<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 23038:66e477f2094cacbd835bbc9ef36f8686c5f16526</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 66e477f2094cacbd835bbc9ef36f8686c5f16526" />
<meta property="og:url" content="/comm-central/rev/66e477f2094cacbd835bbc9ef36f8686c5f16526" />
<meta property="og:description" content="Bug 1429861 - TB: Restore the toolbar bindings/styles after their removal in bug 1428938. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 66e477f2094cacbd835bbc9ef36f8686c5f16526 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/66e477f2094cacbd835bbc9ef36f8686c5f16526">shortlog</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/66e477f2094cacbd835bbc9ef36f8686c5f16526">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526">files</a> |
changeset |
<a href="/comm-central/raw-rev/66e477f2094cacbd835bbc9ef36f8686c5f16526">raw</a>  | <a href="/comm-central/archive/66e477f2094cacbd835bbc9ef36f8686c5f16526.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1429861">Bug 1429861</a> - TB: Restore the toolbar bindings/styles after their removal in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1428938">bug 1428938</a>. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#105;&#99;&#104;&#97;&#114;&#100;&#32;&#77;&#97;&#114;&#116;&#105;&#32;&#60;&#114;&#105;&#99;&#104;&#97;&#114;&#100;&#46;&#109;&#97;&#114;&#116;&#105;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 11 Jan 2018 06:47:27 +0100</td></tr>

<tr>
 <td>changeset 23038</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/66e477f2094cacbd835bbc9ef36f8686c5f16526">66e477f2094cacbd835bbc9ef36f8686c5f16526</a></td>
</tr>



<tr>
<td>parent 23037</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/37b853ebb72630500b8d003c0fb37ebe993af2b4">37b853ebb72630500b8d003c0fb37ebe993af2b4</a>
</td>
</tr>

<tr>
<td>child 23039</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6f984a633da61cbae7b6e479ee0046907c72ff49">6f984a633da61cbae7b6e479ee0046907c72ff49</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=66e477f2094cacbd835bbc9ef36f8686c5f16526">13945</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 11 Jan 2018 23:09:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@66e477f2094c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=66e477f2094cacbd835bbc9ef36f8686c5f16526">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=66e477f2094cacbd835bbc9ef36f8686c5f16526&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=66e477f2094cacbd835bbc9ef36f8686c5f16526&newProject=comm-central&newRevision=66e477f2094cacbd835bbc9ef36f8686c5f16526&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=66e477f2094cacbd835bbc9ef36f8686c5f16526&newProject=comm-central&newRevision=66e477f2094cacbd835bbc9ef36f8686c5f16526&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=66e477f2094cacbd835bbc9ef36f8686c5f16526&newProject=comm-central&newRevision=66e477f2094cacbd835bbc9ef36f8686c5f16526&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1429861">1429861</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1428938">1428938</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1429861">Bug 1429861</a> - TB: Restore the toolbar bindings/styles after their removal in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1428938">bug 1428938</a>. r=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/content/dialogs/calendar-event-dialog.xul">calendar/base/content/dialogs/calendar-event-dialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/content/dialogs/calendar-event-dialog.xul">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/content/dialogs/calendar-event-dialog.xul">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/content/dialogs/calendar-event-dialog.xul">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/content/dialogs/calendar-event-dialog.xul">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/content/dialogs/calendar-event-dialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/jar.mn">calendar/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/content/lightning-item-panel.js">calendar/lightning/content/lightning-item-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/content/lightning-item-panel.js">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/content/lightning-item-panel.js">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/content/lightning-item-panel.js">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/content/lightning-item-panel.js">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/content/lightning-item-panel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/jar.mn">calendar/lightning/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/calendar/lightning/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/bindings/toolbar.xml">common/bindings/toolbar.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/bindings/toolbar.xml">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/bindings/toolbar.xml">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/bindings/toolbar.xml">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/bindings/toolbar.xml">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/bindings/toolbar.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.css">common/src/customizeToolbar.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.css">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.css">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.css">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.css">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.js">common/src/customizeToolbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.js">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.js">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.js">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.js">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.xul">common/src/customizeToolbar.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.xul">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.xul">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.xul">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.xul">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/common/src/customizeToolbar.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/bindings.css">mail/base/content/bindings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/bindings.css">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/bindings.css">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/bindings.css">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/bindings.css">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/bindings.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/addrbook/content/addressbook.xul">mail/components/addrbook/content/addressbook.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/addrbook/content/addressbook.xul">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/addrbook/content/addressbook.xul">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/addrbook/content/addressbook.xul">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/addrbook/content/addressbook.xul">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/addrbook/content/addressbook.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/compose/content/messengercompose.xul">mail/components/compose/content/messengercompose.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/compose/content/messengercompose.xul">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/compose/content/messengercompose.xul">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/compose/content/messengercompose.xul">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/compose/content/messengercompose.xul">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/compose/content/messengercompose.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/im/jar.mn">mail/components/im/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/im/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/im/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/im/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/im/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/components/im/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd">mail/locales/en-US/chrome/messenger/customizeToolbar.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.properties">mail/locales/en-US/chrome/messenger/customizeToolbar.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.properties">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.properties">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.properties">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.properties">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/en-US/chrome/messenger/customizeToolbar.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/mozmill/shared-modules/test-customization-helpers.js">mail/test/mozmill/shared-modules/test-customization-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/mozmill/shared-modules/test-customization-helpers.js">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/mozmill/shared-modules/test-customization-helpers.js">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/mozmill/shared-modules/test-customization-helpers.js">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/mozmill/shared-modules/test-customization-helpers.js">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/mozmill/shared-modules/test-customization-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/resources/mozmill/mozmill/extension/chrome.manifest">mail/test/resources/mozmill/mozmill/extension/chrome.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/resources/mozmill/mozmill/extension/chrome.manifest">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/resources/mozmill/mozmill/extension/chrome.manifest">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/resources/mozmill/mozmill/extension/chrome.manifest">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/resources/mozmill/mozmill/extension/chrome.manifest">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/test/resources/mozmill/mozmill/extension/chrome.manifest">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/jar.mn">mail/themes/linux/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/mail/customizeToolbar.css">mail/themes/linux/mail/customizeToolbar.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/mail/customizeToolbar.css">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/mail/customizeToolbar.css">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/mail/customizeToolbar.css">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/mail/customizeToolbar.css">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/linux/mail/customizeToolbar.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/jar.mn">mail/themes/osx/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/mail/customizeToolbar.css">mail/themes/osx/mail/customizeToolbar.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/mail/customizeToolbar.css">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/mail/customizeToolbar.css">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/mail/customizeToolbar.css">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/mail/customizeToolbar.css">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/osx/mail/customizeToolbar.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/jar.mn">mail/themes/windows/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/jar.mn">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/jar.mn">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/jar.mn">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/jar.mn">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/mail/customizeToolbar.css">mail/themes/windows/mail/customizeToolbar.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/mail/customizeToolbar.css">file</a> |
<a href="/comm-central/annotate/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/mail/customizeToolbar.css">annotate</a> |
<a href="/comm-central/diff/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/mail/customizeToolbar.css">diff</a> |
<a href="/comm-central/comparison/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/mail/customizeToolbar.css">comparison</a> |
<a href="/comm-central/log/66e477f2094cacbd835bbc9ef36f8686c5f16526/mail/themes/windows/mail/customizeToolbar.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.6"></a><span id="l1.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.7"></a><span id="l1.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://global/skin/global.css&quot;?&gt;</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+&lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/content/bindings.css&quot;?&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar-common/skin/calendar-alarms.css&quot;?&gt;</span>
<a href="#l1.12"></a><span id="l1.12"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar-common/skin/calendar-attendees.css&quot;?&gt;</span>
<a href="#l1.13"></a><span id="l1.13"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/widgets/calendar-widget-bindings.css&quot;?&gt;</span>
<a href="#l1.14"></a><span id="l1.14"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/skin/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/datetimepickers/datetimepickers.css&quot;?&gt;</span>
<a href="#l1.17"></a><span id="l1.17"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/skin/primaryToolbar.css&quot;?&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/skin/messenger.css&quot;?&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/jar.mn</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/jar.mn</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -100,18 +100,18 @@ calendar.jar:</span>
<a href="#l2.4"></a><span id="l2.4">     content/calendar/widgets/calendar-widget-bindings.css  (content/widgets/calendar-widget-bindings.css)</span>
<a href="#l2.5"></a><span id="l2.5">     content/calendar/calApplicationUtils.js                (src/calApplicationUtils.js)</span>
<a href="#l2.6"></a><span id="l2.6">     content/calendar/calFilter.js                          (src/calFilter.js)</span>
<a href="#l2.7"></a><span id="l2.7">     content/calendar/WindowsNTToZoneInfoTZId.properties    (src/WindowsNTToZoneInfoTZId.properties)</span>
<a href="#l2.8"></a><span id="l2.8"> % skin calendar classic/1.0 chrome/skin/linux/calendar/</span>
<a href="#l2.9"></a><span id="l2.9"> % skin calendar classic/1.0 chrome/skin/osx/calendar/ os=Darwin</span>
<a href="#l2.10"></a><span id="l2.10"> % skin calendar classic/1.0 chrome/skin/windows/calendar/ os=WINNT</span>
<a href="#l2.11"></a><span id="l2.11"> % skin calendar-common classic/1.0 chrome/skin/common/</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://calendar/skin/calendar-task-view.css</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://calendar/skin/calendar-task-view.css</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css</span>
<a href="#l2.16"></a><span id="l2.16"> % style chrome://calendar/content/calendar-event-dialog.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css</span>
<a href="#l2.17"></a><span id="l2.17"> % style chrome://lightning/content/lightning-item-iframe.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css</span>
<a href="#l2.18"></a><span id="l2.18"> % style chrome://calendar/content/calendar-event-dialog-attendees.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css</span>
<a href="#l2.19"></a><span id="l2.19">     ../icons/default/calendar-alarm-dialog.ico        (themes/common/icons/calendar-alarm-dialog.ico)</span>
<a href="#l2.20"></a><span id="l2.20">     ../icons/default/calendar-alarm-dialog.png        (themes/common/icons/calendar-alarm-dialog.png)</span>
<a href="#l2.21"></a><span id="l2.21">     ../icons/default/calendar-event-dialog.ico        (themes/common/icons/calendar-event-dialog.ico)</span>
<a href="#l2.22"></a><span id="l2.22">     ../icons/default/calendar-event-dialog.png        (themes/common/icons/calendar-event-dialog.png)</span>
<a href="#l2.23"></a><span id="l2.23">     ../icons/default/calendar-event-summary-dialog.ico (themes/common/icons/calendar-event-summary-dialog.ico)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1020,17 +1020,17 @@ function onCommandCustomize() {</span>
<a href="#l3.4"></a><span id="l3.4">     }</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">     // Disable the toolbar context menu items</span>
<a href="#l3.7"></a><span id="l3.7">     document.getElementById(&quot;cmd_customize&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">     let wintype = document.documentElement.getAttribute(&quot;windowtype&quot;);</span>
<a href="#l3.10"></a><span id="l3.10">     wintype = wintype.replace(/:/g, &quot;&quot;);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    window.openDialog(&quot;chrome://global/content/customizeToolbar.xul&quot;,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    window.openDialog(&quot;chrome://messenger/content/customizeToolbar.xul&quot;,</span>
<a href="#l3.14"></a><span id="l3.14">                       &quot;CustomizeToolbar&quot; + wintype,</span>
<a href="#l3.15"></a><span id="l3.15">                       &quot;chrome,all,dependent&quot;,</span>
<a href="#l3.16"></a><span id="l3.16">                       document.getElementById(toolboxId), // toolbox dom node</span>
<a href="#l3.17"></a><span id="l3.17">                       false,                              // is mode toolbar yes/no?</span>
<a href="#l3.18"></a><span id="l3.18">                       null,                               // callback function</span>
<a href="#l3.19"></a><span id="l3.19">                       &quot;dialog&quot;);                          // name of this mode</span>
<a href="#l3.20"></a><span id="l3.20"> }</span>
<a href="#l3.21"></a><span id="l3.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/lightning/jar.mn</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/lightning/jar.mn</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -73,20 +73,20 @@ lightning.jar:</span>
<a href="#l4.4"></a><span id="l4.4">     content/lightning/caldav-lightning-calendar-properties.js   (../providers/caldav/content/caldav-lightning-calendar-properties.js)</span>
<a href="#l4.5"></a><span id="l4.5">     content/lightning/caldav-lightning-utils.js                 (../providers/caldav/content/caldav-lightning-utils.js)</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> % skin lightning classic/1.0 chrome/skin/linux/lightning/</span>
<a href="#l4.8"></a><span id="l4.8"> % skin lightning classic/1.0 chrome/skin/osx/lightning/ os=Darwin</span>
<a href="#l4.9"></a><span id="l4.9"> % skin lightning classic/1.0 chrome/skin/windows/lightning/ os=WINNT</span>
<a href="#l4.10"></a><span id="l4.10"> % skin lightning-common classic/1.0 chrome/skin/lightning-common/</span>
<a href="#l4.11"></a><span id="l4.11"> % style chrome://messenger/content/messageWindow.xul chrome://lightning/skin/lightning.css</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://lightning/skin/lightning-toolbar.css</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://lightning/skin/lightning-toolbar.css</span>
<a href="#l4.14"></a><span id="l4.14"> % style chrome://calendar/content/calendar-event-dialog.xul chrome://communicator/skin/communicator.css application={92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://lightning-common/skin/lightning.css application={92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css application={92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://lightning-common/skin/lightning.css application={92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://calendar-common/skin/dialogs/calendar-event-dialog.css application={92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}</span>
<a href="#l4.19"></a><span id="l4.19">     ../skin/lightning-common/mode-switch-icons.png            (themes/common/images/mode-switch-icons.png)</span>
<a href="#l4.20"></a><span id="l4.20">     ../skin/lightning-common/todayButton-arrow.svg            (themes/common/images/todayButton-arrow.svg)</span>
<a href="#l4.21"></a><span id="l4.21">     ../skin/lightning-common/suite-accountCentral.css         (themes/common/suite-accountCentral.css)</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> # Linux theme files</span>
<a href="#l4.24"></a><span id="l4.24">     ../skin/linux/lightning/accountCentral.css                (themes/linux/accountCentral.css)</span>
<a href="#l4.25"></a><span id="l4.25">     ../skin/linux/lightning/imip.css                          (themes/linux/imip.css)</span>
<a href="#l4.26"></a><span id="l4.26">     ../skin/linux/lightning/lightning.css                     (themes/linux/lightning.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/common/bindings/toolbar.xml</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,598 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+&lt;bindings id=&quot;toolbarBindings&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  &lt;binding id=&quot;toolbar-base&quot;&gt;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+    &lt;resources&gt;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+      &lt;stylesheet src=&quot;chrome://global/skin/toolbar.css&quot;/&gt;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+    &lt;/resources&gt;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+  &lt;binding id=&quot;toolbox&quot; extends=&quot;chrome://messenger/content/toolbar.xml#toolbar-base&quot;&gt;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+      &lt;field name=&quot;palette&quot;&gt;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+        null</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+      &lt;field name=&quot;toolbarset&quot;&gt;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+        null</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      &lt;field name=&quot;customToolbarCount&quot;&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+        0</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+      &lt;field name=&quot;externalToolbars&quot;&gt;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+       []</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+      &lt;!-- Set by customizeToolbar.js --&gt;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+      &lt;property name=&quot;customizing&quot;&gt;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+          return this.getAttribute(&quot;customizing&quot;) == &quot;true&quot;;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+          if (val)</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+            this.setAttribute(&quot;customizing&quot;, &quot;true&quot;);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+          else</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+            this.removeAttribute(&quot;customizing&quot;);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+          return val;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+      &lt;constructor&gt;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+          // Look to see if there is a toolbarset.</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+          this.toolbarset = this.firstChild;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+          while (this.toolbarset &amp;&amp; this.toolbarset.localName != &quot;toolbarset&quot;)</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+            this.toolbarset = this.toolbarset.nextSibling;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+          if (this.toolbarset) {</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+            // Create each toolbar described by the toolbarset.</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+            var index = 0;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+            while (this.toolbarset.hasAttribute(&quot;toolbar&quot; + (++index))) {</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+              var toolbarInfo = this.toolbarset.getAttribute(&quot;toolbar&quot; + index);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+              var infoSplit = toolbarInfo.split(&quot;:&quot;);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+              this.appendCustomToolbar(infoSplit[0], infoSplit[1]);</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+            }</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+          }</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+      &lt;/constructor&gt;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+      &lt;method name=&quot;appendCustomToolbar&quot;&gt;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+        &lt;parameter name=&quot;aName&quot;/&gt;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+        &lt;parameter name=&quot;aCurrentSet&quot;/&gt;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+            if (!this.toolbarset)</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+              return null;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+            var toolbar = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+                                                  &quot;toolbar&quot;);</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+            toolbar.id = &quot;__customToolbar_&quot; + aName.replace(&quot; &quot;, &quot;_&quot;);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+            toolbar.setAttribute(&quot;customizable&quot;, &quot;true&quot;);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+            toolbar.setAttribute(&quot;customindex&quot;, ++this.customToolbarCount);</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+            toolbar.setAttribute(&quot;toolbarname&quot;, aName);</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+            toolbar.setAttribute(&quot;currentset&quot;, aCurrentSet);</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+            toolbar.setAttribute(&quot;mode&quot;, this.getAttribute(&quot;mode&quot;));</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+            toolbar.setAttribute(&quot;iconsize&quot;, this.getAttribute(&quot;iconsize&quot;));</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+            toolbar.setAttribute(&quot;context&quot;, this.toolbarset.getAttribute(&quot;context&quot;));</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+            toolbar.setAttribute(&quot;class&quot;, &quot;chromeclass-toolbar&quot;);</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+            this.insertBefore(toolbar, this.toolbarset);</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+            return toolbar;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+  &lt;binding id=&quot;toolbar&quot; role=&quot;xul:toolbar&quot;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+           extends=&quot;chrome://messenger/content/toolbar.xml#toolbar-base&quot;&gt;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+      &lt;property name=&quot;toolbarName&quot;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+                onget=&quot;return this.getAttribute('toolbarname');&quot;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+                onset=&quot;this.setAttribute('toolbarname', val); return val;&quot;/&gt;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+      &lt;field name=&quot;_toolbox&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+      &lt;property name=&quot;toolbox&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+          if (this._toolbox)</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+            return this._toolbox;</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+          let toolboxId = this.getAttribute(&quot;toolboxid&quot;);</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+          if (toolboxId) {</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+            let toolbox = document.getElementById(toolboxId);</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+            if (!toolbox) {</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+              let tbName = this.toolbarName;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+              if (tbName)</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+                tbName = &quot; (&quot; + tbName + &quot;)&quot;;</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+              else</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+                tbName = &quot;&quot;;</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+              throw new Error(`toolbar ID ${this.id}${tbName}: toolboxid attribute '${toolboxId}' points to a toolbox that doesn't exist`);</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+            }</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+            if (toolbox.externalToolbars.indexOf(this) == -1)</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+              toolbox.externalToolbars.push(this);</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+            return this._toolbox = toolbox;</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+          }</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+          return this._toolbox = (this.parentNode &amp;&amp;</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineplus">+                                  this.parentNode.localName == &quot;toolbox&quot;) ?</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+                                 this.parentNode : null;</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+      &lt;constructor&gt;</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineplus">+          if (document.readyState == &quot;complete&quot;) {</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+            this._init();</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+          } else {</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+            // Need to wait until XUL overlays are loaded. See bug 554279.</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+            let self = this;</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+            document.addEventListener(&quot;readystatechange&quot;, function listener(event) {</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+              if (document.readyState != &quot;complete&quot;)</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+                return;</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+              document.removeEventListener(&quot;readystatechange&quot;, listener);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+              self._init();</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+            });</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+          }</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+      &lt;/constructor&gt;</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+      &lt;method name=&quot;_init&quot;&gt;</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+          // Searching for the toolbox palette in the toolbar binding because</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+          // toolbars are constructed first.</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+          var toolbox = this.toolbox;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+          if (!toolbox)</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+            return;</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+          if (!toolbox.palette) {</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+            // Look to see if there is a toolbarpalette.</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+            var node = toolbox.firstChild;</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+            while (node) {</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+              if (node.localName == &quot;toolbarpalette&quot;)</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+                break;</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+              node = node.nextSibling;</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+            }</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+            if (!node)</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+              return;</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+            // Hold on to the palette but remove it from the document.</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+            toolbox.palette = node;</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+            toolbox.removeChild(node);</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineplus">+          }</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineplus">+</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineplus">+          // Build up our contents from the palette.</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+          var currentSet = this.getAttribute(&quot;currentset&quot;);</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineplus">+          if (!currentSet)</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+            currentSet = this.getAttribute(&quot;defaultset&quot;);</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+          if (currentSet)</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+            this.currentSet = currentSet;</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineplus">+</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+      &lt;method name=&quot;_idFromNode&quot;&gt;</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineplus">+        &lt;parameter name=&quot;aNode&quot;/&gt;</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+          if (aNode.getAttribute(&quot;skipintoolbarset&quot;) == &quot;true&quot;)</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+            return &quot;&quot;;</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+          switch (aNode.localName) {</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineplus">+            case &quot;toolbarseparator&quot;:</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+              return &quot;separator&quot;;</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+            case &quot;toolbarspring&quot;:</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+              return &quot;spring&quot;;</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+            case &quot;toolbarspacer&quot;:</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+              return &quot;spacer&quot;;</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+            default:</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+              return aNode.id;</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+          }</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+      &lt;property name=&quot;currentSet&quot;&gt;</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+            var node = this.firstChild;</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+            var currentSet = [];</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+            while (node) {</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+              var id = this._idFromNode(node);</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+              if (id) {</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+                currentSet.push(id);</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+              }</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+              node = node.nextSibling;</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+            }</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+            return currentSet.join(&quot;,&quot;) || &quot;__empty&quot;;</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineplus">+</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+        &lt;setter&gt;</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+            if (val == this.currentSet)</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+              return val;</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+            var ids = (val == &quot;__empty&quot;) ? [] : val.split(&quot;,&quot;);</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+            var nodeidx = 0;</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+            var paletteItems = { }, added = { };</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineplus">+</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+            var palette = this.toolbox ? this.toolbox.palette : null;</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineplus">+            // build a cache of items in the toolbarpalette</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+            var paletteChildren = palette ? palette.childNodes : [];</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+            for (let c = 0; c &lt; paletteChildren.length; c++) {</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineplus">+              let curNode = paletteChildren[c];</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineplus">+              paletteItems[curNode.id] = curNode;</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineplus">+            }</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineplus">+</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+            var children = this.childNodes;</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineplus">+</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineplus">+            // iterate over the ids to use on the toolbar</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineplus">+            for (let i = 0; i &lt; ids.length; i++) {</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineplus">+              let id = ids[i];</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineplus">+              // iterate over the existing nodes on the toolbar. nodeidx is the</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineplus">+              // spot where we want to insert items.</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineplus">+              let found = false;</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineplus">+              for (let c = nodeidx; c &lt; children.length; c++) {</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineplus">+                let curNode = children[c];</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineplus">+                if (this._idFromNode(curNode) == id) {</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineplus">+                  // the node already exists. If c equals nodeidx, we haven't</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineplus">+                  // iterated yet, so the item is already in the right position.</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+                  // Otherwise, insert it here.</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineplus">+                  if (c != nodeidx) {</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineplus">+                    this.insertBefore(curNode, children[nodeidx]);</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineplus">+                  }</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineplus">+</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineplus">+                  added[curNode.id] = true;</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineplus">+                  nodeidx++;</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineplus">+                  found = true;</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineplus">+                  break;</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineplus">+                }</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineplus">+              }</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineplus">+              if (found) {</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineplus">+                // move on to the next id</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineplus">+                continue;</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineplus">+              }</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineplus">+</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+              // the node isn't already on the toolbar, so add a new one.</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineplus">+              var nodeToAdd = paletteItems[id] || this._getToolbarItem(id);</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+              if (nodeToAdd &amp;&amp; !(nodeToAdd.id in added)) {</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+                added[nodeToAdd.id] = true;</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+                this.insertBefore(nodeToAdd, children[nodeidx] || null);</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineplus">+                nodeToAdd.setAttribute(&quot;removable&quot;, &quot;true&quot;);</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineplus">+                nodeidx++;</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineplus">+              }</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineplus">+            }</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineplus">+</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+            // remove any leftover removable nodes</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+            for (let i = children.length - 1; i &gt;= nodeidx; i--) {</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+              let curNode = children[i];</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineplus">+</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineplus">+              let curNodeId = this._idFromNode(curNode);</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineplus">+              // skip over fixed items</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineplus">+              if (curNodeId &amp;&amp; curNode.getAttribute(&quot;removable&quot;) == &quot;true&quot;) {</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineplus">+                if (palette)</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineplus">+                  palette.appendChild(curNode);</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineplus">+                else</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineplus">+                  this.removeChild(curNode);</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineplus">+              }</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineplus">+            }</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineplus">+</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineplus">+            return val;</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineplus">+        &lt;/setter&gt;</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineplus">+</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineplus">+      &lt;field name=&quot;_newElementCount&quot;&gt;0&lt;/field&gt;</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineplus">+      &lt;method name=&quot;_getToolbarItem&quot;&gt;</span>
<a href="#l5.307"></a><span id="l5.307" class="difflineplus">+        &lt;parameter name=&quot;aId&quot;/&gt;</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineplus">+            const XUL_NS = &quot;http://www.mozilla.org/keymaster/&quot; +</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineplus">+                           &quot;gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineplus">+</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineplus">+            var newItem = null;</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineplus">+            switch (aId) {</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineplus">+              // Handle special cases</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineplus">+              case &quot;separator&quot;:</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineplus">+              case &quot;spring&quot;:</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineplus">+              case &quot;spacer&quot;:</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineplus">+                newItem = document.createElementNS(XUL_NS, &quot;toolbar&quot; + aId);</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineplus">+                // Due to timers resolution Date.now() can be the same for</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineplus">+                // elements created in small timeframes.  So ids are</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineplus">+                // differentiated through a unique count suffix.</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineplus">+                newItem.id = aId + Date.now() + (++this._newElementCount);</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineplus">+                if (aId == &quot;spring&quot;)</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineplus">+                  newItem.flex = 1;</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineplus">+                break;</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineplus">+              default:</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineplus">+                var toolbox = this.toolbox;</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineplus">+                if (!toolbox)</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineplus">+                  break;</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineplus">+</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineplus">+                // look for an item with the same id, as the item may be</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineplus">+                // in a different toolbar.</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineplus">+                var item = document.getElementById(aId);</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineplus">+                if (item &amp;&amp; item.parentNode &amp;&amp;</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineplus">+                    item.parentNode.localName == &quot;toolbar&quot; &amp;&amp;</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineplus">+                    item.parentNode.toolbox == toolbox) {</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineplus">+                  newItem = item;</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineplus">+                  break;</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineplus">+                }</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineplus">+</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineplus">+                if (toolbox.palette) {</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineplus">+                  // Attempt to locate an item with a matching ID within</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineplus">+                  // the palette.</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineplus">+                  let paletteItem = this.toolbox.palette.firstChild;</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineplus">+                  while (paletteItem) {</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineplus">+                    if (paletteItem.id == aId) {</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineplus">+                      newItem = paletteItem;</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineplus">+                      break;</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineplus">+                    }</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineplus">+                    paletteItem = paletteItem.nextSibling;</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineplus">+                  }</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineplus">+                }</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineplus">+                break;</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineplus">+            }</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineplus">+</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineplus">+            return newItem;</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineplus">+</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineplus">+      &lt;method name=&quot;insertItem&quot;&gt;</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineplus">+        &lt;parameter name=&quot;aId&quot;/&gt;</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineplus">+        &lt;parameter name=&quot;aBeforeElt&quot;/&gt;</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineplus">+        &lt;parameter name=&quot;aWrapper&quot;/&gt;</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineplus">+            var newItem = this._getToolbarItem(aId);</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineplus">+            if (!newItem)</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineplus">+              return null;</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineplus">+</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineplus">+            var insertItem = newItem;</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineplus">+            // make sure added items are removable</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineplus">+            newItem.setAttribute(&quot;removable&quot;, &quot;true&quot;);</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineplus">+</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineplus">+            // Wrap the item in another node if so inclined.</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineplus">+            if (aWrapper) {</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineplus">+              aWrapper.appendChild(newItem);</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineplus">+              insertItem = aWrapper;</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineplus">+            }</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineplus">+</span>
<a href="#l5.382"></a><span id="l5.382" class="difflineplus">+            // Insert the palette item into the toolbar.</span>
<a href="#l5.383"></a><span id="l5.383" class="difflineplus">+            if (aBeforeElt)</span>
<a href="#l5.384"></a><span id="l5.384" class="difflineplus">+              this.insertBefore(insertItem, aBeforeElt);</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineplus">+            else</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineplus">+              this.appendChild(insertItem);</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineplus">+</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineplus">+            return newItem;</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.392"></a><span id="l5.392" class="difflineplus">+</span>
<a href="#l5.393"></a><span id="l5.393" class="difflineplus">+      &lt;method name=&quot;hasCustomInteractiveItems&quot;&gt;</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineplus">+        &lt;parameter name=&quot;aCurrentSet&quot;/&gt;</span>
<a href="#l5.395"></a><span id="l5.395" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.396"></a><span id="l5.396" class="difflineplus">+          if (aCurrentSet == &quot;__empty&quot;)</span>
<a href="#l5.397"></a><span id="l5.397" class="difflineplus">+            return false;</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineplus">+</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineplus">+          var defaultOrNoninteractive = (this.getAttribute(&quot;defaultset&quot;) || &quot;&quot;)</span>
<a href="#l5.400"></a><span id="l5.400" class="difflineplus">+                                          .split(&quot;,&quot;)</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineplus">+                                          .concat([&quot;separator&quot;, &quot;spacer&quot;, &quot;spring&quot;]);</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineplus">+          return aCurrentSet.split(&quot;,&quot;).some(function(item) {</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineplus">+            return defaultOrNoninteractive.indexOf(item) == -1;</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineplus">+          });</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.407"></a><span id="l5.407" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineplus">+</span>
<a href="#l5.410"></a><span id="l5.410" class="difflineplus">+  &lt;binding id=&quot;toolbar-menubar-autohide&quot;</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineplus">+           extends=&quot;chrome://messenger/content/toolbar.xml#toolbar&quot;&gt;</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineplus">+      &lt;constructor&gt;</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineplus">+        this._setInactive();</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineplus">+      &lt;/constructor&gt;</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineplus">+      &lt;destructor&gt;</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineplus">+        this._setActive();</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineplus">+      &lt;/destructor&gt;</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineplus">+</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineplus">+      &lt;field name=&quot;_inactiveTimeout&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineplus">+</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineplus">+      &lt;field name=&quot;_contextMenuListener&quot;&gt;&lt;![CDATA[({</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineplus">+        toolbar: this,</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineplus">+        contextMenu: null,</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineplus">+</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineplus">+        get active() {</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineplus">+          return !!this.contextMenu;</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineplus">+        },</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineplus">+</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineplus">+        init(event) {</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineplus">+          var node = event.target;</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineplus">+          while (node != this.toolbar) {</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineplus">+            if (node.localName == &quot;menupopup&quot;)</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineplus">+              return;</span>
<a href="#l5.435"></a><span id="l5.435" class="difflineplus">+            node = node.parentNode;</span>
<a href="#l5.436"></a><span id="l5.436" class="difflineplus">+          }</span>
<a href="#l5.437"></a><span id="l5.437" class="difflineplus">+</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineplus">+          var contextMenuId = this.toolbar.getAttribute(&quot;context&quot;);</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineplus">+          if (!contextMenuId)</span>
<a href="#l5.440"></a><span id="l5.440" class="difflineplus">+            return;</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineplus">+</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineplus">+          this.contextMenu = document.getElementById(contextMenuId);</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineplus">+          if (!this.contextMenu)</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineplus">+            return;</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineplus">+</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineplus">+          this.contextMenu.addEventListener(&quot;popupshown&quot;, this);</span>
<a href="#l5.447"></a><span id="l5.447" class="difflineplus">+          this.contextMenu.addEventListener(&quot;popuphiding&quot;, this);</span>
<a href="#l5.448"></a><span id="l5.448" class="difflineplus">+          this.toolbar.addEventListener(&quot;mousemove&quot;, this);</span>
<a href="#l5.449"></a><span id="l5.449" class="difflineplus">+        },</span>
<a href="#l5.450"></a><span id="l5.450" class="difflineplus">+        handleEvent(event) {</span>
<a href="#l5.451"></a><span id="l5.451" class="difflineplus">+          switch (event.type) {</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineplus">+            case &quot;popupshown&quot;:</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineplus">+              this.toolbar.removeEventListener(&quot;mousemove&quot;, this);</span>
<a href="#l5.454"></a><span id="l5.454" class="difflineplus">+              break;</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineplus">+            case &quot;popuphiding&quot;:</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineplus">+            case &quot;mousemove&quot;:</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineplus">+              this.toolbar._setInactiveAsync();</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineplus">+              this.toolbar.removeEventListener(&quot;mousemove&quot;, this);</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineplus">+              this.contextMenu.removeEventListener(&quot;popuphiding&quot;, this);</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineplus">+              this.contextMenu.removeEventListener(&quot;popupshown&quot;, this);</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineplus">+              this.contextMenu = null;</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineplus">+              break;</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineplus">+          }</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineplus">+        }</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineplus">+      })]]&gt;&lt;/field&gt;</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineplus">+</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineplus">+      &lt;method name=&quot;_setInactive&quot;&gt;</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineplus">+          this.setAttribute(&quot;inactive&quot;, &quot;true&quot;);</span>
<a href="#l5.470"></a><span id="l5.470" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.471"></a><span id="l5.471" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.472"></a><span id="l5.472" class="difflineplus">+</span>
<a href="#l5.473"></a><span id="l5.473" class="difflineplus">+      &lt;method name=&quot;_setInactiveAsync&quot;&gt;</span>
<a href="#l5.474"></a><span id="l5.474" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.475"></a><span id="l5.475" class="difflineplus">+          this._inactiveTimeout = setTimeout(function(self) {</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineplus">+            if (self.getAttribute(&quot;autohide&quot;) == &quot;true&quot;) {</span>
<a href="#l5.477"></a><span id="l5.477" class="difflineplus">+              self._inactiveTimeout = null;</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineplus">+              self._setInactive();</span>
<a href="#l5.479"></a><span id="l5.479" class="difflineplus">+            }</span>
<a href="#l5.480"></a><span id="l5.480" class="difflineplus">+          }, 0, this);</span>
<a href="#l5.481"></a><span id="l5.481" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineplus">+</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineplus">+      &lt;method name=&quot;_setActive&quot;&gt;</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineplus">+          if (this._inactiveTimeout) {</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineplus">+            clearTimeout(this._inactiveTimeout);</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineplus">+            this._inactiveTimeout = null;</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineplus">+          }</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineplus">+          this.removeAttribute(&quot;inactive&quot;);</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineplus">+</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineplus">+    &lt;handlers&gt;</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineplus">+      &lt;handler event=&quot;DOMMenuBarActive&quot;     action=&quot;this._setActive();&quot;/&gt;</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineplus">+      &lt;handler event=&quot;popupshowing&quot;         action=&quot;this._setActive();&quot;/&gt;</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineplus">+      &lt;handler event=&quot;mousedown&quot; button=&quot;2&quot; action=&quot;this._contextMenuListener.init(event);&quot;/&gt;</span>
<a href="#l5.499"></a><span id="l5.499" class="difflineplus">+      &lt;handler event=&quot;DOMMenuBarInactive&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineplus">+        if (!this._contextMenuListener.active)</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineplus">+          this._setInactiveAsync();</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineplus">+    &lt;/handlers&gt;</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineplus">+</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineplus">+  &lt;binding id=&quot;toolbar-drag&quot;</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineplus">+           extends=&quot;chrome://messenger/content/toolbar.xml#toolbar&quot;&gt;</span>
<a href="#l5.508"></a><span id="l5.508" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l5.509"></a><span id="l5.509" class="difflineplus">+      &lt;field name=&quot;_dragBindingAlive&quot;&gt;true&lt;/field&gt;</span>
<a href="#l5.510"></a><span id="l5.510" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l5.511"></a><span id="l5.511" class="difflineplus">+        if (!this._draggableStarted) {</span>
<a href="#l5.512"></a><span id="l5.512" class="difflineplus">+          this._draggableStarted = true;</span>
<a href="#l5.513"></a><span id="l5.513" class="difflineplus">+          try {</span>
<a href="#l5.514"></a><span id="l5.514" class="difflineplus">+            let tmp = {};</span>
<a href="#l5.515"></a><span id="l5.515" class="difflineplus">+            Components.utils.import(&quot;resource://gre/modules/WindowDraggingUtils.jsm&quot;, tmp);</span>
<a href="#l5.516"></a><span id="l5.516" class="difflineplus">+            let draggableThis = new tmp.WindowDraggingElement(this);</span>
<a href="#l5.517"></a><span id="l5.517" class="difflineplus">+            draggableThis.mouseDownCheck = function(e) {</span>
<a href="#l5.518"></a><span id="l5.518" class="difflineplus">+              // Don't move while customizing.</span>
<a href="#l5.519"></a><span id="l5.519" class="difflineplus">+              return this._dragBindingAlive &amp;&amp;</span>
<a href="#l5.520"></a><span id="l5.520" class="difflineplus">+                     this.getAttribute(&quot;customizing&quot;) != &quot;true&quot;;</span>
<a href="#l5.521"></a><span id="l5.521" class="difflineplus">+            };</span>
<a href="#l5.522"></a><span id="l5.522" class="difflineplus">+          } catch (e) {}</span>
<a href="#l5.523"></a><span id="l5.523" class="difflineplus">+        }</span>
<a href="#l5.524"></a><span id="l5.524" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineplus">+</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineplus">+  &lt;binding id=&quot;menubar&quot; role=&quot;xul:menubar&quot;</span>
<a href="#l5.529"></a><span id="l5.529" class="difflineplus">+           extends=&quot;chrome://messenger/content/toolbar.xml#toolbar-base&quot; display=&quot;xul:menubar&quot;&gt;</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineplus">+       &lt;field name=&quot;_active&quot;&gt;false&lt;/field&gt;</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineplus">+       &lt;field name=&quot;_statusbar&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineplus">+       &lt;field name=&quot;_originalStatusText&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.534"></a><span id="l5.534" class="difflineplus">+       &lt;property name=&quot;statusbar&quot; onget=&quot;return this.getAttribute('statusbar');&quot;</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineplus">+                                  onset=&quot;this.setAttribute('statusbar', val); return val;&quot;/&gt;</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineplus">+       &lt;method name=&quot;_updateStatusText&quot;&gt;</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineplus">+          &lt;parameter name=&quot;itemText&quot;/&gt;</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineplus">+          &lt;body&gt;</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineplus">+           &lt;![CDATA[</span>
<a href="#l5.540"></a><span id="l5.540" class="difflineplus">+            if (!this._active)</span>
<a href="#l5.541"></a><span id="l5.541" class="difflineplus">+                return;</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineplus">+            var newText = itemText ? itemText : this._originalStatusText;</span>
<a href="#l5.543"></a><span id="l5.543" class="difflineplus">+            if (newText != this._statusbar.label)</span>
<a href="#l5.544"></a><span id="l5.544" class="difflineplus">+                this._statusbar.label = newText;</span>
<a href="#l5.545"></a><span id="l5.545" class="difflineplus">+           ]]&gt;</span>
<a href="#l5.546"></a><span id="l5.546" class="difflineplus">+          &lt;/body&gt;</span>
<a href="#l5.547"></a><span id="l5.547" class="difflineplus">+        &lt;/method&gt;</span>
<a href="#l5.548"></a><span id="l5.548" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l5.549"></a><span id="l5.549" class="difflineplus">+    &lt;handlers&gt;</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineplus">+        &lt;handler event=&quot;DOMMenuBarActive&quot;&gt;</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineplus">+            if (!this.statusbar) return;</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineplus">+            this._statusbar = document.getElementById(this.statusbar);</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineplus">+            if (!this._statusbar)</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineplus">+              return;</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineplus">+            this._active = true;</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineplus">+            this._originalStatusText = this._statusbar.label;</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineplus">+        &lt;/handler&gt;</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineplus">+        &lt;handler event=&quot;DOMMenuBarInactive&quot;&gt;</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineplus">+            if (!this._active)</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineplus">+              return;</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineplus">+            this._active = false;</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineplus">+            this._statusbar.label = this._originalStatusText;</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineplus">+          ]]&gt;</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineplus">+        &lt;/handler&gt;</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineplus">+        &lt;handler event=&quot;DOMMenuItemActive&quot;&gt;this._updateStatusText(event.target.statusText);&lt;/handler&gt;</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineplus">+        &lt;handler event=&quot;DOMMenuItemInactive&quot;&gt;this._updateStatusText(&quot;&quot;);&lt;/handler&gt;</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineplus">+    &lt;/handlers&gt;</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineplus">+</span>
<a href="#l5.573"></a><span id="l5.573" class="difflineplus">+  &lt;binding id=&quot;toolbardecoration&quot; role=&quot;xul:toolbarseparator&quot; extends=&quot;chrome://messenger/content/toolbar.xml#toolbar-base&quot;&gt;</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.575"></a><span id="l5.575" class="difflineplus">+</span>
<a href="#l5.576"></a><span id="l5.576" class="difflineplus">+  &lt;binding id=&quot;toolbarpaletteitem&quot; extends=&quot;chrome://messenger/content/toolbar.xml#toolbar-base&quot; display=&quot;xul:button&quot;&gt;</span>
<a href="#l5.577"></a><span id="l5.577" class="difflineplus">+    &lt;content&gt;</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineplus">+      &lt;xul:hbox class=&quot;toolbarpaletteitem-box&quot; flex=&quot;1&quot; xbl:inherits=&quot;type,place&quot;&gt;</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineplus">+        &lt;children/&gt;</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineplus">+      &lt;/xul:hbox&gt;</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineplus">+</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineplus">+  &lt;binding id=&quot;toolbarpaletteitem-palette&quot; extends=&quot;chrome://messenger/content/toolbar.xml#toolbarpaletteitem&quot;&gt;</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineplus">+    &lt;content&gt;</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineplus">+      &lt;xul:hbox class=&quot;toolbarpaletteitem-box&quot; xbl:inherits=&quot;type,place&quot;&gt;</span>
<a href="#l5.587"></a><span id="l5.587" class="difflineplus">+        &lt;children/&gt;</span>
<a href="#l5.588"></a><span id="l5.588" class="difflineplus">+      &lt;/xul:hbox&gt;</span>
<a href="#l5.589"></a><span id="l5.589" class="difflineplus">+      &lt;xul:label xbl:inherits=&quot;value=title&quot;/&gt;</span>
<a href="#l5.590"></a><span id="l5.590" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l5.591"></a><span id="l5.591" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.592"></a><span id="l5.592" class="difflineplus">+</span>
<a href="#l5.593"></a><span id="l5.593" class="difflineplus">+  &lt;binding id=&quot;toolbarpaletteitem-palette-wrapping-label&quot; extends=&quot;chrome://messenger/content/toolbar.xml#toolbarpaletteitem&quot;&gt;</span>
<a href="#l5.594"></a><span id="l5.594" class="difflineplus">+    &lt;content&gt;</span>
<a href="#l5.595"></a><span id="l5.595" class="difflineplus">+      &lt;xul:hbox class=&quot;toolbarpaletteitem-box&quot; xbl:inherits=&quot;type,place&quot;&gt;</span>
<a href="#l5.596"></a><span id="l5.596" class="difflineplus">+        &lt;children/&gt;</span>
<a href="#l5.597"></a><span id="l5.597" class="difflineplus">+      &lt;/xul:hbox&gt;</span>
<a href="#l5.598"></a><span id="l5.598" class="difflineplus">+      &lt;xul:label xbl:inherits=&quot;xbl:text=title&quot;/&gt;</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l5.600"></a><span id="l5.600" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l5.601"></a><span id="l5.601" class="difflineplus">+</span>
<a href="#l5.602"></a><span id="l5.602" class="difflineplus">+&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/common/src/customizeToolbar.css</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,39 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+@namespace html url(&quot;http://www.w3.org/1999/xhtml&quot;);</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+#palette-box {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  overflow: auto;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  display: block;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  min-height: 3em;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+}</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+#palette-box &gt; toolbarpaletteitem {</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+  width: 110px;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+  height: 94px;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+  overflow: hidden;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+  display: inline-block;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+}</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+.toolbarpaletteitem-box {</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+  -moz-box-pack: center;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+  -moz-box-flex: 1;</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  width: 110px;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+  max-width: 110px;</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+}</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+toolbarpaletteitem &gt; label {</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+  text-align: center;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+}</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+#main-box &gt; box {</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+  overflow: hidden;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+}</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+/* Hide the toolbarbutton label because we replicate it on the wrapper */</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+.toolbarbutton-text {</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+  display: none;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/common/src/customizeToolbar.js</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,803 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+var gToolboxDocument = null;</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+var gToolbox = null;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+var gCurrentDragOverItem = null;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+var gToolboxChanged = false;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+var gToolboxSheet = false;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+var gPaletteBox = null;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+function onLoad() {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0]) {</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    InitWithToolbox(window.arguments[0]);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+    repositionDialog(window);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  } else if (window.frameElement &amp;&amp;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+           &quot;toolbox&quot; in window.frameElement) {</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    gToolboxSheet = true;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+    InitWithToolbox(window.frameElement.toolbox);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+    repositionDialog(window.frameElement.panel);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+  }</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+}</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+function InitWithToolbox(aToolbox) {</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  gToolbox = aToolbox;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  dispatchCustomizationEvent(&quot;beforecustomization&quot;);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  gToolboxDocument = gToolbox.ownerDocument;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+  gToolbox.customizing = true;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+    toolbar.setAttribute(&quot;customizing&quot;, &quot;true&quot;);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+  });</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+  gPaletteBox = document.getElementById(&quot;palette-box&quot;);</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+  var elts = getRootElements();</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  for (let i = 0; i &lt; elts.length; i++) {</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+    elts[i].addEventListener(&quot;dragstart&quot;, onToolbarDragStart, true);</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+    elts[i].addEventListener(&quot;dragover&quot;, onToolbarDragOver, true);</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+    elts[i].addEventListener(&quot;dragexit&quot;, onToolbarDragExit, true);</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+    elts[i].addEventListener(&quot;drop&quot;, onToolbarDrop, true);</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+  }</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+  initDialog();</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+}</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+function onClose() {</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+  if (!gToolboxSheet)</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+    window.close();</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+  else</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+    finishToolbarCustomization();</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+}</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+function onUnload() {</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  if (!gToolboxSheet)</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+    finishToolbarCustomization();</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+}</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+function finishToolbarCustomization() {</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+  removeToolboxListeners();</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+  unwrapToolbarItems();</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+  persistCurrentSets();</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  gToolbox.customizing = false;</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+    toolbar.removeAttribute(&quot;customizing&quot;);</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+  });</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  notifyParentComplete();</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+}</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+function initDialog() {</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+  if (!gToolbox.toolbarset) {</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+    document.getElementById(&quot;newtoolbar&quot;).hidden = true;</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+  }</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+  var mode = gToolbox.getAttribute(&quot;mode&quot;);</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+  document.getElementById(&quot;modelist&quot;).value = mode;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+  var smallIconsCheckbox = document.getElementById(&quot;smallicons&quot;);</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+  smallIconsCheckbox.checked = gToolbox.getAttribute(&quot;iconsize&quot;) == &quot;small&quot;;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+  if (mode == &quot;text&quot;)</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+    smallIconsCheckbox.disabled = true;</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+  // Build up the palette of other items.</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+  buildPalette();</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+  // Wrap all the items on the toolbar in toolbarpaletteitems.</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+  wrapToolbarItems();</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineplus">+}</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+function repositionDialog(aWindow) {</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+  // Position the dialog touching the bottom of the toolbox and centered with</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+  // it.</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+  if (!aWindow)</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+    return;</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+  var width;</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+  if (aWindow != window)</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+    width = aWindow.getBoundingClientRect().width;</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+  else if (document.documentElement.hasAttribute(&quot;width&quot;))</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+    width = document.documentElement.getAttribute(&quot;width&quot;);</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+  else</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+    width = parseInt(document.documentElement.style.width);</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+  var screenX = gToolbox.boxObject.screenX</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+                + ((gToolbox.boxObject.width - width) / 2);</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+  var screenY = gToolbox.boxObject.screenY + gToolbox.boxObject.height;</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+  aWindow.moveTo(screenX, screenY);</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+}</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+function removeToolboxListeners() {</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+  var elts = getRootElements();</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineplus">+  for (let i = 0; i &lt; elts.length; i++) {</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+    elts[i].removeEventListener(&quot;dragstart&quot;, onToolbarDragStart, true);</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+    elts[i].removeEventListener(&quot;dragover&quot;, onToolbarDragOver, true);</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+    elts[i].removeEventListener(&quot;dragexit&quot;, onToolbarDragExit, true);</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+    elts[i].removeEventListener(&quot;drop&quot;, onToolbarDrop, true);</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+  }</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineplus">+}</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+/**</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+ * Invoke a callback on the toolbox to notify it that the dialog is done</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+ * and going away.</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+ */</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+function notifyParentComplete() {</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+  if (&quot;customizeDone&quot; in gToolbox)</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineplus">+    gToolbox.customizeDone(gToolboxChanged);</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineplus">+  dispatchCustomizationEvent(&quot;aftercustomization&quot;);</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+}</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+function toolboxChanged(aType) {</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+  gToolboxChanged = true;</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineplus">+  if (&quot;customizeChange&quot; in gToolbox)</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+    gToolbox.customizeChange(aType);</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+  dispatchCustomizationEvent(&quot;customizationchange&quot;);</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineplus">+}</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+function dispatchCustomizationEvent(aEventName) {</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+  var evt = document.createEvent(&quot;Events&quot;);</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineplus">+  evt.initEvent(aEventName, true, true);</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineplus">+  gToolbox.dispatchEvent(evt);</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineplus">+}</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineplus">+</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+/**</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+ * Persist the current set of buttons in all customizable toolbars to</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+ * localstore.</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+ */</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineplus">+function persistCurrentSets() {</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineplus">+  if (!gToolboxChanged || gToolboxDocument.defaultView.closed)</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+    return;</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+  var customCount = 0;</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineplus">+    // Calculate currentset and store it in the attribute.</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineplus">+    var currentSet = toolbar.currentSet;</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+    toolbar.setAttribute(&quot;currentset&quot;, currentSet);</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineplus">+</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+    var customIndex = toolbar.hasAttribute(&quot;customindex&quot;);</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineplus">+    if (customIndex) {</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineplus">+      if (!toolbar.hasChildNodes()) {</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineplus">+        // Remove custom toolbars whose contents have been removed.</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineplus">+        gToolbox.removeChild(toolbar);</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineplus">+      } else if (gToolbox.toolbarset) {</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+        // Persist custom toolbar info on the &lt;toolbarset/&gt;</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineplus">+        gToolbox.toolbarset.setAttribute(&quot;toolbar&quot; + (++customCount),</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineplus">+                                         toolbar.toolbarName + &quot;:&quot; + currentSet);</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineplus">+        gToolboxDocument.persist(gToolbox.toolbarset.id, &quot;toolbar&quot; + customCount);</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineplus">+      }</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineplus">+    }</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineplus">+</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+    if (!customIndex) {</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineplus">+      // Persist the currentset attribute directly on hardcoded toolbars.</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineplus">+      gToolboxDocument.persist(toolbar.id, &quot;currentset&quot;);</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineplus">+    }</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineplus">+  });</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineplus">+  // Remove toolbarX attributes for removed toolbars.</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineplus">+  while (gToolbox.toolbarset &amp;&amp; gToolbox.toolbarset.hasAttribute(&quot;toolbar&quot; + (++customCount))) {</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineplus">+    gToolbox.toolbarset.removeAttribute(&quot;toolbar&quot; + customCount);</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineplus">+    gToolboxDocument.persist(gToolbox.toolbarset.id, &quot;toolbar&quot; + customCount);</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineplus">+  }</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineplus">+}</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineplus">+</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+/**</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineplus">+ * Wraps all items in all customizable toolbars in a toolbox.</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineplus">+ */</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineplus">+function wrapToolbarItems() {</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineplus">+    Array.forEach(toolbar.childNodes, function(item) {</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineplus">+      if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineplus">+        if (item.firstChild &amp;&amp; item.firstChild.localName == &quot;menubar&quot;)</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineplus">+          return;</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineplus">+      }</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineplus">+      if (isToolbarItem(item)) {</span>
<a href="#l7.199"></a><span id="l7.199" class="difflineplus">+        let wrapper = wrapToolbarItem(item);</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineplus">+        cleanupItemForToolbar(item, wrapper);</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineplus">+      }</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineplus">+    });</span>
<a href="#l7.203"></a><span id="l7.203" class="difflineplus">+  });</span>
<a href="#l7.204"></a><span id="l7.204" class="difflineplus">+}</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineplus">+</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineplus">+function getRootElements() {</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineplus">+  return [gToolbox].concat(gToolbox.externalToolbars);</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineplus">+}</span>
<a href="#l7.209"></a><span id="l7.209" class="difflineplus">+</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineplus">+/**</span>
<a href="#l7.211"></a><span id="l7.211" class="difflineplus">+ * Unwraps all items in all customizable toolbars in a toolbox.</span>
<a href="#l7.212"></a><span id="l7.212" class="difflineplus">+ */</span>
<a href="#l7.213"></a><span id="l7.213" class="difflineplus">+function unwrapToolbarItems() {</span>
<a href="#l7.214"></a><span id="l7.214" class="difflineplus">+  let elts = getRootElements();</span>
<a href="#l7.215"></a><span id="l7.215" class="difflineplus">+  for (let i = 0; i &lt; elts.length; i++) {</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineplus">+    let paletteItems = elts[i].getElementsByTagName(&quot;toolbarpaletteitem&quot;);</span>
<a href="#l7.217"></a><span id="l7.217" class="difflineplus">+    let paletteItem;</span>
<a href="#l7.218"></a><span id="l7.218" class="difflineplus">+    while ((paletteItem = paletteItems.item(0)) != null) {</span>
<a href="#l7.219"></a><span id="l7.219" class="difflineplus">+      let toolbarItem = paletteItem.firstChild;</span>
<a href="#l7.220"></a><span id="l7.220" class="difflineplus">+      restoreItemForToolbar(toolbarItem, paletteItem);</span>
<a href="#l7.221"></a><span id="l7.221" class="difflineplus">+      paletteItem.parentNode.replaceChild(toolbarItem, paletteItem);</span>
<a href="#l7.222"></a><span id="l7.222" class="difflineplus">+    }</span>
<a href="#l7.223"></a><span id="l7.223" class="difflineplus">+  }</span>
<a href="#l7.224"></a><span id="l7.224" class="difflineplus">+}</span>
<a href="#l7.225"></a><span id="l7.225" class="difflineplus">+</span>
<a href="#l7.226"></a><span id="l7.226" class="difflineplus">+/**</span>
<a href="#l7.227"></a><span id="l7.227" class="difflineplus">+ * Creates a wrapper that can be used to contain a toolbaritem and prevent</span>
<a href="#l7.228"></a><span id="l7.228" class="difflineplus">+ * it from receiving UI events.</span>
<a href="#l7.229"></a><span id="l7.229" class="difflineplus">+ */</span>
<a href="#l7.230"></a><span id="l7.230" class="difflineplus">+function createWrapper(aId, aDocument) {</span>
<a href="#l7.231"></a><span id="l7.231" class="difflineplus">+  var wrapper = aDocument.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l7.232"></a><span id="l7.232" class="difflineplus">+                                         &quot;toolbarpaletteitem&quot;);</span>
<a href="#l7.233"></a><span id="l7.233" class="difflineplus">+</span>
<a href="#l7.234"></a><span id="l7.234" class="difflineplus">+  wrapper.id = &quot;wrapper-&quot; + aId;</span>
<a href="#l7.235"></a><span id="l7.235" class="difflineplus">+  return wrapper;</span>
<a href="#l7.236"></a><span id="l7.236" class="difflineplus">+}</span>
<a href="#l7.237"></a><span id="l7.237" class="difflineplus">+</span>
<a href="#l7.238"></a><span id="l7.238" class="difflineplus">+/**</span>
<a href="#l7.239"></a><span id="l7.239" class="difflineplus">+ * Wraps an item that has been cloned from a template and adds</span>
<a href="#l7.240"></a><span id="l7.240" class="difflineplus">+ * it to the end of the palette.</span>
<a href="#l7.241"></a><span id="l7.241" class="difflineplus">+ */</span>
<a href="#l7.242"></a><span id="l7.242" class="difflineplus">+function wrapPaletteItem(aPaletteItem) {</span>
<a href="#l7.243"></a><span id="l7.243" class="difflineplus">+  var wrapper = createWrapper(aPaletteItem.id, document);</span>
<a href="#l7.244"></a><span id="l7.244" class="difflineplus">+</span>
<a href="#l7.245"></a><span id="l7.245" class="difflineplus">+  wrapper.appendChild(aPaletteItem);</span>
<a href="#l7.246"></a><span id="l7.246" class="difflineplus">+</span>
<a href="#l7.247"></a><span id="l7.247" class="difflineplus">+  // XXX We need to call this AFTER the palette item has been appended</span>
<a href="#l7.248"></a><span id="l7.248" class="difflineplus">+  // to the wrapper or else we crash dropping certain buttons on the</span>
<a href="#l7.249"></a><span id="l7.249" class="difflineplus">+  // palette due to removal of the command and disabled attributes - JRH</span>
<a href="#l7.250"></a><span id="l7.250" class="difflineplus">+  cleanUpItemForPalette(aPaletteItem, wrapper);</span>
<a href="#l7.251"></a><span id="l7.251" class="difflineplus">+</span>
<a href="#l7.252"></a><span id="l7.252" class="difflineplus">+  gPaletteBox.appendChild(wrapper);</span>
<a href="#l7.253"></a><span id="l7.253" class="difflineplus">+}</span>
<a href="#l7.254"></a><span id="l7.254" class="difflineplus">+</span>
<a href="#l7.255"></a><span id="l7.255" class="difflineplus">+/**</span>
<a href="#l7.256"></a><span id="l7.256" class="difflineplus">+ * Wraps an item that is currently on a toolbar and replaces the item</span>
<a href="#l7.257"></a><span id="l7.257" class="difflineplus">+ * with the wrapper. This is not used when dropping items from the palette,</span>
<a href="#l7.258"></a><span id="l7.258" class="difflineplus">+ * only when first starting the dialog and wrapping everything on the toolbars.</span>
<a href="#l7.259"></a><span id="l7.259" class="difflineplus">+ */</span>
<a href="#l7.260"></a><span id="l7.260" class="difflineplus">+function wrapToolbarItem(aToolbarItem) {</span>
<a href="#l7.261"></a><span id="l7.261" class="difflineplus">+  var wrapper = createWrapper(aToolbarItem.id, gToolboxDocument);</span>
<a href="#l7.262"></a><span id="l7.262" class="difflineplus">+</span>
<a href="#l7.263"></a><span id="l7.263" class="difflineplus">+  wrapper.flex = aToolbarItem.flex;</span>
<a href="#l7.264"></a><span id="l7.264" class="difflineplus">+</span>
<a href="#l7.265"></a><span id="l7.265" class="difflineplus">+  aToolbarItem.parentNode.replaceChild(wrapper, aToolbarItem);</span>
<a href="#l7.266"></a><span id="l7.266" class="difflineplus">+</span>
<a href="#l7.267"></a><span id="l7.267" class="difflineplus">+  wrapper.appendChild(aToolbarItem);</span>
<a href="#l7.268"></a><span id="l7.268" class="difflineplus">+</span>
<a href="#l7.269"></a><span id="l7.269" class="difflineplus">+  return wrapper;</span>
<a href="#l7.270"></a><span id="l7.270" class="difflineplus">+}</span>
<a href="#l7.271"></a><span id="l7.271" class="difflineplus">+</span>
<a href="#l7.272"></a><span id="l7.272" class="difflineplus">+/**</span>
<a href="#l7.273"></a><span id="l7.273" class="difflineplus">+ * Get the list of ids for the current set of items on each toolbar.</span>
<a href="#l7.274"></a><span id="l7.274" class="difflineplus">+ */</span>
<a href="#l7.275"></a><span id="l7.275" class="difflineplus">+function getCurrentItemIds() {</span>
<a href="#l7.276"></a><span id="l7.276" class="difflineplus">+  var currentItems = {};</span>
<a href="#l7.277"></a><span id="l7.277" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.278"></a><span id="l7.278" class="difflineplus">+    var child = toolbar.firstChild;</span>
<a href="#l7.279"></a><span id="l7.279" class="difflineplus">+    while (child) {</span>
<a href="#l7.280"></a><span id="l7.280" class="difflineplus">+      if (isToolbarItem(child))</span>
<a href="#l7.281"></a><span id="l7.281" class="difflineplus">+        currentItems[child.id] = 1;</span>
<a href="#l7.282"></a><span id="l7.282" class="difflineplus">+      child = child.nextSibling;</span>
<a href="#l7.283"></a><span id="l7.283" class="difflineplus">+    }</span>
<a href="#l7.284"></a><span id="l7.284" class="difflineplus">+  });</span>
<a href="#l7.285"></a><span id="l7.285" class="difflineplus">+  return currentItems;</span>
<a href="#l7.286"></a><span id="l7.286" class="difflineplus">+}</span>
<a href="#l7.287"></a><span id="l7.287" class="difflineplus">+</span>
<a href="#l7.288"></a><span id="l7.288" class="difflineplus">+/**</span>
<a href="#l7.289"></a><span id="l7.289" class="difflineplus">+ * Builds the palette of draggable items that are not yet in a toolbar.</span>
<a href="#l7.290"></a><span id="l7.290" class="difflineplus">+ */</span>
<a href="#l7.291"></a><span id="l7.291" class="difflineplus">+function buildPalette() {</span>
<a href="#l7.292"></a><span id="l7.292" class="difflineplus">+  // Empty the palette first.</span>
<a href="#l7.293"></a><span id="l7.293" class="difflineplus">+  while (gPaletteBox.lastChild)</span>
<a href="#l7.294"></a><span id="l7.294" class="difflineplus">+    gPaletteBox.removeChild(gPaletteBox.lastChild);</span>
<a href="#l7.295"></a><span id="l7.295" class="difflineplus">+</span>
<a href="#l7.296"></a><span id="l7.296" class="difflineplus">+  // Add the toolbar separator item.</span>
<a href="#l7.297"></a><span id="l7.297" class="difflineplus">+  var templateNode = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l7.298"></a><span id="l7.298" class="difflineplus">+                                              &quot;toolbarseparator&quot;);</span>
<a href="#l7.299"></a><span id="l7.299" class="difflineplus">+  templateNode.id = &quot;separator&quot;;</span>
<a href="#l7.300"></a><span id="l7.300" class="difflineplus">+  wrapPaletteItem(templateNode);</span>
<a href="#l7.301"></a><span id="l7.301" class="difflineplus">+</span>
<a href="#l7.302"></a><span id="l7.302" class="difflineplus">+  // Add the toolbar spring item.</span>
<a href="#l7.303"></a><span id="l7.303" class="difflineplus">+  templateNode = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l7.304"></a><span id="l7.304" class="difflineplus">+                                              &quot;toolbarspring&quot;);</span>
<a href="#l7.305"></a><span id="l7.305" class="difflineplus">+  templateNode.id = &quot;spring&quot;;</span>
<a href="#l7.306"></a><span id="l7.306" class="difflineplus">+  templateNode.flex = 1;</span>
<a href="#l7.307"></a><span id="l7.307" class="difflineplus">+  wrapPaletteItem(templateNode);</span>
<a href="#l7.308"></a><span id="l7.308" class="difflineplus">+</span>
<a href="#l7.309"></a><span id="l7.309" class="difflineplus">+  // Add the toolbar spacer item.</span>
<a href="#l7.310"></a><span id="l7.310" class="difflineplus">+  templateNode = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l7.311"></a><span id="l7.311" class="difflineplus">+                                              &quot;toolbarspacer&quot;);</span>
<a href="#l7.312"></a><span id="l7.312" class="difflineplus">+  templateNode.id = &quot;spacer&quot;;</span>
<a href="#l7.313"></a><span id="l7.313" class="difflineplus">+  templateNode.flex = 1;</span>
<a href="#l7.314"></a><span id="l7.314" class="difflineplus">+  wrapPaletteItem(templateNode);</span>
<a href="#l7.315"></a><span id="l7.315" class="difflineplus">+</span>
<a href="#l7.316"></a><span id="l7.316" class="difflineplus">+  var currentItems = getCurrentItemIds();</span>
<a href="#l7.317"></a><span id="l7.317" class="difflineplus">+  templateNode = gToolbox.palette.firstChild;</span>
<a href="#l7.318"></a><span id="l7.318" class="difflineplus">+  while (templateNode) {</span>
<a href="#l7.319"></a><span id="l7.319" class="difflineplus">+    // Check if the item is already in a toolbar before adding it to the palette.</span>
<a href="#l7.320"></a><span id="l7.320" class="difflineplus">+    if (!(templateNode.id in currentItems)) {</span>
<a href="#l7.321"></a><span id="l7.321" class="difflineplus">+      var paletteItem = document.importNode(templateNode, true);</span>
<a href="#l7.322"></a><span id="l7.322" class="difflineplus">+      wrapPaletteItem(paletteItem);</span>
<a href="#l7.323"></a><span id="l7.323" class="difflineplus">+    }</span>
<a href="#l7.324"></a><span id="l7.324" class="difflineplus">+</span>
<a href="#l7.325"></a><span id="l7.325" class="difflineplus">+    templateNode = templateNode.nextSibling;</span>
<a href="#l7.326"></a><span id="l7.326" class="difflineplus">+  }</span>
<a href="#l7.327"></a><span id="l7.327" class="difflineplus">+}</span>
<a href="#l7.328"></a><span id="l7.328" class="difflineplus">+</span>
<a href="#l7.329"></a><span id="l7.329" class="difflineplus">+/**</span>
<a href="#l7.330"></a><span id="l7.330" class="difflineplus">+ * Makes sure that an item that has been cloned from a template</span>
<a href="#l7.331"></a><span id="l7.331" class="difflineplus">+ * is stripped of any attributes that may adversely affect its</span>
<a href="#l7.332"></a><span id="l7.332" class="difflineplus">+ * appearance in the palette.</span>
<a href="#l7.333"></a><span id="l7.333" class="difflineplus">+ */</span>
<a href="#l7.334"></a><span id="l7.334" class="difflineplus">+function cleanUpItemForPalette(aItem, aWrapper) {</span>
<a href="#l7.335"></a><span id="l7.335" class="difflineplus">+  aWrapper.setAttribute(&quot;place&quot;, &quot;palette&quot;);</span>
<a href="#l7.336"></a><span id="l7.336" class="difflineplus">+  setWrapperType(aItem, aWrapper);</span>
<a href="#l7.337"></a><span id="l7.337" class="difflineplus">+</span>
<a href="#l7.338"></a><span id="l7.338" class="difflineplus">+  if (aItem.hasAttribute(&quot;title&quot;))</span>
<a href="#l7.339"></a><span id="l7.339" class="difflineplus">+    aWrapper.setAttribute(&quot;title&quot;, aItem.getAttribute(&quot;title&quot;));</span>
<a href="#l7.340"></a><span id="l7.340" class="difflineplus">+  else if (aItem.hasAttribute(&quot;label&quot;))</span>
<a href="#l7.341"></a><span id="l7.341" class="difflineplus">+    aWrapper.setAttribute(&quot;title&quot;, aItem.getAttribute(&quot;label&quot;));</span>
<a href="#l7.342"></a><span id="l7.342" class="difflineplus">+  else if (isSpecialItem(aItem)) {</span>
<a href="#l7.343"></a><span id="l7.343" class="difflineplus">+    var stringBundle = document.getElementById(&quot;stringBundle&quot;);</span>
<a href="#l7.344"></a><span id="l7.344" class="difflineplus">+    // Remove the common &quot;toolbar&quot; prefix to generate the string name.</span>
<a href="#l7.345"></a><span id="l7.345" class="difflineplus">+    var title = stringBundle.getString(aItem.localName.slice(7) + &quot;Title&quot;);</span>
<a href="#l7.346"></a><span id="l7.346" class="difflineplus">+    aWrapper.setAttribute(&quot;title&quot;, title);</span>
<a href="#l7.347"></a><span id="l7.347" class="difflineplus">+  }</span>
<a href="#l7.348"></a><span id="l7.348" class="difflineplus">+  aWrapper.setAttribute(&quot;tooltiptext&quot;, aWrapper.getAttribute(&quot;title&quot;));</span>
<a href="#l7.349"></a><span id="l7.349" class="difflineplus">+</span>
<a href="#l7.350"></a><span id="l7.350" class="difflineplus">+  // Remove attributes that screw up our appearance.</span>
<a href="#l7.351"></a><span id="l7.351" class="difflineplus">+  aItem.removeAttribute(&quot;command&quot;);</span>
<a href="#l7.352"></a><span id="l7.352" class="difflineplus">+  aItem.removeAttribute(&quot;observes&quot;);</span>
<a href="#l7.353"></a><span id="l7.353" class="difflineplus">+  aItem.removeAttribute(&quot;type&quot;);</span>
<a href="#l7.354"></a><span id="l7.354" class="difflineplus">+  aItem.removeAttribute(&quot;width&quot;);</span>
<a href="#l7.355"></a><span id="l7.355" class="difflineplus">+</span>
<a href="#l7.356"></a><span id="l7.356" class="difflineplus">+  Array.forEach(aWrapper.querySelectorAll(&quot;[disabled]&quot;), function(aNode) {</span>
<a href="#l7.357"></a><span id="l7.357" class="difflineplus">+    aNode.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.358"></a><span id="l7.358" class="difflineplus">+  });</span>
<a href="#l7.359"></a><span id="l7.359" class="difflineplus">+}</span>
<a href="#l7.360"></a><span id="l7.360" class="difflineplus">+</span>
<a href="#l7.361"></a><span id="l7.361" class="difflineplus">+/**</span>
<a href="#l7.362"></a><span id="l7.362" class="difflineplus">+ * Makes sure that an item that has been cloned from a template</span>
<a href="#l7.363"></a><span id="l7.363" class="difflineplus">+ * is stripped of all properties that may adversely affect its</span>
<a href="#l7.364"></a><span id="l7.364" class="difflineplus">+ * appearance in the toolbar.  Store critical properties on the</span>
<a href="#l7.365"></a><span id="l7.365" class="difflineplus">+ * wrapper so they can be put back on the item when we're done.</span>
<a href="#l7.366"></a><span id="l7.366" class="difflineplus">+ */</span>
<a href="#l7.367"></a><span id="l7.367" class="difflineplus">+function cleanupItemForToolbar(aItem, aWrapper) {</span>
<a href="#l7.368"></a><span id="l7.368" class="difflineplus">+  setWrapperType(aItem, aWrapper);</span>
<a href="#l7.369"></a><span id="l7.369" class="difflineplus">+  aWrapper.setAttribute(&quot;place&quot;, &quot;toolbar&quot;);</span>
<a href="#l7.370"></a><span id="l7.370" class="difflineplus">+</span>
<a href="#l7.371"></a><span id="l7.371" class="difflineplus">+  if (aItem.hasAttribute(&quot;command&quot;)) {</span>
<a href="#l7.372"></a><span id="l7.372" class="difflineplus">+    aWrapper.setAttribute(&quot;itemcommand&quot;, aItem.getAttribute(&quot;command&quot;));</span>
<a href="#l7.373"></a><span id="l7.373" class="difflineplus">+    aItem.removeAttribute(&quot;command&quot;);</span>
<a href="#l7.374"></a><span id="l7.374" class="difflineplus">+  }</span>
<a href="#l7.375"></a><span id="l7.375" class="difflineplus">+</span>
<a href="#l7.376"></a><span id="l7.376" class="difflineplus">+  if (aItem.checked) {</span>
<a href="#l7.377"></a><span id="l7.377" class="difflineplus">+    aWrapper.setAttribute(&quot;itemchecked&quot;, &quot;true&quot;);</span>
<a href="#l7.378"></a><span id="l7.378" class="difflineplus">+    aItem.checked = false;</span>
<a href="#l7.379"></a><span id="l7.379" class="difflineplus">+  }</span>
<a href="#l7.380"></a><span id="l7.380" class="difflineplus">+</span>
<a href="#l7.381"></a><span id="l7.381" class="difflineplus">+  if (aItem.disabled) {</span>
<a href="#l7.382"></a><span id="l7.382" class="difflineplus">+    aWrapper.setAttribute(&quot;itemdisabled&quot;, &quot;true&quot;);</span>
<a href="#l7.383"></a><span id="l7.383" class="difflineplus">+    aItem.disabled = false;</span>
<a href="#l7.384"></a><span id="l7.384" class="difflineplus">+  }</span>
<a href="#l7.385"></a><span id="l7.385" class="difflineplus">+}</span>
<a href="#l7.386"></a><span id="l7.386" class="difflineplus">+</span>
<a href="#l7.387"></a><span id="l7.387" class="difflineplus">+/**</span>
<a href="#l7.388"></a><span id="l7.388" class="difflineplus">+ * Restore all the properties that we stripped off above.</span>
<a href="#l7.389"></a><span id="l7.389" class="difflineplus">+ */</span>
<a href="#l7.390"></a><span id="l7.390" class="difflineplus">+function restoreItemForToolbar(aItem, aWrapper) {</span>
<a href="#l7.391"></a><span id="l7.391" class="difflineplus">+  if (aWrapper.hasAttribute(&quot;itemdisabled&quot;))</span>
<a href="#l7.392"></a><span id="l7.392" class="difflineplus">+    aItem.disabled = true;</span>
<a href="#l7.393"></a><span id="l7.393" class="difflineplus">+</span>
<a href="#l7.394"></a><span id="l7.394" class="difflineplus">+  if (aWrapper.hasAttribute(&quot;itemchecked&quot;))</span>
<a href="#l7.395"></a><span id="l7.395" class="difflineplus">+    aItem.checked = true;</span>
<a href="#l7.396"></a><span id="l7.396" class="difflineplus">+</span>
<a href="#l7.397"></a><span id="l7.397" class="difflineplus">+  if (aWrapper.hasAttribute(&quot;itemcommand&quot;)) {</span>
<a href="#l7.398"></a><span id="l7.398" class="difflineplus">+    let commandID = aWrapper.getAttribute(&quot;itemcommand&quot;);</span>
<a href="#l7.399"></a><span id="l7.399" class="difflineplus">+    aItem.setAttribute(&quot;command&quot;, commandID);</span>
<a href="#l7.400"></a><span id="l7.400" class="difflineplus">+</span>
<a href="#l7.401"></a><span id="l7.401" class="difflineplus">+    // XXX Bug 309953 - toolbarbuttons aren't in sync with their commands after customizing</span>
<a href="#l7.402"></a><span id="l7.402" class="difflineplus">+    let command = gToolboxDocument.getElementById(commandID);</span>
<a href="#l7.403"></a><span id="l7.403" class="difflineplus">+    if (command &amp;&amp; command.hasAttribute(&quot;disabled&quot;))</span>
<a href="#l7.404"></a><span id="l7.404" class="difflineplus">+      aItem.setAttribute(&quot;disabled&quot;, command.getAttribute(&quot;disabled&quot;));</span>
<a href="#l7.405"></a><span id="l7.405" class="difflineplus">+  }</span>
<a href="#l7.406"></a><span id="l7.406" class="difflineplus">+}</span>
<a href="#l7.407"></a><span id="l7.407" class="difflineplus">+</span>
<a href="#l7.408"></a><span id="l7.408" class="difflineplus">+function setWrapperType(aItem, aWrapper) {</span>
<a href="#l7.409"></a><span id="l7.409" class="difflineplus">+  if (aItem.localName == &quot;toolbarseparator&quot;) {</span>
<a href="#l7.410"></a><span id="l7.410" class="difflineplus">+    aWrapper.setAttribute(&quot;type&quot;, &quot;separator&quot;);</span>
<a href="#l7.411"></a><span id="l7.411" class="difflineplus">+  } else if (aItem.localName == &quot;toolbarspring&quot;) {</span>
<a href="#l7.412"></a><span id="l7.412" class="difflineplus">+    aWrapper.setAttribute(&quot;type&quot;, &quot;spring&quot;);</span>
<a href="#l7.413"></a><span id="l7.413" class="difflineplus">+  } else if (aItem.localName == &quot;toolbarspacer&quot;) {</span>
<a href="#l7.414"></a><span id="l7.414" class="difflineplus">+    aWrapper.setAttribute(&quot;type&quot;, &quot;spacer&quot;);</span>
<a href="#l7.415"></a><span id="l7.415" class="difflineplus">+  } else if (aItem.localName == &quot;toolbaritem&quot; &amp;&amp; aItem.firstChild) {</span>
<a href="#l7.416"></a><span id="l7.416" class="difflineplus">+    aWrapper.setAttribute(&quot;type&quot;, aItem.firstChild.localName);</span>
<a href="#l7.417"></a><span id="l7.417" class="difflineplus">+  }</span>
<a href="#l7.418"></a><span id="l7.418" class="difflineplus">+}</span>
<a href="#l7.419"></a><span id="l7.419" class="difflineplus">+</span>
<a href="#l7.420"></a><span id="l7.420" class="difflineplus">+function setDragActive(aItem, aValue) {</span>
<a href="#l7.421"></a><span id="l7.421" class="difflineplus">+  var node = aItem;</span>
<a href="#l7.422"></a><span id="l7.422" class="difflineplus">+  var direction = window.getComputedStyle(aItem).direction;</span>
<a href="#l7.423"></a><span id="l7.423" class="difflineplus">+  var value = direction == &quot;ltr&quot; ? &quot;left&quot; : &quot;right&quot;;</span>
<a href="#l7.424"></a><span id="l7.424" class="difflineplus">+  if (aItem.localName == &quot;toolbar&quot;) {</span>
<a href="#l7.425"></a><span id="l7.425" class="difflineplus">+    node = aItem.lastChild;</span>
<a href="#l7.426"></a><span id="l7.426" class="difflineplus">+    value = direction == &quot;ltr&quot; ? &quot;right&quot; : &quot;left&quot;;</span>
<a href="#l7.427"></a><span id="l7.427" class="difflineplus">+  }</span>
<a href="#l7.428"></a><span id="l7.428" class="difflineplus">+</span>
<a href="#l7.429"></a><span id="l7.429" class="difflineplus">+  if (!node)</span>
<a href="#l7.430"></a><span id="l7.430" class="difflineplus">+    return;</span>
<a href="#l7.431"></a><span id="l7.431" class="difflineplus">+</span>
<a href="#l7.432"></a><span id="l7.432" class="difflineplus">+  if (aValue) {</span>
<a href="#l7.433"></a><span id="l7.433" class="difflineplus">+    if (!node.hasAttribute(&quot;dragover&quot;))</span>
<a href="#l7.434"></a><span id="l7.434" class="difflineplus">+      node.setAttribute(&quot;dragover&quot;, value);</span>
<a href="#l7.435"></a><span id="l7.435" class="difflineplus">+  } else {</span>
<a href="#l7.436"></a><span id="l7.436" class="difflineplus">+    node.removeAttribute(&quot;dragover&quot;);</span>
<a href="#l7.437"></a><span id="l7.437" class="difflineplus">+  }</span>
<a href="#l7.438"></a><span id="l7.438" class="difflineplus">+}</span>
<a href="#l7.439"></a><span id="l7.439" class="difflineplus">+</span>
<a href="#l7.440"></a><span id="l7.440" class="difflineplus">+function addNewToolbar() {</span>
<a href="#l7.441"></a><span id="l7.441" class="difflineplus">+  var promptService = Services.prompt;</span>
<a href="#l7.442"></a><span id="l7.442" class="difflineplus">+  var stringBundle = document.getElementById(&quot;stringBundle&quot;);</span>
<a href="#l7.443"></a><span id="l7.443" class="difflineplus">+  var message = stringBundle.getString(&quot;enterToolbarName&quot;);</span>
<a href="#l7.444"></a><span id="l7.444" class="difflineplus">+  var title = stringBundle.getString(&quot;enterToolbarTitle&quot;);</span>
<a href="#l7.445"></a><span id="l7.445" class="difflineplus">+</span>
<a href="#l7.446"></a><span id="l7.446" class="difflineplus">+  var name = {};</span>
<a href="#l7.447"></a><span id="l7.447" class="difflineplus">+</span>
<a href="#l7.448"></a><span id="l7.448" class="difflineplus">+  // Quitting from the toolbar dialog while the new toolbar prompt is up</span>
<a href="#l7.449"></a><span id="l7.449" class="difflineplus">+  // can cause things to become unresponsive on the Mac. Until dialog modality</span>
<a href="#l7.450"></a><span id="l7.450" class="difflineplus">+  // is fixed (395465), disable the &quot;Done&quot; button explicitly.</span>
<a href="#l7.451"></a><span id="l7.451" class="difflineplus">+  var doneButton = document.getElementById(&quot;donebutton&quot;);</span>
<a href="#l7.452"></a><span id="l7.452" class="difflineplus">+  doneButton.disabled = true;</span>
<a href="#l7.453"></a><span id="l7.453" class="difflineplus">+</span>
<a href="#l7.454"></a><span id="l7.454" class="difflineplus">+  while (true) {</span>
<a href="#l7.455"></a><span id="l7.455" class="difflineplus">+</span>
<a href="#l7.456"></a><span id="l7.456" class="difflineplus">+    if (!promptService.prompt(window, title, message, name, null, {})) {</span>
<a href="#l7.457"></a><span id="l7.457" class="difflineplus">+      doneButton.disabled = false;</span>
<a href="#l7.458"></a><span id="l7.458" class="difflineplus">+      return;</span>
<a href="#l7.459"></a><span id="l7.459" class="difflineplus">+    }</span>
<a href="#l7.460"></a><span id="l7.460" class="difflineplus">+</span>
<a href="#l7.461"></a><span id="l7.461" class="difflineplus">+    if (!name.value) {</span>
<a href="#l7.462"></a><span id="l7.462" class="difflineplus">+      message = stringBundle.getFormattedString(&quot;enterToolbarBlank&quot;, [name.value]);</span>
<a href="#l7.463"></a><span id="l7.463" class="difflineplus">+      continue;</span>
<a href="#l7.464"></a><span id="l7.464" class="difflineplus">+    }</span>
<a href="#l7.465"></a><span id="l7.465" class="difflineplus">+</span>
<a href="#l7.466"></a><span id="l7.466" class="difflineplus">+    var dupeFound = false;</span>
<a href="#l7.467"></a><span id="l7.467" class="difflineplus">+</span>
<a href="#l7.468"></a><span id="l7.468" class="difflineplus">+     // Check for an existing toolbar with the same display name</span>
<a href="#l7.469"></a><span id="l7.469" class="difflineplus">+    for (let i = 0; i &lt; gToolbox.childNodes.length; ++i) {</span>
<a href="#l7.470"></a><span id="l7.470" class="difflineplus">+      var toolbar = gToolbox.childNodes[i];</span>
<a href="#l7.471"></a><span id="l7.471" class="difflineplus">+      var toolbarName = toolbar.getAttribute(&quot;toolbarname&quot;);</span>
<a href="#l7.472"></a><span id="l7.472" class="difflineplus">+</span>
<a href="#l7.473"></a><span id="l7.473" class="difflineplus">+      if (toolbarName == name.value &amp;&amp;</span>
<a href="#l7.474"></a><span id="l7.474" class="difflineplus">+          toolbar.getAttribute(&quot;type&quot;) != &quot;menubar&quot; &amp;&amp;</span>
<a href="#l7.475"></a><span id="l7.475" class="difflineplus">+          toolbar.nodeName == &quot;toolbar&quot;) {</span>
<a href="#l7.476"></a><span id="l7.476" class="difflineplus">+        dupeFound = true;</span>
<a href="#l7.477"></a><span id="l7.477" class="difflineplus">+        break;</span>
<a href="#l7.478"></a><span id="l7.478" class="difflineplus">+      }</span>
<a href="#l7.479"></a><span id="l7.479" class="difflineplus">+    }</span>
<a href="#l7.480"></a><span id="l7.480" class="difflineplus">+</span>
<a href="#l7.481"></a><span id="l7.481" class="difflineplus">+    if (!dupeFound)</span>
<a href="#l7.482"></a><span id="l7.482" class="difflineplus">+      break;</span>
<a href="#l7.483"></a><span id="l7.483" class="difflineplus">+</span>
<a href="#l7.484"></a><span id="l7.484" class="difflineplus">+    message = stringBundle.getFormattedString(&quot;enterToolbarDup&quot;, [name.value]);</span>
<a href="#l7.485"></a><span id="l7.485" class="difflineplus">+  }</span>
<a href="#l7.486"></a><span id="l7.486" class="difflineplus">+</span>
<a href="#l7.487"></a><span id="l7.487" class="difflineplus">+  gToolbox.appendCustomToolbar(name.value, &quot;&quot;);</span>
<a href="#l7.488"></a><span id="l7.488" class="difflineplus">+</span>
<a href="#l7.489"></a><span id="l7.489" class="difflineplus">+  toolboxChanged();</span>
<a href="#l7.490"></a><span id="l7.490" class="difflineplus">+</span>
<a href="#l7.491"></a><span id="l7.491" class="difflineplus">+  doneButton.disabled = false;</span>
<a href="#l7.492"></a><span id="l7.492" class="difflineplus">+}</span>
<a href="#l7.493"></a><span id="l7.493" class="difflineplus">+</span>
<a href="#l7.494"></a><span id="l7.494" class="difflineplus">+/**</span>
<a href="#l7.495"></a><span id="l7.495" class="difflineplus">+ * Restore the default set of buttons to fixed toolbars,</span>
<a href="#l7.496"></a><span id="l7.496" class="difflineplus">+ * remove all custom toolbars, and rebuild the palette.</span>
<a href="#l7.497"></a><span id="l7.497" class="difflineplus">+ */</span>
<a href="#l7.498"></a><span id="l7.498" class="difflineplus">+function restoreDefaultSet() {</span>
<a href="#l7.499"></a><span id="l7.499" class="difflineplus">+  // Unwrap the items on the toolbar.</span>
<a href="#l7.500"></a><span id="l7.500" class="difflineplus">+  unwrapToolbarItems();</span>
<a href="#l7.501"></a><span id="l7.501" class="difflineplus">+</span>
<a href="#l7.502"></a><span id="l7.502" class="difflineplus">+  // Remove all of the customized toolbars.</span>
<a href="#l7.503"></a><span id="l7.503" class="difflineplus">+  var child = gToolbox.lastChild;</span>
<a href="#l7.504"></a><span id="l7.504" class="difflineplus">+  while (child) {</span>
<a href="#l7.505"></a><span id="l7.505" class="difflineplus">+    if (child.hasAttribute(&quot;customindex&quot;)) {</span>
<a href="#l7.506"></a><span id="l7.506" class="difflineplus">+      var thisChild = child;</span>
<a href="#l7.507"></a><span id="l7.507" class="difflineplus">+      child = child.previousSibling;</span>
<a href="#l7.508"></a><span id="l7.508" class="difflineplus">+      thisChild.currentSet = &quot;__empty&quot;;</span>
<a href="#l7.509"></a><span id="l7.509" class="difflineplus">+      gToolbox.removeChild(thisChild);</span>
<a href="#l7.510"></a><span id="l7.510" class="difflineplus">+    } else {</span>
<a href="#l7.511"></a><span id="l7.511" class="difflineplus">+      child = child.previousSibling;</span>
<a href="#l7.512"></a><span id="l7.512" class="difflineplus">+    }</span>
<a href="#l7.513"></a><span id="l7.513" class="difflineplus">+  }</span>
<a href="#l7.514"></a><span id="l7.514" class="difflineplus">+</span>
<a href="#l7.515"></a><span id="l7.515" class="difflineplus">+  // Restore the defaultset for fixed toolbars.</span>
<a href="#l7.516"></a><span id="l7.516" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.517"></a><span id="l7.517" class="difflineplus">+    var defaultSet = toolbar.getAttribute(&quot;defaultset&quot;);</span>
<a href="#l7.518"></a><span id="l7.518" class="difflineplus">+    if (defaultSet)</span>
<a href="#l7.519"></a><span id="l7.519" class="difflineplus">+      toolbar.currentSet = defaultSet;</span>
<a href="#l7.520"></a><span id="l7.520" class="difflineplus">+  });</span>
<a href="#l7.521"></a><span id="l7.521" class="difflineplus">+</span>
<a href="#l7.522"></a><span id="l7.522" class="difflineplus">+  // Restore the default icon size and mode.</span>
<a href="#l7.523"></a><span id="l7.523" class="difflineplus">+  document.getElementById(&quot;smallicons&quot;).checked = (updateIconSize() == &quot;small&quot;);</span>
<a href="#l7.524"></a><span id="l7.524" class="difflineplus">+  document.getElementById(&quot;modelist&quot;).value = updateToolbarMode();</span>
<a href="#l7.525"></a><span id="l7.525" class="difflineplus">+</span>
<a href="#l7.526"></a><span id="l7.526" class="difflineplus">+  // Now rebuild the palette.</span>
<a href="#l7.527"></a><span id="l7.527" class="difflineplus">+  buildPalette();</span>
<a href="#l7.528"></a><span id="l7.528" class="difflineplus">+</span>
<a href="#l7.529"></a><span id="l7.529" class="difflineplus">+  // Now re-wrap the items on the toolbar.</span>
<a href="#l7.530"></a><span id="l7.530" class="difflineplus">+  wrapToolbarItems();</span>
<a href="#l7.531"></a><span id="l7.531" class="difflineplus">+</span>
<a href="#l7.532"></a><span id="l7.532" class="difflineplus">+  toolboxChanged(&quot;reset&quot;);</span>
<a href="#l7.533"></a><span id="l7.533" class="difflineplus">+}</span>
<a href="#l7.534"></a><span id="l7.534" class="difflineplus">+</span>
<a href="#l7.535"></a><span id="l7.535" class="difflineplus">+function updateIconSize(aSize) {</span>
<a href="#l7.536"></a><span id="l7.536" class="difflineplus">+  return updateToolboxProperty(&quot;iconsize&quot;, aSize, &quot;large&quot;);</span>
<a href="#l7.537"></a><span id="l7.537" class="difflineplus">+}</span>
<a href="#l7.538"></a><span id="l7.538" class="difflineplus">+</span>
<a href="#l7.539"></a><span id="l7.539" class="difflineplus">+function updateToolbarMode(aModeValue) {</span>
<a href="#l7.540"></a><span id="l7.540" class="difflineplus">+  var mode = updateToolboxProperty(&quot;mode&quot;, aModeValue, &quot;icons&quot;);</span>
<a href="#l7.541"></a><span id="l7.541" class="difflineplus">+</span>
<a href="#l7.542"></a><span id="l7.542" class="difflineplus">+  var iconSizeCheckbox = document.getElementById(&quot;smallicons&quot;);</span>
<a href="#l7.543"></a><span id="l7.543" class="difflineplus">+  iconSizeCheckbox.disabled = mode == &quot;text&quot;;</span>
<a href="#l7.544"></a><span id="l7.544" class="difflineplus">+</span>
<a href="#l7.545"></a><span id="l7.545" class="difflineplus">+  return mode;</span>
<a href="#l7.546"></a><span id="l7.546" class="difflineplus">+}</span>
<a href="#l7.547"></a><span id="l7.547" class="difflineplus">+</span>
<a href="#l7.548"></a><span id="l7.548" class="difflineplus">+function updateToolboxProperty(aProp, aValue, aToolkitDefault) {</span>
<a href="#l7.549"></a><span id="l7.549" class="difflineplus">+  var toolboxDefault = gToolbox.getAttribute(&quot;default&quot; + aProp) ||</span>
<a href="#l7.550"></a><span id="l7.550" class="difflineplus">+                       aToolkitDefault;</span>
<a href="#l7.551"></a><span id="l7.551" class="difflineplus">+</span>
<a href="#l7.552"></a><span id="l7.552" class="difflineplus">+  gToolbox.setAttribute(aProp, aValue || toolboxDefault);</span>
<a href="#l7.553"></a><span id="l7.553" class="difflineplus">+  gToolboxDocument.persist(gToolbox.id, aProp);</span>
<a href="#l7.554"></a><span id="l7.554" class="difflineplus">+</span>
<a href="#l7.555"></a><span id="l7.555" class="difflineplus">+  forEachCustomizableToolbar(function(toolbar) {</span>
<a href="#l7.556"></a><span id="l7.556" class="difflineplus">+    var toolbarDefault = toolbar.getAttribute(&quot;default&quot; + aProp) ||</span>
<a href="#l7.557"></a><span id="l7.557" class="difflineplus">+                         toolboxDefault;</span>
<a href="#l7.558"></a><span id="l7.558" class="difflineplus">+    if (toolbar.getAttribute(&quot;lock&quot; + aProp) == &quot;true&quot; &amp;&amp;</span>
<a href="#l7.559"></a><span id="l7.559" class="difflineplus">+        toolbar.getAttribute(aProp) == toolbarDefault)</span>
<a href="#l7.560"></a><span id="l7.560" class="difflineplus">+      return;</span>
<a href="#l7.561"></a><span id="l7.561" class="difflineplus">+</span>
<a href="#l7.562"></a><span id="l7.562" class="difflineplus">+    toolbar.setAttribute(aProp, aValue || toolbarDefault);</span>
<a href="#l7.563"></a><span id="l7.563" class="difflineplus">+    gToolboxDocument.persist(toolbar.id, aProp);</span>
<a href="#l7.564"></a><span id="l7.564" class="difflineplus">+  });</span>
<a href="#l7.565"></a><span id="l7.565" class="difflineplus">+</span>
<a href="#l7.566"></a><span id="l7.566" class="difflineplus">+  toolboxChanged(aProp);</span>
<a href="#l7.567"></a><span id="l7.567" class="difflineplus">+</span>
<a href="#l7.568"></a><span id="l7.568" class="difflineplus">+  return aValue || toolboxDefault;</span>
<a href="#l7.569"></a><span id="l7.569" class="difflineplus">+}</span>
<a href="#l7.570"></a><span id="l7.570" class="difflineplus">+</span>
<a href="#l7.571"></a><span id="l7.571" class="difflineplus">+function forEachCustomizableToolbar(callback) {</span>
<a href="#l7.572"></a><span id="l7.572" class="difflineplus">+  Array.filter(gToolbox.childNodes, isCustomizableToolbar).forEach(callback);</span>
<a href="#l7.573"></a><span id="l7.573" class="difflineplus">+  Array.filter(gToolbox.externalToolbars, isCustomizableToolbar).forEach(callback);</span>
<a href="#l7.574"></a><span id="l7.574" class="difflineplus">+}</span>
<a href="#l7.575"></a><span id="l7.575" class="difflineplus">+</span>
<a href="#l7.576"></a><span id="l7.576" class="difflineplus">+function isCustomizableToolbar(aElt) {</span>
<a href="#l7.577"></a><span id="l7.577" class="difflineplus">+  return aElt.localName == &quot;toolbar&quot; &amp;&amp;</span>
<a href="#l7.578"></a><span id="l7.578" class="difflineplus">+         aElt.getAttribute(&quot;customizable&quot;) == &quot;true&quot;;</span>
<a href="#l7.579"></a><span id="l7.579" class="difflineplus">+}</span>
<a href="#l7.580"></a><span id="l7.580" class="difflineplus">+</span>
<a href="#l7.581"></a><span id="l7.581" class="difflineplus">+function isSpecialItem(aElt) {</span>
<a href="#l7.582"></a><span id="l7.582" class="difflineplus">+  return aElt.localName == &quot;toolbarseparator&quot; ||</span>
<a href="#l7.583"></a><span id="l7.583" class="difflineplus">+         aElt.localName == &quot;toolbarspring&quot; ||</span>
<a href="#l7.584"></a><span id="l7.584" class="difflineplus">+         aElt.localName == &quot;toolbarspacer&quot;;</span>
<a href="#l7.585"></a><span id="l7.585" class="difflineplus">+}</span>
<a href="#l7.586"></a><span id="l7.586" class="difflineplus">+</span>
<a href="#l7.587"></a><span id="l7.587" class="difflineplus">+function isToolbarItem(aElt) {</span>
<a href="#l7.588"></a><span id="l7.588" class="difflineplus">+  return aElt.localName == &quot;toolbarbutton&quot; ||</span>
<a href="#l7.589"></a><span id="l7.589" class="difflineplus">+         aElt.localName == &quot;toolbaritem&quot; ||</span>
<a href="#l7.590"></a><span id="l7.590" class="difflineplus">+         aElt.localName == &quot;toolbarseparator&quot; ||</span>
<a href="#l7.591"></a><span id="l7.591" class="difflineplus">+         aElt.localName == &quot;toolbarspring&quot; ||</span>
<a href="#l7.592"></a><span id="l7.592" class="difflineplus">+         aElt.localName == &quot;toolbarspacer&quot;;</span>
<a href="#l7.593"></a><span id="l7.593" class="difflineplus">+}</span>
<a href="#l7.594"></a><span id="l7.594" class="difflineplus">+</span>
<a href="#l7.595"></a><span id="l7.595" class="difflineplus">+// Drag and Drop observers</span>
<a href="#l7.596"></a><span id="l7.596" class="difflineplus">+</span>
<a href="#l7.597"></a><span id="l7.597" class="difflineplus">+function onToolbarDragExit(aEvent) {</span>
<a href="#l7.598"></a><span id="l7.598" class="difflineplus">+  if (isUnwantedDragEvent(aEvent)) {</span>
<a href="#l7.599"></a><span id="l7.599" class="difflineplus">+    return;</span>
<a href="#l7.600"></a><span id="l7.600" class="difflineplus">+  }</span>
<a href="#l7.601"></a><span id="l7.601" class="difflineplus">+</span>
<a href="#l7.602"></a><span id="l7.602" class="difflineplus">+  if (gCurrentDragOverItem)</span>
<a href="#l7.603"></a><span id="l7.603" class="difflineplus">+    setDragActive(gCurrentDragOverItem, false);</span>
<a href="#l7.604"></a><span id="l7.604" class="difflineplus">+}</span>
<a href="#l7.605"></a><span id="l7.605" class="difflineplus">+</span>
<a href="#l7.606"></a><span id="l7.606" class="difflineplus">+function onToolbarDragStart(aEvent) {</span>
<a href="#l7.607"></a><span id="l7.607" class="difflineplus">+  var item = aEvent.target;</span>
<a href="#l7.608"></a><span id="l7.608" class="difflineplus">+  while (item &amp;&amp; item.localName != &quot;toolbarpaletteitem&quot;) {</span>
<a href="#l7.609"></a><span id="l7.609" class="difflineplus">+    if (item.localName == &quot;toolbar&quot;)</span>
<a href="#l7.610"></a><span id="l7.610" class="difflineplus">+      return;</span>
<a href="#l7.611"></a><span id="l7.611" class="difflineplus">+    item = item.parentNode;</span>
<a href="#l7.612"></a><span id="l7.612" class="difflineplus">+  }</span>
<a href="#l7.613"></a><span id="l7.613" class="difflineplus">+</span>
<a href="#l7.614"></a><span id="l7.614" class="difflineplus">+  item.setAttribute(&quot;dragactive&quot;, &quot;true&quot;);</span>
<a href="#l7.615"></a><span id="l7.615" class="difflineplus">+</span>
<a href="#l7.616"></a><span id="l7.616" class="difflineplus">+  var dt = aEvent.dataTransfer;</span>
<a href="#l7.617"></a><span id="l7.617" class="difflineplus">+  var documentId = gToolboxDocument.documentElement.id;</span>
<a href="#l7.618"></a><span id="l7.618" class="difflineplus">+  dt.setData(&quot;text/toolbarwrapper-id/&quot; + documentId, item.firstChild.id);</span>
<a href="#l7.619"></a><span id="l7.619" class="difflineplus">+  dt.effectAllowed = &quot;move&quot;;</span>
<a href="#l7.620"></a><span id="l7.620" class="difflineplus">+}</span>
<a href="#l7.621"></a><span id="l7.621" class="difflineplus">+</span>
<a href="#l7.622"></a><span id="l7.622" class="difflineplus">+function onToolbarDragOver(aEvent) {</span>
<a href="#l7.623"></a><span id="l7.623" class="difflineplus">+  if (isUnwantedDragEvent(aEvent)) {</span>
<a href="#l7.624"></a><span id="l7.624" class="difflineplus">+    return;</span>
<a href="#l7.625"></a><span id="l7.625" class="difflineplus">+  }</span>
<a href="#l7.626"></a><span id="l7.626" class="difflineplus">+</span>
<a href="#l7.627"></a><span id="l7.627" class="difflineplus">+  var documentId = gToolboxDocument.documentElement.id;</span>
<a href="#l7.628"></a><span id="l7.628" class="difflineplus">+  if (!aEvent.dataTransfer.types.includes(&quot;text/toolbarwrapper-id/&quot; + documentId.toLowerCase()))</span>
<a href="#l7.629"></a><span id="l7.629" class="difflineplus">+    return;</span>
<a href="#l7.630"></a><span id="l7.630" class="difflineplus">+</span>
<a href="#l7.631"></a><span id="l7.631" class="difflineplus">+  var toolbar = aEvent.target;</span>
<a href="#l7.632"></a><span id="l7.632" class="difflineplus">+  var dropTarget = aEvent.target;</span>
<a href="#l7.633"></a><span id="l7.633" class="difflineplus">+  while (toolbar &amp;&amp; toolbar.localName != &quot;toolbar&quot;) {</span>
<a href="#l7.634"></a><span id="l7.634" class="difflineplus">+    dropTarget = toolbar;</span>
<a href="#l7.635"></a><span id="l7.635" class="difflineplus">+    toolbar = toolbar.parentNode;</span>
<a href="#l7.636"></a><span id="l7.636" class="difflineplus">+  }</span>
<a href="#l7.637"></a><span id="l7.637" class="difflineplus">+</span>
<a href="#l7.638"></a><span id="l7.638" class="difflineplus">+  // Make sure we are dragging over a customizable toolbar.</span>
<a href="#l7.639"></a><span id="l7.639" class="difflineplus">+  if (!toolbar || !isCustomizableToolbar(toolbar)) {</span>
<a href="#l7.640"></a><span id="l7.640" class="difflineplus">+    gCurrentDragOverItem = null;</span>
<a href="#l7.641"></a><span id="l7.641" class="difflineplus">+    return;</span>
<a href="#l7.642"></a><span id="l7.642" class="difflineplus">+  }</span>
<a href="#l7.643"></a><span id="l7.643" class="difflineplus">+</span>
<a href="#l7.644"></a><span id="l7.644" class="difflineplus">+  var previousDragItem = gCurrentDragOverItem;</span>
<a href="#l7.645"></a><span id="l7.645" class="difflineplus">+</span>
<a href="#l7.646"></a><span id="l7.646" class="difflineplus">+  if (dropTarget.localName == &quot;toolbar&quot;) {</span>
<a href="#l7.647"></a><span id="l7.647" class="difflineplus">+    gCurrentDragOverItem = dropTarget;</span>
<a href="#l7.648"></a><span id="l7.648" class="difflineplus">+  } else {</span>
<a href="#l7.649"></a><span id="l7.649" class="difflineplus">+    gCurrentDragOverItem = null;</span>
<a href="#l7.650"></a><span id="l7.650" class="difflineplus">+</span>
<a href="#l7.651"></a><span id="l7.651" class="difflineplus">+    var direction = window.getComputedStyle(dropTarget.parentNode).direction;</span>
<a href="#l7.652"></a><span id="l7.652" class="difflineplus">+    var dropTargetCenter = dropTarget.boxObject.x + (dropTarget.boxObject.width / 2);</span>
<a href="#l7.653"></a><span id="l7.653" class="difflineplus">+    var dragAfter;</span>
<a href="#l7.654"></a><span id="l7.654" class="difflineplus">+    if (direction == &quot;ltr&quot;)</span>
<a href="#l7.655"></a><span id="l7.655" class="difflineplus">+      dragAfter = aEvent.clientX &gt; dropTargetCenter;</span>
<a href="#l7.656"></a><span id="l7.656" class="difflineplus">+    else</span>
<a href="#l7.657"></a><span id="l7.657" class="difflineplus">+      dragAfter = aEvent.clientX &lt; dropTargetCenter;</span>
<a href="#l7.658"></a><span id="l7.658" class="difflineplus">+</span>
<a href="#l7.659"></a><span id="l7.659" class="difflineplus">+    if (dragAfter) {</span>
<a href="#l7.660"></a><span id="l7.660" class="difflineplus">+      gCurrentDragOverItem = dropTarget.nextSibling;</span>
<a href="#l7.661"></a><span id="l7.661" class="difflineplus">+      if (!gCurrentDragOverItem)</span>
<a href="#l7.662"></a><span id="l7.662" class="difflineplus">+        gCurrentDragOverItem = toolbar;</span>
<a href="#l7.663"></a><span id="l7.663" class="difflineplus">+    } else</span>
<a href="#l7.664"></a><span id="l7.664" class="difflineplus">+      gCurrentDragOverItem = dropTarget;</span>
<a href="#l7.665"></a><span id="l7.665" class="difflineplus">+  }</span>
<a href="#l7.666"></a><span id="l7.666" class="difflineplus">+</span>
<a href="#l7.667"></a><span id="l7.667" class="difflineplus">+  if (previousDragItem &amp;&amp; gCurrentDragOverItem != previousDragItem) {</span>
<a href="#l7.668"></a><span id="l7.668" class="difflineplus">+    setDragActive(previousDragItem, false);</span>
<a href="#l7.669"></a><span id="l7.669" class="difflineplus">+  }</span>
<a href="#l7.670"></a><span id="l7.670" class="difflineplus">+</span>
<a href="#l7.671"></a><span id="l7.671" class="difflineplus">+  setDragActive(gCurrentDragOverItem, true);</span>
<a href="#l7.672"></a><span id="l7.672" class="difflineplus">+</span>
<a href="#l7.673"></a><span id="l7.673" class="difflineplus">+  aEvent.preventDefault();</span>
<a href="#l7.674"></a><span id="l7.674" class="difflineplus">+  aEvent.stopPropagation();</span>
<a href="#l7.675"></a><span id="l7.675" class="difflineplus">+}</span>
<a href="#l7.676"></a><span id="l7.676" class="difflineplus">+</span>
<a href="#l7.677"></a><span id="l7.677" class="difflineplus">+function onToolbarDrop(aEvent) {</span>
<a href="#l7.678"></a><span id="l7.678" class="difflineplus">+  if (isUnwantedDragEvent(aEvent)) {</span>
<a href="#l7.679"></a><span id="l7.679" class="difflineplus">+    return;</span>
<a href="#l7.680"></a><span id="l7.680" class="difflineplus">+  }</span>
<a href="#l7.681"></a><span id="l7.681" class="difflineplus">+</span>
<a href="#l7.682"></a><span id="l7.682" class="difflineplus">+  if (!gCurrentDragOverItem)</span>
<a href="#l7.683"></a><span id="l7.683" class="difflineplus">+    return;</span>
<a href="#l7.684"></a><span id="l7.684" class="difflineplus">+</span>
<a href="#l7.685"></a><span id="l7.685" class="difflineplus">+  setDragActive(gCurrentDragOverItem, false);</span>
<a href="#l7.686"></a><span id="l7.686" class="difflineplus">+</span>
<a href="#l7.687"></a><span id="l7.687" class="difflineplus">+  var documentId = gToolboxDocument.documentElement.id;</span>
<a href="#l7.688"></a><span id="l7.688" class="difflineplus">+  var draggedItemId = aEvent.dataTransfer.getData(&quot;text/toolbarwrapper-id/&quot; + documentId);</span>
<a href="#l7.689"></a><span id="l7.689" class="difflineplus">+  if (gCurrentDragOverItem.id == draggedItemId)</span>
<a href="#l7.690"></a><span id="l7.690" class="difflineplus">+    return;</span>
<a href="#l7.691"></a><span id="l7.691" class="difflineplus">+</span>
<a href="#l7.692"></a><span id="l7.692" class="difflineplus">+  var toolbar = aEvent.target;</span>
<a href="#l7.693"></a><span id="l7.693" class="difflineplus">+  while (toolbar.localName != &quot;toolbar&quot;)</span>
<a href="#l7.694"></a><span id="l7.694" class="difflineplus">+    toolbar = toolbar.parentNode;</span>
<a href="#l7.695"></a><span id="l7.695" class="difflineplus">+</span>
<a href="#l7.696"></a><span id="l7.696" class="difflineplus">+  var draggedPaletteWrapper = document.getElementById(&quot;wrapper-&quot; + draggedItemId);</span>
<a href="#l7.697"></a><span id="l7.697" class="difflineplus">+  if (!draggedPaletteWrapper) {</span>
<a href="#l7.698"></a><span id="l7.698" class="difflineplus">+    // The wrapper has been dragged from the toolbar.</span>
<a href="#l7.699"></a><span id="l7.699" class="difflineplus">+    // Get the wrapper from the toolbar document and make sure that</span>
<a href="#l7.700"></a><span id="l7.700" class="difflineplus">+    // it isn't being dropped on itself.</span>
<a href="#l7.701"></a><span id="l7.701" class="difflineplus">+    let wrapper = gToolboxDocument.getElementById(&quot;wrapper-&quot; + draggedItemId);</span>
<a href="#l7.702"></a><span id="l7.702" class="difflineplus">+    if (wrapper == gCurrentDragOverItem)</span>
<a href="#l7.703"></a><span id="l7.703" class="difflineplus">+       return;</span>
<a href="#l7.704"></a><span id="l7.704" class="difflineplus">+</span>
<a href="#l7.705"></a><span id="l7.705" class="difflineplus">+    // Don't allow non-removable kids (e.g., the menubar) to move.</span>
<a href="#l7.706"></a><span id="l7.706" class="difflineplus">+    if (wrapper.firstChild.getAttribute(&quot;removable&quot;) != &quot;true&quot;)</span>
<a href="#l7.707"></a><span id="l7.707" class="difflineplus">+      return;</span>
<a href="#l7.708"></a><span id="l7.708" class="difflineplus">+</span>
<a href="#l7.709"></a><span id="l7.709" class="difflineplus">+    // Remove the item from its place in the toolbar.</span>
<a href="#l7.710"></a><span id="l7.710" class="difflineplus">+    wrapper.remove();</span>
<a href="#l7.711"></a><span id="l7.711" class="difflineplus">+</span>
<a href="#l7.712"></a><span id="l7.712" class="difflineplus">+    // Determine which toolbar we are dropping on.</span>
<a href="#l7.713"></a><span id="l7.713" class="difflineplus">+    var dropToolbar = null;</span>
<a href="#l7.714"></a><span id="l7.714" class="difflineplus">+    if (gCurrentDragOverItem.localName == &quot;toolbar&quot;)</span>
<a href="#l7.715"></a><span id="l7.715" class="difflineplus">+      dropToolbar = gCurrentDragOverItem;</span>
<a href="#l7.716"></a><span id="l7.716" class="difflineplus">+    else</span>
<a href="#l7.717"></a><span id="l7.717" class="difflineplus">+      dropToolbar = gCurrentDragOverItem.parentNode;</span>
<a href="#l7.718"></a><span id="l7.718" class="difflineplus">+</span>
<a href="#l7.719"></a><span id="l7.719" class="difflineplus">+    // Insert the item into the toolbar.</span>
<a href="#l7.720"></a><span id="l7.720" class="difflineplus">+    if (gCurrentDragOverItem != dropToolbar)</span>
<a href="#l7.721"></a><span id="l7.721" class="difflineplus">+      dropToolbar.insertBefore(wrapper, gCurrentDragOverItem);</span>
<a href="#l7.722"></a><span id="l7.722" class="difflineplus">+    else</span>
<a href="#l7.723"></a><span id="l7.723" class="difflineplus">+      dropToolbar.appendChild(wrapper);</span>
<a href="#l7.724"></a><span id="l7.724" class="difflineplus">+  } else {</span>
<a href="#l7.725"></a><span id="l7.725" class="difflineplus">+    // The item has been dragged from the palette</span>
<a href="#l7.726"></a><span id="l7.726" class="difflineplus">+</span>
<a href="#l7.727"></a><span id="l7.727" class="difflineplus">+    // Create a new wrapper for the item. We don't know the id yet.</span>
<a href="#l7.728"></a><span id="l7.728" class="difflineplus">+    let wrapper = createWrapper(&quot;&quot;, gToolboxDocument);</span>
<a href="#l7.729"></a><span id="l7.729" class="difflineplus">+</span>
<a href="#l7.730"></a><span id="l7.730" class="difflineplus">+    // Ask the toolbar to clone the item's template, place it inside the wrapper, and insert it in the toolbar.</span>
<a href="#l7.731"></a><span id="l7.731" class="difflineplus">+    var newItem = toolbar.insertItem(draggedItemId, gCurrentDragOverItem == toolbar ? null : gCurrentDragOverItem, wrapper);</span>
<a href="#l7.732"></a><span id="l7.732" class="difflineplus">+</span>
<a href="#l7.733"></a><span id="l7.733" class="difflineplus">+    // Prepare the item and wrapper to look good on the toolbar.</span>
<a href="#l7.734"></a><span id="l7.734" class="difflineplus">+    cleanupItemForToolbar(newItem, wrapper);</span>
<a href="#l7.735"></a><span id="l7.735" class="difflineplus">+    wrapper.id = &quot;wrapper-&quot; + newItem.id;</span>
<a href="#l7.736"></a><span id="l7.736" class="difflineplus">+    wrapper.flex = newItem.flex;</span>
<a href="#l7.737"></a><span id="l7.737" class="difflineplus">+</span>
<a href="#l7.738"></a><span id="l7.738" class="difflineplus">+    // Remove the wrapper from the palette.</span>
<a href="#l7.739"></a><span id="l7.739" class="difflineplus">+    if (draggedItemId != &quot;separator&quot; &amp;&amp;</span>
<a href="#l7.740"></a><span id="l7.740" class="difflineplus">+        draggedItemId != &quot;spring&quot; &amp;&amp;</span>
<a href="#l7.741"></a><span id="l7.741" class="difflineplus">+        draggedItemId != &quot;spacer&quot;)</span>
<a href="#l7.742"></a><span id="l7.742" class="difflineplus">+      gPaletteBox.removeChild(draggedPaletteWrapper);</span>
<a href="#l7.743"></a><span id="l7.743" class="difflineplus">+  }</span>
<a href="#l7.744"></a><span id="l7.744" class="difflineplus">+</span>
<a href="#l7.745"></a><span id="l7.745" class="difflineplus">+  gCurrentDragOverItem = null;</span>
<a href="#l7.746"></a><span id="l7.746" class="difflineplus">+</span>
<a href="#l7.747"></a><span id="l7.747" class="difflineplus">+  toolboxChanged();</span>
<a href="#l7.748"></a><span id="l7.748" class="difflineplus">+}</span>
<a href="#l7.749"></a><span id="l7.749" class="difflineplus">+</span>
<a href="#l7.750"></a><span id="l7.750" class="difflineplus">+function onPaletteDragOver(aEvent) {</span>
<a href="#l7.751"></a><span id="l7.751" class="difflineplus">+  if (isUnwantedDragEvent(aEvent)) {</span>
<a href="#l7.752"></a><span id="l7.752" class="difflineplus">+    return;</span>
<a href="#l7.753"></a><span id="l7.753" class="difflineplus">+  }</span>
<a href="#l7.754"></a><span id="l7.754" class="difflineplus">+  var documentId = gToolboxDocument.documentElement.id;</span>
<a href="#l7.755"></a><span id="l7.755" class="difflineplus">+  if (aEvent.dataTransfer.types.includes(&quot;text/toolbarwrapper-id/&quot; + documentId.toLowerCase()))</span>
<a href="#l7.756"></a><span id="l7.756" class="difflineplus">+    aEvent.preventDefault();</span>
<a href="#l7.757"></a><span id="l7.757" class="difflineplus">+}</span>
<a href="#l7.758"></a><span id="l7.758" class="difflineplus">+</span>
<a href="#l7.759"></a><span id="l7.759" class="difflineplus">+function onPaletteDrop(aEvent) {</span>
<a href="#l7.760"></a><span id="l7.760" class="difflineplus">+  if (isUnwantedDragEvent(aEvent)) {</span>
<a href="#l7.761"></a><span id="l7.761" class="difflineplus">+    return;</span>
<a href="#l7.762"></a><span id="l7.762" class="difflineplus">+  }</span>
<a href="#l7.763"></a><span id="l7.763" class="difflineplus">+  var documentId = gToolboxDocument.documentElement.id;</span>
<a href="#l7.764"></a><span id="l7.764" class="difflineplus">+  var itemId = aEvent.dataTransfer.getData(&quot;text/toolbarwrapper-id/&quot; + documentId);</span>
<a href="#l7.765"></a><span id="l7.765" class="difflineplus">+</span>
<a href="#l7.766"></a><span id="l7.766" class="difflineplus">+  var wrapper = gToolboxDocument.getElementById(&quot;wrapper-&quot; + itemId);</span>
<a href="#l7.767"></a><span id="l7.767" class="difflineplus">+  if (wrapper) {</span>
<a href="#l7.768"></a><span id="l7.768" class="difflineplus">+    // Don't allow non-removable kids (e.g., the menubar) to move.</span>
<a href="#l7.769"></a><span id="l7.769" class="difflineplus">+    if (wrapper.firstChild.getAttribute(&quot;removable&quot;) != &quot;true&quot;)</span>
<a href="#l7.770"></a><span id="l7.770" class="difflineplus">+      return;</span>
<a href="#l7.771"></a><span id="l7.771" class="difflineplus">+</span>
<a href="#l7.772"></a><span id="l7.772" class="difflineplus">+    var wrapperType = wrapper.getAttribute(&quot;type&quot;);</span>
<a href="#l7.773"></a><span id="l7.773" class="difflineplus">+    if (wrapperType != &quot;separator&quot; &amp;&amp;</span>
<a href="#l7.774"></a><span id="l7.774" class="difflineplus">+        wrapperType != &quot;spacer&quot; &amp;&amp;</span>
<a href="#l7.775"></a><span id="l7.775" class="difflineplus">+        wrapperType != &quot;spring&quot;) {</span>
<a href="#l7.776"></a><span id="l7.776" class="difflineplus">+      restoreItemForToolbar(wrapper.firstChild, wrapper);</span>
<a href="#l7.777"></a><span id="l7.777" class="difflineplus">+      wrapPaletteItem(document.importNode(wrapper.firstChild, true));</span>
<a href="#l7.778"></a><span id="l7.778" class="difflineplus">+      gToolbox.palette.appendChild(wrapper.firstChild);</span>
<a href="#l7.779"></a><span id="l7.779" class="difflineplus">+    }</span>
<a href="#l7.780"></a><span id="l7.780" class="difflineplus">+</span>
<a href="#l7.781"></a><span id="l7.781" class="difflineplus">+    // The item was dragged out of the toolbar.</span>
<a href="#l7.782"></a><span id="l7.782" class="difflineplus">+    wrapper.remove();</span>
<a href="#l7.783"></a><span id="l7.783" class="difflineplus">+  }</span>
<a href="#l7.784"></a><span id="l7.784" class="difflineplus">+</span>
<a href="#l7.785"></a><span id="l7.785" class="difflineplus">+  toolboxChanged();</span>
<a href="#l7.786"></a><span id="l7.786" class="difflineplus">+}</span>
<a href="#l7.787"></a><span id="l7.787" class="difflineplus">+</span>
<a href="#l7.788"></a><span id="l7.788" class="difflineplus">+</span>
<a href="#l7.789"></a><span id="l7.789" class="difflineplus">+function isUnwantedDragEvent(aEvent) {</span>
<a href="#l7.790"></a><span id="l7.790" class="difflineplus">+  try {</span>
<a href="#l7.791"></a><span id="l7.791" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;toolkit.customization.unsafe_drag_events&quot;)) {</span>
<a href="#l7.792"></a><span id="l7.792" class="difflineplus">+      return false;</span>
<a href="#l7.793"></a><span id="l7.793" class="difflineplus">+    }</span>
<a href="#l7.794"></a><span id="l7.794" class="difflineplus">+  } catch (ex) {}</span>
<a href="#l7.795"></a><span id="l7.795" class="difflineplus">+</span>
<a href="#l7.796"></a><span id="l7.796" class="difflineplus">+  /* Discard drag events that originated from a separate window to</span>
<a href="#l7.797"></a><span id="l7.797" class="difflineplus">+     prevent content-&gt;chrome privilege escalations. */</span>
<a href="#l7.798"></a><span id="l7.798" class="difflineplus">+  let mozSourceNode = aEvent.dataTransfer.mozSourceNode;</span>
<a href="#l7.799"></a><span id="l7.799" class="difflineplus">+  // mozSourceNode is null in the dragStart event handler or if</span>
<a href="#l7.800"></a><span id="l7.800" class="difflineplus">+  // the drag event originated in an external application.</span>
<a href="#l7.801"></a><span id="l7.801" class="difflineplus">+  if (!mozSourceNode) {</span>
<a href="#l7.802"></a><span id="l7.802" class="difflineplus">+    return true;</span>
<a href="#l7.803"></a><span id="l7.803" class="difflineplus">+  }</span>
<a href="#l7.804"></a><span id="l7.804" class="difflineplus">+  let sourceWindow = mozSourceNode.ownerGlobal;</span>
<a href="#l7.805"></a><span id="l7.805" class="difflineplus">+  return sourceWindow != window &amp;&amp; sourceWindow != gToolboxDocument.defaultView;</span>
<a href="#l7.806"></a><span id="l7.806" class="difflineplus">+}</span>
<a href="#l7.807"></a><span id="l7.807" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/common/src/customizeToolbar.xul</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,67 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+&lt;!DOCTYPE dialog [</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+&lt;!ENTITY % customizeToolbarDTD SYSTEM &quot;chrome://global/locale/customizeToolbar.dtd&quot;&gt;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  %customizeToolbarDTD;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+]&gt;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/customizeToolbar.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/customizeToolbar.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+&lt;window id=&quot;CustomizeToolbarWindow&quot;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+        title=&quot;&amp;dialog.title;&quot;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+        onload=&quot;onLoad();&quot;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+        onunload=&quot;onUnload();&quot;</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+        style=&quot;&amp;dialog.dimensions;&quot;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+        persist=&quot;width height&quot;</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+&lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/customizeToolbar.js&quot;/&gt;</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+&lt;stringbundle id=&quot;stringBundle&quot; src=&quot;chrome://messenger/locale/customizeToolbar.properties&quot;/&gt;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+&lt;keyset id=&quot;CustomizeToolbarKeyset&quot;&gt;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+  &lt;key id=&quot;cmd_close1&quot; keycode=&quot;VK_ESCAPE&quot; oncommand=&quot;onClose();&quot;/&gt;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  &lt;key id=&quot;cmd_close2&quot; keycode=&quot;VK_RETURN&quot; oncommand=&quot;onClose();&quot;/&gt;</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+&lt;/keyset&gt;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+&lt;vbox id=&quot;main-box&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  &lt;description id=&quot;instructions&quot;&gt;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  &amp;instructions.description;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  &lt;/description&gt;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+  &lt;vbox flex=&quot;1&quot; id=&quot;palette-box&quot;</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+        ondragstart=&quot;onToolbarDragStart(event)&quot;</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+        ondragover=&quot;onPaletteDragOver(event)&quot;</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+        ondrop=&quot;onPaletteDrop(event)&quot;/&gt;</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+  &lt;box align=&quot;center&quot;&gt;</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+    &lt;label value=&quot;&amp;show.label;&quot;/&gt;</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+    &lt;menulist id=&quot;modelist&quot; value=&quot;icons&quot; oncommand=&quot;updateToolbarMode(this.value);&quot;&gt;</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+      &lt;menupopup id=&quot;modelistpopup&quot;&gt;</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+        &lt;menuitem id=&quot;modefull&quot; value=&quot;full&quot; label=&quot;&amp;iconsAndText.label;&quot;/&gt;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+        &lt;menuitem id=&quot;modeicons&quot; value=&quot;icons&quot; label=&quot;&amp;icons.label;&quot;/&gt;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+        &lt;menuitem id=&quot;modetext&quot; value=&quot;text&quot; label=&quot;&amp;text.label;&quot;/&gt;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+      &lt;/menupopup&gt;</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+    &lt;/menulist&gt;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    &lt;checkbox id=&quot;smallicons&quot; oncommand=&quot;updateIconSize(this.checked ? 'small' : 'large');&quot; label=&quot;&amp;useSmallIcons.label;&quot;/&gt;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+    &lt;button id=&quot;newtoolbar&quot; label=&quot;&amp;addNewToolbar.label;&quot; oncommand=&quot;addNewToolbar();&quot; icon=&quot;add&quot;/&gt;</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+    &lt;button id=&quot;restoreDefault&quot; label=&quot;&amp;restoreDefaultSet.label;&quot; oncommand=&quot;restoreDefaultSet();&quot; icon=&quot;revert&quot;/&gt;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+  &lt;/box&gt;</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+  &lt;separator class=&quot;groove&quot;/&gt;</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+  &lt;hbox align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    &lt;button id=&quot;donebutton&quot; label=&quot;&amp;saveChanges.label;&quot; oncommand=&quot;onClose();&quot;</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+            default=&quot;true&quot; icon=&quot;close&quot;/&gt;</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+&lt;/vbox&gt;</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mail/base/content/bindings.css</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+toolbox {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/toolbar.xml#toolbox&quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+}</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+toolbar:not([type=&quot;menubar&quot;]) {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/toolbar.xml#toolbar&quot;);</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -140,17 +140,17 @@ function CustomizeMailToolbar(toolboxId,</span>
<a href="#l10.4"></a><span id="l10.4">   for (var i = 0; i &lt; menubar.childNodes.length; ++i)</span>
<a href="#l10.5"></a><span id="l10.5">     menubar.childNodes[i].setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">   var customizePopup = document.getElementById(customizePopupId);</span>
<a href="#l10.8"></a><span id="l10.8">   customizePopup.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">   var toolbox = document.getElementById(toolboxId);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  var customizeURL = &quot;chrome://global/content/customizeToolbar.xul&quot;;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  var customizeURL = &quot;chrome://messenger/content/customizeToolbar.xul&quot;;</span>
<a href="#l10.14"></a><span id="l10.14">   gCustomizeSheet = Services.prefs.getBoolPref(&quot;toolbar.customization.usesheet&quot;);</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16">   if (gCustomizeSheet) {</span>
<a href="#l10.17"></a><span id="l10.17">     var sheetFrame = document.getElementById(&quot;customizeToolbarSheetIFrame&quot;);</span>
<a href="#l10.18"></a><span id="l10.18">     var panel = document.getElementById(&quot;customizeToolbarSheetPopup&quot;);</span>
<a href="#l10.19"></a><span id="l10.19">     sheetFrame.hidden = false;</span>
<a href="#l10.20"></a><span id="l10.20">     sheetFrame.toolbox = toolbox;</span>
<a href="#l10.21"></a><span id="l10.21">     sheetFrame.panel = panel;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> #filter substitution</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/mailWindow1.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.11"></a><span id="l11.11"> &lt;?xml-stylesheet href=&quot;chrome://gloda/content/glodacomplete.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/bindings.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.13"></a><span id="l11.13"> &lt;?xml-stylesheet href=&quot;chrome://messenger/content/tabmail.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.14"></a><span id="l11.14"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/tabmail.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> &lt;?xul-overlay href=&quot;chrome://communicator/content/utilityOverlay.xul&quot;?&gt;</span>
<a href="#l11.17"></a><span id="l11.17"> &lt;?xul-overlay href=&quot;chrome://messenger/content/msgHdrViewOverlay.xul&quot;?&gt;</span>
<a href="#l11.18"></a><span id="l11.18"> &lt;?xul-overlay href=&quot;chrome://messenger/content/mailWindowOverlay.xul&quot;?&gt;</span>
<a href="#l11.19"></a><span id="l11.19"> &lt;?xul-overlay href=&quot;chrome://messenger/content/extraCustomizeItems.xul&quot;?&gt;</span>
<a href="#l11.20"></a><span id="l11.20"> &lt;?xul-overlay href=&quot;chrome://messenger/content/mailOverlay.xul&quot;?&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -5,23 +5,23 @@ messenger.jar:</span>
<a href="#l12.4"></a><span id="l12.4"> % content messenger %content/messenger/</span>
<a href="#l12.5"></a><span id="l12.5"> % override chrome://global/content/nsDragAndDrop.js chrome://messenger/content/nsDragAndDrop.js</span>
<a href="#l12.6"></a><span id="l12.6"> % override chrome://messagebody/skin/messageBody.css chrome://messenger/skin/messageBody.css</span>
<a href="#l12.7"></a><span id="l12.7"> % overlay chrome://global/content/viewSource.xul chrome://messenger/content/viewSourceOverlay.xul</span>
<a href="#l12.8"></a><span id="l12.8"> % overlay chrome://global/content/config.xul chrome://messenger/content/configEditorOverlay.xul</span>
<a href="#l12.9"></a><span id="l12.9"> % overlay chrome://editor/content/EdSpellCheck.xul chrome://messenger/content/EdSpellCheckOverlay.xul</span>
<a href="#l12.10"></a><span id="l12.10"> % overlay about:addons chrome://messenger/content/extensionsOverlay.xul</span>
<a href="#l12.11"></a><span id="l12.11"> % style about:addons chrome://messenger/content/extensionsOverlay.css</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/content/messenger.css</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/addressbook/addressbook.css</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/messengercompose/messengercompose.css</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/smime/msgCompSMIMEOverlay.css</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/messageHeader.css</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/primaryToolbar.css</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/content/messenger.css</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/addressbook/addressbook.css</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/messengercompose/messengercompose.css</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/smime/msgCompSMIMEOverlay.css</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/messageHeader.css</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/primaryToolbar.css</span>
<a href="#l12.26"></a><span id="l12.26">     content/messenger/mailWindow.js                 (content/mailWindow.js)</span>
<a href="#l12.27"></a><span id="l12.27">     content/messenger/messageDisplay.js             (content/messageDisplay.js)</span>
<a href="#l12.28"></a><span id="l12.28">     content/messenger/extensionsOverlay.css         (content/extensionsOverlay.css)</span>
<a href="#l12.29"></a><span id="l12.29">     content/messenger/extensionsOverlay.xul         (content/extensionsOverlay.xul)</span>
<a href="#l12.30"></a><span id="l12.30">     content/messenger/folderDisplay.js              (content/folderDisplay.js)</span>
<a href="#l12.31"></a><span id="l12.31">     content/messenger/mailWindowOverlay.js          (content/mailWindowOverlay.js)</span>
<a href="#l12.32"></a><span id="l12.32"> *   content/messenger/mailWindowOverlay.xul         (content/mailWindowOverlay.xul)</span>
<a href="#l12.33"></a><span id="l12.33">     content/messenger/extraCustomizeItems.xul       (content/extraCustomizeItems.xul)</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineat">@@ -32,18 +32,23 @@ messenger.jar:</span>
<a href="#l12.35"></a><span id="l12.35">     content/messenger/nsContextMenu.js              (content/nsContextMenu.js)</span>
<a href="#l12.36"></a><span id="l12.36"> *   content/messenger/messenger.xul                 (content/messenger.xul)</span>
<a href="#l12.37"></a><span id="l12.37"> *   content/messenger/hiddenWindow.xul              (content/hiddenWindow.xul)</span>
<a href="#l12.38"></a><span id="l12.38">     content/messenger/hiddenWindow.js               (content/hiddenWindow.js)</span>
<a href="#l12.39"></a><span id="l12.39">     content/messenger/msgHdrViewOverlay.js          (content/msgHdrViewOverlay.js)</span>
<a href="#l12.40"></a><span id="l12.40">     content/messenger/msgHdrViewOverlay.xul         (content/msgHdrViewOverlay.xul)</span>
<a href="#l12.41"></a><span id="l12.41">     content/messenger/msgViewNavigation.js          (content/msgViewNavigation.js)</span>
<a href="#l12.42"></a><span id="l12.42">     content/messenger/mailWidgets.xml               (content/mailWidgets.xml)</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+    content/messenger/customizeToolbar.css          (../../common/src/customizeToolbar.css)</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+    content/messenger/customizeToolbar.js           (../../common/src/customizeToolbar.js)</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+    content/messenger/customizeToolbar.xul          (../../common/src/customizeToolbar.xul)</span>
<a href="#l12.46"></a><span id="l12.46">     content/messenger/datetimepicker.xml            (../../common/bindings/datetimepicker.xml)</span>
<a href="#l12.47"></a><span id="l12.47">     content/messenger/generalBindings.xml           (../../common/bindings/generalBindings.xml)</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+    content/messenger/toolbar.xml                   (../../common/bindings/toolbar.xml)</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+    content/messenger/bindings.css                  (content/bindings.css)</span>
<a href="#l12.50"></a><span id="l12.50">     content/messenger/nsDragAndDrop.js              (content/nsDragAndDrop.js)</span>
<a href="#l12.51"></a><span id="l12.51">     content/messenger/editContactOverlay.js         (content/editContactOverlay.js)</span>
<a href="#l12.52"></a><span id="l12.52"> *   content/messenger/editContactOverlay.xul        (content/editContactOverlay.xul)</span>
<a href="#l12.53"></a><span id="l12.53">     content/messenger/msgMail3PaneWindow.js         (content/msgMail3PaneWindow.js)</span>
<a href="#l12.54"></a><span id="l12.54">     content/messenger/mail3PaneWindowCommands.js    (content/mail3PaneWindowCommands.js)</span>
<a href="#l12.55"></a><span id="l12.55">     content/messenger/mailCommands.js               (content/mailCommands.js)</span>
<a href="#l12.56"></a><span id="l12.56">     content/messenger/mailCore.js                   (content/mailCore.js)</span>
<a href="#l12.57"></a><span id="l12.57">     content/messenger/customizeToolbarOverlay.xul   (content/customizeToolbarOverlay.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.xul</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l13.4"></a><span id="l13.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.7"></a><span id="l13.7"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.8"></a><span id="l13.8"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/bindings.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l13.11"></a><span id="l13.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/searchBox.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l13.12"></a><span id="l13.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/addressbook/addressbook.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l13.13"></a><span id="l13.13"> </span>
<a href="#l13.14"></a><span id="l13.14"> #ifdef XP_MACOSX</span>
<a href="#l13.15"></a><span id="l13.15"> &lt;?xul-overlay href=&quot;chrome://messenger/content/macMenuOverlay.xul&quot;?&gt;</span>
<a href="#l13.16"></a><span id="l13.16"> #endif</span>
<a href="#l13.17"></a><span id="l13.17"> &lt;?xul-overlay href=&quot;chrome://messenger/content/baseMenuOverlay.xul&quot;?&gt;</span>
<a href="#l13.18"></a><span id="l13.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xul</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xul</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l14.4"></a><span id="l14.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l14.5"></a><span id="l14.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/bindings.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.10"></a><span id="l14.10"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messengercompose/messengercompose.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.11"></a><span id="l14.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/folderMenus.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.12"></a><span id="l14.12"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/attachmentList.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.13"></a><span id="l14.13"> &lt;?xul-overlay href=&quot;chrome://editor/content/editorOverlay.xul&quot;?&gt;</span>
<a href="#l14.14"></a><span id="l14.14"> #ifdef XP_MACOSX</span>
<a href="#l14.15"></a><span id="l14.15"> &lt;?xul-overlay href=&quot;chrome://messenger/content/macMenuOverlay.xul&quot;?&gt;</span>
<a href="#l14.16"></a><span id="l14.16"> #endif</span>
<a href="#l14.17"></a><span id="l14.17"> &lt;?xul-overlay href=&quot;chrome://messenger/content/baseMenuOverlay.xul&quot;?&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/im/jar.mn</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/im/jar.mn</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l15.4"></a><span id="l15.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.5"></a><span id="l15.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.6"></a><span id="l15.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> messenger.jar:</span>
<a href="#l15.9"></a><span id="l15.9"> % overlay chrome://messenger/content/messenger.xul chrome://messenger/content/chat/chat-messenger-overlay.xul</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-% style chrome://global/content/customizeToolbar.xul chrome://messenger/skin/chat.css</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+% style chrome://messenger/content/customizeToolbar.xul chrome://messenger/skin/chat.css</span>
<a href="#l15.12"></a><span id="l15.12"> *   content/messenger/chat/chat-messenger-overlay.xul    (content/chat-messenger-overlay.xul)</span>
<a href="#l15.13"></a><span id="l15.13">     content/messenger/chat/chat-messenger-overlay.js     (content/chat-messenger-overlay.js)</span>
<a href="#l15.14"></a><span id="l15.14">     content/messenger/chat/chat.css                      (content/chat.css)</span>
<a href="#l15.15"></a><span id="l15.15">     content/messenger/am-im.js                           (content/am-im.js)</span>
<a href="#l15.16"></a><span id="l15.16">     content/messenger/am-im.xul                          (content/am-im.xul)</span>
<a href="#l15.17"></a><span id="l15.17">     content/messenger/chat/addbuddy.js                   (content/addbuddy.js)</span>
<a href="#l15.18"></a><span id="l15.18">     content/messenger/chat/addbuddy.xul                  (content/addbuddy.xul)</span>
<a href="#l15.19"></a><span id="l15.19">     content/messenger/chat/badgebutton.xml               (content/badgebutton.xml)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/customizeToolbar.dtd</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,16 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+&lt;!ENTITY dialog.title             &quot;Customize Toolbar&quot;&gt;</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+&lt;!ENTITY dialog.dimensions        &quot;width: 92ch; height: 36em;&quot;&gt;</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+&lt;!ENTITY instructions.description &quot;You can add or remove items by dragging to or from the toolbars.&quot;&gt;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+&lt;!ENTITY show.label               &quot;Show:&quot;&gt;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+&lt;!ENTITY iconsAndText.label       &quot;Icons and Text&quot;&gt;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+&lt;!ENTITY icons.label              &quot;Icons&quot;&gt;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+&lt;!ENTITY text.label               &quot;Text&quot;&gt;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+&lt;!ENTITY useSmallIcons.label      &quot;Use Small Icons&quot;&gt;</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+&lt;!ENTITY restoreDefaultSet.label  &quot;Restore Default Set&quot;&gt;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+&lt;!ENTITY addNewToolbar.label      &quot;Add New Toolbar&quot;&gt;</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+&lt;!ENTITY saveChanges.label        &quot;Done&quot;&gt;</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+&lt;!ENTITY undoChanges.label        &quot;Undo Changes&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/customizeToolbar.properties</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+enterToolbarTitle=New Toolbar</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+enterToolbarName=Enter a name for this toolbar:</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+enterToolbarDup=There is already a toolbar with the name “%S”. Please enter a different name.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+enterToolbarBlank=You must enter a name to create a new toolbar.</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+separatorTitle=Separator</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+springTitle=Flexible Space</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+spacerTitle=Space</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -17,16 +17,18 @@</span>
<a href="#l18.4"></a><span id="l18.4">   locale/@AB_CD@/messenger/aboutSupportMail.dtd                         (%chrome/messenger/aboutSupportMail.dtd)</span>
<a href="#l18.5"></a><span id="l18.5">   locale/@AB_CD@/messenger/aboutSupportMail.properties                  (%chrome/messenger/aboutSupportMail.properties)</span>
<a href="#l18.6"></a><span id="l18.6">   locale/@AB_CD@/messenger/telemetry.properties                         (%chrome/messenger/telemetry.properties)</span>
<a href="#l18.7"></a><span id="l18.7">   locale/@AB_CD@/messenger/accountCreation.dtd                          (%chrome/messenger/accountCreation.dtd)</span>
<a href="#l18.8"></a><span id="l18.8">   locale/@AB_CD@/messenger/accountCreation.properties                   (%chrome/messenger/accountCreation.properties)</span>
<a href="#l18.9"></a><span id="l18.9">   locale/@AB_CD@/messenger/accountCreationModel.properties              (%chrome/messenger/accountCreationModel.properties)</span>
<a href="#l18.10"></a><span id="l18.10">   locale/@AB_CD@/messenger/accountCreationUtil.properties               (%chrome/messenger/accountCreationUtil.properties)</span>
<a href="#l18.11"></a><span id="l18.11">   locale/@AB_CD@/messenger/charsetTitles.properties                     (%chrome/messenger/charsetTitles.properties)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  locale/@AB_CD@/messenger/customizeToolbar.dtd                         (%chrome/messenger/customizeToolbar.dtd)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  locale/@AB_CD@/messenger/customizeToolbar.properties                  (%chrome/messenger/customizeToolbar.properties)</span>
<a href="#l18.14"></a><span id="l18.14">   locale/@AB_CD@/messenger/datetimepicker.dtd                           (%chrome/messenger/datetimepicker.dtd)</span>
<a href="#l18.15"></a><span id="l18.15">   locale/@AB_CD@/messenger/systemIntegrationDialog.dtd                  (%chrome/messenger/systemIntegrationDialog.dtd)</span>
<a href="#l18.16"></a><span id="l18.16">   locale/@AB_CD@/messenger/virtualFolderProperties.dtd                  (%chrome/messenger/virtualFolderProperties.dtd)</span>
<a href="#l18.17"></a><span id="l18.17">   locale/@AB_CD@/messenger/virtualFolderListDialog.dtd                  (%chrome/messenger/virtualFolderListDialog.dtd)</span>
<a href="#l18.18"></a><span id="l18.18">   locale/@AB_CD@/messenger/multimessageview.properties                  (%chrome/messenger/multimessageview.properties)</span>
<a href="#l18.19"></a><span id="l18.19">   locale/@AB_CD@/messenger/multimessageview.dtd                         (%chrome/messenger/multimessageview.dtd)</span>
<a href="#l18.20"></a><span id="l18.20">   locale/@AB_CD@/messenger/mailOverlay.dtd                              (%chrome/messenger/mailOverlay.dtd)</span>
<a href="#l18.21"></a><span id="l18.21">   locale/@AB_CD@/messenger/messenger.dtd                                (%chrome/messenger/messenger.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-customization-helpers.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-customization-helpers.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -54,17 +54,17 @@ CustomizeDialogHelper.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4">    */</span>
<a href="#l19.5"></a><span id="l19.5">   open: function CustomizeDialogHelper_open(aController) {</span>
<a href="#l19.6"></a><span id="l19.6">     let ctc;</span>
<a href="#l19.7"></a><span id="l19.7">     aController.click(aController.eid(this._openElementId));</span>
<a href="#l19.8"></a><span id="l19.8">     // Depending on preferences the customization dialog is</span>
<a href="#l19.9"></a><span id="l19.9">     // either a normal window or embedded into a sheet.</span>
<a href="#l19.10"></a><span id="l19.10">     if (!this._openInWindow) {</span>
<a href="#l19.11"></a><span id="l19.11">       ctc = wh.wait_for_frame_load(aController.e(&quot;customizeToolbarSheetIFrame&quot;),</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        &quot;chrome://global/content/customizeToolbar.xul&quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+        &quot;chrome://messenger/content/customizeToolbar.xul&quot;);</span>
<a href="#l19.14"></a><span id="l19.14">     }</span>
<a href="#l19.15"></a><span id="l19.15">     else {</span>
<a href="#l19.16"></a><span id="l19.16">       ctc = wh.wait_for_existing_window(this._windowType);</span>
<a href="#l19.17"></a><span id="l19.17">     }</span>
<a href="#l19.18"></a><span id="l19.18">     return ctc;</span>
<a href="#l19.19"></a><span id="l19.19">   },</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/chrome.manifest</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/chrome.manifest</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -7,9 +7,9 @@ overlay chrome://calendar/content/calend</span>
<a href="#l20.4"></a><span id="l20.4"> overlay chrome://sunbird/content/calendar.xul chrome://mozmill/content/overlay.xul</span>
<a href="#l20.5"></a><span id="l20.5"> overlay chrome://navigator/content/navigatorOverlay.xul chrome://mozmill/content/overlay_tb.xul</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> overlay windowtype:Songbird:Main chrome://mozmill/content/overlay.xul</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> locale	mozmill	en-US	locale/en-US/</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> skin	mozmill	classic/1.0	skin/</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-style	chrome://global/content/customizeToolbar.xul	chrome://mozmill/skin/overlay.css</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+style	chrome://messenger/content/customizeToolbar.xul	chrome://mozmill/skin/overlay.css</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/themes/linux/jar.mn</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/themes/linux/jar.mn</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -16,16 +16,17 @@ classic.jar:</span>
<a href="#l21.4"></a><span id="l21.4"> * skin/classic/messenger/imAccountWizard.css                  (../../components/im/themes/imAccountWizard.css)</span>
<a href="#l21.5"></a><span id="l21.5">   skin/classic/messenger/imMenulist.css                       (../../components/im/themes/imMenulist.css)</span>
<a href="#l21.6"></a><span id="l21.6"> * skin/classic/messenger/imRichlistbox.css                    (../../components/im/themes/imRichlistbox.css)</span>
<a href="#l21.7"></a><span id="l21.7">   skin/classic/messenger/founder.png                          (../../components/im/themes/founder.png)</span>
<a href="#l21.8"></a><span id="l21.8">   skin/classic/messenger/operator.png                         (../../components/im/themes/operator.png)</span>
<a href="#l21.9"></a><span id="l21.9">   skin/classic/messenger/half-operator.png                    (../../components/im/themes/half-operator.png)</span>
<a href="#l21.10"></a><span id="l21.10">   skin/classic/messenger/voice.png                            (../../components/im/themes/voice.png)</span>
<a href="#l21.11"></a><span id="l21.11">   skin/classic/messenger/browserRequest.css                   (mail/browserRequest.css)</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+  skin/classic/messenger/customizeToolbar.css                 (mail/customizeToolbar.css)</span>
<a href="#l21.13"></a><span id="l21.13">   skin/classic/messenger/datetimepicker.css                   (mail/datetimepicker.css)</span>
<a href="#l21.14"></a><span id="l21.14">   skin/classic/messenger/section_collapsed.png                (mail/section_collapsed.png)</span>
<a href="#l21.15"></a><span id="l21.15">   skin/classic/messenger/section_expanded.png                 (mail/section_expanded.png)</span>
<a href="#l21.16"></a><span id="l21.16">   skin/classic/messenger/messageBody.css                      (mail/messageBody.css)</span>
<a href="#l21.17"></a><span id="l21.17">   skin/classic/messenger/messageHeader.css                    (mail/messageHeader.css)</span>
<a href="#l21.18"></a><span id="l21.18">   skin/classic/messenger/messageIcons.css                     (mail/messageIcons.css)</span>
<a href="#l21.19"></a><span id="l21.19">   skin/classic/messenger/messageQuotes.css                    (mail/messageQuotes.css)</span>
<a href="#l21.20"></a><span id="l21.20">   skin/classic/messenger/messenger.css                        (mail/messenger.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/mail/themes/linux/mail/customizeToolbar.css</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,23 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+window,</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+dialog {</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineplus">+  padding: 6px;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+}</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+#instructions {</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+  font-weight: bold;</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+  font-size: larger;</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+}</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+#palette-box {</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+  -moz-appearance: listbox;</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+  margin: 0 0 10px;</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+}</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+#palette-box &gt; toolbarpaletteitem {</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+  padding: 8px 2px;</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+  margin: 0 8px;</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/themes/osx/jar.mn</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/themes/osx/jar.mn</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -21,16 +21,17 @@ classic.jar:</span>
<a href="#l23.4"></a><span id="l23.4"> * skin/classic/messenger/imAccountWizard.css                     (../../components/im/themes/imAccountWizard.css)</span>
<a href="#l23.5"></a><span id="l23.5">   skin/classic/messenger/imMenulist.css                          (../../components/im/themes/imMenulist.css)</span>
<a href="#l23.6"></a><span id="l23.6"> * skin/classic/messenger/imRichlistbox.css                       (../../components/im/themes/imRichlistbox.css)</span>
<a href="#l23.7"></a><span id="l23.7">   skin/classic/messenger/founder.png                             (../../components/im/themes/founder.png)</span>
<a href="#l23.8"></a><span id="l23.8">   skin/classic/messenger/operator.png                            (../../components/im/themes/operator.png)</span>
<a href="#l23.9"></a><span id="l23.9">   skin/classic/messenger/half-operator.png                       (../../components/im/themes/half-operator.png)</span>
<a href="#l23.10"></a><span id="l23.10">   skin/classic/messenger/voice.png                               (../../components/im/themes/voice.png)</span>
<a href="#l23.11"></a><span id="l23.11">   skin/classic/messenger/browserRequest.css                      (mail/browserRequest.css)</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+  skin/classic/messenger/customizeToolbar.css                    (mail/customizeToolbar.css)</span>
<a href="#l23.13"></a><span id="l23.13">   skin/classic/messenger/datetimepicker.css                      (mail/datetimepicker.css)</span>
<a href="#l23.14"></a><span id="l23.14">   skin/classic/messenger/section_collapsed.png                   (mail/section_collapsed.png)</span>
<a href="#l23.15"></a><span id="l23.15">   skin/classic/messenger/section_expanded.png                    (mail/section_expanded.png)</span>
<a href="#l23.16"></a><span id="l23.16">   skin/classic/messenger/messageBody.css                         (mail/messageBody.css)</span>
<a href="#l23.17"></a><span id="l23.17">   skin/classic/messenger/messageHeader.css                       (mail/messageHeader.css)</span>
<a href="#l23.18"></a><span id="l23.18">   skin/classic/messenger/messageIcons.css                        (mail/messageIcons.css)</span>
<a href="#l23.19"></a><span id="l23.19">   skin/classic/messenger/messageQuotes.css                       (mail/messageQuotes.css)</span>
<a href="#l23.20"></a><span id="l23.20">   skin/classic/messenger/messageWindow.css                       (mail/messageWindow.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/mail/themes/osx/mail/customizeToolbar.css</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,38 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+#palette-box {</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+  margin-top: 2px;</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+  -moz-appearance: listbox;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+  margin: 0 0 10px;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+}</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+#palette-box &gt; toolbarpaletteitem {</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+  padding: 8px 2px;</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+  margin: 0 8px;</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+}</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+#main-box {</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+  padding: 12px;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+}</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+#main-box &gt; separator {</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+  border-bottom: none;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+} </span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+#instructions {</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+  font: menu;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+  font-weight: bold;</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+  line-height: 16pt;</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+}</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+hbox button {</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+  font: menu;</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+}</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+#main-box &gt; box &gt; button {</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+  min-height: 19px; /* aqua size for small buttons */</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+  font: message-box;</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/themes/windows/jar.mn</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/themes/windows/jar.mn</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -16,16 +16,17 @@ classic.jar:</span>
<a href="#l25.4"></a><span id="l25.4"> * skin/classic/messenger/imAccountWizard.css                  (../../components/im/themes/imAccountWizard.css)</span>
<a href="#l25.5"></a><span id="l25.5">   skin/classic/messenger/imMenulist.css                       (../../components/im/themes/imMenulist.css)</span>
<a href="#l25.6"></a><span id="l25.6"> * skin/classic/messenger/imRichlistbox.css                    (../../components/im/themes/imRichlistbox.css)</span>
<a href="#l25.7"></a><span id="l25.7">   skin/classic/messenger/founder.png                          (../../components/im/themes/founder.png)</span>
<a href="#l25.8"></a><span id="l25.8">   skin/classic/messenger/operator.png                         (../../components/im/themes/operator.png)</span>
<a href="#l25.9"></a><span id="l25.9">   skin/classic/messenger/half-operator.png                    (../../components/im/themes/half-operator.png)</span>
<a href="#l25.10"></a><span id="l25.10">   skin/classic/messenger/voice.png                            (../../components/im/themes/voice.png)</span>
<a href="#l25.11"></a><span id="l25.11">   skin/classic/messenger/browserRequest.css                   (mail/browserRequest.css)</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+  skin/classic/messenger/customizeToolbar.css                 (mail/customizeToolbar.css)</span>
<a href="#l25.13"></a><span id="l25.13">   skin/classic/messenger/datetimepicker.css                   (mail/datetimepicker.css)</span>
<a href="#l25.14"></a><span id="l25.14">   skin/classic/messenger/section_collapsed.png                (mail/section_collapsed.png)</span>
<a href="#l25.15"></a><span id="l25.15">   skin/classic/messenger/section_expanded.png                 (mail/section_expanded.png)</span>
<a href="#l25.16"></a><span id="l25.16">   skin/classic/messenger/messageBody.css                      (mail/messageBody.css)</span>
<a href="#l25.17"></a><span id="l25.17">   skin/classic/messenger/messageHeader.css                    (mail/messageHeader.css)</span>
<a href="#l25.18"></a><span id="l25.18">   skin/classic/messenger/messageIcons.css                     (mail/messageIcons.css)</span>
<a href="#l25.19"></a><span id="l25.19">   skin/classic/messenger/messageQuotes.css                    (mail/messageQuotes.css)</span>
<a href="#l25.20"></a><span id="l25.20">   skin/classic/messenger/messenger.css                        (mail/messenger.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">new file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- /dev/null</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ b/mail/themes/windows/mail/customizeToolbar.css</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -0,0 +1,23 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineplus">+</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineplus">+window,</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineplus">+dialog {</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+  padding: 6px;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+}</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+#instructions {</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+  font-weight: bold;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+  font-size: larger;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+}</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+#palette-box {</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+  -moz-appearance: listbox;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+  margin: 0 0 10px;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+}</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineplus">+</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+#palette-box &gt; toolbarpaletteitem {</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+  padding: 8px 2px;</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineplus">+  margin: 0 8px;</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

