<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 15451:f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93" />
<meta property="og:url" content="/comm-central/rev/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93" />
<meta property="og:description" content="Bug 955503 - New conversation tab should display chat rooms, r=florian,aleth" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">shortlog</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">files</a> |
changeset |
<a href="/comm-central/raw-rev/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">raw</a>  | <a href="/comm-central/archive/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=955503">Bug 955503</a> - New conversation tab should display chat rooms, r=florian,aleth
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#105;&#104;&#97;&#110;&#116;&#104;&#32;&#83;&#117;&#98;&#114;&#97;&#109;&#97;&#110;&#121;&#97;&#32;&#60;&#110;&#104;&#110;&#116;&#49;&#49;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 03 Sep 2013 22:19:37 +0530</td></tr>

<tr>
 <td>changeset 15451</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93</a></td>
</tr>



<tr>
<td>parent 15450</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f8fc64e1a05a87c0712d9bad7f7c9c4abda9fca9">f8fc64e1a05a87c0712d9bad7f7c9c4abda9fca9</a>
</td>
</tr>

<tr>
<td>child 15452</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e2ceb3e9995cb8a751979025995a7048fc0bc785">e2ceb3e9995cb8a751979025995a7048fc0bc785</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28florian%29&revcount=50">florian</a>, <a href="/comm-central/log?rev=reviewer%28aleth%29&revcount=50">aleth</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=955503">955503</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=955503">Bug 955503</a> - New conversation tab should display chat rooms, r=florian,aleth</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/components/public/imIAccount.idl">chat/components/public/imIAccount.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/components/public/imIAccount.idl">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/components/public/imIAccount.idl">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/components/public/imIAccount.idl">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/components/public/imIAccount.idl">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/components/public/imIAccount.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/modules/jsProtoHelper.jsm">chat/modules/jsProtoHelper.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/modules/jsProtoHelper.jsm">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/modules/jsProtoHelper.jsm">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/modules/jsProtoHelper.jsm">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/modules/jsProtoHelper.jsm">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/chat/modules/jsProtoHelper.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibConvStatsService.js">im/components/ibConvStatsService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibConvStatsService.js">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibConvStatsService.js">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibConvStatsService.js">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibConvStatsService.js">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibConvStatsService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibIConvStatsService.idl">im/components/ibIConvStatsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibIConvStatsService.idl">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibIConvStatsService.idl">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibIConvStatsService.idl">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibIConvStatsService.idl">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/components/ibIConvStatsService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/content/newtab.xml">im/content/newtab.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/content/newtab.xml">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/content/newtab.xml">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/content/newtab.xml">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/content/newtab.xml">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/content/newtab.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/jar.mn">im/themes/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/jar.mn">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/jar.mn">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/jar.mn">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/jar.mn">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/multiUserIcon.png">im/themes/multiUserIcon.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/multiUserIcon.png">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/multiUserIcon.png">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/multiUserIcon.png">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/multiUserIcon.png">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/multiUserIcon.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/newtab.css">im/themes/newtab.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/newtab.css">file</a> |
<a href="/comm-central/annotate/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/newtab.css">annotate</a> |
<a href="/comm-central/diff/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/newtab.css">diff</a> |
<a href="/comm-central/comparison/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/newtab.css">comparison</a> |
<a href="/comm-central/log/f5ada9a0b8a8d801fb6c286d0187fc5a3da2fd93/im/themes/newtab.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/components/public/imIAccount.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/components/public/imIAccount.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;prplIConversation.idl&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;imIUserStatusInfo.idl&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> interface imITag;</span>
<a href="#l1.9"></a><span id="l1.9"> interface imIBuddy;</span>
<a href="#l1.10"></a><span id="l1.10"> interface imIAccountBuddy;</span>
<a href="#l1.11"></a><span id="l1.11"> interface imIAccount;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+interface prplIAccount;</span>
<a href="#l1.13"></a><span id="l1.13"> interface prplIProtocol;</span>
<a href="#l1.14"></a><span id="l1.14"> interface purpleIProxyInfo;</span>
<a href="#l1.15"></a><span id="l1.15"> interface nsIScriptError;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> /*</span>
<a href="#l1.18"></a><span id="l1.18">  * Used to join chat rooms.</span>
<a href="#l1.19"></a><span id="l1.19">  */</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -34,16 +35,44 @@ interface prplIChatRoomField: nsISupport</span>
<a href="#l1.22"></a><span id="l1.22">   const short TYPE_PASSWORD = 1;</span>
<a href="#l1.23"></a><span id="l1.23">   const short TYPE_INT = 2;</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">   readonly attribute short type;</span>
<a href="#l1.26"></a><span id="l1.26">   readonly attribute long min;</span>
<a href="#l1.27"></a><span id="l1.27">   readonly attribute long max;</span>
<a href="#l1.28"></a><span id="l1.28"> };</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+/*</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+ * Information about a chat room and the fields required to join it.</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+ */</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+[scriptable, uuid(3fc279d9-b280-4f4a-babd-b4e328e65a01)]</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+interface prplIRoomInfo: nsISupports {</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  readonly attribute AUTF8String accountId;</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+  readonly attribute AUTF8String name;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+  readonly attribute AUTF8String topic;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+  readonly attribute unsigned long participantCount;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+  readonly attribute prplIChatRoomFieldValues chatRoomFieldValues;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+};</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+/*</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+ * Callback passed to an account's requestRoomInfo function.</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+ */</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+[scriptable, function, uuid(d3c13bde-b852-44a8-a0dc-c781366cf110)]</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+interface prplIRoomInfoCallback: nsISupports {</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+  /* aRooms is an array containing a batch of prplIRoomInfo. This will be called</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+   * multiple times as batches of chat rooms are received. The number of rooms</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+   * in each batch is left for the prplIAccount implementation to decide.</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+   * aCompleted will be true when aRooms is the last batch.</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+   */</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  void onRoomInfoAvailable([array, size_is(aCount)] in prplIRoomInfo aRooms,</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                           in prplIAccount aAccount,</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+                           in boolean aCompleted,</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+                           in unsigned long aCount);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+};</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59"> /*</span>
<a href="#l1.60"></a><span id="l1.60">  * This interface should be implemented by the protocol plugin.</span>
<a href="#l1.61"></a><span id="l1.61">  */</span>
<a href="#l1.62"></a><span id="l1.62"> [scriptable, uuid(bc540cab-a6e9-4c2c-abff-e95d0d1370a1)]</span>
<a href="#l1.63"></a><span id="l1.63"> interface prplIAccount: nsISupports {</span>
<a href="#l1.64"></a><span id="l1.64">   readonly attribute imIAccount imAccount;</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66" class="difflineat">@@ -80,16 +109,22 @@ interface prplIAccount: nsISupports {</span>
<a href="#l1.67"></a><span id="l1.67">    *  - aSubject will be an nsISimpleEnumerator of prplITooltipInfo.</span>
<a href="#l1.68"></a><span id="l1.68">    *  - aData will be aBuddyName.</span>
<a href="#l1.69"></a><span id="l1.69">    */</span>
<a href="#l1.70"></a><span id="l1.70">   void requestBuddyInfo(in AUTF8String aBuddyName);</span>
<a href="#l1.71"></a><span id="l1.71"> </span>
<a href="#l1.72"></a><span id="l1.72">   readonly attribute boolean canJoinChat;</span>
<a href="#l1.73"></a><span id="l1.73">   nsISimpleEnumerator getChatRoomFields();</span>
<a href="#l1.74"></a><span id="l1.74">   prplIChatRoomFieldValues getChatRoomDefaultFieldValues([optional] in AUTF8String aDefaultChatName);</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+  /* Request information on available chat rooms, to be returned via the</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+   * callback.</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+   */</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+  void requestRoomInfo(in prplIRoomInfoCallback aCallback);</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+  readonly attribute boolean isRoomInfoStale;</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+</span>
<a href="#l1.81"></a><span id="l1.81">   /*</span>
<a href="#l1.82"></a><span id="l1.82">    * Create a new chat conversation if it doesn't already exist.</span>
<a href="#l1.83"></a><span id="l1.83">    */</span>
<a href="#l1.84"></a><span id="l1.84">   void joinChat(in prplIChatRoomFieldValues aComponents);</span>
<a href="#l1.85"></a><span id="l1.85"> </span>
<a href="#l1.86"></a><span id="l1.86">   readonly attribute AUTF8String normalizedName;</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88">   attribute purpleIProxyInfo proxyInfo;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/modules/jsProtoHelper.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/modules/jsProtoHelper.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> const EXPORTED_SYMBOLS = [</span>
<a href="#l2.5"></a><span id="l2.5">   &quot;GenericAccountPrototype&quot;,</span>
<a href="#l2.6"></a><span id="l2.6">   &quot;GenericAccountBuddyPrototype&quot;,</span>
<a href="#l2.7"></a><span id="l2.7">   &quot;GenericConvIMPrototype&quot;,</span>
<a href="#l2.8"></a><span id="l2.8">   &quot;GenericConvChatPrototype&quot;,</span>
<a href="#l2.9"></a><span id="l2.9">   &quot;GenericConvChatBuddyPrototype&quot;,</span>
<a href="#l2.10"></a><span id="l2.10">   &quot;GenericMessagePrototype&quot;,</span>
<a href="#l2.11"></a><span id="l2.11">   &quot;GenericProtocolPrototype&quot;,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  &quot;RoomInfo&quot;,</span>
<a href="#l2.13"></a><span id="l2.13">   &quot;Message&quot;,</span>
<a href="#l2.14"></a><span id="l2.14">   &quot;TooltipInfo&quot;</span>
<a href="#l2.15"></a><span id="l2.15"> ];</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> const {classes: Cc, interfaces: Ci, results: Cr, utils: Cu} = Components;</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19"> Cu.import(&quot;resource:///modules/imXPCOMUtils.jsm&quot;);</span>
<a href="#l2.20"></a><span id="l2.20"> Cu.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -191,16 +192,18 @@ const GenericAccountPrototype = {</span>
<a href="#l2.22"></a><span id="l2.22">     if (aDefaultChatName &amp;&amp; &quot;parseDefaultChatName&quot; in this) {</span>
<a href="#l2.23"></a><span id="l2.23">       let parsedDefaultChatName = this.parseDefaultChatName(aDefaultChatName);</span>
<a href="#l2.24"></a><span id="l2.24">       for (let field in parsedDefaultChatName)</span>
<a href="#l2.25"></a><span id="l2.25">         defaultFieldValues[field] = parsedDefaultChatName[field];</span>
<a href="#l2.26"></a><span id="l2.26">     }</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">     return new ChatRoomFieldValues(defaultFieldValues);</span>
<a href="#l2.29"></a><span id="l2.29">   },</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  requestRoomInfo: function(aCallback) { throw Cr.NS_ERROR_NOT_IMPLEMENTED; },</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  get isRoomInfoStale() false,</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33">   getPref: function (aName, aType)</span>
<a href="#l2.34"></a><span id="l2.34">     this.prefs.prefHasUserValue(aName) ?</span>
<a href="#l2.35"></a><span id="l2.35">       this.prefs[&quot;get&quot; + aType + &quot;Pref&quot;](aName) :</span>
<a href="#l2.36"></a><span id="l2.36">       this.protocol._getOptionDefault(aName),</span>
<a href="#l2.37"></a><span id="l2.37">   getInt: function(aName) this.getPref(aName, &quot;Int&quot;),</span>
<a href="#l2.38"></a><span id="l2.38">   getBool: function(aName) this.getPref(aName, &quot;Bool&quot;),</span>
<a href="#l2.39"></a><span id="l2.39">   getString: function(aName) {</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineat">@@ -707,16 +710,25 @@ UsernameSplit.prototype = {</span>
<a href="#l2.41"></a><span id="l2.41">   __proto__: ClassInfo(&quot;prplIUsernameSplit&quot;, &quot;username split object&quot;),</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43">   get label() this._values.label,</span>
<a href="#l2.44"></a><span id="l2.44">   get separator() this._values.separator,</span>
<a href="#l2.45"></a><span id="l2.45">   get defaultValue() this._values.defaultValue,</span>
<a href="#l2.46"></a><span id="l2.46">   get reverse() !!this._values.reverse // Ensure boolean</span>
<a href="#l2.47"></a><span id="l2.47"> };</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+function RoomInfo(aName, aTopic, aParticipantCount, aAccountId, aChatRoomFieldValues) {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  this.name = aName;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  this.topic = aTopic;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  this.participantCount = aParticipantCount;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+  this.accountId = aAccountId;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  this.chatRoomFieldValues = aChatRoomFieldValues;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+}</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+RoomInfo.prototype = ClassInfo(&quot;prplIRoomInfo&quot;, &quot;RoomInfo object&quot;);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+</span>
<a href="#l2.58"></a><span id="l2.58"> function ChatRoomField(aIdentifier, aField) {</span>
<a href="#l2.59"></a><span id="l2.59">   this.identifier = aIdentifier;</span>
<a href="#l2.60"></a><span id="l2.60">   this.label = aField.label;</span>
<a href="#l2.61"></a><span id="l2.61">   this.required = !!aField.required;</span>
<a href="#l2.62"></a><span id="l2.62"> </span>
<a href="#l2.63"></a><span id="l2.63">   let type = &quot;TEXT&quot;;</span>
<a href="#l2.64"></a><span id="l2.64">   if ((typeof aField.default) == &quot;number&quot;) {</span>
<a href="#l2.65"></a><span id="l2.65">     type = &quot;INT&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/components/ibConvStatsService.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/components/ibConvStatsService.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,20 +1,21 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-const {interfaces: Ci, utils: Cu} = Components;</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+const {interfaces: Ci, utils: Cu, results: Cr} = Components;</span>
<a href="#l3.10"></a><span id="l3.10"> Cu.import(&quot;resource:///modules/imXPCOMUtils.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11"> Cu.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12"> </span>
<a href="#l3.13"></a><span id="l3.13"> const kNotificationsToObserve =</span>
<a href="#l3.14"></a><span id="l3.14">   [&quot;contact-added&quot;, &quot;contact-removed&quot;,&quot;contact-status-changed&quot;,</span>
<a href="#l3.15"></a><span id="l3.15">    &quot;contact-display-name-changed&quot;, &quot;contact-no-longer-dummy&quot;,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-   &quot;contact-preferred-buddy-changed&quot;, &quot;contact-moved&quot;];</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+   &quot;contact-preferred-buddy-changed&quot;, &quot;contact-moved&quot;,</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+   &quot;account-disconnected&quot;];</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> XPCOMUtils.defineLazyGetter(this, &quot;_newtab&quot;, function()</span>
<a href="#l3.21"></a><span id="l3.21">   l10nHelper(&quot;chrome://instantbird/locale/newtab.properties&quot;)</span>
<a href="#l3.22"></a><span id="l3.22"> );</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24"> XPCOMUtils.defineLazyGetter(this, &quot;_instantbird&quot;, function()</span>
<a href="#l3.25"></a><span id="l3.25">   l10nHelper(&quot;chrome://instantbird/locale/instantbird.properties&quot;)</span>
<a href="#l3.26"></a><span id="l3.26"> );</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineat">@@ -22,18 +23,22 @@ XPCOMUtils.defineLazyGetter(this, &quot;_inst</span>
<a href="#l3.28"></a><span id="l3.28"> function ConvStatsService() {</span>
<a href="#l3.29"></a><span id="l3.29">   this._observers = [];</span>
<a href="#l3.30"></a><span id="l3.30"> }</span>
<a href="#l3.31"></a><span id="l3.31"> ConvStatsService.prototype = {</span>
<a href="#l3.32"></a><span id="l3.32">   // Sorted list of contacts, stored as PossibleConvFromContacts.</span>
<a href="#l3.33"></a><span id="l3.33">   _contacts: [],</span>
<a href="#l3.34"></a><span id="l3.34">   // PossibleConvFromContacts stored by id.</span>
<a href="#l3.35"></a><span id="l3.35">   _contactsById: new Map(),</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+  // Sorted list of chat rooms, stored as PossibleChats.</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+  _chats: [],</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+  // Keys are account ids. Values are Maps of chat names to PossibleChats.</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+  _chatsByAccountIdAndName: new Map(),</span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-  _initContacts: function() {</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+  _init: function() {</span>
<a href="#l3.43"></a><span id="l3.43">     let contacts = Services.contacts.getContacts();</span>
<a href="#l3.44"></a><span id="l3.44">     for (let contact of contacts)</span>
<a href="#l3.45"></a><span id="l3.45">       this._addContact(contact);</span>
<a href="#l3.46"></a><span id="l3.46">     for (let notification of kNotificationsToObserve)</span>
<a href="#l3.47"></a><span id="l3.47">       Services.obs.addObserver(this, notification, false);</span>
<a href="#l3.48"></a><span id="l3.48">   },</span>
<a href="#l3.49"></a><span id="l3.49"> </span>
<a href="#l3.50"></a><span id="l3.50">   _addContact: function(aContact) {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineat">@@ -48,16 +53,41 @@ ConvStatsService.prototype = {</span>
<a href="#l3.52"></a><span id="l3.52">   _removeContact: function(aId) {</span>
<a href="#l3.53"></a><span id="l3.53">     if (!this._contactsById.has(aId))</span>
<a href="#l3.54"></a><span id="l3.54">       return;</span>
<a href="#l3.55"></a><span id="l3.55">     this._contacts.splice(</span>
<a href="#l3.56"></a><span id="l3.56">       this._contacts.indexOf(this._contactsById.get(aId)), 1);</span>
<a href="#l3.57"></a><span id="l3.57">     this._contactsById.delete(aId);</span>
<a href="#l3.58"></a><span id="l3.58">   },</span>
<a href="#l3.59"></a><span id="l3.59"> </span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+  _addChat: function(aRoomInfo) {</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+    let accountId = aRoomInfo.accountId;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+    let chatList = this._chatsByAccountIdAndName.get(accountId);</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+    if (!chatList) {</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+      chatList = new Map();</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+      this._chatsByAccountIdAndName.set(accountId, chatList);</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+    }</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+    // If a chat is already added, we remove it and re-add to refresh.</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+    else if (chatList.has(aRoomInfo.name)) {</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+      this._chats.splice(</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+        this._chats.indexOf(chatList.get(aRoomInfo.name)), 1);</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+    }</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+    let possibleConv = new PossibleChat(aRoomInfo);</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+    let pos = this._getPositionToInsert(possibleConv, this._chats);</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+    this._chats.splice(pos, 0, possibleConv);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+    chatList.set(aRoomInfo.name, possibleConv);</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+  },</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+  _removeChatsForAccount: function(aAccId) {</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    if (!this._chatsByAccountIdAndName.has(aAccId))</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+      return;</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+    this._chats = this._chats.filter(function(c) c._accountId != aAccId);</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+    this._chatsByAccountIdAndName.delete(aAccId);</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+  },</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+</span>
<a href="#l3.85"></a><span id="l3.85">   _getPositionToInsert: function(aPossibleConversation, aArrayToInsert) {</span>
<a href="#l3.86"></a><span id="l3.86">     let end = aArrayToInsert.length;</span>
<a href="#l3.87"></a><span id="l3.87">     // Avoid the binary search loop if aArrayToInsert was already sorted.</span>
<a href="#l3.88"></a><span id="l3.88">     if (end == 0 ||</span>
<a href="#l3.89"></a><span id="l3.89">         this._sortComparator(aPossibleConversation, aArrayToInsert[end - 1]) &gt;= 0)</span>
<a href="#l3.90"></a><span id="l3.90">       return end;</span>
<a href="#l3.91"></a><span id="l3.91">     let start = 0;</span>
<a href="#l3.92"></a><span id="l3.92">     while (start &lt; end) {</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineat">@@ -70,47 +100,82 @@ ConvStatsService.prototype = {</span>
<a href="#l3.94"></a><span id="l3.94">     return end;</span>
<a href="#l3.95"></a><span id="l3.95">   },</span>
<a href="#l3.96"></a><span id="l3.96"> </span>
<a href="#l3.97"></a><span id="l3.97">   _sortComparator: function(aPossibleConvA, aPossibleConvB) {</span>
<a href="#l3.98"></a><span id="l3.98">     return (aPossibleConvB.statusType - aPossibleConvA.statusType) ||</span>
<a href="#l3.99"></a><span id="l3.99">       aPossibleConvA.lowerCaseName.localeCompare(aPossibleConvB.lowerCaseName);</span>
<a href="#l3.100"></a><span id="l3.100">   },</span>
<a href="#l3.101"></a><span id="l3.101"> </span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-  getFilteredConvs: function(aFilterStr, aFilteredConvsCount) {</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-    // Clone this._contacts to ensure it doesn't get modified</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-    // when we insert ui conversations.</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-    let filteredConvs = this._contacts.slice(0);</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+  getFilteredConvs: function(aFilterStr) {</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+    let filteredConvs = this._contacts.concat(this._chats);</span>
<a href="#l3.108"></a><span id="l3.108">     let existingConvs = Services.conversations.getUIConversations().map(</span>
<a href="#l3.109"></a><span id="l3.109">                           function(uiConv) new ExistingConversation(uiConv));</span>
<a href="#l3.110"></a><span id="l3.110">     for (let existingConv of existingConvs) {</span>
<a href="#l3.111"></a><span id="l3.111">       let pos = this._getPositionToInsert(existingConv, filteredConvs);</span>
<a href="#l3.112"></a><span id="l3.112">       filteredConvs.splice(pos, 0, existingConv);</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-      // Remove the contact to prevent a duplicate.</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-      let contact = existingConv.uiConv.contact;</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-      if (contact &amp;&amp; this._contactsById.has(contact.id)) {</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-        filteredConvs.splice(</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-          filteredConvs.indexOf(this._contactsById.get(contact.id)), 1);</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+      // Remove any duplicate contact or chat.</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+      let uiConv = existingConv.uiConv;</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+      if (existingConv.isChat) {</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+        let chatList = this._chatsByAccountIdAndName.get(uiConv.account.id);</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+        if (chatList) {</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+          let chat = chatList.get(uiConv.name);</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+          if (chat)</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+            filteredConvs.splice(filteredConvs.indexOf(chat), 1);</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+        }</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+      }</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+      else {</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+        let contact = uiConv.contact;</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+        if (contact &amp;&amp; this._contactsById.has(contact.id)) {</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+          filteredConvs.splice(</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+            filteredConvs.indexOf(this._contactsById.get(contact.id)), 1);</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+        }</span>
<a href="#l3.134"></a><span id="l3.134">       }</span>
<a href="#l3.135"></a><span id="l3.135">     }</span>
<a href="#l3.136"></a><span id="l3.136">     if (aFilterStr) {</span>
<a href="#l3.137"></a><span id="l3.137">       aFilterStr = aFilterStr.toLowerCase();</span>
<a href="#l3.138"></a><span id="l3.138">       filteredConvs = filteredConvs.filter(function(c) {</span>
<a href="#l3.139"></a><span id="l3.139">         return c.lowerCaseName.startsWith(aFilterStr) ||</span>
<a href="#l3.140"></a><span id="l3.140">           c.lowerCaseName.split(/\s+/).some(function(s) s.startsWith(aFilterStr));</span>
<a href="#l3.141"></a><span id="l3.141">       });</span>
<a href="#l3.142"></a><span id="l3.142">     }</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-    if (aFilteredConvsCount)</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-      aFilteredConvsCount.value = filteredConvs.length;</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-    return filteredConvs;</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+    return new nsSimpleEnumerator(filteredConvs);</span>
<a href="#l3.147"></a><span id="l3.147">   },</span>
<a href="#l3.148"></a><span id="l3.148"> </span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+  // The last time an update notification was sent to observers.</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+  _lastUpdateNotification: 0,</span>
<a href="#l3.151"></a><span id="l3.151">   addObserver: function(aObserver) {</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-      this._observers.push(aObserver);</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+    if (this._observers.indexOf(aObserver) != -1)</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+      return;</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+    this._observers.push(aObserver);</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+    let accounts = Services.accounts.getAccounts();</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+    // We request chat lists from accounts when adding new observers.</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+    while (accounts.hasMoreElements()) {</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+      let acc = accounts.getNext();</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+      let id = acc.id;</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+      if (acc.connected &amp;&amp; acc.canJoinChat &amp;&amp; (!this._chatsByAccountIdAndName.has(id) ||</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+          acc.prplAccount.isRoomInfoStale)) {</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+        // Discard any chat room data we already have.</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+        this._removeChatsForAccount(id);</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+        try {</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+          acc.prplAccount.requestRoomInfo(function(aRoomInfo, aPrplAccount, aCompleted) {</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+            aRoomInfo.forEach(this._addChat, this);</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+            let now = Date.now();</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+            if ((now - this._lastUpdateNotification &gt; 100) || aCompleted) {</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+              this._notifyObservers(&quot;updated&quot;);</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+              this._lastUpdateNotification = now;</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+            }</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+          }.bind(this));</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+        } catch(e) {</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+          if (e.result != Cr.NS_ERROR_NOT_IMPLEMENTED)</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+            Cu.reportError(e);</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+          continue;</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+        }</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+      }</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+    }</span>
<a href="#l3.182"></a><span id="l3.182">   },</span>
<a href="#l3.183"></a><span id="l3.183"> </span>
<a href="#l3.184"></a><span id="l3.184">   removeObserver: function(aObserver) {</span>
<a href="#l3.185"></a><span id="l3.185">     this._observers = this._observers.filter(function(o) o !== aObserver);</span>
<a href="#l3.186"></a><span id="l3.186">   },</span>
<a href="#l3.187"></a><span id="l3.187"> </span>
<a href="#l3.188"></a><span id="l3.188">   _notifyObservers: function(aTopic) {</span>
<a href="#l3.189"></a><span id="l3.189">     for each (let observer in this._observers) {</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineat">@@ -118,41 +183,43 @@ ConvStatsService.prototype = {</span>
<a href="#l3.191"></a><span id="l3.191">         observer.observe(this, &quot;stats-service-&quot; + aTopic);</span>
<a href="#l3.192"></a><span id="l3.192">     }</span>
<a href="#l3.193"></a><span id="l3.193">   },</span>
<a href="#l3.194"></a><span id="l3.194"> </span>
<a href="#l3.195"></a><span id="l3.195">   observe: function(aSubject, aTopic, aData) {</span>
<a href="#l3.196"></a><span id="l3.196">     if (aTopic == &quot;profile-after-change&quot;)</span>
<a href="#l3.197"></a><span id="l3.197">       Services.obs.addObserver(this, &quot;prpl-init&quot;, false);</span>
<a href="#l3.198"></a><span id="l3.198">     else if (aTopic == &quot;prpl-init&quot;) {</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-      executeSoon(this._initContacts.bind(this));</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+      executeSoon(this._init.bind(this));</span>
<a href="#l3.201"></a><span id="l3.201">       Services.obs.removeObserver(this, &quot;prpl-init&quot;);</span>
<a href="#l3.202"></a><span id="l3.202">     }</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineminus">-    if (!aTopic.startsWith(&quot;contact-&quot;))</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+    if (!aTopic.startsWith(&quot;contact-&quot;) &amp;&amp; !aTopic.startsWith(&quot;account&quot;))</span>
<a href="#l3.205"></a><span id="l3.205">       return;</span>
<a href="#l3.206"></a><span id="l3.206">     if (aTopic == &quot;contact-no-longer-dummy&quot;) {</span>
<a href="#l3.207"></a><span id="l3.207">       // Contact ID changed. aData is the old ID.</span>
<a href="#l3.208"></a><span id="l3.208">       let id = aSubject.id;</span>
<a href="#l3.209"></a><span id="l3.209">       let oldId = parseInt(aData, 10);</span>
<a href="#l3.210"></a><span id="l3.210">       this._contactsById.set(id, this._contactsById.get(oldId));</span>
<a href="#l3.211"></a><span id="l3.211">       this._contactsById.delete(oldId);</span>
<a href="#l3.212"></a><span id="l3.212">       this._contactsById.get(id)._id = id;</span>
<a href="#l3.213"></a><span id="l3.213">       return;</span>
<a href="#l3.214"></a><span id="l3.214">     }</span>
<a href="#l3.215"></a><span id="l3.215">     else if (aTopic == &quot;contact-added&quot;)</span>
<a href="#l3.216"></a><span id="l3.216">       this._addContact(aSubject);</span>
<a href="#l3.217"></a><span id="l3.217">     else if (aTopic == &quot;contact-removed&quot;)</span>
<a href="#l3.218"></a><span id="l3.218">       this._removeContact(aSubject.id);</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-    else {</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineplus">+    else if (aTopic.startsWith(&quot;contact&quot;)) {</span>
<a href="#l3.221"></a><span id="l3.221">       // A change in the contact's status or display name may cause the</span>
<a href="#l3.222"></a><span id="l3.222">       // order to change, so we simply remove and re-add it.</span>
<a href="#l3.223"></a><span id="l3.223">       this._removeContact(aSubject.id);</span>
<a href="#l3.224"></a><span id="l3.224">       this._addContact(aSubject);</span>
<a href="#l3.225"></a><span id="l3.225">     }</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-    this._notifyObservers(&quot;contact-updated&quot;);</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+    else if (aTopic == &quot;account-disconnected&quot;)</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+      this._removeChatsForAccount(aSubject.id);</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineplus">+    this._notifyObservers(&quot;updated&quot;);</span>
<a href="#l3.230"></a><span id="l3.230">   },</span>
<a href="#l3.231"></a><span id="l3.231"> </span>
<a href="#l3.232"></a><span id="l3.232">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIObserver, Ci.ibIConvStatsService]),</span>
<a href="#l3.233"></a><span id="l3.233">   classDescription: &quot;ConvStatsService&quot;,</span>
<a href="#l3.234"></a><span id="l3.234">   classID: Components.ID(&quot;{1d9be575-87a4-4f2f-b414-c67a560f29fd}&quot;),</span>
<a href="#l3.235"></a><span id="l3.235">   contractID: &quot;@instantbird.org/conv-stats-service;1&quot;</span>
<a href="#l3.236"></a><span id="l3.236"> };</span>
<a href="#l3.237"></a><span id="l3.237"> </span>
<a href="#l3.238"></a><span id="l3.238" class="difflineat">@@ -187,24 +254,41 @@ PossibleConvFromContact.prototype = {</span>
<a href="#l3.239"></a><span id="l3.239">     tagNames.sort(function(a, b) a.toLowerCase().localeCompare(b.toLowerCase()));</span>
<a href="#l3.240"></a><span id="l3.240">     return tagNames.join(&quot;, &quot;);</span>
<a href="#l3.241"></a><span id="l3.241">   },</span>
<a href="#l3.242"></a><span id="l3.242">   get contact() Services.contacts.getContactById(this._id),</span>
<a href="#l3.243"></a><span id="l3.243">   get account() this.contact.preferredBuddy.preferredAccountBuddy.account,</span>
<a href="#l3.244"></a><span id="l3.244">   createConversation: function() this.contact.createConversation()</span>
<a href="#l3.245"></a><span id="l3.245"> };</span>
<a href="#l3.246"></a><span id="l3.246"> </span>
<a href="#l3.247"></a><span id="l3.247" class="difflineplus">+function PossibleChat(aRoomInfo) {</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineplus">+  this._accountId = aRoomInfo.accountId;</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineplus">+  this._displayName = aRoomInfo.name;</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineplus">+  this._statusText = &quot;(&quot; + aRoomInfo.participantCount + &quot;) &quot; +</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineplus">+    (aRoomInfo.topic || _instantbird(&quot;noTopic&quot;));</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineplus">+  this._chatRoomFieldValues = aRoomInfo.chatRoomFieldValues;</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineplus">+}</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+PossibleChat.prototype = {</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineplus">+  __proto__: PossibleConversation,</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineplus">+  _isChat: true,</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineplus">+  _statusType: Ci.imIStatusInfo.STATUS_UNKNOWN,</span>
<a href="#l3.258"></a><span id="l3.258" class="difflineplus">+  _buddyIconFilename: &quot;&quot;,</span>
<a href="#l3.259"></a><span id="l3.259" class="difflineplus">+  get infoText() this.account.normalizedName,</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineplus">+  get source() &quot;chat&quot;,</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineplus">+  get account() Services.accounts.getAccountById(this._accountId),</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineplus">+  createConversation: function() this.account.joinChat(this._chatRoomFieldValues)</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineplus">+};</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineplus">+</span>
<a href="#l3.265"></a><span id="l3.265"> function ExistingConversation(aUIConv) {</span>
<a href="#l3.266"></a><span id="l3.266">   this._id = aUIConv.target.id;</span>
<a href="#l3.267"></a><span id="l3.267">   this._displayName = aUIConv.title;</span>
<a href="#l3.268"></a><span id="l3.268">   this._isChat = aUIConv.isChat;</span>
<a href="#l3.269"></a><span id="l3.269">   if (aUIConv.isChat) {</span>
<a href="#l3.270"></a><span id="l3.270">     this._statusText = aUIConv.topic || _instantbird(&quot;noTopic&quot;);</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-    this._statusType = aUIConv.account.connected &amp;&amp; !aUIConv.left ?</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-      Ci.imIStatusInfo.STATUS_AVAILABLE : Ci.imIStatusInfo.STATUS_OFFLINE;</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+    this._statusType = Ci.imIStatusInfo.STATUS_UNKNOWN;</span>
<a href="#l3.274"></a><span id="l3.274">     this._buddyIconFilename = &quot;&quot;;</span>
<a href="#l3.275"></a><span id="l3.275">   }</span>
<a href="#l3.276"></a><span id="l3.276">   else {</span>
<a href="#l3.277"></a><span id="l3.277">     let buddy = aUIConv.buddy;</span>
<a href="#l3.278"></a><span id="l3.278">     if (buddy) {</span>
<a href="#l3.279"></a><span id="l3.279">       this._statusType = buddy.statusType;</span>
<a href="#l3.280"></a><span id="l3.280">       this._statusText = buddy.statusText;</span>
<a href="#l3.281"></a><span id="l3.281">       this._buddyIconFilename = buddy.buddyIconFilename;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/im/components/ibIConvStatsService.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/im/components/ibIConvStatsService.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,29 +1,27 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+#include &quot;nsISimpleEnumerator.idl&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsIObserver.idl&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;imIStatusInfo.idl&quot;</span>
<a href="#l4.12"></a><span id="l4.12"> </span>
<a href="#l4.13"></a><span id="l4.13"> interface ibIPossibleConversation;</span>
<a href="#l4.14"></a><span id="l4.14"> interface imIAccount;</span>
<a href="#l4.15"></a><span id="l4.15"> interface imIAccountBuddy;</span>
<a href="#l4.16"></a><span id="l4.16"> interface imIContact;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> [scriptable, uuid(1b495592-8512-4443-bcdb-49118f045e42)]</span>
<a href="#l4.19"></a><span id="l4.19"> interface ibIConvStatsService: nsISupports {</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  // Returns an array of PossibleConversations which match the given filter string.</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-  void getFilteredConvs(in AUTF8String aFilterStr,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-    [optional] out unsigned long filteredConvCount,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-    [retval, array, size_is(filteredConvCount)] out ibIPossibleConversation filteredConvs);</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-  // A stats-service-contact-updated notification is fired when a contact has</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-  // been updated and observers need to refresh.</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  // Returns an enumerator of PossibleConversations which match the given filter string.</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  nsISimpleEnumerator getFilteredConvs(in AUTF8String aFilterStr);</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  // A stats-service-updated notification is fired when data has been updated.</span>
<a href="#l4.29"></a><span id="l4.29">   void addObserver(in nsIObserver aObserver);</span>
<a href="#l4.30"></a><span id="l4.30">   void removeObserver(in nsIObserver aObserver);</span>
<a href="#l4.31"></a><span id="l4.31"> };</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33"> [scriptable, uuid(e7e5e7ba-203c-47ea-8174-55b5e5d8131f)]</span>
<a href="#l4.34"></a><span id="l4.34"> // Inherits from imIStatusInfo to avoid code duplication.</span>
<a href="#l4.35"></a><span id="l4.35"> interface ibIPossibleConversation: imIStatusInfo {</span>
<a href="#l4.36"></a><span id="l4.36">   /* The source of the possible conversation. Possible values are:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/content/newtab.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/content/newtab.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -90,42 +90,61 @@</span>
<a href="#l5.4"></a><span id="l5.4">         &lt;body&gt;</span>
<a href="#l5.5"></a><span id="l5.5">         &lt;![CDATA[</span>
<a href="#l5.6"></a><span id="l5.6">           this.addMoreItems();</span>
<a href="#l5.7"></a><span id="l5.7">         ]]&gt;</span>
<a href="#l5.8"></a><span id="l5.8">         &lt;/body&gt;</span>
<a href="#l5.9"></a><span id="l5.9">       &lt;/method&gt;</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">       &lt;!-- Maintains computed number of items to display. Incremented when the user</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-           scrolls near the bottom of the list, unless hasMoreItemsToDisplay is false. --&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+           scrolls near the bottom of the list if we have more conversations. --&gt;</span>
<a href="#l5.14"></a><span id="l5.14">       &lt;field name=&quot;numberOfItemsToDisplay&quot;&gt;0&lt;/field&gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-      &lt;field name=&quot;hasMoreItemsToDisplay&quot;&gt;true&lt;/field&gt;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+      &lt;property name=&quot;hasMoreConversations&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+          return this.filteredConvs &amp;&amp; this.filteredConvs.hasMoreElements();</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l5.23"></a><span id="l5.23">       &lt;!-- While scrolling, we add more items when there are three items left that</span>
<a href="#l5.24"></a><span id="l5.24">            aren't displayed (the last visible item is fourth from the end of the list). --&gt;</span>
<a href="#l5.25"></a><span id="l5.25">       &lt;field name=&quot;kAddMoreItemsThreshold&quot; readonly=&quot;true&quot;&gt;3&lt;/field&gt;</span>
<a href="#l5.26"></a><span id="l5.26">       &lt;!-- Try to add this many items when scrolling past the threshold. --&gt;</span>
<a href="#l5.27"></a><span id="l5.27">       &lt;field name=&quot;kNumItemsIncrement&quot; readonly=&quot;true&quot;&gt;10&lt;/field&gt;</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">       &lt;!-- Increments numberOfItemsToDisplay and calls refresh(). Used on scrolling/resizing. --&gt;</span>
<a href="#l5.30"></a><span id="l5.30">       &lt;method name=&quot;addMoreItems&quot;&gt;</span>
<a href="#l5.31"></a><span id="l5.31">         &lt;body&gt;</span>
<a href="#l5.32"></a><span id="l5.32">         &lt;![CDATA[</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-          if (!this.hasMoreItemsToDisplay)</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+          if (!this.hasMoreConversations)</span>
<a href="#l5.35"></a><span id="l5.35">             return;</span>
<a href="#l5.36"></a><span id="l5.36">           let lastVisibleIndex = this.listbox.getIndexOfFirstVisibleRow() +</span>
<a href="#l5.37"></a><span id="l5.37">                                    this.listbox.getNumberOfVisibleRows() - 1;</span>
<a href="#l5.38"></a><span id="l5.38">           // Increment numberOfItemsToDisplay if lastVisibleIndex exceeds the threshold.</span>
<a href="#l5.39"></a><span id="l5.39">           if (lastVisibleIndex &gt;= this.listItems.length - this.kAddMoreItemsThreshold) {</span>
<a href="#l5.40"></a><span id="l5.40">             this.numberOfItemsToDisplay += this.kNumItemsIncrement;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-            this.refresh();</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+            while (this.hasMoreConversations &amp;&amp;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+                   this.listItems.length &lt; this.numberOfItemsToDisplay)</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+              this.pushListItem().build(this.getNextConv());</span>
<a href="#l5.45"></a><span id="l5.45">           }</span>
<a href="#l5.46"></a><span id="l5.46">         ]]&gt;</span>
<a href="#l5.47"></a><span id="l5.47">         &lt;/body&gt;</span>
<a href="#l5.48"></a><span id="l5.48">       &lt;/method&gt;</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+      &lt;method name=&quot;getNextConv&quot;&gt;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+          if (!this.hasMoreConversations)</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+            return null;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+          return this.filteredConvs.getNext()</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+                     .QueryInterface(Components.interfaces.ibIPossibleConversation);</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+</span>
<a href="#l5.61"></a><span id="l5.61">       &lt;!-- Remove observers when closing tab. --&gt;</span>
<a href="#l5.62"></a><span id="l5.62">       &lt;method name=&quot;destroy&quot;&gt;</span>
<a href="#l5.63"></a><span id="l5.63">         &lt;body&gt;</span>
<a href="#l5.64"></a><span id="l5.64">         &lt;![CDATA[</span>
<a href="#l5.65"></a><span id="l5.65">           this.statsService.removeObserver(this);</span>
<a href="#l5.66"></a><span id="l5.66">           this._destroyed = true;</span>
<a href="#l5.67"></a><span id="l5.67">         ]]&gt;</span>
<a href="#l5.68"></a><span id="l5.68">         &lt;/body&gt;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineat">@@ -135,38 +154,35 @@</span>
<a href="#l5.70"></a><span id="l5.70">         &lt;parameter name=&quot;aOtherNewTab&quot;/&gt;</span>
<a href="#l5.71"></a><span id="l5.71">         &lt;body&gt;</span>
<a href="#l5.72"></a><span id="l5.72">         &lt;![CDATA[</span>
<a href="#l5.73"></a><span id="l5.73">           let filterbox = this.filterbox;</span>
<a href="#l5.74"></a><span id="l5.74">           let otherFilterbox = aOtherNewTab.filterbox;</span>
<a href="#l5.75"></a><span id="l5.75">           filterbox.value = otherFilterbox.value;</span>
<a href="#l5.76"></a><span id="l5.76">           filterbox.selectionStart = otherFilterbox.selectionStart;</span>
<a href="#l5.77"></a><span id="l5.77">           filterbox.selectionEnd = otherFilterbox.selectionEnd;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-          const kFieldsToImport = [&quot;contacts&quot;, &quot;filteredConvs&quot;, &quot;contactsById&quot;,</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-                                   &quot;numberOfItemsToDisplay&quot;, &quot;_prevFilterTxt&quot;,</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-                                   &quot;_forceRefresh&quot;, &quot;hasMoreItemsToDisplay&quot;];</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+          const kFieldsToImport = [&quot;filteredConvs&quot;, &quot;numberOfItemsToDisplay&quot;,</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+                                   &quot;_prevFilterTxt&quot;];</span>
<a href="#l5.83"></a><span id="l5.83">           for (let field of kFieldsToImport)</span>
<a href="#l5.84"></a><span id="l5.84">             this[field] = aOtherNewTab[field];</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-          for (let i = 0; i &lt; aOtherNewTab.listItems.length; ++i)</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-            this.pushListItem();</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+          for (let item of aOtherNewTab.listItems)</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+            this.pushListItem().build(item.target);</span>
<a href="#l5.89"></a><span id="l5.89">           this.listbox.selectedIndex = aOtherNewTab.listbox.selectedIndex;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-          this._delayedRefresh();</span>
<a href="#l5.91"></a><span id="l5.91">           this.listbox.scrollToIndex(aOtherNewTab.listbox.getIndexOfFirstVisibleRow());</span>
<a href="#l5.92"></a><span id="l5.92">           this.addListeners();</span>
<a href="#l5.93"></a><span id="l5.93">         ]]&gt;</span>
<a href="#l5.94"></a><span id="l5.94">         &lt;/body&gt;</span>
<a href="#l5.95"></a><span id="l5.95">       &lt;/method&gt;</span>
<a href="#l5.96"></a><span id="l5.96"> </span>
<a href="#l5.97"></a><span id="l5.97">       &lt;!-- This is separated from the constructor because we don't want to init</span>
<a href="#l5.98"></a><span id="l5.98">            when being imported from another window. --&gt;</span>
<a href="#l5.99"></a><span id="l5.99">       &lt;method name=&quot;init&quot;&gt;</span>
<a href="#l5.100"></a><span id="l5.100">         &lt;body&gt;</span>
<a href="#l5.101"></a><span id="l5.101">         &lt;![CDATA[</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-          this.filteredConvs = this.statsService.getFilteredConvs(&quot;&quot;);</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-          this.resetItemsToDisplay();</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+          this._forceRefresh = true;</span>
<a href="#l5.105"></a><span id="l5.105">           this.refresh();</span>
<a href="#l5.106"></a><span id="l5.106">           this.addListeners();</span>
<a href="#l5.107"></a><span id="l5.107">         ]]&gt;</span>
<a href="#l5.108"></a><span id="l5.108">         &lt;/body&gt;</span>
<a href="#l5.109"></a><span id="l5.109">       &lt;/method&gt;</span>
<a href="#l5.110"></a><span id="l5.110"> </span>
<a href="#l5.111"></a><span id="l5.111">       &lt;method name=&quot;addListeners&quot;&gt;</span>
<a href="#l5.112"></a><span id="l5.112">         &lt;body&gt;</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineat">@@ -186,63 +202,54 @@</span>
<a href="#l5.114"></a><span id="l5.114">             return;</span>
<a href="#l5.115"></a><span id="l5.115">           this._pendingRefreshCall = true;</span>
<a href="#l5.116"></a><span id="l5.116">           Services.tm.mainThread.dispatch(this._delayedRefresh.bind(this),</span>
<a href="#l5.117"></a><span id="l5.117">             Components.interfaces.nsIEventTarget.DISPATCH_NORMAL);</span>
<a href="#l5.118"></a><span id="l5.118">         ]]&gt;</span>
<a href="#l5.119"></a><span id="l5.119">         &lt;/body&gt;</span>
<a href="#l5.120"></a><span id="l5.120">       &lt;/method&gt;</span>
<a href="#l5.121"></a><span id="l5.121"> </span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-      &lt;field name=&quot;_prevFilterTxt&quot;&gt;&quot;&quot;&lt;/field&gt;</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+      &lt;field name=&quot;_prevFilterTxt&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.124"></a><span id="l5.124">       &lt;method name=&quot;_delayedRefresh&quot;&gt;</span>
<a href="#l5.125"></a><span id="l5.125">         &lt;body&gt;</span>
<a href="#l5.126"></a><span id="l5.126">         &lt;![CDATA[</span>
<a href="#l5.127"></a><span id="l5.127">           this._pendingRefreshCall = false;</span>
<a href="#l5.128"></a><span id="l5.128">           // Don't do anything if the tab has been removed.</span>
<a href="#l5.129"></a><span id="l5.129">           if (this._destroyed)</span>
<a href="#l5.130"></a><span id="l5.130">             return;</span>
<a href="#l5.131"></a><span id="l5.131">           let filterTxt = this.filterbox.value.toLowerCase();</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-          // Filtering needs to be done only if either the filter string has changed,</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-          // or the stats service's list was updated. _forceRefresh is a field as</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-          // opposed to a parameter because calls to this function are delayed.</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-          if (this._prevFilterTxt != filterTxt || this._forceRefresh) {</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-            this.filteredConvs = this._statsService.getFilteredConvs(filterTxt);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-            // If the filter string has changed, reset number of items to display.</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-            if (this._prevFilterTxt != filterTxt) {</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-              this.resetItemsToDisplay();</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-              this._prevFilterTxt = filterTxt;</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-            }</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+          if (filterTxt == this._prevFilterTxt &amp;&amp; !this._forceRefresh)</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+            return;</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+          this.filteredConvs = this.statsService.getFilteredConvs(filterTxt);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+          if (filterTxt != this._prevFilterTxt) {</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+            this.resetItemsToDisplay();</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+            this._prevFilterTxt = filterTxt;</span>
<a href="#l5.148"></a><span id="l5.148">           }</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-          this._forceRefresh = false;</span>
<a href="#l5.150"></a><span id="l5.150">           let filteredConvs = this.filteredConvs;</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-          if (filteredConvs.length &lt; this.numberOfItemsToDisplay) {</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-            this.numberOfItemsToDisplay = filteredConvs.length;</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-            this.hasMoreItemsToDisplay = false;</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+          let i;</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+          for (i = 0; i &lt; this.numberOfItemsToDisplay &amp;&amp; this.hasMoreConversations; ++i) {</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+            if (i == this.listItems.length)</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+              this.pushListItem();</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+            this.listItems[i].build(this.getNextConv());</span>
<a href="#l5.159"></a><span id="l5.159">           }</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-          // Add/remove list items until we have the number required.</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-          // Then rebuild them all from filteredConvs.</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-          while (this.listItems.length &gt; this.numberOfItemsToDisplay)</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+          // Remove excess items.</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+          while (this.listItems.length &gt; i)</span>
<a href="#l5.165"></a><span id="l5.165">             this.popListItem();</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-          while (this.listItems.length &lt; this.numberOfItemsToDisplay)</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-            this.pushListItem();</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-          for (let i = 0; i &lt; this.listItems.length; ++i)</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-            this.listItems[i].build(filteredConvs[i]);</span>
<a href="#l5.170"></a><span id="l5.170">         ]]&gt;</span>
<a href="#l5.171"></a><span id="l5.171">         &lt;/body&gt;</span>
<a href="#l5.172"></a><span id="l5.172">       &lt;/method&gt;</span>
<a href="#l5.173"></a><span id="l5.173"> </span>
<a href="#l5.174"></a><span id="l5.174">       &lt;method name=&quot;resetItemsToDisplay&quot;&gt;</span>
<a href="#l5.175"></a><span id="l5.175">         &lt;body&gt;</span>
<a href="#l5.176"></a><span id="l5.176">         &lt;![CDATA[</span>
<a href="#l5.177"></a><span id="l5.177">           let listbox = this.listbox;</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-          this.hasMoreItemsToDisplay = this.filteredConvs.length &gt; 0;</span>
<a href="#l5.179"></a><span id="l5.179">           // We need to have a list item so that we can use its height to compute</span>
<a href="#l5.180"></a><span id="l5.180">           // the number of items to display. If we don't have one, we add it,</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineminus">-          // but only if it will be used (i.e. hasMoreItemsToDisplay is true).</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-          if (this.hasMoreItemsToDisplay) {</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+          // but only if it will be used (i.e. this.hasMoreConversations is true).</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+          if (this.hasMoreConversations) {</span>
<a href="#l5.185"></a><span id="l5.185">             if (!listbox.firstChild)</span>
<a href="#l5.186"></a><span id="l5.186">               this.pushListItem();</span>
<a href="#l5.187"></a><span id="l5.187">             // Add enough items to fill the visible area, plus kNumItemsIncrement.</span>
<a href="#l5.188"></a><span id="l5.188">             this.numberOfItemsToDisplay =</span>
<a href="#l5.189"></a><span id="l5.189">               (listbox.clientHeight / listbox.firstChild.clientHeight) + this.kNumItemsIncrement;</span>
<a href="#l5.190"></a><span id="l5.190">           }</span>
<a href="#l5.191"></a><span id="l5.191">           else</span>
<a href="#l5.192"></a><span id="l5.192">             this.numberOfItemsToDisplay = 0;</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineat">@@ -275,16 +282,28 @@</span>
<a href="#l5.194"></a><span id="l5.194">         &lt;body&gt;</span>
<a href="#l5.195"></a><span id="l5.195">         &lt;![CDATA[</span>
<a href="#l5.196"></a><span id="l5.196">           this.listbox.removeChild(this.listbox.lastChild);</span>
<a href="#l5.197"></a><span id="l5.197">           this.listItems.pop();</span>
<a href="#l5.198"></a><span id="l5.198">         ]]&gt;</span>
<a href="#l5.199"></a><span id="l5.199">         &lt;/body&gt;</span>
<a href="#l5.200"></a><span id="l5.200">       &lt;/method&gt;</span>
<a href="#l5.201"></a><span id="l5.201"> </span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+      &lt;method name=&quot;startConversation&quot;&gt;</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+        &lt;parameter name=&quot;aNewtabItem&quot;/&gt;</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+          let conv = aNewtabItem.target.createConversation();</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+          // If it's a new chat, it won't return the conversation. So don't focus it.</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+          if (conv)</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+            Conversations.focusConversation(conv);</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+        ]]&gt;</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+</span>
<a href="#l5.214"></a><span id="l5.214">       &lt;!-- nsIObserver implementation --&gt;</span>
<a href="#l5.215"></a><span id="l5.215">       &lt;method name=&quot;observe&quot;&gt;</span>
<a href="#l5.216"></a><span id="l5.216">         &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l5.217"></a><span id="l5.217">         &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l5.218"></a><span id="l5.218">         &lt;parameter name=&quot;aData&quot;/&gt;</span>
<a href="#l5.219"></a><span id="l5.219">         &lt;body&gt;</span>
<a href="#l5.220"></a><span id="l5.220">         &lt;![CDATA[</span>
<a href="#l5.221"></a><span id="l5.221">           this._forceRefresh = true;</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineat">@@ -345,30 +364,30 @@</span>
<a href="#l5.223"></a><span id="l5.223">       &lt;![CDATA[</span>
<a href="#l5.224"></a><span id="l5.224">         if (!this.listbox.firstChild ||</span>
<a href="#l5.225"></a><span id="l5.225">             (event.keyCode != event.DOM_VK_ENTER &amp;&amp;</span>
<a href="#l5.226"></a><span id="l5.226">              event.keyCode != event.DOM_VK_RETURN))</span>
<a href="#l5.227"></a><span id="l5.227">           return;</span>
<a href="#l5.228"></a><span id="l5.228">         if (!(&quot;Conversations&quot; in window))</span>
<a href="#l5.229"></a><span id="l5.229">           Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l5.230"></a><span id="l5.230">         let item = this.listbox.selectedItem || this.listbox.firstChild;</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineminus">-        Conversations.focusConversation(item.target.createConversation());</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+        this.startConversation(item);</span>
<a href="#l5.233"></a><span id="l5.233">         window.getTabBrowser().removeTab(this.tab);</span>
<a href="#l5.234"></a><span id="l5.234">       ]]&gt;</span>
<a href="#l5.235"></a><span id="l5.235">       &lt;/handler&gt;</span>
<a href="#l5.236"></a><span id="l5.236">     &lt;/handlers&gt;</span>
<a href="#l5.237"></a><span id="l5.237">   &lt;/binding&gt;</span>
<a href="#l5.238"></a><span id="l5.238"> </span>
<a href="#l5.239"></a><span id="l5.239">   &lt;binding id=&quot;newtab-item&quot;</span>
<a href="#l5.240"></a><span id="l5.240">     extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l5.241"></a><span id="l5.241">     &lt;content&gt;</span>
<a href="#l5.242"></a><span id="l5.242">       &lt;xul:hbox flex=&quot;1&quot;&gt;</span>
<a href="#l5.243"></a><span id="l5.243">         &lt;xul:stack class=&quot;buddyStatusIconStack&quot; mousethrough=&quot;always&quot;&gt;</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineminus">-          &lt;xul:image anonid=&quot;buddyIcon&quot; class=&quot;buddyIcon&quot; xbl:inherits=&quot;src=buddyIcon,status&quot;/&gt;</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-          &lt;xul:image anonid=&quot;statusIcon&quot; class=&quot;statusTypeIcon&quot; xbl:inherits=&quot;status&quot;/&gt;</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineplus">+          &lt;xul:image anonid=&quot;buddyIcon&quot; class=&quot;buddyIcon&quot; xbl:inherits=&quot;src=buddyIcon,status,chat&quot;/&gt;</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+          &lt;xul:image anonid=&quot;statusIcon&quot; class=&quot;statusTypeIcon&quot; xbl:inherits=&quot;status,chat&quot;/&gt;</span>
<a href="#l5.248"></a><span id="l5.248">         &lt;/xul:stack&gt;</span>
<a href="#l5.249"></a><span id="l5.249">         &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l5.250"></a><span id="l5.250">           &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l5.251"></a><span id="l5.251">           &lt;xul:hbox&gt;</span>
<a href="#l5.252"></a><span id="l5.252">             &lt;xul:label class=&quot;displayName&quot; flex=&quot;1&quot; crop=&quot;end&quot; xbl:inherits=&quot;value=displayName,status&quot;/&gt;</span>
<a href="#l5.253"></a><span id="l5.253">             &lt;xul:hbox flex=&quot;10000&quot;&gt;</span>
<a href="#l5.254"></a><span id="l5.254">               &lt;xul:spacer flex=&quot;10000&quot;/&gt;</span>
<a href="#l5.255"></a><span id="l5.255">               &lt;xul:image class=&quot;infoIcon&quot; xbl:inherits=&quot;source,selected&quot;/&gt;</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineat">@@ -388,47 +407,56 @@</span>
<a href="#l5.257"></a><span id="l5.257">       &lt;field name=&quot;target&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.258"></a><span id="l5.258"> </span>
<a href="#l5.259"></a><span id="l5.259">       &lt;method name=&quot;build&quot;&gt;</span>
<a href="#l5.260"></a><span id="l5.260">         &lt;parameter name=&quot;aTarget&quot;/&gt;</span>
<a href="#l5.261"></a><span id="l5.261">         &lt;body&gt;</span>
<a href="#l5.262"></a><span id="l5.262">         &lt;![CDATA[</span>
<a href="#l5.263"></a><span id="l5.263">           this.target = aTarget;</span>
<a href="#l5.264"></a><span id="l5.264">           this.setAttribute(&quot;displayName&quot;, aTarget.displayName);</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineminus">-          if (!(&quot;Status&quot; in window))</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineminus">-            Components.utils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;);</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineminus">-          this.setAttribute(&quot;status&quot;, Status.toAttribute(aTarget.statusType));</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineplus">+          let source = aTarget.source;</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineplus">+          this.setAttribute(&quot;source&quot;, source);</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineplus">+          // Could be an existing conversation or a contact.</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineplus">+          if (source != &quot;chat&quot;) {</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineplus">+            if (!(&quot;Status&quot; in window))</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineplus">+              Components.utils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;);</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineplus">+            this.setAttribute(&quot;status&quot;, Status.toAttribute(aTarget.statusType));</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineplus">+          }</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+          // Could be a new chat or an existing chat conversation.</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineplus">+          if (aTarget.isChat)</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+            this.setAttribute(&quot;chat&quot;, true);</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+          else</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+            this.removeAttribute(&quot;chat&quot;);</span>
<a href="#l5.281"></a><span id="l5.281">           let status;</span>
<a href="#l5.282"></a><span id="l5.282">           if (aTarget.isChat)</span>
<a href="#l5.283"></a><span id="l5.283">             status = aTarget.statusText;</span>
<a href="#l5.284"></a><span id="l5.284">           else {</span>
<a href="#l5.285"></a><span id="l5.285">             status = Status.toLabel(aTarget.statusType);</span>
<a href="#l5.286"></a><span id="l5.286">             let statusText = aTarget.statusText;</span>
<a href="#l5.287"></a><span id="l5.287">             if (statusText)</span>
<a href="#l5.288"></a><span id="l5.288">               status += &quot; - &quot; + statusText;</span>
<a href="#l5.289"></a><span id="l5.289">           }</span>
<a href="#l5.290"></a><span id="l5.290">           this.setAttribute(&quot;statusText&quot;, status);</span>
<a href="#l5.291"></a><span id="l5.291">           this.setAttribute(&quot;infoText&quot;, aTarget.infoText);</span>
<a href="#l5.292"></a><span id="l5.292">           this.setAttribute(&quot;protoIcon&quot;, aTarget.account.protocol.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l5.293"></a><span id="l5.293">           this.setAttribute(&quot;buddyIcon&quot;, aTarget.buddyIconFilename);</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineminus">-          this.setAttribute(&quot;source&quot;, aTarget.source);</span>
<a href="#l5.295"></a><span id="l5.295">         ]]&gt;</span>
<a href="#l5.296"></a><span id="l5.296">         &lt;/body&gt;</span>
<a href="#l5.297"></a><span id="l5.297">       &lt;/method&gt;</span>
<a href="#l5.298"></a><span id="l5.298">     &lt;/implementation&gt;</span>
<a href="#l5.299"></a><span id="l5.299"> </span>
<a href="#l5.300"></a><span id="l5.300">     &lt;handlers&gt;</span>
<a href="#l5.301"></a><span id="l5.301">       &lt;handler event=&quot;mouseup&quot;&gt;</span>
<a href="#l5.302"></a><span id="l5.302">       &lt;![CDATA[</span>
<a href="#l5.303"></a><span id="l5.303">         if (event.button == 2) // Don't handle right clicks.</span>
<a href="#l5.304"></a><span id="l5.304">           return;</span>
<a href="#l5.305"></a><span id="l5.305">         let newtab = document.getBindingParent(this);</span>
<a href="#l5.306"></a><span id="l5.306">         if (!(&quot;Conversations&quot; in window))</span>
<a href="#l5.307"></a><span id="l5.307">           Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineminus">-        Conversations.focusConversation(this.target.createConversation());</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineplus">+        newtab.startConversation(this);</span>
<a href="#l5.310"></a><span id="l5.310">         let tabbrowser = window.getTabBrowser();</span>
<a href="#l5.311"></a><span id="l5.311">         if (event.button != 1 &amp;&amp; !event.controlKey &amp;&amp; !event.metaKey)</span>
<a href="#l5.312"></a><span id="l5.312">           tabbrowser.removeTab(newtab.tab);</span>
<a href="#l5.313"></a><span id="l5.313">         else {</span>
<a href="#l5.314"></a><span id="l5.314">           tabbrowser.selectPanel(newtab);</span>
<a href="#l5.315"></a><span id="l5.315">           newtab.listbox.selectedIndex = -1;</span>
<a href="#l5.316"></a><span id="l5.316">           newtab.filterbox.focus();</span>
<a href="#l5.317"></a><span id="l5.317">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/themes/jar.mn</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/themes/jar.mn</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -29,16 +29,17 @@ instantbird.jar:</span>
<a href="#l6.4"></a><span id="l6.4"> 	skin/classic/instantbird/menulist.css</span>
<a href="#l6.5"></a><span id="l6.5"> 	skin/classic/instantbird/menus.css</span>
<a href="#l6.6"></a><span id="l6.6"> 	skin/classic/instantbird/status.css</span>
<a href="#l6.7"></a><span id="l6.7"> *	skin/classic/instantbird/viewlog.css</span>
<a href="#l6.8"></a><span id="l6.8"> 	skin/classic/instantbird/newMessage.png</span>
<a href="#l6.9"></a><span id="l6.9"> 	skin/classic/instantbird/expand.png</span>
<a href="#l6.10"></a><span id="l6.10"> 	skin/classic/instantbird/collapse.png</span>
<a href="#l6.11"></a><span id="l6.11"> 	skin/classic/instantbird/userIcon.png</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+	skin/classic/instantbird/multiUserIcon.png</span>
<a href="#l6.13"></a><span id="l6.13"> #ifdef XP_UNIX</span>
<a href="#l6.14"></a><span id="l6.14"> #ifdef XP_MACOSX</span>
<a href="#l6.15"></a><span id="l6.15"> 	skin/classic/instantbird/tag.png        (tag-mac.png)</span>
<a href="#l6.16"></a><span id="l6.16"> 	skin/classic/instantbird/tag@2x.png     (tag-mac@2x.png)</span>
<a href="#l6.17"></a><span id="l6.17"> 	skin/classic/instantbird/actionicon-tab.png       (actionicon-tab-mac.png)</span>
<a href="#l6.18"></a><span id="l6.18"> 	skin/classic/instantbird/actionicon-tab@2x.png    (actionicon-tab-mac@2x.png)</span>
<a href="#l6.19"></a><span id="l6.19"> #else</span>
<a href="#l6.20"></a><span id="l6.20"> 	skin/classic/instantbird/tag.png    (tag-linux.png)</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -128,16 +129,17 @@ instantbird.jar:</span>
<a href="#l6.22"></a><span id="l6.22"> 	skin/classic/aero/instantbird/menus.css</span>
<a href="#l6.23"></a><span id="l6.23"> *	skin/classic/aero/instantbird/newtab.css</span>
<a href="#l6.24"></a><span id="l6.24"> 	skin/classic/aero/instantbird/status.css</span>
<a href="#l6.25"></a><span id="l6.25"> *	skin/classic/aero/instantbird/viewlog.css</span>
<a href="#l6.26"></a><span id="l6.26"> 	skin/classic/aero/instantbird/newMessage.png</span>
<a href="#l6.27"></a><span id="l6.27"> 	skin/classic/aero/instantbird/expand.png</span>
<a href="#l6.28"></a><span id="l6.28"> 	skin/classic/aero/instantbird/collapse.png</span>
<a href="#l6.29"></a><span id="l6.29"> 	skin/classic/aero/instantbird/userIcon.png</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+	skin/classic/aero/instantbird/multiUserIcon.png</span>
<a href="#l6.31"></a><span id="l6.31"> 	skin/classic/aero/instantbird/newConversation.png</span>
<a href="#l6.32"></a><span id="l6.32"> 	skin/classic/aero/instantbird/tag.png		(tag-aero.png)</span>
<a href="#l6.33"></a><span id="l6.33"> 	skin/classic/aero/instantbird/actionicon-tab.png        (actionicon-tab-win.png)</span>
<a href="#l6.34"></a><span id="l6.34"> 	skin/classic/aero/instantbird/preferences/Options.png        (preferences-winstripe/Options-aero.png)</span>
<a href="#l6.35"></a><span id="l6.35"> 	skin/classic/aero/instantbird/preferences/alwaysAsk.png      (preferences-winstripe/alwaysAsk-aero.png)</span>
<a href="#l6.36"></a><span id="l6.36"> 	skin/classic/aero/instantbird/preferences/application.png    (preferences-winstripe/application-aero.png)</span>
<a href="#l6.37"></a><span id="l6.37"> 	skin/classic/aero/instantbird/preferences/applications.css   (preferences-winstripe/applications.css)</span>
<a href="#l6.38"></a><span id="l6.38"> 	skin/classic/aero/instantbird/preferences/preferences.css    (preferences-winstripe/preferences.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..e067fc69cb3d9aadd8f7c3d708d11b3e3d6e8b1f</span>
<a href="#l7.3"></a><span id="l7.3">GIT binary patch
literal 3548
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
WoB0HEz;_4$0000&lt;MNUMnLSTZ!Vy9mK</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/themes/newtab.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/themes/newtab.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -62,16 +62,19 @@</span>
<a href="#l8.4"></a><span id="l8.4">   max-height: 16px;</span>
<a href="#l8.5"></a><span id="l8.5">   max-width: 16px;</span>
<a href="#l8.6"></a><span id="l8.6"> }</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> .infoIcon[source=&quot;contact&quot;] {</span>
<a href="#l8.9"></a><span id="l8.9">   list-style-image: url(&quot;chrome://instantbird/skin/tag.png&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+.infoIcon[source=&quot;chat&quot;] {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  list-style-image: url(&quot;chrome://chat/skin/chat-16.png&quot;);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+}</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16"> .infoIcon[source=&quot;existing&quot;] {</span>
<a href="#l8.17"></a><span id="l8.17">   list-style-image: url(&quot;chrome://instantbird/skin/actionicon-tab.png&quot;);</span>
<a href="#l8.18"></a><span id="l8.18">   padding: 3px 0 2px;</span>
<a href="#l8.19"></a><span id="l8.19"> %ifndef XP_LINUX</span>
<a href="#l8.20"></a><span id="l8.20">   -moz-image-region: rect(0, 16px, 11px, 0);</span>
<a href="#l8.21"></a><span id="l8.21"> }</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23" class="difflineat">@@ -110,23 +113,31 @@</span>
<a href="#l8.24"></a><span id="l8.24"> }</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26"> .buddyIcon[src=&quot;&quot;] {</span>
<a href="#l8.27"></a><span id="l8.27">   background-image: url(&quot;chrome://instantbird/skin/userIcon.png&quot;);</span>
<a href="#l8.28"></a><span id="l8.28">   background-size: contain;</span>
<a href="#l8.29"></a><span id="l8.29">   background-repeat: no-repeat;</span>
<a href="#l8.30"></a><span id="l8.30"> }</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+.buddyIcon[src=&quot;&quot;][chat] {</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+  background-image: url(&quot;chrome://instantbird/skin/multiUserIcon.png&quot;);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+}</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+</span>
<a href="#l8.36"></a><span id="l8.36"> .statusTypeIcon {</span>
<a href="#l8.37"></a><span id="l8.37">   margin-top: 32px;</span>
<a href="#l8.38"></a><span id="l8.38">   margin-left: 32px;</span>
<a href="#l8.39"></a><span id="l8.39">   width: 16px;</span>
<a href="#l8.40"></a><span id="l8.40">   height: 16px;</span>
<a href="#l8.41"></a><span id="l8.41"> }</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+.statusTypeIcon[chat] {</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+  list-style-image: none !important;</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+}</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+</span>
<a href="#l8.47"></a><span id="l8.47"> .protoIcon {</span>
<a href="#l8.48"></a><span id="l8.48">   width: 16px;</span>
<a href="#l8.49"></a><span id="l8.49">   height: 16px;</span>
<a href="#l8.50"></a><span id="l8.50">   max-width: 16px;</span>
<a href="#l8.51"></a><span id="l8.51">   max-height: 16px;</span>
<a href="#l8.52"></a><span id="l8.52">   margin-right: 0px;</span>
<a href="#l8.53"></a><span id="l8.53"> }</span>
<a href="#l8.54"></a><span id="l8.54"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

