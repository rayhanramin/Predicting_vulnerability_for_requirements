<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 16029:937875025e76167791b0ef3448c5d3c2728c1563</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 937875025e76167791b0ef3448c5d3c2728c1563" />
<meta property="og:url" content="/comm-central/rev/937875025e76167791b0ef3448c5d3c2728c1563" />
<meta property="og:description" content="Bug 946279 - Implement autotagging of feed &lt;category&gt; tags. r=mkmelin, ui-r=bwinton" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 937875025e76167791b0ef3448c5d3c2728c1563 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/937875025e76167791b0ef3448c5d3c2728c1563">shortlog</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/937875025e76167791b0ef3448c5d3c2728c1563">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563">files</a> |
changeset |
<a href="/comm-central/raw-rev/937875025e76167791b0ef3448c5d3c2728c1563">raw</a>  | <a href="/comm-central/archive/937875025e76167791b0ef3448c5d3c2728c1563.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=946279">Bug 946279</a> - Implement autotagging of feed &lt;category&gt; tags. r=mkmelin, ui-r=bwinton
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#108;&#116;&#97;&#56;&#56;</td></tr>
<tr><td></td><td class="date age">Tue, 15 Apr 2014 09:28:37 -0600</td></tr>

<tr>
 <td>changeset 16029</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/937875025e76167791b0ef3448c5d3c2728c1563">937875025e76167791b0ef3448c5d3c2728c1563</a></td>
</tr>



<tr>
<td>parent 16028</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a3378f94e2605cfdf46d36e2a7298979b21a98c0">a3378f94e2605cfdf46d36e2a7298979b21a98c0</a>
</td>
</tr>

<tr>
<td>child 16030</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e52da7ad68d18e2420521f26a25e32dcbe566ba7">e52da7ad68d18e2420521f26a25e32dcbe566ba7</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=937875025e76167791b0ef3448c5d3c2728c1563">10036</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 16 Apr 2014 14:16:40 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a71ece472c8a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a71ece472c8a355ade973e50cce558acb498916e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a71ece472c8a355ade973e50cce558acb498916e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a71ece472c8a355ade973e50cce558acb498916e&newProject=comm-central&newRevision=937875025e76167791b0ef3448c5d3c2728c1563&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a71ece472c8a355ade973e50cce558acb498916e&newProject=comm-central&newRevision=937875025e76167791b0ef3448c5d3c2728c1563&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a71ece472c8a355ade973e50cce558acb498916e&newProject=comm-central&newRevision=937875025e76167791b0ef3448c5d3c2728c1563&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=946279">946279</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=946279">Bug 946279</a> - Implement autotagging of feed &lt;category&gt; tags. r=mkmelin, ui-r=bwinton</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/Feed.js">mailnews/extensions/newsblog/content/Feed.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/Feed.js">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/Feed.js">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/Feed.js">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/Feed.js">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/Feed.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedItem.js">mailnews/extensions/newsblog/content/FeedItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedItem.js">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedItem.js">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedItem.js">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedItem.js">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedItem.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedUtils.jsm">mailnews/extensions/newsblog/content/FeedUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedUtils.jsm">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedUtils.jsm">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedUtils.jsm">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedUtils.jsm">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/FeedUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.js">mailnews/extensions/newsblog/content/am-newsblog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.js">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.js">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.js">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.js">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.xul">mailnews/extensions/newsblog/content/am-newsblog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.xul">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.xul">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.xul">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.xul">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/am-newsblog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-parser.js">mailnews/extensions/newsblog/content/feed-parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-parser.js">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-parser.js">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-parser.js">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-parser.js">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-parser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.js">mailnews/extensions/newsblog/content/feed-subscriptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.js">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.js">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.js">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.js">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.xul">mailnews/extensions/newsblog/content/feed-subscriptions.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.xul">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.xul">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.xul">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.xul">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/content/feed-subscriptions.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/js/newsblog.js">mailnews/extensions/newsblog/js/newsblog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/js/newsblog.js">file</a> |
<a href="/comm-central/annotate/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/js/newsblog.js">annotate</a> |
<a href="/comm-central/diff/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/js/newsblog.js">diff</a> |
<a href="/comm-central/comparison/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/js/newsblog.js">comparison</a> |
<a href="/comm-central/log/937875025e76167791b0ef3448c5d3c2728c1563/mailnews/extensions/newsblog/js/newsblog.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger-newsblog/feed-subscriptions.dtd</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -14,16 +14,22 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;!ENTITY feedLocation.placeholder    &quot;Enter a valid feed url to Add&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> &lt;!ENTITY feedFolder.label            &quot;Store Articles in:&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> &lt;!ENTITY feedFolder.accesskey        &quot;S&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> &lt;!ENTITY quickMode.label             &quot;Show the article summary instead of loading the web page&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;!ENTITY quickMode.accesskey         &quot;h&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+&lt;!ENTITY autotagEnable.label         &quot;Automatically create tags from feed &amp;lt;category&amp;gt; names&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+&lt;!ENTITY autotagEnable.accesskey     &quot;c&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+&lt;!ENTITY autotagUsePrefix.label      &quot;Prefix tags with:&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+&lt;!ENTITY autotagUsePrefix.accesskey  &quot;P&quot;&gt;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+&lt;!ENTITY autoTagPrefix.placeholder   &quot;Enter a tag prefix&quot;&gt;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;!ENTITY locationValidate.label      &quot;Validate&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19"> &lt;!ENTITY validateText.label          &quot;Check validation and retrieve a valid url.&quot;&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21"> &lt;!ENTITY button.addFeed.label        &quot;Add&quot;&gt;</span>
<a href="#l1.22"></a><span id="l1.22"> &lt;!ENTITY button.addFeed.accesskey    &quot;A&quot;&gt;</span>
<a href="#l1.23"></a><span id="l1.23"> &lt;!ENTITY button.editFeed.label       &quot;Update&quot;&gt;</span>
<a href="#l1.24"></a><span id="l1.24"> &lt;!ENTITY button.editFeed.accesskey   &quot;U&quot;&gt;</span>
<a href="#l1.25"></a><span id="l1.25"> &lt;!ENTITY button.removeFeed.label     &quot;Remove&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/Feed.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/Feed.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -331,16 +331,48 @@ Feed.prototype =</span>
<a href="#l2.4"></a><span id="l2.4">     if (old_quickMode)</span>
<a href="#l2.5"></a><span id="l2.5">       ds.Change(this.resource, FeedUtils.FZ_QUICKMODE,</span>
<a href="#l2.6"></a><span id="l2.6">                 old_quickMode, aNewQuickMode);</span>
<a href="#l2.7"></a><span id="l2.7">     else</span>
<a href="#l2.8"></a><span id="l2.8">       ds.Assert(this.resource, FeedUtils.FZ_QUICKMODE,</span>
<a href="#l2.9"></a><span id="l2.9">                 aNewQuickMode, true);</span>
<a href="#l2.10"></a><span id="l2.10">   },</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  get options ()</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    let options = ds.GetTarget(this.resource, FeedUtils.FZ_OPTIONS, true);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    if (options)</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+      return JSON.parse(options.QueryInterface(Ci.nsIRDFLiteral).Value);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    return null;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  },</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+  set options (aOptions)</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+  {</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+    let newOptions = aOptions ? FeedUtils.newOptions(aOptions) :</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+                                FeedUtils._optionsDefault;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+    let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+    newOptions = FeedUtils.rdf.GetLiteral(JSON.stringify(newOptions));</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    let oldOptions = ds.GetTarget(this.resource, FeedUtils.FZ_OPTIONS, true);</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+    if (oldOptions)</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+      ds.Change(this.resource, FeedUtils.FZ_OPTIONS, oldOptions, newOptions);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+    else</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      ds.Assert(this.resource, FeedUtils.FZ_OPTIONS, newOptions, true);</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+  },</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+  categoryPrefs: function ()</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+  {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+    let categoryPrefsAcct = FeedUtils.getOptionsAcct(this.server).category;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+    if (!this.options)</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+      return categoryPrefsAcct;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+    return this.options.category;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  },</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+</span>
<a href="#l2.44"></a><span id="l2.44">   get link ()</span>
<a href="#l2.45"></a><span id="l2.45">   {</span>
<a href="#l2.46"></a><span id="l2.46">     let ds = FeedUtils.getSubscriptionsDS(this.server);</span>
<a href="#l2.47"></a><span id="l2.47">     let link = ds.GetTarget(this.resource, FeedUtils.RSS_LINK, true);</span>
<a href="#l2.48"></a><span id="l2.48">     if (link)</span>
<a href="#l2.49"></a><span id="l2.49">       link = link.QueryInterface(Ci.nsIRDFLiteral).Value;</span>
<a href="#l2.50"></a><span id="l2.50"> </span>
<a href="#l2.51"></a><span id="l2.51">     return link;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/FeedItem.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/FeedItem.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -19,16 +19,17 @@ FeedItem.prototype =</span>
<a href="#l3.4"></a><span id="l3.4">   id: null,</span>
<a href="#l3.5"></a><span id="l3.5">   feed: null,</span>
<a href="#l3.6"></a><span id="l3.6">   description: null,</span>
<a href="#l3.7"></a><span id="l3.7">   content: null,</span>
<a href="#l3.8"></a><span id="l3.8">   enclosures: [],</span>
<a href="#l3.9"></a><span id="l3.9">   title: null,</span>
<a href="#l3.10"></a><span id="l3.10">   author: &quot;anonymous&quot;,</span>
<a href="#l3.11"></a><span id="l3.11">   inReplyTo: &quot;&quot;,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  keywords: [],</span>
<a href="#l3.13"></a><span id="l3.13">   mURL: null,</span>
<a href="#l3.14"></a><span id="l3.14">   characterSet: &quot;UTF-8&quot;,</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">   ENCLOSURE_BOUNDARY_PREFIX: &quot;--------------&quot;, // 14 dashes</span>
<a href="#l3.17"></a><span id="l3.17">   ENCLOSURE_HEADER_BOUNDARY_PREFIX: &quot;------------&quot;, // 12 dashes</span>
<a href="#l3.18"></a><span id="l3.18">   MESSAGE_TEMPLATE: '\n' +</span>
<a href="#l3.19"></a><span id="l3.19">     '&lt;html&gt;\n' +</span>
<a href="#l3.20"></a><span id="l3.20">     '  &lt;head&gt;\n' +</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -282,16 +283,43 @@ FeedItem.prototype =</span>
<a href="#l3.22"></a><span id="l3.22">     if (this.mDate.search(/^\d\d\d\d/) != -1)</span>
<a href="#l3.23"></a><span id="l3.23">       this.mDate = new Date(this.mDate).toUTCString();</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">     // If there is an inreplyto value, create the headers.</span>
<a href="#l3.26"></a><span id="l3.26">     let inreplytoHdrsStr = this.inReplyTo ?</span>
<a href="#l3.27"></a><span id="l3.27">       (&quot;References: &quot; + this.inReplyTo + &quot;\n&quot; +</span>
<a href="#l3.28"></a><span id="l3.28">        &quot;In-Reply-To: &quot; + this.inReplyTo + &quot;\n&quot;) : &quot;&quot;;</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+    // If there are keywords (categories), create the headers. In the case of</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+    // a longer than RFC5322 recommended line length, create multiple folded</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    // lines (easier to parse than multiple Keywords headers).</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+    let keywordsStr = &quot;&quot;;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    if (this.keywords.length)</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+    {</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+      let HEADER = &quot;Keywords: &quot;;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+      let MAXLEN = 78;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+      keywordsStr = HEADER;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+      let keyword;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+      let keywords = [].concat(this.keywords);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+      let lines = [];</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+      while (keywords.length)</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+      {</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+        keyword = keywords.shift();</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+        if (keywordsStr.length + keyword.length &gt; MAXLEN)</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+        {</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+          lines.push(keywordsStr)</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+          keywordsStr = &quot; &quot;.repeat(HEADER.length);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+        }</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+        keywordsStr += keyword + &quot;,&quot;;</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+      }</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+      keywordsStr = keywordsStr.replace(/,$/,&quot;\n&quot;);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+      lines.push(keywordsStr)</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+      keywordsStr = lines.join(&quot;\n&quot;);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+    }</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+</span>
<a href="#l3.57"></a><span id="l3.57">     // Escape occurrences of &quot;From &quot; at the beginning of lines of</span>
<a href="#l3.58"></a><span id="l3.58">     // content per the mbox standard, since &quot;From &quot; denotes a new</span>
<a href="#l3.59"></a><span id="l3.59">     // message, and add a line break so we know the last line has one.</span>
<a href="#l3.60"></a><span id="l3.60">     this.content = this.content.replace(/([\r\n]+)(&gt;*From )/g, &quot;$1&gt;$2&quot;);</span>
<a href="#l3.61"></a><span id="l3.61">     this.content += &quot;\n&quot;;</span>
<a href="#l3.62"></a><span id="l3.62"> </span>
<a href="#l3.63"></a><span id="l3.63">     // The opening line of the message, mandated by standards to start</span>
<a href="#l3.64"></a><span id="l3.64">     // with &quot;From &quot;.  It's useful to construct this separately because</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineat">@@ -308,16 +336,17 @@ FeedItem.prototype =</span>
<a href="#l3.66"></a><span id="l3.66">       'X-Mozilla-Keys: ' + &quot; &quot;.repeat(80) + '\n' +</span>
<a href="#l3.67"></a><span id="l3.67">       'Received: by localhost; ' + FeedUtils.getValidRFC5322Date() + '\n' +</span>
<a href="#l3.68"></a><span id="l3.68">       'Date: ' + this.mDate + '\n' +</span>
<a href="#l3.69"></a><span id="l3.69">       'Message-Id: ' + this.normalizeMessageID(this.id) + '\n' +</span>
<a href="#l3.70"></a><span id="l3.70">       'From: ' + this.author + '\n' +</span>
<a href="#l3.71"></a><span id="l3.71">       'MIME-Version: 1.0\n' +</span>
<a href="#l3.72"></a><span id="l3.72">       'Subject: ' + this.title + '\n' +</span>
<a href="#l3.73"></a><span id="l3.73">       inreplytoHdrsStr +</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+      keywordsStr +</span>
<a href="#l3.75"></a><span id="l3.75">       'Content-Transfer-Encoding: 8bit\n' +</span>
<a href="#l3.76"></a><span id="l3.76">       'Content-Base: ' + this.mURL + '\n';</span>
<a href="#l3.77"></a><span id="l3.77"> </span>
<a href="#l3.78"></a><span id="l3.78">     if (this.enclosures.length)</span>
<a href="#l3.79"></a><span id="l3.79">     {</span>
<a href="#l3.80"></a><span id="l3.80">       let boundaryID = source.length;</span>
<a href="#l3.81"></a><span id="l3.81">       source += 'Content-Type: multipart/mixed; boundary=&quot;' +</span>
<a href="#l3.82"></a><span id="l3.82">                 this.ENCLOSURE_HEADER_BOUNDARY_PREFIX + boundaryID + '&quot;' + '\n\n' +</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineat">@@ -344,16 +373,56 @@ FeedItem.prototype =</span>
<a href="#l3.84"></a><span id="l3.84">     let folder = this.feed.folder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l3.85"></a><span id="l3.85">     let msgFolder = folder.QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l3.86"></a><span id="l3.86">     msgFolder.gettingNewMessages = true;</span>
<a href="#l3.87"></a><span id="l3.87">     // Source is a unicode string, we want to save a char * string in</span>
<a href="#l3.88"></a><span id="l3.88">     // the original charset. So convert back.</span>
<a href="#l3.89"></a><span id="l3.89">     let msgDBHdr = folder.addMessage(this.mUnicodeConverter.ConvertFromUnicode(source));</span>
<a href="#l3.90"></a><span id="l3.90">     msgDBHdr.OrFlags(Ci.nsMsgMessageFlags.FeedMsg);</span>
<a href="#l3.91"></a><span id="l3.91">     msgFolder.gettingNewMessages = false;</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+    this.tagItem(msgDBHdr, this.keywords);</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+  },</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+/**</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+ * Autotag messages.</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+ *</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+ * @param  nsIMsgDBHdr aMsgDBHdr - message to tag</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+ * @param  array aKeywords       - keywords (tags)</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+ */</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+  tagItem: function(aMsgDBHdr, aKeywords)</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+  {</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+    let categoryPrefs = this.feed.categoryPrefs();</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+    if (!aKeywords.length || !categoryPrefs.enabled)</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+      return;</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+    let msgArray = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+    msgArray.appendElement(aMsgDBHdr, false);</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+    let prefix = categoryPrefs.prefixEnabled ? categoryPrefs.prefix : &quot;&quot;;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+    let rtl = Services.prefs.getIntPref(&quot;bidi.direction&quot;) == 2;</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+    let keys = [];</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+    for (let keyword of aKeywords)</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+    {</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+      keyword = rtl ? keyword + prefix : prefix + keyword;</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+      let keyForTag = MailServices.tags.getKeyForTag(keyword);</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+      if (!keyForTag)</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+      {</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+        // Add the tag if it doesn't exist.</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+        MailServices.tags.addTag(keyword, &quot;&quot;, FeedUtils.AUTOTAG);</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+        keyForTag = MailServices.tags.getKeyForTag(keyword);</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+      }</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+      // Add the tag key to the keys array.</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+      keys.push(keyForTag);</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+    }</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+    if (keys.length)</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+      // Add the keys to the message.</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+      aMsgDBHdr.folder.addKeywordsToMessages(msgArray, keys.join(&quot; &quot;));</span>
<a href="#l3.132"></a><span id="l3.132">   },</span>
<a href="#l3.133"></a><span id="l3.133"> </span>
<a href="#l3.134"></a><span id="l3.134">   htmlEscape: function(s)</span>
<a href="#l3.135"></a><span id="l3.135">   {</span>
<a href="#l3.136"></a><span id="l3.136">     s = s.replace(/&amp;/g, &quot;&amp;amp;&quot;);</span>
<a href="#l3.137"></a><span id="l3.137">     s = s.replace(/&gt;/g, &quot;&amp;gt;&quot;);</span>
<a href="#l3.138"></a><span id="l3.138">     s = s.replace(/&lt;/g, &quot;&amp;lt;&quot;);</span>
<a href="#l3.139"></a><span id="l3.139">     s = s.replace(/'/g, &quot;&amp;#39;&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/FeedUtils.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/FeedUtils.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -55,16 +55,17 @@ var FeedUtils = {</span>
<a href="#l4.4"></a><span id="l4.4">   FZ_ITEM_NS: &quot;urn:feeditem:&quot;,</span>
<a href="#l4.5"></a><span id="l4.5">   get FZ_ROOT()       { return this.rdf.GetResource(this.FZ_NS + &quot;root&quot;) },</span>
<a href="#l4.6"></a><span id="l4.6">   get FZ_FEEDS()      { return this.rdf.GetResource(this.FZ_NS + &quot;feeds&quot;) },</span>
<a href="#l4.7"></a><span id="l4.7">   get FZ_FEED()       { return this.rdf.GetResource(this.FZ_NS + &quot;feed&quot;) },</span>
<a href="#l4.8"></a><span id="l4.8">   get FZ_QUICKMODE()  { return this.rdf.GetResource(this.FZ_NS + &quot;quickMode&quot;) },</span>
<a href="#l4.9"></a><span id="l4.9">   get FZ_DESTFOLDER() { return this.rdf.GetResource(this.FZ_NS + &quot;destFolder&quot;) },</span>
<a href="#l4.10"></a><span id="l4.10">   get FZ_STORED()     { return this.rdf.GetResource(this.FZ_NS + &quot;stored&quot;) },</span>
<a href="#l4.11"></a><span id="l4.11">   get FZ_VALID()      { return this.rdf.GetResource(this.FZ_NS + &quot;valid&quot;) },</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  get FZ_OPTIONS()    { return this.rdf.GetResource(this.FZ_NS + &quot;options&quot;); },</span>
<a href="#l4.13"></a><span id="l4.13">   get FZ_LAST_SEEN_TIMESTAMP() {</span>
<a href="#l4.14"></a><span id="l4.14">     return this.rdf.GetResource(this.FZ_NS + &quot;last-seen-timestamp&quot;);</span>
<a href="#l4.15"></a><span id="l4.15">   },</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">   get RDF_LITERAL_TRUE()  { return this.rdf.GetLiteral(&quot;true&quot;) },</span>
<a href="#l4.18"></a><span id="l4.18">   get RDF_LITERAL_FALSE() { return this.rdf.GetLiteral(&quot;false&quot;) },</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">   // Atom constants</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -85,16 +86,17 @@ var FeedUtils = {</span>
<a href="#l4.22"></a><span id="l4.22">   kNewsBlogRequestFailure: 2,</span>
<a href="#l4.23"></a><span id="l4.23">   kNewsBlogFeedIsBusy: 3,</span>
<a href="#l4.24"></a><span id="l4.24">   // There are no new articles for this feed</span>
<a href="#l4.25"></a><span id="l4.25">   kNewsBlogNoNewItems: 4,</span>
<a href="#l4.26"></a><span id="l4.26">   kNewsBlogCancel: 5,</span>
<a href="#l4.27"></a><span id="l4.27">   kNewsBlogFileError: 6,</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">   CANCEL_REQUESTED: false,</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  AUTOTAG: &quot;~AUTOTAG&quot;,</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32"> /**</span>
<a href="#l4.33"></a><span id="l4.33">  * Get all rss account servers rootFolders.</span>
<a href="#l4.34"></a><span id="l4.34">  * </span>
<a href="#l4.35"></a><span id="l4.35">  * @return array of nsIMsgIncomingServer (empty array if none).</span>
<a href="#l4.36"></a><span id="l4.36">  */</span>
<a href="#l4.37"></a><span id="l4.37">   getAllRssServerRootFolders: function() {</span>
<a href="#l4.38"></a><span id="l4.38">     let rssRootFolders = [];</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -609,18 +611,20 @@ var FeedUtils = {</span>
<a href="#l4.40"></a><span id="l4.40">                                   .replace(/[\x00-\x1F]+/g, &quot;&quot;)</span>
<a href="#l4.41"></a><span id="l4.41">                                   .replace(/[*|\\\/:&lt;&gt;?&quot;]+/g, &quot;&quot;)</span>
<a href="#l4.42"></a><span id="l4.42">                                   .replace(/[\.]+/g, &quot;&quot;)</span>
<a href="#l4.43"></a><span id="l4.43">                                   .trim();</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">     // Prefix with __ if name is:</span>
<a href="#l4.46"></a><span id="l4.46">     // 1) a reserved win filename.</span>
<a href="#l4.47"></a><span id="l4.47">     // 2) an undeletable/unrenameable special folder name (bug 259184).</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-    if (folderName.toUpperCase().match(/COM\d|LPT\d|CON|PRN|AUX|NUL|CLOCK\$/) ||</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-        folderName.toUpperCase().match(/INBOX|OUTBOX|UNSENT MESSAGES|TRASH/))</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    if (folderName.toUpperCase()</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+                  .match(/^COM\d$|^LPT\d$|^CON$|PRN$|^AUX$|^NUL$|^CLOCK\$/) ||</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+        folderName.toUpperCase()</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+                  .match(/^INBOX$|^OUTBOX$|^UNSENT MESSAGES$|^TRASH$/))</span>
<a href="#l4.54"></a><span id="l4.54">       folderName = &quot;__&quot; + folderName;</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56">     // Use a default if no name is found.</span>
<a href="#l4.57"></a><span id="l4.57">     if (!folderName)</span>
<a href="#l4.58"></a><span id="l4.58">       folderName = aDefaultName;</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60">     if (!aUnique)</span>
<a href="#l4.61"></a><span id="l4.61">       return folderName;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineat">@@ -631,16 +635,60 @@ var FeedUtils = {</span>
<a href="#l4.63"></a><span id="l4.63">     while (aParentFolder.containsChildNamed(folderName))</span>
<a href="#l4.64"></a><span id="l4.64">     {</span>
<a href="#l4.65"></a><span id="l4.65">       folderName = folderNameBase + &quot;-&quot; + i++;</span>
<a href="#l4.66"></a><span id="l4.66">     }</span>
<a href="#l4.67"></a><span id="l4.67"> </span>
<a href="#l4.68"></a><span id="l4.68">     return folderName;</span>
<a href="#l4.69"></a><span id="l4.69">   },</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+/**</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+ * This object will contain all feed specific properties.</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+ */</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+  _optionsDefault: {</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+    version: 1,</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+    // Autotag and &lt;category&gt; handling options.</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+    category: {</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+      enabled: false,</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+      prefixEnabled: false,</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+      prefix: null,</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+    }</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+  },</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+  get optionsTemplate()</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+  {</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+    // Copy the object.</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+    return JSON.parse(JSON.stringify(this._optionsDefault));</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+  },</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+  getOptionsAcct: function(aServer)</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+  {</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+    let optionsAcctPref = &quot;mail.server.&quot; + aServer.key + &quot;.feed_options&quot;;</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+    try {</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+      return JSON.parse(Services.prefs.getCharPref(optionsAcctPref));</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+    }</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+    catch (ex) {</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+      this.setOptionsAcct(aServer, this._optionsDefault);</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+      return JSON.parse(Services.prefs.getCharPref(optionsAcctPref));</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+    }</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+  },</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+  setOptionsAcct: function(aServer, aOptions)</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+  {</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+    let optionsAcctPref = &quot;mail.server.&quot; + aServer.key + &quot;.feed_options&quot;;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+    let newOptions = this.newOptions(aOptions);</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+    Services.prefs.setCharPref(optionsAcctPref, JSON.stringify(newOptions));</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+  },</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+  newOptions: function(aOptions)</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+  {</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+    // TODO: Clean options, so that only keys in the active template are stored.</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+    return aOptions;</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+  },</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+</span>
<a href="#l4.115"></a><span id="l4.115">   getSubscriptionsDS: function(aServer) {</span>
<a href="#l4.116"></a><span id="l4.116">     if (this[aServer.serverURI] &amp;&amp; this[aServer.serverURI][&quot;FeedsDS&quot;])</span>
<a href="#l4.117"></a><span id="l4.117">       return this[aServer.serverURI][&quot;FeedsDS&quot;];</span>
<a href="#l4.118"></a><span id="l4.118"> </span>
<a href="#l4.119"></a><span id="l4.119">     let file = this.getSubscriptionsFile(aServer);</span>
<a href="#l4.120"></a><span id="l4.120">     let url = Services.io.getProtocolHandler(&quot;file&quot;).</span>
<a href="#l4.121"></a><span id="l4.121">                           QueryInterface(Ci.nsIFileProtocolHandler).</span>
<a href="#l4.122"></a><span id="l4.122">                           getURLSpecFromFile(file);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/am-newsblog.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/am-newsblog.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,14 +1,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l5.5"></a><span id="l5.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-var gServer;</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+Components.utils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+var gServer, autotagEnable, autotagUsePrefix, autotagPrefix;</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> function onInit(aPageId, aServerId)</span>
<a href="#l5.15"></a><span id="l5.15"> {</span>
<a href="#l5.16"></a><span id="l5.16">   var accountName = document.getElementById(&quot;server.prettyName&quot;);</span>
<a href="#l5.17"></a><span id="l5.17">   var title = document.getElementById(&quot;am-newsblog-title&quot;);</span>
<a href="#l5.18"></a><span id="l5.18">   var defaultTitle = title.getAttribute(&quot;defaultTitle&quot;);</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">   var titleValue;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -16,14 +18,46 @@ function onInit(aPageId, aServerId)</span>
<a href="#l5.22"></a><span id="l5.22">     titleValue = defaultTitle + &quot; - &lt;&quot; + accountName.value + &quot;&gt;&quot;;</span>
<a href="#l5.23"></a><span id="l5.23">   else</span>
<a href="#l5.24"></a><span id="l5.24">     titleValue = defaultTitle;</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">   title.setAttribute(&quot;title&quot;, titleValue);</span>
<a href="#l5.27"></a><span id="l5.27">   document.title = titleValue;</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">   onCheckItem(&quot;server.biffMinutes&quot;, [&quot;server.doBiff&quot;]);</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+  autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+  autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+  let categoryPrefsAcct = FeedUtils.getOptionsAcct(gServer).category;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  autotagEnable.checked = categoryPrefsAcct.enabled;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+  autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  autotagUsePrefix.checked = categoryPrefsAcct.prefixEnabled;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+  autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+  autotagPrefix.value = categoryPrefsAcct.prefix;</span>
<a href="#l5.41"></a><span id="l5.41"> }</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43"> function onPreInit(account, accountValues)</span>
<a href="#l5.44"></a><span id="l5.44"> {</span>
<a href="#l5.45"></a><span id="l5.45">   gServer = account.incomingServer;</span>
<a href="#l5.46"></a><span id="l5.46"> }</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+function setCategoryPrefs(aNode)</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+{</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+  let options =  FeedUtils.getOptionsAcct(gServer);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  switch (aNode.id) {</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+    case &quot;autotagEnable&quot;:</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+      options.category.enabled = aNode.checked;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+      autotagUsePrefix.disabled = !aNode.checked;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+      autotagPrefix.disabled = !aNode.checked || !autotagUsePrefix.checked;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+      break;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+    case &quot;autotagUsePrefix&quot;:</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+      options.category.prefixEnabled = aNode.checked;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+      autotagPrefix.disabled = aNode.disabled || !aNode.checked;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+      break;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+    case &quot;autotagPrefix&quot;:</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+      options.category.prefix = aNode.value;</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+      break;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+  }</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+  FeedUtils.setOptionsAcct(gServer, options)</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/am-newsblog.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/am-newsblog.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,21 +1,24 @@</span>
<a href="#l6.4"></a><span id="l6.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l6.5"></a><span id="l6.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> &lt;!DOCTYPE page [</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-&lt;!ENTITY % newsblogDTD SYSTEM &quot;chrome://messenger-newsblog/locale/am-newsblog.dtd&quot; &gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+&lt;!ENTITY %         newsblogDTD SYSTEM &quot;chrome://messenger-newsblog/locale/am-newsblog.dtd&quot; &gt;</span>
<a href="#l6.14"></a><span id="l6.14"> %newsblogDTD;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-&lt;!ENTITY % accountNoIdentDTD SYSTEM &quot;chrome://messenger/locale/am-serverwithnoidentities.dtd&quot; &gt;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+&lt;!ENTITY %             feedDTD SYSTEM &quot;chrome://messenger-newsblog/locale/feed-subscriptions.dtd&quot; &gt;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+%feedDTD;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+&lt;!ENTITY %   accountNoIdentDTD SYSTEM &quot;chrome://messenger/locale/am-serverwithnoidentities.dtd&quot; &gt;</span>
<a href="#l6.19"></a><span id="l6.19"> %accountNoIdentDTD;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-&lt;!ENTITY % accountServerTopDTD SYSTEM &quot;chrome://messenger/locale/am-server-top.dtd&quot;&gt;%accountServerTopDTD;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+&lt;!ENTITY % accountServerTopDTD SYSTEM &quot;chrome://messenger/locale/am-server-top.dtd&quot;&gt;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+%accountServerTopDTD;</span>
<a href="#l6.23"></a><span id="l6.23"> ]&gt;</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l6.26"></a><span id="l6.26">       class=&quot;color-dialog&quot;</span>
<a href="#l6.27"></a><span id="l6.27">       title=&quot;&amp;accountTitle.label;&quot;</span>
<a href="#l6.28"></a><span id="l6.28">       onload=&quot;parent.onPanelLoaded('am-newsblog.xul');&quot;&gt;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineat">@@ -39,17 +42,17 @@</span>
<a href="#l6.32"></a><span id="l6.32">              accesskey=&quot;&amp;accountName.accesskey;&quot;</span>
<a href="#l6.33"></a><span id="l6.33">              control=&quot;server.prettyName&quot;/&gt;</span>
<a href="#l6.34"></a><span id="l6.34">       &lt;textbox id=&quot;server.prettyName&quot;</span>
<a href="#l6.35"></a><span id="l6.35">                wsm_persist=&quot;true&quot;</span>
<a href="#l6.36"></a><span id="l6.36">                size=&quot;30&quot;</span>
<a href="#l6.37"></a><span id="l6.37">                prefstring=&quot;mail.server.%serverkey%.name&quot;/&gt;</span>
<a href="#l6.38"></a><span id="l6.38">     &lt;/hbox&gt;</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-    &lt;separator/&gt;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43">     &lt;groupbox&gt;</span>
<a href="#l6.44"></a><span id="l6.44">       &lt;caption label=&quot;&amp;serverSettings.label;&quot;/&gt;</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46">       &lt;checkbox id=&quot;server.loginAtStartUp&quot;</span>
<a href="#l6.47"></a><span id="l6.47">                 wsm_persist=&quot;true&quot;</span>
<a href="#l6.48"></a><span id="l6.48">                 label=&quot;&amp;loginAtStartup.label;&quot;</span>
<a href="#l6.49"></a><span id="l6.49">                 accesskey=&quot;&amp;loginAtStartup.accesskey;&quot;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineat">@@ -81,16 +84,32 @@</span>
<a href="#l6.51"></a><span id="l6.51">       &lt;checkbox id=&quot;server.quickMode&quot;</span>
<a href="#l6.52"></a><span id="l6.52">                 wsm_persist=&quot;true&quot;</span>
<a href="#l6.53"></a><span id="l6.53">                 genericattr=&quot;true&quot;</span>
<a href="#l6.54"></a><span id="l6.54">                 label=&quot;&amp;useQuickMode.label;&quot;</span>
<a href="#l6.55"></a><span id="l6.55">                 accesskey=&quot;&amp;useQuickMode.accesskey;&quot;</span>
<a href="#l6.56"></a><span id="l6.56">                 preftype=&quot;bool&quot;</span>
<a href="#l6.57"></a><span id="l6.57">                 prefattribute=&quot;value&quot;</span>
<a href="#l6.58"></a><span id="l6.58">                 prefstring=&quot;mail.server.%serverkey%.quickMode&quot;/&gt;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+      &lt;checkbox id=&quot;autotagEnable&quot;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+                accesskey=&quot;&amp;autotagEnable.accesskey;&quot;</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+                label=&quot;&amp;autotagEnable.label;&quot;</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+                oncommand=&quot;setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+          &lt;checkbox id=&quot;autotagUsePrefix&quot;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+                    class=&quot;indent&quot;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+                    accesskey=&quot;&amp;autotagUsePrefix.accesskey;&quot;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+                    label=&quot;&amp;autotagUsePrefix.label;&quot;</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+                    oncommand=&quot;setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+          &lt;textbox id=&quot;autotagPrefix&quot;</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+                   placeholder=&quot;&amp;autoTagPrefix.placeholder;&quot;</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+                   clickSelectsAll=&quot;true&quot;</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+                   onchange=&quot;setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l6.75"></a><span id="l6.75">     &lt;/groupbox&gt;</span>
<a href="#l6.76"></a><span id="l6.76"> </span>
<a href="#l6.77"></a><span id="l6.77">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l6.78"></a><span id="l6.78"> </span>
<a href="#l6.79"></a><span id="l6.79">     &lt;groupbox&gt;</span>
<a href="#l6.80"></a><span id="l6.80">       &lt;caption label=&quot;&amp;messageStorage.label;&quot;/&gt;</span>
<a href="#l6.81"></a><span id="l6.81"> </span>
<a href="#l6.82"></a><span id="l6.82">       &lt;checkbox id=&quot;server.emptyTrashOnExit&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-parser.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-parser.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -123,16 +123,17 @@ FeedParser.prototype =</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">     for (let itemNode of itemNodes)</span>
<a href="#l7.6"></a><span id="l7.6">     {</span>
<a href="#l7.7"></a><span id="l7.7">       if (!itemNode.childElementCount)</span>
<a href="#l7.8"></a><span id="l7.8">         continue;</span>
<a href="#l7.9"></a><span id="l7.9">       let item = new FeedItem();</span>
<a href="#l7.10"></a><span id="l7.10">       item.feed = aFeed;</span>
<a href="#l7.11"></a><span id="l7.11">       item.enclosures = [];</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+      item.keywords = [];</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14">       tags = this.childrenByTagNameNS(itemNode, FeedUtils.FEEDBURNER_NS, &quot;origLink&quot;);</span>
<a href="#l7.15"></a><span id="l7.15">       let link = this.getNodeValue(tags ? tags[0] : null);</span>
<a href="#l7.16"></a><span id="l7.16">       if (!link)</span>
<a href="#l7.17"></a><span id="l7.17">       {</span>
<a href="#l7.18"></a><span id="l7.18">         tags = this.childrenByTagNameNS(itemNode, nsURI, &quot;link&quot;);</span>
<a href="#l7.19"></a><span id="l7.19">         link = this.getNodeValue(tags ? tags[0] : null);</span>
<a href="#l7.20"></a><span id="l7.20">       }</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -265,16 +266,29 @@ FeedParser.prototype =</span>
<a href="#l7.22"></a><span id="l7.22">       if (origEncUrl)</span>
<a href="#l7.23"></a><span id="l7.23">       {</span>
<a href="#l7.24"></a><span id="l7.24">         if (item.enclosures.length)</span>
<a href="#l7.25"></a><span id="l7.25">           item.enclosures[0].mURL = origEncUrl;</span>
<a href="#l7.26"></a><span id="l7.26">         else</span>
<a href="#l7.27"></a><span id="l7.27">           item.enclosures.push(new FeedEnclosure(origEncUrl));</span>
<a href="#l7.28"></a><span id="l7.28">       }</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+      // Support &lt;category&gt; and autotagging.</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+      let tags = this.childrenByTagNameNS(itemNode, nsURI, &quot;category&quot;);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+      if (tags)</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+      {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+        for (let tag of tags)</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+        {</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+          let term = this.getNodeValue(tag);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+          term = term ? this.xmlUnescape(term.replace(&quot;,&quot;, &quot;;&quot;)) : null;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+          if (term &amp;&amp; item.keywords.indexOf(term) == -1)</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+            item.keywords.push(term);</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+        }</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+      }</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+</span>
<a href="#l7.43"></a><span id="l7.43">       parsedItems.push(item);</span>
<a href="#l7.44"></a><span id="l7.44">     }</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">     return parsedItems;</span>
<a href="#l7.47"></a><span id="l7.47">   },</span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49">   parseAsRSS1 : function(aFeed, aSource, aBaseURI)</span>
<a href="#l7.50"></a><span id="l7.50">   {</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineat">@@ -529,16 +543,17 @@ FeedParser.prototype =</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53">     for (let itemNode of items)</span>
<a href="#l7.54"></a><span id="l7.54">     {</span>
<a href="#l7.55"></a><span id="l7.55">       if (!itemNode.childElementCount)</span>
<a href="#l7.56"></a><span id="l7.56">         continue;</span>
<a href="#l7.57"></a><span id="l7.57">       let item = new FeedItem();</span>
<a href="#l7.58"></a><span id="l7.58">       item.feed = aFeed;</span>
<a href="#l7.59"></a><span id="l7.59">       item.enclosures = [];</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+      item.keywords = [];</span>
<a href="#l7.61"></a><span id="l7.61"> </span>
<a href="#l7.62"></a><span id="l7.62">       tags = this.childrenByTagNameNS(itemNode, FeedUtils.FEEDBURNER_NS, &quot;origLink&quot;);</span>
<a href="#l7.63"></a><span id="l7.63">       item.url = this.getNodeValue(tags ? tags[0] : null);</span>
<a href="#l7.64"></a><span id="l7.64">       if (!item.url)</span>
<a href="#l7.65"></a><span id="l7.65">       {</span>
<a href="#l7.66"></a><span id="l7.66">         tags = this.childrenByTagNameNS(itemNode, FeedUtils.ATOM_IETF_NS, &quot;link&quot;);</span>
<a href="#l7.67"></a><span id="l7.67">         item.url = this.findAtomLink(&quot;alternate&quot;, tags) || aFeed.link;</span>
<a href="#l7.68"></a><span id="l7.68">       }</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineat">@@ -548,17 +563,17 @@ FeedParser.prototype =</span>
<a href="#l7.70"></a><span id="l7.70">       item.description = this.serializeTextConstruct(tags ? tags[0] : null);</span>
<a href="#l7.71"></a><span id="l7.71">       tags = this.childrenByTagNameNS(itemNode, FeedUtils.ATOM_IETF_NS, &quot;title&quot;);</span>
<a href="#l7.72"></a><span id="l7.72">       item.title = this.stripTags(this.serializeTextConstruct(tags ? tags[0] : null) ||</span>
<a href="#l7.73"></a><span id="l7.73">                                   (item.description ?</span>
<a href="#l7.74"></a><span id="l7.74">                                      item.description.substr(0, 150) : null));</span>
<a href="#l7.75"></a><span id="l7.75">       if (!item.title || !item.id)</span>
<a href="#l7.76"></a><span id="l7.76">       {</span>
<a href="#l7.77"></a><span id="l7.77">         // We're lenient about other mandatory tags, but insist on these.</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-        FeedUtils.log.info(&quot;FeedParser.parseAsAtom: &lt;entry&gt; missing mandatory &quot; +</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+        FeedUtils.log.info(&quot;FeedParser.parseAsAtomIETF: &lt;entry&gt; missing mandatory &quot; +</span>
<a href="#l7.80"></a><span id="l7.80">                            &quot;element &lt;id&gt;, or &lt;title&gt; and no &lt;summary&gt;; skipping&quot;);</span>
<a href="#l7.81"></a><span id="l7.81">         continue;</span>
<a href="#l7.82"></a><span id="l7.82">       }</span>
<a href="#l7.83"></a><span id="l7.83"> </span>
<a href="#l7.84"></a><span id="l7.84">       // XXX Support multiple authors.</span>
<a href="#l7.85"></a><span id="l7.85">       tags = this.childrenByTagNameNS(itemNode, FeedUtils.ATOM_IETF_NS, &quot;source&quot;);</span>
<a href="#l7.86"></a><span id="l7.86">       let source = tags ? tags[0] : null;</span>
<a href="#l7.87"></a><span id="l7.87"> </span>
<a href="#l7.88"></a><span id="l7.88" class="difflineat">@@ -643,16 +658,29 @@ FeedParser.prototype =</span>
<a href="#l7.89"></a><span id="l7.89">         {</span>
<a href="#l7.90"></a><span id="l7.90">           let ref = tag.getAttribute(&quot;ref&quot;);</span>
<a href="#l7.91"></a><span id="l7.91">           if (ref)</span>
<a href="#l7.92"></a><span id="l7.92">             item.inReplyTo += item.normalizeMessageID(ref) + &quot; &quot;;</span>
<a href="#l7.93"></a><span id="l7.93">         }</span>
<a href="#l7.94"></a><span id="l7.94">         item.inReplyTo = item.inReplyTo.trimRight();</span>
<a href="#l7.95"></a><span id="l7.95">       }</span>
<a href="#l7.96"></a><span id="l7.96"> </span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+      // Support &lt;category&gt; and autotagging.</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+      tags = this.childrenByTagNameNS(itemNode, FeedUtils.ATOM_IETF_NS, &quot;category&quot;);</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+      if (tags)</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+      {</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+        for (let tag of tags)</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+        {</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+          let term = tag.getAttribute(&quot;term&quot;);</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+          term = term ? this.xmlUnescape(term.replace(&quot;,&quot;, &quot;;&quot;)).trim() : null;</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+          if (term &amp;&amp; item.keywords.indexOf(term) == -1)</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+            item.keywords.push(term);</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+        }</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+      }</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+</span>
<a href="#l7.110"></a><span id="l7.110">       parsedItems.push(item);</span>
<a href="#l7.111"></a><span id="l7.111">     }</span>
<a href="#l7.112"></a><span id="l7.112"> </span>
<a href="#l7.113"></a><span id="l7.113">     return parsedItems;</span>
<a href="#l7.114"></a><span id="l7.114">   },</span>
<a href="#l7.115"></a><span id="l7.115"> </span>
<a href="#l7.116"></a><span id="l7.116">   serializeTextConstruct: function(textElement)</span>
<a href="#l7.117"></a><span id="l7.117">   {</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineat">@@ -721,17 +749,17 @@ FeedParser.prototype =</span>
<a href="#l7.119"></a><span id="l7.119">       for (let child = node.firstChild; child; child = child.nextSibling)</span>
<a href="#l7.120"></a><span id="l7.120">       {</span>
<a href="#l7.121"></a><span id="l7.121">         let value = this.getNodeValue(child);</span>
<a href="#l7.122"></a><span id="l7.122">         if (value)</span>
<a href="#l7.123"></a><span id="l7.123">           ret += value;</span>
<a href="#l7.124"></a><span id="l7.124">       }</span>
<a href="#l7.125"></a><span id="l7.125"> </span>
<a href="#l7.126"></a><span id="l7.126">       if (ret)</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineminus">-        return ret;</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+        return ret.trim();</span>
<a href="#l7.129"></a><span id="l7.129">     }</span>
<a href="#l7.130"></a><span id="l7.130"> </span>
<a href="#l7.131"></a><span id="l7.131">     return null;</span>
<a href="#l7.132"></a><span id="l7.132">   },</span>
<a href="#l7.133"></a><span id="l7.133"> </span>
<a href="#l7.134"></a><span id="l7.134">   // Finds elements that are direct children of the first arg.</span>
<a href="#l7.135"></a><span id="l7.135">   childrenByTagNameNS: function(aElement, aNamespace, aTagName)</span>
<a href="#l7.136"></a><span id="l7.136">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -72,17 +72,17 @@ var FeedSubscriptions = {</span>
<a href="#l8.4"></a><span id="l8.4">       dismissDialog =</span>
<a href="#l8.5"></a><span id="l8.5">         !(Services.prompt.confirmEx(window, pTitle, pMessage,</span>
<a href="#l8.6"></a><span id="l8.6">                                     Ci.nsIPromptService.STD_YES_NO_BUTTONS,</span>
<a href="#l8.7"></a><span id="l8.7">                                     null, null, null, null, { }));</span>
<a href="#l8.8"></a><span id="l8.8">     }</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">     if (dismissDialog)</span>
<a href="#l8.11"></a><span id="l8.11">     {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      FeedUtils.CANCEL_REQUESTED = true;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      FeedUtils.CANCEL_REQUESTED = this.mActionMode == this.kSubscribeMode;</span>
<a href="#l8.14"></a><span id="l8.14">       let win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l8.15"></a><span id="l8.15">       if (win)</span>
<a href="#l8.16"></a><span id="l8.16">         {</span>
<a href="#l8.17"></a><span id="l8.17">           win.FeedFolderNotificationService.removeListener(this.FolderListener,</span>
<a href="#l8.18"></a><span id="l8.18">                                                            this.FOLDER_ACTIONS);</span>
<a href="#l8.19"></a><span id="l8.19">           delete win.FeedFolderNotificationService;</span>
<a href="#l8.20"></a><span id="l8.20">         }</span>
<a href="#l8.21"></a><span id="l8.21">     }</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -91,18 +91,16 @@ var FeedSubscriptions = {</span>
<a href="#l8.23"></a><span id="l8.23">   },</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25">   refreshSubscriptionView: function(aSelectFolder)</span>
<a href="#l8.26"></a><span id="l8.26">   {</span>
<a href="#l8.27"></a><span id="l8.27">     let item = this.mView.currentItem;</span>
<a href="#l8.28"></a><span id="l8.28">     this.loadSubscriptions();</span>
<a href="#l8.29"></a><span id="l8.29">     this.mTree.view = this.mView;</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    document.getElementById(&quot;selectFolderPopup&quot;)._ensureInitialized();</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-</span>
<a href="#l8.33"></a><span id="l8.33">     if (aSelectFolder)</span>
<a href="#l8.34"></a><span id="l8.34">       this.selectFolder(aSelectFolder);</span>
<a href="#l8.35"></a><span id="l8.35">     else</span>
<a href="#l8.36"></a><span id="l8.36">     {</span>
<a href="#l8.37"></a><span id="l8.37">       // If no folder to select, try to select the pre rebuild selection, in</span>
<a href="#l8.38"></a><span id="l8.38">       // an existing window.  For folderpane changes in a feed account.</span>
<a href="#l8.39"></a><span id="l8.39">       if (item)</span>
<a href="#l8.40"></a><span id="l8.40">       {</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -559,25 +557,28 @@ var FeedSubscriptions = {</span>
<a href="#l8.42"></a><span id="l8.42">       this.treeBox.rowCountChanged(aRow, delta);</span>
<a href="#l8.43"></a><span id="l8.43">       return delta;</span>
<a href="#l8.44"></a><span id="l8.44">     }</span>
<a href="#l8.45"></a><span id="l8.45">   },</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47">   makeFolderObject: function (aFolder, aCurrentLevel)</span>
<a href="#l8.48"></a><span id="l8.48">   {</span>
<a href="#l8.49"></a><span id="l8.49">     let defaultQuickMode = aFolder.server.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+    let optionsAcct = aFolder.isServer ? FeedUtils.getOptionsAcct(aFolder.server) :</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+                                         null;</span>
<a href="#l8.52"></a><span id="l8.52">     let open = !aFolder.isServer &amp;&amp;</span>
<a href="#l8.53"></a><span id="l8.53">                aFolder.server == this.mRSSServer &amp;&amp;</span>
<a href="#l8.54"></a><span id="l8.54">                this.mActionMode == this.kImportingOPML ? true : false</span>
<a href="#l8.55"></a><span id="l8.55">     let folderObject =  { children : [],</span>
<a href="#l8.56"></a><span id="l8.56">                           folder   : aFolder,</span>
<a href="#l8.57"></a><span id="l8.57">                           name     : aFolder.prettyName,</span>
<a href="#l8.58"></a><span id="l8.58">                           level    : aCurrentLevel,</span>
<a href="#l8.59"></a><span id="l8.59">                           url      : aFolder.URI,</span>
<a href="#l8.60"></a><span id="l8.60">                           quickMode: defaultQuickMode,</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+                          options  : optionsAcct,</span>
<a href="#l8.62"></a><span id="l8.62">                           open     : open,</span>
<a href="#l8.63"></a><span id="l8.63">                           container: true,</span>
<a href="#l8.64"></a><span id="l8.64">                           favicon  : null };</span>
<a href="#l8.65"></a><span id="l8.65"> </span>
<a href="#l8.66"></a><span id="l8.66">     // If a feed has any sub folders, add them to the list of children.</span>
<a href="#l8.67"></a><span id="l8.67">     let folderEnumerator = aFolder.subFolders;</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69">     while (folderEnumerator.hasMoreElements())</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineat">@@ -588,20 +589,20 @@ var FeedSubscriptions = {</span>
<a href="#l8.71"></a><span id="l8.71">           !folder.getFlag(Ci.nsMsgFolderFlags.Virtual))</span>
<a href="#l8.72"></a><span id="l8.72">       {</span>
<a href="#l8.73"></a><span id="l8.73">         folderObject.children</span>
<a href="#l8.74"></a><span id="l8.74">                     .push(this.makeFolderObject(folder, aCurrentLevel + 1));</span>
<a href="#l8.75"></a><span id="l8.75">       }</span>
<a href="#l8.76"></a><span id="l8.76">     }</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">     let feeds = this.getFeedsInFolder(aFolder);</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-    for (let feed in feeds)</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+    for (let feed of feeds)</span>
<a href="#l8.81"></a><span id="l8.81">     {</span>
<a href="#l8.82"></a><span id="l8.82">       // Now add any feed urls for the folder.</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-      folderObject.children.push(this.makeFeedObject(feeds[feed],</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+      folderObject.children.push(this.makeFeedObject(feed,</span>
<a href="#l8.85"></a><span id="l8.85">                                                      aFolder,</span>
<a href="#l8.86"></a><span id="l8.86">                                                      aCurrentLevel + 1));</span>
<a href="#l8.87"></a><span id="l8.87">     }</span>
<a href="#l8.88"></a><span id="l8.88"> </span>
<a href="#l8.89"></a><span id="l8.89">     // Finally, set the folder's quickMode based on the its first feed's</span>
<a href="#l8.90"></a><span id="l8.90">     // quickMode, since that is how the view determines summary mode, and now</span>
<a href="#l8.91"></a><span id="l8.91">     // quickMode is updated to be the same for all feeds in a folder.</span>
<a href="#l8.92"></a><span id="l8.92">     if (feeds &amp;&amp; feeds[0])</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineat">@@ -622,36 +623,35 @@ var FeedSubscriptions = {</span>
<a href="#l8.94"></a><span id="l8.94">   getFeedsInFolder: function (aFolder)</span>
<a href="#l8.95"></a><span id="l8.95">   {</span>
<a href="#l8.96"></a><span id="l8.96">     let feeds = new Array();</span>
<a href="#l8.97"></a><span id="l8.97">     let feedUrlArray = FeedUtils.getFeedUrlsInFolder(aFolder);</span>
<a href="#l8.98"></a><span id="l8.98">     if (!feedUrlArray)</span>
<a href="#l8.99"></a><span id="l8.99">       // No feedUrls in this folder.</span>
<a href="#l8.100"></a><span id="l8.100">       return feeds;</span>
<a href="#l8.101"></a><span id="l8.101"> </span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-    for (let url in feedUrlArray)</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+    for (let url of feedUrlArray)</span>
<a href="#l8.104"></a><span id="l8.104">     {</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-      if (!feedUrlArray[url])</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-        continue;</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-      let feedResource = FeedUtils.rdf.GetResource(feedUrlArray[url]);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+      let feedResource = FeedUtils.rdf.GetResource(url);</span>
<a href="#l8.109"></a><span id="l8.109">       let feed = new Feed(feedResource, aFolder.server);</span>
<a href="#l8.110"></a><span id="l8.110">       feeds.push(feed);</span>
<a href="#l8.111"></a><span id="l8.111">     }</span>
<a href="#l8.112"></a><span id="l8.112"> </span>
<a href="#l8.113"></a><span id="l8.113">     return feeds;</span>
<a href="#l8.114"></a><span id="l8.114">   },</span>
<a href="#l8.115"></a><span id="l8.115"> </span>
<a href="#l8.116"></a><span id="l8.116">   makeFeedObject: function (aFeed, aFolder, aLevel)</span>
<a href="#l8.117"></a><span id="l8.117">   {</span>
<a href="#l8.118"></a><span id="l8.118">     // Look inside the data source for the feed properties.</span>
<a href="#l8.119"></a><span id="l8.119">     let feed = { children    : [],</span>
<a href="#l8.120"></a><span id="l8.120">                  parentFolder: aFolder,</span>
<a href="#l8.121"></a><span id="l8.121">                  name        : aFeed.title || aFeed.description || aFeed.url,</span>
<a href="#l8.122"></a><span id="l8.122">                  url         : aFeed.url,</span>
<a href="#l8.123"></a><span id="l8.123">                  quickMode   : aFeed.quickMode,</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+                 options     : aFeed.options || FeedUtils.optionsTemplate,</span>
<a href="#l8.125"></a><span id="l8.125">                  level       : aLevel,</span>
<a href="#l8.126"></a><span id="l8.126">                  open        : false,</span>
<a href="#l8.127"></a><span id="l8.127">                  container   : false,</span>
<a href="#l8.128"></a><span id="l8.128">                  favicon     : null };</span>
<a href="#l8.129"></a><span id="l8.129">     return feed;</span>
<a href="#l8.130"></a><span id="l8.130">   },</span>
<a href="#l8.131"></a><span id="l8.131"> </span>
<a href="#l8.132"></a><span id="l8.132">   loadSubscriptions: function ()</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineat">@@ -900,75 +900,97 @@ var FeedSubscriptions = {</span>
<a href="#l8.134"></a><span id="l8.134">     if (!aItem)</span>
<a href="#l8.135"></a><span id="l8.135">       return;</span>
<a href="#l8.136"></a><span id="l8.136"> </span>
<a href="#l8.137"></a><span id="l8.137">     let nameValue = document.getElementById(&quot;nameValue&quot;);</span>
<a href="#l8.138"></a><span id="l8.138">     let locationValue = document.getElementById(&quot;locationValue&quot;);</span>
<a href="#l8.139"></a><span id="l8.139">     let locationValidate = document.getElementById(&quot;locationValidate&quot;);</span>
<a href="#l8.140"></a><span id="l8.140">     let selectFolder = document.getElementById(&quot;selectFolder&quot;);</span>
<a href="#l8.141"></a><span id="l8.141">     let selectFolderValue = document.getElementById(&quot;selectFolderValue&quot;);</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineminus">-    let server, rootFolder, displayFolder;</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+    let isServer = aItem.folder &amp;&amp; aItem.folder.isServer;</span>
<a href="#l8.144"></a><span id="l8.144" class="difflineplus">+    let isFolder = aItem.folder &amp;&amp; !aItem.folder.isServer;</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineplus">+    let isFeed = !aItem.container;</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+    let server, displayFolder;</span>
<a href="#l8.147"></a><span id="l8.147"> </span>
<a href="#l8.148"></a><span id="l8.148" class="difflineminus">-    if (!aItem.container)</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineplus">+    if (isFeed)</span>
<a href="#l8.150"></a><span id="l8.150">     {</span>
<a href="#l8.151"></a><span id="l8.151">       // A feed item.  Set the feed location and title info.</span>
<a href="#l8.152"></a><span id="l8.152">       nameValue.value = aItem.name;</span>
<a href="#l8.153"></a><span id="l8.153">       locationValue.value = aItem.url;</span>
<a href="#l8.154"></a><span id="l8.154">       locationValidate.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l8.155"></a><span id="l8.155"> </span>
<a href="#l8.156"></a><span id="l8.156">       // Root the location picker to the news &amp; blogs server.</span>
<a href="#l8.157"></a><span id="l8.157">       server = aItem.parentFolder.server;</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineminus">-      rootFolder = aItem.parentFolder.rootFolder;</span>
<a href="#l8.159"></a><span id="l8.159">       displayFolder = aItem.parentFolder;</span>
<a href="#l8.160"></a><span id="l8.160">     }</span>
<a href="#l8.161"></a><span id="l8.161">     else</span>
<a href="#l8.162"></a><span id="l8.162">     {</span>
<a href="#l8.163"></a><span id="l8.163">       // A folder/container item.</span>
<a href="#l8.164"></a><span id="l8.164">       nameValue.value = &quot;&quot;;</span>
<a href="#l8.165"></a><span id="l8.165">       nameValue.disabled = true;</span>
<a href="#l8.166"></a><span id="l8.166">       locationValue.value = &quot;&quot;;</span>
<a href="#l8.167"></a><span id="l8.167">       locationValidate.setAttribute(&quot;collapsed&quot;, true);</span>
<a href="#l8.168"></a><span id="l8.168"> </span>
<a href="#l8.169"></a><span id="l8.169">       server = aItem.folder.server;</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineminus">-      rootFolder = aItem.folder.rootFolder;</span>
<a href="#l8.171"></a><span id="l8.171">       displayFolder = aItem.folder;</span>
<a href="#l8.172"></a><span id="l8.172">     }</span>
<a href="#l8.173"></a><span id="l8.173"> </span>
<a href="#l8.174"></a><span id="l8.174">     // Common to both folder and feed items.</span>
<a href="#l8.175"></a><span id="l8.175">     nameValue.disabled = aItem.container;</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineminus">-    selectFolder.setAttribute(&quot;hidden&quot;, aItem.container);</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineminus">-    selectFolderValue.setAttribute(&quot;hidden&quot;, !aItem.container);</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineminus">-    selectFolderValue.setAttribute(&quot;showfilepath&quot;, false);</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineminus">-    this.setFolderPicker(displayFolder);</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+    this.setFolderPicker(displayFolder, isFeed);</span>
<a href="#l8.181"></a><span id="l8.181"> </span>
<a href="#l8.182"></a><span id="l8.182">     // Set quick mode value.</span>
<a href="#l8.183"></a><span id="l8.183">     document.getElementById(&quot;quickMode&quot;).checked = aItem.quickMode;</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineplus">+</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineplus">+    // Autotag items.</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineplus">+    let autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineplus">+    let autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+    let autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineplus">+    let categoryPrefsAcct = FeedUtils.getOptionsAcct(server).category;</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineplus">+    if (isServer)</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+      aItem.options = FeedUtils.getOptionsAcct(server);</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+    let categoryPrefs = aItem.options ? aItem.options.category : null;</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+    autotagEnable.checked = categoryPrefs &amp;&amp; categoryPrefs.enabled;</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineplus">+    autotagUsePrefix.checked = categoryPrefs &amp;&amp; categoryPrefs.prefixEnabled;</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineplus">+    autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineplus">+    autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineplus">+    autotagPrefix.value = categoryPrefs &amp;&amp; categoryPrefs.prefix ?</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineplus">+                            categoryPrefs.prefix : &quot;&quot;;</span>
<a href="#l8.200"></a><span id="l8.200">   },</span>
<a href="#l8.201"></a><span id="l8.201"> </span>
<a href="#l8.202"></a><span id="l8.202" class="difflineminus">-  setFolderPicker: function(aFolder)</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineplus">+  setFolderPicker: function(aFolder, aIsFeed)</span>
<a href="#l8.204"></a><span id="l8.204">   {</span>
<a href="#l8.205"></a><span id="l8.205">     let editFeed = document.getElementById(&quot;editFeed&quot;);</span>
<a href="#l8.206"></a><span id="l8.206">     let folderPrettyPath = FeedUtils.getFolderPrettyPath(aFolder);</span>
<a href="#l8.207"></a><span id="l8.207">     if (!folderPrettyPath)</span>
<a href="#l8.208"></a><span id="l8.208">       return editFeed.disabled = true;</span>
<a href="#l8.209"></a><span id="l8.209"> </span>
<a href="#l8.210"></a><span id="l8.210">     let selectFolder = document.getElementById(&quot;selectFolder&quot;);</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineplus">+    let selectFolderPopup = document.getElementById(&quot;selectFolderPopup&quot;);</span>
<a href="#l8.212"></a><span id="l8.212">     let selectFolderValue = document.getElementById(&quot;selectFolderValue&quot;);</span>
<a href="#l8.213"></a><span id="l8.213"> </span>
<a href="#l8.214"></a><span id="l8.214" class="difflineminus">-    try {</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineminus">-      document.getElementById(&quot;selectFolderPopup&quot;).selectFolder(aFolder);</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-    }</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineminus">-    catch (ex) {}</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineminus">-</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+    selectFolder.setAttribute(&quot;hidden&quot;, !aIsFeed);</span>
<a href="#l8.220"></a><span id="l8.220">     selectFolder._folder = aFolder;</span>
<a href="#l8.221"></a><span id="l8.221" class="difflineminus">-    selectFolder.setAttribute(&quot;label&quot;, folderPrettyPath);</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineminus">-    selectFolder.setAttribute(&quot;uri&quot;, aFolder.URI);</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineminus">-    selectFolderValue.value = folderPrettyPath;</span>
<a href="#l8.224"></a><span id="l8.224" class="difflineminus">-    selectFolderValue.setAttribute(&quot;prettypath&quot;, folderPrettyPath);</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineminus">-    selectFolderValue.setAttribute(&quot;filepath&quot;, aFolder.filePath.path);</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineplus">+    selectFolderValue.setAttribute(&quot;hidden&quot;, aIsFeed);</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineplus">+    selectFolderValue.setAttribute(&quot;showfilepath&quot;, false);</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineplus">+</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineplus">+    if (aIsFeed)</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+    {</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+      selectFolderPopup._ensureInitialized();</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineplus">+      selectFolderPopup.selectFolder(aFolder);</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+      selectFolder.setAttribute(&quot;label&quot;, folderPrettyPath);</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+      selectFolder.setAttribute(&quot;uri&quot;, aFolder.URI);</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+    }</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineplus">+    else</span>
<a href="#l8.237"></a><span id="l8.237" class="difflineplus">+    {</span>
<a href="#l8.238"></a><span id="l8.238" class="difflineplus">+      selectFolderValue.value = folderPrettyPath;</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineplus">+      selectFolderValue.setAttribute(&quot;prettypath&quot;, folderPrettyPath);</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineplus">+      selectFolderValue.setAttribute(&quot;filepath&quot;, aFolder.filePath.path);</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineplus">+    }</span>
<a href="#l8.242"></a><span id="l8.242"> </span>
<a href="#l8.243"></a><span id="l8.243">     return editFeed.disabled = false;</span>
<a href="#l8.244"></a><span id="l8.244">   },</span>
<a href="#l8.245"></a><span id="l8.245"> </span>
<a href="#l8.246"></a><span id="l8.246">   onClickSelectFolderValue: function(aEvent)</span>
<a href="#l8.247"></a><span id="l8.247">   {</span>
<a href="#l8.248"></a><span id="l8.248">     let target = aEvent.target;</span>
<a href="#l8.249"></a><span id="l8.249">     if (((&quot;button&quot; in aEvent) &amp;&amp;</span>
<a href="#l8.250"></a><span id="l8.250" class="difflineat">@@ -986,16 +1008,22 @@ var FeedSubscriptions = {</span>
<a href="#l8.251"></a><span id="l8.251">     }</span>
<a href="#l8.252"></a><span id="l8.252">     else</span>
<a href="#l8.253"></a><span id="l8.253">     {</span>
<a href="#l8.254"></a><span id="l8.254">       target.setAttribute(&quot;showfilepath&quot;, true);</span>
<a href="#l8.255"></a><span id="l8.255">       target.value = target.getAttribute(&quot;filepath&quot;);</span>
<a href="#l8.256"></a><span id="l8.256">     }</span>
<a href="#l8.257"></a><span id="l8.257">   },</span>
<a href="#l8.258"></a><span id="l8.258"> </span>
<a href="#l8.259"></a><span id="l8.259" class="difflineplus">+  setNewFolder: function(aFolder)</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineplus">+  {</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineplus">+    this.setFolderPicker(aFolder, true);</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineplus">+    this.editFeed();</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineplus">+  },</span>
<a href="#l8.264"></a><span id="l8.264" class="difflineplus">+</span>
<a href="#l8.265"></a><span id="l8.265">   setSummary: function(aChecked)</span>
<a href="#l8.266"></a><span id="l8.266">   {</span>
<a href="#l8.267"></a><span id="l8.267">     let item = this.mView.currentItem;</span>
<a href="#l8.268"></a><span id="l8.268">     if (!item || !item.folder)</span>
<a href="#l8.269"></a><span id="l8.269">       // Not a folder.</span>
<a href="#l8.270"></a><span id="l8.270">       return;</span>
<a href="#l8.271"></a><span id="l8.271"> </span>
<a href="#l8.272"></a><span id="l8.272">     if (item.folder.isServer)</span>
<a href="#l8.273"></a><span id="l8.273" class="difflineat">@@ -1014,24 +1042,74 @@ var FeedSubscriptions = {</span>
<a href="#l8.274"></a><span id="l8.274">       return;</span>
<a href="#l8.275"></a><span id="l8.275">     else</span>
<a href="#l8.276"></a><span id="l8.276">     {</span>
<a href="#l8.277"></a><span id="l8.277">       let feedsInFolder = this.getFeedsInFolder(item.folder);</span>
<a href="#l8.278"></a><span id="l8.278">       // Update the feeds database, for each feed in the folder.</span>
<a href="#l8.279"></a><span id="l8.279">       feedsInFolder.forEach(function(feed) { feed.quickMode = aChecked; });</span>
<a href="#l8.280"></a><span id="l8.280">       // Update the folder's feeds properties in the tree map.</span>
<a href="#l8.281"></a><span id="l8.281">       item.children.forEach(function(feed) { feed.quickMode = aChecked; });</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineplus">+      let ds = FeedUtils.getSubscriptionsDS(item.folder.server);</span>
<a href="#l8.283"></a><span id="l8.283" class="difflineplus">+      ds.Flush();</span>
<a href="#l8.284"></a><span id="l8.284">     }</span>
<a href="#l8.285"></a><span id="l8.285"> </span>
<a href="#l8.286"></a><span id="l8.286">     // Update the folder in the tree map.</span>
<a href="#l8.287"></a><span id="l8.287">     item.quickMode = aChecked;</span>
<a href="#l8.288"></a><span id="l8.288">     let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l8.289"></a><span id="l8.289">     this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l8.290"></a><span id="l8.290">   },</span>
<a href="#l8.291"></a><span id="l8.291"> </span>
<a href="#l8.292"></a><span id="l8.292" class="difflineplus">+  setCategoryPrefs: function(aNode)</span>
<a href="#l8.293"></a><span id="l8.293" class="difflineplus">+  {</span>
<a href="#l8.294"></a><span id="l8.294" class="difflineplus">+    let item = this.mView.currentItem;</span>
<a href="#l8.295"></a><span id="l8.295" class="difflineplus">+    if (!item)</span>
<a href="#l8.296"></a><span id="l8.296" class="difflineplus">+      return;</span>
<a href="#l8.297"></a><span id="l8.297" class="difflineplus">+</span>
<a href="#l8.298"></a><span id="l8.298" class="difflineplus">+    let isServer = item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l8.299"></a><span id="l8.299" class="difflineplus">+    let isFolder = item.folder &amp;&amp; !item.folder.isServer;</span>
<a href="#l8.300"></a><span id="l8.300" class="difflineplus">+    let autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l8.301"></a><span id="l8.301" class="difflineplus">+    let autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l8.302"></a><span id="l8.302" class="difflineplus">+    let autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l8.303"></a><span id="l8.303" class="difflineplus">+    if (isFolder || (isServer &amp;&amp; document.getElementById(&quot;locationValue&quot;).value))</span>
<a href="#l8.304"></a><span id="l8.304" class="difflineplus">+    {</span>
<a href="#l8.305"></a><span id="l8.305" class="difflineplus">+      // Intend to subscribe a feed to a folder, a value must be in the url</span>
<a href="#l8.306"></a><span id="l8.306" class="difflineplus">+      // field. Update states for addFeed() and return.</span>
<a href="#l8.307"></a><span id="l8.307" class="difflineplus">+      autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l8.308"></a><span id="l8.308" class="difflineplus">+      autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l8.309"></a><span id="l8.309" class="difflineplus">+      return;</span>
<a href="#l8.310"></a><span id="l8.310" class="difflineplus">+    }</span>
<a href="#l8.311"></a><span id="l8.311" class="difflineplus">+</span>
<a href="#l8.312"></a><span id="l8.312" class="difflineplus">+    switch (aNode.id) {</span>
<a href="#l8.313"></a><span id="l8.313" class="difflineplus">+      case &quot;autotagEnable&quot;:</span>
<a href="#l8.314"></a><span id="l8.314" class="difflineplus">+        item.options.category.enabled = aNode.checked;</span>
<a href="#l8.315"></a><span id="l8.315" class="difflineplus">+        break;</span>
<a href="#l8.316"></a><span id="l8.316" class="difflineplus">+      case &quot;autotagUsePrefix&quot;:</span>
<a href="#l8.317"></a><span id="l8.317" class="difflineplus">+        item.options.category.prefixEnabled = aNode.checked;</span>
<a href="#l8.318"></a><span id="l8.318" class="difflineplus">+        item.options.category.prefix = autotagPrefix.value;</span>
<a href="#l8.319"></a><span id="l8.319" class="difflineplus">+        break;</span>
<a href="#l8.320"></a><span id="l8.320" class="difflineplus">+    }</span>
<a href="#l8.321"></a><span id="l8.321" class="difflineplus">+</span>
<a href="#l8.322"></a><span id="l8.322" class="difflineplus">+    if (isServer)</span>
<a href="#l8.323"></a><span id="l8.323" class="difflineplus">+    {</span>
<a href="#l8.324"></a><span id="l8.324" class="difflineplus">+      FeedUtils.setOptionsAcct(item.folder.server, item.options)</span>
<a href="#l8.325"></a><span id="l8.325" class="difflineplus">+    }</span>
<a href="#l8.326"></a><span id="l8.326" class="difflineplus">+    else</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineplus">+    {</span>
<a href="#l8.328"></a><span id="l8.328" class="difflineplus">+      let feedResource = FeedUtils.rdf.GetResource(item.url);</span>
<a href="#l8.329"></a><span id="l8.329" class="difflineplus">+      let feed = new Feed(feedResource, item.parentFolder.server);</span>
<a href="#l8.330"></a><span id="l8.330" class="difflineplus">+      feed.options = item.options;</span>
<a href="#l8.331"></a><span id="l8.331" class="difflineplus">+      let ds = FeedUtils.getSubscriptionsDS(item.parentFolder.server);</span>
<a href="#l8.332"></a><span id="l8.332" class="difflineplus">+      ds.Flush();</span>
<a href="#l8.333"></a><span id="l8.333" class="difflineplus">+    }</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineplus">+</span>
<a href="#l8.335"></a><span id="l8.335" class="difflineplus">+    this.updateFeedData(item);</span>
<a href="#l8.336"></a><span id="l8.336" class="difflineplus">+    let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l8.337"></a><span id="l8.337" class="difflineplus">+    this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l8.338"></a><span id="l8.338" class="difflineplus">+  },</span>
<a href="#l8.339"></a><span id="l8.339" class="difflineplus">+</span>
<a href="#l8.340"></a><span id="l8.340">   onKeyPress: function(aEvent)</span>
<a href="#l8.341"></a><span id="l8.341">   {</span>
<a href="#l8.342"></a><span id="l8.342">     if (aEvent.keyCode == aEvent.DOM_VK_DELETE &amp;&amp;</span>
<a href="#l8.343"></a><span id="l8.343">         aEvent.target.id == &quot;rssSubscriptionsList&quot;)</span>
<a href="#l8.344"></a><span id="l8.344">       this.removeFeed(true);</span>
<a href="#l8.345"></a><span id="l8.345"> </span>
<a href="#l8.346"></a><span id="l8.346">     this.clearStatusInfo();</span>
<a href="#l8.347"></a><span id="l8.347">   },</span>
<a href="#l8.348"></a><span id="l8.348" class="difflineat">@@ -1043,22 +1121,24 @@ var FeedSubscriptions = {</span>
<a href="#l8.349"></a><span id="l8.349">     this.setSummaryFocus();</span>
<a href="#l8.350"></a><span id="l8.350">     this.updateButtons(item);</span>
<a href="#l8.351"></a><span id="l8.351">   },</span>
<a href="#l8.352"></a><span id="l8.352"> </span>
<a href="#l8.353"></a><span id="l8.353">   updateButtons: function (aSelectedItem)</span>
<a href="#l8.354"></a><span id="l8.354">   {</span>
<a href="#l8.355"></a><span id="l8.355">     let item = aSelectedItem;</span>
<a href="#l8.356"></a><span id="l8.356">     let isServer = item &amp;&amp; item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l8.357"></a><span id="l8.357" class="difflineminus">-    let disable = !item || !item.container ||</span>
<a href="#l8.358"></a><span id="l8.358" class="difflineplus">+    let disable = !item || !item.container || isServer ||</span>
<a href="#l8.359"></a><span id="l8.359">                   this.mActionMode == this.kImportingOPML;</span>
<a href="#l8.360"></a><span id="l8.360">     document.getElementById(&quot;addFeed&quot;).disabled = disable;</span>
<a href="#l8.361"></a><span id="l8.361" class="difflineplus">+    disable = !item || (item.container &amp;&amp; !isServer) ||</span>
<a href="#l8.362"></a><span id="l8.362" class="difflineplus">+              this.mActionMode == this.kImportingOPML;</span>
<a href="#l8.363"></a><span id="l8.363" class="difflineplus">+    document.getElementById(&quot;editFeed&quot;).disabled = disable;</span>
<a href="#l8.364"></a><span id="l8.364">     disable = !item || item.container ||</span>
<a href="#l8.365"></a><span id="l8.365">               this.mActionMode == this.kImportingOPML;</span>
<a href="#l8.366"></a><span id="l8.366" class="difflineminus">-    document.getElementById(&quot;editFeed&quot;).disabled = disable;</span>
<a href="#l8.367"></a><span id="l8.367">     document.getElementById(&quot;removeFeed&quot;).disabled = disable;</span>
<a href="#l8.368"></a><span id="l8.368">     disable = !item || !isServer ||</span>
<a href="#l8.369"></a><span id="l8.369">               this.mActionMode == this.kImportingOPML;</span>
<a href="#l8.370"></a><span id="l8.370">     document.getElementById(&quot;importOPML&quot;).disabled = disable;</span>
<a href="#l8.371"></a><span id="l8.371">     document.getElementById(&quot;exportOPML&quot;).disabled = disable;</span>
<a href="#l8.372"></a><span id="l8.372">   },</span>
<a href="#l8.373"></a><span id="l8.373"> </span>
<a href="#l8.374"></a><span id="l8.374">   onMouseDown: function (aEvent)</span>
<a href="#l8.375"></a><span id="l8.375" class="difflineat">@@ -1067,29 +1147,54 @@ var FeedSubscriptions = {</span>
<a href="#l8.376"></a><span id="l8.376">       return;</span>
<a href="#l8.377"></a><span id="l8.377"> </span>
<a href="#l8.378"></a><span id="l8.378">     this.clearStatusInfo();</span>
<a href="#l8.379"></a><span id="l8.379">   },</span>
<a href="#l8.380"></a><span id="l8.380"> </span>
<a href="#l8.381"></a><span id="l8.381">   setSummaryFocus: function ()</span>
<a href="#l8.382"></a><span id="l8.382">   {</span>
<a href="#l8.383"></a><span id="l8.383">     let item = this.mView.currentItem;</span>
<a href="#l8.384"></a><span id="l8.384" class="difflineplus">+    if (!item)</span>
<a href="#l8.385"></a><span id="l8.385" class="difflineplus">+      return;</span>
<a href="#l8.386"></a><span id="l8.386" class="difflineplus">+</span>
<a href="#l8.387"></a><span id="l8.387">     let locationValue = document.getElementById(&quot;locationValue&quot;);</span>
<a href="#l8.388"></a><span id="l8.388">     let quickMode = document.getElementById(&quot;quickMode&quot;);</span>
<a href="#l8.389"></a><span id="l8.389" class="difflineplus">+    let autotagEnable = document.getElementById(&quot;autotagEnable&quot;);</span>
<a href="#l8.390"></a><span id="l8.390" class="difflineplus">+    let autotagUsePrefix = document.getElementById(&quot;autotagUsePrefix&quot;);</span>
<a href="#l8.391"></a><span id="l8.391" class="difflineplus">+    let autotagPrefix = document.getElementById(&quot;autotagPrefix&quot;);</span>
<a href="#l8.392"></a><span id="l8.392" class="difflineplus">+    let isServer = item.folder &amp;&amp; item.folder.isServer;</span>
<a href="#l8.393"></a><span id="l8.393" class="difflineplus">+    let isFolder = item.folder &amp;&amp; !item.folder.isServer;</span>
<a href="#l8.394"></a><span id="l8.394" class="difflineplus">+    let isFeed = !item.container;</span>
<a href="#l8.395"></a><span id="l8.395"> </span>
<a href="#l8.396"></a><span id="l8.396" class="difflineminus">-    if (item &amp;&amp; item.folder &amp;&amp;</span>
<a href="#l8.397"></a><span id="l8.397" class="difflineminus">-        (locationValue.hasAttribute(&quot;focused&quot;) || locationValue.value ||</span>
<a href="#l8.398"></a><span id="l8.398" class="difflineminus">-         item.folder.isServer || FeedUtils.getFeedUrlsInFolder(item.folder)))</span>
<a href="#l8.399"></a><span id="l8.399" class="difflineplus">+    // Enable summary/autotag by default.</span>
<a href="#l8.400"></a><span id="l8.400" class="difflineplus">+    quickMode.disabled = autotagEnable.disabled = false;</span>
<a href="#l8.401"></a><span id="l8.401" class="difflineplus">+    autotagUsePrefix.disabled = !autotagEnable.checked;</span>
<a href="#l8.402"></a><span id="l8.402" class="difflineplus">+    autotagPrefix.disabled = autotagUsePrefix.disabled || !autotagUsePrefix.checked;</span>
<a href="#l8.403"></a><span id="l8.403" class="difflineplus">+</span>
<a href="#l8.404"></a><span id="l8.404" class="difflineplus">+    if (isServer)</span>
<a href="#l8.405"></a><span id="l8.405">     {</span>
<a href="#l8.406"></a><span id="l8.406" class="difflineminus">-      // Enable summary for account folder or folder with feeds or focus/value</span>
<a href="#l8.407"></a><span id="l8.407" class="difflineminus">-      // in the feed url field of empty folders prior to add.</span>
<a href="#l8.408"></a><span id="l8.408" class="difflineminus">-      quickMode.disabled = false;</span>
<a href="#l8.409"></a><span id="l8.409" class="difflineplus">+      let disable = locationValue.hasAttribute(&quot;focused&quot;) || locationValue.value;</span>
<a href="#l8.410"></a><span id="l8.410" class="difflineplus">+      document.getElementById(&quot;addFeed&quot;).disabled = !disable;</span>
<a href="#l8.411"></a><span id="l8.411" class="difflineplus">+      document.getElementById(&quot;editFeed&quot;).disabled = disable;</span>
<a href="#l8.412"></a><span id="l8.412" class="difflineplus">+</span>
<a href="#l8.413"></a><span id="l8.413" class="difflineplus">+    }</span>
<a href="#l8.414"></a><span id="l8.414" class="difflineplus">+    else if (isFolder)</span>
<a href="#l8.415"></a><span id="l8.415" class="difflineplus">+    {</span>
<a href="#l8.416"></a><span id="l8.416" class="difflineplus">+      if (!locationValue.hasAttribute(&quot;focused&quot;) &amp;&amp; !locationValue.value)</span>
<a href="#l8.417"></a><span id="l8.417" class="difflineplus">+      {</span>
<a href="#l8.418"></a><span id="l8.418" class="difflineplus">+        // Enabled for a folder with feeds. Autotag disabled unless intent is</span>
<a href="#l8.419"></a><span id="l8.419" class="difflineplus">+        // to add a feed.</span>
<a href="#l8.420"></a><span id="l8.420" class="difflineplus">+        quickMode.disabled = !FeedUtils.getFeedUrlsInFolder(item.folder);</span>
<a href="#l8.421"></a><span id="l8.421" class="difflineplus">+        autotagEnable.disabled = autotagUsePrefix.disabled =</span>
<a href="#l8.422"></a><span id="l8.422" class="difflineplus">+          autotagPrefix.disabled = true;</span>
<a href="#l8.423"></a><span id="l8.423" class="difflineplus">+      }</span>
<a href="#l8.424"></a><span id="l8.424">     }</span>
<a href="#l8.425"></a><span id="l8.425">     else</span>
<a href="#l8.426"></a><span id="l8.426">     {</span>
<a href="#l8.427"></a><span id="l8.427" class="difflineplus">+      // Summary is per folder.</span>
<a href="#l8.428"></a><span id="l8.428">       quickMode.disabled = true;</span>
<a href="#l8.429"></a><span id="l8.429">     }</span>
<a href="#l8.430"></a><span id="l8.430">   },</span>
<a href="#l8.431"></a><span id="l8.431"> </span>
<a href="#l8.432"></a><span id="l8.432">   removeFeed: function (aPrompt)</span>
<a href="#l8.433"></a><span id="l8.433">   {</span>
<a href="#l8.434"></a><span id="l8.434">     let seln = this.mView.selection;</span>
<a href="#l8.435"></a><span id="l8.435">     if (seln.count != 1)</span>
<a href="#l8.436"></a><span id="l8.436" class="difflineat">@@ -1156,16 +1261,18 @@ var FeedSubscriptions = {</span>
<a href="#l8.437"></a><span id="l8.437">     let message;</span>
<a href="#l8.438"></a><span id="l8.438">     let parse = aParse == null ? true : aParse;</span>
<a href="#l8.439"></a><span id="l8.439">     let mode = aMode == null ? this.kSubscribeMode : aMode;</span>
<a href="#l8.440"></a><span id="l8.440">     let locationValue = document.getElementById(&quot;locationValue&quot;);</span>
<a href="#l8.441"></a><span id="l8.441">     let quickMode = aParams &amp;&amp; (&quot;quickMode&quot; in aParams) ?</span>
<a href="#l8.442"></a><span id="l8.442">         aParams.quickMode : document.getElementById(&quot;quickMode&quot;).checked;</span>
<a href="#l8.443"></a><span id="l8.443">     let name = aParams &amp;&amp; (&quot;name&quot; in aParams) ?</span>
<a href="#l8.444"></a><span id="l8.444">         aParams.name : document.getElementById(&quot;nameValue&quot;).value;</span>
<a href="#l8.445"></a><span id="l8.445" class="difflineplus">+    let options = aParams &amp;&amp; (&quot;options&quot; in aParams) ?</span>
<a href="#l8.446"></a><span id="l8.446" class="difflineplus">+        aParams.options : null;</span>
<a href="#l8.447"></a><span id="l8.447"> </span>
<a href="#l8.448"></a><span id="l8.448">     if (aFeedLocation)</span>
<a href="#l8.449"></a><span id="l8.449">       locationValue.value = aFeedLocation;</span>
<a href="#l8.450"></a><span id="l8.450">     let feedLocation = locationValue.value.trim();</span>
<a href="#l8.451"></a><span id="l8.451"> </span>
<a href="#l8.452"></a><span id="l8.452">     if (!feedLocation)</span>
<a href="#l8.453"></a><span id="l8.453">     {</span>
<a href="#l8.454"></a><span id="l8.454">       message = locationValue.getAttribute(&quot;placeholder&quot;);</span>
<a href="#l8.455"></a><span id="l8.455" class="difflineat">@@ -1198,22 +1305,32 @@ var FeedSubscriptions = {</span>
<a href="#l8.456"></a><span id="l8.456">     if (FeedUtils.feedAlreadyExists(feedLocation, addFolder.server))</span>
<a href="#l8.457"></a><span id="l8.457">     {</span>
<a href="#l8.458"></a><span id="l8.458">       message = FeedUtils.strings.GetStringFromName(</span>
<a href="#l8.459"></a><span id="l8.459">                   &quot;subscribe-feedAlreadySubscribed&quot;);</span>
<a href="#l8.460"></a><span id="l8.460">       this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l8.461"></a><span id="l8.461">       return false;</span>
<a href="#l8.462"></a><span id="l8.462">     }</span>
<a href="#l8.463"></a><span id="l8.463"> </span>
<a href="#l8.464"></a><span id="l8.464" class="difflineplus">+    if (!options)</span>
<a href="#l8.465"></a><span id="l8.465" class="difflineplus">+    {</span>
<a href="#l8.466"></a><span id="l8.466" class="difflineplus">+      // Not passed a param, get values from the ui.</span>
<a href="#l8.467"></a><span id="l8.467" class="difflineplus">+      options = FeedUtils.optionsTemplate;</span>
<a href="#l8.468"></a><span id="l8.468" class="difflineplus">+      options.category.enabled = document.getElementById(&quot;autotagEnable&quot;).checked;</span>
<a href="#l8.469"></a><span id="l8.469" class="difflineplus">+      options.category.prefixEnabled = document.getElementById(&quot;autotagUsePrefix&quot;).checked;</span>
<a href="#l8.470"></a><span id="l8.470" class="difflineplus">+      options.category.prefix = document.getElementById(&quot;autotagPrefix&quot;).value;</span>
<a href="#l8.471"></a><span id="l8.471" class="difflineplus">+    }</span>
<a href="#l8.472"></a><span id="l8.472" class="difflineplus">+</span>
<a href="#l8.473"></a><span id="l8.473">     let folderURI = addFolder.isServer ? null : addFolder.URI;</span>
<a href="#l8.474"></a><span id="l8.474">     let feedProperties = { feedName     : name,</span>
<a href="#l8.475"></a><span id="l8.475">                            feedLocation : feedLocation,</span>
<a href="#l8.476"></a><span id="l8.476">                            folderURI    : folderURI,</span>
<a href="#l8.477"></a><span id="l8.477">                            server       : addFolder.server,</span>
<a href="#l8.478"></a><span id="l8.478" class="difflineminus">-                           quickMode    : quickMode };</span>
<a href="#l8.479"></a><span id="l8.479" class="difflineplus">+                           quickMode    : quickMode,</span>
<a href="#l8.480"></a><span id="l8.480" class="difflineplus">+                           options      : options };</span>
<a href="#l8.481"></a><span id="l8.481"> </span>
<a href="#l8.482"></a><span id="l8.482">     let feed = this.storeFeed(feedProperties);</span>
<a href="#l8.483"></a><span id="l8.483">     if (!feed)</span>
<a href="#l8.484"></a><span id="l8.484">       return false;</span>
<a href="#l8.485"></a><span id="l8.485"> </span>
<a href="#l8.486"></a><span id="l8.486">     // Now validate and start downloading the feed.</span>
<a href="#l8.487"></a><span id="l8.487">     message = FeedUtils.strings.GetStringFromName(&quot;subscribe-validating-feed&quot;);</span>
<a href="#l8.488"></a><span id="l8.488">     this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l8.489"></a><span id="l8.489" class="difflineat">@@ -1239,41 +1356,62 @@ var FeedSubscriptions = {</span>
<a href="#l8.490"></a><span id="l8.490">         let folder = folderResource.QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l8.491"></a><span id="l8.491">         if (folder &amp;&amp; !folder.isServer)</span>
<a href="#l8.492"></a><span id="l8.492">           feed.folder = folder;</span>
<a href="#l8.493"></a><span id="l8.493">       }</span>
<a href="#l8.494"></a><span id="l8.494">     }</span>
<a href="#l8.495"></a><span id="l8.495"> </span>
<a href="#l8.496"></a><span id="l8.496">     feed.title = feedProperties.feedName;</span>
<a href="#l8.497"></a><span id="l8.497">     feed.quickMode = feedProperties.quickMode;</span>
<a href="#l8.498"></a><span id="l8.498" class="difflineplus">+    feed.options = feedProperties.options;</span>
<a href="#l8.499"></a><span id="l8.499">     return feed;</span>
<a href="#l8.500"></a><span id="l8.500">   },</span>
<a href="#l8.501"></a><span id="l8.501"> </span>
<a href="#l8.502"></a><span id="l8.502" class="difflineplus">+  updateAccount: function(aItem)</span>
<a href="#l8.503"></a><span id="l8.503" class="difflineplus">+  {</span>
<a href="#l8.504"></a><span id="l8.504" class="difflineplus">+    // Check to see if the categoryPrefs custom prefix string value changed.</span>
<a href="#l8.505"></a><span id="l8.505" class="difflineplus">+    let editAutotagPrefix = document.getElementById(&quot;autotagPrefix&quot;).value;</span>
<a href="#l8.506"></a><span id="l8.506" class="difflineplus">+    if (aItem.options.category.prefix != editAutotagPrefix)</span>
<a href="#l8.507"></a><span id="l8.507" class="difflineplus">+    {</span>
<a href="#l8.508"></a><span id="l8.508" class="difflineplus">+      aItem.options.category.prefix = editAutotagPrefix;</span>
<a href="#l8.509"></a><span id="l8.509" class="difflineplus">+      FeedUtils.setOptionsAcct(aItem.folder.server, aItem.options)</span>
<a href="#l8.510"></a><span id="l8.510" class="difflineplus">+      let message = FeedUtils.strings.GetStringFromName(&quot;subscribe-feedUpdated&quot;);</span>
<a href="#l8.511"></a><span id="l8.511" class="difflineplus">+      this.updateStatusItem(&quot;statusText&quot;, message);</span>
<a href="#l8.512"></a><span id="l8.512" class="difflineplus">+    }</span>
<a href="#l8.513"></a><span id="l8.513" class="difflineplus">+  },</span>
<a href="#l8.514"></a><span id="l8.514" class="difflineplus">+</span>
<a href="#l8.515"></a><span id="l8.515">   editFeed: function()</span>
<a href="#l8.516"></a><span id="l8.516">   {</span>
<a href="#l8.517"></a><span id="l8.517">     let seln = this.mView.selection;</span>
<a href="#l8.518"></a><span id="l8.518">     if (seln.count != 1)</span>
<a href="#l8.519"></a><span id="l8.519">       return;</span>
<a href="#l8.520"></a><span id="l8.520"> </span>
<a href="#l8.521"></a><span id="l8.521">     let itemToEdit = this.mView.getItemAtIndex(seln.currentIndex);</span>
<a href="#l8.522"></a><span id="l8.522" class="difflineplus">+    if (itemToEdit.folder &amp;&amp; itemToEdit.folder.isServer)</span>
<a href="#l8.523"></a><span id="l8.523" class="difflineplus">+    {</span>
<a href="#l8.524"></a><span id="l8.524" class="difflineplus">+      this.updateAccount(itemToEdit)</span>
<a href="#l8.525"></a><span id="l8.525" class="difflineplus">+      return;</span>
<a href="#l8.526"></a><span id="l8.526" class="difflineplus">+    }</span>
<a href="#l8.527"></a><span id="l8.527" class="difflineplus">+</span>
<a href="#l8.528"></a><span id="l8.528">     if (!itemToEdit || itemToEdit.container || !itemToEdit.parentFolder)</span>
<a href="#l8.529"></a><span id="l8.529">       return;</span>
<a href="#l8.530"></a><span id="l8.530"> </span>
<a href="#l8.531"></a><span id="l8.531">     let resource = FeedUtils.rdf.GetResource(itemToEdit.url);</span>
<a href="#l8.532"></a><span id="l8.532">     let currentFolderServer = itemToEdit.parentFolder.server;</span>
<a href="#l8.533"></a><span id="l8.533">     let ds = FeedUtils.getSubscriptionsDS(currentFolderServer);</span>
<a href="#l8.534"></a><span id="l8.534">     let currentFolder = ds.GetTarget(resource, FeedUtils.FZ_DESTFOLDER, true);</span>
<a href="#l8.535"></a><span id="l8.535">     let currentFolderURI = currentFolder.QueryInterface(Ci.nsIRDFResource).Value;</span>
<a href="#l8.536"></a><span id="l8.536">     let feed = new Feed(resource, currentFolderServer);</span>
<a href="#l8.537"></a><span id="l8.537">     feed.folder = itemToEdit.parentFolder;</span>
<a href="#l8.538"></a><span id="l8.538"> </span>
<a href="#l8.539"></a><span id="l8.539">     let editNameValue = document.getElementById(&quot;nameValue&quot;).value;</span>
<a href="#l8.540"></a><span id="l8.540">     let editFeedLocation = document.getElementById(&quot;locationValue&quot;).value.trim();</span>
<a href="#l8.541"></a><span id="l8.541">     let selectFolder = document.getElementById(&quot;selectFolder&quot;);</span>
<a href="#l8.542"></a><span id="l8.542">     let editQuickMode = document.getElementById(&quot;quickMode&quot;).checked;</span>
<a href="#l8.543"></a><span id="l8.543" class="difflineplus">+    let editAutotagPrefix = document.getElementById(&quot;autotagPrefix&quot;).value;</span>
<a href="#l8.544"></a><span id="l8.544"> </span>
<a href="#l8.545"></a><span id="l8.545">     if (feed.url != editFeedLocation)</span>
<a href="#l8.546"></a><span id="l8.546">     {</span>
<a href="#l8.547"></a><span id="l8.547">       // Updating a url.  We need to add the new url and delete the old, to</span>
<a href="#l8.548"></a><span id="l8.548">       // ensure everything is cleaned up correctly.</span>
<a href="#l8.549"></a><span id="l8.549">       this.addFeed(null, itemToEdit.parentFolder, false, null, this.kUpdateMode)</span>
<a href="#l8.550"></a><span id="l8.550">       return;</span>
<a href="#l8.551"></a><span id="l8.551">     }</span>
<a href="#l8.552"></a><span id="l8.552" class="difflineat">@@ -1298,16 +1436,24 @@ var FeedSubscriptions = {</span>
<a href="#l8.553"></a><span id="l8.553">     // Check to see if the quickMode value changed.</span>
<a href="#l8.554"></a><span id="l8.554">     if (feed.quickMode != editQuickMode)</span>
<a href="#l8.555"></a><span id="l8.555">     {</span>
<a href="#l8.556"></a><span id="l8.556">       feed.quickMode = editQuickMode;</span>
<a href="#l8.557"></a><span id="l8.557">       itemToEdit.quickMode = editQuickMode;</span>
<a href="#l8.558"></a><span id="l8.558">       updated = true;</span>
<a href="#l8.559"></a><span id="l8.559">     }</span>
<a href="#l8.560"></a><span id="l8.560"> </span>
<a href="#l8.561"></a><span id="l8.561" class="difflineplus">+    // Check to see if the categoryPrefs custom prefix string value changed.</span>
<a href="#l8.562"></a><span id="l8.562" class="difflineplus">+    if (itemToEdit.options.category.prefix != editAutotagPrefix)</span>
<a href="#l8.563"></a><span id="l8.563" class="difflineplus">+    {</span>
<a href="#l8.564"></a><span id="l8.564" class="difflineplus">+      itemToEdit.options.category.prefix = editAutotagPrefix;</span>
<a href="#l8.565"></a><span id="l8.565" class="difflineplus">+      feed.options = itemToEdit.options;</span>
<a href="#l8.566"></a><span id="l8.566" class="difflineplus">+      updated = true;</span>
<a href="#l8.567"></a><span id="l8.567" class="difflineplus">+    }</span>
<a href="#l8.568"></a><span id="l8.568" class="difflineplus">+</span>
<a href="#l8.569"></a><span id="l8.569">     // Did the user change the folder URI for storing the feed?</span>
<a href="#l8.570"></a><span id="l8.570">     let editFolderURI = selectFolder.getAttribute(&quot;uri&quot;);</span>
<a href="#l8.571"></a><span id="l8.571">     if (currentFolderURI != editFolderURI)</span>
<a href="#l8.572"></a><span id="l8.572">     {</span>
<a href="#l8.573"></a><span id="l8.573">       // Make sure the new folderpicked folder is visible.</span>
<a href="#l8.574"></a><span id="l8.574">       this.selectFolder(selectFolder._folder);</span>
<a href="#l8.575"></a><span id="l8.575">       // Now go back to the feed item.</span>
<a href="#l8.576"></a><span id="l8.576">       this.selectFeed(feed, null);</span>
<a href="#l8.577"></a><span id="l8.577" class="difflineat">@@ -1384,17 +1530,18 @@ var FeedSubscriptions = {</span>
<a href="#l8.578"></a><span id="l8.578">     }</span>
<a href="#l8.579"></a><span id="l8.579">     else</span>
<a href="#l8.580"></a><span id="l8.580">     {</span>
<a href="#l8.581"></a><span id="l8.581">       // Moving/copying to a new account.  If dropping on the account folder,</span>
<a href="#l8.582"></a><span id="l8.582">       // a new subfolder is created if necessary.</span>
<a href="#l8.583"></a><span id="l8.583">       accountMoveCopy = true;</span>
<a href="#l8.584"></a><span id="l8.584">       let mode = moveFeed ? this.kMoveMode : this.kCopyMode;</span>
<a href="#l8.585"></a><span id="l8.585">       let params = {quickMode: currentItem.quickMode,</span>
<a href="#l8.586"></a><span id="l8.586" class="difflineminus">-                    name:      currentItem.name};</span>
<a href="#l8.587"></a><span id="l8.587" class="difflineplus">+                    name:      currentItem.name,</span>
<a href="#l8.588"></a><span id="l8.588" class="difflineplus">+                    options:   currentItem.options};</span>
<a href="#l8.589"></a><span id="l8.589">       // Subscribe to the new folder first.  If it already exists in the</span>
<a href="#l8.590"></a><span id="l8.590">       // account or on error, return.</span>
<a href="#l8.591"></a><span id="l8.591">       if (!this.addFeed(currentItem.url, newFolder, false, params, mode))</span>
<a href="#l8.592"></a><span id="l8.592">         return;</span>
<a href="#l8.593"></a><span id="l8.593">       // Unsubscribe the feed from the old folder, if add to the new folder</span>
<a href="#l8.594"></a><span id="l8.594">       // is successfull, and doing a move.</span>
<a href="#l8.595"></a><span id="l8.595">       if (moveFeed)</span>
<a href="#l8.596"></a><span id="l8.596">         FeedUtils.deleteFeed(FeedUtils.rdf.GetResource(currentItem.url),</span>
<a href="#l8.597"></a><span id="l8.597" class="difflineat">@@ -2076,21 +2223,21 @@ var FeedSubscriptions = {</span>
<a href="#l8.598"></a><span id="l8.598">         FeedUtils.log.debug(&quot;generateOutlineList: has subfolders - &quot; +</span>
<a href="#l8.599"></a><span id="l8.599">                             folder.name);</span>
<a href="#l8.600"></a><span id="l8.600">         // Recurse.</span>
<a href="#l8.601"></a><span id="l8.601">         this.generateOutlineList(folder, parent, indentLevel);</span>
<a href="#l8.602"></a><span id="l8.602">       }</span>
<a href="#l8.603"></a><span id="l8.603"> </span>
<a href="#l8.604"></a><span id="l8.604">       // Add outline elements with xmlUrls.</span>
<a href="#l8.605"></a><span id="l8.605">       let feeds = this.getFeedsInFolder(folder);</span>
<a href="#l8.606"></a><span id="l8.606" class="difflineminus">-      for (let feed in feeds)</span>
<a href="#l8.607"></a><span id="l8.607" class="difflineplus">+      for (let feed of feeds)</span>
<a href="#l8.608"></a><span id="l8.608">       {</span>
<a href="#l8.609"></a><span id="l8.609">         FeedUtils.log.debug(&quot;generateOutlineList: folder has FEED url - &quot; +</span>
<a href="#l8.610"></a><span id="l8.610" class="difflineminus">-                            folder.name + &quot; : &quot; + feeds[feed].url);</span>
<a href="#l8.611"></a><span id="l8.611" class="difflineminus">-        feedOutline = this.exportOPMLOutline(feeds[feed], parent.ownerDocument);</span>
<a href="#l8.612"></a><span id="l8.612" class="difflineplus">+                            folder.name + &quot; : &quot; + feed.url);</span>
<a href="#l8.613"></a><span id="l8.613" class="difflineplus">+        feedOutline = this.exportOPMLOutline(feed, parent.ownerDocument);</span>
<a href="#l8.614"></a><span id="l8.614">         this.generatePPSpace(parent, indentString);</span>
<a href="#l8.615"></a><span id="l8.615">         parent.appendChild(feedOutline);</span>
<a href="#l8.616"></a><span id="l8.616">       }</span>
<a href="#l8.617"></a><span id="l8.617">     }</span>
<a href="#l8.618"></a><span id="l8.618">   },</span>
<a href="#l8.619"></a><span id="l8.619"> </span>
<a href="#l8.620"></a><span id="l8.620">   generateOutlineStruct: function(baseFolder, parent, indentLevel)</span>
<a href="#l8.621"></a><span id="l8.621">   {</span>
<a href="#l8.622"></a><span id="l8.622" class="difflineat">@@ -2121,38 +2268,39 @@ var FeedSubscriptions = {</span>
<a href="#l8.623"></a><span id="l8.623">       {</span>
<a href="#l8.624"></a><span id="l8.624">         FeedUtils.log.debug(&quot;generateOutlineStruct: has subfolders - &quot; +</span>
<a href="#l8.625"></a><span id="l8.625">                             folder.name);</span>
<a href="#l8.626"></a><span id="l8.626">         // Recurse.</span>
<a href="#l8.627"></a><span id="l8.627">         this.generateOutlineStruct(folder, folderOutline, indentLevel + 2);</span>
<a href="#l8.628"></a><span id="l8.628">       }</span>
<a href="#l8.629"></a><span id="l8.629"> </span>
<a href="#l8.630"></a><span id="l8.630">       let feeds = this.getFeedsInFolder(folder);</span>
<a href="#l8.631"></a><span id="l8.631" class="difflineminus">-      for (let feed in feeds)</span>
<a href="#l8.632"></a><span id="l8.632" class="difflineplus">+      for (let feed of feeds)</span>
<a href="#l8.633"></a><span id="l8.633">       {</span>
<a href="#l8.634"></a><span id="l8.634">         // Add feed outline elements with xmlUrls.</span>
<a href="#l8.635"></a><span id="l8.635">         FeedUtils.log.debug(&quot;generateOutlineStruct: folder has FEED url - &quot;+</span>
<a href="#l8.636"></a><span id="l8.636" class="difflineminus">-                            folder.name + &quot; : &quot; + feeds[feed].url);</span>
<a href="#l8.637"></a><span id="l8.637" class="difflineminus">-        feedOutline = this.exportOPMLOutline(feeds[feed], parent.ownerDocument);</span>
<a href="#l8.638"></a><span id="l8.638" class="difflineplus">+                            folder.name + &quot; : &quot; + feed.url);</span>
<a href="#l8.639"></a><span id="l8.639" class="difflineplus">+        feedOutline = this.exportOPMLOutline(feed, parent.ownerDocument);</span>
<a href="#l8.640"></a><span id="l8.640">         this.generatePPSpace(folderOutline, indentString(indentLevel + 4));</span>
<a href="#l8.641"></a><span id="l8.641">         folderOutline.appendChild(feedOutline);</span>
<a href="#l8.642"></a><span id="l8.642">       }</span>
<a href="#l8.643"></a><span id="l8.643"> </span>
<a href="#l8.644"></a><span id="l8.644">       parent.appendChild(folderOutline);</span>
<a href="#l8.645"></a><span id="l8.645">     }</span>
<a href="#l8.646"></a><span id="l8.646">   },</span>
<a href="#l8.647"></a><span id="l8.647"> </span>
<a href="#l8.648"></a><span id="l8.648">   exportOPMLOutline: function(aFeed, aDoc)</span>
<a href="#l8.649"></a><span id="l8.649">   {</span>
<a href="#l8.650"></a><span id="l8.650">     let outRv = aDoc.createElement(&quot;outline&quot;);</span>
<a href="#l8.651"></a><span id="l8.651">     outRv.setAttribute(&quot;type&quot;, &quot;rss&quot;);</span>
<a href="#l8.652"></a><span id="l8.652">     outRv.setAttribute(&quot;title&quot;, aFeed.title);</span>
<a href="#l8.653"></a><span id="l8.653">     outRv.setAttribute(&quot;text&quot;, aFeed.title);</span>
<a href="#l8.654"></a><span id="l8.654">     outRv.setAttribute(&quot;version&quot;, &quot;RSS&quot;);</span>
<a href="#l8.655"></a><span id="l8.655">     outRv.setAttribute(&quot;fz:quickMode&quot;, aFeed.quickMode);</span>
<a href="#l8.656"></a><span id="l8.656" class="difflineplus">+    outRv.setAttribute(&quot;fz:options&quot;, JSON.stringify(aFeed.options));</span>
<a href="#l8.657"></a><span id="l8.657">     outRv.setAttribute(&quot;xmlUrl&quot;, aFeed.url);</span>
<a href="#l8.658"></a><span id="l8.658">     outRv.setAttribute(&quot;htmlUrl&quot;, aFeed.link);</span>
<a href="#l8.659"></a><span id="l8.659">     return outRv;</span>
<a href="#l8.660"></a><span id="l8.660">   },</span>
<a href="#l8.661"></a><span id="l8.661"> </span>
<a href="#l8.662"></a><span id="l8.662">   importOPML: function()</span>
<a href="#l8.663"></a><span id="l8.663">   {</span>
<a href="#l8.664"></a><span id="l8.664">     // Account folder must be selected in subscribe dialog.</span>
<a href="#l8.665"></a><span id="l8.665" class="difflineat">@@ -2311,33 +2459,36 @@ var FeedSubscriptions = {</span>
<a href="#l8.666"></a><span id="l8.666">             // parent of feed's folder.</span>
<a href="#l8.667"></a><span id="l8.667">             // NOTE: Assume a type=rss outline must be a leaf and is not a</span>
<a href="#l8.668"></a><span id="l8.668">             // direct parent of another type=rss outline; such a structure</span>
<a href="#l8.669"></a><span id="l8.669">             // may lead to unintended nesting and inaccurate counts.</span>
<a href="#l8.670"></a><span id="l8.670">           }</span>
<a href="#l8.671"></a><span id="l8.671"> </span>
<a href="#l8.672"></a><span id="l8.672">           // Create the feed.</span>
<a href="#l8.673"></a><span id="l8.673">           let quickMode = outline.hasAttribute(&quot;fz:quickMode&quot;) ?</span>
<a href="#l8.674"></a><span id="l8.674" class="difflineminus">-                          outline.getAttribute(&quot;fz:quickMode&quot;) == &quot;true&quot; :</span>
<a href="#l8.675"></a><span id="l8.675" class="difflineminus">-                          rssServer.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l8.676"></a><span id="l8.676" class="difflineplus">+                            outline.getAttribute(&quot;fz:quickMode&quot;) == &quot;true&quot; :</span>
<a href="#l8.677"></a><span id="l8.677" class="difflineplus">+                            rssServer.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l8.678"></a><span id="l8.678" class="difflineplus">+          let options = outline.getAttribute(&quot;fz:options&quot;);</span>
<a href="#l8.679"></a><span id="l8.679" class="difflineplus">+          options = options ? JSON.parse(options) : null;</span>
<a href="#l8.680"></a><span id="l8.680"> </span>
<a href="#l8.681"></a><span id="l8.681">           if (firstFeedInFolderQuickMode === null)</span>
<a href="#l8.682"></a><span id="l8.682">             // The summary/web page pref applies to all feeds in a folder,</span>
<a href="#l8.683"></a><span id="l8.683">             // though it is a property of an individual feed.  This can be</span>
<a href="#l8.684"></a><span id="l8.684">             // set (and is obvious) in the subscribe dialog; ensure import</span>
<a href="#l8.685"></a><span id="l8.685">             // doesn't leave mismatches if mismatched in the opml file.</span>
<a href="#l8.686"></a><span id="l8.686">             firstFeedInFolderQuickMode = quickMode;</span>
<a href="#l8.687"></a><span id="l8.687">           else</span>
<a href="#l8.688"></a><span id="l8.688">             quickMode = firstFeedInFolderQuickMode;</span>
<a href="#l8.689"></a><span id="l8.689"> </span>
<a href="#l8.690"></a><span id="l8.690">           let feedProperties = { feedName     : outlineName,</span>
<a href="#l8.691"></a><span id="l8.691">                                  feedLocation : feedUrl,</span>
<a href="#l8.692"></a><span id="l8.692">                                  server       : rssServer,</span>
<a href="#l8.693"></a><span id="l8.693">                                  folderURI    : folderURI,</span>
<a href="#l8.694"></a><span id="l8.694" class="difflineminus">-                                 quickMode    : quickMode };</span>
<a href="#l8.695"></a><span id="l8.695" class="difflineplus">+                                 quickMode    : quickMode,</span>
<a href="#l8.696"></a><span id="l8.696" class="difflineplus">+                                 options      : options };</span>
<a href="#l8.697"></a><span id="l8.697"> </span>
<a href="#l8.698"></a><span id="l8.698">           FeedUtils.log.info(&quot;importOPMLOutlines: importing feed: name, url - &quot;+</span>
<a href="#l8.699"></a><span id="l8.699">                              outlineName + &quot;, &quot; + feedUrl);</span>
<a href="#l8.700"></a><span id="l8.700"> </span>
<a href="#l8.701"></a><span id="l8.701">           let feed = win.storeFeed(feedProperties);</span>
<a href="#l8.702"></a><span id="l8.702">           if (outline.hasAttribute(&quot;htmlUrl&quot;))</span>
<a href="#l8.703"></a><span id="l8.703">             feed.link = outline.getAttribute(&quot;htmlUrl&quot;);</span>
<a href="#l8.704"></a><span id="l8.704"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -121,31 +121,45 @@</span>
<a href="#l9.4"></a><span id="l9.4">                           class=&quot;folderMenuItem&quot;</span>
<a href="#l9.5"></a><span id="l9.5">                           hidden=&quot;true&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6">                   &lt;menupopup id=&quot;selectFolderPopup&quot;</span>
<a href="#l9.7"></a><span id="l9.7">                              class=&quot;menulist-menupopup&quot;</span>
<a href="#l9.8"></a><span id="l9.8">                              type=&quot;folder&quot;</span>
<a href="#l9.9"></a><span id="l9.9">                              mode=&quot;feeds&quot;</span>
<a href="#l9.10"></a><span id="l9.10">                              showFileHereLabel=&quot;true&quot;</span>
<a href="#l9.11"></a><span id="l9.11">                              showAccountsFileHere=&quot;true&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-                             oncommand=&quot;FeedSubscriptions.setFolderPicker(event.target._folder)&quot;/&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+                             oncommand=&quot;FeedSubscriptions.setNewFolder(event.target._folder)&quot;/&gt;</span>
<a href="#l9.14"></a><span id="l9.14">                 &lt;/menulist&gt;</span>
<a href="#l9.15"></a><span id="l9.15">                 &lt;textbox id=&quot;selectFolderValue&quot;</span>
<a href="#l9.16"></a><span id="l9.16">                          flex=&quot;1&quot;</span>
<a href="#l9.17"></a><span id="l9.17">                          readonly=&quot;true&quot;</span>
<a href="#l9.18"></a><span id="l9.18">                          onkeypress=&quot;FeedSubscriptions.onClickSelectFolderValue(event)&quot;</span>
<a href="#l9.19"></a><span id="l9.19">                          onclick=&quot;FeedSubscriptions.onClickSelectFolderValue(event)&quot;/&gt;</span>
<a href="#l9.20"></a><span id="l9.20">               &lt;/hbox&gt;</span>
<a href="#l9.21"></a><span id="l9.21">             &lt;/row&gt;</span>
<a href="#l9.22"></a><span id="l9.22">           &lt;/rows&gt;</span>
<a href="#l9.23"></a><span id="l9.23">         &lt;/grid&gt;</span>
<a href="#l9.24"></a><span id="l9.24">         &lt;checkbox id=&quot;quickMode&quot;</span>
<a href="#l9.25"></a><span id="l9.25">                   accesskey=&quot;&amp;quickMode.accesskey;&quot;</span>
<a href="#l9.26"></a><span id="l9.26">                   label=&quot;&amp;quickMode.label;&quot;</span>
<a href="#l9.27"></a><span id="l9.27">                   oncommand=&quot;FeedSubscriptions.setSummary(this.checked)&quot;/&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+        &lt;checkbox id=&quot;autotagEnable&quot;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+                  accesskey=&quot;&amp;autotagEnable.accesskey;&quot;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+                  label=&quot;&amp;autotagEnable.label;&quot;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+                  oncommand=&quot;FeedSubscriptions.setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+            &lt;checkbox id=&quot;autotagUsePrefix&quot;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+                      class=&quot;indent&quot;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+                      accesskey=&quot;&amp;autotagUsePrefix.accesskey;&quot;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+                      label=&quot;&amp;autotagUsePrefix.label;&quot;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+                      oncommand=&quot;FeedSubscriptions.setCategoryPrefs(this)&quot;/&gt;</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+            &lt;textbox id=&quot;autotagPrefix&quot;</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+                     placeholder=&quot;&amp;autoTagPrefix.placeholder;&quot;</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+                     clickSelectsAll=&quot;true&quot;/&gt;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l9.42"></a><span id="l9.42">       &lt;/vbox&gt;</span>
<a href="#l9.43"></a><span id="l9.43">     &lt;/hbox&gt;</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45">     &lt;hbox id=&quot;statusContainerBox&quot;</span>
<a href="#l9.46"></a><span id="l9.46">           align=&quot;center&quot;</span>
<a href="#l9.47"></a><span id="l9.47">           valign=&quot;middle&quot;&gt;</span>
<a href="#l9.48"></a><span id="l9.48">       &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l9.49"></a><span id="l9.49">         &lt;description id=&quot;statusText&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/extensions/newsblog/js/newsblog.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/js/newsblog.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -186,16 +186,17 @@ var nsNewsBlogFeedDownloader =</span>
<a href="#l10.4"></a><span id="l10.4">       aMsgWindow.statusFeedback.showStatusString(</span>
<a href="#l10.5"></a><span id="l10.5">         FeedUtils.strings.GetStringFromName(&quot;subscribe-feedAlreadySubscribed&quot;));</span>
<a href="#l10.6"></a><span id="l10.6">       return;</span>
<a href="#l10.7"></a><span id="l10.7">     }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">     let itemResource = FeedUtils.rdf.GetResource(aUrl);</span>
<a href="#l10.10"></a><span id="l10.10">     let feed = new Feed(itemResource, aFolder.server);</span>
<a href="#l10.11"></a><span id="l10.11">     feed.quickMode = feed.server.getBoolValue(&quot;quickMode&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+    feed.options = FeedUtils.getOptionsAcct(feed.server);</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14">     // If the root server, create a new folder for the feed.  The user must</span>
<a href="#l10.15"></a><span id="l10.15">     // want us to add this subscription url to an existing RSS folder.</span>
<a href="#l10.16"></a><span id="l10.16">     if (!aFolder.isServer)</span>
<a href="#l10.17"></a><span id="l10.17">       feed.folder = aFolder;</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">     FeedUtils.progressNotifier.init(aMsgWindow, true);</span>
<a href="#l10.20"></a><span id="l10.20">     FeedUtils.progressNotifier.mNumPendingFeedDownloads++;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

