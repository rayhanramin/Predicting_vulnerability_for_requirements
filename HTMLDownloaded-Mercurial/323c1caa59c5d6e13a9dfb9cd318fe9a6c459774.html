<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26868:323c1caa59c5d6e13a9dfb9cd318fe9a6c459774</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 323c1caa59c5d6e13a9dfb9cd318fe9a6c459774" />
<meta property="og:url" content="/comm-central/rev/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774" />
<meta property="og:description" content="Bug 1557829 - Port bug 1557793 - Adapt to array changes in nsIStringBundle.formatStringFromName. rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 323c1caa59c5d6e13a9dfb9cd318fe9a6c459774 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">shortlog</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">files</a> |
changeset |
<a href="/comm-central/raw-rev/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">raw</a>  | <a href="/comm-central/archive/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557829">Bug 1557829</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557793">bug 1557793</a> - Adapt to array changes in nsIStringBundle.formatStringFromName. rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 11 Jun 2019 17:54:08 +0200</td></tr>

<tr>
 <td>changeset 26868</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">323c1caa59c5d6e13a9dfb9cd318fe9a6c459774</a></td>
</tr>



<tr>
<td>parent 26867</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b27953c5a381358c0480d73971a5c91adabecb1e">b27953c5a381358c0480d73971a5c91adabecb1e</a>
</td>
</tr>

<tr>
<td>child 26869</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/be5c06a3f4d225c6147368b89f3baa05ccc3dfc7">be5c06a3f4d225c6147368b89f3baa05ccc3dfc7</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=323c1caa59c5d6e13a9dfb9cd318fe9a6c459774">16034</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 11 Jun 2019 22:20:26 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@be5c06a3f4d2 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=be5c06a3f4d225c6147368b89f3baa05ccc3dfc7">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=be5c06a3f4d225c6147368b89f3baa05ccc3dfc7&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=be5c06a3f4d225c6147368b89f3baa05ccc3dfc7&newProject=comm-central&newRevision=323c1caa59c5d6e13a9dfb9cd318fe9a6c459774&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=be5c06a3f4d225c6147368b89f3baa05ccc3dfc7&newProject=comm-central&newRevision=323c1caa59c5d6e13a9dfb9cd318fe9a6c459774&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=be5c06a3f4d225c6147368b89f3baa05ccc3dfc7&newProject=comm-central&newRevision=323c1caa59c5d6e13a9dfb9cd318fe9a6c459774&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557829">1557829</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557793">1557793</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557829">Bug 1557829</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557793">bug 1557793</a> - Adapt to array changes in nsIStringBundle.formatStringFromName. rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbView.cpp">mailnews/addrbook/src/nsAbView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbView.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbView.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbView.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbView.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAbView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.h">mailnews/addrbook/src/nsAddrDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/addrbook/src/nsAddrDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilter.cpp">mailnews/base/search/src/nsMsgFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilter.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilter.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilter.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilter.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgStatusFeedback.cpp">mailnews/base/src/nsMsgStatusFeedback.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgStatusFeedback.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgStatusFeedback.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgStatusFeedback.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgStatusFeedback.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsMsgStatusFeedback.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgPrompts.cpp">mailnews/compose/src/nsMsgPrompts.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgPrompts.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgPrompts.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgPrompts.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgPrompts.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgPrompts.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.h">mailnews/compose/src/nsSmtpProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/compose/src/nsSmtpProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">mailnews/extensions/mdn/src/nsMsgMdnGenerator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.h">mailnews/extensions/smime/src/nsMsgComposeSecure.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/extensions/smime/src/nsMsgComposeSecure.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyMail.cpp">mailnews/import/becky/src/nsBeckyMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyMail.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyMail.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyMail.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyMail.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.cpp">mailnews/import/becky/src/nsBeckyStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.h">mailnews/import/becky/src/nsBeckyStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/becky/src/nsBeckyStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.h">mailnews/local/src/nsMovemailService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsMovemailService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.h">mailnews/local/src/nsPop3Protocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Protocol.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mapi/mapihook/src/msgMapiHook.cpp">mailnews/mapi/mapihook/src/msgMapiHook.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mapi/mapihook/src/msgMapiHook.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mapi/mapihook/src/msgMapiHook.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mapi/mapihook/src/msgMapiHook.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mapi/mapihook/src/msgMapiHook.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mapi/mapihook/src/msgMapiHook.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.h">mailnews/news/src/nsNNTPNewsgroupList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.h">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.h">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.h">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.h">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPNewsgroupList.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsDownloader.cpp">mailnews/news/src/nsNewsDownloader.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsDownloader.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsDownloader.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsDownloader.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsDownloader.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsDownloader.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/323c1caa59c5d6e13a9dfb9cd318fe9a6c459774/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1042,38 +1042,34 @@ nsresult nsAbCardProperty::AppendCitySta</span>
<a href="#l1.4"></a><span id="l1.4">   item.mColumn = zipPropName;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   rv = AppendLine(item, aConv, zipResult);</span>
<a href="#l1.7"></a><span id="l1.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">   nsString formattedString;</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   if (!cityResult.IsEmpty() &amp;&amp; !stateResult.IsEmpty() &amp;&amp; !zipResult.IsEmpty()) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    const char16_t *formatStrings[] = {cityResult.get(), stateResult.get(),</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                                       zipResult.get()};</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    AutoTArray&lt;nsString, 3&gt; formatStrings = {cityResult, stateResult,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+                                             zipResult};</span>
<a href="#l1.16"></a><span id="l1.16">     rv = aBundle-&gt;FormatStringFromName(&quot;cityAndStateAndZip&quot;, formatStrings,</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-                                       ArrayLength(formatStrings),</span>
<a href="#l1.18"></a><span id="l1.18">                                        formattedString);</span>
<a href="#l1.19"></a><span id="l1.19">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.20"></a><span id="l1.20">   } else if (!cityResult.IsEmpty() &amp;&amp; !stateResult.IsEmpty() &amp;&amp;</span>
<a href="#l1.21"></a><span id="l1.21">              zipResult.IsEmpty()) {</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-    const char16_t *formatStrings[] = {cityResult.get(), stateResult.get()};</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; formatStrings = {cityResult, stateResult};</span>
<a href="#l1.24"></a><span id="l1.24">     rv = aBundle-&gt;FormatStringFromName(&quot;cityAndStateNoZip&quot;, formatStrings,</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-                                       ArrayLength(formatStrings),</span>
<a href="#l1.26"></a><span id="l1.26">                                        formattedString);</span>
<a href="#l1.27"></a><span id="l1.27">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.28"></a><span id="l1.28">   } else if ((!cityResult.IsEmpty() &amp;&amp; stateResult.IsEmpty() &amp;&amp;</span>
<a href="#l1.29"></a><span id="l1.29">               !zipResult.IsEmpty()) ||</span>
<a href="#l1.30"></a><span id="l1.30">              (cityResult.IsEmpty() &amp;&amp; !stateResult.IsEmpty() &amp;&amp;</span>
<a href="#l1.31"></a><span id="l1.31">               !zipResult.IsEmpty())) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    const char16_t *formatStrings[] = {</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-        cityResult.IsEmpty() ? stateResult.get() : cityResult.get(),</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-        zipResult.get()};</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; formatStrings = {</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+        cityResult.IsEmpty() ? stateResult : cityResult, zipResult};</span>
<a href="#l1.37"></a><span id="l1.37">     rv = aBundle-&gt;FormatStringFromName(&quot;cityOrStateAndZip&quot;, formatStrings,</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-                                       ArrayLength(formatStrings),</span>
<a href="#l1.39"></a><span id="l1.39">                                        formattedString);</span>
<a href="#l1.40"></a><span id="l1.40">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.41"></a><span id="l1.41">   } else {</span>
<a href="#l1.42"></a><span id="l1.42">     if (!cityResult.IsEmpty())</span>
<a href="#l1.43"></a><span id="l1.43">       formattedString = cityResult;</span>
<a href="#l1.44"></a><span id="l1.44">     else if (!stateResult.IsEmpty())</span>
<a href="#l1.45"></a><span id="l1.45">       formattedString = stateResult;</span>
<a href="#l1.46"></a><span id="l1.46">     else</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineat">@@ -1114,25 +1110,25 @@ NS_IMETHODIMP nsAbCardProperty::Generate</span>
<a href="#l1.48"></a><span id="l1.48">       rv = stringBundleService-&gt;CreateBundle(sAddrbookProperties,</span>
<a href="#l1.49"></a><span id="l1.49">                                              getter_AddRefs(bundle));</span>
<a href="#l1.50"></a><span id="l1.50">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.51"></a><span id="l1.51">     }</span>
<a href="#l1.52"></a><span id="l1.52"> </span>
<a href="#l1.53"></a><span id="l1.53">     nsString result;</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55">     if (aGenerateFormat == GENERATE_LAST_FIRST_ORDER) {</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-      const char16_t *stringParams[2] = {lastName.get(), firstName.get()};</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+      AutoTArray&lt;nsString, 2&gt; stringParams = {lastName, firstName};</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;lastFirstFormat&quot;, stringParams, 2,</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-                                        result);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+      rv =</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+          bundle-&gt;FormatStringFromName(&quot;lastFirstFormat&quot;, stringParams, result);</span>
<a href="#l1.63"></a><span id="l1.63">     } else {</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-      const char16_t *stringParams[2] = {firstName.get(), lastName.get()};</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+      AutoTArray&lt;nsString, 2&gt; stringParams = {firstName, lastName};</span>
<a href="#l1.66"></a><span id="l1.66"> </span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;firstLastFormat&quot;, stringParams, 2,</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-                                        result);</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+      rv =</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+          bundle-&gt;FormatStringFromName(&quot;firstLastFormat&quot;, stringParams, result);</span>
<a href="#l1.71"></a><span id="l1.71">     }</span>
<a href="#l1.72"></a><span id="l1.72">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.73"></a><span id="l1.73"> </span>
<a href="#l1.74"></a><span id="l1.74">     aResult.Assign(result);</span>
<a href="#l1.75"></a><span id="l1.75">   }</span>
<a href="#l1.76"></a><span id="l1.76"> </span>
<a href="#l1.77"></a><span id="l1.77">   if (aResult.IsEmpty()) {</span>
<a href="#l1.78"></a><span id="l1.78">     // The normal names have failed, does this card have a company name? If so,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -118,25 +118,24 @@ NS_IMETHODIMP nsAbLDAPListenerBase::OnLD</span>
<a href="#l2.4"></a><span id="l2.4">       InitFailed();</span>
<a href="#l2.5"></a><span id="l2.5">       return rv;</span>
<a href="#l2.6"></a><span id="l2.6">     }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">     // hostTemp is only necessary to work around a code-generation</span>
<a href="#l2.9"></a><span id="l2.9">     // bug in egcs 1.1.2 (the version of gcc that comes with Red Hat 6.2),</span>
<a href="#l2.10"></a><span id="l2.10">     // which is the default compiler for Mozilla on linux at the moment.</span>
<a href="#l2.11"></a><span id="l2.11">     //</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    NS_ConvertASCIItoUTF16 hostTemp(host);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    const char16_t *hostArray[1] = {hostTemp.get()};</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; hostArray;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    CopyASCIItoUTF16(host, *hostArray.AppendElement());</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">     // format the hostname into the authprompt text string</span>
<a href="#l2.18"></a><span id="l2.18">     //</span>
<a href="#l2.19"></a><span id="l2.19">     nsString authPromptText;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-    rv = ldapBundle-&gt;FormatStringFromName(</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-        &quot;authPromptText&quot;, hostArray,</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-        sizeof(hostArray) / sizeof(const char16_t *), authPromptText);</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+    rv = ldapBundle-&gt;FormatStringFromName(&quot;authPromptText&quot;, hostArray,</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+                                          authPromptText);</span>
<a href="#l2.25"></a><span id="l2.25">     if (NS_FAILED(rv)) {</span>
<a href="#l2.26"></a><span id="l2.26">       NS_ERROR(</span>
<a href="#l2.27"></a><span id="l2.27">           &quot;nsAbLDAPListenerBase::OnLDAPInit():&quot;</span>
<a href="#l2.28"></a><span id="l2.28">           &quot;error getting 'authPromptText' string from bundle &quot;</span>
<a href="#l2.29"></a><span id="l2.29">           &quot;chrome://mozldap/locale/ldap.properties&quot;);</span>
<a href="#l2.30"></a><span id="l2.30">       InitFailed();</span>
<a href="#l2.31"></a><span id="l2.31">       return rv;</span>
<a href="#l2.32"></a><span id="l2.32">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -499,21 +499,21 @@ NS_IMETHODIMP nsAbManager::ExportAddress</span>
<a href="#l3.4"></a><span id="l3.4">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l3.5"></a><span id="l3.5">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l3.6"></a><span id="l3.6">       &quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;,</span>
<a href="#l3.7"></a><span id="l3.7">       getter_AddRefs(bundle));</span>
<a href="#l3.8"></a><span id="l3.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   nsString dirName;</span>
<a href="#l3.11"></a><span id="l3.11">   aDirectory-&gt;GetDirName(dirName);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  const char16_t *formatStrings[] = {dirName.get()};</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings = {dirName};</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   nsString title;</span>
<a href="#l3.16"></a><span id="l3.16">   rv = bundle-&gt;FormatStringFromName(&quot;ExportAddressBookNameTitle&quot;, formatStrings,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                                    ArrayLength(formatStrings), title);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+                                    title);</span>
<a href="#l3.19"></a><span id="l3.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">   rv = filePicker-&gt;Init(aParentWin, title, nsIFilePicker::modeSave);</span>
<a href="#l3.22"></a><span id="l3.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24">   filePicker-&gt;SetDefaultString(dirName);</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">   nsString filterString;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1235,35 +1235,33 @@ NS_IMETHODIMP nsAbView::SwapFirstNameLas</span>
<a href="#l4.4"></a><span id="l4.4">         if (!fn.IsEmpty() || !ln.IsEmpty()) {</span>
<a href="#l4.5"></a><span id="l4.5">           abCard-&gt;SetFirstName(ln);</span>
<a href="#l4.6"></a><span id="l4.6">           abCard-&gt;SetLastName(fn);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">           // Generate display name using the new order</span>
<a href="#l4.9"></a><span id="l4.9">           if (displayNameAutoGeneration &amp;&amp; !fn.IsEmpty() &amp;&amp; !ln.IsEmpty()) {</span>
<a href="#l4.10"></a><span id="l4.10">             nsString dnLnFn;</span>
<a href="#l4.11"></a><span id="l4.11">             nsString dnFnLn;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-            const char16_t *nameString[2];</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+            AutoTArray&lt;nsString, 2&gt; nameString;</span>
<a href="#l4.14"></a><span id="l4.14">             const char *formatString;</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">             // The format should stays the same before/after we swap the names</span>
<a href="#l4.17"></a><span id="l4.17">             formatString = displayNameLastnamefirst ? &quot;lastFirstFormat&quot;</span>
<a href="#l4.18"></a><span id="l4.18">                                                     : &quot;firstLastFormat&quot;;</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">             // Generate both ln/fn and fn/ln combination since we need both</span>
<a href="#l4.21"></a><span id="l4.21">             // later to check to see if the current display name was edited note</span>
<a href="#l4.22"></a><span id="l4.22">             // that fn/ln still hold the values before the swap</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-            nameString[0] = ln.get();</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-            nameString[1] = fn.get();</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-            rv = bundle-&gt;FormatStringFromName(formatString, nameString, 2,</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-                                              dnLnFn);</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+            nameString[0] = ln;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+            nameString[1] = fn;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+            rv = bundle-&gt;FormatStringFromName(formatString, nameString, dnLnFn);</span>
<a href="#l4.30"></a><span id="l4.30">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.31"></a><span id="l4.31">             nameString[0] = fn.get();</span>
<a href="#l4.32"></a><span id="l4.32">             nameString[1] = ln.get();</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-            rv = bundle-&gt;FormatStringFromName(formatString, nameString, 2,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-                                              dnFnLn);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+            rv = bundle-&gt;FormatStringFromName(formatString, nameString, dnFnLn);</span>
<a href="#l4.36"></a><span id="l4.36">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38">             // Get the current display name</span>
<a href="#l4.39"></a><span id="l4.39">             nsAutoString dn;</span>
<a href="#l4.40"></a><span id="l4.40">             rv = abCard-&gt;GetDisplayName(dn);</span>
<a href="#l4.41"></a><span id="l4.41">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43">             // Swap the display name if not edited</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -298,17 +298,17 @@ NS_IMETHODIMP nsAddrDatabase::Open(nsIFi</span>
<a href="#l5.4"></a><span id="l5.4">   if (rv == NS_ERROR_FILE_ACCESS_DENIED) {</span>
<a href="#l5.5"></a><span id="l5.5">     static bool gAlreadyAlerted;</span>
<a href="#l5.6"></a><span id="l5.6">     // only do this once per session to avoid annoying the user</span>
<a href="#l5.7"></a><span id="l5.7">     if (!gAlreadyAlerted) {</span>
<a href="#l5.8"></a><span id="l5.8">       gAlreadyAlerted = true;</span>
<a href="#l5.9"></a><span id="l5.9">       nsAutoString mabFileName;</span>
<a href="#l5.10"></a><span id="l5.10">       rv = aMabFile-&gt;GetLeafName(mabFileName);</span>
<a href="#l5.11"></a><span id="l5.11">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      AlertAboutLockedMabFile(mabFileName.get());</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      AlertAboutLockedMabFile(mabFileName);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">       // We just overwrote rv, so return the proper value here.</span>
<a href="#l5.16"></a><span id="l5.16">       return NS_ERROR_FILE_ACCESS_DENIED;</span>
<a href="#l5.17"></a><span id="l5.17">     }</span>
<a href="#l5.18"></a><span id="l5.18">   }</span>
<a href="#l5.19"></a><span id="l5.19">   // try one more time</span>
<a href="#l5.20"></a><span id="l5.20">   // but first rename corrupt mab file</span>
<a href="#l5.21"></a><span id="l5.21">   // and prompt the user</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -367,69 +367,68 @@ NS_IMETHODIMP nsAddrDatabase::Open(nsIFi</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.25"></a><span id="l5.25">         nsAutoString originalMabFileName;</span>
<a href="#l5.26"></a><span id="l5.26">         rv = aMabFile-&gt;GetLeafName(originalMabFileName);</span>
<a href="#l5.27"></a><span id="l5.27">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">         // if this fails, we don't care</span>
<a href="#l5.30"></a><span id="l5.30">         (void)AlertAboutCorruptMabFile(</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-            originalMabFileName.get(),</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-            NS_ConvertASCIItoUTF16(backupMabFileName).get());</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+            originalMabFileName, NS_ConvertASCIItoUTF16(backupMabFileName));</span>
<a href="#l5.34"></a><span id="l5.34">       }</span>
<a href="#l5.35"></a><span id="l5.35">     }</span>
<a href="#l5.36"></a><span id="l5.36">   }</span>
<a href="#l5.37"></a><span id="l5.37">   return rv;</span>
<a href="#l5.38"></a><span id="l5.38"> }</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40"> nsresult nsAddrDatabase::DisplayAlert(const char16_t *titleName,</span>
<a href="#l5.41"></a><span id="l5.41">                                       const char16_t *alertStringName,</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-                                      const char16_t **formatStrings,</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-                                      int32_t numFormatStrings) {</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+                                      nsTArray&lt;nsString&gt; &amp;formatStrings) {</span>
<a href="#l5.45"></a><span id="l5.45">   nsresult rv;</span>
<a href="#l5.46"></a><span id="l5.46">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l5.47"></a><span id="l5.47">       mozilla::services::GetStringBundleService();</span>
<a href="#l5.48"></a><span id="l5.48">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l5.51"></a><span id="l5.51">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l5.52"></a><span id="l5.52">       &quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;,</span>
<a href="#l5.53"></a><span id="l5.53">       getter_AddRefs(bundle));</span>
<a href="#l5.54"></a><span id="l5.54">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.55"></a><span id="l5.55"> </span>
<a href="#l5.56"></a><span id="l5.56">   nsString alertMessage;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-      NS_ConvertUTF16toUTF8(alertStringName).get(), formatStrings,</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-      numFormatStrings, alertMessage);</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+  rv =</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+      bundle-&gt;FormatStringFromName(NS_ConvertUTF16toUTF8(alertStringName).get(),</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+                                   formatStrings, alertMessage);</span>
<a href="#l5.63"></a><span id="l5.63">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.64"></a><span id="l5.64"> </span>
<a href="#l5.65"></a><span id="l5.65">   nsString alertTitle;</span>
<a href="#l5.66"></a><span id="l5.66">   rv = bundle-&gt;GetStringFromName(NS_ConvertUTF16toUTF8(titleName).get(),</span>
<a href="#l5.67"></a><span id="l5.67">                                  alertTitle);</span>
<a href="#l5.68"></a><span id="l5.68">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70">   nsCOMPtr&lt;nsIPromptService&gt; prompter =</span>
<a href="#l5.71"></a><span id="l5.71">       do_GetService(NS_PROMPTSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l5.72"></a><span id="l5.72">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74">   return prompter-&gt;Alert(nullptr /* we don't know the parent window */,</span>
<a href="#l5.75"></a><span id="l5.75">                          alertTitle.get(), alertMessage.get());</span>
<a href="#l5.76"></a><span id="l5.76"> }</span>
<a href="#l5.77"></a><span id="l5.77"> </span>
<a href="#l5.78"></a><span id="l5.78"> nsresult nsAddrDatabase::AlertAboutCorruptMabFile(</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-    const char16_t *aOldFileName, const char16_t *aNewFileName) {</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-  const char16_t *formatStrings[] = {aOldFileName, aOldFileName, aNewFileName};</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+    const nsString &amp;aOldFileName, const nsString &amp;aNewFileName) {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+  AutoTArray&lt;nsString, 3&gt; formatStrings = {aOldFileName, aOldFileName,</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+                                           aNewFileName};</span>
<a href="#l5.84"></a><span id="l5.84">   return DisplayAlert(u&quot;corruptMabFileTitle&quot;, u&quot;corruptMabFileAlert&quot;,</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-                      formatStrings, 3);</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+                      formatStrings);</span>
<a href="#l5.87"></a><span id="l5.87"> }</span>
<a href="#l5.88"></a><span id="l5.88"> </span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-nsresult nsAddrDatabase::AlertAboutLockedMabFile(const char16_t *aFileName) {</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-  const char16_t *formatStrings[] = {aFileName};</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+nsresult nsAddrDatabase::AlertAboutLockedMabFile(const nsString &amp;aFileName) {</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings = {aFileName};</span>
<a href="#l5.93"></a><span id="l5.93">   return DisplayAlert(u&quot;lockedMabFileTitle&quot;, u&quot;lockedMabFileAlert&quot;,</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-                      formatStrings, 1);</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+                      formatStrings);</span>
<a href="#l5.96"></a><span id="l5.96"> }</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98"> nsresult nsAddrDatabase::OpenInternal(nsIFile *aMabFile, bool aCreate,</span>
<a href="#l5.99"></a><span id="l5.99">                                       nsIAddrDatabase **pAddrDB) {</span>
<a href="#l5.100"></a><span id="l5.100">   RefPtr&lt;nsAddrDatabase&gt; pAddressBookDB = new nsAddrDatabase();</span>
<a href="#l5.101"></a><span id="l5.101"> </span>
<a href="#l5.102"></a><span id="l5.102">   nsresult rv = pAddressBookDB-&gt;OpenMDB(aMabFile, aCreate);</span>
<a href="#l5.103"></a><span id="l5.103">   if (NS_SUCCEEDED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -517,18 +517,17 @@ class nsAddrDatabase : public nsIAddrDat</span>
<a href="#l6.4"></a><span id="l6.4">   nsresult GetRowForCharColumn(const char16_t *unicodeStr,</span>
<a href="#l6.5"></a><span id="l6.5">                                mdb_column findColumn, bool bIsCard,</span>
<a href="#l6.6"></a><span id="l6.6">                                bool aCaseInsensitive, nsIMdbRow **findRow,</span>
<a href="#l6.7"></a><span id="l6.7">                                mdb_pos *aRowPos);</span>
<a href="#l6.8"></a><span id="l6.8">   bool HasRowForCharColumn(const char16_t *unicodeStr, mdb_column findColumn,</span>
<a href="#l6.9"></a><span id="l6.9">                            bool aIsCard, nsIMdbRow **aFindRow);</span>
<a href="#l6.10"></a><span id="l6.10">   nsresult OpenInternal(nsIFile *aMabFile, bool aCreate,</span>
<a href="#l6.11"></a><span id="l6.11">                         nsIAddrDatabase **pCardDB);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  nsresult AlertAboutCorruptMabFile(const char16_t *aOldFileName,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                                    const char16_t *aNewFileName);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-  nsresult AlertAboutLockedMabFile(const char16_t *aFileName);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  nsresult AlertAboutCorruptMabFile(const nsString &amp;aOldFileName,</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+                                    const nsString &amp;aNewFileName);</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+  nsresult AlertAboutLockedMabFile(const nsString &amp;aFileName);</span>
<a href="#l6.18"></a><span id="l6.18">   nsresult DisplayAlert(const char16_t *titleName,</span>
<a href="#l6.19"></a><span id="l6.19">                         const char16_t *alertStringName,</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-                        const char16_t **formatStrings,</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-                        int32_t numFormatStrings);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+                        nsTArray&lt;nsString&gt; &amp;formatStrings);</span>
<a href="#l6.23"></a><span id="l6.23"> };</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -507,55 +507,53 @@ nsresult nsMsgFilter::LogRuleHitGeneric(</span>
<a href="#l7.4"></a><span id="l7.4">       rv =</span>
<a href="#l7.5"></a><span id="l7.5">           bundle-&gt;GetStringFromName(PromiseFlatCString(aErrmsg).get(), tErrmsg);</span>
<a href="#l7.6"></a><span id="l7.6">       if (NS_FAILED(rv)) tErrmsg.Assign(NS_ConvertUTF8toUTF16(aErrmsg));</span>
<a href="#l7.7"></a><span id="l7.7">     } else {</span>
<a href="#l7.8"></a><span id="l7.8">       // The addon creating the custom action should have passed a localized</span>
<a href="#l7.9"></a><span id="l7.9">       // string.</span>
<a href="#l7.10"></a><span id="l7.10">       tErrmsg.Assign(NS_ConvertUTF8toUTF16(aErrmsg));</span>
<a href="#l7.11"></a><span id="l7.11">     }</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    const char16_t *logErrorFormatStrings[2] = {tErrmsg.get(), tcode16.get()};</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; logErrorFormatStrings = {tErrmsg, tcode16};</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">     nsString filterFailureWarningPrefix;</span>
<a href="#l7.16"></a><span id="l7.16">     rv = bundle-&gt;FormatStringFromName(&quot;filterFailureWarningPrefix&quot;,</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-                                      logErrorFormatStrings, 2,</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+                                      logErrorFormatStrings,</span>
<a href="#l7.19"></a><span id="l7.19">                                       filterFailureWarningPrefix);</span>
<a href="#l7.20"></a><span id="l7.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.21"></a><span id="l7.21">     buffer += filterFailureWarningPrefix;</span>
<a href="#l7.22"></a><span id="l7.22">     buffer.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l7.23"></a><span id="l7.23">   }</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-  const char16_t *filterLogDetectFormatStrings[4] = {</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-      filterName.get(), authorValue.get(), subjectValue.get(), dateValue.get()};</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+  AutoTArray&lt;nsString, 4&gt; filterLogDetectFormatStrings = {</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+      filterName, authorValue, subjectValue, dateValue};</span>
<a href="#l7.29"></a><span id="l7.29">   nsString filterLogDetectStr;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(&quot;filterLogDetectStr&quot;,</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                                    filterLogDetectFormatStrings, 4,</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-                                    filterLogDetectStr);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+      &quot;filterLogDetectStr&quot;, filterLogDetectFormatStrings, filterLogDetectStr);</span>
<a href="#l7.35"></a><span id="l7.35">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">   buffer += filterLogDetectStr;</span>
<a href="#l7.38"></a><span id="l7.38">   buffer.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">   if (actionType == nsMsgFilterAction::MoveToFolder ||</span>
<a href="#l7.41"></a><span id="l7.41">       actionType == nsMsgFilterAction::CopyToFolder) {</span>
<a href="#l7.42"></a><span id="l7.42">     nsCString actionFolderUri;</span>
<a href="#l7.43"></a><span id="l7.43">     aFilterAction-&gt;GetTargetFolderUri(actionFolderUri);</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-    NS_ConvertASCIItoUTF16 actionFolderUriValue(actionFolderUri);</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">     nsCString msgId;</span>
<a href="#l7.47"></a><span id="l7.47">     aMsgHdr-&gt;GetMessageId(getter_Copies(msgId));</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-    NS_ConvertASCIItoUTF16 msgIdValue(msgId);</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-    const char16_t *logMoveFormatStrings[2] = {msgIdValue.get(),</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-                                               actionFolderUriValue.get()};</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; logMoveFormatStrings;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+    CopyUTF8toUTF16(msgId, *logMoveFormatStrings.AppendElement());</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+    CopyUTF8toUTF16(actionFolderUri, *logMoveFormatStrings.AppendElement());</span>
<a href="#l7.55"></a><span id="l7.55">     nsString logMoveStr;</span>
<a href="#l7.56"></a><span id="l7.56">     rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l7.57"></a><span id="l7.57">         (actionType == nsMsgFilterAction::MoveToFolder) ? &quot;logMoveStr&quot;</span>
<a href="#l7.58"></a><span id="l7.58">                                                         : &quot;logCopyStr&quot;,</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-        logMoveFormatStrings, 2, logMoveStr);</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+        logMoveFormatStrings, logMoveStr);</span>
<a href="#l7.61"></a><span id="l7.61">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.62"></a><span id="l7.62"> </span>
<a href="#l7.63"></a><span id="l7.63">     buffer += logMoveStr;</span>
<a href="#l7.64"></a><span id="l7.64">   } else if (actionType == nsMsgFilterAction::Custom) {</span>
<a href="#l7.65"></a><span id="l7.65">     nsCOMPtr&lt;nsIMsgFilterCustomAction&gt; customAction;</span>
<a href="#l7.66"></a><span id="l7.66">     nsAutoString filterActionName;</span>
<a href="#l7.67"></a><span id="l7.67">     rv = aFilterAction-&gt;GetCustomAction(getter_AddRefs(customAction));</span>
<a href="#l7.68"></a><span id="l7.68">     if (NS_SUCCEEDED(rv) &amp;&amp; customAction)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1161,19 +1161,19 @@ NS_IMETHODIMP nsMsgFilterList::LogFilter</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">   nsString tempMessage(message);</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">   if (filter) {</span>
<a href="#l8.8"></a><span id="l8.8">     // If a filter was passed, prepend its name in the log message.</span>
<a href="#l8.9"></a><span id="l8.9">     nsString filterName;</span>
<a href="#l8.10"></a><span id="l8.10">     filter-&gt;GetFilterName(filterName);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    const char16_t *logFormatStrings[2] = {filterName.get(), tempMessage.get()};</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; logFormatStrings = {filterName, tempMessage};</span>
<a href="#l8.14"></a><span id="l8.14">     nsString statusLogMessage;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-    rv = bundle-&gt;FormatStringFromName(&quot;filterMessage&quot;, logFormatStrings, 2,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;filterMessage&quot;, logFormatStrings,</span>
<a href="#l8.17"></a><span id="l8.17">                                       statusLogMessage);</span>
<a href="#l8.18"></a><span id="l8.18">     if (NS_SUCCEEDED(rv)) tempMessage.Assign(statusLogMessage);</span>
<a href="#l8.19"></a><span id="l8.19">   }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   // Prepare timestamp</span>
<a href="#l8.22"></a><span id="l8.22">   PRExplodedTime exploded;</span>
<a href="#l8.23"></a><span id="l8.23">   nsString dateValue;</span>
<a href="#l8.24"></a><span id="l8.24">   PR_ExplodeTime(PR_Now(), PR_LocalTimeParameters, &amp;exploded);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineat">@@ -1181,22 +1181,22 @@ NS_IMETHODIMP nsMsgFilterList::LogFilter</span>
<a href="#l8.26"></a><span id="l8.26">                                                 mozilla::kTimeFormatSeconds,</span>
<a href="#l8.27"></a><span id="l8.27">                                                 &amp;exploded, dateValue);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">   // HTML-escape the log for security reasons.</span>
<a href="#l8.30"></a><span id="l8.30">   // We don't want someone to send us a message with a subject with</span>
<a href="#l8.31"></a><span id="l8.31">   // HTML tags, especially &lt;script&gt;.</span>
<a href="#l8.32"></a><span id="l8.32">   nsCString escapedBuffer;</span>
<a href="#l8.33"></a><span id="l8.33">   nsAppendEscapedHTML(NS_ConvertUTF16toUTF8(tempMessage), escapedBuffer);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-  NS_ConvertUTF8toUTF16 finalMessage(escapedBuffer);</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   // Print timestamp and the message.</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-  const char16_t *logFormatStrings[2] = {dateValue.get(), finalMessage.get()};</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; logFormatStrings = {dateValue};</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  CopyUTF8toUTF16(escapedBuffer, *logFormatStrings.AppendElement());</span>
<a href="#l8.40"></a><span id="l8.40">   nsString filterLogMessage;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(&quot;filterLogLine&quot;, logFormatStrings, 2,</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+  rv = bundle-&gt;FormatStringFromName(&quot;filterLogLine&quot;, logFormatStrings,</span>
<a href="#l8.43"></a><span id="l8.43">                                     filterLogMessage);</span>
<a href="#l8.44"></a><span id="l8.44"> </span>
<a href="#l8.45"></a><span id="l8.45">   // Write message into log stream.</span>
<a href="#l8.46"></a><span id="l8.46">   uint32_t writeCount;</span>
<a href="#l8.47"></a><span id="l8.47"> </span>
<a href="#l8.48"></a><span id="l8.48">   rv = logStream-&gt;Write(LOG_ENTRY_START_TAG, LOG_ENTRY_START_TAG_LEN,</span>
<a href="#l8.49"></a><span id="l8.49">                         &amp;writeCount);</span>
<a href="#l8.50"></a><span id="l8.50">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1341,19 +1341,19 @@ bool nsMsgFilterAfterTheFact::ContinueEx</span>
<a href="#l9.4"></a><span id="l9.4">   if (!bundleService) return false;</span>
<a href="#l9.5"></a><span id="l9.5">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l9.6"></a><span id="l9.6">                               getter_AddRefs(bundle));</span>
<a href="#l9.7"></a><span id="l9.7">   if (!bundle) return false;</span>
<a href="#l9.8"></a><span id="l9.8">   nsString filterName;</span>
<a href="#l9.9"></a><span id="l9.9">   m_curFilter-&gt;GetFilterName(filterName);</span>
<a href="#l9.10"></a><span id="l9.10">   nsString formatString;</span>
<a href="#l9.11"></a><span id="l9.11">   nsString confirmText;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  const char16_t *formatStrings[] = {filterName.get()};</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings = {filterName};</span>
<a href="#l9.14"></a><span id="l9.14">   nsresult rv = bundle-&gt;FormatStringFromName(&quot;continueFilterExecution&quot;,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-                                             formatStrings, 1, confirmText);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+                                             formatStrings, confirmText);</span>
<a href="#l9.17"></a><span id="l9.17">   if (NS_FAILED(rv)) return false;</span>
<a href="#l9.18"></a><span id="l9.18">   bool returnVal = false;</span>
<a href="#l9.19"></a><span id="l9.19">   (void)DisplayConfirmationPrompt(m_msgWindow, confirmText.get(), &amp;returnVal);</span>
<a href="#l9.20"></a><span id="l9.20">   return returnVal;</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> nsresult nsMsgFilterAfterTheFact::DisplayConfirmationPrompt(</span>
<a href="#l9.24"></a><span id="l9.24">     nsIMsgWindow *msgWindow, const char16_t *confirmString, bool *confirmed) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -329,23 +329,23 @@ nsresult nsMessenger::PromptIfFileExists</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">   nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(mDocShell));</span>
<a href="#l10.6"></a><span id="l10.6">   if (!dialog) return rv;</span>
<a href="#l10.7"></a><span id="l10.7">   nsAutoString path;</span>
<a href="#l10.8"></a><span id="l10.8">   bool dialogResult = false;</span>
<a href="#l10.9"></a><span id="l10.9">   nsString errorMessage;</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">   file-&gt;GetPath(path);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  const char16_t *pathFormatStrings[] = {path.get()};</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; pathFormatStrings = {path};</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">   if (!mStringBundle) {</span>
<a href="#l10.16"></a><span id="l10.16">     rv = InitStringBundle();</span>
<a href="#l10.17"></a><span id="l10.17">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.18"></a><span id="l10.18">   }</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-  rv = mStringBundle-&gt;FormatStringFromName(&quot;fileExists&quot;, pathFormatStrings, 1,</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+  rv = mStringBundle-&gt;FormatStringFromName(&quot;fileExists&quot;, pathFormatStrings,</span>
<a href="#l10.21"></a><span id="l10.21">                                            errorMessage);</span>
<a href="#l10.22"></a><span id="l10.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.23"></a><span id="l10.23">   rv = dialog-&gt;Confirm(nullptr, errorMessage.get(), &amp;dialogResult);</span>
<a href="#l10.24"></a><span id="l10.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">   if (dialogResult) return NS_OK;  // user says okay to replace</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   // if we don't re-init the path for redisplay the picker will</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineat">@@ -789,18 +789,18 @@ nsresult nsMessenger::SaveOneAttachment(</span>
<a href="#l10.30"></a><span id="l10.30">     extension = Substring(defaultDisplayString, extensionIndex + 1);</span>
<a href="#l10.31"></a><span id="l10.31">     filePicker-&gt;SetDefaultExtension(extension);</span>
<a href="#l10.32"></a><span id="l10.32">     if (!mStringBundle) {</span>
<a href="#l10.33"></a><span id="l10.33">       rv = InitStringBundle();</span>
<a href="#l10.34"></a><span id="l10.34">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.35"></a><span id="l10.35">     }</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37">     nsString filterName;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-    const char16_t *extensionParam[] = {extension.get()};</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    rv = mStringBundle-&gt;FormatStringFromName(&quot;saveAsType&quot;, extensionParam, 1,</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; extensionParam = {extension};</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+    rv = mStringBundle-&gt;FormatStringFromName(&quot;saveAsType&quot;, extensionParam,</span>
<a href="#l10.42"></a><span id="l10.42">                                              filterName);</span>
<a href="#l10.43"></a><span id="l10.43">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45">     extension.InsertLiteral(u&quot;*.&quot;, 0);</span>
<a href="#l10.46"></a><span id="l10.46">     filePicker-&gt;AppendFilter(filterName, extension);</span>
<a href="#l10.47"></a><span id="l10.47">   }</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">   filePicker-&gt;AppendFilters(nsIFilePicker::filterAll);</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineat">@@ -2762,23 +2762,23 @@ nsresult nsMessenger::PromptIfDeleteAtta</span>
<a href="#l10.51"></a><span id="l10.51">   // create the list of attachments we are removing</span>
<a href="#l10.52"></a><span id="l10.52">   nsString displayString;</span>
<a href="#l10.53"></a><span id="l10.53">   nsString attachmentList;</span>
<a href="#l10.54"></a><span id="l10.54">   for (uint32_t u = 0; u &lt; aCount; ++u) {</span>
<a href="#l10.55"></a><span id="l10.55">     ConvertAndSanitizeFileName(aDisplayNameArray[u], displayString);</span>
<a href="#l10.56"></a><span id="l10.56">     attachmentList.Append(displayString);</span>
<a href="#l10.57"></a><span id="l10.57">     attachmentList.Append(char16_t('\n'));</span>
<a href="#l10.58"></a><span id="l10.58">   }</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-  const char16_t *formatStrings[] = {attachmentList.get()};</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings = {attachmentList};</span>
<a href="#l10.61"></a><span id="l10.61"> </span>
<a href="#l10.62"></a><span id="l10.62">   // format the message and display</span>
<a href="#l10.63"></a><span id="l10.63">   nsString promptMessage;</span>
<a href="#l10.64"></a><span id="l10.64">   const char *propertyName =</span>
<a href="#l10.65"></a><span id="l10.65">       aSaveFirst ? &quot;detachAttachments&quot; : &quot;deleteAttachments&quot;;</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-  rv = mStringBundle-&gt;FormatStringFromName(propertyName, formatStrings, 1,</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+  rv = mStringBundle-&gt;FormatStringFromName(propertyName, formatStrings,</span>
<a href="#l10.68"></a><span id="l10.68">                                            promptMessage);</span>
<a href="#l10.69"></a><span id="l10.69">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.70"></a><span id="l10.70"> </span>
<a href="#l10.71"></a><span id="l10.71">   bool dialogResult = false;</span>
<a href="#l10.72"></a><span id="l10.72">   rv = dialog-&gt;Confirm(nullptr, promptMessage.get(), &amp;dialogResult);</span>
<a href="#l10.73"></a><span id="l10.73">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.74"></a><span id="l10.74"> </span>
<a href="#l10.75"></a><span id="l10.75">   return dialogResult ? NS_OK : NS_ERROR_FAILURE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -157,22 +157,22 @@ bool nsMessengerUnixIntegration::BuildNo</span>
<a href="#l11.4"></a><span id="l11.4">   int32_t numNewMessages = 0;</span>
<a href="#l11.5"></a><span id="l11.5">   aFolder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">   if (!numNewMessages) return false;</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   nsAutoString numNewMsgsText;</span>
<a href="#l11.10"></a><span id="l11.10">   numNewMsgsText.AppendInt(numNewMessages);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  const char16_t *formatStrings[] = {accountName.get(), numNewMsgsText.get()};</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; formatStrings = {accountName, numNewMsgsText};</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">   aBundle-&gt;FormatStringFromName(numNewMessages == 1</span>
<a href="#l11.16"></a><span id="l11.16">                                     ? &quot;newMailNotification_message&quot;</span>
<a href="#l11.17"></a><span id="l11.17">                                     : &quot;newMailNotification_messages&quot;,</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-                                formatStrings, 2, aTitle);</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+                                formatStrings, aTitle);</span>
<a href="#l11.20"></a><span id="l11.20">   return true;</span>
<a href="#l11.21"></a><span id="l11.21"> }</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23"> /* This comparator lets us sort an nsCOMArray of nsIMsgDBHdr's by</span>
<a href="#l11.24"></a><span id="l11.24">  * their dateInSeconds attributes in ascending order.</span>
<a href="#l11.25"></a><span id="l11.25">  */</span>
<a href="#l11.26"></a><span id="l11.26"> static int nsMsgDbHdrTimestampComparator(nsIMsgDBHdr *aElement1,</span>
<a href="#l11.27"></a><span id="l11.27">                                          nsIMsgDBHdr *aElement2, void *aData) {</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineat">@@ -257,19 +257,19 @@ bool nsMessengerUnixIntegration::BuildNo</span>
<a href="#l11.29"></a><span id="l11.29">     nsString fullHeader;</span>
<a href="#l11.30"></a><span id="l11.30">     if (NS_FAILED(aHdr-&gt;GetMime2DecodedAuthor(fullHeader))) return false;</span>
<a href="#l11.31"></a><span id="l11.31"> </span>
<a href="#l11.32"></a><span id="l11.32">     ExtractName(DecodedHeader(fullHeader), author);</span>
<a href="#l11.33"></a><span id="l11.33">   }</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35">   if (showSubject &amp;&amp; showSender) {</span>
<a href="#l11.36"></a><span id="l11.36">     nsString msgTitle;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-    const char16_t *formatStrings[] = {subject.get(), author.get()};</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; formatStrings = {subject, author};</span>
<a href="#l11.39"></a><span id="l11.39">     aBundle-&gt;FormatStringFromName(&quot;newMailNotification_messagetitle&quot;,</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-                                  formatStrings, 2, msgTitle);</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+                                  formatStrings, msgTitle);</span>
<a href="#l11.42"></a><span id="l11.42">     alertBody.Append(msgTitle);</span>
<a href="#l11.43"></a><span id="l11.43">   } else if (showSubject)</span>
<a href="#l11.44"></a><span id="l11.44">     alertBody.Append(subject);</span>
<a href="#l11.45"></a><span id="l11.45">   else if (showSender)</span>
<a href="#l11.46"></a><span id="l11.46">     alertBody.Append(author);</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48">   if (showPreview &amp;&amp; (showSubject || showSender)) {</span>
<a href="#l11.49"></a><span id="l11.49">     alertBody.AppendLiteral(&quot;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -636,27 +636,25 @@ void nsMessengerWinIntegration::FillTool</span>
<a href="#l12.4"></a><span id="l12.4">       numNewMessages = 0;</span>
<a href="#l12.5"></a><span id="l12.5">       folder-&gt;GetNumNewMessages(true, &amp;numNewMessages);</span>
<a href="#l12.6"></a><span id="l12.6">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l12.7"></a><span id="l12.7">       GetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l12.8"></a><span id="l12.8">       if (bundle) {</span>
<a href="#l12.9"></a><span id="l12.9">         nsAutoString numNewMsgsText;</span>
<a href="#l12.10"></a><span id="l12.10">         numNewMsgsText.AppendInt(numNewMessages);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-        const char16_t *formatStrings[] = {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-            numNewMsgsText.get(),</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-        };</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+        AutoTArray&lt;nsString, 1&gt; formatStrings = {numNewMsgsText};</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">         nsString finalText;</span>
<a href="#l12.18"></a><span id="l12.18">         if (numNewMessages == 1)</span>
<a href="#l12.19"></a><span id="l12.19">           bundle-&gt;FormatStringFromName(&quot;biffNotification_message&quot;,</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-                                       formatStrings, 1, finalText);</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+                                       formatStrings, finalText);</span>
<a href="#l12.22"></a><span id="l12.22">         else</span>
<a href="#l12.23"></a><span id="l12.23">           bundle-&gt;FormatStringFromName(&quot;biffNotification_messages&quot;,</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-                                       formatStrings, 1, finalText);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+                                       formatStrings, finalText);</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">         // the alert message is special...we actually only want to show the</span>
<a href="#l12.28"></a><span id="l12.28">         // first account with new mail in the alert.</span>
<a href="#l12.29"></a><span id="l12.29">         if (animatedAlertText.IsEmpty())  // if we haven't filled in the</span>
<a href="#l12.30"></a><span id="l12.30">                                           // animated alert text yet</span>
<a href="#l12.31"></a><span id="l12.31">           animatedAlertText = finalText;</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33">         toolTipLine.Append(accountName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -303,19 +303,18 @@ nsresult nsFolderCompactState::ShowStatu</span>
<a href="#l13.4"></a><span id="l13.4">     rv = m_folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l13.5"></a><span id="l13.5">     if (NS_FAILED(rv)) break;</span>
<a href="#l13.6"></a><span id="l13.6">     nsAutoString accountName;</span>
<a href="#l13.7"></a><span id="l13.7">     rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l13.8"></a><span id="l13.8">     if (NS_FAILED(rv)) break;</span>
<a href="#l13.9"></a><span id="l13.9">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l13.10"></a><span id="l13.10">     rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l13.11"></a><span id="l13.11">     if (NS_FAILED(rv)) break;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    const char16_t *params[] = {accountName.get(), aMsg.get()};</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    rv =</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-        bundle-&gt;FormatStringFromName(&quot;statusMessage&quot;, params, 2, statusMessage);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; params = {accountName, aMsg};</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;statusMessage&quot;, params, statusMessage);</span>
<a href="#l13.17"></a><span id="l13.17">   } while (false);</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">   // If fetching any of the needed info failed, just show the original message.</span>
<a href="#l13.20"></a><span id="l13.20">   if (NS_FAILED(rv)) statusMessage.Assign(aMsg);</span>
<a href="#l13.21"></a><span id="l13.21">   return statusFeedback-&gt;SetStatusString(statusMessage);</span>
<a href="#l13.22"></a><span id="l13.22"> }</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24"> nsresult nsFolderCompactState::Init(nsIMsgFolder *folder,</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineat">@@ -624,19 +623,18 @@ nsresult nsFolderCompactState::ReleaseFo</span>
<a href="#l13.26"></a><span id="l13.26"> void nsFolderCompactState::ShowDoneStatus() {</span>
<a href="#l13.27"></a><span id="l13.27">   if (m_folder) {</span>
<a href="#l13.28"></a><span id="l13.28">     nsString statusString;</span>
<a href="#l13.29"></a><span id="l13.29">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l13.30"></a><span id="l13.30">     nsresult rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l13.31"></a><span id="l13.31">     NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l13.32"></a><span id="l13.32">     nsAutoString expungedAmount;</span>
<a href="#l13.33"></a><span id="l13.33">     FormatFileSize(m_totalExpungedBytes, true, expungedAmount);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-    const char16_t *params[] = {expungedAmount.get()};</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-    rv =</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-        bundle-&gt;FormatStringFromName(&quot;compactingDone&quot;, params, 1, statusString);</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; params = {expungedAmount};</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;compactingDone&quot;, params, statusString);</span>
<a href="#l13.39"></a><span id="l13.39"> </span>
<a href="#l13.40"></a><span id="l13.40">     if (!statusString.IsEmpty() &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l13.41"></a><span id="l13.41">       ShowStatusMsg(statusString);</span>
<a href="#l13.42"></a><span id="l13.42">   }</span>
<a href="#l13.43"></a><span id="l13.43"> }</span>
<a href="#l13.44"></a><span id="l13.44"> </span>
<a href="#l13.45"></a><span id="l13.45"> nsresult nsFolderCompactState::CompactNextFolder() {</span>
<a href="#l13.46"></a><span id="l13.46">   m_folderIndex++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -256,17 +256,16 @@ NS_IMETHODIMP nsMsgStatusFeedback::OnSta</span>
<a href="#l14.4"></a><span id="l14.4">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">   // prefixing the account name to the status message if status message isn't</span>
<a href="#l14.7"></a><span id="l14.7">   // blank and doesn't already contain the account name.</span>
<a href="#l14.8"></a><span id="l14.8">   nsString statusMessage;</span>
<a href="#l14.9"></a><span id="l14.9">   if (!str.IsEmpty() &amp;&amp; str.Find(accountName) == kNotFound) {</span>
<a href="#l14.10"></a><span id="l14.10">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l14.11"></a><span id="l14.11">     rv = sbs-&gt;CreateBundle(MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    const char16_t* params[] = {accountName.get(), str.get()};</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    rv =</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-        bundle-&gt;FormatStringFromName(&quot;statusMessage&quot;, params, 2, statusMessage);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; params = {accountName, str};</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;statusMessage&quot;, params, statusMessage);</span>
<a href="#l14.17"></a><span id="l14.17">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.18"></a><span id="l14.18">   } else {</span>
<a href="#l14.19"></a><span id="l14.19">     statusMessage.Assign(str);</span>
<a href="#l14.20"></a><span id="l14.20">   }</span>
<a href="#l14.21"></a><span id="l14.21">   return ShowStatusString(statusMessage);</span>
<a href="#l14.22"></a><span id="l14.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -631,41 +631,39 @@ NS_IMETHODIMP nsSpamSettings::LogJunkHit</span>
<a href="#l15.4"></a><span id="l15.4">       mozilla::services::GetStringBundleService();</span>
<a href="#l15.5"></a><span id="l15.5">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l15.8"></a><span id="l15.8">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l15.9"></a><span id="l15.9">       &quot;chrome://messenger/locale/filter.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l15.10"></a><span id="l15.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  const char16_t *junkLogDetectFormatStrings[3] = {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-      authorValue.get(), subjectValue.get(), dateValue.get()};</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  AutoTArray&lt;nsString, 3&gt; junkLogDetectFormatStrings = {</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+      authorValue, subjectValue, dateValue};</span>
<a href="#l15.16"></a><span id="l15.16">   nsString junkLogDetectStr;</span>
<a href="#l15.17"></a><span id="l15.17">   rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-      &quot;junkLogDetectStr&quot;, junkLogDetectFormatStrings, 3, junkLogDetectStr);</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+      &quot;junkLogDetectStr&quot;, junkLogDetectFormatStrings, junkLogDetectStr);</span>
<a href="#l15.20"></a><span id="l15.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">   buffer += NS_ConvertUTF16toUTF8(junkLogDetectStr);</span>
<a href="#l15.23"></a><span id="l15.23">   buffer += &quot;\n&quot;;</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">   if (aMoveMessage) {</span>
<a href="#l15.26"></a><span id="l15.26">     nsCString msgId;</span>
<a href="#l15.27"></a><span id="l15.27">     aMsgHdr-&gt;GetMessageId(getter_Copies(msgId));</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">     nsCString junkFolderURI;</span>
<a href="#l15.30"></a><span id="l15.30">     rv = GetSpamFolderURI(getter_Copies(junkFolderURI));</span>
<a href="#l15.31"></a><span id="l15.31">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-    NS_ConvertASCIItoUTF16 msgIdValue(msgId);</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-    NS_ConvertASCIItoUTF16 junkFolderURIValue(junkFolderURI);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-    const char16_t *logMoveFormatStrings[2] = {msgIdValue.get(),</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-                                               junkFolderURIValue.get()};</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; logMoveFormatStrings;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+    CopyASCIItoUTF16(msgId, *logMoveFormatStrings.AppendElement());</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+    CopyASCIItoUTF16(junkFolderURI, *logMoveFormatStrings.AppendElement());</span>
<a href="#l15.41"></a><span id="l15.41">     nsString logMoveStr;</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-    rv = bundle-&gt;FormatStringFromName(&quot;logMoveStr&quot;, logMoveFormatStrings, 2,</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;logMoveStr&quot;, logMoveFormatStrings,</span>
<a href="#l15.44"></a><span id="l15.44">                                       logMoveStr);</span>
<a href="#l15.45"></a><span id="l15.45">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">     buffer += NS_ConvertUTF16toUTF8(logMoveStr);</span>
<a href="#l15.48"></a><span id="l15.48">     buffer += &quot;\n&quot;;</span>
<a href="#l15.49"></a><span id="l15.49">   }</span>
<a href="#l15.50"></a><span id="l15.50"> </span>
<a href="#l15.51"></a><span id="l15.51">   return LogJunkString(buffer.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1759,22 +1759,22 @@ nsresult nsMsgDBFolder::HandleAutoCompac</span>
<a href="#l16.4"></a><span id="l16.4">           rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l16.5"></a><span id="l16.5">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.6"></a><span id="l16.6">           nsString dialogTitle;</span>
<a href="#l16.7"></a><span id="l16.7">           nsString confirmString;</span>
<a href="#l16.8"></a><span id="l16.8">           nsString checkboxText;</span>
<a href="#l16.9"></a><span id="l16.9">           nsString buttonCompactNowText;</span>
<a href="#l16.10"></a><span id="l16.10">           nsAutoString compactSize;</span>
<a href="#l16.11"></a><span id="l16.11">           FormatFileSize(totalExpungedBytes, true, compactSize);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-          const char16_t *params[] = {compactSize.get()};</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+          AutoTArray&lt;nsString, 1&gt; params = {compactSize};</span>
<a href="#l16.14"></a><span id="l16.14">           rv = bundle-&gt;GetStringFromName(&quot;autoCompactAllFoldersTitle&quot;,</span>
<a href="#l16.15"></a><span id="l16.15">                                          dialogTitle);</span>
<a href="#l16.16"></a><span id="l16.16">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.17"></a><span id="l16.17">           rv = bundle-&gt;FormatStringFromName(&quot;autoCompactAllFoldersText&quot;, params,</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-                                            1, confirmString);</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+                                            confirmString);</span>
<a href="#l16.20"></a><span id="l16.20">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.21"></a><span id="l16.21">           rv = bundle-&gt;GetStringFromName(&quot;autoCompactAlwaysAskCheckbox&quot;,</span>
<a href="#l16.22"></a><span id="l16.22">                                          checkboxText);</span>
<a href="#l16.23"></a><span id="l16.23">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.24"></a><span id="l16.24">           rv = bundle-&gt;GetStringFromName(&quot;compactNowButton&quot;,</span>
<a href="#l16.25"></a><span id="l16.25">                                          buttonCompactNowText);</span>
<a href="#l16.26"></a><span id="l16.26">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.27"></a><span id="l16.27">           bool alwaysAsk = true;  // &quot;Always ask...&quot; - checked by default.</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineat">@@ -3576,22 +3576,21 @@ bool nsMsgDBFolder::ConfirmAutoFolderRen</span>
<a href="#l16.29"></a><span id="l16.29">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l16.30"></a><span id="l16.30">   nsresult rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l16.31"></a><span id="l16.31">   if (NS_WARN_IF(NS_FAILED(rv))) {</span>
<a href="#l16.32"></a><span id="l16.32">     return false;</span>
<a href="#l16.33"></a><span id="l16.33">   }</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">   nsString folderName;</span>
<a href="#l16.36"></a><span id="l16.36">   GetName(folderName);</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-  const char16_t *formatStrings[] = {aOldName.get(), folderName.get(),</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-                                     aNewName.get()};</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+  AutoTArray&lt;nsString, 3&gt; formatStrings = {aOldName, folderName, aNewName};</span>
<a href="#l16.40"></a><span id="l16.40"> </span>
<a href="#l16.41"></a><span id="l16.41">   nsString confirmString;</span>
<a href="#l16.42"></a><span id="l16.42">   rv = bundle-&gt;FormatStringFromName(&quot;confirmDuplicateFolderRename&quot;,</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-                                    formatStrings, 3, confirmString);</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+                                    formatStrings, confirmString);</span>
<a href="#l16.45"></a><span id="l16.45">   if (NS_WARN_IF(NS_FAILED(rv))) {</span>
<a href="#l16.46"></a><span id="l16.46">     return false;</span>
<a href="#l16.47"></a><span id="l16.47">   }</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49">   bool confirmed = false;</span>
<a href="#l16.50"></a><span id="l16.50">   rv = ThrowConfirmationPrompt(msgWindow, confirmString, &amp;confirmed);</span>
<a href="#l16.51"></a><span id="l16.51">   if (NS_WARN_IF(NS_FAILED(rv))) {</span>
<a href="#l16.52"></a><span id="l16.52">     return false;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineat">@@ -4810,21 +4809,20 @@ nsresult nsMsgDBFolder::ThrowConfirmatio</span>
<a href="#l16.54"></a><span id="l16.54"> NS_IMETHODIMP</span>
<a href="#l16.55"></a><span id="l16.55"> nsMsgDBFolder::GetStringWithFolderNameFromBundle(const char *msgName,</span>
<a href="#l16.56"></a><span id="l16.56">                                                  nsAString &amp;aResult) {</span>
<a href="#l16.57"></a><span id="l16.57">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l16.58"></a><span id="l16.58">   nsresult rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l16.59"></a><span id="l16.59">   if (NS_SUCCEEDED(rv) &amp;&amp; bundle) {</span>
<a href="#l16.60"></a><span id="l16.60">     nsString folderName;</span>
<a href="#l16.61"></a><span id="l16.61">     GetName(folderName);</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-    const char16_t *formatStrings[] = {folderName.get(),</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-                                       kLocalizedBrandShortName.get()};</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+    AutoTArray&lt;nsString, 2&gt; formatStrings = {folderName,</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+                                             kLocalizedBrandShortName};</span>
<a href="#l16.67"></a><span id="l16.67">     nsString resultStr;</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-    rv = bundle-&gt;FormatStringFromName(msgName, formatStrings, 2, resultStr);</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(msgName, formatStrings, resultStr);</span>
<a href="#l16.70"></a><span id="l16.70">     if (NS_SUCCEEDED(rv)) aResult.Assign(resultStr);</span>
<a href="#l16.71"></a><span id="l16.71">   }</span>
<a href="#l16.72"></a><span id="l16.72">   return rv;</span>
<a href="#l16.73"></a><span id="l16.73"> }</span>
<a href="#l16.74"></a><span id="l16.74"> </span>
<a href="#l16.75"></a><span id="l16.75"> NS_IMETHODIMP nsMsgDBFolder::ConfirmFolderDeletionForFilter(</span>
<a href="#l16.76"></a><span id="l16.76">     nsIMsgWindow *msgWindow, bool *confirmed) {</span>
<a href="#l16.77"></a><span id="l16.77">   nsString confirmString;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1454,19 +1454,19 @@ char16_t *FormatStringWithHostNameByName</span>
<a href="#l17.4"></a><span id="l17.4">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l17.5"></a><span id="l17.5">   rv = msgUri-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l17.6"></a><span id="l17.6">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">   nsCString hostName;</span>
<a href="#l17.9"></a><span id="l17.9">   rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l17.10"></a><span id="l17.10">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  NS_ConvertASCIItoUTF16 hostStr(hostName);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  const char16_t *params[] = {hostStr.get()};</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; params;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+  CopyASCIItoUTF16(hostName, *params.AppendElement());</span>
<a href="#l17.16"></a><span id="l17.16">   nsAutoString str;</span>
<a href="#l17.17"></a><span id="l17.17">   rv = sBundle-&gt;FormatStringFromName(NS_ConvertUTF16toUTF8(stringName).get(),</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-                                     params, 1, str);</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+                                     params, str);</span>
<a href="#l17.20"></a><span id="l17.20">   NS_ENSURE_SUCCESS(rv, nullptr);</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22">   return ToNewUnicode(str);</span>
<a href="#l17.23"></a><span id="l17.23"> }</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25"> // vim: ts=2 sw=2</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1594,32 +1594,32 @@ NS_MSG_BASE nsresult MsgPromptLoginFaile</span>
<a href="#l18.4"></a><span id="l18.4">   NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l18.7"></a><span id="l18.7">   rv = bundleSvc-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l18.8"></a><span id="l18.8">                                getter_AddRefs(bundle));</span>
<a href="#l18.9"></a><span id="l18.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">   nsString message;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  NS_ConvertUTF8toUTF16 hostNameUTF16(aHostname);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-  NS_ConvertUTF8toUTF16 userNameUTF16(aUsername);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-  const char16_t *formatStrings[] = {hostNameUTF16.get(), userNameUTF16.get()};</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; formatStrings;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+  CopyUTF8toUTF16(aHostname, *formatStrings.AppendElement());</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  CopyUTF8toUTF16(aUsername, *formatStrings.AppendElement());</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(&quot;mailServerLoginFailed2&quot;, formatStrings, 2,</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+  rv = bundle-&gt;FormatStringFromName(&quot;mailServerLoginFailed2&quot;, formatStrings,</span>
<a href="#l18.21"></a><span id="l18.21">                                     message);</span>
<a href="#l18.22"></a><span id="l18.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24">   nsString title;</span>
<a href="#l18.25"></a><span id="l18.25">   if (aAccountname.IsEmpty()) {</span>
<a href="#l18.26"></a><span id="l18.26">     // Account name may be empty e.g. on a SMTP server.</span>
<a href="#l18.27"></a><span id="l18.27">     rv = bundle-&gt;GetStringFromName(&quot;mailServerLoginFailedTitle&quot;, title);</span>
<a href="#l18.28"></a><span id="l18.28">   } else {</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">-    const char16_t *formatStrings[] = {aAccountname.BeginReading()};</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; formatStrings = {nsString(aAccountname)};</span>
<a href="#l18.31"></a><span id="l18.31">     rv = bundle-&gt;FormatStringFromName(&quot;mailServerLoginFailedTitleWithAccount&quot;,</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-                                      formatStrings, 1, title);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+                                      formatStrings, title);</span>
<a href="#l18.34"></a><span id="l18.34">   }</span>
<a href="#l18.35"></a><span id="l18.35">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37">   nsString button0;</span>
<a href="#l18.38"></a><span id="l18.38">   rv = bundle-&gt;GetStringFromName(&quot;mailServerLoginFailedRetryButton&quot;, button0);</span>
<a href="#l18.39"></a><span id="l18.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.40"></a><span id="l18.40"> </span>
<a href="#l18.41"></a><span id="l18.41">   nsString button2;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1022,25 +1022,25 @@ nsresult nsMsgAttachmentHandler::UrlExit</span>
<a href="#l19.4"></a><span id="l19.4">       MsgUnescapeString(turl, 0, unescapedUrl);</span>
<a href="#l19.5"></a><span id="l19.5">       if (unescapedUrl.IsEmpty())</span>
<a href="#l19.6"></a><span id="l19.6">         params = turl;</span>
<a href="#l19.7"></a><span id="l19.7">       else</span>
<a href="#l19.8"></a><span id="l19.8">         params = unescapedUrl;</span>
<a href="#l19.9"></a><span id="l19.9">     } else</span>
<a href="#l19.10"></a><span id="l19.10">       params.Assign('?');</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    NS_ConvertUTF8toUTF16 UTF16params(params);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-    const char16_t *formatParams[] = {UTF16params.get()};</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; formatParams;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+    CopyUTF8toUTF16(params, *formatParams.AppendElement());</span>
<a href="#l19.16"></a><span id="l19.16">     if (mode == nsIMsgSend::nsMsgSaveAsDraft ||</span>
<a href="#l19.17"></a><span id="l19.17">         mode == nsIMsgSend::nsMsgSaveAsTemplate)</span>
<a href="#l19.18"></a><span id="l19.18">       bundle-&gt;FormatStringFromName(&quot;failureOnObjectEmbeddingWhileSaving&quot;,</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-                                   formatParams, 1, msg);</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+                                   formatParams, msg);</span>
<a href="#l19.21"></a><span id="l19.21">     else</span>
<a href="#l19.22"></a><span id="l19.22">       bundle-&gt;FormatStringFromName(&quot;failureOnObjectEmbeddingWhileSending&quot;,</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-                                   formatParams, 1, msg);</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+                                   formatParams, msg);</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26">     nsCOMPtr&lt;nsIPrompt&gt; aPrompt;</span>
<a href="#l19.27"></a><span id="l19.27">     if (m_mime_delivery_state)</span>
<a href="#l19.28"></a><span id="l19.28">       m_mime_delivery_state-&gt;GetDefaultPrompt(getter_AddRefs(aPrompt));</span>
<a href="#l19.29"></a><span id="l19.29">     nsMsgAskBooleanQuestionByString(aPrompt, msg.get(), &amp;keepOnGoing);</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31">     if (keepOnGoing) {</span>
<a href="#l19.32"></a><span id="l19.32">       status = NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -41,18 +41,18 @@ static nsresult nsMsgBuildMessageByName(</span>
<a href="#l20.4"></a><span id="l20.4">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l20.5"></a><span id="l20.5">       &quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;,</span>
<a href="#l20.6"></a><span id="l20.6">       getter_AddRefs(bundle));</span>
<a href="#l20.7"></a><span id="l20.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">   nsString path;</span>
<a href="#l20.10"></a><span id="l20.10">   aFile-&gt;GetPath(path);</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  const char16_t *params[1] = {path.get()};</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-  return bundle-&gt;FormatStringFromName(aName, params, 1, aResult);</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; params = {path};</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+  return bundle-&gt;FormatStringFromName(aName, params, aResult);</span>
<a href="#l20.16"></a><span id="l20.16"> }</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18"> nsresult nsMsgBuildMessageWithFile(nsIFile *aFile, nsString &amp;aResult) {</span>
<a href="#l20.19"></a><span id="l20.19">   return nsMsgBuildMessageByName(&quot;unableToOpenFile&quot;, aFile, aResult);</span>
<a href="#l20.20"></a><span id="l20.20"> }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22"> nsresult nsMsgBuildMessageWithTmpFile(nsIFile *aFile, nsString &amp;aResult) {</span>
<a href="#l20.23"></a><span id="l20.23">   return nsMsgBuildMessageByName(&quot;unableToOpenTmpFile&quot;, aFile, aResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -2216,46 +2216,46 @@ nsresult nsMsgComposeAndSend::HackAttach</span>
<a href="#l21.4"></a><span id="l21.4">       //</span>
<a href="#l21.5"></a><span id="l21.5">       // This only returns a failure code if NET_GetURL was not called</span>
<a href="#l21.6"></a><span id="l21.6">       // (and thus no exit routine was or will be called.)</span>
<a href="#l21.7"></a><span id="l21.7">       //</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">       // Display some feedback to user...</span>
<a href="#l21.10"></a><span id="l21.10">       nsString msg;</span>
<a href="#l21.11"></a><span id="l21.11">       nsAutoString attachmentFileName;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      NS_ConvertUTF8toUTF16 params(m_attachments[i]-&gt;m_realName);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-      const char16_t *formatParams[1];</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-      if (!params.IsEmpty()) {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-        formatParams[0] = params.get();</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; formatParams;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+      if (!(m_attachments[i]-&gt;m_realName).IsEmpty()) {</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+        CopyUTF8toUTF16(m_attachments[i]-&gt;m_realName,</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+                        *formatParams.AppendElement());</span>
<a href="#l21.20"></a><span id="l21.20">       } else if (m_attachments[i]-&gt;mURL) {</span>
<a href="#l21.21"></a><span id="l21.21">         nsCString asciiSpec;</span>
<a href="#l21.22"></a><span id="l21.22">         m_attachments[i]-&gt;mURL-&gt;GetAsciiSpec(asciiSpec);</span>
<a href="#l21.23"></a><span id="l21.23">         attachmentFileName.AssignASCII(asciiSpec.get());</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-        formatParams[0] = attachmentFileName.get();</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+        formatParams[0] = attachmentFileName;</span>
<a href="#l21.26"></a><span id="l21.26">       }</span>
<a href="#l21.27"></a><span id="l21.27">       mComposeBundle-&gt;FormatStringFromName(&quot;gatheringAttachment&quot;, formatParams,</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-                                           1, msg);</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+                                           msg);</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31">       if (!msg.IsEmpty()) {</span>
<a href="#l21.32"></a><span id="l21.32">         SetStatusMessage(msg);</span>
<a href="#l21.33"></a><span id="l21.33">       }</span>
<a href="#l21.34"></a><span id="l21.34"> </span>
<a href="#l21.35"></a><span id="l21.35">       /* As SnarfAttachment will call GatherMimeAttachments when it will be done</span>
<a href="#l21.36"></a><span id="l21.36">          (this is an async process), we need to avoid to call it ourself.</span>
<a href="#l21.37"></a><span id="l21.37">       */</span>
<a href="#l21.38"></a><span id="l21.38">       needToCallGatherMimeAttachments = false;</span>
<a href="#l21.39"></a><span id="l21.39"> </span>
<a href="#l21.40"></a><span id="l21.40">       nsresult status = m_attachments[i]-&gt;SnarfAttachment(mCompFields);</span>
<a href="#l21.41"></a><span id="l21.41">       if (NS_FAILED(status)) {</span>
<a href="#l21.42"></a><span id="l21.42">         nsString errorMsg;</span>
<a href="#l21.43"></a><span id="l21.43">         NS_CopyNativeToUnicode(m_attachments[i]-&gt;m_realName,</span>
<a href="#l21.44"></a><span id="l21.44">                                attachmentFileName);</span>
<a href="#l21.45"></a><span id="l21.45">         nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-        const char16_t *params[] = {attachmentFileName.get()};</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-        mComposeBundle-&gt;FormatStringFromName(&quot;errorAttachingFile&quot;, params, 1,</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+        AutoTArray&lt;nsString, 1&gt; params = {attachmentFileName};</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+        mComposeBundle-&gt;FormatStringFromName(&quot;errorAttachingFile&quot;, params,</span>
<a href="#l21.50"></a><span id="l21.50">                                              errorMsg);</span>
<a href="#l21.51"></a><span id="l21.51">         mSendReport-&gt;SetMessage(nsIMsgSendReport::process_Current,</span>
<a href="#l21.52"></a><span id="l21.52">                                 errorMsg.get(), false);</span>
<a href="#l21.53"></a><span id="l21.53">         mSendReport-&gt;SetError(nsIMsgSendReport::process_Current,</span>
<a href="#l21.54"></a><span id="l21.54">                               NS_MSG_ERROR_ATTACHING_FILE, false);</span>
<a href="#l21.55"></a><span id="l21.55">         return NS_MSG_ERROR_ATTACHING_FILE;</span>
<a href="#l21.56"></a><span id="l21.56">       }</span>
<a href="#l21.57"></a><span id="l21.57">       if (m_be_synchronous_p) break;</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineat">@@ -2873,18 +2873,18 @@ nsresult nsMsgComposeAndSend::DeliverMes</span>
<a href="#l21.59"></a><span id="l21.59">   if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l21.60"></a><span id="l21.60"> </span>
<a href="#l21.61"></a><span id="l21.61">   if ((mMessageWarningSize &gt; 0) &amp;&amp; (fileSize &gt; mMessageWarningSize) &amp;&amp;</span>
<a href="#l21.62"></a><span id="l21.62">       (mGUINotificationEnabled)) {</span>
<a href="#l21.63"></a><span id="l21.63">     bool abortTheSend = false;</span>
<a href="#l21.64"></a><span id="l21.64">     nsString msg;</span>
<a href="#l21.65"></a><span id="l21.65">     nsAutoString formattedFileSize;</span>
<a href="#l21.66"></a><span id="l21.66">     FormatFileSize(fileSize, true, formattedFileSize);</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-    const char16_t *params[] = {formattedFileSize.get()};</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">-    mComposeBundle-&gt;FormatStringFromName(&quot;largeMessageSendWarning&quot;, params, 1,</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; params = {formattedFileSize};</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+    mComposeBundle-&gt;FormatStringFromName(&quot;largeMessageSendWarning&quot;, params,</span>
<a href="#l21.71"></a><span id="l21.71">                                          msg);</span>
<a href="#l21.72"></a><span id="l21.72"> </span>
<a href="#l21.73"></a><span id="l21.73">     if (!msg.IsEmpty()) {</span>
<a href="#l21.74"></a><span id="l21.74">       nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l21.75"></a><span id="l21.75">       rv = GetDefaultPrompt(getter_AddRefs(prompt));</span>
<a href="#l21.76"></a><span id="l21.76">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.77"></a><span id="l21.77">       nsMsgAskBooleanQuestionByString(prompt, msg.get(), &amp;abortTheSend);</span>
<a href="#l21.78"></a><span id="l21.78">       if (!abortTheSend) {</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineat">@@ -3139,21 +3139,20 @@ nsresult nsMsgComposeAndSend::FormatStri</span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81">   // Get the smtp hostname and format the string.</span>
<a href="#l21.82"></a><span id="l21.82">   nsCString smtpHostName;</span>
<a href="#l21.83"></a><span id="l21.83">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l21.84"></a><span id="l21.84">   rv = smtpService-&gt;GetServerByIdentity(mUserIdentity,</span>
<a href="#l21.85"></a><span id="l21.85">                                         getter_AddRefs(smtpServer));</span>
<a href="#l21.86"></a><span id="l21.86">   if (NS_SUCCEEDED(rv)) smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l21.87"></a><span id="l21.87"> </span>
<a href="#l21.88"></a><span id="l21.88" class="difflineminus">-  nsAutoString hostStr;</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-  CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-  const char16_t *params[] = {hostStr.get()};</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; params;</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+  CopyASCIItoUTF16(smtpHostName, *params.AppendElement());</span>
<a href="#l21.93"></a><span id="l21.93">   if (NS_SUCCEEDED(rv))</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineminus">-    mComposeBundle-&gt;FormatStringFromName(aMsgName, params, 1, aString);</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+    mComposeBundle-&gt;FormatStringFromName(aMsgName, params, aString);</span>
<a href="#l21.96"></a><span id="l21.96">   return rv;</span>
<a href="#l21.97"></a><span id="l21.97"> }</span>
<a href="#l21.98"></a><span id="l21.98"> </span>
<a href="#l21.99"></a><span id="l21.99"> void nsMsgComposeAndSend::DoDeliveryExitProcessing(nsIURI *aUri,</span>
<a href="#l21.100"></a><span id="l21.100">                                                    nsresult aExitCode,</span>
<a href="#l21.101"></a><span id="l21.101">                                                    bool aCheckForMail) {</span>
<a href="#l21.102"></a><span id="l21.102">   // If we fail on the news delivery, no sense in going on so just notify</span>
<a href="#l21.103"></a><span id="l21.103">   // the user and exit.</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineat">@@ -3468,34 +3467,33 @@ nsMsgComposeAndSend::NotifyListenerOnSto</span>
<a href="#l21.105"></a><span id="l21.105">     } else</span>
<a href="#l21.106"></a><span id="l21.106">       rv = NS_ERROR_FAILURE;</span>
<a href="#l21.107"></a><span id="l21.107">     if (NS_FAILED(rv) || accountName.IsEmpty()) {</span>
<a href="#l21.108"></a><span id="l21.108">       // Unable to obtain accountName.</span>
<a href="#l21.109"></a><span id="l21.109">       Fail(NS_OK, nullptr, &amp;aStatus);</span>
<a href="#l21.110"></a><span id="l21.110">       return NS_ERROR_FAILURE;</span>
<a href="#l21.111"></a><span id="l21.111">     }</span>
<a href="#l21.112"></a><span id="l21.112"> </span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-    const char16_t *formatStrings[] = {mSavedToFolderName.get(),</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineminus">-                                       accountName.get(),</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineminus">-                                       localFoldersAccountName.get()};</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineplus">+    AutoTArray&lt;nsString, 3&gt; formatStrings = {mSavedToFolderName, accountName,</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+                                             localFoldersAccountName};</span>
<a href="#l21.118"></a><span id="l21.118"> </span>
<a href="#l21.119"></a><span id="l21.119">     nsString msg;</span>
<a href="#l21.120"></a><span id="l21.120">     switch (m_deliver_mode) {</span>
<a href="#l21.121"></a><span id="l21.121">       case nsMsgDeliverNow:</span>
<a href="#l21.122"></a><span id="l21.122">       case nsMsgSendUnsent:</span>
<a href="#l21.123"></a><span id="l21.123">         rv = bundle-&gt;FormatStringFromName(&quot;promptToSaveSentLocally2&quot;,</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineminus">-                                          formatStrings, 3, msg);</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+                                          formatStrings, msg);</span>
<a href="#l21.126"></a><span id="l21.126">         break;</span>
<a href="#l21.127"></a><span id="l21.127">       case nsMsgSaveAsDraft:</span>
<a href="#l21.128"></a><span id="l21.128">         rv = bundle-&gt;FormatStringFromName(&quot;promptToSaveDraftLocally2&quot;,</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineminus">-                                          formatStrings, 3, msg);</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineplus">+                                          formatStrings, msg);</span>
<a href="#l21.131"></a><span id="l21.131">         break;</span>
<a href="#l21.132"></a><span id="l21.132">       case nsMsgSaveAsTemplate:</span>
<a href="#l21.133"></a><span id="l21.133">         rv = bundle-&gt;FormatStringFromName(&quot;promptToSaveTemplateLocally2&quot;,</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineminus">-                                          formatStrings, 3, msg);</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineplus">+                                          formatStrings, msg);</span>
<a href="#l21.136"></a><span id="l21.136">         break;</span>
<a href="#l21.137"></a><span id="l21.137">       default:</span>
<a href="#l21.138"></a><span id="l21.138">         rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l21.139"></a><span id="l21.139">     }</span>
<a href="#l21.140"></a><span id="l21.140">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.141"></a><span id="l21.141">     int32_t buttonPressed = 0;</span>
<a href="#l21.142"></a><span id="l21.142">     bool showCheckBox = false;</span>
<a href="#l21.143"></a><span id="l21.143">     uint32_t buttonFlags =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -2144,58 +2144,55 @@ nsresult nsSmtpProtocol::GetPassword(nsS</span>
<a href="#l22.4"></a><span id="l22.4">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l22.5"></a><span id="l22.5">   rv = prefs-&gt;GetBranch(nullptr, getter_AddRefs(prefBranch));</span>
<a href="#l22.6"></a><span id="l22.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   nsCString username;</span>
<a href="#l22.9"></a><span id="l22.9">   rv = smtpServer-&gt;GetUsername(username);</span>
<a href="#l22.10"></a><span id="l22.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  NS_ConvertASCIItoUTF16 usernameUTF16(username);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-</span>
<a href="#l22.14"></a><span id="l22.14">   nsCString hostname;</span>
<a href="#l22.15"></a><span id="l22.15">   rv = smtpServer-&gt;GetHostname(hostname);</span>
<a href="#l22.16"></a><span id="l22.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.17"></a><span id="l22.17"> </span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-  nsAutoString hostnameUTF16;</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-  CopyASCIItoUTF16(hostname, hostnameUTF16);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-  const char16_t *formatStrings[] = {hostnameUTF16.get(), usernameUTF16.get()};</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; formatStrings;</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+  CopyASCIItoUTF16(hostname, *formatStrings.AppendElement());</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+  CopyASCIItoUTF16(username, *formatStrings.AppendElement());</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26">   rv = PromptForPassword(smtpServer, smtpUrl, formatStrings, aPassword);</span>
<a href="#l22.27"></a><span id="l22.27">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.28"></a><span id="l22.28">   return rv;</span>
<a href="#l22.29"></a><span id="l22.29"> }</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31"> /**</span>
<a href="#l22.32"></a><span id="l22.32">  * formatStrings is an array for the prompts, item 0 is the hostname, item 1</span>
<a href="#l22.33"></a><span id="l22.33">  * is the username.</span>
<a href="#l22.34"></a><span id="l22.34">  */</span>
<a href="#l22.35"></a><span id="l22.35"> nsresult nsSmtpProtocol::PromptForPassword(nsISmtpServer *aSmtpServer,</span>
<a href="#l22.36"></a><span id="l22.36">                                            nsISmtpUrl *aSmtpUrl,</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">-                                           const char16_t **formatStrings,</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+                                           nsTArray&lt;nsString&gt; &amp;formatStrings,</span>
<a href="#l22.39"></a><span id="l22.39">                                            nsAString &amp;aPassword) {</span>
<a href="#l22.40"></a><span id="l22.40">   nsCOMPtr&lt;nsIStringBundleService&gt; stringService =</span>
<a href="#l22.41"></a><span id="l22.41">       mozilla::services::GetStringBundleService();</span>
<a href="#l22.42"></a><span id="l22.42">   NS_ENSURE_TRUE(stringService, NS_ERROR_UNEXPECTED);</span>
<a href="#l22.43"></a><span id="l22.43"> </span>
<a href="#l22.44"></a><span id="l22.44">   nsCOMPtr&lt;nsIStringBundle&gt; composeStringBundle;</span>
<a href="#l22.45"></a><span id="l22.45">   nsresult rv = stringService-&gt;CreateBundle(</span>
<a href="#l22.46"></a><span id="l22.46">       &quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;,</span>
<a href="#l22.47"></a><span id="l22.47">       getter_AddRefs(composeStringBundle));</span>
<a href="#l22.48"></a><span id="l22.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.49"></a><span id="l22.49"> </span>
<a href="#l22.50"></a><span id="l22.50">   nsString passwordPromptString;</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-  if (formatStrings[1])</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+  if (formatStrings.Length() &gt; 1)</span>
<a href="#l22.53"></a><span id="l22.53">     rv = composeStringBundle-&gt;FormatStringFromName(</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-        &quot;smtpEnterPasswordPromptWithUsername&quot;, formatStrings, 2,</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineplus">+        &quot;smtpEnterPasswordPromptWithUsername&quot;, formatStrings,</span>
<a href="#l22.56"></a><span id="l22.56">         passwordPromptString);</span>
<a href="#l22.57"></a><span id="l22.57">   else</span>
<a href="#l22.58"></a><span id="l22.58">     rv = composeStringBundle-&gt;FormatStringFromName(</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineminus">-        &quot;smtpEnterPasswordPrompt&quot;, formatStrings, 1, passwordPromptString);</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+        &quot;smtpEnterPasswordPrompt&quot;, formatStrings, passwordPromptString);</span>
<a href="#l22.61"></a><span id="l22.61">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.62"></a><span id="l22.62"> </span>
<a href="#l22.63"></a><span id="l22.63">   nsCOMPtr&lt;nsIAuthPrompt&gt; netPrompt;</span>
<a href="#l22.64"></a><span id="l22.64">   rv = aSmtpUrl-&gt;GetAuthPrompt(getter_AddRefs(netPrompt));</span>
<a href="#l22.65"></a><span id="l22.65">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.66"></a><span id="l22.66"> </span>
<a href="#l22.67"></a><span id="l22.67">   nsString passwordTitle;</span>
<a href="#l22.68"></a><span id="l22.68">   rv = composeStringBundle-&gt;GetStringFromName(&quot;smtpEnterPasswordPromptTitle&quot;,</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineat">@@ -2228,17 +2225,16 @@ nsresult nsSmtpProtocol::GetUsernamePass</span>
<a href="#l22.70"></a><span id="l22.70">   }</span>
<a href="#l22.71"></a><span id="l22.71">   // empty password</span>
<a href="#l22.72"></a><span id="l22.72"> </span>
<a href="#l22.73"></a><span id="l22.73">   aPassword.Truncate();</span>
<a href="#l22.74"></a><span id="l22.74"> </span>
<a href="#l22.75"></a><span id="l22.75">   nsCString hostname;</span>
<a href="#l22.76"></a><span id="l22.76">   rv = smtpServer-&gt;GetHostname(hostname);</span>
<a href="#l22.77"></a><span id="l22.77">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineminus">-  nsAutoString hostnameUTF16;</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineminus">-  CopyASCIItoUTF16(hostname, hostnameUTF16);</span>
<a href="#l22.80"></a><span id="l22.80"> </span>
<a href="#l22.81"></a><span id="l22.81" class="difflineminus">-  const char16_t *formatStrings[] = {hostnameUTF16.get(), nullptr};</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings;</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+  CopyASCIItoUTF16(hostname, *formatStrings.AppendElement());</span>
<a href="#l22.84"></a><span id="l22.84"> </span>
<a href="#l22.85"></a><span id="l22.85">   rv = PromptForPassword(smtpServer, smtpUrl, formatStrings, aPassword);</span>
<a href="#l22.86"></a><span id="l22.86">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.87"></a><span id="l22.87">   return rv;</span>
<a href="#l22.88"></a><span id="l22.88"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -216,17 +216,17 @@ class nsSmtpProtocol : public nsMsgAsync</span>
<a href="#l23.4"></a><span id="l23.4">   ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">   void SendMessageInFile();</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">   void AppendHelloArgument(nsACString &amp;aResult);</span>
<a href="#l23.9"></a><span id="l23.9">   nsresult GetPassword(nsString &amp;aPassword);</span>
<a href="#l23.10"></a><span id="l23.10">   nsresult GetUsernamePassword(nsACString &amp;aUsername, nsAString &amp;aPassword);</span>
<a href="#l23.11"></a><span id="l23.11">   nsresult PromptForPassword(nsISmtpServer *aSmtpServer, nsISmtpUrl *aSmtpUrl,</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-                             const char16_t **formatStrings,</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+                             nsTArray&lt;nsString&gt; &amp;formatStrings,</span>
<a href="#l23.14"></a><span id="l23.14">                              nsAString &amp;aPassword);</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16">   void InitPrefAuthMethods(int32_t authMethodPrefValue);</span>
<a href="#l23.17"></a><span id="l23.17">   nsresult ChooseAuthMethod();</span>
<a href="#l23.18"></a><span id="l23.18">   void MarkAuthMethodAsFailed(int32_t failedAuthMethod);</span>
<a href="#l23.19"></a><span id="l23.19">   void ResetAuthMethods();</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">   virtual const char *GetType() override { return &quot;smtp&quot;; }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -92,31 +92,31 @@ nsMsgMdnGenerator::nsMsgMdnGenerator() {</span>
<a href="#l24.4"></a><span id="l24.4">   m_notInToCcOp = eNeverSendOp;</span>
<a href="#l24.5"></a><span id="l24.5">   m_outsideDomainOp = eNeverSendOp;</span>
<a href="#l24.6"></a><span id="l24.6">   m_otherOp = eNeverSendOp;</span>
<a href="#l24.7"></a><span id="l24.7"> }</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> nsMsgMdnGenerator::~nsMsgMdnGenerator() {}</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> nsresult nsMsgMdnGenerator::FormatStringFromName(const char *aName,</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-                                                 const char16_t *aString,</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+                                                 const nsString &amp;aString,</span>
<a href="#l24.14"></a><span id="l24.14">                                                  nsAString &amp;aResultString) {</span>
<a href="#l24.15"></a><span id="l24.15">   DEBUG_MDN(&quot;nsMsgMdnGenerator::FormatStringFromName&quot;);</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l24.18"></a><span id="l24.18">       mozilla::services::GetStringBundleService();</span>
<a href="#l24.19"></a><span id="l24.19">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l24.20"></a><span id="l24.20"> </span>
<a href="#l24.21"></a><span id="l24.21">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l24.22"></a><span id="l24.22">   nsresult rv =</span>
<a href="#l24.23"></a><span id="l24.23">       bundleService-&gt;CreateBundle(MDN_STRINGBUNDLE_URL, getter_AddRefs(bundle));</span>
<a href="#l24.24"></a><span id="l24.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.25"></a><span id="l24.25"> </span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-  const char16_t *formatStrings[1] = {aString};</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(aName, formatStrings, 1, aResultString);</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings = {aString};</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+  rv = bundle-&gt;FormatStringFromName(aName, formatStrings, aResultString);</span>
<a href="#l24.30"></a><span id="l24.30">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.31"></a><span id="l24.31">   return rv;</span>
<a href="#l24.32"></a><span id="l24.32"> }</span>
<a href="#l24.33"></a><span id="l24.33"> </span>
<a href="#l24.34"></a><span id="l24.34"> nsresult nsMsgMdnGenerator::GetStringFromName(const char *aName,</span>
<a href="#l24.35"></a><span id="l24.35">                                               nsAString &amp;aResultString) {</span>
<a href="#l24.36"></a><span id="l24.36">   DEBUG_MDN(&quot;nsMsgMdnGenerator::GetStringFromName&quot;);</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38" class="difflineat">@@ -420,18 +420,18 @@ nsresult nsMsgMdnGenerator::CreateFirstP</span>
<a href="#l24.39"></a><span id="l24.39">   // convert fullName to UTF8 before passing it to MakeMimeAddress</span>
<a href="#l24.40"></a><span id="l24.40">   MakeMimeAddress(NS_ConvertUTF16toUTF8(fullName), m_email, fullAddress);</span>
<a href="#l24.41"></a><span id="l24.41"> </span>
<a href="#l24.42"></a><span id="l24.42">   convbuf = nsMsgI18NEncodeMimePartIIStr(fullAddress.get(), true,</span>
<a href="#l24.43"></a><span id="l24.43">                                          m_charset.get(), 0, conformToStandard);</span>
<a href="#l24.44"></a><span id="l24.44"> </span>
<a href="#l24.45"></a><span id="l24.45">   parm = PR_smprintf(&quot;From: %s&quot; CRLF, convbuf ? convbuf : m_email.get());</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-  rv = FormatStringFromName(&quot;MsgMdnMsgSentTo&quot;,</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-                            NS_ConvertASCIItoUTF16(m_email).get(), firstPart1);</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+  rv = FormatStringFromName(&quot;MsgMdnMsgSentTo&quot;, NS_ConvertASCIItoUTF16(m_email),</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+                            firstPart1);</span>
<a href="#l24.51"></a><span id="l24.51">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l24.52"></a><span id="l24.52"> </span>
<a href="#l24.53"></a><span id="l24.53">   PUSH_N_FREE_STRING(parm);</span>
<a href="#l24.54"></a><span id="l24.54"> </span>
<a href="#l24.55"></a><span id="l24.55">   PR_Free(convbuf);</span>
<a href="#l24.56"></a><span id="l24.56"> </span>
<a href="#l24.57"></a><span id="l24.57">   if (compUtils) {</span>
<a href="#l24.58"></a><span id="l24.58">     nsCString msgId;</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineat">@@ -973,33 +973,32 @@ NS_IMETHODIMP nsMsgMdnGenerator::OnStopR</span>
<a href="#l24.60"></a><span id="l24.60">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.61"></a><span id="l24.61"> </span>
<a href="#l24.62"></a><span id="l24.62">   // Get the smtp hostname and format the string.</span>
<a href="#l24.63"></a><span id="l24.63">   nsCString smtpHostName;</span>
<a href="#l24.64"></a><span id="l24.64">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l24.65"></a><span id="l24.65">   rv = smtpService-&gt;GetServerByIdentity(m_identity, getter_AddRefs(smtpServer));</span>
<a href="#l24.66"></a><span id="l24.66">   if (NS_SUCCEEDED(rv)) smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l24.67"></a><span id="l24.67"> </span>
<a href="#l24.68"></a><span id="l24.68" class="difflineminus">-  nsAutoString hostStr;</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-  CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineminus">-  const char16_t *params[] = {hostStr.get()};</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; params;</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+  CopyASCIItoUTF16(smtpHostName, *params.AppendElement());</span>
<a href="#l24.73"></a><span id="l24.73"> </span>
<a href="#l24.74"></a><span id="l24.74">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l24.75"></a><span id="l24.75">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l24.76"></a><span id="l24.76">       mozilla::services::GetStringBundleService();</span>
<a href="#l24.77"></a><span id="l24.77">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l24.78"></a><span id="l24.78"> </span>
<a href="#l24.79"></a><span id="l24.79">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l24.80"></a><span id="l24.80">       &quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;,</span>
<a href="#l24.81"></a><span id="l24.81">       getter_AddRefs(bundle));</span>
<a href="#l24.82"></a><span id="l24.82">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.83"></a><span id="l24.83"> </span>
<a href="#l24.84"></a><span id="l24.84">   nsString failed_msg, dialogTitle;</span>
<a href="#l24.85"></a><span id="l24.85"> </span>
<a href="#l24.86"></a><span id="l24.86" class="difflineminus">-  bundle-&gt;FormatStringFromName(exitString, params, 1, failed_msg);</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineplus">+  bundle-&gt;FormatStringFromName(exitString, params, failed_msg);</span>
<a href="#l24.88"></a><span id="l24.88">   bundle-&gt;GetStringFromName(&quot;sendMessageErrorTitle&quot;, dialogTitle);</span>
<a href="#l24.89"></a><span id="l24.89"> </span>
<a href="#l24.90"></a><span id="l24.90">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l24.91"></a><span id="l24.91">   rv = m_window-&gt;GetPromptDialog(getter_AddRefs(dialog));</span>
<a href="#l24.92"></a><span id="l24.92">   if (NS_SUCCEEDED(rv)) dialog-&gt;Alert(dialogTitle.get(), failed_msg.get());</span>
<a href="#l24.93"></a><span id="l24.93"> </span>
<a href="#l24.94"></a><span id="l24.94">   return NS_OK;</span>
<a href="#l24.95"></a><span id="l24.95"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.h</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -47,17 +47,17 @@ class nsMsgMdnGenerator : public nsIMsgM</span>
<a href="#l25.4"></a><span id="l25.4">   nsresult CreateMdnMsg();</span>
<a href="#l25.5"></a><span id="l25.5">   nsresult CreateFirstPart();</span>
<a href="#l25.6"></a><span id="l25.6">   nsresult CreateSecondPart();</span>
<a href="#l25.7"></a><span id="l25.7">   nsresult CreateThirdPart();</span>
<a href="#l25.8"></a><span id="l25.8">   nsresult SendMdnMsg();</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10">   // string bundle helper methods</span>
<a href="#l25.11"></a><span id="l25.11">   nsresult GetStringFromName(const char *aName, nsAString &amp;aResultString);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  nsresult FormatStringFromName(const char *aName, const char16_t *aString,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  nsresult FormatStringFromName(const char *aName, const nsString &amp;aString,</span>
<a href="#l25.14"></a><span id="l25.14">                                 nsAString &amp;aResultString);</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">   // other helper methods</span>
<a href="#l25.17"></a><span id="l25.17">   nsresult InitAndProcess(bool *needToAskUser);</span>
<a href="#l25.18"></a><span id="l25.18">   nsresult OutputAllHeaders();</span>
<a href="#l25.19"></a><span id="l25.19">   nsresult WriteString(const char *str);</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">  private:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -162,23 +162,22 @@ nsresult nsMsgComposeSecure::GetSMIMEBun</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5">   NS_ENSURE_TRUE(InitializeSMIMEBundle(), NS_ERROR_FAILURE);</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7">   return mSMIMEBundle-&gt;GetStringFromName(NS_ConvertUTF16toUTF8(name).get(),</span>
<a href="#l26.8"></a><span id="l26.8">                                          outString);</span>
<a href="#l26.9"></a><span id="l26.9"> }</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11"> nsresult nsMsgComposeSecure::SMIMEBundleFormatStringFromName(</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    const char *name, const char16_t **params, uint32_t numParams,</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-    nsAString &amp;outString) {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+    const char *name, nsTArray&lt;nsString&gt; &amp;params, nsAString &amp;outString) {</span>
<a href="#l26.15"></a><span id="l26.15">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">   if (!InitializeSMIMEBundle()) return NS_ERROR_FAILURE;</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-  return mSMIMEBundle-&gt;FormatStringFromName(name, params, numParams, outString);</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+  return mSMIMEBundle-&gt;FormatStringFromName(name, params, outString);</span>
<a href="#l26.21"></a><span id="l26.21"> }</span>
<a href="#l26.22"></a><span id="l26.22"> </span>
<a href="#l26.23"></a><span id="l26.23"> bool nsMsgComposeSecure::InitializeSMIMEBundle() {</span>
<a href="#l26.24"></a><span id="l26.24">   if (mSMIMEBundle) return true;</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l26.27"></a><span id="l26.27">       mozilla::services::GetStringBundleService();</span>
<a href="#l26.28"></a><span id="l26.28">   nsresult rv = bundleService-&gt;CreateBundle(SMIME_STRBUNDLE_URL,</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineat">@@ -210,22 +209,19 @@ void nsMsgComposeSecure::SetErrorWithPar</span>
<a href="#l26.30"></a><span id="l26.30">   if (!sendReport || !bundle_string || !param) return;</span>
<a href="#l26.31"></a><span id="l26.31"> </span>
<a href="#l26.32"></a><span id="l26.32">   if (mErrorAlreadyReported) return;</span>
<a href="#l26.33"></a><span id="l26.33"> </span>
<a href="#l26.34"></a><span id="l26.34">   mErrorAlreadyReported = true;</span>
<a href="#l26.35"></a><span id="l26.35"> </span>
<a href="#l26.36"></a><span id="l26.36">   nsString errorString;</span>
<a href="#l26.37"></a><span id="l26.37">   nsresult res;</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-  const char16_t *params[1];</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">-</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">-  NS_ConvertASCIItoUTF16 ucs2(param);</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-  params[0] = ucs2.get();</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-  res = SMIMEBundleFormatStringFromName(bundle_string, params, 1, errorString);</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; params;</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+  CopyASCIItoUTF16(MakeStringSpan(param), *params.AppendElement());</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+  res = SMIMEBundleFormatStringFromName(bundle_string, params, errorString);</span>
<a href="#l26.47"></a><span id="l26.47"> </span>
<a href="#l26.48"></a><span id="l26.48">   if (NS_SUCCEEDED(res) &amp;&amp; !errorString.IsEmpty()) {</span>
<a href="#l26.49"></a><span id="l26.49">     sendReport-&gt;SetMessage(nsIMsgSendReport::process_Current, errorString.get(),</span>
<a href="#l26.50"></a><span id="l26.50">                            true);</span>
<a href="#l26.51"></a><span id="l26.51">   }</span>
<a href="#l26.52"></a><span id="l26.52"> }</span>
<a href="#l26.53"></a><span id="l26.53"> </span>
<a href="#l26.54"></a><span id="l26.54"> nsresult nsMsgComposeSecure::ExtractEncryptionState(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.h</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.h</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -52,18 +52,17 @@ class nsMsgComposeSecure : public nsIMsg</span>
<a href="#l27.4"></a><span id="l27.4">   nsresult MimeInitEncryption(bool aSign, nsIMsgSendReport *sendReport);</span>
<a href="#l27.5"></a><span id="l27.5">   nsresult MimeFinishMultipartSigned(bool aOuter, nsIMsgSendReport *sendReport);</span>
<a href="#l27.6"></a><span id="l27.6">   nsresult MimeFinishEncryption(bool aSign, nsIMsgSendReport *sendReport);</span>
<a href="#l27.7"></a><span id="l27.7">   nsresult MimeCryptoHackCerts(const char *aRecipients,</span>
<a href="#l27.8"></a><span id="l27.8">                                nsIMsgSendReport *sendReport, bool aEncrypt,</span>
<a href="#l27.9"></a><span id="l27.9">                                bool aSign, nsIMsgIdentity *aIdentity);</span>
<a href="#l27.10"></a><span id="l27.10">   bool InitializeSMIMEBundle();</span>
<a href="#l27.11"></a><span id="l27.11">   nsresult SMIMEBundleFormatStringFromName(const char *name,</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-                                           const char16_t **params,</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-                                           uint32_t numParams,</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+                                           nsTArray&lt;nsString&gt; &amp;paramsparams,</span>
<a href="#l27.15"></a><span id="l27.15">                                            nsAString &amp;outString);</span>
<a href="#l27.16"></a><span id="l27.16">   nsresult ExtractEncryptionState(nsIMsgIdentity *aIdentity,</span>
<a href="#l27.17"></a><span id="l27.17">                                   nsIMsgCompFields *aComposeFields,</span>
<a href="#l27.18"></a><span id="l27.18">                                   bool *aSignMessage, bool *aEncrypt);</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">   bool mSignMessage;</span>
<a href="#l27.21"></a><span id="l27.21">   bool mAlwaysEncryptMessage;</span>
<a href="#l27.22"></a><span id="l27.22">   mimeDeliveryCryptoState mCryptoState;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1679,19 +1679,19 @@ nsImapIncomingServer::FEAlert(const nsAS</span>
<a href="#l28.4"></a><span id="l28.4">   GetStringBundle();</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6">   if (m_stringBundle) {</span>
<a href="#l28.7"></a><span id="l28.7">     nsAutoString hostName;</span>
<a href="#l28.8"></a><span id="l28.8">     nsresult rv = GetPrettyName(hostName);</span>
<a href="#l28.9"></a><span id="l28.9">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l28.10"></a><span id="l28.10">       nsString message;</span>
<a href="#l28.11"></a><span id="l28.11">       nsString tempString(aAlertString);</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-      const char16_t *params[] = {hostName.get(), tempString.get()};</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-      rv = m_stringBundle-&gt;FormatStringFromName(&quot;imapServerAlert&quot;, params, 2,</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+      AutoTArray&lt;nsString, 2&gt; params = {hostName, tempString};</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+      rv = m_stringBundle-&gt;FormatStringFromName(&quot;imapServerAlert&quot;, params,</span>
<a href="#l28.18"></a><span id="l28.18">                                                 message);</span>
<a href="#l28.19"></a><span id="l28.19">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l28.20"></a><span id="l28.20">         aUrl-&gt;SetErrorCode(NS_LITERAL_CSTRING(&quot;imap-server-alert&quot;));</span>
<a href="#l28.21"></a><span id="l28.21">         aUrl-&gt;SetErrorMessage(message);</span>
<a href="#l28.22"></a><span id="l28.22"> </span>
<a href="#l28.23"></a><span id="l28.23">         return AlertUser(message, aUrl);</span>
<a href="#l28.24"></a><span id="l28.24">       }</span>
<a href="#l28.25"></a><span id="l28.25">     }</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineat">@@ -1718,19 +1718,19 @@ nsImapIncomingServer::FEAlertWithName(co</span>
<a href="#l28.27"></a><span id="l28.27">   GetStringBundle();</span>
<a href="#l28.28"></a><span id="l28.28"> </span>
<a href="#l28.29"></a><span id="l28.29">   nsString message;</span>
<a href="#l28.30"></a><span id="l28.30"> </span>
<a href="#l28.31"></a><span id="l28.31">   if (m_stringBundle) {</span>
<a href="#l28.32"></a><span id="l28.32">     nsAutoCString hostName;</span>
<a href="#l28.33"></a><span id="l28.33">     nsresult rv = GetHostName(hostName);</span>
<a href="#l28.34"></a><span id="l28.34">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">-      const NS_ConvertUTF8toUTF16 hostName16(hostName);</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-      const char16_t *params[] = {hostName16.get()};</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">-      rv = m_stringBundle-&gt;FormatStringFromName(aMsgName, params, 1, message);</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; params;</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+      CopyUTF8toUTF16(hostName, *params.AppendElement());</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+      rv = m_stringBundle-&gt;FormatStringFromName(aMsgName, params, message);</span>
<a href="#l28.41"></a><span id="l28.41">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l28.42"></a><span id="l28.42">         aUrl-&gt;SetErrorCode(nsDependentCString(aMsgName));</span>
<a href="#l28.43"></a><span id="l28.43">         aUrl-&gt;SetErrorMessage(message);</span>
<a href="#l28.44"></a><span id="l28.44"> </span>
<a href="#l28.45"></a><span id="l28.45">         return AlertUser(message, aUrl);</span>
<a href="#l28.46"></a><span id="l28.46">       }</span>
<a href="#l28.47"></a><span id="l28.47">     }</span>
<a href="#l28.48"></a><span id="l28.48">   }</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineat">@@ -1758,20 +1758,19 @@ NS_IMETHODIMP nsImapIncomingServer::FEAl</span>
<a href="#l28.50"></a><span id="l28.50">   if (pos != -1) pos = message.FindChar(' ', pos + 1);</span>
<a href="#l28.51"></a><span id="l28.51"> </span>
<a href="#l28.52"></a><span id="l28.52">   // Adjust the message.</span>
<a href="#l28.53"></a><span id="l28.53">   if (pos != -1) message = Substring(message, pos + 1);</span>
<a href="#l28.54"></a><span id="l28.54"> </span>
<a href="#l28.55"></a><span id="l28.55">   nsString hostName;</span>
<a href="#l28.56"></a><span id="l28.56">   GetPrettyName(hostName);</span>
<a href="#l28.57"></a><span id="l28.57"> </span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-  const char16_t *formatStrings[] = {hostName.get(), nullptr, nullptr};</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+  AutoTArray&lt;nsString, 3&gt; formatStrings = {hostName};</span>
<a href="#l28.60"></a><span id="l28.60"> </span>
<a href="#l28.61"></a><span id="l28.61">   const char *msgName;</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-  int32_t numStrings;</span>
<a href="#l28.63"></a><span id="l28.63">   nsString fullMessage;</span>
<a href="#l28.64"></a><span id="l28.64">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl = do_QueryInterface(aUrl);</span>
<a href="#l28.65"></a><span id="l28.65">   NS_ENSURE_TRUE(imapUrl, NS_ERROR_INVALID_ARG);</span>
<a href="#l28.66"></a><span id="l28.66"> </span>
<a href="#l28.67"></a><span id="l28.67">   nsImapState imapState;</span>
<a href="#l28.68"></a><span id="l28.68">   nsImapAction imapAction;</span>
<a href="#l28.69"></a><span id="l28.69"> </span>
<a href="#l28.70"></a><span id="l28.70">   imapUrl-&gt;GetRequiredImapState(&amp;imapState);</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineat">@@ -1783,31 +1782,29 @@ NS_IMETHODIMP nsImapIncomingServer::FEAl</span>
<a href="#l28.72"></a><span id="l28.72">   aUrl-&gt;SetErrorCode(NS_LITERAL_CSTRING(&quot;imap-server-error&quot;));</span>
<a href="#l28.73"></a><span id="l28.73">   aUrl-&gt;SetErrorMessage(unicodeMsg);</span>
<a href="#l28.74"></a><span id="l28.74"> </span>
<a href="#l28.75"></a><span id="l28.75">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l28.76"></a><span id="l28.76">   if (imapState == nsIImapUrl::nsImapSelectedState ||</span>
<a href="#l28.77"></a><span id="l28.77">       imapAction == nsIImapUrl::nsImapFolderStatus) {</span>
<a href="#l28.78"></a><span id="l28.78">     aUrl-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l28.79"></a><span id="l28.79">     if (folder) folder-&gt;GetPrettyName(folderName);</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-    numStrings = 3;</span>
<a href="#l28.81"></a><span id="l28.81">     msgName = &quot;imapFolderCommandFailed&quot;;</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-    formatStrings[1] = folderName.get();</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineplus">+    formatStrings.AppendElement(folderName);</span>
<a href="#l28.84"></a><span id="l28.84">   } else {</span>
<a href="#l28.85"></a><span id="l28.85">     msgName = &quot;imapServerCommandFailed&quot;;</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-    numStrings = 2;</span>
<a href="#l28.87"></a><span id="l28.87">   }</span>
<a href="#l28.88"></a><span id="l28.88"> </span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-  formatStrings[numStrings - 1] = unicodeMsg.get();</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineplus">+  formatStrings.AppendElement(unicodeMsg);</span>
<a href="#l28.91"></a><span id="l28.91"> </span>
<a href="#l28.92"></a><span id="l28.92">   nsresult rv = GetStringBundle();</span>
<a href="#l28.93"></a><span id="l28.93">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.94"></a><span id="l28.94">   if (m_stringBundle) {</span>
<a href="#l28.95"></a><span id="l28.95">     rv = m_stringBundle-&gt;FormatStringFromName(msgName, formatStrings,</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineminus">-                                              numStrings, fullMessage);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineplus">+                                              fullMessage);</span>
<a href="#l28.98"></a><span id="l28.98">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.99"></a><span id="l28.99">   }</span>
<a href="#l28.100"></a><span id="l28.100"> </span>
<a href="#l28.101"></a><span id="l28.101">   return AlertUser(fullMessage, aUrl);</span>
<a href="#l28.102"></a><span id="l28.102"> }</span>
<a href="#l28.103"></a><span id="l28.103"> </span>
<a href="#l28.104"></a><span id="l28.104"> #define IMAP_MSGS_URL &quot;chrome://messenger/locale/imapMsgs.properties&quot;</span>
<a href="#l28.105"></a><span id="l28.105"> </span>
<a href="#l28.106"></a><span id="l28.106" class="difflineat">@@ -1985,24 +1982,22 @@ nsImapIncomingServer::PromptPassword(nsI</span>
<a href="#l28.107"></a><span id="l28.107">   GetRealUsername(userName);</span>
<a href="#l28.108"></a><span id="l28.108"> </span>
<a href="#l28.109"></a><span id="l28.109">   nsAutoCString hostName;</span>
<a href="#l28.110"></a><span id="l28.110">   GetRealHostName(hostName);</span>
<a href="#l28.111"></a><span id="l28.111"> </span>
<a href="#l28.112"></a><span id="l28.112">   nsresult rv = GetStringBundle();</span>
<a href="#l28.113"></a><span id="l28.113">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.114"></a><span id="l28.114"> </span>
<a href="#l28.115"></a><span id="l28.115" class="difflineminus">-  NS_ConvertASCIItoUTF16 finalUserName(userName);</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineminus">-  NS_ConvertASCIItoUTF16 finalHostName(hostName);</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineminus">-</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineminus">-  const char16_t *formatStrings[] = {finalUserName.get(), finalHostName.get()};</span>
<a href="#l28.119"></a><span id="l28.119" class="difflineminus">-</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; formatStrings;</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineplus">+  CopyASCIItoUTF16(userName, *formatStrings.AppendElement());</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineplus">+  CopyASCIItoUTF16(hostName, *formatStrings.AppendElement());</span>
<a href="#l28.123"></a><span id="l28.123">   nsString passwordText;</span>
<a href="#l28.124"></a><span id="l28.124">   rv = m_stringBundle-&gt;FormatStringFromName(&quot;imapEnterServerPasswordPrompt&quot;,</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-                                            formatStrings, 2, passwordText);</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineplus">+                                            formatStrings, passwordText);</span>
<a href="#l28.127"></a><span id="l28.127">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.128"></a><span id="l28.128"> </span>
<a href="#l28.129"></a><span id="l28.129">   rv = GetPasswordWithUI(passwordText, passwordTitle, aMsgWindow, aPassword);</span>
<a href="#l28.130"></a><span id="l28.130">   if (NS_SUCCEEDED(rv)) m_password = aPassword;</span>
<a href="#l28.131"></a><span id="l28.131">   return rv;</span>
<a href="#l28.132"></a><span id="l28.132"> }</span>
<a href="#l28.133"></a><span id="l28.133"> </span>
<a href="#l28.134"></a><span id="l28.134"> // for the nsIImapServerSink interface</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineat">@@ -2668,20 +2663,20 @@ nsImapIncomingServer::GeneratePrettyName</span>
<a href="#l28.136"></a><span id="l28.136">                                     &quot;imapDefaultAccountName&quot;, aPrettyName);</span>
<a href="#l28.137"></a><span id="l28.137"> }</span>
<a href="#l28.138"></a><span id="l28.138"> </span>
<a href="#l28.139"></a><span id="l28.139"> nsresult nsImapIncomingServer::GetFormattedStringFromName(</span>
<a href="#l28.140"></a><span id="l28.140">     const nsAString &amp;aValue, const char *aName, nsAString &amp;aResult) {</span>
<a href="#l28.141"></a><span id="l28.141">   nsresult rv = GetStringBundle();</span>
<a href="#l28.142"></a><span id="l28.142">   if (m_stringBundle) {</span>
<a href="#l28.143"></a><span id="l28.143">     nsString tmpVal(aValue);</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-    const char16_t *formatStrings[] = {tmpVal.get()};</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; formatStrings = {tmpVal};</span>
<a href="#l28.146"></a><span id="l28.146"> </span>
<a href="#l28.147"></a><span id="l28.147">     nsString result;</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineminus">-    rv = m_stringBundle-&gt;FormatStringFromName(aName, formatStrings, 1, result);</span>
<a href="#l28.149"></a><span id="l28.149" class="difflineplus">+    rv = m_stringBundle-&gt;FormatStringFromName(aName, formatStrings, result);</span>
<a href="#l28.150"></a><span id="l28.150">     aResult.Assign(result);</span>
<a href="#l28.151"></a><span id="l28.151">   }</span>
<a href="#l28.152"></a><span id="l28.152">   return rv;</span>
<a href="#l28.153"></a><span id="l28.153"> }</span>
<a href="#l28.154"></a><span id="l28.154"> </span>
<a href="#l28.155"></a><span id="l28.155"> nsresult nsImapIncomingServer::GetPrefForServerAttribute(const char *prefSuffix,</span>
<a href="#l28.156"></a><span id="l28.156">                                                          bool *prefValue) {</span>
<a href="#l28.157"></a><span id="l28.157">   // Any caller of this function must initialize prefValue with a default value</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1427,33 +1427,33 @@ NS_IMETHODIMP nsImapMailFolder::Rename(c</span>
<a href="#l29.4"></a><span id="l29.4">   nsAutoString newNameStr(newName);</span>
<a href="#l29.5"></a><span id="l29.5">   if (newNameStr.FindChar(m_hierarchyDelimiter, 0) != kNotFound) {</span>
<a href="#l29.6"></a><span id="l29.6">     nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l29.7"></a><span id="l29.7">     if (msgWindow) msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l29.8"></a><span id="l29.8">     if (docShell) {</span>
<a href="#l29.9"></a><span id="l29.9">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l29.10"></a><span id="l29.10">       rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l29.11"></a><span id="l29.11">       if (NS_SUCCEEDED(rv) &amp;&amp; bundle) {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-        const char16_t delimiter[2] = {(char16_t)m_hierarchyDelimiter, '\0'};</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-        const char16_t *formatStrings[] = {delimiter};</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+        AutoTArray&lt;nsString, 1&gt; formatStrings;</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+        formatStrings.AppendElement()-&gt;Append(m_hierarchyDelimiter);</span>
<a href="#l29.16"></a><span id="l29.16">         nsString alertString;</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-        rv = bundle-&gt;FormatStringFromName(&quot;imapSpecialChar2&quot;, formatStrings, 1,</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+        rv = bundle-&gt;FormatStringFromName(&quot;imapSpecialChar2&quot;, formatStrings,</span>
<a href="#l29.19"></a><span id="l29.19">                                           alertString);</span>
<a href="#l29.20"></a><span id="l29.20">         nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(docShell));</span>
<a href="#l29.21"></a><span id="l29.21">         // setting up the dialog title</span>
<a href="#l29.22"></a><span id="l29.22">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l29.23"></a><span id="l29.23">         rv = GetServer(getter_AddRefs(server));</span>
<a href="#l29.24"></a><span id="l29.24">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.25"></a><span id="l29.25">         nsString dialogTitle;</span>
<a href="#l29.26"></a><span id="l29.26">         nsString accountName;</span>
<a href="#l29.27"></a><span id="l29.27">         rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l29.28"></a><span id="l29.28">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-        const char16_t *titleParams[] = {accountName.get()};</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+        AutoTArray&lt;nsString, 1&gt; titleParams = {accountName};</span>
<a href="#l29.31"></a><span id="l29.31">         rv = bundle-&gt;FormatStringFromName(&quot;imapAlertDialogTitle&quot;, titleParams,</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">-                                          1, dialogTitle);</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+                                          dialogTitle);</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">         if (dialog &amp;&amp; !alertString.IsEmpty())</span>
<a href="#l29.36"></a><span id="l29.36">           dialog-&gt;Alert(dialogTitle.get(), alertString.get());</span>
<a href="#l29.37"></a><span id="l29.37">       }</span>
<a href="#l29.38"></a><span id="l29.38">     }</span>
<a href="#l29.39"></a><span id="l29.39">     return NS_ERROR_FAILURE;</span>
<a href="#l29.40"></a><span id="l29.40">   }</span>
<a href="#l29.41"></a><span id="l29.41">   nsCOMPtr&lt;nsIImapIncomingServer&gt; incomingImapServer;</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineat">@@ -2185,32 +2185,32 @@ nsImapMailFolder::DeleteSubFolders(nsIAr</span>
<a href="#l29.43"></a><span id="l29.43">   {</span>
<a href="#l29.44"></a><span id="l29.44">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l29.45"></a><span id="l29.45">     rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l29.46"></a><span id="l29.46">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.47"></a><span id="l29.47"> </span>
<a href="#l29.48"></a><span id="l29.48">     nsAutoString folderName;</span>
<a href="#l29.49"></a><span id="l29.49">     rv = curFolder-&gt;GetName(folderName);</span>
<a href="#l29.50"></a><span id="l29.50">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-    const char16_t *formatStrings[1] = {folderName.get()};</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; formatStrings = {folderName};</span>
<a href="#l29.53"></a><span id="l29.53"> </span>
<a href="#l29.54"></a><span id="l29.54">     nsAutoString deleteFolderDialogTitle;</span>
<a href="#l29.55"></a><span id="l29.55">     rv = bundle-&gt;GetStringFromName(&quot;imapDeleteFolderDialogTitle&quot;,</span>
<a href="#l29.56"></a><span id="l29.56">                                    deleteFolderDialogTitle);</span>
<a href="#l29.57"></a><span id="l29.57">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.58"></a><span id="l29.58"> </span>
<a href="#l29.59"></a><span id="l29.59">     nsAutoString deleteFolderButtonLabel;</span>
<a href="#l29.60"></a><span id="l29.60">     rv = bundle-&gt;GetStringFromName(&quot;imapDeleteFolderButtonLabel&quot;,</span>
<a href="#l29.61"></a><span id="l29.61">                                    deleteFolderButtonLabel);</span>
<a href="#l29.62"></a><span id="l29.62">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.63"></a><span id="l29.63"> </span>
<a href="#l29.64"></a><span id="l29.64">     nsAutoString confirmationStr;</span>
<a href="#l29.65"></a><span id="l29.65">     rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l29.66"></a><span id="l29.66">         (deleteNoTrash) ? &quot;imapDeleteNoTrash&quot; : &quot;imapMoveFolderToTrash&quot;,</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-        formatStrings, 1, confirmationStr);</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineplus">+        formatStrings, confirmationStr);</span>
<a href="#l29.69"></a><span id="l29.69">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.70"></a><span id="l29.70">     if (!msgWindow) return NS_ERROR_NULL_POINTER;</span>
<a href="#l29.71"></a><span id="l29.71">     nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l29.72"></a><span id="l29.72">     msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l29.73"></a><span id="l29.73">     nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l29.74"></a><span id="l29.74">     if (docShell) dialog = do_GetInterface(docShell);</span>
<a href="#l29.75"></a><span id="l29.75">     if (dialog) {</span>
<a href="#l29.76"></a><span id="l29.76">       int32_t buttonPressed = 0;</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineat">@@ -5573,19 +5573,19 @@ nsImapMailFolder::FillInFolderProps(nsIM</span>
<a href="#l29.78"></a><span id="l29.78">     if (owner.IsEmpty()) {</span>
<a href="#l29.79"></a><span id="l29.79">       rv = IMAPGetStringByName(folderTypeStringID, getter_Copies(uniOwner));</span>
<a href="#l29.80"></a><span id="l29.80">       // Another user's folder, for which we couldn't find an owner name</span>
<a href="#l29.81"></a><span id="l29.81">       NS_ASSERTION(false, &quot;couldn't get owner name for other user's folder&quot;);</span>
<a href="#l29.82"></a><span id="l29.82">     } else {</span>
<a href="#l29.83"></a><span id="l29.83">       // is this right? It doesn't leak, does it?</span>
<a href="#l29.84"></a><span id="l29.84">       CopyASCIItoUTF16(owner, uniOwner);</span>
<a href="#l29.85"></a><span id="l29.85">     }</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-    const char16_t *params[] = {uniOwner.get()};</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; params = {uniOwner};</span>
<a href="#l29.88"></a><span id="l29.88">     rv = bundle-&gt;FormatStringFromName(&quot;imapOtherUsersFolderTypeDescription&quot;,</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineminus">-                                      params, 1, folderTypeDesc);</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineplus">+                                      params, folderTypeDesc);</span>
<a href="#l29.91"></a><span id="l29.91">   } else if (GetFolderACL()-&gt;GetIsFolderShared()) {</span>
<a href="#l29.92"></a><span id="l29.92">     folderTypeStringID = &quot;imapPersonalSharedFolderTypeName&quot;;</span>
<a href="#l29.93"></a><span id="l29.93">     folderTypeDescStringID = &quot;imapPersonalSharedFolderTypeDescription&quot;;</span>
<a href="#l29.94"></a><span id="l29.94">   } else {</span>
<a href="#l29.95"></a><span id="l29.95">     folderTypeStringID = &quot;imapPersonalSharedFolderTypeName&quot;;</span>
<a href="#l29.96"></a><span id="l29.96">     folderTypeDescStringID = &quot;imapPersonalFolderTypeDescription&quot;;</span>
<a href="#l29.97"></a><span id="l29.97">   }</span>
<a href="#l29.98"></a><span id="l29.98"> </span>
<a href="#l29.99"></a><span id="l29.99" class="difflineat">@@ -7443,24 +7443,24 @@ nsresult nsImapMailFolder::CopyStreamMes</span>
<a href="#l29.100"></a><span id="l29.100">     if (m_copyState-&gt;m_totalCount &gt; 1) {</span>
<a href="#l29.101"></a><span id="l29.101">       nsString dstFolderName, progressText;</span>
<a href="#l29.102"></a><span id="l29.102">       GetName(dstFolderName);</span>
<a href="#l29.103"></a><span id="l29.103">       nsAutoString curMsgString;</span>
<a href="#l29.104"></a><span id="l29.104">       nsAutoString totalMsgString;</span>
<a href="#l29.105"></a><span id="l29.105">       totalMsgString.AppendInt(m_copyState-&gt;m_totalCount);</span>
<a href="#l29.106"></a><span id="l29.106">       curMsgString.AppendInt(m_copyState-&gt;m_curIndex + 1);</span>
<a href="#l29.107"></a><span id="l29.107"> </span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-      const char16_t *formatStrings[3] = {</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineminus">-          curMsgString.get(), totalMsgString.get(), dstFolderName.get()};</span>
<a href="#l29.110"></a><span id="l29.110" class="difflineplus">+      AutoTArray&lt;nsString, 3&gt; formatStrings = {curMsgString, totalMsgString,</span>
<a href="#l29.111"></a><span id="l29.111" class="difflineplus">+                                               dstFolderName};</span>
<a href="#l29.112"></a><span id="l29.112"> </span>
<a href="#l29.113"></a><span id="l29.113">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l29.114"></a><span id="l29.114">       rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l29.115"></a><span id="l29.115">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.116"></a><span id="l29.116">       rv = bundle-&gt;FormatStringFromName(&quot;imapCopyingMessageOf2&quot;, formatStrings,</span>
<a href="#l29.117"></a><span id="l29.117" class="difflineminus">-                                        3, progressText);</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineplus">+                                        progressText);</span>
<a href="#l29.119"></a><span id="l29.119">       nsCOMPtr&lt;nsIMsgStatusFeedback&gt; statusFeedback;</span>
<a href="#l29.120"></a><span id="l29.120">       if (m_copyState-&gt;m_msgWindow)</span>
<a href="#l29.121"></a><span id="l29.121">         m_copyState-&gt;m_msgWindow-&gt;GetStatusFeedback(</span>
<a href="#l29.122"></a><span id="l29.122">             getter_AddRefs(statusFeedback));</span>
<a href="#l29.123"></a><span id="l29.123">       if (statusFeedback) {</span>
<a href="#l29.124"></a><span id="l29.124">         statusFeedback-&gt;ShowStatusString(progressText);</span>
<a href="#l29.125"></a><span id="l29.125">         int32_t percent;</span>
<a href="#l29.126"></a><span id="l29.126">         percent = (100 * m_copyState-&gt;m_curIndex) /</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -5058,22 +5058,22 @@ void nsImapProtocol::ShowProgress() {</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">     int32_t progressCurrentNumber = ++m_progressCurrentNumber[m_stringIndex];</span>
<a href="#l30.6"></a><span id="l30.6">     nsAutoString progressCurrentNumberString;</span>
<a href="#l30.7"></a><span id="l30.7">     progressCurrentNumberString.AppendInt(progressCurrentNumber);</span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9">     nsAutoString progressExpectedNumberString;</span>
<a href="#l30.10"></a><span id="l30.10">     progressExpectedNumberString.AppendInt(m_progressExpectedNumber);</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    const char16_t *formatStrings[] = {progressCurrentNumberString.get(),</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-                                       progressExpectedNumberString.get(),</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-                                       unicodeMailboxName.get()};</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+    AutoTArray&lt;nsString, 3&gt; formatStrings = {progressCurrentNumberString,</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+                                             progressExpectedNumberString,</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+                                             unicodeMailboxName};</span>
<a href="#l30.18"></a><span id="l30.18"> </span>
<a href="#l30.19"></a><span id="l30.19">     rv = m_bundle-&gt;FormatStringFromName(m_progressStringName.get(),</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineminus">-                                        formatStrings, 3, progressString);</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+                                        formatStrings, progressString);</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23">     if (NS_SUCCEEDED(rv) &amp;&amp; !progressString.IsEmpty()) {</span>
<a href="#l30.24"></a><span id="l30.24">       PercentProgressUpdateEvent(progressString.get(), progressCurrentNumber,</span>
<a href="#l30.25"></a><span id="l30.25">                                  m_progressExpectedNumber);</span>
<a href="#l30.26"></a><span id="l30.26">     }</span>
<a href="#l30.27"></a><span id="l30.27">   }</span>
<a href="#l30.28"></a><span id="l30.28"> }</span>
<a href="#l30.29"></a><span id="l30.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -2565,19 +2565,19 @@ NS_IMETHODIMP nsImapService::NewChannel(</span>
<a href="#l31.4"></a><span id="l31.4">       nsString statusString, confirmText;</span>
<a href="#l31.5"></a><span id="l31.5">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l31.6"></a><span id="l31.6">       rv = IMAPGetStringBundle(getter_AddRefs(bundle));</span>
<a href="#l31.7"></a><span id="l31.7">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.8"></a><span id="l31.8">       // need to convert folder name from mod-utf7 to unicode</span>
<a href="#l31.9"></a><span id="l31.9">       nsAutoString unescapedName;</span>
<a href="#l31.10"></a><span id="l31.10">       if (NS_FAILED(CopyMUTF7toUTF16(fullFolderName, unescapedName)))</span>
<a href="#l31.11"></a><span id="l31.11">         CopyASCIItoUTF16(fullFolderName, unescapedName);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-      const char16_t *formatStrings[1] = {unescapedName.get()};</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;imapSubscribePrompt&quot;, formatStrings, 1,</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; formatStrings = {unescapedName};</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+      rv = bundle-&gt;FormatStringFromName(&quot;imapSubscribePrompt&quot;, formatStrings,</span>
<a href="#l31.18"></a><span id="l31.18">                                         confirmText);</span>
<a href="#l31.19"></a><span id="l31.19">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.20"></a><span id="l31.20"> </span>
<a href="#l31.21"></a><span id="l31.21">       bool confirmResult = false;</span>
<a href="#l31.22"></a><span id="l31.22">       rv = dialog-&gt;Confirm(nullptr, confirmText.get(), &amp;confirmResult);</span>
<a href="#l31.23"></a><span id="l31.23">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25">       if (confirmResult) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -579,19 +579,19 @@ nsAppleMailImportMail::ImportMailbox(nsI</span>
<a href="#l32.4"></a><span id="l32.4"> </span>
<a href="#l32.5"></a><span id="l32.5">   return NS_OK;</span>
<a href="#l32.6"></a><span id="l32.6"> }</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> void nsAppleMailImportMail::ReportStatus(const char16_t *aErrorName,</span>
<a href="#l32.9"></a><span id="l32.9">                                          nsString &amp;aName, nsAString &amp;aStream) {</span>
<a href="#l32.10"></a><span id="l32.10">   // get (and format, if needed) the error string from the bundle</span>
<a href="#l32.11"></a><span id="l32.11">   nsAutoString outString;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  const char16_t *fmt = {aName.get()};</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; fmt = {aName};</span>
<a href="#l32.14"></a><span id="l32.14">   nsresult rv = mBundle-&gt;FormatStringFromName(</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-      NS_ConvertUTF16toUTF8(aErrorName).get(), &amp;fmt, 1, outString);</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+      NS_ConvertUTF16toUTF8(aErrorName).get(), fmt, outString);</span>
<a href="#l32.17"></a><span id="l32.17">   // write it out the stream</span>
<a href="#l32.18"></a><span id="l32.18">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l32.19"></a><span id="l32.19">     aStream.Append(outString);</span>
<a href="#l32.20"></a><span id="l32.20">     aStream.Append(char16_t('\n'));</span>
<a href="#l32.21"></a><span id="l32.21">   }</span>
<a href="#l32.22"></a><span id="l32.22"> }</span>
<a href="#l32.23"></a><span id="l32.23"> </span>
<a href="#l32.24"></a><span id="l32.24"> void nsAppleMailImportMail::SetLogs(const nsAString &amp;aSuccess,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckyMail.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckyMail.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -543,19 +543,19 @@ nsBeckyMail::ImportMailbox(nsIImportMail</span>
<a href="#l33.4"></a><span id="l33.4">   uint32_t finalSize;</span>
<a href="#l33.5"></a><span id="l33.5">   aSource-&gt;GetSize(&amp;finalSize);</span>
<a href="#l33.6"></a><span id="l33.6">   mReadBytes = finalSize;</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8">   nsAutoString name;</span>
<a href="#l33.9"></a><span id="l33.9">   aSource-&gt;GetDisplayName(getter_Copies(name));</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">   nsAutoString successMessage;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  const char16_t *format = {name.get()};</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; format = {name};</span>
<a href="#l33.14"></a><span id="l33.14">   rv = nsBeckyStringBundle::FormatStringFromName(&quot;BeckyImportMailboxSuccess&quot;,</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-                                                 &amp;format, 1, successMessage);</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+                                                 format, successMessage);</span>
<a href="#l33.17"></a><span id="l33.17">   successMessage.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l33.18"></a><span id="l33.18">   *aSuccessLog = ToNewUnicode(successMessage);</span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20">   return rv;</span>
<a href="#l33.21"></a><span id="l33.21"> }</span>
<a href="#l33.22"></a><span id="l33.22"> </span>
<a href="#l33.23"></a><span id="l33.23"> NS_IMETHODIMP</span>
<a href="#l33.24"></a><span id="l33.24"> nsBeckyMail::GetImportProgress(uint32_t *_retval) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckyStringBundle.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckyStringBundle.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -40,17 +40,16 @@ char16_t *nsBeckyStringBundle::GetString</span>
<a href="#l34.4"></a><span id="l34.4">     mBundle-&gt;GetStringFromName(aName, string);</span>
<a href="#l34.5"></a><span id="l34.5">     return ToNewUnicode(string);</span>
<a href="#l34.6"></a><span id="l34.6">   }</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8">   return nullptr;</span>
<a href="#l34.9"></a><span id="l34.9"> }</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11"> nsresult nsBeckyStringBundle::FormatStringFromName(const char *name,</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-                                                   const char16_t **params,</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-                                                   uint32_t length,</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+                                                   nsTArray&lt;nsString&gt; &amp;params,</span>
<a href="#l34.15"></a><span id="l34.15">                                                    nsAString &amp;_retval) {</span>
<a href="#l34.16"></a><span id="l34.16">   EnsureStringBundle();</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18" class="difflineminus">-  return mBundle-&gt;FormatStringFromName(name, params, length, _retval);</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+  return mBundle-&gt;FormatStringFromName(name, params, _retval);</span>
<a href="#l34.20"></a><span id="l34.20"> }</span>
<a href="#l34.21"></a><span id="l34.21"> </span>
<a href="#l34.22"></a><span id="l34.22"> void nsBeckyStringBundle::Cleanup(void) { mBundle = nullptr; }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckyStringBundle.h</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckyStringBundle.h</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #include &quot;nsString.h&quot;</span>
<a href="#l35.5"></a><span id="l35.5"> </span>
<a href="#l35.6"></a><span id="l35.6"> class nsIStringBundle;</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8"> class nsBeckyStringBundle final {</span>
<a href="#l35.9"></a><span id="l35.9">  public:</span>
<a href="#l35.10"></a><span id="l35.10">   static char16_t *GetStringByName(const char *name);</span>
<a href="#l35.11"></a><span id="l35.11">   static nsresult FormatStringFromName(const char *name,</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-                                       const char16_t **params, uint32_t length,</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+                                       nsTArray&lt;nsString&gt; &amp;params,</span>
<a href="#l35.14"></a><span id="l35.14">                                        nsAString &amp;_retval);</span>
<a href="#l35.15"></a><span id="l35.15">   static void GetStringBundle(void);</span>
<a href="#l35.16"></a><span id="l35.16">   static void EnsureStringBundle(void);</span>
<a href="#l35.17"></a><span id="l35.17">   static void Cleanup(void);</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19">  private:</span>
<a href="#l35.20"></a><span id="l35.20">   static nsCOMPtr&lt;nsIStringBundle&gt; mBundle;</span>
<a href="#l35.21"></a><span id="l35.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -825,18 +825,18 @@ bool nsImportGenericMail::CreateFolder(n</span>
<a href="#l36.4"></a><span id="l36.4">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l36.5"></a><span id="l36.5">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l36.6"></a><span id="l36.6">       mozilla::services::GetStringBundleService();</span>
<a href="#l36.7"></a><span id="l36.7">   if (!bundleService) return false;</span>
<a href="#l36.8"></a><span id="l36.8">   rv = bundleService-&gt;CreateBundle(IMPORT_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l36.9"></a><span id="l36.9">   if (NS_FAILED(rv)) return false;</span>
<a href="#l36.10"></a><span id="l36.10">   nsString folderName;</span>
<a href="#l36.11"></a><span id="l36.11">   if (!m_pName.IsEmpty()) {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    const char16_t *moduleName[] = {m_pName.get()};</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-    rv = bundle-&gt;FormatStringFromName(&quot;ImportModuleFolderName&quot;, moduleName, 1,</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; moduleName = {m_pName};</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;ImportModuleFolderName&quot;, moduleName,</span>
<a href="#l36.16"></a><span id="l36.16">                                       folderName);</span>
<a href="#l36.17"></a><span id="l36.17">   } else {</span>
<a href="#l36.18"></a><span id="l36.18">     rv = bundle-&gt;GetStringFromName(&quot;DefaultFolderName&quot;, folderName);</span>
<a href="#l36.19"></a><span id="l36.19">   }</span>
<a href="#l36.20"></a><span id="l36.20">   if (NS_FAILED(rv)) {</span>
<a href="#l36.21"></a><span id="l36.21">     IMPORT_LOG0(&quot;*** Failed to get Folder Name!\n&quot;);</span>
<a href="#l36.22"></a><span id="l36.22">     return false;</span>
<a href="#l36.23"></a><span id="l36.23">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -695,31 +695,31 @@ nsresult nsMsgLocalMailFolder::ConfirmFo</span>
<a href="#l37.4"></a><span id="l37.4">       rv = bundleService-&gt;CreateBundle(</span>
<a href="#l37.5"></a><span id="l37.5">           &quot;chrome://messenger/locale/localMsgs.properties&quot;,</span>
<a href="#l37.6"></a><span id="l37.6">           getter_AddRefs(bundle));</span>
<a href="#l37.7"></a><span id="l37.7">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l37.8"></a><span id="l37.8"> </span>
<a href="#l37.9"></a><span id="l37.9">       nsAutoString folderName;</span>
<a href="#l37.10"></a><span id="l37.10">       rv = aFolder-&gt;GetName(folderName);</span>
<a href="#l37.11"></a><span id="l37.11">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-      const char16_t *formatStrings[1] = {folderName.get()};</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; formatStrings = {folderName};</span>
<a href="#l37.14"></a><span id="l37.14"> </span>
<a href="#l37.15"></a><span id="l37.15">       nsAutoString deleteFolderDialogTitle;</span>
<a href="#l37.16"></a><span id="l37.16">       rv = bundle-&gt;GetStringFromName(&quot;pop3DeleteFolderDialogTitle&quot;,</span>
<a href="#l37.17"></a><span id="l37.17">                                      deleteFolderDialogTitle);</span>
<a href="#l37.18"></a><span id="l37.18">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20">       nsAutoString deleteFolderButtonLabel;</span>
<a href="#l37.21"></a><span id="l37.21">       rv = bundle-&gt;GetStringFromName(&quot;pop3DeleteFolderButtonLabel&quot;,</span>
<a href="#l37.22"></a><span id="l37.22">                                      deleteFolderButtonLabel);</span>
<a href="#l37.23"></a><span id="l37.23">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l37.24"></a><span id="l37.24"> </span>
<a href="#l37.25"></a><span id="l37.25">       nsAutoString confirmationStr;</span>
<a href="#l37.26"></a><span id="l37.26">       rv = bundle-&gt;FormatStringFromName(&quot;pop3MoveFolderToTrash&quot;, formatStrings,</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineminus">-                                        1, confirmationStr);</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+                                        confirmationStr);</span>
<a href="#l37.29"></a><span id="l37.29">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l37.30"></a><span id="l37.30"> </span>
<a href="#l37.31"></a><span id="l37.31">       nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(docShell));</span>
<a href="#l37.32"></a><span id="l37.32">       if (dialog) {</span>
<a href="#l37.33"></a><span id="l37.33">         int32_t buttonPressed = 0;</span>
<a href="#l37.34"></a><span id="l37.34">         // Default the dialog to &quot;cancel&quot;.</span>
<a href="#l37.35"></a><span id="l37.35">         const uint32_t buttonFlags =</span>
<a href="#l37.36"></a><span id="l37.36">             (nsIPrompt::BUTTON_TITLE_IS_STRING * nsIPrompt::BUTTON_POS_0) +</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineat">@@ -3026,22 +3026,22 @@ nsresult nsMsgLocalMailFolder::DisplayMo</span>
<a href="#l37.38"></a><span id="l37.38">       nsAutoString numMsgSoFarString;</span>
<a href="#l37.39"></a><span id="l37.39">       numMsgSoFarString.AppendInt((mCopyState-&gt;m_copyingMultipleMessages)</span>
<a href="#l37.40"></a><span id="l37.40">                                       ? mCopyState-&gt;m_curCopyIndex</span>
<a href="#l37.41"></a><span id="l37.41">                                       : 1);</span>
<a href="#l37.42"></a><span id="l37.42"> </span>
<a href="#l37.43"></a><span id="l37.43">       nsAutoString totalMessagesString;</span>
<a href="#l37.44"></a><span id="l37.44">       totalMessagesString.AppendInt(mCopyState-&gt;m_totalMsgCount);</span>
<a href="#l37.45"></a><span id="l37.45">       nsString finalString;</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineminus">-      const char16_t *stringArray[] = {</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineminus">-          numMsgSoFarString.get(), totalMessagesString.get(), folderName.get()};</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineplus">+      AutoTArray&lt;nsString, 3&gt; stringArray = {numMsgSoFarString,</span>
<a href="#l37.49"></a><span id="l37.49" class="difflineplus">+                                             totalMessagesString, folderName};</span>
<a href="#l37.50"></a><span id="l37.50">       rv = mCopyState-&gt;m_stringBundle-&gt;FormatStringFromName(</span>
<a href="#l37.51"></a><span id="l37.51">           (mCopyState-&gt;m_isMove) ? &quot;movingMessagesStatus&quot;</span>
<a href="#l37.52"></a><span id="l37.52">                                  : &quot;copyingMessagesStatus&quot;,</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-          stringArray, 3, finalString);</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineplus">+          stringArray, finalString);</span>
<a href="#l37.55"></a><span id="l37.55">       int64_t nowMS = PR_IntervalToMilliseconds(PR_IntervalNow());</span>
<a href="#l37.56"></a><span id="l37.56"> </span>
<a href="#l37.57"></a><span id="l37.57">       // only update status/progress every half second</span>
<a href="#l37.58"></a><span id="l37.58">       if (nowMS - mCopyState-&gt;m_lastProgressTime &lt; 500 &amp;&amp;</span>
<a href="#l37.59"></a><span id="l37.59">           mCopyState-&gt;m_curCopyIndex &lt; mCopyState-&gt;m_totalMsgCount)</span>
<a href="#l37.60"></a><span id="l37.60">         return NS_OK;</span>
<a href="#l37.61"></a><span id="l37.61"> </span>
<a href="#l37.62"></a><span id="l37.62">       mCopyState-&gt;m_lastProgressTime = nowMS;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -97,18 +97,18 @@ nsMovemailService::CheckForNewMail(nsIUr</span>
<a href="#l38.4"></a><span id="l38.4">                                    nsIMsgFolder *inbox,</span>
<a href="#l38.5"></a><span id="l38.5">                                    nsIMovemailIncomingServer *movemailServer,</span>
<a href="#l38.6"></a><span id="l38.6">                                    nsIURI **aURL) {</span>
<a href="#l38.7"></a><span id="l38.7">   nsresult rv = NS_OK;</span>
<a href="#l38.8"></a><span id="l38.8">   LOG((&quot;nsMovemailService::CheckForNewMail\n&quot;));</span>
<a href="#l38.9"></a><span id="l38.9">   return rv;</span>
<a href="#l38.10"></a><span id="l38.10"> }</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-void nsMovemailService::Error(const char *errorCode, const char16_t **params,</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-                              uint32_t length) {</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+void nsMovemailService::Error(const char *errorCode,</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+                              nsTArray&lt;nsString&gt; &amp;params, ) {</span>
<a href="#l38.16"></a><span id="l38.16">   if (!mMsgWindow) return;</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l38.19"></a><span id="l38.19">   nsresult rv = mMsgWindow-&gt;GetPromptDialog(getter_AddRefs(dialog));</span>
<a href="#l38.20"></a><span id="l38.20">   if (NS_FAILED(rv)) return;</span>
<a href="#l38.21"></a><span id="l38.21"> </span>
<a href="#l38.22"></a><span id="l38.22">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l38.23"></a><span id="l38.23">       mozilla::services::GetStringBundleService();</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineat">@@ -116,17 +116,17 @@ void nsMovemailService::Error(const char</span>
<a href="#l38.25"></a><span id="l38.25">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l38.26"></a><span id="l38.26">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l38.27"></a><span id="l38.27">       &quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l38.28"></a><span id="l38.28">   if (NS_FAILED(rv)) return;</span>
<a href="#l38.29"></a><span id="l38.29"> </span>
<a href="#l38.30"></a><span id="l38.30">   nsString errStr;</span>
<a href="#l38.31"></a><span id="l38.31">   // Format the error string if necessary</span>
<a href="#l38.32"></a><span id="l38.32">   if (params)</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-    bundle-&gt;FormatStringFromName(errorCode, params, length, errStr);</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+    bundle-&gt;FormatStringFromName(errorCode, params, errStr);</span>
<a href="#l38.35"></a><span id="l38.35">   else</span>
<a href="#l38.36"></a><span id="l38.36">     bundle-&gt;GetStringFromName(errorCode, errStr);</span>
<a href="#l38.37"></a><span id="l38.37"> </span>
<a href="#l38.38"></a><span id="l38.38">   if (!errStr.IsEmpty()) {</span>
<a href="#l38.39"></a><span id="l38.39">     dialog-&gt;Alert(nullptr, errStr.get());</span>
<a href="#l38.40"></a><span id="l38.40">   }</span>
<a href="#l38.41"></a><span id="l38.41"> }</span>
<a href="#l38.42"></a><span id="l38.42"> </span>
<a href="#l38.43"></a><span id="l38.43" class="difflineat">@@ -135,30 +135,30 @@ SpoolLock::SpoolLock(nsACString *aSpoolN</span>
<a href="#l38.44"></a><span id="l38.44">                      nsIMsgIncomingServer *aServer)</span>
<a href="#l38.45"></a><span id="l38.45">     : mLocked(false),</span>
<a href="#l38.46"></a><span id="l38.46">       mSpoolName(*aSpoolName),</span>
<a href="#l38.47"></a><span id="l38.47">       mOwningService(&amp;aMovemail),</span>
<a href="#l38.48"></a><span id="l38.48">       mServer(aServer) {</span>
<a href="#l38.49"></a><span id="l38.49">   if (!ObtainSpoolLock(aSeconds)) {</span>
<a href="#l38.50"></a><span id="l38.50">     NS_ConvertUTF8toUTF16 lockFile(mSpoolName);</span>
<a href="#l38.51"></a><span id="l38.51">     lockFile.AppendLiteral(LOCK_SUFFIX);</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-    const char16_t *params[] = {lockFile.get()};</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-    mOwningService-&gt;Error(&quot;movemailCantCreateLock&quot;, params, 1);</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; params = {lockFile};</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineplus">+    mOwningService-&gt;Error(&quot;movemailCantCreateLock&quot;, params);</span>
<a href="#l38.56"></a><span id="l38.56">     return;</span>
<a href="#l38.57"></a><span id="l38.57">   }</span>
<a href="#l38.58"></a><span id="l38.58">   mServer-&gt;SetServerBusy(true);</span>
<a href="#l38.59"></a><span id="l38.59">   mLocked = true;</span>
<a href="#l38.60"></a><span id="l38.60"> }</span>
<a href="#l38.61"></a><span id="l38.61"> </span>
<a href="#l38.62"></a><span id="l38.62"> SpoolLock::~SpoolLock() {</span>
<a href="#l38.63"></a><span id="l38.63">   if (mLocked &amp;&amp; !YieldSpoolLock()) {</span>
<a href="#l38.64"></a><span id="l38.64">     NS_ConvertUTF8toUTF16 lockFile(mSpoolName);</span>
<a href="#l38.65"></a><span id="l38.65">     lockFile.AppendLiteral(LOCK_SUFFIX);</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineminus">-    const char16_t *params[] = {lockFile.get()};</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineminus">-    mOwningService-&gt;Error(&quot;movemailCantDeleteLock&quot;, params, 1);</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; params = {lockFile};</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineplus">+    mOwningService-&gt;Error(&quot;movemailCantDeleteLock&quot;, params);</span>
<a href="#l38.70"></a><span id="l38.70">   }</span>
<a href="#l38.71"></a><span id="l38.71">   mServer-&gt;SetServerBusy(false);</span>
<a href="#l38.72"></a><span id="l38.72"> }</span>
<a href="#l38.73"></a><span id="l38.73"> </span>
<a href="#l38.74"></a><span id="l38.74"> bool SpoolLock::isLocked() { return mLocked; }</span>
<a href="#l38.75"></a><span id="l38.75"> </span>
<a href="#l38.76"></a><span id="l38.76"> bool SpoolLock::ObtainSpoolLock(</span>
<a href="#l38.77"></a><span id="l38.77">     unsigned int aSeconds /* number of seconds to retry */) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.h</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.h</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -16,16 +16,16 @@</span>
<a href="#l39.4"></a><span id="l39.4"> class nsMovemailService : public nsIMsgProtocolInfo, public nsIMovemailService {</span>
<a href="#l39.5"></a><span id="l39.5">  public:</span>
<a href="#l39.6"></a><span id="l39.6">   nsMovemailService();</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8">   NS_DECL_ISUPPORTS</span>
<a href="#l39.9"></a><span id="l39.9">   NS_DECL_NSIMOVEMAILSERVICE</span>
<a href="#l39.10"></a><span id="l39.10">   NS_DECL_NSIMSGPROTOCOLINFO</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  void Error(const char* errorCode, const char16_t** params, uint32_t length);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+  void Error(const char* errorCode, nsTArray&lt;nsString&gt;&amp; params);</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">  private:</span>
<a href="#l39.16"></a><span id="l39.16">   virtual ~nsMovemailService();</span>
<a href="#l39.17"></a><span id="l39.17">   nsCOMPtr&lt;nsIMsgWindow&gt; mMsgWindow;</span>
<a href="#l39.18"></a><span id="l39.18"> };</span>
<a href="#l39.19"></a><span id="l39.19"> </span>
<a href="#l39.20"></a><span id="l39.20"> #endif /* nsMovemailService_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -268,18 +268,18 @@ void nsMsgMailboxParser::UpdateStatusTex</span>
<a href="#l40.4"></a><span id="l40.4">         mozilla::services::GetStringBundleService();</span>
<a href="#l40.5"></a><span id="l40.5">     if (!bundleService) return;</span>
<a href="#l40.6"></a><span id="l40.6">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l40.7"></a><span id="l40.7">     rv = bundleService-&gt;CreateBundle(</span>
<a href="#l40.8"></a><span id="l40.8">         &quot;chrome://messenger/locale/localMsgs.properties&quot;,</span>
<a href="#l40.9"></a><span id="l40.9">         getter_AddRefs(bundle));</span>
<a href="#l40.10"></a><span id="l40.10">     if (NS_FAILED(rv)) return;</span>
<a href="#l40.11"></a><span id="l40.11">     nsString finalString;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-    const char16_t *stringArray[] = {m_folderName.get()};</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-    rv = bundle-&gt;FormatStringFromName(stringName, stringArray, 1, finalString);</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; stringArray = {m_folderName};</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(stringName, stringArray, finalString);</span>
<a href="#l40.16"></a><span id="l40.16">     m_statusFeedback-&gt;ShowStatusString(finalString);</span>
<a href="#l40.17"></a><span id="l40.17">   }</span>
<a href="#l40.18"></a><span id="l40.18"> }</span>
<a href="#l40.19"></a><span id="l40.19"> </span>
<a href="#l40.20"></a><span id="l40.20"> void nsMsgMailboxParser::UpdateProgressPercent() {</span>
<a href="#l40.21"></a><span id="l40.21">   if (m_statusFeedback &amp;&amp; m_graph_progress_total != 0) {</span>
<a href="#l40.22"></a><span id="l40.22">     // prevent overflow by dividing both by 100</span>
<a href="#l40.23"></a><span id="l40.23">     int64_t progressTotal = m_graph_progress_total / 100;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -556,26 +556,22 @@ bool nsPop3Protocol::TestCapFlag(uint32_</span>
<a href="#l41.4"></a><span id="l41.4"> </span>
<a href="#l41.5"></a><span id="l41.5"> uint32_t nsPop3Protocol::GetCapFlags() {</span>
<a href="#l41.6"></a><span id="l41.6">   return m_pop3ConData-&gt;capability_flags;</span>
<a href="#l41.7"></a><span id="l41.7"> }</span>
<a href="#l41.8"></a><span id="l41.8"> </span>
<a href="#l41.9"></a><span id="l41.9"> nsresult nsPop3Protocol::FormatCounterString(const nsString &amp;stringName,</span>
<a href="#l41.10"></a><span id="l41.10">                                              uint32_t count1, uint32_t count2,</span>
<a href="#l41.11"></a><span id="l41.11">                                              nsString &amp;resultString) {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  nsAutoString count1String;</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-  count1String.AppendInt(count1);</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">-</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineminus">-  nsAutoString count2String;</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineminus">-  count2String.AppendInt(count2);</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineminus">-</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineminus">-  const char16_t *formatStrings[] = {count1String.get(), count2String.get()};</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; formatStrings;</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineplus">+  formatStrings.AppendElement()-&gt;AppendInt(count1);</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineplus">+  formatStrings.AppendElement()-&gt;AppendInt(count2);</span>
<a href="#l41.22"></a><span id="l41.22"> </span>
<a href="#l41.23"></a><span id="l41.23">   return mLocalBundle-&gt;FormatStringFromName(</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineminus">-      NS_ConvertUTF16toUTF8(stringName).get(), formatStrings, 2, resultString);</span>
<a href="#l41.25"></a><span id="l41.25" class="difflineplus">+      NS_ConvertUTF16toUTF8(stringName).get(), formatStrings, resultString);</span>
<a href="#l41.26"></a><span id="l41.26"> }</span>
<a href="#l41.27"></a><span id="l41.27"> </span>
<a href="#l41.28"></a><span id="l41.28"> void nsPop3Protocol::UpdateStatus(const char *aStatusName) {</span>
<a href="#l41.29"></a><span id="l41.29">   nsString statusMessage;</span>
<a href="#l41.30"></a><span id="l41.30">   mLocalBundle-&gt;GetStringFromName(aStatusName, statusMessage);</span>
<a href="#l41.31"></a><span id="l41.31">   UpdateStatusWithString(statusMessage.get());</span>
<a href="#l41.32"></a><span id="l41.32"> }</span>
<a href="#l41.33"></a><span id="l41.33"> </span>
<a href="#l41.34"></a><span id="l41.34" class="difflineat">@@ -700,19 +696,19 @@ NS_IMETHODIMP nsPop3Protocol::OnPromptSt</span>
<a href="#l41.35"></a><span id="l41.35"> </span>
<a href="#l41.36"></a><span id="l41.36">   nsCString hostName;</span>
<a href="#l41.37"></a><span id="l41.37">   server-&gt;GetRealHostName(hostName);</span>
<a href="#l41.38"></a><span id="l41.38"> </span>
<a href="#l41.39"></a><span id="l41.39">   nsString accountName;</span>
<a href="#l41.40"></a><span id="l41.40">   server-&gt;GetPrettyName(accountName);</span>
<a href="#l41.41"></a><span id="l41.41"> </span>
<a href="#l41.42"></a><span id="l41.42">   nsString passwordPrompt;</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineminus">-  NS_ConvertUTF8toUTF16 userNameUTF16(userName);</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineminus">-  NS_ConvertUTF8toUTF16 hostNameUTF16(hostName);</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineminus">-  const char16_t *passwordParams[] = {userNameUTF16.get(), hostNameUTF16.get()};</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; passwordParams;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineplus">+  CopyUTF8toUTF16(userName, *passwordParams.AppendElement());</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineplus">+  CopyUTF8toUTF16(hostName, *passwordParams.AppendElement());</span>
<a href="#l41.49"></a><span id="l41.49"> </span>
<a href="#l41.50"></a><span id="l41.50">   // if the last prompt got us a bad password then show a special dialog</span>
<a href="#l41.51"></a><span id="l41.51">   if (TestFlag(POP3_PASSWORD_FAILED)) {</span>
<a href="#l41.52"></a><span id="l41.52">     // Biff case (no msgWindow) shouldn't cause prompts or passwords to get</span>
<a href="#l41.53"></a><span id="l41.53">     // forgotten at all</span>
<a href="#l41.54"></a><span id="l41.54">     // TODO shouldn't we skip the new password prompt below as well for biff?</span>
<a href="#l41.55"></a><span id="l41.55">     // Just exit here?</span>
<a href="#l41.56"></a><span id="l41.56">     if (msgWindow) {</span>
<a href="#l41.57"></a><span id="l41.57" class="difflineat">@@ -785,23 +781,23 @@ NS_IMETHODIMP nsPop3Protocol::OnPromptSt</span>
<a href="#l41.58"></a><span id="l41.58">           // As we're async, calling ProcessProtocolState gets things going</span>
<a href="#l41.59"></a><span id="l41.59">           // again.</span>
<a href="#l41.60"></a><span id="l41.60">           ProcessProtocolState(nullptr, nullptr, 0, 0);</span>
<a href="#l41.61"></a><span id="l41.61">           return NS_OK;</span>
<a href="#l41.62"></a><span id="l41.62">         }</span>
<a href="#l41.63"></a><span id="l41.63">       }</span>
<a href="#l41.64"></a><span id="l41.64">     }</span>
<a href="#l41.65"></a><span id="l41.65">     mLocalBundle-&gt;FormatStringFromName(</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineminus">-        &quot;pop3PreviouslyEnteredPasswordIsInvalidPrompt&quot;, passwordParams, 2,</span>
<a href="#l41.67"></a><span id="l41.67" class="difflineplus">+        &quot;pop3PreviouslyEnteredPasswordIsInvalidPrompt&quot;, passwordParams,</span>
<a href="#l41.68"></a><span id="l41.68">         passwordPrompt);</span>
<a href="#l41.69"></a><span id="l41.69">   } else</span>
<a href="#l41.70"></a><span id="l41.70">     // Otherwise this is the first time we've asked about the server's</span>
<a href="#l41.71"></a><span id="l41.71">     // password so show a first time prompt.</span>
<a href="#l41.72"></a><span id="l41.72">     mLocalBundle-&gt;FormatStringFromName(&quot;pop3EnterPasswordPrompt&quot;,</span>
<a href="#l41.73"></a><span id="l41.73" class="difflineminus">-                                       passwordParams, 2, passwordPrompt);</span>
<a href="#l41.74"></a><span id="l41.74" class="difflineplus">+                                       passwordParams, passwordPrompt);</span>
<a href="#l41.75"></a><span id="l41.75"> </span>
<a href="#l41.76"></a><span id="l41.76">   nsString passwordTitle;</span>
<a href="#l41.77"></a><span id="l41.77">   mLocalBundle-&gt;GetStringFromName(&quot;pop3EnterPasswordPromptTitle&quot;,</span>
<a href="#l41.78"></a><span id="l41.78">                                   passwordTitle);</span>
<a href="#l41.79"></a><span id="l41.79"> </span>
<a href="#l41.80"></a><span id="l41.80">   // Now go and get the password.</span>
<a href="#l41.81"></a><span id="l41.81">   if (!passwordPrompt.IsEmpty() &amp;&amp; !passwordTitle.IsEmpty())</span>
<a href="#l41.82"></a><span id="l41.82">     rv = server-&gt;GetPasswordWithUI(passwordPrompt, passwordTitle, msgWindow,</span>
<a href="#l41.83"></a><span id="l41.83" class="difflineat">@@ -1173,44 +1169,43 @@ int32_t nsPop3Protocol::WaitForResponse(</span>
<a href="#l41.84"></a><span id="l41.84"> </span>
<a href="#l41.85"></a><span id="l41.85">   m_pop3ConData-&gt;next_state = m_pop3ConData-&gt;next_state_after_response;</span>
<a href="#l41.86"></a><span id="l41.86">   m_pop3ConData-&gt;pause_for_read = false; /* don't pause */</span>
<a href="#l41.87"></a><span id="l41.87"> </span>
<a href="#l41.88"></a><span id="l41.88">   PR_Free(line);</span>
<a href="#l41.89"></a><span id="l41.89">   return (1); /* everything ok */</span>
<a href="#l41.90"></a><span id="l41.90"> }</span>
<a href="#l41.91"></a><span id="l41.91"> </span>
<a href="#l41.92"></a><span id="l41.92" class="difflineminus">-int32_t nsPop3Protocol::Error(const char *err_code, const char16_t **params,</span>
<a href="#l41.93"></a><span id="l41.93" class="difflineminus">-                              uint32_t length) {</span>
<a href="#l41.94"></a><span id="l41.94" class="difflineplus">+int32_t nsPop3Protocol::Error(const char *err_code, const char16_t *param) {</span>
<a href="#l41.95"></a><span id="l41.95">   MOZ_LOG(POP3LOGMODULE, LogLevel::Info, (POP3LOG(&quot;ERROR: %s&quot;), err_code));</span>
<a href="#l41.96"></a><span id="l41.96">   nsresult rv = NS_OK;</span>
<a href="#l41.97"></a><span id="l41.97"> </span>
<a href="#l41.98"></a><span id="l41.98">   // the error code is just the resource name for the error string...</span>
<a href="#l41.99"></a><span id="l41.99">   // so print out that error message!</span>
<a href="#l41.100"></a><span id="l41.100">   nsAutoString message;</span>
<a href="#l41.101"></a><span id="l41.101">   // Format the alert string if parameter list isn't empty</span>
<a href="#l41.102"></a><span id="l41.102" class="difflineminus">-  if (params) {</span>
<a href="#l41.103"></a><span id="l41.103" class="difflineminus">-    mLocalBundle-&gt;FormatStringFromName(err_code, params, length, message);</span>
<a href="#l41.104"></a><span id="l41.104" class="difflineplus">+  if (param) {</span>
<a href="#l41.105"></a><span id="l41.105" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; params = {nsDependentString(param)};</span>
<a href="#l41.106"></a><span id="l41.106" class="difflineplus">+    mLocalBundle-&gt;FormatStringFromName(err_code, params, message);</span>
<a href="#l41.107"></a><span id="l41.107">   } else {</span>
<a href="#l41.108"></a><span id="l41.108">     mLocalBundle-&gt;GetStringFromName(err_code, message);</span>
<a href="#l41.109"></a><span id="l41.109">   }</span>
<a href="#l41.110"></a><span id="l41.110">   if (!m_pop3ConData-&gt;command_succeeded) {</span>
<a href="#l41.111"></a><span id="l41.111">     // Server error message</span>
<a href="#l41.112"></a><span id="l41.112">     nsString serverSaidPrefix;</span>
<a href="#l41.113"></a><span id="l41.113">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l41.114"></a><span id="l41.114">     nsCString hostName;</span>
<a href="#l41.115"></a><span id="l41.115">     // Format string with hostname.</span>
<a href="#l41.116"></a><span id="l41.116">     if (server) {</span>
<a href="#l41.117"></a><span id="l41.117">       rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l41.118"></a><span id="l41.118">     }</span>
<a href="#l41.119"></a><span id="l41.119">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l41.120"></a><span id="l41.120" class="difflineminus">-      nsAutoString hostStr;</span>
<a href="#l41.121"></a><span id="l41.121" class="difflineminus">-      CopyASCIItoUTF16(hostName, hostStr);</span>
<a href="#l41.122"></a><span id="l41.122" class="difflineminus">-      const char16_t *params[] = {hostStr.get()};</span>
<a href="#l41.123"></a><span id="l41.123" class="difflineminus">-      mLocalBundle-&gt;FormatStringFromName(&quot;pop3ServerSaid&quot;, params, 1,</span>
<a href="#l41.124"></a><span id="l41.124" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; params;</span>
<a href="#l41.125"></a><span id="l41.125" class="difflineplus">+      CopyASCIItoUTF16(hostName, *params.AppendElement());</span>
<a href="#l41.126"></a><span id="l41.126" class="difflineplus">+      mLocalBundle-&gt;FormatStringFromName(&quot;pop3ServerSaid&quot;, params,</span>
<a href="#l41.127"></a><span id="l41.127">                                          serverSaidPrefix);</span>
<a href="#l41.128"></a><span id="l41.128">     }</span>
<a href="#l41.129"></a><span id="l41.129"> </span>
<a href="#l41.130"></a><span id="l41.130">     message.Append(' ');</span>
<a href="#l41.131"></a><span id="l41.131">     message.Append(serverSaidPrefix);</span>
<a href="#l41.132"></a><span id="l41.132">     message.Append(' ');</span>
<a href="#l41.133"></a><span id="l41.133">     message.Append(NS_ConvertASCIItoUTF16(m_commandResponse));</span>
<a href="#l41.134"></a><span id="l41.134">   }</span>
<a href="#l41.135"></a><span id="l41.135" class="difflineat">@@ -1218,19 +1213,19 @@ int32_t nsPop3Protocol::Error(const char</span>
<a href="#l41.136"></a><span id="l41.136">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_url, &amp;rv);</span>
<a href="#l41.137"></a><span id="l41.137">   mailnewsUrl-&gt;SetErrorCode(nsDependentCString(err_code));</span>
<a href="#l41.138"></a><span id="l41.138">   mailnewsUrl-&gt;SetErrorMessage(message);</span>
<a href="#l41.139"></a><span id="l41.139"> </span>
<a href="#l41.140"></a><span id="l41.140">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l41.141"></a><span id="l41.141">   nsString accountName;</span>
<a href="#l41.142"></a><span id="l41.142">   rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l41.143"></a><span id="l41.143">   NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l41.144"></a><span id="l41.144" class="difflineminus">-  const char16_t *titleParams[] = {accountName.get()};</span>
<a href="#l41.145"></a><span id="l41.145" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; titleParams = {accountName};</span>
<a href="#l41.146"></a><span id="l41.146">   nsString dialogTitle;</span>
<a href="#l41.147"></a><span id="l41.147" class="difflineminus">-  mLocalBundle-&gt;FormatStringFromName(&quot;pop3ErrorDialogTitle&quot;, titleParams, 1,</span>
<a href="#l41.148"></a><span id="l41.148" class="difflineplus">+  mLocalBundle-&gt;FormatStringFromName(&quot;pop3ErrorDialogTitle&quot;, titleParams,</span>
<a href="#l41.149"></a><span id="l41.149">                                      dialogTitle);</span>
<a href="#l41.150"></a><span id="l41.150">   // we handle &quot;pop3TmpDownloadError&quot; earlier...</span>
<a href="#l41.151"></a><span id="l41.151">   if (strcmp(err_code, &quot;pop3TmpDownloadError&quot;) &amp;&amp; NS_SUCCEEDED(rv)) {</span>
<a href="#l41.152"></a><span id="l41.152">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l41.153"></a><span id="l41.153">     nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l41.154"></a><span id="l41.154">     rv = mailnewsUrl-&gt;GetMsgWindow(</span>
<a href="#l41.155"></a><span id="l41.155">         getter_AddRefs(msgWindow));  // it is ok to have null msgWindow, for</span>
<a href="#l41.156"></a><span id="l41.156">                                      // example when biffing</span>
<a href="#l41.157"></a><span id="l41.157" class="difflineat">@@ -1728,30 +1723,29 @@ int32_t nsPop3Protocol::NextAuthStep() {</span>
<a href="#l41.158"></a><span id="l41.158">     // response code received shows that login failed not because of</span>
<a href="#l41.159"></a><span id="l41.159">     // wrong credential -&gt; stop login without retry or pw dialog, only alert</span>
<a href="#l41.160"></a><span id="l41.160">     // parameter list -&gt; user</span>
<a href="#l41.161"></a><span id="l41.161">     nsCString userName;</span>
<a href="#l41.162"></a><span id="l41.162">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l41.163"></a><span id="l41.163">     nsresult rv = server-&gt;GetRealUsername(userName);</span>
<a href="#l41.164"></a><span id="l41.164">     NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l41.165"></a><span id="l41.165">     NS_ConvertUTF8toUTF16 userNameUTF16(userName);</span>
<a href="#l41.166"></a><span id="l41.166" class="difflineminus">-    const char16_t *params[] = {userNameUTF16.get()};</span>
<a href="#l41.167"></a><span id="l41.167">     if (TestFlag(POP3_STOPLOGIN)) {</span>
<a href="#l41.168"></a><span id="l41.168">       if (m_password_already_sent)</span>
<a href="#l41.169"></a><span id="l41.169" class="difflineminus">-        return Error(&quot;pop3PasswordFailed&quot;, params, 1);</span>
<a href="#l41.170"></a><span id="l41.170" class="difflineplus">+        return Error(&quot;pop3PasswordFailed&quot;, userNameUTF16.get());</span>
<a href="#l41.171"></a><span id="l41.171"> </span>
<a href="#l41.172"></a><span id="l41.172">       return Error(&quot;pop3UsernameFailure&quot;);</span>
<a href="#l41.173"></a><span id="l41.173">     }</span>
<a href="#l41.174"></a><span id="l41.174">     // response code received shows that server is certain about the</span>
<a href="#l41.175"></a><span id="l41.175">     // credential was wrong -&gt; no fallback, show alert and pw dialog</span>
<a href="#l41.176"></a><span id="l41.176">     if (TestFlag(POP3_AUTH_FAILURE)) {</span>
<a href="#l41.177"></a><span id="l41.177">       MOZ_LOG(POP3LOGMODULE, LogLevel::Debug,</span>
<a href="#l41.178"></a><span id="l41.178">               (POP3LOG(&quot;auth failure, setting password failed&quot;)));</span>
<a href="#l41.179"></a><span id="l41.179">       if (m_password_already_sent)</span>
<a href="#l41.180"></a><span id="l41.180" class="difflineminus">-        Error(&quot;pop3PasswordFailed&quot;, params, 1);</span>
<a href="#l41.181"></a><span id="l41.181" class="difflineplus">+        Error(&quot;pop3PasswordFailed&quot;, userNameUTF16.get());</span>
<a href="#l41.182"></a><span id="l41.182">       else</span>
<a href="#l41.183"></a><span id="l41.183">         Error(&quot;pop3UsernameFailure&quot;);</span>
<a href="#l41.184"></a><span id="l41.184">       SetFlag(POP3_PASSWORD_FAILED);</span>
<a href="#l41.185"></a><span id="l41.185">       ClearFlag(POP3_AUTH_FAILURE);</span>
<a href="#l41.186"></a><span id="l41.186">       return 0;</span>
<a href="#l41.187"></a><span id="l41.187">     }</span>
<a href="#l41.188"></a><span id="l41.188"> </span>
<a href="#l41.189"></a><span id="l41.189">     // We have no certain response code -&gt; fallback and try again.</span>
<a href="#l41.190"></a><span id="l41.190" class="difflineat">@@ -1777,17 +1771,17 @@ int32_t nsPop3Protocol::NextAuthStep() {</span>
<a href="#l41.191"></a><span id="l41.191">          which, upon success, will re-open the connection.  Set a flag</span>
<a href="#l41.192"></a><span id="l41.192">          which causes the prompt to be different that time (to indicate</span>
<a href="#l41.193"></a><span id="l41.193">          that the old password was bogus.)</span>
<a href="#l41.194"></a><span id="l41.194"> </span>
<a href="#l41.195"></a><span id="l41.195">          But if we're just checking for new mail (biff) then don't bother</span>
<a href="#l41.196"></a><span id="l41.196">          prompting the user for a password: just fail silently.</span>
<a href="#l41.197"></a><span id="l41.197">       */</span>
<a href="#l41.198"></a><span id="l41.198">       SetFlag(POP3_PASSWORD_FAILED);</span>
<a href="#l41.199"></a><span id="l41.199" class="difflineminus">-      Error(&quot;pop3PasswordFailed&quot;, params, 1);</span>
<a href="#l41.200"></a><span id="l41.200" class="difflineplus">+      Error(&quot;pop3PasswordFailed&quot;, userNameUTF16.get());</span>
<a href="#l41.201"></a><span id="l41.201">       return 0;</span>
<a href="#l41.202"></a><span id="l41.202">     }</span>
<a href="#l41.203"></a><span id="l41.203">     MOZ_LOG(POP3LOGMODULE, LogLevel::Debug,</span>
<a href="#l41.204"></a><span id="l41.204">             (POP3LOG(&quot;still have some auth methods to try&quot;)));</span>
<a href="#l41.205"></a><span id="l41.205"> </span>
<a href="#l41.206"></a><span id="l41.206">     // TODO needed?</span>
<a href="#l41.207"></a><span id="l41.207">     // m_pop3Server-&gt;SetPop3CapabilityFlags(m_pop3ConData-&gt;capability_flags);</span>
<a href="#l41.208"></a><span id="l41.208"> </span>
<a href="#l41.209"></a><span id="l41.209" class="difflineat">@@ -2204,18 +2198,17 @@ int32_t nsPop3Protocol::GetStat() {</span>
<a href="#l41.210"></a><span id="l41.210">     if (NS_FAILED(rv)) {</span>
<a href="#l41.211"></a><span id="l41.211">       m_nsIPop3Sink-&gt;AbortMailDelivery(this);</span>
<a href="#l41.212"></a><span id="l41.212">       if (rv == NS_MSG_FOLDER_BUSY) {</span>
<a href="#l41.213"></a><span id="l41.213">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l41.214"></a><span id="l41.214">         nsString accountName;</span>
<a href="#l41.215"></a><span id="l41.215">         rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l41.216"></a><span id="l41.216">         NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l41.217"></a><span id="l41.217"> </span>
<a href="#l41.218"></a><span id="l41.218" class="difflineminus">-        const char16_t *params[] = {accountName.get()};</span>
<a href="#l41.219"></a><span id="l41.219" class="difflineminus">-        return Error(&quot;pop3ServerBusy&quot;, params, 1);</span>
<a href="#l41.220"></a><span id="l41.220" class="difflineplus">+        return Error(&quot;pop3ServerBusy&quot;, accountName.get());</span>
<a href="#l41.221"></a><span id="l41.221">       }</span>
<a href="#l41.222"></a><span id="l41.222"> </span>
<a href="#l41.223"></a><span id="l41.223">       return Error(&quot;pop3MessageWriteError&quot;);</span>
<a href="#l41.224"></a><span id="l41.224">     }</span>
<a href="#l41.225"></a><span id="l41.225"> </span>
<a href="#l41.226"></a><span id="l41.226">     if (!m_pop3ConData-&gt;msg_del_started) return Error(&quot;pop3MessageWriteError&quot;);</span>
<a href="#l41.227"></a><span id="l41.227">   }</span>
<a href="#l41.228"></a><span id="l41.228"> </span>
<a href="#l41.229"></a><span id="l41.229" class="difflineat">@@ -2353,18 +2346,17 @@ int32_t nsPop3Protocol::HandleNoUidListA</span>
<a href="#l41.230"></a><span id="l41.230">     return 0;</span>
<a href="#l41.231"></a><span id="l41.231">   }</span>
<a href="#l41.232"></a><span id="l41.232">   m_pop3ConData-&gt;next_state = POP3_SEND_QUIT;</span>
<a href="#l41.233"></a><span id="l41.233">   nsCString hostName;</span>
<a href="#l41.234"></a><span id="l41.234">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l41.235"></a><span id="l41.235">   nsresult rv = server-&gt;GetRealHostName(hostName);</span>
<a href="#l41.236"></a><span id="l41.236">   NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l41.237"></a><span id="l41.237">   NS_ConvertASCIItoUTF16 hostNameUnicode(hostName);</span>
<a href="#l41.238"></a><span id="l41.238" class="difflineminus">-  const char16_t *params[] = {hostNameUnicode.get()};</span>
<a href="#l41.239"></a><span id="l41.239" class="difflineminus">-  return Error(&quot;pop3ServerDoesNotSupportUidlEtc&quot;, params, 1);</span>
<a href="#l41.240"></a><span id="l41.240" class="difflineplus">+  return Error(&quot;pop3ServerDoesNotSupportUidlEtc&quot;, hostNameUnicode.get());</span>
<a href="#l41.241"></a><span id="l41.241"> }</span>
<a href="#l41.242"></a><span id="l41.242"> </span>
<a href="#l41.243"></a><span id="l41.243"> /* km</span>
<a href="#l41.244"></a><span id="l41.244">  *</span>
<a href="#l41.245"></a><span id="l41.245">  *  net_pop3_send_xtnd_xlst_msgid</span>
<a href="#l41.246"></a><span id="l41.246">  *</span>
<a href="#l41.247"></a><span id="l41.247">  *  Process state: POP3_SEND_XTND_XLST_MSGID</span>
<a href="#l41.248"></a><span id="l41.248">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -344,18 +344,17 @@ class nsPop3Protocol : public nsMsgProto</span>
<a href="#l42.4"></a><span id="l42.4">   nsresult GetApopTimestamp();</span>
<a href="#l42.5"></a><span id="l42.5"> </span>
<a href="#l42.6"></a><span id="l42.6">   //////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l42.7"></a><span id="l42.7">   // Begin Pop3 protocol state handlers</span>
<a href="#l42.8"></a><span id="l42.8">   //////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l42.9"></a><span id="l42.9">   int32_t WaitForStartOfConnectionResponse(nsIInputStream* inputStream,</span>
<a href="#l42.10"></a><span id="l42.10">                                            uint32_t length);</span>
<a href="#l42.11"></a><span id="l42.11">   int32_t WaitForResponse(nsIInputStream* inputStream, uint32_t length);</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  int32_t Error(const char* err_code, const char16_t** params = nullptr,</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-                uint32_t length = 0);</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+  int32_t Error(const char* err_code, const char16_t* param = nullptr);</span>
<a href="#l42.15"></a><span id="l42.15">   int32_t SendAuth();</span>
<a href="#l42.16"></a><span id="l42.16">   int32_t AuthResponse(nsIInputStream* inputStream, uint32_t length);</span>
<a href="#l42.17"></a><span id="l42.17">   int32_t SendCapa();</span>
<a href="#l42.18"></a><span id="l42.18">   int32_t CapaResponse(nsIInputStream* inputStream, uint32_t length);</span>
<a href="#l42.19"></a><span id="l42.19">   int32_t SendTLSResponse();</span>
<a href="#l42.20"></a><span id="l42.20">   int32_t ProcessAuth();</span>
<a href="#l42.21"></a><span id="l42.21">   int32_t NextAuthStep();</span>
<a href="#l42.22"></a><span id="l42.22">   int32_t AuthLogin();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -404,21 +404,21 @@ void nsPop3Service::AlertServerBusy(nsIM</span>
<a href="#l43.4"></a><span id="l43.4"> </span>
<a href="#l43.5"></a><span id="l43.5">   nsString accountName;</span>
<a href="#l43.6"></a><span id="l43.6">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l43.7"></a><span id="l43.7">   rv = url-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l43.8"></a><span id="l43.8">   NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l43.9"></a><span id="l43.9">   rv = server-&gt;GetPrettyName(accountName);</span>
<a href="#l43.10"></a><span id="l43.10">   NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l43.11"></a><span id="l43.11"> </span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  const char16_t *params[] = {accountName.get()};</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; params = {accountName};</span>
<a href="#l43.14"></a><span id="l43.14">   nsString alertString;</span>
<a href="#l43.15"></a><span id="l43.15">   nsString dialogTitle;</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-  bundle-&gt;FormatStringFromName(&quot;pop3ServerBusy&quot;, params, 1, alertString);</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-  bundle-&gt;FormatStringFromName(&quot;pop3ErrorDialogTitle&quot;, params, 1, dialogTitle);</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+  bundle-&gt;FormatStringFromName(&quot;pop3ServerBusy&quot;, params, alertString);</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+  bundle-&gt;FormatStringFromName(&quot;pop3ErrorDialogTitle&quot;, params, dialogTitle);</span>
<a href="#l43.20"></a><span id="l43.20">   if (!alertString.IsEmpty())</span>
<a href="#l43.21"></a><span id="l43.21">     dialog-&gt;Alert(dialogTitle.get(), alertString.get());</span>
<a href="#l43.22"></a><span id="l43.22"> }</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24"> NS_IMETHODIMP nsPop3Service::NewChannel(nsIURI *aURI, nsILoadInfo *aLoadInfo,</span>
<a href="#l43.25"></a><span id="l43.25">                                         nsIChannel **_retval) {</span>
<a href="#l43.26"></a><span id="l43.26">   NS_ENSURE_ARG_POINTER(aURI);</span>
<a href="#l43.27"></a><span id="l43.27">   nsresult rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -689,19 +689,18 @@ nsresult nsPop3Sink::HandleTempDownloadF</span>
<a href="#l44.4"></a><span id="l44.4">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l44.5"></a><span id="l44.5">   rv = bundleService-&gt;CreateBundle(</span>
<a href="#l44.6"></a><span id="l44.6">       &quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l44.7"></a><span id="l44.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l44.8"></a><span id="l44.8">   nsString fromStr, subjectStr, confirmString;</span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedSubject(subjectStr);</span>
<a href="#l44.11"></a><span id="l44.11">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedAuthor(fromStr);</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  const char16_t *params[] = {fromStr.get(), subjectStr.get()};</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-  bundle-&gt;FormatStringFromName(&quot;pop3TmpDownloadError&quot;, params, 2,</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">-                               confirmString);</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; params = {fromStr, subjectStr};</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineplus">+  bundle-&gt;FormatStringFromName(&quot;pop3TmpDownloadError&quot;, params, confirmString);</span>
<a href="#l44.17"></a><span id="l44.17">   nsCOMPtr&lt;mozIDOMWindowProxy&gt; parentWindow;</span>
<a href="#l44.18"></a><span id="l44.18">   nsCOMPtr&lt;nsIPromptService&gt; promptService =</span>
<a href="#l44.19"></a><span id="l44.19">       do_GetService(NS_PROMPTSERVICE_CONTRACTID);</span>
<a href="#l44.20"></a><span id="l44.20">   nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l44.21"></a><span id="l44.21">   if (msgWindow) {</span>
<a href="#l44.22"></a><span id="l44.22">     (void)msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l44.23"></a><span id="l44.23">     parentWindow = do_QueryInterface(docShell);</span>
<a href="#l44.24"></a><span id="l44.24">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -157,36 +157,35 @@ bool nsMapiHook::DisplayLoginDialog(bool</span>
<a href="#l45.4"></a><span id="l45.4">                                     getter_AddRefs(brandBundle));</span>
<a href="#l45.5"></a><span id="l45.5">     if (NS_FAILED(rv)) return false;</span>
<a href="#l45.6"></a><span id="l45.6"> </span>
<a href="#l45.7"></a><span id="l45.7">     nsString brandName;</span>
<a href="#l45.8"></a><span id="l45.8">     rv = brandBundle-&gt;GetStringFromName(&quot;brandFullName&quot;, brandName);</span>
<a href="#l45.9"></a><span id="l45.9">     if (NS_FAILED(rv)) return false;</span>
<a href="#l45.10"></a><span id="l45.10"> </span>
<a href="#l45.11"></a><span id="l45.11">     nsString loginTitle;</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-    const char16_t *brandStrings[] = {brandName.get()};</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">-    rv =</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">-        bundle-&gt;FormatStringFromName(&quot;loginTitle&quot;, brandStrings, 1, loginTitle);</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineplus">+    AutoTArray&lt;nsString, 1&gt; brandStrings = {brandName};</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;loginTitle&quot;, brandStrings, loginTitle);</span>
<a href="#l45.17"></a><span id="l45.17">     if (NS_FAILED(rv)) return false;</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19">     if (aLogin) {</span>
<a href="#l45.20"></a><span id="l45.20">       nsString loginText;</span>
<a href="#l45.21"></a><span id="l45.21">       rv = bundle-&gt;GetStringFromName(&quot;loginTextwithName&quot;, loginText);</span>
<a href="#l45.22"></a><span id="l45.22">       if (NS_FAILED(rv) || loginText.IsEmpty()) return false;</span>
<a href="#l45.23"></a><span id="l45.23"> </span>
<a href="#l45.24"></a><span id="l45.24">       bool dummyValue = false;</span>
<a href="#l45.25"></a><span id="l45.25">       rv = dlgService-&gt;PromptUsernameAndPassword(</span>
<a href="#l45.26"></a><span id="l45.26">           nullptr, loginTitle.get(), loginText.get(), aUsername, aPassword,</span>
<a href="#l45.27"></a><span id="l45.27">           nullptr, &amp;dummyValue, &amp;btnResult);</span>
<a href="#l45.28"></a><span id="l45.28">     } else {</span>
<a href="#l45.29"></a><span id="l45.29">       // nsString loginString;</span>
<a href="#l45.30"></a><span id="l45.30">       nsString loginText;</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-      const char16_t *userNameStrings[] = {*aUsername};</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;loginText&quot;, userNameStrings, 1,</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">-                                        loginText);</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; userNameStrings = {nsDependentString(*aUsername)};</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineplus">+      rv =</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineplus">+          bundle-&gt;FormatStringFromName(&quot;loginText&quot;, userNameStrings, loginText);</span>
<a href="#l45.37"></a><span id="l45.37">       if (NS_FAILED(rv)) return false;</span>
<a href="#l45.38"></a><span id="l45.38"> </span>
<a href="#l45.39"></a><span id="l45.39">       bool dummyValue = false;</span>
<a href="#l45.40"></a><span id="l45.40">       rv = dlgService-&gt;PromptPassword(nullptr, loginTitle.get(),</span>
<a href="#l45.41"></a><span id="l45.41">                                       loginText.get(), aPassword, nullptr,</span>
<a href="#l45.42"></a><span id="l45.42">                                       &amp;dummyValue, &amp;btnResult);</span>
<a href="#l45.43"></a><span id="l45.43">     }</span>
<a href="#l45.44"></a><span id="l45.44">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -90,22 +90,22 @@ static void PgpMimeGetNeedsAddonString(n</span>
<a href="#l46.4"></a><span id="l46.4">   if (NS_FAILED(rv)) return;</span>
<a href="#l46.5"></a><span id="l46.5"> </span>
<a href="#l46.6"></a><span id="l46.6">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l46.7"></a><span id="l46.7">   if (NS_FAILED(rv)) return;</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9">   nsCString url;</span>
<a href="#l46.10"></a><span id="l46.10">   if (NS_FAILED(prefs-&gt;GetCharPref(&quot;mail.pgpmime.addon_url&quot;, url))) return;</span>
<a href="#l46.11"></a><span id="l46.11"> </span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  NS_ConvertUTF8toUTF16 url16(url);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">-  const char16_t *formatStrings[] = {url16.get()};</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; formatStrings;</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineplus">+  CopyUTF8toUTF16(url, *formatStrings.AppendElement());</span>
<a href="#l46.16"></a><span id="l46.16"> </span>
<a href="#l46.17"></a><span id="l46.17">   nsString result;</span>
<a href="#l46.18"></a><span id="l46.18">   rv = stringBundle-&gt;FormatStringFromName(PGPMIME_STR_NOT_SUPPORTED_ID,</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineminus">-                                          formatStrings, 1, result);</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineplus">+                                          formatStrings, result);</span>
<a href="#l46.21"></a><span id="l46.21">   if (NS_FAILED(rv)) return;</span>
<a href="#l46.22"></a><span id="l46.22">   aResult = NS_ConvertUTF16toUTF8(result);</span>
<a href="#l46.23"></a><span id="l46.23"> }</span>
<a href="#l46.24"></a><span id="l46.24"> </span>
<a href="#l46.25"></a><span id="l46.25"> static int MimeEncryptedPgpClassInitialize(MimeEncryptedPgpClass *clazz) {</span>
<a href="#l46.26"></a><span id="l46.26">   mozilla::DebugOnly&lt;MimeObjectClass *&gt; oclass = (MimeObjectClass *)clazz;</span>
<a href="#l46.27"></a><span id="l46.27">   NS_ASSERTION(!oclass-&gt;class_initialized, &quot;oclass is not initialized&quot;);</span>
<a href="#l46.28"></a><span id="l46.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -280,17 +280,17 @@ nsresult nsNNTPNewsgroupList::GetRangeOf</span>
<a href="#l47.4"></a><span id="l47.4"> </span>
<a href="#l47.5"></a><span id="l47.5">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l47.6"></a><span id="l47.6">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l47.7"></a><span id="l47.7">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.8"></a><span id="l47.8"> </span>
<a href="#l47.9"></a><span id="l47.9">     rv = bundle-&gt;GetStringFromName(&quot;noNewMessages&quot;, statusString);</span>
<a href="#l47.10"></a><span id="l47.10">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    SetProgressStatus(statusString.get());</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+    SetProgressStatus(statusString);</span>
<a href="#l47.14"></a><span id="l47.14">   }</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16">   if (maxextra &lt;= 0 || last_possible &lt; first_possible || last_possible &lt; 1) {</span>
<a href="#l47.17"></a><span id="l47.17">     *status = 0;</span>
<a href="#l47.18"></a><span id="l47.18">     return NS_OK;</span>
<a href="#l47.19"></a><span id="l47.19">   }</span>
<a href="#l47.20"></a><span id="l47.20"> </span>
<a href="#l47.21"></a><span id="l47.21">   m_knownArts.first_possible = first_possible;</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -799,22 +799,22 @@ nsresult nsNNTPNewsgroupList::FinishXOVE</span>
<a href="#l47.23"></a><span id="l47.23">       nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l47.24"></a><span id="l47.24">           mozilla::services::GetStringBundleService();</span>
<a href="#l47.25"></a><span id="l47.25">       NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l47.26"></a><span id="l47.26"> </span>
<a href="#l47.27"></a><span id="l47.27">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l47.28"></a><span id="l47.28">       rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l47.29"></a><span id="l47.29">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.30"></a><span id="l47.30"> </span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-      const char16_t *formatStrings[2] = {firstStr.get(), lastStr.get()};</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;downloadingArticles&quot;, formatStrings, 2,</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineplus">+      AutoTArray&lt;nsString, 2&gt; formatStrings = {firstStr, lastStr};</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineplus">+      rv = bundle-&gt;FormatStringFromName(&quot;downloadingArticles&quot;, formatStrings,</span>
<a href="#l47.35"></a><span id="l47.35">                                         statusString);</span>
<a href="#l47.36"></a><span id="l47.36">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.37"></a><span id="l47.37"> </span>
<a href="#l47.38"></a><span id="l47.38" class="difflineminus">-      SetProgressStatus(statusString.get());</span>
<a href="#l47.39"></a><span id="l47.39" class="difflineplus">+      SetProgressStatus(statusString);</span>
<a href="#l47.40"></a><span id="l47.40">     }</span>
<a href="#l47.41"></a><span id="l47.41">   }</span>
<a href="#l47.42"></a><span id="l47.42"> </span>
<a href="#l47.43"></a><span id="l47.43">   if (newstatus) *newstatus = 0;</span>
<a href="#l47.44"></a><span id="l47.44"> </span>
<a href="#l47.45"></a><span id="l47.45">   return NS_OK;</span>
<a href="#l47.46"></a><span id="l47.46"> }</span>
<a href="#l47.47"></a><span id="l47.47"> </span>
<a href="#l47.48"></a><span id="l47.48" class="difflineat">@@ -1098,17 +1098,17 @@ void nsNNTPNewsgroupList::SetProgressBar</span>
<a href="#l47.49"></a><span id="l47.49">     mailnewsUrl-&gt;GetStatusFeedback(getter_AddRefs(feedback));</span>
<a href="#l47.50"></a><span id="l47.50"> </span>
<a href="#l47.51"></a><span id="l47.51">     if (feedback) {</span>
<a href="#l47.52"></a><span id="l47.52">       feedback-&gt;ShowProgress(percent);</span>
<a href="#l47.53"></a><span id="l47.53">     }</span>
<a href="#l47.54"></a><span id="l47.54">   }</span>
<a href="#l47.55"></a><span id="l47.55"> }</span>
<a href="#l47.56"></a><span id="l47.56"> </span>
<a href="#l47.57"></a><span id="l47.57" class="difflineminus">-void nsNNTPNewsgroupList::SetProgressStatus(const char16_t *aMessage) {</span>
<a href="#l47.58"></a><span id="l47.58" class="difflineplus">+void nsNNTPNewsgroupList::SetProgressStatus(const nsString &amp;aMessage) {</span>
<a href="#l47.59"></a><span id="l47.59">   if (!m_runningURL) return;</span>
<a href="#l47.60"></a><span id="l47.60"> </span>
<a href="#l47.61"></a><span id="l47.61">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_runningURL);</span>
<a href="#l47.62"></a><span id="l47.62">   if (mailnewsUrl) {</span>
<a href="#l47.63"></a><span id="l47.63">     nsCOMPtr&lt;nsIMsgStatusFeedback&gt; feedback;</span>
<a href="#l47.64"></a><span id="l47.64">     mailnewsUrl-&gt;GetStatusFeedback(getter_AddRefs(feedback));</span>
<a href="#l47.65"></a><span id="l47.65"> </span>
<a href="#l47.66"></a><span id="l47.66">     if (feedback) {</span>
<a href="#l47.67"></a><span id="l47.67" class="difflineat">@@ -1120,18 +1120,18 @@ void nsNNTPNewsgroupList::SetProgressSta</span>
<a href="#l47.68"></a><span id="l47.68">       nsString accountName;</span>
<a href="#l47.69"></a><span id="l47.69">       server-&gt;GetPrettyName(accountName);</span>
<a href="#l47.70"></a><span id="l47.70">       nsString statusMessage;</span>
<a href="#l47.71"></a><span id="l47.71">       nsCOMPtr&lt;nsIStringBundleService&gt; sbs =</span>
<a href="#l47.72"></a><span id="l47.72">           mozilla::services::GetStringBundleService();</span>
<a href="#l47.73"></a><span id="l47.73">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l47.74"></a><span id="l47.74">       rv = sbs-&gt;CreateBundle(MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l47.75"></a><span id="l47.75">       NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l47.76"></a><span id="l47.76" class="difflineminus">-      const char16_t *params[] = {accountName.get(), aMessage};</span>
<a href="#l47.77"></a><span id="l47.77" class="difflineminus">-      bundle-&gt;FormatStringFromName(&quot;statusMessage&quot;, params, 2, statusMessage);</span>
<a href="#l47.78"></a><span id="l47.78" class="difflineplus">+      AutoTArray&lt;nsString, 2&gt; params = {accountName, aMessage};</span>
<a href="#l47.79"></a><span id="l47.79" class="difflineplus">+      bundle-&gt;FormatStringFromName(&quot;statusMessage&quot;, params, statusMessage);</span>
<a href="#l47.80"></a><span id="l47.80"> </span>
<a href="#l47.81"></a><span id="l47.81">       feedback-&gt;ShowStatusString(statusMessage);</span>
<a href="#l47.82"></a><span id="l47.82">     }</span>
<a href="#l47.83"></a><span id="l47.83">   }</span>
<a href="#l47.84"></a><span id="l47.84"> }</span>
<a href="#l47.85"></a><span id="l47.85"> </span>
<a href="#l47.86"></a><span id="l47.86"> void nsNNTPNewsgroupList::UpdateStatus(bool filtering, int32_t numDLed,</span>
<a href="#l47.87"></a><span id="l47.87">                                        int32_t totToDL) {</span>
<a href="#l47.88"></a><span id="l47.88" class="difflineat">@@ -1155,30 +1155,29 @@ void nsNNTPNewsgroupList::UpdateStatus(b</span>
<a href="#l47.89"></a><span id="l47.89">   if (!bundleService) return;</span>
<a href="#l47.90"></a><span id="l47.90"> </span>
<a href="#l47.91"></a><span id="l47.91">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l47.92"></a><span id="l47.92">   rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l47.93"></a><span id="l47.93">   if (!NS_SUCCEEDED(rv)) return;</span>
<a href="#l47.94"></a><span id="l47.94"> </span>
<a href="#l47.95"></a><span id="l47.95">   if (filtering) {</span>
<a href="#l47.96"></a><span id="l47.96">     NS_ConvertUTF8toUTF16 header(m_filterHeaders[m_currentXHDRIndex]);</span>
<a href="#l47.97"></a><span id="l47.97" class="difflineminus">-    const char16_t *formatStrings[4] = {header.get(), numDownloadedStr.get(),</span>
<a href="#l47.98"></a><span id="l47.98" class="difflineminus">-                                        totalToDownloadStr.get(),</span>
<a href="#l47.99"></a><span id="l47.99" class="difflineminus">-                                        newsgroupName.get()};</span>
<a href="#l47.100"></a><span id="l47.100" class="difflineplus">+    AutoTArray&lt;nsString, 4&gt; formatStrings = {header, numDownloadedStr,</span>
<a href="#l47.101"></a><span id="l47.101" class="difflineplus">+                                             totalToDownloadStr, newsgroupName};</span>
<a href="#l47.102"></a><span id="l47.102">     rv = bundle-&gt;FormatStringFromName(&quot;newNewsgroupFilteringHeaders&quot;,</span>
<a href="#l47.103"></a><span id="l47.103" class="difflineminus">-                                      formatStrings, 4, statusString);</span>
<a href="#l47.104"></a><span id="l47.104" class="difflineplus">+                                      formatStrings, statusString);</span>
<a href="#l47.105"></a><span id="l47.105">   } else {</span>
<a href="#l47.106"></a><span id="l47.106" class="difflineminus">-    const char16_t *formatStrings[3] = {</span>
<a href="#l47.107"></a><span id="l47.107" class="difflineminus">-        numDownloadedStr.get(), totalToDownloadStr.get(), newsgroupName.get()};</span>
<a href="#l47.108"></a><span id="l47.108" class="difflineminus">-    rv = bundle-&gt;FormatStringFromName(&quot;newNewsgroupHeaders&quot;, formatStrings, 3,</span>
<a href="#l47.109"></a><span id="l47.109" class="difflineplus">+    AutoTArray&lt;nsString, 3&gt; formatStrings = {numDownloadedStr,</span>
<a href="#l47.110"></a><span id="l47.110" class="difflineplus">+                                             totalToDownloadStr, newsgroupName};</span>
<a href="#l47.111"></a><span id="l47.111" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(&quot;newNewsgroupHeaders&quot;, formatStrings,</span>
<a href="#l47.112"></a><span id="l47.112">                                       statusString);</span>
<a href="#l47.113"></a><span id="l47.113">   }</span>
<a href="#l47.114"></a><span id="l47.114">   if (!NS_SUCCEEDED(rv)) return;</span>
<a href="#l47.115"></a><span id="l47.115"> </span>
<a href="#l47.116"></a><span id="l47.116" class="difflineminus">-  SetProgressStatus(statusString.get());</span>
<a href="#l47.117"></a><span id="l47.117" class="difflineplus">+  SetProgressStatus(statusString);</span>
<a href="#l47.118"></a><span id="l47.118">   m_lastStatusUpdate = PR_Now();</span>
<a href="#l47.119"></a><span id="l47.119"> </span>
<a href="#l47.120"></a><span id="l47.120">   // only update the progress meter if it has changed</span>
<a href="#l47.121"></a><span id="l47.121">   if (percent != m_lastPercent) {</span>
<a href="#l47.122"></a><span id="l47.122">     SetProgressBarPercent(percent);</span>
<a href="#l47.123"></a><span id="l47.123">     m_lastPercent = percent;</span>
<a href="#l47.124"></a><span id="l47.124">   }</span>
<a href="#l47.125"></a><span id="l47.125"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.h</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.h</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -67,17 +67,17 @@ class nsNNTPNewsgroupList : public nsINN</span>
<a href="#l48.4"></a><span id="l48.4">   bool m_finishingXover;</span>
<a href="#l48.5"></a><span id="l48.5"> </span>
<a href="#l48.6"></a><span id="l48.6"> #ifdef HAVE_CHANGELISTENER</span>
<a href="#l48.7"></a><span id="l48.7">   virtual void OnAnnouncerGoingAway(ChangeAnnouncer *instigator);</span>
<a href="#l48.8"></a><span id="l48.8"> #endif</span>
<a href="#l48.9"></a><span id="l48.9">   nsresult ParseLine(char *line, uint32_t *message_number);</span>
<a href="#l48.10"></a><span id="l48.10">   nsresult GetDatabase(const char *uri, nsIMsgDatabase **db);</span>
<a href="#l48.11"></a><span id="l48.11">   void SetProgressBarPercent(int32_t percent);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  void SetProgressStatus(const char16_t *aMessage);</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+  void SetProgressStatus(const nsString &amp;aMessage);</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15">   void UpdateStatus(bool filtering, int32_t numDled, int32_t totToDL);</span>
<a href="#l48.16"></a><span id="l48.16"> </span>
<a href="#l48.17"></a><span id="l48.17">   nsresult AddHeader(const char *header, const char *value);</span>
<a href="#l48.18"></a><span id="l48.18"> </span>
<a href="#l48.19"></a><span id="l48.19">  protected:</span>
<a href="#l48.20"></a><span id="l48.20">   bool m_getOldMessages;</span>
<a href="#l48.21"></a><span id="l48.21">   bool m_promptedAlready;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -948,19 +948,19 @@ nsresult nsNNTPProtocol::LoadUrl(nsIURI </span>
<a href="#l49.4"></a><span id="l49.4">       // as escaped. decode and unescape the newsgroup name so we'll</span>
<a href="#l49.5"></a><span id="l49.5">       // display a proper name.</span>
<a href="#l49.6"></a><span id="l49.6"> </span>
<a href="#l49.7"></a><span id="l49.7">       nsAutoString unescapedName;</span>
<a href="#l49.8"></a><span id="l49.8">       rv = NS_MsgDecodeUnescapeURLPath(group, unescapedName);</span>
<a href="#l49.9"></a><span id="l49.9">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.10"></a><span id="l49.10"> </span>
<a href="#l49.11"></a><span id="l49.11">       bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-      const char16_t *formatStrings[1] = {unescapedName.get()};</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;autoSubscribeText&quot;, formatStrings, 1,</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineplus">+      AutoTArray&lt;nsString, 1&gt; formatStrings = {unescapedName};</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineplus">+</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineplus">+      rv = bundle-&gt;FormatStringFromName(&quot;autoSubscribeText&quot;, formatStrings,</span>
<a href="#l49.18"></a><span id="l49.18">                                         confirmText);</span>
<a href="#l49.19"></a><span id="l49.19">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.20"></a><span id="l49.20"> </span>
<a href="#l49.21"></a><span id="l49.21">       bool confirmResult = false;</span>
<a href="#l49.22"></a><span id="l49.22">       rv = dialog-&gt;Confirm(nullptr, confirmText.get(), &amp;confirmResult);</span>
<a href="#l49.23"></a><span id="l49.23">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.24"></a><span id="l49.24"> </span>
<a href="#l49.25"></a><span id="l49.25">       if (confirmResult) {</span>
<a href="#l49.26"></a><span id="l49.26" class="difflineat">@@ -2630,21 +2630,21 @@ nsresult nsNNTPProtocol::ReadNewsList(ns</span>
<a href="#l49.27"></a><span id="l49.27">       // decimal precision.</span>
<a href="#l49.28"></a><span id="l49.28">       float rate = 0.0;</span>
<a href="#l49.29"></a><span id="l49.29">       ComputeRate(mBytesReceived, m_startTime, &amp;rate);</span>
<a href="#l49.30"></a><span id="l49.30">       char rate_buf[RATE_STR_BUF_LEN];</span>
<a href="#l49.31"></a><span id="l49.31">       PR_snprintf(rate_buf, RATE_STR_BUF_LEN, &quot;%.1f&quot;, rate);</span>
<a href="#l49.32"></a><span id="l49.32"> </span>
<a href="#l49.33"></a><span id="l49.33">       nsAutoString numGroupsStr;</span>
<a href="#l49.34"></a><span id="l49.34">       numGroupsStr.AppendInt(mNumGroupsListed);</span>
<a href="#l49.35"></a><span id="l49.35" class="difflineminus">-      NS_ConvertASCIItoUTF16 rateStr(rate_buf);</span>
<a href="#l49.36"></a><span id="l49.36" class="difflineminus">-</span>
<a href="#l49.37"></a><span id="l49.37" class="difflineminus">-      const char16_t *formatStrings[3] = {numGroupsStr.get(), bytesStr.get(),</span>
<a href="#l49.38"></a><span id="l49.38" class="difflineminus">-                                          rateStr.get()};</span>
<a href="#l49.39"></a><span id="l49.39" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(&quot;bytesReceived&quot;, formatStrings, 3,</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineplus">+</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineplus">+      AutoTArray&lt;nsString, 3&gt; formatStrings = {numGroupsStr, bytesStr};</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineplus">+      CopyASCIItoUTF16(MakeStringSpan(rate_buf),</span>
<a href="#l49.43"></a><span id="l49.43" class="difflineplus">+                       *formatStrings.AppendElement());</span>
<a href="#l49.44"></a><span id="l49.44" class="difflineplus">+      rv = bundle-&gt;FormatStringFromName(&quot;bytesReceived&quot;, formatStrings,</span>
<a href="#l49.45"></a><span id="l49.45">                                         statusString);</span>
<a href="#l49.46"></a><span id="l49.46"> </span>
<a href="#l49.47"></a><span id="l49.47">       rv = msgStatusFeedback-&gt;ShowStatusString(statusString);</span>
<a href="#l49.48"></a><span id="l49.48">       if (NS_FAILED(rv)) {</span>
<a href="#l49.49"></a><span id="l49.49">         PR_Free(lineToFree);</span>
<a href="#l49.50"></a><span id="l49.50">         return rv;</span>
<a href="#l49.51"></a><span id="l49.51">       }</span>
<a href="#l49.52"></a><span id="l49.52">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -166,20 +166,19 @@ bool nsNewsDownloader::GetNextHdrToRetri</span>
<a href="#l50.4"></a><span id="l50.4">     firstStr.AppendInt(m_numwrote);</span>
<a href="#l50.5"></a><span id="l50.5">     nsAutoString totalStr;</span>
<a href="#l50.6"></a><span id="l50.6">     totalStr.AppendInt(int(m_keysToDownload.Length()));</span>
<a href="#l50.7"></a><span id="l50.7">     nsString prettyName;</span>
<a href="#l50.8"></a><span id="l50.8">     nsString statusString;</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">     m_folder-&gt;GetPrettyName(prettyName);</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    const char16_t *formatStrings[3] = {firstStr.get(), totalStr.get(),</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineminus">-                                        prettyName.get()};</span>
<a href="#l50.14"></a><span id="l50.14" class="difflineplus">+    AutoTArray&lt;nsString, 3&gt; formatStrings = {firstStr, totalStr, prettyName};</span>
<a href="#l50.15"></a><span id="l50.15">     rv = bundle-&gt;FormatStringFromName(&quot;downloadingArticlesForOffline&quot;,</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineminus">-                                      formatStrings, 3, statusString);</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineplus">+                                      formatStrings, statusString);</span>
<a href="#l50.18"></a><span id="l50.18">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l50.19"></a><span id="l50.19">     ShowProgress(statusString.get(), percent);</span>
<a href="#l50.20"></a><span id="l50.20">     return true;</span>
<a href="#l50.21"></a><span id="l50.21">   }</span>
<a href="#l50.22"></a><span id="l50.22">   NS_ASSERTION(false, &quot;shouldn't get here if we're not downloading from keys.&quot;);</span>
<a href="#l50.23"></a><span id="l50.23">   return false;  // shouldn't get here if we're not downloading from keys.</span>
<a href="#l50.24"></a><span id="l50.24"> }</span>
<a href="#l50.25"></a><span id="l50.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -1119,25 +1119,23 @@ nsMsgNewsFolder::GetAuthenticationCreden</span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5">       nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l51.6"></a><span id="l51.6">       rv = GetNntpServer(getter_AddRefs(nntpServer));</span>
<a href="#l51.7"></a><span id="l51.7">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.8"></a><span id="l51.8"> </span>
<a href="#l51.9"></a><span id="l51.9">       bool singleSignon = true;</span>
<a href="#l51.10"></a><span id="l51.10">       nntpServer-&gt;GetSingleSignon(&amp;singleSignon);</span>
<a href="#l51.11"></a><span id="l51.11"> </span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-      const char16_t *params[2];</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-      params[0] = mName.get();</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-      params[1] = serverName.get();</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-      if (singleSignon)</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineminus">-        bundle-&gt;FormatStringFromName(&quot;enterUserPassServer&quot;, &amp;params[1], 1,</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineminus">-                                     promptText);</span>
<a href="#l51.18"></a><span id="l51.18" class="difflineminus">-      else</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineminus">-        bundle-&gt;FormatStringFromName(&quot;enterUserPassGroup&quot;, params, 2,</span>
<a href="#l51.20"></a><span id="l51.20" class="difflineminus">-                                     promptText);</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineplus">+      if (singleSignon) {</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineplus">+        AutoTArray&lt;nsString, 1&gt; params = {serverName};</span>
<a href="#l51.23"></a><span id="l51.23" class="difflineplus">+        bundle-&gt;FormatStringFromName(&quot;enterUserPassServer&quot;, params, promptText);</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineplus">+      } else {</span>
<a href="#l51.25"></a><span id="l51.25" class="difflineplus">+        AutoTArray&lt;nsString, 2&gt; params = {mName, serverName};</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineplus">+        bundle-&gt;FormatStringFromName(&quot;enterUserPassGroup&quot;, params, promptText);</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineplus">+      }</span>
<a href="#l51.28"></a><span id="l51.28"> </span>
<a href="#l51.29"></a><span id="l51.29">       // Fill the signon url for the dialog</span>
<a href="#l51.30"></a><span id="l51.30">       nsString signonURL;</span>
<a href="#l51.31"></a><span id="l51.31">       rv = CreateNewsgroupUrlForSignon(nullptr, signonURL);</span>
<a href="#l51.32"></a><span id="l51.32">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.33"></a><span id="l51.33"> </span>
<a href="#l51.34"></a><span id="l51.34">       // Prefill saved username/password</span>
<a href="#l51.35"></a><span id="l51.35">       char16_t *uniGroupUsername =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -1414,22 +1414,21 @@ nsNntpIncomingServer::GroupNotFound(nsIM</span>
<a href="#l52.4"></a><span id="l52.4">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l52.5"></a><span id="l52.5">   rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l52.6"></a><span id="l52.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8">   nsCString hostname;</span>
<a href="#l52.9"></a><span id="l52.9">   rv = GetRealHostName(hostname);</span>
<a href="#l52.10"></a><span id="l52.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  NS_ConvertUTF8toUTF16 hostStr(hostname);</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineminus">-</span>
<a href="#l52.14"></a><span id="l52.14">   nsString groupName(aName);</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineminus">-  const char16_t *formatStrings[2] = {groupName.get(), hostStr.get()};</span>
<a href="#l52.16"></a><span id="l52.16" class="difflineplus">+  AutoTArray&lt;nsString, 2&gt; formatStrings = {groupName};</span>
<a href="#l52.17"></a><span id="l52.17" class="difflineplus">+  CopyUTF8toUTF16(hostname, *formatStrings.AppendElement());</span>
<a href="#l52.18"></a><span id="l52.18">   nsString confirmText;</span>
<a href="#l52.19"></a><span id="l52.19" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(&quot;autoUnsubscribeText&quot;, formatStrings, 2,</span>
<a href="#l52.20"></a><span id="l52.20" class="difflineplus">+  rv = bundle-&gt;FormatStringFromName(&quot;autoUnsubscribeText&quot;, formatStrings,</span>
<a href="#l52.21"></a><span id="l52.21">                                     confirmText);</span>
<a href="#l52.22"></a><span id="l52.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.23"></a><span id="l52.23"> </span>
<a href="#l52.24"></a><span id="l52.24">   bool confirmResult = false;</span>
<a href="#l52.25"></a><span id="l52.25">   rv = prompt-&gt;Confirm(nullptr, confirmText.get(), &amp;confirmResult);</span>
<a href="#l52.26"></a><span id="l52.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.27"></a><span id="l52.27"> </span>
<a href="#l52.28"></a><span id="l52.28">   if (confirmResult) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

