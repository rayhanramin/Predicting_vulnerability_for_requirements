<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22207:fdc9f3574d6ece7b18d60bf6fe94b63324e9536d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ fdc9f3574d6ece7b18d60bf6fe94b63324e9536d" />
<meta property="og:url" content="/comm-central/rev/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d" />
<meta property="og:description" content="Bug 1402750 - Replace [Assign|Append|Insert|Equals](&quot;&quot;) with [Assign|Append|Insert|Equals]Literal(&quot;&quot;). r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / fdc9f3574d6ece7b18d60bf6fe94b63324e9536d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">shortlog</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">files</a> |
changeset |
<a href="/comm-central/raw-rev/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">raw</a>  | <a href="/comm-central/archive/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1402750">Bug 1402750</a> - Replace [Assign|Append|Insert|Equals](&quot;&quot;) with [Assign|Append|Insert|Equals]Literal(&quot;&quot;). r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 25 Sep 2017 23:39:52 +0200</td></tr>

<tr>
 <td>changeset 22207</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">fdc9f3574d6ece7b18d60bf6fe94b63324e9536d</a></td>
</tr>



<tr>
<td>parent 22206</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/eb81a4091d3cd18a78ba26caa8b62cd2945aa322">eb81a4091d3cd18a78ba26caa8b62cd2945aa322</a>
</td>
</tr>

<tr>
<td>child 22208</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/337c6fe6e0e723bcf16be9ebfa3979d78e39166c">337c6fe6e0e723bcf16be9ebfa3979d78e39166c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=fdc9f3574d6ece7b18d60bf6fe94b63324e9536d">13553</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 25 Sep 2017 23:35:01 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2434e5fd8480 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2434e5fd8480accdadfed0e52759cd992425bf15">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2434e5fd8480accdadfed0e52759cd992425bf15&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2434e5fd8480accdadfed0e52759cd992425bf15&newProject=comm-central&newRevision=fdc9f3574d6ece7b18d60bf6fe94b63324e9536d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2434e5fd8480accdadfed0e52759cd992425bf15&newProject=comm-central&newRevision=fdc9f3574d6ece7b18d60bf6fe94b63324e9536d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2434e5fd8480accdadfed0e52759cd992425bf15&newProject=comm-central&newRevision=fdc9f3574d6ece7b18d60bf6fe94b63324e9536d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1402750">1402750</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1402750">Bug 1402750</a> - Replace [Assign|Append|Insert|Equals](&quot;&quot;) with [Assign|Append|Insert|Equals]Literal(&quot;&quot;). r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbAddressCollector.cpp">mailnews/addrbook/src/nsAbAddressCollector.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbAddressCollector.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbAddressCollector.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbAddressCollector.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbAddressCollector.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbAddressCollector.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbWinHelper.cpp">mailnews/addrbook/src/nsAbWinHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbWinHelper.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbWinHelper.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbWinHelper.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbWinHelper.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/addrbook/src/nsAbWinHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgBodyHandler.cpp">mailnews/base/search/src/nsMsgBodyHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgBodyHandler.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgBodyHandler.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgBodyHandler.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgBodyHandler.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgBodyHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgImapSearch.cpp">mailnews/base/search/src/nsMsgImapSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgImapSearch.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgImapSearch.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgImapSearch.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgImapSearch.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgImapSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgLocalSearch.cpp">mailnews/base/search/src/nsMsgLocalSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgLocalSearch.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgLocalSearch.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgLocalSearch.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgLocalSearch.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgLocalSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessengerBootstrap.cpp">mailnews/base/src/nsMessengerBootstrap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessengerBootstrap.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessengerBootstrap.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessengerBootstrap.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessengerBootstrap.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMessengerBootstrap.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgQuote.cpp">mailnews/compose/src/nsMsgQuote.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgQuote.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgQuote.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgQuote.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgQuote.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgQuote.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendPart.cpp">mailnews/compose/src/nsMsgSendPart.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendPart.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendPart.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendPart.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendPart.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsMsgSendPart.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsAutoSyncState.cpp">mailnews/imap/src/nsAutoSyncState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsAutoSyncState.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsAutoSyncState.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsAutoSyncState.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsAutoSyncState.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsAutoSyncState.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapServerResponseParser.cpp">mailnews/imap/src/nsImapServerResponseParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapServerResponseParser.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapServerResponseParser.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapServerResponseParser.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapServerResponseParser.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapServerResponseParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapUndoTxn.cpp">mailnews/imap/src/nsImapUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/imap/src/nsImapUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckyMail.cpp">mailnews/import/becky/src/nsBeckyMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckyMail.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckyMail.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckyMail.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckyMail.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckyMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckySettings.cpp">mailnews/import/becky/src/nsBeckySettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckySettings.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckySettings.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckySettings.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckySettings.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/becky/src/nsBeckySettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/outlook/src/MapiMessage.cpp">mailnews/import/outlook/src/MapiMessage.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/outlook/src/MapiMessage.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/outlook/src/MapiMessage.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/outlook/src/MapiMessage.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/outlook/src/MapiMessage.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/import/outlook/src/MapiMessage.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimedrft.cpp">mailnews/mime/src/mimedrft.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimedrft.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimedrft.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimedrft.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimedrft.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimedrft.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemrel.cpp">mailnews/mime/src/mimemrel.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemrel.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemrel.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemrel.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemrel.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimemrel.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimetpla.cpp">mailnews/mime/src/mimetpla.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimetpla.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimetpla.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimetpla.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimetpla.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/mimetpla.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/nsStreamConverter.cpp">mailnews/mime/src/nsStreamConverter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/nsStreamConverter.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/nsStreamConverter.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/nsStreamConverter.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/nsStreamConverter.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/mime/src/nsStreamConverter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/fdc9f3574d6ece7b18d60bf6fe94b63324e9536d/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -206,20 +206,20 @@ nsAbAddressCollector::AutoCollectScreenN</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   if (domain.IsEmpty())</span>
<a href="#l1.6"></a><span id="l1.6">     return;</span>
<a href="#l1.7"></a><span id="l1.7">   // username in </span>
<a href="#l1.8"></a><span id="l1.8">   // username@aol.com (America Online)</span>
<a href="#l1.9"></a><span id="l1.9">   // username@cs.com (Compuserve)</span>
<a href="#l1.10"></a><span id="l1.10">   // username@netscape.net (Netscape webmail)</span>
<a href="#l1.11"></a><span id="l1.11">   // are all AIM screennames.  autocollect that info.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  if (domain.Equals(&quot;aol.com&quot;) || domain.Equals(&quot;cs.com&quot;) ||</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-      domain.Equals(&quot;netscape.net&quot;))</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  if (domain.EqualsLiteral(&quot;aol.com&quot;) || domain.EqualsLiteral(&quot;cs.com&quot;) ||</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      domain.EqualsLiteral(&quot;netscape.net&quot;))</span>
<a href="#l1.16"></a><span id="l1.16">     aCard-&gt;SetPropertyAsAUTF8String(kScreenNameProperty, Substring(aEmail, 0, atPos));</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-  else if (domain.Equals(&quot;gmail.com&quot;) || domain.Equals(&quot;googlemail.com&quot;))</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+  else if (domain.EqualsLiteral(&quot;gmail.com&quot;) || domain.EqualsLiteral(&quot;googlemail.com&quot;))</span>
<a href="#l1.19"></a><span id="l1.19">     aCard-&gt;SetPropertyAsAUTF8String(kGtalkProperty, Substring(aEmail, 0, atPos));</span>
<a href="#l1.20"></a><span id="l1.20"> }</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22"> // Returns true if the card was modified successfully.</span>
<a href="#l1.23"></a><span id="l1.23"> bool</span>
<a href="#l1.24"></a><span id="l1.24"> nsAbAddressCollector::SetNamesForCard(nsIAbCard *aSenderCard,</span>
<a href="#l1.25"></a><span id="l1.25">                                       const nsACString &amp;aFullName)</span>
<a href="#l1.26"></a><span id="l1.26"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -63,17 +63,17 @@ nsresult nsAbBoolExprToLDAPFilter::Filte</span>
<a href="#l2.4"></a><span id="l2.4">         nsCOMPtr&lt;nsIAbBooleanConditionString&gt;</span>
<a href="#l2.5"></a><span id="l2.5">             childCondition(do_QueryElementAt(childExpressions, 1, &amp;rv));</span>
<a href="#l2.6"></a><span id="l2.6">         if (NS_SUCCEEDED(rv))</span>
<a href="#l2.7"></a><span id="l2.7">         {</span>
<a href="#l2.8"></a><span id="l2.8">             nsCString name;</span>
<a href="#l2.9"></a><span id="l2.9">             rv = childCondition-&gt;GetName (getter_Copies (name));</span>
<a href="#l2.10"></a><span id="l2.10">             NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-            if(name.Equals(&quot;card:nsIAbCard&quot;))</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+            if (name.EqualsLiteral(&quot;card:nsIAbCard&quot;))</span>
<a href="#l2.14"></a><span id="l2.14">                 return NS_OK;</span>
<a href="#l2.15"></a><span id="l2.15">         }</span>
<a href="#l2.16"></a><span id="l2.16">     }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">     filter.AppendLiteral(&quot;(&quot;);</span>
<a href="#l2.19"></a><span id="l2.19">     switch (operation)</span>
<a href="#l2.20"></a><span id="l2.20">     {</span>
<a href="#l2.21"></a><span id="l2.21">         case nsIAbBooleanOperationTypes::AND:</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -170,17 +170,17 @@ nsresult nsAbBoolExprToLDAPFilter::Filte</span>
<a href="#l2.23"></a><span id="l2.23">         case nsIAbBooleanConditionTypes::Exists:</span>
<a href="#l2.24"></a><span id="l2.24">             filter.AppendLiteral(&quot;(&quot;); </span>
<a href="#l2.25"></a><span id="l2.25">             filter.Append(ldapAttr);</span>
<a href="#l2.26"></a><span id="l2.26">             filter.AppendLiteral(&quot;=*)&quot;);</span>
<a href="#l2.27"></a><span id="l2.27">             break;</span>
<a href="#l2.28"></a><span id="l2.28">         case nsIAbBooleanConditionTypes::Contains:</span>
<a href="#l2.29"></a><span id="l2.29">             filter.AppendLiteral(&quot;(&quot;);</span>
<a href="#l2.30"></a><span id="l2.30">             filter.Append(ldapAttr);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-            filter.Append(&quot;=*&quot;);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+            filter.AppendLiteral(&quot;=*&quot;);</span>
<a href="#l2.33"></a><span id="l2.33">             filter.Append(vUTF8);</span>
<a href="#l2.34"></a><span id="l2.34">             filter.AppendLiteral(&quot;*)&quot;);</span>
<a href="#l2.35"></a><span id="l2.35">             break;</span>
<a href="#l2.36"></a><span id="l2.36">         case nsIAbBooleanConditionTypes::DoesNotContain:</span>
<a href="#l2.37"></a><span id="l2.37">             filter.AppendLiteral(&quot;(!(&quot;);</span>
<a href="#l2.38"></a><span id="l2.38">             filter.Append(ldapAttr);</span>
<a href="#l2.39"></a><span id="l2.39">             filter.AppendLiteral(&quot;=*&quot;);</span>
<a href="#l2.40"></a><span id="l2.40">             filter.Append(vUTF8);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -123,17 +123,17 @@ nsAbCardProperty::~nsAbCardProperty(void</span>
<a href="#l3.4"></a><span id="l3.4"> {</span>
<a href="#l3.5"></a><span id="l3.5"> }</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> NS_IMPL_ISUPPORTS(nsAbCardProperty, nsIAbCard, nsIAbItem)</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> NS_IMETHODIMP nsAbCardProperty::GetUuid(nsACString &amp;uuid)</span>
<a href="#l3.10"></a><span id="l3.10"> {</span>
<a href="#l3.11"></a><span id="l3.11">   // If we have indeterminate sub-ids, return an empty uuid.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  if (m_directoryId.Equals(&quot;&quot;) || m_localId.Equals(&quot;&quot;))</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  if (m_directoryId.IsEmpty() || m_localId.IsEmpty())</span>
<a href="#l3.14"></a><span id="l3.14">   {</span>
<a href="#l3.15"></a><span id="l3.15">     uuid.Truncate();</span>
<a href="#l3.16"></a><span id="l3.16">     return NS_OK;</span>
<a href="#l3.17"></a><span id="l3.17">   }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">   nsresult rv;</span>
<a href="#l3.20"></a><span id="l3.20">   nsCOMPtr&lt;nsIAbManager&gt; manager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.21"></a><span id="l3.21">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -239,20 +239,20 @@ NS_IMETHODIMP nsAbLDAPDirectory::SetLDAP</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   rv = SetStringValue(&quot;uri&quot;, tempLDAPURL);</span>
<a href="#l4.6"></a><span id="l4.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   // Now we need to send an update which will ensure our indicators and</span>
<a href="#l4.9"></a><span id="l4.9">   // listeners get updated correctly.</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">   // See if they both start with ldaps: or ldap:</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  bool newIsNotSecure = StringHead(tempLDAPURL, 5).Equals(&quot;ldap:&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  bool newIsNotSecure = StringBeginsWith(tempLDAPURL, NS_LITERAL_CSTRING(&quot;ldap:&quot;));</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">   if (oldUrl.IsEmpty() ||</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-      StringHead(oldUrl, 5).Equals(&quot;ldap:&quot;) != newIsNotSecure)</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+      StringBeginsWith(oldUrl, NS_LITERAL_CSTRING(&quot;ldap:&quot;)) != newIsNotSecure)</span>
<a href="#l4.18"></a><span id="l4.18">   {</span>
<a href="#l4.19"></a><span id="l4.19">     // They don't so its time to send round an update.</span>
<a href="#l4.20"></a><span id="l4.20">     nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l4.21"></a><span id="l4.21">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">     // We inherit from nsIAbDirectory, so this static cast should be safe.</span>
<a href="#l4.24"></a><span id="l4.24">     abManager-&gt;NotifyItemPropertyChanged(static_cast&lt;nsIAbDirectory*&gt;(this),</span>
<a href="#l4.25"></a><span id="l4.25">       &quot;IsSecure&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbWinHelper.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbWinHelper.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -984,17 +984,17 @@ nsAbWinType getAbWinType(const char *aSc</span>
<a href="#l5.4"></a><span id="l5.4"> }</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> void buildAbWinUri(const char *aScheme, uint32_t aType, nsCString&amp; aUri)</span>
<a href="#l5.7"></a><span id="l5.7"> {</span>
<a href="#l5.8"></a><span id="l5.8">     aUri.Assign(aScheme) ;</span>
<a href="#l5.9"></a><span id="l5.9">     switch(aType) {</span>
<a href="#l5.10"></a><span id="l5.10">     case nsAbWinType_Outlook: aUri.Append(kOutlookStub) ; break ; </span>
<a href="#l5.11"></a><span id="l5.11">     case nsAbWinType_OutlookExp: aUri.Append(kOutlookExpStub) ; break ;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    default: aUri.Assign(&quot;&quot;) ;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    default: aUri.AssignLiteral(&quot;&quot;) ;</span>
<a href="#l5.14"></a><span id="l5.14">     }</span>
<a href="#l5.15"></a><span id="l5.15"> }</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -388,17 +388,17 @@ void nsMsgBodyHandler::SniffPossibleMIME</span>
<a href="#l6.4"></a><span id="l6.4">     int32_t start = lowerCaseLine.Find(&quot;boundary=&quot;, /* ignoreCase = */ true);</span>
<a href="#l6.5"></a><span id="l6.5">     start += 9;</span>
<a href="#l6.6"></a><span id="l6.6">     if (line[start] == '\&quot;')</span>
<a href="#l6.7"></a><span id="l6.7">       start++;</span>
<a href="#l6.8"></a><span id="l6.8">     int32_t end = line.RFindChar('\&quot;');</span>
<a href="#l6.9"></a><span id="l6.9">     if (end == -1)</span>
<a href="#l6.10"></a><span id="l6.10">       end = line.Length();</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    boundary.Assign(&quot;--&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    boundary.AssignLiteral(&quot;--&quot;);</span>
<a href="#l6.14"></a><span id="l6.14">     boundary.Append(Substring(line,start,end-start));</span>
<a href="#l6.15"></a><span id="l6.15">   }</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">   if (StringBeginsWith(lowerCaseLine,</span>
<a href="#l6.18"></a><span id="l6.18">                        NS_LITERAL_CSTRING(&quot;content-transfer-encoding:&quot;)) &amp;&amp;</span>
<a href="#l6.19"></a><span id="l6.19">       lowerCaseLine.Find(ENCODING_BASE64, /* ignoreCase = */ true) != kNotFound)</span>
<a href="#l6.20"></a><span id="l6.20">     m_base64part = true;</span>
<a href="#l6.21"></a><span id="l6.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -174,17 +174,17 @@ nsMsgFilterList::GetLogFile(nsIFile **aF</span>
<a href="#l7.4"></a><span id="l7.4">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">   // for news folders (not servers), the filter file is</span>
<a href="#l7.7"></a><span id="l7.7">   // mcom.test.dat</span>
<a href="#l7.8"></a><span id="l7.8">   // where the summary file is</span>
<a href="#l7.9"></a><span id="l7.9">   // mcom.test.msf</span>
<a href="#l7.10"></a><span id="l7.10">   // since the log is an html file we make it</span>
<a href="#l7.11"></a><span id="l7.11">   // mcom.test.htm</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  if (type.Equals(&quot;nntp&quot;) &amp;&amp; !isServer)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  if (type.EqualsLiteral(&quot;nntp&quot;) &amp;&amp; !isServer)</span>
<a href="#l7.14"></a><span id="l7.14">   {</span>
<a href="#l7.15"></a><span id="l7.15">     nsCOMPtr&lt;nsIFile&gt; thisFolder;</span>
<a href="#l7.16"></a><span id="l7.16">     rv = m_folder-&gt;GetFilePath(getter_AddRefs(thisFolder));</span>
<a href="#l7.17"></a><span id="l7.17">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">     nsCOMPtr&lt;nsIFile&gt; filterLogFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l7.20"></a><span id="l7.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.21"></a><span id="l7.21">     rv = filterLogFile-&gt;InitWithFile(thisFolder);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -400,17 +400,17 @@ int nsMsgFilterList::SkipWhitespace(nsII</span>
<a href="#l7.23"></a><span id="l7.23">     ch = ReadChar(aStream);</span>
<a href="#l7.24"></a><span id="l7.24">   } while (!(ch &amp; 0x80) &amp;&amp; isspace(ch)); // isspace can crash with non-ascii input</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">   return ch;</span>
<a href="#l7.27"></a><span id="l7.27"> }</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29"> bool nsMsgFilterList::StrToBool(nsCString &amp;str)</span>
<a href="#l7.30"></a><span id="l7.30"> {</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  return str.Equals(&quot;yes&quot;) ;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  return str.EqualsLiteral(&quot;yes&quot;);</span>
<a href="#l7.33"></a><span id="l7.33"> }</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35"> int nsMsgFilterList::LoadAttrib(nsMsgFilterFileAttribValue &amp;attrib, nsIInputStream *aStream)</span>
<a href="#l7.36"></a><span id="l7.36"> {</span>
<a href="#l7.37"></a><span id="l7.37">   char  attribStr[100];</span>
<a href="#l7.38"></a><span id="l7.38">   int curChar;</span>
<a href="#l7.39"></a><span id="l7.39">   attrib = nsIMsgFilterList::attribNone;</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -1148,17 +1148,17 @@ nsresult nsMsgFilterList::ComputeArbitra</span>
<a href="#l7.42"></a><span id="l7.42">     {</span>
<a href="#l7.43"></a><span id="l7.43">       filter-&gt;GetTerm(i, &amp;attrib, nullptr, nullptr, nullptr, arbitraryHeader);</span>
<a href="#l7.44"></a><span id="l7.44">       if (!arbitraryHeader.IsEmpty())</span>
<a href="#l7.45"></a><span id="l7.45">       {</span>
<a href="#l7.46"></a><span id="l7.46">         if (m_arbitraryHeaders.IsEmpty())</span>
<a href="#l7.47"></a><span id="l7.47">           m_arbitraryHeaders.Assign(arbitraryHeader);</span>
<a href="#l7.48"></a><span id="l7.48">         else if (m_arbitraryHeaders.Find(arbitraryHeader, /* ignoreCase = */ true) == -1)</span>
<a href="#l7.49"></a><span id="l7.49">         {</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-          m_arbitraryHeaders.Append(&quot; &quot;);</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+          m_arbitraryHeaders.Append(' ');</span>
<a href="#l7.52"></a><span id="l7.52">           m_arbitraryHeaders.Append(arbitraryHeader);</span>
<a href="#l7.53"></a><span id="l7.53">         }</span>
<a href="#l7.54"></a><span id="l7.54">       }</span>
<a href="#l7.55"></a><span id="l7.55">     }</span>
<a href="#l7.56"></a><span id="l7.56">   }</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58">   return NS_OK;</span>
<a href="#l7.59"></a><span id="l7.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -124,17 +124,17 @@ nsresult nsMsgSearchOnlineMail::Encode (</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">   // We do not need &quot;srcCharset&quot; since the search term in always unicode.</span>
<a href="#l8.6"></a><span id="l8.6">   // I just pass destCharset for both src and dest charset instead of removing srcCharst from the arguemnt.</span>
<a href="#l8.7"></a><span id="l8.7">   nsresult err = nsMsgSearchAdapter::EncodeImap (getter_Copies(imapTerms), searchTerms,</span>
<a href="#l8.8"></a><span id="l8.8">     asciiOnly ?  usAsciiCharSet.get(): destCharset,</span>
<a href="#l8.9"></a><span id="l8.9">     asciiOnly ?  usAsciiCharSet.get(): destCharset, false);</span>
<a href="#l8.10"></a><span id="l8.10">   if (NS_SUCCEEDED(err))</span>
<a href="#l8.11"></a><span id="l8.11">   {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    pEncoding.Append(&quot;SEARCH&quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    pEncoding.AppendLiteral(&quot;SEARCH&quot;);</span>
<a href="#l8.14"></a><span id="l8.14">     if (csname)</span>
<a href="#l8.15"></a><span id="l8.15">       pEncoding.Append(csname);</span>
<a href="#l8.16"></a><span id="l8.16">     pEncoding.Append(imapTerms);</span>
<a href="#l8.17"></a><span id="l8.17">   }</span>
<a href="#l8.18"></a><span id="l8.18">   PR_FREEIF(csname);</span>
<a href="#l8.19"></a><span id="l8.19">   return err;</span>
<a href="#l8.20"></a><span id="l8.20"> }</span>
<a href="#l8.21"></a><span id="l8.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -435,17 +435,17 @@ nsresult nsMsgSearchOfflineMail::Process</span>
<a href="#l9.4"></a><span id="l9.4">         break;</span>
<a href="#l9.5"></a><span id="l9.5">       case nsMsgSearchAttrib::Subject:</span>
<a href="#l9.6"></a><span id="l9.6">       {</span>
<a href="#l9.7"></a><span id="l9.7">         msgToMatch-&gt;GetSubject(getter_Copies(matchString) /* , true */);</span>
<a href="#l9.8"></a><span id="l9.8">         if (msgFlags &amp; nsMsgMessageFlags::HasRe)</span>
<a href="#l9.9"></a><span id="l9.9">         {</span>
<a href="#l9.10"></a><span id="l9.10">           // Make sure we pass along the &quot;Re: &quot; part of the subject if this is a reply.</span>
<a href="#l9.11"></a><span id="l9.11">           nsCString reString;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-          reString.Assign(&quot;Re: &quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+          reString.AssignLiteral(&quot;Re: &quot;);</span>
<a href="#l9.14"></a><span id="l9.14">           reString.Append(matchString);</span>
<a href="#l9.15"></a><span id="l9.15">           err = aTerm-&gt;MatchRfc2047String(reString, charset, charsetOverride, &amp;result);</span>
<a href="#l9.16"></a><span id="l9.16">         }</span>
<a href="#l9.17"></a><span id="l9.17">         else</span>
<a href="#l9.18"></a><span id="l9.18">           err = aTerm-&gt;MatchRfc2047String(matchString, charset, charsetOverride, &amp;result);</span>
<a href="#l9.19"></a><span id="l9.19">         break;</span>
<a href="#l9.20"></a><span id="l9.20">       }</span>
<a href="#l9.21"></a><span id="l9.21">       case nsMsgSearchAttrib::ToOrCC:</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -547,17 +547,17 @@ nsresult nsMsgSearchOfflineMail::Process</span>
<a href="#l9.23"></a><span id="l9.23">           nsCString keywords;</span>
<a href="#l9.24"></a><span id="l9.24">           nsMsgLabelValue label;</span>
<a href="#l9.25"></a><span id="l9.25">           msgToMatch-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l9.26"></a><span id="l9.26">           msgToMatch-&gt;GetLabel(&amp;label);</span>
<a href="#l9.27"></a><span id="l9.27">           if (label &gt;= 1)</span>
<a href="#l9.28"></a><span id="l9.28">           {</span>
<a href="#l9.29"></a><span id="l9.29">             if (!keywords.IsEmpty())</span>
<a href="#l9.30"></a><span id="l9.30">               keywords.Append(' ');</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-            keywords.Append(&quot;$label&quot;);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+            keywords.AppendLiteral(&quot;$label&quot;);</span>
<a href="#l9.33"></a><span id="l9.33">             keywords.Append(label + '0');</span>
<a href="#l9.34"></a><span id="l9.34">           }</span>
<a href="#l9.35"></a><span id="l9.35">           err = aTerm-&gt;MatchKeyword(keywords, &amp;result);</span>
<a href="#l9.36"></a><span id="l9.36">           break;</span>
<a href="#l9.37"></a><span id="l9.37">       }</span>
<a href="#l9.38"></a><span id="l9.38">       case nsMsgSearchAttrib::JunkStatus:</span>
<a href="#l9.39"></a><span id="l9.39">       {</span>
<a href="#l9.40"></a><span id="l9.40">          nsCString junkScoreStr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -509,17 +509,17 @@ nsresult nsMsgSearchTerm::OutputValue(ns</span>
<a href="#l10.4"></a><span id="l10.4">       {</span>
<a href="#l10.5"></a><span id="l10.5">         nsAutoCString priority;</span>
<a href="#l10.6"></a><span id="l10.6">         NS_MsgGetUntranslatedPriorityName(m_value.u.priority, priority);</span>
<a href="#l10.7"></a><span id="l10.7">         outputStr += priority;</span>
<a href="#l10.8"></a><span id="l10.8">         break;</span>
<a href="#l10.9"></a><span id="l10.9">       }</span>
<a href="#l10.10"></a><span id="l10.10">     case nsMsgSearchAttrib::HasAttachmentStatus:</span>
<a href="#l10.11"></a><span id="l10.11">       {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        outputStr.Append(&quot;true&quot;);  // don't need anything here, really</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+        outputStr.AppendLiteral(&quot;true&quot;);  // don't need anything here, really</span>
<a href="#l10.14"></a><span id="l10.14">         break;</span>
<a href="#l10.15"></a><span id="l10.15">       }</span>
<a href="#l10.16"></a><span id="l10.16">     case nsMsgSearchAttrib::Size:</span>
<a href="#l10.17"></a><span id="l10.17">       {</span>
<a href="#l10.18"></a><span id="l10.18">         outputStr.AppendInt(m_value.u.size);</span>
<a href="#l10.19"></a><span id="l10.19">         break;</span>
<a href="#l10.20"></a><span id="l10.20">       }</span>
<a href="#l10.21"></a><span id="l10.21">     case nsMsgSearchAttrib::Uint32HdrProperty:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -2885,19 +2885,19 @@ nsDelAttachListener::StartProcessing(nsM</span>
<a href="#l11.4"></a><span id="l11.4">   const char * partId;</span>
<a href="#l11.5"></a><span id="l11.5">   const char * nextField;</span>
<a href="#l11.6"></a><span id="l11.6">   nsAutoCString sHeader(&quot;attach&amp;del=&quot;);</span>
<a href="#l11.7"></a><span id="l11.7">   nsAutoCString detachToHeader(&quot;&amp;detachTo=&quot;);</span>
<a href="#l11.8"></a><span id="l11.8">   for (uint32_t u = 0; u &lt; mAttach-&gt;mCount; ++u)</span>
<a href="#l11.9"></a><span id="l11.9">   {</span>
<a href="#l11.10"></a><span id="l11.10">     if (u &gt; 0)</span>
<a href="#l11.11"></a><span id="l11.11">     {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-      sHeader.Append(&quot;,&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+      sHeader.Append(',');</span>
<a href="#l11.14"></a><span id="l11.14">       if (detaching)</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-        detachToHeader.Append(&quot;,&quot;);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+        detachToHeader.Append(',');</span>
<a href="#l11.17"></a><span id="l11.17">     }</span>
<a href="#l11.18"></a><span id="l11.18">     partId = GetAttachmentPartId(mAttach-&gt;mAttachmentArray[u].mUrl);</span>
<a href="#l11.19"></a><span id="l11.19">     nextField = PL_strchr(partId, '&amp;');</span>
<a href="#l11.20"></a><span id="l11.20">     sHeader.Append(partId, nextField ? nextField - partId : -1);</span>
<a href="#l11.21"></a><span id="l11.21">     if (detaching)</span>
<a href="#l11.22"></a><span id="l11.22">       detachToHeader.Append(mDetachedFileUris[u]);</span>
<a href="#l11.23"></a><span id="l11.23">   }</span>
<a href="#l11.24"></a><span id="l11.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -26,17 +26,17 @@ nsMessengerBootstrap::~nsMessengerBootst</span>
<a href="#l12.4"></a><span id="l12.4"> }</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> NS_IMETHODIMP nsMessengerBootstrap::OpenMessengerWindowWithUri(const char *windowType, const char * aFolderURI, nsMsgKey aMessageKey)</span>
<a href="#l12.7"></a><span id="l12.7"> {</span>
<a href="#l12.8"></a><span id="l12.8">   bool standAloneMsgWindow = false;</span>
<a href="#l12.9"></a><span id="l12.9">   nsAutoCString chromeUrl(&quot;chrome://messenger/content/&quot;);</span>
<a href="#l12.10"></a><span id="l12.10">   if (windowType &amp;&amp; !strcmp(windowType, &quot;mail:messageWindow&quot;))</span>
<a href="#l12.11"></a><span id="l12.11">   {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    chromeUrl.Append(&quot;messageWindow.xul&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    chromeUrl.AppendLiteral(&quot;messageWindow.xul&quot;);</span>
<a href="#l12.14"></a><span id="l12.14">     standAloneMsgWindow = true;</span>
<a href="#l12.15"></a><span id="l12.15">   }</span>
<a href="#l12.16"></a><span id="l12.16">   nsresult rv;</span>
<a href="#l12.17"></a><span id="l12.17">   nsCOMPtr&lt;nsIMutableArray&gt; argsArray(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l12.18"></a><span id="l12.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">   // create scriptable versions of our strings that we can store in our nsIMutableArray....</span>
<a href="#l12.21"></a><span id="l12.21">   if (aFolderURI)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1298,17 +1298,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l13.4"></a><span id="l13.4">           nsCString dupAccountKey;</span>
<a href="#l13.5"></a><span id="l13.5">           dupAccount-&gt;GetKey(dupAccountKey);</span>
<a href="#l13.6"></a><span id="l13.6">           if (deferredToAccount.Equals(dupAccountKey))</span>
<a href="#l13.7"></a><span id="l13.7">           {</span>
<a href="#l13.8"></a><span id="l13.8">             nsresult rv;</span>
<a href="#l13.9"></a><span id="l13.9">             nsCString accountPref(&quot;mail.account.&quot;);</span>
<a href="#l13.10"></a><span id="l13.10">             nsCString dupAccountServerKey;</span>
<a href="#l13.11"></a><span id="l13.11">             accountPref.Append(dupAccountKey);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            accountPref.Append(&quot;.server&quot;);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            accountPref.AppendLiteral(&quot;.server&quot;);</span>
<a href="#l13.14"></a><span id="l13.14">             nsCOMPtr&lt;nsIPrefService&gt; prefservice(</span>
<a href="#l13.15"></a><span id="l13.15">               do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l13.16"></a><span id="l13.16">             if (NS_FAILED(rv)) {</span>
<a href="#l13.17"></a><span id="l13.17">               continue;</span>
<a href="#l13.18"></a><span id="l13.18">             }</span>
<a href="#l13.19"></a><span id="l13.19">             nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(</span>
<a href="#l13.20"></a><span id="l13.20">               do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l13.21"></a><span id="l13.21">             if (NS_FAILED(rv)) {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -1317,17 +1317,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l13.23"></a><span id="l13.23">             rv = prefBranch-&gt;GetCharPref(accountPref.get(),</span>
<a href="#l13.24"></a><span id="l13.24">                                          getter_Copies(dupAccountServerKey));</span>
<a href="#l13.25"></a><span id="l13.25">             if (NS_FAILED(rv)) {</span>
<a href="#l13.26"></a><span id="l13.26">               continue;</span>
<a href="#l13.27"></a><span id="l13.27">             }</span>
<a href="#l13.28"></a><span id="l13.28">             nsCOMPtr&lt;nsIPrefBranch&gt; serverPrefBranch;</span>
<a href="#l13.29"></a><span id="l13.29">             nsCString serverKeyPref(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l13.30"></a><span id="l13.30">             serverKeyPref.Append(dupAccountServerKey);</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-            serverKeyPref.Append(&quot;.&quot;);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+            serverKeyPref.Append('.');</span>
<a href="#l13.33"></a><span id="l13.33">             rv = prefservice-&gt;GetBranch(serverKeyPref.get(),</span>
<a href="#l13.34"></a><span id="l13.34">                                         getter_AddRefs(serverPrefBranch));</span>
<a href="#l13.35"></a><span id="l13.35">             if (NS_FAILED(rv)) {</span>
<a href="#l13.36"></a><span id="l13.36">               continue;</span>
<a href="#l13.37"></a><span id="l13.37">             }</span>
<a href="#l13.38"></a><span id="l13.38">             nsCString userName;</span>
<a href="#l13.39"></a><span id="l13.39">             nsCString hostName;</span>
<a href="#l13.40"></a><span id="l13.40">             nsCString type;</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineat">@@ -2945,17 +2945,17 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l13.42"></a><span id="l13.42">       {</span>
<a href="#l13.43"></a><span id="l13.43">         if (version == -1)</span>
<a href="#l13.44"></a><span id="l13.44">         {</span>
<a href="#l13.45"></a><span id="l13.45">           buffer.Cut(0, 8);</span>
<a href="#l13.46"></a><span id="l13.46">           nsresult irv;</span>
<a href="#l13.47"></a><span id="l13.47">           version = buffer.ToInteger(&amp;irv);</span>
<a href="#l13.48"></a><span id="l13.48">           continue;</span>
<a href="#l13.49"></a><span id="l13.49">         }</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-        if (Substring(buffer, 0, 4).Equals(&quot;uri=&quot;))</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+        if (StringBeginsWith(buffer, NS_LITERAL_CSTRING(&quot;uri=&quot;)))</span>
<a href="#l13.52"></a><span id="l13.52">         {</span>
<a href="#l13.53"></a><span id="l13.53">           buffer.Cut(0, 4);</span>
<a href="#l13.54"></a><span id="l13.54">           dbFolderInfo = nullptr;</span>
<a href="#l13.55"></a><span id="l13.55"> </span>
<a href="#l13.56"></a><span id="l13.56">           rv = rdf-&gt;GetResource(buffer, getter_AddRefs(resource));</span>
<a href="#l13.57"></a><span id="l13.57">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59">           virtualFolder = do_QueryInterface(resource);</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineat">@@ -3009,37 +3009,37 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l13.61"></a><span id="l13.61">                 parentFolder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l13.62"></a><span id="l13.62">                 buffer.SetLength(lastSlash);</span>
<a href="#l13.63"></a><span id="l13.63">               }</span>
<a href="#l13.64"></a><span id="l13.64">               else</span>
<a href="#l13.65"></a><span id="l13.65">                 break;</span>
<a href="#l13.66"></a><span id="l13.66">             } while (!grandParent &amp;&amp; !isServer);</span>
<a href="#l13.67"></a><span id="l13.67">           }</span>
<a href="#l13.68"></a><span id="l13.68">         }</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-        else if (dbFolderInfo &amp;&amp; Substring(buffer, 0, 6).Equals(&quot;scope=&quot;))</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+        else if (dbFolderInfo &amp;&amp; StringBeginsWith(buffer, NS_LITERAL_CSTRING(&quot;scope=&quot;)))</span>
<a href="#l13.71"></a><span id="l13.71">         {</span>
<a href="#l13.72"></a><span id="l13.72">           buffer.Cut(0, 6);</span>
<a href="#l13.73"></a><span id="l13.73">           // if this is a cross folder virtual folder, we have a list of folders uris,</span>
<a href="#l13.74"></a><span id="l13.74">           // and we have to add a pending listener for each of them.</span>
<a href="#l13.75"></a><span id="l13.75">           if (!buffer.IsEmpty())</span>
<a href="#l13.76"></a><span id="l13.76">           {</span>
<a href="#l13.77"></a><span id="l13.77">             ParseAndVerifyVirtualFolderScope(buffer, rdf);</span>
<a href="#l13.78"></a><span id="l13.78">             dbFolderInfo-&gt;SetCharProperty(kSearchFolderUriProp, buffer);</span>
<a href="#l13.79"></a><span id="l13.79">             AddVFListenersForVF(virtualFolder, buffer, rdf, msgDBService);</span>
<a href="#l13.80"></a><span id="l13.80">           }</span>
<a href="#l13.81"></a><span id="l13.81">         }</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-        else if (dbFolderInfo &amp;&amp; Substring(buffer, 0, 6).Equals(&quot;terms=&quot;))</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+        else if (dbFolderInfo &amp;&amp; StringBeginsWith(buffer, NS_LITERAL_CSTRING(&quot;terms=&quot;)))</span>
<a href="#l13.84"></a><span id="l13.84">         {</span>
<a href="#l13.85"></a><span id="l13.85">           buffer.Cut(0, 6);</span>
<a href="#l13.86"></a><span id="l13.86">           dbFolderInfo-&gt;SetCharProperty(&quot;searchStr&quot;, buffer);</span>
<a href="#l13.87"></a><span id="l13.87">         }</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-        else if (dbFolderInfo &amp;&amp; Substring(buffer, 0, 13).Equals(&quot;searchOnline=&quot;))</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+        else if (dbFolderInfo &amp;&amp; StringBeginsWith(buffer, NS_LITERAL_CSTRING(&quot;searchOnline=&quot;)))</span>
<a href="#l13.90"></a><span id="l13.90">         {</span>
<a href="#l13.91"></a><span id="l13.91">           buffer.Cut(0, 13);</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-          dbFolderInfo-&gt;SetBooleanProperty(&quot;searchOnline&quot;, buffer.Equals(&quot;true&quot;));</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+          dbFolderInfo-&gt;SetBooleanProperty(&quot;searchOnline&quot;, buffer.EqualsLiteral(&quot;true&quot;));</span>
<a href="#l13.94"></a><span id="l13.94">         }</span>
<a href="#l13.95"></a><span id="l13.95">         else if (dbFolderInfo &amp;&amp;</span>
<a href="#l13.96"></a><span id="l13.96">                  Substring(buffer, 0, SEARCH_FOLDER_FLAG_LEN + 1)</span>
<a href="#l13.97"></a><span id="l13.97">                    .Equals(SEARCH_FOLDER_FLAG&quot;=&quot;))</span>
<a href="#l13.98"></a><span id="l13.98">         {</span>
<a href="#l13.99"></a><span id="l13.99">           buffer.Cut(0, SEARCH_FOLDER_FLAG_LEN + 1);</span>
<a href="#l13.100"></a><span id="l13.100">           dbFolderInfo-&gt;SetCharProperty(SEARCH_FOLDER_FLAG, buffer);</span>
<a href="#l13.101"></a><span id="l13.101">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -102,17 +102,17 @@ nsMsgContentPolicy::ShouldAcceptRemoteCo</span>
<a href="#l14.4"></a><span id="l14.4">   nsCString emailAddress;</span>
<a href="#l14.5"></a><span id="l14.5">   ExtractEmail(EncodedHeader(author), emailAddress);</span>
<a href="#l14.6"></a><span id="l14.6">   if (emailAddress.IsEmpty())</span>
<a href="#l14.7"></a><span id="l14.7">     return false;</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">   nsCOMPtr&lt;nsIIOService&gt; ios = do_GetService(&quot;@mozilla.org/network/io-service;1&quot;, &amp;rv);</span>
<a href="#l14.10"></a><span id="l14.10">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l14.11"></a><span id="l14.11">   nsCOMPtr&lt;nsIURI&gt; mailURI;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  emailAddress.Insert(&quot;chrome://messenger/content/email=&quot;, 0);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  emailAddress.InsertLiteral(&quot;chrome://messenger/content/email=&quot;, 0);</span>
<a href="#l14.14"></a><span id="l14.14">   rv = ios-&gt;NewURI(emailAddress, nullptr, nullptr, getter_AddRefs(mailURI));</span>
<a href="#l14.15"></a><span id="l14.15">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">   // check with permission manager</span>
<a href="#l14.18"></a><span id="l14.18">   uint32_t permission = 0;</span>
<a href="#l14.19"></a><span id="l14.19">   rv = mPermissionManager-&gt;TestPermission(mailURI, &quot;image&quot;, &amp;permission);</span>
<a href="#l14.20"></a><span id="l14.20">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l14.21"></a><span id="l14.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -348,17 +348,17 @@ static void UpdateCachedName(nsIMsgDBHdr</span>
<a href="#l15.4"></a><span id="l15.4">   nsCString newCachedName;</span>
<a href="#l15.5"></a><span id="l15.5">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l15.6"></a><span id="l15.6">   int32_t  currentDisplayNameVersion = 0;</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">   prefs-&gt;GetIntPref(&quot;mail.displayname.version&quot;, &amp;currentDisplayNameVersion);</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   // save version number</span>
<a href="#l15.11"></a><span id="l15.11">   newCachedName.AppendInt(currentDisplayNameVersion);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  newCachedName.Append(&quot;|&quot;);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  newCachedName.Append('|');</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15">   // save name</span>
<a href="#l15.16"></a><span id="l15.16">   newCachedName.Append(NS_ConvertUTF16toUTF8(newName));</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18">   aHdr-&gt;SetStringProperty(header_field,newCachedName.get());</span>
<a href="#l15.19"></a><span id="l15.19"> }</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> nsresult nsMsgDBView::FetchAuthor(nsIMsgDBHdr * aHdr, nsAString &amp;aSenderString)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -2064,17 +2064,17 @@ nsMsgFlatFolderDataSource::~nsMsgFlatFol</span>
<a href="#l16.4"></a><span id="l16.4"> }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> nsresult nsMsgFlatFolderDataSource::Init()</span>
<a href="#l16.7"></a><span id="l16.7"> {</span>
<a href="#l16.8"></a><span id="l16.8">   nsIRDFService* rdf = getRDFService();</span>
<a href="#l16.9"></a><span id="l16.9">   NS_ENSURE_TRUE(rdf, NS_ERROR_FAILURE);</span>
<a href="#l16.10"></a><span id="l16.10">   nsCOMPtr&lt;nsIRDFResource&gt; source;</span>
<a href="#l16.11"></a><span id="l16.11">   nsAutoCString dsUri(m_dsName);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  dsUri.Append(&quot;:/&quot;);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  dsUri.AppendLiteral(&quot;:/&quot;);</span>
<a href="#l16.14"></a><span id="l16.14">   rdf-&gt;GetResource(dsUri, getter_AddRefs(m_rootResource));</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">   return nsMsgFolderDataSource::Init();</span>
<a href="#l16.17"></a><span id="l16.17"> }</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> void nsMsgFlatFolderDataSource::Cleanup()</span>
<a href="#l16.20"></a><span id="l16.20"> {</span>
<a href="#l16.21"></a><span id="l16.21">   m_folders.Clear();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -136,17 +136,17 @@ nsMsgPrintEngine::OnStateChange(nsIWebPr</span>
<a href="#l17.4"></a><span id="l17.4">           // Make sure this isn't just &quot;about:blank&quot; finishing....</span>
<a href="#l17.5"></a><span id="l17.5">           nsCOMPtr&lt;nsIURI&gt; originalURI = nullptr;</span>
<a href="#l17.6"></a><span id="l17.6">           if (NS_SUCCEEDED(aChannel-&gt;GetOriginalURI(getter_AddRefs(originalURI))) &amp;&amp; originalURI)</span>
<a href="#l17.7"></a><span id="l17.7">           {</span>
<a href="#l17.8"></a><span id="l17.8">             nsAutoCString spec;</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">             if (NS_SUCCEEDED(originalURI-&gt;GetSpec(spec)))</span>
<a href="#l17.11"></a><span id="l17.11">             {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-              if (spec.Equals(&quot;about:blank&quot;))</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+              if (spec.EqualsLiteral(&quot;about:blank&quot;))</span>
<a href="#l17.14"></a><span id="l17.14">               {</span>
<a href="#l17.15"></a><span id="l17.15">                 return StartNextPrintOperation();</span>
<a href="#l17.16"></a><span id="l17.16">               }</span>
<a href="#l17.17"></a><span id="l17.17">             }</span>
<a href="#l17.18"></a><span id="l17.18">           }</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">           // If something bad happens here (menaing we can fire the PLEvent, highly unlikely)</span>
<a href="#l17.21"></a><span id="l17.21">           // we will still ask the msg to print, but if the user &quot;cancels&quot; out of the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -529,17 +529,17 @@ NS_IMETHODIMP nsSpamSettings::GetSpamFol</span>
<a href="#l18.4"></a><span id="l18.4">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l18.5"></a><span id="l18.5">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">   // see nsMsgFolder::SetPrettyName() for where the pretty name is set.</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">   // Check for an existing junk folder - this will do a case-insensitive</span>
<a href="#l18.10"></a><span id="l18.10">   // search by URI - if we find a junk folder, use its URI.</span>
<a href="#l18.11"></a><span id="l18.11">   nsCOMPtr&lt;nsIMsgFolder&gt; junkFolder;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  folderURI.Append(&quot;/Junk&quot;);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  folderURI.AppendLiteral(&quot;/Junk&quot;);</span>
<a href="#l18.14"></a><span id="l18.14">   if (NS_SUCCEEDED(server-&gt;GetMsgFolderFromURI(nullptr, folderURI,</span>
<a href="#l18.15"></a><span id="l18.15">                                                getter_AddRefs(junkFolder))) &amp;&amp;</span>
<a href="#l18.16"></a><span id="l18.16">       junkFolder)</span>
<a href="#l18.17"></a><span id="l18.17">     junkFolder-&gt;GetURI(folderURI);</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">   // XXX todo</span>
<a href="#l18.20"></a><span id="l18.20">   // better not to make base depend in imap</span>
<a href="#l18.21"></a><span id="l18.21">   // but doing it here, like in nsMsgCopy.cpp</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -578,17 +578,17 @@ NS_IMETHODIMP nsSpamSettings::SetServerF</span>
<a href="#l18.23"></a><span id="l18.23"> NS_IMETHODIMP nsSpamSettings::GetServerFilterFile(nsIFile ** aFile)</span>
<a href="#l18.24"></a><span id="l18.24"> {</span>
<a href="#l18.25"></a><span id="l18.25">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l18.26"></a><span id="l18.26">   if (!mServerFilterFile)</span>
<a href="#l18.27"></a><span id="l18.27">   {</span>
<a href="#l18.28"></a><span id="l18.28">     nsresult rv;</span>
<a href="#l18.29"></a><span id="l18.29">     nsAutoCString serverFilterFileName;</span>
<a href="#l18.30"></a><span id="l18.30">     GetServerFilterName(serverFilterFileName);</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    serverFilterFileName.Append(&quot;.sfd&quot;);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    serverFilterFileName.AppendLiteral(&quot;.sfd&quot;);</span>
<a href="#l18.33"></a><span id="l18.33"> </span>
<a href="#l18.34"></a><span id="l18.34">     nsCOMPtr&lt;nsIProperties&gt; dirSvc = do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l18.35"></a><span id="l18.35">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37">     // Walk through the list of isp directories</span>
<a href="#l18.38"></a><span id="l18.38">     nsCOMPtr&lt;nsISimpleEnumerator&gt; ispDirectories;</span>
<a href="#l18.39"></a><span id="l18.39">     rv = dirSvc-&gt;Get(ISP_DIRECTORY_LIST, NS_GET_IID(nsISimpleEnumerator), getter_AddRefs(ispDirectories));</span>
<a href="#l18.40"></a><span id="l18.40">     NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1774,21 +1774,21 @@ nsresult nsMsgDBFolder::EndNewOfflineMes</span>
<a href="#l19.4"></a><span id="l19.4">          // this closes the stream</span>
<a href="#l19.5"></a><span id="l19.5">          msgStore-&gt;DiscardNewMessage(m_tempMessageStream, m_offlineHeader);</span>
<a href="#l19.6"></a><span id="l19.6">        else</span>
<a href="#l19.7"></a><span id="l19.7">          m_tempMessageStream-&gt;Close();</span>
<a href="#l19.8"></a><span id="l19.8">        m_tempMessageStream = nullptr;</span>
<a href="#l19.9"></a><span id="l19.9"> #ifdef _DEBUG</span>
<a href="#l19.10"></a><span id="l19.10">        nsAutoCString message(&quot;Offline message too small: messageSize=&quot;);</span>
<a href="#l19.11"></a><span id="l19.11">        message.AppendInt(messageSize);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-       message.Append(&quot; curStorePos=&quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+       message.AppendLiteral(&quot; curStorePos=&quot;);</span>
<a href="#l19.14"></a><span id="l19.14">        message.AppendInt(curStorePos);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-       message.Append(&quot; numOfflineMsgLines=&quot;);</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+       message.AppendLiteral(&quot; numOfflineMsgLines=&quot;);</span>
<a href="#l19.17"></a><span id="l19.17">        message.AppendInt(m_numOfflineMsgLines);</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-       message.Append(&quot; bytesAdded=&quot;);</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+       message.AppendLiteral(&quot; bytesAdded=&quot;);</span>
<a href="#l19.20"></a><span id="l19.20">        message.AppendInt(m_bytesAddedToLocalMsg);</span>
<a href="#l19.21"></a><span id="l19.21">        NS_ERROR(message.get());</span>
<a href="#l19.22"></a><span id="l19.22"> #endif</span>
<a href="#l19.23"></a><span id="l19.23">        m_offlineHeader = nullptr;</span>
<a href="#l19.24"></a><span id="l19.24">        return NS_ERROR_FAILURE;</span>
<a href="#l19.25"></a><span id="l19.25">     }</span>
<a href="#l19.26"></a><span id="l19.26">     else</span>
<a href="#l19.27"></a><span id="l19.27">       m_offlineHeader-&gt;SetLineCount(m_numOfflineMsgLines);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -135,34 +135,34 @@ const char * nsMsgI18NFileSystemCharset(</span>
<a href="#l20.4"></a><span id="l20.4">     nsresult rv;</span>
<a href="#l20.5"></a><span id="l20.5">     nsCOMPtr &lt;nsIPlatformCharset&gt; platformCharset = do_GetService(NS_PLATFORMCHARSET_CONTRACTID, &amp;rv);</span>
<a href="#l20.6"></a><span id="l20.6">         if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.7"></a><span id="l20.7">           rv = platformCharset-&gt;GetCharset(kPlatformCharsetSel_FileName,</span>
<a href="#l20.8"></a><span id="l20.8">                                            fileSystemCharset);</span>
<a href="#l20.9"></a><span id="l20.9">         }</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">     if (NS_FAILED(rv))</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      fileSystemCharset.Assign(&quot;ISO-8859-1&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      fileSystemCharset.AssignLiteral(&quot;ISO-8859-1&quot;);</span>
<a href="#l20.14"></a><span id="l20.14">   }</span>
<a href="#l20.15"></a><span id="l20.15">   return fileSystemCharset.get();</span>
<a href="#l20.16"></a><span id="l20.16"> }</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18"> // Charset used by the text file.</span>
<a href="#l20.19"></a><span id="l20.19"> void nsMsgI18NTextFileCharset(nsACString&amp; aCharset)</span>
<a href="#l20.20"></a><span id="l20.20"> {</span>
<a href="#l20.21"></a><span id="l20.21">   nsresult rv;</span>
<a href="#l20.22"></a><span id="l20.22">   nsCOMPtr &lt;nsIPlatformCharset&gt; platformCharset =</span>
<a href="#l20.23"></a><span id="l20.23">     do_GetService(NS_PLATFORMCHARSET_CONTRACTID, &amp;rv);</span>
<a href="#l20.24"></a><span id="l20.24">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.25"></a><span id="l20.25">     rv = platformCharset-&gt;GetCharset(kPlatformCharsetSel_PlainTextInFile,</span>
<a href="#l20.26"></a><span id="l20.26">                                      aCharset);</span>
<a href="#l20.27"></a><span id="l20.27">   }</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">   if (NS_FAILED(rv))</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-    aCharset.Assign(&quot;ISO-8859-1&quot;);</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+    aCharset.AssignLiteral(&quot;ISO-8859-1&quot;);</span>
<a href="#l20.32"></a><span id="l20.32"> }</span>
<a href="#l20.33"></a><span id="l20.33"> </span>
<a href="#l20.34"></a><span id="l20.34"> // MIME encoder, output string should be freed by PR_FREE</span>
<a href="#l20.35"></a><span id="l20.35"> // XXX : fix callers later to avoid allocation and copy</span>
<a href="#l20.36"></a><span id="l20.36"> char * nsMsgI18NEncodeMimePartIIStr(const char *header, bool structured, const char *charset, int32_t fieldnamelen, bool usemime)</span>
<a href="#l20.37"></a><span id="l20.37"> {</span>
<a href="#l20.38"></a><span id="l20.38">   // No MIME, convert to the outgoing mail charset.</span>
<a href="#l20.39"></a><span id="l20.39">   if (false == usemime) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -942,17 +942,17 @@ nsMsgIncomingServer::GetMsgStore(nsIMsgP</span>
<a href="#l21.4"></a><span id="l21.4">     // We don't want there to be a default pref, I think, since</span>
<a href="#l21.5"></a><span id="l21.5">     // we can't change the default. We may want no pref to mean</span>
<a href="#l21.6"></a><span id="l21.6">     // berkeley store, and then set the store pref off of some sort</span>
<a href="#l21.7"></a><span id="l21.7">     // of default when creating a server. But we need to make sure</span>
<a href="#l21.8"></a><span id="l21.8">     // that we do always write a store pref.</span>
<a href="#l21.9"></a><span id="l21.9">     GetCharValue(&quot;storeContractID&quot;, storeContractID);</span>
<a href="#l21.10"></a><span id="l21.10">     if (storeContractID.IsEmpty())</span>
<a href="#l21.11"></a><span id="l21.11">     {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      storeContractID.Assign(&quot;@mozilla.org/msgstore/berkeleystore;1&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+      storeContractID.AssignLiteral(&quot;@mozilla.org/msgstore/berkeleystore;1&quot;);</span>
<a href="#l21.14"></a><span id="l21.14">       SetCharValue(&quot;storeContractID&quot;, storeContractID);</span>
<a href="#l21.15"></a><span id="l21.15">     }</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">     // After someone starts using the pluggable store, we can no longer</span>
<a href="#l21.18"></a><span id="l21.18">     // change the value.</span>
<a href="#l21.19"></a><span id="l21.19">     SetBoolValue(&quot;canChangeStoreType&quot;, false);</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21">     // Right now, we just have one pluggable store per server. If we want</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -209,20 +209,20 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetServe</span>
<a href="#l22.4"></a><span id="l22.4">   rv = m_baseURL-&gt;GetSpec(urlstr);</span>
<a href="#l22.5"></a><span id="l22.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.6"></a><span id="l22.6">   rv = url-&gt;SetSpec(urlstr);</span>
<a href="#l22.7"></a><span id="l22.7">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l22.8"></a><span id="l22.8">   rv = GetScheme(scheme);</span>
<a href="#l22.9"></a><span id="l22.9">     if (NS_SUCCEEDED(rv))</span>
<a href="#l22.10"></a><span id="l22.10">     {</span>
<a href="#l22.11"></a><span id="l22.11">         if (scheme.EqualsLiteral(&quot;pop&quot;))</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-          scheme.Assign(&quot;pop3&quot;);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+          scheme.AssignLiteral(&quot;pop3&quot;);</span>
<a href="#l22.14"></a><span id="l22.14">         // we use &quot;nntp&quot; in the server list so translate it here.</span>
<a href="#l22.15"></a><span id="l22.15">         if (scheme.EqualsLiteral(&quot;news&quot;))</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-          scheme.Assign(&quot;nntp&quot;);</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+          scheme.AssignLiteral(&quot;nntp&quot;);</span>
<a href="#l22.18"></a><span id="l22.18">         url-&gt;SetScheme(scheme);</span>
<a href="#l22.19"></a><span id="l22.19">         nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l22.20"></a><span id="l22.20">                  do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l22.21"></a><span id="l22.21">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l22.22"></a><span id="l22.22"> </span>
<a href="#l22.23"></a><span id="l22.23">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l22.24"></a><span id="l22.24">         rv = accountManager-&gt;FindServerByURI(url, false,</span>
<a href="#l22.25"></a><span id="l22.25">                                         aIncomingServer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -99,17 +99,17 @@ nsMsgProtocol::GetQoSBits(uint8_t *aQoSB</span>
<a href="#l23.4"></a><span id="l23.4">   NS_ENSURE_ARG_POINTER(aQoSBits);</span>
<a href="#l23.5"></a><span id="l23.5">   const char* protocol = GetType();</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">   if (!protocol)</span>
<a href="#l23.8"></a><span id="l23.8">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10">   nsAutoCString prefName(&quot;mail.&quot;);</span>
<a href="#l23.11"></a><span id="l23.11">   prefName.Append(protocol);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  prefName.Append(&quot;.qos&quot;);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  prefName.AppendLiteral(&quot;.qos&quot;);</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15">   nsresult rv;</span>
<a href="#l23.16"></a><span id="l23.16">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l23.17"></a><span id="l23.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">   int32_t val;</span>
<a href="#l23.20"></a><span id="l23.20">   rv = prefBranch-&gt;GetIntPref(prefName.get(), &amp;val);</span>
<a href="#l23.21"></a><span id="l23.21">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -129,18 +129,18 @@ nsresult GetMessageServiceContractIDForU</span>
<a href="#l24.4"></a><span id="l24.4">   //Find protocol</span>
<a href="#l24.5"></a><span id="l24.5">   nsAutoCString uriStr(uri);</span>
<a href="#l24.6"></a><span id="l24.6">   int32_t pos = uriStr.FindChar(':');</span>
<a href="#l24.7"></a><span id="l24.7">   if (pos == -1)</span>
<a href="#l24.8"></a><span id="l24.8">     return NS_ERROR_FAILURE;</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">   nsAutoCString protocol(StringHead(uriStr, pos));</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  if (protocol.Equals(&quot;file&quot;) &amp;&amp; uriStr.Find(&quot;application/x-message-display&quot;) != -1)</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-    protocol.Assign(&quot;mailbox&quot;);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+  if (protocol.EqualsLiteral(&quot;file&quot;) &amp;&amp; uriStr.Find(&quot;application/x-message-display&quot;) != -1)</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+    protocol.AssignLiteral(&quot;mailbox&quot;);</span>
<a href="#l24.16"></a><span id="l24.16">   //Build message service contractid</span>
<a href="#l24.17"></a><span id="l24.17">   contractID = &quot;@mozilla.org/messenger/messageservice;1?type=&quot;;</span>
<a href="#l24.18"></a><span id="l24.18">   contractID += protocol.get();</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">   return rv;</span>
<a href="#l24.21"></a><span id="l24.21"> }</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23"> nsresult GetMessageServiceFromURI(const nsACString&amp; uri, nsIMsgMessageService **aMessageService)</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineat">@@ -1379,35 +1379,35 @@ nsresult GetSpecialDirectoryWithFileName</span>
<a href="#l24.25"></a><span id="l24.25">   return (*result)-&gt;AppendNative(nsDependentCString(fileName));</span>
<a href="#l24.26"></a><span id="l24.26"> }</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28"> // Cleans up temp files with matching names</span>
<a href="#l24.29"></a><span id="l24.29"> nsresult MsgCleanupTempFiles(const char *fileName, const char *extension)</span>
<a href="#l24.30"></a><span id="l24.30"> {</span>
<a href="#l24.31"></a><span id="l24.31">   nsCOMPtr&lt;nsIFile&gt; tmpFile;</span>
<a href="#l24.32"></a><span id="l24.32">   nsCString rootName(fileName);</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-  rootName.Append(&quot;.&quot;);</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+  rootName.Append('.');</span>
<a href="#l24.35"></a><span id="l24.35">   rootName.Append(extension);</span>
<a href="#l24.36"></a><span id="l24.36">   nsresult rv = GetSpecialDirectoryWithFileName(NS_OS_TEMP_DIR,</span>
<a href="#l24.37"></a><span id="l24.37">                                                 rootName.get(),</span>
<a href="#l24.38"></a><span id="l24.38">                                                 getter_AddRefs(tmpFile));</span>
<a href="#l24.39"></a><span id="l24.39"> </span>
<a href="#l24.40"></a><span id="l24.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.41"></a><span id="l24.41">   int index = 1;</span>
<a href="#l24.42"></a><span id="l24.42">   bool exists;</span>
<a href="#l24.43"></a><span id="l24.43">   do</span>
<a href="#l24.44"></a><span id="l24.44">   {</span>
<a href="#l24.45"></a><span id="l24.45">     tmpFile-&gt;Exists(&amp;exists);</span>
<a href="#l24.46"></a><span id="l24.46">     if (exists)</span>
<a href="#l24.47"></a><span id="l24.47">     {</span>
<a href="#l24.48"></a><span id="l24.48">       tmpFile-&gt;Remove(false);</span>
<a href="#l24.49"></a><span id="l24.49">       nsCString leafName(fileName);</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-      leafName.Append(&quot;-&quot;);</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+      leafName.Append('-');</span>
<a href="#l24.52"></a><span id="l24.52">       leafName.AppendInt(index);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-      leafName.Append(&quot;.&quot;);</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+      leafName.Append('.');</span>
<a href="#l24.55"></a><span id="l24.55">       leafName.Append(extension);</span>
<a href="#l24.56"></a><span id="l24.56">         // start with &quot;Picture-1.jpg&quot; after &quot;Picture.jpg&quot; exists</span>
<a href="#l24.57"></a><span id="l24.57">       tmpFile-&gt;SetNativeLeafName(leafName);</span>
<a href="#l24.58"></a><span id="l24.58">     }</span>
<a href="#l24.59"></a><span id="l24.59">   }</span>
<a href="#l24.60"></a><span id="l24.60">   while (exists &amp;&amp; ++index &lt; 10000);</span>
<a href="#l24.61"></a><span id="l24.61">   return NS_OK;</span>
<a href="#l24.62"></a><span id="l24.62"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -616,17 +616,17 @@ nsMsgAttachmentHandler::SnarfMsgAttachme</span>
<a href="#l25.4"></a><span id="l25.4">     }</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">     rv = fetcher-&gt;Initialize(mTmpFile, mOutFile, FetcherURLDoneCallback, this);</span>
<a href="#l25.7"></a><span id="l25.7">     rv = GetMessageServiceFromURI(m_uri, getter_AddRefs(messageService));</span>
<a href="#l25.8"></a><span id="l25.8">     if (NS_SUCCEEDED(rv) &amp;&amp; messageService)</span>
<a href="#l25.9"></a><span id="l25.9">     {</span>
<a href="#l25.10"></a><span id="l25.10">       nsAutoCString uri(m_uri);</span>
<a href="#l25.11"></a><span id="l25.11">       uri += (uri.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-      uri.Append(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+      uri.AppendLiteral(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l25.14"></a><span id="l25.14">       nsCOMPtr&lt;nsIStreamListener&gt; strListener = do_QueryInterface(fetcher);</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">       // initialize a new stream converter, that uses the strListener as its input</span>
<a href="#l25.17"></a><span id="l25.17">       // obtain the input stream listener from the new converter,</span>
<a href="#l25.18"></a><span id="l25.18">       // and pass the converter's input stream listener to DisplayMessage</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20">       m_mime_parser = do_CreateInstance(NS_MAILNEWS_MIME_STREAM_CONVERTER_CONTRACTID, &amp;rv);</span>
<a href="#l25.21"></a><span id="l25.21">       if (NS_FAILED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -607,38 +607,38 @@ mime_generate_attachment_headers (const </span>
<a href="#l26.4"></a><span id="l26.4">     CopyUTF8toUTF16(nsDependentCString(real_name), realName);</span>
<a href="#l26.5"></a><span id="l26.5">     if (bodyCharset &amp;&amp; *bodyCharset &amp;&amp;</span>
<a href="#l26.6"></a><span id="l26.6">         nsMsgI18Ncheck_data_in_charset_range(bodyCharset, realName.get()))</span>
<a href="#l26.7"></a><span id="l26.7">       charset.Assign(bodyCharset);</span>
<a href="#l26.8"></a><span id="l26.8">     else</span>
<a href="#l26.9"></a><span id="l26.9">     {</span>
<a href="#l26.10"></a><span id="l26.10">       charset.Assign(nsMsgI18NFileSystemCharset());</span>
<a href="#l26.11"></a><span id="l26.11">       if (!nsMsgI18Ncheck_data_in_charset_range(charset.get(), realName.get()))</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        charset.Assign(&quot;UTF-8&quot;); // set to UTF-8 if fails again</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+        charset.AssignLiteral(&quot;UTF-8&quot;); // set to UTF-8 if fails again</span>
<a href="#l26.14"></a><span id="l26.14">     }</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16">     encodedRealName = RFC2231ParmFolding(&quot;filename&quot;, charset, nullptr,</span>
<a href="#l26.17"></a><span id="l26.17">                                          realName);</span>
<a href="#l26.18"></a><span id="l26.18">     // somehow RFC2231ParamFolding failed. fall back to legacy method</span>
<a href="#l26.19"></a><span id="l26.19">     if (!encodedRealName || !*encodedRealName) {</span>
<a href="#l26.20"></a><span id="l26.20">       PR_FREEIF(encodedRealName);</span>
<a href="#l26.21"></a><span id="l26.21">       parmFolding = 0;</span>
<a href="#l26.22"></a><span id="l26.22">       // Not RFC 2231 style encoding (it's not standard-compliant)</span>
<a href="#l26.23"></a><span id="l26.23">       encodedRealName =</span>
<a href="#l26.24"></a><span id="l26.24">         LegacyParmFolding(charset, nsDependentCString(real_name), parmFolding);</span>
<a href="#l26.25"></a><span id="l26.25">     }</span>
<a href="#l26.26"></a><span id="l26.26">   }</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28">   nsCString buf;  // very likely to be longer than 64 characters</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-  buf.Append(&quot;Content-Type: &quot;);</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+  buf.AppendLiteral(&quot;Content-Type: &quot;);</span>
<a href="#l26.31"></a><span id="l26.31">   buf.Append(type);</span>
<a href="#l26.32"></a><span id="l26.32">   if (type_param &amp;&amp; *type_param)</span>
<a href="#l26.33"></a><span id="l26.33">   {</span>
<a href="#l26.34"></a><span id="l26.34">     if (*type_param != ';')</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-      buf.Append(&quot;; &quot;);</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+      buf.AppendLiteral(&quot;; &quot;);</span>
<a href="#l26.37"></a><span id="l26.37">     buf.Append(type_param);</span>
<a href="#l26.38"></a><span id="l26.38">   }</span>
<a href="#l26.39"></a><span id="l26.39"> </span>
<a href="#l26.40"></a><span id="l26.40">   if (mime_type_needs_charset (type))</span>
<a href="#l26.41"></a><span id="l26.41">   {</span>
<a href="#l26.42"></a><span id="l26.42"> </span>
<a href="#l26.43"></a><span id="l26.43">     char charset_label[65] = &quot;&quot;;   // Content-Type: charset</span>
<a href="#l26.44"></a><span id="l26.44">     if (attachmentCharset)</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineat">@@ -675,143 +675,143 @@ mime_generate_attachment_headers (const </span>
<a href="#l26.46"></a><span id="l26.46">          (PL_strcasecmp(type, TEXT_ENRICHED) == 0) ||</span>
<a href="#l26.47"></a><span id="l26.47">          (PL_strcasecmp(type, TEXT_VCARD) == 0) ||</span>
<a href="#l26.48"></a><span id="l26.48">          (PL_strcasecmp(type, APPLICATION_DIRECTORY) == 0) || /* text/x-vcard synonym */</span>
<a href="#l26.49"></a><span id="l26.49">          (PL_strcasecmp(type, TEXT_CSS) == 0) ||</span>
<a href="#l26.50"></a><span id="l26.50">          (PL_strcasecmp(type, TEXT_JSSS) == 0)) ||</span>
<a href="#l26.51"></a><span id="l26.51">          (PL_strcasecmp(encoding, ENCODING_BASE64) != 0)) &amp;&amp;</span>
<a href="#l26.52"></a><span id="l26.52">          (*charset_label))</span>
<a href="#l26.53"></a><span id="l26.53">     {</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineminus">-      buf.Append(&quot;; charset=&quot;);</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineplus">+      buf.AppendLiteral(&quot;; charset=&quot;);</span>
<a href="#l26.56"></a><span id="l26.56">       buf.Append(charset_label);</span>
<a href="#l26.57"></a><span id="l26.57">     }</span>
<a href="#l26.58"></a><span id="l26.58">   }</span>
<a href="#l26.59"></a><span id="l26.59"> </span>
<a href="#l26.60"></a><span id="l26.60">   // Only do this if we are in the body of a message</span>
<a href="#l26.61"></a><span id="l26.61">   if (aBodyDocument)</span>
<a href="#l26.62"></a><span id="l26.62">   {</span>
<a href="#l26.63"></a><span id="l26.63">     // Add format=flowed as in RFC 2646 if we are using that</span>
<a href="#l26.64"></a><span id="l26.64">     if(type &amp;&amp; !PL_strcasecmp(type, &quot;text/plain&quot;))</span>
<a href="#l26.65"></a><span id="l26.65">     {</span>
<a href="#l26.66"></a><span id="l26.66">       bool flowed, delsp, formatted, disallowBreaks;</span>
<a href="#l26.67"></a><span id="l26.67">       GetSerialiserFlags(bodyCharset, &amp;flowed, &amp;delsp, &amp;formatted, &amp;disallowBreaks);</span>
<a href="#l26.68"></a><span id="l26.68">       if(flowed)</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-        buf.Append(&quot;; format=flowed&quot;);</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+        buf.AppendLiteral(&quot;; format=flowed&quot;);</span>
<a href="#l26.71"></a><span id="l26.71">       if (delsp)</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineminus">-        buf.Append(&quot;; delsp=yes&quot;);</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+        buf.AppendLiteral(&quot;; delsp=yes&quot;);</span>
<a href="#l26.74"></a><span id="l26.74">       // else</span>
<a href="#l26.75"></a><span id="l26.75">       // {</span>
<a href="#l26.76"></a><span id="l26.76">       // Don't add a markup. Could use</span>
<a href="#l26.77"></a><span id="l26.77">       //        PUSH_STRING (&quot;; format=fixed&quot;);</span>
<a href="#l26.78"></a><span id="l26.78">       // but it is equivalent to nothing at all and we do want</span>
<a href="#l26.79"></a><span id="l26.79">       // to save bandwidth. Don't we?</span>
<a href="#l26.80"></a><span id="l26.80">       // }</span>
<a href="#l26.81"></a><span id="l26.81">     }</span>
<a href="#l26.82"></a><span id="l26.82">   }</span>
<a href="#l26.83"></a><span id="l26.83"> </span>
<a href="#l26.84"></a><span id="l26.84">   if (x_mac_type &amp;&amp; *x_mac_type) {</span>
<a href="#l26.85"></a><span id="l26.85" class="difflineminus">-    buf.Append(&quot;; x-mac-type=\&quot;&quot;);</span>
<a href="#l26.86"></a><span id="l26.86" class="difflineplus">+    buf.AppendLiteral(&quot;; x-mac-type=\&quot;&quot;);</span>
<a href="#l26.87"></a><span id="l26.87">     buf.Append(x_mac_type);</span>
<a href="#l26.88"></a><span id="l26.88" class="difflineminus">-    buf.Append(&quot;\&quot;&quot;);</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineplus">+    buf.Append('&quot;');</span>
<a href="#l26.90"></a><span id="l26.90">   }</span>
<a href="#l26.91"></a><span id="l26.91"> </span>
<a href="#l26.92"></a><span id="l26.92">   if (x_mac_creator &amp;&amp; *x_mac_creator) {</span>
<a href="#l26.93"></a><span id="l26.93" class="difflineminus">-    buf.Append(&quot;; x-mac-creator=\&quot;&quot;);</span>
<a href="#l26.94"></a><span id="l26.94" class="difflineplus">+    buf.AppendLiteral(&quot;; x-mac-creator=\&quot;&quot;);</span>
<a href="#l26.95"></a><span id="l26.95">     buf.Append(x_mac_creator);</span>
<a href="#l26.96"></a><span id="l26.96" class="difflineminus">-    buf.Append(&quot;\&quot;&quot;);</span>
<a href="#l26.97"></a><span id="l26.97" class="difflineplus">+    buf.Append('&quot;');</span>
<a href="#l26.98"></a><span id="l26.98">   }</span>
<a href="#l26.99"></a><span id="l26.99"> </span>
<a href="#l26.100"></a><span id="l26.100"> #ifdef EMIT_NAME_IN_CONTENT_TYPE</span>
<a href="#l26.101"></a><span id="l26.101">   if (encodedRealName &amp;&amp; *encodedRealName) {</span>
<a href="#l26.102"></a><span id="l26.102">     // Note that we don't need to output the name field if the name encoding is</span>
<a href="#l26.103"></a><span id="l26.103">     // RFC 2231. If the MUA knows the RFC 2231, it should know the RFC 2183 too.</span>
<a href="#l26.104"></a><span id="l26.104">     if (parmFolding != 2) {</span>
<a href="#l26.105"></a><span id="l26.105">       // The underlying JS MIME code will only handle UTF-8 here.</span>
<a href="#l26.106"></a><span id="l26.106">       char *nameValue = LegacyParmFolding(NS_LITERAL_CSTRING(&quot;UTF-8&quot;),</span>
<a href="#l26.107"></a><span id="l26.107">                                           nsDependentCString(real_name),</span>
<a href="#l26.108"></a><span id="l26.108">                                           parmFolding);</span>
<a href="#l26.109"></a><span id="l26.109">       if (!nameValue || !*nameValue) {</span>
<a href="#l26.110"></a><span id="l26.110">         PR_FREEIF(nameValue);</span>
<a href="#l26.111"></a><span id="l26.111">         nameValue = encodedRealName;</span>
<a href="#l26.112"></a><span id="l26.112">       }</span>
<a href="#l26.113"></a><span id="l26.113" class="difflineminus">-      buf.Append(&quot;;\r\n name=\&quot;&quot;);</span>
<a href="#l26.114"></a><span id="l26.114" class="difflineplus">+      buf.AppendLiteral(&quot;;\r\n name=\&quot;&quot;);</span>
<a href="#l26.115"></a><span id="l26.115">       buf.Append(nameValue);</span>
<a href="#l26.116"></a><span id="l26.116" class="difflineminus">-      buf.Append(&quot;\&quot;&quot;);</span>
<a href="#l26.117"></a><span id="l26.117" class="difflineplus">+      buf.Append('&quot;');</span>
<a href="#l26.118"></a><span id="l26.118">       if (nameValue != encodedRealName)</span>
<a href="#l26.119"></a><span id="l26.119">         PR_FREEIF(nameValue);</span>
<a href="#l26.120"></a><span id="l26.120">     }</span>
<a href="#l26.121"></a><span id="l26.121">   }</span>
<a href="#l26.122"></a><span id="l26.122"> #endif /* EMIT_NAME_IN_CONTENT_TYPE */</span>
<a href="#l26.123"></a><span id="l26.123">   buf.Append(CRLF);</span>
<a href="#l26.124"></a><span id="l26.124"> </span>
<a href="#l26.125"></a><span id="l26.125" class="difflineminus">-  buf.Append(&quot;Content-Transfer-Encoding: &quot;);</span>
<a href="#l26.126"></a><span id="l26.126" class="difflineplus">+  buf.AppendLiteral(&quot;Content-Transfer-Encoding: &quot;);</span>
<a href="#l26.127"></a><span id="l26.127">   buf.Append(encoding);</span>
<a href="#l26.128"></a><span id="l26.128">   buf.Append(CRLF);</span>
<a href="#l26.129"></a><span id="l26.129"> </span>
<a href="#l26.130"></a><span id="l26.130">   if (description &amp;&amp; *description) {</span>
<a href="#l26.131"></a><span id="l26.131">     char *s = mime_fix_header (description);</span>
<a href="#l26.132"></a><span id="l26.132">     if (s) {</span>
<a href="#l26.133"></a><span id="l26.133" class="difflineminus">-      buf.Append(&quot;Content-Description: &quot;);</span>
<a href="#l26.134"></a><span id="l26.134" class="difflineplus">+      buf.AppendLiteral(&quot;Content-Description: &quot;);</span>
<a href="#l26.135"></a><span id="l26.135">       buf.Append(s);</span>
<a href="#l26.136"></a><span id="l26.136">       buf.Append(CRLF);</span>
<a href="#l26.137"></a><span id="l26.137">       PR_Free(s);</span>
<a href="#l26.138"></a><span id="l26.138">     }</span>
<a href="#l26.139"></a><span id="l26.139">   }</span>
<a href="#l26.140"></a><span id="l26.140"> </span>
<a href="#l26.141"></a><span id="l26.141">   if ( (content_id) &amp;&amp; (*content_id) )</span>
<a href="#l26.142"></a><span id="l26.142">   {</span>
<a href="#l26.143"></a><span id="l26.143" class="difflineminus">-    buf.Append(&quot;Content-ID: &lt;&quot;);</span>
<a href="#l26.144"></a><span id="l26.144" class="difflineplus">+    buf.AppendLiteral(&quot;Content-ID: &lt;&quot;);</span>
<a href="#l26.145"></a><span id="l26.145">     buf.Append(content_id);</span>
<a href="#l26.146"></a><span id="l26.146" class="difflineminus">-    buf.Append(&quot;&gt;&quot;);</span>
<a href="#l26.147"></a><span id="l26.147" class="difflineplus">+    buf.Append('&gt;');</span>
<a href="#l26.148"></a><span id="l26.148">     buf.Append(CRLF);</span>
<a href="#l26.149"></a><span id="l26.149">   }</span>
<a href="#l26.150"></a><span id="l26.150"> </span>
<a href="#l26.151"></a><span id="l26.151">   if (encodedRealName &amp;&amp; *encodedRealName) {</span>
<a href="#l26.152"></a><span id="l26.152">     char *period = PL_strrchr(encodedRealName, '.');</span>
<a href="#l26.153"></a><span id="l26.153">     int32_t pref_content_disposition = 0;</span>
<a href="#l26.154"></a><span id="l26.154"> </span>
<a href="#l26.155"></a><span id="l26.155">     if (prefs) {</span>
<a href="#l26.156"></a><span id="l26.156">       mozilla::DebugOnly&lt;nsresult&gt; rv = prefs-&gt;GetIntPref(&quot;mail.content_disposition_type&quot;,</span>
<a href="#l26.157"></a><span id="l26.157">                                                           &amp;pref_content_disposition);</span>
<a href="#l26.158"></a><span id="l26.158">       NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to get mail.content_disposition_type&quot;);</span>
<a href="#l26.159"></a><span id="l26.159">     }</span>
<a href="#l26.160"></a><span id="l26.160"> </span>
<a href="#l26.161"></a><span id="l26.161" class="difflineminus">-    buf.Append(&quot;Content-Disposition: &quot;);</span>
<a href="#l26.162"></a><span id="l26.162" class="difflineplus">+    buf.AppendLiteral(&quot;Content-Disposition: &quot;);</span>
<a href="#l26.163"></a><span id="l26.163"> </span>
<a href="#l26.164"></a><span id="l26.164">     // If this is an attachment which is part of the message body and therefore has a</span>
<a href="#l26.165"></a><span id="l26.165">     // Content-ID (e.g, image in HTML msg), then Content-Disposition has to be inline</span>
<a href="#l26.166"></a><span id="l26.166">     if (content_id &amp;&amp; *content_id)</span>
<a href="#l26.167"></a><span id="l26.167" class="difflineminus">-      buf.Append(&quot;inline&quot;);</span>
<a href="#l26.168"></a><span id="l26.168" class="difflineplus">+      buf.AppendLiteral(&quot;inline&quot;);</span>
<a href="#l26.169"></a><span id="l26.169">     else if (pref_content_disposition == 1)</span>
<a href="#l26.170"></a><span id="l26.170" class="difflineminus">-      buf.Append(&quot;attachment&quot;);</span>
<a href="#l26.171"></a><span id="l26.171" class="difflineplus">+      buf.AppendLiteral(&quot;attachment&quot;);</span>
<a href="#l26.172"></a><span id="l26.172">     else</span>
<a href="#l26.173"></a><span id="l26.173">       if (pref_content_disposition == 2 &amp;&amp;</span>
<a href="#l26.174"></a><span id="l26.174">           (!PL_strcasecmp(type, TEXT_PLAIN) ||</span>
<a href="#l26.175"></a><span id="l26.175">           (period &amp;&amp; !PL_strcasecmp(period, &quot;.txt&quot;))))</span>
<a href="#l26.176"></a><span id="l26.176" class="difflineminus">-        buf.Append(&quot;attachment&quot;);</span>
<a href="#l26.177"></a><span id="l26.177" class="difflineplus">+        buf.AppendLiteral(&quot;attachment&quot;);</span>
<a href="#l26.178"></a><span id="l26.178"> </span>
<a href="#l26.179"></a><span id="l26.179">       /* If this document is an anonymous binary file or a vcard,</span>
<a href="#l26.180"></a><span id="l26.180">       then always show it as an attachment, never inline. */</span>
<a href="#l26.181"></a><span id="l26.181">       else</span>
<a href="#l26.182"></a><span id="l26.182">         if (!PL_strcasecmp(type, APPLICATION_OCTET_STREAM) ||</span>
<a href="#l26.183"></a><span id="l26.183">             !PL_strcasecmp(type, TEXT_VCARD) ||</span>
<a href="#l26.184"></a><span id="l26.184">             !PL_strcasecmp(type, APPLICATION_DIRECTORY)) /* text/x-vcard synonym */</span>
<a href="#l26.185"></a><span id="l26.185" class="difflineminus">-          buf.Append(&quot;attachment&quot;);</span>
<a href="#l26.186"></a><span id="l26.186" class="difflineplus">+          buf.AppendLiteral(&quot;attachment&quot;);</span>
<a href="#l26.187"></a><span id="l26.187">         else</span>
<a href="#l26.188"></a><span id="l26.188" class="difflineminus">-          buf.Append(&quot;inline&quot;);</span>
<a href="#l26.189"></a><span id="l26.189" class="difflineplus">+          buf.AppendLiteral(&quot;inline&quot;);</span>
<a href="#l26.190"></a><span id="l26.190"> </span>
<a href="#l26.191"></a><span id="l26.191" class="difflineminus">-    buf.Append(&quot;;\r\n &quot;);</span>
<a href="#l26.192"></a><span id="l26.192" class="difflineplus">+    buf.AppendLiteral(&quot;;\r\n &quot;);</span>
<a href="#l26.193"></a><span id="l26.193">     buf.Append(encodedRealName);</span>
<a href="#l26.194"></a><span id="l26.194">     buf.Append(CRLF);</span>
<a href="#l26.195"></a><span id="l26.195">   }</span>
<a href="#l26.196"></a><span id="l26.196">   else</span>
<a href="#l26.197"></a><span id="l26.197">     if (type &amp;&amp;</span>
<a href="#l26.198"></a><span id="l26.198">         (!PL_strcasecmp (type, MESSAGE_RFC822) ||</span>
<a href="#l26.199"></a><span id="l26.199">         !PL_strcasecmp (type, MESSAGE_NEWS)))</span>
<a href="#l26.200"></a><span id="l26.200" class="difflineminus">-      buf.Append(&quot;Content-Disposition: inline&quot; CRLF);</span>
<a href="#l26.201"></a><span id="l26.201" class="difflineplus">+      buf.AppendLiteral(&quot;Content-Disposition: inline&quot; CRLF);</span>
<a href="#l26.202"></a><span id="l26.202"> </span>
<a href="#l26.203"></a><span id="l26.203"> #ifdef GENERATE_CONTENT_BASE</span>
<a href="#l26.204"></a><span id="l26.204">   /* If this is an HTML document, and we know the URL it originally</span>
<a href="#l26.205"></a><span id="l26.205">      came from, write out a Content-Base header. */</span>
<a href="#l26.206"></a><span id="l26.206">   if (type &amp;&amp;</span>
<a href="#l26.207"></a><span id="l26.207">       (!PL_strcasecmp (type, TEXT_HTML) ||</span>
<a href="#l26.208"></a><span id="l26.208">       !PL_strcasecmp (type, TEXT_MDL)) &amp;&amp;</span>
<a href="#l26.209"></a><span id="l26.209">       base_url &amp;&amp; *base_url)</span>
<a href="#l26.210"></a><span id="l26.210" class="difflineat">@@ -835,54 +835,54 @@ mime_generate_attachment_headers (const </span>
<a href="#l26.211"></a><span id="l26.211"> </span>
<a href="#l26.212"></a><span id="l26.212">     /* rhp - Put in a pref for using Content-Location instead of Content-Base.</span>
<a href="#l26.213"></a><span id="l26.213">            This will get tweaked to default to true in 5.0</span>
<a href="#l26.214"></a><span id="l26.214">     */</span>
<a href="#l26.215"></a><span id="l26.215">     if (prefs)</span>
<a href="#l26.216"></a><span id="l26.216">       prefs-&gt;GetBoolPref(&quot;mail.use_content_location_on_send&quot;, &amp;useContentLocation);</span>
<a href="#l26.217"></a><span id="l26.217"> </span>
<a href="#l26.218"></a><span id="l26.218">     if (useContentLocation)</span>
<a href="#l26.219"></a><span id="l26.219" class="difflineminus">-      buf.Append(&quot;Content-Location: \&quot;&quot;);</span>
<a href="#l26.220"></a><span id="l26.220" class="difflineplus">+      buf.AppendLiteral(&quot;Content-Location: \&quot;&quot;);</span>
<a href="#l26.221"></a><span id="l26.221">     else</span>
<a href="#l26.222"></a><span id="l26.222" class="difflineminus">-      buf.Append(&quot;Content-Base: \&quot;&quot;);</span>
<a href="#l26.223"></a><span id="l26.223" class="difflineplus">+      buf.AppendLiteral(&quot;Content-Base: \&quot;&quot;);</span>
<a href="#l26.224"></a><span id="l26.224">     /* rhp - Pref for Content-Location usage */</span>
<a href="#l26.225"></a><span id="l26.225"> </span>
<a href="#l26.226"></a><span id="l26.226"> /* rhp: this is to work with the Content-Location stuff */</span>
<a href="#l26.227"></a><span id="l26.227"> CONTENT_LOC_HACK:</span>
<a href="#l26.228"></a><span id="l26.228"> </span>
<a href="#l26.229"></a><span id="l26.229">     while (*s != 0 &amp;&amp; *s != '#')</span>
<a href="#l26.230"></a><span id="l26.230">     {</span>
<a href="#l26.231"></a><span id="l26.231">       uint32_t ot=buf.Length();</span>
<a href="#l26.232"></a><span id="l26.232">       char tmp[]=&quot;\x00\x00&quot;;</span>
<a href="#l26.233"></a><span id="l26.233">       /* URLs must be wrapped at 40 characters or less. */</span>
<a href="#l26.234"></a><span id="l26.234">       if (col &gt;= 38) {</span>
<a href="#l26.235"></a><span id="l26.235">         buf.Append(CRLF &quot;\t&quot;);</span>
<a href="#l26.236"></a><span id="l26.236">         col = 0;</span>
<a href="#l26.237"></a><span id="l26.237">       }</span>
<a href="#l26.238"></a><span id="l26.238"> </span>
<a href="#l26.239"></a><span id="l26.239">       if (*s == ' ')</span>
<a href="#l26.240"></a><span id="l26.240" class="difflineminus">-        buf.Append(&quot;%20&quot;);</span>
<a href="#l26.241"></a><span id="l26.241" class="difflineplus">+        buf.AppendLiteral(&quot;%20&quot;);</span>
<a href="#l26.242"></a><span id="l26.242">       else if (*s == '\t')</span>
<a href="#l26.243"></a><span id="l26.243" class="difflineminus">-        buf.Append(&quot;%09&quot;);</span>
<a href="#l26.244"></a><span id="l26.244" class="difflineplus">+        buf.AppendLiteral(&quot;%09&quot;);</span>
<a href="#l26.245"></a><span id="l26.245">       else if (*s == '\n')</span>
<a href="#l26.246"></a><span id="l26.246" class="difflineminus">-        buf.Append(&quot;%0A&quot;);</span>
<a href="#l26.247"></a><span id="l26.247" class="difflineplus">+        buf.AppendLiteral(&quot;%0A&quot;);</span>
<a href="#l26.248"></a><span id="l26.248">       else if (*s == '\r')</span>
<a href="#l26.249"></a><span id="l26.249" class="difflineminus">-        buf.Append(&quot;%0D&quot;);</span>
<a href="#l26.250"></a><span id="l26.250" class="difflineplus">+        buf.AppendLiteral(&quot;%0D&quot;);</span>
<a href="#l26.251"></a><span id="l26.251">       else {</span>
<a href="#l26.252"></a><span id="l26.252"> 	      tmp[0]=*s;</span>
<a href="#l26.253"></a><span id="l26.253"> 	      buf.Append(tmp);</span>
<a href="#l26.254"></a><span id="l26.254">       }</span>
<a href="#l26.255"></a><span id="l26.255">       s++;</span>
<a href="#l26.256"></a><span id="l26.256">       col += (buf.Length() - ot);</span>
<a href="#l26.257"></a><span id="l26.257">     }</span>
<a href="#l26.258"></a><span id="l26.258" class="difflineminus">-    buf.Append(&quot;\&quot;&quot; CRLF);</span>
<a href="#l26.259"></a><span id="l26.259" class="difflineplus">+    buf.AppendLiteral(&quot;\&quot;&quot; CRLF);</span>
<a href="#l26.260"></a><span id="l26.260"> </span>
<a href="#l26.261"></a><span id="l26.261">     /* rhp: this is to try to get around this fun problem with Content-Location */</span>
<a href="#l26.262"></a><span id="l26.262">     if (!useContentLocation) {</span>
<a href="#l26.263"></a><span id="l26.263" class="difflineminus">-      buf.Append(&quot;Content-Location: \&quot;&quot;);</span>
<a href="#l26.264"></a><span id="l26.264" class="difflineplus">+      buf.AppendLiteral(&quot;Content-Location: \&quot;&quot;);</span>
<a href="#l26.265"></a><span id="l26.265">       s = base_url;</span>
<a href="#l26.266"></a><span id="l26.266">       col = 0;</span>
<a href="#l26.267"></a><span id="l26.267">       useContentLocation = true;</span>
<a href="#l26.268"></a><span id="l26.268">       goto CONTENT_LOC_HACK;</span>
<a href="#l26.269"></a><span id="l26.269">     }</span>
<a href="#l26.270"></a><span id="l26.270">     /* rhp: this is to try to get around this fun problem with Content-Location */</span>
<a href="#l26.271"></a><span id="l26.271"> </span>
<a href="#l26.272"></a><span id="l26.272"> GIVE_UP_ON_CONTENT_BASE:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1784,17 +1784,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l27.4"></a><span id="l27.4">       // Remove possible trailing '?'.</span>
<a href="#l27.5"></a><span id="l27.5">       if (msgUri.CharAt(msgUri.Length() - 1) == '?')</span>
<a href="#l27.6"></a><span id="l27.6">         msgUri.Cut(msgUri.Length() - 1, 1);</span>
<a href="#l27.7"></a><span id="l27.7">     }</span>
<a href="#l27.8"></a><span id="l27.8">     else // we're dealing with a message/rfc822 attachment</span>
<a href="#l27.9"></a><span id="l27.9">     {</span>
<a href="#l27.10"></a><span id="l27.10">       // nsURLFetcher will check for &quot;realtype=message/rfc822&quot; and will set the</span>
<a href="#l27.11"></a><span id="l27.11">       // content type to message/rfc822 in the forwarded message.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-      msgUri.Append(&quot;&amp;realtype=message/rfc822&quot;);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+      msgUri.AppendLiteral(&quot;&amp;realtype=message/rfc822&quot;);</span>
<a href="#l27.14"></a><span id="l27.14">     }</span>
<a href="#l27.15"></a><span id="l27.15">     originalMsgURI = msgUri.get();</span>
<a href="#l27.16"></a><span id="l27.16">   }</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18">   if (compFields)</span>
<a href="#l27.19"></a><span id="l27.19">   {</span>
<a href="#l27.20"></a><span id="l27.20">     m_compFields = reinterpret_cast&lt;nsMsgCompFields*&gt;(compFields);</span>
<a href="#l27.21"></a><span id="l27.21">   }</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -1878,19 +1878,19 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l27.23"></a><span id="l27.23">         msgDBHdr-&gt;GetStringProperty(QUEUED_DISPOSITION_PROPERTY, getter_Copies(queuedDisposition));</span>
<a href="#l27.24"></a><span id="l27.24">         // We need to retrieve the original URI from the database so we can</span>
<a href="#l27.25"></a><span id="l27.25">         // set the disposition flags correctly if the draft is a reply or forwarded message.</span>
<a href="#l27.26"></a><span id="l27.26">         nsCString originalMsgURIfromDB;</span>
<a href="#l27.27"></a><span id="l27.27">         msgDBHdr-&gt;GetStringProperty(ORIG_URI_PROPERTY, getter_Copies(originalMsgURIfromDB));</span>
<a href="#l27.28"></a><span id="l27.28">         mOriginalMsgURI = originalMsgURIfromDB;</span>
<a href="#l27.29"></a><span id="l27.29">         if (!queuedDisposition.IsEmpty())</span>
<a href="#l27.30"></a><span id="l27.30">         {</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-          if (queuedDisposition.Equals(&quot;replied&quot;))</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+          if (queuedDisposition.EqualsLiteral(&quot;replied&quot;))</span>
<a href="#l27.33"></a><span id="l27.33">              mDraftDisposition = nsIMsgFolder::nsMsgDispositionState_Replied;</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-          else if (queuedDisposition.Equals(&quot;forward&quot;))</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+          else if (queuedDisposition.EqualsLiteral(&quot;forward&quot;))</span>
<a href="#l27.36"></a><span id="l27.36">              mDraftDisposition = nsIMsgFolder::nsMsgDispositionState_Forwarded;</span>
<a href="#l27.37"></a><span id="l27.37">         }</span>
<a href="#l27.38"></a><span id="l27.38">       }</span>
<a href="#l27.39"></a><span id="l27.39">     }</span>
<a href="#l27.40"></a><span id="l27.40">   }</span>
<a href="#l27.41"></a><span id="l27.41"> </span>
<a href="#l27.42"></a><span id="l27.42">   // If we don't have an original message URI, nothing else to do...</span>
<a href="#l27.43"></a><span id="l27.43">   if (!originalMsgURI || *originalMsgURI == 0)</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineat">@@ -3392,17 +3392,17 @@ NS_IMETHODIMP nsMsgCompose::RememberQueu</span>
<a href="#l27.45"></a><span id="l27.45">   {</span>
<a href="#l27.46"></a><span id="l27.46">     mMsgSend-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l27.47"></a><span id="l27.47">     nsAutoCString msgUri(m_folderName);</span>
<a href="#l27.48"></a><span id="l27.48">     nsCString identityKey;</span>
<a href="#l27.49"></a><span id="l27.49"> </span>
<a href="#l27.50"></a><span id="l27.50">     m_identity-&gt;GetKey(identityKey);</span>
<a href="#l27.51"></a><span id="l27.51"> </span>
<a href="#l27.52"></a><span id="l27.52">     int32_t insertIndex = StringBeginsWith(msgUri, NS_LITERAL_CSTRING(&quot;mailbox&quot;)) ? 7 : 4;</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-    msgUri.Insert(&quot;-message&quot;, insertIndex); // &quot;mailbox/imap: -&gt; &quot;mailbox/imap-message:&quot;</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineplus">+    msgUri.InsertLiteral(&quot;-message&quot;, insertIndex); // &quot;mailbox/imap: -&gt; &quot;mailbox/imap-message:&quot;</span>
<a href="#l27.55"></a><span id="l27.55">     msgUri.Append('#');</span>
<a href="#l27.56"></a><span id="l27.56">     msgUri.AppendInt(msgKey);</span>
<a href="#l27.57"></a><span id="l27.57">     nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l27.58"></a><span id="l27.58">     rv = GetMsgDBHdrFromURI(msgUri.get(), getter_AddRefs(msgHdr));</span>
<a href="#l27.59"></a><span id="l27.59">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.60"></a><span id="l27.60">     uint32_t pseudoHdrProp = 0;</span>
<a href="#l27.61"></a><span id="l27.61">     msgHdr-&gt;GetUint32Property(&quot;pseudoHdr&quot;, &amp;pseudoHdrProp);</span>
<a href="#l27.62"></a><span id="l27.62">     if (pseudoHdrProp)</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineat">@@ -4167,23 +4167,23 @@ nsMsgCompose::LoadDataFromFile(nsIFile *</span>
<a href="#l27.64"></a><span id="l27.64"> </span>
<a href="#l27.65"></a><span id="l27.65">   readSize = (uint32_t) fileSize;</span>
<a href="#l27.66"></a><span id="l27.66"> </span>
<a href="#l27.67"></a><span id="l27.67">   nsAutoCString sigEncoding(nsMsgI18NParseMetaCharset(file));</span>
<a href="#l27.68"></a><span id="l27.68">   bool removeSigCharset = !sigEncoding.IsEmpty() &amp;&amp; m_composeHTML;</span>
<a href="#l27.69"></a><span id="l27.69"> </span>
<a href="#l27.70"></a><span id="l27.70">   if (sigEncoding.IsEmpty()) {</span>
<a href="#l27.71"></a><span id="l27.71">     if (aAllowUTF8 &amp;&amp; MsgIsUTF8(nsDependentCString(readBuf))) {</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineminus">-      sigEncoding.Assign(&quot;UTF-8&quot;);</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineplus">+      sigEncoding.AssignLiteral(&quot;UTF-8&quot;);</span>
<a href="#l27.74"></a><span id="l27.74">     }</span>
<a href="#l27.75"></a><span id="l27.75">     else if (sigEncoding.IsEmpty() &amp;&amp; aAllowUTF16 &amp;&amp;</span>
<a href="#l27.76"></a><span id="l27.76">              readSize % 2 == 0 &amp;&amp; readSize &gt;= 2 &amp;&amp;</span>
<a href="#l27.77"></a><span id="l27.77">              ((readBuf[0] == char(0xFE) &amp;&amp; readBuf[1] == char(0xFF)) ||</span>
<a href="#l27.78"></a><span id="l27.78">               (readBuf[0] == char(0xFF) &amp;&amp; readBuf[1] == char(0xFE)))) {</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-      sigEncoding.Assign(&quot;UTF-16&quot;);</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineplus">+      sigEncoding.AssignLiteral(&quot;UTF-16&quot;);</span>
<a href="#l27.81"></a><span id="l27.81">     }</span>
<a href="#l27.82"></a><span id="l27.82">     else {</span>
<a href="#l27.83"></a><span id="l27.83">       //default to platform encoding for plain text files w/o meta charset</span>
<a href="#l27.84"></a><span id="l27.84">       nsAutoCString textFileCharset;</span>
<a href="#l27.85"></a><span id="l27.85">       nsMsgI18NTextFileCharset(textFileCharset);</span>
<a href="#l27.86"></a><span id="l27.86">       sigEncoding.Assign(textFileCharset);</span>
<a href="#l27.87"></a><span id="l27.87">     }</span>
<a href="#l27.88"></a><span id="l27.88">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -385,24 +385,24 @@ nsMsgComposeService::OpenComposeWindow(c</span>
<a href="#l28.4"></a><span id="l28.4">      Maybe one day when we will have more time we can change that</span>
<a href="#l28.5"></a><span id="l28.5">   */</span>
<a href="#l28.6"></a><span id="l28.6">   if (type == nsIMsgCompType::ForwardInline || type == nsIMsgCompType::Draft ||</span>
<a href="#l28.7"></a><span id="l28.7">       type == nsIMsgCompType::Template || type == nsIMsgCompType::ReplyWithTemplate ||</span>
<a href="#l28.8"></a><span id="l28.8">       type == nsIMsgCompType::Redirect || type == nsIMsgCompType::EditAsNew)</span>
<a href="#l28.9"></a><span id="l28.9">   {</span>
<a href="#l28.10"></a><span id="l28.10">     nsAutoCString uriToOpen(originalMsgURI);</span>
<a href="#l28.11"></a><span id="l28.11">     uriToOpen += (uriToOpen.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-    uriToOpen.Append(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+    uriToOpen.AppendLiteral(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15">     // The compose type that gets transmitted to a compose window open in mime</span>
<a href="#l28.16"></a><span id="l28.16">     // is communicated using url query parameters here.</span>
<a href="#l28.17"></a><span id="l28.17">     if (type == nsIMsgCompType::Redirect)</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-      uriToOpen.Append(&quot;&amp;redirect=true&quot;);</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+      uriToOpen.AppendLiteral(&quot;&amp;redirect=true&quot;);</span>
<a href="#l28.20"></a><span id="l28.20">     else if (type == nsIMsgCompType::EditAsNew)</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">-      uriToOpen.Append(&quot;&amp;editasnew=true&quot;);</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+      uriToOpen.AppendLiteral(&quot;&amp;editasnew=true&quot;);</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24">     return LoadDraftOrTemplate(uriToOpen, type == nsIMsgCompType::ForwardInline || type == nsIMsgCompType::Draft ?</span>
<a href="#l28.25"></a><span id="l28.25">                                nsMimeOutput::nsMimeMessageDraftOrTemplate : nsMimeOutput::nsMimeMessageEditorTemplate,</span>
<a href="#l28.26"></a><span id="l28.26">                                identity, originalMsgURI, origMsgHdr, type == nsIMsgCompType::ForwardInline,</span>
<a href="#l28.27"></a><span id="l28.27">                                format == nsIMsgCompFormat::OppositeOfDefault, aMsgWindow);</span>
<a href="#l28.28"></a><span id="l28.28">   }</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30">   nsCOMPtr&lt;nsIMsgComposeParams&gt; pMsgComposeParams (do_CreateInstance(NS_MSGCOMPOSEPARAMS_CONTRACTID, &amp;rv));</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineat">@@ -1007,17 +1007,17 @@ nsMsgComposeService::ForwardMessage(cons</span>
<a href="#l28.32"></a><span id="l28.32">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l28.33"></a><span id="l28.33">   aMsgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l28.34"></a><span id="l28.34">   NS_ENSURE_TRUE(folder, NS_ERROR_NULL_POINTER);</span>
<a href="#l28.35"></a><span id="l28.35"> </span>
<a href="#l28.36"></a><span id="l28.36">   folder-&gt;GetUriForMsg(aMsgHdr, msgUri);</span>
<a href="#l28.37"></a><span id="l28.37"> </span>
<a href="#l28.38"></a><span id="l28.38">   nsAutoCString uriToOpen(msgUri);</span>
<a href="#l28.39"></a><span id="l28.39">   uriToOpen += (uriToOpen.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">-  uriToOpen.Append(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+  uriToOpen.AppendLiteral(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43">   // get the MsgIdentity for the above key using AccountManager</span>
<a href="#l28.44"></a><span id="l28.44">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l28.45"></a><span id="l28.45">     do_GetService (NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l28.46"></a><span id="l28.46">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.47"></a><span id="l28.47"> </span>
<a href="#l28.48"></a><span id="l28.48">   nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l28.49"></a><span id="l28.49">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -139,21 +139,21 @@ nsMsgQuote::QuoteMessage(const char *msg</span>
<a href="#l29.4"></a><span id="l29.4">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">   nsAutoCString queryPart;</span>
<a href="#l29.7"></a><span id="l29.7">   rv = mailNewsUrl-&gt;GetQuery(queryPart);</span>
<a href="#l29.8"></a><span id="l29.8">   if (!queryPart.IsEmpty())</span>
<a href="#l29.9"></a><span id="l29.9">     queryPart.Append('&amp;');</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11">   if (headersOnly) /* We don't need to quote the message body but we still need to extract the headers */</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    queryPart.Append(&quot;header=only&quot;);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+    queryPart.AppendLiteral(&quot;header=only&quot;);</span>
<a href="#l29.14"></a><span id="l29.14">   else if (quoteHeaders)</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-    queryPart.Append(&quot;header=quote&quot;);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+    queryPart.AppendLiteral(&quot;header=quote&quot;);</span>
<a href="#l29.17"></a><span id="l29.17">   else</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-    queryPart.Append(&quot;header=quotebody&quot;);</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+    queryPart.AppendLiteral(&quot;header=quotebody&quot;);</span>
<a href="#l29.20"></a><span id="l29.20">   rv = mailNewsUrl-&gt;SetQuery(queryPart);</span>
<a href="#l29.21"></a><span id="l29.21">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l29.22"></a><span id="l29.22"> </span>
<a href="#l29.23"></a><span id="l29.23">   // if we were given a non empty charset, then use it</span>
<a href="#l29.24"></a><span id="l29.24">   if (aMsgCharSet &amp;&amp; *aMsgCharSet)</span>
<a href="#l29.25"></a><span id="l29.25">   {</span>
<a href="#l29.26"></a><span id="l29.26">     nsCOMPtr&lt;nsIMsgI18NUrl&gt; i18nUrl (do_QueryInterface(aURL));</span>
<a href="#l29.27"></a><span id="l29.27">     if (i18nUrl)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1080,17 +1080,17 @@ nsMsgComposeAndSend::PreProcessPart(nsMs</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">   nsCString type(ma-&gt;m_type);</span>
<a href="#l30.6"></a><span id="l30.6">   nsCString realName(ma-&gt;m_realName);</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">   // for cloud attachments, make the part an html part with no name,</span>
<a href="#l30.9"></a><span id="l30.9">   // so we don't show it as an attachment.</span>
<a href="#l30.10"></a><span id="l30.10">   if (ma-&gt;mSendViaCloud)</span>
<a href="#l30.11"></a><span id="l30.11">   {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    type.Assign(&quot;application/octet-stream&quot;);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+    type.AssignLiteral(&quot;application/octet-stream&quot;);</span>
<a href="#l30.14"></a><span id="l30.14">     realName.Truncate();</span>
<a href="#l30.15"></a><span id="l30.15">   }</span>
<a href="#l30.16"></a><span id="l30.16">   hdrs = mime_generate_attachment_headers (type.get(),</span>
<a href="#l30.17"></a><span id="l30.17">                                            ma-&gt;m_typeParam.get(),</span>
<a href="#l30.18"></a><span id="l30.18">                                            ma-&gt;m_encoding.get(),</span>
<a href="#l30.19"></a><span id="l30.19">                                            ma-&gt;m_description.get(),</span>
<a href="#l30.20"></a><span id="l30.20">                                            ma-&gt;m_xMacType.get(),</span>
<a href="#l30.21"></a><span id="l30.21">                                            ma-&gt;m_xMacCreator.get(),</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -1122,22 +1122,22 @@ nsMsgComposeAndSend::PreProcessPart(nsMs</span>
<a href="#l30.23"></a><span id="l30.23"> </span>
<a href="#l30.24"></a><span id="l30.24">     // Need to add some headers so that libmime can restore the cloud info</span>
<a href="#l30.25"></a><span id="l30.25">     // when loading a draft message.</span>
<a href="#l30.26"></a><span id="l30.26">     nsCString draftInfo(HEADER_X_MOZILLA_CLOUD_PART&quot;: cloudFile; url=&quot;);</span>
<a href="#l30.27"></a><span id="l30.27">     draftInfo.Append(ma-&gt;mCloudUrl.get());</span>
<a href="#l30.28"></a><span id="l30.28">     // don't leak user file paths or account keys to recipients.</span>
<a href="#l30.29"></a><span id="l30.29">     if (m_deliver_mode == nsMsgSaveAsDraft)</span>
<a href="#l30.30"></a><span id="l30.30">     {</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-      draftInfo.Append(&quot;; provider=&quot;);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+      draftInfo.AppendLiteral(&quot;; provider=&quot;);</span>
<a href="#l30.33"></a><span id="l30.33">       draftInfo.Append(ma-&gt;mCloudProviderKey.get());</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-      draftInfo.Append(&quot;; file=&quot;);</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+      draftInfo.AppendLiteral(&quot;; file=&quot;);</span>
<a href="#l30.36"></a><span id="l30.36">       draftInfo.Append(urlSpec.get());</span>
<a href="#l30.37"></a><span id="l30.37">     }</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-    draftInfo.Append(&quot;; name=&quot;);</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+    draftInfo.AppendLiteral(&quot;; name=&quot;);</span>
<a href="#l30.40"></a><span id="l30.40">     draftInfo.Append(ma-&gt;m_realName.get());</span>
<a href="#l30.41"></a><span id="l30.41">     draftInfo.Append(CRLF);</span>
<a href="#l30.42"></a><span id="l30.42">     part-&gt;AppendOtherHeaders(draftInfo.get());</span>
<a href="#l30.43"></a><span id="l30.43">     part-&gt;SetType(&quot;application/octet-stream&quot;);</span>
<a href="#l30.44"></a><span id="l30.44">     part-&gt;SetBuffer(&quot;&quot;);</span>
<a href="#l30.45"></a><span id="l30.45">   }</span>
<a href="#l30.46"></a><span id="l30.46">   if (NS_FAILED(status))</span>
<a href="#l30.47"></a><span id="l30.47">     return 0;</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineat">@@ -2104,34 +2104,34 @@ nsMsgComposeAndSend::AddCompFieldLocalAt</span>
<a href="#l30.49"></a><span id="l30.49">                 rv = fileUrl-&gt;SetFileName(m_attachments[newLoc]-&gt;m_realName);</span>
<a href="#l30.50"></a><span id="l30.50">                 if (NS_SUCCEEDED(rv))</span>
<a href="#l30.51"></a><span id="l30.51">                 {</span>
<a href="#l30.52"></a><span id="l30.52">                   rv = fileUrl-&gt;GetFileExtension(fileExt);</span>
<a href="#l30.53"></a><span id="l30.53">                   if (NS_SUCCEEDED(rv) &amp;&amp; !fileExt.IsEmpty()) {</span>
<a href="#l30.54"></a><span id="l30.54">                     nsAutoCString type;</span>
<a href="#l30.55"></a><span id="l30.55">                     mimeFinder-&gt;GetTypeFromExtension(fileExt, type);</span>
<a href="#l30.56"></a><span id="l30.56">   #ifndef XP_MACOSX</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineminus">-                    if (!type.Equals(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineplus">+                    if (!type.EqualsLiteral(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l30.59"></a><span id="l30.59">   #endif</span>
<a href="#l30.60"></a><span id="l30.60">                     m_attachments[newLoc]-&gt;m_type = type;</span>
<a href="#l30.61"></a><span id="l30.61">                   }</span>
<a href="#l30.62"></a><span id="l30.62">                 }</span>
<a href="#l30.63"></a><span id="l30.63"> </span>
<a href="#l30.64"></a><span id="l30.64">                 //Then try using the url if we still haven't figured out the content type</span>
<a href="#l30.65"></a><span id="l30.65">                 if (m_attachments[newLoc]-&gt;m_type.IsEmpty())</span>
<a href="#l30.66"></a><span id="l30.66">                 {</span>
<a href="#l30.67"></a><span id="l30.67">                   rv = fileUrl-&gt;SetSpec(url);</span>
<a href="#l30.68"></a><span id="l30.68">                   if (NS_SUCCEEDED(rv))</span>
<a href="#l30.69"></a><span id="l30.69">                   {</span>
<a href="#l30.70"></a><span id="l30.70">                     rv = fileUrl-&gt;GetFileExtension(fileExt);</span>
<a href="#l30.71"></a><span id="l30.71">                     if (NS_SUCCEEDED(rv) &amp;&amp; !fileExt.IsEmpty()) {</span>
<a href="#l30.72"></a><span id="l30.72">                       nsAutoCString type;</span>
<a href="#l30.73"></a><span id="l30.73">                       mimeFinder-&gt;GetTypeFromExtension(fileExt, type);</span>
<a href="#l30.74"></a><span id="l30.74">   #ifndef XP_MACOSX</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineminus">-                    if (!type.Equals(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineplus">+                    if (!type.EqualsLiteral(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l30.77"></a><span id="l30.77">   #endif</span>
<a href="#l30.78"></a><span id="l30.78">                       m_attachments[newLoc]-&gt;m_type = type;</span>
<a href="#l30.79"></a><span id="l30.79">                     // rtf and vcs files may look like text to sniffers,</span>
<a href="#l30.80"></a><span id="l30.80">                     // but they're not human readable.</span>
<a href="#l30.81"></a><span id="l30.81">                     if (type.IsEmpty() &amp;&amp; !fileExt.IsEmpty() &amp;&amp;</span>
<a href="#l30.82"></a><span id="l30.82">                          (MsgLowerCaseEqualsLiteral(fileExt, &quot;rtf&quot;) ||</span>
<a href="#l30.83"></a><span id="l30.83">                           MsgLowerCaseEqualsLiteral(fileExt, &quot;vcs&quot;)))</span>
<a href="#l30.84"></a><span id="l30.84">                       m_attachments[newLoc]-&gt;m_type = APPLICATION_OCTET_STREAM;</span>
<a href="#l30.85"></a><span id="l30.85" class="difflineat">@@ -2684,17 +2684,17 @@ nsMsgComposeAndSend::InitCompositionFiel</span>
<a href="#l30.86"></a><span id="l30.86">                 nsCOMPtr &lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l30.87"></a><span id="l30.87">                 rv = folder-&gt;GetServer(getter_AddRefs(incomingServer));</span>
<a href="#l30.88"></a><span id="l30.88">                 if (NS_SUCCEEDED(rv))</span>
<a href="#l30.89"></a><span id="l30.89">                 {</span>
<a href="#l30.90"></a><span id="l30.90">                   nsCString incomingServerType;</span>
<a href="#l30.91"></a><span id="l30.91">                   rv = incomingServer-&gt;GetCharValue(&quot;type&quot;, incomingServerType);</span>
<a href="#l30.92"></a><span id="l30.92">                   // Exclude RSS accounts, as they falsely report</span>
<a href="#l30.93"></a><span id="l30.93">                   // 'canFileMessages' = true</span>
<a href="#l30.94"></a><span id="l30.94" class="difflineminus">-                  if (NS_SUCCEEDED(rv) &amp;&amp; !incomingServerType.Equals(&quot;rss&quot;))</span>
<a href="#l30.95"></a><span id="l30.95" class="difflineplus">+                  if (NS_SUCCEEDED(rv) &amp;&amp; !incomingServerType.EqualsLiteral(&quot;rss&quot;))</span>
<a href="#l30.96"></a><span id="l30.96">                   {</span>
<a href="#l30.97"></a><span id="l30.97">                     bool fccReplyFollowsParent;</span>
<a href="#l30.98"></a><span id="l30.98">                     rv = mUserIdentity-&gt;GetFccReplyFollowsParent(</span>
<a href="#l30.99"></a><span id="l30.99">                              &amp;fccReplyFollowsParent);</span>
<a href="#l30.100"></a><span id="l30.100">                     if (NS_SUCCEEDED(rv) &amp;&amp; fccReplyFollowsParent)</span>
<a href="#l30.101"></a><span id="l30.101">                     {</span>
<a href="#l30.102"></a><span id="l30.102">                       nsCString folderURI;</span>
<a href="#l30.103"></a><span id="l30.103">                       rv = folder-&gt;GetURI(folderURI);</span>
<a href="#l30.104"></a><span id="l30.104" class="difflineat">@@ -4425,17 +4425,17 @@ nsMsgComposeAndSend::MimeDoFCC(nsIFile  </span>
<a href="#l30.105"></a><span id="l30.105">       rv = accountManager-&gt;GetLocalFoldersServer(getter_AddRefs(server));</span>
<a href="#l30.106"></a><span id="l30.106">       if (NS_SUCCEEDED(rv) &amp;&amp; server)</span>
<a href="#l30.107"></a><span id="l30.107">       {</span>
<a href="#l30.108"></a><span id="l30.108">         nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l30.109"></a><span id="l30.109">         rv = server-&gt;GetRootMsgFolder(getter_AddRefs(rootFolder));</span>
<a href="#l30.110"></a><span id="l30.110">         if (NS_SUCCEEDED(rv) &amp;&amp; rootFolder)</span>
<a href="#l30.111"></a><span id="l30.111">         {</span>
<a href="#l30.112"></a><span id="l30.112">           rv = rootFolder-&gt;GetURI(folder);</span>
<a href="#l30.113"></a><span id="l30.113" class="difflineminus">-          folder.Append(&quot;/&quot;);</span>
<a href="#l30.114"></a><span id="l30.114" class="difflineplus">+          folder.Append('/');</span>
<a href="#l30.115"></a><span id="l30.115">         }</span>
<a href="#l30.116"></a><span id="l30.116">       }</span>
<a href="#l30.117"></a><span id="l30.117">     }</span>
<a href="#l30.118"></a><span id="l30.118">     if (NS_FAILED(rv) || folder.IsEmpty())</span>
<a href="#l30.119"></a><span id="l30.119">     {</span>
<a href="#l30.120"></a><span id="l30.120">       status = NS_ERROR_FAILURE;</span>
<a href="#l30.121"></a><span id="l30.121">       goto FAIL;</span>
<a href="#l30.122"></a><span id="l30.122">     }</span>
<a href="#l30.123"></a><span id="l30.123" class="difflineat">@@ -4445,17 +4445,17 @@ nsMsgComposeAndSend::MimeDoFCC(nsIFile  </span>
<a href="#l30.124"></a><span id="l30.124">     {</span>
<a href="#l30.125"></a><span id="l30.125">       case nsMsgDeliverNow:</span>
<a href="#l30.126"></a><span id="l30.126">       case nsMsgSendUnsent:</span>
<a href="#l30.127"></a><span id="l30.127">       case nsMsgSaveAsDraft:</span>
<a href="#l30.128"></a><span id="l30.128">       case nsMsgSaveAsTemplate:</span>
<a href="#l30.129"></a><span id="l30.129">         // Typically, this appends &quot;Sent-&quot;, &quot;Drafts-&quot; or &quot;Templates-&quot; to folder</span>
<a href="#l30.130"></a><span id="l30.130">         // and then has the account name appended, e.g., .../Sent-MyImapAccount.</span>
<a href="#l30.131"></a><span id="l30.131">         folder.Append(NS_ConvertUTF16toUTF8(mSavedToFolderName));</span>
<a href="#l30.132"></a><span id="l30.132" class="difflineminus">-        folder.Append(&quot;-&quot;);</span>
<a href="#l30.133"></a><span id="l30.133" class="difflineplus">+        folder.Append('-');</span>
<a href="#l30.134"></a><span id="l30.134">         break;</span>
<a href="#l30.135"></a><span id="l30.135">       default:</span>
<a href="#l30.136"></a><span id="l30.136">         status = NS_ERROR_FAILURE;</span>
<a href="#l30.137"></a><span id="l30.137">         goto FAIL;</span>
<a href="#l30.138"></a><span id="l30.138">     }</span>
<a href="#l30.139"></a><span id="l30.139"> </span>
<a href="#l30.140"></a><span id="l30.140">     // Get the account name where the &quot;save to&quot; failed.</span>
<a href="#l30.141"></a><span id="l30.141">     nsString accountName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -851,17 +851,17 @@ nsresult nsMsgSendLater::SetOrigMsgDispo</span>
<a href="#l31.4"></a><span id="l31.4">       if (msgHdr)</span>
<a href="#l31.5"></a><span id="l31.5">       {</span>
<a href="#l31.6"></a><span id="l31.6">         // get the folder for the message resource</span>
<a href="#l31.7"></a><span id="l31.7">         nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l31.8"></a><span id="l31.8">         msgHdr-&gt;GetFolder(getter_AddRefs(msgFolder));</span>
<a href="#l31.9"></a><span id="l31.9">         if (msgFolder)</span>
<a href="#l31.10"></a><span id="l31.10">         {</span>
<a href="#l31.11"></a><span id="l31.11">           nsMsgDispositionState dispositionSetting = nsIMsgFolder::nsMsgDispositionState_Replied;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-          if (queuedDisposition.Equals(&quot;forwarded&quot;))</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+          if (queuedDisposition.EqualsLiteral(&quot;forwarded&quot;))</span>
<a href="#l31.14"></a><span id="l31.14">             dispositionSetting = nsIMsgFolder::nsMsgDispositionState_Forwarded;</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16">           msgFolder-&gt;AddMessageDispositionState(msgHdr, dispositionSetting);</span>
<a href="#l31.17"></a><span id="l31.17">         }</span>
<a href="#l31.18"></a><span id="l31.18">       }</span>
<a href="#l31.19"></a><span id="l31.19">     }</span>
<a href="#l31.20"></a><span id="l31.20">   }</span>
<a href="#l31.21"></a><span id="l31.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendPart.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendPart.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -152,17 +152,17 @@ nsresult nsMsgSendPart::AddChild(nsMsgSe</span>
<a href="#l32.4"></a><span id="l32.4">   for (int i=0 ; i&lt;m_numchildren-1 ; i++) {</span>
<a href="#l32.5"></a><span id="l32.5">     tmp[i] = m_children[i];</span>
<a href="#l32.6"></a><span id="l32.6">   }</span>
<a href="#l32.7"></a><span id="l32.7">   delete [] m_children;</span>
<a href="#l32.8"></a><span id="l32.8">   m_children = tmp;</span>
<a href="#l32.9"></a><span id="l32.9">   m_children[m_numchildren - 1] = child;</span>
<a href="#l32.10"></a><span id="l32.10">   child-&gt;m_parent = this;</span>
<a href="#l32.11"></a><span id="l32.11">   nsCString partNum(m_partNum);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  partNum.Append(&quot;.&quot;);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  partNum.Append('.');</span>
<a href="#l32.14"></a><span id="l32.14">   partNum.AppendInt(m_numchildren);</span>
<a href="#l32.15"></a><span id="l32.15">   child-&gt;m_partNum = partNum;</span>
<a href="#l32.16"></a><span id="l32.16">   return NS_OK;</span>
<a href="#l32.17"></a><span id="l32.17"> }</span>
<a href="#l32.18"></a><span id="l32.18"> </span>
<a href="#l32.19"></a><span id="l32.19"> nsMsgSendPart * nsMsgSendPart::DetachChild(int32_t whichOne)</span>
<a href="#l32.20"></a><span id="l32.20"> {</span>
<a href="#l32.21"></a><span id="l32.21">   nsMsgSendPart *returnValue = nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -775,22 +775,22 @@ nsresult nsSmtpProtocol::SendHeloRespons</span>
<a href="#l33.4"></a><span id="l33.4">   }</span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6">   if (TestFlag(SMTP_EHLO_8BIT_ENABLED))</span>
<a href="#l33.7"></a><span id="l33.7">   {</span>
<a href="#l33.8"></a><span id="l33.8">     bool strictlyMime = false;</span>
<a href="#l33.9"></a><span id="l33.9">     rv = prefBranch-&gt;GetBoolPref(&quot;mail.strictly_mime&quot;, &amp;strictlyMime);</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">     if (!strictlyMime)</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-      buffer.Append(&quot; BODY=8BITMIME&quot;);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+      buffer.AppendLiteral(&quot; BODY=8BITMIME&quot;);</span>
<a href="#l33.14"></a><span id="l33.14">   }</span>
<a href="#l33.15"></a><span id="l33.15"> </span>
<a href="#l33.16"></a><span id="l33.16">   if (TestFlag(SMTP_EHLO_SIZE_ENABLED))</span>
<a href="#l33.17"></a><span id="l33.17">   {</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineminus">-    buffer.Append(&quot; SIZE=&quot;);</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+    buffer.AppendLiteral(&quot; SIZE=&quot;);</span>
<a href="#l33.20"></a><span id="l33.20">     buffer.AppendInt(m_totalMessageSize);</span>
<a href="#l33.21"></a><span id="l33.21">   }</span>
<a href="#l33.22"></a><span id="l33.22">   buffer += CRLF;</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24">   status = SendData(buffer.get());</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26">   m_nextState = SMTP_RESPONSE;</span>
<a href="#l33.27"></a><span id="l33.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -3413,17 +3413,17 @@ nsIMimeConverter *nsMsgDatabase::GetMime</span>
<a href="#l34.4"></a><span id="l34.4"> </span>
<a href="#l34.5"></a><span id="l34.5"> nsresult nsMsgDatabase::GetEffectiveCharset(nsIMdbRow *row, nsACString &amp;resultCharset)</span>
<a href="#l34.6"></a><span id="l34.6"> {</span>
<a href="#l34.7"></a><span id="l34.7">   resultCharset.Truncate();</span>
<a href="#l34.8"></a><span id="l34.8">   bool characterSetOverride;</span>
<a href="#l34.9"></a><span id="l34.9">   m_dbFolderInfo-&gt;GetCharacterSetOverride(&amp;characterSetOverride);</span>
<a href="#l34.10"></a><span id="l34.10">   nsresult rv = RowCellColumnToCharPtr(row, m_messageCharSetColumnToken, getter_Copies(resultCharset));</span>
<a href="#l34.11"></a><span id="l34.11">   if (NS_FAILED(rv) || resultCharset.IsEmpty() ||</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-      resultCharset.Equals(&quot;us-ascii&quot;) || characterSetOverride)</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+      resultCharset.EqualsLiteral(&quot;us-ascii&quot;) || characterSetOverride)</span>
<a href="#l34.14"></a><span id="l34.14">   {</span>
<a href="#l34.15"></a><span id="l34.15">     rv = m_dbFolderInfo-&gt;GetEffectiveCharacterSet(resultCharset);</span>
<a href="#l34.16"></a><span id="l34.16">   }</span>
<a href="#l34.17"></a><span id="l34.17">   return rv;</span>
<a href="#l34.18"></a><span id="l34.18"> }</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20"> nsresult nsMsgDatabase::RowCellColumnToMime2DecodedString(nsIMdbRow *row, mdb_token columnToken, nsAString &amp;resultStr)</span>
<a href="#l34.21"></a><span id="l34.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -493,17 +493,17 @@ void Tokenizer::tokenizeHeaders(nsIUTF8S</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5">       if (headerProcessed)</span>
<a href="#l35.6"></a><span id="l35.6">         continue;</span>
<a href="#l35.7"></a><span id="l35.7">     }</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9">     switch (headerName.First())</span>
<a href="#l35.10"></a><span id="l35.10">     {</span>
<a href="#l35.11"></a><span id="l35.11">     case 'c':</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-        if (headerName.Equals(&quot;content-type&quot;))</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+        if (headerName.EqualsLiteral(&quot;content-type&quot;))</span>
<a href="#l35.14"></a><span id="l35.14">         {</span>
<a href="#l35.15"></a><span id="l35.15">           nsresult rv;</span>
<a href="#l35.16"></a><span id="l35.16">           nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimehdrpar = do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv);</span>
<a href="#l35.17"></a><span id="l35.17">           if (NS_FAILED(rv))</span>
<a href="#l35.18"></a><span id="l35.18">             break;</span>
<a href="#l35.19"></a><span id="l35.19"> </span>
<a href="#l35.20"></a><span id="l35.20">           // extract the charset parameter</span>
<a href="#l35.21"></a><span id="l35.21">           nsCString parameterValue;</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -515,38 +515,38 @@ void Tokenizer::tokenizeHeaders(nsIUTF8S</span>
<a href="#l35.23"></a><span id="l35.23">           if (!parameterValue.Length())</span>
<a href="#l35.24"></a><span id="l35.24">             mimehdrpar-&gt;GetParameterInternal(headerValue.get(), nullptr /* use first unnamed param */, nullptr, nullptr, getter_Copies(parameterValue));</span>
<a href="#l35.25"></a><span id="l35.25">           addTokenForHeader(&quot;content-type/type&quot;, parameterValue);</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27">           // XXX: should we add a token for the entire content-type header as well or just these parts we have extracted?</span>
<a href="#l35.28"></a><span id="l35.28">         }</span>
<a href="#l35.29"></a><span id="l35.29">         break;</span>
<a href="#l35.30"></a><span id="l35.30">     case 'r':</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-      if (headerName.Equals(&quot;received&quot;))</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+      if (headerName.EqualsLiteral(&quot;received&quot;))</span>
<a href="#l35.33"></a><span id="l35.33">       {</span>
<a href="#l35.34"></a><span id="l35.34">         // look for the string &quot;may be forged&quot; in the received headers. sendmail sometimes adds this hint</span>
<a href="#l35.35"></a><span id="l35.35">         // This does not compile on linux yet. Need to figure out why. Commenting out for now</span>
<a href="#l35.36"></a><span id="l35.36">         // if (FindInReadable(FORGED_RECEIVED_HEADER_HINT, headerValue))</span>
<a href="#l35.37"></a><span id="l35.37">         //   addTokenForHeader(headerName.get(), FORGED_RECEIVED_HEADER_HINT);</span>
<a href="#l35.38"></a><span id="l35.38">       }</span>
<a href="#l35.39"></a><span id="l35.39"> </span>
<a href="#l35.40"></a><span id="l35.40">       // leave out reply-to</span>
<a href="#l35.41"></a><span id="l35.41">       break;</span>
<a href="#l35.42"></a><span id="l35.42">     case 's':</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineminus">-        if (headerName.Equals(&quot;subject&quot;))</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+        if (headerName.EqualsLiteral(&quot;subject&quot;))</span>
<a href="#l35.45"></a><span id="l35.45">         {</span>
<a href="#l35.46"></a><span id="l35.46">           // we want to tokenize the subject</span>
<a href="#l35.47"></a><span id="l35.47">           addTokenForHeader(headerName.get(), headerValue, true);</span>
<a href="#l35.48"></a><span id="l35.48">         }</span>
<a href="#l35.49"></a><span id="l35.49"> </span>
<a href="#l35.50"></a><span id="l35.50">         // important: leave out sender field. Too strong of an indicator</span>
<a href="#l35.51"></a><span id="l35.51">         break;</span>
<a href="#l35.52"></a><span id="l35.52">     case 'x': // (2) X-Mailer / user-agent works best if it is untokenized, just fold the case and any leading/trailing white space</span>
<a href="#l35.53"></a><span id="l35.53">         // all headers beginning with x-mozilla are being changed by us, so ignore</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineminus">-        if (Substring(headerName, 0, 9).Equals(&quot;x-mozilla&quot;))</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+        if (StringBeginsWith(headerName, NS_LITERAL_CSTRING(&quot;x-mozilla&quot;)))</span>
<a href="#l35.56"></a><span id="l35.56">           break;</span>
<a href="#l35.57"></a><span id="l35.57">         // fall through</span>
<a href="#l35.58"></a><span id="l35.58">         MOZ_FALLTHROUGH;</span>
<a href="#l35.59"></a><span id="l35.59">     case 'u':</span>
<a href="#l35.60"></a><span id="l35.60">         addTokenForHeader(headerName.get(), headerValue);</span>
<a href="#l35.61"></a><span id="l35.61">         break;</span>
<a href="#l35.62"></a><span id="l35.62">     default:</span>
<a href="#l35.63"></a><span id="l35.63">         addTokenForHeader(headerName.get(), headerValue);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -674,17 +674,17 @@ nsresult nsMsgMdnGenerator::CreateSecond</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5">       if (!userAgentString.IsEmpty())</span>
<a href="#l36.6"></a><span id="l36.6">       {</span>
<a href="#l36.7"></a><span id="l36.7">         // Prepend the product name with the dns name according to RFC 3798.</span>
<a href="#l36.8"></a><span id="l36.8">         char hostName[256];</span>
<a href="#l36.9"></a><span id="l36.9">         PR_GetSystemInfo(PR_SI_HOSTNAME_UNTRUNCATED, hostName, sizeof hostName);</span>
<a href="#l36.10"></a><span id="l36.10">         if ((hostName[0] != '\0') &amp;&amp; (strchr(hostName, '.') != NULL))</span>
<a href="#l36.11"></a><span id="l36.11">         {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-          userAgentString.Insert(&quot;; &quot;, 0);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+          userAgentString.InsertLiteral(&quot;; &quot;, 0);</span>
<a href="#l36.14"></a><span id="l36.14">           userAgentString.Insert(nsDependentCString(hostName), 0);</span>
<a href="#l36.15"></a><span id="l36.15">         }</span>
<a href="#l36.16"></a><span id="l36.16"> </span>
<a href="#l36.17"></a><span id="l36.17">         tmpBuffer = PR_smprintf(&quot;Reporting-UA: %s&quot; CRLF,</span>
<a href="#l36.18"></a><span id="l36.18">                                 userAgentString.get());</span>
<a href="#l36.19"></a><span id="l36.19">         PUSH_N_FREE_STRING(tmpBuffer);</span>
<a href="#l36.20"></a><span id="l36.20">       }</span>
<a href="#l36.21"></a><span id="l36.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -508,17 +508,17 @@ NS_IMETHODIMP nsAutoSyncState::SetState(</span>
<a href="#l37.4"></a><span id="l37.4">       ownerFolder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l37.5"></a><span id="l37.5">       session-&gt;IsFolderOpenInWindow(ownerFolder, &amp;folderOpen);</span>
<a href="#l37.6"></a><span id="l37.6">       if (!folderOpen &amp;&amp; ! (folderFlags &amp; nsMsgFolderFlags::Inbox))</span>
<a href="#l37.7"></a><span id="l37.7">         ownerFolder-&gt;SetMsgDatabase(nullptr);</span>
<a href="#l37.8"></a><span id="l37.8">     }</span>
<a href="#l37.9"></a><span id="l37.9">   }</span>
<a href="#l37.10"></a><span id="l37.10">   nsCString logStr(&quot;Sync State set to &quot;);</span>
<a href="#l37.11"></a><span id="l37.11">   logStr.Append(stateStrings[aState]);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  logStr.Append(&quot; for &quot;);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+  logStr.AppendLiteral(&quot; for &quot;);</span>
<a href="#l37.14"></a><span id="l37.14">   LogOwnerFolderName(logStr.get());</span>
<a href="#l37.15"></a><span id="l37.15">   return NS_OK;</span>
<a href="#l37.16"></a><span id="l37.16"> }</span>
<a href="#l37.17"></a><span id="l37.17"> </span>
<a href="#l37.18"></a><span id="l37.18"> NS_IMETHODIMP nsAutoSyncState::TryCurrentGroupAgain(uint32_t aRetryCount)</span>
<a href="#l37.19"></a><span id="l37.19"> {</span>
<a href="#l37.20"></a><span id="l37.20">   SetState(stReadyToDownload);</span>
<a href="#l37.21"></a><span id="l37.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1111,17 +1111,17 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l38.4"></a><span id="l38.4">   {</span>
<a href="#l38.5"></a><span id="l38.5">     tokenStr = StringHead(tempFolderName, slashPos);</span>
<a href="#l38.6"></a><span id="l38.6">     remStr = Substring(tempFolderName, slashPos);</span>
<a href="#l38.7"></a><span id="l38.7">   }</span>
<a href="#l38.8"></a><span id="l38.8">   else</span>
<a href="#l38.9"></a><span id="l38.9">     tokenStr.Assign(tempFolderName);</span>
<a href="#l38.10"></a><span id="l38.10"> </span>
<a href="#l38.11"></a><span id="l38.11">   if ((int32_t(PL_strcasecmp(tokenStr.get(), &quot;INBOX&quot;))==0) &amp;&amp; (strcmp(tokenStr.get(), &quot;INBOX&quot;) != 0))</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    changedStr.Append(&quot;INBOX&quot;);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    changedStr.AppendLiteral(&quot;INBOX&quot;);</span>
<a href="#l38.14"></a><span id="l38.14">   else</span>
<a href="#l38.15"></a><span id="l38.15">     changedStr.Append(tokenStr);</span>
<a href="#l38.16"></a><span id="l38.16"> </span>
<a href="#l38.17"></a><span id="l38.17">   if (slashPos &gt; 0 )</span>
<a href="#l38.18"></a><span id="l38.18">     changedStr.Append(remStr);</span>
<a href="#l38.19"></a><span id="l38.19"> </span>
<a href="#l38.20"></a><span id="l38.20">   dupFolderPath.Assign(changedStr);</span>
<a href="#l38.21"></a><span id="l38.21">   nsAutoCString folderName(dupFolderPath);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -3248,17 +3248,17 @@ NS_IMETHODIMP nsImapMailFolder::BeginCop</span>
<a href="#l39.4"></a><span id="l39.4">     // be locking the previous temp file, and CreateUnique fails if the file</span>
<a href="#l39.5"></a><span id="l39.5">     // is locked. Use the message key to make a unique name.</span>
<a href="#l39.6"></a><span id="l39.6">     if (message)</span>
<a href="#l39.7"></a><span id="l39.7">     {</span>
<a href="#l39.8"></a><span id="l39.8">       nsCString tmpFileName(&quot;nscpmsg-&quot;);</span>
<a href="#l39.9"></a><span id="l39.9">       nsMsgKey msgKey;</span>
<a href="#l39.10"></a><span id="l39.10">       message-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l39.11"></a><span id="l39.11">       tmpFileName.AppendInt(msgKey);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-      tmpFileName.Append(&quot;.txt&quot;);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+      tmpFileName.AppendLiteral(&quot;.txt&quot;);</span>
<a href="#l39.14"></a><span id="l39.14">       m_copyState-&gt;m_tmpFile-&gt;SetNativeLeafName(tmpFileName);</span>
<a href="#l39.15"></a><span id="l39.15">       rv = m_copyState-&gt;m_tmpFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l39.16"></a><span id="l39.16">       if (NS_FAILED(rv))</span>
<a href="#l39.17"></a><span id="l39.17">       {</span>
<a href="#l39.18"></a><span id="l39.18">         MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create temp nscpmsg.txt: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l39.19"></a><span id="l39.19">         OnCopyCompleted(m_copyState-&gt;m_srcSupport, rv);</span>
<a href="#l39.20"></a><span id="l39.20">         return rv;</span>
<a href="#l39.21"></a><span id="l39.21">       }</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -9080,17 +9080,17 @@ nsImapMailFolder::SetJunkScoreForMessage</span>
<a href="#l39.23"></a><span id="l39.23"> </span>
<a href="#l39.24"></a><span id="l39.24">   nsresult rv = nsMsgDBFolder::SetJunkScoreForMessages(aMessages, aJunkScore);</span>
<a href="#l39.25"></a><span id="l39.25">   if (NS_SUCCEEDED(rv))</span>
<a href="#l39.26"></a><span id="l39.26">   {</span>
<a href="#l39.27"></a><span id="l39.27">     nsAutoCString messageIds;</span>
<a href="#l39.28"></a><span id="l39.28">     nsTArray&lt;nsMsgKey&gt; keys;</span>
<a href="#l39.29"></a><span id="l39.29">     nsresult rv = BuildIdsAndKeyArray(aMessages, messageIds, keys);</span>
<a href="#l39.30"></a><span id="l39.30">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-    StoreCustomKeywords(nullptr, aJunkScore.Equals(&quot;0&quot;) ? NS_LITERAL_CSTRING(&quot;NonJunk&quot;) : NS_LITERAL_CSTRING(&quot;Junk&quot;), EmptyCString(), keys.Elements(),</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+    StoreCustomKeywords(nullptr, aJunkScore.EqualsLiteral(&quot;0&quot;) ? NS_LITERAL_CSTRING(&quot;NonJunk&quot;) : NS_LITERAL_CSTRING(&quot;Junk&quot;), EmptyCString(), keys.Elements(),</span>
<a href="#l39.33"></a><span id="l39.33">       keys.Length(), nullptr);</span>
<a href="#l39.34"></a><span id="l39.34">     if (mDatabase)</span>
<a href="#l39.35"></a><span id="l39.35">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l39.36"></a><span id="l39.36">   }</span>
<a href="#l39.37"></a><span id="l39.37">   return rv;</span>
<a href="#l39.38"></a><span id="l39.38"> }</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40"> NS_IMETHODIMP</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineat">@@ -9680,32 +9680,32 @@ NS_IMETHODIMP nsImapMailFolder::GetOffli</span>
<a href="#l39.42"></a><span id="l39.42">       nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l39.43"></a><span id="l39.43">       nsCOMPtr&lt;nsIMsgImapMailFolder&gt; subFolder;</span>
<a href="#l39.44"></a><span id="l39.44">       for (uint32_t i = 0; i &lt; labelNames.Length(); i++)</span>
<a href="#l39.45"></a><span id="l39.45">       {</span>
<a href="#l39.46"></a><span id="l39.46">         rv = GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l39.47"></a><span id="l39.47">         if (NS_SUCCEEDED(rv) &amp;&amp; (rootFolder))</span>
<a href="#l39.48"></a><span id="l39.48">         {</span>
<a href="#l39.49"></a><span id="l39.49">           nsCOMPtr&lt;nsIMsgImapMailFolder&gt; imapRootFolder = do_QueryInterface(rootFolder);</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineminus">-          if (labelNames[i].Equals(&quot;\&quot;\\\\Draft\&quot;&quot;))</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineplus">+          if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Draft\&quot;&quot;))</span>
<a href="#l39.52"></a><span id="l39.52">              rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Drafts,</span>
<a href="#l39.53"></a><span id="l39.53">                                                  getter_AddRefs(subMsgFolder));</span>
<a href="#l39.54"></a><span id="l39.54" class="difflineminus">-          if (labelNames[i].Equals(&quot;\&quot;\\\\Inbox\&quot;&quot;))</span>
<a href="#l39.55"></a><span id="l39.55" class="difflineplus">+          if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Inbox\&quot;&quot;))</span>
<a href="#l39.56"></a><span id="l39.56">              rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Inbox,</span>
<a href="#l39.57"></a><span id="l39.57">                                                  getter_AddRefs(subMsgFolder));</span>
<a href="#l39.58"></a><span id="l39.58" class="difflineminus">-          if (labelNames[i].Equals(&quot;\&quot;\\\\All Mail\&quot;&quot;))</span>
<a href="#l39.59"></a><span id="l39.59" class="difflineplus">+          if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\All Mail\&quot;&quot;))</span>
<a href="#l39.60"></a><span id="l39.60">              rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Archive,</span>
<a href="#l39.61"></a><span id="l39.61">                                                  getter_AddRefs(subMsgFolder));</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineminus">-          if (labelNames[i].Equals(&quot;\&quot;\\\\Trash\&quot;&quot;))</span>
<a href="#l39.63"></a><span id="l39.63" class="difflineplus">+          if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Trash\&quot;&quot;))</span>
<a href="#l39.64"></a><span id="l39.64">              rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Trash,</span>
<a href="#l39.65"></a><span id="l39.65">                                                  getter_AddRefs(subMsgFolder));</span>
<a href="#l39.66"></a><span id="l39.66" class="difflineminus">-          if (labelNames[i].Equals(&quot;\&quot;\\\\Spam\&quot;&quot;))</span>
<a href="#l39.67"></a><span id="l39.67" class="difflineplus">+          if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Spam\&quot;&quot;))</span>
<a href="#l39.68"></a><span id="l39.68">              rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Junk,</span>
<a href="#l39.69"></a><span id="l39.69">                                                  getter_AddRefs(subMsgFolder));</span>
<a href="#l39.70"></a><span id="l39.70" class="difflineminus">-          if (labelNames[i].Equals(&quot;\&quot;\\\\Sent\&quot;&quot;))</span>
<a href="#l39.71"></a><span id="l39.71" class="difflineplus">+          if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Sent\&quot;&quot;))</span>
<a href="#l39.72"></a><span id="l39.72">              rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::SentMail,</span>
<a href="#l39.73"></a><span id="l39.73">                                                  getter_AddRefs(subMsgFolder));</span>
<a href="#l39.74"></a><span id="l39.74">           if (labelNames[i].Find(&quot;[Imap]/&quot;, /* ignoreCase = */ true) != kNotFound)</span>
<a href="#l39.75"></a><span id="l39.75">           {</span>
<a href="#l39.76"></a><span id="l39.76">             MsgReplaceSubstring(labelNames[i], &quot;[Imap]/&quot;, &quot;&quot;);</span>
<a href="#l39.77"></a><span id="l39.77">             imapRootFolder-&gt;FindOnlineSubFolder(labelNames[i], getter_AddRefs(subFolder));</span>
<a href="#l39.78"></a><span id="l39.78">             subMsgFolder = do_QueryInterface(subFolder);</span>
<a href="#l39.79"></a><span id="l39.79">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1438,17 +1438,17 @@ nsImapProtocol::ImapThreadMainLoop()</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5">   MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ImapThreadMainLoop leaving [this=%p]\n&quot;, this));</span>
<a href="#l40.6"></a><span id="l40.6"> }</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8"> void nsImapProtocol::HandleIdleResponses()</span>
<a href="#l40.9"></a><span id="l40.9"> {</span>
<a href="#l40.10"></a><span id="l40.10">   // int32_t oldRecent = GetServerStateParser().NumberOfRecentMessages();</span>
<a href="#l40.11"></a><span id="l40.11">   nsAutoCString commandBuffer(GetServerCommandTag());</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  commandBuffer.Append(&quot; IDLE&quot; CRLF);</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  commandBuffer.AppendLiteral(&quot; IDLE&quot; CRLF);</span>
<a href="#l40.14"></a><span id="l40.14"> </span>
<a href="#l40.15"></a><span id="l40.15">   do</span>
<a href="#l40.16"></a><span id="l40.16">   {</span>
<a href="#l40.17"></a><span id="l40.17">     ParseIMAPandCheckForNewMail(commandBuffer.get());</span>
<a href="#l40.18"></a><span id="l40.18">   }</span>
<a href="#l40.19"></a><span id="l40.19">   while (m_inputStreamBuffer-&gt;NextLineAvailable() &amp;&amp; GetServerStateParser().Connected());</span>
<a href="#l40.20"></a><span id="l40.20"> </span>
<a href="#l40.21"></a><span id="l40.21">   //  if (oldRecent != GetServerStateParser().NumberOfRecentMessages())</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -1669,17 +1669,17 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l40.23"></a><span id="l40.23">       {</span>
<a href="#l40.24"></a><span id="l40.24">         if (!DeathSignalReceived() &amp;&amp; NS_SUCCEEDED(GetConnectionStatus()))</span>
<a href="#l40.25"></a><span id="l40.25">           AlertUserEventUsingName(&quot;imapServerNotImap4&quot;);</span>
<a href="#l40.26"></a><span id="l40.26"> </span>
<a href="#l40.27"></a><span id="l40.27">         SetConnectionStatus(NS_ERROR_FAILURE);        // stop netlib</span>
<a href="#l40.28"></a><span id="l40.28">       }</span>
<a href="#l40.29"></a><span id="l40.29">       else</span>
<a href="#l40.30"></a><span id="l40.30">       {</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-        if ((m_connectionType.Equals(&quot;starttls&quot;)</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+        if ((m_connectionType.EqualsLiteral(&quot;starttls&quot;)</span>
<a href="#l40.33"></a><span id="l40.33">              &amp;&amp; (m_socketType == nsMsgSocketType::trySTARTTLS</span>
<a href="#l40.34"></a><span id="l40.34">              &amp;&amp; (GetServerStateParser().GetCapabilityFlag() &amp; kHasStartTLSCapability)))</span>
<a href="#l40.35"></a><span id="l40.35">             || m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l40.36"></a><span id="l40.36">         {</span>
<a href="#l40.37"></a><span id="l40.37">           StartTLS();</span>
<a href="#l40.38"></a><span id="l40.38">           if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l40.39"></a><span id="l40.39">           {</span>
<a href="#l40.40"></a><span id="l40.40">             nsCOMPtr&lt;nsISupports&gt; secInfo;</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineat">@@ -2854,24 +2854,24 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l40.42"></a><span id="l40.42"> </span>
<a href="#l40.43"></a><span id="l40.43">           m_runningUrl-&gt;GetListOfMessageIds(messageIdString);</span>
<a href="#l40.44"></a><span id="l40.44">           m_runningUrl-&gt;GetCustomAddFlags(addFlags);</span>
<a href="#l40.45"></a><span id="l40.45">           m_runningUrl-&gt;GetCustomSubtractFlags(subtractFlags);</span>
<a href="#l40.46"></a><span id="l40.46">           if (!addFlags.IsEmpty())</span>
<a href="#l40.47"></a><span id="l40.47">           {</span>
<a href="#l40.48"></a><span id="l40.48">             nsAutoCString storeString(&quot;+FLAGS (&quot;);</span>
<a href="#l40.49"></a><span id="l40.49">             storeString.Append(addFlags);</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-            storeString.Append(&quot;)&quot;);</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+            storeString.Append(')');</span>
<a href="#l40.52"></a><span id="l40.52">             Store(messageIdString, storeString.get(), true);</span>
<a href="#l40.53"></a><span id="l40.53">           }</span>
<a href="#l40.54"></a><span id="l40.54">           if (!subtractFlags.IsEmpty())</span>
<a href="#l40.55"></a><span id="l40.55">           {</span>
<a href="#l40.56"></a><span id="l40.56">             nsAutoCString storeString(&quot;-FLAGS (&quot;);</span>
<a href="#l40.57"></a><span id="l40.57">             storeString.Append(subtractFlags);</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineminus">-            storeString.Append(&quot;)&quot;);</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineplus">+            storeString.Append(')');</span>
<a href="#l40.60"></a><span id="l40.60">             Store(messageIdString, storeString.get(), true);</span>
<a href="#l40.61"></a><span id="l40.61">           }</span>
<a href="#l40.62"></a><span id="l40.62">         }</span>
<a href="#l40.63"></a><span id="l40.63">         break;</span>
<a href="#l40.64"></a><span id="l40.64">       case nsIImapUrl::nsImapDeleteMsg:</span>
<a href="#l40.65"></a><span id="l40.65">         {</span>
<a href="#l40.66"></a><span id="l40.66">           nsCString messageIdString;</span>
<a href="#l40.67"></a><span id="l40.67">           m_runningUrl-&gt;GetListOfMessageIds(messageIdString);</span>
<a href="#l40.68"></a><span id="l40.68" class="difflineat">@@ -3249,21 +3249,21 @@ void nsImapProtocol::SelectMailbox(const</span>
<a href="#l40.69"></a><span id="l40.69">   ProgressEventFunctionUsingNameWithString(&quot;imapStatusSelectingMailbox&quot;, mailboxName);</span>
<a href="#l40.70"></a><span id="l40.70">   IncrementCommandTagNumber();</span>
<a href="#l40.71"></a><span id="l40.71"> </span>
<a href="#l40.72"></a><span id="l40.72">   m_closeNeededBeforeSelect = false;   // initial value</span>
<a href="#l40.73"></a><span id="l40.73">   GetServerStateParser().ResetFlagInfo();</span>
<a href="#l40.74"></a><span id="l40.74">   nsCString escapedName;</span>
<a href="#l40.75"></a><span id="l40.75">   CreateEscapedMailboxName(mailboxName, escapedName);</span>
<a href="#l40.76"></a><span id="l40.76">   nsCString commandBuffer(GetServerCommandTag());</span>
<a href="#l40.77"></a><span id="l40.77" class="difflineminus">-  commandBuffer.Append(&quot; select \&quot;&quot;);</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineplus">+  commandBuffer.AppendLiteral(&quot; select \&quot;&quot;);</span>
<a href="#l40.79"></a><span id="l40.79">   commandBuffer.Append(escapedName.get());</span>
<a href="#l40.80"></a><span id="l40.80" class="difflineminus">-  commandBuffer.Append(&quot;\&quot;&quot;);</span>
<a href="#l40.81"></a><span id="l40.81" class="difflineplus">+  commandBuffer.Append('&quot;');</span>
<a href="#l40.82"></a><span id="l40.82">   if (UseCondStore())</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineminus">-    commandBuffer.Append(&quot; (CONDSTORE)&quot;);</span>
<a href="#l40.84"></a><span id="l40.84" class="difflineplus">+    commandBuffer.AppendLiteral(&quot; (CONDSTORE)&quot;);</span>
<a href="#l40.85"></a><span id="l40.85">   commandBuffer.Append(CRLF);</span>
<a href="#l40.86"></a><span id="l40.86"> </span>
<a href="#l40.87"></a><span id="l40.87">   nsresult res;</span>
<a href="#l40.88"></a><span id="l40.88">   res = SendData(commandBuffer.get());</span>
<a href="#l40.89"></a><span id="l40.89">   if (NS_FAILED(res)) return;</span>
<a href="#l40.90"></a><span id="l40.90">   ParseIMAPandCheckForNewMail();</span>
<a href="#l40.91"></a><span id="l40.91"> </span>
<a href="#l40.92"></a><span id="l40.92">   int32_t numOfMessagesInFlagState = 0;</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineat">@@ -3284,21 +3284,21 @@ void nsImapProtocol::SelectMailbox(const</span>
<a href="#l40.94"></a><span id="l40.94"> </span>
<a href="#l40.95"></a><span id="l40.95"> // Please call only with a single message ID</span>
<a href="#l40.96"></a><span id="l40.96"> void nsImapProtocol::Bodystructure(const nsCString &amp;messageId, bool idIsUid)</span>
<a href="#l40.97"></a><span id="l40.97"> {</span>
<a href="#l40.98"></a><span id="l40.98">   IncrementCommandTagNumber();</span>
<a href="#l40.99"></a><span id="l40.99"> </span>
<a href="#l40.100"></a><span id="l40.100">   nsCString commandString(GetServerCommandTag());</span>
<a href="#l40.101"></a><span id="l40.101">   if (idIsUid)</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineminus">-    commandString.Append(&quot; UID&quot;);</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineminus">-  commandString.Append(&quot; fetch &quot;);</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineplus">+    commandString.AppendLiteral(&quot; UID&quot;);</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineplus">+  commandString.AppendLiteral(&quot; fetch &quot;);</span>
<a href="#l40.106"></a><span id="l40.106"> </span>
<a href="#l40.107"></a><span id="l40.107">   commandString.Append(messageId);</span>
<a href="#l40.108"></a><span id="l40.108" class="difflineminus">-  commandString.Append(&quot; (BODYSTRUCTURE)&quot; CRLF);</span>
<a href="#l40.109"></a><span id="l40.109" class="difflineplus">+  commandString.AppendLiteral(&quot; (BODYSTRUCTURE)&quot; CRLF);</span>
<a href="#l40.110"></a><span id="l40.110"> </span>
<a href="#l40.111"></a><span id="l40.111">   nsresult rv = SendData(commandString.get());</span>
<a href="#l40.112"></a><span id="l40.112">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.113"></a><span id="l40.113">       ParseIMAPandCheckForNewMail(commandString.get());</span>
<a href="#l40.114"></a><span id="l40.114"> }</span>
<a href="#l40.115"></a><span id="l40.115"> </span>
<a href="#l40.116"></a><span id="l40.116"> void nsImapProtocol::PipelinedFetchMessageParts(const char *uid, nsIMAPMessagePartIDArray *parts)</span>
<a href="#l40.117"></a><span id="l40.117"> {</span>
<a href="#l40.118"></a><span id="l40.118" class="difflineat">@@ -3310,75 +3310,75 @@ void nsImapProtocol::PipelinedFetchMessa</span>
<a href="#l40.119"></a><span id="l40.119">   while ((parts-&gt;GetNumParts() &gt; currentPartNum) &amp;&amp; !DeathSignalReceived())</span>
<a href="#l40.120"></a><span id="l40.120">   {</span>
<a href="#l40.121"></a><span id="l40.121">     nsIMAPMessagePartID *currentPart = parts-&gt;GetPart(currentPartNum);</span>
<a href="#l40.122"></a><span id="l40.122">     if (currentPart)</span>
<a href="#l40.123"></a><span id="l40.123">     {</span>
<a href="#l40.124"></a><span id="l40.124">       // Do things here depending on the type of message part</span>
<a href="#l40.125"></a><span id="l40.125">       // Append it to the fetch string</span>
<a href="#l40.126"></a><span id="l40.126">       if (currentPartNum &gt; 0)</span>
<a href="#l40.127"></a><span id="l40.127" class="difflineminus">-        stringToFetch.Append(&quot; &quot;);</span>
<a href="#l40.128"></a><span id="l40.128" class="difflineplus">+        stringToFetch.Append(' ');</span>
<a href="#l40.129"></a><span id="l40.129"> </span>
<a href="#l40.130"></a><span id="l40.130">       switch (currentPart-&gt;GetFields())</span>
<a href="#l40.131"></a><span id="l40.131">       {</span>
<a href="#l40.132"></a><span id="l40.132">       case kMIMEHeader:</span>
<a href="#l40.133"></a><span id="l40.133">         what = &quot;BODY.PEEK[&quot;;</span>
<a href="#l40.134"></a><span id="l40.134">         what.Append(currentPart-&gt;GetPartNumberString());</span>
<a href="#l40.135"></a><span id="l40.135" class="difflineminus">-        what.Append(&quot;.MIME]&quot;);</span>
<a href="#l40.136"></a><span id="l40.136" class="difflineplus">+        what.AppendLiteral(&quot;.MIME]&quot;);</span>
<a href="#l40.137"></a><span id="l40.137">         stringToFetch.Append(what);</span>
<a href="#l40.138"></a><span id="l40.138">         break;</span>
<a href="#l40.139"></a><span id="l40.139">       case kRFC822HeadersOnly:</span>
<a href="#l40.140"></a><span id="l40.140">         if (currentPart-&gt;GetPartNumberString())</span>
<a href="#l40.141"></a><span id="l40.141">         {</span>
<a href="#l40.142"></a><span id="l40.142">           what = &quot;BODY.PEEK[&quot;;</span>
<a href="#l40.143"></a><span id="l40.143">           what.Append(currentPart-&gt;GetPartNumberString());</span>
<a href="#l40.144"></a><span id="l40.144" class="difflineminus">-          what.Append(&quot;.HEADER]&quot;);</span>
<a href="#l40.145"></a><span id="l40.145" class="difflineplus">+          what.AppendLiteral(&quot;.HEADER]&quot;);</span>
<a href="#l40.146"></a><span id="l40.146">           stringToFetch.Append(what);</span>
<a href="#l40.147"></a><span id="l40.147">         }</span>
<a href="#l40.148"></a><span id="l40.148">         else</span>
<a href="#l40.149"></a><span id="l40.149">         {</span>
<a href="#l40.150"></a><span id="l40.150">           // headers for the top-level message</span>
<a href="#l40.151"></a><span id="l40.151" class="difflineminus">-          stringToFetch.Append(&quot;BODY.PEEK[HEADER]&quot;);</span>
<a href="#l40.152"></a><span id="l40.152" class="difflineplus">+          stringToFetch.AppendLiteral(&quot;BODY.PEEK[HEADER]&quot;);</span>
<a href="#l40.153"></a><span id="l40.153">         }</span>
<a href="#l40.154"></a><span id="l40.154">         break;</span>
<a href="#l40.155"></a><span id="l40.155">       default:</span>
<a href="#l40.156"></a><span id="l40.156">         NS_ASSERTION(false, &quot;we should only be pipelining MIME headers and Message headers&quot;);</span>
<a href="#l40.157"></a><span id="l40.157">         break;</span>
<a href="#l40.158"></a><span id="l40.158">       }</span>
<a href="#l40.159"></a><span id="l40.159">     }</span>
<a href="#l40.160"></a><span id="l40.160">     currentPartNum++;</span>
<a href="#l40.161"></a><span id="l40.161">   }</span>
<a href="#l40.162"></a><span id="l40.162"> </span>
<a href="#l40.163"></a><span id="l40.163">   // Run the single, pipelined fetch command</span>
<a href="#l40.164"></a><span id="l40.164">   if ((parts-&gt;GetNumParts() &gt; 0) &amp;&amp; !DeathSignalReceived() &amp;&amp; !GetPseudoInterrupted() &amp;&amp; stringToFetch.get())</span>
<a href="#l40.165"></a><span id="l40.165">   {</span>
<a href="#l40.166"></a><span id="l40.166">       IncrementCommandTagNumber();</span>
<a href="#l40.167"></a><span id="l40.167"> </span>
<a href="#l40.168"></a><span id="l40.168">     nsCString commandString(GetServerCommandTag());</span>
<a href="#l40.169"></a><span id="l40.169" class="difflineminus">-    commandString.Append(&quot; UID fetch &quot;);</span>
<a href="#l40.170"></a><span id="l40.170" class="difflineplus">+    commandString.AppendLiteral(&quot; UID fetch &quot;);</span>
<a href="#l40.171"></a><span id="l40.171">     commandString.Append(uid, 10);</span>
<a href="#l40.172"></a><span id="l40.172" class="difflineminus">-    commandString.Append(&quot; (&quot;);</span>
<a href="#l40.173"></a><span id="l40.173" class="difflineplus">+    commandString.AppendLiteral(&quot; (&quot;);</span>
<a href="#l40.174"></a><span id="l40.174">     commandString.Append(stringToFetch);</span>
<a href="#l40.175"></a><span id="l40.175" class="difflineminus">-    commandString.Append(&quot;)&quot; CRLF);</span>
<a href="#l40.176"></a><span id="l40.176" class="difflineplus">+    commandString.AppendLiteral(&quot;)&quot; CRLF);</span>
<a href="#l40.177"></a><span id="l40.177">     nsresult rv = SendData(commandString.get());</span>
<a href="#l40.178"></a><span id="l40.178">         if (NS_SUCCEEDED(rv))</span>
<a href="#l40.179"></a><span id="l40.179">             ParseIMAPandCheckForNewMail(commandString.get());</span>
<a href="#l40.180"></a><span id="l40.180">   }</span>
<a href="#l40.181"></a><span id="l40.181"> }</span>
<a href="#l40.182"></a><span id="l40.182"> </span>
<a href="#l40.183"></a><span id="l40.183"> void nsImapProtocol::FetchMsgAttribute(const nsCString &amp;messageIds, const nsCString &amp;attribute)</span>
<a href="#l40.184"></a><span id="l40.184"> {</span>
<a href="#l40.185"></a><span id="l40.185">     IncrementCommandTagNumber();</span>
<a href="#l40.186"></a><span id="l40.186"> </span>
<a href="#l40.187"></a><span id="l40.187">     nsAutoCString commandString (GetServerCommandTag());</span>
<a href="#l40.188"></a><span id="l40.188" class="difflineminus">-    commandString.Append(&quot; UID fetch &quot;);</span>
<a href="#l40.189"></a><span id="l40.189" class="difflineplus">+    commandString.AppendLiteral(&quot; UID fetch &quot;);</span>
<a href="#l40.190"></a><span id="l40.190">     commandString.Append(messageIds);</span>
<a href="#l40.191"></a><span id="l40.191" class="difflineminus">-    commandString.Append(&quot; (&quot;);</span>
<a href="#l40.192"></a><span id="l40.192" class="difflineplus">+    commandString.AppendLiteral(&quot; (&quot;);</span>
<a href="#l40.193"></a><span id="l40.193">     commandString.Append(attribute);</span>
<a href="#l40.194"></a><span id="l40.194" class="difflineminus">-    commandString.Append(&quot;)&quot; CRLF);</span>
<a href="#l40.195"></a><span id="l40.195" class="difflineplus">+    commandString.AppendLiteral(&quot;)&quot; CRLF);</span>
<a href="#l40.196"></a><span id="l40.196">     nsresult rv = SendData(commandString.get());</span>
<a href="#l40.197"></a><span id="l40.197"> </span>
<a href="#l40.198"></a><span id="l40.198">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.199"></a><span id="l40.199">        ParseIMAPandCheckForNewMail(commandString.get());</span>
<a href="#l40.200"></a><span id="l40.200">     GetServerStateParser().SetFetchingFlags(false);</span>
<a href="#l40.201"></a><span id="l40.201">     // Always clear this flag after every fetch.</span>
<a href="#l40.202"></a><span id="l40.202">     m_fetchingWholeMessage = false;</span>
<a href="#l40.203"></a><span id="l40.203"> }</span>
<a href="#l40.204"></a><span id="l40.204" class="difflineat">@@ -3423,38 +3423,38 @@ nsImapProtocol::FetchMessage(const nsCSt</span>
<a href="#l40.205"></a><span id="l40.205">     MOZ_LOG(IMAP, LogLevel::Debug, (&quot;FetchMessage everything: curFetchSize %u numBytes %u&quot;,</span>
<a href="#l40.206"></a><span id="l40.206">                                 m_curFetchSize, numBytes));</span>
<a href="#l40.207"></a><span id="l40.207">     if (numBytes &gt; 0)</span>
<a href="#l40.208"></a><span id="l40.208">       m_curFetchSize = numBytes;</span>
<a href="#l40.209"></a><span id="l40.209"> </span>
<a href="#l40.210"></a><span id="l40.210">     if (GetServerStateParser().ServerHasIMAP4Rev1Capability())</span>
<a href="#l40.211"></a><span id="l40.211">     {</span>
<a href="#l40.212"></a><span id="l40.212">       if (GetServerStateParser().GetCapabilityFlag() &amp; kHasXSenderCapability)</span>
<a href="#l40.213"></a><span id="l40.213" class="difflineminus">-        commandString.Append(&quot; %s (XSENDER UID RFC822.SIZE BODY[]&quot;);</span>
<a href="#l40.214"></a><span id="l40.214" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (XSENDER UID RFC822.SIZE BODY[]&quot;);</span>
<a href="#l40.215"></a><span id="l40.215">       else</span>
<a href="#l40.216"></a><span id="l40.216" class="difflineminus">-        commandString.Append(&quot; %s (UID RFC822.SIZE BODY[]&quot;);</span>
<a href="#l40.217"></a><span id="l40.217" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (UID RFC822.SIZE BODY[]&quot;);</span>
<a href="#l40.218"></a><span id="l40.218">     }</span>
<a href="#l40.219"></a><span id="l40.219">     else</span>
<a href="#l40.220"></a><span id="l40.220">     {</span>
<a href="#l40.221"></a><span id="l40.221">       if (GetServerStateParser().GetCapabilityFlag() &amp; kHasXSenderCapability)</span>
<a href="#l40.222"></a><span id="l40.222" class="difflineminus">-        commandString.Append(&quot; %s (XSENDER UID RFC822.SIZE RFC822&quot;);</span>
<a href="#l40.223"></a><span id="l40.223" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (XSENDER UID RFC822.SIZE RFC822&quot;);</span>
<a href="#l40.224"></a><span id="l40.224">       else</span>
<a href="#l40.225"></a><span id="l40.225" class="difflineminus">-        commandString.Append(&quot; %s (UID RFC822.SIZE RFC822&quot;);</span>
<a href="#l40.226"></a><span id="l40.226" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (UID RFC822.SIZE RFC822&quot;);</span>
<a href="#l40.227"></a><span id="l40.227">     }</span>
<a href="#l40.228"></a><span id="l40.228">     if (numBytes &gt; 0)</span>
<a href="#l40.229"></a><span id="l40.229">     {</span>
<a href="#l40.230"></a><span id="l40.230">       // if we are retrieving chunks</span>
<a href="#l40.231"></a><span id="l40.231">       char *byterangeString = PR_smprintf(&quot;&lt;%ld.%ld&gt;&quot;,startByte, numBytes);</span>
<a href="#l40.232"></a><span id="l40.232">       if (byterangeString)</span>
<a href="#l40.233"></a><span id="l40.233">       {</span>
<a href="#l40.234"></a><span id="l40.234">         commandString.Append(byterangeString);</span>
<a href="#l40.235"></a><span id="l40.235">         PR_Free(byterangeString);</span>
<a href="#l40.236"></a><span id="l40.236">       }</span>
<a href="#l40.237"></a><span id="l40.237">     }</span>
<a href="#l40.238"></a><span id="l40.238" class="difflineminus">-    commandString.Append(&quot;)&quot;);</span>
<a href="#l40.239"></a><span id="l40.239" class="difflineplus">+    commandString.Append(')');</span>
<a href="#l40.240"></a><span id="l40.240"> </span>
<a href="#l40.241"></a><span id="l40.241">     break;</span>
<a href="#l40.242"></a><span id="l40.242"> </span>
<a href="#l40.243"></a><span id="l40.243">   case kEveryThingRFC822Peek:</span>
<a href="#l40.244"></a><span id="l40.244">     {</span>
<a href="#l40.245"></a><span id="l40.245">       MOZ_LOG(IMAP, LogLevel::Debug, (&quot;FetchMessage peek: curFetchSize %u numBytes %u&quot;,</span>
<a href="#l40.246"></a><span id="l40.246">                                   m_curFetchSize, numBytes));</span>
<a href="#l40.247"></a><span id="l40.247">       if (numBytes &gt; 0)</span>
<a href="#l40.248"></a><span id="l40.248" class="difflineat">@@ -3485,17 +3485,17 @@ nsImapProtocol::FetchMessage(const nsCSt</span>
<a href="#l40.249"></a><span id="l40.249">         // if we are retrieving chunks</span>
<a href="#l40.250"></a><span id="l40.250">         char *byterangeString = PR_smprintf(&quot;&lt;%ld.%ld&gt;&quot;,startByte, numBytes);</span>
<a href="#l40.251"></a><span id="l40.251">         if (byterangeString)</span>
<a href="#l40.252"></a><span id="l40.252">         {</span>
<a href="#l40.253"></a><span id="l40.253">           commandString.Append(byterangeString);</span>
<a href="#l40.254"></a><span id="l40.254">           PR_Free(byterangeString);</span>
<a href="#l40.255"></a><span id="l40.255">         }</span>
<a href="#l40.256"></a><span id="l40.256">       }</span>
<a href="#l40.257"></a><span id="l40.257" class="difflineminus">-      commandString.Append(&quot;)&quot;);</span>
<a href="#l40.258"></a><span id="l40.258" class="difflineplus">+      commandString.Append(')');</span>
<a href="#l40.259"></a><span id="l40.259">     }</span>
<a href="#l40.260"></a><span id="l40.260">     break;</span>
<a href="#l40.261"></a><span id="l40.261">   case kHeadersRFC822andUid:</span>
<a href="#l40.262"></a><span id="l40.262">     if (GetServerStateParser().ServerHasIMAP4Rev1Capability())</span>
<a href="#l40.263"></a><span id="l40.263">     {</span>
<a href="#l40.264"></a><span id="l40.264">       eIMAPCapabilityFlags server_capabilityFlags = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l40.265"></a><span id="l40.265">       bool aolImapServer = ((server_capabilityFlags &amp; kAOLImapCapability) != 0);</span>
<a href="#l40.266"></a><span id="l40.266">       bool downloadAllHeaders = false;</span>
<a href="#l40.267"></a><span id="l40.267" class="difflineat">@@ -3534,98 +3534,98 @@ nsImapProtocol::FetchMessage(const nsCSt</span>
<a href="#l40.268"></a><span id="l40.268"> </span>
<a href="#l40.269"></a><span id="l40.269">         if (gUseEnvelopeCmd)</span>
<a href="#l40.270"></a><span id="l40.270">           what = PR_smprintf(&quot; ENVELOPE BODY.PEEK[HEADER.FIELDS (%s)])&quot;, headersToDL);</span>
<a href="#l40.271"></a><span id="l40.271">         else</span>
<a href="#l40.272"></a><span id="l40.272">           what = PR_smprintf(&quot; BODY.PEEK[HEADER.FIELDS (%s)])&quot;,headersToDL);</span>
<a href="#l40.273"></a><span id="l40.273">         NS_Free(headersToDL);</span>
<a href="#l40.274"></a><span id="l40.274">         if (what)</span>
<a href="#l40.275"></a><span id="l40.275">         {</span>
<a href="#l40.276"></a><span id="l40.276" class="difflineminus">-          commandString.Append(&quot; %s (UID &quot;);</span>
<a href="#l40.277"></a><span id="l40.277" class="difflineplus">+          commandString.AppendLiteral(&quot; %s (UID &quot;);</span>
<a href="#l40.278"></a><span id="l40.278">            if (m_isGmailServer)</span>
<a href="#l40.279"></a><span id="l40.279" class="difflineminus">-            commandString.Append(&quot;X-GM-MSGID X-GM-THRID X-GM-LABELS &quot;);</span>
<a href="#l40.280"></a><span id="l40.280" class="difflineplus">+            commandString.AppendLiteral(&quot;X-GM-MSGID X-GM-THRID X-GM-LABELS &quot;);</span>
<a href="#l40.281"></a><span id="l40.281">           if (aolImapServer)</span>
<a href="#l40.282"></a><span id="l40.282" class="difflineminus">-            commandString.Append(&quot; XAOL.SIZE&quot;) ;</span>
<a href="#l40.283"></a><span id="l40.283" class="difflineplus">+            commandString.AppendLiteral(&quot; XAOL.SIZE&quot;) ;</span>
<a href="#l40.284"></a><span id="l40.284">           else</span>
<a href="#l40.285"></a><span id="l40.285" class="difflineminus">-            commandString.Append(&quot;RFC822.SIZE&quot;);</span>
<a href="#l40.286"></a><span id="l40.286" class="difflineminus">-          commandString.Append(&quot; FLAGS&quot;);</span>
<a href="#l40.287"></a><span id="l40.287" class="difflineplus">+            commandString.AppendLiteral(&quot;RFC822.SIZE&quot;);</span>
<a href="#l40.288"></a><span id="l40.288" class="difflineplus">+          commandString.AppendLiteral(&quot; FLAGS&quot;);</span>
<a href="#l40.289"></a><span id="l40.289">           commandString.Append(what);</span>
<a href="#l40.290"></a><span id="l40.290">           PR_Free(what);</span>
<a href="#l40.291"></a><span id="l40.291">         }</span>
<a href="#l40.292"></a><span id="l40.292">         else</span>
<a href="#l40.293"></a><span id="l40.293">         {</span>
<a href="#l40.294"></a><span id="l40.294" class="difflineminus">-          commandString.Append(&quot; %s (UID RFC822.SIZE BODY.PEEK[HEADER] FLAGS)&quot;);</span>
<a href="#l40.295"></a><span id="l40.295" class="difflineplus">+          commandString.AppendLiteral(&quot; %s (UID RFC822.SIZE BODY.PEEK[HEADER] FLAGS)&quot;);</span>
<a href="#l40.296"></a><span id="l40.296">         }</span>
<a href="#l40.297"></a><span id="l40.297">       }</span>
<a href="#l40.298"></a><span id="l40.298">       else</span>
<a href="#l40.299"></a><span id="l40.299" class="difflineminus">-        commandString.Append(&quot; %s (UID RFC822.SIZE BODY.PEEK[HEADER] FLAGS)&quot;);</span>
<a href="#l40.300"></a><span id="l40.300" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (UID RFC822.SIZE BODY.PEEK[HEADER] FLAGS)&quot;);</span>
<a href="#l40.301"></a><span id="l40.301">     }</span>
<a href="#l40.302"></a><span id="l40.302">     else</span>
<a href="#l40.303"></a><span id="l40.303" class="difflineminus">-      commandString.Append(&quot; %s (UID RFC822.SIZE RFC822.HEADER FLAGS)&quot;);</span>
<a href="#l40.304"></a><span id="l40.304" class="difflineplus">+      commandString.AppendLiteral(&quot; %s (UID RFC822.SIZE RFC822.HEADER FLAGS)&quot;);</span>
<a href="#l40.305"></a><span id="l40.305">     break;</span>
<a href="#l40.306"></a><span id="l40.306">   case kUid:</span>
<a href="#l40.307"></a><span id="l40.307" class="difflineminus">-    commandString.Append(&quot; %s (UID)&quot;);</span>
<a href="#l40.308"></a><span id="l40.308" class="difflineplus">+    commandString.AppendLiteral(&quot; %s (UID)&quot;);</span>
<a href="#l40.309"></a><span id="l40.309">     break;</span>
<a href="#l40.310"></a><span id="l40.310">   case kFlags:</span>
<a href="#l40.311"></a><span id="l40.311">     GetServerStateParser().SetFetchingFlags(true);</span>
<a href="#l40.312"></a><span id="l40.312" class="difflineminus">-    commandString.Append(&quot; %s (FLAGS)&quot;);</span>
<a href="#l40.313"></a><span id="l40.313" class="difflineplus">+    commandString.AppendLiteral(&quot; %s (FLAGS)&quot;);</span>
<a href="#l40.314"></a><span id="l40.314">     break;</span>
<a href="#l40.315"></a><span id="l40.315">   case kRFC822Size:</span>
<a href="#l40.316"></a><span id="l40.316" class="difflineminus">-    commandString.Append(&quot; %s (RFC822.SIZE)&quot;);</span>
<a href="#l40.317"></a><span id="l40.317" class="difflineplus">+    commandString.AppendLiteral(&quot; %s (RFC822.SIZE)&quot;);</span>
<a href="#l40.318"></a><span id="l40.318">     break;</span>
<a href="#l40.319"></a><span id="l40.319">   case kBodyStart:</span>
<a href="#l40.320"></a><span id="l40.320">     {</span>
<a href="#l40.321"></a><span id="l40.321">       int32_t numBytesToFetch;</span>
<a href="#l40.322"></a><span id="l40.322">       m_runningUrl-&gt;GetNumBytesToFetch(&amp;numBytesToFetch);</span>
<a href="#l40.323"></a><span id="l40.323"> </span>
<a href="#l40.324"></a><span id="l40.324" class="difflineminus">-      commandString.Append(&quot; %s (UID BODY.PEEK[HEADER.FIELDS (Content-Type Content-Transfer-Encoding)] BODY.PEEK[TEXT]&lt;0.&quot;);</span>
<a href="#l40.325"></a><span id="l40.325" class="difflineplus">+      commandString.AppendLiteral(&quot; %s (UID BODY.PEEK[HEADER.FIELDS (Content-Type Content-Transfer-Encoding)] BODY.PEEK[TEXT]&lt;0.&quot;);</span>
<a href="#l40.326"></a><span id="l40.326">       commandString.AppendInt(numBytesToFetch);</span>
<a href="#l40.327"></a><span id="l40.327" class="difflineminus">-      commandString.Append(&quot;&gt;)&quot;);</span>
<a href="#l40.328"></a><span id="l40.328" class="difflineplus">+      commandString.AppendLiteral(&quot;&gt;)&quot;);</span>
<a href="#l40.329"></a><span id="l40.329">     }</span>
<a href="#l40.330"></a><span id="l40.330">     break;</span>
<a href="#l40.331"></a><span id="l40.331">   case kRFC822HeadersOnly:</span>
<a href="#l40.332"></a><span id="l40.332">     if (GetServerStateParser().ServerHasIMAP4Rev1Capability())</span>
<a href="#l40.333"></a><span id="l40.333">     {</span>
<a href="#l40.334"></a><span id="l40.334">       if (part)</span>
<a href="#l40.335"></a><span id="l40.335">       {</span>
<a href="#l40.336"></a><span id="l40.336" class="difflineminus">-        commandString.Append(&quot; %s (BODY[&quot;);</span>
<a href="#l40.337"></a><span id="l40.337" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (BODY[&quot;);</span>
<a href="#l40.338"></a><span id="l40.338">         char *what = PR_smprintf(&quot;%s.HEADER])&quot;, part);</span>
<a href="#l40.339"></a><span id="l40.339">         if (what)</span>
<a href="#l40.340"></a><span id="l40.340">         {</span>
<a href="#l40.341"></a><span id="l40.341">           commandString.Append(what);</span>
<a href="#l40.342"></a><span id="l40.342">           PR_Free(what);</span>
<a href="#l40.343"></a><span id="l40.343">         }</span>
<a href="#l40.344"></a><span id="l40.344">         else</span>
<a href="#l40.345"></a><span id="l40.345">           HandleMemoryFailure();</span>
<a href="#l40.346"></a><span id="l40.346">       }</span>
<a href="#l40.347"></a><span id="l40.347">       else</span>
<a href="#l40.348"></a><span id="l40.348">       {</span>
<a href="#l40.349"></a><span id="l40.349">         // headers for the top-level message</span>
<a href="#l40.350"></a><span id="l40.350" class="difflineminus">-        commandString.Append(&quot; %s (BODY[HEADER])&quot;);</span>
<a href="#l40.351"></a><span id="l40.351" class="difflineplus">+        commandString.AppendLiteral(&quot; %s (BODY[HEADER])&quot;);</span>
<a href="#l40.352"></a><span id="l40.352">       }</span>
<a href="#l40.353"></a><span id="l40.353">     }</span>
<a href="#l40.354"></a><span id="l40.354">     else</span>
<a href="#l40.355"></a><span id="l40.355" class="difflineminus">-      commandString.Append(&quot; %s (RFC822.HEADER)&quot;);</span>
<a href="#l40.356"></a><span id="l40.356" class="difflineplus">+      commandString.AppendLiteral(&quot; %s (RFC822.HEADER)&quot;);</span>
<a href="#l40.357"></a><span id="l40.357">     break;</span>
<a href="#l40.358"></a><span id="l40.358">   case kMIMEPart:</span>
<a href="#l40.359"></a><span id="l40.359" class="difflineminus">-    commandString.Append(&quot; %s (BODY.PEEK[%s]&quot;);</span>
<a href="#l40.360"></a><span id="l40.360" class="difflineplus">+    commandString.AppendLiteral(&quot; %s (BODY.PEEK[%s]&quot;);</span>
<a href="#l40.361"></a><span id="l40.361">     if (numBytes &gt; 0)</span>
<a href="#l40.362"></a><span id="l40.362">     {</span>
<a href="#l40.363"></a><span id="l40.363">       // if we are retrieving chunks</span>
<a href="#l40.364"></a><span id="l40.364">       char *byterangeString = PR_smprintf(&quot;&lt;%ld.%ld&gt;&quot;,startByte, numBytes);</span>
<a href="#l40.365"></a><span id="l40.365">       if (byterangeString)</span>
<a href="#l40.366"></a><span id="l40.366">       {</span>
<a href="#l40.367"></a><span id="l40.367">         commandString.Append(byterangeString);</span>
<a href="#l40.368"></a><span id="l40.368">         PR_Free(byterangeString);</span>
<a href="#l40.369"></a><span id="l40.369">       }</span>
<a href="#l40.370"></a><span id="l40.370">     }</span>
<a href="#l40.371"></a><span id="l40.371" class="difflineminus">-    commandString.Append(&quot;)&quot;);</span>
<a href="#l40.372"></a><span id="l40.372" class="difflineplus">+    commandString.Append(')');</span>
<a href="#l40.373"></a><span id="l40.373">     break;</span>
<a href="#l40.374"></a><span id="l40.374">   case kMIMEHeader:</span>
<a href="#l40.375"></a><span id="l40.375" class="difflineminus">-    commandString.Append(&quot; %s (BODY[%s.MIME])&quot;);</span>
<a href="#l40.376"></a><span id="l40.376" class="difflineplus">+    commandString.AppendLiteral(&quot; %s (BODY[%s.MIME])&quot;);</span>
<a href="#l40.377"></a><span id="l40.377">     break;</span>
<a href="#l40.378"></a><span id="l40.378">   }</span>
<a href="#l40.379"></a><span id="l40.379"> </span>
<a href="#l40.380"></a><span id="l40.380">   if (fetchModifier)</span>
<a href="#l40.381"></a><span id="l40.381">     commandString.Append(fetchModifier);</span>
<a href="#l40.382"></a><span id="l40.382"> </span>
<a href="#l40.383"></a><span id="l40.383">   commandString.Append(CRLF);</span>
<a href="#l40.384"></a><span id="l40.384"> </span>
<a href="#l40.385"></a><span id="l40.385" class="difflineat">@@ -4194,17 +4194,17 @@ void nsImapProtocol::ProcessMailboxUpdat</span>
<a href="#l40.386"></a><span id="l40.386">     {</span>
<a href="#l40.387"></a><span id="l40.387">       uint32_t highestRecordedUID = GetServerStateParser().HighestRecordedUID();</span>
<a href="#l40.388"></a><span id="l40.388">       // if we're using CONDSTORE, and the parser hasn't seen any UIDs, use</span>
<a href="#l40.389"></a><span id="l40.389">       // the highest UID we've seen from the folder.</span>
<a href="#l40.390"></a><span id="l40.390">       if (UseCondStore() &amp;&amp; !highestRecordedUID)</span>
<a href="#l40.391"></a><span id="l40.391">         highestRecordedUID = mFolderHighestUID;</span>
<a href="#l40.392"></a><span id="l40.392"> </span>
<a href="#l40.393"></a><span id="l40.393">       AppendUid(fetchStr, highestRecordedUID + 1);</span>
<a href="#l40.394"></a><span id="l40.394" class="difflineminus">-      fetchStr.Append(&quot;:*&quot;);</span>
<a href="#l40.395"></a><span id="l40.395" class="difflineplus">+      fetchStr.AppendLiteral(&quot;:*&quot;);</span>
<a href="#l40.396"></a><span id="l40.396">       FetchMessage(fetchStr, kFlags);      // only new messages please</span>
<a href="#l40.397"></a><span id="l40.397">     }</span>
<a href="#l40.398"></a><span id="l40.398">   }</span>
<a href="#l40.399"></a><span id="l40.399">   else if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l40.400"></a><span id="l40.400">   {</span>
<a href="#l40.401"></a><span id="l40.401">     GetServerStateParser().ResetFlagInfo();</span>
<a href="#l40.402"></a><span id="l40.402">     // the flag state is empty, but not partial.</span>
<a href="#l40.403"></a><span id="l40.403">     m_flagState-&gt;SetPartialUIDFetch(false);</span>
<a href="#l40.404"></a><span id="l40.404" class="difflineat">@@ -4422,17 +4422,17 @@ void nsImapProtocol::PeriodicBiff()</span>
<a href="#l40.405"></a><span id="l40.405"> </span>
<a href="#l40.406"></a><span id="l40.406">       deleted = m_flagState-&gt;NumberOfDeletedMessages();</span>
<a href="#l40.407"></a><span id="l40.407">       added = numMessages;</span>
<a href="#l40.408"></a><span id="l40.408">       if (!added || (added == deleted)) // empty keys, get them all</span>
<a href="#l40.409"></a><span id="l40.409">         id = 1;</span>
<a href="#l40.410"></a><span id="l40.410"> </span>
<a href="#l40.411"></a><span id="l40.411">       //sprintf(fetchStr, &quot;%ld:%ld&quot;, id, id + GetServerStateParser().NumberOfMessages() - fFlagState-&gt;GetNumberOfMessages());</span>
<a href="#l40.412"></a><span id="l40.412">       AppendUid(fetchStr, id);</span>
<a href="#l40.413"></a><span id="l40.413" class="difflineminus">-      fetchStr.Append(&quot;:*&quot;);</span>
<a href="#l40.414"></a><span id="l40.414" class="difflineplus">+      fetchStr.AppendLiteral(&quot;:*&quot;);</span>
<a href="#l40.415"></a><span id="l40.415">       FetchMessage(fetchStr, kFlags);</span>
<a href="#l40.416"></a><span id="l40.416">       if (((uint32_t) m_flagState-&gt;GetHighestNonDeletedUID() &gt;= id) &amp;&amp; m_flagState-&gt;IsLastMessageUnseen())</span>
<a href="#l40.417"></a><span id="l40.417">         m_currentBiffState = nsIMsgFolder::nsMsgBiffState_NewMail;</span>
<a href="#l40.418"></a><span id="l40.418">       else</span>
<a href="#l40.419"></a><span id="l40.419">         m_currentBiffState = nsIMsgFolder::nsMsgBiffState_NoMail;</span>
<a href="#l40.420"></a><span id="l40.420">     }</span>
<a href="#l40.421"></a><span id="l40.421">     else</span>
<a href="#l40.422"></a><span id="l40.422">       m_currentBiffState = nsIMsgFolder::nsMsgBiffState_NoMail;</span>
<a href="#l40.423"></a><span id="l40.423" class="difflineat">@@ -5371,17 +5371,17 @@ nsImapProtocol::IssueUserDefinedMsgComma</span>
<a href="#l40.424"></a><span id="l40.424">     HandleMemoryFailure();</span>
<a href="#l40.425"></a><span id="l40.425"> }</span>
<a href="#l40.426"></a><span id="l40.426"> </span>
<a href="#l40.427"></a><span id="l40.427"> void</span>
<a href="#l40.428"></a><span id="l40.428"> nsImapProtocol::UidExpunge(const nsCString &amp;messageSet)</span>
<a href="#l40.429"></a><span id="l40.429"> {</span>
<a href="#l40.430"></a><span id="l40.430">     IncrementCommandTagNumber();</span>
<a href="#l40.431"></a><span id="l40.431">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.432"></a><span id="l40.432" class="difflineminus">-    command.Append(&quot; uid expunge &quot;);</span>
<a href="#l40.433"></a><span id="l40.433" class="difflineplus">+    command.AppendLiteral(&quot; uid expunge &quot;);</span>
<a href="#l40.434"></a><span id="l40.434">     command.Append(messageSet);</span>
<a href="#l40.435"></a><span id="l40.435">     command.Append(CRLF);</span>
<a href="#l40.436"></a><span id="l40.436">     nsresult rv = SendData(command.get());</span>
<a href="#l40.437"></a><span id="l40.437">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.438"></a><span id="l40.438">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.439"></a><span id="l40.439"> }</span>
<a href="#l40.440"></a><span id="l40.440"> </span>
<a href="#l40.441"></a><span id="l40.441"> void</span>
<a href="#l40.442"></a><span id="l40.442" class="difflineat">@@ -5406,17 +5406,17 @@ nsImapProtocol::Expunge()</span>
<a href="#l40.443"></a><span id="l40.443">       delete search;</span>
<a href="#l40.444"></a><span id="l40.444">       if (key == 0)</span>
<a href="#l40.445"></a><span id="l40.445">         return;  //no deleted messages to expunge (bug 235004)</span>
<a href="#l40.446"></a><span id="l40.446">     }</span>
<a href="#l40.447"></a><span id="l40.447">   }</span>
<a href="#l40.448"></a><span id="l40.448"> </span>
<a href="#l40.449"></a><span id="l40.449">   IncrementCommandTagNumber();</span>
<a href="#l40.450"></a><span id="l40.450">   nsAutoCString command(GetServerCommandTag());</span>
<a href="#l40.451"></a><span id="l40.451" class="difflineminus">-  command.Append(&quot; expunge&quot; CRLF);</span>
<a href="#l40.452"></a><span id="l40.452" class="difflineplus">+  command.AppendLiteral(&quot; expunge&quot; CRLF);</span>
<a href="#l40.453"></a><span id="l40.453"> </span>
<a href="#l40.454"></a><span id="l40.454">   nsresult rv = SendData(command.get());</span>
<a href="#l40.455"></a><span id="l40.455">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.456"></a><span id="l40.456">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.457"></a><span id="l40.457"> }</span>
<a href="#l40.458"></a><span id="l40.458"> </span>
<a href="#l40.459"></a><span id="l40.459"> void</span>
<a href="#l40.460"></a><span id="l40.460"> nsImapProtocol::HandleMemoryFailure()</span>
<a href="#l40.461"></a><span id="l40.461" class="difflineat">@@ -5441,31 +5441,31 @@ void nsImapProtocol::HandleCurrentUrlErr</span>
<a href="#l40.462"></a><span id="l40.462">   }</span>
<a href="#l40.463"></a><span id="l40.463"> }</span>
<a href="#l40.464"></a><span id="l40.464"> </span>
<a href="#l40.465"></a><span id="l40.465"> void nsImapProtocol::StartTLS()</span>
<a href="#l40.466"></a><span id="l40.466"> {</span>
<a href="#l40.467"></a><span id="l40.467">     IncrementCommandTagNumber();</span>
<a href="#l40.468"></a><span id="l40.468">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.469"></a><span id="l40.469"> </span>
<a href="#l40.470"></a><span id="l40.470" class="difflineminus">-    command.Append(&quot; STARTTLS&quot; CRLF);</span>
<a href="#l40.471"></a><span id="l40.471" class="difflineplus">+    command.AppendLiteral(&quot; STARTTLS&quot; CRLF);</span>
<a href="#l40.472"></a><span id="l40.472"> </span>
<a href="#l40.473"></a><span id="l40.473">     nsresult rv = SendData(command.get());</span>
<a href="#l40.474"></a><span id="l40.474">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.475"></a><span id="l40.475">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.476"></a><span id="l40.476"> }</span>
<a href="#l40.477"></a><span id="l40.477"> </span>
<a href="#l40.478"></a><span id="l40.478"> void nsImapProtocol::Capability()</span>
<a href="#l40.479"></a><span id="l40.479"> {</span>
<a href="#l40.480"></a><span id="l40.480"> </span>
<a href="#l40.481"></a><span id="l40.481">     ProgressEventFunctionUsingName(&quot;imapStatusCheckCompat&quot;);</span>
<a href="#l40.482"></a><span id="l40.482">     IncrementCommandTagNumber();</span>
<a href="#l40.483"></a><span id="l40.483">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.484"></a><span id="l40.484"> </span>
<a href="#l40.485"></a><span id="l40.485" class="difflineminus">-    command.Append(&quot; capability&quot; CRLF);</span>
<a href="#l40.486"></a><span id="l40.486" class="difflineplus">+    command.AppendLiteral(&quot; capability&quot; CRLF);</span>
<a href="#l40.487"></a><span id="l40.487"> </span>
<a href="#l40.488"></a><span id="l40.488">     nsresult rv = SendData(command.get());</span>
<a href="#l40.489"></a><span id="l40.489">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.490"></a><span id="l40.490">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.491"></a><span id="l40.491">     if (!gUseLiteralPlus)</span>
<a href="#l40.492"></a><span id="l40.492">     {</span>
<a href="#l40.493"></a><span id="l40.493">       eIMAPCapabilityFlags capabilityFlag = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l40.494"></a><span id="l40.494">       if (capabilityFlag &amp; kLiteralPlusCapability)</span>
<a href="#l40.495"></a><span id="l40.495" class="difflineat">@@ -5476,49 +5476,49 @@ void nsImapProtocol::Capability()</span>
<a href="#l40.496"></a><span id="l40.496"> }</span>
<a href="#l40.497"></a><span id="l40.497"> </span>
<a href="#l40.498"></a><span id="l40.498"> void nsImapProtocol::ID()</span>
<a href="#l40.499"></a><span id="l40.499"> {</span>
<a href="#l40.500"></a><span id="l40.500">   if (!gAppName[0])</span>
<a href="#l40.501"></a><span id="l40.501">     return;</span>
<a href="#l40.502"></a><span id="l40.502">   IncrementCommandTagNumber();</span>
<a href="#l40.503"></a><span id="l40.503">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.504"></a><span id="l40.504" class="difflineminus">-  command.Append(&quot; ID (\&quot;name\&quot; \&quot;&quot;);</span>
<a href="#l40.505"></a><span id="l40.505" class="difflineplus">+  command.AppendLiteral(&quot; ID (\&quot;name\&quot; \&quot;&quot;);</span>
<a href="#l40.506"></a><span id="l40.506">   command.Append(gAppName);</span>
<a href="#l40.507"></a><span id="l40.507" class="difflineminus">-  command.Append(&quot;\&quot; \&quot;version\&quot; \&quot;&quot;);</span>
<a href="#l40.508"></a><span id="l40.508" class="difflineplus">+  command.AppendLiteral(&quot;\&quot; \&quot;version\&quot; \&quot;&quot;);</span>
<a href="#l40.509"></a><span id="l40.509">   command.Append(gAppVersion);</span>
<a href="#l40.510"></a><span id="l40.510" class="difflineminus">-  command.Append(&quot;\&quot;)&quot; CRLF);</span>
<a href="#l40.511"></a><span id="l40.511" class="difflineplus">+  command.AppendLiteral(&quot;\&quot;)&quot; CRLF);</span>
<a href="#l40.512"></a><span id="l40.512"> </span>
<a href="#l40.513"></a><span id="l40.513">   nsresult rv = SendData(command.get());</span>
<a href="#l40.514"></a><span id="l40.514">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.515"></a><span id="l40.515">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.516"></a><span id="l40.516"> }</span>
<a href="#l40.517"></a><span id="l40.517"> </span>
<a href="#l40.518"></a><span id="l40.518"> void nsImapProtocol::EnableCondStore()</span>
<a href="#l40.519"></a><span id="l40.519"> {</span>
<a href="#l40.520"></a><span id="l40.520">   IncrementCommandTagNumber();</span>
<a href="#l40.521"></a><span id="l40.521">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.522"></a><span id="l40.522"> </span>
<a href="#l40.523"></a><span id="l40.523" class="difflineminus">-  command.Append(&quot; ENABLE CONDSTORE&quot; CRLF);</span>
<a href="#l40.524"></a><span id="l40.524" class="difflineplus">+  command.AppendLiteral(&quot; ENABLE CONDSTORE&quot; CRLF);</span>
<a href="#l40.525"></a><span id="l40.525"> </span>
<a href="#l40.526"></a><span id="l40.526">   nsresult rv = SendData(command.get());</span>
<a href="#l40.527"></a><span id="l40.527">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.528"></a><span id="l40.528">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.529"></a><span id="l40.529"> }</span>
<a href="#l40.530"></a><span id="l40.530"> </span>
<a href="#l40.531"></a><span id="l40.531"> void nsImapProtocol::StartCompressDeflate()</span>
<a href="#l40.532"></a><span id="l40.532"> {</span>
<a href="#l40.533"></a><span id="l40.533">   // only issue a compression request if we haven't already</span>
<a href="#l40.534"></a><span id="l40.534">   if (!TestFlag(IMAP_ISSUED_COMPRESS_REQUEST))</span>
<a href="#l40.535"></a><span id="l40.535">   {</span>
<a href="#l40.536"></a><span id="l40.536">     SetFlag(IMAP_ISSUED_COMPRESS_REQUEST);</span>
<a href="#l40.537"></a><span id="l40.537">     IncrementCommandTagNumber();</span>
<a href="#l40.538"></a><span id="l40.538">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.539"></a><span id="l40.539"> </span>
<a href="#l40.540"></a><span id="l40.540" class="difflineminus">-    command.Append(&quot; COMPRESS DEFLATE&quot; CRLF);</span>
<a href="#l40.541"></a><span id="l40.541" class="difflineplus">+    command.AppendLiteral(&quot; COMPRESS DEFLATE&quot; CRLF);</span>
<a href="#l40.542"></a><span id="l40.542"> </span>
<a href="#l40.543"></a><span id="l40.543">     nsresult rv = SendData(command.get());</span>
<a href="#l40.544"></a><span id="l40.544">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.545"></a><span id="l40.545">     {</span>
<a href="#l40.546"></a><span id="l40.546">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.547"></a><span id="l40.547">       if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l40.548"></a><span id="l40.548">       {</span>
<a href="#l40.549"></a><span id="l40.549">         rv = BeginCompressing();</span>
<a href="#l40.550"></a><span id="l40.550" class="difflineat">@@ -5581,17 +5581,17 @@ void nsImapProtocol::Language()</span>
<a href="#l40.551"></a><span id="l40.551">       LossyCopyUTF16toASCII(mAcceptLanguages, extractedLanguage);</span>
<a href="#l40.552"></a><span id="l40.552">       int32_t pos = extractedLanguage.FindChar(',');</span>
<a href="#l40.553"></a><span id="l40.553">       if (pos &gt; 0) // we have a comma separated list of languages...</span>
<a href="#l40.554"></a><span id="l40.554">         extractedLanguage.SetLength(pos); // truncate everything after the first comma (including the comma)</span>
<a href="#l40.555"></a><span id="l40.555"> </span>
<a href="#l40.556"></a><span id="l40.556">       if (extractedLanguage.IsEmpty())</span>
<a href="#l40.557"></a><span id="l40.557">         return;</span>
<a href="#l40.558"></a><span id="l40.558"> </span>
<a href="#l40.559"></a><span id="l40.559" class="difflineminus">-      command.Append(&quot; LANGUAGE &quot;);</span>
<a href="#l40.560"></a><span id="l40.560" class="difflineplus">+      command.AppendLiteral(&quot; LANGUAGE &quot;);</span>
<a href="#l40.561"></a><span id="l40.561">       command.Append(extractedLanguage);</span>
<a href="#l40.562"></a><span id="l40.562">       command.Append(CRLF);</span>
<a href="#l40.563"></a><span id="l40.563"> </span>
<a href="#l40.564"></a><span id="l40.564">       rv = SendData(command.get());</span>
<a href="#l40.565"></a><span id="l40.565">       if (NS_SUCCEEDED(rv))</span>
<a href="#l40.566"></a><span id="l40.566">         ParseIMAPandCheckForNewMail(nullptr, true /* ignore bad or no result from the server for this command */);</span>
<a href="#l40.567"></a><span id="l40.567">     }</span>
<a href="#l40.568"></a><span id="l40.568">   }</span>
<a href="#l40.569"></a><span id="l40.569" class="difflineat">@@ -5753,34 +5753,34 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l40.570"></a><span id="l40.570">   nsresult rv;</span>
<a href="#l40.571"></a><span id="l40.571">   NS_ConvertUTF16toUTF8 password(aPassword);</span>
<a href="#l40.572"></a><span id="l40.572">   MOZ_LOG(IMAP, LogLevel::Debug, (&quot;IMAP: trying auth method 0x%&quot; PRIx64, m_currentAuthMethod));</span>
<a href="#l40.573"></a><span id="l40.573"> </span>
<a href="#l40.574"></a><span id="l40.574">   if (flag &amp; kHasAuthExternalCapability)</span>
<a href="#l40.575"></a><span id="l40.575">   {</span>
<a href="#l40.576"></a><span id="l40.576">       char *base64UserName = PL_Base64Encode(userName, strlen(userName), nullptr);</span>
<a href="#l40.577"></a><span id="l40.577">       nsAutoCString command (GetServerCommandTag());</span>
<a href="#l40.578"></a><span id="l40.578" class="difflineminus">-      command.Append(&quot; authenticate EXTERNAL &quot; );</span>
<a href="#l40.579"></a><span id="l40.579" class="difflineplus">+      command.AppendLiteral(&quot; authenticate EXTERNAL &quot; );</span>
<a href="#l40.580"></a><span id="l40.580">       command.Append(base64UserName);</span>
<a href="#l40.581"></a><span id="l40.581">       command.Append(CRLF);</span>
<a href="#l40.582"></a><span id="l40.582">       PR_Free(base64UserName);</span>
<a href="#l40.583"></a><span id="l40.583">       rv = SendData(command.get());</span>
<a href="#l40.584"></a><span id="l40.584">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.585"></a><span id="l40.585">       nsImapServerResponseParser &amp;parser = GetServerStateParser();</span>
<a href="#l40.586"></a><span id="l40.586">       if (parser.LastCommandSuccessful())</span>
<a href="#l40.587"></a><span id="l40.587">         return NS_OK;</span>
<a href="#l40.588"></a><span id="l40.588">       parser.SetCapabilityFlag(parser.GetCapabilityFlag() &amp; ~kHasAuthExternalCapability);</span>
<a href="#l40.589"></a><span id="l40.589">   }</span>
<a href="#l40.590"></a><span id="l40.590">   else if (flag &amp; kHasCRAMCapability)</span>
<a href="#l40.591"></a><span id="l40.591">   {</span>
<a href="#l40.592"></a><span id="l40.592">     NS_ENSURE_TRUE(m_imapServerSink, NS_ERROR_NULL_POINTER);</span>
<a href="#l40.593"></a><span id="l40.593">     MOZ_LOG(IMAP, LogLevel::Debug, (&quot;MD5 auth&quot;));</span>
<a href="#l40.594"></a><span id="l40.594">     // inform the server that we want to begin a CRAM authentication procedure...</span>
<a href="#l40.595"></a><span id="l40.595">     nsAutoCString command (GetServerCommandTag());</span>
<a href="#l40.596"></a><span id="l40.596" class="difflineminus">-    command.Append(&quot; authenticate CRAM-MD5&quot; CRLF);</span>
<a href="#l40.597"></a><span id="l40.597" class="difflineplus">+    command.AppendLiteral(&quot; authenticate CRAM-MD5&quot; CRLF);</span>
<a href="#l40.598"></a><span id="l40.598">     rv = SendData(command.get());</span>
<a href="#l40.599"></a><span id="l40.599">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.600"></a><span id="l40.600">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.601"></a><span id="l40.601">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l40.602"></a><span id="l40.602">     {</span>
<a href="#l40.603"></a><span id="l40.603">       char *digest = nullptr;</span>
<a href="#l40.604"></a><span id="l40.604">       char *cramDigest = GetServerStateParser().fAuthChallenge;</span>
<a href="#l40.605"></a><span id="l40.605">       char *decodedChallenge = PL_Base64Decode(cramDigest,</span>
<a href="#l40.606"></a><span id="l40.606" class="difflineat">@@ -5821,17 +5821,17 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l40.607"></a><span id="l40.607">     nsAutoCString response;</span>
<a href="#l40.608"></a><span id="l40.608"> </span>
<a href="#l40.609"></a><span id="l40.609">     nsAutoCString service(&quot;imap@&quot;);</span>
<a href="#l40.610"></a><span id="l40.610">     service.Append(m_realHostName);</span>
<a href="#l40.611"></a><span id="l40.611">     rv = DoGSSAPIStep1(service.get(), userName, response);</span>
<a href="#l40.612"></a><span id="l40.612">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.613"></a><span id="l40.613"> </span>
<a href="#l40.614"></a><span id="l40.614">     nsAutoCString command (GetServerCommandTag());</span>
<a href="#l40.615"></a><span id="l40.615" class="difflineminus">-    command.Append(&quot; authenticate GSSAPI&quot; CRLF);</span>
<a href="#l40.616"></a><span id="l40.616" class="difflineplus">+    command.AppendLiteral(&quot; authenticate GSSAPI&quot; CRLF);</span>
<a href="#l40.617"></a><span id="l40.617">     rv = SendData(command.get());</span>
<a href="#l40.618"></a><span id="l40.618">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.619"></a><span id="l40.619"> </span>
<a href="#l40.620"></a><span id="l40.620">     ParseIMAPandCheckForNewMail(&quot;AUTH GSSAPI&quot;);</span>
<a href="#l40.621"></a><span id="l40.621">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l40.622"></a><span id="l40.622">     {</span>
<a href="#l40.623"></a><span id="l40.623">       response += CRLF;</span>
<a href="#l40.624"></a><span id="l40.624">       rv = SendData(response.get());</span>
<a href="#l40.625"></a><span id="l40.625" class="difflineat">@@ -5946,29 +5946,29 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l40.626"></a><span id="l40.626">   } // if has auth login capability</span>
<a href="#l40.627"></a><span id="l40.627">   else if (flag &amp; kHasAuthOldLoginCapability)</span>
<a href="#l40.628"></a><span id="l40.628">   {</span>
<a href="#l40.629"></a><span id="l40.629">     MOZ_LOG(IMAP, LogLevel::Debug, (&quot;old-style auth&quot;));</span>
<a href="#l40.630"></a><span id="l40.630">     ProgressEventFunctionUsingName(&quot;imapStatusSendingLogin&quot;);</span>
<a href="#l40.631"></a><span id="l40.631">     IncrementCommandTagNumber();</span>
<a href="#l40.632"></a><span id="l40.632">     nsCString command (GetServerCommandTag());</span>
<a href="#l40.633"></a><span id="l40.633">     nsAutoCString escapedUserName;</span>
<a href="#l40.634"></a><span id="l40.634" class="difflineminus">-    command.Append(&quot; login \&quot;&quot;);</span>
<a href="#l40.635"></a><span id="l40.635" class="difflineplus">+    command.AppendLiteral(&quot; login \&quot;&quot;);</span>
<a href="#l40.636"></a><span id="l40.636">     EscapeUserNamePasswordString(userName, &amp;escapedUserName);</span>
<a href="#l40.637"></a><span id="l40.637">     command.Append(escapedUserName);</span>
<a href="#l40.638"></a><span id="l40.638" class="difflineminus">-    command.Append(&quot;\&quot; \&quot;&quot;);</span>
<a href="#l40.639"></a><span id="l40.639" class="difflineplus">+    command.AppendLiteral(&quot;\&quot; \&quot;&quot;);</span>
<a href="#l40.640"></a><span id="l40.640"> </span>
<a href="#l40.641"></a><span id="l40.641">     // if the password contains a \, login will fail</span>
<a href="#l40.642"></a><span id="l40.642">     // turn foo\bar into foo\\bar</span>
<a href="#l40.643"></a><span id="l40.643">     nsAutoCString correctedPassword;</span>
<a href="#l40.644"></a><span id="l40.644">     // We're assuming old style login doesn't want UTF-8</span>
<a href="#l40.645"></a><span id="l40.645">     EscapeUserNamePasswordString(NS_LossyConvertUTF16toASCII(aPassword).get(),</span>
<a href="#l40.646"></a><span id="l40.646">                                  &amp;correctedPassword);</span>
<a href="#l40.647"></a><span id="l40.647">     command.Append(correctedPassword);</span>
<a href="#l40.648"></a><span id="l40.648" class="difflineminus">-    command.Append(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.649"></a><span id="l40.649" class="difflineplus">+    command.AppendLiteral(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.650"></a><span id="l40.650">     rv = SendData(command.get(), true /* suppress logging */);</span>
<a href="#l40.651"></a><span id="l40.651">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.652"></a><span id="l40.652">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.653"></a><span id="l40.653">   }</span>
<a href="#l40.654"></a><span id="l40.654">   else if (flag &amp; kHasXOAuth2Capability)</span>
<a href="#l40.655"></a><span id="l40.655">   {</span>
<a href="#l40.656"></a><span id="l40.656">     MOZ_LOG(IMAP, LogLevel::Debug, (&quot;XOAUTH2 auth&quot;));</span>
<a href="#l40.657"></a><span id="l40.657"> </span>
<a href="#l40.658"></a><span id="l40.658" class="difflineat">@@ -6102,36 +6102,36 @@ void nsImapProtocol::UploadMessageFromFi</span>
<a href="#l40.659"></a><span id="l40.659">   nsCString flagString;</span>
<a href="#l40.660"></a><span id="l40.660">   bool hasLiteralPlus = (GetServerStateParser().GetCapabilityFlag() &amp;</span>
<a href="#l40.661"></a><span id="l40.661">     kLiteralPlusCapability);</span>
<a href="#l40.662"></a><span id="l40.662"> </span>
<a href="#l40.663"></a><span id="l40.663">   nsCOMPtr &lt;nsIInputStream&gt; fileInputStream;</span>
<a href="#l40.664"></a><span id="l40.664"> </span>
<a href="#l40.665"></a><span id="l40.665">   if (!escapedName.IsEmpty())</span>
<a href="#l40.666"></a><span id="l40.666">   {</span>
<a href="#l40.667"></a><span id="l40.667" class="difflineminus">-    command.Append(&quot; append \&quot;&quot;);</span>
<a href="#l40.668"></a><span id="l40.668" class="difflineplus">+    command.AppendLiteral(&quot; append \&quot;&quot;);</span>
<a href="#l40.669"></a><span id="l40.669">     command.Append(escapedName);</span>
<a href="#l40.670"></a><span id="l40.670" class="difflineminus">-    command.Append(&quot;\&quot;&quot;);</span>
<a href="#l40.671"></a><span id="l40.671" class="difflineplus">+    command.Append('&quot;');</span>
<a href="#l40.672"></a><span id="l40.672">     if (flags || keywords.Length())</span>
<a href="#l40.673"></a><span id="l40.673">     {</span>
<a href="#l40.674"></a><span id="l40.674" class="difflineminus">-      command.Append(&quot; (&quot;);</span>
<a href="#l40.675"></a><span id="l40.675" class="difflineplus">+      command.AppendLiteral(&quot; (&quot;);</span>
<a href="#l40.676"></a><span id="l40.676"> </span>
<a href="#l40.677"></a><span id="l40.677">       if (flags)</span>
<a href="#l40.678"></a><span id="l40.678">       {</span>
<a href="#l40.679"></a><span id="l40.679">         SetupMessageFlagsString(flagString, flags,</span>
<a href="#l40.680"></a><span id="l40.680">           GetServerStateParser().SupportsUserFlags());</span>
<a href="#l40.681"></a><span id="l40.681">         command.Append(flagString);</span>
<a href="#l40.682"></a><span id="l40.682">       }</span>
<a href="#l40.683"></a><span id="l40.683">       if (keywords.Length())</span>
<a href="#l40.684"></a><span id="l40.684">       {</span>
<a href="#l40.685"></a><span id="l40.685">         if (flags)</span>
<a href="#l40.686"></a><span id="l40.686">           command.Append(' ');</span>
<a href="#l40.687"></a><span id="l40.687">         command.Append(keywords);</span>
<a href="#l40.688"></a><span id="l40.688">       }</span>
<a href="#l40.689"></a><span id="l40.689" class="difflineminus">-      command.Append(&quot;)&quot;);</span>
<a href="#l40.690"></a><span id="l40.690" class="difflineplus">+      command.Append(')');</span>
<a href="#l40.691"></a><span id="l40.691">     }</span>
<a href="#l40.692"></a><span id="l40.692"> </span>
<a href="#l40.693"></a><span id="l40.693">     // date should never be 0, but just in case...</span>
<a href="#l40.694"></a><span id="l40.694">     if (date)</span>
<a href="#l40.695"></a><span id="l40.695">     {</span>
<a href="#l40.696"></a><span id="l40.696">       /* Use PR_FormatTimeUSEnglish() to format the date in US English format,</span>
<a href="#l40.697"></a><span id="l40.697">         then figure out what our local GMT offset is, and append it (since</span>
<a href="#l40.698"></a><span id="l40.698">         PR_FormatTimeUSEnglish() can't do that.) Generate four digit years as</span>
<a href="#l40.699"></a><span id="l40.699" class="difflineat">@@ -6149,30 +6149,30 @@ void nsImapProtocol::UploadMessageFromFi</span>
<a href="#l40.700"></a><span id="l40.700">                             &quot; \&quot;%s %c%02d%02d\&quot;&quot;,</span>
<a href="#l40.701"></a><span id="l40.701">                             szDateTime,</span>
<a href="#l40.702"></a><span id="l40.702">                             (gmtoffset &gt;= 0 ? '+' : '-'),</span>
<a href="#l40.703"></a><span id="l40.703">                             ((gmtoffset &gt;= 0 ? gmtoffset : -gmtoffset) / 60),</span>
<a href="#l40.704"></a><span id="l40.704">                             ((gmtoffset &gt;= 0 ? gmtoffset : -gmtoffset) % 60));</span>
<a href="#l40.705"></a><span id="l40.705"> </span>
<a href="#l40.706"></a><span id="l40.706">       command.Append(dateStr);</span>
<a href="#l40.707"></a><span id="l40.707">     }</span>
<a href="#l40.708"></a><span id="l40.708" class="difflineminus">-    command.Append(&quot; {&quot;);</span>
<a href="#l40.709"></a><span id="l40.709" class="difflineplus">+    command.AppendLiteral(&quot; {&quot;);</span>
<a href="#l40.710"></a><span id="l40.710"> </span>
<a href="#l40.711"></a><span id="l40.711">     dataBuffer = (char*) PR_CALLOC(COPY_BUFFER_SIZE+1);</span>
<a href="#l40.712"></a><span id="l40.712">     if (!dataBuffer) goto done;</span>
<a href="#l40.713"></a><span id="l40.713">     rv = file-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l40.714"></a><span id="l40.714">     NS_ASSERTION(fileSize, &quot;got empty file in UploadMessageFromFile&quot;);</span>
<a href="#l40.715"></a><span id="l40.715">     if (NS_FAILED(rv) || !fileSize) goto done;</span>
<a href="#l40.716"></a><span id="l40.716">     rv = NS_NewLocalFileInputStream(getter_AddRefs(fileInputStream), file);</span>
<a href="#l40.717"></a><span id="l40.717">     if (NS_FAILED(rv) || !fileInputStream) goto done;</span>
<a href="#l40.718"></a><span id="l40.718">     command.AppendInt((int32_t)fileSize);</span>
<a href="#l40.719"></a><span id="l40.719">     if (hasLiteralPlus)</span>
<a href="#l40.720"></a><span id="l40.720" class="difflineminus">-      command.Append(&quot;+}&quot; CRLF);</span>
<a href="#l40.721"></a><span id="l40.721" class="difflineplus">+      command.AppendLiteral(&quot;+}&quot; CRLF);</span>
<a href="#l40.722"></a><span id="l40.722">     else</span>
<a href="#l40.723"></a><span id="l40.723" class="difflineminus">-      command.Append(&quot;}&quot; CRLF);</span>
<a href="#l40.724"></a><span id="l40.724" class="difflineplus">+      command.AppendLiteral(&quot;}&quot; CRLF);</span>
<a href="#l40.725"></a><span id="l40.725"> </span>
<a href="#l40.726"></a><span id="l40.726">     rv = SendData(command.get());</span>
<a href="#l40.727"></a><span id="l40.727">     if (NS_FAILED(rv)) goto done;</span>
<a href="#l40.728"></a><span id="l40.728"> </span>
<a href="#l40.729"></a><span id="l40.729">     if (!hasLiteralPlus)</span>
<a href="#l40.730"></a><span id="l40.730">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.731"></a><span id="l40.731"> </span>
<a href="#l40.732"></a><span id="l40.732">     totalSize = fileSize;</span>
<a href="#l40.733"></a><span id="l40.733" class="difflineat">@@ -6500,19 +6500,19 @@ void nsImapProtocol::RefreshFolderACLVie</span>
<a href="#l40.734"></a><span id="l40.734"> </span>
<a href="#l40.735"></a><span id="l40.735"> void nsImapProtocol::GetACLForFolder(const char *mailboxName)</span>
<a href="#l40.736"></a><span id="l40.736"> {</span>
<a href="#l40.737"></a><span id="l40.737">   IncrementCommandTagNumber();</span>
<a href="#l40.738"></a><span id="l40.738"> </span>
<a href="#l40.739"></a><span id="l40.739">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.740"></a><span id="l40.740">   nsCString escapedName;</span>
<a href="#l40.741"></a><span id="l40.741">   CreateEscapedMailboxName(mailboxName, escapedName);</span>
<a href="#l40.742"></a><span id="l40.742" class="difflineminus">-  command.Append(&quot; getacl \&quot;&quot;);</span>
<a href="#l40.743"></a><span id="l40.743" class="difflineplus">+  command.AppendLiteral(&quot; getacl \&quot;&quot;);</span>
<a href="#l40.744"></a><span id="l40.744">   command.Append(escapedName);</span>
<a href="#l40.745"></a><span id="l40.745" class="difflineminus">-  command.Append(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.746"></a><span id="l40.746" class="difflineplus">+  command.AppendLiteral(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.747"></a><span id="l40.747"> </span>
<a href="#l40.748"></a><span id="l40.748">   nsresult rv = SendData(command.get());</span>
<a href="#l40.749"></a><span id="l40.749">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.750"></a><span id="l40.750">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.751"></a><span id="l40.751"> }</span>
<a href="#l40.752"></a><span id="l40.752"> </span>
<a href="#l40.753"></a><span id="l40.753"> void nsImapProtocol::OnRefreshAllACLs()</span>
<a href="#l40.754"></a><span id="l40.754"> {</span>
<a href="#l40.755"></a><span id="l40.755" class="difflineat">@@ -6566,105 +6566,105 @@ void nsImapProtocol::Logout(bool shuttin</span>
<a href="#l40.756"></a><span id="l40.756">     if (closeNeeded &amp;&amp; GetDeleteIsMoveToTrash())</span>
<a href="#l40.757"></a><span id="l40.757">         Close();</span>
<a href="#l40.758"></a><span id="l40.758"> ********************/</span>
<a href="#l40.759"></a><span id="l40.759"> </span>
<a href="#l40.760"></a><span id="l40.760">   IncrementCommandTagNumber();</span>
<a href="#l40.761"></a><span id="l40.761"> </span>
<a href="#l40.762"></a><span id="l40.762">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.763"></a><span id="l40.763"> </span>
<a href="#l40.764"></a><span id="l40.764" class="difflineminus">-  command.Append(&quot; logout&quot; CRLF);</span>
<a href="#l40.765"></a><span id="l40.765" class="difflineplus">+  command.AppendLiteral(&quot; logout&quot; CRLF);</span>
<a href="#l40.766"></a><span id="l40.766"> </span>
<a href="#l40.767"></a><span id="l40.767">   nsresult rv = SendData(command.get());</span>
<a href="#l40.768"></a><span id="l40.768">   if (m_transport &amp;&amp; shuttingDown)</span>
<a href="#l40.769"></a><span id="l40.769">     m_transport-&gt;SetTimeout(nsISocketTransport::TIMEOUT_READ_WRITE, 5);</span>
<a href="#l40.770"></a><span id="l40.770">   // the socket may be dead before we read the response, so drop it.</span>
<a href="#l40.771"></a><span id="l40.771">   if (NS_SUCCEEDED(rv) &amp;&amp; waitForResponse)</span>
<a href="#l40.772"></a><span id="l40.772">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.773"></a><span id="l40.773"> }</span>
<a href="#l40.774"></a><span id="l40.774"> </span>
<a href="#l40.775"></a><span id="l40.775"> void nsImapProtocol::Noop()</span>
<a href="#l40.776"></a><span id="l40.776"> {</span>
<a href="#l40.777"></a><span id="l40.777">   //ProgressUpdateEvent(&quot;noop...&quot;);</span>
<a href="#l40.778"></a><span id="l40.778">   IncrementCommandTagNumber();</span>
<a href="#l40.779"></a><span id="l40.779">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.780"></a><span id="l40.780"> </span>
<a href="#l40.781"></a><span id="l40.781" class="difflineminus">-  command.Append(&quot; noop&quot; CRLF);</span>
<a href="#l40.782"></a><span id="l40.782" class="difflineplus">+  command.AppendLiteral(&quot; noop&quot; CRLF);</span>
<a href="#l40.783"></a><span id="l40.783"> </span>
<a href="#l40.784"></a><span id="l40.784">   nsresult rv = SendData(command.get());</span>
<a href="#l40.785"></a><span id="l40.785">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.786"></a><span id="l40.786">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.787"></a><span id="l40.787"> }</span>
<a href="#l40.788"></a><span id="l40.788"> </span>
<a href="#l40.789"></a><span id="l40.789"> void nsImapProtocol::XServerInfo()</span>
<a href="#l40.790"></a><span id="l40.790"> {</span>
<a href="#l40.791"></a><span id="l40.791"> </span>
<a href="#l40.792"></a><span id="l40.792">     ProgressEventFunctionUsingName(&quot;imapGettingServerInfo&quot;);</span>
<a href="#l40.793"></a><span id="l40.793">     IncrementCommandTagNumber();</span>
<a href="#l40.794"></a><span id="l40.794">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.795"></a><span id="l40.795"> </span>
<a href="#l40.796"></a><span id="l40.796" class="difflineminus">-  command.Append(&quot; XSERVERINFO MANAGEACCOUNTURL MANAGELISTSURL MANAGEFILTERSURL&quot; CRLF);</span>
<a href="#l40.797"></a><span id="l40.797" class="difflineplus">+  command.AppendLiteral(&quot; XSERVERINFO MANAGEACCOUNTURL MANAGELISTSURL MANAGEFILTERSURL&quot; CRLF);</span>
<a href="#l40.798"></a><span id="l40.798"> </span>
<a href="#l40.799"></a><span id="l40.799">     nsresult rv = SendData(command.get());</span>
<a href="#l40.800"></a><span id="l40.800">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.801"></a><span id="l40.801">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.802"></a><span id="l40.802"> }</span>
<a href="#l40.803"></a><span id="l40.803"> </span>
<a href="#l40.804"></a><span id="l40.804"> void nsImapProtocol::Netscape()</span>
<a href="#l40.805"></a><span id="l40.805"> {</span>
<a href="#l40.806"></a><span id="l40.806">     ProgressEventFunctionUsingName(&quot;imapGettingServerInfo&quot;);</span>
<a href="#l40.807"></a><span id="l40.807">     IncrementCommandTagNumber();</span>
<a href="#l40.808"></a><span id="l40.808"> </span>
<a href="#l40.809"></a><span id="l40.809">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.810"></a><span id="l40.810"> </span>
<a href="#l40.811"></a><span id="l40.811" class="difflineminus">-  command.Append(&quot; netscape&quot; CRLF);</span>
<a href="#l40.812"></a><span id="l40.812" class="difflineplus">+  command.AppendLiteral(&quot; netscape&quot; CRLF);</span>
<a href="#l40.813"></a><span id="l40.813"> </span>
<a href="#l40.814"></a><span id="l40.814">     nsresult rv = SendData(command.get());</span>
<a href="#l40.815"></a><span id="l40.815">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.816"></a><span id="l40.816">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.817"></a><span id="l40.817"> }</span>
<a href="#l40.818"></a><span id="l40.818"> </span>
<a href="#l40.819"></a><span id="l40.819"> </span>
<a href="#l40.820"></a><span id="l40.820"> </span>
<a href="#l40.821"></a><span id="l40.821"> void nsImapProtocol::XMailboxInfo(const char *mailboxName)</span>
<a href="#l40.822"></a><span id="l40.822"> {</span>
<a href="#l40.823"></a><span id="l40.823"> </span>
<a href="#l40.824"></a><span id="l40.824">     ProgressEventFunctionUsingName(&quot;imapGettingMailboxInfo&quot;);</span>
<a href="#l40.825"></a><span id="l40.825">     IncrementCommandTagNumber();</span>
<a href="#l40.826"></a><span id="l40.826">     nsCString command(GetServerCommandTag());</span>
<a href="#l40.827"></a><span id="l40.827"> </span>
<a href="#l40.828"></a><span id="l40.828" class="difflineminus">-  command.Append(&quot; XMAILBOXINFO \&quot;&quot;);</span>
<a href="#l40.829"></a><span id="l40.829" class="difflineplus">+  command.AppendLiteral(&quot; XMAILBOXINFO \&quot;&quot;);</span>
<a href="#l40.830"></a><span id="l40.830">   command.Append(mailboxName);</span>
<a href="#l40.831"></a><span id="l40.831" class="difflineminus">-  command.Append(&quot;\&quot; MANAGEURL POSTURL&quot; CRLF);</span>
<a href="#l40.832"></a><span id="l40.832" class="difflineplus">+  command.AppendLiteral(&quot;\&quot; MANAGEURL POSTURL&quot; CRLF);</span>
<a href="#l40.833"></a><span id="l40.833"> </span>
<a href="#l40.834"></a><span id="l40.834">     nsresult rv = SendData(command.get());</span>
<a href="#l40.835"></a><span id="l40.835">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.836"></a><span id="l40.836">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.837"></a><span id="l40.837"> }</span>
<a href="#l40.838"></a><span id="l40.838"> </span>
<a href="#l40.839"></a><span id="l40.839"> void nsImapProtocol::Namespace()</span>
<a href="#l40.840"></a><span id="l40.840"> {</span>
<a href="#l40.841"></a><span id="l40.841"> </span>
<a href="#l40.842"></a><span id="l40.842">     IncrementCommandTagNumber();</span>
<a href="#l40.843"></a><span id="l40.843"> </span>
<a href="#l40.844"></a><span id="l40.844">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.845"></a><span id="l40.845" class="difflineminus">-  command.Append(&quot; namespace&quot; CRLF);</span>
<a href="#l40.846"></a><span id="l40.846" class="difflineplus">+  command.AppendLiteral(&quot; namespace&quot; CRLF);</span>
<a href="#l40.847"></a><span id="l40.847"> </span>
<a href="#l40.848"></a><span id="l40.848">     nsresult rv = SendData(command.get());</span>
<a href="#l40.849"></a><span id="l40.849">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.850"></a><span id="l40.850">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.851"></a><span id="l40.851"> }</span>
<a href="#l40.852"></a><span id="l40.852"> </span>
<a href="#l40.853"></a><span id="l40.853"> </span>
<a href="#l40.854"></a><span id="l40.854"> void nsImapProtocol::MailboxData()</span>
<a href="#l40.855"></a><span id="l40.855"> {</span>
<a href="#l40.856"></a><span id="l40.856">     IncrementCommandTagNumber();</span>
<a href="#l40.857"></a><span id="l40.857"> </span>
<a href="#l40.858"></a><span id="l40.858">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.859"></a><span id="l40.859" class="difflineminus">-  command.Append(&quot; mailboxdata&quot; CRLF);</span>
<a href="#l40.860"></a><span id="l40.860" class="difflineplus">+  command.AppendLiteral(&quot; mailboxdata&quot; CRLF);</span>
<a href="#l40.861"></a><span id="l40.861"> </span>
<a href="#l40.862"></a><span id="l40.862">     nsresult rv = SendData(command.get());</span>
<a href="#l40.863"></a><span id="l40.863">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.864"></a><span id="l40.864">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.865"></a><span id="l40.865"> }</span>
<a href="#l40.866"></a><span id="l40.866"> </span>
<a href="#l40.867"></a><span id="l40.867"> </span>
<a href="#l40.868"></a><span id="l40.868"> void nsImapProtocol::GetMyRightsForFolder(const char *mailboxName)</span>
<a href="#l40.869"></a><span id="l40.869" class="difflineat">@@ -6673,19 +6673,19 @@ void nsImapProtocol::GetMyRightsForFolde</span>
<a href="#l40.870"></a><span id="l40.870"> </span>
<a href="#l40.871"></a><span id="l40.871">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.872"></a><span id="l40.872">   nsCString escapedName;</span>
<a href="#l40.873"></a><span id="l40.873">   CreateEscapedMailboxName(mailboxName, escapedName);</span>
<a href="#l40.874"></a><span id="l40.874"> </span>
<a href="#l40.875"></a><span id="l40.875">   if (MailboxIsNoSelectMailbox(escapedName.get()))</span>
<a href="#l40.876"></a><span id="l40.876">     return; // Don't issue myrights on Noselect folder</span>
<a href="#l40.877"></a><span id="l40.877"> </span>
<a href="#l40.878"></a><span id="l40.878" class="difflineminus">-  command.Append(&quot; myrights \&quot;&quot;);</span>
<a href="#l40.879"></a><span id="l40.879" class="difflineplus">+  command.AppendLiteral(&quot; myrights \&quot;&quot;);</span>
<a href="#l40.880"></a><span id="l40.880">   command.Append(escapedName);</span>
<a href="#l40.881"></a><span id="l40.881" class="difflineminus">-  command.Append(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.882"></a><span id="l40.882" class="difflineplus">+  command.AppendLiteral(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.883"></a><span id="l40.883"> </span>
<a href="#l40.884"></a><span id="l40.884">   nsresult rv = SendData(command.get());</span>
<a href="#l40.885"></a><span id="l40.885">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.886"></a><span id="l40.886">     ParseIMAPandCheckForNewMail();</span>
<a href="#l40.887"></a><span id="l40.887"> }</span>
<a href="#l40.888"></a><span id="l40.888"> </span>
<a href="#l40.889"></a><span id="l40.889"> bool nsImapProtocol::FolderIsSelected(const char *mailboxName)</span>
<a href="#l40.890"></a><span id="l40.890"> {</span>
<a href="#l40.891"></a><span id="l40.891" class="difflineat">@@ -6710,19 +6710,19 @@ void nsImapProtocol::OnStatusForFolder(c</span>
<a href="#l40.892"></a><span id="l40.892">   }</span>
<a href="#l40.893"></a><span id="l40.893"> </span>
<a href="#l40.894"></a><span id="l40.894">   IncrementCommandTagNumber();</span>
<a href="#l40.895"></a><span id="l40.895"> </span>
<a href="#l40.896"></a><span id="l40.896">   nsAutoCString command(GetServerCommandTag());</span>
<a href="#l40.897"></a><span id="l40.897">   nsCString escapedName;</span>
<a href="#l40.898"></a><span id="l40.898">   CreateEscapedMailboxName(mailboxName, escapedName);</span>
<a href="#l40.899"></a><span id="l40.899"> </span>
<a href="#l40.900"></a><span id="l40.900" class="difflineminus">-  command.Append(&quot; STATUS \&quot;&quot;);</span>
<a href="#l40.901"></a><span id="l40.901" class="difflineplus">+  command.AppendLiteral(&quot; STATUS \&quot;&quot;);</span>
<a href="#l40.902"></a><span id="l40.902">   command.Append(escapedName);</span>
<a href="#l40.903"></a><span id="l40.903" class="difflineminus">-  command.Append(&quot;\&quot; (UIDNEXT MESSAGES UNSEEN RECENT)&quot; CRLF);</span>
<a href="#l40.904"></a><span id="l40.904" class="difflineplus">+  command.AppendLiteral(&quot;\&quot; (UIDNEXT MESSAGES UNSEEN RECENT)&quot; CRLF);</span>
<a href="#l40.905"></a><span id="l40.905"> </span>
<a href="#l40.906"></a><span id="l40.906">   nsresult rv = SendData(command.get());</span>
<a href="#l40.907"></a><span id="l40.907">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.908"></a><span id="l40.908">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.909"></a><span id="l40.909"> </span>
<a href="#l40.910"></a><span id="l40.910">   if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l40.911"></a><span id="l40.911">   {</span>
<a href="#l40.912"></a><span id="l40.912">     RefPtr&lt;nsImapMailboxSpec&gt; new_spec = GetServerStateParser().CreateCurrentMailboxSpec(mailboxName);</span>
<a href="#l40.913"></a><span id="l40.913" class="difflineat">@@ -7424,22 +7424,22 @@ void nsImapProtocol::DiscoverMailboxList</span>
<a href="#l40.914"></a><span id="l40.914">         }</span>
<a href="#l40.915"></a><span id="l40.915"> </span>
<a href="#l40.916"></a><span id="l40.916">         // now do the folders within this namespace</span>
<a href="#l40.917"></a><span id="l40.917">         nsCString pattern;</span>
<a href="#l40.918"></a><span id="l40.918">         nsCString pattern2;</span>
<a href="#l40.919"></a><span id="l40.919">         if (usingSubscription)</span>
<a href="#l40.920"></a><span id="l40.920">         {</span>
<a href="#l40.921"></a><span id="l40.921">           pattern.Append(prefix);</span>
<a href="#l40.922"></a><span id="l40.922" class="difflineminus">-          pattern.Append(&quot;*&quot;);</span>
<a href="#l40.923"></a><span id="l40.923" class="difflineplus">+          pattern.Append('*');</span>
<a href="#l40.924"></a><span id="l40.924">         }</span>
<a href="#l40.925"></a><span id="l40.925">         else</span>
<a href="#l40.926"></a><span id="l40.926">         {</span>
<a href="#l40.927"></a><span id="l40.927">           pattern.Append(prefix);</span>
<a href="#l40.928"></a><span id="l40.928" class="difflineminus">-          pattern.Append(&quot;%&quot;); // mscott just need one percent right?</span>
<a href="#l40.929"></a><span id="l40.929" class="difflineplus">+          pattern.Append('%'); // mscott just need one percent right?</span>
<a href="#l40.930"></a><span id="l40.930">           // pattern = PR_smprintf(&quot;%s%%&quot;, prefix);</span>
<a href="#l40.931"></a><span id="l40.931">           char delimiter = ns-&gt;GetDelimiter();</span>
<a href="#l40.932"></a><span id="l40.932">           if (delimiter)</span>
<a href="#l40.933"></a><span id="l40.933">           {</span>
<a href="#l40.934"></a><span id="l40.934">             // delimiter might be NIL, in which case there's no hierarchy anyway</span>
<a href="#l40.935"></a><span id="l40.935">             pattern2 = prefix;</span>
<a href="#l40.936"></a><span id="l40.936">             pattern2 += &quot;%&quot;;</span>
<a href="#l40.937"></a><span id="l40.937">             pattern2 += delimiter;</span>
<a href="#l40.938"></a><span id="l40.938" class="difflineat">@@ -7933,18 +7933,18 @@ void nsImapProtocol::Search(const char *</span>
<a href="#l40.939"></a><span id="l40.939"> {</span>
<a href="#l40.940"></a><span id="l40.940">   m_notifySearchHit = notifyHit;</span>
<a href="#l40.941"></a><span id="l40.941">   ProgressEventFunctionUsingName(&quot;imapStatusSearchMailbox&quot;);</span>
<a href="#l40.942"></a><span id="l40.942">   IncrementCommandTagNumber();</span>
<a href="#l40.943"></a><span id="l40.943"> </span>
<a href="#l40.944"></a><span id="l40.944">   nsCString protocolString(GetServerCommandTag());</span>
<a href="#l40.945"></a><span id="l40.945">   // the searchCriteria string contains the 'search ....' string</span>
<a href="#l40.946"></a><span id="l40.946">   if (useUID)</span>
<a href="#l40.947"></a><span id="l40.947" class="difflineminus">-     protocolString.Append(&quot; uid&quot;);</span>
<a href="#l40.948"></a><span id="l40.948" class="difflineminus">-  protocolString.Append(&quot; &quot;);</span>
<a href="#l40.949"></a><span id="l40.949" class="difflineplus">+     protocolString.AppendLiteral(&quot; uid&quot;);</span>
<a href="#l40.950"></a><span id="l40.950" class="difflineplus">+  protocolString.Append(' ');</span>
<a href="#l40.951"></a><span id="l40.951">   protocolString.Append(searchCriteria);</span>
<a href="#l40.952"></a><span id="l40.952">   // the search criteria can contain string literals, which means we</span>
<a href="#l40.953"></a><span id="l40.953">   // need to break up the protocol string by CRLF's, and after sending CRLF,</span>
<a href="#l40.954"></a><span id="l40.954">   // wait for the server to respond OK before sending more data</span>
<a href="#l40.955"></a><span id="l40.955">   nsresult rv;</span>
<a href="#l40.956"></a><span id="l40.956">   int32_t crlfIndex;</span>
<a href="#l40.957"></a><span id="l40.957">   while ((crlfIndex = protocolString.Find(CRLF)) != kNotFound &amp;&amp; !DeathSignalReceived())</span>
<a href="#l40.958"></a><span id="l40.958">   {</span>
<a href="#l40.959"></a><span id="l40.959" class="difflineat">@@ -7993,32 +7993,32 @@ void nsImapProtocol::Copy(const char * m</span>
<a href="#l40.960"></a><span id="l40.960">       idString.Assign(messageList);</span>
<a href="#l40.961"></a><span id="l40.961"> </span>
<a href="#l40.962"></a><span id="l40.962">     msgsHandled += msgsToHandle;</span>
<a href="#l40.963"></a><span id="l40.963">     msgCountLeft -= msgsToHandle;</span>
<a href="#l40.964"></a><span id="l40.964"> </span>
<a href="#l40.965"></a><span id="l40.965">     IncrementCommandTagNumber();</span>
<a href="#l40.966"></a><span id="l40.966">     nsAutoCString protocolString(GetServerCommandTag());</span>
<a href="#l40.967"></a><span id="l40.967">     if (idsAreUid)</span>
<a href="#l40.968"></a><span id="l40.968" class="difflineminus">-      protocolString.Append(&quot; uid&quot;);</span>
<a href="#l40.969"></a><span id="l40.969" class="difflineplus">+      protocolString.AppendLiteral(&quot; uid&quot;);</span>
<a href="#l40.970"></a><span id="l40.970">     // If it's a MOVE operation on aol servers then use 'xaol-move' cmd.</span>
<a href="#l40.971"></a><span id="l40.971">     if ((m_imapAction == nsIImapUrl::nsImapOnlineMove) &amp;&amp;</span>
<a href="#l40.972"></a><span id="l40.972">         GetServerStateParser().ServerIsAOLServer())</span>
<a href="#l40.973"></a><span id="l40.973" class="difflineminus">-      protocolString.Append(&quot; xaol-move &quot;);</span>
<a href="#l40.974"></a><span id="l40.974" class="difflineplus">+      protocolString.AppendLiteral(&quot; xaol-move &quot;);</span>
<a href="#l40.975"></a><span id="l40.975">     else if ((m_imapAction == nsIImapUrl::nsImapOnlineMove) &amp;&amp;</span>
<a href="#l40.976"></a><span id="l40.976">              GetServerStateParser().GetCapabilityFlag() &amp; kHasMoveCapability)</span>
<a href="#l40.977"></a><span id="l40.977" class="difflineminus">-      protocolString.Append(&quot; move &quot;);</span>
<a href="#l40.978"></a><span id="l40.978" class="difflineplus">+      protocolString.AppendLiteral(&quot; move &quot;);</span>
<a href="#l40.979"></a><span id="l40.979">     else</span>
<a href="#l40.980"></a><span id="l40.980" class="difflineminus">-      protocolString.Append(&quot; copy &quot;);</span>
<a href="#l40.981"></a><span id="l40.981" class="difflineplus">+      protocolString.AppendLiteral(&quot; copy &quot;);</span>
<a href="#l40.982"></a><span id="l40.982"> </span>
<a href="#l40.983"></a><span id="l40.983"> </span>
<a href="#l40.984"></a><span id="l40.984">     protocolString.Append(idString);</span>
<a href="#l40.985"></a><span id="l40.985" class="difflineminus">-    protocolString.Append(&quot; \&quot;&quot;);</span>
<a href="#l40.986"></a><span id="l40.986" class="difflineplus">+    protocolString.AppendLiteral(&quot; \&quot;&quot;);</span>
<a href="#l40.987"></a><span id="l40.987">     protocolString.Append(escapedDestination);</span>
<a href="#l40.988"></a><span id="l40.988" class="difflineminus">-    protocolString.Append(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.989"></a><span id="l40.989" class="difflineplus">+    protocolString.AppendLiteral(&quot;\&quot;&quot; CRLF);</span>
<a href="#l40.990"></a><span id="l40.990"> </span>
<a href="#l40.991"></a><span id="l40.991">     nsresult rv = SendData(protocolString.get());</span>
<a href="#l40.992"></a><span id="l40.992">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.993"></a><span id="l40.993">        ParseIMAPandCheckForNewMail(protocolString.get());</span>
<a href="#l40.994"></a><span id="l40.994">   }</span>
<a href="#l40.995"></a><span id="l40.995">   while (msgCountLeft &gt; 0 &amp;&amp; !DeathSignalReceived());</span>
<a href="#l40.996"></a><span id="l40.996"> }</span>
<a href="#l40.997"></a><span id="l40.997"> </span>
<a href="#l40.998"></a><span id="l40.998" class="difflineat">@@ -8235,22 +8235,22 @@ void nsImapProtocol::ProcessAfterAuthent</span>
<a href="#l40.999"></a><span id="l40.999">         nsAutoCString statusString;</span>
<a href="#l40.1000"></a><span id="l40.1000">         m_forceSelect = IsExtraSelectNeeded();</span>
<a href="#l40.1001"></a><span id="l40.1001">         // Setting to &quot;yes-auto&quot; or &quot;no-auto&quot; avoids doing redundant calls to</span>
<a href="#l40.1002"></a><span id="l40.1002">         // IsExtraSelectNeeded() on subsequent ID() occurrences. It also</span>
<a href="#l40.1003"></a><span id="l40.1003">         // provides feedback to the user regarding the detection status.</span>
<a href="#l40.1004"></a><span id="l40.1004">         if (m_forceSelect)</span>
<a href="#l40.1005"></a><span id="l40.1005">         {</span>
<a href="#l40.1006"></a><span id="l40.1006">           // Set preference value to &quot;yes-auto&quot;.</span>
<a href="#l40.1007"></a><span id="l40.1007" class="difflineminus">-          statusString.Assign(&quot;yes-auto&quot;);</span>
<a href="#l40.1008"></a><span id="l40.1008" class="difflineplus">+          statusString.AssignLiteral(&quot;yes-auto&quot;);</span>
<a href="#l40.1009"></a><span id="l40.1009">         }</span>
<a href="#l40.1010"></a><span id="l40.1010">         else</span>
<a href="#l40.1011"></a><span id="l40.1011">         {</span>
<a href="#l40.1012"></a><span id="l40.1012">           // Set preference value to &quot;no-auto&quot;.</span>
<a href="#l40.1013"></a><span id="l40.1013" class="difflineminus">-          statusString.Assign(&quot;no-auto&quot;);</span>
<a href="#l40.1014"></a><span id="l40.1014" class="difflineplus">+          statusString.AssignLiteral(&quot;no-auto&quot;);</span>
<a href="#l40.1015"></a><span id="l40.1015">         }</span>
<a href="#l40.1016"></a><span id="l40.1016">         m_imapServerSink-&gt;SetServerForceSelect(statusString);</span>
<a href="#l40.1017"></a><span id="l40.1017">         break;</span>
<a href="#l40.1018"></a><span id="l40.1018">       }</span>
<a href="#l40.1019"></a><span id="l40.1019">     }</span>
<a href="#l40.1020"></a><span id="l40.1020">   }</span>
<a href="#l40.1021"></a><span id="l40.1021"> </span>
<a href="#l40.1022"></a><span id="l40.1022">   // If no ID capability or empty ID response, user may still want to</span>
<a href="#l40.1023"></a><span id="l40.1023" class="difflineat">@@ -8259,17 +8259,17 @@ void nsImapProtocol::ProcessAfterAuthent</span>
<a href="#l40.1024"></a><span id="l40.1024">   {</span>
<a href="#l40.1025"></a><span id="l40.1025">     switch (m_forceSelectValue.get()[0])</span>
<a href="#l40.1026"></a><span id="l40.1026">     {</span>
<a href="#l40.1027"></a><span id="l40.1027">     case 'a':</span>
<a href="#l40.1028"></a><span id="l40.1028">       {</span>
<a href="#l40.1029"></a><span id="l40.1029">         // If default &quot;auto&quot;, set to &quot;no-auto&quot; so visible in config editor</span>
<a href="#l40.1030"></a><span id="l40.1030">         // and set/keep m_forceSelect false.</span>
<a href="#l40.1031"></a><span id="l40.1031">         nsAutoCString statusString;</span>
<a href="#l40.1032"></a><span id="l40.1032" class="difflineminus">-        statusString.Assign(&quot;no-auto&quot;);</span>
<a href="#l40.1033"></a><span id="l40.1033" class="difflineplus">+        statusString.AssignLiteral(&quot;no-auto&quot;);</span>
<a href="#l40.1034"></a><span id="l40.1034">         m_imapServerSink-&gt;SetServerForceSelect(statusString);</span>
<a href="#l40.1035"></a><span id="l40.1035">         m_forceSelect = false;</span>
<a href="#l40.1036"></a><span id="l40.1036">       }</span>
<a href="#l40.1037"></a><span id="l40.1037">       break;</span>
<a href="#l40.1038"></a><span id="l40.1038">     case 'y':</span>
<a href="#l40.1039"></a><span id="l40.1039">     case 'Y':</span>
<a href="#l40.1040"></a><span id="l40.1040">       m_forceSelect = true;</span>
<a href="#l40.1041"></a><span id="l40.1041">       break;</span>
<a href="#l40.1042"></a><span id="l40.1042" class="difflineat">@@ -8279,33 +8279,33 @@ void nsImapProtocol::ProcessAfterAuthent</span>
<a href="#l40.1043"></a><span id="l40.1043">   }</span>
<a href="#l40.1044"></a><span id="l40.1044"> }</span>
<a href="#l40.1045"></a><span id="l40.1045"> </span>
<a href="#l40.1046"></a><span id="l40.1046"> void nsImapProtocol::SetupMessageFlagsString(nsCString&amp; flagString,</span>
<a href="#l40.1047"></a><span id="l40.1047">                                              imapMessageFlagsType flags,</span>
<a href="#l40.1048"></a><span id="l40.1048">                                              uint16_t userFlags)</span>
<a href="#l40.1049"></a><span id="l40.1049"> {</span>
<a href="#l40.1050"></a><span id="l40.1050">     if (flags &amp; kImapMsgSeenFlag)</span>
<a href="#l40.1051"></a><span id="l40.1051" class="difflineminus">-        flagString.Append(&quot;\\Seen &quot;);</span>
<a href="#l40.1052"></a><span id="l40.1052" class="difflineplus">+        flagString.AppendLiteral(&quot;\\Seen &quot;);</span>
<a href="#l40.1053"></a><span id="l40.1053">     if (flags &amp; kImapMsgAnsweredFlag)</span>
<a href="#l40.1054"></a><span id="l40.1054" class="difflineminus">-        flagString.Append(&quot;\\Answered &quot;);</span>
<a href="#l40.1055"></a><span id="l40.1055" class="difflineplus">+        flagString.AppendLiteral(&quot;\\Answered &quot;);</span>
<a href="#l40.1056"></a><span id="l40.1056">     if (flags &amp; kImapMsgFlaggedFlag)</span>
<a href="#l40.1057"></a><span id="l40.1057" class="difflineminus">-        flagString.Append(&quot;\\Flagged &quot;);</span>
<a href="#l40.1058"></a><span id="l40.1058" class="difflineplus">+        flagString.AppendLiteral(&quot;\\Flagged &quot;);</span>
<a href="#l40.1059"></a><span id="l40.1059">     if (flags &amp; kImapMsgDeletedFlag)</span>
<a href="#l40.1060"></a><span id="l40.1060" class="difflineminus">-        flagString.Append(&quot;\\Deleted &quot;);</span>
<a href="#l40.1061"></a><span id="l40.1061" class="difflineplus">+        flagString.AppendLiteral(&quot;\\Deleted &quot;);</span>
<a href="#l40.1062"></a><span id="l40.1062">     if (flags &amp; kImapMsgDraftFlag)</span>
<a href="#l40.1063"></a><span id="l40.1063" class="difflineminus">-        flagString.Append(&quot;\\Draft &quot;);</span>
<a href="#l40.1064"></a><span id="l40.1064" class="difflineplus">+        flagString.AppendLiteral(&quot;\\Draft &quot;);</span>
<a href="#l40.1065"></a><span id="l40.1065">     if (flags &amp; kImapMsgRecentFlag)</span>
<a href="#l40.1066"></a><span id="l40.1066" class="difflineminus">-        flagString.Append(&quot;\\Recent &quot;);</span>
<a href="#l40.1067"></a><span id="l40.1067" class="difflineplus">+        flagString.AppendLiteral(&quot;\\Recent &quot;);</span>
<a href="#l40.1068"></a><span id="l40.1068">     if ((flags &amp; kImapMsgForwardedFlag) &amp;&amp;</span>
<a href="#l40.1069"></a><span id="l40.1069">         (userFlags &amp; kImapMsgSupportForwardedFlag))</span>
<a href="#l40.1070"></a><span id="l40.1070" class="difflineminus">-        flagString.Append(&quot;$Forwarded &quot;); // Not always available</span>
<a href="#l40.1071"></a><span id="l40.1071" class="difflineplus">+        flagString.AppendLiteral(&quot;$Forwarded &quot;); // Not always available</span>
<a href="#l40.1072"></a><span id="l40.1072">     if ((flags &amp; kImapMsgMDNSentFlag) &amp;&amp; (</span>
<a href="#l40.1073"></a><span id="l40.1073">         userFlags &amp; kImapMsgSupportMDNSentFlag))</span>
<a href="#l40.1074"></a><span id="l40.1074" class="difflineminus">-        flagString.Append(&quot;$MDNSent &quot;); // Not always available</span>
<a href="#l40.1075"></a><span id="l40.1075" class="difflineplus">+        flagString.AppendLiteral(&quot;$MDNSent &quot;); // Not always available</span>
<a href="#l40.1076"></a><span id="l40.1076"> </span>
<a href="#l40.1077"></a><span id="l40.1077">     // eat the last space</span>
<a href="#l40.1078"></a><span id="l40.1078">     if (!flagString.IsEmpty())</span>
<a href="#l40.1079"></a><span id="l40.1079">         flagString.SetLength(flagString.Length()-1);</span>
<a href="#l40.1080"></a><span id="l40.1080"> }</span>
<a href="#l40.1081"></a><span id="l40.1081"> </span>
<a href="#l40.1082"></a><span id="l40.1082"> void nsImapProtocol::ProcessStoreFlags(const nsCString &amp;messageIdsString,</span>
<a href="#l40.1083"></a><span id="l40.1083">                                                  bool idsAreUids,</span>
<a href="#l40.1084"></a><span id="l40.1084" class="difflineat">@@ -8325,29 +8325,29 @@ void nsImapProtocol::ProcessStoreFlags(c</span>
<a href="#l40.1085"></a><span id="l40.1085">   }</span>
<a href="#l40.1086"></a><span id="l40.1086"> </span>
<a href="#l40.1087"></a><span id="l40.1087">   if (addFlags)</span>
<a href="#l40.1088"></a><span id="l40.1088">       flagString = &quot;+Flags (&quot;;</span>
<a href="#l40.1089"></a><span id="l40.1089">   else</span>
<a href="#l40.1090"></a><span id="l40.1090">       flagString = &quot;-Flags (&quot;;</span>
<a href="#l40.1091"></a><span id="l40.1091"> </span>
<a href="#l40.1092"></a><span id="l40.1092">   if (flags &amp; kImapMsgSeenFlag &amp;&amp; kImapMsgSeenFlag &amp; settableFlags)</span>
<a href="#l40.1093"></a><span id="l40.1093" class="difflineminus">-      flagString .Append(&quot;\\Seen &quot;);</span>
<a href="#l40.1094"></a><span id="l40.1094" class="difflineplus">+      flagString .AppendLiteral(&quot;\\Seen &quot;);</span>
<a href="#l40.1095"></a><span id="l40.1095">   if (flags &amp; kImapMsgAnsweredFlag &amp;&amp; kImapMsgAnsweredFlag &amp; settableFlags)</span>
<a href="#l40.1096"></a><span id="l40.1096" class="difflineminus">-      flagString .Append(&quot;\\Answered &quot;);</span>
<a href="#l40.1097"></a><span id="l40.1097" class="difflineplus">+      flagString .AppendLiteral(&quot;\\Answered &quot;);</span>
<a href="#l40.1098"></a><span id="l40.1098">   if (flags &amp; kImapMsgFlaggedFlag &amp;&amp; kImapMsgFlaggedFlag &amp; settableFlags)</span>
<a href="#l40.1099"></a><span id="l40.1099" class="difflineminus">-      flagString .Append(&quot;\\Flagged &quot;);</span>
<a href="#l40.1100"></a><span id="l40.1100" class="difflineplus">+      flagString .AppendLiteral(&quot;\\Flagged &quot;);</span>
<a href="#l40.1101"></a><span id="l40.1101">   if (flags &amp; kImapMsgDeletedFlag &amp;&amp; kImapMsgDeletedFlag &amp; settableFlags)</span>
<a href="#l40.1102"></a><span id="l40.1102" class="difflineminus">-      flagString .Append(&quot;\\Deleted &quot;);</span>
<a href="#l40.1103"></a><span id="l40.1103" class="difflineplus">+      flagString .AppendLiteral(&quot;\\Deleted &quot;);</span>
<a href="#l40.1104"></a><span id="l40.1104">   if (flags &amp; kImapMsgDraftFlag &amp;&amp; kImapMsgDraftFlag &amp; settableFlags)</span>
<a href="#l40.1105"></a><span id="l40.1105" class="difflineminus">-      flagString .Append(&quot;\\Draft &quot;);</span>
<a href="#l40.1106"></a><span id="l40.1106" class="difflineplus">+      flagString .AppendLiteral(&quot;\\Draft &quot;);</span>
<a href="#l40.1107"></a><span id="l40.1107">   if (flags &amp; kImapMsgForwardedFlag &amp;&amp; kImapMsgSupportForwardedFlag &amp; userFlags)</span>
<a href="#l40.1108"></a><span id="l40.1108" class="difflineminus">-        flagString .Append(&quot;$Forwarded &quot;);  // if supported</span>
<a href="#l40.1109"></a><span id="l40.1109" class="difflineplus">+        flagString .AppendLiteral(&quot;$Forwarded &quot;);  // if supported</span>
<a href="#l40.1110"></a><span id="l40.1110">   if (flags &amp; kImapMsgMDNSentFlag &amp;&amp; kImapMsgSupportMDNSentFlag &amp; userFlags)</span>
<a href="#l40.1111"></a><span id="l40.1111" class="difflineminus">-        flagString .Append(&quot;$MDNSent &quot;);  // if supported</span>
<a href="#l40.1112"></a><span id="l40.1112" class="difflineplus">+        flagString .AppendLiteral(&quot;$MDNSent &quot;);  // if supported</span>
<a href="#l40.1113"></a><span id="l40.1113"> </span>
<a href="#l40.1114"></a><span id="l40.1114">   if (flagString.Length() &gt; 8) // if more than &quot;+Flags (&quot;</span>
<a href="#l40.1115"></a><span id="l40.1115">   {</span>
<a href="#l40.1116"></a><span id="l40.1116">   // replace the final space with ')'</span>
<a href="#l40.1117"></a><span id="l40.1117">     flagString.SetCharAt(')',flagString.Length() - 1);</span>
<a href="#l40.1118"></a><span id="l40.1118"> </span>
<a href="#l40.1119"></a><span id="l40.1119">     Store(messageIdsString, flagString.get(), idsAreUids);</span>
<a href="#l40.1120"></a><span id="l40.1120">     if (m_runningUrl &amp;&amp; idsAreUids)</span>
<a href="#l40.1121"></a><span id="l40.1121" class="difflineat">@@ -8379,17 +8379,17 @@ void nsImapProtocol::ProcessStoreFlags(c</span>
<a href="#l40.1122"></a><span id="l40.1122"> </span>
<a href="#l40.1123"></a><span id="l40.1123"> </span>
<a href="#l40.1124"></a><span id="l40.1124"> void nsImapProtocol::Close(bool shuttingDown /* = false */,</span>
<a href="#l40.1125"></a><span id="l40.1125">                            bool waitForResponse /* = true */)</span>
<a href="#l40.1126"></a><span id="l40.1126"> {</span>
<a href="#l40.1127"></a><span id="l40.1127">   IncrementCommandTagNumber();</span>
<a href="#l40.1128"></a><span id="l40.1128"> </span>
<a href="#l40.1129"></a><span id="l40.1129">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.1130"></a><span id="l40.1130" class="difflineminus">-  command.Append(&quot; close&quot; CRLF);</span>
<a href="#l40.1131"></a><span id="l40.1131" class="difflineplus">+  command.AppendLiteral(&quot; close&quot; CRLF);</span>
<a href="#l40.1132"></a><span id="l40.1132"> </span>
<a href="#l40.1133"></a><span id="l40.1133">   if (!shuttingDown)</span>
<a href="#l40.1134"></a><span id="l40.1134">     ProgressEventFunctionUsingName(&quot;imapStatusCloseMailbox&quot;);</span>
<a href="#l40.1135"></a><span id="l40.1135"> </span>
<a href="#l40.1136"></a><span id="l40.1136">   GetServerStateParser().ResetFlagInfo();</span>
<a href="#l40.1137"></a><span id="l40.1137"> </span>
<a href="#l40.1138"></a><span id="l40.1138">   nsresult rv = SendData(command.get());</span>
<a href="#l40.1139"></a><span id="l40.1139">   if (m_transport &amp;&amp; shuttingDown)</span>
<a href="#l40.1140"></a><span id="l40.1140" class="difflineat">@@ -8399,33 +8399,33 @@ void nsImapProtocol::Close(bool shutting</span>
<a href="#l40.1141"></a><span id="l40.1141">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.1142"></a><span id="l40.1142"> }</span>
<a href="#l40.1143"></a><span id="l40.1143"> </span>
<a href="#l40.1144"></a><span id="l40.1144"> void nsImapProtocol::XAOL_Option(const char *option)</span>
<a href="#l40.1145"></a><span id="l40.1145"> {</span>
<a href="#l40.1146"></a><span id="l40.1146">   IncrementCommandTagNumber();</span>
<a href="#l40.1147"></a><span id="l40.1147"> </span>
<a href="#l40.1148"></a><span id="l40.1148">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.1149"></a><span id="l40.1149" class="difflineminus">-  command.Append(&quot; XAOL-OPTION &quot;);</span>
<a href="#l40.1150"></a><span id="l40.1150" class="difflineplus">+  command.AppendLiteral(&quot; XAOL-OPTION &quot;);</span>
<a href="#l40.1151"></a><span id="l40.1151">   command.Append(option);</span>
<a href="#l40.1152"></a><span id="l40.1152">   command.Append(CRLF);</span>
<a href="#l40.1153"></a><span id="l40.1153"> </span>
<a href="#l40.1154"></a><span id="l40.1154">   nsresult rv = SendData(command.get());</span>
<a href="#l40.1155"></a><span id="l40.1155">   if (NS_SUCCEEDED(rv))</span>
<a href="#l40.1156"></a><span id="l40.1156">       ParseIMAPandCheckForNewMail();</span>
<a href="#l40.1157"></a><span id="l40.1157"> }</span>
<a href="#l40.1158"></a><span id="l40.1158"> </span>
<a href="#l40.1159"></a><span id="l40.1159"> void nsImapProtocol::Check()</span>
<a href="#l40.1160"></a><span id="l40.1160"> {</span>
<a href="#l40.1161"></a><span id="l40.1161">     //ProgressUpdateEvent(&quot;Checking mailbox...&quot;);</span>
<a href="#l40.1162"></a><span id="l40.1162"> </span>
<a href="#l40.1163"></a><span id="l40.1163">     IncrementCommandTagNumber();</span>
<a href="#l40.1164"></a><span id="l40.1164"> </span>
<a href="#l40.1165"></a><span id="l40.1165">   nsCString command(GetServerCommandTag());</span>
<a href="#l40.1166"></a><span id="l40.1166" class="difflineminus">-  command.Append(&quot; check&quot; CRLF);</span>
<a href="#l40.1167"></a><span id="l40.1167" class="difflineplus">+  command.AppendLiteral(&quot; check&quot; CRLF);</span>
<a href="#l40.1168"></a><span id="l40.1168"> </span>
<a href="#l40.1169"></a><span id="l40.1169">     nsresult rv = SendData(command.get());</span>
<a href="#l40.1170"></a><span id="l40.1170">     if (NS_SUCCEEDED(rv))</span>
<a href="#l40.1171"></a><span id="l40.1171">     {</span>
<a href="#l40.1172"></a><span id="l40.1172">         m_flagChangeCount = 0;</span>
<a href="#l40.1173"></a><span id="l40.1173">         m_lastCheckTime = PR_Now();</span>
<a href="#l40.1174"></a><span id="l40.1174">         ParseIMAPandCheckForNewMail();</span>
<a href="#l40.1175"></a><span id="l40.1175">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -674,17 +674,17 @@ void nsImapServerResponseParser::respons</span>
<a href="#l41.4"></a><span id="l41.4">         fServerConnection.GetCurrentUrl()-&gt;GetCommand(customCommand);</span>
<a href="#l41.5"></a><span id="l41.5">         if (customCommand.Equals(fNextToken))</span>
<a href="#l41.6"></a><span id="l41.6">         {</span>
<a href="#l41.7"></a><span id="l41.7">           nsAutoCString customCommandResponse;</span>
<a href="#l41.8"></a><span id="l41.8">           while (Connected() &amp;&amp; !fAtEndOfLine)</span>
<a href="#l41.9"></a><span id="l41.9">           {</span>
<a href="#l41.10"></a><span id="l41.10">             AdvanceToNextToken();</span>
<a href="#l41.11"></a><span id="l41.11">             customCommandResponse.Append(fNextToken);</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-            customCommandResponse.Append(&quot; &quot;);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+            customCommandResponse.Append(' ');</span>
<a href="#l41.14"></a><span id="l41.14">           }</span>
<a href="#l41.15"></a><span id="l41.15">           fServerConnection.GetCurrentUrl()-&gt;SetCustomCommandResult(customCommandResponse);</span>
<a href="#l41.16"></a><span id="l41.16">         }</span>
<a href="#l41.17"></a><span id="l41.17">         else</span>
<a href="#l41.18"></a><span id="l41.18">           SetSyntaxError(true);</span>
<a href="#l41.19"></a><span id="l41.19">       }</span>
<a href="#l41.20"></a><span id="l41.20">       break;</span>
<a href="#l41.21"></a><span id="l41.21">     case 'Q':</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineat">@@ -1524,25 +1524,25 @@ void nsImapServerResponseParser::xaolenv</span>
<a href="#l41.23"></a><span id="l41.23">       AdvanceToNextToken();</span>
<a href="#l41.24"></a><span id="l41.24">       if (ContinueParse())</span>
<a href="#l41.25"></a><span id="l41.25">       {</span>
<a href="#l41.26"></a><span id="l41.26">         nsAutoCString fromLine;</span>
<a href="#l41.27"></a><span id="l41.27">         if (!strcmp(GetSelectedMailboxName(), &quot;Sent Items&quot;))</span>
<a href="#l41.28"></a><span id="l41.28">         {</span>
<a href="#l41.29"></a><span id="l41.29">           // xaol envelope switches the From with the To, so we switch them back and</span>
<a href="#l41.30"></a><span id="l41.30">           // create a fake from line From: user@aol.com</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-          fromLine.Append(&quot;To: &quot;);</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+          fromLine.AppendLiteral(&quot;To: &quot;);</span>
<a href="#l41.33"></a><span id="l41.33">           nsAutoCString fakeFromLine(NS_LITERAL_CSTRING(&quot;From: &quot;));</span>
<a href="#l41.34"></a><span id="l41.34">           fakeFromLine.Append(fServerConnection.GetImapUserName());</span>
<a href="#l41.35"></a><span id="l41.35">           fakeFromLine.Append(NS_LITERAL_CSTRING(&quot;@aol.com&quot;));</span>
<a href="#l41.36"></a><span id="l41.36">           fServerConnection.HandleMessageDownLoadLine(fakeFromLine.get(), false);</span>
<a href="#l41.37"></a><span id="l41.37">         }</span>
<a href="#l41.38"></a><span id="l41.38">         else</span>
<a href="#l41.39"></a><span id="l41.39">         {</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineminus">-          fromLine.Append(&quot;From: &quot;);</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineplus">+          fromLine.AppendLiteral(&quot;From: &quot;);</span>
<a href="#l41.42"></a><span id="l41.42">         }</span>
<a href="#l41.43"></a><span id="l41.43">         parse_address(fromLine);</span>
<a href="#l41.44"></a><span id="l41.44">         fServerConnection.HandleMessageDownLoadLine(fromLine.get(), false);</span>
<a href="#l41.45"></a><span id="l41.45">         if (ContinueParse())</span>
<a href="#l41.46"></a><span id="l41.46">         {</span>
<a href="#l41.47"></a><span id="l41.47">           AdvanceToNextToken();	// ge attachment size</span>
<a href="#l41.48"></a><span id="l41.48">           int32_t attachmentSize = atoi(fNextToken);</span>
<a href="#l41.49"></a><span id="l41.49">           if (attachmentSize != 0)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -208,17 +208,17 @@ NS_IMETHODIMP nsImapService::SelectFolde</span>
<a href="#l42.4"></a><span id="l42.4">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.5"></a><span id="l42.5">     mailNewsUrl-&gt;SetUpdatingFolder(true);</span>
<a href="#l42.6"></a><span id="l42.6">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.9"></a><span id="l42.9">     {</span>
<a href="#l42.10"></a><span id="l42.10">       nsAutoCString folderName;</span>
<a href="#l42.11"></a><span id="l42.11">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-      urlSpec.Append(&quot;/select&gt;&quot;);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/select&gt;&quot;);</span>
<a href="#l42.14"></a><span id="l42.14">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.15"></a><span id="l42.15">       urlSpec.Append(folderName);</span>
<a href="#l42.16"></a><span id="l42.16">       rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l42.17"></a><span id="l42.17">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.18"></a><span id="l42.18">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.19"></a><span id="l42.19">     }</span>
<a href="#l42.20"></a><span id="l42.20">   } // if we have a url to run....</span>
<a href="#l42.21"></a><span id="l42.21"> </span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -261,23 +261,23 @@ NS_IMETHODIMP nsImapService::GetUrlForUr</span>
<a href="#l42.23"></a><span id="l42.23">     nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l42.24"></a><span id="l42.24">     bool useLocalCache = false;</span>
<a href="#l42.25"></a><span id="l42.25">     folder-&gt;HasMsgOffline(strtoul(msgKey.get(), nullptr, 10), &amp;useLocalCache);</span>
<a href="#l42.26"></a><span id="l42.26">     mailnewsUrl-&gt;SetMsgIsInLocalCache(useLocalCache);</span>
<a href="#l42.27"></a><span id="l42.27"> </span>
<a href="#l42.28"></a><span id="l42.28">     nsCOMPtr&lt;nsIURI&gt; url = do_QueryInterface(imapUrl);</span>
<a href="#l42.29"></a><span id="l42.29">     rv = url-&gt;GetSpec(urlSpec);</span>
<a href="#l42.30"></a><span id="l42.30">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-    urlSpec.Append(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+    urlSpec.AppendLiteral(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l42.33"></a><span id="l42.33">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.34"></a><span id="l42.34"> </span>
<a href="#l42.35"></a><span id="l42.35">     nsAutoCString folderName;</span>
<a href="#l42.36"></a><span id="l42.36">     GetFolderName(folder, folderName);</span>
<a href="#l42.37"></a><span id="l42.37">     urlSpec.Append(folderName);</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineminus">-    urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineplus">+    urlSpec.Append('&gt;');</span>
<a href="#l42.40"></a><span id="l42.40">     urlSpec.Append(msgKey);</span>
<a href="#l42.41"></a><span id="l42.41">     rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l42.42"></a><span id="l42.42">     imapUrl-&gt;QueryInterface(NS_GET_IID(nsIURI), (void **) aURL);</span>
<a href="#l42.43"></a><span id="l42.43">   }</span>
<a href="#l42.44"></a><span id="l42.44"> </span>
<a href="#l42.45"></a><span id="l42.45">   return rv;</span>
<a href="#l42.46"></a><span id="l42.46"> }</span>
<a href="#l42.47"></a><span id="l42.47"> </span>
<a href="#l42.48"></a><span id="l42.48" class="difflineat">@@ -338,23 +338,23 @@ NS_IMETHODIMP nsImapService::OpenAttachm</span>
<a href="#l42.49"></a><span id="l42.49">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.50"></a><span id="l42.50">     {</span>
<a href="#l42.51"></a><span id="l42.51">       nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l42.52"></a><span id="l42.52">       nsAutoCString urlSpec;</span>
<a href="#l42.53"></a><span id="l42.53">       char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l42.54"></a><span id="l42.54">       rv = CreateStartOfImapUrl(uri, getter_AddRefs(imapUrl), folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l42.55"></a><span id="l42.55">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.56"></a><span id="l42.56"> </span>
<a href="#l42.57"></a><span id="l42.57" class="difflineminus">-      urlSpec.Append(&quot;/fetch&gt;UID&gt;&quot;);</span>
<a href="#l42.58"></a><span id="l42.58" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/fetch&gt;UID&gt;&quot;);</span>
<a href="#l42.59"></a><span id="l42.59">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.60"></a><span id="l42.60"> </span>
<a href="#l42.61"></a><span id="l42.61">       nsCString folderName;</span>
<a href="#l42.62"></a><span id="l42.62">       GetFolderName(folder, folderName);</span>
<a href="#l42.63"></a><span id="l42.63">       urlSpec.Append(folderName);</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.65"></a><span id="l42.65" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.66"></a><span id="l42.66">       urlSpec.Append(msgKey);</span>
<a href="#l42.67"></a><span id="l42.67">       urlSpec.Append(uriMimePart);</span>
<a href="#l42.68"></a><span id="l42.68"> </span>
<a href="#l42.69"></a><span id="l42.69">       if (!uriMimePart.IsEmpty())</span>
<a href="#l42.70"></a><span id="l42.70">       {</span>
<a href="#l42.71"></a><span id="l42.71">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailUrl (do_QueryInterface(imapUrl));</span>
<a href="#l42.72"></a><span id="l42.72">         if (mailUrl)</span>
<a href="#l42.73"></a><span id="l42.73">         {</span>
<a href="#l42.74"></a><span id="l42.74" class="difflineat">@@ -596,17 +596,17 @@ nsresult nsImapService::FetchMimePart(ns</span>
<a href="#l42.75"></a><span id="l42.75"> </span>
<a href="#l42.76"></a><span id="l42.76">     rv = url-&gt;GetSpec(urlSpec);</span>
<a href="#l42.77"></a><span id="l42.77">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.78"></a><span id="l42.78"> </span>
<a href="#l42.79"></a><span id="l42.79">     // rhp: If we are displaying this message for the purpose of printing, we</span>
<a href="#l42.80"></a><span id="l42.80">     // need to append the header=print option.</span>
<a href="#l42.81"></a><span id="l42.81">     //</span>
<a href="#l42.82"></a><span id="l42.82">     if (mPrintingOperation)</span>
<a href="#l42.83"></a><span id="l42.83" class="difflineminus">-      urlSpec.Append(&quot;?header=print&quot;);</span>
<a href="#l42.84"></a><span id="l42.84" class="difflineplus">+      urlSpec.AppendLiteral(&quot;?header=print&quot;);</span>
<a href="#l42.85"></a><span id="l42.85"> </span>
<a href="#l42.86"></a><span id="l42.86">     rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l42.87"></a><span id="l42.87">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.88"></a><span id="l42.88"> </span>
<a href="#l42.89"></a><span id="l42.89">     rv = aImapUrl-&gt;SetImapAction(actionToUse /* nsIImapUrl::nsImapMsgFetch */);</span>
<a href="#l42.90"></a><span id="l42.90">     if (aImapMailFolder &amp;&amp; aDisplayConsumer)</span>
<a href="#l42.91"></a><span id="l42.91">     {</span>
<a href="#l42.92"></a><span id="l42.92">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; aMsgIncomingServer;</span>
<a href="#l42.93"></a><span id="l42.93" class="difflineat">@@ -825,17 +825,17 @@ NS_IMETHODIMP nsImapService::Search(nsIM</span>
<a href="#l42.94"></a><span id="l42.94">   {</span>
<a href="#l42.95"></a><span id="l42.95">     nsCString folderName;</span>
<a href="#l42.96"></a><span id="l42.96">     GetFolderName(aMsgFolder, folderName);</span>
<a href="#l42.97"></a><span id="l42.97"> </span>
<a href="#l42.98"></a><span id="l42.98">     nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; mailNewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l42.99"></a><span id="l42.99">     if (!aMsgWindow)</span>
<a href="#l42.100"></a><span id="l42.100">       mailNewsUrl-&gt;SetSuppressErrorMsgs(true);</span>
<a href="#l42.101"></a><span id="l42.101"> </span>
<a href="#l42.102"></a><span id="l42.102" class="difflineminus">-    urlSpec.Append(&quot;/search&gt;UID&gt;&quot;);</span>
<a href="#l42.103"></a><span id="l42.103" class="difflineplus">+    urlSpec.AppendLiteral(&quot;/search&gt;UID&gt;&quot;);</span>
<a href="#l42.104"></a><span id="l42.104">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.105"></a><span id="l42.105">     urlSpec.Append(folderName);</span>
<a href="#l42.106"></a><span id="l42.106">     urlSpec.Append('&gt;');</span>
<a href="#l42.107"></a><span id="l42.107">     // escape aSearchUri so that IMAP special characters (i.e. '\')</span>
<a href="#l42.108"></a><span id="l42.108">     // won't be replaced with '/' in NECKO.</span>
<a href="#l42.109"></a><span id="l42.109">     // it will be unescaped in nsImapUrl::ParseUrl().</span>
<a href="#l42.110"></a><span id="l42.110">     nsCString escapedSearchUri;</span>
<a href="#l42.111"></a><span id="l42.111"> </span>
<a href="#l42.112"></a><span id="l42.112" class="difflineat">@@ -955,29 +955,29 @@ NS_IMETHODIMP nsImapService::AddImapFetc</span>
<a href="#l42.113"></a><span id="l42.113">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l42.114"></a><span id="l42.114"> </span>
<a href="#l42.115"></a><span id="l42.115">   nsAutoCString urlSpec;</span>
<a href="#l42.116"></a><span id="l42.116">   nsresult rv = aUrl-&gt;GetSpec(urlSpec);</span>
<a href="#l42.117"></a><span id="l42.117">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.118"></a><span id="l42.118"> </span>
<a href="#l42.119"></a><span id="l42.119">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l42.120"></a><span id="l42.120"> </span>
<a href="#l42.121"></a><span id="l42.121" class="difflineminus">-  urlSpec.Append(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l42.122"></a><span id="l42.122" class="difflineplus">+  urlSpec.AppendLiteral(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l42.123"></a><span id="l42.123">   urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.124"></a><span id="l42.124"> </span>
<a href="#l42.125"></a><span id="l42.125">   nsAutoCString folderName;</span>
<a href="#l42.126"></a><span id="l42.126">   GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.127"></a><span id="l42.127">   urlSpec.Append(folderName);</span>
<a href="#l42.128"></a><span id="l42.128"> </span>
<a href="#l42.129"></a><span id="l42.129" class="difflineminus">-  urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.130"></a><span id="l42.130" class="difflineplus">+  urlSpec.Append('&gt;');</span>
<a href="#l42.131"></a><span id="l42.131">   urlSpec.Append(aMessageIdentifierList);</span>
<a href="#l42.132"></a><span id="l42.132"> </span>
<a href="#l42.133"></a><span id="l42.133">   if (!aAdditionalHeader.IsEmpty())</span>
<a href="#l42.134"></a><span id="l42.134">   {</span>
<a href="#l42.135"></a><span id="l42.135" class="difflineminus">-    urlSpec.Append(&quot;?header=&quot;);</span>
<a href="#l42.136"></a><span id="l42.136" class="difflineplus">+    urlSpec.AppendLiteral(&quot;?header=&quot;);</span>
<a href="#l42.137"></a><span id="l42.137">     urlSpec.Append(aAdditionalHeader);</span>
<a href="#l42.138"></a><span id="l42.138">   }</span>
<a href="#l42.139"></a><span id="l42.139"> </span>
<a href="#l42.140"></a><span id="l42.140">   return aUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l42.141"></a><span id="l42.141"> }</span>
<a href="#l42.142"></a><span id="l42.142"> </span>
<a href="#l42.143"></a><span id="l42.143"> NS_IMETHODIMP nsImapService::FetchMessage(nsIImapUrl *aImapUrl,</span>
<a href="#l42.144"></a><span id="l42.144">                                           nsImapAction aImapAction,</span>
<a href="#l42.145"></a><span id="l42.145" class="difflineat">@@ -1401,26 +1401,26 @@ NS_IMETHODIMP nsImapService::GetHeaders(</span>
<a href="#l42.146"></a><span id="l42.146">   {</span>
<a href="#l42.147"></a><span id="l42.147">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.148"></a><span id="l42.148"> </span>
<a href="#l42.149"></a><span id="l42.149">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgFetch);</span>
<a href="#l42.150"></a><span id="l42.150">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l42.151"></a><span id="l42.151"> </span>
<a href="#l42.152"></a><span id="l42.152">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.153"></a><span id="l42.153">     {</span>
<a href="#l42.154"></a><span id="l42.154" class="difflineminus">-      urlSpec.Append(&quot;/header&gt;&quot;);</span>
<a href="#l42.155"></a><span id="l42.155" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/header&gt;&quot;);</span>
<a href="#l42.156"></a><span id="l42.156">       urlSpec.Append(messageIdsAreUID ? uidString : sequenceString);</span>
<a href="#l42.157"></a><span id="l42.157" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.158"></a><span id="l42.158" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.159"></a><span id="l42.159">       urlSpec.Append(char (hierarchyDelimiter));</span>
<a href="#l42.160"></a><span id="l42.160"> </span>
<a href="#l42.161"></a><span id="l42.161">       nsCString folderName;</span>
<a href="#l42.162"></a><span id="l42.162"> </span>
<a href="#l42.163"></a><span id="l42.163">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.164"></a><span id="l42.164">       urlSpec.Append(folderName);</span>
<a href="#l42.165"></a><span id="l42.165" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.166"></a><span id="l42.166" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.167"></a><span id="l42.167">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l42.168"></a><span id="l42.168">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.169"></a><span id="l42.169"> </span>
<a href="#l42.170"></a><span id="l42.170">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.171"></a><span id="l42.171">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.172"></a><span id="l42.172">     }</span>
<a href="#l42.173"></a><span id="l42.173">   }</span>
<a href="#l42.174"></a><span id="l42.174">   return rv;</span>
<a href="#l42.175"></a><span id="l42.175" class="difflineat">@@ -1451,27 +1451,27 @@ NS_IMETHODIMP nsImapService::GetBodyStar</span>
<a href="#l42.176"></a><span id="l42.176">   {</span>
<a href="#l42.177"></a><span id="l42.177">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgPreview);</span>
<a href="#l42.178"></a><span id="l42.178">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l42.179"></a><span id="l42.179"> </span>
<a href="#l42.180"></a><span id="l42.180">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.181"></a><span id="l42.181">     {</span>
<a href="#l42.182"></a><span id="l42.182">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.183"></a><span id="l42.183"> </span>
<a href="#l42.184"></a><span id="l42.184" class="difflineminus">-      urlSpec.Append(&quot;/previewBody&gt;&quot;);</span>
<a href="#l42.185"></a><span id="l42.185" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/previewBody&gt;&quot;);</span>
<a href="#l42.186"></a><span id="l42.186">       urlSpec.Append(uidString);</span>
<a href="#l42.187"></a><span id="l42.187" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.188"></a><span id="l42.188" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.189"></a><span id="l42.189">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.190"></a><span id="l42.190"> </span>
<a href="#l42.191"></a><span id="l42.191">       nsCString folderName;</span>
<a href="#l42.192"></a><span id="l42.192">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.193"></a><span id="l42.193">       urlSpec.Append(folderName);</span>
<a href="#l42.194"></a><span id="l42.194" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.195"></a><span id="l42.195" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.196"></a><span id="l42.196">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l42.197"></a><span id="l42.197" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.198"></a><span id="l42.198" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.199"></a><span id="l42.199">       urlSpec.AppendInt(numBytes);</span>
<a href="#l42.200"></a><span id="l42.200">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.201"></a><span id="l42.201">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.202"></a><span id="l42.202">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.203"></a><span id="l42.203">     }</span>
<a href="#l42.204"></a><span id="l42.204">   }</span>
<a href="#l42.205"></a><span id="l42.205">   return rv;</span>
<a href="#l42.206"></a><span id="l42.206"> }</span>
<a href="#l42.207"></a><span id="l42.207" class="difflineat">@@ -1529,17 +1529,17 @@ nsImapService::VerifyLogon(nsIMsgFolder </span>
<a href="#l42.208"></a><span id="l42.208">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l42.209"></a><span id="l42.209">   {</span>
<a href="#l42.210"></a><span id="l42.210">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.211"></a><span id="l42.211"> </span>
<a href="#l42.212"></a><span id="l42.212">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailNewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l42.213"></a><span id="l42.213">     mailNewsUrl-&gt;SetSuppressErrorMsgs(true);</span>
<a href="#l42.214"></a><span id="l42.214">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.215"></a><span id="l42.215">     rv = SetImapUrlSink(aFolder, imapUrl);</span>
<a href="#l42.216"></a><span id="l42.216" class="difflineminus">-    urlSpec.Append(&quot;/verifyLogon&quot;);</span>
<a href="#l42.217"></a><span id="l42.217" class="difflineplus">+    urlSpec.AppendLiteral(&quot;/verifyLogon&quot;);</span>
<a href="#l42.218"></a><span id="l42.218">     rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.219"></a><span id="l42.219">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.220"></a><span id="l42.220">       rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, nullptr);</span>
<a href="#l42.221"></a><span id="l42.221">     if (aURL)</span>
<a href="#l42.222"></a><span id="l42.222">       uri.forget(aURL);</span>
<a href="#l42.223"></a><span id="l42.223">   }</span>
<a href="#l42.224"></a><span id="l42.224">   return rv;</span>
<a href="#l42.225"></a><span id="l42.225"> }</span>
<a href="#l42.226"></a><span id="l42.226" class="difflineat">@@ -1596,23 +1596,23 @@ NS_IMETHODIMP nsImapService::Biff(nsIMsg</span>
<a href="#l42.227"></a><span id="l42.227">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l42.228"></a><span id="l42.228">   {</span>
<a href="#l42.229"></a><span id="l42.229">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapExpungeFolder);</span>
<a href="#l42.230"></a><span id="l42.230">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l42.231"></a><span id="l42.231"> </span>
<a href="#l42.232"></a><span id="l42.232">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.233"></a><span id="l42.233">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.234"></a><span id="l42.234">     {</span>
<a href="#l42.235"></a><span id="l42.235" class="difflineminus">-      urlSpec.Append(&quot;/Biff&gt;&quot;);</span>
<a href="#l42.236"></a><span id="l42.236" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/Biff&gt;&quot;);</span>
<a href="#l42.237"></a><span id="l42.237">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.238"></a><span id="l42.238"> </span>
<a href="#l42.239"></a><span id="l42.239">       nsCString folderName;</span>
<a href="#l42.240"></a><span id="l42.240">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.241"></a><span id="l42.241">       urlSpec.Append(folderName);</span>
<a href="#l42.242"></a><span id="l42.242" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.243"></a><span id="l42.243" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.244"></a><span id="l42.244">       urlSpec.AppendInt(uidHighWater);</span>
<a href="#l42.245"></a><span id="l42.245">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.246"></a><span id="l42.246">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.247"></a><span id="l42.247">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.248"></a><span id="l42.248">     }</span>
<a href="#l42.249"></a><span id="l42.249">   }</span>
<a href="#l42.250"></a><span id="l42.250">   return rv;</span>
<a href="#l42.251"></a><span id="l42.251"> }</span>
<a href="#l42.252"></a><span id="l42.252" class="difflineat">@@ -1662,25 +1662,25 @@ NS_IMETHODIMP nsImapService::DeleteMessa</span>
<a href="#l42.253"></a><span id="l42.253">   {</span>
<a href="#l42.254"></a><span id="l42.254">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgFetch);</span>
<a href="#l42.255"></a><span id="l42.255">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l42.256"></a><span id="l42.256"> </span>
<a href="#l42.257"></a><span id="l42.257">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.258"></a><span id="l42.258">     {</span>
<a href="#l42.259"></a><span id="l42.259">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.260"></a><span id="l42.260"> </span>
<a href="#l42.261"></a><span id="l42.261" class="difflineminus">-      urlSpec.Append(&quot;/deletemsg&gt;&quot;);</span>
<a href="#l42.262"></a><span id="l42.262" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/deletemsg&gt;&quot;);</span>
<a href="#l42.263"></a><span id="l42.263">       urlSpec.Append(messageIdsAreUID ? uidString : sequenceString);</span>
<a href="#l42.264"></a><span id="l42.264" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.265"></a><span id="l42.265" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.266"></a><span id="l42.266">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.267"></a><span id="l42.267"> </span>
<a href="#l42.268"></a><span id="l42.268">       nsCString folderName;</span>
<a href="#l42.269"></a><span id="l42.269">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.270"></a><span id="l42.270">       urlSpec.Append(folderName);</span>
<a href="#l42.271"></a><span id="l42.271" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.272"></a><span id="l42.272" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.273"></a><span id="l42.273">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l42.274"></a><span id="l42.274">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.275"></a><span id="l42.275">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.276"></a><span id="l42.276">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.277"></a><span id="l42.277">     }</span>
<a href="#l42.278"></a><span id="l42.278">   }</span>
<a href="#l42.279"></a><span id="l42.279">   return rv;</span>
<a href="#l42.280"></a><span id="l42.280"> }</span>
<a href="#l42.281"></a><span id="l42.281" class="difflineat">@@ -1763,22 +1763,22 @@ nsresult nsImapService::DiddleFlags(nsIM</span>
<a href="#l42.282"></a><span id="l42.282">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.283"></a><span id="l42.283">     {</span>
<a href="#l42.284"></a><span id="l42.284">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.285"></a><span id="l42.285"> </span>
<a href="#l42.286"></a><span id="l42.286">       urlSpec.Append('/');</span>
<a href="#l42.287"></a><span id="l42.287">       urlSpec.Append(howToDiddle);</span>
<a href="#l42.288"></a><span id="l42.288">       urlSpec.Append('&gt;');</span>
<a href="#l42.289"></a><span id="l42.289">       urlSpec.Append(messageIdsAreUID ? uidString : sequenceString);</span>
<a href="#l42.290"></a><span id="l42.290" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.291"></a><span id="l42.291" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.292"></a><span id="l42.292">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.293"></a><span id="l42.293">       nsCString folderName;</span>
<a href="#l42.294"></a><span id="l42.294">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l42.295"></a><span id="l42.295">       urlSpec.Append(folderName);</span>
<a href="#l42.296"></a><span id="l42.296" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.297"></a><span id="l42.297" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.298"></a><span id="l42.298">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l42.299"></a><span id="l42.299">       urlSpec.Append('&gt;');</span>
<a href="#l42.300"></a><span id="l42.300">       urlSpec.AppendInt(flags);</span>
<a href="#l42.301"></a><span id="l42.301">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.302"></a><span id="l42.302">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.303"></a><span id="l42.303">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.304"></a><span id="l42.304">     }</span>
<a href="#l42.305"></a><span id="l42.305">   }</span>
<a href="#l42.306"></a><span id="l42.306" class="difflineat">@@ -1834,17 +1834,17 @@ NS_IMETHODIMP nsImapService::DiscoverAll</span>
<a href="#l42.307"></a><span id="l42.307">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l42.308"></a><span id="l42.308"> </span>
<a href="#l42.309"></a><span id="l42.309">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.310"></a><span id="l42.310">     {</span>
<a href="#l42.311"></a><span id="l42.311">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.312"></a><span id="l42.312">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(imapUrl);</span>
<a href="#l42.313"></a><span id="l42.313">       if (mailnewsurl)</span>
<a href="#l42.314"></a><span id="l42.314">         mailnewsurl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.315"></a><span id="l42.315" class="difflineminus">-      urlSpec.Append(&quot;/discoverallboxes&quot;);</span>
<a href="#l42.316"></a><span id="l42.316" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/discoverallboxes&quot;);</span>
<a href="#l42.317"></a><span id="l42.317">       nsCOMPtr &lt;nsIURI&gt; url = do_QueryInterface(imapUrl, &amp;rv);</span>
<a href="#l42.318"></a><span id="l42.318">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.319"></a><span id="l42.319">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.320"></a><span id="l42.320">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.321"></a><span id="l42.321">     }</span>
<a href="#l42.322"></a><span id="l42.322">   }</span>
<a href="#l42.323"></a><span id="l42.323">   return rv;</span>
<a href="#l42.324"></a><span id="l42.324"> }</span>
<a href="#l42.325"></a><span id="l42.325" class="difflineat">@@ -1862,17 +1862,17 @@ NS_IMETHODIMP nsImapService::DiscoverAll</span>
<a href="#l42.326"></a><span id="l42.326">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(aImapUrl), aImapMailFolder,</span>
<a href="#l42.327"></a><span id="l42.327">                                      aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l42.328"></a><span id="l42.328">   if (NS_SUCCEEDED(rv) &amp;&amp; aImapUrl)</span>
<a href="#l42.329"></a><span id="l42.329">   {</span>
<a href="#l42.330"></a><span id="l42.330">     rv = SetImapUrlSink(aImapMailFolder, aImapUrl);</span>
<a href="#l42.331"></a><span id="l42.331">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.332"></a><span id="l42.332">     {</span>
<a href="#l42.333"></a><span id="l42.333">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(aImapUrl);</span>
<a href="#l42.334"></a><span id="l42.334" class="difflineminus">-      urlSpec.Append(&quot;/discoverallandsubscribedboxes&quot;);</span>
<a href="#l42.335"></a><span id="l42.335" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/discoverallandsubscribedboxes&quot;);</span>
<a href="#l42.336"></a><span id="l42.336">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.337"></a><span id="l42.337">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.338"></a><span id="l42.338">         rv = GetImapConnectionAndLoadUrl(aImapUrl, nullptr, aURL);</span>
<a href="#l42.339"></a><span id="l42.339">     }</span>
<a href="#l42.340"></a><span id="l42.340">   }</span>
<a href="#l42.341"></a><span id="l42.341">   return rv;</span>
<a href="#l42.342"></a><span id="l42.342"> }</span>
<a href="#l42.343"></a><span id="l42.343"> </span>
<a href="#l42.344"></a><span id="l42.344" class="difflineat">@@ -1892,17 +1892,17 @@ NS_IMETHODIMP nsImapService::DiscoverChi</span>
<a href="#l42.345"></a><span id="l42.345">   if (NS_SUCCEEDED (rv))</span>
<a href="#l42.346"></a><span id="l42.346">   {</span>
<a href="#l42.347"></a><span id="l42.347">     rv = SetImapUrlSink(aImapMailFolder, aImapUrl);</span>
<a href="#l42.348"></a><span id="l42.348">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.349"></a><span id="l42.349">     {</span>
<a href="#l42.350"></a><span id="l42.350">       if (!folderPath.IsEmpty())</span>
<a href="#l42.351"></a><span id="l42.351">       {</span>
<a href="#l42.352"></a><span id="l42.352">         nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(aImapUrl);</span>
<a href="#l42.353"></a><span id="l42.353" class="difflineminus">-        urlSpec.Append(&quot;/discoverchildren&gt;&quot;);</span>
<a href="#l42.354"></a><span id="l42.354" class="difflineplus">+        urlSpec.AppendLiteral(&quot;/discoverchildren&gt;&quot;);</span>
<a href="#l42.355"></a><span id="l42.355">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.356"></a><span id="l42.356">         urlSpec.Append(folderPath);</span>
<a href="#l42.357"></a><span id="l42.357">         rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l42.358"></a><span id="l42.358"> </span>
<a href="#l42.359"></a><span id="l42.359">         // Make sure the uri has the same hierarchy separator as the one in msg folder </span>
<a href="#l42.360"></a><span id="l42.360">         // obj if it's not kOnlineHierarchySeparatorUnknown (ie, '^').</span>
<a href="#l42.361"></a><span id="l42.361">         char uriDelimiter;</span>
<a href="#l42.362"></a><span id="l42.362">         nsresult rv1 = aImapUrl-&gt;GetOnlineSubDirSeparator(&amp;uriDelimiter);</span>
<a href="#l42.363"></a><span id="l42.363" class="difflineat">@@ -1965,19 +1965,19 @@ NS_IMETHODIMP nsImapService::OnlineMessa</span>
<a href="#l42.364"></a><span id="l42.364">     imapUrl-&gt;SetCopyState(copyState);</span>
<a href="#l42.365"></a><span id="l42.365"> </span>
<a href="#l42.366"></a><span id="l42.366">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgurl (do_QueryInterface(imapUrl));</span>
<a href="#l42.367"></a><span id="l42.367"> </span>
<a href="#l42.368"></a><span id="l42.368">     msgurl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.369"></a><span id="l42.369">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.370"></a><span id="l42.370"> </span>
<a href="#l42.371"></a><span id="l42.371">     if (isMove)</span>
<a href="#l42.372"></a><span id="l42.372" class="difflineminus">-      urlSpec.Append(&quot;/onlinemove&gt;&quot;);</span>
<a href="#l42.373"></a><span id="l42.373" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/onlinemove&gt;&quot;);</span>
<a href="#l42.374"></a><span id="l42.374">     else</span>
<a href="#l42.375"></a><span id="l42.375" class="difflineminus">-      urlSpec.Append(&quot;/onlinecopy&gt;&quot;);</span>
<a href="#l42.376"></a><span id="l42.376" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/onlinecopy&gt;&quot;);</span>
<a href="#l42.377"></a><span id="l42.377">     if (idsAreUids)</span>
<a href="#l42.378"></a><span id="l42.378">       urlSpec.Append(uidString);</span>
<a href="#l42.379"></a><span id="l42.379">     else</span>
<a href="#l42.380"></a><span id="l42.380">       urlSpec.Append(sequenceString);</span>
<a href="#l42.381"></a><span id="l42.381">     urlSpec.Append('&gt;');</span>
<a href="#l42.382"></a><span id="l42.382">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.383"></a><span id="l42.383"> </span>
<a href="#l42.384"></a><span id="l42.384">     nsCString folderName;</span>
<a href="#l42.385"></a><span id="l42.385" class="difflineat">@@ -2154,19 +2154,19 @@ NS_IMETHODIMP nsImapService::AppendMessa</span>
<a href="#l42.386"></a><span id="l42.386"> </span>
<a href="#l42.387"></a><span id="l42.387">     SetImapUrlSink(aDstFolder, imapUrl);</span>
<a href="#l42.388"></a><span id="l42.388">     imapUrl-&gt;SetMsgFile(aFile);</span>
<a href="#l42.389"></a><span id="l42.389">     imapUrl-&gt;SetCopyState(aCopyState);</span>
<a href="#l42.390"></a><span id="l42.390"> </span>
<a href="#l42.391"></a><span id="l42.391">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.392"></a><span id="l42.392"> </span>
<a href="#l42.393"></a><span id="l42.393">     if (inSelectedState)</span>
<a href="#l42.394"></a><span id="l42.394" class="difflineminus">-      urlSpec.Append(&quot;/appenddraftfromfile&gt;&quot;);</span>
<a href="#l42.395"></a><span id="l42.395" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/appenddraftfromfile&gt;&quot;);</span>
<a href="#l42.396"></a><span id="l42.396">     else</span>
<a href="#l42.397"></a><span id="l42.397" class="difflineminus">-      urlSpec.Append(&quot;/appendmsgfromfile&gt;&quot;);</span>
<a href="#l42.398"></a><span id="l42.398" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/appendmsgfromfile&gt;&quot;);</span>
<a href="#l42.399"></a><span id="l42.399"> </span>
<a href="#l42.400"></a><span id="l42.400">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.401"></a><span id="l42.401"> </span>
<a href="#l42.402"></a><span id="l42.402">     nsCString folderName;</span>
<a href="#l42.403"></a><span id="l42.403">     GetFolderName(aDstFolder, folderName);</span>
<a href="#l42.404"></a><span id="l42.404">     urlSpec.Append(folderName);</span>
<a href="#l42.405"></a><span id="l42.405"> </span>
<a href="#l42.406"></a><span id="l42.406">     if (inSelectedState)</span>
<a href="#l42.407"></a><span id="l42.407" class="difflineat">@@ -2259,17 +2259,17 @@ NS_IMETHODIMP nsImapService::MoveFolder(</span>
<a href="#l42.408"></a><span id="l42.408">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailNewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l42.409"></a><span id="l42.409">       if (mailNewsUrl)</span>
<a href="#l42.410"></a><span id="l42.410">         mailNewsUrl-&gt;SetMsgWindow(msgWindow);</span>
<a href="#l42.411"></a><span id="l42.411">       char hierarchyDelimiter = kOnlineHierarchySeparatorUnknown;</span>
<a href="#l42.412"></a><span id="l42.412">       nsCString folderName;</span>
<a href="#l42.413"></a><span id="l42.413"> </span>
<a href="#l42.414"></a><span id="l42.414">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.415"></a><span id="l42.415">       GetFolderName(srcFolder, folderName);</span>
<a href="#l42.416"></a><span id="l42.416" class="difflineminus">-      urlSpec.Append(&quot;/movefolderhierarchy&gt;&quot;);</span>
<a href="#l42.417"></a><span id="l42.417" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/movefolderhierarchy&gt;&quot;);</span>
<a href="#l42.418"></a><span id="l42.418">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.419"></a><span id="l42.419">       urlSpec.Append(folderName);</span>
<a href="#l42.420"></a><span id="l42.420">       urlSpec.Append('&gt;');</span>
<a href="#l42.421"></a><span id="l42.421">       GetFolderName(dstFolder, folderName);</span>
<a href="#l42.422"></a><span id="l42.422">       if (!folderName.IsEmpty())</span>
<a href="#l42.423"></a><span id="l42.423">       {</span>
<a href="#l42.424"></a><span id="l42.424">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.425"></a><span id="l42.425">         urlSpec.Append(folderName);</span>
<a href="#l42.426"></a><span id="l42.426" class="difflineat">@@ -2305,17 +2305,17 @@ NS_IMETHODIMP nsImapService::RenameLeaf(</span>
<a href="#l42.427"></a><span id="l42.427">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.428"></a><span id="l42.428">     {</span>
<a href="#l42.429"></a><span id="l42.429">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.430"></a><span id="l42.430">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailNewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l42.431"></a><span id="l42.431">       if (mailNewsUrl)</span>
<a href="#l42.432"></a><span id="l42.432">         mailNewsUrl-&gt;SetMsgWindow(msgWindow);</span>
<a href="#l42.433"></a><span id="l42.433">       nsCString folderName;</span>
<a href="#l42.434"></a><span id="l42.434">       GetFolderName(srcFolder, folderName);</span>
<a href="#l42.435"></a><span id="l42.435" class="difflineminus">-      urlSpec.Append(&quot;/rename&gt;&quot;);</span>
<a href="#l42.436"></a><span id="l42.436" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/rename&gt;&quot;);</span>
<a href="#l42.437"></a><span id="l42.437">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.438"></a><span id="l42.438">       urlSpec.Append(folderName);</span>
<a href="#l42.439"></a><span id="l42.439">       urlSpec.Append('&gt;');</span>
<a href="#l42.440"></a><span id="l42.440">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.441"></a><span id="l42.441">       nsAutoCString cStrFolderName;</span>
<a href="#l42.442"></a><span id="l42.442">       // Unescape the name before looking for parent path</span>
<a href="#l42.443"></a><span id="l42.443">       MsgUnescapeString(folderName, 0, cStrFolderName);</span>
<a href="#l42.444"></a><span id="l42.444">       int32_t leafNameStart = cStrFolderName.RFindChar(hierarchyDelimiter);</span>
<a href="#l42.445"></a><span id="l42.445" class="difflineat">@@ -2360,17 +2360,17 @@ NS_IMETHODIMP nsImapService::CreateFolde</span>
<a href="#l42.446"></a><span id="l42.446">   {</span>
<a href="#l42.447"></a><span id="l42.447">     rv = SetImapUrlSink(parent, imapUrl);</span>
<a href="#l42.448"></a><span id="l42.448">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.449"></a><span id="l42.449">     {</span>
<a href="#l42.450"></a><span id="l42.450">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.451"></a><span id="l42.451"> </span>
<a href="#l42.452"></a><span id="l42.452">       nsCString folderName;</span>
<a href="#l42.453"></a><span id="l42.453">       GetFolderName(parent, folderName);</span>
<a href="#l42.454"></a><span id="l42.454" class="difflineminus">-      urlSpec.Append(&quot;/create&gt;&quot;);</span>
<a href="#l42.455"></a><span id="l42.455" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/create&gt;&quot;);</span>
<a href="#l42.456"></a><span id="l42.456">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.457"></a><span id="l42.457">       if (!folderName.IsEmpty())</span>
<a href="#l42.458"></a><span id="l42.458">       {</span>
<a href="#l42.459"></a><span id="l42.459">         nsCString canonicalName;</span>
<a href="#l42.460"></a><span id="l42.460">         nsImapUrl::ConvertToCanonicalFormat(folderName.get(),</span>
<a href="#l42.461"></a><span id="l42.461">                                             hierarchyDelimiter,</span>
<a href="#l42.462"></a><span id="l42.462">                                             getter_Copies(canonicalName));</span>
<a href="#l42.463"></a><span id="l42.463">         urlSpec.Append(canonicalName);</span>
<a href="#l42.464"></a><span id="l42.464" class="difflineat">@@ -2409,17 +2409,17 @@ NS_IMETHODIMP nsImapService::EnsureFolde</span>
<a href="#l42.465"></a><span id="l42.465">   {</span>
<a href="#l42.466"></a><span id="l42.466">     rv = SetImapUrlSink(parent, imapUrl);</span>
<a href="#l42.467"></a><span id="l42.467">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.468"></a><span id="l42.468">     {</span>
<a href="#l42.469"></a><span id="l42.469">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l42.470"></a><span id="l42.470"> </span>
<a href="#l42.471"></a><span id="l42.471">       nsCString folderName;</span>
<a href="#l42.472"></a><span id="l42.472">       GetFolderName(parent, folderName);</span>
<a href="#l42.473"></a><span id="l42.473" class="difflineminus">-      urlSpec.Append(&quot;/ensureExists&gt;&quot;);</span>
<a href="#l42.474"></a><span id="l42.474" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/ensureExists&gt;&quot;);</span>
<a href="#l42.475"></a><span id="l42.475">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.476"></a><span id="l42.476">       if (!folderName.IsEmpty())</span>
<a href="#l42.477"></a><span id="l42.477">       {</span>
<a href="#l42.478"></a><span id="l42.478">         urlSpec.Append(folderName);</span>
<a href="#l42.479"></a><span id="l42.479">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.480"></a><span id="l42.480">       }</span>
<a href="#l42.481"></a><span id="l42.481">       nsAutoCString utfNewName; </span>
<a href="#l42.482"></a><span id="l42.482">       CopyUTF16toMUTF7(PromiseFlatString(newFolderName), utfNewName);</span>
<a href="#l42.483"></a><span id="l42.483" class="difflineat">@@ -2442,17 +2442,17 @@ NS_IMETHODIMP nsImapService::ListFolder(</span>
<a href="#l42.484"></a><span id="l42.484">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l42.485"></a><span id="l42.485"> </span>
<a href="#l42.486"></a><span id="l42.486">   return FolderCommand(aImapMailFolder, aUrlListener,</span>
<a href="#l42.487"></a><span id="l42.487">                        &quot;/listfolder&gt;&quot;, nsIImapUrl::nsImapListFolder, nullptr, aURL);</span>
<a href="#l42.488"></a><span id="l42.488"> }</span>
<a href="#l42.489"></a><span id="l42.489"> </span>
<a href="#l42.490"></a><span id="l42.490"> NS_IMETHODIMP nsImapService::GetScheme(nsACString &amp;aScheme)</span>
<a href="#l42.491"></a><span id="l42.491"> {</span>
<a href="#l42.492"></a><span id="l42.492" class="difflineminus">-  aScheme.Assign(&quot;imap&quot;);</span>
<a href="#l42.493"></a><span id="l42.493" class="difflineplus">+  aScheme.AssignLiteral(&quot;imap&quot;);</span>
<a href="#l42.494"></a><span id="l42.494">   return NS_OK; </span>
<a href="#l42.495"></a><span id="l42.495"> }</span>
<a href="#l42.496"></a><span id="l42.496"> </span>
<a href="#l42.497"></a><span id="l42.497"> NS_IMETHODIMP nsImapService::GetDefaultPort(int32_t *aDefaultPort)</span>
<a href="#l42.498"></a><span id="l42.498"> {</span>
<a href="#l42.499"></a><span id="l42.499">   NS_ENSURE_ARG_POINTER(aDefaultPort);</span>
<a href="#l42.500"></a><span id="l42.500">   *aDefaultPort = nsIImapUrl::DEFAULT_IMAP_PORT;</span>
<a href="#l42.501"></a><span id="l42.501">   return NS_OK;</span>
<a href="#l42.502"></a><span id="l42.502" class="difflineat">@@ -3005,17 +3005,17 @@ NS_IMETHODIMP nsImapService::GetListOfFo</span>
<a href="#l42.503"></a><span id="l42.503">       tokenStr = StringHead(tempFolderName, slashPos);</span>
<a href="#l42.504"></a><span id="l42.504">       remStr = Substring(tempFolderName, slashPos);</span>
<a href="#l42.505"></a><span id="l42.505">     }</span>
<a href="#l42.506"></a><span id="l42.506">     else</span>
<a href="#l42.507"></a><span id="l42.507">       tokenStr.Assign(tempFolderName);</span>
<a href="#l42.508"></a><span id="l42.508"> </span>
<a href="#l42.509"></a><span id="l42.509">     if (tokenStr.LowerCaseEqualsLiteral(&quot;inbox&quot;) &amp;&amp;</span>
<a href="#l42.510"></a><span id="l42.510">         !tokenStr.EqualsLiteral(&quot;INBOX&quot;))</span>
<a href="#l42.511"></a><span id="l42.511" class="difflineminus">-      changedStr.Append(&quot;INBOX&quot;);</span>
<a href="#l42.512"></a><span id="l42.512" class="difflineplus">+      changedStr.AppendLiteral(&quot;INBOX&quot;);</span>
<a href="#l42.513"></a><span id="l42.513">     else</span>
<a href="#l42.514"></a><span id="l42.514">       changedStr.Append(tokenStr);</span>
<a href="#l42.515"></a><span id="l42.515"> </span>
<a href="#l42.516"></a><span id="l42.516">     if (slashPos &gt; 0 ) </span>
<a href="#l42.517"></a><span id="l42.517">       changedStr.Append(remStr);</span>
<a href="#l42.518"></a><span id="l42.518"> </span>
<a href="#l42.519"></a><span id="l42.519">     rv = rootMsgFolder-&gt;FindSubFolder(changedStr, getter_AddRefs(msgFolder));</span>
<a href="#l42.520"></a><span id="l42.520">   }</span>
<a href="#l42.521"></a><span id="l42.521" class="difflineat">@@ -3135,24 +3135,24 @@ NS_IMETHODIMP nsImapService::IssueComman</span>
<a href="#l42.522"></a><span id="l42.522">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.523"></a><span id="l42.523">     mailNewsUrl-&gt;SetUpdatingFolder(true);</span>
<a href="#l42.524"></a><span id="l42.524">     rv = SetImapUrlSink(anImapFolder, imapUrl);</span>
<a href="#l42.525"></a><span id="l42.525"> </span>
<a href="#l42.526"></a><span id="l42.526">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.527"></a><span id="l42.527">     {</span>
<a href="#l42.528"></a><span id="l42.528">       nsCString folderName;</span>
<a href="#l42.529"></a><span id="l42.529">       GetFolderName(anImapFolder, folderName);</span>
<a href="#l42.530"></a><span id="l42.530" class="difflineminus">-      urlSpec.Append(&quot;/&quot;);</span>
<a href="#l42.531"></a><span id="l42.531" class="difflineplus">+      urlSpec.Append('/');</span>
<a href="#l42.532"></a><span id="l42.532">       urlSpec.Append(aCommand);</span>
<a href="#l42.533"></a><span id="l42.533" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.534"></a><span id="l42.534" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.535"></a><span id="l42.535">       urlSpec.Append(uidString);</span>
<a href="#l42.536"></a><span id="l42.536" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.537"></a><span id="l42.537" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.538"></a><span id="l42.538">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.539"></a><span id="l42.539">       urlSpec.Append(folderName);</span>
<a href="#l42.540"></a><span id="l42.540" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.541"></a><span id="l42.541" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.542"></a><span id="l42.542">       urlSpec.Append(uids);</span>
<a href="#l42.543"></a><span id="l42.543">       rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l42.544"></a><span id="l42.544">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.545"></a><span id="l42.545">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.546"></a><span id="l42.546">     }</span>
<a href="#l42.547"></a><span id="l42.547">   } // if we have a url to run....</span>
<a href="#l42.548"></a><span id="l42.548"> </span>
<a href="#l42.549"></a><span id="l42.549">   return rv;</span>
<a href="#l42.550"></a><span id="l42.550" class="difflineat">@@ -3182,22 +3182,22 @@ NS_IMETHODIMP nsImapService::FetchCustom</span>
<a href="#l42.551"></a><span id="l42.551">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.552"></a><span id="l42.552">     mailNewsUrl-&gt;SetUpdatingFolder(true);</span>
<a href="#l42.553"></a><span id="l42.553">     rv = SetImapUrlSink(anImapFolder, imapUrl);</span>
<a href="#l42.554"></a><span id="l42.554"> </span>
<a href="#l42.555"></a><span id="l42.555">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.556"></a><span id="l42.556">     {</span>
<a href="#l42.557"></a><span id="l42.557">       nsCString folderName;</span>
<a href="#l42.558"></a><span id="l42.558">       GetFolderName(anImapFolder, folderName);</span>
<a href="#l42.559"></a><span id="l42.559" class="difflineminus">-      urlSpec.Append(&quot;/customFetch&gt;UID&gt;&quot;);</span>
<a href="#l42.560"></a><span id="l42.560" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/customFetch&gt;UID&gt;&quot;);</span>
<a href="#l42.561"></a><span id="l42.561">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.562"></a><span id="l42.562">       urlSpec.Append(folderName);</span>
<a href="#l42.563"></a><span id="l42.563" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.564"></a><span id="l42.564" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.565"></a><span id="l42.565">       urlSpec.Append(uids);</span>
<a href="#l42.566"></a><span id="l42.566" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.567"></a><span id="l42.567" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.568"></a><span id="l42.568">       urlSpec.Append(aAttribute);</span>
<a href="#l42.569"></a><span id="l42.569">       rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l42.570"></a><span id="l42.570">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.571"></a><span id="l42.571">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.572"></a><span id="l42.572">     }</span>
<a href="#l42.573"></a><span id="l42.573">   } // if we have a url to run....</span>
<a href="#l42.574"></a><span id="l42.574"> </span>
<a href="#l42.575"></a><span id="l42.575">   return rv;</span>
<a href="#l42.576"></a><span id="l42.576" class="difflineat">@@ -3227,24 +3227,24 @@ NS_IMETHODIMP nsImapService::StoreCustom</span>
<a href="#l42.577"></a><span id="l42.577">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l42.578"></a><span id="l42.578">     mailNewsUrl-&gt;SetUpdatingFolder(true);</span>
<a href="#l42.579"></a><span id="l42.579">     rv = SetImapUrlSink(anImapFolder, imapUrl);</span>
<a href="#l42.580"></a><span id="l42.580"> </span>
<a href="#l42.581"></a><span id="l42.581">     if (NS_SUCCEEDED(rv))</span>
<a href="#l42.582"></a><span id="l42.582">     {</span>
<a href="#l42.583"></a><span id="l42.583">       nsCString folderName;</span>
<a href="#l42.584"></a><span id="l42.584">       GetFolderName(anImapFolder, folderName);</span>
<a href="#l42.585"></a><span id="l42.585" class="difflineminus">-      urlSpec.Append(&quot;/customKeywords&gt;UID&gt;&quot;);</span>
<a href="#l42.586"></a><span id="l42.586" class="difflineplus">+      urlSpec.AppendLiteral(&quot;/customKeywords&gt;UID&gt;&quot;);</span>
<a href="#l42.587"></a><span id="l42.587">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l42.588"></a><span id="l42.588">       urlSpec.Append(folderName);</span>
<a href="#l42.589"></a><span id="l42.589" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.590"></a><span id="l42.590" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.591"></a><span id="l42.591">       urlSpec.Append(uids);</span>
<a href="#l42.592"></a><span id="l42.592" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.593"></a><span id="l42.593" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.594"></a><span id="l42.594">       urlSpec.Append(flagsToAdd);</span>
<a href="#l42.595"></a><span id="l42.595" class="difflineminus">-      urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l42.596"></a><span id="l42.596" class="difflineplus">+      urlSpec.Append('&gt;');</span>
<a href="#l42.597"></a><span id="l42.597">       urlSpec.Append(flagsToSubtract);</span>
<a href="#l42.598"></a><span id="l42.598">       rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l42.599"></a><span id="l42.599">       if (NS_SUCCEEDED(rv))</span>
<a href="#l42.600"></a><span id="l42.600">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l42.601"></a><span id="l42.601">     }</span>
<a href="#l42.602"></a><span id="l42.602">   } // if we have a url to run....</span>
<a href="#l42.603"></a><span id="l42.603"> </span>
<a href="#l42.604"></a><span id="l42.604">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -280,17 +280,17 @@ nsImapMoveCopyMsgTxn::GetSrcKeyArray(nsT</span>
<a href="#l43.4"></a><span id="l43.4">     srcKeyArray = m_srcKeyArray;</span>
<a href="#l43.5"></a><span id="l43.5">     return NS_OK;</span>
<a href="#l43.6"></a><span id="l43.6"> }</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8"> nsresult</span>
<a href="#l43.9"></a><span id="l43.9"> nsImapMoveCopyMsgTxn::AddDstKey(nsMsgKey aKey)</span>
<a href="#l43.10"></a><span id="l43.10"> {</span>
<a href="#l43.11"></a><span id="l43.11">     if (!m_dstMsgIdString.IsEmpty())</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-        m_dstMsgIdString.Append(&quot;,&quot;);</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+        m_dstMsgIdString.Append(',');</span>
<a href="#l43.14"></a><span id="l43.14">     m_dstMsgIdString.AppendInt((int32_t) aKey);</span>
<a href="#l43.15"></a><span id="l43.15">     return NS_OK;</span>
<a href="#l43.16"></a><span id="l43.16"> }</span>
<a href="#l43.17"></a><span id="l43.17"> </span>
<a href="#l43.18"></a><span id="l43.18"> nsresult</span>
<a href="#l43.19"></a><span id="l43.19"> nsImapMoveCopyMsgTxn::UndoMailboxDelete()</span>
<a href="#l43.20"></a><span id="l43.20"> {</span>
<a href="#l43.21"></a><span id="l43.21">     nsresult rv = NS_ERROR_FAILURE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckyMail.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckyMail.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -356,17 +356,17 @@ static inline bool</span>
<a href="#l44.4"></a><span id="l44.4"> IsEndOfHeaders(const nsCString &amp;aLine)</span>
<a href="#l44.5"></a><span id="l44.5"> {</span>
<a href="#l44.6"></a><span id="l44.6">   return aLine.IsEmpty();</span>
<a href="#l44.7"></a><span id="l44.7"> }</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9"> static inline bool</span>
<a href="#l44.10"></a><span id="l44.10"> IsEndOfMessage(const nsCString &amp;aLine)</span>
<a href="#l44.11"></a><span id="l44.11"> {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  return aLine.Equals(&quot;.&quot;);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+  return aLine.EqualsLiteral(&quot;.&quot;);</span>
<a href="#l44.14"></a><span id="l44.14"> }</span>
<a href="#l44.15"></a><span id="l44.15"> </span>
<a href="#l44.16"></a><span id="l44.16"> class ImportMessageRunnable: public mozilla::Runnable</span>
<a href="#l44.17"></a><span id="l44.17"> {</span>
<a href="#l44.18"></a><span id="l44.18"> public:</span>
<a href="#l44.19"></a><span id="l44.19">   ImportMessageRunnable(nsIFile *aMessageFile,</span>
<a href="#l44.20"></a><span id="l44.20">                         nsIMsgFolder *aFolder);</span>
<a href="#l44.21"></a><span id="l44.21">   NS_DECL_NSIRUNNABLE</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckySettings.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckySettings.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -185,32 +185,32 @@ nsBeckySettings::SetupSmtpServer(nsISmtp</span>
<a href="#l45.4"></a><span id="l45.4">     nsresult errorCode;</span>
<a href="#l45.5"></a><span id="l45.5">     port = value.ToInteger(&amp;errorCode, 10);</span>
<a href="#l45.6"></a><span id="l45.6">   }</span>
<a href="#l45.7"></a><span id="l45.7">   server-&gt;SetPort(port);</span>
<a href="#l45.8"></a><span id="l45.8"> </span>
<a href="#l45.9"></a><span id="l45.9">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.10"></a><span id="l45.10">                      NS_LITERAL_CSTRING(&quot;SSLSMTP&quot;),</span>
<a href="#l45.11"></a><span id="l45.11">                      value);</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  if (value.Equals(&quot;1&quot;))</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  if (value.EqualsLiteral(&quot;1&quot;))</span>
<a href="#l45.14"></a><span id="l45.14">     server-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l45.15"></a><span id="l45.15"> </span>
<a href="#l45.16"></a><span id="l45.16">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.17"></a><span id="l45.17">                      NS_LITERAL_CSTRING(&quot;SMTPAUTH&quot;),</span>
<a href="#l45.18"></a><span id="l45.18">                      value);</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineminus">-  if (value.Equals(&quot;1&quot;)) {</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineplus">+  if (value.EqualsLiteral(&quot;1&quot;)) {</span>
<a href="#l45.21"></a><span id="l45.21">     mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.22"></a><span id="l45.22">                        NS_LITERAL_CSTRING(&quot;SMTPAUTHMODE&quot;),</span>
<a href="#l45.23"></a><span id="l45.23">                        value);</span>
<a href="#l45.24"></a><span id="l45.24">     nsMsgAuthMethodValue authMethod = nsMsgAuthMethod::none;</span>
<a href="#l45.25"></a><span id="l45.25" class="difflineminus">-    if (value.Equals(&quot;1&quot;)) {</span>
<a href="#l45.26"></a><span id="l45.26" class="difflineplus">+    if (value.EqualsLiteral(&quot;1&quot;)) {</span>
<a href="#l45.27"></a><span id="l45.27">       authMethod = nsMsgAuthMethod::passwordEncrypted;</span>
<a href="#l45.28"></a><span id="l45.28" class="difflineminus">-    } else if (value.Equals(&quot;2&quot;) ||</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">-               value.Equals(&quot;4&quot;) ||</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineminus">-               value.Equals(&quot;6&quot;)) {</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineplus">+    } else if (value.EqualsLiteral(&quot;2&quot;) ||</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+               value.EqualsLiteral(&quot;4&quot;) ||</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineplus">+               value.EqualsLiteral(&quot;6&quot;)) {</span>
<a href="#l45.34"></a><span id="l45.34">       authMethod = nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l45.35"></a><span id="l45.35">     } else {</span>
<a href="#l45.36"></a><span id="l45.36">       authMethod = nsMsgAuthMethod::anything;</span>
<a href="#l45.37"></a><span id="l45.37">     }</span>
<a href="#l45.38"></a><span id="l45.38">     server-&gt;SetAuthMethod(authMethod);</span>
<a href="#l45.39"></a><span id="l45.39">   }</span>
<a href="#l45.40"></a><span id="l45.40"> </span>
<a href="#l45.41"></a><span id="l45.41">   server.forget(aServer);</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineat">@@ -223,33 +223,33 @@ nsBeckySettings::SetPop3ServerProperties</span>
<a href="#l45.43"></a><span id="l45.43"> {</span>
<a href="#l45.44"></a><span id="l45.44">   nsCOMPtr&lt;nsIPop3IncomingServer&gt; pop3Server = do_QueryInterface(aServer);</span>
<a href="#l45.45"></a><span id="l45.45"> </span>
<a href="#l45.46"></a><span id="l45.46">   nsAutoCString value;</span>
<a href="#l45.47"></a><span id="l45.47">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.48"></a><span id="l45.48">                      NS_LITERAL_CSTRING(&quot;POP3Auth&quot;),</span>
<a href="#l45.49"></a><span id="l45.49">                      value); // 0: plain, 1: APOP, 2: CRAM-MD5, 3: NTLM</span>
<a href="#l45.50"></a><span id="l45.50">   nsMsgAuthMethodValue authMethod;</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineminus">-  if (value.IsEmpty() || value.Equals(&quot;0&quot;)) {</span>
<a href="#l45.52"></a><span id="l45.52" class="difflineplus">+  if (value.IsEmpty() || value.EqualsLiteral(&quot;0&quot;)) {</span>
<a href="#l45.53"></a><span id="l45.53">     authMethod = nsMsgAuthMethod::passwordCleartext;</span>
<a href="#l45.54"></a><span id="l45.54" class="difflineminus">-  } else if (value.Equals(&quot;1&quot;)) {</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineplus">+  } else if (value.EqualsLiteral(&quot;1&quot;)) {</span>
<a href="#l45.56"></a><span id="l45.56">     authMethod = nsMsgAuthMethod::old;</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineminus">-  } else if (value.Equals(&quot;2&quot;)) {</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineplus">+  } else if (value.EqualsLiteral(&quot;2&quot;)) {</span>
<a href="#l45.59"></a><span id="l45.59">     authMethod = nsMsgAuthMethod::passwordEncrypted;</span>
<a href="#l45.60"></a><span id="l45.60" class="difflineminus">-  } else if (value.Equals(&quot;3&quot;)) {</span>
<a href="#l45.61"></a><span id="l45.61" class="difflineplus">+  } else if (value.EqualsLiteral(&quot;3&quot;)) {</span>
<a href="#l45.62"></a><span id="l45.62">     authMethod = nsMsgAuthMethod::NTLM;</span>
<a href="#l45.63"></a><span id="l45.63">   } else {</span>
<a href="#l45.64"></a><span id="l45.64">     authMethod = nsMsgAuthMethod::none;</span>
<a href="#l45.65"></a><span id="l45.65">   }</span>
<a href="#l45.66"></a><span id="l45.66">   aServer-&gt;SetAuthMethod(authMethod);</span>
<a href="#l45.67"></a><span id="l45.67"> </span>
<a href="#l45.68"></a><span id="l45.68">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.69"></a><span id="l45.69">                      NS_LITERAL_CSTRING(&quot;LeaveServer&quot;),</span>
<a href="#l45.70"></a><span id="l45.70">                      value);</span>
<a href="#l45.71"></a><span id="l45.71" class="difflineminus">-  if (value.Equals(&quot;1&quot;)) {</span>
<a href="#l45.72"></a><span id="l45.72" class="difflineplus">+  if (value.EqualsLiteral(&quot;1&quot;)) {</span>
<a href="#l45.73"></a><span id="l45.73">     pop3Server-&gt;SetLeaveMessagesOnServer(true);</span>
<a href="#l45.74"></a><span id="l45.74">     nsresult rv = mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.75"></a><span id="l45.75">                                      NS_LITERAL_CSTRING(&quot;KeepDays&quot;),</span>
<a href="#l45.76"></a><span id="l45.76">                                      value);</span>
<a href="#l45.77"></a><span id="l45.77">     if (NS_FAILED(rv))</span>
<a href="#l45.78"></a><span id="l45.78">       return NS_OK;</span>
<a href="#l45.79"></a><span id="l45.79"> </span>
<a href="#l45.80"></a><span id="l45.80">     nsresult errorCode;</span>
<a href="#l45.81"></a><span id="l45.81" class="difflineat">@@ -266,17 +266,17 @@ nsBeckySettings::SetPop3ServerProperties</span>
<a href="#l45.82"></a><span id="l45.82"> nsresult</span>
<a href="#l45.83"></a><span id="l45.83"> nsBeckySettings::SetupIncomingServer(nsIMsgIncomingServer **aServer)</span>
<a href="#l45.84"></a><span id="l45.84"> {</span>
<a href="#l45.85"></a><span id="l45.85">   nsAutoCString value;</span>
<a href="#l45.86"></a><span id="l45.86">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.87"></a><span id="l45.87">                      NS_LITERAL_CSTRING(&quot;Protocol&quot;),</span>
<a href="#l45.88"></a><span id="l45.88">                      value);</span>
<a href="#l45.89"></a><span id="l45.89">   nsCString protocol;</span>
<a href="#l45.90"></a><span id="l45.90" class="difflineminus">-  if (value.Equals(&quot;1&quot;)) {</span>
<a href="#l45.91"></a><span id="l45.91" class="difflineplus">+  if (value.EqualsLiteral(&quot;1&quot;)) {</span>
<a href="#l45.92"></a><span id="l45.92">     protocol = NS_LITERAL_CSTRING(&quot;imap&quot;);</span>
<a href="#l45.93"></a><span id="l45.93">   } else {</span>
<a href="#l45.94"></a><span id="l45.94">     protocol = NS_LITERAL_CSTRING(&quot;pop3&quot;);</span>
<a href="#l45.95"></a><span id="l45.95">   }</span>
<a href="#l45.96"></a><span id="l45.96"> </span>
<a href="#l45.97"></a><span id="l45.97">   nsAutoCString userName, serverName;</span>
<a href="#l45.98"></a><span id="l45.98">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.99"></a><span id="l45.99">                      NS_LITERAL_CSTRING(&quot;MailServer&quot;),</span>
<a href="#l45.100"></a><span id="l45.100" class="difflineat">@@ -300,41 +300,41 @@ nsBeckySettings::SetupIncomingServer(nsI</span>
<a href="#l45.101"></a><span id="l45.101">                             value);</span>
<a href="#l45.102"></a><span id="l45.102">     if (NS_SUCCEEDED(rv))</span>
<a href="#l45.103"></a><span id="l45.103">       port = value.ToInteger(&amp;errorCode, 10);</span>
<a href="#l45.104"></a><span id="l45.104">     else</span>
<a href="#l45.105"></a><span id="l45.105">       port = 110;</span>
<a href="#l45.106"></a><span id="l45.106">     mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.107"></a><span id="l45.107">                        NS_LITERAL_CSTRING(&quot;SSLPOP&quot;),</span>
<a href="#l45.108"></a><span id="l45.108">                        value);</span>
<a href="#l45.109"></a><span id="l45.109" class="difflineminus">-    if (value.Equals(&quot;1&quot;))</span>
<a href="#l45.110"></a><span id="l45.110" class="difflineplus">+    if (value.EqualsLiteral(&quot;1&quot;))</span>
<a href="#l45.111"></a><span id="l45.111">       isSecure = true;</span>
<a href="#l45.112"></a><span id="l45.112">   } else if (protocol.EqualsLiteral(&quot;imap&quot;)) {</span>
<a href="#l45.113"></a><span id="l45.113">     rv = mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.114"></a><span id="l45.114">                             NS_LITERAL_CSTRING(&quot;IMAP4Port&quot;),</span>
<a href="#l45.115"></a><span id="l45.115">                             value);</span>
<a href="#l45.116"></a><span id="l45.116">     if (NS_SUCCEEDED(rv))</span>
<a href="#l45.117"></a><span id="l45.117">       port = value.ToInteger(&amp;errorCode, 10);</span>
<a href="#l45.118"></a><span id="l45.118">     else</span>
<a href="#l45.119"></a><span id="l45.119">       port = 143;</span>
<a href="#l45.120"></a><span id="l45.120">     mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.121"></a><span id="l45.121">                        NS_LITERAL_CSTRING(&quot;SSLIMAP&quot;),</span>
<a href="#l45.122"></a><span id="l45.122">                        value);</span>
<a href="#l45.123"></a><span id="l45.123" class="difflineminus">-    if (value.Equals(&quot;1&quot;))</span>
<a href="#l45.124"></a><span id="l45.124" class="difflineplus">+    if (value.EqualsLiteral(&quot;1&quot;))</span>
<a href="#l45.125"></a><span id="l45.125">       isSecure = true;</span>
<a href="#l45.126"></a><span id="l45.126">   }</span>
<a href="#l45.127"></a><span id="l45.127"> </span>
<a href="#l45.128"></a><span id="l45.128">   server-&gt;SetPort(port);</span>
<a href="#l45.129"></a><span id="l45.129">   if (isSecure)</span>
<a href="#l45.130"></a><span id="l45.130">     server-&gt;SetSocketType(nsMsgSocketType::SSL);</span>
<a href="#l45.131"></a><span id="l45.131"> </span>
<a href="#l45.132"></a><span id="l45.132">   mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.133"></a><span id="l45.133">                      NS_LITERAL_CSTRING(&quot;CheckInt&quot;),</span>
<a href="#l45.134"></a><span id="l45.134">                      value);</span>
<a href="#l45.135"></a><span id="l45.135" class="difflineminus">-  if (value.Equals(&quot;1&quot;))</span>
<a href="#l45.136"></a><span id="l45.136" class="difflineplus">+  if (value.EqualsLiteral(&quot;1&quot;))</span>
<a href="#l45.137"></a><span id="l45.137">     server-&gt;SetDoBiff(true);</span>
<a href="#l45.138"></a><span id="l45.138">   rv = mParser-&gt;GetString(NS_LITERAL_CSTRING(&quot;Account&quot;),</span>
<a href="#l45.139"></a><span id="l45.139">                           NS_LITERAL_CSTRING(&quot;CheckEvery&quot;),</span>
<a href="#l45.140"></a><span id="l45.140">                           value);</span>
<a href="#l45.141"></a><span id="l45.141">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l45.142"></a><span id="l45.142">     int32_t minutes = value.ToInteger(&amp;errorCode, 10);</span>
<a href="#l45.143"></a><span id="l45.143">     if (NS_SUCCEEDED(errorCode))</span>
<a href="#l45.144"></a><span id="l45.144">       server-&gt;SetBiffMinutes(minutes);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -727,17 +727,17 @@ bool CMapiMessage::FetchBody(void)</span>
<a href="#l46.4"></a><span id="l46.4">     const char* charset = nsMsgI18NFileSystemCharset();</span>
<a href="#l46.5"></a><span id="l46.5">     if (charset) {</span>
<a href="#l46.6"></a><span id="l46.6">       bFoundCharset = CheckBodyInCharsetRange(charset);</span>
<a href="#l46.7"></a><span id="l46.7">       if (bFoundCharset)</span>
<a href="#l46.8"></a><span id="l46.8">         m_mimeCharset.Assign(charset);</span>
<a href="#l46.9"></a><span id="l46.9">     }</span>
<a href="#l46.10"></a><span id="l46.10">   }</span>
<a href="#l46.11"></a><span id="l46.11">   if (!bFoundCharset) // Everything else failed, let's use the lossless utf-8...</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-    m_mimeCharset.Assign(&quot;utf-8&quot;);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+    m_mimeCharset.AssignLiteral(&quot;utf-8&quot;);</span>
<a href="#l46.14"></a><span id="l46.14"> </span>
<a href="#l46.15"></a><span id="l46.15">   MAPI_DUMP_STRING(m_body.get());</span>
<a href="#l46.16"></a><span id="l46.16">   MAPI_TRACE0(&quot;\r\n&quot;);</span>
<a href="#l46.17"></a><span id="l46.17"> </span>
<a href="#l46.18"></a><span id="l46.18">   return true;</span>
<a href="#l46.19"></a><span id="l46.19"> }</span>
<a href="#l46.20"></a><span id="l46.20"> </span>
<a href="#l46.21"></a><span id="l46.21"> void CMapiMessage::GetBody(nsCString&amp; dest) const</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -1619,17 +1619,17 @@ nsresult nsParseMailMessageState::Finali</span>
<a href="#l47.4"></a><span id="l47.4">           ParseString(oldKeywords, ' ', oldKeywordArray);</span>
<a href="#l47.5"></a><span id="l47.5">           for (uint32_t i = 0; i &lt; oldKeywordArray.Length(); i++)</span>
<a href="#l47.6"></a><span id="l47.6">             if (!newKeywordArray.Contains(oldKeywordArray[i]))</span>
<a href="#l47.7"></a><span id="l47.7">               newKeywordArray.AppendElement(oldKeywordArray[i]);</span>
<a href="#l47.8"></a><span id="l47.8">           nsAutoCString newKeywords;</span>
<a href="#l47.9"></a><span id="l47.9">           for (uint32_t i = 0; i &lt; newKeywordArray.Length(); i++)</span>
<a href="#l47.10"></a><span id="l47.10">           {</span>
<a href="#l47.11"></a><span id="l47.11">             if (i)</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-              newKeywords.Append(&quot; &quot;);</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+              newKeywords.Append(' ');</span>
<a href="#l47.14"></a><span id="l47.14">             newKeywords.Append(newKeywordArray[i]);</span>
<a href="#l47.15"></a><span id="l47.15">           }</span>
<a href="#l47.16"></a><span id="l47.16">           m_newMsgHdr-&gt;SetStringProperty(&quot;keywords&quot;, newKeywords.get());</span>
<a href="#l47.17"></a><span id="l47.17">         }</span>
<a href="#l47.18"></a><span id="l47.18">         for (uint32_t i = 0; i &lt; m_customDBHeaders.Length(); i++)</span>
<a href="#l47.19"></a><span id="l47.19">         {</span>
<a href="#l47.20"></a><span id="l47.20">           if (m_customDBHeaderValues[i].length)</span>
<a href="#l47.21"></a><span id="l47.21">             m_newMsgHdr-&gt;SetStringProperty(m_customDBHeaders[i].get(), m_customDBHeaderValues[i].value);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -377,24 +377,24 @@ nsPgpMimeProxy::Finish() {</span>
<a href="#l48.4"></a><span id="l48.4">     return mDecryptor-&gt;OnStopRequest((nsIRequest*) this, nullptr, NS_OK);</span>
<a href="#l48.5"></a><span id="l48.5">   }</span>
<a href="#l48.6"></a><span id="l48.6">   else {</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8">     if (!mOutputFun)</span>
<a href="#l48.9"></a><span id="l48.9">       return NS_ERROR_FAILURE;</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11">     nsCString temp;</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-    temp.Append(&quot;Content-Type: text/html\r\nCharset: UTF-8\r\n\r\n&lt;html&gt;&lt;body&gt;&quot;);</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-    temp.Append(&quot;&lt;BR&gt;&lt;text=\&quot;#000000\&quot; bgcolor=\&quot;#FFFFFF\&quot; link=\&quot;#FF0000\&quot; vlink=\&quot;#800080\&quot; alink=\&quot;#0000FF\&quot;&gt;&quot;);</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">-    temp.Append(&quot;&lt;center&gt;&lt;table BORDER=1 &gt;&lt;tr&gt;&lt;td&gt;&lt;CENTER&gt;&quot;);</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineplus">+    temp.AppendLiteral(&quot;Content-Type: text/html\r\nCharset: UTF-8\r\n\r\n&lt;html&gt;&lt;body&gt;&quot;);</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineplus">+    temp.AppendLiteral(&quot;&lt;BR&gt;&lt;text=\&quot;#000000\&quot; bgcolor=\&quot;#FFFFFF\&quot; link=\&quot;#FF0000\&quot; vlink=\&quot;#800080\&quot; alink=\&quot;#0000FF\&quot;&gt;&quot;);</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineplus">+    temp.AppendLiteral(&quot;&lt;center&gt;&lt;table BORDER=1 &gt;&lt;tr&gt;&lt;td&gt;&lt;CENTER&gt;&quot;);</span>
<a href="#l48.18"></a><span id="l48.18"> </span>
<a href="#l48.19"></a><span id="l48.19">     nsCString tString;</span>
<a href="#l48.20"></a><span id="l48.20">     PgpMimeGetNeedsAddonString(tString);</span>
<a href="#l48.21"></a><span id="l48.21">     temp.Append(tString);</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineminus">-    temp.Append(&quot;&lt;/CENTER&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;BR&gt;&lt;/body&gt;&lt;/html&gt;\r\n&quot;);</span>
<a href="#l48.23"></a><span id="l48.23" class="difflineplus">+    temp.AppendLiteral(&quot;&lt;/CENTER&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;BR&gt;&lt;/body&gt;&lt;/html&gt;\r\n&quot;);</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25">     PR_SetError(0,0);</span>
<a href="#l48.26"></a><span id="l48.26">     int status = mOutputFun(temp.get(), temp.Length(), mOutputClosure);</span>
<a href="#l48.27"></a><span id="l48.27">     if (status &lt; 0) {</span>
<a href="#l48.28"></a><span id="l48.28">       PR_SetError(status, 0);</span>
<a href="#l48.29"></a><span id="l48.29">       mOutputFun = nullptr;</span>
<a href="#l48.30"></a><span id="l48.30">       return NS_ERROR_FAILURE;</span>
<a href="#l48.31"></a><span id="l48.31">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -814,23 +814,23 @@ nsMimeBaseEmitter::WriteHeaderFieldHTML(</span>
<a href="#l49.4"></a><span id="l49.4">     nsAppendEscapedHTML(nsDependentCString(i18nValue), newValue);</span>
<a href="#l49.5"></a><span id="l49.5">   }</span>
<a href="#l49.6"></a><span id="l49.6"> </span>
<a href="#l49.7"></a><span id="l49.7">   free(i18nValue);</span>
<a href="#l49.8"></a><span id="l49.8"> </span>
<a href="#l49.9"></a><span id="l49.9">   if (newValue.IsEmpty())</span>
<a href="#l49.10"></a><span id="l49.10">     return NS_OK;</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;tr&gt;&quot;);</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;td&gt;&quot;);</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;tr&gt;&quot;);</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;td&gt;&quot;);</span>
<a href="#l49.16"></a><span id="l49.16"> </span>
<a href="#l49.17"></a><span id="l49.17">   if (mFormat == nsMimeOutput::nsMimeMessageSaveAs)</span>
<a href="#l49.18"></a><span id="l49.18" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;b&gt;&quot;);</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;b&gt;&quot;);</span>
<a href="#l49.20"></a><span id="l49.20">   else</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;div class=\&quot;headerdisplayname\&quot; style=\&quot;display:inline;\&quot;&gt;&quot;);</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;div class=\&quot;headerdisplayname\&quot; style=\&quot;display:inline;\&quot;&gt;&quot;);</span>
<a href="#l49.23"></a><span id="l49.23"> </span>
<a href="#l49.24"></a><span id="l49.24">   // Here is where we are going to try to L10N the tagName so we will always</span>
<a href="#l49.25"></a><span id="l49.25">   // get a field name next to an emitted header value. Note: Default will always</span>
<a href="#l49.26"></a><span id="l49.26">   // be the name of the header itself.</span>
<a href="#l49.27"></a><span id="l49.27">   //</span>
<a href="#l49.28"></a><span id="l49.28">   nsCString newTagName(field);</span>
<a href="#l49.29"></a><span id="l49.29">   newTagName.StripWhitespace();</span>
<a href="#l49.30"></a><span id="l49.30">   ToUpperCase(newTagName);</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineat">@@ -839,59 +839,59 @@ nsMimeBaseEmitter::WriteHeaderFieldHTML(</span>
<a href="#l49.32"></a><span id="l49.32">   if ( (!l10nTagName) || (!*l10nTagName) )</span>
<a href="#l49.33"></a><span id="l49.33">     mHTMLHeaders.Append(field);</span>
<a href="#l49.34"></a><span id="l49.34">   else</span>
<a href="#l49.35"></a><span id="l49.35">   {</span>
<a href="#l49.36"></a><span id="l49.36">     mHTMLHeaders.Append(l10nTagName);</span>
<a href="#l49.37"></a><span id="l49.37">     PR_FREEIF(l10nTagName);</span>
<a href="#l49.38"></a><span id="l49.38">   }</span>
<a href="#l49.39"></a><span id="l49.39"> </span>
<a href="#l49.40"></a><span id="l49.40" class="difflineminus">-  mHTMLHeaders.Append(&quot;: &quot;);</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;: &quot;);</span>
<a href="#l49.42"></a><span id="l49.42">   if (mFormat == nsMimeOutput::nsMimeMessageSaveAs)</span>
<a href="#l49.43"></a><span id="l49.43" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;/b&gt;&quot;);</span>
<a href="#l49.44"></a><span id="l49.44" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;/b&gt;&quot;);</span>
<a href="#l49.45"></a><span id="l49.45">   else</span>
<a href="#l49.46"></a><span id="l49.46" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;/div&gt;&quot;);</span>
<a href="#l49.47"></a><span id="l49.47" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;/div&gt;&quot;);</span>
<a href="#l49.48"></a><span id="l49.48"> </span>
<a href="#l49.49"></a><span id="l49.49">   // Now write out the actual value itself and move on!</span>
<a href="#l49.50"></a><span id="l49.50">   //</span>
<a href="#l49.51"></a><span id="l49.51">   mHTMLHeaders.Append(newValue);</span>
<a href="#l49.52"></a><span id="l49.52" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;/td&gt;&quot;);</span>
<a href="#l49.53"></a><span id="l49.53" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;/td&gt;&quot;);</span>
<a href="#l49.54"></a><span id="l49.54"> </span>
<a href="#l49.55"></a><span id="l49.55" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;/tr&gt;&quot;);</span>
<a href="#l49.56"></a><span id="l49.56" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;/tr&gt;&quot;);</span>
<a href="#l49.57"></a><span id="l49.57"> </span>
<a href="#l49.58"></a><span id="l49.58">   return NS_OK;</span>
<a href="#l49.59"></a><span id="l49.59"> }</span>
<a href="#l49.60"></a><span id="l49.60"> </span>
<a href="#l49.61"></a><span id="l49.61"> nsresult</span>
<a href="#l49.62"></a><span id="l49.62"> nsMimeBaseEmitter::WriteHeaderFieldHTMLPrefix(const nsACString &amp;name)</span>
<a href="#l49.63"></a><span id="l49.63"> {</span>
<a href="#l49.64"></a><span id="l49.64">   if (</span>
<a href="#l49.65"></a><span id="l49.65">       ( (mFormat == nsMimeOutput::nsMimeMessageSaveAs) &amp;&amp; (mFirstHeaders) ) ||</span>
<a href="#l49.66"></a><span id="l49.66">       ( (mFormat == nsMimeOutput::nsMimeMessagePrintOutput) &amp;&amp; (mFirstHeaders) )</span>
<a href="#l49.67"></a><span id="l49.67">      )</span>
<a href="#l49.68"></a><span id="l49.68">      /* DO NOTHING */ ;   // rhp: Do nothing...leaving the conditional like this so its</span>
<a href="#l49.69"></a><span id="l49.69">                           //      easier to see the logic of what is going on.</span>
<a href="#l49.70"></a><span id="l49.70">   else {</span>
<a href="#l49.71"></a><span id="l49.71" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;br&gt;&lt;fieldset class=\&quot;mimeAttachmentHeader\&quot;&gt;&quot;);</span>
<a href="#l49.72"></a><span id="l49.72" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;br&gt;&lt;fieldset class=\&quot;mimeAttachmentHeader\&quot;&gt;&quot;);</span>
<a href="#l49.73"></a><span id="l49.73">     if (!name.IsEmpty()) {</span>
<a href="#l49.74"></a><span id="l49.74" class="difflineminus">-      mHTMLHeaders.Append(&quot;&lt;legend class=\&quot;mimeAttachmentHeaderName\&quot;&gt;&quot;);</span>
<a href="#l49.75"></a><span id="l49.75" class="difflineplus">+      mHTMLHeaders.AppendLiteral(&quot;&lt;legend class=\&quot;mimeAttachmentHeaderName\&quot;&gt;&quot;);</span>
<a href="#l49.76"></a><span id="l49.76">       nsAppendEscapedHTML(name, mHTMLHeaders);</span>
<a href="#l49.77"></a><span id="l49.77" class="difflineminus">-      mHTMLHeaders.Append(&quot;&lt;/legend&gt;&quot;);</span>
<a href="#l49.78"></a><span id="l49.78" class="difflineplus">+      mHTMLHeaders.AppendLiteral(&quot;&lt;/legend&gt;&quot;);</span>
<a href="#l49.79"></a><span id="l49.79">     }</span>
<a href="#l49.80"></a><span id="l49.80" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;/fieldset&gt;&quot;);</span>
<a href="#l49.81"></a><span id="l49.81" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;/fieldset&gt;&quot;);</span>
<a href="#l49.82"></a><span id="l49.82">   }</span>
<a href="#l49.83"></a><span id="l49.83"> </span>
<a href="#l49.84"></a><span id="l49.84">   mFirstHeaders = false;</span>
<a href="#l49.85"></a><span id="l49.85">   return NS_OK;</span>
<a href="#l49.86"></a><span id="l49.86"> }</span>
<a href="#l49.87"></a><span id="l49.87"> </span>
<a href="#l49.88"></a><span id="l49.88"> nsresult</span>
<a href="#l49.89"></a><span id="l49.89"> nsMimeBaseEmitter::WriteHeaderFieldHTMLPostfix()</span>
<a href="#l49.90"></a><span id="l49.90"> {</span>
<a href="#l49.91"></a><span id="l49.91" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;br&gt;&quot;);</span>
<a href="#l49.92"></a><span id="l49.92" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;br&gt;&quot;);</span>
<a href="#l49.93"></a><span id="l49.93">   return NS_OK;</span>
<a href="#l49.94"></a><span id="l49.94"> }</span>
<a href="#l49.95"></a><span id="l49.95"> </span>
<a href="#l49.96"></a><span id="l49.96"> NS_IMETHODIMP</span>
<a href="#l49.97"></a><span id="l49.97"> nsMimeBaseEmitter::WriteHTMLHeaders(const nsACString &amp;name)</span>
<a href="#l49.98"></a><span id="l49.98"> {</span>
<a href="#l49.99"></a><span id="l49.99">   WriteHeaderFieldHTMLPrefix(name);</span>
<a href="#l49.100"></a><span id="l49.100"> </span>
<a href="#l49.101"></a><span id="l49.101" class="difflineat">@@ -915,29 +915,29 @@ nsMimeBaseEmitter::WriteHTMLHeaders(cons</span>
<a href="#l49.102"></a><span id="l49.102">   mHTMLHeaders = &quot;&quot;;</span>
<a href="#l49.103"></a><span id="l49.103"> </span>
<a href="#l49.104"></a><span id="l49.104">   return NS_OK;</span>
<a href="#l49.105"></a><span id="l49.105"> }</span>
<a href="#l49.106"></a><span id="l49.106"> </span>
<a href="#l49.107"></a><span id="l49.107"> nsresult</span>
<a href="#l49.108"></a><span id="l49.108"> nsMimeBaseEmitter::DumpSubjectFromDate()</span>
<a href="#l49.109"></a><span id="l49.109"> {</span>
<a href="#l49.110"></a><span id="l49.110" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part1\&quot;&gt;&quot;);</span>
<a href="#l49.111"></a><span id="l49.111" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part1\&quot;&gt;&quot;);</span>
<a href="#l49.112"></a><span id="l49.112"> </span>
<a href="#l49.113"></a><span id="l49.113">     // This is the envelope information</span>
<a href="#l49.114"></a><span id="l49.114">     OutputGenericHeader(HEADER_SUBJECT);</span>
<a href="#l49.115"></a><span id="l49.115">     OutputGenericHeader(HEADER_FROM);</span>
<a href="#l49.116"></a><span id="l49.116">     OutputGenericHeader(HEADER_DATE);</span>
<a href="#l49.117"></a><span id="l49.117"> </span>
<a href="#l49.118"></a><span id="l49.118">     // If we are Quoting a message, then we should dump the To: also</span>
<a href="#l49.119"></a><span id="l49.119">     if ( ( mFormat == nsMimeOutput::nsMimeMessageQuoting ) ||</span>
<a href="#l49.120"></a><span id="l49.120">          ( mFormat == nsMimeOutput::nsMimeMessageBodyQuoting ) )</span>
<a href="#l49.121"></a><span id="l49.121">       OutputGenericHeader(HEADER_TO);</span>
<a href="#l49.122"></a><span id="l49.122"> </span>
<a href="#l49.123"></a><span id="l49.123" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;/table&gt;&quot;);</span>
<a href="#l49.124"></a><span id="l49.124" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;/table&gt;&quot;);</span>
<a href="#l49.125"></a><span id="l49.125"> </span>
<a href="#l49.126"></a><span id="l49.126">   return NS_OK;</span>
<a href="#l49.127"></a><span id="l49.127"> }</span>
<a href="#l49.128"></a><span id="l49.128"> </span>
<a href="#l49.129"></a><span id="l49.129"> nsresult</span>
<a href="#l49.130"></a><span id="l49.130"> nsMimeBaseEmitter::DumpToCC()</span>
<a href="#l49.131"></a><span id="l49.131"> {</span>
<a href="#l49.132"></a><span id="l49.132">   const char * toField = GetHeaderValue(HEADER_TO);</span>
<a href="#l49.133"></a><span id="l49.133" class="difflineat">@@ -945,39 +945,39 @@ nsMimeBaseEmitter::DumpToCC()</span>
<a href="#l49.134"></a><span id="l49.134">   const char * bccField = GetHeaderValue(HEADER_BCC);</span>
<a href="#l49.135"></a><span id="l49.135">   const char * newsgroupField = GetHeaderValue(HEADER_NEWSGROUPS);</span>
<a href="#l49.136"></a><span id="l49.136"> </span>
<a href="#l49.137"></a><span id="l49.137">   // only dump these fields if we have at least one of them! When displaying news</span>
<a href="#l49.138"></a><span id="l49.138">   // messages that didn't have a To or Cc field, we'd always get an empty box</span>
<a href="#l49.139"></a><span id="l49.139">   // which looked weird.</span>
<a href="#l49.140"></a><span id="l49.140">   if (toField || ccField || bccField || newsgroupField)</span>
<a href="#l49.141"></a><span id="l49.141">   {</span>
<a href="#l49.142"></a><span id="l49.142" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part2\&quot;&gt;&quot;);</span>
<a href="#l49.143"></a><span id="l49.143" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part2\&quot;&gt;&quot;);</span>
<a href="#l49.144"></a><span id="l49.144"> </span>
<a href="#l49.145"></a><span id="l49.145">     if (toField)</span>
<a href="#l49.146"></a><span id="l49.146">       WriteHeaderFieldHTML(HEADER_TO, toField);</span>
<a href="#l49.147"></a><span id="l49.147">     if (ccField)</span>
<a href="#l49.148"></a><span id="l49.148">       WriteHeaderFieldHTML(HEADER_CC, ccField);</span>
<a href="#l49.149"></a><span id="l49.149">     if (bccField)</span>
<a href="#l49.150"></a><span id="l49.150">       WriteHeaderFieldHTML(HEADER_BCC, bccField);</span>
<a href="#l49.151"></a><span id="l49.151">     if (newsgroupField)</span>
<a href="#l49.152"></a><span id="l49.152">       WriteHeaderFieldHTML(HEADER_NEWSGROUPS, newsgroupField);</span>
<a href="#l49.153"></a><span id="l49.153"> </span>
<a href="#l49.154"></a><span id="l49.154" class="difflineminus">-    mHTMLHeaders.Append(&quot;&lt;/table&gt;&quot;);</span>
<a href="#l49.155"></a><span id="l49.155" class="difflineplus">+    mHTMLHeaders.AppendLiteral(&quot;&lt;/table&gt;&quot;);</span>
<a href="#l49.156"></a><span id="l49.156">   }</span>
<a href="#l49.157"></a><span id="l49.157"> </span>
<a href="#l49.158"></a><span id="l49.158">   return NS_OK;</span>
<a href="#l49.159"></a><span id="l49.159"> }</span>
<a href="#l49.160"></a><span id="l49.160"> </span>
<a href="#l49.161"></a><span id="l49.161"> nsresult</span>
<a href="#l49.162"></a><span id="l49.162"> nsMimeBaseEmitter::DumpRestOfHeaders()</span>
<a href="#l49.163"></a><span id="l49.163"> {</span>
<a href="#l49.164"></a><span id="l49.164">   nsTArray&lt;headerInfoType*&gt; *array = mDocHeader? mHeaderArray : mEmbeddedHeaderArray;</span>
<a href="#l49.165"></a><span id="l49.165"> </span>
<a href="#l49.166"></a><span id="l49.166" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part3\&quot;&gt;&quot;);</span>
<a href="#l49.167"></a><span id="l49.167" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part3\&quot;&gt;&quot;);</span>
<a href="#l49.168"></a><span id="l49.168"> </span>
<a href="#l49.169"></a><span id="l49.169">   for (size_t i = 0; i &lt; array-&gt;Length(); i++)</span>
<a href="#l49.170"></a><span id="l49.170">   {</span>
<a href="#l49.171"></a><span id="l49.171">     headerInfoType *headerInfo = array-&gt;ElementAt(i);</span>
<a href="#l49.172"></a><span id="l49.172">     if ( (!headerInfo) || (!headerInfo-&gt;name) || (!(*headerInfo-&gt;name)) ||</span>
<a href="#l49.173"></a><span id="l49.173">       (!headerInfo-&gt;value) || (!(*headerInfo-&gt;value)))</span>
<a href="#l49.174"></a><span id="l49.174">       continue;</span>
<a href="#l49.175"></a><span id="l49.175"> </span>
<a href="#l49.176"></a><span id="l49.176" class="difflineat">@@ -986,17 +986,17 @@ nsMimeBaseEmitter::DumpRestOfHeaders()</span>
<a href="#l49.177"></a><span id="l49.177">       (!PL_strcasecmp(HEADER_FROM, headerInfo-&gt;name)) ||</span>
<a href="#l49.178"></a><span id="l49.178">       (!PL_strcasecmp(HEADER_TO, headerInfo-&gt;name)) ||</span>
<a href="#l49.179"></a><span id="l49.179">       (!PL_strcasecmp(HEADER_CC, headerInfo-&gt;name)) )</span>
<a href="#l49.180"></a><span id="l49.180">       continue;</span>
<a href="#l49.181"></a><span id="l49.181"> </span>
<a href="#l49.182"></a><span id="l49.182">     WriteHeaderFieldHTML(headerInfo-&gt;name, headerInfo-&gt;value);</span>
<a href="#l49.183"></a><span id="l49.183">   }</span>
<a href="#l49.184"></a><span id="l49.184"> </span>
<a href="#l49.185"></a><span id="l49.185" class="difflineminus">-  mHTMLHeaders.Append(&quot;&lt;/table&gt;&quot;);</span>
<a href="#l49.186"></a><span id="l49.186" class="difflineplus">+  mHTMLHeaders.AppendLiteral(&quot;&lt;/table&gt;&quot;);</span>
<a href="#l49.187"></a><span id="l49.187">   return NS_OK;</span>
<a href="#l49.188"></a><span id="l49.188"> }</span>
<a href="#l49.189"></a><span id="l49.189"> </span>
<a href="#l49.190"></a><span id="l49.190"> nsresult</span>
<a href="#l49.191"></a><span id="l49.191"> nsMimeBaseEmitter::OutputGenericHeader(const char *aHeaderVal)</span>
<a href="#l49.192"></a><span id="l49.192"> {</span>
<a href="#l49.193"></a><span id="l49.193">   const char *val = GetHeaderValue(aHeaderVal);</span>
<a href="#l49.194"></a><span id="l49.194"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -1991,25 +1991,25 @@ mime_decompose_file_init_fn(void *stream</span>
<a href="#l50.4"></a><span id="l50.4">     nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder(do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l50.5"></a><span id="l50.5">     if (NS_SUCCEEDED(rv) &amp;&amp; mimeFinder)</span>
<a href="#l50.6"></a><span id="l50.6">     {</span>
<a href="#l50.7"></a><span id="l50.7">       nsAutoCString fileExtension;</span>
<a href="#l50.8"></a><span id="l50.8">       rv = mimeFinder-&gt;GetPrimaryExtension(contentType, EmptyCString(), fileExtension);</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">       if (NS_SUCCEEDED(rv) &amp;&amp; !fileExtension.IsEmpty())</span>
<a href="#l50.11"></a><span id="l50.11">       {</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-        newAttachName.Append(&quot;.&quot;);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+        newAttachName.Append('.');</span>
<a href="#l50.14"></a><span id="l50.14">         newAttachName.Append(fileExtension);</span>
<a href="#l50.15"></a><span id="l50.15">         extensionAdded = true;</span>
<a href="#l50.16"></a><span id="l50.16">       }</span>
<a href="#l50.17"></a><span id="l50.17">     }</span>
<a href="#l50.18"></a><span id="l50.18"> </span>
<a href="#l50.19"></a><span id="l50.19">     if (!extensionAdded)</span>
<a href="#l50.20"></a><span id="l50.20">     {</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineminus">-      newAttachName.Append(&quot;.tmp&quot;);</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineplus">+      newAttachName.AppendLiteral(&quot;.tmp&quot;);</span>
<a href="#l50.23"></a><span id="l50.23">     }</span>
<a href="#l50.24"></a><span id="l50.24"> </span>
<a href="#l50.25"></a><span id="l50.25">     nsMsgCreateTempFile(newAttachName.get(), getter_AddRefs(tmpFile));</span>
<a href="#l50.26"></a><span id="l50.26">   }</span>
<a href="#l50.27"></a><span id="l50.27">   nsresult rv;</span>
<a href="#l50.28"></a><span id="l50.28"> </span>
<a href="#l50.29"></a><span id="l50.29">   // This needs to be done so the attachment structure has a handle</span>
<a href="#l50.30"></a><span id="l50.30">   // on the temp file for this attachment...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -444,40 +444,40 @@ GenerateAttachmentData(MimeObject *objec</span>
<a href="#l51.4"></a><span id="l51.4">     else</span>
<a href="#l51.5"></a><span id="l51.5">       tmp-&gt;m_realName.Adopt(mime_part_address(object));</span>
<a href="#l51.6"></a><span id="l51.6">   } else {</span>
<a href="#l51.7"></a><span id="l51.7">     tmp-&gt;m_hasFilename = true;</span>
<a href="#l51.8"></a><span id="l51.8">   }</span>
<a href="#l51.9"></a><span id="l51.9"> </span>
<a href="#l51.10"></a><span id="l51.10">   if (!tmp-&gt;m_realName.IsEmpty() &amp;&amp; !tmp-&gt;m_isExternalAttachment)</span>
<a href="#l51.11"></a><span id="l51.11">   {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    urlString.Append(&quot;&amp;filename=&quot;);</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    urlString.AppendLiteral(&quot;&amp;filename=&quot;);</span>
<a href="#l51.14"></a><span id="l51.14">     nsAutoCString aResult;</span>
<a href="#l51.15"></a><span id="l51.15">     if (NS_SUCCEEDED(MsgEscapeString(tmp-&gt;m_realName,</span>
<a href="#l51.16"></a><span id="l51.16">                                      nsINetUtil::ESCAPE_XALPHAS, aResult)))</span>
<a href="#l51.17"></a><span id="l51.17">       urlString.Append(aResult);</span>
<a href="#l51.18"></a><span id="l51.18">     else</span>
<a href="#l51.19"></a><span id="l51.19">       urlString.Append(tmp-&gt;m_realName);</span>
<a href="#l51.20"></a><span id="l51.20">     if (tmp-&gt;m_realType.EqualsLiteral(&quot;message/rfc822&quot;) &amp;&amp;</span>
<a href="#l51.21"></a><span id="l51.21">            !StringEndsWith(urlString, NS_LITERAL_CSTRING(&quot;.eml&quot;), nsCaseInsensitiveCStringComparator()))</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineminus">-      urlString.Append(&quot;.eml&quot;);</span>
<a href="#l51.23"></a><span id="l51.23" class="difflineplus">+      urlString.AppendLiteral(&quot;.eml&quot;);</span>
<a href="#l51.24"></a><span id="l51.24">   } else if (tmp-&gt;m_isExternalAttachment) {</span>
<a href="#l51.25"></a><span id="l51.25">     // Allows the JS mime emitter to figure out the part information.</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineminus">-    urlString.Append(&quot;?part=&quot;);</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineplus">+    urlString.AppendLiteral(&quot;?part=&quot;);</span>
<a href="#l51.28"></a><span id="l51.28">     urlString.Append(part);</span>
<a href="#l51.29"></a><span id="l51.29">   } else if (tmp-&gt;m_realType.LowerCaseEqualsLiteral(MESSAGE_RFC822)) {</span>
<a href="#l51.30"></a><span id="l51.30">     // Special case...if this is a enclosed RFC822 message, give it a nice</span>
<a href="#l51.31"></a><span id="l51.31">     // name.</span>
<a href="#l51.32"></a><span id="l51.32">     if (object-&gt;headers-&gt;munged_subject)</span>
<a href="#l51.33"></a><span id="l51.33">     {</span>
<a href="#l51.34"></a><span id="l51.34">       nsCString subject;</span>
<a href="#l51.35"></a><span id="l51.35">       subject.Assign(object-&gt;headers-&gt;munged_subject);</span>
<a href="#l51.36"></a><span id="l51.36">       MimeHeaders_convert_header_value(options, subject, false);</span>
<a href="#l51.37"></a><span id="l51.37">       tmp-&gt;m_realName.Assign(subject);</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineminus">-      tmp-&gt;m_realName.Append(&quot;.eml&quot;);</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineplus">+      tmp-&gt;m_realName.AppendLiteral(&quot;.eml&quot;);</span>
<a href="#l51.40"></a><span id="l51.40">     }</span>
<a href="#l51.41"></a><span id="l51.41">     else</span>
<a href="#l51.42"></a><span id="l51.42">       tmp-&gt;m_realName = &quot;ForwardedMessage.eml&quot;;</span>
<a href="#l51.43"></a><span id="l51.43">   }</span>
<a href="#l51.44"></a><span id="l51.44"> </span>
<a href="#l51.45"></a><span id="l51.45">   nsresult rv = nsMimeNewURI(getter_AddRefs(tmp-&gt;m_url), urlString.get(), nullptr);</span>
<a href="#l51.46"></a><span id="l51.46"> </span>
<a href="#l51.47"></a><span id="l51.47">   PR_FREEIF(urlSpec);</span>
<a href="#l51.48"></a><span id="l51.48" class="difflineat">@@ -664,17 +664,17 @@ NotifyEmittersOfAttachmentList(MimeDispl</span>
<a href="#l51.49"></a><span id="l51.49">     //   &quot;attachment&quot; or if it can't be displayed inline.</span>
<a href="#l51.50"></a><span id="l51.50">     // - If there's no name at all, just skip it (we don't know what to do with</span>
<a href="#l51.51"></a><span id="l51.51">     //   it then).</span>
<a href="#l51.52"></a><span id="l51.52">     // - If the attachment has a &quot;provided name&quot; (i.e. not something like &quot;Part</span>
<a href="#l51.53"></a><span id="l51.53">     //   1.2&quot;), display it.</span>
<a href="#l51.54"></a><span id="l51.54">     // - If we're asking for all body parts and NOT asking for metadata only,</span>
<a href="#l51.55"></a><span id="l51.55">     //   display it.</span>
<a href="#l51.56"></a><span id="l51.56">     // - Otherwise, skip it.</span>
<a href="#l51.57"></a><span id="l51.57" class="difflineminus">-    if (!tmp-&gt;m_disposition.Equals(&quot;attachment&quot;) &amp;&amp; tmp-&gt;m_displayableInline &amp;&amp;</span>
<a href="#l51.58"></a><span id="l51.58" class="difflineplus">+    if (!tmp-&gt;m_disposition.EqualsLiteral(&quot;attachment&quot;) &amp;&amp; tmp-&gt;m_displayableInline &amp;&amp;</span>
<a href="#l51.59"></a><span id="l51.59">         (tmp-&gt;m_realName.IsEmpty() || (!tmp-&gt;m_hasFilename &amp;&amp;</span>
<a href="#l51.60"></a><span id="l51.60">         (opt-&gt;html_as_p != 4 || opt-&gt;metadata_only))))</span>
<a href="#l51.61"></a><span id="l51.61">     {</span>
<a href="#l51.62"></a><span id="l51.62">       ++i;</span>
<a href="#l51.63"></a><span id="l51.63">       ++tmp;</span>
<a href="#l51.64"></a><span id="l51.64">       continue;</span>
<a href="#l51.65"></a><span id="l51.65">     }</span>
<a href="#l51.66"></a><span id="l51.66"> </span>
<a href="#l51.67"></a><span id="l51.67" class="difflineat">@@ -2001,17 +2001,17 @@ nsresult GetMailNewsFont(MimeObject *obj</span>
<a href="#l51.68"></a><span id="l51.68">     MimeInlineText  *text = (MimeInlineText *) obj;</span>
<a href="#l51.69"></a><span id="l51.69">     nsAutoCString charset;</span>
<a href="#l51.70"></a><span id="l51.70"> </span>
<a href="#l51.71"></a><span id="l51.71">     // get a charset</span>
<a href="#l51.72"></a><span id="l51.72">     if (!text-&gt;initializeCharset)</span>
<a href="#l51.73"></a><span id="l51.73">       ((MimeInlineTextClass*)&amp;mimeInlineTextClass)-&gt;initialize_charset(obj);</span>
<a href="#l51.74"></a><span id="l51.74"> </span>
<a href="#l51.75"></a><span id="l51.75">     if (!text-&gt;charset || !(*text-&gt;charset))</span>
<a href="#l51.76"></a><span id="l51.76" class="difflineminus">-      charset.Assign(&quot;us-ascii&quot;);</span>
<a href="#l51.77"></a><span id="l51.77" class="difflineplus">+      charset.AssignLiteral(&quot;us-ascii&quot;);</span>
<a href="#l51.78"></a><span id="l51.78">     else</span>
<a href="#l51.79"></a><span id="l51.79">       charset.Assign(text-&gt;charset);</span>
<a href="#l51.80"></a><span id="l51.80"> </span>
<a href="#l51.81"></a><span id="l51.81">     nsCOMPtr&lt;nsICharsetConverterManager&gt; charSetConverterManager2;</span>
<a href="#l51.82"></a><span id="l51.82">     nsAutoCString prefStr;</span>
<a href="#l51.83"></a><span id="l51.83"> </span>
<a href="#l51.84"></a><span id="l51.84">     ToLowerCase(charset);</span>
<a href="#l51.85"></a><span id="l51.85"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -473,17 +473,17 @@ MimeMultipartRelated_output_child_p(Mime</span>
<a href="#l52.4"></a><span id="l52.4">           }</span>
<a href="#l52.5"></a><span id="l52.5"> </span>
<a href="#l52.6"></a><span id="l52.6">           /*</span>
<a href="#l52.7"></a><span id="l52.7">             AppleDouble part need special care: we need to output only the data fork part of it.</span>
<a href="#l52.8"></a><span id="l52.8">             The problem at this point is that we haven't yet decoded the children of the AppleDouble</span>
<a href="#l52.9"></a><span id="l52.9">             part therfore we will have to hope the datafork is the second one!</span>
<a href="#l52.10"></a><span id="l52.10">           */</span>
<a href="#l52.11"></a><span id="l52.11">           if (mime_typep(child, (MimeObjectClass *) &amp;mimeMultipartAppleDoubleClass))</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-            partnum.Append(&quot;.2&quot;);</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+            partnum.AppendLiteral(&quot;.2&quot;);</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">           char* part;</span>
<a href="#l52.16"></a><span id="l52.16">           if (!imappartnum.IsEmpty())</span>
<a href="#l52.17"></a><span id="l52.17">             part = mime_set_url_imap_part(obj-&gt;options-&gt;url, imappartnum.get(), partnum.get());</span>
<a href="#l52.18"></a><span id="l52.18">           else</span>
<a href="#l52.19"></a><span id="l52.19">           {</span>
<a href="#l52.20"></a><span id="l52.20">             char *no_part_url = nullptr;</span>
<a href="#l52.21"></a><span id="l52.21">             if (obj-&gt;options-&gt;part_to_load &amp;&amp; obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageBodyDisplay)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -44,35 +44,35 @@ MimeTextBuildPrefixCSS(int32_t    quoted</span>
<a href="#l53.4"></a><span id="l53.4">                        char       *citationColor,      // mail.citation_color</span>
<a href="#l53.5"></a><span id="l53.5">                        nsACString &amp;style)</span>
<a href="#l53.6"></a><span id="l53.6"> {</span>
<a href="#l53.7"></a><span id="l53.7">   switch (quotedStyleSetting)</span>
<a href="#l53.8"></a><span id="l53.8">   {</span>
<a href="#l53.9"></a><span id="l53.9">   case 0:     // regular</span>
<a href="#l53.10"></a><span id="l53.10">     break;</span>
<a href="#l53.11"></a><span id="l53.11">   case 1:     // bold</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-    style.Append(&quot;font-weight: bold; &quot;);</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+    style.AppendLiteral(&quot;font-weight: bold; &quot;);</span>
<a href="#l53.14"></a><span id="l53.14">     break;</span>
<a href="#l53.15"></a><span id="l53.15">   case 2:     // italic</span>
<a href="#l53.16"></a><span id="l53.16" class="difflineminus">-    style.Append(&quot;font-style: italic; &quot;);</span>
<a href="#l53.17"></a><span id="l53.17" class="difflineplus">+    style.AppendLiteral(&quot;font-style: italic; &quot;);</span>
<a href="#l53.18"></a><span id="l53.18">     break;</span>
<a href="#l53.19"></a><span id="l53.19">   case 3:     // bold-italic</span>
<a href="#l53.20"></a><span id="l53.20" class="difflineminus">-    style.Append(&quot;font-weight: bold; font-style: italic; &quot;);</span>
<a href="#l53.21"></a><span id="l53.21" class="difflineplus">+    style.AppendLiteral(&quot;font-weight: bold; font-style: italic; &quot;);</span>
<a href="#l53.22"></a><span id="l53.22">     break;</span>
<a href="#l53.23"></a><span id="l53.23">   }</span>
<a href="#l53.24"></a><span id="l53.24"> </span>
<a href="#l53.25"></a><span id="l53.25">   switch (quotedSizeSetting)</span>
<a href="#l53.26"></a><span id="l53.26">   {</span>
<a href="#l53.27"></a><span id="l53.27">   case 0:     // regular</span>
<a href="#l53.28"></a><span id="l53.28">     break;</span>
<a href="#l53.29"></a><span id="l53.29">   case 1:     // large</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-    style.Append(&quot;font-size: large; &quot;);</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineplus">+    style.AppendLiteral(&quot;font-size: large; &quot;);</span>
<a href="#l53.32"></a><span id="l53.32">     break;</span>
<a href="#l53.33"></a><span id="l53.33">   case 2:     // small</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-    style.Append(&quot;font-size: small; &quot;);</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineplus">+    style.AppendLiteral(&quot;font-size: small; &quot;);</span>
<a href="#l53.36"></a><span id="l53.36">     break;</span>
<a href="#l53.37"></a><span id="l53.37">   }</span>
<a href="#l53.38"></a><span id="l53.38"> </span>
<a href="#l53.39"></a><span id="l53.39">   if (citationColor &amp;&amp; *citationColor)</span>
<a href="#l53.40"></a><span id="l53.40">   {</span>
<a href="#l53.41"></a><span id="l53.41">     style += &quot;color: &quot;;</span>
<a href="#l53.42"></a><span id="l53.42">     style += citationColor;</span>
<a href="#l53.43"></a><span id="l53.43">     style += ';';</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -367,17 +367,17 @@ nsStreamConverter::DetermineOutputFormat</span>
<a href="#l54.4"></a><span id="l54.4">       // Don't muck with this data!</span>
<a href="#l54.5"></a><span id="l54.5">       *aNewType = nsMimeOutput::nsMimeMessageRaw;</span>
<a href="#l54.6"></a><span id="l54.6">       return NS_OK;</span>
<a href="#l54.7"></a><span id="l54.7">     }</span>
<a href="#l54.8"></a><span id="l54.8">   }</span>
<a href="#l54.9"></a><span id="l54.9"> </span>
<a href="#l54.10"></a><span id="l54.10">   // is this is a part that should just come out raw</span>
<a href="#l54.11"></a><span id="l54.11">   const char *part = FindQueryElementData(queryPart, &quot;part=&quot;);</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  if (part &amp;&amp; !mToType.Equals(&quot;application/vnd.mozilla.xul+xml&quot;))</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+  if (part &amp;&amp; !mToType.EqualsLiteral(&quot;application/vnd.mozilla.xul+xml&quot;))</span>
<a href="#l54.14"></a><span id="l54.14">   {</span>
<a href="#l54.15"></a><span id="l54.15">     // default for parts</span>
<a href="#l54.16"></a><span id="l54.16">     mOutputFormat = &quot;raw&quot;;</span>
<a href="#l54.17"></a><span id="l54.17">     *aNewType = nsMimeOutput::nsMimeMessageRaw;</span>
<a href="#l54.18"></a><span id="l54.18"> </span>
<a href="#l54.19"></a><span id="l54.19">     // if we are being asked to fetch a part....it should have a</span>
<a href="#l54.20"></a><span id="l54.20">     // content type appended to it...if it does, we want to remember</span>
<a href="#l54.21"></a><span id="l54.21">     // that as mOutputFormat</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineat">@@ -389,23 +389,23 @@ nsStreamConverter::DetermineOutputFormat</span>
<a href="#l54.23"></a><span id="l54.23">         typeField = secondTypeField;</span>
<a href="#l54.24"></a><span id="l54.24">     }</span>
<a href="#l54.25"></a><span id="l54.25">     if (typeField)</span>
<a href="#l54.26"></a><span id="l54.26">     {</span>
<a href="#l54.27"></a><span id="l54.27">       // store the real content type...mOutputFormat gets deleted later on...</span>
<a href="#l54.28"></a><span id="l54.28">       // and make sure we only get our own value.</span>
<a href="#l54.29"></a><span id="l54.29">       char *nextField = PL_strchr(typeField, '&amp;');</span>
<a href="#l54.30"></a><span id="l54.30">       mRealContentType.Assign(typeField, nextField ? nextField - typeField : -1);</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-      if (mRealContentType.Equals(&quot;message/rfc822&quot;))</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+      if (mRealContentType.EqualsLiteral(&quot;message/rfc822&quot;))</span>
<a href="#l54.33"></a><span id="l54.33">       {</span>
<a href="#l54.34"></a><span id="l54.34">         mRealContentType = &quot;application/x-message-display&quot;;</span>
<a href="#l54.35"></a><span id="l54.35">         mOutputFormat = &quot;text/html&quot;;</span>
<a href="#l54.36"></a><span id="l54.36">         *aNewType = nsMimeOutput::nsMimeMessageBodyDisplay;</span>
<a href="#l54.37"></a><span id="l54.37">       }</span>
<a href="#l54.38"></a><span id="l54.38" class="difflineminus">-      else if (mRealContentType.Equals(&quot;application/x-message-display&quot;))</span>
<a href="#l54.39"></a><span id="l54.39" class="difflineplus">+      else if (mRealContentType.EqualsLiteral(&quot;application/x-message-display&quot;))</span>
<a href="#l54.40"></a><span id="l54.40">       {</span>
<a href="#l54.41"></a><span id="l54.41">         mRealContentType = &quot;&quot;;</span>
<a href="#l54.42"></a><span id="l54.42">         mOutputFormat = &quot;text/html&quot;;</span>
<a href="#l54.43"></a><span id="l54.43">         *aNewType = nsMimeOutput::nsMimeMessageBodyDisplay;</span>
<a href="#l54.44"></a><span id="l54.44">       }</span>
<a href="#l54.45"></a><span id="l54.45">     }</span>
<a href="#l54.46"></a><span id="l54.46"> </span>
<a href="#l54.47"></a><span id="l54.47">     return NS_OK;</span>
<a href="#l54.48"></a><span id="l54.48" class="difflineat">@@ -680,17 +680,17 @@ NS_IMETHODIMP nsStreamConverter::GetCont</span>
<a href="#l54.49"></a><span id="l54.49">   if (!aOutputContentType)</span>
<a href="#l54.50"></a><span id="l54.50">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l54.51"></a><span id="l54.51"> </span>
<a href="#l54.52"></a><span id="l54.52">   // since this method passes a string through an IDL file we need to use nsMemory to allocate it</span>
<a href="#l54.53"></a><span id="l54.53">   // and not strdup!</span>
<a href="#l54.54"></a><span id="l54.54">   //  (1) check to see if we have a real content type...use it first...</span>
<a href="#l54.55"></a><span id="l54.55">   if (!mRealContentType.IsEmpty())</span>
<a href="#l54.56"></a><span id="l54.56">     *aOutputContentType = ToNewCString(mRealContentType);</span>
<a href="#l54.57"></a><span id="l54.57" class="difflineminus">-  else if (mOutputFormat.Equals(&quot;raw&quot;))</span>
<a href="#l54.58"></a><span id="l54.58" class="difflineplus">+  else if (mOutputFormat.EqualsLiteral(&quot;raw&quot;))</span>
<a href="#l54.59"></a><span id="l54.59">     *aOutputContentType = (char *) nsMemory::Clone(UNKNOWN_CONTENT_TYPE, sizeof(UNKNOWN_CONTENT_TYPE));</span>
<a href="#l54.60"></a><span id="l54.60">   else</span>
<a href="#l54.61"></a><span id="l54.61">     *aOutputContentType = ToNewCString(mOutputFormat);</span>
<a href="#l54.62"></a><span id="l54.62">   return NS_OK;</span>
<a href="#l54.63"></a><span id="l54.63"> }</span>
<a href="#l54.64"></a><span id="l54.64"> </span>
<a href="#l54.65"></a><span id="l54.65"> //</span>
<a href="#l54.66"></a><span id="l54.66"> // This is the type of output operation that is being requested by libmime. The types</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -810,17 +810,17 @@ nsNntpIncomingServer::WriteHostInfoFile(</span>
<a href="#l55.4"></a><span id="l55.4">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l55.5"></a><span id="l55.5">   nsCOMPtr&lt;nsIOutputStream&gt; hostInfoStream;</span>
<a href="#l55.6"></a><span id="l55.6">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(hostInfoStream), mHostInfoFile, -1, 00600);</span>
<a href="#l55.7"></a><span id="l55.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l55.8"></a><span id="l55.8"> </span>
<a href="#l55.9"></a><span id="l55.9">   // XXX TODO: missing some formatting, see the 4.x code</span>
<a href="#l55.10"></a><span id="l55.10">   nsAutoCString header(&quot;# News host information file.&quot;);</span>
<a href="#l55.11"></a><span id="l55.11">   WriteLine(hostInfoStream, header);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  header.Assign(&quot;# This is a generated file!  Do not edit.&quot;);</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  header.AssignLiteral(&quot;# This is a generated file!  Do not edit.&quot;);</span>
<a href="#l55.14"></a><span id="l55.14">   WriteLine(hostInfoStream, header);</span>
<a href="#l55.15"></a><span id="l55.15">   header.Truncate();</span>
<a href="#l55.16"></a><span id="l55.16">   WriteLine(hostInfoStream, header);</span>
<a href="#l55.17"></a><span id="l55.17">   nsAutoCString version(&quot;version=&quot;);</span>
<a href="#l55.18"></a><span id="l55.18">   version.AppendInt(VALID_VERSION);</span>
<a href="#l55.19"></a><span id="l55.19">   WriteLine(hostInfoStream, version);</span>
<a href="#l55.20"></a><span id="l55.20">   nsAutoCString newsrcname(&quot;newsrcname=&quot;);</span>
<a href="#l55.21"></a><span id="l55.21">   newsrcname.Append(hostname);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -217,17 +217,17 @@ nsNntpService::DisplayMessage(const char</span>
<a href="#l56.4"></a><span id="l56.4">   // you are reading a message that you've already read, you</span>
<a href="#l56.5"></a><span id="l56.5">   // (from a cross post) it would be in your cache.</span>
<a href="#l56.6"></a><span id="l56.6">   rv = CreateMessageIDURL(folder, key, getter_Copies(urlStr));</span>
<a href="#l56.7"></a><span id="l56.7">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l56.8"></a><span id="l56.8"> </span>
<a href="#l56.9"></a><span id="l56.9">   // rhp: If we are displaying this message for the purposes of printing, append</span>
<a href="#l56.10"></a><span id="l56.10">   // the magic operand.</span>
<a href="#l56.11"></a><span id="l56.11">   if (mPrintingOperation)</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-    urlStr.Append(&quot;?header=print&quot;);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+    urlStr.AppendLiteral(&quot;?header=print&quot;);</span>
<a href="#l56.14"></a><span id="l56.14"> </span>
<a href="#l56.15"></a><span id="l56.15">   nsNewsAction action = nsINntpUrl::ActionFetchArticle;</span>
<a href="#l56.16"></a><span id="l56.16">   if (mOpenAttachmentOperation)</span>
<a href="#l56.17"></a><span id="l56.17">     action = nsINntpUrl::ActionFetchPart;</span>
<a href="#l56.18"></a><span id="l56.18"> </span>
<a href="#l56.19"></a><span id="l56.19">   nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l56.20"></a><span id="l56.20">   rv = ConstructNntpUrl(urlStr.get(), aUrlListener, aMsgWindow, aMessageURI, action, getter_AddRefs(url));</span>
<a href="#l56.21"></a><span id="l56.21">   NS_ENSURE_SUCCESS(rv,rv);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

