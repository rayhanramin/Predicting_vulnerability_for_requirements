<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1645:30c7a484a3ae6529d00799d7d21ebe65c4fec2d1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 30c7a484a3ae6529d00799d7d21ebe65c4fec2d1" />
<meta property="og:url" content="/comm-central/rev/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1" />
<meta property="og:description" content="Bug 433316 Implement backend changes for MailNews transfer from wallet to login manager. r=Neil,sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 30c7a484a3ae6529d00799d7d21ebe65c4fec2d1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">shortlog</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">files</a> |
changeset |
<a href="/comm-central/raw-rev/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">raw</a>  | <a href="/comm-central/archive/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=433316">Bug 433316</a> Implement backend changes for MailNews transfer from wallet to login manager. r=Neil,sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 15 Jan 2009 17:55:32 +0000</td></tr>

<tr>
 <td>changeset 1645</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">30c7a484a3ae6529d00799d7d21ebe65c4fec2d1</a></td>
</tr>



<tr>
<td>parent 1644</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c5c795d2335cb405e0f2c4b9490a2e7663923563">c5c795d2335cb405e0f2c4b9490a2e7663923563</a>
</td>
</tr>

<tr>
<td>child 1646</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/12e714b4861c7494881fe9bafc8baaf04ce3166f">12e714b4861c7494881fe9bafc8baaf04ce3166f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=30c7a484a3ae6529d00799d7d21ebe65c4fec2d1">1318</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 15 Jan 2009 18:00:33 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@238fe79f54ae [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=238fe79f54ae13aca291a00d9d33f94b60b5c776">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=238fe79f54ae13aca291a00d9d33f94b60b5c776&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=238fe79f54ae13aca291a00d9d33f94b60b5c776&newProject=comm-central&newRevision=30c7a484a3ae6529d00799d7d21ebe65c4fec2d1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=238fe79f54ae13aca291a00d9d33f94b60b5c776&newProject=comm-central&newRevision=30c7a484a3ae6529d00799d7d21ebe65c4fec2d1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=238fe79f54ae13aca291a00d9d33f94b60b5c776&newProject=comm-central&newRevision=30c7a484a3ae6529d00799d7d21ebe65c4fec2d1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=433316">433316</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=433316">Bug 433316</a> Implement backend changes for MailNews transfer from wallet to login manager. r=Neil,sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/directory/xpcom/base/src/nsLDAPProtocolHandler.js">directory/xpcom/base/src/nsLDAPProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/directory/xpcom/base/src/nsLDAPProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/directory/xpcom/base/src/nsLDAPProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/directory/xpcom/base/src/nsLDAPProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/directory/xpcom/base/src/nsLDAPProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/directory/xpcom/base/src/nsLDAPProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/confvars.sh">mail/confvars.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/confvars.sh">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/confvars.sh">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/confvars.sh">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/confvars.sh">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/confvars.sh">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/removed-files.in">mail/installer/removed-files.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/removed-files.in">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/removed-files.in">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/removed-files.in">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/removed-files.in">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/removed-files.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/windows/packages-static">mail/installer/windows/packages-static</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/windows/packages-static">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/windows/packages-static">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/windows/packages-static">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/windows/packages-static">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/installer/windows/packages-static">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.dtd">mail/locales/en-US/chrome/communicator/wallet/SignonViewer.dtd</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.dtd">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.dtd">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.properties">mail/locales/en-US/chrome/communicator/wallet/SignonViewer.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.properties">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.properties">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/wallet.properties">mail/locales/en-US/chrome/communicator/wallet/wallet.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/wallet.properties">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/wallet.properties">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/communicator/wallet/wallet.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/messenger/news.properties">mail/locales/en-US/chrome/messenger/news.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/messenger/news.properties">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/messenger/news.properties">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/messenger/news.properties">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/messenger/news.properties">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/en-US/chrome/messenger/news.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/test/unit/test_ldap1.js">mailnews/addrbook/test/unit/test_ldap1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/test/unit/test_ldap1.js">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/test/unit/test_ldap1.js">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/test/unit/test_ldap1.js">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/test/unit/test_ldap1.js">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/addrbook/test/unit/test_ldap1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/public/nsIMsgIncomingServer.idl">mailnews/base/public/nsIMsgIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/public/nsIMsgIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/public/nsIMsgIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/public/nsIMsgIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/public/nsIMsgIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/public/nsIMsgIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/Makefile.in">mailnews/base/util/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/Makefile.in">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/Makefile.in">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/Makefile.in">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/Makefile.in">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.h">mailnews/base/util/nsMsgDBFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.h">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.h">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.h">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.h">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgDBFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.h">mailnews/base/util/nsMsgIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.h">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.h">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/Makefile.in">mailnews/compose/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/test/unit/test_smtpPassword2.js">mailnews/compose/test/unit/test_smtpPassword2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/test/unit/test_smtpPassword2.js">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/test/unit/test_smtpPassword2.js">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/test/unit/test_smtpPassword2.js">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/test/unit/test_smtpPassword2.js">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/compose/test/unit/test_smtpPassword2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/test/unit/test_pop3Password3.js">mailnews/local/test/unit/test_pop3Password3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/test/unit/test_pop3Password3.js">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/test/unit/test_pop3Password3.js">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/test/unit/test_pop3Password3.js">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/test/unit/test_pop3Password3.js">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/local/test/unit/test_pop3Password3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/Makefile.in">mailnews/news/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/test/unit/test_nntpPassword3.js">mailnews/news/test/unit/test_nntpPassword3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/test/unit/test_nntpPassword3.js">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/test/unit/test_nntpPassword3.js">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/test/unit/test_nntpPassword3.js">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/test/unit/test_nntpPassword3.js">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/news/test/unit/test_nntpPassword3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/test/data/signons-mailnews1.8-multiple.txt">mailnews/test/data/signons-mailnews1.8-multiple.txt</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/test/data/signons-mailnews1.8-multiple.txt">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/test/data/signons-mailnews1.8-multiple.txt">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/test/data/signons-mailnews1.8-multiple.txt">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/test/data/signons-mailnews1.8-multiple.txt">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/mailnews/test/data/signons-mailnews1.8-multiple.txt">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/confvars.sh">suite/confvars.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/confvars.sh">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/confvars.sh">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/confvars.sh">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/confvars.sh">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/confvars.sh">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/removed-files.in">suite/installer/removed-files.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/removed-files.in">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/removed-files.in">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/removed-files.in">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/removed-files.in">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/removed-files.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/unix/packages">suite/installer/unix/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/unix/packages">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/unix/packages">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/unix/packages">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/unix/packages">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/unix/packages">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/windows/packages">suite/installer/windows/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/windows/packages">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/windows/packages">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/windows/packages">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/windows/packages">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/installer/windows/packages">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/locales/en-US/chrome/mailnews/news.properties">suite/locales/en-US/chrome/mailnews/news.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/locales/en-US/chrome/mailnews/news.properties">file</a> |
<a href="/comm-central/annotate/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/locales/en-US/chrome/mailnews/news.properties">annotate</a> |
<a href="/comm-central/diff/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/locales/en-US/chrome/mailnews/news.properties">diff</a> |
<a href="/comm-central/comparison/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/locales/en-US/chrome/mailnews/news.properties">comparison</a> |
<a href="/comm-central/log/30c7a484a3ae6529d00799d7d21ebe65c4fec2d1/suite/locales/en-US/chrome/mailnews/news.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/directory/xpcom/base/src/nsLDAPProtocolHandler.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/directory/xpcom/base/src/nsLDAPProtocolHandler.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -53,23 +53,18 @@ function makeProtocolHandler(aProtocol, </span>
<a href="#l1.4"></a><span id="l1.4">                    nsIProtocolHandler.URI_DANGEROUS_TO_LOAD |</span>
<a href="#l1.5"></a><span id="l1.5">                    nsIProtocolHandler.ALLOWS_PROXY,</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">     newURI: function (aSpec, aOriginCharset, aBaseURI) {</span>
<a href="#l1.8"></a><span id="l1.8">       var url = Components.classes[&quot;@mozilla.org/network/ldap-url;1&quot;]</span>
<a href="#l1.9"></a><span id="l1.9">                           .createInstance(Components.interfaces.nsIURI);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">       if (url instanceof Components.interfaces.nsILDAPURL)</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#ifdef USE_TK_LOGIN_MANAGER</span>
<a href="#l1.13"></a><span id="l1.13"> 	url.init(Components.interfaces.nsIStandardURL.URLTYPE_STANDARD,</span>
<a href="#l1.14"></a><span id="l1.14"> 		 aDefaultPort, aSpec, aOriginCharset, aBaseURI);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-#else</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-	url.init(Components.interfaces.nsIStandardURL.URLTYPE_STANDARD,</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-		 -1, aSpec, aOriginCharset, aBaseURI);</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-#endif</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">       return url;</span>
<a href="#l1.21"></a><span id="l1.21">     },</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">     newChannel: function (aURI) {</span>
<a href="#l1.24"></a><span id="l1.24">       if (&quot;@mozilla.org/network/ldap-channel;1&quot; in Components.classes) {</span>
<a href="#l1.25"></a><span id="l1.25">         var channel = Components.classes[&quot;@mozilla.org/network/ldap-channel;1&quot;]</span>
<a href="#l1.26"></a><span id="l1.26">                                 .createInstance(Components.interfaces.nsIChannel);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -942,35 +942,30 @@ function loadStartFolder(initialUri)</span>
<a href="#l2.4"></a><span id="l2.4">             }</span>
<a href="#l2.5"></a><span id="l2.5">         }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">         // it is possible we were given an initial uri and we need to subscribe or try to add</span>
<a href="#l2.8"></a><span id="l2.8">         // the folder. i.e. the user just clicked on a news folder they aren't subscribed to from a browser</span>
<a href="#l2.9"></a><span id="l2.9">         // the news url comes in here.</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">         if (isLoginAtStartUpEnabled &amp;&amp; masterPasswordSet()) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-          let passwordMgr = Components.classes[&quot;@mozilla.org/passwordmanager;1&quot;]</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                              .getService(Components.interfaces.nsIPasswordManagerInternal);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-          if (passwordMgr)</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+          let loginMgr = Components.classes[&quot;@mozilla.org/login-manager;1&quot;]</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+                              .getService(Components.interfaces.nsILoginManager);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+          if (loginMgr)</span>
<a href="#l2.18"></a><span id="l2.18">           {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-            let hostFound = new Object;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-            let userNameFound = new Object;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-            let passwordFound = new Object;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-</span>
<a href="#l2.23"></a><span id="l2.23">             // Get password entry corresponding to the default server.</span>
<a href="#l2.24"></a><span id="l2.24">             // This will block the UI until the use enters something.</span>
<a href="#l2.25"></a><span id="l2.25">             // This throws an exception if the user cancels. For now, I'm</span>
<a href="#l2.26"></a><span id="l2.26">             // just letting everything proceed as before, but conceivably,</span>
<a href="#l2.27"></a><span id="l2.27">             // we could loop waiting for the user to enter the right password,</span>
<a href="#l2.28"></a><span id="l2.28">             // and exit the app if they don't. But this assumes the</span>
<a href="#l2.29"></a><span id="l2.29">             // default server password is stored.</span>
<a href="#l2.30"></a><span id="l2.30">             try {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-                passwordMgr.findPasswordEntry(defaultServer.serverURI, &quot;&quot;, &quot;&quot;,</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-                                           hostFound, userNameFound, </span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-                                           passwordFound);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+                loginMgr.findLogins({}, defaultServer.serverURI, null,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+                                    defaultServer.serverURI, {});</span>
<a href="#l2.36"></a><span id="l2.36">             } catch(ex) {};</span>
<a href="#l2.37"></a><span id="l2.37">           }</span>
<a href="#l2.38"></a><span id="l2.38">         }</span>
<a href="#l2.39"></a><span id="l2.39">         // Perform biff on the server to check for new mail, except for imap</span>
<a href="#l2.40"></a><span id="l2.40">         // or a pop3 account that is deferred or deferred to,</span>
<a href="#l2.41"></a><span id="l2.41">         // or the case where initialUri is non-null (non-startup)</span>
<a href="#l2.42"></a><span id="l2.42">         if (!initialUri &amp;&amp; isLoginAtStartUpEnabled &amp;&amp; gLoadStartFolder</span>
<a href="#l2.43"></a><span id="l2.43">             &amp;&amp; !defaultServer.isDeferredTo &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/confvars.sh</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/confvars.sh</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -57,10 +57,9 @@ MOZ_SAFE_BROWSING=1</span>
<a href="#l3.4"></a><span id="l3.4"> # Can be dropped when we branch MOZILLA_1_9_1_BRANCH</span>
<a href="#l3.5"></a><span id="l3.5"> MOZILLA_BRANCH_VERSION=`echo ${MOZILLA_VERSION} | sed -e 's/\(^[0-9]\.[0-9]\.[0-9]\).*/\1/;'`</span>
<a href="#l3.6"></a><span id="l3.6"> if test &quot;$MOZILLA_BRANCH_VERSION&quot; = &quot;1.9.1&quot;; then</span>
<a href="#l3.7"></a><span id="l3.7">   MOZ_APP_VERSION=`cat $topsrcdir/$MOZ_BUILD_APP/config/version-191.txt`</span>
<a href="#l3.8"></a><span id="l3.8"> else</span>
<a href="#l3.9"></a><span id="l3.9">   MOZ_APP_VERSION=`cat $topsrcdir/$MOZ_BUILD_APP/config/version.txt`</span>
<a href="#l3.10"></a><span id="l3.10"> fi</span>
<a href="#l3.11"></a><span id="l3.11"> THUNDERBIRD_VERSION=$MOZ_APP_VERSION</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-MOZ_EXTENSIONS_DEFAULT=&quot; wallet&quot;</span>
<a href="#l3.13"></a><span id="l3.13"> MOZ_NO_XPCOM_OBSOLETE=1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/installer/removed-files.in</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/installer/removed-files.in</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -31,17 +31,18 @@ components/pipboot.dll</span>
<a href="#l4.4"></a><span id="l4.4"> components/pipnss.dll</span>
<a href="#l4.5"></a><span id="l4.5"> components/pippki.dll</span>
<a href="#l4.6"></a><span id="l4.6"> components/profile.dll</span>
<a href="#l4.7"></a><span id="l4.7"> components/profilemigration.dll</span>
<a href="#l4.8"></a><span id="l4.8"> components/rdf.dll</span>
<a href="#l4.9"></a><span id="l4.9"> components/spellchk.dll</span>
<a href="#l4.10"></a><span id="l4.10"> components/txmgr.dll</span>
<a href="#l4.11"></a><span id="l4.11"> components/uconv.dll</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-components/wallet.dll</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+components/@DLL_PREFIX@wallet@DLL_SUFFIX@</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+components/@DLL_PREFIX@walletviewers@DLL_SUFFIX@</span>
<a href="#l4.15"></a><span id="l4.15"> components/webbrwsr.dll</span>
<a href="#l4.16"></a><span id="l4.16"> components/wlltvwrs.dll</span>
<a href="#l4.17"></a><span id="l4.17"> components/xmlextras.dll</span>
<a href="#l4.18"></a><span id="l4.18"> components/xpc3250.dll</span>
<a href="#l4.19"></a><span id="l4.19"> components/xppref32.dll</span>
<a href="#l4.20"></a><span id="l4.20"> nsldap32v50.dll</span>
<a href="#l4.21"></a><span id="l4.21"> nsldappr32v50.dll</span>
<a href="#l4.22"></a><span id="l4.22"> #ifdef XP_WIN</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -135,16 +136,18 @@ components/rdf.xpt</span>
<a href="#l4.24"></a><span id="l4.24"> components/signonviewer.xpt</span>
<a href="#l4.25"></a><span id="l4.25"> components/spellchecker.xpt</span>
<a href="#l4.26"></a><span id="l4.26"> components/txmgr.xpt</span>
<a href="#l4.27"></a><span id="l4.27"> components/txtsvc.xpt</span>
<a href="#l4.28"></a><span id="l4.28"> components/uconv.xpt</span>
<a href="#l4.29"></a><span id="l4.29"> components/unicharutil.xpt</span>
<a href="#l4.30"></a><span id="l4.30"> components/uriloader.xpt</span>
<a href="#l4.31"></a><span id="l4.31"> components/wallet.xpt</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+components/walleteditor.xpt</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+components/walletpreview.xpt</span>
<a href="#l4.34"></a><span id="l4.34"> components/webbrowserpersist.xpt</span>
<a href="#l4.35"></a><span id="l4.35"> components/webBrowser_core.xpt</span>
<a href="#l4.36"></a><span id="l4.36"> components/webshell_idls.xpt</span>
<a href="#l4.37"></a><span id="l4.37"> components/widget.xpt</span>
<a href="#l4.38"></a><span id="l4.38"> components/windowds.xpt</span>
<a href="#l4.39"></a><span id="l4.39"> components/windowwatcher.xpt</span>
<a href="#l4.40"></a><span id="l4.40"> components/winhooks.xpt</span>
<a href="#l4.41"></a><span id="l4.41"> components/xmlextras.xpt</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineat">@@ -199,16 +202,23 @@ defaults/messenger/SpamPal.sfd</span>
<a href="#l4.43"></a><span id="l4.43"> defaults/isp/rss.rdf</span>
<a href="#l4.44"></a><span id="l4.44"> defaults/isp/movemail.rdf</span>
<a href="#l4.45"></a><span id="l4.45"> defaults/isp/dotmac.rdf</span>
<a href="#l4.46"></a><span id="l4.46"> defaults/isp/en-US/rss.rdf</span>
<a href="#l4.47"></a><span id="l4.47"> defaults/isp/en-US/movemail.rdf</span>
<a href="#l4.48"></a><span id="l4.48"> defaults/isp/en-US/dotmac.rdf</span>
<a href="#l4.49"></a><span id="l4.49"> defaults/isp/en-US/</span>
<a href="#l4.50"></a><span id="l4.50"> defaults/isp/</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+defaults/wallet/VcardSchema.tbl</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+defaults/wallet/FieldSchema.tbl</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+defaults/wallet/SchemaConcat.tbl</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+defaults/wallet/DistinguishedSchema.tbl</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+defaults/wallet/SchemaStrings.tbl</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+defaults/wallet/PositionalSchema.tbl</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+defaults/wallet/StateSchema.tbl</span>
<a href="#l4.58"></a><span id="l4.58"> isp/gmail.rdf</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60"> components/@DLL_PREFIX@xpcom_compat_c@DLL_SUFFIX@</span>
<a href="#l4.61"></a><span id="l4.61"> @DLL_PREFIX@xpcom_compat@DLL_SUFFIX@</span>
<a href="#l4.62"></a><span id="l4.62"> @DLL_PREFIX@zlib@DLL_SUFFIX@</span>
<a href="#l4.63"></a><span id="l4.63"> @DLL_PREFIX@xpistub@DLL_SUFFIX@</span>
<a href="#l4.64"></a><span id="l4.64"> #Remove Talkback files from old location (in case user updates from 1.0.x)</span>
<a href="#l4.65"></a><span id="l4.65"> components/BrandRes.dll</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/installer/windows/packages-static</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/installer/windows/packages-static</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -143,19 +143,23 @@ bin\greprefs\*</span>
<a href="#l5.4"></a><span id="l5.4"> ; LDAP components</span>
<a href="#l5.5"></a><span id="l5.5"> bin\components\mozldap.xpt</span>
<a href="#l5.6"></a><span id="l5.6"> bin\components\nsAbLDAPAttributeMap.js</span>
<a href="#l5.7"></a><span id="l5.7"> bin\components\nsLDAPProtocolHandler.js</span>
<a href="#l5.8"></a><span id="l5.8"> bin\nsldap32v60.dll</span>
<a href="#l5.9"></a><span id="l5.9"> bin\nsldappr32v60.dll</span>
<a href="#l5.10"></a><span id="l5.10"> bin\nsldif32v60.dll</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-; wallet</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-bin\components\wallet.xpt</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-bin\components\signonviewer.xpt</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+; login manager</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+bin\components\loginmgr.xpt</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+bin\components\nsLoginInfo.js</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+bin\components\nsLoginManager.js</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+bin\components\nsLoginManagerPrompter.js</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+bin\components\storage-Legacy.js</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+bin\components\storage-mozStorage.js</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> ; download progress</span>
<a href="#l5.24"></a><span id="l5.24"> bin\components\nsHelperAppDlg.js</span>
<a href="#l5.25"></a><span id="l5.25"> bin\components\nsDownloadManagerUI.js</span>
<a href="#l5.26"></a><span id="l5.26"> bin\components\nsProgressDialog.js</span>
<a href="#l5.27"></a><span id="l5.27"> bin\components\downloads.xpt</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29"> ; Protocol/Content handling</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.dtd</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,17 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-&lt;!ENTITY      windowtitle.label               &quot;Password Manager&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-&lt;!ENTITY      windowalttitle.label            &quot;Form Manager: Sites&quot;&gt;</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-&lt;!ENTITY      tab.signonsstored.label         &quot;Passwords Saved&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-&lt;!ENTITY      tab.signonsnotstored.label      &quot;Passwords Never Saved&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-&lt;!ENTITY      tab.nopreview.label             &quot;Forms Never Previewed&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-&lt;!ENTITY      tab.nocapture.label             &quot;Forms Never Saved&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-&lt;!ENTITY      spiel.signonsstored.label       &quot;Password Manager has saved login information for the following sites:&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-&lt;!ENTITY      spiel.signonsnotstored.label    &quot;Password Manager will never save login information for the following sites:&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-&lt;!ENTITY      spiel.nopreview.label           &quot;Form Manager will never preview forms from the following sites before pre-filling them for you:&quot;&gt;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-&lt;!ENTITY      spiel.nocapture.label           &quot;Form Manager will never ask to save forms from the following sites:&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-&lt;!ENTITY      treehead.site.label             &quot;Site&quot;&gt;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-&lt;!ENTITY      treehead.username.label         &quot;Username&quot;&gt;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-&lt;!ENTITY      treehead.password.label         &quot;Password&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-&lt;!ENTITY      remove.label                    &quot;Remove&quot;&gt;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-&lt;!ENTITY      removeall.label                 &quot;Remove All&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">deleted file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- a/mail/locales/en-US/chrome/communicator/wallet/SignonViewer.properties</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ /dev/null</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -1,10 +0,0 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">-encrypted = %S (encrypted)</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">-close=Close</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">-hidePasswords=Hide Passwords</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">-showPasswords=Show Passwords</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">-noMasterPasswordPrompt=Are you sure you wish to show your passwords?</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-removeAllPasswordsPrompt=Are you sure you wish to remove all passwords?</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">-removeAllPasswordsTitle=Remove all passwords</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-# Default user name in the view passwords dialog</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-noUserNameForPassword=&lt;not specified&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/mail/locales/en-US/chrome/communicator/wallet/wallet.properties</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,83 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-#</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-#</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-# License.</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-#</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-#</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-#</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-#</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-#</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-IncorrectKey_TryAgain? = Master password incorrect. Do you want to try again?</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-WantToCaptureForm? = Do you want to remember the values you filled in?</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-WantToSavePasswordObscured? = Password Manager can remember this logon and enter it automatically the next time you return to this website.##Do you want Password Manager to remember this logon?</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-WantToSavePasswordEncrypted? = Password Manager can remember this logon and enter it automatically the next time you return to this website.##Do you want Password Manager to remember this logon?</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-xWantToSavePasswordObscured? = Do you want to remember your user name and password?##Stored values are not password protected.</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-xWantToSavePasswordEncrypted? = Do you want to remember your user name and password?##Stored values are password protected.</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-#translator's note: # in following line will be converted to linefeed by program</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-firstPassword = A master password will be used to protect sensitive single-signon information stored on your hard drive.  Future releases will strongly encrypt this data for maximum protection.##Select a master password.#(Leave fields blank if you don't want to use a master password).#</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-password = Enter your master password.</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-#translator's note: # in following line will be converted to linefeed by program</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-newPassword = Select a new master password.#(Leave fields blank if you don't want to use a master password).#</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-enterPassword = Enter a master password</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-confirmPassword = Retype the master password</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-confirmFailed_TryAgain? = The two master passwords were not identical.  Please enter the same master password in both fields.</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-SelectUser = Select a username to be entered on this form.</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-SelectUserWhosePasswordIsBeingChanged = Select the user whose password is being changed.</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-PasswordNotification = For your convenience, the browser can remember your user names and passwords so you won't have to re-type them in the future.  Your passwords will be obscured before being saved on your hard drive.  Do you want this feature enabled?</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-WalletNotification = You can save information that you enter on forms and later automatically prefill that information on other forms.  To save such information, select Edit/Save Form Info from the menu while viewing the form.</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-noPrefills = There are no fields that can be prefilled.</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-Never = Never for this site</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-Confirm = Confirm</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-PromptForPassword = Password</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-PromptForData = Prompt</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-SaveTheseValuesObscured = Use Password Manager to remember these values.</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-SaveTheseValuesEncrypted = Use Password Manager to remember these values.</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-SaveThisValueObscured = Use Password Manager to remember this value.</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-SaveThisValueEncrypted = Use Password Manager to remember this value.</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-SaveThisPasswordObscured= Use Password Manager to remember this password.</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-SaveThisPasswordEncrypted = Use Password Manager to remember this password.</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-xSaveTheseValuesObscured = Remember these values.  Stored values are not password protected.</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-xSaveTheseValuesEncrypted = Remember these values.  Stored values are password protected.</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-xSaveThisValueObscured = Remember this value.  Stored values are not password protected.</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-xSaveThisValueEncrypted = Remember this value.  Stored values are password protected.</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-UserName = User Name</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-Password = Password</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-SelectUserTitleLine = Select User</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-NoPasswordsEverSaved = No passwords have ever been saved.</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-Captured = Data has been captured.</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-NotCaptured = There is nothing to capture.</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-UnableToCapture = Unable to capture data.</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-Converted = Stored data has been converted.</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-AllDataWillBeCleared = All stored data will be erased.</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-NotConverted = Unable to convert stored data.</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-PasswordNotChanged = Unable to change the password that protects your sensitive information.</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-PasswordExpired = Your sensitive information is now locked.</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-PasswordNotExpired = Unable to lock your sensitive information.</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-Caveat = Saving Passwords and Other Sensitive Information##Password Manager and Form Manager will save passwords, user names, and other sensitive information and enter them for you automatically when they are required.#This sensitive information is stored on your computer in a file that's difficult, but not impossible, to read.#If other people have access to your computer, you may want to password protect the stored sensitive information by choosing a Master Password.#If you choose to password protect your stored information, you will be asked to provide your Master Password from time to time.  This approach provides better security but is slightly less convenient.</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-CaveatTitle = Alert</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/news.properties</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/news.properties</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -42,16 +42,18 @@ htmlNewsErrorTitle=Error!</span>
<a href="#l9.4"></a><span id="l9.4"> htmlNewsError=&lt;H1&gt;Error!&lt;/H1&gt;newsgroup server responded: </span>
<a href="#l9.5"></a><span id="l9.5"> # LOCALIZATION NOTE ( articleExpired ): In the following item, translate only &quot;Perhaps the article has expired&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> articleExpired=&lt;B&gt;&lt;P&gt;Perhaps the article has expired&lt;/P&gt;&lt;/B&gt;</span>
<a href="#l9.7"></a><span id="l9.7"> removeExpiredArtLinkText=Click here to remove all expired articles</span>
<a href="#l9.8"></a><span id="l9.8"> cancelDisallowed=This message does not appear to be from you.  You may only cancel your own posts, not those made by others.</span>
<a href="#l9.9"></a><span id="l9.9"> cancelConfirm=Are you sure you want to cancel this message?</span>
<a href="#l9.10"></a><span id="l9.10"> messageCancelled=Message cancelled.</span>
<a href="#l9.11"></a><span id="l9.11"> enterUsername=Please enter a username for news server access:</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+enterUsernameTitle=News Server Username Required</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+saveUsername=Use Password Manager to remember this value.</span>
<a href="#l9.14"></a><span id="l9.14"> enterPassword=Please enter a password for news server access:</span>
<a href="#l9.15"></a><span id="l9.15"> enterPasswordTitle=News Server Password Required</span>
<a href="#l9.16"></a><span id="l9.16"> okButtonText=Download</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> noNewMessages=There are no new messages on the server.</span>
<a href="#l9.19"></a><span id="l9.19"> downloadingHeaders=Downloading %S of %S headers</span>
<a href="#l9.20"></a><span id="l9.20"> downloadingFilterHeaders=Getting headers for filters: %S (%S/%S)</span>
<a href="#l9.21"></a><span id="l9.21"> downloadingArticles=Downloading articles %S-%S</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -148,11 +148,8 @@</span>
<a href="#l10.4"></a><span id="l10.4">   locale/@AB_CD@/messenger-smime/certFetchingStatus.dtd                 (%chrome/messenger-smime/certFetchingStatus.dtd)</span>
<a href="#l10.5"></a><span id="l10.5">   locale/@AB_CD@/messenger-smime/msgSecurityInfo.properties             (%chrome/messenger-smime/msgSecurityInfo.properties)</span>
<a href="#l10.6"></a><span id="l10.6"> % locale messenger-region @AB_CD@ %locale/@AB_CD@/messenger-region/</span>
<a href="#l10.7"></a><span id="l10.7">   locale/@AB_CD@/messenger-region/region.properties                     (%chrome/messenger-region/region.properties)</span>
<a href="#l10.8"></a><span id="l10.8"> % locale mozldap @AB_CD@ %locale/@AB_CD@/mozldap/</span>
<a href="#l10.9"></a><span id="l10.9">   locale/@AB_CD@/mozldap/ldap.properties                                (%chrome/mozldap/ldap.properties)</span>
<a href="#l10.10"></a><span id="l10.10"> % locale communicator @AB_CD@ %locale/@AB_CD@/communicator/</span>
<a href="#l10.11"></a><span id="l10.11">   locale/@AB_CD@/communicator/utilityOverlay.dtd             (%chrome/communicator/utilityOverlay.dtd)</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  locale/@AB_CD@/communicator/wallet/wallet.properties       (%chrome/communicator/wallet/wallet.properties)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-+ locale/@AB_CD@/communicator/wallet/SignonViewer.properties (%chrome/communicator/wallet/SignonViewer.properties)</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-+ locale/@AB_CD@/communicator/wallet/SignonViewer.dtd        (%chrome/communicator/wallet/SignonViewer.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -41,23 +41,18 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #include &quot;nsAbLDAPListenerBase.h&quot;</span>
<a href="#l11.5"></a><span id="l11.5"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsILDAPMessage.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsILDAPErrors.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-#ifdef USE_TK_LOGIN_MANAGER</span>
<a href="#l11.13"></a><span id="l11.13"> #include &quot;nsILoginManager.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsILoginInfo.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-#else</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-#include &quot;nsCategoryManagerUtils.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-#endif</span>
<a href="#l11.19"></a><span id="l11.19"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> #include &quot;nsXPCOMCIDInternal.h&quot;</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22"> nsAbLDAPListenerBase::nsAbLDAPListenerBase(nsILDAPURL* url,</span>
<a href="#l11.23"></a><span id="l11.23">                                            nsILDAPConnection* connection,</span>
<a href="#l11.24"></a><span id="l11.24">                                            const nsACString &amp;login,</span>
<a href="#l11.25"></a><span id="l11.25">                                            const PRInt32 timeOut) :</span>
<a href="#l11.26"></a><span id="l11.26">   mDirectoryUrl(url), mConnection(connection), mLogin(login),</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineat">@@ -323,17 +318,16 @@ nsresult nsAbLDAPListenerBase::OnLDAPMes</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">   if (errCode != nsILDAPErrors::SUCCESS)</span>
<a href="#l11.30"></a><span id="l11.30">   {</span>
<a href="#l11.31"></a><span id="l11.31">     // if the login failed, tell the wallet to forget this password</span>
<a href="#l11.32"></a><span id="l11.32">     //</span>
<a href="#l11.33"></a><span id="l11.33">     if (errCode == nsILDAPErrors::INAPPROPRIATE_AUTH ||</span>
<a href="#l11.34"></a><span id="l11.34">         errCode == nsILDAPErrors::INVALID_CREDENTIALS)</span>
<a href="#l11.35"></a><span id="l11.35">     {</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-#ifdef USE_TK_LOGIN_MANAGER</span>
<a href="#l11.37"></a><span id="l11.37">       // Login failed, so try again - but first remove the existing login(s)</span>
<a href="#l11.38"></a><span id="l11.38">       // so that the user gets prompted. This may not be the best way of doing</span>
<a href="#l11.39"></a><span id="l11.39">       // things, we need to review that later.</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41">       nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l11.42"></a><span id="l11.42">         do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l11.43"></a><span id="l11.43">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45" class="difflineat">@@ -360,39 +354,16 @@ nsresult nsAbLDAPListenerBase::OnLDAPMes</span>
<a href="#l11.46"></a><span id="l11.46">         rv = loginMgr-&gt;RemoveLogin(logins[i]);</span>
<a href="#l11.47"></a><span id="l11.47">         if (NS_FAILED(rv))</span>
<a href="#l11.48"></a><span id="l11.48">         {</span>
<a href="#l11.49"></a><span id="l11.49">           NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l11.50"></a><span id="l11.50">           return rv;</span>
<a href="#l11.51"></a><span id="l11.51">         }</span>
<a href="#l11.52"></a><span id="l11.52">       }</span>
<a href="#l11.53"></a><span id="l11.53">       NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-#else</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-      // make sure the wallet service has been created, and in doing so,</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-      // pass in a login-failed message to tell it to forget this passwd.</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-      //</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-      // apparently getting passwords stored in the wallet</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-      // doesn't require the service to be running, which is why</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-      // this might not exist yet.</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-      //</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-      rv = NS_CreateServicesFromCategory(&quot;passwordmanager&quot;,</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-                                         mDirectoryUrl,</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-                                         &quot;login-failed&quot;);</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-      {</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-        NS_ERROR(&quot;nsLDAPAutoCompleteSession::ForgetPassword(): error&quot;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-                 &quot; creating password manager service&quot;);</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-        // not much to do at this point, though conceivably we could </span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-        // pop up a dialog telling the user to go manually delete</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-        // this password in the password manager.</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-        return rv;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-      }</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-      // Login failed, so try again</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineminus">-#endif</span>
<a href="#l11.77"></a><span id="l11.77"> </span>
<a href="#l11.78"></a><span id="l11.78">       // XXX We should probably pop up an error dialog telling</span>
<a href="#l11.79"></a><span id="l11.79">       // the user that the login failed here, rather than just bringing </span>
<a href="#l11.80"></a><span id="l11.80">       // up the password dialog again, which is what calling OnLDAPInit()</span>
<a href="#l11.81"></a><span id="l11.81">       // does.</span>
<a href="#l11.82"></a><span id="l11.82">       return OnLDAPInit(nsnull, NS_OK);</span>
<a href="#l11.83"></a><span id="l11.83">     }</span>
<a href="#l11.84"></a><span id="l11.84"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_ldap1.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_ldap1.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.5"></a><span id="l12.5"> /*</span>
<a href="#l12.6"></a><span id="l12.6">  * Test suite for basic LDAP address book functions</span>
<a href="#l12.7"></a><span id="l12.7">  */</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> const kLDAPDirectory = 0; // defined in nsDirPrefs.h</span>
<a href="#l12.10"></a><span id="l12.10"> const kLDAPUriPrefix = &quot;moz-abldapdirectory://&quot;;</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-const kLDAPTestSpec = &quot;ldap://invalidhost:389//dc=intranet??sub?(objectclass=*)&quot;;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+const kLDAPTestSpec = &quot;ldap://invalidhost//dc=intranet??sub?(objectclass=*)&quot;;</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14"> function run_test() {</span>
<a href="#l12.15"></a><span id="l12.15">   // Test - Create an LDAP directory</span>
<a href="#l12.16"></a><span id="l12.16">   var abManager = Components.classes[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l12.17"></a><span id="l12.17">                             .getService(Components.interfaces.nsIAbManager);</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">   var abUri = abManager.newAddressBook(&quot;test&quot;, kLDAPTestSpec, kLDAPDirectory);</span>
<a href="#l12.20"></a><span id="l12.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -53,17 +53,17 @@ interface nsIMsgDBHdr;</span>
<a href="#l13.4"></a><span id="l13.4"> interface nsILocalFile;</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> /*</span>
<a href="#l13.7"></a><span id="l13.7">  * Interface for incoming mail/news host</span>
<a href="#l13.8"></a><span id="l13.8">  * this is the base interface for all mail server types (imap, pop, nntp, etc)</span>
<a href="#l13.9"></a><span id="l13.9">  * often you will want to add extra interfaces that give you server-specific</span>
<a href="#l13.10"></a><span id="l13.10">  * attributes and methods.</span>
<a href="#l13.11"></a><span id="l13.11">  */</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-[scriptable, uuid(b51b27f6-4c36-44ef-8457-52b40d2056ce)]</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+[scriptable, uuid(2795ee91-7231-4c3b-a6ed-ea9a721371fa)]</span>
<a href="#l13.14"></a><span id="l13.14"> interface nsIMsgIncomingServer : nsISupports {</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16">   /**</span>
<a href="#l13.17"></a><span id="l13.17">    * internal pref key - guaranteed to be unique across all servers</span>
<a href="#l13.18"></a><span id="l13.18">    */</span>
<a href="#l13.19"></a><span id="l13.19">   attribute ACString key;</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21">   /**</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -123,21 +123,16 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l13.23"></a><span id="l13.23">   attribute ACString password;</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">   /* prompt the user for a password */</span>
<a href="#l13.26"></a><span id="l13.26">   ACString getPasswordWithUI(in AString aPromptString, in AString aPromptTitle, in nsIMsgWindow aMsgWindow, out boolean okayValue);</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   /* forget the password in memory and in single signon database */</span>
<a href="#l13.29"></a><span id="l13.29">   void forgetPassword();</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  /**</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-   * logon succeeded - persist password, if user chooses.</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-   */</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  void storePassword(); </span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-</span>
<a href="#l13.36"></a><span id="l13.36">   /* forget the password in memory which is cached for the session */</span>
<a href="#l13.37"></a><span id="l13.37">   void forgetSessionPassword();</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39">   /* should we download whole messages when biff goes off? */</span>
<a href="#l13.40"></a><span id="l13.40">   /* in 4.x, this was &quot;mail.pop3_gets_new_mail&quot; for pop */</span>
<a href="#l13.41"></a><span id="l13.41">   /* &quot;mail.imap.new_mail_get_headers&quot; for imap, and it was global.  in 5.x, it is per server */</span>
<a href="#l13.42"></a><span id="l13.42">   attribute boolean downloadOnBiff;</span>
<a href="#l13.43"></a><span id="l13.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/util/Makefile.in</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/util/Makefile.in</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -79,16 +79,18 @@ REQUIRES	= xpcom \</span>
<a href="#l14.4"></a><span id="l14.4"> 		  uconv \</span>
<a href="#l14.5"></a><span id="l14.5"> 		  unicharutil \</span>
<a href="#l14.6"></a><span id="l14.6"> 		  nkcache \</span>
<a href="#l14.7"></a><span id="l14.7"> 		  mimetype \</span>
<a href="#l14.8"></a><span id="l14.8"> 		  windowwatcher \</span>
<a href="#l14.9"></a><span id="l14.9"> 		  htmlparser \</span>
<a href="#l14.10"></a><span id="l14.10"> 		  content \</span>
<a href="#l14.11"></a><span id="l14.11"> 		  layout \</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+		  loginmgr \</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+		  pipnss \</span>
<a href="#l14.14"></a><span id="l14.14"> 		  $(NULL)</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> CPPSRCS		= \</span>
<a href="#l14.17"></a><span id="l14.17"> 		nsMsgLineBuffer.cpp \</span>
<a href="#l14.18"></a><span id="l14.18"> 		nsMsgDBFolder.cpp \</span>
<a href="#l14.19"></a><span id="l14.19"> 		nsMsgKeySet.cpp \</span>
<a href="#l14.20"></a><span id="l14.20"> 		nsMsgIdentity.cpp \</span>
<a href="#l14.21"></a><span id="l14.21"> 		nsMsgIncomingServer.cpp \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -66,17 +66,16 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsISpamSettings.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-#include &quot;nsCPasswordManager.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsInt64.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsReadLine.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsParserCIID.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsIParser.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsIHTMLContentSink.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsIContentSerializer.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsLayoutCID.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -92,16 +91,18 @@</span>
<a href="#l15.22"></a><span id="l15.22"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l15.23"></a><span id="l15.23"> #include &quot;nsIMimeHeaders.h&quot;</span>
<a href="#l15.24"></a><span id="l15.24"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l15.25"></a><span id="l15.25"> #include &quot;nsIMsgTraitService.h&quot;</span>
<a href="#l15.26"></a><span id="l15.26"> #include &quot;nsIMessenger.h&quot;</span>
<a href="#l15.27"></a><span id="l15.27"> #include &quot;nsITransactionManager.h&quot;</span>
<a href="#l15.28"></a><span id="l15.28"> #include &quot;nsMsgReadStateTxn.h&quot;</span>
<a href="#l15.29"></a><span id="l15.29"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+#include &quot;nsIPK11TokenDB.h&quot;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+#include &quot;nsIPK11Token.h&quot;</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33"> #define oneHour 3600000000U</span>
<a href="#l15.34"></a><span id="l15.34"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36"> static PRTime gtimeOfLastPurgeCheck;    //variable to know when to check for purge_threshhold</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38"> #define PREF_MAIL_PROMPT_PURGE_THRESHOLD &quot;mail.prompt_purge_threshhold&quot;</span>
<a href="#l15.39"></a><span id="l15.39"> #define PREF_MAIL_PURGE_THRESHOLD &quot;mail.purge_threshhold&quot;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineat">@@ -2227,89 +2228,65 @@ nsMsgDBFolder::GetLastMessageLoaded(nsMs</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42"> NS_IMETHODIMP</span>
<a href="#l15.43"></a><span id="l15.43"> nsMsgDBFolder::SetLastMessageLoaded(nsMsgKey aMsgKey)</span>
<a href="#l15.44"></a><span id="l15.44"> {</span>
<a href="#l15.45"></a><span id="l15.45">   mLastMessageLoaded = aMsgKey;</span>
<a href="#l15.46"></a><span id="l15.46">   return NS_OK;</span>
<a href="#l15.47"></a><span id="l15.47"> }</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-nsresult nsMsgDBFolder::PromptForCachePassword(nsIMsgIncomingServer *server, nsIMsgWindow *aWindow, PRBool &amp;passwordCorrect)</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-{</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-  PRBool userDidntCancel;</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-  passwordCorrect = PR_FALSE;</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-  nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-  nsresult rv = GetBaseStringBundle(getter_AddRefs(bundle));</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-  nsCString hostName;</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-  nsCString userName;</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-  nsString passwordTemplate;</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-  nsCString password;</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-  nsString passwordTitle;</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-  nsString passwordPromptString;</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-  server-&gt;GetRealHostName(hostName);</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-  server-&gt;GetRealUsername(userName);</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-  bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;passwordTitle&quot;).get(), getter_Copies(passwordTitle));</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-  bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;passwordPrompt&quot;).get(), getter_Copies(passwordTemplate));</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-  </span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-  NS_ConvertASCIItoUTF16 userNameStr(userName);</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-  NS_ConvertASCIItoUTF16 hostNameStr(hostName);</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-  const PRUnichar *stringParams[2] = { userNameStr.get(), hostNameStr.get() };</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-  rv = bundle-&gt;FormatStringFromName(</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-        NS_LITERAL_STRING(&quot;passwordPrompt&quot;).get(), stringParams, 2,</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-        getter_Copies(passwordPromptString ));</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-  do</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+// Returns true if: a) there is no need to prompt or b) the user is already</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+// logged in or c) the user logged in successfully.</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+PRBool nsMsgDBFolder::PromptForMasterPasswordIfNecessary()</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+{</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+  nsresult rv;</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+    do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+  PRBool userNeedsToAuthenticate = PR_FALSE;</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+  // if we're PasswordProtectLocalCache, then we need to find out if the server</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+  // is authenticated.</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+  (void) accountManager-&gt;GetUserNeedsToAuthenticate(&amp;userNeedsToAuthenticate);</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+  if (!userNeedsToAuthenticate)</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+    return PR_TRUE;</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+  // Do we have a master password?</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+  nsCOMPtr&lt;nsIPK11TokenDB&gt; tokenDB =</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+    do_GetService(NS_PK11TOKENDB_CONTRACTID, &amp;rv);</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineplus">+</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+  nsCOMPtr&lt;nsIPK11Token&gt; token;</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineplus">+  rv = tokenDB-&gt;GetInternalKeyToken(getter_AddRefs(token));</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+  PRBool result;</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+  rv = token-&gt;CheckPassword(EmptyString().get(), &amp;result);</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+  if (result)</span>
<a href="#l15.109"></a><span id="l15.109">   {</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineminus">-    rv = server-&gt;GetPasswordWithUI(passwordPromptString,</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineminus">-                                   passwordTitle,</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineminus">-                                   aWindow,</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-                                   &amp;userDidntCancel,</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineminus">-                                   password);</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineminus">-    if (rv != NS_MSG_PASSWORD_PROMPT_CANCELLED &amp;&amp; !password.IsEmpty())</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-    {</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-      nsCOMPtr &lt;nsIPasswordManagerInternal&gt; passwordMgrInt = do_GetService(NS_PASSWORDMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-      if(passwordMgrInt)</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineminus">-      {</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-        // Get the current server URI</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-        nsCString currServerUri;</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-        rv = server-&gt;GetServerURI(currServerUri);</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineminus">-</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-        currServerUri.Insert('x', 0);</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineminus">-        nsCAutoString hostFound;</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-        nsAutoString userNameFound;</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-        nsAutoString passwordFound;</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-        // Get password entry corresponding to the host URI we are passing in.</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-        rv = passwordMgrInt-&gt;FindPasswordEntry(currServerUri, EmptyString(), EmptyString(),</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-                                               hostFound, userNameFound,</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineminus">-                                               passwordFound);</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineminus">-          break;</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineminus">-        // compare the user-entered password with the saved password with</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineminus">-        // the munged uri.</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-        passwordCorrect = password.Equals(NS_ConvertUTF16toUTF8(passwordFound));</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-        if (!passwordCorrect)</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineminus">-          server-&gt;SetPassword(EmptyCString());</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineminus">-        else</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineminus">-        {</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineminus">-          nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID);</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-          if (accountManager)</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineminus">-            accountManager-&gt;SetUserNeedsToAuthenticate(PR_FALSE);</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineminus">-        }</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineminus">-      }</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineminus">-    }</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineplus">+    // We don't have a master password, so this function isn't supported,</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineplus">+    // therefore just tell account manager we've authenticated and return true.</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineplus">+    accountManager-&gt;SetUserNeedsToAuthenticate(PR_FALSE);</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineplus">+    return PR_TRUE;</span>
<a href="#l15.153"></a><span id="l15.153">   }</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineminus">-  while (NS_SUCCEEDED(rv) &amp;&amp; rv != NS_MSG_PASSWORD_PROMPT_CANCELLED &amp;&amp; userDidntCancel &amp;&amp; !passwordCorrect);</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineminus">-  return (!passwordCorrect) ? NS_ERROR_FAILURE : rv;</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineplus">+</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineplus">+  // We have a master password, so try and login to the slot.</span>
<a href="#l15.158"></a><span id="l15.158" class="difflineplus">+  rv = token-&gt;Login(PR_FALSE);</span>
<a href="#l15.159"></a><span id="l15.159" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineplus">+    // Login failed, so we didn't get a password (e.g. prompt cancelled).</span>
<a href="#l15.161"></a><span id="l15.161" class="difflineplus">+    return PR_FALSE;</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineplus">+</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineplus">+  // Double-check that we are now logged in</span>
<a href="#l15.164"></a><span id="l15.164" class="difflineplus">+  rv = token-&gt;IsLoggedIn(&amp;result);</span>
<a href="#l15.165"></a><span id="l15.165" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l15.166"></a><span id="l15.166" class="difflineplus">+</span>
<a href="#l15.167"></a><span id="l15.167" class="difflineplus">+  accountManager-&gt;SetUserNeedsToAuthenticate(!result);</span>
<a href="#l15.168"></a><span id="l15.168" class="difflineplus">+  return result;</span>
<a href="#l15.169"></a><span id="l15.169"> }</span>
<a href="#l15.170"></a><span id="l15.170"> </span>
<a href="#l15.171"></a><span id="l15.171"> // this gets called after the last junk mail classification has run.</span>
<a href="#l15.172"></a><span id="l15.172"> nsresult nsMsgDBFolder::PerformBiffNotifications(void)</span>
<a href="#l15.173"></a><span id="l15.173"> {</span>
<a href="#l15.174"></a><span id="l15.174">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l15.175"></a><span id="l15.175">   nsresult rv = GetServer(getter_AddRefs(server));</span>
<a href="#l15.176"></a><span id="l15.176">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -143,17 +143,20 @@ protected:</span>
<a href="#l16.4"></a><span id="l16.4">   nsresult OnHdrAddedOrDeleted(nsIMsgDBHdr *hdrChanged, PRBool added);</span>
<a href="#l16.5"></a><span id="l16.5">   nsresult CreateFileForDB(const nsACString&amp; userLeafName, nsILocalFile *baseDir, nsILocalFile **dbFile);</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">   nsresult GetFolderCacheKey(nsILocalFile **aFile, PRBool createDBIfMissing = PR_FALSE);</span>
<a href="#l16.8"></a><span id="l16.8">   nsresult GetFolderCacheElemFromFile(nsILocalFile *file, nsIMsgFolderCacheElement **cacheElement);</span>
<a href="#l16.9"></a><span id="l16.9">   nsresult AddDirectorySeparator(nsILocalFile *path);</span>
<a href="#l16.10"></a><span id="l16.10">   nsresult CheckIfFolderExists(const nsAString&amp; newFolderName, nsIMsgFolder *parentFolder, nsIMsgWindow *msgWindow);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  nsresult PromptForCachePassword(nsIMsgIncomingServer *server, nsIMsgWindow *aWindow, PRBool &amp;passwordCorrect);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  // Returns true if: a) there is no need to prompt or b) the user is already</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+  // logged in or c) the user logged in successfully.</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  static PRBool PromptForMasterPasswordIfNecessary();</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+</span>
<a href="#l16.17"></a><span id="l16.17">   // offline support methods.</span>
<a href="#l16.18"></a><span id="l16.18">   nsresult StartNewOfflineMessage();</span>
<a href="#l16.19"></a><span id="l16.19">   nsresult WriteStartOfNewLocalMessage();</span>
<a href="#l16.20"></a><span id="l16.20">   nsresult EndNewOfflineMessage();</span>
<a href="#l16.21"></a><span id="l16.21">   nsresult CompactOfflineStore(nsIMsgWindow *inWindow, nsIUrlListener *aUrlListener);</span>
<a href="#l16.22"></a><span id="l16.22">   nsresult AutoCompact(nsIMsgWindow *aWindow);</span>
<a href="#l16.23"></a><span id="l16.23">   // this is a helper routine that ignores whether MSG_FLAG_OFFLINE is set for the folder</span>
<a href="#l16.24"></a><span id="l16.24">   nsresult MsgFitsDownloadCriteria(nsMsgKey msgKey, PRBool *result);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.6"></a><span id="l17.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.7"></a><span id="l17.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.8"></a><span id="l17.8">  *</span>
<a href="#l17.9"></a><span id="l17.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.10"></a><span id="l17.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.11"></a><span id="l17.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l17.12"></a><span id="l17.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l17.13"></a><span id="l17.13">  *</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineat">@@ -57,28 +57,28 @@</span>
<a href="#l17.15"></a><span id="l17.15"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l17.16"></a><span id="l17.16"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l17.17"></a><span id="l17.17"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l17.18"></a><span id="l17.18"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l17.19"></a><span id="l17.19"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l17.20"></a><span id="l17.20"> #include &quot;nsIRelativeFilePref.h&quot;</span>
<a href="#l17.21"></a><span id="l17.21"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l17.22"></a><span id="l17.22"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-#include &quot;nsIObserverService.h&quot;</span>
<a href="#l17.24"></a><span id="l17.24"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l17.25"></a><span id="l17.25"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l17.26"></a><span id="l17.26"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l17.27"></a><span id="l17.27"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l17.28"></a><span id="l17.28"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l17.29"></a><span id="l17.29"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l17.30"></a><span id="l17.30"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l17.31"></a><span id="l17.31"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+#include &quot;nsILoginInfo.h&quot;</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+#include &quot;nsILoginManager.h&quot;</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-#include &quot;nsCPasswordManager.h&quot;</span>
<a href="#l17.37"></a><span id="l17.37"> #include &quot;nsIMsgMdnGenerator.h&quot;</span>
<a href="#l17.38"></a><span id="l17.38"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l17.39"></a><span id="l17.39"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l17.40"></a><span id="l17.40"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42"> #define PORT_NOT_SET -1</span>
<a href="#l17.43"></a><span id="l17.43"> </span>
<a href="#l17.44"></a><span id="l17.44"> nsMsgIncomingServer::nsMsgIncomingServer():</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineat">@@ -688,52 +688,91 @@ NS_IMETHODIMP nsMsgIncomingServer::GetPa</span>
<a href="#l17.46"></a><span id="l17.46"> </span>
<a href="#l17.47"></a><span id="l17.47"> NS_IMETHODIMP nsMsgIncomingServer::GetServerRequiresPasswordForBiff(PRBool *aServerRequiresPasswordForBiff)</span>
<a href="#l17.48"></a><span id="l17.48"> {</span>
<a href="#l17.49"></a><span id="l17.49">   NS_ENSURE_ARG_POINTER(aServerRequiresPasswordForBiff);</span>
<a href="#l17.50"></a><span id="l17.50">   *aServerRequiresPasswordForBiff = PR_TRUE;</span>
<a href="#l17.51"></a><span id="l17.51">   return NS_OK;</span>
<a href="#l17.52"></a><span id="l17.52"> }</span>
<a href="#l17.53"></a><span id="l17.53"> </span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+void nsMsgIncomingServer::GetPasswordWithoutUI(nsACString &amp;aPassword)</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+{</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+  aPassword.Truncate();</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+  nsresult rv;</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  nsCOMPtr&lt;nsILoginManager&gt; loginMgr(do_GetService(NS_LOGINMANAGER_CONTRACTID,</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+                                                   &amp;rv));</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+  // Get the current server URI</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+  nsCString currServerUri;</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+  rv = GetLocalStoreType(currServerUri);</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+  currServerUri.AppendLiteral(&quot;://&quot;);</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+  nsCString temp;</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+  rv = GetHostName(temp);</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+  currServerUri.Append(temp);</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+  NS_ConvertUTF8toUTF16 currServer(currServerUri);</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+  PRUint32 numLogins = 0;</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+  nsILoginInfo** logins = nsnull;</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+  rv = loginMgr-&gt;FindLogins(&amp;numLogins, currServer, EmptyString(),</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+                            currServer, &amp;logins);</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+  // Don't abort here, if we didn't find any or failed, then we'll just have</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+  // to prompt.</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+  if (NS_SUCCEEDED(rv) &amp;&amp; numLogins &gt; 0)</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+  {</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+    nsCString serverCUsername;</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+    rv = GetUsername(serverCUsername);</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+    NS_ConvertUTF8toUTF16 serverUsername(serverCUsername);</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+    nsString username;</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+    for (PRUint32 i = 0; i &lt; numLogins; ++i)</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+    {</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+      rv = logins[i]-&gt;GetUsername(username);</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+      if (username.Equals(serverUsername))</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+      {</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+        nsString password;</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+        rv = logins[i]-&gt;GetPassword(password);</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+        NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+        m_password = NS_LossyConvertUTF16toASCII(password);</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+        break;</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+      }</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+    }</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineplus">+    NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numLogins, logins);</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+  }</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+}</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+</span>
<a href="#l17.113"></a><span id="l17.113"> NS_IMETHODIMP</span>
<a href="#l17.114"></a><span id="l17.114"> nsMsgIncomingServer::GetPasswordWithUI(const nsAString&amp; aPromptMessage, const</span>
<a href="#l17.115"></a><span id="l17.115">                                        nsAString&amp; aPromptTitle,</span>
<a href="#l17.116"></a><span id="l17.116">                                        nsIMsgWindow* aMsgWindow,</span>
<a href="#l17.117"></a><span id="l17.117">                                        PRBool *okayValue,</span>
<a href="#l17.118"></a><span id="l17.118">                                        nsACString&amp; aPassword)</span>
<a href="#l17.119"></a><span id="l17.119"> {</span>
<a href="#l17.120"></a><span id="l17.120">   nsresult rv = NS_OK;</span>
<a href="#l17.121"></a><span id="l17.121">   NS_ENSURE_ARG_POINTER(okayValue);</span>
<a href="#l17.122"></a><span id="l17.122"> </span>
<a href="#l17.123"></a><span id="l17.123">   if (m_password.IsEmpty())</span>
<a href="#l17.124"></a><span id="l17.124">   {</span>
<a href="#l17.125"></a><span id="l17.125">     // let's see if we have the password in the password manager and</span>
<a href="#l17.126"></a><span id="l17.126">     // can avoid this prompting thing. This makes it easier to get embedders</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-    // to get up and running w/o a password prompting UI. We already depend on</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineminus">-    // nsIPasswordManagerInternal so this doesn't introduce a new dependency.</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineminus">-    nsCOMPtr &lt;nsIPasswordManagerInternal&gt; passwordMgrInt = do_GetService(NS_PASSWORDMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineminus">-    if(passwordMgrInt)</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineminus">-    {</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineminus">-      // Get the current server URI</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineminus">-      nsCString currServerUri;</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineminus">-      rv = GetServerURI(currServerUri);</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineminus">-</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineminus">-      nsCAutoString hostFound;</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineminus">-      nsAutoString userNameFound;</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineminus">-      nsAutoString passwordFound;</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineminus">-</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineminus">-      // Get password entry corresponding to the host URI we are passing in.</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineminus">-      if (NS_SUCCEEDED(passwordMgrInt-&gt;FindPasswordEntry(currServerUri, EmptyString(), EmptyString(),</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-                                             hostFound, userNameFound, passwordFound)))</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-      {</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineminus">-        LossyCopyUTF16toASCII(passwordFound, m_password);</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineminus">-        *okayValue = PR_TRUE;</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineminus">-      }</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineminus">-    }</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+    // to get up and running w/o a password prompting UI.</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineplus">+    GetPasswordWithoutUI(aPassword);</span>
<a href="#l17.151"></a><span id="l17.151">   }</span>
<a href="#l17.152"></a><span id="l17.152">   if (m_password.IsEmpty())</span>
<a href="#l17.153"></a><span id="l17.153">   {</span>
<a href="#l17.154"></a><span id="l17.154">     nsCOMPtr&lt;nsIAuthPrompt&gt; dialog;</span>
<a href="#l17.155"></a><span id="l17.155">     // aMsgWindow is required if we need to prompt</span>
<a href="#l17.156"></a><span id="l17.156">     if (aMsgWindow)</span>
<a href="#l17.157"></a><span id="l17.157">     {</span>
<a href="#l17.158"></a><span id="l17.158">       // prompt the user for the password</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineat">@@ -741,30 +780,44 @@ nsMsgIncomingServer::GetPasswordWithUI(c</span>
<a href="#l17.160"></a><span id="l17.160">       rv = aMsgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l17.161"></a><span id="l17.161">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.162"></a><span id="l17.162">       dialog = do_GetInterface(docShell, &amp;rv);</span>
<a href="#l17.163"></a><span id="l17.163">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.164"></a><span id="l17.164">     }</span>
<a href="#l17.165"></a><span id="l17.165">     if (dialog)</span>
<a href="#l17.166"></a><span id="l17.166">     {</span>
<a href="#l17.167"></a><span id="l17.167">       nsCString serverUri;</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineminus">-      rv = GetServerURI(serverUri);</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+      rv = GetLocalStoreType(serverUri);</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+      serverUri.AppendLiteral(&quot;://&quot;);</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+      nsCString temp;</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+      rv = GetRealUsername(temp);</span>
<a href="#l17.175"></a><span id="l17.175">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.176"></a><span id="l17.176"> </span>
<a href="#l17.177"></a><span id="l17.177" class="difflineplus">+      serverUri.Append(temp);</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+      serverUri.AppendLiteral(&quot;@&quot;);</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+      rv = GetRealHostName(temp);</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+      serverUri.Append(temp);</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+</span>
<a href="#l17.185"></a><span id="l17.185">       // we pass in the previously used password, if any, into PromptPassword</span>
<a href="#l17.186"></a><span id="l17.186">       // so that it will appear as ******. This means we can't use an nsString</span>
<a href="#l17.187"></a><span id="l17.187">       // and getter_Copies.</span>
<a href="#l17.188"></a><span id="l17.188">       PRUnichar *uniPassword = nsnull;</span>
<a href="#l17.189"></a><span id="l17.189">       if (!aPassword.IsEmpty())</span>
<a href="#l17.190"></a><span id="l17.190">         uniPassword = ToNewUnicode(NS_ConvertASCIItoUTF16(aPassword));</span>
<a href="#l17.191"></a><span id="l17.191"> </span>
<a href="#l17.192"></a><span id="l17.192" class="difflineminus">-      PRUint32 savePasswordType = PasswordProtectLocalCache() ? nsIAuthPrompt::SAVE_PASSWORD_FOR_SESSION : nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY;</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineminus">-      rv = dialog-&gt;PromptPassword(nsString(aPromptTitle).get(), nsString(aPromptMessage).get(),</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineminus">-        NS_ConvertASCIItoUTF16(serverUri).get(), savePasswordType,</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineminus">-        &amp;uniPassword, okayValue);</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineplus">+      rv = dialog-&gt;PromptPassword(PromiseFlatString(aPromptTitle).get(),</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineplus">+                                  PromiseFlatString(aPromptMessage).get(),</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+                                  NS_ConvertASCIItoUTF16(serverUri).get(),</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+                                  nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+                                  &amp;uniPassword, okayValue);</span>
<a href="#l17.201"></a><span id="l17.201">       nsAutoString uniPasswordAdopted;</span>
<a href="#l17.202"></a><span id="l17.202">       uniPasswordAdopted.Adopt(uniPassword);</span>
<a href="#l17.203"></a><span id="l17.203">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.204"></a><span id="l17.204"> </span>
<a href="#l17.205"></a><span id="l17.205">       if (!*okayValue) // if the user pressed cancel, just return an empty string;</span>
<a href="#l17.206"></a><span id="l17.206">       {</span>
<a href="#l17.207"></a><span id="l17.207">         aPassword.Truncate();</span>
<a href="#l17.208"></a><span id="l17.208">         return NS_MSG_PASSWORD_PROMPT_CANCELLED;</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineat">@@ -774,70 +827,66 @@ nsMsgIncomingServer::GetPasswordWithUI(c</span>
<a href="#l17.210"></a><span id="l17.210">       rv = SetPassword(NS_LossyConvertUTF16toASCII(uniPasswordAdopted));</span>
<a href="#l17.211"></a><span id="l17.211">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.212"></a><span id="l17.212">     } // if we got a prompt dialog</span>
<a href="#l17.213"></a><span id="l17.213">   } // if the password is empty</span>
<a href="#l17.214"></a><span id="l17.214">   return GetPassword(aPassword);</span>
<a href="#l17.215"></a><span id="l17.215"> }</span>
<a href="#l17.216"></a><span id="l17.216"> </span>
<a href="#l17.217"></a><span id="l17.217"> NS_IMETHODIMP</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineminus">-nsMsgIncomingServer::StorePassword()</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+nsMsgIncomingServer::ForgetPassword()</span>
<a href="#l17.220"></a><span id="l17.220"> {</span>
<a href="#l17.221"></a><span id="l17.221">   nsresult rv;</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineplus">+  nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+    do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.225"></a><span id="l17.225"> </span>
<a href="#l17.226"></a><span id="l17.226" class="difflineminus">-  // we only need to store this if we're password protecting the local cache.</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineminus">-  // Otherwise, the password manager handles storing the password if the user</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineminus">-  // checks the &quot;remember password&quot; box.</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineminus">-  if (!PasswordProtectLocalCache())</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineminus">-    return NS_OK;</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineplus">+  // Get the current server URI</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+  nsCString currServerUri;</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineplus">+  rv = GetLocalStoreType(currServerUri);</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.235"></a><span id="l17.235"> </span>
<a href="#l17.236"></a><span id="l17.236" class="difflineminus">-  nsCString pwd;</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineminus">-  rv = GetPassword(pwd);</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineplus">+  currServerUri.AppendLiteral(&quot;://&quot;);</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineplus">+  nsCString temp;</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+  rv = GetHostName(temp);</span>
<a href="#l17.242"></a><span id="l17.242">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.243"></a><span id="l17.243"> </span>
<a href="#l17.244"></a><span id="l17.244" class="difflineminus">-  nsCString serverSpec;</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineminus">-  rv = GetServerURI(serverSpec);</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineplus">+  currServerUri.Append(temp);</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineplus">+</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineplus">+  PRUint32 count;</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineplus">+  nsILoginInfo** logins;</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineplus">+</span>
<a href="#l17.252"></a><span id="l17.252" class="difflineplus">+  NS_ConvertUTF8toUTF16 currServer(currServerUri);</span>
<a href="#l17.253"></a><span id="l17.253"> </span>
<a href="#l17.254"></a><span id="l17.254" class="difflineminus">-  // We're password protecting the local cache, we're going to munge the uri in the password mgr to</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineminus">-  // start with 'x', so that we can remember the password in order to challenge the user, w/o having the</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineminus">-  // password mgr automatically use the password.</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineminus">-  serverSpec.Insert('x', 0);</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineminus">-  NS_NewURI(getter_AddRefs(uri), serverSpec);</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+  nsCString serverCUsername;</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+  rv = GetUsername(serverCUsername);</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.263"></a><span id="l17.263"> </span>
<a href="#l17.264"></a><span id="l17.264" class="difflineminus">-  //this is need to make sure wallet service has been created</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineminus">-  rv = CreateServicesForPasswordManager();</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+  NS_ConvertUTF8toUTF16 serverUsername(serverCUsername);</span>
<a href="#l17.267"></a><span id="l17.267" class="difflineplus">+</span>
<a href="#l17.268"></a><span id="l17.268" class="difflineplus">+  rv = loginMgr-&gt;FindLogins(&amp;count, currServer, EmptyString(),</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineplus">+                            currServer, &amp;logins);</span>
<a href="#l17.270"></a><span id="l17.270">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.271"></a><span id="l17.271" class="difflineminus">-  </span>
<a href="#l17.272"></a><span id="l17.272" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l17.273"></a><span id="l17.273" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineminus">-  rv = observerService-&gt;NotifyObservers(uri, &quot;login-succeeded&quot;, NS_ConvertUTF8toUTF16(pwd).get());</span>
<a href="#l17.275"></a><span id="l17.275" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l17.276"></a><span id="l17.276" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID);</span>
<a href="#l17.277"></a><span id="l17.277" class="difflineminus">-  if (accountManager)</span>
<a href="#l17.278"></a><span id="l17.278" class="difflineminus">-    accountManager-&gt;SetUserNeedsToAuthenticate(PR_FALSE);</span>
<a href="#l17.279"></a><span id="l17.279" class="difflineminus">-  return rv;</span>
<a href="#l17.280"></a><span id="l17.280" class="difflineminus">-}</span>
<a href="#l17.281"></a><span id="l17.281"> </span>
<a href="#l17.282"></a><span id="l17.282" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l17.283"></a><span id="l17.283" class="difflineminus">-nsMsgIncomingServer::ForgetPassword()</span>
<a href="#l17.284"></a><span id="l17.284" class="difflineminus">-{</span>
<a href="#l17.285"></a><span id="l17.285" class="difflineminus">-  //this is needed to make sure the wallet service has been created</span>
<a href="#l17.286"></a><span id="l17.286" class="difflineminus">-  nsresult rv = CreateServicesForPasswordManager();</span>
<a href="#l17.287"></a><span id="l17.287" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.288"></a><span id="l17.288" class="difflineminus">-  nsCOMPtr &lt;nsIPasswordManager&gt; passwordMgr = do_GetService(NS_PASSWORDMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l17.289"></a><span id="l17.289" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; passwordMgr)</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineplus">+  // There should only be one-login stored for this url, however just in case</span>
<a href="#l17.291"></a><span id="l17.291" class="difflineplus">+  // there isn't.</span>
<a href="#l17.292"></a><span id="l17.292" class="difflineplus">+  nsString username;</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineplus">+  for (PRUint32 i = 0; i &lt; count; ++i)</span>
<a href="#l17.294"></a><span id="l17.294">   {</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineminus">-    // Get the current server URI</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineminus">-    nsCString currServerUri;</span>
<a href="#l17.297"></a><span id="l17.297" class="difflineminus">-    rv = GetServerURI(currServerUri);</span>
<a href="#l17.298"></a><span id="l17.298" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineminus">-    passwordMgr-&gt;RemoveUser(currServerUri, EmptyString());</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineplus">+    if (NS_SUCCEEDED(logins[i]-&gt;GetUsername(username)) &amp;&amp;</span>
<a href="#l17.301"></a><span id="l17.301" class="difflineplus">+        username.Equals(serverUsername))</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+    {</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineplus">+      // If this fails, just continue, we'll still want to remove the password</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineplus">+      // from our local cache.</span>
<a href="#l17.305"></a><span id="l17.305" class="difflineplus">+      loginMgr-&gt;RemoveLogin(logins[i]);</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineplus">+    }</span>
<a href="#l17.307"></a><span id="l17.307">   }</span>
<a href="#l17.308"></a><span id="l17.308" class="difflineplus">+  NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l17.309"></a><span id="l17.309" class="difflineplus">+</span>
<a href="#l17.310"></a><span id="l17.310">   return SetPassword(EmptyCString());</span>
<a href="#l17.311"></a><span id="l17.311"> }</span>
<a href="#l17.312"></a><span id="l17.312"> </span>
<a href="#l17.313"></a><span id="l17.313"> NS_IMETHODIMP</span>
<a href="#l17.314"></a><span id="l17.314"> nsMsgIncomingServer::ForgetSessionPassword()</span>
<a href="#l17.315"></a><span id="l17.315"> {</span>
<a href="#l17.316"></a><span id="l17.316">   m_password.Truncate();</span>
<a href="#l17.317"></a><span id="l17.317">   return NS_OK;</span>
<a href="#l17.318"></a><span id="l17.318" class="difflineat">@@ -896,27 +945,16 @@ nsMsgIncomingServer::GetLocalPath(nsILoc</span>
<a href="#l17.319"></a><span id="l17.319"> NS_IMETHODIMP</span>
<a href="#l17.320"></a><span id="l17.320"> nsMsgIncomingServer::SetLocalPath(nsILocalFile *aLocalPath)</span>
<a href="#l17.321"></a><span id="l17.321"> {</span>
<a href="#l17.322"></a><span id="l17.322">   NS_ENSURE_ARG_POINTER(aLocalPath);</span>
<a href="#l17.323"></a><span id="l17.323">   aLocalPath-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l17.324"></a><span id="l17.324">   return SetFileValue(&quot;directory-rel&quot;, &quot;directory&quot;, aLocalPath);</span>
<a href="#l17.325"></a><span id="l17.325"> }</span>
<a href="#l17.326"></a><span id="l17.326"> </span>
<a href="#l17.327"></a><span id="l17.327" class="difflineminus">-PRBool nsMsgIncomingServer::PasswordProtectLocalCache()</span>
<a href="#l17.328"></a><span id="l17.328" class="difflineminus">-{</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineminus">-  NS_ENSURE_TRUE(prefs, PR_FALSE);</span>
<a href="#l17.331"></a><span id="l17.331" class="difflineminus">-</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineminus">-  PRBool passwordProtectLocalCache;</span>
<a href="#l17.333"></a><span id="l17.333" class="difflineminus">-  nsresult rv = prefs-&gt;GetBoolPref( &quot;mail.password_protect_local_cache&quot;, &amp;passwordProtectLocalCache);</span>
<a href="#l17.334"></a><span id="l17.334" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineminus">-  return passwordProtectLocalCache;</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineminus">-}</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineminus">-</span>
<a href="#l17.338"></a><span id="l17.338"> NS_IMETHODIMP</span>
<a href="#l17.339"></a><span id="l17.339"> nsMsgIncomingServer::GetLocalStoreType(nsACString&amp; aResult)</span>
<a href="#l17.340"></a><span id="l17.340"> {</span>
<a href="#l17.341"></a><span id="l17.341">   NS_NOTYETIMPLEMENTED(&quot;nsMsgIncomingServer superclass not implementing GetLocalStoreType!&quot;);</span>
<a href="#l17.342"></a><span id="l17.342">   return NS_ERROR_UNEXPECTED;</span>
<a href="#l17.343"></a><span id="l17.343"> }</span>
<a href="#l17.344"></a><span id="l17.344"> </span>
<a href="#l17.345"></a><span id="l17.345"> NS_IMETHODIMP</span>
<a href="#l17.346"></a><span id="l17.346" class="difflineat">@@ -1630,45 +1668,24 @@ nsMsgIncomingServer::GetPasswordPromptRe</span>
<a href="#l17.347"></a><span id="l17.347">   // If the password is not even required for biff we don't need to check any further</span>
<a href="#l17.348"></a><span id="l17.348">   nsresult rv = GetServerRequiresPasswordForBiff(aPasswordIsRequired);</span>
<a href="#l17.349"></a><span id="l17.349">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.350"></a><span id="l17.350">   if (!*aPasswordIsRequired)</span>
<a href="#l17.351"></a><span id="l17.351">     return NS_OK;</span>
<a href="#l17.352"></a><span id="l17.352"> </span>
<a href="#l17.353"></a><span id="l17.353">   // If the password is empty, check to see if it is stored and to be retrieved</span>
<a href="#l17.354"></a><span id="l17.354">   if (m_password.IsEmpty()) {</span>
<a href="#l17.355"></a><span id="l17.355" class="difflineminus">-    nsCOMPtr &lt;nsIPasswordManagerInternal&gt; passwordMgrInt = do_GetService(NS_PASSWORDMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l17.356"></a><span id="l17.356" class="difflineminus">-    if(NS_SUCCEEDED(rv) &amp;&amp; passwordMgrInt) {</span>
<a href="#l17.357"></a><span id="l17.357" class="difflineminus">-</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineminus">-      // Get the current server URI</span>
<a href="#l17.359"></a><span id="l17.359" class="difflineminus">-      nsCString currServerUri;</span>
<a href="#l17.360"></a><span id="l17.360" class="difflineminus">-      rv = GetServerURI(currServerUri);</span>
<a href="#l17.361"></a><span id="l17.361" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.362"></a><span id="l17.362" class="difflineminus">-</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineminus">-      // Obtain the server URI which is in the format &lt;protocol&gt;://&lt;userid&gt;@&lt;hostname&gt;.</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineminus">-      // Password manager uses the same format when it stores the password on user's request.</span>
<a href="#l17.365"></a><span id="l17.365" class="difflineminus">-      nsCAutoString hostFound;</span>
<a href="#l17.366"></a><span id="l17.366" class="difflineminus">-      nsAutoString userNameFound;</span>
<a href="#l17.367"></a><span id="l17.367" class="difflineminus">-      nsAutoString passwordFound;</span>
<a href="#l17.368"></a><span id="l17.368" class="difflineplus">+    nsCString password;</span>
<a href="#l17.369"></a><span id="l17.369" class="difflineplus">+    GetPasswordWithoutUI(password);</span>
<a href="#l17.370"></a><span id="l17.370"> </span>
<a href="#l17.371"></a><span id="l17.371" class="difflineminus">-      // Get password entry corresponding to the host URI we are passing in.</span>
<a href="#l17.372"></a><span id="l17.372" class="difflineminus">-      rv = passwordMgrInt-&gt;FindPasswordEntry(currServerUri, EmptyString(), EmptyString(),</span>
<a href="#l17.373"></a><span id="l17.373" class="difflineminus">-                                             hostFound, userNameFound, passwordFound);</span>
<a href="#l17.374"></a><span id="l17.374" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l17.375"></a><span id="l17.375" class="difflineminus">-        return NS_OK;</span>
<a href="#l17.376"></a><span id="l17.376" class="difflineminus">-</span>
<a href="#l17.377"></a><span id="l17.377" class="difflineminus">-      // If a match is found, password element is filled in. Convert the</span>
<a href="#l17.378"></a><span id="l17.378" class="difflineminus">-      // obtained password and store it for the session.</span>
<a href="#l17.379"></a><span id="l17.379" class="difflineminus">-      if (!passwordFound.IsEmpty())</span>
<a href="#l17.380"></a><span id="l17.380" class="difflineminus">-      {</span>
<a href="#l17.381"></a><span id="l17.381" class="difflineminus">-        if (PasswordProtectLocalCache()) // hmm, shouldn't be in here, so remove it.</span>
<a href="#l17.382"></a><span id="l17.382" class="difflineminus">-          ForgetPassword();</span>
<a href="#l17.383"></a><span id="l17.383" class="difflineminus">-        else</span>
<a href="#l17.384"></a><span id="l17.384" class="difflineminus">-          rv = SetPassword(NS_LossyConvertUTF16toASCII(passwordFound));</span>
<a href="#l17.385"></a><span id="l17.385" class="difflineminus">-      }</span>
<a href="#l17.386"></a><span id="l17.386" class="difflineplus">+    // If a match is found, password element is filled in. Convert the</span>
<a href="#l17.387"></a><span id="l17.387" class="difflineplus">+    // obtained password and store it for the session.</span>
<a href="#l17.388"></a><span id="l17.388" class="difflineplus">+    if (!password.IsEmpty())</span>
<a href="#l17.389"></a><span id="l17.389" class="difflineplus">+    {</span>
<a href="#l17.390"></a><span id="l17.390" class="difflineplus">+      rv = SetPassword(password);</span>
<a href="#l17.391"></a><span id="l17.391">     }</span>
<a href="#l17.392"></a><span id="l17.392">   }</span>
<a href="#l17.393"></a><span id="l17.393">   *aPasswordIsRequired = m_password.IsEmpty();</span>
<a href="#l17.394"></a><span id="l17.394">   return rv;</span>
<a href="#l17.395"></a><span id="l17.395"> }</span>
<a href="#l17.396"></a><span id="l17.396"> </span>
<a href="#l17.397"></a><span id="l17.397"> NS_IMETHODIMP nsMsgIncomingServer::ConfigureTemporaryFilters(nsIMsgFilterList *aFilterList)</span>
<a href="#l17.398"></a><span id="l17.398"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.h</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -73,19 +73,20 @@ class NS_MSG_BASE nsMsgIncomingServer : </span>
<a href="#l18.4"></a><span id="l18.4">   virtual ~nsMsgIncomingServer();</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   NS_DECL_ISUPPORTS</span>
<a href="#l18.7"></a><span id="l18.7">   NS_DECL_NSIMSGINCOMINGSERVER</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> protected:</span>
<a href="#l18.10"></a><span id="l18.10">   nsCString m_serverKey;</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  void GetPasswordWithoutUI(nsACString &amp;aPassword);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+</span>
<a href="#l18.14"></a><span id="l18.14">   nsresult ConfigureTemporaryReturnReceiptsFilter(nsIMsgFilterList *filterList);</span>
<a href="#l18.15"></a><span id="l18.15">   nsresult ConfigureTemporaryServerSpamFilters(nsIMsgFilterList *filterList);</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-  PRBool PasswordProtectLocalCache();</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">   nsCOMPtr &lt;nsIMsgFolder&gt; m_rootFolder;</span>
<a href="#l18.19"></a><span id="l18.19">   nsCOMPtr &lt;nsIMsgRetentionSettings&gt; m_retentionSettings;</span>
<a href="#l18.20"></a><span id="l18.20">   nsCOMPtr &lt;nsIMsgDownloadSettings&gt; m_downloadSettings;</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22">   nsresult CreateLocalFolder(nsIFile *path, const nsACString&amp; folderName);</span>
<a href="#l18.23"></a><span id="l18.23">   nsresult GetDeferredServers(nsIMsgIncomingServer *server, nsISupportsArray **_retval);</span>
<a href="#l18.24"></a><span id="l18.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -641,19 +641,22 @@ NS_IMETHODIMP nsMsgProtocol::GetContentL</span>
<a href="#l19.4"></a><span id="l19.4"> }</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> NS_IMETHODIMP nsMsgProtocol::GetSecurityInfo(nsISupports * *aSecurityInfo)</span>
<a href="#l19.7"></a><span id="l19.7"> {</span>
<a href="#l19.8"></a><span id="l19.8">   *aSecurityInfo = nsnull;</span>
<a href="#l19.9"></a><span id="l19.9">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l19.10"></a><span id="l19.10"> }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-NS_IMETHODIMP nsMsgProtocol::GetName(nsACString &amp;aName)</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+NS_IMETHODIMP nsMsgProtocol::GetName(nsACString &amp;result)</span>
<a href="#l19.14"></a><span id="l19.14"> {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+  if (m_url)</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+    return m_url-&gt;GetSpec(result);</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+  result.Truncate();</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+  return NS_OK;</span>
<a href="#l19.20"></a><span id="l19.20"> }</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23"> NS_IMETHODIMP</span>
<a href="#l19.24"></a><span id="l19.24"> nsMsgProtocol::SetContentLength(PRInt32 aContentLength)</span>
<a href="#l19.25"></a><span id="l19.25"> {</span>
<a href="#l19.26"></a><span id="l19.26">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l19.27"></a><span id="l19.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -61,18 +61,16 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsIRelativeFilePref.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-#include &quot;nsICategoryManager.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-#include &quot;nsCategoryManagerUtils.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14"> #include &quot;nsISpamSettings.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> #include &quot;nsISignatureVerifier.h&quot;</span>
<a href="#l20.16"></a><span id="l20.16"> #include &quot;nsICryptoHash.h&quot;</span>
<a href="#l20.17"></a><span id="l20.17"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l20.18"></a><span id="l20.18"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l20.19"></a><span id="l20.19"> #include &quot;nsIRssIncomingServer.h&quot;</span>
<a href="#l20.20"></a><span id="l20.20"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l20.21"></a><span id="l20.21"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -88,19 +86,16 @@</span>
<a href="#l20.23"></a><span id="l20.23"> static NS_DEFINE_CID(kImapUrlCID, NS_IMAPURL_CID);</span>
<a href="#l20.24"></a><span id="l20.24"> static NS_DEFINE_CID(kCMailboxUrl, NS_MAILBOXURL_CID);</span>
<a href="#l20.25"></a><span id="l20.25"> static NS_DEFINE_CID(kCNntpUrlCID, NS_NNTPURL_CID);</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27"> #define ILLEGAL_FOLDER_CHARS &quot;;#&quot;</span>
<a href="#l20.28"></a><span id="l20.28"> #define ILLEGAL_FOLDER_CHARS_AS_FIRST_LETTER &quot;.&quot;</span>
<a href="#l20.29"></a><span id="l20.29"> #define ILLEGAL_FOLDER_CHARS_AS_LAST_LETTER  &quot;.~ &quot;</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-#define NS_PASSWORDMANAGER_CATEGORY &quot;passwordmanager&quot;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-static PRBool gInitPasswordManager = PR_FALSE;</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-</span>
<a href="#l20.34"></a><span id="l20.34"> nsresult GetMessageServiceContractIDForURI(const char *uri, nsCString &amp;contractID)</span>
<a href="#l20.35"></a><span id="l20.35"> {</span>
<a href="#l20.36"></a><span id="l20.36">   nsresult rv = NS_OK;</span>
<a href="#l20.37"></a><span id="l20.37">   //Find protocol</span>
<a href="#l20.38"></a><span id="l20.38">   nsCAutoString uriStr(uri);</span>
<a href="#l20.39"></a><span id="l20.39">   PRInt32 pos = uriStr.FindChar(':');</span>
<a href="#l20.40"></a><span id="l20.40">   if (pos == -1)</span>
<a href="#l20.41"></a><span id="l20.41">     return NS_ERROR_FAILURE;</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineat">@@ -825,29 +820,16 @@ nsresult EscapeFromSpaceLine(nsIOutputSt</span>
<a href="#l20.43"></a><span id="l20.43">       rv = outputStream-&gt;Write(start, end-start, &amp;written);</span>
<a href="#l20.44"></a><span id="l20.44">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.45"></a><span id="l20.45">       break;</span>
<a href="#l20.46"></a><span id="l20.46">     }</span>
<a href="#l20.47"></a><span id="l20.47">   }</span>
<a href="#l20.48"></a><span id="l20.48">   return NS_OK;</span>
<a href="#l20.49"></a><span id="l20.49"> }</span>
<a href="#l20.50"></a><span id="l20.50"> </span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-nsresult CreateServicesForPasswordManager()</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-{</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-  if (!gInitPasswordManager)</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-  {</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-     // Initialize the password manager category</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-    gInitPasswordManager = PR_TRUE;</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-    return NS_CreateServicesFromCategory(NS_PASSWORDMANAGER_CATEGORY,</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-                                  nsnull,</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-                                  NS_PASSWORDMANAGER_CATEGORY);</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-  }</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-  return NS_OK;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-}</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-</span>
<a href="#l20.64"></a><span id="l20.64"> nsresult IsRFC822HeaderFieldName(const char *aHdr, PRBool *aResult)</span>
<a href="#l20.65"></a><span id="l20.65"> {</span>
<a href="#l20.66"></a><span id="l20.66">   NS_ENSURE_ARG_POINTER(aHdr);</span>
<a href="#l20.67"></a><span id="l20.67">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l20.68"></a><span id="l20.68">   PRUint32 length = strlen(aHdr);</span>
<a href="#l20.69"></a><span id="l20.69">   for(PRUint32 i=0; i&lt;length; i++)</span>
<a href="#l20.70"></a><span id="l20.70">   {</span>
<a href="#l20.71"></a><span id="l20.71">     char c = aHdr[i];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -113,18 +113,16 @@ NS_MSG_BASE nsresult NS_GetPersistentFil</span>
<a href="#l21.4"></a><span id="l21.4">                                           nsILocalFile **aFile,</span>
<a href="#l21.5"></a><span id="l21.5">                                           nsIPrefBranch *prefBranch = nsnull);</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> NS_MSG_BASE nsresult NS_SetPersistentFile(const char *relPrefName,</span>
<a href="#l21.8"></a><span id="l21.8">                                           const char *absPrefName,</span>
<a href="#l21.9"></a><span id="l21.9">                                           nsILocalFile *aFile,</span>
<a href="#l21.10"></a><span id="l21.10">                                           nsIPrefBranch *prefBranch = nsnull);</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-NS_MSG_BASE nsresult CreateServicesForPasswordManager();</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-</span>
<a href="#l21.14"></a><span id="l21.14"> NS_MSG_BASE nsresult IsRFC822HeaderFieldName(const char *aHdr, PRBool *aResult);</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16"> NS_MSG_BASE nsresult NS_GetUnicharPreferenceWithDefault(nsIPrefBranch *prefBranch,   //can be null, if so uses the root branch</span>
<a href="#l21.17"></a><span id="l21.17">                                                         const char *prefName,</span>
<a href="#l21.18"></a><span id="l21.18">                                                         const nsAString&amp; defValue,</span>
<a href="#l21.19"></a><span id="l21.19">                                                         nsAString&amp; prefValue);</span>
<a href="#l21.20"></a><span id="l21.20">  </span>
<a href="#l21.21"></a><span id="l21.21"> NS_MSG_BASE nsresult NS_GetLocalizedUnicharPreferenceWithDefault(nsIPrefBranch *prefBranch,   //can be null, if so uses the root branch</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/compose/src/Makefile.in</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/compose/src/Makefile.in</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -78,16 +78,17 @@ REQUIRES	= xpcom \</span>
<a href="#l22.4"></a><span id="l22.4"> 		  txmgr \</span>
<a href="#l22.5"></a><span id="l22.5"> 		  caps \</span>
<a href="#l22.6"></a><span id="l22.6"> 		  exthandler \</span>
<a href="#l22.7"></a><span id="l22.7"> 		  nkcache \</span>
<a href="#l22.8"></a><span id="l22.8"> 		  mimetype \</span>
<a href="#l22.9"></a><span id="l22.9"> 		  windowwatcher \</span>
<a href="#l22.10"></a><span id="l22.10"> 		  gfx \</span>
<a href="#l22.11"></a><span id="l22.11"> 		  zipwriter \</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+		  loginmgr \</span>
<a href="#l22.13"></a><span id="l22.13"> 		  $(NULL)</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15"> ifdef MOZ_THUNDERBIRD</span>
<a href="#l22.16"></a><span id="l22.16"> REQUIRES	+= xulapp</span>
<a href="#l22.17"></a><span id="l22.17"> endif</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19"> DEFINES += -DMOZ_APP_VERSION=&quot;$(MOZ_APP_VERSION)&quot;</span>
<a href="#l22.20"></a><span id="l22.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -31,31 +31,29 @@</span>
<a href="#l23.4"></a><span id="l23.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l23.5"></a><span id="l23.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l23.6"></a><span id="l23.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l23.7"></a><span id="l23.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l23.8"></a><span id="l23.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l23.9"></a><span id="l23.9">  *</span>
<a href="#l23.10"></a><span id="l23.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-#include &quot;msgCore.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l23.14"></a><span id="l23.14"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l23.15"></a><span id="l23.15"> #include &quot;nsEscape.h&quot;</span>
<a href="#l23.16"></a><span id="l23.16"> #include &quot;nsSmtpServer.h&quot;</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-#include &quot;nsIObserverService.h&quot;</span>
<a href="#l23.18"></a><span id="l23.18"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l23.19"></a><span id="l23.19"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-#include &quot;nsISmtpUrl.h&quot;</span>
<a href="#l23.22"></a><span id="l23.22"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l23.23"></a><span id="l23.23"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l23.24"></a><span id="l23.24"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l23.25"></a><span id="l23.25"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l23.26"></a><span id="l23.26"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+#include &quot;nsILoginInfo.h&quot;</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+#include &quot;nsILoginManager.h&quot;</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30"> NS_IMPL_ADDREF(nsSmtpServer)</span>
<a href="#l23.31"></a><span id="l23.31"> NS_IMPL_RELEASE(nsSmtpServer)</span>
<a href="#l23.32"></a><span id="l23.32"> NS_INTERFACE_MAP_BEGIN(nsSmtpServer)</span>
<a href="#l23.33"></a><span id="l23.33">     NS_INTERFACE_MAP_ENTRY(nsISmtpServer)</span>
<a href="#l23.34"></a><span id="l23.34">     NS_INTERFACE_MAP_ENTRY(nsISupportsWeakReference)</span>
<a href="#l23.35"></a><span id="l23.35">     NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsISmtpServer)</span>
<a href="#l23.36"></a><span id="l23.36"> NS_INTERFACE_MAP_END</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineat">@@ -448,25 +446,30 @@ nsSmtpServer::GetPasswordWithUI(const PR</span>
<a href="#l23.38"></a><span id="l23.38">         if (NS_SUCCEEDED(rv))</span>
<a href="#l23.39"></a><span id="l23.39">         {</span>
<a href="#l23.40"></a><span id="l23.40">             nsString uniPassword;</span>
<a href="#l23.41"></a><span id="l23.41">             PRBool okayValue = PR_TRUE;</span>
<a href="#l23.42"></a><span id="l23.42">             nsCString serverUri;</span>
<a href="#l23.43"></a><span id="l23.43">             rv = GetServerURI(serverUri);</span>
<a href="#l23.44"></a><span id="l23.44">             if (NS_FAILED(rv))</span>
<a href="#l23.45"></a><span id="l23.45">                 return rv;</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+</span>
<a href="#l23.47"></a><span id="l23.47">             nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+            NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+</span>
<a href="#l23.50"></a><span id="l23.50">             PRBool passwordProtectLocalCache = PR_FALSE;</span>
<a href="#l23.51"></a><span id="l23.51"> </span>
<a href="#l23.52"></a><span id="l23.52" class="difflineminus">-            (void) prefBranch-&gt;GetBoolPref( &quot;mail.password_protect_local_cache&quot;, &amp;passwordProtectLocalCache);</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+            (void) prefBranch-&gt;GetBoolPref(&quot;mail.password_protect_local_cache&quot;,</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineplus">+                                           &amp;passwordProtectLocalCache);</span>
<a href="#l23.55"></a><span id="l23.55"> </span>
<a href="#l23.56"></a><span id="l23.56" class="difflineminus">-            PRUint32 savePasswordType = (passwordProtectLocalCache) ? nsIAuthPrompt::SAVE_PASSWORD_FOR_SESSION : nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY;</span>
<a href="#l23.57"></a><span id="l23.57">             rv = aDialog-&gt;PromptPassword(aPromptTitle, aPromptMessage,</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineminus">-                    NS_ConvertASCIItoUTF16(serverUri).get(), savePasswordType,</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineminus">-                    getter_Copies(uniPassword), &amp;okayValue);</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineplus">+              NS_ConvertASCIItoUTF16(serverUri).get(),</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineplus">+              passwordProtectLocalCache ? nsIAuthPrompt::SAVE_PASSWORD_NEVER</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+                                        : nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineplus">+              getter_Copies(uniPassword), &amp;okayValue);</span>
<a href="#l23.64"></a><span id="l23.64">             if (NS_FAILED(rv))</span>
<a href="#l23.65"></a><span id="l23.65">                 return rv;</span>
<a href="#l23.66"></a><span id="l23.66"> </span>
<a href="#l23.67"></a><span id="l23.67">             if (!okayValue) // if the user pressed cancel, just return NULL;</span>
<a href="#l23.68"></a><span id="l23.68">             {</span>
<a href="#l23.69"></a><span id="l23.69">                 aPassword.Truncate();</span>
<a href="#l23.70"></a><span id="l23.70">                 return rv;</span>
<a href="#l23.71"></a><span id="l23.71">             }</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineat">@@ -500,19 +503,30 @@ nsSmtpServer::GetUsernamePasswordWithUI(</span>
<a href="#l23.73"></a><span id="l23.73">         {</span>
<a href="#l23.74"></a><span id="l23.74">             nsString uniUsername;</span>
<a href="#l23.75"></a><span id="l23.75">             nsString uniPassword;</span>
<a href="#l23.76"></a><span id="l23.76">             PRBool okayValue = PR_TRUE;</span>
<a href="#l23.77"></a><span id="l23.77">             nsCString serverUri;</span>
<a href="#l23.78"></a><span id="l23.78">             rv = GetServerURI(serverUri);</span>
<a href="#l23.79"></a><span id="l23.79">             if (NS_FAILED(rv))</span>
<a href="#l23.80"></a><span id="l23.80">                 return rv;</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineplus">+</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineplus">+            nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineplus">+            NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineplus">+</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineplus">+            PRBool passwordProtectLocalCache = PR_FALSE;</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineplus">+</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineplus">+            (void) prefBranch-&gt;GetBoolPref(&quot;mail.password_protect_local_cache&quot;,</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineplus">+                                           &amp;passwordProtectLocalCache);</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineplus">+</span>
<a href="#l23.90"></a><span id="l23.90">             rv = aDialog-&gt;PromptUsernameAndPassword(aPromptTitle, aPromptMessage,</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-                                         NS_ConvertASCIItoUTF16(serverUri).get(), nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-                                         getter_Copies(uniUsername), getter_Copies(uniPassword), &amp;okayValue);</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+              NS_ConvertASCIItoUTF16(serverUri).get(),</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineplus">+              passwordProtectLocalCache ? nsIAuthPrompt::SAVE_PASSWORD_NEVER</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineplus">+                                        : nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineplus">+              getter_Copies(uniUsername), getter_Copies(uniPassword), &amp;okayValue);</span>
<a href="#l23.97"></a><span id="l23.97">             if (NS_FAILED(rv))</span>
<a href="#l23.98"></a><span id="l23.98">                 return rv;</span>
<a href="#l23.99"></a><span id="l23.99"> </span>
<a href="#l23.100"></a><span id="l23.100">             if (!okayValue) // if the user pressed cancel, just return NULL;</span>
<a href="#l23.101"></a><span id="l23.101">             {</span>
<a href="#l23.102"></a><span id="l23.102">               aUsername.Truncate();</span>
<a href="#l23.103"></a><span id="l23.103">               aPassword.Truncate();</span>
<a href="#l23.104"></a><span id="l23.104">               return rv;</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineat">@@ -537,47 +551,74 @@ nsSmtpServer::GetUsernamePasswordWithUI(</span>
<a href="#l23.106"></a><span id="l23.106">     if (NS_FAILED(rv))</span>
<a href="#l23.107"></a><span id="l23.107">         return rv;</span>
<a href="#l23.108"></a><span id="l23.108">     return GetPassword(aPassword);</span>
<a href="#l23.109"></a><span id="l23.109"> }</span>
<a href="#l23.110"></a><span id="l23.110"> </span>
<a href="#l23.111"></a><span id="l23.111"> NS_IMETHODIMP</span>
<a href="#l23.112"></a><span id="l23.112"> nsSmtpServer::ForgetPassword()</span>
<a href="#l23.113"></a><span id="l23.113"> {</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineminus">-    nsresult rv;</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineminus">-    nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineplus">+  nsresult rv;</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+  nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineplus">+    do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineplus">+</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineplus">+  // Get the current server URI without the username</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineplus">+  nsCAutoString serverUri(NS_LITERAL_CSTRING(&quot;smtp://&quot;));</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineplus">+</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineplus">+  nsCString hostname;</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineplus">+  rv = GetHostname(hostname);</span>
<a href="#l23.127"></a><span id="l23.127"> </span>
<a href="#l23.128"></a><span id="l23.128" class="difflineminus">-    nsCString serverUri;</span>
<a href="#l23.129"></a><span id="l23.129" class="difflineminus">-    rv = GetServerURI(serverUri);</span>
<a href="#l23.130"></a><span id="l23.130" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l23.131"></a><span id="l23.131" class="difflineminus">-        return rv;</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineplus">+  if (NS_SUCCEEDED(rv) &amp;&amp; !hostname.IsEmpty()) {</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineplus">+    nsCString escapedHostname;</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineplus">+    *((char **)getter_Copies(escapedHostname)) =</span>
<a href="#l23.135"></a><span id="l23.135" class="difflineplus">+      nsEscape(hostname.get(), url_Path);</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineplus">+    // not all servers have a hostname</span>
<a href="#l23.137"></a><span id="l23.137" class="difflineplus">+    serverUri.Append(escapedHostname);</span>
<a href="#l23.138"></a><span id="l23.138" class="difflineplus">+  }</span>
<a href="#l23.139"></a><span id="l23.139" class="difflineplus">+</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineplus">+  PRUint32 count;</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineplus">+  nsILoginInfo** logins;</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineplus">+</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineplus">+  NS_ConvertUTF8toUTF16 currServer(serverUri);</span>
<a href="#l23.144"></a><span id="l23.144"> </span>
<a href="#l23.145"></a><span id="l23.145" class="difflineminus">-    nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l23.146"></a><span id="l23.146" class="difflineminus">-    NS_NewURI(getter_AddRefs(uri), serverUri);</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineplus">+  nsCString serverCUsername;</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineplus">+  rv = GetUsername(serverCUsername);</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.150"></a><span id="l23.150"> </span>
<a href="#l23.151"></a><span id="l23.151" class="difflineminus">-    //this is need to make sure wallet service has been created</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineminus">-    rv = CreateServicesForPasswordManager();</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineplus">+  NS_ConvertUTF8toUTF16 serverUsername(serverCUsername);</span>
<a href="#l23.155"></a><span id="l23.155" class="difflineplus">+</span>
<a href="#l23.156"></a><span id="l23.156" class="difflineplus">+  rv = loginMgr-&gt;FindLogins(&amp;count, currServer, EmptyString(),</span>
<a href="#l23.157"></a><span id="l23.157" class="difflineplus">+                            currServer, &amp;logins);</span>
<a href="#l23.158"></a><span id="l23.158" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.159"></a><span id="l23.159"> </span>
<a href="#l23.160"></a><span id="l23.160" class="difflineminus">-    rv = observerService-&gt;NotifyObservers(uri, &quot;login-failed&quot;, nsnull);</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineplus">+  // There should only be one-login stored for this url, however just in case</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineplus">+  // there isn't.</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineplus">+  nsString username;</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineplus">+  for (PRUint32 i = 0; i &lt; count; ++i)</span>
<a href="#l23.166"></a><span id="l23.166" class="difflineplus">+  {</span>
<a href="#l23.167"></a><span id="l23.167" class="difflineplus">+    if (NS_SUCCEEDED(logins[i]-&gt;GetUsername(username)) &amp;&amp;</span>
<a href="#l23.168"></a><span id="l23.168" class="difflineplus">+        username.Equals(serverUsername))</span>
<a href="#l23.169"></a><span id="l23.169" class="difflineplus">+    {</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineplus">+      // If this fails, just continue, we'll still want to remove the password</span>
<a href="#l23.171"></a><span id="l23.171" class="difflineplus">+      // from our local cache.</span>
<a href="#l23.172"></a><span id="l23.172" class="difflineplus">+      loginMgr-&gt;RemoveLogin(logins[i]);</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineplus">+    }</span>
<a href="#l23.174"></a><span id="l23.174" class="difflineplus">+  }</span>
<a href="#l23.175"></a><span id="l23.175" class="difflineplus">+  NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l23.176"></a><span id="l23.176"> </span>
<a href="#l23.177"></a><span id="l23.177" class="difflineminus">-    rv = SetPassword(EmptyCString());</span>
<a href="#l23.178"></a><span id="l23.178" class="difflineminus">-    m_logonFailed = PR_TRUE;</span>
<a href="#l23.179"></a><span id="l23.179" class="difflineminus">-    return rv;</span>
<a href="#l23.180"></a><span id="l23.180" class="difflineplus">+  rv = SetPassword(EmptyCString());</span>
<a href="#l23.181"></a><span id="l23.181" class="difflineplus">+  m_logonFailed = PR_TRUE;</span>
<a href="#l23.182"></a><span id="l23.182" class="difflineplus">+  return rv;</span>
<a href="#l23.183"></a><span id="l23.183"> }</span>
<a href="#l23.184"></a><span id="l23.184"> </span>
<a href="#l23.185"></a><span id="l23.185"> NS_IMETHODIMP</span>
<a href="#l23.186"></a><span id="l23.186"> nsSmtpServer::GetServerURI(nsACString &amp;aResult)</span>
<a href="#l23.187"></a><span id="l23.187"> {</span>
<a href="#l23.188"></a><span id="l23.188" class="difflineminus">-    nsCAutoString uri;</span>
<a href="#l23.189"></a><span id="l23.189" class="difflineminus">-</span>
<a href="#l23.190"></a><span id="l23.190" class="difflineminus">-    uri.AssignLiteral(&quot;smtp&quot;);</span>
<a href="#l23.191"></a><span id="l23.191" class="difflineminus">-    uri.AppendLiteral(&quot;://&quot;);</span>
<a href="#l23.192"></a><span id="l23.192" class="difflineplus">+    nsCAutoString uri(NS_LITERAL_CSTRING(&quot;smtp://&quot;));</span>
<a href="#l23.193"></a><span id="l23.193"> </span>
<a href="#l23.194"></a><span id="l23.194">     nsCString username;</span>
<a href="#l23.195"></a><span id="l23.195">     nsresult rv = GetUsername(username);</span>
<a href="#l23.196"></a><span id="l23.196"> </span>
<a href="#l23.197"></a><span id="l23.197">     if (NS_SUCCEEDED(rv) &amp;&amp; !username.IsEmpty()) {</span>
<a href="#l23.198"></a><span id="l23.198">         nsCString escapedUsername;</span>
<a href="#l23.199"></a><span id="l23.199">         MsgEscapeString(username, nsINetUtil::ESCAPE_XALPHAS, escapedUsername);</span>
<a href="#l23.200"></a><span id="l23.200">         // not all servers have a username</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPassword2.js</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,67 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+/**</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+ * Extra tests for SMTP passwords (forgetPassword)</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+ */</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+const kUser1 = &quot;testsmtp&quot;;</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+const kUser2 = &quot;testsmtpa&quot;;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+const kProtocol = &quot;smtp&quot;;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+const kHostname = &quot;localhost&quot;;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+const kServerUrl = kProtocol + &quot;://&quot; + kHostname;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+function run_test()</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+{</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+  // Login Manager</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+  var loginMgr = Cc[&quot;@mozilla.org/login-manager;1&quot;].getService(Ci.nsILoginManager);</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+  // Passwords File (generated from Mozilla 1.8 branch).</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+  var signons = do_get_file(&quot;../mailnews/test/data/signons-mailnews1.8-multiple.txt&quot;);</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+  // Copy the file to the profile directory for a PAB</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+  signons.copyTo(gProfileDir, &quot;signons.txt&quot;);</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+  // Set up the basic accounts and folders.</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+  loadLocalMailAccount();</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+  var smtpServer1 = getBasicSmtpServer();</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+  var smtpServer2 = getBasicSmtpServer();</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+  smtpServer1.authMethod = 1;</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+  smtpServer1.username = kUser1;</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+  smtpServer2.authMethod = 1;</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+  smtpServer2.username = kUser2;</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+  var i;</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+  var count = {};</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+  // Test - Check there are two logins to begin with.</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+  var logins = loginMgr.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+  do_check_eq(count.value, 2);</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+  // These will either be one way around or the other.</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+  if (logins[0].username == kUser1) {</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+    do_check_eq(logins[1].username, kUser2);</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+  } else {</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+    do_check_eq(logins[0].username, kUser2);</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+    do_check_eq(logins[1].username, kUser1);</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+  }</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+  // Test - Remove a login via the incoming server</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+  smtpServer1.forgetPassword();</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+  logins = logins = loginMgr.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+  // should be one login left for kUser2</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+  do_check_eq(count.value, 1);</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+  do_check_eq(logins[0].username, kUser2);</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+  // Test - Remove the other login via the incoming server</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineplus">+  smtpServer2.forgetPassword();</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineplus">+</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineplus">+  logins = logins = loginMgr.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineplus">+</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineplus">+  // should be one login left for kUser2</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineplus">+  do_check_eq(count.value, 0);</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+  do_check_eq(logins.length, 0);</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -2045,17 +2045,24 @@ NS_IMETHODIMP nsImapIncomingServer::Rese</span>
<a href="#l25.4"></a><span id="l25.4">   }</span>
<a href="#l25.5"></a><span id="l25.5">   return rv;</span>
<a href="#l25.6"></a><span id="l25.6"> }</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> NS_IMETHODIMP nsImapIncomingServer::SetUserAuthenticated(PRBool aUserAuthenticated)</span>
<a href="#l25.9"></a><span id="l25.9"> {</span>
<a href="#l25.10"></a><span id="l25.10">   m_userAuthenticated = aUserAuthenticated;</span>
<a href="#l25.11"></a><span id="l25.11">   if (aUserAuthenticated)</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    StorePassword();</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  {</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+    nsresult rv;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+    nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+      do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+    accountManager-&gt;SetUserNeedsToAuthenticate(PR_FALSE);</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineplus">+  }</span>
<a href="#l25.21"></a><span id="l25.21">   return NS_OK;</span>
<a href="#l25.22"></a><span id="l25.22"> }</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24"> NS_IMETHODIMP nsImapIncomingServer::GetUserAuthenticated(PRBool *aUserAuthenticated)</span>
<a href="#l25.25"></a><span id="l25.25"> {</span>
<a href="#l25.26"></a><span id="l25.26">   NS_ENSURE_ARG_POINTER(aUserAuthenticated);</span>
<a href="#l25.27"></a><span id="l25.27">   *aUserAuthenticated = m_userAuthenticated;</span>
<a href="#l25.28"></a><span id="l25.28">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -764,36 +764,21 @@ NS_IMETHODIMP nsImapMailFolder::UpdateFo</span>
<a href="#l26.4"></a><span id="l26.4">   {</span>
<a href="#l26.5"></a><span id="l26.5">     if (hasOfflineEvents)</span>
<a href="#l26.6"></a><span id="l26.6">     {</span>
<a href="#l26.7"></a><span id="l26.7">       nsImapOfflineSync *goOnline = new nsImapOfflineSync(msgWindow, this, this);</span>
<a href="#l26.8"></a><span id="l26.8">       if (goOnline)</span>
<a href="#l26.9"></a><span id="l26.9">         return goOnline-&gt;ProcessNextOperation();</span>
<a href="#l26.10"></a><span id="l26.10">     }</span>
<a href="#l26.11"></a><span id="l26.11">   }</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  else // we're offline - check if we're password protecting the offline store</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-    nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-    PRBool userNeedsToAuthenticate = PR_FALSE;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-    // if we're PasswordProtectLocalCache, then we need to find out if the server is authenticated.</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-    (void) accountManager-&gt;GetUserNeedsToAuthenticate(&amp;userNeedsToAuthenticate);</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-    if (userNeedsToAuthenticate)</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-    {</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-      nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-      rv = GetServer(getter_AddRefs(server));</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">-      {</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineminus">-        PRBool passwordMatches = PR_FALSE;</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-        rv = PromptForCachePassword(server, msgWindow, passwordMatches);</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-        if (!passwordMatches)</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-          return NS_ERROR_FAILURE;</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-      }</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-    }</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  }</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+  // Check it we're password protecting the local store.</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+  if (!PromptForMasterPasswordIfNecessary())</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+</span>
<a href="#l26.37"></a><span id="l26.37">   if (!canOpenThisFolder)</span>
<a href="#l26.38"></a><span id="l26.38">     selectFolder = PR_FALSE;</span>
<a href="#l26.39"></a><span id="l26.39">   // don't run select if we can't select the folder...</span>
<a href="#l26.40"></a><span id="l26.40">   if (NS_SUCCEEDED(rv) &amp;&amp; !m_urlRunning &amp;&amp; selectFolder)</span>
<a href="#l26.41"></a><span id="l26.41">   {</span>
<a href="#l26.42"></a><span id="l26.42">     nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l26.43"></a><span id="l26.43">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.44"></a><span id="l26.44"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -8759,17 +8759,20 @@ NS_IMETHODIMP nsImapMockChannel::SetSecu</span>
<a href="#l27.4"></a><span id="l27.4"> }</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.7"></a><span id="l27.7"> // From nsIRequest</span>
<a href="#l27.8"></a><span id="l27.8"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10"> NS_IMETHODIMP nsImapMockChannel::GetName(nsACString &amp;result)</span>
<a href="#l27.11"></a><span id="l27.11"> {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  if (m_url)</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+    return m_url-&gt;GetSpec(result);</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+  result.Truncate();</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+  return NS_OK;</span>
<a href="#l27.17"></a><span id="l27.17"> }</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19"> NS_IMETHODIMP nsImapMockChannel::IsPending(PRBool *result)</span>
<a href="#l27.20"></a><span id="l27.20"> {</span>
<a href="#l27.21"></a><span id="l27.21">     *result = m_channelListener != nsnull;</span>
<a href="#l27.22"></a><span id="l27.22">     return NS_OK;</span>
<a href="#l27.23"></a><span id="l27.23"> }</span>
<a href="#l27.24"></a><span id="l27.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -592,48 +592,19 @@ NS_IMETHODIMP nsMsgLocalMailFolder::GetD</span>
<a href="#l28.4"></a><span id="l28.4"> }</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6"> NS_IMETHODIMP</span>
<a href="#l28.7"></a><span id="l28.7"> nsMsgLocalMailFolder::UpdateFolder(nsIMsgWindow *aWindow)</span>
<a href="#l28.8"></a><span id="l28.8"> {</span>
<a href="#l28.9"></a><span id="l28.9">   (void) RefreshSizeOnDisk();</span>
<a href="#l28.10"></a><span id="l28.10">   nsresult rv;</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-           do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-  PRBool userNeedsToAuthenticate = PR_FALSE;</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-  // if we're PasswordProtectLocalCache, then we need to find out if the server is authenticated.</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-  (void) accountManager-&gt;GetUserNeedsToAuthenticate(&amp;userNeedsToAuthenticate);</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-  if (userNeedsToAuthenticate)</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">-  {</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">-    rv = GetServer(getter_AddRefs(server));</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, NS_MSG_INVALID_OR_MISSING_SERVER);</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">-    // need to check if this is a pop3 or no mail server to determine which password</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">-    // we should challenge the user with.</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; serverToAuthenticateAgainst;</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-    nsCOMPtr&lt;nsINoIncomingServer&gt; noIncomingServer = do_QueryInterface(server);</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-    if (noIncomingServer)</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-    {</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">-      nsCOMPtr&lt;nsIMsgAccount&gt; defaultAccount;</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-      accountManager-&gt;GetDefaultAccount(getter_AddRefs(defaultAccount));</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-      if (defaultAccount)</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-        defaultAccount-&gt;GetIncomingServer(getter_AddRefs(serverToAuthenticateAgainst));</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-    }</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-    else</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">-      GetServer(getter_AddRefs(serverToAuthenticateAgainst));</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-    if (serverToAuthenticateAgainst)</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">-    {</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineminus">-      PRBool passwordMatches = PR_FALSE;</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-      rv = PromptForCachePassword(serverToAuthenticateAgainst, aWindow, passwordMatches);</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">-      if (!passwordMatches)</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineminus">-    }</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-  }</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+  if (!PromptForMasterPasswordIfNecessary())</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineplus">+</span>
<a href="#l28.47"></a><span id="l28.47">   //If we don't currently have a database, get it.  Otherwise, the folder has been updated (presumably this</span>
<a href="#l28.48"></a><span id="l28.48">   //changes when we download headers when opening inbox).  If it's updated, send NotifyFolderLoaded.</span>
<a href="#l28.49"></a><span id="l28.49">   if(!mDatabase)</span>
<a href="#l28.50"></a><span id="l28.50">     // return of NS_ERROR_NOT_INITIALIZED means running parsing URL</span>
<a href="#l28.51"></a><span id="l28.51">     rv = GetDatabaseWithReparse(this, aWindow, getter_AddRefs(mDatabase));</span>
<a href="#l28.52"></a><span id="l28.52">   else</span>
<a href="#l28.53"></a><span id="l28.53">   {</span>
<a href="#l28.54"></a><span id="l28.54">     PRBool valid;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -103,23 +103,16 @@ nsPop3Sink::~nsPop3Sink()</span>
<a href="#l29.4"></a><span id="l29.4">     NS_IF_RELEASE(m_newMailParser);</span>
<a href="#l29.5"></a><span id="l29.5"> }</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7"> nsresult</span>
<a href="#l29.8"></a><span id="l29.8"> nsPop3Sink::SetUserAuthenticated(PRBool authed)</span>
<a href="#l29.9"></a><span id="l29.9"> {</span>
<a href="#l29.10"></a><span id="l29.10">   m_authed = authed;</span>
<a href="#l29.11"></a><span id="l29.11">   m_popServer-&gt;SetAuthenticated(authed);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  if (authed)</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-  {</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_popServer);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-    if (!server)</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-      return NS_ERROR_UNEXPECTED;</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-    return server-&gt;StorePassword();</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-  }</span>
<a href="#l29.19"></a><span id="l29.19">   return NS_OK;</span>
<a href="#l29.20"></a><span id="l29.20"> }</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22"> nsresult</span>
<a href="#l29.23"></a><span id="l29.23"> nsPop3Sink::GetUserAuthenticated(PRBool* authed)</span>
<a href="#l29.24"></a><span id="l29.24"> {</span>
<a href="#l29.25"></a><span id="l29.25">   return m_popServer-&gt;GetAuthenticated(authed);</span>
<a href="#l29.26"></a><span id="l29.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">new file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- /dev/null</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password3.js</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -0,0 +1,71 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l30.6"></a><span id="l30.6" class="difflineplus">+/**</span>
<a href="#l30.7"></a><span id="l30.7" class="difflineplus">+ * Extra tests for POP3 passwords (forgetPassword)</span>
<a href="#l30.8"></a><span id="l30.8" class="difflineplus">+ */</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineplus">+</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineplus">+const kUser1 = &quot;testpop3&quot;;</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineplus">+const kUser2 = &quot;testpop3a&quot;;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+const kProtocol = &quot;pop3&quot;;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+const kHostname = &quot;localhost&quot;;</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+const kServerUrl = &quot;mailbox://&quot; + kHostname;</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+function run_test()</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+{</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+  // Login Manager</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+  var loginMgr = Cc[&quot;@mozilla.org/login-manager;1&quot;].getService(Ci.nsILoginManager);</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+  // Passwords File (generated from Mozilla 1.8 branch).</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineplus">+  var signons = do_get_file(&quot;../mailnews/test/data/signons-mailnews1.8-multiple.txt&quot;);</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+  // Copy the file to the profile directory for a PAB</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+  signons.copyTo(gProfileDir, &quot;signons.txt&quot;);</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineplus">+</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineplus">+  // Set up the basic accounts and folders.</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineplus">+  // We would use createPop3ServerAndLocalFolders() however we want to have</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+  // a different username and NO password for this test (as we expect to load</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+  // it from signons.txt).</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+  loadLocalMailAccount();</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+  var acctMgr = Cc[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+                  .getService(Ci.nsIMsgAccountManager);</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+  var incomingServer1 = acctMgr.createIncomingServer(kUser1, kHostname,</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+                                                     kProtocol);</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+  var incomingServer2 = acctMgr.createIncomingServer(kUser2, kHostname,</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+                                                     kProtocol);</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+  var i;</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+  var count = {};</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+  // Test - Check there are two logins to begin with.</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+  var logins = loginMgr.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineplus">+</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineplus">+  do_check_eq(count.value, 2);</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineplus">+</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineplus">+  // These will either be one way around or the other.</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineplus">+  if (logins[0].username == kUser1) {</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineplus">+    do_check_eq(logins[1].username, kUser2);</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineplus">+  } else {</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineplus">+    do_check_eq(logins[0].username, kUser2);</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineplus">+    do_check_eq(logins[1].username, kUser1);</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineplus">+  }</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineplus">+  // Test - Remove a login via the incoming server</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+  incomingServer1.forgetPassword();</span>
<a href="#l30.60"></a><span id="l30.60" class="difflineplus">+</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineplus">+ logins = loginMgr.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineplus">+</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineplus">+  // should be one login left for kUser2</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+  do_check_eq(count.value, 1);</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+  do_check_eq(logins[0].username, kUser2);</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+</span>
<a href="#l30.67"></a><span id="l30.67" class="difflineplus">+  // Test - Remove the other login via the incoming server</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineplus">+  incomingServer2.forgetPassword();</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineplus">+</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineplus">+  logins = loginMgr.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l30.71"></a><span id="l30.71" class="difflineplus">+</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineplus">+  // should be one login left for kUser2</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineplus">+  do_check_eq(count.value, 0);</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineplus">+  do_check_eq(logins.length, 0);</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/news/src/Makefile.in</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/news/src/Makefile.in</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -64,16 +64,18 @@ REQUIRES	= xpcom \</span>
<a href="#l31.4"></a><span id="l31.4"> 		  appshell \</span>
<a href="#l31.5"></a><span id="l31.5"> 		  toolkitcomps \</span>
<a href="#l31.6"></a><span id="l31.6"> 		  mime \</span>
<a href="#l31.7"></a><span id="l31.7"> 		  intl \</span>
<a href="#l31.8"></a><span id="l31.8"> 		  rdfutil \</span>
<a href="#l31.9"></a><span id="l31.9"> 		  nkcache \</span>
<a href="#l31.10"></a><span id="l31.10"> 		  windowwatcher \</span>
<a href="#l31.11"></a><span id="l31.11"> 		  unicharutil \</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+		  embed_base \</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+		  loginmgr \</span>
<a href="#l31.14"></a><span id="l31.14"> 		  $(NULL)</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16"> CPPSRCS		= \</span>
<a href="#l31.17"></a><span id="l31.17"> 		nsNNTPArticleList.cpp \</span>
<a href="#l31.18"></a><span id="l31.18"> 		nsNNTPNewsgroupList.cpp \</span>
<a href="#l31.19"></a><span id="l31.19"> 		nsNNTPNewsgroupPost.cpp \</span>
<a href="#l31.20"></a><span id="l31.20"> 		nsNNTPProtocol.cpp \</span>
<a href="#l31.21"></a><span id="l31.21"> 		nsNntpUrl.cpp \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -2655,24 +2655,29 @@ PRInt32 nsNNTPProtocol::BeginAuthorizati</span>
<a href="#l32.4"></a><span id="l32.4">     rv = m_newsFolder-&gt;GetGroupUsername(cachedUsername);</span>
<a href="#l32.5"></a><span id="l32.5"> </span>
<a href="#l32.6"></a><span id="l32.6">   if (NS_FAILED(rv) || cachedUsername.IsEmpty()) {</span>
<a href="#l32.7"></a><span id="l32.7">     rv = NS_OK;</span>
<a href="#l32.8"></a><span id="l32.8">     NNTP_LOG_NOTE(&quot;ask for the news username&quot;);</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">     nsString usernamePromptText;</span>
<a href="#l32.11"></a><span id="l32.11">     GetNewsStringByName(&quot;enterUsername&quot;, getter_Copies(usernamePromptText));</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+    nsString usernamePromptTitleText;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    GetNewsStringByName(&quot;enterUsernameTitle&quot;,</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+                        getter_Copies(usernamePromptTitleText));</span>
<a href="#l32.15"></a><span id="l32.15">     if (m_newsFolder) {</span>
<a href="#l32.16"></a><span id="l32.16">       if (!m_msgWindow) {</span>
<a href="#l32.17"></a><span id="l32.17">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(m_runningURL);</span>
<a href="#l32.18"></a><span id="l32.18">         if (mailnewsurl)</span>
<a href="#l32.19"></a><span id="l32.19">           rv = mailnewsurl-&gt;GetMsgWindow(getter_AddRefs(m_msgWindow));</span>
<a href="#l32.20"></a><span id="l32.20">       }</span>
<a href="#l32.21"></a><span id="l32.21"> </span>
<a href="#l32.22"></a><span id="l32.22" class="difflineminus">-      rv = m_newsFolder-&gt;GetGroupUsernameWithUI(usernamePromptText, EmptyString(), m_msgWindow, username);</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineplus">+      rv = m_newsFolder-&gt;GetGroupUsernameWithUI(usernamePromptText,</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineplus">+                                                usernamePromptTitleText,</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineplus">+                                                m_msgWindow, username);</span>
<a href="#l32.26"></a><span id="l32.26">     }</span>
<a href="#l32.27"></a><span id="l32.27">     else</span>
<a href="#l32.28"></a><span id="l32.28">       return(MK_NNTP_AUTH_FAILED);</span>
<a href="#l32.29"></a><span id="l32.29"> </span>
<a href="#l32.30"></a><span id="l32.30">     if (NS_FAILED(rv)) {</span>
<a href="#l32.31"></a><span id="l32.31">       AlertError(MK_NNTP_AUTH_FAILED, &quot;Aborted by user&quot;);</span>
<a href="#l32.32"></a><span id="l32.32">       return(MK_NNTP_AUTH_FAILED);</span>
<a href="#l32.33"></a><span id="l32.33">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -71,17 +71,16 @@</span>
<a href="#l33.4"></a><span id="l33.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l33.5"></a><span id="l33.5"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-#include &quot;nsIObserverService.h&quot;</span>
<a href="#l33.13"></a><span id="l33.13"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l33.14"></a><span id="l33.14"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l33.15"></a><span id="l33.15"> #include &quot;nsIURL.h&quot;</span>
<a href="#l33.16"></a><span id="l33.16"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l33.17"></a><span id="l33.17"> #include &quot;nsINntpUrl.h&quot;</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l33.20"></a><span id="l33.20"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineat">@@ -91,16 +90,21 @@</span>
<a href="#l33.22"></a><span id="l33.22"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l33.23"></a><span id="l33.23"> #include &quot;nsEscape.h&quot;</span>
<a href="#l33.24"></a><span id="l33.24"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l33.25"></a><span id="l33.25"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l33.26"></a><span id="l33.26"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l33.27"></a><span id="l33.27"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l33.28"></a><span id="l33.28"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l33.29"></a><span id="l33.29"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineplus">+#include &quot;nsILoginInfo.h&quot;</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+#include &quot;nsILoginManager.h&quot;</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+#include &quot;nsIPromptService.h&quot;</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+#include &quot;nsEmbedCID.h&quot;</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+#include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l33.35"></a><span id="l33.35"> </span>
<a href="#l33.36"></a><span id="l33.36"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l33.37"></a><span id="l33.37"> </span>
<a href="#l33.38"></a><span id="l33.38"> // ###tw  This really ought to be the most</span>
<a href="#l33.39"></a><span id="l33.39"> // efficient file reading size for the current</span>
<a href="#l33.40"></a><span id="l33.40"> // operating system.</span>
<a href="#l33.41"></a><span id="l33.41"> #define NEWSRC_FILE_BUFFER_SIZE 1024</span>
<a href="#l33.42"></a><span id="l33.42"> </span>
<a href="#l33.43"></a><span id="l33.43" class="difflineat">@@ -1063,18 +1067,16 @@ nsresult nsMsgNewsFolder::CreateNewsgrou</span>
<a href="#l33.44"></a><span id="l33.44"> nsresult nsMsgNewsFolder::CreateNewsgroupPasswordUrlForSignon(const nsACString&amp; inUriStr, nsACString&amp; result)</span>
<a href="#l33.45"></a><span id="l33.45"> {</span>
<a href="#l33.46"></a><span id="l33.46">   return CreateNewsgroupUrlForSignon(inUriStr, &quot;password&quot;, result);</span>
<a href="#l33.47"></a><span id="l33.47"> }</span>
<a href="#l33.48"></a><span id="l33.48"> </span>
<a href="#l33.49"></a><span id="l33.49"> nsresult nsMsgNewsFolder::CreateNewsgroupUrlForSignon(const nsACString&amp; inUriStr, const char *ref, nsACString&amp; result)</span>
<a href="#l33.50"></a><span id="l33.50"> {</span>
<a href="#l33.51"></a><span id="l33.51">   nsresult rv;</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineminus">-  PRInt32 port = 0;</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineminus">-</span>
<a href="#l33.54"></a><span id="l33.54">   nsCOMPtr&lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l33.55"></a><span id="l33.55">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l33.58"></a><span id="l33.58">   rv = GetServer(getter_AddRefs(server));</span>
<a href="#l33.59"></a><span id="l33.59">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.60"></a><span id="l33.60"> </span>
<a href="#l33.61"></a><span id="l33.61">   nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l33.62"></a><span id="l33.62" class="difflineat">@@ -1094,84 +1096,134 @@ nsresult nsMsgNewsFolder::CreateNewsgrou</span>
<a href="#l33.63"></a><span id="l33.63">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.64"></a><span id="l33.64">   }</span>
<a href="#l33.65"></a><span id="l33.65">   else</span>
<a href="#l33.66"></a><span id="l33.66">   {</span>
<a href="#l33.67"></a><span id="l33.67">     rv = url-&gt;SetSpec(inUriStr);</span>
<a href="#l33.68"></a><span id="l33.68">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.69"></a><span id="l33.69">   }</span>
<a href="#l33.70"></a><span id="l33.70"> </span>
<a href="#l33.71"></a><span id="l33.71" class="difflineplus">+  PRInt32 port = 0;</span>
<a href="#l33.72"></a><span id="l33.72">   rv = url-&gt;GetPort(&amp;port);</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.75"></a><span id="l33.75"> </span>
<a href="#l33.76"></a><span id="l33.76">   if (port &lt;= 0)</span>
<a href="#l33.77"></a><span id="l33.77">   {</span>
<a href="#l33.78"></a><span id="l33.78">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l33.79"></a><span id="l33.79">     rv = GetServer(getter_AddRefs(server));</span>
<a href="#l33.80"></a><span id="l33.80">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.81"></a><span id="l33.81"> </span>
<a href="#l33.82"></a><span id="l33.82">     PRInt32 socketType;</span>
<a href="#l33.83"></a><span id="l33.83">     nsresult rv = server-&gt;GetSocketType(&amp;socketType);</span>
<a href="#l33.84"></a><span id="l33.84">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.85"></a><span id="l33.85"> </span>
<a href="#l33.86"></a><span id="l33.86" class="difflineminus">-    rv = url-&gt;SetPort((socketType == nsIMsgIncomingServer::useSSL) ?</span>
<a href="#l33.87"></a><span id="l33.87" class="difflineminus">-                      nsINntpUrl::DEFAULT_NNTPS_PORT : nsINntpUrl::DEFAULT_NNTP_PORT);</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineplus">+    // Only set this for ssl newsgroups as for non-ssl connections, we don't</span>
<a href="#l33.90"></a><span id="l33.90" class="difflineplus">+    // need to specify the port as it is the default for the protocol and</span>
<a href="#l33.91"></a><span id="l33.91" class="difflineplus">+    // password manager &quot;blanks&quot; those out.</span>
<a href="#l33.92"></a><span id="l33.92" class="difflineplus">+    if (socketType == nsIMsgIncomingServer::useSSL)</span>
<a href="#l33.93"></a><span id="l33.93" class="difflineplus">+    {</span>
<a href="#l33.94"></a><span id="l33.94" class="difflineplus">+      rv = url-&gt;SetPort(nsINntpUrl::DEFAULT_NNTPS_PORT);</span>
<a href="#l33.95"></a><span id="l33.95" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.96"></a><span id="l33.96" class="difflineplus">+    }</span>
<a href="#l33.97"></a><span id="l33.97">   }</span>
<a href="#l33.98"></a><span id="l33.98"> </span>
<a href="#l33.99"></a><span id="l33.99" class="difflineminus">-  rv = url-&gt;SetRef(nsDependentCString(ref));</span>
<a href="#l33.100"></a><span id="l33.100" class="difflineplus">+  if (ref)</span>
<a href="#l33.101"></a><span id="l33.101" class="difflineplus">+  {</span>
<a href="#l33.102"></a><span id="l33.102" class="difflineplus">+    rv = url-&gt;SetRef(nsDependentCString(ref));</span>
<a href="#l33.103"></a><span id="l33.103" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.104"></a><span id="l33.104" class="difflineplus">+</span>
<a href="#l33.105"></a><span id="l33.105" class="difflineplus">+    return url-&gt;GetSpec(result);</span>
<a href="#l33.106"></a><span id="l33.106" class="difflineplus">+  }</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineplus">+</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineplus">+  // If the url doesn't have a path, make sure we don't get a '/' on the end</span>
<a href="#l33.109"></a><span id="l33.109" class="difflineplus">+  // as that will confuse searching in password manager.</span>
<a href="#l33.110"></a><span id="l33.110" class="difflineplus">+  nsCString spec;</span>
<a href="#l33.111"></a><span id="l33.111" class="difflineplus">+  rv = url-&gt;GetSpec(spec);</span>
<a href="#l33.112"></a><span id="l33.112">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.113"></a><span id="l33.113"> </span>
<a href="#l33.114"></a><span id="l33.114" class="difflineminus">-  return url-&gt;GetSpec(result);</span>
<a href="#l33.115"></a><span id="l33.115" class="difflineplus">+  if (!spec.IsEmpty() &amp;&amp; spec[spec.Length() - 1] == '/')</span>
<a href="#l33.116"></a><span id="l33.116" class="difflineplus">+    result = StringHead(spec, spec.Length() - 1);</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineplus">+  else</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineplus">+    result = spec;</span>
<a href="#l33.119"></a><span id="l33.119" class="difflineplus">+</span>
<a href="#l33.120"></a><span id="l33.120" class="difflineplus">+  return NS_OK;</span>
<a href="#l33.121"></a><span id="l33.121"> }</span>
<a href="#l33.122"></a><span id="l33.122"> </span>
<a href="#l33.123"></a><span id="l33.123"> NS_IMETHODIMP nsMsgNewsFolder::ForgetGroupUsername()</span>
<a href="#l33.124"></a><span id="l33.124"> {</span>
<a href="#l33.125"></a><span id="l33.125" class="difflineminus">-  nsresult rv;</span>
<a href="#l33.126"></a><span id="l33.126" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l33.127"></a><span id="l33.127" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.128"></a><span id="l33.128" class="difflineminus">-</span>
<a href="#l33.129"></a><span id="l33.129" class="difflineminus">-  rv = SetGroupUsername(EmptyCString());</span>
<a href="#l33.130"></a><span id="l33.130" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.131"></a><span id="l33.131" class="difflineplus">+  nsCString hostname;</span>
<a href="#l33.132"></a><span id="l33.132" class="difflineplus">+  nsresult rv = CreateNewsgroupUrlForSignon(mURI, nsnull, hostname);</span>
<a href="#l33.133"></a><span id="l33.133" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.134"></a><span id="l33.134"> </span>
<a href="#l33.135"></a><span id="l33.135">   nsCString signonURL;</span>
<a href="#l33.136"></a><span id="l33.136">   rv = CreateNewsgroupUsernameUrlForSignon(mURI, signonURL);</span>
<a href="#l33.137"></a><span id="l33.137" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.138"></a><span id="l33.138" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.139"></a><span id="l33.139"> </span>
<a href="#l33.140"></a><span id="l33.140" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l33.141"></a><span id="l33.141" class="difflineminus">-  NS_NewURI(getter_AddRefs(uri), signonURL);</span>
<a href="#l33.142"></a><span id="l33.142" class="difflineminus">-</span>
<a href="#l33.143"></a><span id="l33.143" class="difflineminus">-  //this is need to make sure wallet service has been created</span>
<a href="#l33.144"></a><span id="l33.144" class="difflineminus">-  rv = CreateServicesForPasswordManager();</span>
<a href="#l33.145"></a><span id="l33.145" class="difflineplus">+  nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l33.146"></a><span id="l33.146" class="difflineplus">+    do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l33.147"></a><span id="l33.147">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.148"></a><span id="l33.148"> </span>
<a href="#l33.149"></a><span id="l33.149" class="difflineminus">-  return observerService-&gt;NotifyObservers(uri, &quot;login-failed&quot;, nsnull);</span>
<a href="#l33.150"></a><span id="l33.150" class="difflineplus">+  PRUint32 count;</span>
<a href="#l33.151"></a><span id="l33.151" class="difflineplus">+  nsILoginInfo** logins;</span>
<a href="#l33.152"></a><span id="l33.152" class="difflineplus">+</span>
<a href="#l33.153"></a><span id="l33.153" class="difflineplus">+  // XXX we don't support multiple logins per news server, so just delete any</span>
<a href="#l33.154"></a><span id="l33.154" class="difflineplus">+  // we find.</span>
<a href="#l33.155"></a><span id="l33.155" class="difflineplus">+  rv = loginMgr-&gt;FindLogins(&amp;count, NS_ConvertASCIItoUTF16(hostname),</span>
<a href="#l33.156"></a><span id="l33.156" class="difflineplus">+                            EmptyString(),</span>
<a href="#l33.157"></a><span id="l33.157" class="difflineplus">+                            NS_ConvertASCIItoUTF16(signonURL), &amp;logins);</span>
<a href="#l33.158"></a><span id="l33.158" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.159"></a><span id="l33.159" class="difflineplus">+</span>
<a href="#l33.160"></a><span id="l33.160" class="difflineplus">+  // There should only be one-login stored for this url, however just in case</span>
<a href="#l33.161"></a><span id="l33.161" class="difflineplus">+  // there isn't.</span>
<a href="#l33.162"></a><span id="l33.162" class="difflineplus">+  for (PRUint32 i = 0; i &lt; count; ++i)</span>
<a href="#l33.163"></a><span id="l33.163" class="difflineplus">+  {</span>
<a href="#l33.164"></a><span id="l33.164" class="difflineplus">+    // If this fails, just continue, we'll still want to remove the password</span>
<a href="#l33.165"></a><span id="l33.165" class="difflineplus">+    // from our local cache.</span>
<a href="#l33.166"></a><span id="l33.166" class="difflineplus">+    loginMgr-&gt;RemoveLogin(logins[i]);</span>
<a href="#l33.167"></a><span id="l33.167" class="difflineplus">+  }</span>
<a href="#l33.168"></a><span id="l33.168" class="difflineplus">+  NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l33.169"></a><span id="l33.169" class="difflineplus">+</span>
<a href="#l33.170"></a><span id="l33.170" class="difflineplus">+  return NS_OK;</span>
<a href="#l33.171"></a><span id="l33.171"> }</span>
<a href="#l33.172"></a><span id="l33.172"> </span>
<a href="#l33.173"></a><span id="l33.173"> NS_IMETHODIMP nsMsgNewsFolder::ForgetGroupPassword()</span>
<a href="#l33.174"></a><span id="l33.174"> {</span>
<a href="#l33.175"></a><span id="l33.175" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l33.176"></a><span id="l33.176" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l33.177"></a><span id="l33.177" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.178"></a><span id="l33.178" class="difflineminus">-</span>
<a href="#l33.179"></a><span id="l33.179" class="difflineminus">-  rv = SetGroupPassword(EmptyCString());</span>
<a href="#l33.180"></a><span id="l33.180" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.181"></a><span id="l33.181" class="difflineplus">+  nsCString hostname;</span>
<a href="#l33.182"></a><span id="l33.182" class="difflineplus">+  nsresult rv = CreateNewsgroupUrlForSignon(mURI, nsnull, hostname);</span>
<a href="#l33.183"></a><span id="l33.183" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.184"></a><span id="l33.184"> </span>
<a href="#l33.185"></a><span id="l33.185">   nsCString signonURL;</span>
<a href="#l33.186"></a><span id="l33.186">   rv = CreateNewsgroupPasswordUrlForSignon(mURI, signonURL);</span>
<a href="#l33.187"></a><span id="l33.187" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.188"></a><span id="l33.188" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.189"></a><span id="l33.189"> </span>
<a href="#l33.190"></a><span id="l33.190" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l33.191"></a><span id="l33.191" class="difflineminus">-  NS_NewURI(getter_AddRefs(uri), signonURL);</span>
<a href="#l33.192"></a><span id="l33.192" class="difflineminus">-</span>
<a href="#l33.193"></a><span id="l33.193" class="difflineminus">-  //this is need to make sure wallet service has been created</span>
<a href="#l33.194"></a><span id="l33.194" class="difflineminus">-  rv = CreateServicesForPasswordManager();</span>
<a href="#l33.195"></a><span id="l33.195" class="difflineplus">+  nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l33.196"></a><span id="l33.196" class="difflineplus">+    do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l33.197"></a><span id="l33.197">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.198"></a><span id="l33.198"> </span>
<a href="#l33.199"></a><span id="l33.199" class="difflineminus">-  return observerService-&gt;NotifyObservers(uri, &quot;login-failed&quot;, nsnull);</span>
<a href="#l33.200"></a><span id="l33.200" class="difflineplus">+  PRUint32 count;</span>
<a href="#l33.201"></a><span id="l33.201" class="difflineplus">+  nsILoginInfo** logins;</span>
<a href="#l33.202"></a><span id="l33.202" class="difflineplus">+</span>
<a href="#l33.203"></a><span id="l33.203" class="difflineplus">+  // XXX we don't support multiple logins per news server, so just delete any</span>
<a href="#l33.204"></a><span id="l33.204" class="difflineplus">+  // we find.</span>
<a href="#l33.205"></a><span id="l33.205" class="difflineplus">+  rv = loginMgr-&gt;FindLogins(&amp;count, NS_ConvertASCIItoUTF16(hostname),</span>
<a href="#l33.206"></a><span id="l33.206" class="difflineplus">+                            EmptyString(),</span>
<a href="#l33.207"></a><span id="l33.207" class="difflineplus">+                            NS_ConvertASCIItoUTF16(signonURL), &amp;logins);</span>
<a href="#l33.208"></a><span id="l33.208" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.209"></a><span id="l33.209" class="difflineplus">+</span>
<a href="#l33.210"></a><span id="l33.210" class="difflineplus">+  // There should only be one-login stored for this url, however just in case</span>
<a href="#l33.211"></a><span id="l33.211" class="difflineplus">+  // there isn't.</span>
<a href="#l33.212"></a><span id="l33.212" class="difflineplus">+  for (PRUint32 i = 0; i &lt; count; ++i)</span>
<a href="#l33.213"></a><span id="l33.213" class="difflineplus">+  {</span>
<a href="#l33.214"></a><span id="l33.214" class="difflineplus">+    // If this fails, just continue, we'll still want to remove the password</span>
<a href="#l33.215"></a><span id="l33.215" class="difflineplus">+    // from our local cache.</span>
<a href="#l33.216"></a><span id="l33.216" class="difflineplus">+    loginMgr-&gt;RemoveLogin(logins[i]);</span>
<a href="#l33.217"></a><span id="l33.217" class="difflineplus">+  }</span>
<a href="#l33.218"></a><span id="l33.218" class="difflineplus">+  NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l33.219"></a><span id="l33.219" class="difflineplus">+</span>
<a href="#l33.220"></a><span id="l33.220" class="difflineplus">+  return SetGroupPassword(EmptyCString());</span>
<a href="#l33.221"></a><span id="l33.221"> }</span>
<a href="#l33.222"></a><span id="l33.222"> </span>
<a href="#l33.223"></a><span id="l33.223"> // change order of subfolders (newsgroups)</span>
<a href="#l33.224"></a><span id="l33.224"> // aOrientation = -1 ... aNewsgroupToMove aRefNewsgroup ...</span>
<a href="#l33.225"></a><span id="l33.225"> // aOrientation =  1 ... aRefNewsgroup aNewsgroupToMove ...</span>
<a href="#l33.226"></a><span id="l33.226"> NS_IMETHODIMP nsMsgNewsFolder::MoveFolder(nsIMsgFolder *aNewsgroupToMove, nsIMsgFolder *aRefNewsgroup, PRInt32 aOrientation)</span>
<a href="#l33.227"></a><span id="l33.227"> {</span>
<a href="#l33.228"></a><span id="l33.228">   // if folders are identical do nothing</span>
<a href="#l33.229"></a><span id="l33.229" class="difflineat">@@ -1335,30 +1387,126 @@ nsMsgNewsFolder::GetGroupUsernameWithUI(</span>
<a href="#l33.230"></a><span id="l33.230">     </span>
<a href="#l33.231"></a><span id="l33.231">     NS_ENSURE_TRUE(dialog, NS_ERROR_FAILURE);</span>
<a href="#l33.232"></a><span id="l33.232"> </span>
<a href="#l33.233"></a><span id="l33.233">     nsString uniGroupUsername;</span>
<a href="#l33.234"></a><span id="l33.234">     PRBool okayValue = PR_TRUE;</span>
<a href="#l33.235"></a><span id="l33.235"> </span>
<a href="#l33.236"></a><span id="l33.236">     nsCString signonURL;</span>
<a href="#l33.237"></a><span id="l33.237">     rv = CreateNewsgroupUsernameUrlForSignon(mURI, signonURL);</span>
<a href="#l33.238"></a><span id="l33.238" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.239"></a><span id="l33.239" class="difflineplus">+    if (NS_FAILED(rv))</span>
<a href="#l33.240"></a><span id="l33.240" class="difflineplus">+      return rv;</span>
<a href="#l33.241"></a><span id="l33.241" class="difflineplus">+</span>
<a href="#l33.242"></a><span id="l33.242" class="difflineplus">+    // This is the hostname without the #username or #password on the end.</span>
<a href="#l33.243"></a><span id="l33.243" class="difflineplus">+    nsCString hostnameURL;</span>
<a href="#l33.244"></a><span id="l33.244" class="difflineplus">+    rv = CreateNewsgroupUrlForSignon(mURI, nsnull, hostnameURL);</span>
<a href="#l33.245"></a><span id="l33.245" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.246"></a><span id="l33.246" class="difflineplus">+</span>
<a href="#l33.247"></a><span id="l33.247" class="difflineplus">+    // Due to the way the new login manager doesn't want to let us save</span>
<a href="#l33.248"></a><span id="l33.248" class="difflineplus">+    // usernames in the password field, unfortunately the way mailnews has</span>
<a href="#l33.249"></a><span id="l33.249" class="difflineplus">+    // worked historically, means we need to do this.</span>
<a href="#l33.250"></a><span id="l33.250" class="difflineplus">+    // So we have to first check manully, then prompt, the save separately if</span>
<a href="#l33.251"></a><span id="l33.251" class="difflineplus">+    // we want to get a value.</span>
<a href="#l33.252"></a><span id="l33.252" class="difflineplus">+    nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l33.253"></a><span id="l33.253" class="difflineplus">+      do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l33.254"></a><span id="l33.254" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.255"></a><span id="l33.255" class="difflineplus">+</span>
<a href="#l33.256"></a><span id="l33.256" class="difflineplus">+    PRUint32 count = 0;</span>
<a href="#l33.257"></a><span id="l33.257" class="difflineplus">+    nsILoginInfo **logins = nsnull;</span>
<a href="#l33.258"></a><span id="l33.258" class="difflineplus">+    rv = loginMgr-&gt;FindLogins(&amp;count, NS_ConvertASCIItoUTF16(hostnameURL),</span>
<a href="#l33.259"></a><span id="l33.259" class="difflineplus">+                              EmptyString(), NS_ConvertASCIItoUTF16(signonURL), &amp;logins);</span>
<a href="#l33.260"></a><span id="l33.260" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.261"></a><span id="l33.261" class="difflineplus">+</span>
<a href="#l33.262"></a><span id="l33.262" class="difflineplus">+    if (count &gt; 0)</span>
<a href="#l33.263"></a><span id="l33.263" class="difflineplus">+    {</span>
<a href="#l33.264"></a><span id="l33.264" class="difflineplus">+      nsString username;</span>
<a href="#l33.265"></a><span id="l33.265" class="difflineplus">+      rv = logins[0]-&gt;GetPassword(username);</span>
<a href="#l33.266"></a><span id="l33.266" class="difflineplus">+</span>
<a href="#l33.267"></a><span id="l33.267" class="difflineplus">+      NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l33.268"></a><span id="l33.268" class="difflineplus">+</span>
<a href="#l33.269"></a><span id="l33.269" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.270"></a><span id="l33.270" class="difflineplus">+</span>
<a href="#l33.271"></a><span id="l33.271" class="difflineplus">+      NS_LossyConvertUTF16toASCII result(username);</span>
<a href="#l33.272"></a><span id="l33.272"> </span>
<a href="#l33.273"></a><span id="l33.273" class="difflineminus">-    rv = dialog-&gt;Prompt(nsString(aPromptTitle).get(), nsString(aPromptMessage).get(),</span>
<a href="#l33.274"></a><span id="l33.274" class="difflineminus">-                        NS_ConvertASCIItoUTF16(signonURL).get(),</span>
<a href="#l33.275"></a><span id="l33.275" class="difflineminus">-                        nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY, NS_ConvertASCIItoUTF16(mPrevUsername).get(),</span>
<a href="#l33.276"></a><span id="l33.276" class="difflineminus">-                        getter_Copies(uniGroupUsername), &amp;okayValue);</span>
<a href="#l33.277"></a><span id="l33.277" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.278"></a><span id="l33.278" class="difflineplus">+      // Just use the first as that is all we should have</span>
<a href="#l33.279"></a><span id="l33.279" class="difflineplus">+      rv = SetGroupUsername(result);</span>
<a href="#l33.280"></a><span id="l33.280" class="difflineplus">+      if (NS_FAILED(rv))</span>
<a href="#l33.281"></a><span id="l33.281" class="difflineplus">+        return rv;</span>
<a href="#l33.282"></a><span id="l33.282" class="difflineplus">+</span>
<a href="#l33.283"></a><span id="l33.283" class="difflineplus">+      mPrevUsername = aGroupUsername = result;</span>
<a href="#l33.284"></a><span id="l33.284" class="difflineplus">+      return NS_OK;</span>
<a href="#l33.285"></a><span id="l33.285" class="difflineplus">+    }</span>
<a href="#l33.286"></a><span id="l33.286" class="difflineplus">+    NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(count, logins);</span>
<a href="#l33.287"></a><span id="l33.287" class="difflineplus">+</span>
<a href="#l33.288"></a><span id="l33.288" class="difflineplus">+</span>
<a href="#l33.289"></a><span id="l33.289" class="difflineplus">+    // No logins, so time to prompt. Toolkit password manager doesn't let us</span>
<a href="#l33.290"></a><span id="l33.290" class="difflineplus">+    // use nsIAuthPrompt.prompt in the way we'd like currently, and it doesn't</span>
<a href="#l33.291"></a><span id="l33.291" class="difflineplus">+    // let us store username-only passwords. So go direct to the dialog and</span>
<a href="#l33.292"></a><span id="l33.292" class="difflineplus">+    // cut out the middle-man.</span>
<a href="#l33.293"></a><span id="l33.293" class="difflineplus">+    nsCOMPtr&lt;nsIPromptService&gt; promptSvc =</span>
<a href="#l33.294"></a><span id="l33.294" class="difflineplus">+      do_GetService(NS_PROMPTSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l33.295"></a><span id="l33.295" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.296"></a><span id="l33.296" class="difflineplus">+</span>
<a href="#l33.297"></a><span id="l33.297" class="difflineplus">+    PRBool saveUsername = PR_FALSE;</span>
<a href="#l33.298"></a><span id="l33.298" class="difflineplus">+</span>
<a href="#l33.299"></a><span id="l33.299" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l33.300"></a><span id="l33.300" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.301"></a><span id="l33.301" class="difflineplus">+</span>
<a href="#l33.302"></a><span id="l33.302" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l33.303"></a><span id="l33.303" class="difflineplus">+    rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l33.304"></a><span id="l33.304" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.305"></a><span id="l33.305" class="difflineplus">+</span>
<a href="#l33.306"></a><span id="l33.306" class="difflineplus">+    nsString saveUsernameText;</span>
<a href="#l33.307"></a><span id="l33.307" class="difflineplus">+    rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;saveUsername&quot;).get(),</span>
<a href="#l33.308"></a><span id="l33.308" class="difflineplus">+                                   getter_Copies(saveUsernameText));</span>
<a href="#l33.309"></a><span id="l33.309" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.310"></a><span id="l33.310" class="difflineplus">+</span>
<a href="#l33.311"></a><span id="l33.311" class="difflineplus">+    rv = promptSvc-&gt;Prompt(nsnull, nsString(aPromptTitle).get(),</span>
<a href="#l33.312"></a><span id="l33.312" class="difflineplus">+                           nsString(aPromptMessage).get(),</span>
<a href="#l33.313"></a><span id="l33.313" class="difflineplus">+                           getter_Copies(uniGroupUsername),</span>
<a href="#l33.314"></a><span id="l33.314" class="difflineplus">+                           saveUsernameText.get(), &amp;saveUsername,</span>
<a href="#l33.315"></a><span id="l33.315" class="difflineplus">+                           &amp;okayValue);</span>
<a href="#l33.316"></a><span id="l33.316" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.317"></a><span id="l33.317"> </span>
<a href="#l33.318"></a><span id="l33.318">     if (!okayValue) // if the user pressed cancel, just return NULL;</span>
<a href="#l33.319"></a><span id="l33.319">     {</span>
<a href="#l33.320"></a><span id="l33.320">       aGroupUsername.Truncate();</span>
<a href="#l33.321"></a><span id="l33.321">       return rv;</span>
<a href="#l33.322"></a><span id="l33.322">     }</span>
<a href="#l33.323"></a><span id="l33.323"> </span>
<a href="#l33.324"></a><span id="l33.324" class="difflineplus">+    if (saveUsername)</span>
<a href="#l33.325"></a><span id="l33.325" class="difflineplus">+    {</span>
<a href="#l33.326"></a><span id="l33.326" class="difflineplus">+      nsCOMPtr&lt;nsILoginInfo&gt; login =</span>
<a href="#l33.327"></a><span id="l33.327" class="difflineplus">+        do_CreateInstance(&quot;@mozilla.org/login-manager/loginInfo;1&quot;, &amp;rv);</span>
<a href="#l33.328"></a><span id="l33.328" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.329"></a><span id="l33.329" class="difflineplus">+</span>
<a href="#l33.330"></a><span id="l33.330" class="difflineplus">+      rv = login-&gt;SetHostname(NS_ConvertASCIItoUTF16(hostnameURL));</span>
<a href="#l33.331"></a><span id="l33.331" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.332"></a><span id="l33.332" class="difflineplus">+</span>
<a href="#l33.333"></a><span id="l33.333" class="difflineplus">+      rv = login-&gt;SetHttpRealm(NS_ConvertASCIItoUTF16(signonURL));</span>
<a href="#l33.334"></a><span id="l33.334" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.335"></a><span id="l33.335" class="difflineplus">+</span>
<a href="#l33.336"></a><span id="l33.336" class="difflineplus">+      rv = login-&gt;SetPassword(uniGroupUsername);</span>
<a href="#l33.337"></a><span id="l33.337" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.338"></a><span id="l33.338" class="difflineplus">+</span>
<a href="#l33.339"></a><span id="l33.339" class="difflineplus">+      // Apparently there is a small difference between empty strings and null</span>
<a href="#l33.340"></a><span id="l33.340" class="difflineplus">+      // strings, but setting these to empty works for us.</span>
<a href="#l33.341"></a><span id="l33.341" class="difflineplus">+      rv = login-&gt;SetUsername(EmptyString());</span>
<a href="#l33.342"></a><span id="l33.342" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.343"></a><span id="l33.343" class="difflineplus">+</span>
<a href="#l33.344"></a><span id="l33.344" class="difflineplus">+      rv = login-&gt;SetUsernameField(EmptyString());</span>
<a href="#l33.345"></a><span id="l33.345" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.346"></a><span id="l33.346" class="difflineplus">+</span>
<a href="#l33.347"></a><span id="l33.347" class="difflineplus">+      rv = login-&gt;SetPasswordField(EmptyString());</span>
<a href="#l33.348"></a><span id="l33.348" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.349"></a><span id="l33.349" class="difflineplus">+</span>
<a href="#l33.350"></a><span id="l33.350" class="difflineplus">+      rv = loginMgr-&gt;AddLogin(login);</span>
<a href="#l33.351"></a><span id="l33.351" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.352"></a><span id="l33.352" class="difflineplus">+    }</span>
<a href="#l33.353"></a><span id="l33.353" class="difflineplus">+</span>
<a href="#l33.354"></a><span id="l33.354">     // we got a username back, remember it</span>
<a href="#l33.355"></a><span id="l33.355">     rv = SetGroupUsername(NS_LossyConvertUTF16toASCII(uniGroupUsername));</span>
<a href="#l33.356"></a><span id="l33.356">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l33.357"></a><span id="l33.357"> </span>
<a href="#l33.358"></a><span id="l33.358">   } // if the password is empty</span>
<a href="#l33.359"></a><span id="l33.359"> </span>
<a href="#l33.360"></a><span id="l33.360">   rv = GetGroupUsername(aGroupUsername);</span>
<a href="#l33.361"></a><span id="l33.361">   mPrevUsername = aGroupUsername;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">new file mode 100644</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineminus">--- /dev/null</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPassword3.js</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineat">@@ -0,0 +1,65 @@</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l34.6"></a><span id="l34.6" class="difflineplus">+/**</span>
<a href="#l34.7"></a><span id="l34.7" class="difflineplus">+ * Extra tests for forgetting newsgroup usernames and passwords.</span>
<a href="#l34.8"></a><span id="l34.8" class="difflineplus">+ */</span>
<a href="#l34.9"></a><span id="l34.9" class="difflineplus">+</span>
<a href="#l34.10"></a><span id="l34.10" class="difflineplus">+do_import_script(&quot;../mailnews/test/resources/mailTestUtils.js&quot;);</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineplus">+</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+const kUsername = &quot;testnews&quot;;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+const kPassword = &quot;newstest&quot;;</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+const kProtocol = &quot;nntp&quot;;</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+const kHostname = &quot;localhost&quot;;</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+const kServerUrl = &quot;news://&quot; + kHostname;</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineplus">+function run_test()</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+{</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineplus">+  // Login Manager</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineplus">+  var loginMgr = Cc[&quot;@mozilla.org/login-manager;1&quot;].getService(Ci.nsILoginManager);</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineplus">+</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineplus">+  // Passwords File (generated from Mozilla 1.8 branch).</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineplus">+  var signons = do_get_file(&quot;../mailnews/test/data/signons-mailnews1.8.txt&quot;);</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineplus">+</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineplus">+  // Copy the file to the profile directory for a PAB</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineplus">+  signons.copyTo(gProfileDir, &quot;signons.txt&quot;);</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineplus">+</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineplus">+  // Set up the basic accounts and folders.</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+  loadLocalMailAccount();</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineplus">+</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+  var acctMgr = Cc[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+                  .getService(Ci.nsIMsgAccountManager);</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineplus">+</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineplus">+  var incomingServer = acctMgr.createIncomingServer(null, kHostname,</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineplus">+                                                    kProtocol);</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineplus">+</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineplus">+  var i;</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineplus">+  var count = {};</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+  // Test - Check there is a password to begin with...</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineplus">+  var logins = loginMgr.findLogins(count, kServerUrl, null,</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineplus">+                                   kServerUrl + &quot;/#password&quot;);</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineplus">+</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineplus">+  do_check_eq(count.value, 1);</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineplus">+  do_check_eq(logins[0].password, kPassword);</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineplus">+</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineplus">+  // ...and a username.</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineplus">+  var logins = loginMgr.findLogins(count, kServerUrl, null,</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineplus">+                                   kServerUrl + &quot;/#username&quot;);</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineplus">+</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineplus">+  do_check_eq(count.value, 1);</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+  do_check_eq(logins[0].password, kUsername);</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineplus">+</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineplus">+  // Test - Remove the news password login via the incoming server</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineplus">+  incomingServer.forgetPassword();</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineplus">+</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineplus">+  logins = logins = loginMgr.findLogins(count, kServerUrl, null,</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineplus">+                                        kServerUrl + &quot;/#password&quot;);</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineplus">+</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineplus">+  // should be no passwords left...</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineplus">+  do_check_eq(count.value, 0);</span>
<a href="#l34.63"></a><span id="l34.63" class="difflineplus">+</span>
<a href="#l34.64"></a><span id="l34.64" class="difflineplus">+  logins = logins = loginMgr.findLogins(count, kServerUrl, null,</span>
<a href="#l34.65"></a><span id="l34.65" class="difflineplus">+                                        kServerUrl + &quot;/#username&quot;);</span>
<a href="#l34.66"></a><span id="l34.66" class="difflineplus">+</span>
<a href="#l34.67"></a><span id="l34.67" class="difflineplus">+  // ...and no usernames left either.</span>
<a href="#l34.68"></a><span id="l34.68" class="difflineplus">+  do_check_eq(count.value, 0);</span>
<a href="#l34.69"></a><span id="l34.69" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">new file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- /dev/null</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ b/mailnews/test/data/signons-mailnews1.8-multiple.txt</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -0,0 +1,26 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineplus">+#2c</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineplus">+.</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineplus">+mailbox://testpop3@localhost</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineplus">+\=username=\</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineplus">+~</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+*\=password=\</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineplus">+~cG9wM3Rlc3Q=</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+.</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+mailbox://testpop3a@localhost</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+\=username=\</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+~</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+*\=password=\</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+~c210cHRlc3Q=</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+.</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+smtp://testsmtp@localhost</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+\=username=\</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+~</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+*\=password=\</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+~c210cHRlc3Q=</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineplus">+.</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineplus">+smtp://testsmtpa@localhost</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+\=username=\</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+~</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+*\=password=\</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+~cG9wM3Rlc3Q=</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineplus">+.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/confvars.sh</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/confvars.sh</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -43,12 +43,12 @@ if [ &quot;$COMM_BUILD&quot; ]; then</span>
<a href="#l36.4"></a><span id="l36.4">   MOZ_LDAP_XPCOM=1</span>
<a href="#l36.5"></a><span id="l36.5"> fi</span>
<a href="#l36.6"></a><span id="l36.6"> MOZ_STATIC_MAIL_BUILD=1</span>
<a href="#l36.7"></a><span id="l36.7"> MOZ_COMPOSER=1</span>
<a href="#l36.8"></a><span id="l36.8"> MOZ_SUITE=1</span>
<a href="#l36.9"></a><span id="l36.9"> MOZ_APP_VERSION=`cat $topsrcdir/$MOZ_BUILD_APP/config/version.txt`</span>
<a href="#l36.10"></a><span id="l36.10"> SEAMONKEY_VERSION=$MOZ_APP_VERSION</span>
<a href="#l36.11"></a><span id="l36.11"> MOZ_NO_XPCOM_OBSOLETE=1</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-MOZ_EXTENSIONS_DEFAULT=&quot; wallet venkman inspector irc gnomevfs reporter&quot;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+MOZ_EXTENSIONS_DEFAULT=&quot; venkman inspector irc gnomevfs reporter&quot;</span>
<a href="#l36.14"></a><span id="l36.14"> MOZ_PLACES=1</span>
<a href="#l36.15"></a><span id="l36.15"> MOZ_UPDATER=1</span>
<a href="#l36.16"></a><span id="l36.16"> MOZ_HELP_VIEWER=1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/installer/removed-files.in</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/installer/removed-files.in</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -72,26 +72,39 @@ components/nsKillAll.js</span>
<a href="#l37.4"></a><span id="l37.4"> components/nsResetPref.js</span>
<a href="#l37.5"></a><span id="l37.5"> components/nsScriptableIO.js</span>
<a href="#l37.6"></a><span id="l37.6"> components/nsSetDefaultBrowser.js</span>
<a href="#l37.7"></a><span id="l37.7"> components/nsSetDefaultMail.js</span>
<a href="#l37.8"></a><span id="l37.8"> components/nsUnsetDefaultMail.js</span>
<a href="#l37.9"></a><span id="l37.9"> components/nsXmlRpcClient.js</span>
<a href="#l37.10"></a><span id="l37.10"> components/progressDlg.xpt</span>
<a href="#l37.11"></a><span id="l37.11"> components/search.xpt</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+components/sigonviewer.xpt</span>
<a href="#l37.13"></a><span id="l37.13"> components/sidebar.xpt</span>
<a href="#l37.14"></a><span id="l37.14"> components/@DLL_PREFIX@srchsvc@DLL_SUFFIX@</span>
<a href="#l37.15"></a><span id="l37.15"> components/suitetypeaheadfind.xpt</span>
<a href="#l37.16"></a><span id="l37.16"> components/@DLL_PREFIX@suitetypeaheadfind@DLL_SUFFIX@</span>
<a href="#l37.17"></a><span id="l37.17"> components/urlwidgt.xpt</span>
<a href="#l37.18"></a><span id="l37.18"> components/util.xpt</span>
<a href="#l37.19"></a><span id="l37.19"> components/venkman-service.js</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+components/@DLL_PREFIX@wallet@DLL_SUFFIX@</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineplus">+components/@DLL_PREFIX@walletviewers@DLL_SUFFIX@</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineplus">+components/wallet.xpt</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineplus">+components/walleteditor.xpt</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+components/walletpreview.xpt</span>
<a href="#l37.25"></a><span id="l37.25"> components/@DLL_PREFIX@xmlextras@DLL_SUFFIX@</span>
<a href="#l37.26"></a><span id="l37.26"> components/winhooks.xpt</span>
<a href="#l37.27"></a><span id="l37.27"> components/xml-rpc.xpt</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+defaults/wallet/VcardSchema.tbl</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+defaults/wallet/FieldSchema.tbl</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineplus">+defaults/wallet/SchemaConcat.tbl</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+defaults/wallet/DistinguishedSchema.tbl</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+defaults/wallet/SchemaStrings.tbl</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineplus">+defaults/wallet/PositionalSchema.tbl</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineplus">+defaults/wallet/StateSchema.tbl</span>
<a href="#l37.35"></a><span id="l37.35"> @DLL_PREFIX@xpistub@DLL_SUFFIX@</span>
<a href="#l37.36"></a><span id="l37.36"> res/cmessage.txt</span>
<a href="#l37.37"></a><span id="l37.37"> LICENSE</span>
<a href="#l37.38"></a><span id="l37.38"> #ifdef XP_WIN</span>
<a href="#l37.39"></a><span id="l37.39"> #ifdef MOZ_MEMORY</span>
<a href="#l37.40"></a><span id="l37.40"> Microsoft.VC80.CRT.manifest</span>
<a href="#l37.41"></a><span id="l37.41"> msvcm80.dll</span>
<a href="#l37.42"></a><span id="l37.42"> msvcp80.dll</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/suite/installer/unix/packages</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/suite/installer/unix/packages</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -185,17 +185,16 @@ bin/components/libremoteservice.so</span>
<a href="#l38.4"></a><span id="l38.4"> bin/components/librdf.so</span>
<a href="#l38.5"></a><span id="l38.5"> bin/components/rdf.xpt</span>
<a href="#l38.6"></a><span id="l38.6"> bin/components/libsatchel.so</span>
<a href="#l38.7"></a><span id="l38.7"> bin/components/libspellchecker.so</span>
<a href="#l38.8"></a><span id="l38.8"> bin/components/satchel.xpt</span>
<a href="#l38.9"></a><span id="l38.9"> bin/components/saxparser.xpt</span>
<a href="#l38.10"></a><span id="l38.10"> bin/components/shistory.xpt</span>
<a href="#l38.11"></a><span id="l38.11"> bin/components/shellservice.xpt</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-bin/components/signonviewer.xpt</span>
<a href="#l38.13"></a><span id="l38.13"> bin/components/spellchecker.xpt</span>
<a href="#l38.14"></a><span id="l38.14"> bin/components/storage.xpt</span>
<a href="#l38.15"></a><span id="l38.15"> bin/components/libstoragecomps.so</span>
<a href="#l38.16"></a><span id="l38.16"> bin/components/libsuite.so</span>
<a href="#l38.17"></a><span id="l38.17"> bin/components/suitebrowser.xpt</span>
<a href="#l38.18"></a><span id="l38.18"> bin/components/suitecommon.xpt</span>
<a href="#l38.19"></a><span id="l38.19"> bin/components/suitemigration.xpt</span>
<a href="#l38.20"></a><span id="l38.20"> bin/components/libsystem-pref.so</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -209,21 +208,16 @@ bin/components/txtsvc.xpt</span>
<a href="#l38.22"></a><span id="l38.22"> bin/components/libuconv.so</span>
<a href="#l38.23"></a><span id="l38.23"> bin/components/uconv.xpt</span>
<a href="#l38.24"></a><span id="l38.24"> bin/components/unicharutil.xpt</span>
<a href="#l38.25"></a><span id="l38.25"> bin/components/libucvmath.so</span>
<a href="#l38.26"></a><span id="l38.26"> bin/components/libuniversalchardet.so</span>
<a href="#l38.27"></a><span id="l38.27"> bin/components/update.xpt</span>
<a href="#l38.28"></a><span id="l38.28"> bin/components/uriloader.xpt</span>
<a href="#l38.29"></a><span id="l38.29"> bin/components/urlformatter.xpt</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-bin/components/libwallet.so</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-bin/components/libwalletviewers.so</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">-bin/components/wallet.xpt</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-bin/components/walleteditor.xpt</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">-bin/components/walletpreview.xpt</span>
<a href="#l38.35"></a><span id="l38.35"> bin/components/webBrowser_core.xpt</span>
<a href="#l38.36"></a><span id="l38.36"> bin/components/webbrowserpersist.xpt</span>
<a href="#l38.37"></a><span id="l38.37"> bin/components/libwebbrwsr.so</span>
<a href="#l38.38"></a><span id="l38.38"> bin/components/webshell_idls.xpt</span>
<a href="#l38.39"></a><span id="l38.39"> bin/components/widget.xpt</span>
<a href="#l38.40"></a><span id="l38.40"> bin/components/libwidget_gtk2.so</span>
<a href="#l38.41"></a><span id="l38.41"> bin/components/libwindowds.so</span>
<a href="#l38.42"></a><span id="l38.42"> bin/components/windowds.xpt</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineat">@@ -276,16 +270,17 @@ bin/components/nsSuiteGlue.js</span>
<a href="#l38.44"></a><span id="l38.44"> bin/components/nsTaggingService.js</span>
<a href="#l38.45"></a><span id="l38.45"> bin/components/nsTypeAheadFind.js</span>
<a href="#l38.46"></a><span id="l38.46"> bin/components/nsTryToClose.js</span>
<a href="#l38.47"></a><span id="l38.47"> bin/components/nsUpdateService.js</span>
<a href="#l38.48"></a><span id="l38.48"> bin/components/nsURLFormatter.js</span>
<a href="#l38.49"></a><span id="l38.49"> bin/components/nsWebHandlerApp.js</span>
<a href="#l38.50"></a><span id="l38.50"> bin/components/pluginGlue.js</span>
<a href="#l38.51"></a><span id="l38.51"> bin/components/storage-Legacy.js</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineplus">+bin/components/storage-mozStorage.js</span>
<a href="#l38.53"></a><span id="l38.53"> bin/components/txEXSLTRegExFunctions.js</span>
<a href="#l38.54"></a><span id="l38.54"> </span>
<a href="#l38.55"></a><span id="l38.55"> ; Modules</span>
<a href="#l38.56"></a><span id="l38.56"> bin/modules/*</span>
<a href="#l38.57"></a><span id="l38.57"> bin/modules/gloda/*</span>
<a href="#l38.58"></a><span id="l38.58"> </span>
<a href="#l38.59"></a><span id="l38.59"> ; Safe Browsing</span>
<a href="#l38.60"></a><span id="l38.60"> </span>
<a href="#l38.61"></a><span id="l38.61" class="difflineat">@@ -351,25 +346,16 @@ bin/extensions/modern@themes.mozilla.org</span>
<a href="#l38.62"></a><span id="l38.62"> bin/extensions/modern@themes.mozilla.org/preview.png</span>
<a href="#l38.63"></a><span id="l38.63"> </span>
<a href="#l38.64"></a><span id="l38.64"> ; Default Preferences</span>
<a href="#l38.65"></a><span id="l38.65"> ; All the pref files must be part of base to prevent migration bugs</span>
<a href="#l38.66"></a><span id="l38.66"> bin/defaults/autoconfig/*</span>
<a href="#l38.67"></a><span id="l38.67"> bin/defaults/pref/*</span>
<a href="#l38.68"></a><span id="l38.68"> bin/greprefs/*</span>
<a href="#l38.69"></a><span id="l38.69"> </span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-; Wallet schemas</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineminus">-bin/defaults/wallet/VcardSchema.tbl</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineminus">-bin/defaults/wallet/FieldSchema.tbl</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-bin/defaults/wallet/SchemaConcat.tbl</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineminus">-bin/defaults/wallet/DistinguishedSchema.tbl</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineminus">-bin/defaults/wallet/SchemaStrings.tbl</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineminus">-bin/defaults/wallet/PositionalSchema.tbl</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineminus">-bin/defaults/wallet/StateSchema.tbl</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineminus">-</span>
<a href="#l38.79"></a><span id="l38.79"> ; LDAP components need to be in the browser for AutoConfig</span>
<a href="#l38.80"></a><span id="l38.80"> bin/libldap60.so</span>
<a href="#l38.81"></a><span id="l38.81"> bin/libldif60.so</span>
<a href="#l38.82"></a><span id="l38.82"> bin/libprldap60.so</span>
<a href="#l38.83"></a><span id="l38.83"> bin/components/libmozldap.so</span>
<a href="#l38.84"></a><span id="l38.84"> bin/components/mozldap.xpt</span>
<a href="#l38.85"></a><span id="l38.85"> bin/components/nsLDAPProtocolHandler.js</span>
<a href="#l38.86"></a><span id="l38.86"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/suite/installer/windows/packages</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/suite/installer/windows/packages</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -187,17 +187,16 @@ bin\components\profile.xpt</span>
<a href="#l39.4"></a><span id="l39.4"> bin\components\proxyObject.xpt</span>
<a href="#l39.5"></a><span id="l39.5"> bin\components\rdf.dll</span>
<a href="#l39.6"></a><span id="l39.6"> bin\components\rdf.xpt</span>
<a href="#l39.7"></a><span id="l39.7"> bin\components\satchel.dll</span>
<a href="#l39.8"></a><span id="l39.8"> bin\components\satchel.xpt</span>
<a href="#l39.9"></a><span id="l39.9"> bin\components\saxparser.xpt</span>
<a href="#l39.10"></a><span id="l39.10"> bin\components\shellservice.xpt</span>
<a href="#l39.11"></a><span id="l39.11"> bin\components\shistory.xpt</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-bin\components\signonviewer.xpt</span>
<a href="#l39.13"></a><span id="l39.13"> bin\components\storage.xpt</span>
<a href="#l39.14"></a><span id="l39.14"> bin\components\strgcmps.dll</span>
<a href="#l39.15"></a><span id="l39.15"> bin\components\suite.dll</span>
<a href="#l39.16"></a><span id="l39.16"> bin\components\suitebrowser.xpt</span>
<a href="#l39.17"></a><span id="l39.17"> bin\components\suitecommon.xpt</span>
<a href="#l39.18"></a><span id="l39.18"> bin\components\suitemigration.xpt</span>
<a href="#l39.19"></a><span id="l39.19"> bin\components\tkautoc.dll</span>
<a href="#l39.20"></a><span id="l39.20"> bin\components\tkitcmps.dll</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineat">@@ -207,20 +206,16 @@ bin\components\txmgr.xpt</span>
<a href="#l39.22"></a><span id="l39.22"> bin\components\txtsvc.xpt</span>
<a href="#l39.23"></a><span id="l39.23"> bin\components\uconv.dll</span>
<a href="#l39.24"></a><span id="l39.24"> bin\components\uconv.xpt</span>
<a href="#l39.25"></a><span id="l39.25"> bin\components\unicharutil.xpt</span>
<a href="#l39.26"></a><span id="l39.26"> bin\components\universalchardet.dll</span>
<a href="#l39.27"></a><span id="l39.27"> bin\components\update.xpt</span>
<a href="#l39.28"></a><span id="l39.28"> bin\components\uriloader.xpt</span>
<a href="#l39.29"></a><span id="l39.29"> bin\components\urlformatter.xpt</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-bin\components\wallet.dll</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-bin\components\wallet.xpt</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineminus">-bin\components\walleteditor.xpt</span>
<a href="#l39.33"></a><span id="l39.33" class="difflineminus">-bin\components\walletpreview.xpt</span>
<a href="#l39.34"></a><span id="l39.34"> bin\components\webBrowser_core.xpt</span>
<a href="#l39.35"></a><span id="l39.35"> bin\components\webbrowserpersist.xpt</span>
<a href="#l39.36"></a><span id="l39.36"> bin\components\webbrwsr.dll</span>
<a href="#l39.37"></a><span id="l39.37"> bin\components\webshell_idls.xpt</span>
<a href="#l39.38"></a><span id="l39.38"> bin\components\widget.xpt</span>
<a href="#l39.39"></a><span id="l39.39"> bin\components\windowds.dll</span>
<a href="#l39.40"></a><span id="l39.40"> bin\components\windowds.xpt</span>
<a href="#l39.41"></a><span id="l39.41"> bin\components\windowwatcher.xpt</span>
<a href="#l39.42"></a><span id="l39.42" class="difflineat">@@ -276,16 +271,17 @@ bin\components\nsSetDefault.js</span>
<a href="#l39.43"></a><span id="l39.43"> bin\components\nsSidebar.js</span>
<a href="#l39.44"></a><span id="l39.44"> bin\components\nsSuiteGlue.js</span>
<a href="#l39.45"></a><span id="l39.45"> bin\components\nsTaggingService.js</span>
<a href="#l39.46"></a><span id="l39.46"> bin\components\nsTypeAheadFind.js</span>
<a href="#l39.47"></a><span id="l39.47"> bin\components\nsUpdateService.js</span>
<a href="#l39.48"></a><span id="l39.48"> bin\components\nsURLFormatter.js</span>
<a href="#l39.49"></a><span id="l39.49"> bin\components\pluginGlue.js</span>
<a href="#l39.50"></a><span id="l39.50"> bin\components\storage-Legacy.js</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineplus">+bin\components\storage-mozStorage.js</span>
<a href="#l39.52"></a><span id="l39.52"> bin\components\txEXSLTRegExFunctions.js</span>
<a href="#l39.53"></a><span id="l39.53"> bin\components\nsAboutAbout.js</span>
<a href="#l39.54"></a><span id="l39.54"> bin\components\nsDefaultCLH.js</span>
<a href="#l39.55"></a><span id="l39.55"> bin\components\nsHandlerService.js</span>
<a href="#l39.56"></a><span id="l39.56"> bin\components\nsWebHandlerApp.js</span>
<a href="#l39.57"></a><span id="l39.57"> </span>
<a href="#l39.58"></a><span id="l39.58"> ; Modules</span>
<a href="#l39.59"></a><span id="l39.59"> bin\modules\*</span>
<a href="#l39.60"></a><span id="l39.60" class="difflineat">@@ -398,23 +394,16 @@ bin\res\charsetalias.properties</span>
<a href="#l39.61"></a><span id="l39.61"> bin\res\charsetData.properties</span>
<a href="#l39.62"></a><span id="l39.62"> bin\res\langGroups.properties</span>
<a href="#l39.63"></a><span id="l39.63"> bin\res\language.properties</span>
<a href="#l39.64"></a><span id="l39.64"> bin\res\wincharset.properties</span>
<a href="#l39.65"></a><span id="l39.65"> bin\res\entityTables\*</span>
<a href="#l39.66"></a><span id="l39.66"> bin\res\dtd\*</span>
<a href="#l39.67"></a><span id="l39.67"> bin\res\fonts\*</span>
<a href="#l39.68"></a><span id="l39.68"> bin\res\html\*</span>
<a href="#l39.69"></a><span id="l39.69" class="difflineminus">-bin\defaults\wallet\VcardSchema.tbl</span>
<a href="#l39.70"></a><span id="l39.70" class="difflineminus">-bin\defaults\wallet\FieldSchema.tbl</span>
<a href="#l39.71"></a><span id="l39.71" class="difflineminus">-bin\defaults\wallet\SchemaConcat.tbl</span>
<a href="#l39.72"></a><span id="l39.72" class="difflineminus">-bin\defaults\wallet\DistinguishedSchema.tbl</span>
<a href="#l39.73"></a><span id="l39.73" class="difflineminus">-bin\defaults\wallet\SchemaStrings.tbl</span>
<a href="#l39.74"></a><span id="l39.74" class="difflineminus">-bin\defaults\wallet\PositionalSchema.tbl</span>
<a href="#l39.75"></a><span id="l39.75" class="difflineminus">-bin\defaults\wallet\StateSchema.tbl</span>
<a href="#l39.76"></a><span id="l39.76"> </span>
<a href="#l39.77"></a><span id="l39.77"> ; MathML, optional for MathML charset conversion</span>
<a href="#l39.78"></a><span id="l39.78"> bin\components\ucvmath.dll</span>
<a href="#l39.79"></a><span id="l39.79"> bin\res\mathml.css</span>
<a href="#l39.80"></a><span id="l39.80"> bin\res\entityTables\mathml20.properties</span>
<a href="#l39.81"></a><span id="l39.81"> bin\res\fonts\mathfont.properties</span>
<a href="#l39.82"></a><span id="l39.82"> bin\res\fonts\mathfontCMEX10.properties</span>
<a href="#l39.83"></a><span id="l39.83"> bin\res\fonts\mathfontCMSY10.properties</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/news.properties</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/news.properties</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -42,16 +42,18 @@ htmlNewsErrorTitle=Error!</span>
<a href="#l40.4"></a><span id="l40.4"> htmlNewsError=&lt;H1&gt;Error!&lt;/H1&gt;newsgroup server responded: </span>
<a href="#l40.5"></a><span id="l40.5"> # LOCALIZATION NOTE ( articleExpired ): In the following item, translate only &quot;Perhaps the article has expired&quot;</span>
<a href="#l40.6"></a><span id="l40.6"> articleExpired=&lt;B&gt;&lt;P&gt;Perhaps the article has expired&lt;/P&gt;&lt;/B&gt;</span>
<a href="#l40.7"></a><span id="l40.7"> removeExpiredArtLinkText=Click here to remove all expired articles</span>
<a href="#l40.8"></a><span id="l40.8"> cancelDisallowed=This message does not appear to be from you.  You may only cancel your own posts, not those made by others.</span>
<a href="#l40.9"></a><span id="l40.9"> cancelConfirm=Are you sure you want to cancel this message?</span>
<a href="#l40.10"></a><span id="l40.10"> messageCancelled=Message cancelled.</span>
<a href="#l40.11"></a><span id="l40.11"> enterUsername=Please enter a username for news server access:</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+enterUsernameTitle=News Server Username Required</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+saveUsername=Use Password Manager to remember this value.</span>
<a href="#l40.14"></a><span id="l40.14"> enterPassword=Please enter a password for news server access:</span>
<a href="#l40.15"></a><span id="l40.15"> enterPasswordTitle=News Server Password Required</span>
<a href="#l40.16"></a><span id="l40.16"> okButtonText=Download</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18"> noNewMessages=There are no new messages on the server.</span>
<a href="#l40.19"></a><span id="l40.19"> downloadingHeaders=Downloading %S of %S headers</span>
<a href="#l40.20"></a><span id="l40.20"> downloadingFilterHeaders=Getting headers for filters: %S (%S/%S)</span>
<a href="#l40.21"></a><span id="l40.21"> downloadingArticles=Downloading articles %S-%S</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

