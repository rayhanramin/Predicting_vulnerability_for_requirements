<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 5390:9c1e65314027b7fa2cf4321f608fb5c036c9565d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9c1e65314027b7fa2cf4321f608fb5c036c9565d" />
<meta property="og:url" content="/comm-central/rev/9c1e65314027b7fa2cf4321f608fb5c036c9565d" />
<meta property="og:description" content="bug 480109 - Provide tests for SeaMonkey sessionstore, r=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9c1e65314027b7fa2cf4321f608fb5c036c9565d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9c1e65314027b7fa2cf4321f608fb5c036c9565d">shortlog</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9c1e65314027b7fa2cf4321f608fb5c036c9565d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d">files</a> |
changeset |
<a href="/comm-central/raw-rev/9c1e65314027b7fa2cf4321f608fb5c036c9565d">raw</a>  | <a href="/comm-central/archive/9c1e65314027b7fa2cf4321f608fb5c036c9565d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=480109">bug 480109</a> - Provide tests for SeaMonkey sessionstore, r=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#105;&#115;&#97;&#107;&#32;&#75;&#104;&#97;&#99;&#104;&#97;&#116;&#114;&#121;&#97;&#110;&#32;&#60;&#109;&#105;&#115;&#97;&#107;&#46;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 06 Apr 2010 18:59:25 +0200</td></tr>

<tr>
 <td>changeset 5390</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9c1e65314027b7fa2cf4321f608fb5c036c9565d">9c1e65314027b7fa2cf4321f608fb5c036c9565d</a></td>
</tr>



<tr>
<td>parent 5389</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c3c85081eef958933d5df37d303f4eaf0a425da1">c3c85081eef958933d5df37d303f4eaf0a425da1</a>
</td>
</tr>

<tr>
<td>child 5391</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34">6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9c1e65314027b7fa2cf4321f608fb5c036c9565d">4158</a></td></tr>
<tr><td>push user</td><td>kairo@kairo.at</td></tr>
<tr><td>push date</td><td class="date age">Tue, 06 Apr 2010 17:00:44 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6bd4bb3b4b5d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34&newProject=comm-central&newRevision=9c1e65314027b7fa2cf4321f608fb5c036c9565d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34&newProject=comm-central&newRevision=9c1e65314027b7fa2cf4321f608fb5c036c9565d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd4bb3b4b5d7ca3096bc3f3fa8f3b1ae6937b34&newProject=comm-central&newRevision=9c1e65314027b7fa2cf4321f608fb5c036c9565d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=480109">480109</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=480109">bug 480109</a> - Provide tests for SeaMonkey sessionstore, r=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/Makefile.in">suite/common/tests/browser/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/Makefile.in">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/Makefile.in">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/Makefile.in">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/Makefile.in">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445.js">suite/common/tests/browser/browser_bug339445.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445_sample.html">suite/common/tests/browser/browser_bug339445_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug339445_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug345898.js">suite/common/tests/browser/browser_bug345898.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug345898.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug345898.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug345898.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug345898.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug345898.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337.js">suite/common/tests/browser/browser_bug346337.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337_sample.html">suite/common/tests/browser/browser_bug346337_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug346337_sample.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug350525.js">suite/common/tests/browser/browser_bug350525.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug350525.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug350525.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug350525.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug350525.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug350525.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug367052.js">suite/common/tests/browser/browser_bug367052.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug367052.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug367052.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug367052.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug367052.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug367052.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug393716.js">suite/common/tests/browser/browser_bug393716.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug393716.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug393716.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug393716.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug393716.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug393716.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470.js">suite/common/tests/browser/browser_bug408470.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470_sample.html">suite/common/tests/browser/browser_bug408470_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug408470_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132.js">suite/common/tests/browser/browser_bug423132.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132_sample.html">suite/common/tests/browser/browser_bug423132_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug423132_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951.js">suite/common/tests/browser/browser_bug447951.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951_sample.html">suite/common/tests/browser/browser_bug447951_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug447951_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug448741.js">suite/common/tests/browser/browser_bug448741.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug448741.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug448741.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug448741.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug448741.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug448741.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908.js">suite/common/tests/browser/browser_bug454908.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908_sample.html">suite/common/tests/browser/browser_bug454908_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug454908_sample.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342.js">suite/common/tests/browser/browser_bug456342.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342_sample.xhtml">suite/common/tests/browser/browser_bug456342_sample.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342_sample.xhtml">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342_sample.xhtml">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342_sample.xhtml">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342_sample.xhtml">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug456342_sample.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug461634.js">suite/common/tests/browser/browser_bug461634.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug461634.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug461634.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug461634.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug461634.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug461634.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206.js">suite/common/tests/browser/browser_bug463206.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206_sample.html">suite/common/tests/browser/browser_bug463206_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug463206_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465215.js">suite/common/tests/browser/browser_bug465215.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465215.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465215.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465215.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465215.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465215.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465223.js">suite/common/tests/browser/browser_bug465223.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465223.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465223.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465223.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465223.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug465223.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937.js">suite/common/tests/browser/browser_bug466937.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937_sample.html">suite/common/tests/browser/browser_bug466937_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug466937_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161.js">suite/common/tests/browser/browser_bug476161.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161_sample.html">suite/common/tests/browser/browser_bug476161_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug476161_sample.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug477657.js">suite/common/tests/browser/browser_bug477657.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug477657.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug477657.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug477657.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug477657.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug477657.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug480893.js">suite/common/tests/browser/browser_bug480893.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug480893.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug480893.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug480893.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug480893.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug480893.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug483330.js">suite/common/tests/browser/browser_bug483330.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug483330.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug483330.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug483330.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug483330.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug483330.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482.js">suite/common/tests/browser/browser_bug485482.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482_sample.html">suite/common/tests/browser/browser_bug485482_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482_sample.html">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482_sample.html">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug485482_sample.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug490040.js">suite/common/tests/browser/browser_bug490040.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug490040.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug490040.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug490040.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug490040.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug490040.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug491168.js">suite/common/tests/browser/browser_bug491168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug491168.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug491168.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug491168.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug491168.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug491168.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug509315.js">suite/common/tests/browser/browser_bug509315.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug509315.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug509315.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug509315.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug514751.js">suite/common/tests/browser/browser_bug514751.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug514751.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug514751.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug514751.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug514751.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug514751.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524345.js">suite/common/tests/browser/browser_bug524345.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524345.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524345.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524345.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524369.js">suite/common/tests/browser/browser_bug524369.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524369.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524369.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524369.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371.js">suite/common/tests/browser/browser_bug524371.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371_sample.html">suite/common/tests/browser/browser_bug524371_sample.html</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371_sample.html">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371_sample.html">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug524371_sample.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug526613.js">suite/common/tests/browser/browser_bug526613.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug526613.js">file</a> |
<a href="/comm-central/annotate/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug526613.js">annotate</a> |
<a href="/comm-central/diff/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug526613.js">diff</a> |
<a href="/comm-central/comparison/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug526613.js">comparison</a> |
<a href="/comm-central/log/9c1e65314027b7fa2cf4321f608fb5c036c9565d/suite/common/tests/browser/browser_bug526613.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/common/tests/browser/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/common/tests/browser/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -40,23 +40,54 @@ topsrcdir	= @top_srcdir@</span>
<a href="#l1.4"></a><span id="l1.4"> srcdir		= @srcdir@</span>
<a href="#l1.5"></a><span id="l1.5"> VPATH		= @srcdir@</span>
<a href="#l1.6"></a><span id="l1.6"> relativesrcdir  = suite/common/tests/browser</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.9"></a><span id="l1.9"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> _BROWSER_FILES = \</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-	browser_bug431826.js \</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-	browser_bug493467.js \</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-	browser_bug509315.js \</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-	browser_bug510890.js \</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-	browser_bug515006.js \</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-	browser_bug524345.js \</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-	browser_bug524369.js \</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-	browser_bug524371.js \</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-	browser_bug524371_sample.html \</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-	browser_bug526613.js \</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+        browser_bug339445.js \</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+        browser_bug339445_sample.html \</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+        browser_bug345898.js \</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+        browser_bug346337.js \</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+        browser_bug346337_sample.html \</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+        browser_bug350525.js \</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+        browser_bug367052.js \</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+        browser_bug393716.js \</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+        browser_bug408470.js \</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+        browser_bug408470_sample.html \</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+        browser_bug423132.js \</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+        browser_bug423132_sample.html \</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+        browser_bug431826.js \</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+        browser_bug447951.js \</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+        browser_bug447951_sample.html \</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+        browser_bug448741.js \</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+        browser_bug454908.js \</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+        browser_bug454908_sample.html \</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+        browser_bug456342.js \</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+        browser_bug456342_sample.xhtml \</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+        browser_bug461634.js \</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+        browser_bug463206.js \</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+        browser_bug463206_sample.html \</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+        browser_bug465215.js \</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+        browser_bug465223.js \</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+        browser_bug466937.js \</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+        browser_bug466937_sample.html \</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+        browser_bug476161.js \</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+        browser_bug476161_sample.html \</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+        browser_bug477657.js \</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+        browser_bug480893.js \</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+        browser_bug483330.js \</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+        browser_bug485482.js \</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+        browser_bug485482_sample.html \</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+        browser_bug490040.js \</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+        browser_bug491168.js \</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        browser_bug493467.js \</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+        browser_bug510890.js \</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+        browser_bug514751.js \</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        browser_bug515006.js \</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+        browser_bug526613.js \</span>
<a href="#l1.63"></a><span id="l1.63">         browser_bug528776.js \</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-	$(NULL)</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+        $(NULL)</span>
<a href="#l1.66"></a><span id="l1.66"> </span>
<a href="#l1.67"></a><span id="l1.67"> libs::	$(_BROWSER_FILES)</span>
<a href="#l1.68"></a><span id="l1.68"> 	$(INSTALL) $(foreach f,$^,&quot;$f&quot;) $(MOZDEPTH)/_tests/testing/mochitest/browser/$(relativesrcdir)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug339445.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,71 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+ *</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+ *</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+ * License.</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+ *</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+ *</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+ *</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+ *</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+ *</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+function test() {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  /** Test for Bug 339445 **/</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+  try {</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+  }</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+  catch (ex) { }</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug339445_sample.html&quot;;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+    let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+    is(doc.getElementById(&quot;storageTestItem&quot;).textContent, &quot;PENDING&quot;,</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+       &quot;sessionStorage value has been set&quot;);</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+      let doc2 = tab2.linkedBrowser.contentDocument;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+      is(doc2.getElementById(&quot;storageTestItem&quot;).textContent, &quot;SUCCESS&quot;,</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+         &quot;sessionStorage value has been duplicated&quot;);</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      // clean up</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+      gBrowser.removeTab(tab2);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+      gBrowser.removeTab(tab);</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+      finish();</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    }, true);</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  }, true);</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug339445_sample.html</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,17 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+&lt;title&gt;Test for bug 339445&lt;/title&gt;</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+storageTestItem = &lt;span id=&quot;storageTestItem&quot;&gt;FAIL&lt;/span&gt;</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+&lt;!--</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+  storageTestItem's textContent will be one of the following:</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  * FAIL    : sessionStorage wasn't available</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  * PENDING : the test value has been initialized on first load</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  * SUCCESS : the test value was correctly retrieved</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+--&gt;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+&lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  document.getElementById(&quot;storageTestItem&quot;).textContent =</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+    sessionStorage[&quot;storageTestItem&quot;] || &quot;PENDING&quot;;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+  sessionStorage[&quot;storageTestItem&quot;] = &quot;SUCCESS&quot;;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+&lt;/script&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug345898.js</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,85 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+ *</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+ *</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+ * License.</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+ *</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+ *</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+ *</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+ *</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+ *</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+function test() {</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  /** Test for Bug 345898 **/</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+  </span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+  function test(aLambda) {</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+    try {</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+      aLambda();</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+      return false;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+    }</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+    catch (ex) {</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+      return ex.name == &quot;NS_ERROR_ILLEGAL_VALUE&quot;;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+    }</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+  }</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+  </span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+  </span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+  // all of the following calls with illegal arguments should throw NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+  ok(test(function() ss.getWindowState({})),</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+     &quot;Invalid window for getWindowState throws&quot;);</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+  ok(test(function() ss.setWindowState({}, &quot;&quot;, false)),</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+     &quot;Invalid window for setWindowState throws&quot;);</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+  ok(test(function() ss.getTabState({})),</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+     &quot;Invalid tab for getTabState throws&quot;);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+  ok(test(function() ss.setTabState({}, &quot;{}&quot;)),</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+     &quot;Invalid tab state for setTabState throws&quot;);</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+  ok(test(function() ss.setTabState({}, '{ &quot;entries&quot;: [] }')),</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+     &quot;Invalid tab for setTabState throws&quot;);</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+  ok(test(function() ss.duplicateTab({}, {})),</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+     &quot;Invalid tab for duplicateTab throws&quot;);</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+  ok(test(function() ss.duplicateTab({}, getBrowser().selectedTab)),</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+     &quot;Invalid window for duplicateTab throws&quot;);</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+  ok(test(function() ss.getClosedTabData({})),</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+     &quot;Invalid window for getClosedTabData throws&quot;);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+  ok(test(function() ss.undoCloseTab({}, 0)),</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+     &quot;Invalid window for undoCloseTab throws&quot;);</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+  ok(test(function() ss.undoCloseTab(window, -1)),</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+     &quot;Invalid index for undoCloseTab throws&quot;);</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+  ok(test(function() ss.getWindowValue({}, &quot;&quot;)),</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+     &quot;Invalid window for getWindowValue throws&quot;);</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+  ok(test(function() ss.getWindowValue({}, &quot;&quot;)),</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+     &quot;Invalid window for getWindowValue throws&quot;);</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+  ok(test(function() ss.getWindowValue({}, &quot;&quot;, &quot;&quot;)),</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+     &quot;Invalid window for setWindowValue throws&quot;);</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+  ok(test(function() ss.deleteWindowValue({}, &quot;&quot;)),</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+     &quot;Invalid window for deleteWindowValue throws&quot;);</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+  ok(test(function() ss.deleteWindowValue(window, Date.now().toString())),</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+     &quot;Nonexistent value for deleteWindowValue throws&quot;);</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+  ok(test(function() ss.deleteTabValue(getBrowser().selectedTab, Date.now().toString())),</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+     &quot;Nonexistent value for deleteTabValue throws&quot;);</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug346337.js</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,154 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+ *</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+ *</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+ * License.</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+ *</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+ *</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+ *</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+ *</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+ *</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+function test() {</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+  /** Test for Bug 346337 **/</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+  </span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+  try {</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+  }</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+  catch (ex) { }</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+  let fieldList = {</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+    &quot;//input[@name='input']&quot;:     Date.now().toString(),</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+    &quot;//input[@name='spaced 1']&quot;:  Math.random().toString(),</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+    &quot;//input[3]&quot;:                 &quot;three&quot;,</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+    &quot;//input[@type='checkbox']&quot;:  true,</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+    &quot;//input[@name='uncheck']&quot;:   false,</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+    &quot;//input[@type='radio'][1]&quot;:  false,</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+    &quot;//input[@type='radio'][2]&quot;:  true,</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+    &quot;//input[@type='radio'][3]&quot;:  false,</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+    &quot;//select&quot;:                   2,</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+    &quot;//select[@multiple]&quot;:        [1, 3],</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+    &quot;//textarea[1]&quot;:              &quot;&quot;,</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+    &quot;//textarea[2]&quot;:              &quot;Some text... &quot; + Math.random(),</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+    &quot;//textarea[3]&quot;:              &quot;Some more text\n&quot; + new Date(),</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+    &quot;//input[@type='file'][1]&quot;:   [&quot;/dev/null&quot;],</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+    &quot;//input[@type='file'][2]&quot;:   [&quot;/dev/null&quot;, &quot;/dev/stdin&quot;]</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+  };</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+  </span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+  function getElementByXPath(aTab, aQuery) {</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+    let doc = aTab.linkedBrowser.contentDocument;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+    let xptype = Components.interfaces.nsIDOMXPathResult.FIRST_ORDERED_NODE_TYPE;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+    return doc.evaluate(aQuery, doc, null, xptype, null).singleNodeValue;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+  }</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+  </span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+  function setFormValue(aTab, aQuery, aValue) {</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+    let node = getElementByXPath(aTab, aQuery);</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+    if (typeof aValue == &quot;string&quot;)</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+      node.value = aValue;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+    else if (typeof aValue == &quot;boolean&quot;)</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+      node.checked = aValue;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+    else if (typeof aValue == &quot;number&quot;)</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+      node.selectedIndex = aValue;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+    else if (node instanceof Components.interfaces.nsIDOMHTMLInputElement &amp;&amp; node.type == &quot;file&quot;)</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+      node.mozSetFileNameArray(aValue, aValue.length);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+    else</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+      Array.forEach(node.options, function(aOpt, aIx)</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+                                    (aOpt.selected = aValue.indexOf(aIx) &gt; -1));</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+  }</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+  </span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+  function compareFormValue(aTab, aQuery, aValue) {</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+    let node = getElementByXPath(aTab, aQuery);</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+    if (!node)</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+      return false;</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+    if (node instanceof Components.interfaces.nsIDOMHTMLInputElement) {</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+      if (node.type == &quot;file&quot;) {</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+        let fileNames = node.mozGetFileNameArray();</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+        return fileNames.length == aValue.length &amp;&amp;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+               Array.every(fileNames, function(aFile) aValue.indexOf(aFile) &gt;= 0);</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+      }</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+      return aValue == (node.type == &quot;checkbox&quot; || node.type == &quot;radio&quot; ?</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+                        node.checked : node.value);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+    }</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+    if (node instanceof Components.interfaces.nsIDOMHTMLTextAreaElement)</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+      return aValue == node.value;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+    if (!node.multiple)</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+      return aValue == node.selectedIndex;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+    return Array.every(node.options, function(aOpt, aIx)</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+                                       (aValue.indexOf(aIx) &gt; -1) == aOpt.selected);</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+  }</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+  </span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+  // test setup</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+  let tabbrowser = getBrowser();</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+  </span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+  // make sure we don't save form data at all (except for tab duplication)</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+  gPrefService.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 2);</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+  </span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+  let testURL = &quot;chrome://mochikit/content/browser/&quot; +</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug346337_sample.html&quot;;</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+  let tab = tabbrowser.addTab(testURL);</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+    for (let xpath in fieldList)</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+      setFormValue(tab, xpath, fieldList[xpath]);</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+    </span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+    let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;pageshow&quot;, function(aEvent) {</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+      for (let xpath in fieldList)</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+        ok(compareFormValue(tab2, xpath, fieldList[xpath]),</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineplus">+           &quot;The value for \&quot;&quot; + xpath + &quot;\&quot; was correctly restored&quot;);</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+      let browser = tab.linkedBrowser;</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+      tab.linkedBrowser.addEventListener(&quot;pageshow&quot;, function(aEvent) {</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+        browser.removeEventListener(&quot;pageshow&quot;, arguments.callee, true);</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+        let tab3 = tabbrowser.undoCloseTab(0);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+        tab3.linkedBrowser.addEventListener(&quot;pageshow&quot;, function(aEvent) {</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+          for (let xpath in fieldList)</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineplus">+            if (fieldList[xpath])</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+              ok(!compareFormValue(tab3, xpath, fieldList[xpath]),</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+                 &quot;The value for \&quot;&quot; + xpath + &quot;\&quot; was correctly discarded&quot;);</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+          </span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+        if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+          gPrefService.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+          // undoCloseTab can reuse a single blank tab, so we have to</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+          // make sure not to close the window when closing our last tab</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+          if (tabbrowser.tabContainer.childNodes.length == 1)</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+            tabbrowser.addTab();</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+          tabbrowser.removeTab(tab3);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+          finish();</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+        }, true);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+      }, true);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+      // clean up</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+      tabbrowser.removeTab(tab2);</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+      tabbrowser.removeTab(tab);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+    }, true);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+  }, true);</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug346337_sample.html</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,37 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+&lt;title&gt;Test for bug 346337&lt;/title&gt;</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+&lt;h3&gt;Text Fields&lt;/h3&gt;</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+&lt;input type=&quot;text&quot; name=&quot;input&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+&lt;input type=&quot;text&quot; name=&quot;spaced 1&quot;&gt;</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+&lt;input&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+&lt;h3&gt;Checkboxes and Radio buttons&lt;/h3&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+&lt;input type=&quot;checkbox&quot; name=&quot;check&quot;&gt; Check 1</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+&lt;input type=&quot;checkbox&quot; name=&quot;uncheck&quot; checked&gt; Check 2</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+&lt;p&gt;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+&lt;input type=&quot;radio&quot; name=&quot;group&quot; value=&quot;1&quot;&gt; Radio 1</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+&lt;input type=&quot;radio&quot; name=&quot;group&quot; value=&quot;some&quot;&gt; Radio 2</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+&lt;input type=&quot;radio&quot; name=&quot;group&quot; checked&gt; Radio 3</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+&lt;h3&gt;Selects&lt;/h3&gt;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+&lt;select name=&quot;any&quot;&gt;  </span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+  &lt;option value=&quot;1&quot;&gt; Select 1  </span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+  &lt;option value=&quot;some&quot;&gt; Select 2 </span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+  &lt;option&gt;Select 3</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+&lt;/select&gt;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+&lt;select multiple=&quot;multiple&quot;&gt;  </span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  &lt;option value=1&gt; Multi-select 1</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+  &lt;option value=2&gt; Multi-select 2  </span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+  &lt;option value=3&gt; Multi-select 3</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+  &lt;option value=4&gt; Multi-select 4</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+&lt;/select&gt; </span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+&lt;h3&gt;Text Areas&lt;/h3&gt;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+&lt;textarea name=&quot;testarea&quot;&gt;&lt;/textarea&gt;</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+&lt;textarea name=&quot;sized one&quot; rows=&quot;5&quot; cols=&quot;25&quot;&gt;&lt;/textarea&gt;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+&lt;textarea&gt;&lt;/textarea&gt;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+&lt;h3&gt;File Selector&lt;/h3&gt;</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+&lt;input type=&quot;file&quot;&gt;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+&lt;input type=&quot;file&quot; multiple&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug350525.js</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,107 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+function test() {</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+  /** Test for Bug 350525 **/</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+  </span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+  function test(aLambda) {</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+    try {</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+      return aLambda() || true;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+    }</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+    catch (ex) { }</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    return false;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  }</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+  </span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+  // test setup</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+  let tabbrowser = getBrowser();</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  </span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  // component</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  let ssComponent = test(function() Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  ok(ssComponent, &quot;reference the sessionstore component&quot;);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  </span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  // service</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+  let ss = test(function() ssComponent.getService(Components.interfaces.nsISessionStore));</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+  ok(ss, &quot;reference the sessionstore service&quot;);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+  </span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+  ////////////////////////////</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+  // setWindowValue, et al. //</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+  ////////////////////////////</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+  let key = &quot;Unique name: &quot; + Date.now();</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  </span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  // test adding</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+  ok(test(function() ss.setWindowValue(window, key, value)), &quot;set a window value&quot;);</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+  </span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+  // test retrieving</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+  is(ss.getWindowValue(window, key), value, &quot;stored window value matches original&quot;);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+  </span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+  // test deleting </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+  ok(test(function() ss.deleteWindowValue(window, key)), &quot;delete the window value&quot;);</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  </span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+  // value should not exist post-delete</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+  is(ss.getWindowValue(window, key), &quot;&quot;, &quot;window value was deleted&quot;);</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+  </span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+  /////////////////////////</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+  // setTabValue, et al. //</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  /////////////////////////</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+  key = &quot;Unique name: &quot; + Math.random();</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+  value = &quot;Unique value: &quot; + Date.now();</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+  let tab = tabbrowser.addTab();</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+  tab.linkedBrowser.stop();</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+  </span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+  // test adding</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+  ok(test(function() ss.setTabValue(tab, key, value)), &quot;store a tab value&quot;);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+  </span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+  // test retrieving</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+  is(ss.getTabValue(tab, key), value, &quot;stored tab value match original&quot;);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+  </span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  // test deleting </span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+  ok(test(function() ss.deleteTabValue(tab, key)), &quot;delete the tab value&quot;);</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+  // value should not exist post-delete</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+  is(ss.getTabValue(tab, key), &quot;&quot;, &quot;tab value was deleted&quot;);</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+  </span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+  // clean up</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+  tabbrowser.removeTab(tab);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+  </span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  /////////////////////////////////////</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+  // getClosedTabCount, undoCloseTab //</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+  /////////////////////////////////////</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+  </span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+  // get closed tab count</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+  let count = ss.getClosedTabCount(window);</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+  let max_tabs_undo = gPrefService.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  ok(0 &lt;= count &amp;&amp; count &lt;= max_tabs_undo,</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+     &quot;getClosedTabCount returns zero or at most max_tabs_undo&quot;);</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+  </span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+  // create a new tab</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+  let testURL = &quot;about:&quot;;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+  tab = tabbrowser.addTab(testURL);</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+    // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+    gPrefService.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+    </span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+    // remove tab</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+    tabbrowser.removeTab(tab);</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+    </span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+    // getClosedTabCount</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineplus">+    var newcount = ss.getClosedTabCount(window);</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+    ok(newcount &gt; count, &quot;after closing a tab, getClosedTabCount has been incremented&quot;);</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+    </span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+    // undoCloseTab</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+    tab = test(function() ss.undoCloseTab(window, 0));</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+    ok(tab, &quot;undoCloseTab doesn't throw&quot;)</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+    </span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+    tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+      is(this.currentURI.spec, testURL, &quot;correct tab was reopened&quot;);</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+      </span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+      // clean up</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+        gPrefService.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+      tabbrowser.removeTab(tab);</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+      finish();</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+    }, true);</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+  }, true);</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug367052.js</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,77 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+ *</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+ *</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+ * License.</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+ *</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+ *</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+ *</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+ *</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+ *</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+function test() {</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+  /** Test for Bug 367052 **/</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+  </span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+  // test setup</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+  let tabbrowser = gBrowser;</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+  </span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+  // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+  let max_tabs_undo = gPrefService.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+  gPrefService.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+  let closedTabCount = ss.getClosedTabCount(window);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+  </span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+  // restore a blank tab</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+  let tab = tabbrowser.addTab(&quot;about:&quot;);</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    </span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    let browser = tabbrowser.getBrowserForTab(tab);</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+    let history = browser.webNavigation.sessionHistory;</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+    ok(history.count &gt;= 1, &quot;the new tab does have at least one history entry&quot;);</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+    </span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    ss.setTabState(tab, '{ &quot;entries&quot;: [] }');</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+    tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+      ok(history.count == 0, &quot;the tab was restored without any history whatsoever&quot;);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+      </span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+      tabbrowser.removeTab(tab);</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+      ok(ss.getClosedTabCount(window) == closedTabCount,</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+         &quot;The closed blank tab wasn't added to Recently Closed Tabs&quot;);</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+      </span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+      // clean up</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+        gPrefService.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+      finish();</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+    }, true);</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+  }, true);</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug393716.js</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,81 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+function test() {</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+  /** Test for Bug 393716 **/</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+  </span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+  // set up the basics (SessionStore service, tabbrowser)</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+  try {</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+    var ss = Cc[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+  }</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+  catch (ex) { }</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  ok(ss, &quot;SessionStore service is available&quot;);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  let tabbrowser = getBrowser();</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+  </span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  /////////////////</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+  // getTabState //</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+  /////////////////</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+  let key = &quot;Unique key: &quot; + Date.now();</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+  let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  let testURL = &quot;about:config&quot;;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+  </span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  // create a new tab</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+  let tab = tabbrowser.addTab(testURL);</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  ss.setTabValue(tab, key, value);</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+    // get the tab's state</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+    let state = ss.getTabState(tab);</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+    ok(state, &quot;get the tab's state&quot;);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    </span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+    // verify the tab state's integrity</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+    state = eval(&quot;(&quot; + state + &quot;)&quot;);</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+    ok(state instanceof Object &amp;&amp; state.entries instanceof Array &amp;&amp; state.entries.length &gt; 0,</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+       &quot;state object seems valid&quot;);</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+    ok(state.entries.length == 1 &amp;&amp; state.entries[0].url == testURL,</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+       &quot;Got the expected state object (test URL)&quot;);</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+    ok(state.extData &amp;&amp; state.extData[key] == value,</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+       &quot;Got the expected state object (test manually set tab value)&quot;);</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    </span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+    // clean up</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+    tabbrowser.removeTab(tab);</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+  }, true);</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+  </span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+  //////////////////////////////////</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  // setTabState and duplicateTab //</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+  //////////////////////////////////</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+  let key2 = &quot;key2&quot;;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+  let value2 = &quot;Value &quot; + Math.random();</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+  let value3 = &quot;Another value: &quot; + Date.now();</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  let state = { entries: [{ url: testURL }], extData: { key2: value2 } };</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  </span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+  // create a new tab</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+  let tab2 = tabbrowser.addTab();</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  // set the tab's state</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+  ss.setTabState(tab2, JSON.stringify(state));</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+  tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+   // verify the correctness of the restored tab</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+    ok(ss.getTabValue(tab2, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+       &quot;the tab's state was correctly restored&quot;);</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+    </span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+    // add text data</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+    let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+    textbox.wrappedJSObject.value = value3;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+    </span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+    // duplicate the tab</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+    let duplicateTab = ss.duplicateTab(window, tab2);</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+    tabbrowser.removeTab(tab2);</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+    </span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+    duplicateTab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+      // verify the correctness of the duplicated tab</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+      ok(ss.getTabValue(duplicateTab, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+         &quot;correctly duplicated the tab's state&quot;);</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+      let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+      is(textbox.wrappedJSObject.value, value3, &quot;also duplicated text data&quot;);</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+      </span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+      // clean up</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+      tabbrowser.removeTab(duplicateTab);</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+      finish();</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+    }, true);</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+  }, true);</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug408470.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,93 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ *</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+ *</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+ * License.</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+ *</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+ *</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+ *</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+ *</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+ *</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+function test() {</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+  /** Test for Bug 408470 **/</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+  </span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+  try {</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+  }</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+  catch (ex) { }</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+  </span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+  let pendingCount = 1;</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+  let testUrl = &quot;chrome://mochikit/content/browser/&quot; +</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug408470_sample.html&quot;;</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+  let tab = gBrowser.addTab(testUrl);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+  let window = tab.ownerDocument.defaultView;</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  </span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+    // enable all stylesheets and verify that they're correctly persisted</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    Array.forEach(tab.linkedBrowser.contentDocument.styleSheets, function(aSS, aIx) {</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+      pendingCount++;</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+      let ssTitle = aSS.title;</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+      stylesheetSwitchAll(tab.linkedBrowser.contentWindow, ssTitle);</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+      </span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+      let newTab = ss.duplicateTab(window,tab);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+      newTab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+        tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+        let states = Array.map(newTab.linkedBrowser.contentDocument.styleSheets,</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+                               function(aSS) !aSS.disabled);</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+        let correct = states.indexOf(true) == aIx &amp;&amp; states.indexOf(true, aIx + 1) == -1;</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+        </span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+        if (/^fail_/.test(ssTitle))</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+          ok(!correct, &quot;didn't restore stylesheet &quot; + ssTitle);</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+        else</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+          ok(correct, &quot;restored stylesheet &quot; + ssTitle);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+        </span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+        gBrowser.removeTab(newTab);</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+        if (--pendingCount == 0)</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+          finish();</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+      }, true);</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+    });</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+    </span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+    // disable all styles and verify that this is correctly persisted</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+    tab.linkedBrowser.markupDocumentViewer.authorStyleDisabled = true;</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+    let newTab = ss.duplicateTab(window,tab);</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+    newTab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+      tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+      is(newTab.linkedBrowser.markupDocumentViewer.authorStyleDisabled, true,</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+         &quot;disabled all stylesheets&quot;);</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+      </span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+      gBrowser.removeTab(newTab);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+      if (--pendingCount == 0)</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+        finish();</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+    }, true);</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+    </span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+    gBrowser.removeTab(tab);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+  }, true);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug408470_sample.html</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,19 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+&lt;html&gt;</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+&lt;head&gt;</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+&lt;title&gt;Test for bug 408470&lt;/title&gt;</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;default&quot; rel=&quot;stylesheet&quot;&gt;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;alternate&quot; rel=&quot;alternate stylesheet&quot;&gt;</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;altERnate&quot; rel=&quot; styLEsheet altERnate &quot;&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;media_empty&quot; rel=&quot;alternate stylesheet&quot; media=&quot;&quot;&gt;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;media_all&quot; rel=&quot;alternate stylesheet&quot; media=&quot;all&quot;&gt;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;media_ALL&quot; rel=&quot;alternate stylesheet&quot; media=&quot; ALL &quot;&gt;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;media_screen&quot; rel=&quot;alternate stylesheet&quot; media=&quot;screen&quot;&gt;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;media_print_screen&quot; rel=&quot;alternate stylesheet&quot; media=&quot;print,screen&quot;&gt;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;fail_media_print&quot; rel=&quot;alternate stylesheet&quot; media=&quot;print&quot;&gt;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;fail_media_projection&quot; rel=&quot;stylesheet&quot; media=&quot;projection&quot;&gt;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+&lt;link href=&quot;404.css&quot; title=&quot;fail_media_invalid&quot; rel=&quot;alternate stylesheet&quot; media=&quot;hallo&quot;&gt;</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+&lt;/head&gt;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+&lt;body&gt;&lt;/body&gt;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">rename from suite/common/tests/browser/browser_bug524371.js</span>
<a href="#l12.2"></a><span id="l12.2">rename to suite/common/tests/browser/browser_bug423132.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/suite/common/tests/browser/browser_bug524371.js</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug423132.js</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -29,37 +29,50 @@</span>
<a href="#l12.6"></a><span id="l12.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.7"></a><span id="l12.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.8"></a><span id="l12.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.9"></a><span id="l12.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.10"></a><span id="l12.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.11"></a><span id="l12.11">  *</span>
<a href="#l12.12"></a><span id="l12.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+function browserWindowsCount() {</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+  let count = 0;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  let e = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+                    .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+                    .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+  while (e.hasMoreElements()) {</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+    if (!e.getNext().closed)</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+      ++count;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+  }</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+  return count;</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+}</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+</span>
<a href="#l12.26"></a><span id="l12.26"> function test() {</span>
<a href="#l12.27"></a><span id="l12.27">   // test that cookies are stored and restored correctly by sessionstore,</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-  // bug 524371.</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+  // bug 423132, ported by bug 524371.</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+  is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l12.31"></a><span id="l12.31"> </span>
<a href="#l12.32"></a><span id="l12.32">   // test setup</span>
<a href="#l12.33"></a><span id="l12.33">   waitForExplicitFinish();</span>
<a href="#l12.34"></a><span id="l12.34"> </span>
<a href="#l12.35"></a><span id="l12.35">   let cs = Components.classes[&quot;@mozilla.org/cookiemanager;1&quot;].getService(Components.interfaces.nsICookieManager2);</span>
<a href="#l12.36"></a><span id="l12.36">   cs.removeAll();</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38">   let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40">   var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l12.41"></a><span id="l12.41">                                .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">   // make sure that sessionstore.js can be forced to be created by setting</span>
<a href="#l12.44"></a><span id="l12.44">   // the interval pref to 0</span>
<a href="#l12.45"></a><span id="l12.45">   gPrefService.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-  const testURL = &quot;http://localhost:8888/browser/&quot; +</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-    &quot;suite/common/tests/browser/browser_bug524371_sample.html&quot;;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+  const testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug423132_sample.html&quot;;</span>
<a href="#l12.51"></a><span id="l12.51"> </span>
<a href="#l12.52"></a><span id="l12.52">   // open a new window</span>
<a href="#l12.53"></a><span id="l12.53">   let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;, &quot;about:blank&quot;);</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55">   // make sure sessionstore saves the cookie data, then close the window</span>
<a href="#l12.56"></a><span id="l12.56">   newWin.addEventListener(&quot;load&quot;, function (aEvent) {</span>
<a href="#l12.57"></a><span id="l12.57">     newWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l12.58"></a><span id="l12.58"> </span>
<a href="#l12.59"></a><span id="l12.59" class="difflineat">@@ -95,15 +108,17 @@ function test() {</span>
<a href="#l12.60"></a><span id="l12.60">         if (cookie.name == cookie2.name)</span>
<a href="#l12.61"></a><span id="l12.61">           break;</span>
<a href="#l12.62"></a><span id="l12.62">       }</span>
<a href="#l12.63"></a><span id="l12.63">       is(cookie.name, cookie2.name, &quot;cookie name successfully restored&quot;);</span>
<a href="#l12.64"></a><span id="l12.64">       is(cookie.value, cookie2.value, &quot;cookie value successfully restored&quot;);</span>
<a href="#l12.65"></a><span id="l12.65">       is(cookie.path, cookie2.path, &quot;cookie path successfully restored&quot;);</span>
<a href="#l12.66"></a><span id="l12.66"> </span>
<a href="#l12.67"></a><span id="l12.67">       // clean up</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-      gPrefService.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+        gPrefService.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l12.71"></a><span id="l12.71">       cs.removeAll();</span>
<a href="#l12.72"></a><span id="l12.72">       newWin.close();</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+      is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l12.74"></a><span id="l12.74">       finish();</span>
<a href="#l12.75"></a><span id="l12.75">     }, true);</span>
<a href="#l12.76"></a><span id="l12.76">   }, false);</span>
<a href="#l12.77"></a><span id="l12.77"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">rename from suite/common/tests/browser/browser_bug524371_sample.html</span>
<a href="#l13.2"></a><span id="l13.2">rename to suite/common/tests/browser/browser_bug423132_sample.html</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug447951.js</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,88 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+ *</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+ *</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+ * License.</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+ *</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+ *</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+ *</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+ *</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+ *</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+function test() {</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+  /** Test for Bug 447951 **/</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+  </span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+  // test setup</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+  const baseURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug447951_sample.html#&quot;;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+    </span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+  let tab = getBrowser().addTab();</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+    </span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+    let tabState = { entries: [] };</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+    let max_entries = gPrefService.getIntPref(&quot;browser.sessionhistory.max_entries&quot;);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+    for (let i = 0; i &lt; max_entries; i++)</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+      tabState.entries.push({ url: baseURL + i });</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+    </span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+    ss.setTabState(tab, JSON.stringify(tabState));</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+    tab.addEventListener(&quot;SSTabRestored&quot;, function(aEvent) {</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+      tab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, false);</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+      tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+      is(tabState.entries.length, max_entries, &quot;session history filled to the limit&quot;);</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+      is(tabState.entries[0].url, baseURL + 0, &quot;... but not more&quot;);</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+      </span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+      // visit yet another anchor (appending it to session history)</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+      let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+      let event = doc.createEvent(&quot;MouseEvents&quot;);</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+      event.initMouseEvent(&quot;click&quot;, true, true, doc.defaultView, 1,</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+                           0, 0, 0, 0, false, false, false, false, 0, null);</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+      doc.querySelector(&quot;a&quot;).dispatchEvent(event);</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+      </span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+      executeSoon(function() {</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+        tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+        is(tab.linkedBrowser.currentURI.spec, baseURL + &quot;end&quot;,</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+           &quot;the new anchor was loaded&quot;);</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+        is(tabState.entries[tabState.entries.length - 1].url, baseURL + &quot;end&quot;,</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+           &quot;... and ignored&quot;);</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+        is(tabState.entries[0].url, baseURL + 1,</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+           &quot;... and the first item was removed&quot;);</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+        </span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+        // clean up</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+        getBrowser().removeTab(tab);</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+        finish();</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+      });</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+    }, false);</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+  }, true);</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug447951_sample.html</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+&lt;title&gt;Testcase for bug 447951&lt;/title&gt;</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+&lt;a href=&quot;#end&quot;&gt;click me&lt;/a&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug448741.js</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,102 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+ *</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+ *</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+ * License.</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+ *</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+ *</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+ *</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+ *</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+ *</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+function test() {</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+  /** Test for Bug 448741 **/</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+  </span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+  // test setup</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+  let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+                     .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+  </span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+  let uniqueName = &quot;bug 448741&quot;;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+  let uniqueValue = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+  </span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+  // set a unique value on a new, blank tab</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+  var tab = getBrowser().addTab();</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+  tab.linkedBrowser.stop();</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+  ss.setTabValue(tab, uniqueName, uniqueValue);</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+  let valueWasCleaned = false;</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+  </span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+  // prevent our value from being written to disk</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+  function cleaningObserver(aSubject, aTopic, aData) {</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+    ok(aTopic == &quot;sessionstore-state-write&quot;, &quot;observed correct topic?&quot;);</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+    ok(aSubject instanceof Ci.nsISupportsString, &quot;subject is a string?&quot;);</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+    ok(aSubject.data.indexOf(uniqueValue) &gt; -1, &quot;data contains our value?&quot;);</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+    // find the data for the newly added tab and delete it</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+    let state = JSON.parse(aSubject.data);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+    state.windows.forEach(function (winData) {</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+      winData.tabs.forEach(function (tabData) {</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+        if (tabData.extData &amp;&amp; uniqueName in tabData.extData &amp;&amp;</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+            tabData.extData[uniqueName] == uniqueValue) {</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+          delete tabData.extData[uniqueName];</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+          valueWasCleaned = true;</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+        }</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+      });</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+    });</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+    ok(valueWasCleaned, &quot;found and removed the specific tab value&quot;);</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+    aSubject.data = JSON.stringify(state);</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+    os.removeObserver(cleaningObserver, aTopic, false);</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+  }</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+  </span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+  // make sure that all later observers don't see that value any longer</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+  function checkingObserver(aSubject, aTopic, aData) {</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+    ok(valueWasCleaned &amp;&amp; aSubject instanceof Ci.nsISupportsString,</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+       &quot;ready to check the cleaned state?&quot;);</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+    ok(aSubject.data.indexOf(uniqueValue) == -1, &quot;data no longer contains our value?&quot;);</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+    // clean up</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+    getBrowser().removeTab(tab);</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+    os.removeObserver(checkingObserver, aTopic, false);</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+    if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+      gPrefService.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+    finish();</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+  }</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+  </span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+  // last added observers are invoked first</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+  os.addObserver(checkingObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+  os.addObserver(cleaningObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+  </span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+  // trigger an immediate save operation</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+  gPrefService.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug454908.js</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,87 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+ *</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+ *</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+ * License.</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+ *</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+ *</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+ *</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+ *</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+ *</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+function test() {</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+  /** Test for Bug 454908 **/</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+  </span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+  </span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+  let fieldValues = {</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+    username: &quot;User &quot; + Math.random(),</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+    passwd:   &quot;pwd&quot; + Date.now()</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  };</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  // make sure we do save form data</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+                        .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+  gPrefService.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+  </span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+  let testURL = &quot;chrome://mochikit/content/browser/&quot; +</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug454908_sample.html&quot;;</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+    let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+    for (let id in fieldValues)</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+      doc.getElementById(id).value = fieldValues[id];</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+    </span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+    getBrowser().removeTab(tab);</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+    </span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+    tab = getBrowser().undoCloseTab();</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+    tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+      tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+      let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+      for (let id in fieldValues) {</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+        let node = doc.getElementById(id);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+        if (node.type == &quot;password&quot;)</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+          is(node.value, &quot;&quot;, &quot;password wasn't saved/restored&quot;);</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+        else</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+          is(node.value, fieldValues[id], &quot;username was saved/restored&quot;);</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+      }</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+      </span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+      // clean up</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+        gPrefService.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+      // undoCloseTab can reuse a single blank tab, so we have to</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+      // make sure not to close the window when closing our last tab</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+      if (gBrowser.tabContainer.childNodes.length == 1)</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+        gBrowser.addTab();</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+      gBrowser.removeTab(tab);</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+      finish();</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+    }, true);</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+  }, true);</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug454908_sample.html</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,8 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+&lt;title&gt;Test for bug 454908&lt;/title&gt;</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+&lt;h3&gt;Dummy Login&lt;/h3&gt;</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+&lt;form&gt;</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+&lt;p&gt;Username: &lt;input type=&quot;text&quot; id=&quot;username&quot;&gt;</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+&lt;p&gt;Password: &lt;input type=&quot;password&quot; id=&quot;passwd&quot;&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+&lt;/form&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug456342.js</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,83 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+ *</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+ *</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+ * License.</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+ *</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+ *</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+ *</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+ *</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+ *</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+function test() {</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+  /** Test for Bug 456342 **/</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+  </span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+  </span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+  // make sure we do save form data</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+  var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+  gPrefService.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineplus">+  </span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+  let testURL = &quot;chrome://mochikit/content/browser/&quot; +</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug456342_sample.xhtml&quot;;</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+  let tabbrowser = getBrowser();</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+  let tab2 = tabbrowser.addTab(&quot;about:&quot;);</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+  let tab = tabbrowser.addTab(testURL);</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+  let browser = tab2.linkedBrowser;</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+  browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineplus">+    browser.addEventListener(&quot;pageshow&quot;, function(aEvent) {</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineplus">+      browser.removeEventListener(&quot;pageshow&quot;, arguments.callee, true);</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineplus">+      let undoItems = JSON.parse(ss.getClosedTabData(window));</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineplus">+      let savedFormData = undoItems[0].state.entries[0].formdata;</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+      </span>
<a href="#l19.68"></a><span id="l19.68" class="difflineplus">+      let countGood = 0, countBad = 0;</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+      for each (let value in savedFormData) {</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+        if (value == &quot;save me&quot;)</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+          countGood++;</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+        else</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+          countBad++;</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+      }</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineplus">+      </span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+      is(countGood, 4, &quot;Saved text for non-standard input fields&quot;);</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+      is(countBad,  0, &quot;Didn't save text for ignored field types&quot;);</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+      </span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+      // clean up</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+        gPrefService.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineplus">+      tabbrowser.removeTab(tab2);</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+      finish();</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineplus">+    }, true);</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineplus">+    tabbrowser.removeTab(tab);</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+  }, true);</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug456342_sample.xhtml</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,26 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+&lt;head&gt;&lt;title&gt;Test for bug 456342&lt;/title&gt;&lt;/head&gt;</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineplus">+</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineplus">+&lt;body&gt;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+&lt;h3&gt;Non-standard &amp;lt;input&amp;gt;s&lt;/h3&gt;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+&lt;p&gt;Search        &lt;input type=&quot;search&quot;       value=&quot;save me&quot; id=&quot;searchTerm&quot;/&gt;&lt;/p&gt;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+&lt;p&gt;Image Search: &lt;input type=&quot;image search&quot; value=&quot;save me&quot; /&gt;&lt;/p&gt;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+&lt;p&gt;Autocomplete: &lt;input type=&quot;autocomplete&quot; value=&quot;save me&quot; name=&quot;fill-in&quot;/&gt;&lt;/p&gt;</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+&lt;p&gt;Mistyped:     &lt;input type=&quot;txet&quot;         value=&quot;save me&quot; name=&quot;mistyped&quot;/&gt;&lt;/p&gt;</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+&lt;h3&gt;Ignored types&lt;/h3&gt;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+&lt;input type=&quot;hidden&quot; value=&quot;don't save&quot; name=&quot;hideme&quot;/&gt;</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+&lt;input type=&quot;HIDDEN&quot; value=&quot;don't save&quot; name=&quot;hideme2&quot;/&gt;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+&lt;input type=&quot;submit&quot; value=&quot;don't save&quot; name=&quot;submit&quot;/&gt;</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+&lt;input type=&quot;reset&quot;  value=&quot;don't save&quot; name=&quot;reset&quot;/&gt;</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+&lt;input type=&quot;image&quot;  value=&quot;don't save&quot; name=&quot;image&quot;/&gt;</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+&lt;input type=&quot;button&quot; value=&quot;don't save&quot; name=&quot;button&quot;/&gt;</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+&lt;input type=&quot;password&quot; value=&quot;don't save&quot; name=&quot;password&quot;/&gt;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+&lt;input type=&quot;PassWord&quot; value=&quot;don't save&quot; name=&quot;password2&quot;/&gt;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+&lt;input type=&quot;PASSWORD&quot; value=&quot;don't save&quot; name=&quot;password3&quot;/&gt;</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+&lt;/body&gt;</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">rename from suite/common/tests/browser/browser_bug524345.js</span>
<a href="#l21.2"></a><span id="l21.2">rename to suite/common/tests/browser/browser_bug461634.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineminus">--- a/suite/common/tests/browser/browser_bug524345.js</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug461634.js</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineat">@@ -30,18 +30,31 @@</span>
<a href="#l21.6"></a><span id="l21.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.7"></a><span id="l21.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.8"></a><span id="l21.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.9"></a><span id="l21.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.10"></a><span id="l21.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.11"></a><span id="l21.11">  *</span>
<a href="#l21.12"></a><span id="l21.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+function browserWindowsCount() {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+  let count = 0;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+  let e = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+                    .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+                    .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+  while (e.hasMoreElements()) {</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+    if (!e.getNext().closed)</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+      ++count;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+  }</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+  return count;</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+}</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+</span>
<a href="#l21.26"></a><span id="l21.26"> function test() {</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-  /** Test for Bug 524345 **/</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+  /** Test for Bug 461634, ported by Bug 524345 **/</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+  is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31">   // test setup</span>
<a href="#l21.32"></a><span id="l21.32">   let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l21.33"></a><span id="l21.33">   var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.34"></a><span id="l21.34">                                .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l21.35"></a><span id="l21.35">   waitForExplicitFinish();</span>
<a href="#l21.36"></a><span id="l21.36"> </span>
<a href="#l21.37"></a><span id="l21.37">   const REMEMBER = Date.now(), FORGET = Math.random();</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineat">@@ -110,13 +123,14 @@ function test() {</span>
<a href="#l21.39"></a><span id="l21.39"> 	&quot;The correct amout of tabs was removed&quot;);</span>
<a href="#l21.40"></a><span id="l21.40">      is(countByTitle(closedTabs, &quot;FORGET&quot;), 0,</span>
<a href="#l21.41"></a><span id="l21.41"> 	&quot;All tabs specifically forgotten were indeed removed&quot;);</span>
<a href="#l21.42"></a><span id="l21.42">      is(countByTitle(closedTabs, &quot;REMEMBER&quot;), remember_count,</span>
<a href="#l21.43"></a><span id="l21.43"> 	&quot;... and tabs not specifically forgotten weren't.&quot;);</span>
<a href="#l21.44"></a><span id="l21.44">  </span>
<a href="#l21.45"></a><span id="l21.45">      // clean up</span>
<a href="#l21.46"></a><span id="l21.46">      newWin.close();</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+     is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l21.48"></a><span id="l21.48">      gPrefService.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l21.49"></a><span id="l21.49">      finish();</span>
<a href="#l21.50"></a><span id="l21.50">     });</span>
<a href="#l21.51"></a><span id="l21.51">   }, false);</span>
<a href="#l21.52"></a><span id="l21.52"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug463206.js</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,100 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+ *</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+ *</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+ * License.</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+ *</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+ *</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+ *</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+ *</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+ *</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+function test() {</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+  /** Test for Bug 463206 **/</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+  </span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+  try {</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+  }</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+  catch (ex) { }</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineplus">+  </span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+  let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug463206_sample.html&quot;;</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+  </span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+  var frameCount = 0;</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineplus">+  let window = tab.ownerDocument.defaultView;</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+    // wait for all frames to load completely</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+    if (frameCount++ &lt; 5)</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+      return;</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+    function typeText(aTextField, aValue) {</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+      aTextField.value = aValue;</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+      </span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+      let event = aTextField.ownerDocument.createEvent(&quot;UIEvents&quot;);</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineplus">+      event.initUIEvent(&quot;input&quot;, true, true, aTextField.ownerDocument.defaultView, 0);</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+      aTextField.dispatchEvent(event);</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+    }</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+    </span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+    let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+    typeText(doc.getElementById(&quot;out1&quot;), Date.now());</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineplus">+    typeText(doc.getElementsByName(&quot;1|#out2&quot;)[0], Math.random());</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+    typeText(doc.defaultView.frames[0].frames[1].document.getElementById(&quot;in1&quot;), new Date());</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineplus">+    </span>
<a href="#l22.75"></a><span id="l22.75" class="difflineplus">+    frameCount = 0;</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineplus">+    let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+      // wait for all frames to load completely</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+      if (frameCount++ &lt; 5)</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+        return;</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+      let doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+      let win = tab2.linkedBrowser.contentWindow;</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineplus">+      isnot(doc.getElementById(&quot;out1&quot;).value,</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineplus">+            win.frames[1].document.getElementById(&quot;out1&quot;).value,</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineplus">+            &quot;text isn't reused for frames&quot;);</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineplus">+      isnot(doc.getElementsByName(&quot;1|#out2&quot;)[0].value, &quot;&quot;,</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+            &quot;text containing | and # is correctly restored&quot;);</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+      is(win.frames[1].document.getElementById(&quot;out2&quot;).value, &quot;&quot;,</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineplus">+            &quot;id prefixes can't be faked&quot;);</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineplus">+      isnot(win.frames[0].frames[1].document.getElementById(&quot;in1&quot;).value, &quot;&quot;,</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineplus">+            &quot;id prefixes aren't mixed up&quot;);</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineplus">+      is(win.frames[1].frames[0].document.getElementById(&quot;in1&quot;).value, &quot;&quot;,</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineplus">+            &quot;id prefixes aren't mixed up&quot;);</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineplus">+      </span>
<a href="#l22.97"></a><span id="l22.97" class="difflineplus">+      // clean up</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineplus">+      getBrowser().removeTab(tab2);</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineplus">+      getBrowser().removeTab(tab);</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+      </span>
<a href="#l22.101"></a><span id="l22.101" class="difflineplus">+      finish();</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineplus">+    }, true);</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineplus">+  }, true);</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">new file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- /dev/null</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug463206_sample.html</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -0,0 +1,10 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineplus">+&lt;!-- Testcase originally by &lt;moz_bug_r_a4@yahoo.com&gt; --&gt;</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineplus">+</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineplus">+&lt;title&gt;Test for bug 463206&lt;/title&gt;</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+&lt;iframe src=&quot;data:text/html,&lt;iframe&gt;&lt;/iframe&gt;&lt;iframe%20src='data:text/html,&lt;input%2520id=%2522in1%2522&gt;'&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineplus">+&lt;iframe src=&quot;data:text/html,&lt;input%20id='out1'&gt;&lt;input%20id='out2'&gt;&lt;iframe%20src='data:text/html,&lt;input%2520id=%2522in1%2522&gt;'&gt;&quot;&gt;&lt;/iframe&gt;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+&lt;input id=&quot;out1&quot;&gt;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+&lt;input name=&quot;1|#out2&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug465215.js</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,72 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+ *</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+ *</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+ * License.</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+ *</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+ *</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+ *</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+ *</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+ *</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+function test() {</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+  /** Test for Bug 465215 **/</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+  </span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+  let ss = Cc[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Ci.nsISessionStore);</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+  </span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+  let uniqueName = &quot;bug 465215&quot;;</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+  let uniqueValue1 = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+  let uniqueValue2 = &quot;as good as unique: &quot; + Math.random();</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+  </span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+  // set a unique value on a new, blank tab</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+  let tab1 = gBrowser.addTab();</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+  tab1.linkedBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+    tab1.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+    ss.setTabValue(tab1, uniqueName, uniqueValue1);</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+    </span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+    // duplicate the tab with that value</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+    let tab2 = ss.duplicateTab(window, tab1);</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+    is(ss.getTabValue(tab2, uniqueName), uniqueValue1, &quot;tab value was duplicated&quot;);</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+    </span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+    ss.setTabValue(tab2, uniqueName, uniqueValue2);</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+    isnot(ss.getTabValue(tab1, uniqueName), uniqueValue2, &quot;tab values aren't sync'd&quot;);</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+    </span>
<a href="#l24.64"></a><span id="l24.64" class="difflineplus">+    // overwrite the tab with the value which should remove it</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineplus">+    ss.setTabState(tab1, JSON.stringify({ entries: [] }));</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineplus">+    tab1.linkedBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineplus">+      tab1.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineplus">+      is(ss.getTabValue(tab1, uniqueName), &quot;&quot;, &quot;tab value was cleared&quot;);</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineplus">+      </span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+      // clean up</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+      gBrowser.removeTab(tab2);</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+      gBrowser.removeTab(tab1);</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+      finish();</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineplus">+    }, true);</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineplus">+  }, true);</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">new file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- /dev/null</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug465223.js</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -0,0 +1,93 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineplus">+ *</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+ *</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+ * License.</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+ *</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+ *</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+ *</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+ *</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+ *</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+function browserWindowsCount() {</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineplus">+  let count = 0;</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+  let e = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineplus">+                    .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineplus">+                    .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineplus">+  while (e.hasMoreElements()) {</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineplus">+    if (!e.getNext().closed)</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineplus">+      ++count;</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineplus">+  }</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+  return count;</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineplus">+}</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineplus">+</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+function test() {</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineplus">+  /** Test for Bug 465223 **/</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineplus">+  is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineplus">+  </span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+  // test setup</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+  let ss = Cc[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Ci.nsISessionStore);</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineplus">+  </span>
<a href="#l25.61"></a><span id="l25.61" class="difflineplus">+  let uniqueKey1 = &quot;bug 465223.1&quot;;</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineplus">+  let uniqueKey2 = &quot;bug 465223.2&quot;;</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineplus">+  let uniqueValue1 = &quot;unik&quot; + Date.now();</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineplus">+  let uniqueValue2 = &quot;pi != &quot; + Math.random();</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineplus">+  </span>
<a href="#l25.66"></a><span id="l25.66" class="difflineplus">+  // open a window and set a value on it</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineplus">+  let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+  newWin.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+    ss.setWindowValue(newWin, uniqueKey1, uniqueValue1);</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+    </span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+    let newState = { windows: [{ tabs:[{ entries: [] }], extData: {} }] };</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+    newState.windows[0].extData[uniqueKey2] = uniqueValue2;</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineplus">+    ss.setWindowState(newWin, JSON.stringify(newState), false);</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineplus">+    </span>
<a href="#l25.75"></a><span id="l25.75" class="difflineplus">+    is(newWin.gBrowser.tabContainer.childNodes.length, 2,</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineplus">+       &quot;original tab wasn't overwritten&quot;);</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineplus">+    is(ss.getWindowValue(newWin, uniqueKey1), uniqueValue1,</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+       &quot;window value wasn't overwritten when the tabs weren't&quot;);</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineplus">+    is(ss.getWindowValue(newWin, uniqueKey2), uniqueValue2,</span>
<a href="#l25.80"></a><span id="l25.80" class="difflineplus">+       &quot;new window value was correctly added&quot;);</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineplus">+    </span>
<a href="#l25.82"></a><span id="l25.82" class="difflineplus">+    newState.windows[0].extData[uniqueKey2] = uniqueValue1;</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineplus">+    ss.setWindowState(newWin, JSON.stringify(newState), true);</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineplus">+    </span>
<a href="#l25.85"></a><span id="l25.85" class="difflineplus">+    is(newWin.gBrowser.tabContainer.childNodes.length, 1,</span>
<a href="#l25.86"></a><span id="l25.86" class="difflineplus">+       &quot;original tabs were overwritten&quot;);</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineplus">+    is(ss.getWindowValue(newWin, uniqueKey1), &quot;&quot;,</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineplus">+       &quot;window value was cleared&quot;);</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineplus">+    is(ss.getWindowValue(newWin, uniqueKey2), uniqueValue1,</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineplus">+       &quot;window value was correctly overwritten&quot;);</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineplus">+    </span>
<a href="#l25.92"></a><span id="l25.92" class="difflineplus">+    // clean up</span>
<a href="#l25.93"></a><span id="l25.93" class="difflineplus">+    newWin.close();</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineplus">+    is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineplus">+    finish();</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+  }, false);</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">new file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- /dev/null</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug466937.js</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -0,0 +1,77 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineplus">+ *</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+ *</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+ * License.</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+ *</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+ *</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+ *</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineplus">+ *</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+ *</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+function test() {</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+  /** Test for Bug 466937 **/</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+  </span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+  try {</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+    var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+                       .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+  }</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+  catch (ex) { }</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+  </span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+  let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug466937_sample.html&quot;;</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+  let testPath = &quot;/home/user/regular.file&quot;;</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+  </span>
<a href="#l26.55"></a><span id="l26.55" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+  let window = tab.ownerDocument.defaultView;</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineplus">+    let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineplus">+    doc.getElementById(&quot;reverse_thief&quot;).value = &quot;/home/user/secret2&quot;;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineplus">+    doc.getElementById(&quot;bystander&quot;).value = testPath;</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+    </span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+    let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+      doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineplus">+      is(doc.getElementById(&quot;thief&quot;).value, &quot;&quot;,</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineplus">+         &quot;file path wasn't set to text field value&quot;);</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+      is(doc.getElementById(&quot;reverse_thief&quot;).value, &quot;&quot;,</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+         &quot;text field value wasn't set to full file path&quot;);</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineplus">+      is(doc.getElementById(&quot;bystander&quot;).value, testPath,</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineplus">+         &quot;normal case: file path was correctly preserved&quot;);</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+      </span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+      // clean up</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+      gBrowser.removeTab(tab2);</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+      gBrowser.removeTab(tab);</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineplus">+      </span>
<a href="#l26.78"></a><span id="l26.78" class="difflineplus">+      finish();</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineplus">+    }, true);</span>
<a href="#l26.80"></a><span id="l26.80" class="difflineplus">+  }, true);</span>
<a href="#l26.81"></a><span id="l26.81" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">new file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- /dev/null</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug466937_sample.html</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -0,0 +1,21 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineplus">+&lt;!-- Testcase originally by &lt;moz_bug_r_a4@yahoo.com&gt; --&gt;</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineplus">+</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineplus">+&lt;title&gt;Test for bug 466937&lt;/title&gt;</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineplus">+</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+&lt;input id=&quot;thief&quot; value=&quot;/home/user/secret&quot;&gt;</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineplus">+&lt;input type=&quot;file&quot; id=&quot;reverse_thief&quot;&gt;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+&lt;input type=&quot;file&quot; id=&quot;bystander&quot;&gt;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+&lt;script&gt;</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+  window.addEventListener(&quot;DOMContentLoaded&quot;, function() {</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+    window.removeEventListener(&quot;DOMContentLoaded&quot;, arguments.callee, false);</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+    if (!document.location.hash) {</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+      document.location.hash = &quot;#ready&quot;;</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineplus">+    }</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+    else {</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+      document.getElementById(&quot;thief&quot;).type = &quot;file&quot;;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+      document.getElementById(&quot;reverse_thief&quot;).type = &quot;text&quot;;</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+    }</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+  }, false);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+&lt;/script&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">new file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineminus">--- /dev/null</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug476161.js</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineat">@@ -0,0 +1,71 @@</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l28.6"></a><span id="l28.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l28.7"></a><span id="l28.7" class="difflineplus">+ *</span>
<a href="#l28.8"></a><span id="l28.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l28.9"></a><span id="l28.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l28.10"></a><span id="l28.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+ *</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+ * License.</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+ *</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+ *</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineplus">+ *</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+ *</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+ *</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+function test() {</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+  /** Test for Bug 476161 **/</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+  </span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineplus">+  </span>
<a href="#l28.46"></a><span id="l28.46" class="difflineplus">+  var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineplus">+  let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug476161_sample.html&quot;;</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+  let window = tab.ownerDocument.defaultView;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+    let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineplus">+    </span>
<a href="#l28.56"></a><span id="l28.56" class="difflineplus">+    doc.getElementById(&quot;modify1&quot;).value += Math.random();</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineplus">+    doc.getElementById(&quot;modify2&quot;).value += &quot; &quot; + Date.now();</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineplus">+    </span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+    let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineplus">+      let doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineplus">+      let changed = doc.getElementById(&quot;changed&quot;).textContent.trim().split();</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineplus">+      </span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+      is(changed.sort().join(&quot; &quot;), &quot;modify1 modify2&quot;,</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+         &quot;input events were only dispatched for modified text fields&quot;);</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineplus">+      </span>
<a href="#l28.68"></a><span id="l28.68" class="difflineplus">+      // clean up</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineplus">+      gBrowser.removeTab(tab2);</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineplus">+      gBrowser.removeTab(tab);</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineplus">+</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineplus">+      finish();</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineplus">+    }, true);</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineplus">+  }, true);</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">new file mode 100644</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineminus">--- /dev/null</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug476161_sample.html</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineat">@@ -0,0 +1,24 @@</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l29.6"></a><span id="l29.6" class="difflineplus">+&lt;title&gt;Test for bug 476161&lt;/title&gt;</span>
<a href="#l29.7"></a><span id="l29.7" class="difflineplus">+</span>
<a href="#l29.8"></a><span id="l29.8" class="difflineplus">+&lt;script&gt;</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineplus">+</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineplus">+document.addEventListener(&quot;input&quot;, function(aEvent) {</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineplus">+  var inputEl = aEvent.originalTarget;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+  var changedEl = document.getElementById(&quot;changed&quot;);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  </span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+  changedEl.textContent += &quot; &quot; + inputEl.id;</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+}, false);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+&lt;/script&gt;</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+&lt;h3&gt;Text fields with changed text&lt;/h3&gt;</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+&lt;input type=&quot;text&quot; id=&quot;modify1&quot;&gt;</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineplus">+&lt;input type=&quot;text&quot; id=&quot;modify2&quot; value=&quot;preset value&quot;&gt;</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineplus">+</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineplus">+&lt;h3&gt;Text fields with unchanged text&lt;/h3&gt;</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineplus">+&lt;input type=&quot;text&quot; id=&quot;unchanged1&quot;&gt;</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineplus">+&lt;input type=&quot;text&quot; id=&quot;unchanged2&quot; value=&quot;preset value&quot;&gt;</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineplus">+</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineplus">+&lt;h3&gt;Changed field IDs&lt;/h3&gt;</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineplus">+&lt;div id=&quot;changed&quot;&gt;&lt;/div&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">new file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- /dev/null</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug477657.js</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -0,0 +1,115 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l30.6"></a><span id="l30.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l30.7"></a><span id="l30.7" class="difflineplus">+ *</span>
<a href="#l30.8"></a><span id="l30.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+ *</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+ * License.</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+ *</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+ *</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+ *</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineplus">+ *</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+ *</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+function browserWindowsCount() {</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+  let count = 0;</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+  let e = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+                    .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+                    .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+  while (e.hasMoreElements()) {</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineplus">+    if (!e.getNext().closed)</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineplus">+      ++count;</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineplus">+  }</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineplus">+  return count;</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineplus">+}</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineplus">+</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineplus">+function test() {</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineplus">+  /** Test for Bug 477657 **/</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineplus">+  is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineplus">+  </span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+  // Test fails randomly on OS X (bug 482975)</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineplus">+  if (&quot;nsILocalFileMac&quot; in Components.interfaces)</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+    return;</span>
<a href="#l30.60"></a><span id="l30.60" class="difflineplus">+</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineplus">+  // test setup</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+  </span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+  let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l30.67"></a><span id="l30.67" class="difflineplus">+  newWin.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineplus">+    let newState = { windows: [{</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineplus">+      tabs: [{ entries: [] }],</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineplus">+      _closedTabs: [{</span>
<a href="#l30.71"></a><span id="l30.71" class="difflineplus">+        state: { entries: [{ url: &quot;about:&quot; }]},</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineplus">+        title: &quot;About:&quot;</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineplus">+      }],</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineplus">+      sizemode: &quot;maximized&quot;</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineplus">+    }] };</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineplus">+    </span>
<a href="#l30.77"></a><span id="l30.77" class="difflineplus">+    let uniqueKey = &quot;bug 477657&quot;;</span>
<a href="#l30.78"></a><span id="l30.78" class="difflineplus">+    let uniqueValue = &quot;unik&quot; + Date.now();</span>
<a href="#l30.79"></a><span id="l30.79" class="difflineplus">+  </span>
<a href="#l30.80"></a><span id="l30.80" class="difflineplus">+    ss.setWindowValue(newWin, uniqueKey, uniqueValue);</span>
<a href="#l30.81"></a><span id="l30.81" class="difflineplus">+    is(ss.getWindowValue(newWin, uniqueKey), uniqueValue,</span>
<a href="#l30.82"></a><span id="l30.82" class="difflineplus">+       &quot;window value was set before the window was overwritten&quot;);</span>
<a href="#l30.83"></a><span id="l30.83" class="difflineplus">+    ss.setWindowState(newWin, JSON.stringify(newState), true);</span>
<a href="#l30.84"></a><span id="l30.84" class="difflineplus">+    </span>
<a href="#l30.85"></a><span id="l30.85" class="difflineplus">+    // use setTimeout(..., 0) to mirror sss_restoreWindowFeatures</span>
<a href="#l30.86"></a><span id="l30.86" class="difflineplus">+    setTimeout(function() {</span>
<a href="#l30.87"></a><span id="l30.87" class="difflineplus">+      is(ss.getWindowValue(newWin, uniqueKey), &quot;&quot;,</span>
<a href="#l30.88"></a><span id="l30.88" class="difflineplus">+         &quot;window value was implicitly cleared&quot;);</span>
<a href="#l30.89"></a><span id="l30.89" class="difflineplus">+      </span>
<a href="#l30.90"></a><span id="l30.90" class="difflineplus">+      is(newWin.windowState, newWin.STATE_MAXIMIZED,</span>
<a href="#l30.91"></a><span id="l30.91" class="difflineplus">+         &quot;the window was maximized&quot;);</span>
<a href="#l30.92"></a><span id="l30.92" class="difflineplus">+      </span>
<a href="#l30.93"></a><span id="l30.93" class="difflineplus">+      is(JSON.parse(ss.getClosedTabData(newWin)).length, 1,</span>
<a href="#l30.94"></a><span id="l30.94" class="difflineplus">+         &quot;the closed tab was added before the window was overwritten&quot;);</span>
<a href="#l30.95"></a><span id="l30.95" class="difflineplus">+      delete newState.windows[0]._closedTabs;</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineplus">+      delete newState.windows[0].sizemode;</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineplus">+      ss.setWindowState(newWin, JSON.stringify(newState), true);</span>
<a href="#l30.98"></a><span id="l30.98" class="difflineplus">+      </span>
<a href="#l30.99"></a><span id="l30.99" class="difflineplus">+      setTimeout(function() {</span>
<a href="#l30.100"></a><span id="l30.100" class="difflineplus">+        is(JSON.parse(ss.getClosedTabData(newWin)).length, 0,</span>
<a href="#l30.101"></a><span id="l30.101" class="difflineplus">+           &quot;closed tabs were implicitly cleared&quot;);</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineplus">+        </span>
<a href="#l30.103"></a><span id="l30.103" class="difflineplus">+        is(newWin.windowState, newWin.STATE_MAXIMIZED,</span>
<a href="#l30.104"></a><span id="l30.104" class="difflineplus">+           &quot;the window remains maximized&quot;);</span>
<a href="#l30.105"></a><span id="l30.105" class="difflineplus">+        newState.windows[0].sizemode = &quot;normal&quot;;</span>
<a href="#l30.106"></a><span id="l30.106" class="difflineplus">+        ss.setWindowState(newWin, JSON.stringify(newState), true);</span>
<a href="#l30.107"></a><span id="l30.107" class="difflineplus">+        </span>
<a href="#l30.108"></a><span id="l30.108" class="difflineplus">+        setTimeout(function() {</span>
<a href="#l30.109"></a><span id="l30.109" class="difflineplus">+          isnot(newWin.windowState, newWin.STATE_MAXIMIZED,</span>
<a href="#l30.110"></a><span id="l30.110" class="difflineplus">+                &quot;the window was explicitly unmaximized&quot;);</span>
<a href="#l30.111"></a><span id="l30.111" class="difflineplus">+          </span>
<a href="#l30.112"></a><span id="l30.112" class="difflineplus">+          newWin.close();</span>
<a href="#l30.113"></a><span id="l30.113" class="difflineplus">+          is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l30.114"></a><span id="l30.114" class="difflineplus">+          finish();</span>
<a href="#l30.115"></a><span id="l30.115" class="difflineplus">+        }, 0);</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineplus">+      }, 0);</span>
<a href="#l30.117"></a><span id="l30.117" class="difflineplus">+    }, 0);</span>
<a href="#l30.118"></a><span id="l30.118" class="difflineplus">+  }, false);</span>
<a href="#l30.119"></a><span id="l30.119" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1">new file mode 100644</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineminus">--- /dev/null</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug480893.js</span>
<a href="#l31.4"></a><span id="l31.4" class="difflineat">@@ -0,0 +1,93 @@</span>
<a href="#l31.5"></a><span id="l31.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l31.6"></a><span id="l31.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l31.7"></a><span id="l31.7" class="difflineplus">+ *</span>
<a href="#l31.8"></a><span id="l31.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l31.9"></a><span id="l31.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l31.10"></a><span id="l31.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+ *</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+ * License.</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+ *</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+ *</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+ * Michael Kohler &lt;michaelkohler@live.com&gt;.</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineplus">+ *</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineplus">+ *</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+ *</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineplus">+</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineplus">+function test() {</span>
<a href="#l31.42"></a><span id="l31.42" class="difflineplus">+  /** Test for Bug 480893 **/</span>
<a href="#l31.43"></a><span id="l31.43" class="difflineplus">+</span>
<a href="#l31.44"></a><span id="l31.44" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineplus">+</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineplus">+                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineplus">+</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineplus">+  // Test that starting a new session loads a blank page if Firefox is</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineplus">+  // configured to display a blank page at startup (browser.startup.page = 0)</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineplus">+  gPrefService.setIntPref(&quot;browser.startup.page&quot;, 0);</span>
<a href="#l31.52"></a><span id="l31.52" class="difflineplus">+  let tab = getBrowser().addTab(&quot;about:sessionrestore&quot;);</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineplus">+  getBrowser().selectedTab = tab;</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineplus">+  let browser = tab.linkedBrowser;</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+  browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineplus">+    browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineplus">+    let doc = browser.contentDocument;</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineplus">+</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineplus">+    // click on the &quot;Start New Session&quot; button after about:sessionrestore is loaded</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+    doc.getElementById(&quot;errorCancel&quot;).click();</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineplus">+    browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineplus">+      browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineplus">+      let doc = browser.contentDocument;</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineplus">+</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineplus">+      is(doc.URL, &quot;about:blank&quot;, &quot;loaded page is about:blank&quot;);</span>
<a href="#l31.66"></a><span id="l31.66" class="difflineplus">+</span>
<a href="#l31.67"></a><span id="l31.67" class="difflineplus">+      // Test that starting a new session loads the homepage (set to http://mochi.test:8888)</span>
<a href="#l31.68"></a><span id="l31.68" class="difflineplus">+      // if Firefox is configured to display a homepage at startup (browser.startup.page = 1)</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineplus">+      let homepage = &quot;http://mochi.test:8888/&quot;;</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineplus">+      gPrefService.setCharPref(&quot;browser.startup.homepage&quot;, homepage);</span>
<a href="#l31.71"></a><span id="l31.71" class="difflineplus">+      gPrefService.setIntPref(&quot;browser.startup.page&quot;, 1);</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineplus">+      getBrowser().loadURI(&quot;about:sessionrestore&quot;);</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineplus">+      browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l31.74"></a><span id="l31.74" class="difflineplus">+        browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineplus">+        let doc = browser.contentDocument;</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineplus">+</span>
<a href="#l31.77"></a><span id="l31.77" class="difflineplus">+        // click on the &quot;Start New Session&quot; button after about:sessionrestore is loaded</span>
<a href="#l31.78"></a><span id="l31.78" class="difflineplus">+        doc.getElementById(&quot;errorCancel&quot;).click();</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineplus">+        browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l31.80"></a><span id="l31.80" class="difflineplus">+          browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineplus">+          let doc = browser.contentDocument;</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineplus">+</span>
<a href="#l31.83"></a><span id="l31.83" class="difflineplus">+          is(doc.URL, homepage, &quot;loaded page is the homepage&quot;);</span>
<a href="#l31.84"></a><span id="l31.84" class="difflineplus">+</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineplus">+          // close tab, restore default values and finish the test</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineplus">+          getBrowser().removeTab(tab);</span>
<a href="#l31.87"></a><span id="l31.87" class="difflineplus">+          // we need this if-statement because if there is no user set value, </span>
<a href="#l31.88"></a><span id="l31.88" class="difflineplus">+          // clearUserPref throws a uncatched exception and finish is not called</span>
<a href="#l31.89"></a><span id="l31.89" class="difflineplus">+          if (gPrefService.prefHasUserValue(&quot;browser.startup.page&quot;))</span>
<a href="#l31.90"></a><span id="l31.90" class="difflineplus">+            gPrefService.clearUserPref(&quot;browser.startup.page&quot;);</span>
<a href="#l31.91"></a><span id="l31.91" class="difflineplus">+          gPrefService.clearUserPref(&quot;browser.startup.homepage&quot;);</span>
<a href="#l31.92"></a><span id="l31.92" class="difflineplus">+          finish();</span>
<a href="#l31.93"></a><span id="l31.93" class="difflineplus">+        }, true);</span>
<a href="#l31.94"></a><span id="l31.94" class="difflineplus">+      }, true);</span>
<a href="#l31.95"></a><span id="l31.95" class="difflineplus">+    }, true);</span>
<a href="#l31.96"></a><span id="l31.96" class="difflineplus">+  }, true);</span>
<a href="#l31.97"></a><span id="l31.97" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1">new file mode 100644</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineminus">--- /dev/null</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug483330.js</span>
<a href="#l32.4"></a><span id="l32.4" class="difflineat">@@ -0,0 +1,40 @@</span>
<a href="#l32.5"></a><span id="l32.5" class="difflineplus">+function test() {</span>
<a href="#l32.6"></a><span id="l32.6" class="difflineplus">+  /** Test for Bug 483330 **/</span>
<a href="#l32.7"></a><span id="l32.7" class="difflineplus">+</span>
<a href="#l32.8"></a><span id="l32.8" class="difflineplus">+  // test setup</span>
<a href="#l32.9"></a><span id="l32.9" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l32.10"></a><span id="l32.10" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l32.11"></a><span id="l32.11" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  let tab = getBrowser().addTab();</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  getBrowser().selectedTab = tab;</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+  let browser = tab.linkedBrowser;</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineplus">+  browser.addEventListener(&quot;load&quot;, function loadListener(e) {</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineplus">+    browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineplus">+    // Scroll the content document</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineplus">+    browser.contentWindow.scrollTo(1100, 1200);</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineplus">+    is(browser.contentWindow.scrollX, 1100, &quot;scrolled horizontally&quot;);</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineplus">+    is(browser.contentWindow.scrollY, 1200, &quot;scrolled vertically&quot;);</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineplus">+</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineplus">+    getBrowser().removeTab(tab);</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineplus">+</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineplus">+    let newTab = ss.undoCloseTab(window, 0);</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineplus">+    newTab.addEventListener(&quot;SSTabRestored&quot;, function tabRestored(e) {</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineplus">+      newTab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, true);</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+      let newBrowser = newTab.linkedBrowser;</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+      // check that the scroll position was restored</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+      is(newBrowser.contentWindow.scrollX, 1100, &quot;still scrolled horizontally&quot;);</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineplus">+      is(newBrowser.contentWindow.scrollY, 1200, &quot;still scrolled vertically&quot;);</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineplus">+</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+      getBrowser().removeTab(newTab);</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+      finish();</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+    }, true);</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+  }, true);</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+  browser.loadURI(&quot;data:text/html,&lt;body style='width: 100000px; height: 100000px;'&gt;&lt;p&gt;top&lt;/p&gt;&lt;/body&gt;&quot;);</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">new file mode 100644</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineminus">--- /dev/null</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug485482.js</span>
<a href="#l33.4"></a><span id="l33.4" class="difflineat">@@ -0,0 +1,71 @@</span>
<a href="#l33.5"></a><span id="l33.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l33.6"></a><span id="l33.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l33.7"></a><span id="l33.7" class="difflineplus">+ *</span>
<a href="#l33.8"></a><span id="l33.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l33.9"></a><span id="l33.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l33.10"></a><span id="l33.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+ *</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+ * License.</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineplus">+ *</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+ *</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+ * Simon Bnzli &lt;zeniko@gmail.com&gt;.</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineplus">+ *</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineplus">+ *</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineplus">+ *</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineplus">+</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+function test() {</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineplus">+  /** Test for Bug 485482, ported by Bug 487922 **/</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineplus">+  </span>
<a href="#l33.44"></a><span id="l33.44" class="difflineplus">+  var ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineplus">+</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineplus">+  </span>
<a href="#l33.49"></a><span id="l33.49" class="difflineplus">+  let uniqueValue = Math.random();</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+  </span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+  let testURL = &quot;chrome://mochikit/content/browser/&quot; +</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineplus">+    &quot;suite/common/tests/browser/browser_bug485482_sample.html&quot;;</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+  let tab = getBrowser().addTab(testURL);</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineplus">+    let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l33.57"></a><span id="l33.57" class="difflineplus">+    doc.querySelector(&quot;input[type=text]&quot;).value = uniqueValue;</span>
<a href="#l33.58"></a><span id="l33.58" class="difflineplus">+    doc.querySelector(&quot;input[type=checkbox]&quot;).checked = true;</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineplus">+    </span>
<a href="#l33.60"></a><span id="l33.60" class="difflineplus">+    let tab2 = ss.duplicateTab(window, tab);</span>
<a href="#l33.61"></a><span id="l33.61" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l33.62"></a><span id="l33.62" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l33.63"></a><span id="l33.63" class="difflineplus">+      doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l33.64"></a><span id="l33.64" class="difflineplus">+      is(doc.querySelector(&quot;input[type=text]&quot;).value, uniqueValue,</span>
<a href="#l33.65"></a><span id="l33.65" class="difflineplus">+         &quot;generated XPath expression was valid&quot;);</span>
<a href="#l33.66"></a><span id="l33.66" class="difflineplus">+      ok(doc.querySelector(&quot;input[type=checkbox]&quot;).checked,</span>
<a href="#l33.67"></a><span id="l33.67" class="difflineplus">+         &quot;generated XPath expression was valid&quot;);</span>
<a href="#l33.68"></a><span id="l33.68" class="difflineplus">+      </span>
<a href="#l33.69"></a><span id="l33.69" class="difflineplus">+      // clean up</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineplus">+      getBrowser().removeTab(tab2);</span>
<a href="#l33.71"></a><span id="l33.71" class="difflineplus">+      getBrowser().removeTab(tab);</span>
<a href="#l33.72"></a><span id="l33.72" class="difflineplus">+      finish();</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineplus">+    }, true);</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+  }, true);</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">new file mode 100644</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineminus">--- /dev/null</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug485482_sample.html</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineat">@@ -0,0 +1,12 @@</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l34.6"></a><span id="l34.6" class="difflineplus">+&lt;title&gt;Test for bug 485482&lt;/title&gt;</span>
<a href="#l34.7"></a><span id="l34.7" class="difflineplus">+</span>
<a href="#l34.8"></a><span id="l34.8" class="difflineplus">+&lt;bad=name&gt;</span>
<a href="#l34.9"></a><span id="l34.9" class="difflineplus">+  &lt;input type=&quot;text&quot;&gt;</span>
<a href="#l34.10"></a><span id="l34.10" class="difflineplus">+&lt;/bad=name&gt;</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineplus">+</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+&lt;worse=name&gt;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  &lt;l0c@l+na~e&quot;'&gt;</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+    &lt;input type=&quot;checkbox&quot; name=&quot;check&quot;&gt; Check</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+  &lt;/l0c@l+na~e&quot;'&gt;</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+&lt;/worse=name&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">new file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- /dev/null</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug490040.js</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -0,0 +1,181 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineplus">+ *</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+ *</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+ * License.</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+ *</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+ * The Original Code is sessionstore test code.</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+ *</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+ * Mozilla Corporation.</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineplus">+ *</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+ * Paul OShannessy &lt;paul@oshannessy.com&gt;</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+ *</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+ *</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+function browserWindowsCount() {</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+  let count = 0;</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+  let e = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+                    .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineplus">+                    .getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineplus">+  while (e.hasMoreElements()) {</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineplus">+    if (!e.getNext().closed)</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineplus">+      ++count;</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineplus">+  }</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+  return count;</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+}</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+function test() {</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+  /** Test for Bug 490040, ported by Bug 511640 **/</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+  is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+  let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineplus">+                     .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineplus">+  let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineplus">+                     .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineplus">+  let ww = Components.classes[&quot;@mozilla.org/embedcomp/window-watcher;1&quot;]</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineplus">+                     .getService(Components.interfaces.nsIWindowWatcher);</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineplus">+</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineplus">+  var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineplus">+                               .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineplus">+</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineplus">+  function testWithState(aState) {</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+    // Ensure we can store the window if needed.</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineplus">+    let curClosedWindowCount = ss.getClosedWindowCount();</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineplus">+    gPrefService.setIntPref(&quot;browser.sessionstore.max_windows_undo&quot;,</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineplus">+                            curClosedWindowCount + 1);</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineplus">+</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineplus">+    var origWin;</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineplus">+    function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineplus">+      let theWin = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineplus">+      if (origWin &amp;&amp; theWin != origWin)</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineplus">+        return;</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineplus">+</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineplus">+      switch (aTopic) {</span>
<a href="#l35.83"></a><span id="l35.83" class="difflineplus">+        case &quot;domwindowopened&quot;:</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineplus">+          origWin = theWin;</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineplus">+          theWin.addEventListener(&quot;load&quot;, function () {</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineplus">+            theWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l35.87"></a><span id="l35.87" class="difflineplus">+            executeSoon(function () {</span>
<a href="#l35.88"></a><span id="l35.88" class="difflineplus">+              // Close the window as soon as the first tab loads, or</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineplus">+              // immediately if there are no tabs.</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineplus">+              if (aState.windowState.windows[0].tabs[0].entries.length) {</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineplus">+                theWin.gBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l35.92"></a><span id="l35.92" class="difflineplus">+                  theWin.gBrowser.removeEventListener(&quot;load&quot;,</span>
<a href="#l35.93"></a><span id="l35.93" class="difflineplus">+                                                      arguments.callee, true);</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineplus">+                  theWin.close();</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineplus">+                }, true);</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineplus">+              } else {</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineplus">+                executeSoon(function () {</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineplus">+                  theWin.close();</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+                });</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineplus">+              }</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineplus">+              ss.setWindowState(theWin, JSON.stringify(aState.windowState),</span>
<a href="#l35.102"></a><span id="l35.102" class="difflineplus">+                                true);</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineplus">+            });</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineplus">+          }, false);</span>
<a href="#l35.105"></a><span id="l35.105" class="difflineplus">+          break;</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineplus">+</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineplus">+        case &quot;domwindowclosed&quot;:</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineplus">+          ww.unregisterNotification(windowObserver);</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineplus">+          // Use executeSoon to ensure this happens after SS observer.</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineplus">+          executeSoon(function () {</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineplus">+            is(ss.getClosedWindowCount(),</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineplus">+               curClosedWindowCount + (aState.shouldBeAdded ? 1 : 0),</span>
<a href="#l35.113"></a><span id="l35.113" class="difflineplus">+               &quot;That window should &quot; + (aState.shouldBeAdded ? &quot;&quot; : &quot;not &quot;) +</span>
<a href="#l35.114"></a><span id="l35.114" class="difflineplus">+               &quot;be restorable&quot;);</span>
<a href="#l35.115"></a><span id="l35.115" class="difflineplus">+            executeSoon(runNextTest);</span>
<a href="#l35.116"></a><span id="l35.116" class="difflineplus">+          });</span>
<a href="#l35.117"></a><span id="l35.117" class="difflineplus">+          break;</span>
<a href="#l35.118"></a><span id="l35.118" class="difflineplus">+      }</span>
<a href="#l35.119"></a><span id="l35.119" class="difflineplus">+    }</span>
<a href="#l35.120"></a><span id="l35.120" class="difflineplus">+    ww.registerNotification(windowObserver);</span>
<a href="#l35.121"></a><span id="l35.121" class="difflineplus">+    ww.openWindow(null,</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineplus">+                  location,</span>
<a href="#l35.123"></a><span id="l35.123" class="difflineplus">+                  &quot;_blank&quot;,</span>
<a href="#l35.124"></a><span id="l35.124" class="difflineplus">+                  &quot;chrome,all,dialog=no&quot;,</span>
<a href="#l35.125"></a><span id="l35.125" class="difflineplus">+                  null);</span>
<a href="#l35.126"></a><span id="l35.126" class="difflineplus">+  }</span>
<a href="#l35.127"></a><span id="l35.127" class="difflineplus">+</span>
<a href="#l35.128"></a><span id="l35.128" class="difflineplus">+  // Only windows with open tabs are restorable. Windows where a lone tab is</span>
<a href="#l35.129"></a><span id="l35.129" class="difflineplus">+  // detached may have _closedTabs, but is left with just an empty tab.</span>
<a href="#l35.130"></a><span id="l35.130" class="difflineplus">+  let states = [</span>
<a href="#l35.131"></a><span id="l35.131" class="difflineplus">+    {</span>
<a href="#l35.132"></a><span id="l35.132" class="difflineplus">+      shouldBeAdded: true,</span>
<a href="#l35.133"></a><span id="l35.133" class="difflineplus">+      windowState: {</span>
<a href="#l35.134"></a><span id="l35.134" class="difflineplus">+        windows: [{</span>
<a href="#l35.135"></a><span id="l35.135" class="difflineplus">+          tabs: [{ entries: [{ url: &quot;http://example.com&quot;, title: &quot;example.com&quot; }] }],</span>
<a href="#l35.136"></a><span id="l35.136" class="difflineplus">+          selected: 1,</span>
<a href="#l35.137"></a><span id="l35.137" class="difflineplus">+          _closedTabs: []</span>
<a href="#l35.138"></a><span id="l35.138" class="difflineplus">+        }]</span>
<a href="#l35.139"></a><span id="l35.139" class="difflineplus">+      }</span>
<a href="#l35.140"></a><span id="l35.140" class="difflineplus">+    },</span>
<a href="#l35.141"></a><span id="l35.141" class="difflineplus">+    {</span>
<a href="#l35.142"></a><span id="l35.142" class="difflineplus">+      shouldBeAdded: false,</span>
<a href="#l35.143"></a><span id="l35.143" class="difflineplus">+      windowState: {</span>
<a href="#l35.144"></a><span id="l35.144" class="difflineplus">+        windows: [{</span>
<a href="#l35.145"></a><span id="l35.145" class="difflineplus">+          tabs: [{ entries: [] }],</span>
<a href="#l35.146"></a><span id="l35.146" class="difflineplus">+          _closedTabs: []</span>
<a href="#l35.147"></a><span id="l35.147" class="difflineplus">+        }]</span>
<a href="#l35.148"></a><span id="l35.148" class="difflineplus">+      }</span>
<a href="#l35.149"></a><span id="l35.149" class="difflineplus">+    },</span>
<a href="#l35.150"></a><span id="l35.150" class="difflineplus">+    {</span>
<a href="#l35.151"></a><span id="l35.151" class="difflineplus">+      shouldBeAdded: false,</span>
<a href="#l35.152"></a><span id="l35.152" class="difflineplus">+      windowState: {</span>
<a href="#l35.153"></a><span id="l35.153" class="difflineplus">+        windows: [{</span>
<a href="#l35.154"></a><span id="l35.154" class="difflineplus">+          tabs: [{ entries: [] }],</span>
<a href="#l35.155"></a><span id="l35.155" class="difflineplus">+          _closedTabs: [{ state: { entries: [{ url: &quot;http://example.com&quot;, index: 1 }] } }]</span>
<a href="#l35.156"></a><span id="l35.156" class="difflineplus">+        }]</span>
<a href="#l35.157"></a><span id="l35.157" class="difflineplus">+      }</span>
<a href="#l35.158"></a><span id="l35.158" class="difflineplus">+    },</span>
<a href="#l35.159"></a><span id="l35.159" class="difflineplus">+    {</span>
<a href="#l35.160"></a><span id="l35.160" class="difflineplus">+      shouldBeAdded: false,</span>
<a href="#l35.161"></a><span id="l35.161" class="difflineplus">+      windowState: {</span>
<a href="#l35.162"></a><span id="l35.162" class="difflineplus">+        windows: [{</span>
<a href="#l35.163"></a><span id="l35.163" class="difflineplus">+          tabs: [{ entries: [] }],</span>
<a href="#l35.164"></a><span id="l35.164" class="difflineplus">+          _closedTabs: [],</span>
<a href="#l35.165"></a><span id="l35.165" class="difflineplus">+          extData: { keyname: &quot;pi != &quot; + Math.random() }</span>
<a href="#l35.166"></a><span id="l35.166" class="difflineplus">+        }]</span>
<a href="#l35.167"></a><span id="l35.167" class="difflineplus">+      }</span>
<a href="#l35.168"></a><span id="l35.168" class="difflineplus">+    }</span>
<a href="#l35.169"></a><span id="l35.169" class="difflineplus">+  ];</span>
<a href="#l35.170"></a><span id="l35.170" class="difflineplus">+</span>
<a href="#l35.171"></a><span id="l35.171" class="difflineplus">+  function runNextTest() {</span>
<a href="#l35.172"></a><span id="l35.172" class="difflineplus">+    if (states.length) {</span>
<a href="#l35.173"></a><span id="l35.173" class="difflineplus">+      let state = states.shift();</span>
<a href="#l35.174"></a><span id="l35.174" class="difflineplus">+      testWithState(state);</span>
<a href="#l35.175"></a><span id="l35.175" class="difflineplus">+    }</span>
<a href="#l35.176"></a><span id="l35.176" class="difflineplus">+    else {</span>
<a href="#l35.177"></a><span id="l35.177" class="difflineplus">+      if (gPrefService.prefHasUserValue(&quot;browser.sessionstore.max_windows_undo&quot;))</span>
<a href="#l35.178"></a><span id="l35.178" class="difflineplus">+        gPrefService.clearUserPref(&quot;browser.sessionstore.max_windows_undo&quot;);</span>
<a href="#l35.179"></a><span id="l35.179" class="difflineplus">+      is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l35.180"></a><span id="l35.180" class="difflineplus">+      finish();</span>
<a href="#l35.181"></a><span id="l35.181" class="difflineplus">+    }</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineplus">+  }</span>
<a href="#l35.183"></a><span id="l35.183" class="difflineplus">+  runNextTest();</span>
<a href="#l35.184"></a><span id="l35.184" class="difflineplus">+}</span>
<a href="#l35.185"></a><span id="l35.185" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1">rename from suite/common/tests/browser/browser_bug524369.js</span>
<a href="#l36.2"></a><span id="l36.2">rename to suite/common/tests/browser/browser_bug491168.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineminus">--- a/suite/common/tests/browser/browser_bug524369.js</span>
<a href="#l36.4"></a><span id="l36.4" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug491168.js</span>
<a href="#l36.5"></a><span id="l36.5" class="difflineat">@@ -48,17 +48,17 @@ function browserWindowsCount() {</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7"> function test() {</span>
<a href="#l36.8"></a><span id="l36.8">   // make sure we use sessionstore for undoClosetab</span>
<a href="#l36.9"></a><span id="l36.9">   var gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l36.10"></a><span id="l36.10">                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12">   gPrefService.setIntPref(&quot;browser.tabs.max_tabs_undo&quot;, 0);</span>
<a href="#l36.13"></a><span id="l36.13"> </span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-  /** Test for Bug 524369 **/</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+  /** Test for Bug 491168, ported by Bug 524369 **/</span>
<a href="#l36.16"></a><span id="l36.16">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l36.17"></a><span id="l36.17"> </span>
<a href="#l36.18"></a><span id="l36.18">   // test setup</span>
<a href="#l36.19"></a><span id="l36.19">   let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;].getService(Components.interfaces.nsISessionStore);</span>
<a href="#l36.20"></a><span id="l36.20">   let ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;].getService(Components.interfaces.nsIIOService);</span>
<a href="#l36.21"></a><span id="l36.21"> </span>
<a href="#l36.22"></a><span id="l36.22">   waitForExplicitFinish();</span>
<a href="#l36.23"></a><span id="l36.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1">rename from suite/common/tests/browser/browser_bug509315.js</span>
<a href="#l37.2"></a><span id="l37.2">rename to suite/common/tests/browser/browser_bug514751.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/suite/common/tests/browser/browser_bug526613.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_bug526613.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -42,61 +42,70 @@ function test() {</span>
<a href="#l38.4"></a><span id="l38.4">   let ss = Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]</span>
<a href="#l38.5"></a><span id="l38.5">                      .getService(Components.interfaces.nsISessionStore);</span>
<a href="#l38.6"></a><span id="l38.6">   let os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l38.7"></a><span id="l38.7">                      .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l38.8"></a><span id="l38.8">   let wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l38.9"></a><span id="l38.9">                      .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l38.10"></a><span id="l38.10">   waitForExplicitFinish();</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  function browserWindowsCount() {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  function browserWindowsCount(expected) {</span>
<a href="#l38.14"></a><span id="l38.14">     let count = 0;</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineminus">-    let e = wm.getXULWindowEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+    let e = wm.getEnumerator(&quot;navigator:browser&quot;);</span>
<a href="#l38.17"></a><span id="l38.17">     while (e.hasMoreElements()) {</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineminus">-      ++count;</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineminus">-      e.getNext();</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineplus">+      if (!e.getNext().closed)</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineplus">+        ++count;</span>
<a href="#l38.22"></a><span id="l38.22">     }</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineminus">-</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineminus">-    return count;</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineplus">+    is(count, expected,</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineplus">+       &quot;number of open browser windows according to nsIWindowMediator&quot;);</span>
<a href="#l38.27"></a><span id="l38.27" class="difflineplus">+    let state = ss.getBrowserState();</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineplus">+    info(state);</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+    is(JSON.parse(state).windows.length, expected,</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineplus">+       &quot;number of open browser windows according to getBrowserState&quot;);</span>
<a href="#l38.31"></a><span id="l38.31">   }</span>
<a href="#l38.32"></a><span id="l38.32"> </span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-  is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+  browserWindowsCount(1);</span>
<a href="#l38.35"></a><span id="l38.35"> </span>
<a href="#l38.36"></a><span id="l38.36">   // backup old state</span>
<a href="#l38.37"></a><span id="l38.37">   let oldState = ss.getBrowserState();</span>
<a href="#l38.38"></a><span id="l38.38">   // create a new state for testing</span>
<a href="#l38.39"></a><span id="l38.39">   let testState = {</span>
<a href="#l38.40"></a><span id="l38.40">     windows: [</span>
<a href="#l38.41"></a><span id="l38.41">       { tabs: [{ entries: [{ url: &quot;http://example.com/&quot; }] }], selected: 1 },</span>
<a href="#l38.42"></a><span id="l38.42">       { tabs: [{ entries: [{ url: &quot;about:robots&quot;        }] }], selected: 1 },</span>
<a href="#l38.43"></a><span id="l38.43">     ],</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineminus">-    // make sure the first window is focues, otherwise when restoring the</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+    // make sure the first window is focused, otherwise when restoring the</span>
<a href="#l38.46"></a><span id="l38.46">     // old state, the first window is closed and the test harness gets unloaded</span>
<a href="#l38.47"></a><span id="l38.47">     selectedWindow: 1</span>
<a href="#l38.48"></a><span id="l38.48">   };</span>
<a href="#l38.49"></a><span id="l38.49"> </span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-  let observer = {</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-    pass: 1,</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-    observe: function(aSubject, aTopic, aData) {</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+  let pass = 1;</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineplus">+  function observer(aSubject, aTopic, aData) {</span>
<a href="#l38.55"></a><span id="l38.55">       is(aTopic, &quot;sessionstore-browser-state-restored&quot;,</span>
<a href="#l38.56"></a><span id="l38.56">          &quot;The sessionstore-browser-state-restored notification was observed&quot;);</span>
<a href="#l38.57"></a><span id="l38.57"> </span>
<a href="#l38.58"></a><span id="l38.58" class="difflineminus">-      if (this.pass++ == 1) {  </span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-        is(browserWindowsCount(), 2, &quot;Two windows should exist at this point&quot;);</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+    if (pass++ == 1) {</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+      browserWindowsCount(2);</span>
<a href="#l38.62"></a><span id="l38.62"> </span>
<a href="#l38.63"></a><span id="l38.63" class="difflineminus">-        // executeSoon is needed here in order to let the first window be focues</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineminus">-        // (see above)</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineminus">-        executeSoon(function() {</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineplus">+      // let the first window be focused (see above)</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineplus">+      function pollMostRecentWindow() {</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+        if (wm.getMostRecentWindow(&quot;navigator:browser&quot;) == window) {</span>
<a href="#l38.69"></a><span id="l38.69">           ss.setBrowserState(oldState);</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-        });</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineplus">+        } else {</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineplus">+          info(&quot;waiting for the current window to become active&quot;);</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineplus">+          setTimeout(pollMostRecentWindow, 0);</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+          window.focus(); //XXX Why is this needed?</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineplus">+        }</span>
<a href="#l38.76"></a><span id="l38.76">       }</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineminus">-      else {</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineminus">-        is(browserWindowsCount(), 1, &quot;Only one window should exist after cleanup&quot;);</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineminus">-        os.removeObserver(this, &quot;sessionstore-browser-state-restored&quot;);</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineplus">+      pollMostRecentWindow();</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineplus">+    }</span>
<a href="#l38.82"></a><span id="l38.82" class="difflineplus">+    else {</span>
<a href="#l38.83"></a><span id="l38.83" class="difflineplus">+      browserWindowsCount(1);</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineplus">+      ok(!window.closed, &quot;Restoring the old state should have left this window open&quot;);</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineplus">+      os.removeObserver(observer, &quot;sessionstore-browser-state-restored&quot;);</span>
<a href="#l38.86"></a><span id="l38.86">         finish();</span>
<a href="#l38.87"></a><span id="l38.87">       }</span>
<a href="#l38.88"></a><span id="l38.88">     }</span>
<a href="#l38.89"></a><span id="l38.89" class="difflineminus">-  };</span>
<a href="#l38.90"></a><span id="l38.90">   os.addObserver(observer, &quot;sessionstore-browser-state-restored&quot;, false);</span>
<a href="#l38.91"></a><span id="l38.91"> </span>
<a href="#l38.92"></a><span id="l38.92">   // set browser to test state</span>
<a href="#l38.93"></a><span id="l38.93">   ss.setBrowserState(JSON.stringify(testState));</span>
<a href="#l38.94"></a><span id="l38.94"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

