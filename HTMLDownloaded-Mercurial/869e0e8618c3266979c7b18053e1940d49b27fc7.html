<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10327:869e0e8618c3266979c7b18053e1940d49b27fc7</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 869e0e8618c3266979c7b18053e1940d49b27fc7" />
<meta property="og:url" content="/comm-central/rev/869e0e8618c3266979c7b18053e1940d49b27fc7" />
<meta property="og:description" content="Bug 724441 - Replace arguments.callee() with a name. r=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 869e0e8618c3266979c7b18053e1940d49b27fc7 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/869e0e8618c3266979c7b18053e1940d49b27fc7">shortlog</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/869e0e8618c3266979c7b18053e1940d49b27fc7">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7">files</a> |
changeset |
<a href="/comm-central/raw-rev/869e0e8618c3266979c7b18053e1940d49b27fc7">raw</a>  | <a href="/comm-central/archive/869e0e8618c3266979c7b18053e1940d49b27fc7.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=724441">Bug 724441</a> - Replace arguments.callee() with a name. r=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#69;&#100;&#109;&#117;&#110;&#100;&#32;&#87;&#111;&#110;&#103;&#32;&#60;&#101;&#119;&#111;&#110;&#103;&#64;&#112;&#119;&#45;&#119;&#115;&#112;&#120;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 01 Jun 2012 10:05:49 +0800</td></tr>

<tr>
 <td>changeset 10327</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/869e0e8618c3266979c7b18053e1940d49b27fc7">869e0e8618c3266979c7b18053e1940d49b27fc7</a></td>
</tr>



<tr>
<td>parent 10326</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b6fea1b5af0591b3b4d0a64ec70ebab5c102f0a4">b6fea1b5af0591b3b4d0a64ec70ebab5c102f0a4</a>
</td>
</tr>

<tr>
<td>child 10328</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c47b65544536a902b40ef6ccf6c171c8431d010a">c47b65544536a902b40ef6ccf6c171c8431d010a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=869e0e8618c3266979c7b18053e1940d49b27fc7">7821</a></td></tr>
<tr><td>push user</td><td>ewong@pw-wspx.org</td></tr>
<tr><td>push date</td><td class="date age">Fri, 01 Jun 2012 02:06:16 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@869e0e8618c3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=869e0e8618c3266979c7b18053e1940d49b27fc7">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=869e0e8618c3266979c7b18053e1940d49b27fc7&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=869e0e8618c3266979c7b18053e1940d49b27fc7&newProject=comm-central&newRevision=869e0e8618c3266979c7b18053e1940d49b27fc7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=869e0e8618c3266979c7b18053e1940d49b27fc7&newProject=comm-central&newRevision=869e0e8618c3266979c7b18053e1940d49b27fc7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=869e0e8618c3266979c7b18053e1940d49b27fc7&newProject=comm-central&newRevision=869e0e8618c3266979c7b18053e1940d49b27fc7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=724441">724441</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=724441">Bug 724441</a> - Replace arguments.callee() with a name. r=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug561636.js">suite/browser/test/browser/browser_bug561636.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug561636.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug561636.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug561636.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug561636.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug561636.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug595507.js">suite/browser/test/browser/browser_bug595507.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug595507.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug595507.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug595507.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug595507.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_bug595507.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_popupNotification.js">suite/browser/test/browser/browser_popupNotification.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_popupNotification.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_popupNotification.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_popupNotification.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_popupNotification.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/browser/test/browser/browser_popupNotification.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/aboutSessionRestore.js">suite/common/aboutSessionRestore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/aboutSessionRestore.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/aboutSessionRestore.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/aboutSessionRestore.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/aboutSessionRestore.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/aboutSessionRestore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul">suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/src/nsSessionStore.js">suite/common/src/nsSessionStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/src/nsSessionStore.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/src/nsSessionStore.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/src/nsSessionStore.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/src/nsSessionStore.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/src/nsSessionStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_339445.js">suite/common/tests/browser/browser_339445.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_339445.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_339445.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_339445.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_339445.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_339445.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_350525.js">suite/common/tests/browser/browser_350525.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_350525.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_350525.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_350525.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_350525.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_350525.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_367052.js">suite/common/tests/browser/browser_367052.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_367052.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_367052.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_367052.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_367052.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_367052.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_393716.js">suite/common/tests/browser/browser_393716.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_393716.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_393716.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_393716.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_393716.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_393716.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_423132.js">suite/common/tests/browser/browser_423132.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_423132.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_423132.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_423132.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_423132.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_423132.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_447951.js">suite/common/tests/browser/browser_447951.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_447951.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_447951.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_447951.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_447951.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_447951.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_454908.js">suite/common/tests/browser/browser_454908.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_454908.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_454908.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_454908.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_454908.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_454908.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_456342.js">suite/common/tests/browser/browser_456342.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_456342.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_456342.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_456342.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_456342.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_456342.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_463206.js">suite/common/tests/browser/browser_463206.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_463206.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_463206.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_463206.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_463206.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_463206.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_465215.js">suite/common/tests/browser/browser_465215.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_465215.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_465215.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_465215.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_465215.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_465215.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937.js">suite/common/tests/browser/browser_466937.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937_sample.html">suite/common/tests/browser/browser_466937_sample.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937_sample.html">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937_sample.html">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937_sample.html">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937_sample.html">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_466937_sample.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_480893.js">suite/common/tests/browser/browser_480893.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_480893.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_480893.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_480893.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_480893.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_480893.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_483330.js">suite/common/tests/browser/browser_483330.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_483330.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_483330.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_483330.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_483330.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_483330.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_485482.js">suite/common/tests/browser/browser_485482.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_485482.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_485482.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_485482.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_485482.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_485482.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_490040.js">suite/common/tests/browser/browser_490040.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_490040.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_490040.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_490040.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_490040.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_490040.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_491168.js">suite/common/tests/browser/browser_491168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_491168.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_491168.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_491168.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_491168.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_491168.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_500328.js">suite/common/tests/browser/browser_500328.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_500328.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_500328.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_500328.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_500328.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_500328.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_514751.js">suite/common/tests/browser/browser_514751.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_514751.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_514751.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_514751.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_514751.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_514751.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_524745.js">suite/common/tests/browser/browser_524745.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_524745.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_524745.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_524745.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_524745.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_524745.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_586068-cascaded_restore.js">suite/common/tests/browser/browser_586068-cascaded_restore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_586068-cascaded_restore.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_586068-cascaded_restore.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_586068-cascaded_restore.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_586068-cascaded_restore.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_586068-cascaded_restore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_597315.js">suite/common/tests/browser/browser_597315.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_597315.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_597315.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_597315.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_597315.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_597315.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_615394-SSWindowState_events.js">suite/common/tests/browser/browser_615394-SSWindowState_events.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_615394-SSWindowState_events.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_615394-SSWindowState_events.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_615394-SSWindowState_events.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_615394-SSWindowState_events.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_615394-SSWindowState_events.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_form_restore_events.js">suite/common/tests/browser/browser_form_restore_events.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_form_restore_events.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_form_restore_events.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_form_restore_events.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_form_restore_events.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_form_restore_events.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_markPageAsFollowedLink.js">suite/common/tests/browser/browser_markPageAsFollowedLink.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_markPageAsFollowedLink.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_markPageAsFollowedLink.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_markPageAsFollowedLink.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_markPageAsFollowedLink.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/browser_markPageAsFollowedLink.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/head.js">suite/common/tests/browser/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/head.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/head.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/head.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/head.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/tests/browser/head.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/utilityOverlay.js">suite/common/utilityOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/utilityOverlay.js">file</a> |
<a href="/comm-central/annotate/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/utilityOverlay.js">annotate</a> |
<a href="/comm-central/diff/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/utilityOverlay.js">diff</a> |
<a href="/comm-central/comparison/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/utilityOverlay.js">comparison</a> |
<a href="/comm-central/log/869e0e8618c3266979c7b18053e1940d49b27fc7/suite/common/utilityOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/test/browser/browser_bug561636.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_bug561636.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -38,18 +38,18 @@ function test()</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> /**</span>
<a href="#l1.6"></a><span id="l1.6">  * In this test, we check that no popup appears if the form is valid.</span>
<a href="#l1.7"></a><span id="l1.7">  */</span>
<a href="#l1.8"></a><span id="l1.8"> function test1() {</span>
<a href="#l1.9"></a><span id="l1.9">   let uri = &quot;data:text/html,&lt;html&gt;&lt;body&gt;&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&quot;;</span>
<a href="#l1.10"></a><span id="l1.10">   let tab = gBrowser.addTab();</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test1TabLBLoad(aEvent) {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test1TabLBLoad, true);</span>
<a href="#l1.16"></a><span id="l1.16">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18">     doc.getElementById('s').click();</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     executeSoon(function() {</span>
<a href="#l1.21"></a><span id="l1.21">       checkPopupHide();</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">       // Clean-up</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -68,33 +68,33 @@ function test1() {</span>
<a href="#l1.25"></a><span id="l1.25">  * In this test, we check that, when an invalid form is submitted,</span>
<a href="#l1.26"></a><span id="l1.26">  * the invalid element is focused and a popup appears.</span>
<a href="#l1.27"></a><span id="l1.27">  */</span>
<a href="#l1.28"></a><span id="l1.28"> function test2()</span>
<a href="#l1.29"></a><span id="l1.29"> {</span>
<a href="#l1.30"></a><span id="l1.30">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input required id='i'&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.31"></a><span id="l1.31">   let tab = gBrowser.addTab();</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test2gIpopupShown() {</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test2gIpopupShown, false);</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.39"></a><span id="l1.39">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.40"></a><span id="l1.40">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.41"></a><span id="l1.41"> </span>
<a href="#l1.42"></a><span id="l1.42">     checkPopupShow();</span>
<a href="#l1.43"></a><span id="l1.43">     checkPopupMessage(doc);</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45">     // Clean-up and next test.</span>
<a href="#l1.46"></a><span id="l1.46">     gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.47"></a><span id="l1.47">     executeSoon(test3);</span>
<a href="#l1.48"></a><span id="l1.48">   }, false);</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test2TabLBLoad(aEvent) {</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test2TabLBLoad, true);</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.56"></a><span id="l1.56">   }, true);</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58">   gBrowser.selectedTab = tab;</span>
<a href="#l1.59"></a><span id="l1.59">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.60"></a><span id="l1.60"> }</span>
<a href="#l1.61"></a><span id="l1.61"> </span>
<a href="#l1.62"></a><span id="l1.62" class="difflineat">@@ -102,33 +102,33 @@ function test2()</span>
<a href="#l1.63"></a><span id="l1.63">  * In this test, we check that, when an invalid form is submitted,</span>
<a href="#l1.64"></a><span id="l1.64">  * the first invalid element is focused and a popup appears.</span>
<a href="#l1.65"></a><span id="l1.65">  */</span>
<a href="#l1.66"></a><span id="l1.66"> function test3()</span>
<a href="#l1.67"></a><span id="l1.67"> {</span>
<a href="#l1.68"></a><span id="l1.68">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input&gt;&lt;input id='i' required&gt;&lt;input required&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.69"></a><span id="l1.69">   let tab = gBrowser.addTab();</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test3gIPopupShown() {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test3gIPopupShown, false);</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.77"></a><span id="l1.77">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.78"></a><span id="l1.78">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.79"></a><span id="l1.79"> </span>
<a href="#l1.80"></a><span id="l1.80">     checkPopupShow();</span>
<a href="#l1.81"></a><span id="l1.81">     checkPopupMessage(doc);</span>
<a href="#l1.82"></a><span id="l1.82"> </span>
<a href="#l1.83"></a><span id="l1.83">     // Clean-up and next test.</span>
<a href="#l1.84"></a><span id="l1.84">     gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.85"></a><span id="l1.85">     executeSoon(test4a);</span>
<a href="#l1.86"></a><span id="l1.86">   }, false);</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test3TabLBLoad(aEvent) {</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test3TabLBLoad, true);</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.94"></a><span id="l1.94">   }, true);</span>
<a href="#l1.95"></a><span id="l1.95"> </span>
<a href="#l1.96"></a><span id="l1.96">   gBrowser.selectedTab = tab;</span>
<a href="#l1.97"></a><span id="l1.97">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.98"></a><span id="l1.98"> }</span>
<a href="#l1.99"></a><span id="l1.99"> </span>
<a href="#l1.100"></a><span id="l1.100" class="difflineat">@@ -136,18 +136,18 @@ function test3()</span>
<a href="#l1.101"></a><span id="l1.101">  * In this test, we check that, we hide the popup by interacting with the</span>
<a href="#l1.102"></a><span id="l1.102">  * invalid element if the element becomes valid.</span>
<a href="#l1.103"></a><span id="l1.103">  */</span>
<a href="#l1.104"></a><span id="l1.104"> function test4a()</span>
<a href="#l1.105"></a><span id="l1.105"> {</span>
<a href="#l1.106"></a><span id="l1.106">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input id='i' required&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.107"></a><span id="l1.107">   let tab = gBrowser.addTab();</span>
<a href="#l1.108"></a><span id="l1.108"> </span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test4agIPopupShown() {</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test4agIPopupShown, false);</span>
<a href="#l1.113"></a><span id="l1.113"> </span>
<a href="#l1.114"></a><span id="l1.114">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.115"></a><span id="l1.115">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.116"></a><span id="l1.116">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.117"></a><span id="l1.117"> </span>
<a href="#l1.118"></a><span id="l1.118">     checkPopupShow();</span>
<a href="#l1.119"></a><span id="l1.119">     checkPopupMessage(doc);</span>
<a href="#l1.120"></a><span id="l1.120"> </span>
<a href="#l1.121"></a><span id="l1.121" class="difflineat">@@ -157,18 +157,18 @@ function test4a()</span>
<a href="#l1.122"></a><span id="l1.122">       checkPopupHide();</span>
<a href="#l1.123"></a><span id="l1.123"> </span>
<a href="#l1.124"></a><span id="l1.124">       // Clean-up and next test.</span>
<a href="#l1.125"></a><span id="l1.125">       gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.126"></a><span id="l1.126">       executeSoon(test4b);</span>
<a href="#l1.127"></a><span id="l1.127">     });</span>
<a href="#l1.128"></a><span id="l1.128">   }, false);</span>
<a href="#l1.129"></a><span id="l1.129"> </span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test4aTabLBLoad(aEvent) {</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test4aTabLBLoad, true);</span>
<a href="#l1.134"></a><span id="l1.134"> </span>
<a href="#l1.135"></a><span id="l1.135">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.136"></a><span id="l1.136">   }, true);</span>
<a href="#l1.137"></a><span id="l1.137"> </span>
<a href="#l1.138"></a><span id="l1.138">   gBrowser.selectedTab = tab;</span>
<a href="#l1.139"></a><span id="l1.139">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.140"></a><span id="l1.140"> }</span>
<a href="#l1.141"></a><span id="l1.141"> </span>
<a href="#l1.142"></a><span id="l1.142" class="difflineat">@@ -176,18 +176,18 @@ function test4a()</span>
<a href="#l1.143"></a><span id="l1.143">  * In this test, we check that, we don't hide the popup by interacting with the</span>
<a href="#l1.144"></a><span id="l1.144">  * invalid element if the element is still invalid.</span>
<a href="#l1.145"></a><span id="l1.145">  */</span>
<a href="#l1.146"></a><span id="l1.146"> function test4b()</span>
<a href="#l1.147"></a><span id="l1.147"> {</span>
<a href="#l1.148"></a><span id="l1.148">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input type='email' id='i' required&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.149"></a><span id="l1.149">   let tab = gBrowser.addTab();</span>
<a href="#l1.150"></a><span id="l1.150"> </span>
<a href="#l1.151"></a><span id="l1.151" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test4bgIpopupShown() {</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test4bgIpopupShown, false);</span>
<a href="#l1.155"></a><span id="l1.155"> </span>
<a href="#l1.156"></a><span id="l1.156">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.157"></a><span id="l1.157">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.158"></a><span id="l1.158">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.159"></a><span id="l1.159"> </span>
<a href="#l1.160"></a><span id="l1.160">     checkPopupShow();</span>
<a href="#l1.161"></a><span id="l1.161">     checkPopupMessage(doc);</span>
<a href="#l1.162"></a><span id="l1.162"> </span>
<a href="#l1.163"></a><span id="l1.163" class="difflineat">@@ -197,18 +197,18 @@ function test4b()</span>
<a href="#l1.164"></a><span id="l1.164">       checkPopupShow();</span>
<a href="#l1.165"></a><span id="l1.165"> </span>
<a href="#l1.166"></a><span id="l1.166">       // Clean-up and next test.</span>
<a href="#l1.167"></a><span id="l1.167">       gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.168"></a><span id="l1.168">       executeSoon(test5);</span>
<a href="#l1.169"></a><span id="l1.169">     });</span>
<a href="#l1.170"></a><span id="l1.170">   }, false);</span>
<a href="#l1.171"></a><span id="l1.171"> </span>
<a href="#l1.172"></a><span id="l1.172" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test4bTabLBLoad(aEvent) {</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test4bTabLBLoad, true);</span>
<a href="#l1.176"></a><span id="l1.176"> </span>
<a href="#l1.177"></a><span id="l1.177">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.178"></a><span id="l1.178">   }, true);</span>
<a href="#l1.179"></a><span id="l1.179"> </span>
<a href="#l1.180"></a><span id="l1.180">   gBrowser.selectedTab = tab;</span>
<a href="#l1.181"></a><span id="l1.181">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.182"></a><span id="l1.182"> }</span>
<a href="#l1.183"></a><span id="l1.183"> </span>
<a href="#l1.184"></a><span id="l1.184" class="difflineat">@@ -216,18 +216,18 @@ function test4b()</span>
<a href="#l1.185"></a><span id="l1.185">  * In this test, we check that we can hide the popup by blurring the invalid</span>
<a href="#l1.186"></a><span id="l1.186">  * element.</span>
<a href="#l1.187"></a><span id="l1.187">  */</span>
<a href="#l1.188"></a><span id="l1.188"> function test5()</span>
<a href="#l1.189"></a><span id="l1.189"> {</span>
<a href="#l1.190"></a><span id="l1.190">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input id='i' required&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.191"></a><span id="l1.191">   let tab = gBrowser.addTab();</span>
<a href="#l1.192"></a><span id="l1.192"> </span>
<a href="#l1.193"></a><span id="l1.193" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test5gIpopupShown() {</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test5gIpopupShown, false);</span>
<a href="#l1.197"></a><span id="l1.197"> </span>
<a href="#l1.198"></a><span id="l1.198">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.199"></a><span id="l1.199">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.200"></a><span id="l1.200">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.201"></a><span id="l1.201"> </span>
<a href="#l1.202"></a><span id="l1.202">     checkPopupShow();</span>
<a href="#l1.203"></a><span id="l1.203">     checkPopupMessage(doc);</span>
<a href="#l1.204"></a><span id="l1.204"> </span>
<a href="#l1.205"></a><span id="l1.205" class="difflineat">@@ -237,36 +237,36 @@ function test5()</span>
<a href="#l1.206"></a><span id="l1.206">       checkPopupHide();</span>
<a href="#l1.207"></a><span id="l1.207"> </span>
<a href="#l1.208"></a><span id="l1.208">       // Clean-up and next test.</span>
<a href="#l1.209"></a><span id="l1.209">       gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.210"></a><span id="l1.210">       executeSoon(test6);</span>
<a href="#l1.211"></a><span id="l1.211">     });</span>
<a href="#l1.212"></a><span id="l1.212">   }, false);</span>
<a href="#l1.213"></a><span id="l1.213"> </span>
<a href="#l1.214"></a><span id="l1.214" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test5TabLBLoad(aEvent) {</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test5TabLBLoad, true);</span>
<a href="#l1.218"></a><span id="l1.218"> </span>
<a href="#l1.219"></a><span id="l1.219">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.220"></a><span id="l1.220">   }, true);</span>
<a href="#l1.221"></a><span id="l1.221"> </span>
<a href="#l1.222"></a><span id="l1.222">   gBrowser.selectedTab = tab;</span>
<a href="#l1.223"></a><span id="l1.223">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.224"></a><span id="l1.224"> }</span>
<a href="#l1.225"></a><span id="l1.225"> </span>
<a href="#l1.226"></a><span id="l1.226"> /**</span>
<a href="#l1.227"></a><span id="l1.227">  * In this test, we check that we can hide the popup by pressing TAB.</span>
<a href="#l1.228"></a><span id="l1.228">  */</span>
<a href="#l1.229"></a><span id="l1.229"> function test6()</span>
<a href="#l1.230"></a><span id="l1.230"> {</span>
<a href="#l1.231"></a><span id="l1.231">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input id='i' required&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.232"></a><span id="l1.232">   let tab = gBrowser.addTab();</span>
<a href="#l1.233"></a><span id="l1.233"> </span>
<a href="#l1.234"></a><span id="l1.234" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test6gIpopupShown() {</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test6gIpopupShown, false);</span>
<a href="#l1.238"></a><span id="l1.238"> </span>
<a href="#l1.239"></a><span id="l1.239">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.240"></a><span id="l1.240">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.241"></a><span id="l1.241">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.242"></a><span id="l1.242"> </span>
<a href="#l1.243"></a><span id="l1.243">     checkPopupShow();</span>
<a href="#l1.244"></a><span id="l1.244">     checkPopupMessage(doc);</span>
<a href="#l1.245"></a><span id="l1.245"> </span>
<a href="#l1.246"></a><span id="l1.246" class="difflineat">@@ -276,36 +276,36 @@ function test6()</span>
<a href="#l1.247"></a><span id="l1.247">       checkPopupHide();</span>
<a href="#l1.248"></a><span id="l1.248"> </span>
<a href="#l1.249"></a><span id="l1.249">       // Clean-up and next test.</span>
<a href="#l1.250"></a><span id="l1.250">       gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.251"></a><span id="l1.251">       executeSoon(test7);</span>
<a href="#l1.252"></a><span id="l1.252">     });</span>
<a href="#l1.253"></a><span id="l1.253">   }, false);</span>
<a href="#l1.254"></a><span id="l1.254"> </span>
<a href="#l1.255"></a><span id="l1.255" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test6TabLBLoad(aEvent) {</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test6TabLBLoad, true);</span>
<a href="#l1.259"></a><span id="l1.259"> </span>
<a href="#l1.260"></a><span id="l1.260">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.261"></a><span id="l1.261">   }, true);</span>
<a href="#l1.262"></a><span id="l1.262"> </span>
<a href="#l1.263"></a><span id="l1.263">   gBrowser.selectedTab = tab;</span>
<a href="#l1.264"></a><span id="l1.264">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.265"></a><span id="l1.265"> }</span>
<a href="#l1.266"></a><span id="l1.266"> </span>
<a href="#l1.267"></a><span id="l1.267"> /**</span>
<a href="#l1.268"></a><span id="l1.268">  * In this test, we check that the popup will hide if we move to another tab.</span>
<a href="#l1.269"></a><span id="l1.269">  */</span>
<a href="#l1.270"></a><span id="l1.270"> function test7()</span>
<a href="#l1.271"></a><span id="l1.271"> {</span>
<a href="#l1.272"></a><span id="l1.272">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input id='i' required&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.273"></a><span id="l1.273">   let tab = gBrowser.addTab();</span>
<a href="#l1.274"></a><span id="l1.274"> </span>
<a href="#l1.275"></a><span id="l1.275" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test7gIpopupShown() {</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test7gIpopupShown, false);</span>
<a href="#l1.279"></a><span id="l1.279"> </span>
<a href="#l1.280"></a><span id="l1.280">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.281"></a><span id="l1.281">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.282"></a><span id="l1.282">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.283"></a><span id="l1.283"> </span>
<a href="#l1.284"></a><span id="l1.284">     checkPopupShow();</span>
<a href="#l1.285"></a><span id="l1.285">     checkPopupMessage(doc);</span>
<a href="#l1.286"></a><span id="l1.286"> </span>
<a href="#l1.287"></a><span id="l1.287" class="difflineat">@@ -318,18 +318,18 @@ function test7()</span>
<a href="#l1.288"></a><span id="l1.288"> </span>
<a href="#l1.289"></a><span id="l1.289">       // Clean-up and next test.</span>
<a href="#l1.290"></a><span id="l1.290">       gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.291"></a><span id="l1.291">       gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.292"></a><span id="l1.292">       executeSoon(test8);</span>
<a href="#l1.293"></a><span id="l1.293">     });</span>
<a href="#l1.294"></a><span id="l1.294">   }, false);</span>
<a href="#l1.295"></a><span id="l1.295"> </span>
<a href="#l1.296"></a><span id="l1.296" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test7TabLBLoad(aEvent) {</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test7TabLBLoad, true);</span>
<a href="#l1.300"></a><span id="l1.300"> </span>
<a href="#l1.301"></a><span id="l1.301">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.302"></a><span id="l1.302">   }, true);</span>
<a href="#l1.303"></a><span id="l1.303"> </span>
<a href="#l1.304"></a><span id="l1.304">   gBrowser.selectedTab = tab;</span>
<a href="#l1.305"></a><span id="l1.305">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.306"></a><span id="l1.306"> }</span>
<a href="#l1.307"></a><span id="l1.307"> </span>
<a href="#l1.308"></a><span id="l1.308" class="difflineat">@@ -358,18 +358,18 @@ function test8()</span>
<a href="#l1.309"></a><span id="l1.309"> </span>
<a href="#l1.310"></a><span id="l1.310">       // Next test</span>
<a href="#l1.311"></a><span id="l1.311">       executeSoon(test9);</span>
<a href="#l1.312"></a><span id="l1.312">     });</span>
<a href="#l1.313"></a><span id="l1.313">   };</span>
<a href="#l1.314"></a><span id="l1.314"> </span>
<a href="#l1.315"></a><span id="l1.315">   Services.obs.addObserver(gObserver, &quot;invalidformsubmit&quot;, false);</span>
<a href="#l1.316"></a><span id="l1.316"> </span>
<a href="#l1.317"></a><span id="l1.317" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test8TabLBLoad(aEvent) {</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test8TabLBLoad, true);</span>
<a href="#l1.321"></a><span id="l1.321"> </span>
<a href="#l1.322"></a><span id="l1.322">     isnot(gBrowser.selectedTab, tab,</span>
<a href="#l1.323"></a><span id="l1.323">           &quot;This tab should have been loaded in background&quot;);</span>
<a href="#l1.324"></a><span id="l1.324"> </span>
<a href="#l1.325"></a><span id="l1.325">     tab.linkedBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.326"></a><span id="l1.326">   }, true);</span>
<a href="#l1.327"></a><span id="l1.327"> </span>
<a href="#l1.328"></a><span id="l1.328">   tab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineat">@@ -378,82 +378,82 @@ function test8()</span>
<a href="#l1.330"></a><span id="l1.330"> /**</span>
<a href="#l1.331"></a><span id="l1.331">  * In this test, we check that the author defined error message is shown.</span>
<a href="#l1.332"></a><span id="l1.332">  */</span>
<a href="#l1.333"></a><span id="l1.333"> function test9()</span>
<a href="#l1.334"></a><span id="l1.334"> {</span>
<a href="#l1.335"></a><span id="l1.335">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input x-moz-errormessage='foo' required id='i'&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.336"></a><span id="l1.336">   let tab = gBrowser.addTab();</span>
<a href="#l1.337"></a><span id="l1.337"> </span>
<a href="#l1.338"></a><span id="l1.338" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test9gIpopupShown() {</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test9gIpopupShown, false);</span>
<a href="#l1.342"></a><span id="l1.342"> </span>
<a href="#l1.343"></a><span id="l1.343">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.344"></a><span id="l1.344">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l1.345"></a><span id="l1.345">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.346"></a><span id="l1.346"> </span>
<a href="#l1.347"></a><span id="l1.347">     checkPopupShow();</span>
<a href="#l1.348"></a><span id="l1.348"> </span>
<a href="#l1.349"></a><span id="l1.349">     is(gInvalidFormPopup.firstChild.textContent, &quot;foo&quot;,</span>
<a href="#l1.350"></a><span id="l1.350">        &quot;The panel should show the author defined error message&quot;);</span>
<a href="#l1.351"></a><span id="l1.351"> </span>
<a href="#l1.352"></a><span id="l1.352">     // Clean-up and next test.</span>
<a href="#l1.353"></a><span id="l1.353">     gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.354"></a><span id="l1.354">     executeSoon(test10);</span>
<a href="#l1.355"></a><span id="l1.355">   }, false);</span>
<a href="#l1.356"></a><span id="l1.356"> </span>
<a href="#l1.357"></a><span id="l1.357" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.358"></a><span id="l1.358" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.359"></a><span id="l1.359" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test9TabLBLoad(aEvent) {</span>
<a href="#l1.360"></a><span id="l1.360" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test9TabLBLoad, true);</span>
<a href="#l1.361"></a><span id="l1.361"> </span>
<a href="#l1.362"></a><span id="l1.362">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.363"></a><span id="l1.363">   }, true);</span>
<a href="#l1.364"></a><span id="l1.364"> </span>
<a href="#l1.365"></a><span id="l1.365">   gBrowser.selectedTab = tab;</span>
<a href="#l1.366"></a><span id="l1.366">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.367"></a><span id="l1.367"> }</span>
<a href="#l1.368"></a><span id="l1.368"> </span>
<a href="#l1.369"></a><span id="l1.369"> /**</span>
<a href="#l1.370"></a><span id="l1.370">  * In this test, we check that the message is correctly updated when it changes.</span>
<a href="#l1.371"></a><span id="l1.371">  */</span>
<a href="#l1.372"></a><span id="l1.372"> function test10()</span>
<a href="#l1.373"></a><span id="l1.373"> {</span>
<a href="#l1.374"></a><span id="l1.374">   let uri = &quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input type='email' required id='i'&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;&quot;;</span>
<a href="#l1.375"></a><span id="l1.375">   let tab = gBrowser.addTab();</span>
<a href="#l1.376"></a><span id="l1.376"> </span>
<a href="#l1.377"></a><span id="l1.377" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l1.378"></a><span id="l1.378" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function test10gIpopupShown() {</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, test10gIpopupShown, false);</span>
<a href="#l1.381"></a><span id="l1.381"> </span>
<a href="#l1.382"></a><span id="l1.382">     let doc = gBrowser.contentDocument;</span>
<a href="#l1.383"></a><span id="l1.383">     let input = doc.getElementById('i');</span>
<a href="#l1.384"></a><span id="l1.384">     is(doc.activeElement, input, &quot;First invalid element should be focused&quot;);</span>
<a href="#l1.385"></a><span id="l1.385"> </span>
<a href="#l1.386"></a><span id="l1.386">     checkPopupShow();</span>
<a href="#l1.387"></a><span id="l1.387"> </span>
<a href="#l1.388"></a><span id="l1.388">     is(gInvalidFormPopup.firstChild.textContent, input.validationMessage,</span>
<a href="#l1.389"></a><span id="l1.389">        &quot;The panel should show the current validation message&quot;);</span>
<a href="#l1.390"></a><span id="l1.390"> </span>
<a href="#l1.391"></a><span id="l1.391" class="difflineminus">-    input.addEventListener('input', function() {</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineminus">-      input.removeEventListener('input', arguments.callee, false);</span>
<a href="#l1.393"></a><span id="l1.393" class="difflineplus">+    input.addEventListener('input', function test10InputInput() {</span>
<a href="#l1.394"></a><span id="l1.394" class="difflineplus">+      input.removeEventListener('input', test10InputInput, false);</span>
<a href="#l1.395"></a><span id="l1.395"> </span>
<a href="#l1.396"></a><span id="l1.396">       executeSoon(function() {</span>
<a href="#l1.397"></a><span id="l1.397">         // Now, the element suffers from another error, the message should have</span>
<a href="#l1.398"></a><span id="l1.398">         // been updated.</span>
<a href="#l1.399"></a><span id="l1.399">         is(gInvalidFormPopup.firstChild.textContent, input.validationMessage,</span>
<a href="#l1.400"></a><span id="l1.400">            &quot;The panel should show the current validation message&quot;);</span>
<a href="#l1.401"></a><span id="l1.401"> </span>
<a href="#l1.402"></a><span id="l1.402">         // Clean-up and next test.</span>
<a href="#l1.403"></a><span id="l1.403">         gBrowser.removeTab(gBrowser.selectedTab);</span>
<a href="#l1.404"></a><span id="l1.404">         executeSoon(finish);</span>
<a href="#l1.405"></a><span id="l1.405">       });</span>
<a href="#l1.406"></a><span id="l1.406">     }, false);</span>
<a href="#l1.407"></a><span id="l1.407"> </span>
<a href="#l1.408"></a><span id="l1.408">     EventUtils.synthesizeKey('f', {});</span>
<a href="#l1.409"></a><span id="l1.409">   }, false);</span>
<a href="#l1.410"></a><span id="l1.410"> </span>
<a href="#l1.411"></a><span id="l1.411" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l1.412"></a><span id="l1.412" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l1.413"></a><span id="l1.413" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function test10TabLBLoad(aEvent) {</span>
<a href="#l1.414"></a><span id="l1.414" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, test10TabLBLoad, true);</span>
<a href="#l1.415"></a><span id="l1.415"> </span>
<a href="#l1.416"></a><span id="l1.416">     gBrowser.contentDocument.getElementById('s').click();</span>
<a href="#l1.417"></a><span id="l1.417">   }, true);</span>
<a href="#l1.418"></a><span id="l1.418"> </span>
<a href="#l1.419"></a><span id="l1.419">   gBrowser.selectedTab = tab;</span>
<a href="#l1.420"></a><span id="l1.420">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l1.421"></a><span id="l1.421"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/test/browser/browser_bug595507.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_bug595507.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -7,33 +7,33 @@ ok(gInvalidFormPopup,</span>
<a href="#l2.4"></a><span id="l2.4">  */</span>
<a href="#l2.5"></a><span id="l2.5"> function test()</span>
<a href="#l2.6"></a><span id="l2.6"> {</span>
<a href="#l2.7"></a><span id="l2.7">   waitForExplicitFinish();</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">   let uri = &quot;data:text/html,&lt;iframe src=\&quot;data:text/html,&lt;iframe name='t'&gt;&lt;/iframe&gt;&lt;form target='t' action='data:text/html,'&gt;&lt;input required id='i'&gt;&lt;input id='s' type='submit'&gt;&lt;/form&gt;\&quot;&lt;/iframe&gt;&quot;;</span>
<a href="#l2.10"></a><span id="l2.10">   let tab = gBrowser.addTab();</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function() {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  gInvalidFormPopup.addEventListener(&quot;popupshown&quot;, function testgIpopupShown() {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    gInvalidFormPopup.removeEventListener(&quot;popupshown&quot;, testgIpopupShown, false);</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">     let doc = gBrowser.contentDocument.getElementsByTagName('iframe')[0].contentDocument;</span>
<a href="#l2.18"></a><span id="l2.18">     is(doc.activeElement, doc.getElementById('i'),</span>
<a href="#l2.19"></a><span id="l2.19">        &quot;First invalid element should be focused&quot;);</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">     ok(gInvalidFormPopup.state == 'showing' || gInvalidFormPopup.state == 'open',</span>
<a href="#l2.22"></a><span id="l2.22">        &quot;The invalid form popup should be shown&quot;);</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">     // Clean-up and next test.</span>
<a href="#l2.25"></a><span id="l2.25">     gBrowser.removeTab(gBrowser.selectedTab, {animate: false});</span>
<a href="#l2.26"></a><span id="l2.26">     executeSoon(finish);</span>
<a href="#l2.27"></a><span id="l2.27">   }, false);</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34">     gBrowser.contentDocument.getElementsByTagName('iframe')[0].contentDocument</span>
<a href="#l2.35"></a><span id="l2.35">       .getElementById('s').click();</span>
<a href="#l2.36"></a><span id="l2.36">   }, true);</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">   gBrowser.selectedTab = tab;</span>
<a href="#l2.39"></a><span id="l2.39">   gBrowser.selectedTab.linkedBrowser.loadURI(uri);</span>
<a href="#l2.40"></a><span id="l2.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/browser/test/browser/browser_popupNotification.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_popupNotification.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -748,39 +748,39 @@ function triggerMainCommand(popup) {</span>
<a href="#l3.4"></a><span id="l3.4"> function triggerSecondaryCommand(popup, index) {</span>
<a href="#l3.5"></a><span id="l3.5">   info(&quot;[Test #&quot; + gTestIndex + &quot;] triggering secondary command&quot;);</span>
<a href="#l3.6"></a><span id="l3.6">   let notifications = popup.childNodes;</span>
<a href="#l3.7"></a><span id="l3.7">   ok(notifications.length &gt; 0, &quot;at least one notification displayed&quot;);</span>
<a href="#l3.8"></a><span id="l3.8">   let notification = notifications[0];</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   notification.button.focus();</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  popup.addEventListener(&quot;popupshown&quot;, function () {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    popup.removeEventListener(&quot;popupshown&quot;, arguments.callee, false);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  popup.addEventListener(&quot;popupshown&quot;, function triggerPopupShown() {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    popup.removeEventListener(&quot;popupshown&quot;, triggerPopupShown, false);</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17">     // Press down until the desired command is selected</span>
<a href="#l3.18"></a><span id="l3.18">     for (let i = 0; i &lt;= index; i++)</span>
<a href="#l3.19"></a><span id="l3.19">       EventUtils.synthesizeKey(&quot;VK_DOWN&quot;, {});</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">     // Activate</span>
<a href="#l3.22"></a><span id="l3.22">     EventUtils.synthesizeKey(&quot;VK_ENTER&quot;, {});</span>
<a href="#l3.23"></a><span id="l3.23">   }, false);</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">   // One down event to open the popup</span>
<a href="#l3.26"></a><span id="l3.26">   EventUtils.synthesizeKey(&quot;VK_DOWN&quot;, { altKey: (navigator.platform.indexOf(&quot;Mac&quot;) == -1) });</span>
<a href="#l3.27"></a><span id="l3.27"> }</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> function loadURI(uri, callback) {</span>
<a href="#l3.30"></a><span id="l3.30">   if (callback) {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    gBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    gBrowser.addEventListener(&quot;load&quot;, function loadURIgBLoad() {</span>
<a href="#l3.33"></a><span id="l3.33">       // Ignore the about:blank load</span>
<a href="#l3.34"></a><span id="l3.34">       if (gBrowser.currentURI.spec != uri)</span>
<a href="#l3.35"></a><span id="l3.35">         return;</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-      gBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+      gBrowser.removeEventListener(&quot;load&quot;, loadURIgBLoad, true);</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40">       callback();</span>
<a href="#l3.41"></a><span id="l3.41">     }, true);</span>
<a href="#l3.42"></a><span id="l3.42">   }</span>
<a href="#l3.43"></a><span id="l3.43">   gBrowser.loadURI(uri);</span>
<a href="#l3.44"></a><span id="l3.44"> }</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46"> function dismissNotification(popup) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/common/aboutSessionRestore.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/common/aboutSessionRestore.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -94,18 +94,18 @@ function restoreSession() {</span>
<a href="#l4.4"></a><span id="l4.4">   if (top.gBrowser.tabContainer.childNodes.length == 1) {</span>
<a href="#l4.5"></a><span id="l4.5">     ss.setWindowState(top, stateString, true);</span>
<a href="#l4.6"></a><span id="l4.6">     return;</span>
<a href="#l4.7"></a><span id="l4.7">   }</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">   // restore the session into a new window and close the current tab</span>
<a href="#l4.10"></a><span id="l4.10">   var newWindow = top.openDialog(top.location, &quot;_blank&quot;, &quot;chrome,dialog=no,all&quot;, &quot;about:blank&quot;);</span>
<a href="#l4.11"></a><span id="l4.11">   var tab = top.gBrowser.selectedTab;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  newWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-    newWindow.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  newWindow.addEventListener(&quot;load&quot;, function newWindowLoad() {</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+    newWindow.removeEventListener(&quot;load&quot;, newWindowLoad, true);</span>
<a href="#l4.16"></a><span id="l4.16">     ss.setWindowState(newWindow, stateString, true);</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">     top.gBrowser.removeTab(tab);</span>
<a href="#l4.19"></a><span id="l4.19">   }, true);</span>
<a href="#l4.20"></a><span id="l4.20"> }</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22"> function startNewSession() {</span>
<a href="#l4.23"></a><span id="l4.23">   if (Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/common/places/tests/chrome/test_bug427633_no_newfolder_if_noip.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -63,20 +63,20 @@</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">       // Init panel.</span>
<a href="#l5.6"></a><span id="l5.6">       ok(gEditItemOverlay, &quot;gEditItemOverlay is in context&quot;);</span>
<a href="#l5.7"></a><span id="l5.7">       gEditItemOverlay.initPanel(itemId);</span>
<a href="#l5.8"></a><span id="l5.8">       ok(gEditItemOverlay._initialized, &quot;gEditItemOverlay is initialized&quot;);</span>
<a href="#l5.9"></a><span id="l5.9">       // We must be sure tree is initialized, so we wait for place to be set.</span>
<a href="#l5.10"></a><span id="l5.10">       SimpleTest.waitForExplicitFinish();</span>
<a href="#l5.11"></a><span id="l5.11">       var tree = gEditItemOverlay._element(&quot;folderTree&quot;);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      tree.addEventListener(&quot;DOMAttrModified&quot;, function(event) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      tree.addEventListener(&quot;DOMAttrModified&quot;, function treeDOMAttrMod(event) {</span>
<a href="#l5.14"></a><span id="l5.14">           if (event.attrName != &quot;place&quot;)</span>
<a href="#l5.15"></a><span id="l5.15">             return;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-          tree.removeEventListener(&quot;DOMAttrModified&quot;, arguments.callee, false);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+          tree.removeEventListener(&quot;DOMAttrModified&quot;, treeDOMAttrMod, false);</span>
<a href="#l5.18"></a><span id="l5.18">           SimpleTest.executeSoon(function() {</span>
<a href="#l5.19"></a><span id="l5.19">             tree.view.selection.clearSelection();</span>
<a href="#l5.20"></a><span id="l5.20">             ok(document.getElementById(&quot;editBMPanel_newFolderButton&quot;).disabled,</span>
<a href="#l5.21"></a><span id="l5.21">                &quot;New folder button is disabled if there's no selection&quot;);</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">             // Cleanup.</span>
<a href="#l5.24"></a><span id="l5.24">             bs.removeItem(itemId);</span>
<a href="#l5.25"></a><span id="l5.25">             SimpleTest.finish();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/common/src/nsSessionStore.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/common/src/nsSessionStore.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -361,18 +361,18 @@ SessionStoreService.prototype = {</span>
<a href="#l6.4"></a><span id="l6.4">    * Handle notifications</span>
<a href="#l6.5"></a><span id="l6.5">    */</span>
<a href="#l6.6"></a><span id="l6.6">   observe: function sss_observe(aSubject, aTopic, aData) {</span>
<a href="#l6.7"></a><span id="l6.7">     // for event listeners</span>
<a href="#l6.8"></a><span id="l6.8">     var _this = this;</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">     switch (aTopic) {</span>
<a href="#l6.11"></a><span id="l6.11">     case &quot;domwindowopened&quot;: // catch new windows</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      aSubject.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-        aEvent.currentTarget.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+      aSubject.addEventListener(&quot;load&quot;, function aSubjectLoad(aEvent) {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+        aEvent.currentTarget.removeEventListener(&quot;load&quot;, aSubjectLoad, false);</span>
<a href="#l6.16"></a><span id="l6.16">         _this.onLoad(aEvent.currentTarget);</span>
<a href="#l6.17"></a><span id="l6.17">       }, false);</span>
<a href="#l6.18"></a><span id="l6.18">       break;</span>
<a href="#l6.19"></a><span id="l6.19">     case &quot;domwindowclosed&quot;: // catch closed windows</span>
<a href="#l6.20"></a><span id="l6.20">       this.onClose(aSubject);</span>
<a href="#l6.21"></a><span id="l6.21">       break;</span>
<a href="#l6.22"></a><span id="l6.22">     case &quot;quit-application-requested&quot;:</span>
<a href="#l6.23"></a><span id="l6.23">       // get a current snapshot of all windows</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/common/tests/browser/browser_339445.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_339445.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -6,25 +6,25 @@ function test() {</span>
<a href="#l7.4"></a><span id="l7.4">   /** Test for Bug 339445 **/</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">   waitForExplicitFinish();</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l7.9"></a><span id="l7.9">     &quot;suite/common/tests/browser/browser_339445_sample.html&quot;;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l7.16"></a><span id="l7.16">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l7.17"></a><span id="l7.17">     is(doc.getElementById(&quot;storageTestItem&quot;).textContent, &quot;PENDING&quot;,</span>
<a href="#l7.18"></a><span id="l7.18">        &quot;sessionStorage value has been set&quot;);</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l7.25"></a><span id="l7.25">       let doc2 = tab2.linkedBrowser.contentDocument;</span>
<a href="#l7.26"></a><span id="l7.26">       is(doc2.getElementById(&quot;storageTestItem&quot;).textContent, &quot;SUCCESS&quot;,</span>
<a href="#l7.27"></a><span id="l7.27">          &quot;sessionStorage value has been duplicated&quot;);</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">       // clean up</span>
<a href="#l7.30"></a><span id="l7.30">       getBrowser().removeTab(tab2);</span>
<a href="#l7.31"></a><span id="l7.31">       getBrowser().removeTab(tab);</span>
<a href="#l7.32"></a><span id="l7.32"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/common/tests/browser/browser_350525.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_350525.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -65,34 +65,34 @@ function test() {</span>
<a href="#l8.4"></a><span id="l8.4">   let count = ss.getClosedTabCount(window);</span>
<a href="#l8.5"></a><span id="l8.5">   let max_tabs_undo = Services.prefs.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l8.6"></a><span id="l8.6">   ok(0 &lt;= count &amp;&amp; count &lt;= max_tabs_undo,</span>
<a href="#l8.7"></a><span id="l8.7">      &quot;getClosedTabCount returns zero or at most max_tabs_undo&quot;);</span>
<a href="#l8.8"></a><span id="l8.8">   </span>
<a href="#l8.9"></a><span id="l8.9">   // create a new tab</span>
<a href="#l8.10"></a><span id="l8.10">   let testURL = &quot;about:&quot;;</span>
<a href="#l8.11"></a><span id="l8.11">   tab = getBrowser().addTab(testURL);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l8.16"></a><span id="l8.16">     // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l8.17"></a><span id="l8.17">     Services.prefs.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l8.18"></a><span id="l8.18">     </span>
<a href="#l8.19"></a><span id="l8.19">     // remove tab</span>
<a href="#l8.20"></a><span id="l8.20">     getBrowser().removeTab(tab);</span>
<a href="#l8.21"></a><span id="l8.21">     </span>
<a href="#l8.22"></a><span id="l8.22">     // getClosedTabCount</span>
<a href="#l8.23"></a><span id="l8.23">     var newcount = ss.getClosedTabCount(window);</span>
<a href="#l8.24"></a><span id="l8.24">     ok(newcount &gt; count, &quot;after closing a tab, getClosedTabCount has been incremented&quot;);</span>
<a href="#l8.25"></a><span id="l8.25">     </span>
<a href="#l8.26"></a><span id="l8.26">     // undoCloseTab</span>
<a href="#l8.27"></a><span id="l8.27">     tab = test(function() ss.undoCloseTab(window, 0));</span>
<a href="#l8.28"></a><span id="l8.28">     ok(tab, &quot;undoCloseTab doesn't throw&quot;)</span>
<a href="#l8.29"></a><span id="l8.29">     </span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-    tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad2(aEvent) {</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, testTabLBLoad2, true);</span>
<a href="#l8.34"></a><span id="l8.34">       is(this.currentURI.spec, testURL, &quot;correct tab was reopened&quot;);</span>
<a href="#l8.35"></a><span id="l8.35">       </span>
<a href="#l8.36"></a><span id="l8.36">       // clean up</span>
<a href="#l8.37"></a><span id="l8.37">       if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l8.38"></a><span id="l8.38">         Services.prefs.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l8.39"></a><span id="l8.39">       getBrowser().removeTab(tab);</span>
<a href="#l8.40"></a><span id="l8.40">       finish();</span>
<a href="#l8.41"></a><span id="l8.41">     }, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/common/tests/browser/browser_367052.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_367052.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -9,25 +9,25 @@ function test() {</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">   // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l9.6"></a><span id="l9.6">   let max_tabs_undo = Services.prefs.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l9.7"></a><span id="l9.7">   Services.prefs.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l9.8"></a><span id="l9.8">   let closedTabCount = ss.getClosedTabCount(window);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">   // restore a blank tab</span>
<a href="#l9.11"></a><span id="l9.11">   let tab = getBrowser().addTab(&quot;about:&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">     let history = tab.linkedBrowser.webNavigation.sessionHistory;</span>
<a href="#l9.18"></a><span id="l9.18">     ok(history.count &gt;= 1, &quot;the new tab does have at least one history entry&quot;);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">     ss.setTabState(tab, '{ &quot;entries&quot;: [] }');</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-    tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+    tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad2(aEvent) {</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, testTabLBLoad2, true);</span>
<a href="#l9.25"></a><span id="l9.25">       ok(history.count == 0, &quot;the tab was restored without any history whatsoever&quot;);</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">       getBrowser().removeTab(tab);</span>
<a href="#l9.28"></a><span id="l9.28">       ok(ss.getClosedTabCount(window) == closedTabCount,</span>
<a href="#l9.29"></a><span id="l9.29">          &quot;The closed blank tab wasn't added to Recently Closed Tabs&quot;);</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31">       // clean up</span>
<a href="#l9.32"></a><span id="l9.32">       if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/common/tests/browser/browser_393716.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_393716.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -8,18 +8,18 @@ function test() {</span>
<a href="#l10.4"></a><span id="l10.4">   /////////////////</span>
<a href="#l10.5"></a><span id="l10.5">   let key = &quot;Unique key: &quot; + Date.now();</span>
<a href="#l10.6"></a><span id="l10.6">   let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l10.7"></a><span id="l10.7">   let testURL = &quot;about:config&quot;;</span>
<a href="#l10.8"></a><span id="l10.8">   </span>
<a href="#l10.9"></a><span id="l10.9">   // create a new tab</span>
<a href="#l10.10"></a><span id="l10.10">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l10.11"></a><span id="l10.11">   ss.setTabValue(tab, key, value);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l10.16"></a><span id="l10.16">     // get the tab's state</span>
<a href="#l10.17"></a><span id="l10.17">     let state = ss.getTabState(tab);</span>
<a href="#l10.18"></a><span id="l10.18">     ok(state, &quot;get the tab's state&quot;);</span>
<a href="#l10.19"></a><span id="l10.19">     </span>
<a href="#l10.20"></a><span id="l10.20">     // verify the tab state's integrity</span>
<a href="#l10.21"></a><span id="l10.21">     state = eval(&quot;(&quot; + state + &quot;)&quot;);</span>
<a href="#l10.22"></a><span id="l10.22">     ok(state instanceof Object &amp;&amp; state.entries instanceof Array &amp;&amp; state.entries.length &gt; 0,</span>
<a href="#l10.23"></a><span id="l10.23">        &quot;state object seems valid&quot;);</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -39,32 +39,32 @@ function test() {</span>
<a href="#l10.25"></a><span id="l10.25">   let value2 = &quot;Value &quot; + Math.random();</span>
<a href="#l10.26"></a><span id="l10.26">   let value3 = &quot;Another value: &quot; + Date.now();</span>
<a href="#l10.27"></a><span id="l10.27">   let state = { entries: [{ url: testURL }], extData: { key2: value2 } };</span>
<a href="#l10.28"></a><span id="l10.28">   </span>
<a href="#l10.29"></a><span id="l10.29">   // create a new tab</span>
<a href="#l10.30"></a><span id="l10.30">   let tab2 = getBrowser().addTab();</span>
<a href="#l10.31"></a><span id="l10.31">   // set the tab's state</span>
<a href="#l10.32"></a><span id="l10.32">   ss.setTabState(tab2, JSON.stringify(state));</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-  tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+  tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l10.37"></a><span id="l10.37">    // verify the correctness of the restored tab</span>
<a href="#l10.38"></a><span id="l10.38">     ok(ss.getTabValue(tab2, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l10.39"></a><span id="l10.39">        &quot;the tab's state was correctly restored&quot;);</span>
<a href="#l10.40"></a><span id="l10.40">     </span>
<a href="#l10.41"></a><span id="l10.41">     // add text data</span>
<a href="#l10.42"></a><span id="l10.42">     let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l10.43"></a><span id="l10.43">     textbox.value = value3;</span>
<a href="#l10.44"></a><span id="l10.44">     </span>
<a href="#l10.45"></a><span id="l10.45">     // duplicate the tab</span>
<a href="#l10.46"></a><span id="l10.46">     let duplicateTab = ss.duplicateTab(window, tab2);</span>
<a href="#l10.47"></a><span id="l10.47">     getBrowser().removeTab(tab2);</span>
<a href="#l10.48"></a><span id="l10.48">     </span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-    duplicateTab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-      this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+    duplicateTab.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2DupLBLoad(aEvent) {</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+      this.removeEventListener(&quot;load&quot;, testTab2DupLBLoad, true);</span>
<a href="#l10.53"></a><span id="l10.53">       // verify the correctness of the duplicated tab</span>
<a href="#l10.54"></a><span id="l10.54">       ok(ss.getTabValue(duplicateTab, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l10.55"></a><span id="l10.55">          &quot;correctly duplicated the tab's state&quot;);</span>
<a href="#l10.56"></a><span id="l10.56">       let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l10.57"></a><span id="l10.57">       is(textbox.value, value3, &quot;also duplicated text data&quot;);</span>
<a href="#l10.58"></a><span id="l10.58">       </span>
<a href="#l10.59"></a><span id="l10.59">       // clean up</span>
<a href="#l10.60"></a><span id="l10.60">       getBrowser().removeTab(duplicateTab);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/common/tests/browser/browser_423132.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_423132.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -30,23 +30,23 @@ function test() {</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">   const testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l11.6"></a><span id="l11.6">     &quot;suite/common/tests/browser/browser_423132_sample.html&quot;;</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">   // open a new window</span>
<a href="#l11.9"></a><span id="l11.9">   let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;, &quot;about:blank&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">   // make sure sessionstore saves the cookie data, then close the window</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  newWin.addEventListener(&quot;load&quot;, function (aEvent) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    newWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  newWin.addEventListener(&quot;load&quot;, function testNewWinLoad(aEvent) {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    newWin.removeEventListener(&quot;load&quot;, testNewWinLoad, false);</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">     newWin.getBrowser().selectedBrowser.loadURI(testURL, null, null);</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-    newWin.getBrowser().addEventListener(&quot;pageshow&quot;, function (aEvent) {</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-      newWin.getBrowser().removeEventListener(&quot;pageshow&quot;, arguments.callee, true);</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+    newWin.getBrowser().addEventListener(&quot;pageshow&quot;, function testNewWinPageShow(aEvent) {</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+      newWin.getBrowser().removeEventListener(&quot;pageshow&quot;, testNewWinPageShow, true);</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">       // get the sessionstore state for the window</span>
<a href="#l11.25"></a><span id="l11.25">       let state = ss.getWindowState(newWin);</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">       // verify our cookie got set during pageload</span>
<a href="#l11.28"></a><span id="l11.28">       let e = cs.enumerator;</span>
<a href="#l11.29"></a><span id="l11.29">       let cookie;</span>
<a href="#l11.30"></a><span id="l11.30">       let i = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/common/tests/browser/browser_447951.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_447951.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -5,27 +5,27 @@</span>
<a href="#l12.4"></a><span id="l12.4"> function test() {</span>
<a href="#l12.5"></a><span id="l12.5">   /** Test for Bug 447951 **/</span>
<a href="#l12.6"></a><span id="l12.6">   </span>
<a href="#l12.7"></a><span id="l12.7">   waitForExplicitFinish();</span>
<a href="#l12.8"></a><span id="l12.8">   const baseURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l12.9"></a><span id="l12.9">     &quot;suite/common/tests/browser/browser_447951_sample.html#&quot;;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">   let tab = getBrowser().addTab();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l12.16"></a><span id="l12.16">     </span>
<a href="#l12.17"></a><span id="l12.17">     let tabState = { entries: [] };</span>
<a href="#l12.18"></a><span id="l12.18">     let max_entries = Services.prefs.getIntPref(&quot;browser.sessionhistory.max_entries&quot;);</span>
<a href="#l12.19"></a><span id="l12.19">     for (let i = 0; i &lt; max_entries; i++)</span>
<a href="#l12.20"></a><span id="l12.20">       tabState.entries.push({ url: baseURL + i });</span>
<a href="#l12.21"></a><span id="l12.21">     </span>
<a href="#l12.22"></a><span id="l12.22">     ss.setTabState(tab, JSON.stringify(tabState));</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-    tab.addEventListener(&quot;SSTabRestored&quot;, function(aEvent) {</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-      tab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, false);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+    tab.addEventListener(&quot;SSTabRestored&quot;, function testTabSSTabRestored(aEvent) {</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+      tab.removeEventListener(&quot;SSTabRestored&quot;, testTabSSTabRestored, false);</span>
<a href="#l12.27"></a><span id="l12.27">       tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l12.28"></a><span id="l12.28">       is(tabState.entries.length, max_entries, &quot;session history filled to the limit&quot;);</span>
<a href="#l12.29"></a><span id="l12.29">       is(tabState.entries[0].url, baseURL + 0, &quot;... but not more&quot;);</span>
<a href="#l12.30"></a><span id="l12.30">       </span>
<a href="#l12.31"></a><span id="l12.31">       // visit yet another anchor (appending it to session history)</span>
<a href="#l12.32"></a><span id="l12.32">       let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l12.33"></a><span id="l12.33">       let event = doc.createEvent(&quot;MouseEvents&quot;);</span>
<a href="#l12.34"></a><span id="l12.34">       event.initMouseEvent(&quot;click&quot;, true, true, doc.defaultView, 1,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/common/tests/browser/browser_454908.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_454908.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -13,27 +13,27 @@ function test() {</span>
<a href="#l13.4"></a><span id="l13.4">   };</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">   // make sure we do save form data</span>
<a href="#l13.7"></a><span id="l13.7">   Services.prefs.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l13.8"></a><span id="l13.8">   </span>
<a href="#l13.9"></a><span id="l13.9">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l13.10"></a><span id="l13.10">   let testURL = rootDir + &quot;browser_454908_sample.html&quot;;</span>
<a href="#l13.11"></a><span id="l13.11">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l13.16"></a><span id="l13.16">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l13.17"></a><span id="l13.17">     for (let id in fieldValues)</span>
<a href="#l13.18"></a><span id="l13.18">       doc.getElementById(id).value = fieldValues[id];</span>
<a href="#l13.19"></a><span id="l13.19">     </span>
<a href="#l13.20"></a><span id="l13.20">     getBrowser().removeTab(tab);</span>
<a href="#l13.21"></a><span id="l13.21">     </span>
<a href="#l13.22"></a><span id="l13.22">     tab = getBrowser().undoCloseTab();</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-    tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-      tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad2(aEvent) {</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+      tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad2, true);</span>
<a href="#l13.27"></a><span id="l13.27">       let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l13.28"></a><span id="l13.28">       for (let id in fieldValues) {</span>
<a href="#l13.29"></a><span id="l13.29">         let node = doc.getElementById(id);</span>
<a href="#l13.30"></a><span id="l13.30">         if (node.type == &quot;password&quot;)</span>
<a href="#l13.31"></a><span id="l13.31">           is(node.value, &quot;&quot;, &quot;password wasn't saved/restored&quot;);</span>
<a href="#l13.32"></a><span id="l13.32">         else</span>
<a href="#l13.33"></a><span id="l13.33">           is(node.value, fieldValues[id], &quot;username was saved/restored&quot;);</span>
<a href="#l13.34"></a><span id="l13.34">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/common/tests/browser/browser_456342.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_456342.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -8,18 +8,18 @@ function test() {</span>
<a href="#l14.4"></a><span id="l14.4">   waitForExplicitFinish();</span>
<a href="#l14.5"></a><span id="l14.5">   </span>
<a href="#l14.6"></a><span id="l14.6">   // make sure we do save form data</span>
<a href="#l14.7"></a><span id="l14.7">   Services.prefs.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l14.8"></a><span id="l14.8">   </span>
<a href="#l14.9"></a><span id="l14.9">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l14.10"></a><span id="l14.10">   let testURL = rootDir + &quot;browser_456342_sample.xhtml&quot;;</span>
<a href="#l14.11"></a><span id="l14.11">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    this.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+    this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">     let expectedValue = &quot;try to save me&quot;;</span>
<a href="#l14.18"></a><span id="l14.18">     // Since bug 537289 we only save non-default values, so we need to set each</span>
<a href="#l14.19"></a><span id="l14.19">     // form field's value after load.</span>
<a href="#l14.20"></a><span id="l14.20">     let formEls = aEvent.originalTarget.forms[0].elements;</span>
<a href="#l14.21"></a><span id="l14.21">     for (let i = 0; i &lt; formEls.length; i++)</span>
<a href="#l14.22"></a><span id="l14.22">       formEls[i].value = expectedValue;</span>
<a href="#l14.23"></a><span id="l14.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/common/tests/browser/browser_463206.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_463206.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -8,41 +8,41 @@ function test() {</span>
<a href="#l15.4"></a><span id="l15.4">   waitForExplicitFinish();</span>
<a href="#l15.5"></a><span id="l15.5">   </span>
<a href="#l15.6"></a><span id="l15.6">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l15.7"></a><span id="l15.7">     &quot;suite/common/tests/browser/browser_463206_sample.html&quot;;</span>
<a href="#l15.8"></a><span id="l15.8">   </span>
<a href="#l15.9"></a><span id="l15.9">   var frameCount = 0;</span>
<a href="#l15.10"></a><span id="l15.10">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l15.11"></a><span id="l15.11">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l15.14"></a><span id="l15.14">     // wait for all frames to load completely</span>
<a href="#l15.15"></a><span id="l15.15">     if (frameCount++ &lt; 5)</span>
<a href="#l15.16"></a><span id="l15.16">       return;</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l15.19"></a><span id="l15.19">     function typeText(aTextField, aValue) {</span>
<a href="#l15.20"></a><span id="l15.20">       aTextField.value = aValue;</span>
<a href="#l15.21"></a><span id="l15.21">       </span>
<a href="#l15.22"></a><span id="l15.22">       let event = aTextField.ownerDocument.createEvent(&quot;UIEvents&quot;);</span>
<a href="#l15.23"></a><span id="l15.23">       event.initUIEvent(&quot;input&quot;, true, true, aTextField.ownerDocument.defaultView, 0);</span>
<a href="#l15.24"></a><span id="l15.24">       aTextField.dispatchEvent(event);</span>
<a href="#l15.25"></a><span id="l15.25">     }</span>
<a href="#l15.26"></a><span id="l15.26">     </span>
<a href="#l15.27"></a><span id="l15.27">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l15.28"></a><span id="l15.28">     typeText(doc.getElementById(&quot;out1&quot;), Date.now());</span>
<a href="#l15.29"></a><span id="l15.29">     typeText(doc.getElementsByName(&quot;1|#out2&quot;)[0], Math.random());</span>
<a href="#l15.30"></a><span id="l15.30">     typeText(doc.defaultView.frames[0].frames[1].document.getElementById(&quot;in1&quot;), new Date());</span>
<a href="#l15.31"></a><span id="l15.31">     </span>
<a href="#l15.32"></a><span id="l15.32">     frameCount = 0;</span>
<a href="#l15.33"></a><span id="l15.33">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l15.36"></a><span id="l15.36">       // wait for all frames to load completely</span>
<a href="#l15.37"></a><span id="l15.37">       if (frameCount++ &lt; 5)</span>
<a href="#l15.38"></a><span id="l15.38">         return;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42">       let doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l15.43"></a><span id="l15.43">       let win = tab2.linkedBrowser.contentWindow;</span>
<a href="#l15.44"></a><span id="l15.44">       isnot(doc.getElementById(&quot;out1&quot;).value,</span>
<a href="#l15.45"></a><span id="l15.45">             win.frames[1].document.getElementById(&quot;out1&quot;).value,</span>
<a href="#l15.46"></a><span id="l15.46">             &quot;text isn't reused for frames&quot;);</span>
<a href="#l15.47"></a><span id="l15.47">       isnot(doc.getElementsByName(&quot;1|#out2&quot;)[0].value, &quot;&quot;,</span>
<a href="#l15.48"></a><span id="l15.48">             &quot;text containing | and # is correctly restored&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/common/tests/browser/browser_465215.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_465215.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -8,31 +8,31 @@ function test() {</span>
<a href="#l16.4"></a><span id="l16.4">   waitForExplicitFinish();</span>
<a href="#l16.5"></a><span id="l16.5">   </span>
<a href="#l16.6"></a><span id="l16.6">   let uniqueName = &quot;bug 465215&quot;;</span>
<a href="#l16.7"></a><span id="l16.7">   let uniqueValue1 = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l16.8"></a><span id="l16.8">   let uniqueValue2 = &quot;as good as unique: &quot; + Math.random();</span>
<a href="#l16.9"></a><span id="l16.9">   </span>
<a href="#l16.10"></a><span id="l16.10">   // set a unique value on a new, blank tab</span>
<a href="#l16.11"></a><span id="l16.11">   let tab1 = gBrowser.addTab();</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  tab1.linkedBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-    tab1.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+  tab1.linkedBrowser.addEventListener(&quot;load&quot;, function testTab1LBLoad() {</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+    tab1.linkedBrowser.removeEventListener(&quot;load&quot;, testTab1LBLoad, true);</span>
<a href="#l16.16"></a><span id="l16.16">     ss.setTabValue(tab1, uniqueName, uniqueValue1);</span>
<a href="#l16.17"></a><span id="l16.17">     </span>
<a href="#l16.18"></a><span id="l16.18">     // duplicate the tab with that value</span>
<a href="#l16.19"></a><span id="l16.19">     let tab2 = ss.duplicateTab(window, tab1);</span>
<a href="#l16.20"></a><span id="l16.20">     is(ss.getTabValue(tab2, uniqueName), uniqueValue1, &quot;tab value was duplicated&quot;);</span>
<a href="#l16.21"></a><span id="l16.21">     </span>
<a href="#l16.22"></a><span id="l16.22">     ss.setTabValue(tab2, uniqueName, uniqueValue2);</span>
<a href="#l16.23"></a><span id="l16.23">     isnot(ss.getTabValue(tab1, uniqueName), uniqueValue2, &quot;tab values aren't sync'd&quot;);</span>
<a href="#l16.24"></a><span id="l16.24">     </span>
<a href="#l16.25"></a><span id="l16.25">     // overwrite the tab with the value which should remove it</span>
<a href="#l16.26"></a><span id="l16.26">     ss.setTabState(tab1, JSON.stringify({ entries: [] }));</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-    tab1.linkedBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-      tab1.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+    tab1.linkedBrowser.addEventListener(&quot;load&quot;, function testTab1LBLoad2() {</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+      tab1.linkedBrowser.removeEventListener(&quot;load&quot;, testTab1LBLoad2, true);</span>
<a href="#l16.31"></a><span id="l16.31">       is(ss.getTabValue(tab1, uniqueName), &quot;&quot;, &quot;tab value was cleared&quot;);</span>
<a href="#l16.32"></a><span id="l16.32">       </span>
<a href="#l16.33"></a><span id="l16.33">       // clean up</span>
<a href="#l16.34"></a><span id="l16.34">       gBrowser.removeTab(tab2);</span>
<a href="#l16.35"></a><span id="l16.35">       gBrowser.removeTab(tab1);</span>
<a href="#l16.36"></a><span id="l16.36">       finish();</span>
<a href="#l16.37"></a><span id="l16.37">     }, true);</span>
<a href="#l16.38"></a><span id="l16.38">   }, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/common/tests/browser/browser_466937.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_466937.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -13,25 +13,25 @@ function test() {</span>
<a href="#l17.4"></a><span id="l17.4">   file.append(&quot;466937_test.file&quot;);</span>
<a href="#l17.5"></a><span id="l17.5">   let testPath = file.path;</span>
<a href="#l17.6"></a><span id="l17.6">   </span>
<a href="#l17.7"></a><span id="l17.7">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l17.8"></a><span id="l17.8">     &quot;suite/common/tests/browser/browser_466937_sample.html&quot;;</span>
<a href="#l17.9"></a><span id="l17.9">   </span>
<a href="#l17.10"></a><span id="l17.10">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l17.11"></a><span id="l17.11">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l17.16"></a><span id="l17.16">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l17.17"></a><span id="l17.17">     doc.getElementById(&quot;reverse_thief&quot;).value = &quot;/home/user/secret2&quot;;</span>
<a href="#l17.18"></a><span id="l17.18">     doc.getElementById(&quot;bystander&quot;).value = testPath;</span>
<a href="#l17.19"></a><span id="l17.19">     </span>
<a href="#l17.20"></a><span id="l17.20">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l17.25"></a><span id="l17.25">       doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l17.26"></a><span id="l17.26">       is(doc.getElementById(&quot;thief&quot;).value, &quot;&quot;,</span>
<a href="#l17.27"></a><span id="l17.27">          &quot;file path wasn't set to text field value&quot;);</span>
<a href="#l17.28"></a><span id="l17.28">       is(doc.getElementById(&quot;reverse_thief&quot;).value, &quot;&quot;,</span>
<a href="#l17.29"></a><span id="l17.29">          &quot;text field value wasn't set to full file path&quot;);</span>
<a href="#l17.30"></a><span id="l17.30">       is(doc.getElementById(&quot;bystander&quot;).value, testPath,</span>
<a href="#l17.31"></a><span id="l17.31">          &quot;normal case: file path was correctly preserved&quot;);</span>
<a href="#l17.32"></a><span id="l17.32">       </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/common/tests/browser/browser_466937_sample.html</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_466937_sample.html</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -3,18 +3,18 @@</span>
<a href="#l18.4"></a><span id="l18.4"> &lt;!DOCTYPE html&gt;</span>
<a href="#l18.5"></a><span id="l18.5"> &lt;title&gt;Test for bug 466937&lt;/title&gt;</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> &lt;input id=&quot;thief&quot; value=&quot;/home/user/secret&quot;&gt;</span>
<a href="#l18.8"></a><span id="l18.8"> &lt;input type=&quot;file&quot; id=&quot;reverse_thief&quot;&gt;</span>
<a href="#l18.9"></a><span id="l18.9"> &lt;input type=&quot;file&quot; id=&quot;bystander&quot;&gt;</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11"> &lt;script&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  window.addEventListener(&quot;DOMContentLoaded&quot;, function() {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-    window.removeEventListener(&quot;DOMContentLoaded&quot;, arguments.callee, false);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+  window.addEventListener(&quot;DOMContentLoaded&quot;, function windowDOMContentLoaded() {</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+    window.removeEventListener(&quot;DOMContentLoaded&quot;, windowDOMContentLoaded, false);</span>
<a href="#l18.16"></a><span id="l18.16">     if (!document.location.hash) {</span>
<a href="#l18.17"></a><span id="l18.17">       document.location.hash = &quot;#ready&quot;;</span>
<a href="#l18.18"></a><span id="l18.18">     }</span>
<a href="#l18.19"></a><span id="l18.19">     else {</span>
<a href="#l18.20"></a><span id="l18.20">       document.getElementById(&quot;thief&quot;).type = &quot;file&quot;;</span>
<a href="#l18.21"></a><span id="l18.21">       document.getElementById(&quot;reverse_thief&quot;).type = &quot;text&quot;;</span>
<a href="#l18.22"></a><span id="l18.22">     }</span>
<a href="#l18.23"></a><span id="l18.23">   }, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/common/tests/browser/browser_480893.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_480893.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -8,42 +8,42 @@ function test() {</span>
<a href="#l19.4"></a><span id="l19.4">   waitForExplicitFinish();</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6">   // Test that starting a new session loads a blank page if Firefox is</span>
<a href="#l19.7"></a><span id="l19.7">   // configured to display a blank page at startup (browser.startup.page = 0)</span>
<a href="#l19.8"></a><span id="l19.8">   Services.prefs.setIntPref(&quot;browser.startup.page&quot;, 0);</span>
<a href="#l19.9"></a><span id="l19.9">   let tab = getBrowser().addTab(&quot;about:sessionrestore&quot;);</span>
<a href="#l19.10"></a><span id="l19.10">   getBrowser().selectedTab = tab;</span>
<a href="#l19.11"></a><span id="l19.11">   let browser = tab.linkedBrowser;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-    browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+  browser.addEventListener(&quot;load&quot;, function testBrowserLoad(aEvent) {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+    browser.removeEventListener(&quot;load&quot;, testBrowserLoad, true);</span>
<a href="#l19.16"></a><span id="l19.16">     let doc = browser.contentDocument;</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18">     // click on the &quot;Start New Session&quot; button after about:sessionrestore is loaded</span>
<a href="#l19.19"></a><span id="l19.19">     doc.getElementById(&quot;errorCancel&quot;).click();</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-    browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-      browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+    browser.addEventListener(&quot;load&quot;, function testBrowserLoad2(aEvent) {</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+      browser.removeEventListener(&quot;load&quot;, testBrowserLoad2, true);</span>
<a href="#l19.24"></a><span id="l19.24">       let doc = browser.contentDocument;</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26">       is(doc.URL, &quot;about:blank&quot;, &quot;loaded page is about:blank&quot;);</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">       // Test that starting a new session loads the homepage (set to http://mochi.test:8888)</span>
<a href="#l19.29"></a><span id="l19.29">       // if Firefox is configured to display a homepage at startup (browser.startup.page = 1)</span>
<a href="#l19.30"></a><span id="l19.30">       let homepage = &quot;http://mochi.test:8888/&quot;;</span>
<a href="#l19.31"></a><span id="l19.31">       Services.prefs.setCharPref(&quot;browser.startup.homepage&quot;, homepage);</span>
<a href="#l19.32"></a><span id="l19.32">       Services.prefs.setIntPref(&quot;browser.startup.page&quot;, 1);</span>
<a href="#l19.33"></a><span id="l19.33">       getBrowser().loadURI(&quot;about:sessionrestore&quot;);</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-      browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-        browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+      browser.addEventListener(&quot;load&quot;, function testBrowserLoad3(aEvent) {</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+        browser.removeEventListener(&quot;load&quot;, testBrowserLoad3, true);</span>
<a href="#l19.38"></a><span id="l19.38">         let doc = browser.contentDocument;</span>
<a href="#l19.39"></a><span id="l19.39"> </span>
<a href="#l19.40"></a><span id="l19.40">         // click on the &quot;Start New Session&quot; button after about:sessionrestore is loaded</span>
<a href="#l19.41"></a><span id="l19.41">         doc.getElementById(&quot;errorCancel&quot;).click();</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-        browser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-          browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+        browser.addEventListener(&quot;load&quot;, function testBrowserLoad4(aEvent) {</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+          browser.removeEventListener(&quot;load&quot;, testBrowserLoad4, true);</span>
<a href="#l19.46"></a><span id="l19.46">           let doc = browser.contentDocument;</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48">           is(doc.URL, homepage, &quot;loaded page is the homepage&quot;);</span>
<a href="#l19.49"></a><span id="l19.49"> </span>
<a href="#l19.50"></a><span id="l19.50">           // close tab, restore default values and finish the test</span>
<a href="#l19.51"></a><span id="l19.51">           getBrowser().removeTab(tab);</span>
<a href="#l19.52"></a><span id="l19.52">           // we need this if-statement because if there is no user set value, </span>
<a href="#l19.53"></a><span id="l19.53">           // clearUserPref throws a uncatched exception and finish is not called</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/common/tests/browser/browser_483330.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_483330.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -3,28 +3,28 @@ function test() {</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5">   waitForExplicitFinish();</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7">   let tab = getBrowser().addTab();</span>
<a href="#l20.8"></a><span id="l20.8">   getBrowser().selectedTab = tab;</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">   let browser = tab.linkedBrowser;</span>
<a href="#l20.11"></a><span id="l20.11">   browser.addEventListener(&quot;load&quot;, function loadListener(e) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    browser.removeEventListener(&quot;load&quot;, loadListener, true);</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15">     // Scroll the content document</span>
<a href="#l20.16"></a><span id="l20.16">     browser.contentWindow.scrollTo(1100, 1200);</span>
<a href="#l20.17"></a><span id="l20.17">     is(browser.contentWindow.scrollX, 1100, &quot;scrolled horizontally&quot;);</span>
<a href="#l20.18"></a><span id="l20.18">     is(browser.contentWindow.scrollY, 1200, &quot;scrolled vertically&quot;);</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20">     getBrowser().removeTab(tab);</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22">     let newTab = ss.undoCloseTab(window, 0);</span>
<a href="#l20.23"></a><span id="l20.23">     newTab.addEventListener(&quot;SSTabRestored&quot;, function tabRestored(e) {</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-      newTab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, true);</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+      newTab.removeEventListener(&quot;SSTabRestored&quot;, tabRestored, true);</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">       let newBrowser = newTab.linkedBrowser;</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">       // check that the scroll position was restored</span>
<a href="#l20.30"></a><span id="l20.30">       is(newBrowser.contentWindow.scrollX, 1100, &quot;still scrolled horizontally&quot;);</span>
<a href="#l20.31"></a><span id="l20.31">       is(newBrowser.contentWindow.scrollY, 1200, &quot;still scrolled vertically&quot;);</span>
<a href="#l20.32"></a><span id="l20.32"> </span>
<a href="#l20.33"></a><span id="l20.33">       getBrowser().removeTab(newTab);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/common/tests/browser/browser_485482.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_485482.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -7,25 +7,25 @@ function test() {</span>
<a href="#l21.4"></a><span id="l21.4">   </span>
<a href="#l21.5"></a><span id="l21.5">   waitForExplicitFinish();</span>
<a href="#l21.6"></a><span id="l21.6">   </span>
<a href="#l21.7"></a><span id="l21.7">   let uniqueValue = Math.random();</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l21.10"></a><span id="l21.10">   let testURL = rootDir + &quot;browser_485482_sample.html&quot;;</span>
<a href="#l21.11"></a><span id="l21.11">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l21.16"></a><span id="l21.16">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l21.17"></a><span id="l21.17">     doc.querySelector(&quot;input[type=text]&quot;).value = uniqueValue;</span>
<a href="#l21.18"></a><span id="l21.18">     doc.querySelector(&quot;input[type=checkbox]&quot;).checked = true;</span>
<a href="#l21.19"></a><span id="l21.19">     </span>
<a href="#l21.20"></a><span id="l21.20">     let tab2 = ss.duplicateTab(window, tab);</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">-    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l21.25"></a><span id="l21.25">       doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l21.26"></a><span id="l21.26">       is(doc.querySelector(&quot;input[type=text]&quot;).value, uniqueValue,</span>
<a href="#l21.27"></a><span id="l21.27">          &quot;generated XPath expression was valid&quot;);</span>
<a href="#l21.28"></a><span id="l21.28">       ok(doc.querySelector(&quot;input[type=checkbox]&quot;).checked,</span>
<a href="#l21.29"></a><span id="l21.29">          &quot;generated XPath expression was valid&quot;);</span>
<a href="#l21.30"></a><span id="l21.30">       </span>
<a href="#l21.31"></a><span id="l21.31">       // clean up</span>
<a href="#l21.32"></a><span id="l21.32">       getBrowser().removeTab(tab2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/common/tests/browser/browser_490040.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_490040.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -30,25 +30,26 @@ function test() {</span>
<a href="#l22.4"></a><span id="l22.4">     function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l22.5"></a><span id="l22.5">       let theWin = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l22.6"></a><span id="l22.6">       if (origWin &amp;&amp; theWin != origWin)</span>
<a href="#l22.7"></a><span id="l22.7">         return;</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9">       switch (aTopic) {</span>
<a href="#l22.10"></a><span id="l22.10">         case &quot;domwindowopened&quot;:</span>
<a href="#l22.11"></a><span id="l22.11">           origWin = theWin;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-          theWin.addEventListener(&quot;load&quot;, function () {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-            theWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+          theWin.addEventListener(&quot;load&quot;, function testTheWinLoad() {</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+            theWin.removeEventListener(&quot;load&quot;, testTheWinLoad, false);</span>
<a href="#l22.16"></a><span id="l22.16">             executeSoon(function () {</span>
<a href="#l22.17"></a><span id="l22.17">               // Close the window as soon as the first tab loads, or</span>
<a href="#l22.18"></a><span id="l22.18">               // immediately if there are no tabs.</span>
<a href="#l22.19"></a><span id="l22.19">               if (aState.windowState.windows[0].tabs[0].entries.length) {</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-                theWin.gBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-                  theWin.gBrowser.removeEventListener(&quot;load&quot;,</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-                                                      arguments.callee, true);</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+                theWin.gBrowser.addEventListener(&quot;load&quot;,</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+                                                   function testTheWinLoad2() {</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+                  theWin.gBrowser.removeEventListener(&quot;load&quot;, testTheWinLoad2,</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+                                                        true);</span>
<a href="#l22.27"></a><span id="l22.27">                   theWin.close();</span>
<a href="#l22.28"></a><span id="l22.28">                 }, true);</span>
<a href="#l22.29"></a><span id="l22.29">               } else {</span>
<a href="#l22.30"></a><span id="l22.30">                 executeSoon(function () {</span>
<a href="#l22.31"></a><span id="l22.31">                   theWin.close();</span>
<a href="#l22.32"></a><span id="l22.32">                 });</span>
<a href="#l22.33"></a><span id="l22.33">               }</span>
<a href="#l22.34"></a><span id="l22.34">               ss.setWindowState(theWin, JSON.stringify(aState.windowState),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/common/tests/browser/browser_491168.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_491168.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -23,34 +23,34 @@ function test() {</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">   const REFERRER1 = &quot;http://example.org/?&quot; + Date.now();</span>
<a href="#l23.6"></a><span id="l23.6">   const REFERRER2 = &quot;http://example.org/?&quot; + Math.random();</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">   let tab = getBrowser().addTab();</span>
<a href="#l23.9"></a><span id="l23.9">   getBrowser().selectedTab = tab;</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">   let browser = tab.linkedBrowser;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  browser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-    browser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+  browser.addEventListener(&quot;load&quot;, function testBrowserLoad() {</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+    browser.removeEventListener(&quot;load&quot;, testBrowserLoad, true);</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17">     let tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l23.18"></a><span id="l23.18">     is(tabState.entries[0].referrer,  REFERRER1,</span>
<a href="#l23.19"></a><span id="l23.19">        &quot;Referrer retrieved via getTabState matches referrer set via loadURI.&quot;);</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">     tabState.entries[0].referrer = REFERRER2;</span>
<a href="#l23.22"></a><span id="l23.22">     ss.setTabState(tab, JSON.stringify(tabState));</span>
<a href="#l23.23"></a><span id="l23.23"> </span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-    tab.addEventListener(&quot;SSTabRestored&quot;, function() {</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-      tab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, true);</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+    tab.addEventListener(&quot;SSTabRestored&quot;, function testBrowserTabRestored() {</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+      tab.removeEventListener(&quot;SSTabRestored&quot;, testBrowserTabRestored, true);</span>
<a href="#l23.28"></a><span id="l23.28">       is(window.content.document.referrer, REFERRER2, &quot;document.referrer matches referrer set via setTabState.&quot;);</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30">       getBrowser().removeTab(tab);</span>
<a href="#l23.31"></a><span id="l23.31">       let newTab = ss.undoCloseTab(window, 0);</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-      newTab.addEventListener(&quot;SSTabRestored&quot;, function() {</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-        newTab.removeEventListener(&quot;SSTabRestored&quot;, arguments.callee, true);</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+      newTab.addEventListener(&quot;SSTabRestored&quot;, function testBrowserNewTabRest() {</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+        newTab.removeEventListener(&quot;SSTabRestored&quot;, testBrowserNewTabRest, true);</span>
<a href="#l23.36"></a><span id="l23.36"> </span>
<a href="#l23.37"></a><span id="l23.37">         is(window.content.document.referrer, REFERRER2, &quot;document.referrer is still correct after closing and reopening the tab.&quot;);</span>
<a href="#l23.38"></a><span id="l23.38">         getBrowser().removeTab(newTab);</span>
<a href="#l23.39"></a><span id="l23.39"> </span>
<a href="#l23.40"></a><span id="l23.40">         is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l23.41"></a><span id="l23.41">         // clean up</span>
<a href="#l23.42"></a><span id="l23.42">         if (Services.prefs.prefHasUserValue(&quot;browser.tabs.max_tabs_undo&quot;))</span>
<a href="#l23.43"></a><span id="l23.43">           Services.prefs.clearUserPref(&quot;browser.tabs.max_tabs_undo&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/common/tests/browser/browser_500328.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_500328.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -7,17 +7,17 @@ function checkState(tab) {</span>
<a href="#l24.4"></a><span id="l24.4">   // from the popState event are as we expect them to be.</span>
<a href="#l24.5"></a><span id="l24.5">   //</span>
<a href="#l24.6"></a><span id="l24.6">   // We also add a node to the document's body when after going back and make</span>
<a href="#l24.7"></a><span id="l24.7">   // sure it's still there after we go forward -- this is to test that the two</span>
<a href="#l24.8"></a><span id="l24.8">   // history entries correspond to the same document.</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">   let popStateCount = 0;</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  tab.linkedBrowser.addEventListener('popstate', function(aEvent) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  tab.linkedBrowser.addEventListener('popstate', function checkStateTabPopState(aEvent) {</span>
<a href="#l24.14"></a><span id="l24.14">     let contentWindow = tab.linkedBrowser.contentWindow;</span>
<a href="#l24.15"></a><span id="l24.15">     if (popStateCount == 0) {</span>
<a href="#l24.16"></a><span id="l24.16">       popStateCount++;</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18">       is(tab.linkedBrowser.contentWindow.testState, 'foo',</span>
<a href="#l24.19"></a><span id="l24.19">          'testState after going back');</span>
<a href="#l24.20"></a><span id="l24.20"> </span>
<a href="#l24.21"></a><span id="l24.21">       ok(aEvent.state, &quot;Event should have a state property.&quot;);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -43,17 +43,18 @@ function checkState(tab) {</span>
<a href="#l24.23"></a><span id="l24.23">       // previous entry, which is bad.</span>
<a href="#l24.24"></a><span id="l24.24">       let doc = contentWindow.document;</span>
<a href="#l24.25"></a><span id="l24.25">       let newElem = doc.getElementById(&quot;new-elem&quot;);</span>
<a href="#l24.26"></a><span id="l24.26">       ok(newElem, &quot;doc should contain new-elem.&quot;);</span>
<a href="#l24.27"></a><span id="l24.27">       newElem.parentNode.removeChild(newElem);</span>
<a href="#l24.28"></a><span id="l24.28">       ok(!doc.getElementById(&quot;new-elem&quot;), &quot;new-elem should be removed.&quot;);</span>
<a href="#l24.29"></a><span id="l24.29"> </span>
<a href="#l24.30"></a><span id="l24.30">       // Clean up after ourselves and finish the test.</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-      tab.linkedBrowser.removeEventListener(&quot;popstate&quot;, arguments.callee, true);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+      tab.linkedBrowser.removeEventListener(&quot;popstate&quot;, checkStateTabPopState,</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+                                              true);</span>
<a href="#l24.34"></a><span id="l24.34">       getBrowser().removeTab(tab);</span>
<a href="#l24.35"></a><span id="l24.35">       finish();</span>
<a href="#l24.36"></a><span id="l24.36">     }</span>
<a href="#l24.37"></a><span id="l24.37">   }, true);</span>
<a href="#l24.38"></a><span id="l24.38"> </span>
<a href="#l24.39"></a><span id="l24.39">   // Set some state in the page's window.  When we go back(), the page should</span>
<a href="#l24.40"></a><span id="l24.40">   // be retrieved from bfcache, and this state should still be there.</span>
<a href="#l24.41"></a><span id="l24.41">   tab.linkedBrowser.contentWindow.testState = 'foo';</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineat">@@ -69,23 +70,23 @@ function test() {</span>
<a href="#l24.43"></a><span id="l24.43">   waitForExplicitFinish();</span>
<a href="#l24.44"></a><span id="l24.44"> </span>
<a href="#l24.45"></a><span id="l24.45">   // We open a new blank window, let it load, and then load in</span>
<a href="#l24.46"></a><span id="l24.46">   // http://example.com.  We need to load the blank window first, otherwise the</span>
<a href="#l24.47"></a><span id="l24.47">   // docshell gets confused and doesn't have a current history entry.</span>
<a href="#l24.48"></a><span id="l24.48">   let tab = getBrowser().addTab(&quot;about:blank&quot;);</span>
<a href="#l24.49"></a><span id="l24.49">   let tabBrowser = tab.linkedBrowser;</span>
<a href="#l24.50"></a><span id="l24.50"> </span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-  tabBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-    tabBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+  tabBrowser.addEventListener(&quot;load&quot;, function testTabBrowserLoad(aEvent) {</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+    tabBrowser.removeEventListener(&quot;load&quot;, testTabBrowserLoad, true);</span>
<a href="#l24.55"></a><span id="l24.55"> </span>
<a href="#l24.56"></a><span id="l24.56">     tabBrowser.loadURI(&quot;http://example.com&quot;, null, null);</span>
<a href="#l24.57"></a><span id="l24.57"> </span>
<a href="#l24.58"></a><span id="l24.58" class="difflineminus">-    tabBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineminus">-      tabBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+    tabBrowser.addEventListener(&quot;load&quot;, function testTabBrowserLoad2(aEvent) {</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+      tabBrowser.removeEventListener(&quot;load&quot;, testTabBrowserLoad2, true);</span>
<a href="#l24.62"></a><span id="l24.62"> </span>
<a href="#l24.63"></a><span id="l24.63">       // After these push/replaceState calls, the window should have three</span>
<a href="#l24.64"></a><span id="l24.64">       // history entries:</span>
<a href="#l24.65"></a><span id="l24.65">       //   testURL        (state object: null)          &lt;-- oldest</span>
<a href="#l24.66"></a><span id="l24.66">       //   testURL        (state object: {obj1:1})</span>
<a href="#l24.67"></a><span id="l24.67">       //   testURL?page2  (state object: {obj3:/^a$/})  &lt;-- newest</span>
<a href="#l24.68"></a><span id="l24.68">       let contentWindow = tab.linkedBrowser.contentWindow;</span>
<a href="#l24.69"></a><span id="l24.69">       let history = contentWindow.history;</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineat">@@ -97,18 +98,18 @@ function test() {</span>
<a href="#l24.71"></a><span id="l24.71">       getBrowser().removeTab(tab);</span>
<a href="#l24.72"></a><span id="l24.72"> </span>
<a href="#l24.73"></a><span id="l24.73">       // Restore the state into a new tab.  Things don't work well when we</span>
<a href="#l24.74"></a><span id="l24.74">       // restore into the old tab, but that's not a real use case anyway.</span>
<a href="#l24.75"></a><span id="l24.75">       let tab2 = getBrowser().addTab(&quot;about:blank&quot;);</span>
<a href="#l24.76"></a><span id="l24.76">       ss.setTabState(tab2, state, true);</span>
<a href="#l24.77"></a><span id="l24.77"> </span>
<a href="#l24.78"></a><span id="l24.78">       // Run checkState() once the tab finishes loading its restored state.</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineminus">-      tab2.linkedBrowser.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineminus">-        tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineplus">+      tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTBTab2LBLoad() {</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineplus">+        tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTBTab2LBLoad, true);</span>
<a href="#l24.83"></a><span id="l24.83">         SimpleTest.executeSoon(function() {</span>
<a href="#l24.84"></a><span id="l24.84">           checkState(tab2);</span>
<a href="#l24.85"></a><span id="l24.85">         });</span>
<a href="#l24.86"></a><span id="l24.86">       }, true);</span>
<a href="#l24.87"></a><span id="l24.87"> </span>
<a href="#l24.88"></a><span id="l24.88">     }, true);</span>
<a href="#l24.89"></a><span id="l24.89">   }, true);</span>
<a href="#l24.90"></a><span id="l24.90"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/common/tests/browser/browser_514751.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_514751.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -19,18 +19,18 @@ function test() {</span>
<a href="#l25.4"></a><span id="l25.4">   };</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">   let windowObserver = {</span>
<a href="#l25.7"></a><span id="l25.7">     observe: function(aSubject, aTopic, aData) {</span>
<a href="#l25.8"></a><span id="l25.8">       let theWin = aSubject.QueryInterface(Ci.nsIDOMWindow);</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10">       switch(aTopic) {</span>
<a href="#l25.11"></a><span id="l25.11">         case &quot;domwindowopened&quot;:</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-          theWin.addEventListener(&quot;load&quot;, function () {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-            theWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+          theWin.addEventListener(&quot;load&quot;, function testTheWinLoad() {</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+            theWin.removeEventListener(&quot;load&quot;, testTheWinLoad, false);</span>
<a href="#l25.16"></a><span id="l25.16">             executeSoon(function() {</span>
<a href="#l25.17"></a><span id="l25.17">               var gotError = false;</span>
<a href="#l25.18"></a><span id="l25.18">               try {</span>
<a href="#l25.19"></a><span id="l25.19">                 ss.setWindowState(theWin, JSON.stringify(state), true);</span>
<a href="#l25.20"></a><span id="l25.20">               } catch (e) {</span>
<a href="#l25.21"></a><span id="l25.21">                 if (/NS_ERROR_MALFORMED_URI/.test(e))</span>
<a href="#l25.22"></a><span id="l25.22">                   gotError = true;</span>
<a href="#l25.23"></a><span id="l25.23">               }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/common/tests/browser/browser_524745.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_524745.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -17,18 +17,18 @@ function test() {</span>
<a href="#l26.4"></a><span id="l26.4">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">   let uniqKey = &quot;bug524745&quot;;</span>
<a href="#l26.7"></a><span id="l26.7">   let uniqVal = Date.now();</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   waitForExplicitFinish();</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11">   let window_B = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  window_B.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-    window_B.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+  window_B.addEventListener(&quot;load&quot;, function testWindowBLoad(aEvent) {</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+    window_B.removeEventListener(&quot;load&quot;, testWindowBLoad, false);</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">       waitForFocus(function() {</span>
<a href="#l26.18"></a><span id="l26.18">         // Add identifying information to window_B</span>
<a href="#l26.19"></a><span id="l26.19">         ss.setWindowValue(window_B, uniqKey, uniqVal);</span>
<a href="#l26.20"></a><span id="l26.20">         let state = JSON.parse(ss.getBrowserState());</span>
<a href="#l26.21"></a><span id="l26.21">         let selectedWindow = state.windows[state.selectedWindow - 1];</span>
<a href="#l26.22"></a><span id="l26.22">         is(selectedWindow.extData &amp;&amp; selectedWindow.extData[uniqKey], uniqVal,</span>
<a href="#l26.23"></a><span id="l26.23">            &quot;selectedWindow is window_B&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/suite/common/tests/browser/browser_586068-cascaded_restore.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_586068-cascaded_restore.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -244,18 +244,18 @@ function test_multiWindowState() {</span>
<a href="#l27.4"></a><span id="l27.4">     window.getBrowser().removeTabsProgressListener(progressListener);</span>
<a href="#l27.5"></a><span id="l27.5">     runNextTest();</span>
<a href="#l27.6"></a><span id="l27.6">   }</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   // We also want to catch the 2nd window, so we need to observe domwindowopened</span>
<a href="#l27.9"></a><span id="l27.9">   function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l27.10"></a><span id="l27.10">     let theWin = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l27.11"></a><span id="l27.11">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-      theWin.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-        theWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+      theWin.addEventListener(&quot;load&quot;, function theWinLoad() {</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+        theWin.removeEventListener(&quot;load&quot;, theWinLoad, false);</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17">         Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l27.18"></a><span id="l27.18">         theWin.getBrowser().addTabsProgressListener(progressListener);</span>
<a href="#l27.19"></a><span id="l27.19">       }, false);</span>
<a href="#l27.20"></a><span id="l27.20">     }</span>
<a href="#l27.21"></a><span id="l27.21">   }</span>
<a href="#l27.22"></a><span id="l27.22">   Services.ww.registerNotification(windowObserver);</span>
<a href="#l27.23"></a><span id="l27.23"> </span>
<a href="#l27.24"></a><span id="l27.24" class="difflineat">@@ -507,18 +507,18 @@ function test_setBrowserStateInterrupted</span>
<a href="#l27.25"></a><span id="l27.25">     Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l27.26"></a><span id="l27.26">     runNextTest();</span>
<a href="#l27.27"></a><span id="l27.27">   }</span>
<a href="#l27.28"></a><span id="l27.28"> </span>
<a href="#l27.29"></a><span id="l27.29">   // We also want to catch the extra windows (there should be 2), so we need to observe domwindowopened</span>
<a href="#l27.30"></a><span id="l27.30">   function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l27.31"></a><span id="l27.31">     let theWin = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l27.32"></a><span id="l27.32">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">-      theWin.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-        theWin.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+      theWin.addEventListener(&quot;load&quot;, function wObserverTheWinLoad() {</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+        theWin.removeEventListener(&quot;load&quot;, wObserverTheWinLoad, false);</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38">         Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l27.39"></a><span id="l27.39">         theWin.getBrowser().addTabsProgressListener(progressListener);</span>
<a href="#l27.40"></a><span id="l27.40">       }, false);</span>
<a href="#l27.41"></a><span id="l27.41">     }</span>
<a href="#l27.42"></a><span id="l27.42">   }</span>
<a href="#l27.43"></a><span id="l27.43">   Services.ww.registerNotification(windowObserver);</span>
<a href="#l27.44"></a><span id="l27.44"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/common/tests/browser/browser_597315.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_597315.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -49,16 +49,16 @@ function test() {</span>
<a href="#l28.4"></a><span id="l28.4">     });</span>
<a href="#l28.5"></a><span id="l28.5">     EventUtils.sendMouseEvent({type:&quot;click&quot;}, links[0], browser_b.contentWindow);</span>
<a href="#l28.6"></a><span id="l28.6">   });</span>
<a href="#l28.7"></a><span id="l28.7"> }</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9"> // helper function</span>
<a href="#l28.10"></a><span id="l28.10"> function waitForLoadsInBrowser(aBrowser, aLoadCount, aCallback) {</span>
<a href="#l28.11"></a><span id="l28.11">   let loadCount = 0;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  aBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  aBrowser.addEventListener(&quot;load&quot;, function aBrowserLoad(aEvent) {</span>
<a href="#l28.14"></a><span id="l28.14">     if (++loadCount &lt; aLoadCount)</span>
<a href="#l28.15"></a><span id="l28.15">       return;</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-    aBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+    aBrowser.removeEventListener(&quot;load&quot;, aBrowserLoad, true);</span>
<a href="#l28.19"></a><span id="l28.19">     aCallback();</span>
<a href="#l28.20"></a><span id="l28.20">   }, true);</span>
<a href="#l28.21"></a><span id="l28.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/common/tests/browser/browser_615394-SSWindowState_events.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_615394-SSWindowState_events.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -257,18 +257,18 @@ function test_setBrowserState() {</span>
<a href="#l29.4"></a><span id="l29.4">   windowEvents[getOuterWindowID(window)] = { busyEventCount: 0, readyEventCount: 0 };</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">   // waitForBrowserState does it's own observing for windows, but doesn't attach</span>
<a href="#l29.7"></a><span id="l29.7">   // the listeners we want here, so do it ourselves.</span>
<a href="#l29.8"></a><span id="l29.8">   let newWindow;</span>
<a href="#l29.9"></a><span id="l29.9">   function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l29.10"></a><span id="l29.10">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l29.11"></a><span id="l29.11">       newWindow = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-      newWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-        newWindow.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+      newWindow.addEventListener(&quot;load&quot;, function newWindowLoad() {</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+        newWindow.removeEventListener(&quot;load&quot;, newWindowLoad, false);</span>
<a href="#l29.16"></a><span id="l29.16"> </span>
<a href="#l29.17"></a><span id="l29.17">         Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">         windowEvents[getOuterWindowID(newWindow)] = { busyEventCount: 0, readyEventCount: 0 };</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">         newWindow.addEventListener(&quot;SSWindowStateBusy&quot;, onSSWindowStateBusy, false);</span>
<a href="#l29.22"></a><span id="l29.22">         newWindow.addEventListener(&quot;SSWindowStateReady&quot;, onSSWindowStateReady, false);</span>
<a href="#l29.23"></a><span id="l29.23">       }, false);</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineat">@@ -320,18 +320,18 @@ function test_undoCloseWindow() {</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26">   waitForBrowserState(lameMultiWindowState, function() {</span>
<a href="#l29.27"></a><span id="l29.27">     // Close the window which isn't window</span>
<a href="#l29.28"></a><span id="l29.28">     newWindow.close();</span>
<a href="#l29.29"></a><span id="l29.29">     reopenedWindow = ss.undoCloseWindow(0);</span>
<a href="#l29.30"></a><span id="l29.30">     reopenedWindow.addEventListener(&quot;SSWindowStateBusy&quot;, onSSWindowStateBusy, false);</span>
<a href="#l29.31"></a><span id="l29.31">     reopenedWindow.addEventListener(&quot;SSWindowStateReady&quot;, onSSWindowStateReady, false);</span>
<a href="#l29.32"></a><span id="l29.32"> </span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">-    reopenedWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineminus">-      reopenedWindow.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineplus">+    reopenedWindow.addEventListener(&quot;load&quot;, function reopenWindowLoad() {</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineplus">+      reopenedWindow.removeEventListener(&quot;load&quot;, reopenWindowLoad, false);</span>
<a href="#l29.37"></a><span id="l29.37"> </span>
<a href="#l29.38"></a><span id="l29.38">       reopenedWindow.getBrowser().tabContainer.addEventListener(&quot;SSTabRestored&quot;, onSSTabRestored, false);</span>
<a href="#l29.39"></a><span id="l29.39">     }, false);</span>
<a href="#l29.40"></a><span id="l29.40">   });</span>
<a href="#l29.41"></a><span id="l29.41"> </span>
<a href="#l29.42"></a><span id="l29.42">   let busyEventCount = 0,</span>
<a href="#l29.43"></a><span id="l29.43">       readyEventCount = 0,</span>
<a href="#l29.44"></a><span id="l29.44">       tabRestoredCount = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/common/tests/browser/browser_form_restore_events.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_form_restore_events.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -10,18 +10,18 @@ function test() {</span>
<a href="#l30.4"></a><span id="l30.4">   let file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l30.5"></a><span id="l30.5">                        .getService(Components.interfaces.nsIProperties)</span>
<a href="#l30.6"></a><span id="l30.6">                        .get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l30.9"></a><span id="l30.9">     &quot;suite/common/tests/browser/browser_form_restore_events_sample.html&quot;;</span>
<a href="#l30.10"></a><span id="l30.10">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l30.11"></a><span id="l30.11">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  tab.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-    tab.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+    tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l30.16"></a><span id="l30.16">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18">     // text fields</span>
<a href="#l30.19"></a><span id="l30.19">     doc.getElementById(&quot;modify01&quot;).value += Math.random();</span>
<a href="#l30.20"></a><span id="l30.20">     doc.getElementById(&quot;modify02&quot;).value += &quot; &quot; + Date.now();</span>
<a href="#l30.21"></a><span id="l30.21"> </span>
<a href="#l30.22"></a><span id="l30.22">     // textareas</span>
<a href="#l30.23"></a><span id="l30.23">     doc.getElementById(&quot;modify03&quot;).value += Math.random();</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineat">@@ -40,18 +40,18 @@ function test() {</span>
<a href="#l30.25"></a><span id="l30.25">     doc.getElementById(&quot;modify09&quot;).checked = false;</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27">     // radio</span>
<a href="#l30.28"></a><span id="l30.28">     // select one then another in the same group - only last one should get event on restore</span>
<a href="#l30.29"></a><span id="l30.29">     doc.getElementById(&quot;modify10&quot;).checked = true;</span>
<a href="#l30.30"></a><span id="l30.30">     doc.getElementById(&quot;modify11&quot;).checked = true;</span>
<a href="#l30.31"></a><span id="l30.31"> </span>
<a href="#l30.32"></a><span id="l30.32">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function(aEvent) {</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, arguments.callee, true);</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+    tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+      tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l30.37"></a><span id="l30.37">       let doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l30.38"></a><span id="l30.38">       let inputFired = doc.getElementById(&quot;inputFired&quot;).textContent.trim().split();</span>
<a href="#l30.39"></a><span id="l30.39">       let changeFired = doc.getElementById(&quot;changeFired&quot;).textContent.trim().split();</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41">       is(inputFired.sort().join(&quot; &quot;), &quot;modify01 modify02 modify03 modify04 modify05&quot;,</span>
<a href="#l30.42"></a><span id="l30.42">          &quot;input events were only dispatched for modified input, textarea fields&quot;);</span>
<a href="#l30.43"></a><span id="l30.43"> </span>
<a href="#l30.44"></a><span id="l30.44">       is(changeFired.sort().join(&quot; &quot;), &quot;modify06 modify07 modify08 modify09 modify11&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/common/tests/browser/browser_markPageAsFollowedLink.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_markPageAsFollowedLink.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -38,22 +38,23 @@ let observer = {</span>
<a href="#l31.4"></a><span id="l31.4"> Services.obs.addObserver(observer, &quot;uri-visit-saved&quot;, false);</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> function test()</span>
<a href="#l31.7"></a><span id="l31.7"> {</span>
<a href="#l31.8"></a><span id="l31.8">   waitForExplicitFinish();</span>
<a href="#l31.9"></a><span id="l31.9">   gBrowser.selectedTab = gBrowser.addTab(PAGE_URL);</span>
<a href="#l31.10"></a><span id="l31.10">   let frameCount = 0;</span>
<a href="#l31.11"></a><span id="l31.11">   gBrowser.selectedTab.linkedBrowser.addEventListener(&quot;DOMContentLoaded&quot;,</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    function (event)</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    function gBrowserDOMContentLoaded(event)</span>
<a href="#l31.14"></a><span id="l31.14">     {</span>
<a href="#l31.15"></a><span id="l31.15">       // Wait for all the frames.</span>
<a href="#l31.16"></a><span id="l31.16">       if (frameCount++ &lt; 2)</span>
<a href="#l31.17"></a><span id="l31.17">         return;</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">-      gBrowser.selectedTab.linkedBrowser.removeEventListener(&quot;DOMContentLoaded&quot;, arguments.callee, false)</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+      gBrowser.selectedTab.linkedBrowser.removeEventListener(&quot;DOMContentLoaded&quot;,</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+        gBrowserDOMContentLoaded, false)</span>
<a href="#l31.21"></a><span id="l31.21">       gTabLoaded = true;</span>
<a href="#l31.22"></a><span id="l31.22">       maybeClickLink();</span>
<a href="#l31.23"></a><span id="l31.23">     }, false</span>
<a href="#l31.24"></a><span id="l31.24">   );</span>
<a href="#l31.25"></a><span id="l31.25"> }</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27"> function maybeClickLink() {</span>
<a href="#l31.28"></a><span id="l31.28">   if (gTabLoaded &amp;&amp; gLeftFrameVisited) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/common/tests/browser/head.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/common/tests/browser/head.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -51,18 +51,18 @@ function waitForBrowserState(aState, aSe</span>
<a href="#l32.4"></a><span id="l32.4">     }</span>
<a href="#l32.5"></a><span id="l32.5">   }</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7">   // Used to add our listener to further windows so we can catch SSTabRestored</span>
<a href="#l32.8"></a><span id="l32.8">   // coming from them when creating a multi-window state.</span>
<a href="#l32.9"></a><span id="l32.9">   function windowObserver(aSubject, aTopic, aData) {</span>
<a href="#l32.10"></a><span id="l32.10">     if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l32.11"></a><span id="l32.11">       let newWindow = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-      newWindow.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-        newWindow.removeEventListener(&quot;load&quot;, arguments.callee, false);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+      newWindow.addEventListener(&quot;load&quot;, function newWindowLoad() {</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+        newWindow.removeEventListener(&quot;load&quot;, newWindowLoad, false);</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17">         if (++windowsOpen == expectedWindows) {</span>
<a href="#l32.18"></a><span id="l32.18">           Services.ww.unregisterNotification(windowObserver);</span>
<a href="#l32.19"></a><span id="l32.19">           windowObserving = false;</span>
<a href="#l32.20"></a><span id="l32.20">         }</span>
<a href="#l32.21"></a><span id="l32.21"> </span>
<a href="#l32.22"></a><span id="l32.22">         // Track this window so we can remove the progress listener later</span>
<a href="#l32.23"></a><span id="l32.23">         windows.push(newWindow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/common/utilityOverlay.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/common/utilityOverlay.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -314,18 +314,18 @@ function goCustomizeToolbar(toolbox)</span>
<a href="#l33.4"></a><span id="l33.4">     if (sheetFrame.getAttribute(&quot;src&quot;) == customizeURL)</span>
<a href="#l33.5"></a><span id="l33.5">       sheetFrame.contentWindow.location.reload();</span>
<a href="#l33.6"></a><span id="l33.6">     else</span>
<a href="#l33.7"></a><span id="l33.7">       sheetFrame.setAttribute(&quot;src&quot;, customizeURL);</span>
<a href="#l33.8"></a><span id="l33.8"> </span>
<a href="#l33.9"></a><span id="l33.9">     // Open the panel, but make it invisible until the iframe has loaded so</span>
<a href="#l33.10"></a><span id="l33.10">     // that the user doesn't see a white flash.</span>
<a href="#l33.11"></a><span id="l33.11">     panel.style.visibility = &quot;hidden&quot;;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    toolbox.addEventListener(&quot;beforecustomization&quot;, function () {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-      toolbox.removeEventListener(&quot;beforecustomization&quot;, arguments.callee, false);</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+    toolbox.addEventListener(&quot;beforecustomization&quot;, function toolboxBeforeCustom() {</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+      toolbox.removeEventListener(&quot;beforecustomization&quot;, toolboxBeforeCustom, false);</span>
<a href="#l33.16"></a><span id="l33.16">       panel.style.removeProperty(&quot;visibility&quot;);</span>
<a href="#l33.17"></a><span id="l33.17">     }, false);</span>
<a href="#l33.18"></a><span id="l33.18">     panel.openPopup(toolbox, &quot;after_start&quot;, 0, 0);</span>
<a href="#l33.19"></a><span id="l33.19">     return sheetFrame.contentWindow;</span>
<a href="#l33.20"></a><span id="l33.20">   }</span>
<a href="#l33.21"></a><span id="l33.21">   else {</span>
<a href="#l33.22"></a><span id="l33.22">     return window.openDialog(customizeURL,</span>
<a href="#l33.23"></a><span id="l33.23">                              &quot;&quot;,</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineat">@@ -1510,20 +1510,20 @@ function switchToTabHavingURI(aURI, aOpe</span>
<a href="#l33.25"></a><span id="l33.25">   }</span>
<a href="#l33.26"></a><span id="l33.26"> </span>
<a href="#l33.27"></a><span id="l33.27">   // No opened tab has that url.</span>
<a href="#l33.28"></a><span id="l33.28">   if (aOpenNew) {</span>
<a href="#l33.29"></a><span id="l33.29">     let newWindowPref = Services.prefs.getIntPref(&quot;browser.link.open_external&quot;);</span>
<a href="#l33.30"></a><span id="l33.30">     let where = newWindowPref == kNewTab ? &quot;tabfocused&quot; : &quot;window&quot;;</span>
<a href="#l33.31"></a><span id="l33.31">     let browserWin = openUILinkIn(aURI.spec, where);</span>
<a href="#l33.32"></a><span id="l33.32">     if (aCallback) {</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineminus">-      browserWin.addEventListener(&quot;pageshow&quot;, function(event) {</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+      browserWin.addEventListener(&quot;pageshow&quot;, function browserWinPageShow(event) {</span>
<a href="#l33.35"></a><span id="l33.35">         if (event.target.location.href != aURI.spec)</span>
<a href="#l33.36"></a><span id="l33.36">           return;</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineminus">-        browserWin.removeEventListener(&quot;pageshow&quot;, arguments.callee, true);</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineplus">+        browserWin.removeEventListener(&quot;pageshow&quot;, browserWinPageShow, true);</span>
<a href="#l33.39"></a><span id="l33.39">         aCallback(browserWin.getBrowser().selectedBrowser);</span>
<a href="#l33.40"></a><span id="l33.40">       }, true);</span>
<a href="#l33.41"></a><span id="l33.41">     }</span>
<a href="#l33.42"></a><span id="l33.42">     return true;</span>
<a href="#l33.43"></a><span id="l33.43">   }</span>
<a href="#l33.44"></a><span id="l33.44"> </span>
<a href="#l33.45"></a><span id="l33.45">   return false;</span>
<a href="#l33.46"></a><span id="l33.46"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

