<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26570:6b0afa688835d60842c0a8d74e418a00a1d04fe1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6b0afa688835d60842c0a8d74e418a00a1d04fe1" />
<meta property="og:url" content="/comm-central/rev/6b0afa688835d60842c0a8d74e418a00a1d04fe1" />
<meta property="og:description" content="Bug 1546364 - Fix badly formatted comments in mailnews/mime. rs=reformat" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6b0afa688835d60842c0a8d74e418a00a1d04fe1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6b0afa688835d60842c0a8d74e418a00a1d04fe1">shortlog</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6b0afa688835d60842c0a8d74e418a00a1d04fe1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1">files</a> |
changeset |
<a href="/comm-central/raw-rev/6b0afa688835d60842c0a8d74e418a00a1d04fe1">raw</a>  | <a href="/comm-central/archive/6b0afa688835d60842c0a8d74e418a00a1d04fe1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1546364">Bug 1546364</a> - Fix badly formatted comments in mailnews/mime. rs=reformat
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 10 May 2019 22:15:34 +0200</td></tr>

<tr>
 <td>changeset 26570</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6b0afa688835d60842c0a8d74e418a00a1d04fe1">6b0afa688835d60842c0a8d74e418a00a1d04fe1</a></td>
</tr>



<tr>
<td>parent 26569</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cb2423b0246dc754cb22a57bdf4674803df56f0f">cb2423b0246dc754cb22a57bdf4674803df56f0f</a>
</td>
</tr>

<tr>
<td>child 26571</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/55a635377bed6cdeb57175d7e25a67b34dfce540">55a635377bed6cdeb57175d7e25a67b34dfce540</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6b0afa688835d60842c0a8d74e418a00a1d04fe1">15898</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 10 May 2019 21:58:24 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@55a635377bed [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=55a635377bed6cdeb57175d7e25a67b34dfce540">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=55a635377bed6cdeb57175d7e25a67b34dfce540&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=55a635377bed6cdeb57175d7e25a67b34dfce540&newProject=comm-central&newRevision=6b0afa688835d60842c0a8d74e418a00a1d04fe1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=55a635377bed6cdeb57175d7e25a67b34dfce540&newProject=comm-central&newRevision=6b0afa688835d60842c0a8d74e418a00a1d04fe1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=55a635377bed6cdeb57175d7e25a67b34dfce540&newProject=comm-central&newRevision=6b0afa688835d60842c0a8d74e418a00a1d04fe1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28reformat%29&revcount=50">reformat</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1546364">1546364</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1546364">Bug 1546364</a> - Fix badly formatted comments in mailnews/mime. rs=reformat
# ignore-this-changeset</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/comi18n.h">mailnews/mime/src/comi18n.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/comi18n.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/comi18n.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/comi18n.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/comi18n.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/comi18n.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimebuf.cpp">mailnews/mime/src/mimebuf.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimebuf.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimebuf.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimebuf.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimebuf.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimebuf.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimecryp.h">mailnews/mime/src/mimecryp.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimecryp.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimecryp.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimecryp.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimecryp.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimecryp.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeebod.h">mailnews/mime/src/mimeebod.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeebod.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeebod.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeebod.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeebod.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeebod.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeeobj.cpp">mailnews/mime/src/mimeeobj.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeeobj.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeeobj.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeeobj.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeeobj.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeeobj.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimehdrs.cpp">mailnews/mime/src/mimehdrs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimehdrs.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimehdrs.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimehdrs.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimehdrs.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimehdrs.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimei.cpp">mailnews/mime/src/mimei.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimei.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimei.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimei.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimei.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimei.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemapl.cpp">mailnews/mime/src/mimemapl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemapl.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemapl.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemapl.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemapl.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemapl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.cpp">mailnews/mime/src/mimemrel.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.h">mailnews/mime/src/mimemrel.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemrel.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemult.cpp">mailnews/mime/src/mimemult.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemult.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemult.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemult.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemult.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimemult.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeobj.h">mailnews/mime/src/mimeobj.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeobj.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeobj.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeobj.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeobj.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimeobj.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimepbuf.cpp">mailnews/mime/src/mimepbuf.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimepbuf.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimepbuf.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimepbuf.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimepbuf.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimepbuf.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimethtm.cpp">mailnews/mime/src/mimethtm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimethtm.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimethtm.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimethtm.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimethtm.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimethtm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimetpla.cpp">mailnews/mime/src/mimetpla.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimetpla.cpp">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimetpla.cpp">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimetpla.cpp">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimetpla.cpp">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/mimetpla.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/modlmime.h">mailnews/mime/src/modlmime.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/modlmime.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/modlmime.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/modlmime.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/modlmime.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/modlmime.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/nsStreamConverter.h">mailnews/mime/src/nsStreamConverter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/nsStreamConverter.h">file</a> |
<a href="/comm-central/annotate/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/nsStreamConverter.h">annotate</a> |
<a href="/comm-central/diff/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/nsStreamConverter.h">diff</a> |
<a href="/comm-central/comparison/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/nsStreamConverter.h">comparison</a> |
<a href="/comm-central/log/6b0afa688835d60842c0a8d74e418a00a1d04fe1/mailnews/mime/src/nsStreamConverter.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -774,18 +774,17 @@ nsresult nsMimeBaseEmitter::WriteHeaderF</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   return NS_OK;</span>
<a href="#l1.6"></a><span id="l1.6"> }</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> nsresult nsMimeBaseEmitter::WriteHeaderFieldHTMLPrefix(const nsACString &amp;name) {</span>
<a href="#l1.9"></a><span id="l1.9">   if (((mFormat == nsMimeOutput::nsMimeMessageSaveAs) &amp;&amp; (mFirstHeaders)) ||</span>
<a href="#l1.10"></a><span id="l1.10">       ((mFormat == nsMimeOutput::nsMimeMessagePrintOutput) &amp;&amp; (mFirstHeaders)))</span>
<a href="#l1.11"></a><span id="l1.11">     /* DO NOTHING */;  // rhp: Do nothing...leaving the conditional like this so</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-                       // its</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                       //      easier to see the logic of what is going on.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+                       // its easier to see the logic of what is going on.</span>
<a href="#l1.15"></a><span id="l1.15">   else {</span>
<a href="#l1.16"></a><span id="l1.16">     mHTMLHeaders.AppendLiteral(&quot;&lt;br&gt;&lt;fieldset class=\&quot;mimeAttachmentHeader\&quot;&gt;&quot;);</span>
<a href="#l1.17"></a><span id="l1.17">     if (!name.IsEmpty()) {</span>
<a href="#l1.18"></a><span id="l1.18">       mHTMLHeaders.AppendLiteral(&quot;&lt;legend class=\&quot;mimeAttachmentHeaderName\&quot;&gt;&quot;);</span>
<a href="#l1.19"></a><span id="l1.19">       nsAppendEscapedHTML(name, mHTMLHeaders);</span>
<a href="#l1.20"></a><span id="l1.20">       mHTMLHeaders.AppendLiteral(&quot;&lt;/legend&gt;&quot;);</span>
<a href="#l1.21"></a><span id="l1.21">     }</span>
<a href="#l1.22"></a><span id="l1.22">     mHTMLHeaders.AppendLiteral(&quot;&lt;/fieldset&gt;&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/mime/src/comi18n.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/mime/src/comi18n.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -12,23 +12,23 @@</span>
<a href="#l2.4"></a><span id="l2.4"> extern &quot;C&quot; {</span>
<a href="#l2.5"></a><span id="l2.5"> #endif /* __cplusplus */</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> /**</span>
<a href="#l2.8"></a><span id="l2.8">  * Decode MIME header to UTF-8.</span>
<a href="#l2.9"></a><span id="l2.9">  * Uses MIME_ConvertCharset if the decoded string needs a conversion.</span>
<a href="#l2.10"></a><span id="l2.10">  *</span>
<a href="#l2.11"></a><span id="l2.11">  *</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">- * @param header      [IN] A header to decode.</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">- * @param default_charset     [IN] Default charset to apply to ulabeled</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">- * non-UTF-8 8bit data</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">- * @param override_charset    [IN] If true, default_charset used instead of any</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">- * charset labeling other than UTF-8</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">- * @param eatContinuations    [IN] If true, unfold headers</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">- * @param result      [OUT] Decoded buffer</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+ * @param header            [IN]  A header to decode.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+ * @param default_charset   [IN]  Default charset to apply to ulabeled</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+ *                                non-UTF-8 8bit data</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+ * @param override_charset  [IN]  If true, default_charset used instead of any</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+ *                                charset labeling other than UTF-8</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+ * @param eatContinuations  [IN]  If true, unfold headers</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+ * @param result            [OUT] Decoded buffer</span>
<a href="#l2.26"></a><span id="l2.26">  */</span>
<a href="#l2.27"></a><span id="l2.27"> void MIME_DecodeMimeHeader(const char *header, const char *default_charset,</span>
<a href="#l2.28"></a><span id="l2.28">                            bool override_charset, bool eatContinuations,</span>
<a href="#l2.29"></a><span id="l2.29">                            nsACString &amp;result);</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31"> nsresult MIME_detect_charset(const char *aBuf, int32_t aLength,</span>
<a href="#l2.32"></a><span id="l2.32">                              nsACString &amp;aCharset);</span>
<a href="#l2.33"></a><span id="l2.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/mime/src/mimebuf.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/mime/src/mimebuf.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -86,24 +86,24 @@ static int convert_and_send_buffer(</span>
<a href="#l3.4"></a><span id="l3.4">     char *buf, int length, bool convert_newlines_p,</span>
<a href="#l3.5"></a><span id="l3.5">     int32_t (*per_line_fn)(char *line, uint32_t line_length, void *closure),</span>
<a href="#l3.6"></a><span id="l3.6">     void *closure) {</span>
<a href="#l3.7"></a><span id="l3.7">   /* Convert the line terminator to the native form.</span>
<a href="#l3.8"></a><span id="l3.8">    */</span>
<a href="#l3.9"></a><span id="l3.9">   char *newline;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> #if (MSG_LINEBREAK_LEN == 2)</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  /***</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  /*</span>
<a href="#l3.14"></a><span id="l3.14">    * This is a patch to support a mail DB corruption cause by earlier version</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-   *that lead to a crash. What happened is that the line terminator is</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-   *CR+NULL+LF. Therefore, we first process a line terminated by CR then a</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-   *second line that contains only NULL+LF. We need to ignore this second line.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-   *See bug http://bugzilla.mozilla.org/show_bug.cgi?id=61412 for more</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-   *information.</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-   ***/</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+   * that lead to a crash. What happened is that the line terminator is</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+   * CR+NULL+LF. Therefore, we first process a line terminated by CR then a</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+   * second line that contains only NULL+LF. We need to ignore this second line.</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+   * See bug http://bugzilla.mozilla.org/show_bug.cgi?id=61412 for more</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+   * information.</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+   */</span>
<a href="#l3.27"></a><span id="l3.27">   if (length == 2 &amp;&amp; buf[0] == 0x00 &amp;&amp; buf[1] == '\n') return 0;</span>
<a href="#l3.28"></a><span id="l3.28"> #endif</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30">   NS_ASSERTION(buf &amp;&amp; length &gt; 0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l3.31"></a><span id="l3.31">   if (!buf || length &lt;= 0) return -1;</span>
<a href="#l3.32"></a><span id="l3.32">   newline = buf + length;</span>
<a href="#l3.33"></a><span id="l3.33">   NS_ASSERTION(newline[-1] == '\r' || newline[-1] == '\n',</span>
<a href="#l3.34"></a><span id="l3.34">                &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/mime/src/mimecryp.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/mime/src/mimecryp.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -121,19 +121,19 @@ struct MimeEncryptedClass {</span>
<a href="#l4.4"></a><span id="l4.4"> };</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> extern MimeEncryptedClass mimeEncryptedClass;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> struct MimeEncrypted {</span>
<a href="#l4.9"></a><span id="l4.9">   MimeContainer container;         /* superclass variables */</span>
<a href="#l4.10"></a><span id="l4.10">   void *crypto_closure;            /* Opaque data used by decryption module. */</span>
<a href="#l4.11"></a><span id="l4.11">   MimeDecoderData *decoder_data;   /* Opaque data for the Transfer-Encoding</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                    decoder. */</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                                      decoder. */</span>
<a href="#l4.14"></a><span id="l4.14">   MimeHeaders *hdrs;               /* Headers of the enclosed object (including</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-                          the type of the *decrypted* data.) */</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+                                      the type of the *decrypted* data.) */</span>
<a href="#l4.17"></a><span id="l4.17">   MimePartBufferData *part_buffer; /* The data of the decrypted enclosed</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-                    object (see mimepbuf.h) */</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+                                      object (see mimepbuf.h) */</span>
<a href="#l4.20"></a><span id="l4.20"> };</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22"> #define MimeEncryptedClassInitializer(ITYPE, CSUPER) \</span>
<a href="#l4.23"></a><span id="l4.23">   { MimeContainerClassInitializer(ITYPE, CSUPER) }</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25"> #endif /* _MIMECRYP_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/mime/src/mimeebod.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/mime/src/mimeebod.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -21,17 +21,17 @@ struct MimeExternalBodyClass {</span>
<a href="#l5.4"></a><span id="l5.4">   MimeObjectClass object;</span>
<a href="#l5.5"></a><span id="l5.5"> };</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> extern MimeExternalBodyClass mimeExternalBodyClass;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> struct MimeExternalBody {</span>
<a href="#l5.10"></a><span id="l5.10">   MimeObject object; /* superclass variables */</span>
<a href="#l5.11"></a><span id="l5.11">   MimeHeaders *hdrs; /* headers within this external-body, which</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-              describe the network data which this body</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-              is a pointer to. */</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+                        describe the network data which this body</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                        is a pointer to. */</span>
<a href="#l5.16"></a><span id="l5.16">   char *body;        /* The &quot;phantom body&quot; of this link. */</span>
<a href="#l5.17"></a><span id="l5.17"> };</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> #define MimeExternalBodyClassInitializer(ITYPE, CSUPER) \</span>
<a href="#l5.20"></a><span id="l5.20">   { MimeObjectClassInitializer(ITYPE, CSUPER) }</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> #endif /* _MIMEEBOD_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/mime/src/mimeeobj.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/mime/src/mimeeobj.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -128,21 +128,20 @@ static int MimeExternalObject_parse_begi</span>
<a href="#l6.4"></a><span id="l6.4">       all_headers_p = false;</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6">     newopt.fancy_headers_p = true;</span>
<a href="#l6.7"></a><span id="l6.7">     newopt.headers = (all_headers_p ? MimeHeadersAll : MimeHeadersSome);</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">     /******</span>
<a href="#l6.10"></a><span id="l6.10">     RICHIE SHERRY</span>
<a href="#l6.11"></a><span id="l6.11">     GOTTA STILL DO THIS FOR QUOTING!</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-         status = MimeHeaders_write_attachment_box (obj-&gt;headers, &amp;newopt,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                                                     obj-&gt;content_type,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                                                     obj-&gt;encoding,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                                                     id_name? id_name : id,</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-    id_url, 0)</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+    status = MimeHeaders_write_attachment_box(obj-&gt;headers, &amp;newopt,</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+                                              obj-&gt;content_type,</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                                              obj-&gt;encoding,</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+                                              id_name? id_name : id, id_url, 0)</span>
<a href="#l6.21"></a><span id="l6.21">     *****/</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">     // obj-&gt;options really owns the storage for this.</span>
<a href="#l6.24"></a><span id="l6.24">     newopt.part_to_load = nullptr;</span>
<a href="#l6.25"></a><span id="l6.25">     newopt.default_charset = nullptr;</span>
<a href="#l6.26"></a><span id="l6.26">     PR_FREEIF(id);</span>
<a href="#l6.27"></a><span id="l6.27">     PR_FREEIF(id_url);</span>
<a href="#l6.28"></a><span id="l6.28">     PR_FREEIF(id_name);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -384,17 +384,17 @@ char *MimeHeaders_get(MimeHeaders *hdrs,</span>
<a href="#l7.4"></a><span id="l7.4">           PR_Free(result);</span>
<a href="#l7.5"></a><span id="l7.5">           return 0;</span>
<a href="#l7.6"></a><span id="l7.6">         }</span>
<a href="#l7.7"></a><span id="l7.7">         result = s;</span>
<a href="#l7.8"></a><span id="l7.8">         s = result + L;</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">         /* Since we are tacking more data onto the end of the header</span>
<a href="#l7.11"></a><span id="l7.11">            field, we must make it be a well-formed continuation line,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                            by separating the old and new data with CR-LF-TAB.</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+           by separating the old and new data with CR-LF-TAB.</span>
<a href="#l7.14"></a><span id="l7.14">          */</span>
<a href="#l7.15"></a><span id="l7.15">         *s++ = ','; /* #### only do this for addr headers? */</span>
<a href="#l7.16"></a><span id="l7.16">         *s++ = MSG_LINEBREAK[0];</span>
<a href="#l7.17"></a><span id="l7.17"> #if (MSG_LINEBREAK_LEN == 2)</span>
<a href="#l7.18"></a><span id="l7.18">         *s++ = MSG_LINEBREAK[1];</span>
<a href="#l7.19"></a><span id="l7.19"> #endif</span>
<a href="#l7.20"></a><span id="l7.20">         *s++ = '\t';</span>
<a href="#l7.21"></a><span id="l7.21">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/mime/src/mimei.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/mime/src/mimei.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -7,52 +7,55 @@</span>
<a href="#l8.4"></a><span id="l8.4">  * by IBM described herein are Copyright (c) International Business Machines</span>
<a href="#l8.5"></a><span id="l8.5">  * Corporation, 2000. Modifications to Mozilla code or documentation identified</span>
<a href="#l8.6"></a><span id="l8.6">  * per MPL Section 3.3</span>
<a href="#l8.7"></a><span id="l8.7">  *</span>
<a href="#l8.8"></a><span id="l8.8">  * Date             Modified by     Description of modification</span>
<a href="#l8.9"></a><span id="l8.9">  * 04/20/2000       IBM Corp.      OS/2 VisualAge build.</span>
<a href="#l8.10"></a><span id="l8.10">  */</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+// clang-format off</span>
<a href="#l8.13"></a><span id="l8.13"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-#include &quot;mimeobj.h&quot;  /*  MimeObject (abstract) */</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-#include &quot;mimecont.h&quot; /*   |--- MimeContainer (abstract) */</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-#include &quot;mimemult.h&quot; /*   |     |--- MimeMultipart (abstract) */</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-#include &quot;mimemmix.h&quot; /*   |     |     |--- MimeMultipartMixed */</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-#include &quot;mimemdig.h&quot; /*   |     |     |--- MimeMultipartDigest */</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-#include &quot;mimempar.h&quot; /*   |     |     |--- MimeMultipartParallel */</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-#include &quot;mimemalt.h&quot; /*   |     |     |--- MimeMultipartAlternative */</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-#include &quot;mimemrel.h&quot; /*   |     |     |--- MimeMultipartRelated */</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-#include &quot;mimemapl.h&quot; /*   |     |     |--- MimeMultipartAppleDouble */</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-#include &quot;mimesun.h&quot;  /*   |     |     |--- MimeSunAttachment */</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-#include &quot;mimemsig.h&quot; /*   |     |     |--- MimeMultipartSigned (abstract)*/</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+#include &quot;mimeobj.h&quot;   /*  MimeObject (abstract) */</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+#include &quot;mimecont.h&quot;  /*   |--- MimeContainer (abstract) */</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+#include &quot;mimemult.h&quot;  /*   |     |--- MimeMultipart (abstract) */</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+#include &quot;mimemmix.h&quot;  /*   |     |     |--- MimeMultipartMixed */</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+#include &quot;mimemdig.h&quot;  /*   |     |     |--- MimeMultipartDigest */</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+#include &quot;mimempar.h&quot;  /*   |     |     |--- MimeMultipartParallel */</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+#include &quot;mimemalt.h&quot;  /*   |     |     |--- MimeMultipartAlternative */</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+#include &quot;mimemrel.h&quot;  /*   |     |     |--- MimeMultipartRelated */</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+#include &quot;mimemapl.h&quot;  /*   |     |     |--- MimeMultipartAppleDouble */</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+#include &quot;mimesun.h&quot;   /*   |     |     |--- MimeSunAttachment */</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+#include &quot;mimemsig.h&quot;  /*   |     |     |--- MimeMultipartSigned (abstract)*/</span>
<a href="#l8.36"></a><span id="l8.36"> #ifdef ENABLE_SMIME</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-#  include &quot;mimemcms.h&quot; /*   |     |           |---MimeMultipartSignedCMS */</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+#include &quot;mimemcms.h&quot;  /*   |     |           |---MimeMultipartSignedCMS */</span>
<a href="#l8.39"></a><span id="l8.39"> #endif</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-#include &quot;mimecryp.h&quot; /*   |     |--- MimeEncrypted (abstract) */</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+#include &quot;mimecryp.h&quot;  /*   |     |--- MimeEncrypted (abstract) */</span>
<a href="#l8.42"></a><span id="l8.42"> #ifdef ENABLE_SMIME</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-#  include &quot;mimecms.h&quot; /*   |     |     |--- MimeEncryptedPKCS7 */</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+#include &quot;mimecms.h&quot;   /*   |     |     |--- MimeEncryptedPKCS7 */</span>
<a href="#l8.45"></a><span id="l8.45"> #endif</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-#include &quot;mimemsg.h&quot;  /*   |     |--- MimeMessage */</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-#include &quot;mimeunty.h&quot; /*   |     |--- MimeUntypedText */</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-#include &quot;mimeleaf.h&quot; /*   |--- MimeLeaf (abstract) */</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-#include &quot;mimetext.h&quot; /*   |     |--- MimeInlineText (abstract) */</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-#include &quot;mimetpla.h&quot; /*   |     |     |--- MimeInlineTextPlain */</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-#include &quot;mimethpl.h&quot; /*   |     |     |     |--- M.I.TextHTMLAsPlaintext */</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-#include &quot;mimetpfl.h&quot; /*   |     |     |--- MimeInlineTextPlainFlowed */</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-#include &quot;mimethtm.h&quot; /*   |     |     |--- MimeInlineTextHTML */</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-#include &quot;mimethsa.h&quot; /*   |     |     |     |--- M.I.TextHTMLSanitized */</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+#include &quot;mimemsg.h&quot;   /*   |     |--- MimeMessage */</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+#include &quot;mimeunty.h&quot;  /*   |     |--- MimeUntypedText */</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+#include &quot;mimeleaf.h&quot;  /*   |--- MimeLeaf (abstract) */</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+#include &quot;mimetext.h&quot;  /*   |     |--- MimeInlineText (abstract) */</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+#include &quot;mimetpla.h&quot;  /*   |     |     |--- MimeInlineTextPlain */</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+#include &quot;mimethpl.h&quot;  /*   |     |     |     |--- M.I.TextHTMLAsPlaintext */</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+#include &quot;mimetpfl.h&quot;  /*   |     |     |--- MimeInlineTextPlainFlowed */</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+#include &quot;mimethtm.h&quot;  /*   |     |     |--- MimeInlineTextHTML */</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+#include &quot;mimethsa.h&quot;  /*   |     |     |     |--- M.I.TextHTMLSanitized */</span>
<a href="#l8.64"></a><span id="l8.64"> #include &quot;mimeTextHTMLParsed.h&quot; /*|     |     |--- M.I.TextHTMLParsed */</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-#include &quot;mimetric.h&quot;           /*   |     |     |--- MimeInlineTextRichtext */</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-#include &quot;mimetenr.h&quot; /*   |     |     |     |--- MimeInlineTextEnriched */</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+#include &quot;mimetric.h&quot;  /*   |     |     |--- MimeInlineTextRichtext */</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+#include &quot;mimetenr.h&quot;  /*   |     |     |     |--- MimeInlineTextEnriched */</span>
<a href="#l8.69"></a><span id="l8.69"> /* SUPPORTED VIA PLUGIN     |     |     |--- MimeInlineTextVCard */</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-#include &quot;mimeiimg.h&quot; /*   |     |--- MimeInlineImage */</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-#include &quot;mimeeobj.h&quot; /*   |     |--- MimeExternalObject */</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-#include &quot;mimeebod.h&quot; /*   |--- MimeExternalBody */</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-                      /* If you add classes here,also add them to mimei.h */</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+#include &quot;mimeiimg.h&quot;  /*   |     |--- MimeInlineImage */</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+#include &quot;mimeeobj.h&quot;  /*   |     |--- MimeExternalObject */</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+#include &quot;mimeebod.h&quot;  /*   |--- MimeExternalBody */</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+                       /* If you add classes here,also add them to mimei.h */</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+// clang-format on</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+</span>
<a href="#l8.80"></a><span id="l8.80"> #include &quot;prlog.h&quot;</span>
<a href="#l8.81"></a><span id="l8.81"> #include &quot;prmem.h&quot;</span>
<a href="#l8.82"></a><span id="l8.82"> #include &quot;prenv.h&quot;</span>
<a href="#l8.83"></a><span id="l8.83"> #include &quot;plstr.h&quot;</span>
<a href="#l8.84"></a><span id="l8.84"> #include &quot;prlink.h&quot;</span>
<a href="#l8.85"></a><span id="l8.85"> #include &quot;prprf.h&quot;</span>
<a href="#l8.86"></a><span id="l8.86"> #include &quot;mimecth.h&quot;</span>
<a href="#l8.87"></a><span id="l8.87"> #include &quot;mimebuf.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/mime/src/mimemapl.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/mime/src/mimemapl.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -121,21 +121,20 @@ static int MimeMultipartAppleDouble_pars</span>
<a href="#l9.4"></a><span id="l9.4">         all_headers_p = false;</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">         newopt.fancy_headers_p = true;</span>
<a href="#l9.7"></a><span id="l9.7">         newopt.headers = (all_headers_p ? MimeHeadersAll : MimeHeadersSome);</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">     //</span>
<a href="#l9.10"></a><span id="l9.10">     RICHIE SHERRY</span>
<a href="#l9.11"></a><span id="l9.11">     GOTTA STILL DO THIS FOR QUOTING!</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-         status = MimeHeaders_write_attachment_box (obj-&gt;headers, &amp;newopt,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                                                     obj-&gt;content_type,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                                                     obj-&gt;encoding,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-                                                     id_name? id_name : id,</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-    id_url, 0</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+    status = MimeHeaders_write_attachment_box(obj-&gt;headers, &amp;newopt,</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+                                              obj-&gt;content_type,</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+                                              obj-&gt;encoding,</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+                                              id_name? id_name : id, id_url, 0)</span>
<a href="#l9.21"></a><span id="l9.21">     //</span>
<a href="#l9.22"></a><span id="l9.22">     *********************************************************************************/</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">     //  FAIL:</span>
<a href="#l9.25"></a><span id="l9.25">     PR_FREEIF(id);</span>
<a href="#l9.26"></a><span id="l9.26">     PR_FREEIF(id_url);</span>
<a href="#l9.27"></a><span id="l9.27">     PR_FREEIF(id_imap);</span>
<a href="#l9.28"></a><span id="l9.28">     if (status &lt; 0) return status;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1377,19 +1377,19 @@ extern &quot;C&quot; void *mime_bridge_create_disp</span>
<a href="#l10.4"></a><span id="l10.4">                                             &amp;MIME_WrapLongLines);</span>
<a href="#l10.5"></a><span id="l10.5">     msd-&gt;options-&gt;m_prefBranch-&gt;GetBoolPref(&quot;mail.fixed_width_messages&quot;,</span>
<a href="#l10.6"></a><span id="l10.6">                                             &amp;MIME_VariableWidthPlaintext);</span>
<a href="#l10.7"></a><span id="l10.7">     //</span>
<a href="#l10.8"></a><span id="l10.8">     // Charset overrides takes place here</span>
<a href="#l10.9"></a><span id="l10.9">     //</span>
<a href="#l10.10"></a><span id="l10.10">     // We have a bool pref (mail.force_user_charset) to deal with attachments.</span>
<a href="#l10.11"></a><span id="l10.11">     // 1) If true - libmime does NO conversion and just passes it through to</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    // raptor 2) If false, then we try to use the charset of the part and if not</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    // available,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-    //    the charset of the root message</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+    //    raptor</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+    // 2) If false, then we try to use the charset of the part and if not</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+    //    available, the charset of the root message</span>
<a href="#l10.18"></a><span id="l10.18">     //</span>
<a href="#l10.19"></a><span id="l10.19">     msd-&gt;options-&gt;m_prefBranch-&gt;GetBoolPref(</span>
<a href="#l10.20"></a><span id="l10.20">         &quot;mail.force_user_charset&quot;, &amp;(msd-&gt;options-&gt;force_user_charset));</span>
<a href="#l10.21"></a><span id="l10.21">     msd-&gt;options-&gt;m_prefBranch-&gt;GetBoolPref(</span>
<a href="#l10.22"></a><span id="l10.22">         &quot;mail.inline_attachments&quot;, &amp;(msd-&gt;options-&gt;show_attachment_inline_p));</span>
<a href="#l10.23"></a><span id="l10.23">     msd-&gt;options-&gt;m_prefBranch-&gt;GetBoolPref(</span>
<a href="#l10.24"></a><span id="l10.24">         &quot;mail.inline_attachments.text&quot;,</span>
<a href="#l10.25"></a><span id="l10.25">         &amp;(msd-&gt;options-&gt;show_attachment_inline_text));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -555,18 +555,18 @@ static bool MimeMultipartRelated_output_</span>
<a href="#l11.4"></a><span id="l11.4">   if (obj-&gt;options &amp;&amp; !obj-&gt;options-&gt;write_html_p</span>
<a href="#l11.5"></a><span id="l11.5"> #ifdef MIME_DRAFTS</span>
<a href="#l11.6"></a><span id="l11.6">       &amp;&amp; !obj-&gt;options-&gt;decompose_file_p</span>
<a href="#l11.7"></a><span id="l11.7"> #endif /* MIME_DRAFTS */</span>
<a href="#l11.8"></a><span id="l11.8">   ) {</span>
<a href="#l11.9"></a><span id="l11.9">     return true;</span>
<a href="#l11.10"></a><span id="l11.10">   }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  return false; /* Don't actually parse this child; we'll handle</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-            all that at eof time. */</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  // Don't actually parse this child; we'll handle all that at eof time.</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+  return false;</span>
<a href="#l11.16"></a><span id="l11.16"> }</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18"> static int MimeMultipartRelated_parse_child_line(MimeObject *obj,</span>
<a href="#l11.19"></a><span id="l11.19">                                                  const char *line,</span>
<a href="#l11.20"></a><span id="l11.20">                                                  int32_t length,</span>
<a href="#l11.21"></a><span id="l11.21">                                                  bool first_line_p) {</span>
<a href="#l11.22"></a><span id="l11.22">   MimeContainer *cont = (MimeContainer *)obj;</span>
<a href="#l11.23"></a><span id="l11.23">   MimeMultipartRelated *relobj = (MimeMultipartRelated *)obj;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -21,36 +21,34 @@ typedef struct MimeMultipartRelated Mime</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> struct MimeMultipartRelatedClass {</span>
<a href="#l12.6"></a><span id="l12.6">   MimeMultipartClass multipart;</span>
<a href="#l12.7"></a><span id="l12.7"> };</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> extern &quot;C&quot; MimeMultipartRelatedClass mimeMultipartRelatedClass;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> struct MimeMultipartRelated {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  MimeMultipart multipart; /* superclass variables */</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  MimeMultipart multipart;  // superclass variables.</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-  char* base_url; /* Base URL (if any) for the whole</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-            multipart/related. */</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+  char* base_url;  // Base URL (if any) for the whole multipart/related.</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-  char* head_buffer;         /* Buffer used to remember the text/html 'head'</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-                      part. */</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-  uint32_t head_buffer_fp;   /* Active length. */</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-  uint32_t head_buffer_size; /* How big it is. */</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+  char* head_buffer;          // Buffer used to remember the text/html 'head'</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+                              // part.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+  uint32_t head_buffer_fp;    // Active length.</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+  uint32_t head_buffer_size;  // How big it is.</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; file_buffer; /* The nsIFile of a temp file used when we</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-                                  run out of room in the head_buffer. */</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-  nsCOMPtr&lt;nsIInputStream&gt; input_file_stream;   /* A stream to it. */</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  nsCOMPtr&lt;nsIOutputStream&gt; output_file_stream; /* A stream to it. */</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; file_buffer;  // The nsIFile of a temp file used when we</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+                                  // run out of room in the head_buffer.</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  nsCOMPtr&lt;nsIInputStream&gt; input_file_stream;    // A stream to it.</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  nsCOMPtr&lt;nsIOutputStream&gt; output_file_stream;  // A stream to it.</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-  MimeHeaders* buffered_hdrs; /* The headers of the 'head' part. */</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+  MimeHeaders* buffered_hdrs;  // The headers of the 'head' part. */</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-  bool head_loaded;    /* Whether we've already passed the 'head'</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-                   part. */</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-  MimeObject* headobj; /* The actual text/html head object. */</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+  bool head_loaded;     // Whether we've already passed the 'head' part.</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+  MimeObject* headobj;  // The actual text/html head object.</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46">   PLHashTable* hash;</span>
<a href="#l12.47"></a><span id="l12.47"> </span>
<a href="#l12.48"></a><span id="l12.48">   MimeConverterOutputCallback real_output_fn;</span>
<a href="#l12.49"></a><span id="l12.49">   void* real_output_closure;</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51">   char* curtag;</span>
<a href="#l12.52"></a><span id="l12.52">   int32_t curtag_max;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/mime/src/mimemult.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/mime/src/mimemult.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -214,72 +214,59 @@ static int MimeMultipart_parse_line(cons</span>
<a href="#l13.4"></a><span id="l13.4">           if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;state &amp;&amp;</span>
<a href="#l13.5"></a><span id="l13.5">               obj-&gt;options-&gt;state-&gt;strippingPart) {</span>
<a href="#l13.6"></a><span id="l13.6">             stripping = true;</span>
<a href="#l13.7"></a><span id="l13.7">             bool detachingPart =</span>
<a href="#l13.8"></a><span id="l13.8">                 obj-&gt;options-&gt;state-&gt;detachedFilePath.Length() &gt; 0;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">             nsAutoCString fileName;</span>
<a href="#l13.11"></a><span id="l13.11">             fileName.Adopt(MimeHeaders_get_name(mult-&gt;hdrs, obj-&gt;options));</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+            // clang-format off</span>
<a href="#l13.13"></a><span id="l13.13">             if (detachingPart) {</span>
<a href="#l13.14"></a><span id="l13.14">               char *contentType =</span>
<a href="#l13.15"></a><span id="l13.15">                   MimeHeaders_get(mult-&gt;hdrs, &quot;Content-Type&quot;, false, false);</span>
<a href="#l13.16"></a><span id="l13.16">               if (contentType) {</span>
<a href="#l13.17"></a><span id="l13.17">                 MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;Content-Type: &quot;));</span>
<a href="#l13.18"></a><span id="l13.18">                 MimeWriteAString(obj, nsDependentCString(contentType));</span>
<a href="#l13.19"></a><span id="l13.19">                 PR_Free(contentType);</span>
<a href="#l13.20"></a><span id="l13.20">               }</span>
<a href="#l13.21"></a><span id="l13.21">               MimeWriteAString(obj, NS_LITERAL_CSTRING(MSG_LINEBREAK));</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-              MimeWriteAString(</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-                  obj, NS_LITERAL_CSTRING(</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-                           &quot;Content-Disposition: attachment; filename=\&quot;&quot;));</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+              MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;Content-Disposition: attachment; filename=\&quot;&quot;));</span>
<a href="#l13.26"></a><span id="l13.26">               MimeWriteAString(obj, fileName);</span>
<a href="#l13.27"></a><span id="l13.27">               MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK));</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-              MimeWriteAString(obj, NS_LITERAL_CSTRING(</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-                                        &quot;X-Mozilla-External-Attachment-URL: &quot;));</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+              MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;X-Mozilla-External-Attachment-URL: &quot;));</span>
<a href="#l13.31"></a><span id="l13.31">               MimeWriteAString(obj, obj-&gt;options-&gt;state-&gt;detachedFilePath);</span>
<a href="#l13.32"></a><span id="l13.32">               MimeWriteAString(obj, NS_LITERAL_CSTRING(MSG_LINEBREAK));</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-              MimeWriteAString(</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-                  obj, NS_LITERAL_CSTRING(</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-                           &quot;X-Mozilla-Altered: AttachmentDetached; date=\&quot;&quot;));</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+              MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;X-Mozilla-Altered: AttachmentDetached; date=\&quot;&quot;));</span>
<a href="#l13.37"></a><span id="l13.37">             } else {</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-              nsAutoCString header(</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-                  &quot;Content-Type: text/x-moz-deleted; name=\&quot;Deleted: &quot;);</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+              nsAutoCString header(&quot;Content-Type: text/x-moz-deleted; name=\&quot;Deleted: &quot;);</span>
<a href="#l13.41"></a><span id="l13.41">               header.Append(fileName);</span>
<a href="#l13.42"></a><span id="l13.42">               status = MimeWriteAString(obj, header);</span>
<a href="#l13.43"></a><span id="l13.43">               if (status &lt; 0) return status;</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-              status = MimeWriteAString(</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-                  obj, NS_LITERAL_CSTRING(</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-                           &quot;\&quot;&quot; MSG_LINEBREAK</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-                           &quot;Content-Transfer-Encoding: 8bit&quot; MSG_LINEBREAK));</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-              MimeWriteAString(</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-                  obj,</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-                  NS_LITERAL_CSTRING(</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-                      &quot;Content-Disposition: inline; filename=\&quot;Deleted: &quot;));</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+              status = MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+                                                 &quot;Content-Transfer-Encoding: 8bit&quot; MSG_LINEBREAK));</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+              MimeWriteAString(obj, NS_LITERAL_CSTRING(</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+                                        &quot;Content-Disposition: inline; filename=\&quot;Deleted: &quot;));</span>
<a href="#l13.56"></a><span id="l13.56">               MimeWriteAString(obj, fileName);</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-              MimeWriteAString(</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-                  obj, NS_LITERAL_CSTRING(</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-                           &quot;\&quot;&quot; MSG_LINEBREAK</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-                           &quot;X-Mozilla-Altered: AttachmentDeleted; date=\&quot;&quot;));</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+              MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+                                        &quot;X-Mozilla-Altered: AttachmentDeleted; date=\&quot;&quot;));</span>
<a href="#l13.63"></a><span id="l13.63">             }</span>
<a href="#l13.64"></a><span id="l13.64">             nsCString result;</span>
<a href="#l13.65"></a><span id="l13.65">             char timeBuffer[128];</span>
<a href="#l13.66"></a><span id="l13.66">             PRExplodedTime now;</span>
<a href="#l13.67"></a><span id="l13.67">             PR_ExplodeTime(PR_Now(), PR_LocalTimeParameters, &amp;now);</span>
<a href="#l13.68"></a><span id="l13.68">             PR_FormatTimeUSEnglish(timeBuffer, sizeof(timeBuffer),</span>
<a href="#l13.69"></a><span id="l13.69">                                    &quot;%a %b %d %H:%M:%S %Y&quot;, &amp;now);</span>
<a href="#l13.70"></a><span id="l13.70">             MimeWriteAString(obj, nsDependentCString(timeBuffer));</span>
<a href="#l13.71"></a><span id="l13.71">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK));</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-            MimeWriteAString(</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-                obj,</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-                NS_LITERAL_CSTRING(</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-                    MSG_LINEBREAK</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-                    &quot;You deleted an attachment from this message. The original &quot;</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-                    &quot;MIME headers for the attachment were:&quot; MSG_LINEBREAK));</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+            MimeWriteAString(obj, NS_LITERAL_CSTRING(MSG_LINEBREAK</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+                                      &quot;You deleted an attachment from this message. The original &quot;</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+                                      &quot;MIME headers for the attachment were:&quot; MSG_LINEBREAK));</span>
<a href="#l13.81"></a><span id="l13.81">             MimeHeaders_write_raw_headers(mult-&gt;hdrs, obj-&gt;options, false);</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+            // clang-format on</span>
<a href="#l13.83"></a><span id="l13.83">           }</span>
<a href="#l13.84"></a><span id="l13.84">           int32_t old_nchildren = container-&gt;nchildren;</span>
<a href="#l13.85"></a><span id="l13.85">           status = ((MimeMultipartClass *)obj-&gt;clazz)-&gt;create_child(obj);</span>
<a href="#l13.86"></a><span id="l13.86">           if (status &lt; 0) return status;</span>
<a href="#l13.87"></a><span id="l13.87">           NS_ASSERTION(mult-&gt;state != MimeMultipartHeaders,</span>
<a href="#l13.88"></a><span id="l13.88">                        &quot;mult-&gt;state shouldn't be MimeMultipartHeaders&quot;);</span>
<a href="#l13.89"></a><span id="l13.89"> </span>
<a href="#l13.90"></a><span id="l13.90">           if (!stripping &amp;&amp; container-&gt;nchildren &gt; old_nchildren &amp;&amp;</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineat">@@ -436,32 +423,26 @@ static int MimeMultipart_create_child(Mi</span>
<a href="#l13.92"></a><span id="l13.92">   }</span>
<a href="#l13.93"></a><span id="l13.93"> </span>
<a href="#l13.94"></a><span id="l13.94"> #ifdef MIME_DRAFTS</span>
<a href="#l13.95"></a><span id="l13.95">   if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l13.96"></a><span id="l13.96">       obj-&gt;options-&gt;is_multipart_msg &amp;&amp; obj-&gt;options-&gt;decompose_file_init_fn) {</span>
<a href="#l13.97"></a><span id="l13.97">     if (!mime_typep(obj, (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.98"></a><span id="l13.98">         !mime_typep(obj, (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.99"></a><span id="l13.99">         !mime_typep(obj, (MimeObjectClass *)&amp;mimeMultipartSignedClass) &amp;&amp;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-#  ifdef MIME_DETAIL_CHECK</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-        !mime_typep(body, (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-        !mime_typep(body, (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-        !mime_typep(body, (MimeObjectClass *)&amp;mimeMultipartSignedClass)</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-#  else</span>
<a href="#l13.105"></a><span id="l13.105">         /* bug 21869 -- due to the fact that we are not generating the</span>
<a href="#l13.106"></a><span id="l13.106">            correct mime class object for content-typ multipart/signed part</span>
<a href="#l13.107"></a><span id="l13.107">            the above check failed. to solve the problem in general and not</span>
<a href="#l13.108"></a><span id="l13.108">            to cause early temination when parsing message for opening as</span>
<a href="#l13.109"></a><span id="l13.109">            draft we can simply make sure that the child is not a multipart</span>
<a href="#l13.110"></a><span id="l13.110">            mime object. this way we could have a proper decomposing message</span>
<a href="#l13.111"></a><span id="l13.111">            part functions set correctly */</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-        !mime_typep(body, (MimeObjectClass *)&amp;mimeMultipartClass)</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-#  endif</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-        &amp;&amp; !(mime_typep(body, (MimeObjectClass *)&amp;mimeExternalObjectClass) &amp;&amp;</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-             !strcmp(body-&gt;content_type, &quot;text/x-vcard&quot;))) {</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+        !mime_typep(body, (MimeObjectClass *)&amp;mimeMultipartClass) &amp;&amp;</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+        !(mime_typep(body, (MimeObjectClass *)&amp;mimeExternalObjectClass) &amp;&amp;</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+          !strcmp(body-&gt;content_type, &quot;text/x-vcard&quot;))) {</span>
<a href="#l13.119"></a><span id="l13.119">       status = obj-&gt;options-&gt;decompose_file_init_fn(</span>
<a href="#l13.120"></a><span id="l13.120">           obj-&gt;options-&gt;stream_closure, mult-&gt;hdrs);</span>
<a href="#l13.121"></a><span id="l13.121">       if (status &lt; 0) return status;</span>
<a href="#l13.122"></a><span id="l13.122">     }</span>
<a href="#l13.123"></a><span id="l13.123">   }</span>
<a href="#l13.124"></a><span id="l13.124"> #endif /* MIME_DRAFTS */</span>
<a href="#l13.125"></a><span id="l13.125"> </span>
<a href="#l13.126"></a><span id="l13.126">   /* Now that we've added this new object to our list of children,</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineat">@@ -526,42 +507,35 @@ static int MimeMultipart_close_child(Mim</span>
<a href="#l13.128"></a><span id="l13.128">       if (status &lt; 0) return status;</span>
<a href="#l13.129"></a><span id="l13.129">       status = kid-&gt;clazz-&gt;parse_end(kid, false);</span>
<a href="#l13.130"></a><span id="l13.130">       if (status &lt; 0) return status;</span>
<a href="#l13.131"></a><span id="l13.131"> </span>
<a href="#l13.132"></a><span id="l13.132"> #ifdef MIME_DRAFTS</span>
<a href="#l13.133"></a><span id="l13.133">       if (object-&gt;options &amp;&amp; object-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l13.134"></a><span id="l13.134">           object-&gt;options-&gt;is_multipart_msg &amp;&amp;</span>
<a href="#l13.135"></a><span id="l13.135">           object-&gt;options-&gt;decompose_file_close_fn) {</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineminus">-        if (!mime_typep(object,</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-                        (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-            !mime_typep(object,</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-                        (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+        // clang-format off</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+        if (!mime_typep(object, (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+            !mime_typep(object, (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.143"></a><span id="l13.143">             !mime_typep(object, (MimeObjectClass *)&amp;mimeMultipartSignedClass) &amp;&amp;</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-#  ifdef MIME_DETAIL_CHECK</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-            !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-            !mime_typep(kid,</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-                        (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineminus">-            !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartSignedClass)</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-#  else</span>
<a href="#l13.150"></a><span id="l13.150">             /* bug 21869 -- due to the fact that we are not generating the</span>
<a href="#l13.151"></a><span id="l13.151">                correct mime class object for content-typ multipart/signed part</span>
<a href="#l13.152"></a><span id="l13.152">                the above check failed. to solve the problem in general and not</span>
<a href="#l13.153"></a><span id="l13.153">                to cause early temination when parsing message for opening as</span>
<a href="#l13.154"></a><span id="l13.154">                draft we can simply make sure that the child is not a multipart</span>
<a href="#l13.155"></a><span id="l13.155">                mime object. this way we could have a proper decomposing message</span>
<a href="#l13.156"></a><span id="l13.156">                part functions set correctly */</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-            !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartClass)</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-#  endif</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-            &amp;&amp; !(mime_typep(kid, (MimeObjectClass *)&amp;mimeExternalObjectClass) &amp;&amp;</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-                 !strcmp(kid-&gt;content_type, &quot;text/x-vcard&quot;))) {</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+            !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartClass) &amp;&amp;</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+            !(mime_typep(kid, (MimeObjectClass *)&amp;mimeExternalObjectClass) &amp;&amp;</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+              !strcmp(kid-&gt;content_type, &quot;text/x-vcard&quot;))) {</span>
<a href="#l13.164"></a><span id="l13.164">           status = object-&gt;options-&gt;decompose_file_close_fn(</span>
<a href="#l13.165"></a><span id="l13.165">               object-&gt;options-&gt;stream_closure);</span>
<a href="#l13.166"></a><span id="l13.166">           if (status &lt; 0) return status;</span>
<a href="#l13.167"></a><span id="l13.167">         }</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+        // clang-format on</span>
<a href="#l13.169"></a><span id="l13.169">       }</span>
<a href="#l13.170"></a><span id="l13.170"> #endif /* MIME_DRAFTS */</span>
<a href="#l13.171"></a><span id="l13.171">     }</span>
<a href="#l13.172"></a><span id="l13.172">   }</span>
<a href="#l13.173"></a><span id="l13.173">   return 0;</span>
<a href="#l13.174"></a><span id="l13.174"> }</span>
<a href="#l13.175"></a><span id="l13.175"> </span>
<a href="#l13.176"></a><span id="l13.176"> static int MimeMultipart_parse_child_line(MimeObject *obj, const char *line,</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineat">@@ -579,32 +553,26 @@ static int MimeMultipart_parse_child_lin</span>
<a href="#l13.178"></a><span id="l13.178"> </span>
<a href="#l13.179"></a><span id="l13.179"> #ifdef MIME_DRAFTS</span>
<a href="#l13.180"></a><span id="l13.180">   if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;decompose_file_p &amp;&amp;</span>
<a href="#l13.181"></a><span id="l13.181">       obj-&gt;options-&gt;is_multipart_msg &amp;&amp;</span>
<a href="#l13.182"></a><span id="l13.182">       obj-&gt;options-&gt;decompose_file_output_fn) {</span>
<a href="#l13.183"></a><span id="l13.183">     if (!mime_typep(obj, (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.184"></a><span id="l13.184">         !mime_typep(obj, (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.185"></a><span id="l13.185">         !mime_typep(obj, (MimeObjectClass *)&amp;mimeMultipartSignedClass) &amp;&amp;</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineminus">-#  ifdef MIME_DETAIL_CHECK</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineminus">-        !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartAlternativeClass) &amp;&amp;</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineminus">-        !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartRelatedClass) &amp;&amp;</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineminus">-        !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartSignedClass)</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineminus">-#  else</span>
<a href="#l13.191"></a><span id="l13.191">         /* bug 21869 -- due to the fact that we are not generating the</span>
<a href="#l13.192"></a><span id="l13.192">            correct mime class object for content-typ multipart/signed part</span>
<a href="#l13.193"></a><span id="l13.193">            the above check failed. to solve the problem in general and not</span>
<a href="#l13.194"></a><span id="l13.194">            to cause early temination when parsing message for opening as</span>
<a href="#l13.195"></a><span id="l13.195">            draft we can simply make sure that the child is not a multipart</span>
<a href="#l13.196"></a><span id="l13.196">            mime object. this way we could have a proper decomposing message</span>
<a href="#l13.197"></a><span id="l13.197">            part functions set correctly */</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineminus">-        !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartClass)</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineminus">-#  endif</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineminus">-        &amp;&amp; !(mime_typep(kid, (MimeObjectClass *)&amp;mimeExternalObjectClass) &amp;&amp;</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineminus">-             !strcmp(kid-&gt;content_type, &quot;text/x-vcard&quot;)))</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+        !mime_typep(kid, (MimeObjectClass *)&amp;mimeMultipartClass) &amp;&amp;</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+        !(mime_typep(kid, (MimeObjectClass *)&amp;mimeExternalObjectClass) &amp;&amp;</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineplus">+          !strcmp(kid-&gt;content_type, &quot;text/x-vcard&quot;)))</span>
<a href="#l13.205"></a><span id="l13.205">       return obj-&gt;options-&gt;decompose_file_output_fn(</span>
<a href="#l13.206"></a><span id="l13.206">           line, length, obj-&gt;options-&gt;stream_closure);</span>
<a href="#l13.207"></a><span id="l13.207">   }</span>
<a href="#l13.208"></a><span id="l13.208"> #endif /* MIME_DRAFTS */</span>
<a href="#l13.209"></a><span id="l13.209"> </span>
<a href="#l13.210"></a><span id="l13.210">   /* The newline issues here are tricky, since both the newlines before</span>
<a href="#l13.211"></a><span id="l13.211">    and after the boundary string are to be considered part of the</span>
<a href="#l13.212"></a><span id="l13.212">    boundary: this is so that a part can be specified such that it</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/mime/src/mimeobj.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/mime/src/mimeobj.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -124,53 +124,53 @@ struct MimeObjectClass {</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> extern &quot;C&quot; MimeObjectClass mimeObjectClass;</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> /* this one is typdedef'ed in mimei.h, since it is the base-class. */</span>
<a href="#l14.8"></a><span id="l14.8"> struct MimeObject {</span>
<a href="#l14.9"></a><span id="l14.9">   MimeObjectClass *clazz; /* Pointer to class object, for `type-of' */</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   MimeHeaders *headers; /* The header data associated with this object;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-              this is where the content-type, disposition,</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-              description, and other meta-data live.</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+                           this is where the content-type, disposition,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+                           description, and other meta-data live.</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-              For example, the outermost message/rfc822 object</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-              would have NULL here (since it has no parent,</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-              thus no headers to describe it.)  However, a</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-              multipart/mixed object, which was the sole</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-              child of that message/rfc822 object, would have</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-              here a copy of the headers which began the</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-              parent object (the headers which describe the</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-              child.)</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-            */</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+                           For example, the outermost message/rfc822 object</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+                           would have NULL here (since it has no parent,</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+                           thus no headers to describe it.)  However, a</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+                           multipart/mixed object, which was the sole</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+                           child of that message/rfc822 object, would have</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+                           here a copy of the headers which began the</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+                           parent object (the headers which describe the</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+                           child.)</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+                         */</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">   char *content_type; /* The MIME content-type and encoding.  */</span>
<a href="#l14.37"></a><span id="l14.37">   char *encoding;     /* In most cases, these will be the same as the</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-                values to be found in the `headers' object,</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-                but in some cases, the values in these slots</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-                will be more correct than the headers.</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-              */</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+                         values to be found in the `headers' object,</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+                         but in some cases, the values in these slots</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+                         will be more correct than the headers.</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+                       */</span>
<a href="#l14.46"></a><span id="l14.46"> </span>
<a href="#l14.47"></a><span id="l14.47">   MimeObject *parent; /* Backpointer to a MimeContainer object. */</span>
<a href="#l14.48"></a><span id="l14.48"> </span>
<a href="#l14.49"></a><span id="l14.49">   MimeDisplayOptions *options; /* Display preferences set by caller. */</span>
<a href="#l14.50"></a><span id="l14.50"> </span>
<a href="#l14.51"></a><span id="l14.51">   bool closed_p;             /* Whether it's done being written to. */</span>
<a href="#l14.52"></a><span id="l14.52">   bool parsed_p;             /* Whether the parser has been shut down. */</span>
<a href="#l14.53"></a><span id="l14.53">   bool output_p;             /* Whether it should be written. */</span>
<a href="#l14.54"></a><span id="l14.54">   bool dontShowAsAttachment; /* Force an object to not be shown as attachment,</span>
<a href="#l14.55"></a><span id="l14.55">                                 but when is false, it doesn't mean it will be</span>
<a href="#l14.56"></a><span id="l14.56">                                 shown as attachment; specifically, body parts</span>
<a href="#l14.57"></a><span id="l14.57">                                 are never shown as attachments. */</span>
<a href="#l14.58"></a><span id="l14.58"> </span>
<a href="#l14.59"></a><span id="l14.59">   /* Read-buffer and write-buffer (on input, `parse_buffer' uses ibuffer to</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-   compose calls to `parse_line'; on output, `obuffer' is used in various</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-   ways by various routines.)  These buffers are created and grow as needed.</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-   `ibuffer' should be generally be considered hands-off, and `obuffer'</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-   should generally be considered fair game.</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+     compose calls to `parse_line'; on output, `obuffer' is used in various</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+     ways by various routines.)  These buffers are created and grow as needed.</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+     `ibuffer' should be generally be considered hands-off, and `obuffer'</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+     should generally be considered fair game.</span>
<a href="#l14.68"></a><span id="l14.68">    */</span>
<a href="#l14.69"></a><span id="l14.69">   char *ibuffer, *obuffer;</span>
<a href="#l14.70"></a><span id="l14.70">   int32_t ibuffer_size, obuffer_size;</span>
<a href="#l14.71"></a><span id="l14.71">   int32_t ibuffer_fp, obuffer_fp;</span>
<a href="#l14.72"></a><span id="l14.72"> };</span>
<a href="#l14.73"></a><span id="l14.73"> </span>
<a href="#l14.74"></a><span id="l14.74"> #define MimeObject_grow_obuffer(obj, desired_size)                         \</span>
<a href="#l14.75"></a><span id="l14.75">   (((desired_size) &gt;= (obj)-&gt;obuffer_size)                                 \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/mime/src/mimepbuf.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/mime/src/mimepbuf.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -47,19 +47,18 @@ extern nsresult nsMsgCreateTempFile(cons</span>
<a href="#l15.4"></a><span id="l15.4"> #define TARGET_MEMORY_BUFFER_QUANTUM (1024 * 5) /* decrease in steps of 5k */</span>
<a href="#l15.5"></a><span id="l15.5"> #define DISK_BUFFER_SIZE (1024 * 10)            /* read disk in 10k chunks */</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7"> struct MimePartBufferData {</span>
<a href="#l15.8"></a><span id="l15.8">   char *part_buffer;        /* Buffer used for part-lookahead. */</span>
<a href="#l15.9"></a><span id="l15.9">   int32_t part_buffer_fp;   /* Active length. */</span>
<a href="#l15.10"></a><span id="l15.10">   int32_t part_buffer_size; /* How big it is. */</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-      file_buffer; /* The nsIFile of a temp file used when we</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                                        run out of room in the head_buffer. */</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; file_buffer; /* The nsIFile of a temp file used when we</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+                                    run out of room in the head_buffer. */</span>
<a href="#l15.17"></a><span id="l15.17">   nsCOMPtr&lt;nsIInputStream&gt; input_file_stream;   /* A stream to it. */</span>
<a href="#l15.18"></a><span id="l15.18">   nsCOMPtr&lt;nsIOutputStream&gt; output_file_stream; /* A stream to it. */</span>
<a href="#l15.19"></a><span id="l15.19">   MimePartBufferData()</span>
<a href="#l15.20"></a><span id="l15.20">       : part_buffer(nullptr), part_buffer_fp(0), part_buffer_size(0) {}</span>
<a href="#l15.21"></a><span id="l15.21"> };</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23"> MimePartBufferData *MimePartBufferCreate(void) {</span>
<a href="#l15.24"></a><span id="l15.24">   return new MimePartBufferData();</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineat">@@ -111,25 +110,24 @@ void MimePartBufferDestroy(MimePartBuffe</span>
<a href="#l15.26"></a><span id="l15.26"> }</span>
<a href="#l15.27"></a><span id="l15.27"> </span>
<a href="#l15.28"></a><span id="l15.28"> int MimePartBufferWrite(MimePartBufferData *data, const char *buf,</span>
<a href="#l15.29"></a><span id="l15.29">                         int32_t size) {</span>
<a href="#l15.30"></a><span id="l15.30">   NS_ASSERTION(data &amp;&amp; buf &amp;&amp; size &gt; 0, &quot;MimePartBufferWrite: Bad param&quot;);</span>
<a href="#l15.31"></a><span id="l15.31">   if (!data || !buf || size &lt;= 0) return -1;</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33">   /* If we don't yet have a buffer (either memory or file) try and make a</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-    memory buffer.</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-    */</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+     memory buffer.</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+   */</span>
<a href="#l15.38"></a><span id="l15.38">   if (!data-&gt;part_buffer &amp;&amp; !data-&gt;file_buffer) {</span>
<a href="#l15.39"></a><span id="l15.39">     int target_size = TARGET_MEMORY_BUFFER_SIZE;</span>
<a href="#l15.40"></a><span id="l15.40">     while (target_size &gt; 0) {</span>
<a href="#l15.41"></a><span id="l15.41">       data-&gt;part_buffer = (char *)PR_MALLOC(target_size);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-      if (data-&gt;part_buffer) break;                /* got it! */</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-      target_size -= TARGET_MEMORY_BUFFER_QUANTUM; /* decrease it and try</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-       again */</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+      if (data-&gt;part_buffer) break;                 // got it!</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+      target_size -= TARGET_MEMORY_BUFFER_QUANTUM;  // decrease it and try again</span>
<a href="#l15.47"></a><span id="l15.47">     }</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">     if (data-&gt;part_buffer)</span>
<a href="#l15.50"></a><span id="l15.50">       data-&gt;part_buffer_size = target_size;</span>
<a href="#l15.51"></a><span id="l15.51">     else</span>
<a href="#l15.52"></a><span id="l15.52">       data-&gt;part_buffer_size = 0;</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54">     data-&gt;part_buffer_fp = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/mime/src/mimethtm.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/mime/src/mimethtm.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -61,22 +61,22 @@ static int MimeInlineTextHTML_parse_begi</span>
<a href="#l16.4"></a><span id="l16.4">     if (base_hdr) {</span>
<a href="#l16.5"></a><span id="l16.5">       uint32_t buflen = strlen(base_hdr) + 20;</span>
<a href="#l16.6"></a><span id="l16.6">       char *buf = (char *)PR_MALLOC(buflen);</span>
<a href="#l16.7"></a><span id="l16.7">       const char *in;</span>
<a href="#l16.8"></a><span id="l16.8">       char *out;</span>
<a href="#l16.9"></a><span id="l16.9">       if (!buf) return MIME_OUT_OF_MEMORY;</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">       /* The value of the Content-Base header is a number of &quot;words&quot;.</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-      Whitespace in this header is not significant -- it is assumed</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-      that any real whitespace in the URL has already been encoded,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-      and whitespace has been inserted to allow the lines in the</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-      mail header to be wrapped reasonably.  Creators are supposed</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-      to insert whitespace every 40 characters or less.</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-    */</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+        Whitespace in this header is not significant -- it is assumed</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+        that any real whitespace in the URL has already been encoded,</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+        and whitespace has been inserted to allow the lines in the</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+        mail header to be wrapped reasonably.  Creators are supposed</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+        to insert whitespace every 40 characters or less.</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+      */</span>
<a href="#l16.24"></a><span id="l16.24">       PL_strncpyz(buf, &quot;&lt;BASE HREF=\&quot;&quot;, buflen);</span>
<a href="#l16.25"></a><span id="l16.25">       out = buf + strlen(buf);</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27">       for (in = base_hdr; *in; in++) /* ignore whitespace and quotes */</span>
<a href="#l16.28"></a><span id="l16.28">         if (!IS_SPACE(*in) &amp;&amp; *in != '&quot;') *out++ = *in;</span>
<a href="#l16.29"></a><span id="l16.29"> </span>
<a href="#l16.30"></a><span id="l16.30">       /* Close the tag and argument. */</span>
<a href="#l16.31"></a><span id="l16.31">       *out++ = '&quot;';</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineat">@@ -168,19 +168,19 @@ void MimeInlineTextHTML_insert_lang_div(</span>
<a href="#l16.33"></a><span id="l16.33">     return;</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">   // Make sure we have a &lt;body&gt; before we start.</span>
<a href="#l16.36"></a><span id="l16.36">   int32_t index = message.Find(&quot;&lt;body&quot;, /* ignoreCase = */ true);</span>
<a href="#l16.37"></a><span id="l16.37">   if (index == kNotFound) return;</span>
<a href="#l16.38"></a><span id="l16.38">   index = message.FindChar('&gt;', index) + 1;</span>
<a href="#l16.39"></a><span id="l16.39"> </span>
<a href="#l16.40"></a><span id="l16.40">   // Insert &lt;div class=&quot;moz-text-html&quot; lang=&quot;...&quot;&gt; for the following two</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-  // purposes: 1) Users can configure their HTML display via CSS for</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-  // .moz-text-html. 2) The language group in the 'lang' attribure is used by</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-  // Gecko to determine</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+  // purposes:</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+  // 1) Users can configure their HTML display via CSS for .moz-text-html.</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+  // 2) The language group in the 'lang' attribure is used by Gecko to determine</span>
<a href="#l16.47"></a><span id="l16.47">   //    which font to use.</span>
<a href="#l16.48"></a><span id="l16.48">   int32_t fontSize;            // default font size</span>
<a href="#l16.49"></a><span id="l16.49">   int32_t fontSizePercentage;  // size percentage</span>
<a href="#l16.50"></a><span id="l16.50">   nsAutoCString fontLang;      // langgroup of the font.</span>
<a href="#l16.51"></a><span id="l16.51">   if (NS_SUCCEEDED(GetMailNewsFont(obj, false, &amp;fontSize, &amp;fontSizePercentage,</span>
<a href="#l16.52"></a><span id="l16.52">                                    fontLang))) {</span>
<a href="#l16.53"></a><span id="l16.53">     message.Insert(NS_LITERAL_CSTRING(&quot;&lt;div class=\&quot;moz-text-html\&quot; lang=\&quot;&quot;) +</span>
<a href="#l16.54"></a><span id="l16.54">                        fontLang + NS_LITERAL_CSTRING(&quot;\&quot;&gt;&quot;),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -177,17 +177,17 @@ static int MimeInlineTextPlain_parse_beg</span>
<a href="#l17.4"></a><span id="l17.4">             openingDiv += '\&quot;';</span>
<a href="#l17.5"></a><span id="l17.5">           }</span>
<a href="#l17.6"></a><span id="l17.6">         }</span>
<a href="#l17.7"></a><span id="l17.7">         openingDiv += &quot;&gt;&lt;pre wrap class=\&quot;moz-quote-pre\&quot;&gt;\n&quot;;</span>
<a href="#l17.8"></a><span id="l17.8">       } else</span>
<a href="#l17.9"></a><span id="l17.9">         openingDiv = &quot;&lt;pre wrap class=\&quot;moz-quote-pre\&quot;&gt;\n&quot;;</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">       /* text/plain objects always have separators before and after them.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-       Note that this is not the case for text/enriched objects. */</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+         Note that this is not the case for text/enriched objects. */</span>
<a href="#l17.14"></a><span id="l17.14">       status = MimeObject_write_separator(obj);</span>
<a href="#l17.15"></a><span id="l17.15">       if (status &lt; 0) return status;</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">       status =</span>
<a href="#l17.18"></a><span id="l17.18">           MimeObject_write(obj, openingDiv.get(), openingDiv.Length(), true);</span>
<a href="#l17.19"></a><span id="l17.19">       if (status &lt; 0) return status;</span>
<a href="#l17.20"></a><span id="l17.20">     }</span>
<a href="#l17.21"></a><span id="l17.21">   }</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -235,18 +235,18 @@ static int MimeInlineTextPlain_parse_eof</span>
<a href="#l17.23"></a><span id="l17.23">     if (status &lt; 0) return status;</span>
<a href="#l17.24"></a><span id="l17.24">     if (!quoting) {</span>
<a href="#l17.25"></a><span id="l17.25">       status = MimeObject_write(obj, &quot;&lt;/div&gt;&quot;, 6, false);</span>
<a href="#l17.26"></a><span id="l17.26">       // .moz-text-plain</span>
<a href="#l17.27"></a><span id="l17.27">       if (status &lt; 0) return status;</span>
<a href="#l17.28"></a><span id="l17.28">     }</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30">     /* text/plain objects always have separators before and after them.</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-   Note that this is not the case for text/enriched objects.</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-   */</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+       Note that this is not the case for text/enriched objects.</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+     */</span>
<a href="#l17.35"></a><span id="l17.35">     status = MimeObject_write_separator(obj);</span>
<a href="#l17.36"></a><span id="l17.36">     if (status &lt; 0) return status;</span>
<a href="#l17.37"></a><span id="l17.37">   }</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39">   return 0;</span>
<a href="#l17.40"></a><span id="l17.40"> }</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42"> static int MimeInlineTextPlain_parse_line(const char *line, int32_t length,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/mime/src/modlmime.h</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/mime/src/modlmime.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -26,39 +26,39 @@</span>
<a href="#l18.4"></a><span id="l18.4">  */</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6"> typedef struct MimeHeaders {</span>
<a href="#l18.7"></a><span id="l18.7">   char *all_headers;        /* A char* of the entire header section. */</span>
<a href="#l18.8"></a><span id="l18.8">   int32_t all_headers_fp;   /* The length (it is not NULL-terminated.) */</span>
<a href="#l18.9"></a><span id="l18.9">   int32_t all_headers_size; /* The size of the allocated block. */</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">   bool done_p; /* Whether we've read the end-of-headers marker</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-            (the terminating blank line.) */</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+                 (the terminating blank line.) */</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   char **heads;       /* An array of length n_headers which points</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-                to the beginning of each distinct header:</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-                just after the newline which terminated</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-                the previous one.  This is to speed search.</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+                        to the beginning of each distinct header:</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+                        just after the newline which terminated</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+                        the previous one.  This is to speed search.</span>
<a href="#l18.22"></a><span id="l18.22">       </span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-                This is not initialized until all the</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-                headers have been read.</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-              */</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+                        This is not initialized until all the</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+                        headers have been read.</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+                      */</span>
<a href="#l18.29"></a><span id="l18.29">   int32_t heads_size; /* The length (and consequently, how many</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-            distinct headers are in here.) */</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+                         distinct headers are in here.) */</span>
<a href="#l18.32"></a><span id="l18.32"> </span>
<a href="#l18.33"></a><span id="l18.33">   char *obuffer; /* This buffer is used for output. */</span>
<a href="#l18.34"></a><span id="l18.34">   int32_t obuffer_size;</span>
<a href="#l18.35"></a><span id="l18.35">   int32_t obuffer_fp;</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-  char</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-      *munged_subject; /* What a hack.  This is a place to write down</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-             the subject header, after it's been</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-             charset-ified and stuff.  Remembered so that</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-             we can later use it to generate the</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-             &lt;TITLE&gt; tag. (Also works for giving names to RFC822 attachments) */</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+  char *munged_subject; /* What a hack.  This is a place to write down</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+                           the subject header, after it's been</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+                           charset-ified and stuff.  Remembered so that</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+                           we can later use it to generate the</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+                           &lt;TITLE&gt; tag. (Also works for giving names to</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+                           RFC822 attachments) */</span>
<a href="#l18.49"></a><span id="l18.49"> } MimeHeaders;</span>
<a href="#l18.50"></a><span id="l18.50"> </span>
<a href="#l18.51"></a><span id="l18.51"> class MimeDisplayOptions;</span>
<a href="#l18.52"></a><span id="l18.52"> class MimeParseStateObject;</span>
<a href="#l18.53"></a><span id="l18.53"> typedef struct MSG_AttachmentData MSG_AttachmentData;</span>
<a href="#l18.54"></a><span id="l18.54"> </span>
<a href="#l18.55"></a><span id="l18.55"> /* Given the name of a header, returns the contents of that header as</span>
<a href="#l18.56"></a><span id="l18.56">    a newly-allocated string (which the caller must free.)  If the header</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineat">@@ -71,54 +71,54 @@ typedef struct MSG_AttachmentData MSG_At</span>
<a href="#l18.58"></a><span id="l18.58">    If `all_p' is false, then the first header encountered is used, and</span>
<a href="#l18.59"></a><span id="l18.59">    any subsequent headers of the same name are ignored.  If true, then</span>
<a href="#l18.60"></a><span id="l18.60">    all headers of the same name are appended together (this is useful</span>
<a href="#l18.61"></a><span id="l18.61">    for gathering up all CC headers into one, for example.)</span>
<a href="#l18.62"></a><span id="l18.62">  */</span>
<a href="#l18.63"></a><span id="l18.63"> extern char *MimeHeaders_get(MimeHeaders *hdrs, const char *header_name,</span>
<a href="#l18.64"></a><span id="l18.64">                              bool strip_p, bool all_p);</span>
<a href="#l18.65"></a><span id="l18.65"> </span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+// clang-format off</span>
<a href="#l18.67"></a><span id="l18.67"> /* Given a header of the form of the MIME &quot;Content-&quot; headers, extracts a</span>
<a href="#l18.68"></a><span id="l18.68">    named parameter from it, if it exists.  For example,</span>
<a href="#l18.69"></a><span id="l18.69">    MimeHeaders_get_parameter(&quot;text/plain; charset=us-ascii&quot;, &quot;charset&quot;)</span>
<a href="#l18.70"></a><span id="l18.70">    would return &quot;us-ascii&quot;.</span>
<a href="#l18.71"></a><span id="l18.71"> </span>
<a href="#l18.72"></a><span id="l18.72">    Returns NULL if there is no match, or if there is an allocation failure.</span>
<a href="#l18.73"></a><span id="l18.73"> </span>
<a href="#l18.74"></a><span id="l18.74">    RFC2231 - MIME Parameter Value and Encoded Word Extensions: Character Sets,</span>
<a href="#l18.75"></a><span id="l18.75">    Languages, and Continuations</span>
<a href="#l18.76"></a><span id="l18.76"> </span>
<a href="#l18.77"></a><span id="l18.77">    RFC2231 has added the character sets, languages, and continuations mechanism.</span>
<a href="#l18.78"></a><span id="l18.78">    charset, and language information may also be returned to the caller.</span>
<a href="#l18.79"></a><span id="l18.79">    Note that charset and language should be free()'d while</span>
<a href="#l18.80"></a><span id="l18.80">    the return value (parameter) has to be PR_FREE'd.</span>
<a href="#l18.81"></a><span id="l18.81"> </span>
<a href="#l18.82"></a><span id="l18.82">    For example,</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-   MimeHeaders_get_parameter(&quot;text/plain;</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineminus">-   name*=us-ascii'en-us'This%20is%20%2A%2A%2Afun%2A%2A%2A&quot;, &quot;name&quot;)</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineminus">-   MimeHeaders_get_parameter(&quot;text/plain; name*0*=us-ascii'en-us'This%20is%20;</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineminus">-   CRLFLWSPname*1*=%2A%2A%2Afun%2A%2A%2A&quot;, &quot;name&quot;) would return &quot;This is</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineminus">-   ***fun***&quot; and *charset = &quot;us-ascii&quot;, *language = &quot;en-us&quot;</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineplus">+   MimeHeaders_get_parameter(&quot;text/plain; name*=us-ascii'en-us'This%20is%20%2A%2A%2Afun%2A%2A%2A&quot;, &quot;name&quot;)</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineplus">+   MimeHeaders_get_parameter(&quot;text/plain; name*0*=us-ascii'en-us'This%20is%20; CRLFLWSPname*1*=%2A%2A%2Afun%2A%2A%2A&quot;, &quot;name&quot;) would return &quot;This is ***fun***&quot; and *charset = &quot;us-ascii&quot;, *language = &quot;en-us&quot;</span>
<a href="#l18.90"></a><span id="l18.90">  */</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineplus">+// clang-format on</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineplus">+</span>
<a href="#l18.93"></a><span id="l18.93"> extern char *MimeHeaders_get_parameter(const char *header_value,</span>
<a href="#l18.94"></a><span id="l18.94">                                        const char *parm_name, char **charset,</span>
<a href="#l18.95"></a><span id="l18.95">                                        char **language);</span>
<a href="#l18.96"></a><span id="l18.96"> </span>
<a href="#l18.97"></a><span id="l18.97"> extern MimeHeaders *MimeHeaders_copy(MimeHeaders *srcHeaders);</span>
<a href="#l18.98"></a><span id="l18.98"> </span>
<a href="#l18.99"></a><span id="l18.99"> extern void MimeHeaders_free(MimeHeaders *hdrs);</span>
<a href="#l18.100"></a><span id="l18.100"> </span>
<a href="#l18.101"></a><span id="l18.101"> typedef enum {</span>
<a href="#l18.102"></a><span id="l18.102">   MimeHeadersAll,       /* Show all headers */</span>
<a href="#l18.103"></a><span id="l18.103">   MimeHeadersSome,      /* Show all &quot;interesting&quot; headers */</span>
<a href="#l18.104"></a><span id="l18.104">   MimeHeadersSomeNoRef, /* Same, but suppress the `References' header</span>
<a href="#l18.105"></a><span id="l18.105">                           (for when we're printing this message.) */</span>
<a href="#l18.106"></a><span id="l18.106">   MimeHeadersMicro,     /* Show a one-line header summary */</span>
<a href="#l18.107"></a><span id="l18.107">   MimeHeadersMicroPlus, /* Same, but show the full recipient list as</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-                          well (To, CC, etc.) */</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineplus">+                           well (To, CC, etc.) */</span>
<a href="#l18.110"></a><span id="l18.110">   MimeHeadersCitation,  /* A one-line summary geared toward use in a</span>
<a href="#l18.111"></a><span id="l18.111">                            reply citation (&quot;So-and-so wrote:&quot;) */</span>
<a href="#l18.112"></a><span id="l18.112">   MimeHeadersOnly,      /* Just parse and output headers...nothing else! */</span>
<a href="#l18.113"></a><span id="l18.113">   MimeHeadersNone       /* Skip showing any headers */</span>
<a href="#l18.114"></a><span id="l18.114"> } MimeHeadersState;</span>
<a href="#l18.115"></a><span id="l18.115"> </span>
<a href="#l18.116"></a><span id="l18.116"> /* The signature for various callbacks in the MimeDisplayOptions structure.</span>
<a href="#l18.117"></a><span id="l18.117">  */</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineat">@@ -135,67 +135,68 @@ class MimeDisplayOptions {</span>
<a href="#l18.119"></a><span id="l18.119"> </span>
<a href="#l18.120"></a><span id="l18.120">   const char *url; /* Base URL for the document.  This string should</span>
<a href="#l18.121"></a><span id="l18.121">             be freed by the caller, after the parser</span>
<a href="#l18.122"></a><span id="l18.122">             completes (possibly at the same time as the</span>
<a href="#l18.123"></a><span id="l18.123">             MimeDisplayOptions itself.) */</span>
<a href="#l18.124"></a><span id="l18.124"> </span>
<a href="#l18.125"></a><span id="l18.125">   MimeHeadersState headers; /* How headers should be displayed. */</span>
<a href="#l18.126"></a><span id="l18.126">   bool fancy_headers_p;     /* Whether to do clever formatting of headers</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-                    using tables, instead of spaces. */</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineplus">+                               using tables, instead of spaces. */</span>
<a href="#l18.129"></a><span id="l18.129"> </span>
<a href="#l18.130"></a><span id="l18.130">   bool output_vcard_buttons_p; /* Whether to output the buttons */</span>
<a href="#l18.131"></a><span id="l18.131">                                /* on vcards. */</span>
<a href="#l18.132"></a><span id="l18.132"> </span>
<a href="#l18.133"></a><span id="l18.133">   bool variable_width_plaintext_p; /* Whether text/plain messages should</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-                      be in variable width, or fixed. */</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineplus">+                                      be in variable width, or fixed. */</span>
<a href="#l18.136"></a><span id="l18.136">   bool wrap_long_lines_p;          /* Whether to wrap long lines in text/plain</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-                           messages. */</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineplus">+                                      messages. */</span>
<a href="#l18.139"></a><span id="l18.139"> </span>
<a href="#l18.140"></a><span id="l18.140">   bool rot13_p;       /* Whether text/plain parts should be rotated</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineminus">-                  Set by &quot;?rot13=true&quot; */</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineplus">+                         Set by &quot;?rot13=true&quot; */</span>
<a href="#l18.143"></a><span id="l18.143">   char *part_to_load; /* The particular part of the multipart which</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineminus">-              we are extracting.  Set by &quot;?part=3.2.4&quot; */</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineplus">+                         we are extracting.  Set by &quot;?part=3.2.4&quot; */</span>
<a href="#l18.146"></a><span id="l18.146"> </span>
<a href="#l18.147"></a><span id="l18.147">   bool no_output_p; /* Will never write output when this is true.</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-          (When false, output or not may depend on other things.)</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineminus">-          This needs to be in the options, because the method</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineminus">-          MimeObject_parse_begin is controlling the property &quot;output_p&quot;</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineminus">-          (on the MimeObject) so we need a way for other functions to</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineminus">-          override it and tell that we do not want output. */</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineplus">+                       (When false, output or not may depend on other things.)</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineplus">+                       This needs to be in the options, because the method</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineplus">+                       MimeObject_parse_begin is controlling the property</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineplus">+                       &quot;output_p&quot; (on the MimeObject) so we need a way for other</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineplus">+                       functions to override it and tell that we do not want</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineplus">+                       output. */</span>
<a href="#l18.159"></a><span id="l18.159"> </span>
<a href="#l18.160"></a><span id="l18.160">   bool write_html_p; /* Whether the output should be HTML, or raw. */</span>
<a href="#l18.161"></a><span id="l18.161"> </span>
<a href="#l18.162"></a><span id="l18.162">   bool decrypt_p; /* Whether all traces of xlateion should be</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineminus">-              eradicated -- this is only meaningful when</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineminus">-              write_html_p is false; we set this when</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineminus">-              attaching a message for forwarding, since</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineminus">-              forwarding someone else a message that wasn't</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineminus">-              xlated for them doesn't work.  We have to</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineminus">-              dexlate it before sending it.</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineminus">-            */</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineplus">+                     eradicated -- this is only meaningful when</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineplus">+                     write_html_p is false; we set this when</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineplus">+                     attaching a message for forwarding, since</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineplus">+                     forwarding someone else a message that wasn't</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineplus">+                     xlated for them doesn't work.  We have to</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineplus">+                     dexlate it before sending it.</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineplus">+                   */</span>
<a href="#l18.177"></a><span id="l18.177"> </span>
<a href="#l18.178"></a><span id="l18.178">   /* Whether this MIME part is a child of another part (and not top level). */</span>
<a href="#l18.179"></a><span id="l18.179">   bool is_child = false;</span>
<a href="#l18.180"></a><span id="l18.180"> </span>
<a href="#l18.181"></a><span id="l18.181" class="difflineminus">-  uint32_t</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineminus">-      whattodo; /* from the prefs, we'll get if the user wants to do glyph or</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineminus">-                   structure substitutions and set this member variable. */</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineplus">+  uint32_t whattodo; /* from the prefs, we'll get if the user wants to do glyph</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineplus">+                        or structure substitutions and set this member variable.</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineplus">+                      */</span>
<a href="#l18.187"></a><span id="l18.187"> </span>
<a href="#l18.188"></a><span id="l18.188">   char *default_charset;   /* If this is non-NULL, then it is the charset to</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineminus">-                  assume when no other one is specified via a</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineminus">-                  `charset' parameter.</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineminus">-                */</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineplus">+                              assume when no other one is specified via a</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineplus">+                              `charset' parameter.</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineplus">+                            */</span>
<a href="#l18.195"></a><span id="l18.195">   bool override_charset;   /* If this is true, then we will assume that</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineminus">-                  all data is in the default_charset, regardless</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineminus">-                                of what the `charset' parameter of that part</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineminus">-                                says. (This is to cope with the fact that, in</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineminus">-                                the real world, many messages are mislabelled</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineminus">-                                with the wrong charset.)</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineminus">-                */</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineplus">+                              all data is in the default_charset, regardless</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineplus">+                              of what the `charset' parameter of that part</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineplus">+                              says. (This is to cope with the fact that, in</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineplus">+                              the real world, many messages are mislabelled</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineplus">+                              with the wrong charset.)</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineplus">+                            */</span>
<a href="#l18.208"></a><span id="l18.208">   bool force_user_charset; /* this is the new strategy to deal with incorrectly</span>
<a href="#l18.209"></a><span id="l18.209">                               labeled attachments */</span>
<a href="#l18.210"></a><span id="l18.210"> </span>
<a href="#l18.211"></a><span id="l18.211">   /* =======================================================================</span>
<a href="#l18.212"></a><span id="l18.212">    Stream-related callbacks; for these functions, the `closure' argument</span>
<a href="#l18.213"></a><span id="l18.213">    is what is found in `options-&gt;stream_closure'.  (One possible exception</span>
<a href="#l18.214"></a><span id="l18.214">    is for output_fn; see &quot;output_closure&quot; below.)</span>
<a href="#l18.215"></a><span id="l18.215">    */</span>
<a href="#l18.216"></a><span id="l18.216" class="difflineat">@@ -270,17 +271,17 @@ class MimeDisplayOptions {</span>
<a href="#l18.217"></a><span id="l18.217"> </span>
<a href="#l18.218"></a><span id="l18.218">   /* For turning a mail address into a mailto URL. */</span>
<a href="#l18.219"></a><span id="l18.219">   MimeHTMLGeneratorFunction generate_mailto_url_fn;</span>
<a href="#l18.220"></a><span id="l18.220"> </span>
<a href="#l18.221"></a><span id="l18.221">   /* For turning a newsgroup name into a news URL. */</span>
<a href="#l18.222"></a><span id="l18.222">   MimeHTMLGeneratorFunction generate_news_url_fn;</span>
<a href="#l18.223"></a><span id="l18.223"> </span>
<a href="#l18.224"></a><span id="l18.224">   /* =======================================================================</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineminus">-     Callbacks to handle the backend-specific inlined image display</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineplus">+   Callbacks to handle the backend-specific inlined image display</span>
<a href="#l18.227"></a><span id="l18.227">    (internal-external-reconnect junk.)  For `image_begin', the `closure'</span>
<a href="#l18.228"></a><span id="l18.228">    argument is what is found in `stream_closure'; but for all of the</span>
<a href="#l18.229"></a><span id="l18.229">    others, the `closure' argument is the data that `image_begin' returned.</span>
<a href="#l18.230"></a><span id="l18.230">    */</span>
<a href="#l18.231"></a><span id="l18.231"> </span>
<a href="#l18.232"></a><span id="l18.232">   /* Begins processing an embedded image; the URL and content_type are of the</span>
<a href="#l18.233"></a><span id="l18.233">    image itself. */</span>
<a href="#l18.234"></a><span id="l18.234">   void *(*image_begin)(const char *image_url, const char *content_type,</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineat">@@ -302,67 +303,66 @@ class MimeDisplayOptions {</span>
<a href="#l18.236"></a><span id="l18.236">                   initialize this to 0 and leave it alone.</span>
<a href="#l18.237"></a><span id="l18.237">                 */</span>
<a href="#l18.238"></a><span id="l18.238"> </span>
<a href="#l18.239"></a><span id="l18.239"> #ifdef MIME_DRAFTS</span>
<a href="#l18.240"></a><span id="l18.240">   /* =======================================================================</span>
<a href="#l18.241"></a><span id="l18.241">   Mail Draft hooks -- 09-19-1996</span>
<a href="#l18.242"></a><span id="l18.242">    */</span>
<a href="#l18.243"></a><span id="l18.243">   bool decompose_file_p;           /* are we decomposing a mime msg</span>
<a href="#l18.244"></a><span id="l18.244" class="difflineminus">-                    into separate files */</span>
<a href="#l18.245"></a><span id="l18.245" class="difflineplus">+                                      into separate files */</span>
<a href="#l18.246"></a><span id="l18.246">   bool done_parsing_outer_headers; /* are we done parsing the outer message</span>
<a href="#l18.247"></a><span id="l18.247" class="difflineminus">-                     headers; this is really useful when</span>
<a href="#l18.248"></a><span id="l18.248" class="difflineminus">-                     we have multiple Message/RFC822</span>
<a href="#l18.249"></a><span id="l18.249" class="difflineminus">-                     headers */</span>
<a href="#l18.250"></a><span id="l18.250" class="difflineplus">+                                      headers; this is really useful when</span>
<a href="#l18.251"></a><span id="l18.251" class="difflineplus">+                                      we have multiple Message/RFC822</span>
<a href="#l18.252"></a><span id="l18.252" class="difflineplus">+                                      headers */</span>
<a href="#l18.253"></a><span id="l18.253">   bool is_multipart_msg;           /* are we decomposing a multipart</span>
<a href="#l18.254"></a><span id="l18.254" class="difflineminus">-                     message */</span>
<a href="#l18.255"></a><span id="l18.255" class="difflineplus">+                                      message */</span>
<a href="#l18.256"></a><span id="l18.256"> </span>
<a href="#l18.257"></a><span id="l18.257" class="difflineminus">-  int decompose_init_count; /* used for non multipart message only</span>
<a href="#l18.258"></a><span id="l18.258" class="difflineminus">-                             */</span>
<a href="#l18.259"></a><span id="l18.259" class="difflineplus">+  int decompose_init_count; /* used for non multipart message only */</span>
<a href="#l18.260"></a><span id="l18.260"> </span>
<a href="#l18.261"></a><span id="l18.261" class="difflineminus">-  bool signed_p; /* to tell draft this is a signed</span>
<a href="#l18.262"></a><span id="l18.262" class="difflineminus">-          message */</span>
<a href="#l18.263"></a><span id="l18.263" class="difflineplus">+  bool signed_p; /* to tell draft this is a signed message */</span>
<a href="#l18.264"></a><span id="l18.264"> </span>
<a href="#l18.265"></a><span id="l18.265">   bool caller_need_root_headers; /* set it to true to receive the message main</span>
<a href="#l18.266"></a><span id="l18.266" class="difflineminus">-                                      headers through the callback</span>
<a href="#l18.267"></a><span id="l18.267" class="difflineminus">-                                      decompose_headers_info_fn */</span>
<a href="#l18.268"></a><span id="l18.268" class="difflineplus">+                                    headers through the callback</span>
<a href="#l18.269"></a><span id="l18.269" class="difflineplus">+                                    decompose_headers_info_fn */</span>
<a href="#l18.270"></a><span id="l18.270"> </span>
<a href="#l18.271"></a><span id="l18.271">   /* Callback to gather the outer most headers so we could use the</span>
<a href="#l18.272"></a><span id="l18.272">    information to initialize the addressing/subject/newsgroups fields</span>
<a href="#l18.273"></a><span id="l18.273">    for the composition window. */</span>
<a href="#l18.274"></a><span id="l18.274">   int (*decompose_headers_info_fn)(void *closure, MimeHeaders *headers);</span>
<a href="#l18.275"></a><span id="l18.275"> </span>
<a href="#l18.276"></a><span id="l18.276">   /* Callbacks to create temporary files for drafts attachments. */</span>
<a href="#l18.277"></a><span id="l18.277">   int (*decompose_file_init_fn)(void *stream_closure, MimeHeaders *headers);</span>
<a href="#l18.278"></a><span id="l18.278"> </span>
<a href="#l18.279"></a><span id="l18.279">   MimeConverterOutputCallback decompose_file_output_fn;</span>
<a href="#l18.280"></a><span id="l18.280"> </span>
<a href="#l18.281"></a><span id="l18.281">   int (*decompose_file_close_fn)(void *stream_closure);</span>
<a href="#l18.282"></a><span id="l18.282"> #endif /* MIME_DRAFTS */</span>
<a href="#l18.283"></a><span id="l18.283"> </span>
<a href="#l18.284"></a><span id="l18.284">   int32_t attachment_icon_layer_id; /* Hackhackhack.  This is zero if we have</span>
<a href="#l18.285"></a><span id="l18.285" class="difflineminus">-                   not yet emitted the attachment layer</span>
<a href="#l18.286"></a><span id="l18.286" class="difflineminus">-                   stuff.  If we have, then this is the</span>
<a href="#l18.287"></a><span id="l18.287" class="difflineminus">-                   id number for that layer, which is a</span>
<a href="#l18.288"></a><span id="l18.288" class="difflineminus">-                   unique random number every time, to keep</span>
<a href="#l18.289"></a><span id="l18.289" class="difflineminus">-                   evil people from writing javascript code</span>
<a href="#l18.290"></a><span id="l18.290" class="difflineminus">-                   to hack it. */</span>
<a href="#l18.291"></a><span id="l18.291" class="difflineplus">+                                       not yet emitted the attachment layer</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineplus">+                                       stuff.  If we have, then this is the</span>
<a href="#l18.293"></a><span id="l18.293" class="difflineplus">+                                       id number for that layer, which is a</span>
<a href="#l18.294"></a><span id="l18.294" class="difflineplus">+                                       unique random number every time, to keep</span>
<a href="#l18.295"></a><span id="l18.295" class="difflineplus">+                                       evil people from writing javascript code</span>
<a href="#l18.296"></a><span id="l18.296" class="difflineplus">+                                       to hack it. */</span>
<a href="#l18.297"></a><span id="l18.297"> </span>
<a href="#l18.298"></a><span id="l18.298">   bool missing_parts; /* Whether or not this message is going to contain</span>
<a href="#l18.299"></a><span id="l18.299" class="difflineminus">-                missing parts (from IMAP Mime Parts On Demand) */</span>
<a href="#l18.300"></a><span id="l18.300" class="difflineplus">+                         missing parts (from IMAP Mime Parts On Demand) */</span>
<a href="#l18.301"></a><span id="l18.301"> </span>
<a href="#l18.302"></a><span id="l18.302">   bool show_attachment_inline_p; /* Whether or not we should display attachment</span>
<a href="#l18.303"></a><span id="l18.303" class="difflineminus">-                         inline (whatever say the content-disposition) */</span>
<a href="#l18.304"></a><span id="l18.304" class="difflineplus">+                                    inline (whatever say the</span>
<a href="#l18.305"></a><span id="l18.305" class="difflineplus">+                                    content-disposition) */</span>
<a href="#l18.306"></a><span id="l18.306"> </span>
<a href="#l18.307"></a><span id="l18.307">   bool show_attachment_inline_text; /* Whether or not we should display text</span>
<a href="#l18.308"></a><span id="l18.308" class="difflineminus">-                         attachment inline (whatever the content-disposition</span>
<a href="#l18.309"></a><span id="l18.309" class="difflineminus">-                         says) */</span>
<a href="#l18.310"></a><span id="l18.310" class="difflineplus">+                                       attachment inline (whatever the</span>
<a href="#l18.311"></a><span id="l18.311" class="difflineplus">+                                       content-disposition says) */</span>
<a href="#l18.312"></a><span id="l18.312"> </span>
<a href="#l18.313"></a><span id="l18.313">   bool quote_attachment_inline_p; /* Whether or not we should include inlined</span>
<a href="#l18.314"></a><span id="l18.314" class="difflineminus">-                         attachments in quotes of replies) */</span>
<a href="#l18.315"></a><span id="l18.315" class="difflineplus">+                                     attachments in quotes of replies) */</span>
<a href="#l18.316"></a><span id="l18.316"> </span>
<a href="#l18.317"></a><span id="l18.317">   int32_t html_as_p; /* How we should display HTML, which allows us to know if</span>
<a href="#l18.318"></a><span id="l18.318">                         we should display all body parts */</span>
<a href="#l18.319"></a><span id="l18.319"> </span>
<a href="#l18.320"></a><span id="l18.320">   /**</span>
<a href="#l18.321"></a><span id="l18.321">    * Should StartBody/EndBody events be generated for nested MimeMessages.  If</span>
<a href="#l18.322"></a><span id="l18.322">    *  false (the default value), the events are only generated for the outermost</span>
<a href="#l18.323"></a><span id="l18.323">    *  MimeMessage.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.h</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -53,18 +53,18 @@ class nsStreamConverter : public nsIStre</span>
<a href="#l19.4"></a><span id="l19.4">   nsCOMPtr&lt;nsIAsyncOutputStream&gt; mOutputStream;  // output stream</span>
<a href="#l19.5"></a><span id="l19.5">   nsCOMPtr&lt;nsIAsyncInputStream&gt; mInputStream;</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">   nsCOMPtr&lt;nsIStreamListener&gt; mOutListener;  // output stream listener</span>
<a href="#l19.8"></a><span id="l19.8">   nsCOMPtr&lt;nsIChannel&gt; mOutgoingChannel;</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">   nsCOMPtr&lt;nsIMimeEmitter&gt; mEmitter;  // emitter being used...</span>
<a href="#l19.11"></a><span id="l19.11">   nsCOMPtr&lt;nsIURI&gt; mURI;              // URI being processed</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  nsMimeOutputType</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-      mOutputType;  // the output type we should use for the operation</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+  nsMimeOutputType mOutputType;       // the output type we should use for the</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+                                      // operation</span>
<a href="#l19.16"></a><span id="l19.16">   bool mAlreadyKnowOutputType;</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18">   void *mBridgeStream;  // internal libmime data stream</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">   // Type of output, entire message, header only, body only</span>
<a href="#l19.21"></a><span id="l19.21">   nsCString mOutputFormat;</span>
<a href="#l19.22"></a><span id="l19.22">   nsCString mRealContentType;  // if we know the content type for real, this</span>
<a href="#l19.23"></a><span id="l19.23">                                // will be set (used by attachments)</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineat">@@ -82,13 +82,13 @@ class nsStreamConverter : public nsIStre</span>
<a href="#l19.25"></a><span id="l19.25">   nsCString mOriginalMsgURI;</span>
<a href="#l19.26"></a><span id="l19.26">   nsCOMPtr&lt;nsIMsgDBHdr&gt; mOrigMsgHdr;</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">   nsCString mFromType;</span>
<a href="#l19.29"></a><span id="l19.29">   nsCString mToType;</span>
<a href="#l19.30"></a><span id="l19.30"> #ifdef DEBUG_mscott</span>
<a href="#l19.31"></a><span id="l19.31">   PRTime mConvertContentTime;</span>
<a href="#l19.32"></a><span id="l19.32"> #endif</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-  nsIRequest</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-      *mPendingRequest;  // used when we need to delay to fire onStartRequest</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+  nsIRequest *mPendingRequest;  // used when we need to delay to fire</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+                                // onStartRequest</span>
<a href="#l19.37"></a><span id="l19.37"> };</span>
<a href="#l19.38"></a><span id="l19.38"> </span>
<a href="#l19.39"></a><span id="l19.39"> #endif /* nsStreamConverter_h_ */</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

