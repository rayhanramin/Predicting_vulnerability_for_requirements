<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19888:90226acddf809e946b07f5ba04aafff5ff9db1a2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 90226acddf809e946b07f5ba04aafff5ff9db1a2" />
<meta property="og:url" content="/comm-central/rev/90226acddf809e946b07f5ba04aafff5ff9db1a2" />
<meta property="og:description" content="Bug 1293808 - Remove defunct image caching. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 90226acddf809e946b07f5ba04aafff5ff9db1a2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/90226acddf809e946b07f5ba04aafff5ff9db1a2">shortlog</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/90226acddf809e946b07f5ba04aafff5ff9db1a2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2">files</a> |
changeset |
<a href="/comm-central/raw-rev/90226acddf809e946b07f5ba04aafff5ff9db1a2">raw</a>  | <a href="/comm-central/archive/90226acddf809e946b07f5ba04aafff5ff9db1a2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1293808">Bug 1293808</a> - Remove defunct image caching. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 15 Aug 2016 09:40:01 +0200</td></tr>

<tr>
 <td>changeset 19888</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/90226acddf809e946b07f5ba04aafff5ff9db1a2">90226acddf809e946b07f5ba04aafff5ff9db1a2</a></td>
</tr>



<tr>
<td>parent 19887</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cd8d6e07925eca1390840d98c5264953ca5afc87">cd8d6e07925eca1390840d98c5264953ca5afc87</a>
</td>
</tr>

<tr>
<td>child 19889</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/903910d8f38a2e5ee8ac3b931b4bf45fe331cb12">903910d8f38a2e5ee8ac3b931b4bf45fe331cb12</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=90226acddf809e946b07f5ba04aafff5ff9db1a2">12182</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 15 Aug 2016 07:41:37 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@90226acddf80 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=90226acddf809e946b07f5ba04aafff5ff9db1a2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=90226acddf809e946b07f5ba04aafff5ff9db1a2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=90226acddf809e946b07f5ba04aafff5ff9db1a2&newProject=comm-central&newRevision=cd8d6e07925eca1390840d98c5264953ca5afc87&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=90226acddf809e946b07f5ba04aafff5ff9db1a2&newProject=comm-central&newRevision=cd8d6e07925eca1390840d98c5264953ca5afc87&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=90226acddf809e946b07f5ba04aafff5ff9db1a2&newProject=comm-central&newRevision=cd8d6e07925eca1390840d98c5264953ca5afc87&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1293808">1293808</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1293808">Bug 1293808</a> - Remove defunct image caching. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/public/nsIMsgMailNewsUrl.idl">mailnews/base/public/nsIMsgMailNewsUrl.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/public/nsIMsgMailNewsUrl.idl">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/public/nsIMsgMailNewsUrl.idl">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/public/nsIMsgMailNewsUrl.idl">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/public/nsIMsgMailNewsUrl.idl">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/public/nsIMsgMailNewsUrl.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.h">mailnews/base/util/nsMsgMailNewsUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.h">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.h">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.h">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.h">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/base/util/nsMsgMailNewsUrl.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/public/nsIImapMessageSink.idl">mailnews/imap/public/nsIImapMessageSink.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/public/nsIImapMessageSink.idl">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/public/nsIImapMessageSink.idl">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/public/nsIImapMessageSink.idl">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/public/nsIImapMessageSink.idl">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/public/nsIImapMessageSink.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsSyncRunnableHelpers.cpp">mailnews/imap/src/nsSyncRunnableHelpers.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsSyncRunnableHelpers.cpp">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsSyncRunnableHelpers.cpp">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsSyncRunnableHelpers.cpp">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsSyncRunnableHelpers.cpp">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/imap/src/nsSyncRunnableHelpers.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimei.h">mailnews/mime/src/mimei.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimei.h">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimei.h">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimei.h">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimei.h">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimei.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/90226acddf809e946b07f5ba04aafff5ff9db1a2/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgMailNewsUrl.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgMailNewsUrl.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -9,17 +9,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> interface nsIFile;</span>
<a href="#l1.5"></a><span id="l1.5"> interface nsIUrlListener;</span>
<a href="#l1.6"></a><span id="l1.6"> interface nsIMsgStatusFeedback;</span>
<a href="#l1.7"></a><span id="l1.7"> interface nsIMsgIncomingServer;</span>
<a href="#l1.8"></a><span id="l1.8"> interface nsIMsgWindow;</span>
<a href="#l1.9"></a><span id="l1.9"> interface nsILoadGroup;</span>
<a href="#l1.10"></a><span id="l1.10"> interface nsIMsgSearchSession;</span>
<a href="#l1.11"></a><span id="l1.11"> interface nsICacheEntryDescriptor;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-interface nsICacheSession;</span>
<a href="#l1.13"></a><span id="l1.13"> interface nsIMimeHeaders;</span>
<a href="#l1.14"></a><span id="l1.14"> interface nsIStreamListener;</span>
<a href="#l1.15"></a><span id="l1.15"> interface nsIMsgFolder;</span>
<a href="#l1.16"></a><span id="l1.16"> interface nsIMsgHeaderSink;</span>
<a href="#l1.17"></a><span id="l1.17"> interface nsIMsgDBHdr;</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> [scriptable, uuid(995455ba-5bb4-4643-8d70-2b877a2e1320)]</span>
<a href="#l1.20"></a><span id="l1.20"> interface nsIMsgMailNewsUrl : nsIURL {</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -90,29 +89,21 @@ interface nsIMsgMailNewsUrl : nsIURL {</span>
<a href="#l1.22"></a><span id="l1.22">   attribute nsIMimeHeaders mimeHeaders;</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24">   // the load group is computed from the msgWindow</span>
<a href="#l1.25"></a><span id="l1.25">   readonly attribute nsILoadGroup loadGroup;</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   // search session, if we're running a search.</span>
<a href="#l1.28"></a><span id="l1.28">   attribute nsIMsgSearchSession searchSession;</span>
<a href="#l1.29"></a><span id="l1.29">   attribute boolean updatingFolder;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  attribute boolean addToMemoryCache; </span>
<a href="#l1.31"></a><span id="l1.31">   attribute boolean msgIsInLocalCache;</span>
<a href="#l1.32"></a><span id="l1.32">   attribute boolean suppressErrorMsgs; // used to avoid displaying biff error messages</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34">   attribute nsICacheEntryDescriptor memCacheEntry;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-  // if we want mime to cache images fetched by this message, set this cache session.</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-  attribute nsICacheSession imageCacheSession; </span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-  // hold onto this cache entry until url goes away. This is used by mime to keep</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-  // images cached until the url is deleted so we don't get entries evicted</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-  // before we've used them. We need to be sure this doesn't introduce</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-  // circular references or the url will never get freed.</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-  void cacheCacheEntry(in nsICacheEntryDescriptor cacheEntry);</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-  void removeCacheEntry(in nsICacheEntryDescriptor cacheEntry);</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+</span>
<a href="#l1.44"></a><span id="l1.44">   const unsigned long eCopy     = 0;</span>
<a href="#l1.45"></a><span id="l1.45">   const unsigned long eMove     = 1;</span>
<a href="#l1.46"></a><span id="l1.46">   const unsigned long eDisplay  = 2;</span>
<a href="#l1.47"></a><span id="l1.47">   boolean IsUrlType(in unsigned long type);</span>
<a href="#l1.48"></a><span id="l1.48">   nsIStreamListener getSaveAsListener(in boolean addDummyEnvelope, in nsIFile aFile);</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50">   // typically the header sink is tied to the nsIMsgWindow, but in certain circumstances, a consumer</span>
<a href="#l1.51"></a><span id="l1.51">   // may chose to provide its own header sink for this url</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -28,17 +28,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &lt;algorithm&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> nsMsgMailNewsUrl::nsMsgMailNewsUrl()</span>
<a href="#l2.7"></a><span id="l2.7"> {</span>
<a href="#l2.8"></a><span id="l2.8">   // nsIURI specific state</span>
<a href="#l2.9"></a><span id="l2.9">   m_errorMessage = nullptr;</span>
<a href="#l2.10"></a><span id="l2.10">   m_runningUrl = false;</span>
<a href="#l2.11"></a><span id="l2.11">   m_updatingFolder = false;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  m_addContentToCache = false;</span>
<a href="#l2.13"></a><span id="l2.13">   m_msgIsInLocalCache = false;</span>
<a href="#l2.14"></a><span id="l2.14">   m_suppressErrorMsgs = false;</span>
<a href="#l2.15"></a><span id="l2.15">   mMaxProgress = -1;</span>
<a href="#l2.16"></a><span id="l2.16">   m_baseURL = do_CreateInstance(NS_STANDARDURL_CONTRACTID);</span>
<a href="#l2.17"></a><span id="l2.17"> }</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19"> #define NOTIFY_URL_LISTENERS(propertyfunc_, params_)                   \</span>
<a href="#l2.20"></a><span id="l2.20">   PR_BEGIN_MACRO                                                       \</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -257,29 +256,16 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetUpdat</span>
<a href="#l2.22"></a><span id="l2.22"> }</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24"> NS_IMETHODIMP nsMsgMailNewsUrl::SetUpdatingFolder(bool updatingFolder)</span>
<a href="#l2.25"></a><span id="l2.25"> {</span>
<a href="#l2.26"></a><span id="l2.26">   m_updatingFolder = updatingFolder;</span>
<a href="#l2.27"></a><span id="l2.27">   return NS_OK;</span>
<a href="#l2.28"></a><span id="l2.28"> }</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::GetAddToMemoryCache(bool *aAddToCache)</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-{</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-  NS_ENSURE_ARG(aAddToCache); </span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-  *aAddToCache = m_addContentToCache;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-  return NS_OK;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-}</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::SetAddToMemoryCache(bool aAddToCache)</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-{</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-  m_addContentToCache = aAddToCache;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-  return NS_OK;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-}</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-</span>
<a href="#l2.43"></a><span id="l2.43"> NS_IMETHODIMP nsMsgMailNewsUrl::GetMsgIsInLocalCache(bool *aMsgIsInLocalCache)</span>
<a href="#l2.44"></a><span id="l2.44"> {</span>
<a href="#l2.45"></a><span id="l2.45">   NS_ENSURE_ARG(aMsgIsInLocalCache); </span>
<a href="#l2.46"></a><span id="l2.46">   *aMsgIsInLocalCache = m_msgIsInLocalCache;</span>
<a href="#l2.47"></a><span id="l2.47">   return NS_OK;</span>
<a href="#l2.48"></a><span id="l2.48"> }</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50"> NS_IMETHODIMP nsMsgMailNewsUrl::SetMsgIsInLocalCache(bool aMsgIsInLocalCache)</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineat">@@ -715,44 +701,16 @@ NS_IMETHODIMP nsMsgMailNewsUrl:: GetMemC</span>
<a href="#l2.52"></a><span id="l2.52">   {</span>
<a href="#l2.53"></a><span id="l2.53">     *memCacheEntry = nullptr;</span>
<a href="#l2.54"></a><span id="l2.54">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l2.55"></a><span id="l2.55">   }</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57">   return rv;</span>
<a href="#l2.58"></a><span id="l2.58"> }</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::SetImageCacheSession(nsICacheSession *imageCacheSession)</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-{</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-  m_imageCacheSession = imageCacheSession;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-  return NS_OK;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-}</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::GetImageCacheSession(nsICacheSession **imageCacheSession)</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-{</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-  NS_ENSURE_ARG(imageCacheSession);</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-  NS_IF_ADDREF(*imageCacheSession = m_imageCacheSession);</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-  return NS_OK;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-}</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::CacheCacheEntry(nsICacheEntryDescriptor *cacheEntry)</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-{</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-  m_cachedMemCacheEntries.AppendObject(cacheEntry);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-  return NS_OK;</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-}</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::RemoveCacheEntry(nsICacheEntryDescriptor *cacheEntry)</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-{</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-  m_cachedMemCacheEntries.RemoveObject(cacheEntry);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-  return NS_OK;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-}</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-</span>
<a href="#l2.88"></a><span id="l2.88"> NS_IMETHODIMP nsMsgMailNewsUrl::GetMimeHeaders(nsIMimeHeaders * *mimeHeaders)</span>
<a href="#l2.89"></a><span id="l2.89"> {</span>
<a href="#l2.90"></a><span id="l2.90">     NS_ENSURE_ARG_POINTER(mimeHeaders);</span>
<a href="#l2.91"></a><span id="l2.91">     NS_IF_ADDREF(*mimeHeaders = mMimeHeaders);</span>
<a href="#l2.92"></a><span id="l2.92">     return (mMimeHeaders) ? NS_OK : NS_ERROR_NULL_POINTER;</span>
<a href="#l2.93"></a><span id="l2.93"> }</span>
<a href="#l2.94"></a><span id="l2.94"> </span>
<a href="#l2.95"></a><span id="l2.95"> NS_IMETHODIMP nsMsgMailNewsUrl::SetMimeHeaders(nsIMimeHeaders *mimeHeaders)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -51,24 +51,21 @@ protected:</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   nsCOMPtr&lt;nsIURL&gt; m_baseURL;</span>
<a href="#l3.6"></a><span id="l3.6">   nsWeakPtr m_statusFeedbackWeak;</span>
<a href="#l3.7"></a><span id="l3.7">   nsWeakPtr m_msgWindowWeak;</span>
<a href="#l3.8"></a><span id="l3.8">   nsWeakPtr m_loadGroupWeak;</span>
<a href="#l3.9"></a><span id="l3.9">   nsCOMPtr&lt;nsIMimeHeaders&gt; mMimeHeaders;</span>
<a href="#l3.10"></a><span id="l3.10">   nsCOMPtr&lt;nsIMsgSearchSession&gt; m_searchSession;</span>
<a href="#l3.11"></a><span id="l3.11">   nsCOMPtr&lt;nsICacheEntryDescriptor&gt; m_memCacheEntry;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  nsCOMPtr&lt;nsICacheSession&gt; m_imageCacheSession;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  nsCOMArray&lt;nsICacheEntryDescriptor&gt; m_cachedMemCacheEntries;</span>
<a href="#l3.14"></a><span id="l3.14">   nsCOMPtr&lt;nsIMsgHeaderSink&gt; mMsgHeaderSink;</span>
<a href="#l3.15"></a><span id="l3.15">   char *m_errorMessage;</span>
<a href="#l3.16"></a><span id="l3.16">   int64_t mMaxProgress;</span>
<a href="#l3.17"></a><span id="l3.17">   bool m_runningUrl;</span>
<a href="#l3.18"></a><span id="l3.18">   bool m_updatingFolder;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-  bool m_addContentToCache;</span>
<a href="#l3.20"></a><span id="l3.20">   bool m_msgIsInLocalCache;</span>
<a href="#l3.21"></a><span id="l3.21">   bool m_suppressErrorMsgs;</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">   // the following field is really a bit of a hack to make </span>
<a href="#l3.24"></a><span id="l3.24">   // open attachments work. The external applications code sometimes tries to figure out the right</span>
<a href="#l3.25"></a><span id="l3.25">   // handler to use by looking at the file extension of the url we are trying to load. Unfortunately,</span>
<a href="#l3.26"></a><span id="l3.26">   // the attachment file name really isn't part of the url string....so we'll store it here...and if </span>
<a href="#l3.27"></a><span id="l3.27">   // the url we are running is an attachment url, we'll set it here. Then when the helper apps code</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/imap/public/nsIImapMessageSink.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/imap/public/nsIImapMessageSink.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -58,17 +58,16 @@ interface nsIImapMessageSink : nsISuppor</span>
<a href="#l4.4"></a><span id="l4.4">                           in nsMsgKey aMessageKey,</span>
<a href="#l4.5"></a><span id="l4.5">                           in unsigned long long aHighestModSeq);</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">   void notifyMessageDeleted(in string aOnlineFolderName,in boolean aDeleteAllMsgs,in string aMsgIdString);</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">   void getMessageSizeFromDB(in string aId, out unsigned long aSize);</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">   void setContentModified(in nsIImapUrl aImapUrl, in nsImapContentModifiedType aModified);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  void setImageCacheSessionForUrl(in nsIMsgMailNewsUrl aMailUrl);</span>
<a href="#l4.13"></a><span id="l4.13">   </span>
<a href="#l4.14"></a><span id="l4.14">   /**</span>
<a href="#l4.15"></a><span id="l4.15">    * For a message stored in a file, get the message metadata needed to copy</span>
<a href="#l4.16"></a><span id="l4.16">    * that message to an imap folder</span>
<a href="#l4.17"></a><span id="l4.17">    *</span>
<a href="#l4.18"></a><span id="l4.18">    * @param aRunningUrl  message URL</span>
<a href="#l4.19"></a><span id="l4.19">    * @param aDate        message date</span>
<a href="#l4.20"></a><span id="l4.20">    * @param aKeywords    message custom keywords (if supported by the server),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -5070,30 +5070,16 @@ nsImapMailFolder::GetMessageSizeFromDB(c</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> NS_IMETHODIMP</span>
<a href="#l5.6"></a><span id="l5.6"> nsImapMailFolder::SetContentModified(nsIImapUrl *aImapUrl, nsImapContentModifiedType modified)</span>
<a href="#l5.7"></a><span id="l5.7"> {</span>
<a href="#l5.8"></a><span id="l5.8">   return aImapUrl-&gt;SetContentModified(modified);</span>
<a href="#l5.9"></a><span id="l5.9"> }</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> NS_IMETHODIMP</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-nsImapMailFolder::SetImageCacheSessionForUrl(nsIMsgMailNewsUrl *mailurl)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-{</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-  nsCOMPtr&lt;nsICacheSession&gt; cacheSession;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-  rv = imapService-&gt;GetCacheSession(getter_AddRefs(cacheSession));</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; cacheSession)</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-    rv = mailurl-&gt;SetImageCacheSession(cacheSession);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-  return rv;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-}</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.26"></a><span id="l5.26"> nsImapMailFolder::GetCurMoveCopyMessageInfo(nsIImapUrl *runningUrl,</span>
<a href="#l5.27"></a><span id="l5.27">                                             PRTime *aDate,</span>
<a href="#l5.28"></a><span id="l5.28">                                             nsACString&amp; aKeywords,</span>
<a href="#l5.29"></a><span id="l5.29">                                             uint32_t* aResult)</span>
<a href="#l5.30"></a><span id="l5.30"> {</span>
<a href="#l5.31"></a><span id="l5.31">   nsCOMPtr &lt;nsISupports&gt; copyState;</span>
<a href="#l5.32"></a><span id="l5.32">   runningUrl-&gt;GetCopyState(getter_AddRefs(copyState));</span>
<a href="#l5.33"></a><span id="l5.33">   if (copyState)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -2641,25 +2641,16 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l6.4"></a><span id="l6.4">                 IMAP_ContentModifiedType modType = GetShowAttachmentsInline() ?</span>
<a href="#l6.5"></a><span id="l6.5">                   IMAP_CONTENT_MODIFIED_VIEW_INLINE :</span>
<a href="#l6.6"></a><span id="l6.6">                   IMAP_CONTENT_MODIFIED_VIEW_AS_LINKS ;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">                 bool wasStoringMsgOffline;</span>
<a href="#l6.9"></a><span id="l6.9">                 m_runningUrl-&gt;GetStoreResultsOffline(&amp;wasStoringMsgOffline);</span>
<a href="#l6.10"></a><span id="l6.10">                 m_runningUrl-&gt;SetStoreOfflineOnFallback(wasStoringMsgOffline);</span>
<a href="#l6.11"></a><span id="l6.11">                 m_runningUrl-&gt;SetStoreResultsOffline(false);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailurl = do_QueryInterface(m_runningUrl);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                if (mailurl)</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                  mailurl-&gt;SetAddToMemoryCache(false);</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-                  // need to proxy this over to the ui thread</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-                  if (m_imapMessageSink)</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-                    m_imapMessageSink-&gt;SetImageCacheSessionForUrl(mailurl);</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-                }</span>
<a href="#l6.21"></a><span id="l6.21">                 SetContentModified(modType);  // This will be looked at by the cache</span>
<a href="#l6.22"></a><span id="l6.22">                 if (bMessageIdsAreUids)</span>
<a href="#l6.23"></a><span id="l6.23">                 {</span>
<a href="#l6.24"></a><span id="l6.24">                   res = m_hostSessionList-&gt;FindShellInCacheForHost(GetImapServerKey(),</span>
<a href="#l6.25"></a><span id="l6.25">                     GetServerStateParser().GetSelectedMailboxName(),</span>
<a href="#l6.26"></a><span id="l6.26">                     messageIdString.get(), modType, getter_AddRefs(foundShell));</span>
<a href="#l6.27"></a><span id="l6.27">                   if (foundShell)</span>
<a href="#l6.28"></a><span id="l6.28">                   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -513,17 +513,16 @@ NS_IMETHODIMP nsImapService::DisplayMess</span>
<a href="#l7.4"></a><span id="l7.4">       }</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">       if (folder)</span>
<a href="#l7.7"></a><span id="l7.7">       {</span>
<a href="#l7.8"></a><span id="l7.8">         folder-&gt;ShouldStoreMsgOffline(key, &amp;shouldStoreMsgOffline);</span>
<a href="#l7.9"></a><span id="l7.9">         folder-&gt;HasMsgOffline(key, &amp;hasMsgOffline);</span>
<a href="#l7.10"></a><span id="l7.10">       }</span>
<a href="#l7.11"></a><span id="l7.11">       imapUrl-&gt;SetStoreResultsOffline(shouldStoreMsgOffline);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      msgurl-&gt;SetAddToMemoryCache(!hasMsgOffline);</span>
<a href="#l7.13"></a><span id="l7.13">       imapUrl-&gt;SetFetchPartsOnDemand(</span>
<a href="#l7.14"></a><span id="l7.14">         useMimePartsOnDemand &amp;&amp; messageSize &gt;= (uint32_t) gMIMEOnDemandThreshold);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">       if (hasMsgOffline)</span>
<a href="#l7.17"></a><span id="l7.17">         msgurl-&gt;SetMsgIsInLocalCache(true);</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">       nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l7.20"></a><span id="l7.20">       // Should the message fetch force a peek or a traditional fetch?</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -1187,18 +1186,16 @@ NS_IMETHODIMP nsImapService::StreamMessa</span>
<a href="#l7.22"></a><span id="l7.22">           rv = IsMsgInMemCache(url, folder, nullptr, &amp;isMsgInMemCache);</span>
<a href="#l7.23"></a><span id="l7.23">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">           if (!isMsgInMemCache)</span>
<a href="#l7.26"></a><span id="l7.26">             return NS_ERROR_FAILURE;</span>
<a href="#l7.27"></a><span id="l7.27">         }</span>
<a href="#l7.28"></a><span id="l7.28">       }</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-      msgurl-&gt;SetAddToMemoryCache(true);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-</span>
<a href="#l7.32"></a><span id="l7.32">       bool shouldStoreMsgOffline = false;</span>
<a href="#l7.33"></a><span id="l7.33">       folder-&gt;ShouldStoreMsgOffline(key, &amp;shouldStoreMsgOffline);</span>
<a href="#l7.34"></a><span id="l7.34">       imapUrl-&gt;SetStoreResultsOffline(shouldStoreMsgOffline);</span>
<a href="#l7.35"></a><span id="l7.35">       rv = GetMessageFromUrl(imapUrl, nsIImapUrl::nsImapMsgFetchPeek, folder,</span>
<a href="#l7.36"></a><span id="l7.36">                              imapMessageSink, aMsgWindow, aConsumer,</span>
<a href="#l7.37"></a><span id="l7.37">                              aConvertData, aURL);</span>
<a href="#l7.38"></a><span id="l7.38">     }</span>
<a href="#l7.39"></a><span id="l7.39">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/src/nsSyncRunnableHelpers.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -407,17 +407,16 @@ NS_SYNCRUNNABLEMETHOD2(ImapMessageSink, </span>
<a href="#l8.4"></a><span id="l8.4"> NS_SYNCRUNNABLEMETHOD3(ImapMessageSink, ParseAdoptedMsgLine, const char *, nsMsgKey, nsIImapUrl *)</span>
<a href="#l8.5"></a><span id="l8.5"> NS_SYNCRUNNABLEMETHOD4(ImapMessageSink, NormalEndMsgWriteStream, nsMsgKey, bool, nsIImapUrl *, int32_t)</span>
<a href="#l8.6"></a><span id="l8.6"> NS_SYNCRUNNABLEMETHOD0(ImapMessageSink, AbortMsgWriteStream)</span>
<a href="#l8.7"></a><span id="l8.7"> NS_SYNCRUNNABLEMETHOD0(ImapMessageSink, BeginMessageUpload)</span>
<a href="#l8.8"></a><span id="l8.8"> NS_SYNCRUNNABLEMETHOD4(ImapMessageSink, NotifyMessageFlags, uint32_t, const nsACString &amp;, nsMsgKey, uint64_t)</span>
<a href="#l8.9"></a><span id="l8.9"> NS_SYNCRUNNABLEMETHOD3(ImapMessageSink, NotifyMessageDeleted, const char *, bool, const char *)</span>
<a href="#l8.10"></a><span id="l8.10"> NS_SYNCRUNNABLEMETHOD2(ImapMessageSink, GetMessageSizeFromDB, const char *, uint32_t *)</span>
<a href="#l8.11"></a><span id="l8.11"> NS_SYNCRUNNABLEMETHOD2(ImapMessageSink, SetContentModified, nsIImapUrl *, nsImapContentModifiedType)</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-NS_SYNCRUNNABLEMETHOD1(ImapMessageSink, SetImageCacheSessionForUrl, nsIMsgMailNewsUrl *)</span>
<a href="#l8.13"></a><span id="l8.13"> NS_SYNCRUNNABLEMETHOD4(ImapMessageSink, GetCurMoveCopyMessageInfo, nsIImapUrl *, PRTime *, nsACString &amp;, uint32_t *)</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> NS_SYNCRUNNABLEMETHOD4(ImapServerSink, PossibleImapMailbox, const nsACString &amp;, char, int32_t, bool *)</span>
<a href="#l8.16"></a><span id="l8.16"> NS_SYNCRUNNABLEMETHOD2(ImapServerSink, FolderNeedsACLInitialized, const nsACString &amp;, bool *)</span>
<a href="#l8.17"></a><span id="l8.17"> NS_SYNCRUNNABLEMETHOD3(ImapServerSink, AddFolderRights, const nsACString &amp;, const nsACString &amp;, const nsACString &amp;)</span>
<a href="#l8.18"></a><span id="l8.18"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, RefreshFolderRights, const nsACString &amp;)</span>
<a href="#l8.19"></a><span id="l8.19"> NS_SYNCRUNNABLEMETHOD0(ImapServerSink, DiscoveryDone)</span>
<a href="#l8.20"></a><span id="l8.20"> NS_SYNCRUNNABLEMETHOD1(ImapServerSink, OnlineFolderDelete, const nsACString &amp;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/mime/src/mimei.h</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/mime/src/mimei.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -401,30 +401,19 @@ extern int MimeOptions_write(MimeDisplay</span>
<a href="#l9.4"></a><span id="l9.4">                              const char *data, int32_t length,</span>
<a href="#l9.5"></a><span id="l9.5">                              bool user_visible_p);</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> /* Writes out the right kind of HR (or rather, queues it for writing.) */</span>
<a href="#l9.8"></a><span id="l9.8"> extern int MimeObject_write_separator(MimeObject *);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> extern bool MimeObjectIsMessageBody(MimeObject *obj);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-/* This is the data tagged to contexts and the declaration needs to be</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-   in a header file since more than mimemoz.c needs to see it now...</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-   */</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-#ifdef HAVE_MIME_DATA_SLOT</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-# define LOCK_LAST_CACHED_MESSAGE</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-#endif</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-</span>
<a href="#l9.19"></a><span id="l9.19"> struct MimeDisplayData {            /* This struct is what we hang off of</span>
<a href="#l9.20"></a><span id="l9.20">                                        (context)-&gt;mime_data, to remember info</span>
<a href="#l9.21"></a><span id="l9.21">                                        about the last MIME object we've</span>
<a href="#l9.22"></a><span id="l9.22">                                        parsed and displayed.  See</span>
<a href="#l9.23"></a><span id="l9.23">                                        MimeGuessURLContentName() below.</span>
<a href="#l9.24"></a><span id="l9.24">                                      */</span>
<a href="#l9.25"></a><span id="l9.25">   MimeObject *last_parsed_object;</span>
<a href="#l9.26"></a><span id="l9.26">   char *last_parsed_url;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-#ifdef LOCK_LAST_CACHED_MESSAGE</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-  char *previous_locked_url;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-#endif /* LOCK_LAST_CACHED_MESSAGE */</span>
<a href="#l9.31"></a><span id="l9.31"> };</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33"> #endif /* _MIMEI_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -39,33 +39,27 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsIURI.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-#include &quot;nsICacheEntryDescriptor.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-#include &quot;nsICacheSession.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsITransport.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;mimeebod.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;mimeeobj.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> // &lt;for functions=&quot;HTML2Plaintext,HTMLSantinize&quot;&gt;</span>
<a href="#l10.18"></a><span id="l10.18"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> #include &quot;nsLayoutCID.h&quot;</span>
<a href="#l10.20"></a><span id="l10.20"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l10.21"></a><span id="l10.21"> #include &quot;nsIParserUtils.h&quot;</span>
<a href="#l10.22"></a><span id="l10.22"> // &lt;/for&gt;</span>
<a href="#l10.23"></a><span id="l10.23"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-#ifdef HAVE_MIME_DATA_SLOT</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-#define LOCK_LAST_CACHED_MESSAGE</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-#endif</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-</span>
<a href="#l10.29"></a><span id="l10.29"> void                 ValidateRealName(nsMsgAttachmentData *aAttach, MimeHeaders *aHdrs);</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31"> static MimeHeadersState MIME_HeaderType;</span>
<a href="#l10.32"></a><span id="l10.32"> static bool MIME_WrapLongLines;</span>
<a href="#l10.33"></a><span id="l10.33"> static bool MIME_VariableWidthPlaintext;</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35"> mime_stream_data::mime_stream_data() : url_name(nullptr), orig_url_name(nullptr),</span>
<a href="#l10.36"></a><span id="l10.36">   pluginObj2(nullptr), istream(nullptr), obj(nullptr), options(nullptr),</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineat">@@ -1136,26 +1130,23 @@ static int    mime_image_write_buffer(co</span>
<a href="#l10.38"></a><span id="l10.38">  */</span>
<a href="#l10.39"></a><span id="l10.39"> class mime_image_stream_data {</span>
<a href="#l10.40"></a><span id="l10.40"> public:</span>
<a href="#l10.41"></a><span id="l10.41">   mime_image_stream_data();</span>
<a href="#l10.42"></a><span id="l10.42"> </span>
<a href="#l10.43"></a><span id="l10.43">   mime_stream_data *msd;</span>
<a href="#l10.44"></a><span id="l10.44">   char                    *url;</span>
<a href="#l10.45"></a><span id="l10.45">   nsMIMESession           *istream;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-  nsCOMPtr&lt;nsIOutputStream&gt; memCacheOutputStream;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-  bool m_shouldCacheImage;</span>
<a href="#l10.48"></a><span id="l10.48"> };</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50"> mime_image_stream_data::mime_image_stream_data()</span>
<a href="#l10.51"></a><span id="l10.51"> {</span>
<a href="#l10.52"></a><span id="l10.52">   url = nullptr;</span>
<a href="#l10.53"></a><span id="l10.53">   istream = nullptr;</span>
<a href="#l10.54"></a><span id="l10.54">   msd = nullptr;</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-  m_shouldCacheImage = false;</span>
<a href="#l10.56"></a><span id="l10.56"> }</span>
<a href="#l10.57"></a><span id="l10.57"> </span>
<a href="#l10.58"></a><span id="l10.58"> static void *</span>
<a href="#l10.59"></a><span id="l10.59"> mime_image_begin(const char *image_url, const char *content_type,</span>
<a href="#l10.60"></a><span id="l10.60">                  void *stream_closure)</span>
<a href="#l10.61"></a><span id="l10.61"> {</span>
<a href="#l10.62"></a><span id="l10.62">   mime_stream_data *msd = (mime_stream_data *) stream_closure;</span>
<a href="#l10.63"></a><span id="l10.63">   class mime_image_stream_data *mid;</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineat">@@ -1168,75 +1159,29 @@ mime_image_begin(const char *image_url, </span>
<a href="#l10.65"></a><span id="l10.65"> </span>
<a href="#l10.66"></a><span id="l10.66">   mid-&gt;url = (char *) strdup(image_url);</span>
<a href="#l10.67"></a><span id="l10.67">   if (!mid-&gt;url)</span>
<a href="#l10.68"></a><span id="l10.68">   {</span>
<a href="#l10.69"></a><span id="l10.69">     PR_Free(mid);</span>
<a href="#l10.70"></a><span id="l10.70">     return nullptr;</span>
<a href="#l10.71"></a><span id="l10.71">   }</span>
<a href="#l10.72"></a><span id="l10.72"> </span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-  if (msd-&gt;channel)</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-  {</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-    nsCOMPtr &lt;nsIURI&gt; uri;</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-    nsresult rv = msd-&gt;channel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; uri)</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-    {</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-      nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; mailUrl = do_QueryInterface(uri);</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-      if (mailUrl)</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-      {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-        nsCOMPtr&lt;nsICacheSession&gt; memCacheSession;</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-        mailUrl-&gt;GetImageCacheSession(getter_AddRefs(memCacheSession));</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-        if (memCacheSession)</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-        {</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-          nsCOMPtr&lt;nsICacheEntryDescriptor&gt; entry;</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-          // we may need to convert the image_url into just a part url - in any case,</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-          // it has to be the same as what imglib will be asking imap for later</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-          // on so that we'll find this in the memory cache.</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-          rv = memCacheSession-&gt;OpenCacheEntry(nsDependentCString(image_url), nsICache::ACCESS_READ_WRITE, nsICache::BLOCKING, getter_AddRefs(entry));</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-          nsCacheAccessMode access;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-          if (entry)</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-          {</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-            entry-&gt;GetAccessGranted(&amp;access);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-#ifdef DEBUG_bienvenu</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-            printf(&quot;Mime opening cache entry for %s access = %ld\n&quot;, image_url, access);</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-#endif</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-            // if we only got write access, then we should fill in this cache entry</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-            if (access &amp; nsICache::ACCESS_WRITE &amp;&amp; !(access &amp; nsICache::ACCESS_READ))</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-            {</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-              mailUrl-&gt;CacheCacheEntry(entry);</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-              entry-&gt;MarkValid();</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-              // remember the content type as meta data so we can pull it out in the imap code</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-              // to feed the cache entry directly to imglib w/o going through mime.</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-              entry-&gt;SetMetaDataElement(&quot;contentType&quot;, content_type);</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-              rv = entry-&gt;OpenOutputStream(0, getter_AddRefs(mid-&gt;memCacheOutputStream));</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-              if (NS_FAILED(rv)) return nullptr;</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-            }</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-          }</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineminus">-        }</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineminus">-      }</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineminus">-    }</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-  }</span>
<a href="#l10.117"></a><span id="l10.117">   mid-&gt;istream = (nsMIMESession *) msd-&gt;pluginObj2;</span>
<a href="#l10.118"></a><span id="l10.118">   return mid;</span>
<a href="#l10.119"></a><span id="l10.119"> }</span>
<a href="#l10.120"></a><span id="l10.120"> </span>
<a href="#l10.121"></a><span id="l10.121"> static void</span>
<a href="#l10.122"></a><span id="l10.122"> mime_image_end(void *image_closure, int status)</span>
<a href="#l10.123"></a><span id="l10.123"> {</span>
<a href="#l10.124"></a><span id="l10.124">   mime_image_stream_data *mid =</span>
<a href="#l10.125"></a><span id="l10.125">     (mime_image_stream_data *) image_closure;</span>
<a href="#l10.126"></a><span id="l10.126"> </span>
<a href="#l10.127"></a><span id="l10.127">   PR_ASSERT(mid);</span>
<a href="#l10.128"></a><span id="l10.128">   if (!mid)</span>
<a href="#l10.129"></a><span id="l10.129">     return;</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-  if (mid-&gt;memCacheOutputStream)</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-    mid-&gt;memCacheOutputStream-&gt;Close();</span>
<a href="#l10.132"></a><span id="l10.132"> </span>
<a href="#l10.133"></a><span id="l10.133">   PR_FREEIF(mid-&gt;url);</span>
<a href="#l10.134"></a><span id="l10.134">   delete mid;</span>
<a href="#l10.135"></a><span id="l10.135"> }</span>
<a href="#l10.136"></a><span id="l10.136"> </span>
<a href="#l10.137"></a><span id="l10.137"> </span>
<a href="#l10.138"></a><span id="l10.138"> static char *</span>
<a href="#l10.139"></a><span id="l10.139"> mime_image_make_image_html(void *image_closure)</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineat">@@ -1292,26 +1237,16 @@ mime_image_write_buffer(const char *buf,</span>
<a href="#l10.141"></a><span id="l10.141">   mime_image_stream_data *mid =</span>
<a href="#l10.142"></a><span id="l10.142">                 (mime_image_stream_data *) image_closure;</span>
<a href="#l10.143"></a><span id="l10.143">   mime_stream_data *msd = mid-&gt;msd;</span>
<a href="#l10.144"></a><span id="l10.144"> </span>
<a href="#l10.145"></a><span id="l10.145">   if ( ( (!msd-&gt;output_emitter) ) &amp;&amp;</span>
<a href="#l10.146"></a><span id="l10.146">        ( (!msd-&gt;pluginObj2)     ) )</span>
<a href="#l10.147"></a><span id="l10.147">     return -1;</span>
<a href="#l10.148"></a><span id="l10.148"> </span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-  //</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-  // If we get here, we are just eating the data this time around</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineminus">-  // and the returned URL will deal with writing the data to the viewer.</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-  // Just return the size value to the caller.</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineminus">-  //</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-  if (mid-&gt;memCacheOutputStream)</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-  {</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-    uint32_t bytesWritten;</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-    mid-&gt;memCacheOutputStream-&gt;Write(buf, size, &amp;bytesWritten);</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineminus">-  }</span>
<a href="#l10.159"></a><span id="l10.159">   return size;</span>
<a href="#l10.160"></a><span id="l10.160"> }</span>
<a href="#l10.161"></a><span id="l10.161"> </span>
<a href="#l10.162"></a><span id="l10.162"> MimeObject*</span>
<a href="#l10.163"></a><span id="l10.163"> mime_get_main_object(MimeObject* obj)</span>
<a href="#l10.164"></a><span id="l10.164"> {</span>
<a href="#l10.165"></a><span id="l10.165">   MimeContainer *cobj;</span>
<a href="#l10.166"></a><span id="l10.166">   if (!(mime_subclass_p(obj-&gt;clazz, (MimeObjectClass*) &amp;mimeMessageClass)))</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

