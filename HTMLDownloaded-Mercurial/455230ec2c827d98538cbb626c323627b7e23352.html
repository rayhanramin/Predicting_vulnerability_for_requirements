<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22888:455230ec2c827d98538cbb626c323627b7e23352</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 455230ec2c827d98538cbb626c323627b7e23352" />
<meta property="og:url" content="/comm-central/rev/455230ec2c827d98538cbb626c323627b7e23352" />
<meta property="og:description" content="Bug 1421992 - script-generated patch to replace do_check_* functions with their Assert.* equivalents in C-C. rs=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 455230ec2c827d98538cbb626c323627b7e23352 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/455230ec2c827d98538cbb626c323627b7e23352">shortlog</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/455230ec2c827d98538cbb626c323627b7e23352">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352">files</a> |
changeset |
<a href="/comm-central/raw-rev/455230ec2c827d98538cbb626c323627b7e23352">raw</a>  | <a href="/comm-central/archive/455230ec2c827d98538cbb626c323627b7e23352.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1421992">Bug 1421992</a> - script-generated patch to replace do_check_* functions with their Assert.* equivalents in C-C. rs=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#101;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#113;&#117;&#101;&#122;&#101;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 20 Dec 2017 15:44:11 +0100</td></tr>

<tr>
 <td>changeset 22888</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/455230ec2c827d98538cbb626c323627b7e23352">455230ec2c827d98538cbb626c323627b7e23352</a></td>
</tr>



<tr>
<td>parent 22887</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8ccb4ed893026c1f0b2d330de91340bf86292fca">8ccb4ed893026c1f0b2d330de91340bf86292fca</a>
</td>
</tr>

<tr>
<td>child 22889</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a644e16e6d6985d211177dc8ab363f8fbd56095a">a644e16e6d6985d211177dc8ab363f8fbd56095a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=455230ec2c827d98538cbb626c323627b7e23352">13864</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 20 Dec 2017 20:19:24 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a644e16e6d69 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a644e16e6d6985d211177dc8ab363f8fbd56095a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a644e16e6d6985d211177dc8ab363f8fbd56095a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a644e16e6d6985d211177dc8ab363f8fbd56095a&newProject=comm-central&newRevision=455230ec2c827d98538cbb626c323627b7e23352&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a644e16e6d6985d211177dc8ab363f8fbd56095a&newProject=comm-central&newRevision=455230ec2c827d98538cbb626c323627b7e23352&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a644e16e6d6985d211177dc8ab363f8fbd56095a&newProject=comm-central&newRevision=455230ec2c827d98538cbb626c323627b7e23352&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1421992">1421992</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1421992">Bug 1421992</a> - script-generated patch to replace do_check_* functions with their Assert.* equivalents in C-C. rs=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_accounts.js">chat/components/src/test/test_accounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_accounts.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_accounts.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_accounts.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_accounts.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_accounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_commands.js">chat/components/src/test/test_commands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_commands.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_commands.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_commands.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_commands.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/chat/components/src/test/test_commands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_ArrayBufferUtils.js">chat/modules/test/test_ArrayBufferUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_ArrayBufferUtils.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_ArrayBufferUtils.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_ArrayBufferUtils.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_ArrayBufferUtils.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_ArrayBufferUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_NormalizedMap.js">chat/modules/test/test_NormalizedMap.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_NormalizedMap.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_NormalizedMap.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_NormalizedMap.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_NormalizedMap.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_NormalizedMap.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_filtering.js">chat/modules/test/test_filtering.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_filtering.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_filtering.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_filtering.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_filtering.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/chat/modules/test/test_filtering.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/protocols/irc/test/test_ircNonStandard.js">chat/protocols/irc/test/test_ircNonStandard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/chat/protocols/irc/test/test_ircNonStandard.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/chat/protocols/irc/test/test_ircNonStandard.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/chat/protocols/irc/test/test_ircNonStandard.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/chat/protocols/irc/test/test_ircNonStandard.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/chat/protocols/irc/test/test_ircNonStandard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/ldap/xpcom/tests/unit/test_nsLDAPURL.js">ldap/xpcom/tests/unit/test_nsLDAPURL.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/ldap/xpcom/tests/unit/test_nsLDAPURL.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/ldap/xpcom/tests/unit/test_nsLDAPURL.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/ldap/xpcom/tests/unit/test_nsLDAPURL.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/ldap/xpcom/tests/unit/test_nsLDAPURL.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/ldap/xpcom/tests/unit/test_nsLDAPURL.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_alertHook.js">mail/base/test/unit/test_alertHook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_alertHook.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_alertHook.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_alertHook.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_alertHook.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_alertHook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_mailGlue_distribution.js">mail/base/test/unit/test_mailGlue_distribution.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_mailGlue_distribution.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_mailGlue_distribution.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_mailGlue_distribution.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_mailGlue_distribution.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_mailGlue_distribution.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_imapFolder.js">mail/base/test/unit/test_viewWrapper_imapFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_imapFolder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_imapFolder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_imapFolder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_imapFolder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_imapFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_logic.js">mail/base/test/unit/test_viewWrapper_logic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_logic.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_logic.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_logic.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_logic.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_logic.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_virtualFolder.js">mail/base/test/unit/test_viewWrapper_virtualFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_virtualFolder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_virtualFolder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_virtualFolder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_virtualFolder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_viewWrapper_virtualFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_windows_font_migration.js">mail/base/test/unit/test_windows_font_migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_windows_font_migration.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_windows_font_migration.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_windows_font_migration.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_windows_font_migration.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/base/test/unit/test_windows_font_migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/components/test/unit/test_about_support.js">mail/components/test/unit/test_about_support.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mail/components/test/unit/test_about_support.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mail/components/test/unit/test_about_support.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mail/components/test/unit/test_about_support.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mail/components/test/unit/test_about_support.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mail/components/test/unit/test_about_support.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js">mailnews/addrbook/test/unit/test_basic_nsIAbCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js">mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug534822.js">mailnews/addrbook/test/unit/test_bug534822.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug534822.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug534822.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug534822.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug534822.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug534822.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug_448165.js">mailnews/addrbook/test/unit/test_bug_448165.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug_448165.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug_448165.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug_448165.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug_448165.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_bug_448165.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_cardForEmail.js">mailnews/addrbook/test/unit/test_cardForEmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_cardForEmail.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_cardForEmail.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_cardForEmail.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_cardForEmail.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_cardForEmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection.js">mailnews/addrbook/test/unit/test_collection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection_2.js">mailnews/addrbook/test/unit/test_collection_2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection_2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection_2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection_2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection_2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_collection_2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap1.js">mailnews/addrbook/test/unit/test_ldap1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap2.js">mailnews/addrbook/test/unit/test_ldap2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldap2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldapOffline.js">mailnews/addrbook/test/unit/test_ldapOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldapOffline.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldapOffline.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldapOffline.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldapOffline.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_ldapOffline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_mailList1.js">mailnews/addrbook/test/unit/test_mailList1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_mailList1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_mailList1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_mailList1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_mailList1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_mailList1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_notifications.js">mailnews/addrbook/test/unit/test_notifications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_notifications.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_notifications.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_notifications.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_notifications.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_notifications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager1.js">mailnews/addrbook/test/unit/test_nsAbManager1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager2.js">mailnews/addrbook/test/unit/test_nsAbManager2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager3.js">mailnews/addrbook/test/unit/test_nsAbManager3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsAbManager3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsIAbCard.js">mailnews/addrbook/test/unit/test_nsIAbCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsIAbCard.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsIAbCard.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsIAbCard.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsIAbCard.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_nsIAbCard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_uuid.js">mailnews/addrbook/test/unit/test_uuid.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_uuid.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_uuid.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_uuid.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_uuid.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/addrbook/test/unit/test_uuid.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgr.js">mailnews/base/test/unit/test_accountMgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgr.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgr.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgr.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgr.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgr.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgrCustomTypes.js">mailnews/base/test/unit/test_accountMgrCustomTypes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgrCustomTypes.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgrCustomTypes.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgrCustomTypes.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgrCustomTypes.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMgrCustomTypes.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMigration.js">mailnews/base/test/unit/test_accountMigration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMigration.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMigration.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMigration.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMigration.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_accountMigration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_acctRepair.js">mailnews/base/test/unit/test_acctRepair.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_acctRepair.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_acctRepair.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_acctRepair.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_acctRepair.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_acctRepair.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigFetchDisk.js">mailnews/base/test/unit/test_autoconfigFetchDisk.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigFetchDisk.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigFetchDisk.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigFetchDisk.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigFetchDisk.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigFetchDisk.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigUtils.js">mailnews/base/test/unit/test_autoconfigUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigUtils.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigUtils.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigUtils.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigUtils.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigXML.js">mailnews/base/test/unit/test_autoconfigXML.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigXML.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigXML.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigXML.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigXML.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_autoconfigXML.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bccInDatabase.js">mailnews/base/test/unit/test_bccInDatabase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bccInDatabase.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bccInDatabase.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bccInDatabase.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bccInDatabase.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bccInDatabase.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug366491.js">mailnews/base/test/unit/test_bug366491.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug366491.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug366491.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug366491.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug366491.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug366491.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug404489.js">mailnews/base/test/unit/test_bug404489.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug404489.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug404489.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug404489.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug404489.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug404489.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug428427.js">mailnews/base/test/unit/test_bug428427.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug428427.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug428427.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug428427.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug428427.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug428427.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug434810.js">mailnews/base/test/unit/test_bug434810.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug434810.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug434810.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug434810.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug434810.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug434810.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug471682.js">mailnews/base/test/unit/test_bug471682.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug471682.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug471682.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug471682.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug471682.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug471682.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug514945.js">mailnews/base/test/unit/test_bug514945.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug514945.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug514945.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug514945.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug514945.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_bug514945.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactColumnSave.js">mailnews/base/test/unit/test_compactColumnSave.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactColumnSave.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactColumnSave.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactColumnSave.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactColumnSave.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactColumnSave.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactFailure.js">mailnews/base/test/unit/test_compactFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactFailure.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactFailure.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactFailure.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactFailure.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_compactFailure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyChaining.js">mailnews/base/test/unit/test_copyChaining.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyChaining.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyChaining.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyChaining.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyChaining.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyChaining.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyThenMoveManual.js">mailnews/base/test/unit/test_copyThenMoveManual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyThenMoveManual.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyThenMoveManual.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyThenMoveManual.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyThenMoveManual.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyThenMoveManual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyToInvalidDB.js">mailnews/base/test/unit/test_copyToInvalidDB.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyToInvalidDB.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyToInvalidDB.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyToInvalidDB.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyToInvalidDB.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_copyToInvalidDB.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_detachToFile.js">mailnews/base/test/unit/test_detachToFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_detachToFile.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_detachToFile.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_detachToFile.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_detachToFile.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_detachToFile.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_emptyTrash.js">mailnews/base/test/unit/test_emptyTrash.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_emptyTrash.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_emptyTrash.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_emptyTrash.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_emptyTrash.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_emptyTrash.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_fix_deferred_accounts.js">mailnews/base/test/unit/test_fix_deferred_accounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_fix_deferred_accounts.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_fix_deferred_accounts.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_fix_deferred_accounts.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_fix_deferred_accounts.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_fix_deferred_accounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderCompact.js">mailnews/base/test/unit/test_folderCompact.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderCompact.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderCompact.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderCompact.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderCompact.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderCompact.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderLookupService.js">mailnews/base/test/unit/test_folderLookupService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderLookupService.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderLookupService.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderLookupService.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderLookupService.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_folderLookupService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_formatFileSize.js">mailnews/base/test/unit/test_formatFileSize.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_formatFileSize.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_formatFileSize.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_formatFileSize.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_formatFileSize.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_formatFileSize.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_getMsgTextFromStream.js">mailnews/base/test/unit/test_getMsgTextFromStream.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_getMsgTextFromStream.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_getMsgTextFromStream.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_getMsgTextFromStream.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_getMsgTextFromStream.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_getMsgTextFromStream.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_hostnameUtils.js">mailnews/base/test/unit/test_hostnameUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_hostnameUtils.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_hostnameUtils.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_hostnameUtils.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_hostnameUtils.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_hostnameUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_inheritedFolderProperties.js">mailnews/base/test/unit/test_inheritedFolderProperties.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_inheritedFolderProperties.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_inheritedFolderProperties.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_inheritedFolderProperties.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_inheritedFolderProperties.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_inheritedFolderProperties.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_iteratorUtils.js">mailnews/base/test/unit/test_iteratorUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_iteratorUtils.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_iteratorUtils.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_iteratorUtils.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_iteratorUtils.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_iteratorUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkWhitelisting.js">mailnews/base/test/unit/test_junkWhitelisting.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkWhitelisting.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkWhitelisting.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkWhitelisting.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkWhitelisting.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkWhitelisting.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkingWhenDisabled.js">mailnews/base/test/unit/test_junkingWhenDisabled.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkingWhenDisabled.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkingWhenDisabled.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkingWhenDisabled.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkingWhenDisabled.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_junkingWhenDisabled.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_loadVirtualFolders.js">mailnews/base/test/unit/test_loadVirtualFolders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_loadVirtualFolders.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_loadVirtualFolders.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_loadVirtualFolders.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_loadVirtualFolders.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_loadVirtualFolders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mailServices.js">mailnews/base/test/unit/test_mailServices.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mailServices.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mailServices.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mailServices.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mailServices.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mailServices.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mimemaltdetach.js">mailnews/base/test/unit/test_mimemaltdetach.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mimemaltdetach.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mimemaltdetach.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mimemaltdetach.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mimemaltdetach.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_mimemaltdetach.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_newMailNotification.js">mailnews/base/test/unit/test_newMailNotification.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_newMailNotification.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_newMailNotification.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_newMailNotification.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_newMailNotification.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_newMailNotification.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolder.js">mailnews/base/test/unit/test_nsIMsgFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolderListener.js">mailnews/base/test/unit/test_nsIMsgFolderListener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolderListener.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolderListener.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolderListener.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolderListener.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgFolderListener.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgTagService.js">mailnews/base/test/unit/test_nsIMsgTagService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgTagService.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgTagService.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgTagService.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgTagService.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsIMsgTagService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMailDirProvider.js">mailnews/base/test/unit/test_nsMailDirProvider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMailDirProvider.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMailDirProvider.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMailDirProvider.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMailDirProvider.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMailDirProvider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">mailnews/base/test/unit/test_nsMsgDBView_headerValues.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js">mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js">mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgTraitService.js">mailnews/base/test/unit/test_nsMsgTraitService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgTraitService.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgTraitService.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgTraitService.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgTraitService.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_nsMsgTraitService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_postPluginFilters.js">mailnews/base/test/unit/test_postPluginFilters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_postPluginFilters.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_postPluginFilters.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_postPluginFilters.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_postPluginFilters.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_postPluginFilters.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_quarantineFilterMove.js">mailnews/base/test/unit/test_quarantineFilterMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_quarantineFilterMove.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_quarantineFilterMove.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_quarantineFilterMove.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_quarantineFilterMove.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_quarantineFilterMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_retention.js">mailnews/base/test/unit/test_retention.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_retention.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_retention.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_retention.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_retention.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_retention.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_search.js">mailnews/base/test/unit/test_search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_search.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_search.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_search.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_search.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_search.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchBoolean.js">mailnews/base/test/unit/test_searchBoolean.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchBoolean.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchBoolean.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchBoolean.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchBoolean.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchBoolean.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchLocalizationStrings.js">mailnews/base/test/unit/test_searchLocalizationStrings.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchLocalizationStrings.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchLocalizationStrings.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchLocalizationStrings.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchLocalizationStrings.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_searchLocalizationStrings.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_base64.js">mailnews/base/test/unit/test_testsuite_base64.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_base64.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_base64.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_base64.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_base64.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_base64.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js">mailnews/base/test/unit/test_testsuite_fakeserverAuth.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/head_compose.js">mailnews/compose/test/unit/head_compose.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/head_compose.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/head_compose.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/head_compose.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/head_compose.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/head_compose.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment.js">mailnews/compose/test/unit/test_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment_intl.js">mailnews/compose/test/unit/test_attachment_intl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment_intl.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment_intl.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment_intl.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment_intl.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_attachment_intl.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_autoReply.js">mailnews/compose/test/unit/test_autoReply.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_autoReply.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_autoReply.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_autoReply.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_autoReply.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_autoReply.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug235432.js">mailnews/compose/test/unit/test_bug235432.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug235432.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug235432.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug235432.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug235432.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug235432.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug474774.js">mailnews/compose/test/unit/test_bug474774.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug474774.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug474774.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug474774.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug474774.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_bug474774.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_detectAttachmentCharset.js">mailnews/compose/test/unit/test_detectAttachmentCharset.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_detectAttachmentCharset.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_detectAttachmentCharset.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_detectAttachmentCharset.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_detectAttachmentCharset.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_detectAttachmentCharset.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_longLines.js">mailnews/compose/test/unit/test_longLines.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_longLines.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_longLines.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_longLines.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_longLines.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_longLines.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_mailtoURL.js">mailnews/compose/test/unit/test_mailtoURL.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_mailtoURL.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_mailtoURL.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_mailtoURL.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_mailtoURL.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_mailtoURL.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_messageHeaders.js">mailnews/compose/test/unit/test_messageHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_messageHeaders.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_messageHeaders.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_messageHeaders.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_messageHeaders.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_messageHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsIMsgCompFields.js">mailnews/compose/test/unit/test_nsIMsgCompFields.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsIMsgCompFields.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsIMsgCompFields.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsIMsgCompFields.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsIMsgCompFields.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsIMsgCompFields.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose1.js">mailnews/compose/test/unit/test_nsMsgCompose1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose2.js">mailnews/compose/test/unit/test_nsMsgCompose2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose3.js">mailnews/compose/test/unit/test_nsMsgCompose3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose4.js">mailnews/compose/test/unit/test_nsMsgCompose4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose4.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose4.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose4.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose4.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsMsgCompose4.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsSmtpService1.js">mailnews/compose/test/unit/test_nsSmtpService1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsSmtpService1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsSmtpService1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsSmtpService1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsSmtpService1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_nsSmtpService1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_saveDraft.js">mailnews/compose/test/unit/test_saveDraft.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_saveDraft.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_saveDraft.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_saveDraft.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_saveDraft.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_saveDraft.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendBackground.js">mailnews/compose/test/unit/test_sendBackground.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendBackground.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendBackground.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendBackground.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendBackground.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendBackground.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMailAddressIDN.js">mailnews/compose/test/unit/test_sendMailAddressIDN.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMailAddressIDN.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMailAddressIDN.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMailAddressIDN.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMailAddressIDN.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMailAddressIDN.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageFile.js">mailnews/compose/test/unit/test_sendMessageFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageFile.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageFile.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageFile.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageFile.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageFile.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater.js">mailnews/compose/test/unit/test_sendMessageLater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater2.js">mailnews/compose/test/unit/test_sendMessageLater2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater3.js">mailnews/compose/test/unit/test_sendMessageLater3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_sendMessageLater3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPassword2.js">mailnews/compose/test/unit/test_smtpPassword2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPassword2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPassword2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPassword2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPassword2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPassword2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">mailnews/compose/test/unit/test_smtpPasswordFailure1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">mailnews/compose/test/unit/test_smtpPasswordFailure2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">mailnews/compose/test/unit/test_smtpPasswordFailure3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpProtocols.js">mailnews/compose/test/unit/test_smtpProtocols.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpProtocols.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpProtocols.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpProtocols.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpProtocols.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpProtocols.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpURL.js">mailnews/compose/test/unit/test_smtpURL.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpURL.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpURL.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpURL.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpURL.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_smtpURL.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_splitRecipients.js">mailnews/compose/test/unit/test_splitRecipients.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_splitRecipients.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_splitRecipients.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_splitRecipients.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_splitRecipients.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_splitRecipients.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js">mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_temporaryFilesRemoved.js">mailnews/compose/test/unit/test_temporaryFilesRemoved.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_temporaryFilesRemoved.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_temporaryFilesRemoved.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_temporaryFilesRemoved.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_temporaryFilesRemoved.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/compose/test/unit/test_temporaryFilesRemoved.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_gloda_content.js">mailnews/db/gloda/test/unit/base_gloda_content.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_gloda_content.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_gloda_content.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_gloda_content.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_gloda_content.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_gloda_content.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_junk.js">mailnews/db/gloda/test/unit/base_index_junk.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_junk.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_junk.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_junk.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_junk.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_junk.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_messages.js">mailnews/db/gloda/test/unit/base_index_messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_messages.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_messages.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_messages.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_messages.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/base_index_messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_corrupt_database.js">mailnews/db/gloda/test/unit/test_corrupt_database.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_corrupt_database.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_corrupt_database.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_corrupt_database.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_corrupt_database.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_corrupt_database.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_folder_logic.js">mailnews/db/gloda/test/unit/test_folder_logic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_folder_logic.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_folder_logic.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_folder_logic.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_folder_logic.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_folder_logic.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">mailnews/db/gloda/test/unit/test_fts3_tokenizer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_addressbook.js">mailnews/db/gloda/test/unit/test_index_addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_addressbook.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_addressbook.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_addressbook.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_addressbook.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_bad_messages.js">mailnews/db/gloda/test/unit/test_index_bad_messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_bad_messages.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_bad_messages.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_bad_messages.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_bad_messages.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_bad_messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_compaction.js">mailnews/db/gloda/test/unit/test_index_compaction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_compaction.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_compaction.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_compaction.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_compaction.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_compaction.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_messages_local.js">mailnews/db/gloda/test/unit/test_index_messages_local.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_messages_local.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_messages_local.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_messages_local.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_messages_local.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_messages_local.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">mailnews/db/gloda/test/unit/test_index_sweep_folder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_intl.js">mailnews/db/gloda/test/unit/test_intl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_intl.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_intl.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_intl.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_intl.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_intl.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_migration.js">mailnews/db/gloda/test/unit/test_migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_migration.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_migration.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_migration.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_migration.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_migration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">mailnews/db/gloda/test/unit/test_mime_attachments_size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_emitter.js">mailnews/db/gloda/test/unit/test_mime_emitter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_emitter.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_emitter.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_emitter.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_emitter.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_mime_emitter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_noun_mimetype.js">mailnews/db/gloda/test/unit/test_noun_mimetype.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_noun_mimetype.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_noun_mimetype.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_noun_mimetype.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_noun_mimetype.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_noun_mimetype.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_nuke_migration.js">mailnews/db/gloda/test/unit/test_nuke_migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_nuke_migration.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_nuke_migration.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_nuke_migration.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_nuke_migration.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_nuke_migration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_query_core.js">mailnews/db/gloda/test/unit/test_query_core.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_query_core.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_query_core.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_query_core.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_query_core.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_query_core.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">mailnews/db/msgdb/test/unit/test_filter_enumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_maildb.js">mailnews/db/msgdb/test/unit/test_maildb.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_maildb.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_maildb.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_maildb.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_maildb.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_maildb.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_references_parsing.js">mailnews/db/msgdb/test/unit/test_references_parsing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_references_parsing.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_references_parsing.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_references_parsing.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_references_parsing.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/db/msgdb/test/unit/test_references_parsing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_askuser.js">mailnews/extensions/mdn/test/unit/test_askuser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_askuser.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_askuser.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_askuser.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_askuser.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_askuser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">mailnews/extensions/mdn/test/unit/test_mdnFlags.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/head_server.js">mailnews/imap/test/unit/head_server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/head_server.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/head_server.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/head_server.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/head_server.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/head_server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_autosync_date_constraints.js">mailnews/imap/test/unit/test_autosync_date_constraints.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_autosync_date_constraints.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_autosync_date_constraints.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_autosync_date_constraints.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_autosync_date_constraints.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_autosync_date_constraints.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bccProperty.js">mailnews/imap/test/unit/test_bccProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bccProperty.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bccProperty.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bccProperty.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bccProperty.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bccProperty.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bug460636.js">mailnews/imap/test/unit/test_bug460636.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bug460636.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bug460636.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bug460636.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bug460636.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_bug460636.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_chunkLastLF.js">mailnews/imap/test/unit/test_chunkLastLF.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_chunkLastLF.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_chunkLastLF.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_chunkLastLF.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_chunkLastLF.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_chunkLastLF.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_compactOfflineStore.js">mailnews/imap/test/unit/test_compactOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_compactOfflineStore.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_compactOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_compactOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_compactOfflineStore.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_compactOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_copyThenMove.js">mailnews/imap/test/unit/test_copyThenMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_copyThenMove.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_copyThenMove.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_copyThenMove.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_copyThenMove.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_copyThenMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dod.js">mailnews/imap/test/unit/test_dod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dod.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dod.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dod.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dod.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dod.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dontStatNoSelect.js">mailnews/imap/test/unit/test_dontStatNoSelect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dontStatNoSelect.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dontStatNoSelect.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dontStatNoSelect.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dontStatNoSelect.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_dontStatNoSelect.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_fetchCustomAttribute.js">mailnews/imap/test/unit/test_fetchCustomAttribute.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_fetchCustomAttribute.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_fetchCustomAttribute.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_fetchCustomAttribute.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_fetchCustomAttribute.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_fetchCustomAttribute.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_filterCustomHeaders.js">mailnews/imap/test/unit/test_filterCustomHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_filterCustomHeaders.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_filterCustomHeaders.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_filterCustomHeaders.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_filterCustomHeaders.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_filterCustomHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_folderOfflineFlags.js">mailnews/imap/test/unit/test_folderOfflineFlags.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_folderOfflineFlags.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_folderOfflineFlags.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_folderOfflineFlags.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_folderOfflineFlags.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_folderOfflineFlags.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailAttributes.js">mailnews/imap/test/unit/test_gmailAttributes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailAttributes.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailAttributes.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailAttributes.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailAttributes.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailAttributes.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAttachmentSaves.js">mailnews/imap/test/unit/test_imapAttachmentSaves.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAttachmentSaves.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAttachmentSaves.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAttachmentSaves.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAttachmentSaves.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAttachmentSaves.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAuthMethods.js">mailnews/imap/test/unit/test_imapAuthMethods.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAuthMethods.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAuthMethods.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAuthMethods.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAuthMethods.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAuthMethods.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAutoSync.js">mailnews/imap/test/unit/test_imapAutoSync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAutoSync.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAutoSync.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAutoSync.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAutoSync.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapAutoSync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapChunks.js">mailnews/imap/test/unit/test_imapChunks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapChunks.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapChunks.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapChunks.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapChunks.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapChunks.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapContentLength.js">mailnews/imap/test/unit/test_imapContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapContentLength.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapContentLength.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapContentLength.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapContentLength.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapCopyTimeout.js">mailnews/imap/test/unit/test_imapCopyTimeout.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapCopyTimeout.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapCopyTimeout.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapCopyTimeout.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapCopyTimeout.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapCopyTimeout.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFlagChange.js">mailnews/imap/test/unit/test_imapFlagChange.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFlagChange.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFlagChange.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFlagChange.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFlagChange.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFlagChange.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFolderCopy.js">mailnews/imap/test/unit/test_imapFolderCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFolderCopy.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFolderCopy.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFolderCopy.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFolderCopy.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapFolderCopy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrChunking.js">mailnews/imap/test/unit/test_imapHdrChunking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrChunking.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrChunking.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrChunking.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrChunking.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrChunking.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrStreaming.js">mailnews/imap/test/unit/test_imapHdrStreaming.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrStreaming.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrStreaming.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrStreaming.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrStreaming.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHdrStreaming.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHighWater.js">mailnews/imap/test/unit/test_imapHighWater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHighWater.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHighWater.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHighWater.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHighWater.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapHighWater.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapID.js">mailnews/imap/test/unit/test_imapID.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapID.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapID.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapID.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapID.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapID.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapPasswordFailure.js">mailnews/imap/test/unit/test_imapPasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapPasswordFailure.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapPasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapPasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapPasswordFailure.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapPasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapProtocols.js">mailnews/imap/test/unit/test_imapProtocols.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapProtocols.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapProtocols.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapProtocols.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapProtocols.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapProtocols.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapRename.js">mailnews/imap/test/unit/test_imapRename.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapRename.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapRename.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapRename.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapRename.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapRename.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapSearch.js">mailnews/imap/test/unit/test_imapSearch.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapSearch.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapSearch.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapSearch.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapSearch.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapSearch.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">mailnews/imap/test/unit/test_imapStatusCloseDBs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">mailnews/imap/test/unit/test_imapStoreMsgOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUndo.js">mailnews/imap/test/unit/test_imapUndo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUndo.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUndo.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUndo.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUndo.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUndo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUrls.js">mailnews/imap/test/unit/test_imapUrls.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUrls.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUrls.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUrls.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUrls.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_imapUrls.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_largeOfflineStore.js">mailnews/imap/test/unit/test_largeOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_largeOfflineStore.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_largeOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_largeOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_largeOfflineStore.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_largeOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listClosesDB.js">mailnews/imap/test/unit/test_listClosesDB.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listClosesDB.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listClosesDB.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listClosesDB.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listClosesDB.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listClosesDB.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listSubscribed.js">mailnews/imap/test/unit/test_listSubscribed.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listSubscribed.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listSubscribed.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listSubscribed.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listSubscribed.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_listSubscribed.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilter.js">mailnews/imap/test/unit/test_localToImapFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilter.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilter.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilter.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilter.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_lsub.js">mailnews/imap/test/unit/test_lsub.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_lsub.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_lsub.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_lsub.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_lsub.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_lsub.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_mailboxes.js">mailnews/imap/test/unit/test_mailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_mailboxes.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_mailboxes.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_mailboxes.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_mailboxes.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_mailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineDraftDataloss.js">mailnews/imap/test/unit/test_offlineDraftDataloss.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineDraftDataloss.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineDraftDataloss.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineDraftDataloss.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineDraftDataloss.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineDraftDataloss.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlinePlayback.js">mailnews/imap/test/unit/test_offlinePlayback.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlinePlayback.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlinePlayback.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlinePlayback.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlinePlayback.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlinePlayback.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineStoreLocking.js">mailnews/imap/test/unit/test_offlineStoreLocking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineStoreLocking.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineStoreLocking.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineStoreLocking.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineStoreLocking.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_offlineStoreLocking.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_partsOnDemand.js">mailnews/imap/test/unit/test_partsOnDemand.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_partsOnDemand.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_partsOnDemand.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_partsOnDemand.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_partsOnDemand.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_partsOnDemand.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_preserveDataOnMove.js">mailnews/imap/test/unit/test_preserveDataOnMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_preserveDataOnMove.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_preserveDataOnMove.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_preserveDataOnMove.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_preserveDataOnMove.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_preserveDataOnMove.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveImapDraft.js">mailnews/imap/test/unit/test_saveImapDraft.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveImapDraft.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveImapDraft.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveImapDraft.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveImapDraft.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveImapDraft.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveTemplate.js">mailnews/imap/test/unit/test_saveTemplate.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveTemplate.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveTemplate.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveTemplate.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveTemplate.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_saveTemplate.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_starttlsFailure.js">mailnews/imap/test/unit/test_starttlsFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_starttlsFailure.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_starttlsFailure.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_starttlsFailure.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_starttlsFailure.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_starttlsFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_subfolderLocation.js">mailnews/imap/test/unit/test_subfolderLocation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_subfolderLocation.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_subfolderLocation.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_subfolderLocation.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_subfolderLocation.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_subfolderLocation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_syncChanges.js">mailnews/imap/test/unit/test_syncChanges.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_syncChanges.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_syncChanges.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_syncChanges.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_syncChanges.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_syncChanges.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_trustSpamAssassin.js">mailnews/imap/test/unit/test_trustSpamAssassin.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_trustSpamAssassin.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_trustSpamAssassin.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_trustSpamAssassin.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_trustSpamAssassin.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/imap/test/unit/test_trustSpamAssassin.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/resources/import_helper.js">mailnews/import/test/unit/resources/import_helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/resources/import_helper.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/resources/import_helper.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/resources/import_helper.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/resources/import_helper.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/resources/import_helper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_bug_437556.js">mailnews/import/test/unit/test_bug_437556.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_bug_437556.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_bug_437556.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_bug_437556.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_bug_437556.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_bug_437556.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_csv_GetSample.js">mailnews/import/test/unit/test_csv_GetSample.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_csv_GetSample.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_csv_GetSample.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_csv_GetSample.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_csv_GetSample.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/import/test/unit/test_csv_GetSample.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/intl/test/unit/CharsetConversionTests.js">mailnews/intl/test/unit/CharsetConversionTests.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/intl/test/unit/CharsetConversionTests.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/intl/test/unit/CharsetConversionTests.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/intl/test/unit/CharsetConversionTests.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/intl/test/unit/CharsetConversionTests.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/intl/test/unit/CharsetConversionTests.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/head_maillocal.js">mailnews/local/test/unit/head_maillocal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/head_maillocal.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/head_maillocal.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/head_maillocal.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/head_maillocal.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/head_maillocal.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_bug457168.js">mailnews/local/test/unit/test_bug457168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_bug457168.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_bug457168.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_bug457168.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_bug457168.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_bug457168.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_fileName.js">mailnews/local/test/unit/test_fileName.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_fileName.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_fileName.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_fileName.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_fileName.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_fileName.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_folderLoaded.js">mailnews/local/test/unit/test_folderLoaded.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_folderLoaded.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_folderLoaded.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_folderLoaded.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_folderLoaded.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_folderLoaded.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_localFolder.js">mailnews/local/test/unit/test_localFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_localFolder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_localFolder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_localFolder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_localFolder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_localFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxContentLength.js">mailnews/local/test/unit/test_mailboxContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxContentLength.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxContentLength.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxContentLength.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxContentLength.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxProtocol.js">mailnews/local/test/unit/test_mailboxProtocol.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxProtocol.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxProtocol.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxProtocol.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxProtocol.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_mailboxProtocol.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_movemailDownload.js">mailnews/local/test/unit/test_movemailDownload.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_movemailDownload.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_movemailDownload.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_movemailDownload.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_movemailDownload.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_movemailDownload.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgCopy.js">mailnews/local/test/unit/test_msgCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgCopy.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgCopy.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgCopy.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgCopy.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgCopy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgIDParsing.js">mailnews/local/test/unit/test_msgIDParsing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgIDParsing.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgIDParsing.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgIDParsing.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgIDParsing.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_msgIDParsing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over2GBMailboxes.js">mailnews/local/test/unit/test_over2GBMailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over2GBMailboxes.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over2GBMailboxes.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over2GBMailboxes.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over2GBMailboxes.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over2GBMailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over4GBMailboxes.js">mailnews/local/test/unit/test_over4GBMailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over4GBMailboxes.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over4GBMailboxes.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over4GBMailboxes.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over4GBMailboxes.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_over4GBMailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3AuthMethods.js">mailnews/local/test/unit/test_pop3AuthMethods.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3AuthMethods.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3AuthMethods.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3AuthMethods.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3AuthMethods.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3AuthMethods.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Download.js">mailnews/local/test/unit/test_pop3Download.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Download.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Download.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Download.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Download.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Download.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Duplicates.js">mailnews/local/test/unit/test_pop3Duplicates.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Duplicates.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Duplicates.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Duplicates.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Duplicates.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Duplicates.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3FilterActions.js">mailnews/local/test/unit/test_pop3FilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3FilterActions.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3FilterActions.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3FilterActions.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3FilterActions.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3FilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GSSAPIFail.js">mailnews/local/test/unit/test_pop3GSSAPIFail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GSSAPIFail.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GSSAPIFail.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GSSAPIFail.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GSSAPIFail.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GSSAPIFail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GetNewMail.js">mailnews/local/test/unit/test_pop3GetNewMail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GetNewMail.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GetNewMail.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GetNewMail.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GetNewMail.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3GetNewMail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter.js">mailnews/local/test/unit/test_pop3MoveFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter2.js">mailnews/local/test/unit/test_pop3MoveFilter2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MoveFilter2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy.js">mailnews/local/test/unit/test_pop3MultiCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy2.js">mailnews/local/test/unit/test_pop3MultiCopy2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3MultiCopy2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password.js">mailnews/local/test/unit/test_pop3Password.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password2.js">mailnews/local/test/unit/test_pop3Password2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password3.js">mailnews/local/test/unit/test_pop3Password3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Password3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure.js">mailnews/local/test/unit/test_pop3PasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure2.js">mailnews/local/test/unit/test_pop3PasswordFailure2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure3.js">mailnews/local/test/unit/test_pop3PasswordFailure3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3PasswordFailure3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Pump.js">mailnews/local/test/unit/test_pop3Pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Pump.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Pump.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Pump.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Pump.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3Pump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_preview.js">mailnews/local/test/unit/test_preview.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_preview.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_preview.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_preview.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_preview.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_preview.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_saveMessage.js">mailnews/local/test/unit/test_saveMessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_saveMessage.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_saveMessage.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_saveMessage.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_saveMessage.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_saveMessage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_streamHeaders.js">mailnews/local/test/unit/test_streamHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_streamHeaders.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_streamHeaders.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_streamHeaders.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_streamHeaders.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_streamHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_undoDelete.js">mailnews/local/test/unit/test_undoDelete.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_undoDelete.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_undoDelete.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_undoDelete.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_undoDelete.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_undoDelete.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_verifyLogon.js">mailnews/local/test/unit/test_verifyLogon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_verifyLogon.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_verifyLogon.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_verifyLogon.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_verifyLogon.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/local/test/unit/test_verifyLogon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js">mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_alternate_p7m_handling.js">mailnews/mime/test/unit/test_alternate_p7m_handling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_alternate_p7m_handling.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_alternate_p7m_handling.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_alternate_p7m_handling.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_alternate_p7m_handling.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_alternate_p7m_handling.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_attachment_size.js">mailnews/mime/test/unit/test_attachment_size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_attachment_size.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_attachment_size.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_attachment_size.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_attachment_size.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_attachment_size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_badContentType.js">mailnews/mime/test/unit/test_badContentType.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_badContentType.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_badContentType.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_badContentType.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_badContentType.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_badContentType.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_bug493544.js">mailnews/mime/test/unit/test_bug493544.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_bug493544.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_bug493544.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_bug493544.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_bug493544.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_bug493544.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_hidden_attachments.js">mailnews/mime/test/unit/test_hidden_attachments.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_hidden_attachments.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_hidden_attachments.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_hidden_attachments.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_hidden_attachments.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_hidden_attachments.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_jsmime_charset.js">mailnews/mime/test/unit/test_jsmime_charset.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_jsmime_charset.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_jsmime_charset.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_jsmime_charset.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_jsmime_charset.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_jsmime_charset.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_message_attachment.js">mailnews/mime/test/unit/test_message_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_message_attachment.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_message_attachment.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_message_attachment.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_message_attachment.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_message_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_mimeContentType.js">mailnews/mime/test/unit/test_mimeContentType.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_mimeContentType.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_mimeContentType.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_mimeContentType.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_mimeContentType.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_mimeContentType.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js">mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js">mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js">mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js">mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js">mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parseHeadersWithArray.js">mailnews/mime/test/unit/test_parseHeadersWithArray.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parseHeadersWithArray.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parseHeadersWithArray.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parseHeadersWithArray.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parseHeadersWithArray.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parseHeadersWithArray.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parser.js">mailnews/mime/test/unit/test_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parser.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parser.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parser.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parser.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_parser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_rfc822_body.js">mailnews/mime/test/unit/test_rfc822_body.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_rfc822_body.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_rfc822_body.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_rfc822_body.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_rfc822_body.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_rfc822_body.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_structured_headers.js">mailnews/mime/test/unit/test_structured_headers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_structured_headers.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_structured_headers.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_structured_headers.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_structured_headers.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_structured_headers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_text_attachment.js">mailnews/mime/test/unit/test_text_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_text_attachment.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_text_attachment.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_text_attachment.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_text_attachment.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/mime/test/unit/test_text_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/head_server_setup.js">mailnews/news/test/unit/head_server_setup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/head_server_setup.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/head_server_setup.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/head_server_setup.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/head_server_setup.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/head_server_setup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_biff.js">mailnews/news/test/unit/test_biff.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_biff.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_biff.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_biff.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_biff.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_biff.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug37465.js">mailnews/news/test/unit/test_bug37465.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug37465.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug37465.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug37465.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug37465.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug37465.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug403242.js">mailnews/news/test/unit/test_bug403242.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug403242.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug403242.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug403242.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug403242.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug403242.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug540288.js">mailnews/news/test/unit/test_bug540288.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug540288.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug540288.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug540288.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug540288.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug540288.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug695309.js">mailnews/news/test/unit/test_bug695309.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug695309.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug695309.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug695309.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug695309.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_bug695309.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_filter.js">mailnews/news/test/unit/test_filter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_filter.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_filter.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_filter.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_filter.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_filter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_getNewsMessage.js">mailnews/news/test/unit/test_getNewsMessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_getNewsMessage.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_getNewsMessage.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_getNewsMessage.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_getNewsMessage.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_getNewsMessage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_internalUris.js">mailnews/news/test/unit/test_internalUris.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_internalUris.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_internalUris.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_internalUris.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_internalUris.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_internalUris.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_newsAutocomplete.js">mailnews/news/test/unit/test_newsAutocomplete.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_newsAutocomplete.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_newsAutocomplete.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_newsAutocomplete.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_newsAutocomplete.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_newsAutocomplete.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpContentLength.js">mailnews/news/test/unit/test_nntpContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpContentLength.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpContentLength.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpContentLength.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpContentLength.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPassword3.js">mailnews/news/test/unit/test_nntpPassword3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPassword3.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPassword3.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPassword3.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPassword3.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPassword3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPasswordFailure.js">mailnews/news/test/unit/test_nntpPasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPasswordFailure.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPasswordFailure.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpPasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpProtocols.js">mailnews/news/test/unit/test_nntpProtocols.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpProtocols.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpProtocols.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpProtocols.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpProtocols.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpProtocols.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpUrl.js">mailnews/news/test/unit/test_nntpUrl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpUrl.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpUrl.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpUrl.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpUrl.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_nntpUrl.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_server.js">mailnews/news/test/unit/test_server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_server.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_server.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_server.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_server.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_server.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_uriParser.js">mailnews/news/test/unit/test_uriParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_uriParser.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_uriParser.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_uriParser.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_uriParser.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/news/test/unit/test_uriParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/POP3pump.js">mailnews/test/resources/POP3pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/POP3pump.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/POP3pump.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/POP3pump.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/POP3pump.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/POP3pump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/msgFolderListenerSetup.js">mailnews/test/resources/msgFolderListenerSetup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/msgFolderListenerSetup.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/msgFolderListenerSetup.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/msgFolderListenerSetup.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/msgFolderListenerSetup.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/msgFolderListenerSetup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/searchTestUtils.js">mailnews/test/resources/searchTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/searchTestUtils.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/searchTestUtils.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/searchTestUtils.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/searchTestUtils.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/mailnews/test/resources/searchTestUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/head_autocomplete.js">suite/common/places/tests/autocomplete/head_autocomplete.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/head_autocomplete.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/head_autocomplete.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/head_autocomplete.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/head_autocomplete.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/head_autocomplete.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js">suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/head_common.js">suite/common/places/tests/head_common.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/head_common.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/head_common.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/head_common.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/head_common.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/head_common.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_421483.js">suite/common/places/tests/unit/test_421483.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_421483.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_421483.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_421483.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_421483.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_421483.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">suite/common/places/tests/unit/test_PUIU_makeTransaction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt.js">suite/common/places/tests/unit/test_browserGlue_corrupt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js">suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js">suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_migrate.js">suite/common/places/tests/unit/test_browserGlue_migrate.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_migrate.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_migrate.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_migrate.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_migrate.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_migrate.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_prefs.js">suite/common/places/tests/unit/test_browserGlue_prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_prefs.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_prefs.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_prefs.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_prefs.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_prefs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_restore.js">suite/common/places/tests/unit/test_browserGlue_restore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_restore.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_restore.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_restore.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_restore.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_restore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_clearHistory_shutdown.js">suite/common/places/tests/unit/test_clearHistory_shutdown.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_clearHistory_shutdown.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_clearHistory_shutdown.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_clearHistory_shutdown.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_clearHistory_shutdown.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_clearHistory_shutdown.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_leftpane_corruption_handling.js">suite/common/places/tests/unit/test_leftpane_corruption_handling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_leftpane_corruption_handling.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_leftpane_corruption_handling.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_leftpane_corruption_handling.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_leftpane_corruption_handling.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/common/places/tests/unit/test_leftpane_corruption_handling.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/modules/test/unit/test_browser_sanitizer.js">suite/modules/test/unit/test_browser_sanitizer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/455230ec2c827d98538cbb626c323627b7e23352/suite/modules/test/unit/test_browser_sanitizer.js">file</a> |
<a href="/comm-central/annotate/455230ec2c827d98538cbb626c323627b7e23352/suite/modules/test/unit/test_browser_sanitizer.js">annotate</a> |
<a href="/comm-central/diff/455230ec2c827d98538cbb626c323627b7e23352/suite/modules/test/unit/test_browser_sanitizer.js">diff</a> |
<a href="/comm-central/comparison/455230ec2c827d98538cbb626c323627b7e23352/suite/modules/test/unit/test_browser_sanitizer.js">comparison</a> |
<a href="/comm-central/log/455230ec2c827d98538cbb626c323627b7e23352/suite/modules/test/unit/test_browser_sanitizer.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/components/src/test/test_accounts.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/components/src/test/test_accounts.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -22,19 +22,19 @@ function run_test() {</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   try {</span>
<a href="#l1.6"></a><span id="l1.6">     // Having an implementation of nsIXULAppInfo is required for</span>
<a href="#l1.7"></a><span id="l1.7">     // Services.core.init to work.</span>
<a href="#l1.8"></a><span id="l1.8">     updateAppInfo();</span>
<a href="#l1.9"></a><span id="l1.9">     Services.core.init();</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">     let account = Services.accounts.getAccountByNumericId(1);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    do_check_true(account instanceof Ci.imIAccount);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    do_check_eq(account.name, kAccountName);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    do_check_eq(account.normalizedName, kAccountName);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-    do_check_eq(account.protocol.id, kPrplId);</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-    do_check_eq(account.connectionErrorReason, Ci.imIAccount.ERROR_UNKNOWN_PRPL);</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    Assert.ok(account instanceof Ci.imIAccount);</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+    Assert.equal(account.name, kAccountName);</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+    Assert.equal(account.normalizedName, kAccountName);</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+    Assert.equal(account.protocol.id, kPrplId);</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+    Assert.equal(account.connectionErrorReason, Ci.imIAccount.ERROR_UNKNOWN_PRPL);</span>
<a href="#l1.22"></a><span id="l1.22">   } finally {</span>
<a href="#l1.23"></a><span id="l1.23">     Services.core.quit();</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">     prefs.deleteBranch(&quot;messenger&quot;);</span>
<a href="#l1.26"></a><span id="l1.26">   }</span>
<a href="#l1.27"></a><span id="l1.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/components/src/test/test_commands.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/components/src/test/test_commands.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -127,29 +127,29 @@ function run_test() {</span>
<a href="#l2.4"></a><span id="l2.4">   ];</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">   for (let test of testData) {</span>
<a href="#l2.7"></a><span id="l2.7">     do_print(&quot;The following tests are with: &quot; + test.desc);</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">     // Check which commands are available in which context.</span>
<a href="#l2.10"></a><span id="l2.10">     let cmdlist = cmdserv.listCommandsForConversation(test.conv, {})</span>
<a href="#l2.11"></a><span id="l2.11">                          .map(aCmd =&gt; aCmd.name).sort().join(&quot;, &quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    do_check_eq(cmdlist, test.cmdlist);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    Assert.equal(cmdlist, test.cmdlist);</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">     for (let testCmd of testCmds) {</span>
<a href="#l2.16"></a><span id="l2.16">       do_print(&quot;Testing command found for '&quot; + testCmd + &quot;'&quot;);</span>
<a href="#l2.17"></a><span id="l2.17">       let expectedResult = test.results.shift();</span>
<a href="#l2.18"></a><span id="l2.18">       let cmdArray = cmdserv._findCommands(test.conv, testCmd);</span>
<a href="#l2.19"></a><span id="l2.19">       // Check whether commands are only returned when appropriate.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-      do_check_eq(cmdArray.length &gt; 0, expectedResult.length &gt; 0);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+      Assert.equal(cmdArray.length &gt; 0, expectedResult.length &gt; 0);</span>
<a href="#l2.22"></a><span id="l2.22">       if (cmdArray.length) {</span>
<a href="#l2.23"></a><span id="l2.23">         // Check if the right command was returned.</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-        do_check_eq(cmdArray[0].name, expectedResult[0]);</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-        do_check_eq(cmdArray[0].priority == Ci.imICommand.CMD_PRIORITY_PRPL,</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-                    !!expectedResult[1]);</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+        Assert.equal(cmdArray[0].name, expectedResult[0]);</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+        Assert.equal(cmdArray[0].priority == Ci.imICommand.CMD_PRIORITY_PRPL,</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+                     !!expectedResult[1]);</span>
<a href="#l2.30"></a><span id="l2.30">       }</span>
<a href="#l2.31"></a><span id="l2.31">     }</span>
<a href="#l2.32"></a><span id="l2.32">   }</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34">   // Array of messages to test command execution of.</span>
<a href="#l2.35"></a><span id="l2.35">   let testMessages = [</span>
<a href="#l2.36"></a><span id="l2.36">     {</span>
<a href="#l2.37"></a><span id="l2.37">       message: &quot;/r9kbeta&quot;,</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineat">@@ -171,13 +171,13 @@ function run_test() {</span>
<a href="#l2.39"></a><span id="l2.39">       message: &quot;/notregistered&quot;,</span>
<a href="#l2.40"></a><span id="l2.40">       result: false</span>
<a href="#l2.41"></a><span id="l2.41">     }</span>
<a href="#l2.42"></a><span id="l2.42">   ];</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">   // Test command execution.</span>
<a href="#l2.45"></a><span id="l2.45">   for (let executionTest of testMessages) {</span>
<a href="#l2.46"></a><span id="l2.46">     do_print(&quot;Testing command execution for '&quot; + executionTest.message + &quot;'&quot;);</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-    do_check_eq(cmdserv.executeCommand(executionTest.message, fakeConversation), executionTest.result);</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+    Assert.equal(cmdserv.executeCommand(executionTest.message, fakeConversation), executionTest.result);</span>
<a href="#l2.49"></a><span id="l2.49">   }</span>
<a href="#l2.50"></a><span id="l2.50"> </span>
<a href="#l2.51"></a><span id="l2.51">   cmdserv.unInitCommands();</span>
<a href="#l2.52"></a><span id="l2.52"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/chat/modules/test/test_ArrayBufferUtils.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/chat/modules/test/test_ArrayBufferUtils.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -6,25 +6,25 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l3.4"></a><span id="l3.4"> function do_check_arraybuffer_eq(a, b) {</span>
<a href="#l3.5"></a><span id="l3.5">   let viewA = new Uint8Array(a);</span>
<a href="#l3.6"></a><span id="l3.6">   let viewB = new Uint8Array(b);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   let res = a.byteLength == b.byteLength;</span>
<a href="#l3.9"></a><span id="l3.9">   for (let i = 0; i &lt; viewA.byteLength; ++i)</span>
<a href="#l3.10"></a><span id="l3.10">     res = res &amp;&amp; viewA[i] == viewB[i];</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  do_check_true(res);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  Assert.ok(res);</span>
<a href="#l3.14"></a><span id="l3.14"> }</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> function do_check_array_eq(a, b) {</span>
<a href="#l3.17"></a><span id="l3.17">   let res = a.length == b.length;</span>
<a href="#l3.18"></a><span id="l3.18">   for (let i = 0; i &lt; a.length; ++i)</span>
<a href="#l3.19"></a><span id="l3.19">     res = res &amp;&amp; a[i] == b[i];</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-  do_check_true(res);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  Assert.ok(res);</span>
<a href="#l3.23"></a><span id="l3.23"> }</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25"> function test_ArrayBufferToBytes() {</span>
<a href="#l3.26"></a><span id="l3.26">   let expectedBytes = [0, 1, 0, 10, 0, 100, 3, 232];</span>
<a href="#l3.27"></a><span id="l3.27">   let expectedBuf = new ArrayBuffer(8);</span>
<a href="#l3.28"></a><span id="l3.28">   let view = new DataView(expectedBuf);</span>
<a href="#l3.29"></a><span id="l3.29">   view.setUint16(0, 1);</span>
<a href="#l3.30"></a><span id="l3.30">   view.setUint16(2, 10);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineat">@@ -65,31 +65,31 @@ function test_ArrayBufferToString() {</span>
<a href="#l3.32"></a><span id="l3.32">   let byteString = StringToBytes(testString);</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34">   let buf = new ArrayBuffer(byteString.length);</span>
<a href="#l3.35"></a><span id="l3.35">   let view = new DataView(buf);</span>
<a href="#l3.36"></a><span id="l3.36">   for (let i = 0; i &lt; byteString.length; ++i)</span>
<a href="#l3.37"></a><span id="l3.37">     view.setUint8(i, byteString[i]);</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">   let str = ArrayBufferToString(buf);</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-  do_check_eq(str, testString);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+  Assert.equal(str, testString);</span>
<a href="#l3.42"></a><span id="l3.42"> </span>
<a href="#l3.43"></a><span id="l3.43">   run_next_test();</span>
<a href="#l3.44"></a><span id="l3.44"> }</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46"> function test_ArrayBufferToHexString() {</span>
<a href="#l3.47"></a><span id="l3.47">   let buf = new ArrayBuffer(4);</span>
<a href="#l3.48"></a><span id="l3.48">   let view = new DataView(buf);</span>
<a href="#l3.49"></a><span id="l3.49">   view.setUint8(0, 0x00);</span>
<a href="#l3.50"></a><span id="l3.50">   view.setUint8(1, 0x10);</span>
<a href="#l3.51"></a><span id="l3.51">   view.setUint8(2, 0x01);</span>
<a href="#l3.52"></a><span id="l3.52">   view.setUint8(3, 0x11);</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54">   let str = ArrayBufferToHexString(buf);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-  do_check_eq(str, &quot;0x00 10 01 11&quot;);</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+  Assert.equal(str, &quot;0x00 10 01 11&quot;);</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58">   run_next_test();</span>
<a href="#l3.59"></a><span id="l3.59"> }</span>
<a href="#l3.60"></a><span id="l3.60"> </span>
<a href="#l3.61"></a><span id="l3.61"> function run_test() {</span>
<a href="#l3.62"></a><span id="l3.62">   add_test(test_ArrayBufferToBytes);</span>
<a href="#l3.63"></a><span id="l3.63">   add_test(test_BytesToArrayBuffer);</span>
<a href="#l3.64"></a><span id="l3.64">   add_test(test_StringToBytes);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/modules/test/test_NormalizedMap.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/modules/test/test_NormalizedMap.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2,67 +2,67 @@</span>
<a href="#l4.4"></a><span id="l4.4">  * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> Components.utils.import(&quot;resource:///modules/NormalizedMap.jsm&quot;);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> function test_setter_getter() {</span>
<a href="#l4.9"></a><span id="l4.9">   let m = new NormalizedMap(aStr =&gt; aStr.toLowerCase());</span>
<a href="#l4.10"></a><span id="l4.10">   m.set(&quot;foo&quot;, &quot;bar&quot;);</span>
<a href="#l4.11"></a><span id="l4.11">   m.set(&quot;BaZ&quot;, &quot;blah&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  do_check_eq(m.has(&quot;FOO&quot;), true);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  do_check_eq(m.has(&quot;BaZ&quot;), true);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-  do_check_eq(m.get(&quot;FOO&quot;), &quot;bar&quot;);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  Assert.equal(m.has(&quot;FOO&quot;), true);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  Assert.equal(m.has(&quot;BaZ&quot;), true);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  Assert.equal(m.get(&quot;FOO&quot;), &quot;bar&quot;);</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   let keys = Array.from(m.keys());</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  do_check_eq(keys[0], &quot;foo&quot;);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-  do_check_eq(keys[1], &quot;baz&quot;);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+  Assert.equal(keys[0], &quot;foo&quot;);</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  Assert.equal(keys[1], &quot;baz&quot;);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   let values = Array.from(m.values());</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-  do_check_eq(values[0], &quot;bar&quot;);</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-  do_check_eq(values[1], &quot;blah&quot;);</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  Assert.equal(values[0], &quot;bar&quot;);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+  Assert.equal(values[1], &quot;blah&quot;);</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  do_check_eq(m.size, 2);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  Assert.equal(m.size, 2);</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">   run_next_test();</span>
<a href="#l4.35"></a><span id="l4.35"> }</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37"> function test_constructor() {</span>
<a href="#l4.38"></a><span id="l4.38">   let k = new NormalizedMap(aStr =&gt; aStr.toLowerCase(), [[&quot;A&quot;, 2], [&quot;b&quot;, 3]]);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-  do_check_eq(k.get(&quot;b&quot;), 3);</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-  do_check_eq(k.get(&quot;a&quot;), 2);</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-  do_check_eq(k.get(&quot;B&quot;), 3);</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-  do_check_eq(k.get(&quot;A&quot;), 2);</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+  Assert.equal(k.get(&quot;b&quot;), 3);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+  Assert.equal(k.get(&quot;a&quot;), 2);</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+  Assert.equal(k.get(&quot;B&quot;), 3);</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+  Assert.equal(k.get(&quot;A&quot;), 2);</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48">   run_next_test();</span>
<a href="#l4.49"></a><span id="l4.49"> }</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51"> function test_iterator() {</span>
<a href="#l4.52"></a><span id="l4.52">   let k = new NormalizedMap(aStr =&gt; aStr.toLowerCase());</span>
<a href="#l4.53"></a><span id="l4.53">   k.set(&quot;FoO&quot;, &quot;bar&quot;);</span>
<a href="#l4.54"></a><span id="l4.54"> </span>
<a href="#l4.55"></a><span id="l4.55">   for (let [key, value] of k) {</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-    do_check_eq(key, &quot;foo&quot;);</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-    do_check_eq(value, &quot;bar&quot;);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+    Assert.equal(key, &quot;foo&quot;);</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+    Assert.equal(value, &quot;bar&quot;);</span>
<a href="#l4.60"></a><span id="l4.60">   }</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62">   run_next_test();</span>
<a href="#l4.63"></a><span id="l4.63"> }</span>
<a href="#l4.64"></a><span id="l4.64"> </span>
<a href="#l4.65"></a><span id="l4.65"> function test_delete() {</span>
<a href="#l4.66"></a><span id="l4.66">   let m = new NormalizedMap(aStr =&gt; aStr.toLowerCase());</span>
<a href="#l4.67"></a><span id="l4.67">   m.set(&quot;foo&quot;, &quot;bar&quot;);</span>
<a href="#l4.68"></a><span id="l4.68">   m.set(&quot;BaZ&quot;, &quot;blah&quot;);</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-  do_check_eq(m.delete(&quot;blah&quot;), false);</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+  Assert.equal(m.delete(&quot;blah&quot;), false);</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-  do_check_eq(m.delete(&quot;FOO&quot;), true);</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-  do_check_eq(m.size, 1);</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+  Assert.equal(m.delete(&quot;FOO&quot;), true);</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+  Assert.equal(m.size, 1);</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-  do_check_eq(m.delete(&quot;baz&quot;), true);</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-  do_check_eq(m.size, 0);</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+  Assert.equal(m.delete(&quot;baz&quot;), true);</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+  Assert.equal(m.size, 0);</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">   run_next_test();</span>
<a href="#l4.84"></a><span id="l4.84"> }</span>
<a href="#l4.85"></a><span id="l4.85"> </span>
<a href="#l4.86"></a><span id="l4.86"> function run_test() {</span>
<a href="#l4.87"></a><span id="l4.87">   add_test(test_setter_getter);</span>
<a href="#l4.88"></a><span id="l4.88">   add_test(test_constructor);</span>
<a href="#l4.89"></a><span id="l4.89">   add_test(test_iterator);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/chat/modules/test/test_filtering.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/chat/modules/test/test_filtering.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -26,310 +26,310 @@ function run_test() {</span>
<a href="#l5.4"></a><span id="l5.4"> function test_plainText() {</span>
<a href="#l5.5"></a><span id="l5.5">   const strings = [</span>
<a href="#l5.6"></a><span id="l5.6">     &quot;foo&quot;,</span>
<a href="#l5.7"></a><span id="l5.7">     &quot;foo  &quot;, // preserve trailing whitespace</span>
<a href="#l5.8"></a><span id="l5.8">     &quot;  foo&quot;, // preserve leading indent</span>
<a href="#l5.9"></a><span id="l5.9">     &quot;&amp;lt;html&amp;gt;&amp;amp;&quot; // keep escaped characters</span>
<a href="#l5.10"></a><span id="l5.10">   ];</span>
<a href="#l5.11"></a><span id="l5.11">   for (let string of strings)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.14"></a><span id="l5.14"> }</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> function test_paragraphs() {</span>
<a href="#l5.17"></a><span id="l5.17">   const strings = [</span>
<a href="#l5.18"></a><span id="l5.18">     &quot;&lt;p&gt;foo&lt;/p&gt;&lt;p&gt;bar&lt;/p&gt;&quot;,</span>
<a href="#l5.19"></a><span id="l5.19">     &quot;&lt;p&gt;foo&lt;br&gt;bar&lt;/p&gt;&quot;,</span>
<a href="#l5.20"></a><span id="l5.20">     &quot;foo&lt;br&gt;bar&quot;</span>
<a href="#l5.21"></a><span id="l5.21">   ];</span>
<a href="#l5.22"></a><span id="l5.22">   for (let string of strings)</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.25"></a><span id="l5.25"> }</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27"> function test_stripScripts() {</span>
<a href="#l5.28"></a><span id="l5.28">   const strings = [</span>
<a href="#l5.29"></a><span id="l5.29">     [&quot;&lt;script&gt;alert('hey')&lt;/script&gt;&quot;, &quot;&quot;],</span>
<a href="#l5.30"></a><span id="l5.30">     [&quot;foo &lt;script&gt;alert('hey')&lt;/script&gt;&quot;, &quot;foo &quot;],</span>
<a href="#l5.31"></a><span id="l5.31">     [&quot;&lt;p onclick=\&quot;alert('hey')\&quot;&gt;foo&lt;/p&gt;&quot;, &quot;&lt;p&gt;foo&lt;/p&gt;&quot;],</span>
<a href="#l5.32"></a><span id="l5.32">     [&quot;&lt;p onmouseover=\&quot;alert('hey')\&quot;&gt;foo&lt;/p&gt;&quot;, &quot;&lt;p&gt;foo&lt;/p&gt;&quot;],</span>
<a href="#l5.33"></a><span id="l5.33">   ];</span>
<a href="#l5.34"></a><span id="l5.34">   for (let [input, expectedOutput] of strings)</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-    do_check_eq(expectedOutput, cleanupImMarkup(input));</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+    Assert.equal(expectedOutput, cleanupImMarkup(input));</span>
<a href="#l5.37"></a><span id="l5.37"> }</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39"> function test_links() {</span>
<a href="#l5.40"></a><span id="l5.40">   // http, https, ftp and mailto links should be preserved.</span>
<a href="#l5.41"></a><span id="l5.41">   const ok = [</span>
<a href="#l5.42"></a><span id="l5.42">     &quot;http://example.com/&quot;,</span>
<a href="#l5.43"></a><span id="l5.43">     &quot;https://example.com/&quot;,</span>
<a href="#l5.44"></a><span id="l5.44">     &quot;ftp://example.com/&quot;,</span>
<a href="#l5.45"></a><span id="l5.45">     &quot;mailto:foo@example.com&quot;</span>
<a href="#l5.46"></a><span id="l5.46">   ];</span>
<a href="#l5.47"></a><span id="l5.47">   for (let string of ok) {</span>
<a href="#l5.48"></a><span id="l5.48">     string = &quot;&lt;a href=\&quot;&quot; + string + &quot;\&quot;&gt;foo&lt;/a&gt;&quot;;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.51"></a><span id="l5.51">   }</span>
<a href="#l5.52"></a><span id="l5.52"> </span>
<a href="#l5.53"></a><span id="l5.53">   // other links should be removed</span>
<a href="#l5.54"></a><span id="l5.54">   const bad = [</span>
<a href="#l5.55"></a><span id="l5.55">     &quot;chrome://global/content/&quot;,</span>
<a href="#l5.56"></a><span id="l5.56">     &quot;about:&quot;,</span>
<a href="#l5.57"></a><span id="l5.57">     &quot;about:blank&quot;,</span>
<a href="#l5.58"></a><span id="l5.58">     &quot;foo://bar/&quot;,</span>
<a href="#l5.59"></a><span id="l5.59">     &quot;&quot;</span>
<a href="#l5.60"></a><span id="l5.60">   ];</span>
<a href="#l5.61"></a><span id="l5.61">   for (let string of bad) {</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-    do_check_eq(&quot;&lt;a&gt;foo&lt;/a&gt;&quot;,</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-                cleanupImMarkup(&quot;&lt;a href=\&quot;&quot; + string + &quot;\&quot;&gt;foo&lt;/a&gt;&quot;));</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+    Assert.equal(&quot;&lt;a&gt;foo&lt;/a&gt;&quot;,</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+                 cleanupImMarkup(&quot;&lt;a href=\&quot;&quot; + string + &quot;\&quot;&gt;foo&lt;/a&gt;&quot;));</span>
<a href="#l5.66"></a><span id="l5.66">   }</span>
<a href="#l5.67"></a><span id="l5.67"> </span>
<a href="#l5.68"></a><span id="l5.68">   // keep link titles</span>
<a href="#l5.69"></a><span id="l5.69">   let string = &quot;&lt;a title=\&quot;foo bar\&quot;&gt;foo&lt;/a&gt;&quot;;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-  do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+  Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.72"></a><span id="l5.72"> }</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74"> function test_allModes() {</span>
<a href="#l5.75"></a><span id="l5.75">   test_plainText();</span>
<a href="#l5.76"></a><span id="l5.76">   test_paragraphs();</span>
<a href="#l5.77"></a><span id="l5.77">   test_stripScripts();</span>
<a href="#l5.78"></a><span id="l5.78">   test_links();</span>
<a href="#l5.79"></a><span id="l5.79">   // Remove random classes.</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-  do_check_eq(&quot;&lt;p&gt;foo&lt;/p&gt;&quot;, cleanupImMarkup(&quot;&lt;p class=\&quot;foobar\&quot;&gt;foo&lt;/p&gt;&quot;));</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+  Assert.equal(&quot;&lt;p&gt;foo&lt;/p&gt;&quot;, cleanupImMarkup(&quot;&lt;p class=\&quot;foobar\&quot;&gt;foo&lt;/p&gt;&quot;));</span>
<a href="#l5.82"></a><span id="l5.82"> }</span>
<a href="#l5.83"></a><span id="l5.83"> </span>
<a href="#l5.84"></a><span id="l5.84"> function test_strictMode() {</span>
<a href="#l5.85"></a><span id="l5.85">   Services.prefs.setIntPref(kModePref, kStrictMode);</span>
<a href="#l5.86"></a><span id="l5.86">   test_allModes();</span>
<a href="#l5.87"></a><span id="l5.87"> </span>
<a href="#l5.88"></a><span id="l5.88">   // check that basic formatting is stipped in strict mode.</span>
<a href="#l5.89"></a><span id="l5.89">   for (let tag of [&quot;div&quot;, &quot;em&quot;, &quot;strong&quot;, &quot;b&quot;, &quot;i&quot;, &quot;u&quot;, &quot;span&quot;, &quot;code&quot;,</span>
<a href="#l5.90"></a><span id="l5.90">                    &quot;ul&quot;, &quot;li&quot;, &quot;ol&quot;, &quot;cite&quot;, &quot;blockquote&quot;])</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-    do_check_eq(&quot;foo&quot;, cleanupImMarkup(&quot;&lt;&quot; + tag + &quot;&gt;foo&lt;/&quot; + tag + &quot;&gt;&quot;));</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+    Assert.equal(&quot;foo&quot;, cleanupImMarkup(&quot;&lt;&quot; + tag + &quot;&gt;foo&lt;/&quot; + tag + &quot;&gt;&quot;));</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94">   // check that font settings are removed.</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-  do_check_eq(&quot;foo&quot;,</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-              cleanupImMarkup(&quot;&lt;font face=\&quot;Times\&quot; color=\&quot;pink\&quot;&gt;foo&lt;/font&gt;&quot;));</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-  do_check_eq(&quot;&lt;p&gt;foo&lt;/p&gt;&quot;,</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-              cleanupImMarkup(&quot;&lt;p style=\&quot;font-weight: bold;\&quot;&gt;foo&lt;/p&gt;&quot;));</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+  Assert.equal(&quot;foo&quot;,</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+               cleanupImMarkup(&quot;&lt;font face=\&quot;Times\&quot; color=\&quot;pink\&quot;&gt;foo&lt;/font&gt;&quot;));</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+  Assert.equal(&quot;&lt;p&gt;foo&lt;/p&gt;&quot;,</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+               cleanupImMarkup(&quot;&lt;p style=\&quot;font-weight: bold;\&quot;&gt;foo&lt;/p&gt;&quot;));</span>
<a href="#l5.103"></a><span id="l5.103"> </span>
<a href="#l5.104"></a><span id="l5.104">   // Discard hr</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-  do_check_eq(&quot;foobar&quot;, cleanupImMarkup(&quot;foo&lt;hr&gt;bar&quot;));</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+  Assert.equal(&quot;foobar&quot;, cleanupImMarkup(&quot;foo&lt;hr&gt;bar&quot;));</span>
<a href="#l5.107"></a><span id="l5.107"> </span>
<a href="#l5.108"></a><span id="l5.108">   run_next_test();</span>
<a href="#l5.109"></a><span id="l5.109"> }</span>
<a href="#l5.110"></a><span id="l5.110"> </span>
<a href="#l5.111"></a><span id="l5.111"> function test_standardMode() {</span>
<a href="#l5.112"></a><span id="l5.112">   Services.prefs.setIntPref(kModePref, kStandardMode);</span>
<a href="#l5.113"></a><span id="l5.113">   test_allModes();</span>
<a href="#l5.114"></a><span id="l5.114"> </span>
<a href="#l5.115"></a><span id="l5.115">   // check that basic formatting is kept in standard mode.</span>
<a href="#l5.116"></a><span id="l5.116">   for (let tag of [&quot;div&quot;, &quot;em&quot;, &quot;strong&quot;, &quot;b&quot;, &quot;i&quot;, &quot;u&quot;, &quot;span&quot;, &quot;code&quot;,</span>
<a href="#l5.117"></a><span id="l5.117">                    &quot;ul&quot;, &quot;li&quot;, &quot;ol&quot;, &quot;cite&quot;, &quot;blockquote&quot;]) {</span>
<a href="#l5.118"></a><span id="l5.118">     let string = &quot;&lt;&quot; + tag + &quot;&gt;foo&lt;/&quot; + tag + &quot;&gt;&quot;;</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.121"></a><span id="l5.121">   }</span>
<a href="#l5.122"></a><span id="l5.122"> </span>
<a href="#l5.123"></a><span id="l5.123">   // Keep special allowed classes.</span>
<a href="#l5.124"></a><span id="l5.124">   for (let className of [&quot;moz-txt-underscore&quot;, &quot;moz-txt-tag&quot;]) {</span>
<a href="#l5.125"></a><span id="l5.125">     let string = &quot;&lt;span class=\&quot;&quot; + className + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;;</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.128"></a><span id="l5.128">   }</span>
<a href="#l5.129"></a><span id="l5.129"> </span>
<a href="#l5.130"></a><span id="l5.130">   // Remove font settings</span>
<a href="#l5.131"></a><span id="l5.131">   let string = &quot;&lt;font face=\&quot;Times\&quot; color=\&quot;pink\&quot; size=\&quot;3\&quot;&gt;foo&lt;/font&gt;&quot;;</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-  do_check_eq(&quot;foo&quot;, cleanupImMarkup(string));</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+  Assert.equal(&quot;foo&quot;, cleanupImMarkup(string));</span>
<a href="#l5.134"></a><span id="l5.134"> </span>
<a href="#l5.135"></a><span id="l5.135">   // Discard hr</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-  do_check_eq(&quot;foobar&quot;, cleanupImMarkup(&quot;foo&lt;hr&gt;bar&quot;));</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+  Assert.equal(&quot;foobar&quot;, cleanupImMarkup(&quot;foo&lt;hr&gt;bar&quot;));</span>
<a href="#l5.138"></a><span id="l5.138"> </span>
<a href="#l5.139"></a><span id="l5.139">   const okCSS = [</span>
<a href="#l5.140"></a><span id="l5.140">     &quot;font-style: italic&quot;,</span>
<a href="#l5.141"></a><span id="l5.141">     &quot;font-weight: bold&quot;</span>
<a href="#l5.142"></a><span id="l5.142">   ];</span>
<a href="#l5.143"></a><span id="l5.143">   for (let css of okCSS) {</span>
<a href="#l5.144"></a><span id="l5.144">     let string = &quot;&lt;span style=\&quot;&quot; + css + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;;</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.147"></a><span id="l5.147">   }</span>
<a href="#l5.148"></a><span id="l5.148">   // text-decoration is a shorthand for several text-decoration properties.</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-  do_check_eq(&quot;&lt;span style=\&quot;text-decoration-line: underline;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-              cleanupImMarkup(&quot;&lt;span style=\&quot;text-decoration: underline\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+  Assert.equal(&quot;&lt;span style=\&quot;text-decoration-line: underline;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+               cleanupImMarkup(&quot;&lt;span style=\&quot;text-decoration: underline\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.153"></a><span id="l5.153"> </span>
<a href="#l5.154"></a><span id="l5.154">   const badCSS = [</span>
<a href="#l5.155"></a><span id="l5.155">     &quot;color: pink;&quot;,</span>
<a href="#l5.156"></a><span id="l5.156">     &quot;font-family: Times&quot;,</span>
<a href="#l5.157"></a><span id="l5.157">     &quot;font-size: larger&quot;,</span>
<a href="#l5.158"></a><span id="l5.158">     &quot;-moz-binding: url('chrome://global/content/bindings/textbox.xml#textbox');&quot;,</span>
<a href="#l5.159"></a><span id="l5.159">     &quot;display: none&quot;,</span>
<a href="#l5.160"></a><span id="l5.160">     &quot;visibility: hidden&quot;</span>
<a href="#l5.161"></a><span id="l5.161">   ];</span>
<a href="#l5.162"></a><span id="l5.162">   for (let css of badCSS) {</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-    do_check_eq(&quot;&lt;span style=\&quot;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-                cleanupImMarkup(&quot;&lt;span style=\&quot;&quot; + css + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+    Assert.equal(&quot;&lt;span style=\&quot;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+                 cleanupImMarkup(&quot;&lt;span style=\&quot;&quot; + css + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.167"></a><span id="l5.167">   }</span>
<a href="#l5.168"></a><span id="l5.168">   // The shorthand 'font' is decomposed to non-shorthand properties,</span>
<a href="#l5.169"></a><span id="l5.169">   // and not recomposed as some non-shorthand properties are filtered out.</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-  do_check_eq(&quot;&lt;span style=\&quot;font-style: normal; font-weight: normal;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-              cleanupImMarkup(&quot;&lt;span style=\&quot;font: 15px normal\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+  Assert.equal(&quot;&lt;span style=\&quot;font-style: normal; font-weight: normal;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+               cleanupImMarkup(&quot;&lt;span style=\&quot;font: 15px normal\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.174"></a><span id="l5.174"> </span>
<a href="#l5.175"></a><span id="l5.175">   run_next_test();</span>
<a href="#l5.176"></a><span id="l5.176"> }</span>
<a href="#l5.177"></a><span id="l5.177"> </span>
<a href="#l5.178"></a><span id="l5.178"> function test_permissiveMode() {</span>
<a href="#l5.179"></a><span id="l5.179">   Services.prefs.setIntPref(kModePref, kPermissiveMode);</span>
<a href="#l5.180"></a><span id="l5.180">   test_allModes();</span>
<a href="#l5.181"></a><span id="l5.181"> </span>
<a href="#l5.182"></a><span id="l5.182">   // Check that all formatting is kept in permissive mode.</span>
<a href="#l5.183"></a><span id="l5.183">   for (let tag of [&quot;div&quot;, &quot;em&quot;, &quot;strong&quot;, &quot;b&quot;, &quot;i&quot;, &quot;u&quot;, &quot;span&quot;, &quot;code&quot;,</span>
<a href="#l5.184"></a><span id="l5.184">                    &quot;ul&quot;, &quot;li&quot;, &quot;ol&quot;, &quot;cite&quot;, &quot;blockquote&quot;]) {</span>
<a href="#l5.185"></a><span id="l5.185">     let string = &quot;&lt;&quot; + tag + &quot;&gt;foo&lt;/&quot; + tag + &quot;&gt;&quot;;</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.188"></a><span id="l5.188">   }</span>
<a href="#l5.189"></a><span id="l5.189"> </span>
<a href="#l5.190"></a><span id="l5.190">   // Keep special allowed classes.</span>
<a href="#l5.191"></a><span id="l5.191">   for (let className of [&quot;moz-txt-underscore&quot;, &quot;moz-txt-tag&quot;]) {</span>
<a href="#l5.192"></a><span id="l5.192">     let string = &quot;&lt;span class=\&quot;&quot; + className + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;;</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.195"></a><span id="l5.195">   }</span>
<a href="#l5.196"></a><span id="l5.196"> </span>
<a href="#l5.197"></a><span id="l5.197">   // Keep font settings</span>
<a href="#l5.198"></a><span id="l5.198">   const fontAttributes = [</span>
<a href="#l5.199"></a><span id="l5.199">     &quot;face=\&quot;Times\&quot;&quot;,</span>
<a href="#l5.200"></a><span id="l5.200">     &quot;color=\&quot;pink\&quot;&quot;,</span>
<a href="#l5.201"></a><span id="l5.201">     &quot;size=\&quot;3\&quot;&quot;</span>
<a href="#l5.202"></a><span id="l5.202">   ];</span>
<a href="#l5.203"></a><span id="l5.203">   for (let fontAttribute of fontAttributes) {</span>
<a href="#l5.204"></a><span id="l5.204">     let string = &quot;&lt;font &quot; + fontAttribute + &quot;&gt;foo&lt;/font&gt;&quot;;</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.207"></a><span id="l5.207">   }</span>
<a href="#l5.208"></a><span id="l5.208"> </span>
<a href="#l5.209"></a><span id="l5.209">   // Allow hr</span>
<a href="#l5.210"></a><span id="l5.210">   let string = &quot;foo&lt;hr&gt;bar&quot;;</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineminus">-  do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+  Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.213"></a><span id="l5.213"> </span>
<a href="#l5.214"></a><span id="l5.214">   // Allow most CSS rules changing the text appearance.</span>
<a href="#l5.215"></a><span id="l5.215">   const okCSS = [</span>
<a href="#l5.216"></a><span id="l5.216">     &quot;font-style: italic&quot;,</span>
<a href="#l5.217"></a><span id="l5.217">     &quot;font-weight: bold&quot;,</span>
<a href="#l5.218"></a><span id="l5.218">     &quot;text-decoration: underline&quot;,</span>
<a href="#l5.219"></a><span id="l5.219">     &quot;color: pink;&quot;,</span>
<a href="#l5.220"></a><span id="l5.220">     &quot;font-family: Times&quot;,</span>
<a href="#l5.221"></a><span id="l5.221">     &quot;font-size: larger&quot;</span>
<a href="#l5.222"></a><span id="l5.222">   ];</span>
<a href="#l5.223"></a><span id="l5.223">   for (let css of okCSS) {</span>
<a href="#l5.224"></a><span id="l5.224">     let string = &quot;&lt;span style=\&quot;&quot; + css + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;;</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-    do_check_eq(string, cleanupImMarkup(string));</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+    Assert.equal(string, cleanupImMarkup(string));</span>
<a href="#l5.227"></a><span id="l5.227">   }</span>
<a href="#l5.228"></a><span id="l5.228"> </span>
<a href="#l5.229"></a><span id="l5.229">   // The shorthand 'font' is decomposed to non-shorthand properties,</span>
<a href="#l5.230"></a><span id="l5.230">   // and not recomposed as some non-shorthand properties are filtered out.</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineminus">-  do_check_eq(&quot;&lt;span style=\&quot;font-family: normal; font-size: 15px; &quot; +</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineminus">-              &quot;font-style: normal; font-weight: normal;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineminus">-              cleanupImMarkup(&quot;&lt;span style=\&quot;font: 15px normal\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+  Assert.equal(&quot;&lt;span style=\&quot;font-family: normal; font-size: 15px; &quot; +</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+               &quot;font-style: normal; font-weight: normal;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+               cleanupImMarkup(&quot;&lt;span style=\&quot;font: 15px normal\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.237"></a><span id="l5.237"> </span>
<a href="#l5.238"></a><span id="l5.238">   // But still filter out dangerous CSS rules.</span>
<a href="#l5.239"></a><span id="l5.239">   const badCSS = [</span>
<a href="#l5.240"></a><span id="l5.240">     &quot;-moz-binding: url('chrome://global/content/bindings/textbox.xml#textbox');&quot;,</span>
<a href="#l5.241"></a><span id="l5.241">     &quot;display: none&quot;,</span>
<a href="#l5.242"></a><span id="l5.242">     &quot;visibility: hidden&quot;</span>
<a href="#l5.243"></a><span id="l5.243">   ];</span>
<a href="#l5.244"></a><span id="l5.244">   for (let css of badCSS) {</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-    do_check_eq(&quot;&lt;span style=\&quot;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-                cleanupImMarkup(&quot;&lt;span style=\&quot;&quot; + css + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+    Assert.equal(&quot;&lt;span style=\&quot;\&quot;&gt;foo&lt;/span&gt;&quot;,</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineplus">+                 cleanupImMarkup(&quot;&lt;span style=\&quot;&quot; + css + &quot;\&quot;&gt;foo&lt;/span&gt;&quot;));</span>
<a href="#l5.249"></a><span id="l5.249">   }</span>
<a href="#l5.250"></a><span id="l5.250"> </span>
<a href="#l5.251"></a><span id="l5.251">   run_next_test();</span>
<a href="#l5.252"></a><span id="l5.252"> }</span>
<a href="#l5.253"></a><span id="l5.253"> </span>
<a href="#l5.254"></a><span id="l5.254"> function test_addGlobalAllowedTag() {</span>
<a href="#l5.255"></a><span id="l5.255">   Services.prefs.setIntPref(kModePref, kStrictMode);</span>
<a href="#l5.256"></a><span id="l5.256"> </span>
<a href="#l5.257"></a><span id="l5.257">   // Check that &lt;hr&gt; isn't allowed by default in strict mode.</span>
<a href="#l5.258"></a><span id="l5.258">   // Note: we use &lt;hr&gt; instead of &lt;img&gt; to avoid mailnews' content policy</span>
<a href="#l5.259"></a><span id="l5.259">   // messing things up.</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineminus">-  do_check_eq(&quot;&quot;, cleanupImMarkup(&quot;&lt;hr&gt;&quot;));</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineplus">+  Assert.equal(&quot;&quot;, cleanupImMarkup(&quot;&lt;hr&gt;&quot;));</span>
<a href="#l5.262"></a><span id="l5.262"> </span>
<a href="#l5.263"></a><span id="l5.263">   // Allow &lt;hr&gt; without attributes.</span>
<a href="#l5.264"></a><span id="l5.264">   addGlobalAllowedTag(&quot;hr&quot;);</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineminus">-  do_check_eq(&quot;&lt;hr&gt;&quot;, cleanupImMarkup(&quot;&lt;hr&gt;&quot;));</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineminus">-  do_check_eq(&quot;&lt;hr&gt;&quot;, cleanupImMarkup(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;));</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineplus">+  Assert.equal(&quot;&lt;hr&gt;&quot;, cleanupImMarkup(&quot;&lt;hr&gt;&quot;));</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineplus">+  Assert.equal(&quot;&lt;hr&gt;&quot;, cleanupImMarkup(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;));</span>
<a href="#l5.269"></a><span id="l5.269">   removeGlobalAllowedTag(&quot;hr&quot;);</span>
<a href="#l5.270"></a><span id="l5.270"> </span>
<a href="#l5.271"></a><span id="l5.271">   // Allow &lt;hr&gt; with an unfiltered src attribute.</span>
<a href="#l5.272"></a><span id="l5.272">   addGlobalAllowedTag(&quot;hr&quot;, {src: true});</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-  do_check_eq(&quot;&lt;hr&gt;&quot;, cleanupImMarkup(&quot;&lt;hr alt=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineminus">-  do_check_eq(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;,</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineminus">-              cleanupImMarkup(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;));</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineminus">-  do_check_eq(&quot;&lt;hr src=\&quot;chrome://global/skin/img.png\&quot;&gt;&quot;,</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineminus">-              cleanupImMarkup(&quot;&lt;hr src=\&quot;chrome://global/skin/img.png\&quot;&gt;&quot;));</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+  Assert.equal(&quot;&lt;hr&gt;&quot;, cleanupImMarkup(&quot;&lt;hr alt=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+  Assert.equal(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;,</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+               cleanupImMarkup(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;));</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineplus">+  Assert.equal(&quot;&lt;hr src=\&quot;chrome://global/skin/img.png\&quot;&gt;&quot;,</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineplus">+               cleanupImMarkup(&quot;&lt;hr src=\&quot;chrome://global/skin/img.png\&quot;&gt;&quot;));</span>
<a href="#l5.283"></a><span id="l5.283">   removeGlobalAllowedTag(&quot;hr&quot;);</span>
<a href="#l5.284"></a><span id="l5.284"> </span>
<a href="#l5.285"></a><span id="l5.285">   // Allow &lt;hr&gt; with an src attribute taking only http(s) urls.</span>
<a href="#l5.286"></a><span id="l5.286">   addGlobalAllowedTag(&quot;hr&quot;, {src: aValue =&gt; /^https?:/.test(aValue)});</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineminus">-  do_check_eq(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;,</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineminus">-              cleanupImMarkup(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;));</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineminus">-  do_check_eq(&quot;&lt;hr&gt;&quot;,</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineminus">-              cleanupImMarkup(&quot;&lt;hr src=\&quot;chrome://global/skin/img.png\&quot;&gt;&quot;));</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineplus">+  Assert.equal(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;,</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineplus">+               cleanupImMarkup(&quot;&lt;hr src=\&quot;http://example.com/\&quot;&gt;&quot;));</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineplus">+  Assert.equal(&quot;&lt;hr&gt;&quot;,</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineplus">+               cleanupImMarkup(&quot;&lt;hr src=\&quot;chrome://global/skin/img.png\&quot;&gt;&quot;));</span>
<a href="#l5.295"></a><span id="l5.295">   removeGlobalAllowedTag(&quot;hr&quot;);</span>
<a href="#l5.296"></a><span id="l5.296"> </span>
<a href="#l5.297"></a><span id="l5.297">   run_next_test();</span>
<a href="#l5.298"></a><span id="l5.298"> }</span>
<a href="#l5.299"></a><span id="l5.299"> </span>
<a href="#l5.300"></a><span id="l5.300"> function test_addGlobalAllowedAttribute() {</span>
<a href="#l5.301"></a><span id="l5.301">   Services.prefs.setIntPref(kModePref, kStrictMode);</span>
<a href="#l5.302"></a><span id="l5.302"> </span>
<a href="#l5.303"></a><span id="l5.303">   // Check that id isn't allowed by default in strict mode.</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineminus">-  do_check_eq(&quot;&lt;br&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineplus">+  Assert.equal(&quot;&lt;br&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.306"></a><span id="l5.306"> </span>
<a href="#l5.307"></a><span id="l5.307">   // Allow id unconditionally.</span>
<a href="#l5.308"></a><span id="l5.308">   addGlobalAllowedAttribute(&quot;id&quot;);</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineminus">-  do_check_eq(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineplus">+  Assert.equal(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.311"></a><span id="l5.311">   removeGlobalAllowedAttribute(&quot;id&quot;);</span>
<a href="#l5.312"></a><span id="l5.312"> </span>
<a href="#l5.313"></a><span id="l5.313">   // Allow id only with numbers.</span>
<a href="#l5.314"></a><span id="l5.314">   addGlobalAllowedAttribute(&quot;id&quot;, aId =&gt; /^\d+$/.test(aId));</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineminus">-  do_check_eq(&quot;&lt;br id=\&quot;123\&quot;&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;123\&quot;&gt;&quot;));</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-  do_check_eq(&quot;&lt;br&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineplus">+  Assert.equal(&quot;&lt;br id=\&quot;123\&quot;&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;123\&quot;&gt;&quot;));</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineplus">+  Assert.equal(&quot;&lt;br&gt;&quot;, cleanupImMarkup(&quot;&lt;br id=\&quot;foo\&quot;&gt;&quot;));</span>
<a href="#l5.319"></a><span id="l5.319">   removeGlobalAllowedAttribute(&quot;id&quot;);</span>
<a href="#l5.320"></a><span id="l5.320"> </span>
<a href="#l5.321"></a><span id="l5.321">   run_next_test();</span>
<a href="#l5.322"></a><span id="l5.322"> }</span>
<a href="#l5.323"></a><span id="l5.323"> </span>
<a href="#l5.324"></a><span id="l5.324"> function test_addGlobalAllowedStyleRule() {</span>
<a href="#l5.325"></a><span id="l5.325">   // We need at least the standard mode to have the style attribute allowed.</span>
<a href="#l5.326"></a><span id="l5.326">   Services.prefs.setIntPref(kModePref, kStandardMode);</span>
<a href="#l5.327"></a><span id="l5.327"> </span>
<a href="#l5.328"></a><span id="l5.328">   // Check that clear isn't allowed by default in strict mode.</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-  do_check_eq(&quot;&lt;br style=\&quot;\&quot;&gt;&quot;, cleanupImMarkup(&quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;));</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineplus">+  Assert.equal(&quot;&lt;br style=\&quot;\&quot;&gt;&quot;, cleanupImMarkup(&quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;));</span>
<a href="#l5.331"></a><span id="l5.331"> </span>
<a href="#l5.332"></a><span id="l5.332">   // Allow clear.</span>
<a href="#l5.333"></a><span id="l5.333">   addGlobalAllowedStyleRule(&quot;clear&quot;);</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineminus">-  do_check_eq(&quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;,</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineminus">-              cleanupImMarkup(&quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;));</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineplus">+  Assert.equal(&quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;,</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineplus">+               cleanupImMarkup(&quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;));</span>
<a href="#l5.338"></a><span id="l5.338">   removeGlobalAllowedStyleRule(&quot;clear&quot;);</span>
<a href="#l5.339"></a><span id="l5.339"> </span>
<a href="#l5.340"></a><span id="l5.340">   run_next_test();</span>
<a href="#l5.341"></a><span id="l5.341"> }</span>
<a href="#l5.342"></a><span id="l5.342"> </span>
<a href="#l5.343"></a><span id="l5.343"> function test_createDerivedRuleset() {</span>
<a href="#l5.344"></a><span id="l5.344">   Services.prefs.setIntPref(kModePref, kStandardMode);</span>
<a href="#l5.345"></a><span id="l5.345"> </span>
<a href="#l5.346"></a><span id="l5.346">   let rules = createDerivedRuleset();</span>
<a href="#l5.347"></a><span id="l5.347"> </span>
<a href="#l5.348"></a><span id="l5.348">   let string = &quot;&lt;hr&gt;&quot;;</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineminus">-  do_check_eq(&quot;&quot;, cleanupImMarkup(string));</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineminus">-  do_check_eq(&quot;&quot;, cleanupImMarkup(string, rules));</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineplus">+  Assert.equal(&quot;&quot;, cleanupImMarkup(string));</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineplus">+  Assert.equal(&quot;&quot;, cleanupImMarkup(string, rules));</span>
<a href="#l5.353"></a><span id="l5.353">   rules.tags[&quot;hr&quot;] = true;</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineminus">-  do_check_eq(string, cleanupImMarkup(string, rules));</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineplus">+  Assert.equal(string, cleanupImMarkup(string, rules));</span>
<a href="#l5.356"></a><span id="l5.356"> </span>
<a href="#l5.357"></a><span id="l5.357">   string = &quot;&lt;br id=\&quot;123\&quot;&gt;&quot;;</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineminus">-  do_check_eq(&quot;&lt;br&gt;&quot;, cleanupImMarkup(string));</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineminus">-  do_check_eq(&quot;&lt;br&gt;&quot;, cleanupImMarkup(string, rules));</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineplus">+  Assert.equal(&quot;&lt;br&gt;&quot;, cleanupImMarkup(string));</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineplus">+  Assert.equal(&quot;&lt;br&gt;&quot;, cleanupImMarkup(string, rules));</span>
<a href="#l5.362"></a><span id="l5.362">   rules.attrs[&quot;id&quot;] = true;</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineminus">-  do_check_eq(string, cleanupImMarkup(string, rules));</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineplus">+  Assert.equal(string, cleanupImMarkup(string, rules));</span>
<a href="#l5.365"></a><span id="l5.365"> </span>
<a href="#l5.366"></a><span id="l5.366">   string = &quot;&lt;br style=\&quot;clear: both;\&quot;&gt;&quot;;</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineminus">-  do_check_eq(&quot;&lt;br style=\&quot;\&quot;&gt;&quot;, cleanupImMarkup(string));</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineminus">-  do_check_eq(&quot;&lt;br style=\&quot;\&quot;&gt;&quot;, cleanupImMarkup(string, rules));</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineplus">+  Assert.equal(&quot;&lt;br style=\&quot;\&quot;&gt;&quot;, cleanupImMarkup(string));</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineplus">+  Assert.equal(&quot;&lt;br style=\&quot;\&quot;&gt;&quot;, cleanupImMarkup(string, rules));</span>
<a href="#l5.371"></a><span id="l5.371">   rules.styles[&quot;clear&quot;] = true;</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineminus">-  do_check_eq(string, cleanupImMarkup(string, rules));</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineplus">+  Assert.equal(string, cleanupImMarkup(string, rules));</span>
<a href="#l5.374"></a><span id="l5.374"> </span>
<a href="#l5.375"></a><span id="l5.375">   run_next_test();</span>
<a href="#l5.376"></a><span id="l5.376"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/chat/protocols/irc/test/test_ircNonStandard.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/chat/protocols/irc/test/test_ircNonStandard.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -83,17 +83,17 @@ function testZncAuth() {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   for (let msg of kZncMsgs) {</span>
<a href="#l6.6"></a><span id="l6.6">     let message = irc.ircMessage(msg, &quot;&quot;);</span>
<a href="#l6.7"></a><span id="l6.7">     // No provided password.</span>
<a href="#l6.8"></a><span id="l6.8">     let account = new FakeAccount();</span>
<a href="#l6.9"></a><span id="l6.9">     let result = NOTICE.call(account, message);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     // Yes, it was handled.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    do_check_true(result);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    Assert.ok(result);</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">     // No sent data and parameters should be unchanged.</span>
<a href="#l6.16"></a><span id="l6.16">     equal(account.buffer.length, 0);</span>
<a href="#l6.17"></a><span id="l6.17">     equal(account.shouldAuthenticate, undefined);</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">     // With a password.</span>
<a href="#l6.20"></a><span id="l6.20">     account = new FakeAccount(&quot;password&quot;);</span>
<a href="#l6.21"></a><span id="l6.21">     result = NOTICE.call(account, message);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/ldap/xpcom/tests/unit/test_nsLDAPURL.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/ldap/xpcom/tests/unit/test_nsLDAPURL.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -85,200 +85,200 @@ function run_test() {</span>
<a href="#l7.4"></a><span id="l7.4">   // Test - get and check urls.</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">   var part = 0;</span>
<a href="#l7.7"></a><span id="l7.7">   for (part = 0; part &lt; ldapURLs.length; ++part)</span>
<a href="#l7.8"></a><span id="l7.8">   {</span>
<a href="#l7.9"></a><span id="l7.9">     dump(&quot;url: &quot; + ldapURLs[part].url + &quot;\n&quot;);</span>
<a href="#l7.10"></a><span id="l7.10">     url = ioService.newURI(ldapURLs[part].url);</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    do_check_eq(url.spec, ldapURLs[part].spec);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    do_check_eq(url.asciiSpec, ldapURLs[part].asciiSpec);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-    do_check_eq(url.scheme, ldapURLs[part].scheme);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-    do_check_eq(url.host, ldapURLs[part].host);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-    do_check_eq(url.asciiHost, ldapURLs[part].asciiHost);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-    do_check_eq(url.port, ldapURLs[part].port);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-    do_check_eq(url.pathQueryRef, ldapURLs[part].path);</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-    do_check_eq(url.prePath, ldapURLs[part].prePath);</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-    do_check_eq(url.hostPort, ldapURLs[part].hostPort);</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    Assert.equal(url.spec, ldapURLs[part].spec);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+    Assert.equal(url.asciiSpec, ldapURLs[part].asciiSpec);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+    Assert.equal(url.scheme, ldapURLs[part].scheme);</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+    Assert.equal(url.host, ldapURLs[part].host);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    Assert.equal(url.asciiHost, ldapURLs[part].asciiHost);</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+    Assert.equal(url.port, ldapURLs[part].port);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+    Assert.equal(url.pathQueryRef, ldapURLs[part].path);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+    Assert.equal(url.prePath, ldapURLs[part].prePath);</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+    Assert.equal(url.hostPort, ldapURLs[part].hostPort);</span>
<a href="#l7.30"></a><span id="l7.30">     // XXX nsLDAPURL ought to have classinfo.</span>
<a href="#l7.31"></a><span id="l7.31">     url = url.QueryInterface(Ci.nsILDAPURL);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-    do_check_eq(url.dn, ldapURLs[part].dn);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-    do_check_eq(url.scope, ldapURLs[part].scope);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-    do_check_eq(url.filter, ldapURLs[part].filter);</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-    do_check_eq(url.options, ldapURLs[part].options);</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+    Assert.equal(url.dn, ldapURLs[part].dn);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+    Assert.equal(url.scope, ldapURLs[part].scope);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+    Assert.equal(url.filter, ldapURLs[part].filter);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+    Assert.equal(url.options, ldapURLs[part].options);</span>
<a href="#l7.40"></a><span id="l7.40">   }</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">   // Test - Check changing ldap values</span>
<a href="#l7.43"></a><span id="l7.43">   dump(&quot;Other Tests\n&quot;);</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">   // Start off with a base url</span>
<a href="#l7.46"></a><span id="l7.46">   const kBaseURL = &quot;ldap://localhost:389/dc=test,dc=abc??sub?(objectclass=*)&quot;;</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48">   url = ioService.newURI(kBaseURL)</span>
<a href="#l7.49"></a><span id="l7.49">                  .QueryInterface(Ci.nsILDAPURL);</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51">   // Test - dn</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53">   url.dn = &quot;dc=short&quot;;</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-  do_check_eq(url.dn, &quot;dc=short&quot;);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??sub?(objectclass=*)&quot;);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+  Assert.equal(url.dn, &quot;dc=short&quot;);</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??sub?(objectclass=*)&quot;);</span>
<a href="#l7.59"></a><span id="l7.59"> </span>
<a href="#l7.60"></a><span id="l7.60">   // Test - scope</span>
<a href="#l7.61"></a><span id="l7.61"> </span>
<a href="#l7.62"></a><span id="l7.62">   url.scope = Ci.nsILDAPURL.SCOPE_BASE;</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-  do_check_eq(url.scope, Ci.nsILDAPURL.SCOPE_BASE);</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short???(objectclass=*)&quot;);</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+  Assert.equal(url.scope, Ci.nsILDAPURL.SCOPE_BASE);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short???(objectclass=*)&quot;);</span>
<a href="#l7.68"></a><span id="l7.68"> </span>
<a href="#l7.69"></a><span id="l7.69">   url.scope = Ci.nsILDAPURL.SCOPE_ONELEVEL;</span>
<a href="#l7.70"></a><span id="l7.70"> </span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-  do_check_eq(url.scope, Ci.nsILDAPURL.SCOPE_ONELEVEL);</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  Assert.equal(url.scope, Ci.nsILDAPURL.SCOPE_ONELEVEL);</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76">   // Test - filter</span>
<a href="#l7.77"></a><span id="l7.77"> </span>
<a href="#l7.78"></a><span id="l7.78">   url.filter = &quot;(oc=ygh)&quot;;</span>
<a href="#l7.79"></a><span id="l7.79"> </span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-  do_check_eq(url.filter, &quot;(oc=ygh)&quot;);</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(oc=ygh)&quot;);</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+  Assert.equal(url.filter, &quot;(oc=ygh)&quot;);</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(oc=ygh)&quot;);</span>
<a href="#l7.84"></a><span id="l7.84"> </span>
<a href="#l7.85"></a><span id="l7.85">   url.filter = &quot;&quot;;</span>
<a href="#l7.86"></a><span id="l7.86"> </span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-  do_check_eq(url.filter, &quot;(objectclass=*)&quot;);</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+  Assert.equal(url.filter, &quot;(objectclass=*)&quot;);</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.91"></a><span id="l7.91"> </span>
<a href="#l7.92"></a><span id="l7.92">   // Test - scheme</span>
<a href="#l7.93"></a><span id="l7.93"> </span>
<a href="#l7.94"></a><span id="l7.94">   // An old version used to have a bug whereby if you set the scheme to the</span>
<a href="#l7.95"></a><span id="l7.95">   // same thing twice, you'd get the options set wrongly.</span>
<a href="#l7.96"></a><span id="l7.96">   url.scheme = &quot;ldaps&quot;;</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-  do_check_eq(url.options, 1);</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-  do_check_eq(url.spec, &quot;ldaps://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+  Assert.equal(url.options, 1);</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+  Assert.equal(url.spec, &quot;ldaps://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.101"></a><span id="l7.101">   url.scheme = &quot;ldaps&quot;;</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-  do_check_eq(url.options, 1);</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-  do_check_eq(url.spec, &quot;ldaps://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+  Assert.equal(url.options, 1);</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+  Assert.equal(url.spec, &quot;ldaps://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.106"></a><span id="l7.106"> </span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-  do_check_true(url.schemeIs(&quot;ldaps&quot;));</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineminus">-  do_check_false(url.schemeIs(&quot;ldap&quot;));</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+  Assert.ok(url.schemeIs(&quot;ldaps&quot;));</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+  Assert.ok(!url.schemeIs(&quot;ldap&quot;));</span>
<a href="#l7.111"></a><span id="l7.111"> </span>
<a href="#l7.112"></a><span id="l7.112">   url.scheme = &quot;ldap&quot;;</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineminus">-  do_check_eq(url.options, 0);</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+  Assert.equal(url.options, 0);</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.117"></a><span id="l7.117">   url.scheme = &quot;ldap&quot;;</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineminus">-  do_check_eq(url.options, 0);</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+  Assert.equal(url.options, 0);</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.122"></a><span id="l7.122"> </span>
<a href="#l7.123"></a><span id="l7.123" class="difflineminus">-  do_check_true(url.schemeIs(&quot;ldap&quot;));</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineminus">-  do_check_false(url.schemeIs(&quot;ldaps&quot;));</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+  Assert.ok(url.schemeIs(&quot;ldap&quot;));</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+  Assert.ok(!url.schemeIs(&quot;ldaps&quot;));</span>
<a href="#l7.127"></a><span id="l7.127"> </span>
<a href="#l7.128"></a><span id="l7.128">   // Test - Options</span>
<a href="#l7.129"></a><span id="l7.129"> </span>
<a href="#l7.130"></a><span id="l7.130">   url.options = Ci.nsILDAPURL.OPT_SECURE;</span>
<a href="#l7.131"></a><span id="l7.131"> </span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-  do_check_eq(url.options, Ci.nsILDAPURL.OPT_SECURE);</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-  do_check_eq(url.spec, &quot;ldaps://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+  Assert.equal(url.options, Ci.nsILDAPURL.OPT_SECURE);</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+  Assert.equal(url.spec, &quot;ldaps://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.136"></a><span id="l7.136"> </span>
<a href="#l7.137"></a><span id="l7.137">   url.options = 0;</span>
<a href="#l7.138"></a><span id="l7.138"> </span>
<a href="#l7.139"></a><span id="l7.139" class="difflineminus">-  do_check_eq(url.options, 0);</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+  Assert.equal(url.options, 0);</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.143"></a><span id="l7.143"> </span>
<a href="#l7.144"></a><span id="l7.144">   // Test - Equals</span>
<a href="#l7.145"></a><span id="l7.145"> </span>
<a href="#l7.146"></a><span id="l7.146">   var url2 = ioService.newURI(&quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;)</span>
<a href="#l7.147"></a><span id="l7.147">                       .QueryInterface(Ci.nsILDAPURL);</span>
<a href="#l7.148"></a><span id="l7.148"> </span>
<a href="#l7.149"></a><span id="l7.149" class="difflineminus">-  do_check_true(url.equals(url2));</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+  Assert.ok(url.equals(url2));</span>
<a href="#l7.151"></a><span id="l7.151"> </span>
<a href="#l7.152"></a><span id="l7.152">   url2.spec = &quot;ldap://localhost:389/dc=short??sub?(objectclass=*)&quot;;</span>
<a href="#l7.153"></a><span id="l7.153"> </span>
<a href="#l7.154"></a><span id="l7.154" class="difflineminus">-  do_check_false(url.equals(url2));</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+  Assert.ok(!url.equals(url2));</span>
<a href="#l7.156"></a><span id="l7.156"> </span>
<a href="#l7.157"></a><span id="l7.157">   // Test Attributes</span>
<a href="#l7.158"></a><span id="l7.158"> </span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-  do_check_eq(url.attributes.length, 0);</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+  Assert.equal(url.attributes.length, 0);</span>
<a href="#l7.161"></a><span id="l7.161"> </span>
<a href="#l7.162"></a><span id="l7.162">   // Nothing should happend if the attribute doesn't exist</span>
<a href="#l7.163"></a><span id="l7.163">   url.removeAttribute(&quot;abc&quot;);</span>
<a href="#l7.164"></a><span id="l7.164"> </span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-  do_check_eq(url.attributes.length, 0);</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineplus">+  Assert.equal(url.attributes.length, 0);</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.169"></a><span id="l7.169"> </span>
<a href="#l7.170"></a><span id="l7.170">   url.addAttribute(&quot;dn&quot;);</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short?dn?one?(objectclass=*)&quot;);</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short?dn?one?(objectclass=*)&quot;);</span>
<a href="#l7.173"></a><span id="l7.173"> </span>
<a href="#l7.174"></a><span id="l7.174" class="difflineminus">-  do_check_eq(url.attributes, &quot;dn&quot;);</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+  Assert.equal(url.attributes, &quot;dn&quot;);</span>
<a href="#l7.176"></a><span id="l7.176"> </span>
<a href="#l7.177"></a><span id="l7.177">   url.removeAttribute(&quot;dn&quot;);</span>
<a href="#l7.178"></a><span id="l7.178"> </span>
<a href="#l7.179"></a><span id="l7.179" class="difflineminus">-  do_check_eq(url.attributes.length, 0);</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineplus">+  Assert.equal(url.attributes.length, 0);</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.183"></a><span id="l7.183"> </span>
<a href="#l7.184"></a><span id="l7.184">   var newAttrs = &quot;abc,def,ghi,jkl&quot;;</span>
<a href="#l7.185"></a><span id="l7.185">   url.attributes = newAttrs;</span>
<a href="#l7.186"></a><span id="l7.186"> </span>
<a href="#l7.187"></a><span id="l7.187">   var i;</span>
<a href="#l7.188"></a><span id="l7.188"> </span>
<a href="#l7.189"></a><span id="l7.189" class="difflineminus">-  do_check_eq(url.attributes, newAttrs);</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineminus">-  do_check_eq(url.spec,</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineminus">-              &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short?&quot; +</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineminus">-              newAttrs + &quot;?one?(objectclass=*)&quot;);</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineplus">+  Assert.equal(url.attributes, newAttrs);</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineplus">+  Assert.equal(url.spec,</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineplus">+               &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short?&quot; +</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineplus">+               newAttrs + &quot;?one?(objectclass=*)&quot;);</span>
<a href="#l7.197"></a><span id="l7.197"> </span>
<a href="#l7.198"></a><span id="l7.198">   // Try adding an existing attribute - should do nothing</span>
<a href="#l7.199"></a><span id="l7.199">   url.addAttribute(&quot;def&quot;);</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineminus">-  do_check_eq(url.attributes, newAttrs);</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineplus">+  Assert.equal(url.attributes, newAttrs);</span>
<a href="#l7.202"></a><span id="l7.202"> </span>
<a href="#l7.203"></a><span id="l7.203">   //  url.addAttribute(&quot;jk&quot;);</span>
<a href="#l7.204"></a><span id="l7.204"> </span>
<a href="#l7.205"></a><span id="l7.205" class="difflineminus">-  do_check_true(url.hasAttribute(&quot;jkl&quot;));</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineminus">-  do_check_true(url.hasAttribute(&quot;def&quot;));</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineminus">-  do_check_true(url.hasAttribute(&quot;ABC&quot;));</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineminus">-  do_check_false(url.hasAttribute(&quot;cde&quot;));</span>
<a href="#l7.209"></a><span id="l7.209" class="difflineminus">-  do_check_false(url.hasAttribute(&quot;3446&quot;));</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineminus">-  do_check_false(url.hasAttribute(&quot;kl&quot;));</span>
<a href="#l7.211"></a><span id="l7.211" class="difflineminus">-  do_check_false(url.hasAttribute(&quot;jk&quot;));</span>
<a href="#l7.212"></a><span id="l7.212" class="difflineplus">+  Assert.ok(url.hasAttribute(&quot;jkl&quot;));</span>
<a href="#l7.213"></a><span id="l7.213" class="difflineplus">+  Assert.ok(url.hasAttribute(&quot;def&quot;));</span>
<a href="#l7.214"></a><span id="l7.214" class="difflineplus">+  Assert.ok(url.hasAttribute(&quot;ABC&quot;));</span>
<a href="#l7.215"></a><span id="l7.215" class="difflineplus">+  Assert.ok(!url.hasAttribute(&quot;cde&quot;));</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineplus">+  Assert.ok(!url.hasAttribute(&quot;3446&quot;));</span>
<a href="#l7.217"></a><span id="l7.217" class="difflineplus">+  Assert.ok(!url.hasAttribute(&quot;kl&quot;));</span>
<a href="#l7.218"></a><span id="l7.218" class="difflineplus">+  Assert.ok(!url.hasAttribute(&quot;jk&quot;));</span>
<a href="#l7.219"></a><span id="l7.219"> </span>
<a href="#l7.220"></a><span id="l7.220">   // Sub-string of an attribute, so this shouldn't change anything.</span>
<a href="#l7.221"></a><span id="l7.221">   url.removeAttribute(&quot;kl&quot;);</span>
<a href="#l7.222"></a><span id="l7.222">   url.removeAttribute(&quot;jk&quot;);</span>
<a href="#l7.223"></a><span id="l7.223">   url.removeAttribute(&quot;ef&quot;);</span>
<a href="#l7.224"></a><span id="l7.224" class="difflineminus">-  do_check_eq(url.attributes, newAttrs);</span>
<a href="#l7.225"></a><span id="l7.225" class="difflineplus">+  Assert.equal(url.attributes, newAttrs);</span>
<a href="#l7.226"></a><span id="l7.226"> </span>
<a href="#l7.227"></a><span id="l7.227">   url.removeAttribute(&quot;abc&quot;);</span>
<a href="#l7.228"></a><span id="l7.228">   newAttrs = newAttrs.substring(4);</span>
<a href="#l7.229"></a><span id="l7.229"> </span>
<a href="#l7.230"></a><span id="l7.230" class="difflineminus">-  do_check_eq(url.attributes, newAttrs);</span>
<a href="#l7.231"></a><span id="l7.231" class="difflineminus">-  do_check_eq(url.spec,</span>
<a href="#l7.232"></a><span id="l7.232" class="difflineminus">-              &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short?&quot; +</span>
<a href="#l7.233"></a><span id="l7.233" class="difflineminus">-              newAttrs + &quot;?one?(objectclass=*)&quot;);</span>
<a href="#l7.234"></a><span id="l7.234" class="difflineplus">+  Assert.equal(url.attributes, newAttrs);</span>
<a href="#l7.235"></a><span id="l7.235" class="difflineplus">+  Assert.equal(url.spec,</span>
<a href="#l7.236"></a><span id="l7.236" class="difflineplus">+               &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short?&quot; +</span>
<a href="#l7.237"></a><span id="l7.237" class="difflineplus">+               newAttrs + &quot;?one?(objectclass=*)&quot;);</span>
<a href="#l7.238"></a><span id="l7.238"> </span>
<a href="#l7.239"></a><span id="l7.239">   // This shouldn't fail, just clear the list</span>
<a href="#l7.240"></a><span id="l7.240">   url.attributes = &quot;&quot;;</span>
<a href="#l7.241"></a><span id="l7.241"> </span>
<a href="#l7.242"></a><span id="l7.242" class="difflineminus">-  do_check_eq(url.attributes.length, 0);</span>
<a href="#l7.243"></a><span id="l7.243" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.244"></a><span id="l7.244" class="difflineplus">+  Assert.equal(url.attributes.length, 0);</span>
<a href="#l7.245"></a><span id="l7.245" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost&quot; + portAdpt + &quot;/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.246"></a><span id="l7.246"> </span>
<a href="#l7.247"></a><span id="l7.247">   // Set attributes via the url spec</span>
<a href="#l7.248"></a><span id="l7.248"> </span>
<a href="#l7.249"></a><span id="l7.249">   newAttrs = &quot;abc,def,ghi,jkl&quot;;</span>
<a href="#l7.250"></a><span id="l7.250">   url.spec = &quot;ldap://localhost/dc=short?&quot; + newAttrs + &quot;?one?(objectclass=*)&quot;;</span>
<a href="#l7.251"></a><span id="l7.251"> </span>
<a href="#l7.252"></a><span id="l7.252" class="difflineminus">-  do_check_eq(url.attributes, newAttrs);</span>
<a href="#l7.253"></a><span id="l7.253" class="difflineminus">-  do_check_eq(url.spec,</span>
<a href="#l7.254"></a><span id="l7.254" class="difflineminus">-              &quot;ldap://localhost/dc=short?&quot; + newAttrs + &quot;?one?(objectclass=*)&quot;);</span>
<a href="#l7.255"></a><span id="l7.255" class="difflineplus">+  Assert.equal(url.attributes, newAttrs);</span>
<a href="#l7.256"></a><span id="l7.256" class="difflineplus">+  Assert.equal(url.spec,</span>
<a href="#l7.257"></a><span id="l7.257" class="difflineplus">+               &quot;ldap://localhost/dc=short?&quot; + newAttrs + &quot;?one?(objectclass=*)&quot;);</span>
<a href="#l7.258"></a><span id="l7.258"> </span>
<a href="#l7.259"></a><span id="l7.259">   url.spec = &quot;ldap://localhost/dc=short??one?(objectclass=*)&quot;;</span>
<a href="#l7.260"></a><span id="l7.260"> </span>
<a href="#l7.261"></a><span id="l7.261">   attrs = url.attributes;</span>
<a href="#l7.262"></a><span id="l7.262" class="difflineminus">-  do_check_eq(attrs.length, 0);</span>
<a href="#l7.263"></a><span id="l7.263" class="difflineminus">-  do_check_eq(url.spec, &quot;ldap://localhost/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.264"></a><span id="l7.264" class="difflineplus">+  Assert.equal(attrs.length, 0);</span>
<a href="#l7.265"></a><span id="l7.265" class="difflineplus">+  Assert.equal(url.spec, &quot;ldap://localhost/dc=short??one?(objectclass=*)&quot;);</span>
<a href="#l7.266"></a><span id="l7.266"> </span>
<a href="#l7.267"></a><span id="l7.267">   // Test - clone</span>
<a href="#l7.268"></a><span id="l7.268"> </span>
<a href="#l7.269"></a><span id="l7.269">   url.spec = &quot;ldap://localhost/dc=short?abc,def,ghi,jkl?one?(objectclass=*)&quot;;</span>
<a href="#l7.270"></a><span id="l7.270"> </span>
<a href="#l7.271"></a><span id="l7.271">   var newUrl = url.clone();</span>
<a href="#l7.272"></a><span id="l7.272"> </span>
<a href="#l7.273"></a><span id="l7.273" class="difflineminus">-  do_check_eq(newUrl.spec,</span>
<a href="#l7.274"></a><span id="l7.274" class="difflineminus">-              &quot;ldap://localhost/dc=short?abc,def,ghi,jkl?one?(objectclass=*)&quot;);</span>
<a href="#l7.275"></a><span id="l7.275" class="difflineplus">+  Assert.equal(newUrl.spec,</span>
<a href="#l7.276"></a><span id="l7.276" class="difflineplus">+               &quot;ldap://localhost/dc=short?abc,def,ghi,jkl?one?(objectclass=*)&quot;);</span>
<a href="#l7.277"></a><span id="l7.277"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/test/unit/test_alertHook.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/test/unit/test_alertHook.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -37,28 +37,28 @@ function run_test() {</span>
<a href="#l8.4"></a><span id="l8.4">   let uuid = MockFactory.register(&quot;@mozilla.org/alerts-service;1&quot;, mockAlertsService);</span>
<a href="#l8.5"></a><span id="l8.5">   do_register_cleanup(function() {</span>
<a href="#l8.6"></a><span id="l8.6">     MockFactory.unregister(uuid);</span>
<a href="#l8.7"></a><span id="l8.7">   });</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">   // Just text, no url or window =&gt; expect no error shown to user</span>
<a href="#l8.10"></a><span id="l8.10">   gAlertShown = false;</span>
<a href="#l8.11"></a><span id="l8.11">   MailServices.mailSession.alertUser(&quot;test error&quot;);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  do_check_false(gAlertShown);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  Assert.ok(!gAlertShown);</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   // Text, url and window =&gt; expect error shown to user</span>
<a href="#l8.16"></a><span id="l8.16">   gAlertShown = false;</span>
<a href="#l8.17"></a><span id="l8.17">   MailServices.mailSession.alertUser(&quot;test error 2&quot;, mailnewsURL);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-  do_check_true(gAlertShown);</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+  Assert.ok(gAlertShown);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   // Text, url and no window =&gt; export no error shown to user</span>
<a href="#l8.22"></a><span id="l8.22">   gAlertShown = false;</span>
<a href="#l8.23"></a><span id="l8.23">   gMsgWindow = null;</span>
<a href="#l8.24"></a><span id="l8.24">   MailServices.mailSession.alertUser(&quot;test error 2&quot;, mailnewsURL);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-  do_check_false(gAlertShown);</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+  Assert.ok(!gAlertShown);</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">   // XXX There appears to be a shutdown leak within the activity manager when</span>
<a href="#l8.29"></a><span id="l8.29">   // unless it is cleaned up, however as it is only shutdown, it doesn't really</span>
<a href="#l8.30"></a><span id="l8.30">   // matter, so we'll just ignore it here.</span>
<a href="#l8.31"></a><span id="l8.31">   Cc[&quot;@mozilla.org/activity-manager;1&quot;]</span>
<a href="#l8.32"></a><span id="l8.32">     .getService(Ci.nsIActivityManager)</span>
<a href="#l8.33"></a><span id="l8.33">     .cleanUp();</span>
<a href="#l8.34"></a><span id="l8.34"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -27,17 +27,17 @@ function* test_empty_trash() {</span>
<a href="#l9.4"></a><span id="l9.4">   yield wait_for_async_promises();</span>
<a href="#l9.5"></a><span id="l9.5">   let trashFolder = get_real_injection_folder(trashHandle);</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">   yield async_view_open(viewWrapper, trashFolder);</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">   yield async_empty_trash();</span>
<a href="#l9.10"></a><span id="l9.10">   verify_empty_view(viewWrapper);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  do_check_true(viewWrapper.displayedFolder !== null);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  Assert.ok(viewWrapper.displayedFolder !== null);</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">   let [msgSet] = make_new_sets_in_folders([trashHandle], [{count: 1}]);</span>
<a href="#l9.16"></a><span id="l9.16">   yield wait_for_message_injection();</span>
<a href="#l9.17"></a><span id="l9.17">   verify_messages_in_view(msgSet, viewWrapper);</span>
<a href="#l9.18"></a><span id="l9.18"> }</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> var tests = [</span>
<a href="#l9.21"></a><span id="l9.21">   test_real_folder_load_and_move_to_trash,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/test/unit/test_mailGlue_distribution.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/test/unit/test_mailGlue_distribution.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -34,91 +34,91 @@ function run_test()</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">   let testDir = Services.dirsvc.get(&quot;CurWorkD&quot;, Ci.nsIFile);</span>
<a href="#l10.6"></a><span id="l10.6">   let testDistributionFile = testDir.clone();</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">   // Construct descendant file</span>
<a href="#l10.9"></a><span id="l10.9">   testDistributionFile.append(&quot;distribution.ini&quot;);</span>
<a href="#l10.10"></a><span id="l10.10">   // Copy to distroDir</span>
<a href="#l10.11"></a><span id="l10.11">   testDistributionFile.copyTo(distroDir, &quot;distribution.ini&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  do_check_true(testDistributionFile.exists());</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  Assert.ok(testDistributionFile.exists());</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">   // Set the prefs</span>
<a href="#l10.16"></a><span id="l10.16">   TBDistCustomizer.applyPrefDefaults();</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">   let testIni = Cc[&quot;@mozilla.org/xpcom/ini-parser-factory;1&quot;]</span>
<a href="#l10.19"></a><span id="l10.19">                   .getService(Ci.nsIINIParserFactory)</span>
<a href="#l10.20"></a><span id="l10.20">                   .createINIParser(testDistributionFile);</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">   // Now check that prefs were set - test the Global prefs against the</span>
<a href="#l10.23"></a><span id="l10.23">   // Global section in the ini file</span>
<a href="#l10.24"></a><span id="l10.24">   let iniValue = testIni.getString(&quot;Global&quot;, &quot;id&quot;);</span>
<a href="#l10.25"></a><span id="l10.25">   let pref = Services.prefs.getCharPref(&quot;distribution.id&quot;);</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-  do_check_eq(iniValue, pref);</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+  Assert.equal(iniValue, pref);</span>
<a href="#l10.28"></a><span id="l10.28"> </span>
<a href="#l10.29"></a><span id="l10.29">   iniValue = testIni.getString(&quot;Global&quot;, &quot;version&quot;);</span>
<a href="#l10.30"></a><span id="l10.30">   pref = Services.prefs.getCharPref(&quot;distribution.version&quot;);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  do_check_eq(iniValue, pref);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  Assert.equal(iniValue, pref);</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">   let aboutLocale;</span>
<a href="#l10.35"></a><span id="l10.35">   try {</span>
<a href="#l10.36"></a><span id="l10.36">     aboutLocale = testIni.getString(&quot;Global&quot;, &quot;about.en-US&quot;);</span>
<a href="#l10.37"></a><span id="l10.37">   }</span>
<a href="#l10.38"></a><span id="l10.38">   catch (e) {</span>
<a href="#l10.39"></a><span id="l10.39">     Components.utils.reportError(e);</span>
<a href="#l10.40"></a><span id="l10.40">   }</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42">   if (aboutLocale == undefined)</span>
<a href="#l10.43"></a><span id="l10.43">     aboutLocale = testIni.getString(&quot;Global&quot;, &quot;about&quot;);</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45">   pref = Services.prefs.getCharPref(&quot;distribution.about&quot;);</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-  do_check_eq(aboutLocale, pref);</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+  Assert.equal(aboutLocale, pref);</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">   // Test Preferences section</span>
<a href="#l10.50"></a><span id="l10.50">   let s = &quot;Preferences&quot;;</span>
<a href="#l10.51"></a><span id="l10.51">   let keys = testIni.getKeys(s);</span>
<a href="#l10.52"></a><span id="l10.52">   while (keys.hasMore()) {</span>
<a href="#l10.53"></a><span id="l10.53">     let key = keys.getNext();</span>
<a href="#l10.54"></a><span id="l10.54">     let value = eval(testIni.getString(s, key));</span>
<a href="#l10.55"></a><span id="l10.55">     switch (typeof value) {</span>
<a href="#l10.56"></a><span id="l10.56">     case &quot;boolean&quot;:</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-        do_check_eq(value, Services.prefs.getBoolPref(key));</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+        Assert.equal(value, Services.prefs.getBoolPref(key));</span>
<a href="#l10.59"></a><span id="l10.59">         break;</span>
<a href="#l10.60"></a><span id="l10.60">     case &quot;number&quot;:</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-        do_check_eq(value, Services.prefs.getIntPref(key));</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+        Assert.equal(value, Services.prefs.getIntPref(key));</span>
<a href="#l10.63"></a><span id="l10.63">         break;</span>
<a href="#l10.64"></a><span id="l10.64">     case &quot;string&quot;:</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-        do_check_eq(value, Services.prefs.getCharPref(key));</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+        Assert.equal(value, Services.prefs.getCharPref(key));</span>
<a href="#l10.67"></a><span id="l10.67">         break;</span>
<a href="#l10.68"></a><span id="l10.68">     default:</span>
<a href="#l10.69"></a><span id="l10.69">         do_throw(&quot;The preference &quot; + key + &quot; is of unknown type: &quot; + typeof value);</span>
<a href="#l10.70"></a><span id="l10.70">     }</span>
<a href="#l10.71"></a><span id="l10.71">   }</span>
<a href="#l10.72"></a><span id="l10.72"> </span>
<a href="#l10.73"></a><span id="l10.73">   // Test the LocalizablePreferences-[locale] section</span>
<a href="#l10.74"></a><span id="l10.74">   // Add any prefs found in it to the overrides array</span>
<a href="#l10.75"></a><span id="l10.75">   let overrides = [];</span>
<a href="#l10.76"></a><span id="l10.76">   s = &quot;LocalizablePreferences-en-US&quot;;</span>
<a href="#l10.77"></a><span id="l10.77">   keys = testIni.getKeys(s);</span>
<a href="#l10.78"></a><span id="l10.78">   while (keys.hasMore()) {</span>
<a href="#l10.79"></a><span id="l10.79">     let key = keys.getNext();</span>
<a href="#l10.80"></a><span id="l10.80">     let value = eval(testIni.getString(s, key));</span>
<a href="#l10.81"></a><span id="l10.81">     value = &quot;data:text/plain,&quot; + key + &quot;=&quot; + value;</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-    do_check_eq(value, Services.prefs.getCharPref(key));</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+    Assert.equal(value, Services.prefs.getCharPref(key));</span>
<a href="#l10.84"></a><span id="l10.84">     overrides.push(key);</span>
<a href="#l10.85"></a><span id="l10.85">   }</span>
<a href="#l10.86"></a><span id="l10.86"> </span>
<a href="#l10.87"></a><span id="l10.87">   // Test the LocalizablePreferences section</span>
<a href="#l10.88"></a><span id="l10.88">   // Any prefs here that aren't found in overrides are not overriden</span>
<a href="#l10.89"></a><span id="l10.89">   //   by LocalizablePrefs-[locale] and should be tested</span>
<a href="#l10.90"></a><span id="l10.90">   s = &quot;LocalizablePreferences&quot;;</span>
<a href="#l10.91"></a><span id="l10.91">   keys = testIni.getKeys(s);</span>
<a href="#l10.92"></a><span id="l10.92">   while (keys.hasMore()) {</span>
<a href="#l10.93"></a><span id="l10.93">     let key = keys.getNext();</span>
<a href="#l10.94"></a><span id="l10.94">     if (!overrides.includes(key)) {</span>
<a href="#l10.95"></a><span id="l10.95">       let value = eval(testIni.getString(s, key));</span>
<a href="#l10.96"></a><span id="l10.96">       value =  value.replace(/%LOCALE%/g, &quot;en-US&quot;);</span>
<a href="#l10.97"></a><span id="l10.97">       value = &quot;data:text/plain,&quot; + key + &quot;=&quot; + value;</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-      do_check_eq(value, Services.prefs.getCharPref(key));</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+      Assert.equal(value, Services.prefs.getCharPref(key));</span>
<a href="#l10.100"></a><span id="l10.100">     }</span>
<a href="#l10.101"></a><span id="l10.101">   }</span>
<a href="#l10.102"></a><span id="l10.102">   do_test_finished();</span>
<a href="#l10.103"></a><span id="l10.103"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_imapFolder.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_imapFolder.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -30,23 +30,23 @@ function* test_enter_imap_folder_requiri</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">   // - add the messages</span>
<a href="#l11.6"></a><span id="l11.6">   let [msgSet] = make_new_sets_in_folder(folderHandle, [{count: 1}], true);</span>
<a href="#l11.7"></a><span id="l11.7">   yield wait_for_message_injection();</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   let viewWrapper = make_view_wrapper();</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">   // - make sure we don't know about the message!</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  do_check_eq(msgFolder.getTotalMessages(false), 0);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  Assert.equal(msgFolder.getTotalMessages(false), 0);</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">   // - sync open the folder, verify we claim we entered, and make sure it has</span>
<a href="#l11.16"></a><span id="l11.16">   //  nothing in it!</span>
<a href="#l11.17"></a><span id="l11.17">   viewWrapper.listener.pendingLoad = true;</span>
<a href="#l11.18"></a><span id="l11.18">   viewWrapper.open(msgFolder);</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-  do_check_true(viewWrapper._enteredFolder);</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+  Assert.ok(viewWrapper._enteredFolder);</span>
<a href="#l11.21"></a><span id="l11.21">   verify_empty_view(viewWrapper);</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23">   // - async wait for all the messages to load</span>
<a href="#l11.24"></a><span id="l11.24">   yield false;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">   // - make sure the view sees the message though...</span>
<a href="#l11.27"></a><span id="l11.27">   verify_messages_in_view(msgSet, viewWrapper);</span>
<a href="#l11.28"></a><span id="l11.28"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_logic.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_logic.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -43,42 +43,42 @@ function* test_threads_special_views_mut</span>
<a href="#l12.4"></a><span id="l12.4">   let folder = make_empty_folder();</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l12.7"></a><span id="l12.7">   // enter an update that will never conclude. this is fine.</span>
<a href="#l12.8"></a><span id="l12.8">   viewWrapper.beginViewUpdate();</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">   // turn on the special view, make sure we think it took</span>
<a href="#l12.11"></a><span id="l12.11">   viewWrapper.specialViewThreadsWithUnread = true;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  do_check_true(viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  do_check_false(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  Assert.ok(viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">   // hit showUnreadOnly which should already be false, so this makes sure that</span>
<a href="#l12.18"></a><span id="l12.18">   //  just writing to it forces the special view off.</span>
<a href="#l12.19"></a><span id="l12.19">   viewWrapper.showUnreadOnly = false;</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-  do_check_false(viewWrapper.showUnreadOnly);</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-  do_check_false(viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-  do_check_false(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+  Assert.ok(!viewWrapper.showUnreadOnly);</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   // turn on the other special view</span>
<a href="#l12.28"></a><span id="l12.28">   viewWrapper.specialViewWatchedThreadsWithUnread = true;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-  do_check_false(viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-  do_check_true(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  Assert.ok(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.33"></a><span id="l12.33"> </span>
<a href="#l12.34"></a><span id="l12.34">   // turn on show unread only mode, make sure special view is cleared</span>
<a href="#l12.35"></a><span id="l12.35">   viewWrapper.showUnreadOnly = true;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-  do_check_true(viewWrapper.showUnreadOnly);</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-  do_check_false(viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-  do_check_false(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  Assert.ok(viewWrapper.showUnreadOnly);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">   // turn off show unread only mode just to make sure the transition happens</span>
<a href="#l12.44"></a><span id="l12.44">   viewWrapper.showUnreadOnly = false;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-  do_check_false(viewWrapper.showUnreadOnly);</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-  do_check_false(viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-  do_check_false(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+  Assert.ok(!viewWrapper.showUnreadOnly);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewThreadsWithUnread);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+  Assert.ok(!viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l12.51"></a><span id="l12.51"> }</span>
<a href="#l12.52"></a><span id="l12.52"> </span>
<a href="#l12.53"></a><span id="l12.53"> /**</span>
<a href="#l12.54"></a><span id="l12.54">  * Do a quick test of primary sorting to make sure we're actually changing the</span>
<a href="#l12.55"></a><span id="l12.55">  *  sort order.  (However, we are not responsible for verifying correctness of</span>
<a href="#l12.56"></a><span id="l12.56">  *  the sort.)</span>
<a href="#l12.57"></a><span id="l12.57">  */</span>
<a href="#l12.58"></a><span id="l12.58"> function* test_sort_primary() {</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineat">@@ -228,34 +228,34 @@ function* test_sort_group_by_sort() {</span>
<a href="#l12.60"></a><span id="l12.60">  *  presumably visible).</span>
<a href="#l12.61"></a><span id="l12.61">  */</span>
<a href="#l12.62"></a><span id="l12.62"> function* test_mailviews_persistence() {</span>
<a href="#l12.63"></a><span id="l12.63">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.64"></a><span id="l12.64">   let folder = make_empty_folder();</span>
<a href="#l12.65"></a><span id="l12.65"> </span>
<a href="#l12.66"></a><span id="l12.66">   // open the folder, ensure it is using the default mail view</span>
<a href="#l12.67"></a><span id="l12.67">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-  do_check_eq(viewWrapper.mailViewIndex, MailViewConstants.kViewItemAll);</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+  Assert.equal(viewWrapper.mailViewIndex, MailViewConstants.kViewItemAll);</span>
<a href="#l12.70"></a><span id="l12.70"> </span>
<a href="#l12.71"></a><span id="l12.71">   // set the view so as to be persisted</span>
<a href="#l12.72"></a><span id="l12.72">   viewWrapper.setMailView(MailViewConstants.kViewItemUnread);</span>
<a href="#l12.73"></a><span id="l12.73">   // ...but first make sure it took at all</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-  do_check_eq(viewWrapper.mailViewIndex, MailViewConstants.kViewItemUnread);</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+  Assert.equal(viewWrapper.mailViewIndex, MailViewConstants.kViewItemUnread);</span>
<a href="#l12.76"></a><span id="l12.76"> </span>
<a href="#l12.77"></a><span id="l12.77">   // close, re-open and verify it took</span>
<a href="#l12.78"></a><span id="l12.78">   viewWrapper.close();</span>
<a href="#l12.79"></a><span id="l12.79">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-  do_check_eq(viewWrapper.mailViewIndex, MailViewConstants.kViewItemUnread);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+  Assert.equal(viewWrapper.mailViewIndex, MailViewConstants.kViewItemUnread);</span>
<a href="#l12.82"></a><span id="l12.82"> </span>
<a href="#l12.83"></a><span id="l12.83">   // close, turn off the mailview usage indication by the listener...</span>
<a href="#l12.84"></a><span id="l12.84">   viewWrapper.close();</span>
<a href="#l12.85"></a><span id="l12.85">   gMockViewWrapperListener.shouldUseMailViews = false;</span>
<a href="#l12.86"></a><span id="l12.86">   // ...open and verify that it did not take!</span>
<a href="#l12.87"></a><span id="l12.87">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-  do_check_eq(viewWrapper.mailViewIndex, MailViewConstants.kViewItemAll);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+  Assert.equal(viewWrapper.mailViewIndex, MailViewConstants.kViewItemAll);</span>
<a href="#l12.90"></a><span id="l12.90"> </span>
<a href="#l12.91"></a><span id="l12.91">   // put the mailview setting back so other tests work</span>
<a href="#l12.92"></a><span id="l12.92">   gMockViewWrapperListener.shouldUseMailViews = true;</span>
<a href="#l12.93"></a><span id="l12.93"> }</span>
<a href="#l12.94"></a><span id="l12.94"> </span>
<a href="#l12.95"></a><span id="l12.95"> /**</span>
<a href="#l12.96"></a><span id="l12.96">  * Make sure:</span>
<a href="#l12.97"></a><span id="l12.97">  * - View update depth increments / decrements as expected, and triggers a</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineat">@@ -270,38 +270,38 @@ function test_view_update_depth_logic() </span>
<a href="#l12.99"></a><span id="l12.99">   let viewWrapper = make_view_wrapper();</span>
<a href="#l12.100"></a><span id="l12.100"> </span>
<a href="#l12.101"></a><span id="l12.101">   // create an instance-specific dummy method that counts calls t</span>
<a href="#l12.102"></a><span id="l12.102">   //  _applyViewChanges</span>
<a href="#l12.103"></a><span id="l12.103">   let applyViewCount = 0;</span>
<a href="#l12.104"></a><span id="l12.104">   viewWrapper._applyViewChanges = function() { applyViewCount++; };</span>
<a href="#l12.105"></a><span id="l12.105"> </span>
<a href="#l12.106"></a><span id="l12.106">   // - view update depth basics</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.109"></a><span id="l12.109">   viewWrapper.beginViewUpdate();</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 1);</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 1);</span>
<a href="#l12.112"></a><span id="l12.112">   viewWrapper.beginViewUpdate();</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 2);</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 2);</span>
<a href="#l12.115"></a><span id="l12.115">   viewWrapper.endViewUpdate();</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-  do_check_eq(applyViewCount, 0);</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 1);</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+  Assert.equal(applyViewCount, 0);</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 1);</span>
<a href="#l12.120"></a><span id="l12.120">   viewWrapper.endViewUpdate();</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineminus">-  do_check_eq(applyViewCount, 1);</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+  Assert.equal(applyViewCount, 1);</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.125"></a><span id="l12.125"> </span>
<a href="#l12.126"></a><span id="l12.126">   // - don't go below zero! (and don't trigger.)</span>
<a href="#l12.127"></a><span id="l12.127">   applyViewCount = 0;</span>
<a href="#l12.128"></a><span id="l12.128">   viewWrapper.endViewUpdate();</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-  do_check_eq(applyViewCount, 0);</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+  Assert.equal(applyViewCount, 0);</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.133"></a><span id="l12.133"> </span>
<a href="#l12.134"></a><span id="l12.134">   // - depth zeroed on clear</span>
<a href="#l12.135"></a><span id="l12.135">   viewWrapper.beginViewUpdate();</span>
<a href="#l12.136"></a><span id="l12.136">   viewWrapper.close(); // this does little else because there is nothing open</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-  do_check_eq(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+  Assert.equal(viewWrapper._viewUpdateDepth, 0);</span>
<a href="#l12.139"></a><span id="l12.139"> }</span>
<a href="#l12.140"></a><span id="l12.140"> </span>
<a href="#l12.141"></a><span id="l12.141"> var tests = [</span>
<a href="#l12.142"></a><span id="l12.142">   test_threading_grouping_mutual_exclusion,</span>
<a href="#l12.143"></a><span id="l12.143">   test_threads_special_views_mutual_exclusion,</span>
<a href="#l12.144"></a><span id="l12.144">   test_sort_primary,</span>
<a href="#l12.145"></a><span id="l12.145">   test_sort_secondary_explicit,</span>
<a href="#l12.146"></a><span id="l12.146">   test_sort_secondary_implicit,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolder.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolder.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -28,17 +28,17 @@ initViewWrapperTestUtils();</span>
<a href="#l13.4"></a><span id="l13.4"> function* test_virtual_folder_single_load_no_pred() {</span>
<a href="#l13.5"></a><span id="l13.5">   let viewWrapper = make_view_wrapper();</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">   let [folderOne, setOne] = make_folder_with_sets(1);</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">   let virtFolder = make_virtual_folder([folderOne], {});</span>
<a href="#l13.10"></a><span id="l13.10">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  do_check_true(viewWrapper.isVirtual);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  Assert.ok(viewWrapper.isVirtual);</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15">   assert_equals(gMockViewWrapperListener.allMessagesLoadedEventCount, 1,</span>
<a href="#l13.16"></a><span id="l13.16">                 &quot;Should only have received a single all messages loaded&quot; +</span>
<a href="#l13.17"></a><span id="l13.17">                 &quot; notification!&quot;);</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">   verify_messages_in_view(setOne, viewWrapper);</span>
<a href="#l13.20"></a><span id="l13.20">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l13.21"></a><span id="l13.21"> }</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -327,17 +327,17 @@ function* test_virtual_folder_underlying</span>
<a href="#l13.23"></a><span id="l13.23">   // only messages from the surviving folder should be present</span>
<a href="#l13.24"></a><span id="l13.24">   verify_messages_in_view([twoSubjFoo], viewWrapper);</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">   // this one is not async though, because we are expecting to close the wrapper</span>
<a href="#l13.27"></a><span id="l13.27">   //  and ignore the view entirely, so do not yield.</span>
<a href="#l13.28"></a><span id="l13.28">   delete_folder(folderTwo);</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">   // now the view wrapper should have closed itself.</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  do_check_eq(null, viewWrapper.displayedFolder);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  Assert.equal(null, viewWrapper.displayedFolder);</span>
<a href="#l13.33"></a><span id="l13.33">   // This fails because virtFolder.parent is null, not sure why</span>
<a href="#l13.34"></a><span id="l13.34">   //virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l13.35"></a><span id="l13.35"> }</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37"> /* ===== Virtual Folder, Mail Views ===== */</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39"> /*</span>
<a href="#l13.40"></a><span id="l13.40">  * We do not need to test all of the mail view permutations, realFolder</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/base/test/unit/test_windows_font_migration.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/base/test/unit/test_windows_font_migration.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -61,23 +61,23 @@ function makeVerifier(aFonts) {</span>
<a href="#l14.4"></a><span id="l14.4">       let nonDefaultKey = key + (aFonts.migrated ? &quot;&quot; : &quot;Non&quot;) + &quot;Migrated&quot;;</span>
<a href="#l14.5"></a><span id="l14.5">       expectedFonts[key] = (nonDefaultKey in aNonDefaultFonts ?</span>
<a href="#l14.6"></a><span id="l14.6">                             aNonDefaultFonts[nonDefaultKey] :</span>
<a href="#l14.7"></a><span id="l14.7">                             aFonts[key]);</span>
<a href="#l14.8"></a><span id="l14.8">     }</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">     // A distinct lack of magic here, so that failing stuff is generally easier</span>
<a href="#l14.11"></a><span id="l14.11">     // to comment out and debug.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    do_check_eq(getFont(&quot;serif&quot;, aEncoding), expectedFonts.serif);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    do_check_eq(getFont(&quot;sans-serif&quot;, aEncoding), expectedFonts.sans);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-    do_check_eq(getFont(&quot;monospace&quot;, aEncoding), expectedFonts.monospace);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(&quot;font.size.variable.&quot; + aEncoding),</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-                expectedFonts.variableSize);</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(&quot;font.size.fixed.&quot; + aEncoding),</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-                expectedFonts.fixedSize);</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+    Assert.equal(getFont(&quot;serif&quot;, aEncoding), expectedFonts.serif);</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+    Assert.equal(getFont(&quot;sans-serif&quot;, aEncoding), expectedFonts.sans);</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+    Assert.equal(getFont(&quot;monospace&quot;, aEncoding), expectedFonts.monospace);</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(&quot;font.size.variable.&quot; + aEncoding),</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+                 expectedFonts.variableSize);</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(&quot;font.size.fixed.&quot; + aEncoding),</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+                 expectedFonts.fixedSize);</span>
<a href="#l14.26"></a><span id="l14.26">   }</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28">   return verifier;</span>
<a href="#l14.29"></a><span id="l14.29"> }</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31"> /**</span>
<a href="#l14.32"></a><span id="l14.32">  * Verifier function for non-ClearType fonts.</span>
<a href="#l14.33"></a><span id="l14.33">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/test/unit/test_about_support.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/test/unit/test_about_support.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -102,84 +102,84 @@ function setup_accounts() {</span>
<a href="#l15.4"></a><span id="l15.4"> /**</span>
<a href="#l15.5"></a><span id="l15.5">  * Verify that the given account's details match our details for the key.</span>
<a href="#l15.6"></a><span id="l15.6">  */</span>
<a href="#l15.7"></a><span id="l15.7"> function verify_account_details(aDetails) {</span>
<a href="#l15.8"></a><span id="l15.8">   let expectedDetails = gAccountMap[aDetails.key];</span>
<a href="#l15.9"></a><span id="l15.9">   // All our servers are at localhost</span>
<a href="#l15.10"></a><span id="l15.10">   let expectedHostDetails = &quot;(&quot; + expectedDetails.type + &quot;) localhost:&quot; +</span>
<a href="#l15.11"></a><span id="l15.11">     expectedDetails.port;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  do_check_eq(aDetails.hostDetails, expectedHostDetails);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  do_check_eq(aDetails.socketType, expectedDetails.socketType);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  do_check_eq(aDetails.authMethod, expectedDetails.authMethod);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  Assert.equal(aDetails.hostDetails, expectedHostDetails);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  Assert.equal(aDetails.socketType, expectedDetails.socketType);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  Assert.equal(aDetails.authMethod, expectedDetails.authMethod);</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   let smtpToSee = expectedDetails.smtpServers.map(smtpDetails =&gt;</span>
<a href="#l15.20"></a><span id="l15.20">                     &quot;localhost:&quot; + smtpDetails.port);</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">   for (let smtpDetails of aDetails.smtpServers) {</span>
<a href="#l15.23"></a><span id="l15.23">     // Check that we're expecting to see this server</span>
<a href="#l15.24"></a><span id="l15.24">     let toSeeIndex = smtpToSee.indexOf(smtpDetails.name);</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-    do_check_neq(toSeeIndex, -1);</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+    Assert.notEqual(toSeeIndex, -1);</span>
<a href="#l15.27"></a><span id="l15.27">     smtpToSee.splice(toSeeIndex, 1);</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">     let expectedSMTPDetails = gSMTPMap[smtpDetails.name];</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-    do_check_eq(smtpDetails.socketType, expectedSMTPDetails.socketType);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-    do_check_eq(smtpDetails.authMethod, expectedSMTPDetails.authMethod);</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-    do_check_eq(smtpDetails.isDefault, expectedSMTPDetails.isDefault);</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+    Assert.equal(smtpDetails.socketType, expectedSMTPDetails.socketType);</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    Assert.equal(smtpDetails.authMethod, expectedSMTPDetails.authMethod);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+    Assert.equal(smtpDetails.isDefault, expectedSMTPDetails.isDefault);</span>
<a href="#l15.36"></a><span id="l15.36">   }</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38">   // Check that we saw all the SMTP servers we wanted to see</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-  do_check_eq(smtpToSee.length, 0);</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+  Assert.equal(smtpToSee.length, 0);</span>
<a href="#l15.41"></a><span id="l15.41"> }</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43"> /**</span>
<a href="#l15.44"></a><span id="l15.44">  * Tests the getFileSystemType function. This is more a check to make sure the</span>
<a href="#l15.45"></a><span id="l15.45">  * function returns something meaningful and doesn't throw an exception, since</span>
<a href="#l15.46"></a><span id="l15.46">  * we don't have any information about what sort of file system we're running</span>
<a href="#l15.47"></a><span id="l15.47">  * on.</span>
<a href="#l15.48"></a><span id="l15.48">  */</span>
<a href="#l15.49"></a><span id="l15.49"> function test_get_file_system_type() {</span>
<a href="#l15.50"></a><span id="l15.50">   let fsType = AboutSupportPlatform.getFileSystemType(do_get_cwd());</span>
<a href="#l15.51"></a><span id="l15.51">   if (&quot;nsILocalFileMac&quot; in Ci) {</span>
<a href="#l15.52"></a><span id="l15.52">     // Mac should return null</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-    do_check_eq(fsType, null);</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+    Assert.equal(fsType, null);</span>
<a href="#l15.55"></a><span id="l15.55">   } else {</span>
<a href="#l15.56"></a><span id="l15.56">     // Windows and Linux should return a string</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-    do_check_true([&quot;local&quot;, &quot;network&quot;, &quot;unknown&quot;].includes(fsType));</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+    Assert.ok([&quot;local&quot;, &quot;network&quot;, &quot;unknown&quot;].includes(fsType));</span>
<a href="#l15.59"></a><span id="l15.59">   }</span>
<a href="#l15.60"></a><span id="l15.60"> }</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62"> /**</span>
<a href="#l15.63"></a><span id="l15.63">  * Test the getAccountDetails function.</span>
<a href="#l15.64"></a><span id="l15.64">  */</span>
<a href="#l15.65"></a><span id="l15.65"> function test_get_account_details() {</span>
<a href="#l15.66"></a><span id="l15.66">   let accountDetails = AboutSupport.getAccountDetails();</span>
<a href="#l15.67"></a><span id="l15.67">   let accountDetailsText = uneval(accountDetails);</span>
<a href="#l15.68"></a><span id="l15.68">   // The list of accounts we are looking for</span>
<a href="#l15.69"></a><span id="l15.69">   let accountsToSee = Object.keys(gAccountMap);</span>
<a href="#l15.70"></a><span id="l15.70"> </span>
<a href="#l15.71"></a><span id="l15.71">   // Our first check is to see that no sensitive data has crept in</span>
<a href="#l15.72"></a><span id="l15.72">   for (let data of gSensitiveData)</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-    do_check_false(accountDetailsText.includes(data));</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+    Assert.ok(!accountDetailsText.includes(data));</span>
<a href="#l15.75"></a><span id="l15.75"> </span>
<a href="#l15.76"></a><span id="l15.76">   for (let details of accountDetails) {</span>
<a href="#l15.77"></a><span id="l15.77">     // We're going to make one exception: for the local folders server. We don't</span>
<a href="#l15.78"></a><span id="l15.78">     // care too much about its details.</span>
<a href="#l15.79"></a><span id="l15.79">     if (details.key == localAccountUtils.msgAccount.key)</span>
<a href="#l15.80"></a><span id="l15.80">       continue;</span>
<a href="#l15.81"></a><span id="l15.81"> </span>
<a href="#l15.82"></a><span id="l15.82">     // Check that we're expecting to see this server</span>
<a href="#l15.83"></a><span id="l15.83">     let toSeeIndex = accountsToSee.indexOf(details.key);</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-    do_check_neq(toSeeIndex, -1);</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+    Assert.notEqual(toSeeIndex, -1);</span>
<a href="#l15.86"></a><span id="l15.86">     accountsToSee.splice(toSeeIndex, 1);</span>
<a href="#l15.87"></a><span id="l15.87"> </span>
<a href="#l15.88"></a><span id="l15.88">     verify_account_details(details);</span>
<a href="#l15.89"></a><span id="l15.89">   }</span>
<a href="#l15.90"></a><span id="l15.90">   // Check that we got all the accounts we wanted to see</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-  do_check_eq(accountsToSee.length, 0);</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+  Assert.equal(accountsToSee.length, 0);</span>
<a href="#l15.93"></a><span id="l15.93"> }</span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95"> var tests = [</span>
<a href="#l15.96"></a><span id="l15.96">   test_get_file_system_type,</span>
<a href="#l15.97"></a><span id="l15.97">   test_get_account_details,</span>
<a href="#l15.98"></a><span id="l15.98"> ];</span>
<a href="#l15.99"></a><span id="l15.99"> </span>
<a href="#l15.100"></a><span id="l15.100"> function run_test() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_basic_nsIAbCard.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -22,119 +22,119 @@ function run_test() {</span>
<a href="#l16.4"></a><span id="l16.4">   // Test - Set First, Last and Display Names and Email Address</span>
<a href="#l16.5"></a><span id="l16.5">   // via setProperty, and check correctly saved via their</span>
<a href="#l16.6"></a><span id="l16.6">   // attributes. We're using firstName to check UTF-8 values.</span>
<a href="#l16.7"></a><span id="l16.7">   card.setProperty(&quot;FirstName&quot;, kFNValue);</span>
<a href="#l16.8"></a><span id="l16.8">   card.setProperty(&quot;LastName&quot;, kLNValue);</span>
<a href="#l16.9"></a><span id="l16.9">   card.setProperty(&quot;DisplayName&quot;, kDNValue);</span>
<a href="#l16.10"></a><span id="l16.10">   card.setProperty(&quot;PrimaryEmail&quot;, kEmailValue);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  do_check_eq(card.firstName, kFNValue);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  do_check_eq(card.lastName, kLNValue);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-  do_check_eq(card.displayName, kDNValue);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  do_check_eq(card.primaryEmail, kEmailValue);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+  Assert.equal(card.firstName, kFNValue);</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+  Assert.equal(card.lastName, kLNValue);</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+  Assert.equal(card.displayName, kDNValue);</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+  Assert.equal(card.primaryEmail, kEmailValue);</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">   // Repeat in the opposite order.</span>
<a href="#l16.22"></a><span id="l16.22">   card.firstName = kFNValue;</span>
<a href="#l16.23"></a><span id="l16.23">   card.lastName = kLNValue;</span>
<a href="#l16.24"></a><span id="l16.24">   card.displayName = kDNValue;</span>
<a href="#l16.25"></a><span id="l16.25">   card.primaryEmail = kEmailValue;</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-  do_check_eq(card.getProperty(&quot;FirstName&quot;, &quot;BAD&quot;), kFNValue);</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-  do_check_eq(card.getProperty(&quot;LastName&quot;, &quot;BAD&quot;), kLNValue);</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-  do_check_eq(card.getProperty(&quot;DisplayName&quot;, &quot;BAD&quot;), kDNValue);</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-  do_check_eq(card.getProperty(&quot;PrimaryEmail&quot;, &quot;BAD&quot;), kEmailValue);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+  Assert.equal(card.getProperty(&quot;FirstName&quot;, &quot;BAD&quot;), kFNValue);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+  Assert.equal(card.getProperty(&quot;LastName&quot;, &quot;BAD&quot;), kLNValue);</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+  Assert.equal(card.getProperty(&quot;DisplayName&quot;, &quot;BAD&quot;), kDNValue);</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+  Assert.equal(card.getProperty(&quot;PrimaryEmail&quot;, &quot;BAD&quot;), kEmailValue);</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36">   // Test - generateName. Note: if the addressBook.properties</span>
<a href="#l16.37"></a><span id="l16.37">   // value changes, this will affect these tests.</span>
<a href="#l16.38"></a><span id="l16.38"> </span>
<a href="#l16.39"></a><span id="l16.39">   // Add a company name, so we can test fallback to company name.</span>
<a href="#l16.40"></a><span id="l16.40">   card.setProperty(&quot;Company&quot;, kCompanyValue);</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-  do_check_eq(card.generateName(0), kDNValue);</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-  do_check_eq(card.generateName(1), kLNValue + &quot;, &quot; + kFNValue);</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-  do_check_eq(card.generateName(2), kFNValue + &quot; &quot; + kLNValue);</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+  Assert.equal(card.generateName(0), kDNValue);</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+  Assert.equal(card.generateName(1), kLNValue + &quot;, &quot; + kFNValue);</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+  Assert.equal(card.generateName(2), kFNValue + &quot; &quot; + kLNValue);</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49">   // Test - generateName, with missing items.</span>
<a href="#l16.50"></a><span id="l16.50"> </span>
<a href="#l16.51"></a><span id="l16.51">   card.displayName = &quot;&quot;;</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-  do_check_eq(card.generateName(0), kCompanyValue);</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+  Assert.equal(card.generateName(0), kCompanyValue);</span>
<a href="#l16.54"></a><span id="l16.54"> </span>
<a href="#l16.55"></a><span id="l16.55">   card.deleteProperty(&quot;Company&quot;);</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-  do_check_eq(card.generateName(0), kEmailReducedValue);</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+  Assert.equal(card.generateName(0), kEmailReducedValue);</span>
<a href="#l16.58"></a><span id="l16.58"> </span>
<a href="#l16.59"></a><span id="l16.59">   // Reset company name for the first/last name tests.</span>
<a href="#l16.60"></a><span id="l16.60">   card.setProperty(&quot;Company&quot;, kCompanyValue);</span>
<a href="#l16.61"></a><span id="l16.61"> </span>
<a href="#l16.62"></a><span id="l16.62">   card.firstName = &quot;&quot;;</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-  do_check_eq(card.generateName(1), kLNValue);</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-  do_check_eq(card.generateName(2), kLNValue);</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+  Assert.equal(card.generateName(1), kLNValue);</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+  Assert.equal(card.generateName(2), kLNValue);</span>
<a href="#l16.67"></a><span id="l16.67"> </span>
<a href="#l16.68"></a><span id="l16.68">   card.firstName = kFNValue;</span>
<a href="#l16.69"></a><span id="l16.69">   card.lastName = &quot;&quot;;</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-  do_check_eq(card.generateName(1), kFNValue);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-  do_check_eq(card.generateName(2), kFNValue);</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+  Assert.equal(card.generateName(1), kFNValue);</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+  Assert.equal(card.generateName(2), kFNValue);</span>
<a href="#l16.74"></a><span id="l16.74"> </span>
<a href="#l16.75"></a><span id="l16.75">   card.firstName = &quot;&quot;;</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-  do_check_eq(card.generateName(1), kCompanyValue);</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-  do_check_eq(card.generateName(2), kCompanyValue);</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+  Assert.equal(card.generateName(1), kCompanyValue);</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+  Assert.equal(card.generateName(2), kCompanyValue);</span>
<a href="#l16.80"></a><span id="l16.80"> </span>
<a href="#l16.81"></a><span id="l16.81">   card.deleteProperty(&quot;Company&quot;);</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineminus">-  do_check_eq(card.generateName(1), kEmailReducedValue);</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-  do_check_eq(card.generateName(2), kEmailReducedValue);</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+  Assert.equal(card.generateName(1), kEmailReducedValue);</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+  Assert.equal(card.generateName(2), kEmailReducedValue);</span>
<a href="#l16.86"></a><span id="l16.86"> </span>
<a href="#l16.87"></a><span id="l16.87">   card.primaryEmail = &quot;&quot;;</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-  do_check_eq(card.generateName(1), &quot;&quot;);</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-  do_check_eq(card.generateName(2), &quot;&quot;);</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+  Assert.equal(card.generateName(1), &quot;&quot;);</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+  Assert.equal(card.generateName(2), &quot;&quot;);</span>
<a href="#l16.92"></a><span id="l16.92"> </span>
<a href="#l16.93"></a><span id="l16.93">   // Test - generateNameWithBundle, most of this will have</span>
<a href="#l16.94"></a><span id="l16.94">   // been tested above.</span>
<a href="#l16.95"></a><span id="l16.95"> </span>
<a href="#l16.96"></a><span id="l16.96">   card.firstName = kFNValue;</span>
<a href="#l16.97"></a><span id="l16.97">   card.lastName = kLNValue;</span>
<a href="#l16.98"></a><span id="l16.98"> </span>
<a href="#l16.99"></a><span id="l16.99">   let bundle = Services.strings.createBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;);</span>
<a href="#l16.100"></a><span id="l16.100"> </span>
<a href="#l16.101"></a><span id="l16.101" class="difflineminus">-  do_check_eq(card.generateName(1, bundle), kLNValue + &quot;, &quot; + kFNValue);</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+  Assert.equal(card.generateName(1, bundle), kLNValue + &quot;, &quot; + kFNValue);</span>
<a href="#l16.103"></a><span id="l16.103"> </span>
<a href="#l16.104"></a><span id="l16.104">   // Test - generatePhoneticName</span>
<a href="#l16.105"></a><span id="l16.105"> </span>
<a href="#l16.106"></a><span id="l16.106">   card.setProperty(&quot;PhoneticFirstName&quot;, kFNValue);</span>
<a href="#l16.107"></a><span id="l16.107">   card.setProperty(&quot;PhoneticLastName&quot;, kLNValue);</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">-  do_check_eq(card.generatePhoneticName(false), kFNValue + kLNValue);</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineminus">-  do_check_eq(card.generatePhoneticName(true), kLNValue + kFNValue);</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+  Assert.equal(card.generatePhoneticName(false), kFNValue + kLNValue);</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+  Assert.equal(card.generatePhoneticName(true), kLNValue + kFNValue);</span>
<a href="#l16.112"></a><span id="l16.112"> </span>
<a href="#l16.113"></a><span id="l16.113">   card.setProperty(&quot;PhoneticLastName&quot;, &quot;&quot;);</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-  do_check_eq(card.generatePhoneticName(false), kFNValue);</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-  do_check_eq(card.generatePhoneticName(true), kFNValue);</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+  Assert.equal(card.generatePhoneticName(false), kFNValue);</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+  Assert.equal(card.generatePhoneticName(true), kFNValue);</span>
<a href="#l16.118"></a><span id="l16.118"> </span>
<a href="#l16.119"></a><span id="l16.119">   card.setProperty(&quot;PhoneticFirstName&quot;, &quot;&quot;);</span>
<a href="#l16.120"></a><span id="l16.120">   card.setProperty(&quot;PhoneticLastName&quot;, kLNValue);</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineminus">-  do_check_eq(card.generatePhoneticName(false), kLNValue);</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-  do_check_eq(card.generatePhoneticName(true), kLNValue);</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+  Assert.equal(card.generatePhoneticName(false), kLNValue);</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineplus">+  Assert.equal(card.generatePhoneticName(true), kLNValue);</span>
<a href="#l16.125"></a><span id="l16.125"> </span>
<a href="#l16.126"></a><span id="l16.126">   // Test - hasEmailAddress</span>
<a href="#l16.127"></a><span id="l16.127"> </span>
<a href="#l16.128"></a><span id="l16.128">   card.deleteProperty(&quot;PrimaryEmail&quot;);</span>
<a href="#l16.129"></a><span id="l16.129">   card.deleteProperty(&quot;SecondEmail&quot;);</span>
<a href="#l16.130"></a><span id="l16.130"> </span>
<a href="#l16.131"></a><span id="l16.131" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue), false);</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValueLC), false);</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue2), false);</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue), false);</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValueLC), false);</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue2), false);</span>
<a href="#l16.137"></a><span id="l16.137"> </span>
<a href="#l16.138"></a><span id="l16.138">   card.setProperty(&quot;PrimaryEmail&quot;, kEmailValue);</span>
<a href="#l16.139"></a><span id="l16.139"> </span>
<a href="#l16.140"></a><span id="l16.140" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue), true);</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValueLC), true);</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue2), false);</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue), true);</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValueLC), true);</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue2), false);</span>
<a href="#l16.146"></a><span id="l16.146"> </span>
<a href="#l16.147"></a><span id="l16.147">   card.setProperty(&quot;SecondEmail&quot;, kEmailValue2);</span>
<a href="#l16.148"></a><span id="l16.148"> </span>
<a href="#l16.149"></a><span id="l16.149" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue), true);</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValueLC), true);</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue2), true);</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue), true);</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValueLC), true);</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue2), true);</span>
<a href="#l16.155"></a><span id="l16.155"> </span>
<a href="#l16.156"></a><span id="l16.156">   card.deleteProperty(&quot;PrimaryEmail&quot;);</span>
<a href="#l16.157"></a><span id="l16.157"> </span>
<a href="#l16.158"></a><span id="l16.158" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue), false);</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValueLC), false);</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineminus">-  do_check_eq(card.hasEmailAddress(kEmailValue2), true);</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue), false);</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValueLC), false);</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineplus">+  Assert.equal(card.hasEmailAddress(kEmailValue2), true);</span>
<a href="#l16.164"></a><span id="l16.164"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_basic_nsIAbDirectory.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -29,81 +29,81 @@</span>
<a href="#l17.4"></a><span id="l17.4"> function check_ab(abConfig) {</span>
<a href="#l17.5"></a><span id="l17.5">   // Test - Get the directory</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">   let AB = MailServices.ab.getDirectory(abConfig.URI);</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">   // Test - Is it the right type?</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   if (abConfig.dirType == 2)</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    do_check_true(AB instanceof Components.interfaces.nsIAbMDBDirectory);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    Assert.ok(AB instanceof Components.interfaces.nsIAbMDBDirectory);</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">   // Test - Check attributes</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-  do_check_eq(AB.generateName(0), abConfig.dirName);</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-  do_check_eq(AB.propertiesChromeURI, kNormalPropertiesURI);</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-  do_check_eq(AB.readOnly, abConfig.readOnly);</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-  do_check_eq(AB.dirName, abConfig.dirName);</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-  do_check_eq(AB.dirType, abConfig.dirType);</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-  do_check_eq(AB.fileName, abConfig.fileName);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-  do_check_eq(AB.URI, abConfig.URI);</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-  do_check_eq(AB.position, abConfig.position);</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-  do_check_eq(AB.isMailList, false);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-  do_check_eq(AB.isRemote, false);</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-  do_check_eq(AB.isSecure, false);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-  do_check_eq(AB.supportsMailingLists, true);</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-  do_check_eq(AB.dirPrefId, abConfig.dirPrefID);</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  Assert.equal(AB.generateName(0), abConfig.dirName);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  Assert.equal(AB.propertiesChromeURI, kNormalPropertiesURI);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  Assert.equal(AB.readOnly, abConfig.readOnly);</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  Assert.equal(AB.dirName, abConfig.dirName);</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+  Assert.equal(AB.dirType, abConfig.dirType);</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+  Assert.equal(AB.fileName, abConfig.fileName);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+  Assert.equal(AB.URI, abConfig.URI);</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+  Assert.equal(AB.position, abConfig.position);</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+  Assert.equal(AB.isMailList, false);</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  Assert.equal(AB.isRemote, false);</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+  Assert.equal(AB.isSecure, false);</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+  Assert.equal(AB.supportsMailingLists, true);</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+  Assert.equal(AB.dirPrefId, abConfig.dirPrefID);</span>
<a href="#l17.43"></a><span id="l17.43"> </span>
<a href="#l17.44"></a><span id="l17.44">   // Test - autocomplete enable/disable</span>
<a href="#l17.45"></a><span id="l17.45"> </span>
<a href="#l17.46"></a><span id="l17.46">   // enable is the default</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-  do_check_eq(AB.useForAutocomplete(&quot;&quot;), true);</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+  Assert.equal(AB.useForAutocomplete(&quot;&quot;), true);</span>
<a href="#l17.49"></a><span id="l17.49"> </span>
<a href="#l17.50"></a><span id="l17.50">   Services.prefs.setBoolPref(&quot;mail.enable_autocomplete&quot;, false);</span>
<a href="#l17.51"></a><span id="l17.51"> </span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-  do_check_eq(AB.useForAutocomplete(&quot;&quot;), false);</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+  Assert.equal(AB.useForAutocomplete(&quot;&quot;), false);</span>
<a href="#l17.54"></a><span id="l17.54"> </span>
<a href="#l17.55"></a><span id="l17.55">   Services.prefs.setBoolPref(&quot;mail.enable_autocomplete&quot;, true);</span>
<a href="#l17.56"></a><span id="l17.56"> </span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-  do_check_eq(AB.useForAutocomplete(&quot;&quot;), true);</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+  Assert.equal(AB.useForAutocomplete(&quot;&quot;), true);</span>
<a href="#l17.59"></a><span id="l17.59"> </span>
<a href="#l17.60"></a><span id="l17.60">   // Test - check getting default preferences</span>
<a href="#l17.61"></a><span id="l17.61"> </span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-  do_check_eq(AB.getIntValue(&quot;random&quot;, 54321), 54321);</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-  do_check_eq(AB.getBoolValue(&quot;random&quot;, false), false);</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-  do_check_eq(AB.getStringValue(&quot;random&quot;, &quot;abc&quot;), &quot;abc&quot;);</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-  do_check_eq(AB.getLocalizedStringValue(&quot;random&quot;, &quot;xyz&quot;), &quot;xyz&quot;);</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+  Assert.equal(AB.getIntValue(&quot;random&quot;, 54321), 54321);</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+  Assert.equal(AB.getBoolValue(&quot;random&quot;, false), false);</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+  Assert.equal(AB.getStringValue(&quot;random&quot;, &quot;abc&quot;), &quot;abc&quot;);</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+  Assert.equal(AB.getLocalizedStringValue(&quot;random&quot;, &quot;xyz&quot;), &quot;xyz&quot;);</span>
<a href="#l17.70"></a><span id="l17.70"> </span>
<a href="#l17.71"></a><span id="l17.71"> </span>
<a href="#l17.72"></a><span id="l17.72">   // Test - check get/set int preferences on nsIAbDirectory</span>
<a href="#l17.73"></a><span id="l17.73"> </span>
<a href="#l17.74"></a><span id="l17.74">   AB.setIntValue(&quot;inttest&quot;, 12345);</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-  do_check_eq(Services.prefs.getIntPref(abConfig.dirPrefID + &quot;.inttest&quot;), 12345);</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-  do_check_eq(AB.getIntValue(&quot;inttest&quot;, -1), 12345);</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+  Assert.equal(Services.prefs.getIntPref(abConfig.dirPrefID + &quot;.inttest&quot;), 12345);</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+  Assert.equal(AB.getIntValue(&quot;inttest&quot;, -1), 12345);</span>
<a href="#l17.79"></a><span id="l17.79"> </span>
<a href="#l17.80"></a><span id="l17.80">   AB.setIntValue(&quot;inttest&quot;, 123456);</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-  do_check_eq(Services.prefs.getIntPref(abConfig.dirPrefID + &quot;.inttest&quot;), 123456);</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-  do_check_eq(AB.getIntValue(&quot;inttest&quot;, -2), 123456);</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+  Assert.equal(Services.prefs.getIntPref(abConfig.dirPrefID + &quot;.inttest&quot;), 123456);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+  Assert.equal(AB.getIntValue(&quot;inttest&quot;, -2), 123456);</span>
<a href="#l17.85"></a><span id="l17.85"> </span>
<a href="#l17.86"></a><span id="l17.86">   // Test - check get/set bool preferences on nsIAbDirectory</span>
<a href="#l17.87"></a><span id="l17.87"> </span>
<a href="#l17.88"></a><span id="l17.88">   AB.setBoolValue(&quot;booltest&quot;, true);</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-  do_check_eq(Services.prefs.getBoolPref(abConfig.dirPrefID + &quot;.booltest&quot;), true);</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-  do_check_eq(AB.getBoolValue(&quot;booltest&quot;, false), true);</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+  Assert.equal(Services.prefs.getBoolPref(abConfig.dirPrefID + &quot;.booltest&quot;), true);</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+  Assert.equal(AB.getBoolValue(&quot;booltest&quot;, false), true);</span>
<a href="#l17.93"></a><span id="l17.93"> </span>
<a href="#l17.94"></a><span id="l17.94">   AB.setBoolValue(&quot;booltest&quot;, false);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-  do_check_eq(Services.prefs.getBoolPref(abConfig.dirPrefID + &quot;.booltest&quot;), false);</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-  do_check_eq(AB.getBoolValue(&quot;booltest&quot;, true), false);</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+  Assert.equal(Services.prefs.getBoolPref(abConfig.dirPrefID + &quot;.booltest&quot;), false);</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+  Assert.equal(AB.getBoolValue(&quot;booltest&quot;, true), false);</span>
<a href="#l17.99"></a><span id="l17.99"> </span>
<a href="#l17.100"></a><span id="l17.100"> </span>
<a href="#l17.101"></a><span id="l17.101">   // Test - check get/set string preferences on nsIAbDirectory</span>
<a href="#l17.102"></a><span id="l17.102"> </span>
<a href="#l17.103"></a><span id="l17.103">   AB.setStringValue(&quot;stringtest&quot;, &quot;tyu&quot;);</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(abConfig.dirPrefID + &quot;.stringtest&quot;), &quot;tyu&quot;);</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-  do_check_eq(AB.getStringValue(&quot;stringtest&quot;, &quot;&quot;), &quot;tyu&quot;);</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(abConfig.dirPrefID + &quot;.stringtest&quot;), &quot;tyu&quot;);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+  Assert.equal(AB.getStringValue(&quot;stringtest&quot;, &quot;&quot;), &quot;tyu&quot;);</span>
<a href="#l17.108"></a><span id="l17.108"> }</span>
<a href="#l17.109"></a><span id="l17.109"> </span>
<a href="#l17.110"></a><span id="l17.110"> function run_test() {</span>
<a href="#l17.111"></a><span id="l17.111">   // Check the default personal address book</span>
<a href="#l17.112"></a><span id="l17.112">   check_ab(kPABData);</span>
<a href="#l17.113"></a><span id="l17.113"> </span>
<a href="#l17.114"></a><span id="l17.114">   // Check the default collected address book</span>
<a href="#l17.115"></a><span id="l17.115">   check_ab(kCABData);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_bug534822.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_bug534822.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -27,16 +27,16 @@ function run_test() {</span>
<a href="#l18.4"></a><span id="l18.4">     { name: kCABData.dirName, result: false }</span>
<a href="#l18.5"></a><span id="l18.5">   ];</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">   while (dirs.hasMoreElements()) {</span>
<a href="#l18.8"></a><span id="l18.8">     let dir = dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     for (let i = 0; i &lt; results.length; ++i) {</span>
<a href="#l18.11"></a><span id="l18.11">       if (results[i].name == dir.dirName) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-        do_check_false(results[i].result);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+        Assert.ok(!results[i].result);</span>
<a href="#l18.14"></a><span id="l18.14">         results[i].result = true;</span>
<a href="#l18.15"></a><span id="l18.15">       }</span>
<a href="#l18.16"></a><span id="l18.16">     }</span>
<a href="#l18.17"></a><span id="l18.17">   }</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-  results.forEach(function (result) { do_check_true(result.result); });</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+  results.forEach(function (result) { Assert.ok(result.result); });</span>
<a href="#l18.21"></a><span id="l18.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_bug_448165.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_bug_448165.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> /**</span>
<a href="#l19.5"></a><span id="l19.5">  * A simple test to check for a regression of bug 448165: Mailnews crashes in</span>
<a href="#l19.6"></a><span id="l19.6">  * nsAbMDBDirectory::DeleteCards if aCards is null</span>
<a href="#l19.7"></a><span id="l19.7">  */</span>
<a href="#l19.8"></a><span id="l19.8"> function run_test() {</span>
<a href="#l19.9"></a><span id="l19.9">   // get the Personal Address Book</span>
<a href="#l19.10"></a><span id="l19.10">   let pab = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">-  do_check_true(pab instanceof Ci.nsIAbDirectory);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+  Assert.ok(pab instanceof Ci.nsIAbDirectory);</span>
<a href="#l19.13"></a><span id="l19.13">   try {</span>
<a href="#l19.14"></a><span id="l19.14">     pab.deleteCards(null); // this should throw an error</span>
<a href="#l19.15"></a><span id="l19.15">     do_throw(&quot;Error, deleteCards should throw an error when null is passed to it&quot;);</span>
<a href="#l19.16"></a><span id="l19.16">   }</span>
<a href="#l19.17"></a><span id="l19.17">   catch (e) {</span>
<a href="#l19.18"></a><span id="l19.18">     // make sure the correct error message was thrown</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-    do_check_eq(e.result, Components.results.NS_ERROR_INVALID_POINTER);</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+    Assert.equal(e.result, Components.results.NS_ERROR_INVALID_POINTER);</span>
<a href="#l19.21"></a><span id="l19.21">   }</span>
<a href="#l19.22"></a><span id="l19.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -4,45 +4,45 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * - checks correct return when no email address supplied</span>
<a href="#l20.5"></a><span id="l20.5">  * - checks correct return when no matching email address supplied</span>
<a href="#l20.6"></a><span id="l20.6">  * - checks correct return when matching email address supplied.</span>
<a href="#l20.7"></a><span id="l20.7">  *</span>
<a href="#l20.8"></a><span id="l20.8">  * Uses: cardForEmail.mab</span>
<a href="#l20.9"></a><span id="l20.9">  */</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> function check_correct_card(card) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  do_check_neq(card, null);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  Assert.notEqual(card, null);</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-  do_check_eq(card.firstName, &quot;FirstName1&quot;);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-  do_check_eq(card.lastName, &quot;LastName1&quot;);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-  do_check_eq(card.displayName, &quot;DisplayName1&quot;);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-  do_check_eq(card.primaryEmail, &quot;PrimaryEmail1@test.invalid&quot;);</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-  do_check_eq(card.getProperty(&quot;SecondEmail&quot;, &quot;BAD&quot;), &quot;SecondEmail1\u00D0@test.invalid&quot;);</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+  Assert.equal(card.firstName, &quot;FirstName1&quot;);</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+  Assert.equal(card.lastName, &quot;LastName1&quot;);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+  Assert.equal(card.displayName, &quot;DisplayName1&quot;);</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+  Assert.equal(card.primaryEmail, &quot;PrimaryEmail1@test.invalid&quot;);</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+  Assert.equal(card.getProperty(&quot;SecondEmail&quot;, &quot;BAD&quot;), &quot;SecondEmail1\u00D0@test.invalid&quot;);</span>
<a href="#l20.25"></a><span id="l20.25"> }</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27"> function run_test() {</span>
<a href="#l20.28"></a><span id="l20.28">   // Test setup - copy the data file into place</span>
<a href="#l20.29"></a><span id="l20.29">   var testAB = do_get_file(&quot;data/cardForEmail.mab&quot;);</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31">   // Copy the file to the profile directory for a PAB</span>
<a href="#l20.32"></a><span id="l20.32">   testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l20.33"></a><span id="l20.33"> </span>
<a href="#l20.34"></a><span id="l20.34">   // Test - Get the directory</span>
<a href="#l20.35"></a><span id="l20.35">   let AB = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l20.36"></a><span id="l20.36"> </span>
<a href="#l20.37"></a><span id="l20.37">   // Test - Check that a null string succeeds and does not</span>
<a href="#l20.38"></a><span id="l20.38">   // return a card (bug 404264)</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-  do_check_true(AB.cardForEmailAddress(null) == null);</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+  Assert.ok(AB.cardForEmailAddress(null) == null);</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42">   // Test - Check that an empty string succeeds and does not</span>
<a href="#l20.43"></a><span id="l20.43">   // return a card (bug 404264)</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-  do_check_true(AB.cardForEmailAddress(&quot;&quot;) == null);</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+  Assert.ok(AB.cardForEmailAddress(&quot;&quot;) == null);</span>
<a href="#l20.46"></a><span id="l20.46"> </span>
<a href="#l20.47"></a><span id="l20.47">   // Test - Check that we don't match an email that doesn't exist</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-  do_check_true(AB.cardForEmailAddress(&quot;nocard@this.email.invalid&quot;) == null);</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+  Assert.ok(AB.cardForEmailAddress(&quot;nocard@this.email.invalid&quot;) == null);</span>
<a href="#l20.50"></a><span id="l20.50"> </span>
<a href="#l20.51"></a><span id="l20.51">   // Test - Check that we match this email and some of the fields</span>
<a href="#l20.52"></a><span id="l20.52">   // of the card are correct.</span>
<a href="#l20.53"></a><span id="l20.53">   var card = AB.cardForEmailAddress(&quot;PrimaryEmail1@test.invalid&quot;);</span>
<a href="#l20.54"></a><span id="l20.54"> </span>
<a href="#l20.55"></a><span id="l20.55">   check_correct_card(card);</span>
<a href="#l20.56"></a><span id="l20.56"> </span>
<a href="#l20.57"></a><span id="l20.57">   // Test - Check that we match with the primary email with insensitive case.</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineat">@@ -56,39 +56,39 @@ function run_test() {</span>
<a href="#l20.59"></a><span id="l20.59">   check_correct_card(card);</span>
<a href="#l20.60"></a><span id="l20.60"> </span>
<a href="#l20.61"></a><span id="l20.61">   // Test - Check that we match with the second email with insensitive case.</span>
<a href="#l20.62"></a><span id="l20.62">   card = AB.cardForEmailAddress(&quot;SECondEMail1\u00D0@TEST.inValid&quot;);</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64">   check_correct_card(card);</span>
<a href="#l20.65"></a><span id="l20.65"> </span>
<a href="#l20.66"></a><span id="l20.66">   // Check getCardFromProperty returns null correctly for non-extant properties</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-  do_check_eq(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;&quot;, false), null);</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-  do_check_eq(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle&quot;, false), null);</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+  Assert.equal(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;&quot;, false), null);</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+  Assert.equal(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle&quot;, false), null);</span>
<a href="#l20.71"></a><span id="l20.71"> </span>
<a href="#l20.72"></a><span id="l20.72">   // Check case-insensitive searching works</span>
<a href="#l20.73"></a><span id="l20.73">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle1&quot;, true);</span>
<a href="#l20.74"></a><span id="l20.74">   check_correct_card(card);</span>
<a href="#l20.75"></a><span id="l20.75">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle1&quot;, false);</span>
<a href="#l20.76"></a><span id="l20.76">   check_correct_card(card);</span>
<a href="#l20.77"></a><span id="l20.77"> </span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-  do_check_eq(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;jobtitle1&quot;, true), null);</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineplus">+  Assert.equal(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;jobtitle1&quot;, true), null);</span>
<a href="#l20.80"></a><span id="l20.80"> </span>
<a href="#l20.81"></a><span id="l20.81">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;jobtitle1&quot;, false);</span>
<a href="#l20.82"></a><span id="l20.82">   check_correct_card(card);</span>
<a href="#l20.83"></a><span id="l20.83"> </span>
<a href="#l20.84"></a><span id="l20.84">   var cards = AB.getCardsFromProperty(&quot;LastName&quot;, &quot;DOE&quot;, true);</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-  do_check_false(cards.hasMoreElements());</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+  Assert.ok(!cards.hasMoreElements());</span>
<a href="#l20.87"></a><span id="l20.87"> </span>
<a href="#l20.88"></a><span id="l20.88">   cards = AB.getCardsFromProperty(&quot;LastName&quot;, &quot;Doe&quot;, true);</span>
<a href="#l20.89"></a><span id="l20.89">   var i = 0;</span>
<a href="#l20.90"></a><span id="l20.90">   var data = [ 'John', 'Jane' ];</span>
<a href="#l20.91"></a><span id="l20.91"> </span>
<a href="#l20.92"></a><span id="l20.92">   while (cards.hasMoreElements()) {</span>
<a href="#l20.93"></a><span id="l20.93">     i++;</span>
<a href="#l20.94"></a><span id="l20.94">     card = cards.getNext().QueryInterface(Components.interfaces.nsIAbCard);</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-    do_check_eq(card.lastName, 'Doe');</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineplus">+    Assert.equal(card.lastName, 'Doe');</span>
<a href="#l20.97"></a><span id="l20.97">     var index = data.indexOf(card.firstName);</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-    do_check_neq(index, -1);</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineplus">+    Assert.notEqual(index, -1);</span>
<a href="#l20.100"></a><span id="l20.100">     delete data[index];</span>
<a href="#l20.101"></a><span id="l20.101">   }</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-  do_check_eq(i, 2);</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineplus">+  Assert.equal(i, 2);</span>
<a href="#l20.104"></a><span id="l20.104"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_collection.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_collection.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -223,32 +223,32 @@ var collectChecker = {</span>
<a href="#l21.4"></a><span id="l21.4">       throw &quot;FAILED in checkAll item: &quot; + i + &quot; : &quot; + e;</span>
<a href="#l21.5"></a><span id="l21.5">     }</span>
<a href="#l21.6"></a><span id="l21.6">   },</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">   checkCardResult : function (aDetails, overrideMailFormat) {</span>
<a href="#l21.9"></a><span id="l21.9">     try {</span>
<a href="#l21.10"></a><span id="l21.10">       var card = this.AB.cardForEmailAddress(aDetails.primaryEmail);</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      do_check_true(card != null);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+      Assert.ok(card != null);</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15">       if (&quot;secondEmail&quot; in aDetails)</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-        do_check_eq(card.getProperty(&quot;SecondEmail&quot;, &quot;BAD&quot;), aDetails.secondEmail);</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+        Assert.equal(card.getProperty(&quot;SecondEmail&quot;, &quot;BAD&quot;), aDetails.secondEmail);</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">       if (overrideMailFormat)</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-        do_check_eq(card.getProperty(&quot;PreferMailFormat&quot;, &quot;BAD&quot;), nsIAbPMF.unknown);</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+        Assert.equal(card.getProperty(&quot;PreferMailFormat&quot;, &quot;BAD&quot;), nsIAbPMF.unknown);</span>
<a href="#l21.22"></a><span id="l21.22">       else if (&quot;mailFormatOut&quot; in aDetails)</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-        do_check_eq(card.getProperty(&quot;PreferMailFormat&quot;, &quot;BAD&quot;), aDetails.mailFormatOut);</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+        Assert.equal(card.getProperty(&quot;PreferMailFormat&quot;, &quot;BAD&quot;), aDetails.mailFormatOut);</span>
<a href="#l21.25"></a><span id="l21.25">       else</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-        do_check_eq(card.getProperty(&quot;PreferMailFormat&quot;, &quot;BAD&quot;), aDetails.mailFormat);</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+        Assert.equal(card.getProperty(&quot;PreferMailFormat&quot;, &quot;BAD&quot;), aDetails.mailFormat);</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-      do_check_eq(card.displayName, aDetails.displayName);</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-      do_check_eq(card.firstName, aDetails.firstName);</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-      do_check_eq(card.lastName, aDetails.lastName);</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-      do_check_eq(card.getProperty(&quot;_AimScreenName&quot;, &quot;&quot;), aDetails.screenName);</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+      Assert.equal(card.displayName, aDetails.displayName);</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+      Assert.equal(card.firstName, aDetails.firstName);</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+      Assert.equal(card.lastName, aDetails.lastName);</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+      Assert.equal(card.getProperty(&quot;_AimScreenName&quot;, &quot;&quot;), aDetails.screenName);</span>
<a href="#l21.37"></a><span id="l21.37">     }</span>
<a href="#l21.38"></a><span id="l21.38">     catch (e) {</span>
<a href="#l21.39"></a><span id="l21.39">       throw &quot;FAILED in checkCardResult emailHeader: &quot; + aDetails.emailHeader + &quot; : &quot; + e;</span>
<a href="#l21.40"></a><span id="l21.40">     }</span>
<a href="#l21.41"></a><span id="l21.41">   }</span>
<a href="#l21.42"></a><span id="l21.42"> };</span>
<a href="#l21.43"></a><span id="l21.43"> </span>
<a href="#l21.44"></a><span id="l21.44"> function run_test()</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineat">@@ -270,29 +270,29 @@ function run_test()</span>
<a href="#l21.46"></a><span id="l21.46">               .getService(Components.interfaces.nsIAbAddressCollector);</span>
<a href="#l21.47"></a><span id="l21.47"> </span>
<a href="#l21.48"></a><span id="l21.48">   // Test - Addition of header without email address.</span>
<a href="#l21.49"></a><span id="l21.49"> </span>
<a href="#l21.50"></a><span id="l21.50">   collectChecker.addressCollect.collectAddress(&quot;MyTest &lt;&gt;&quot;, true,</span>
<a href="#l21.51"></a><span id="l21.51">                                                nsIAbPMF.unknown);</span>
<a href="#l21.52"></a><span id="l21.52"> </span>
<a href="#l21.53"></a><span id="l21.53">   // Address book should have no cards present.</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-  do_check_false(collectChecker.AB.childCards.hasMoreElements());</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+  Assert.ok(!collectChecker.AB.childCards.hasMoreElements());</span>
<a href="#l21.56"></a><span id="l21.56"> </span>
<a href="#l21.57"></a><span id="l21.57">   // Test - Email doesn't exist, but don't add it.</span>
<a href="#l21.58"></a><span id="l21.58"> </span>
<a href="#l21.59"></a><span id="l21.59">   // As we've just set everything up, we know we haven't got anything in the</span>
<a href="#l21.60"></a><span id="l21.60">   // AB, so just try and collect without adding.</span>
<a href="#l21.61"></a><span id="l21.61">   collectChecker.addressCollect.collectAddress(addEmailChecks[0].emailHeader,</span>
<a href="#l21.62"></a><span id="l21.62">                                                false,</span>
<a href="#l21.63"></a><span id="l21.63">                                                addEmailChecks[0].mailFormat);</span>
<a href="#l21.64"></a><span id="l21.64"> </span>
<a href="#l21.65"></a><span id="l21.65">   var card = collectChecker.AB.cardForEmailAddress(addEmailChecks[0].emailHeader);</span>
<a href="#l21.66"></a><span id="l21.66"> </span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-  do_check_true(card == null);</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+  Assert.ok(card == null);</span>
<a href="#l21.69"></a><span id="l21.69"> </span>
<a href="#l21.70"></a><span id="l21.70">   // Test - Try and collect various emails and formats.</span>
<a href="#l21.71"></a><span id="l21.71"> </span>
<a href="#l21.72"></a><span id="l21.72">   collectChecker.part = 0;</span>
<a href="#l21.73"></a><span id="l21.73"> </span>
<a href="#l21.74"></a><span id="l21.74">   addEmailChecks.forEach(collectChecker.checkAddress, collectChecker);</span>
<a href="#l21.75"></a><span id="l21.75"> </span>
<a href="#l21.76"></a><span id="l21.76">   // Test - Do all emails at the same time.</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineat">@@ -307,19 +307,19 @@ function run_test()</span>
<a href="#l21.78"></a><span id="l21.78"> </span>
<a href="#l21.79"></a><span id="l21.79">   collectChecker.AB.deleteCards(cardsToDelete);</span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81">   // Null these directly, so gc() will purge them</span>
<a href="#l21.82"></a><span id="l21.82">   childCards = null;</span>
<a href="#l21.83"></a><span id="l21.83">   cardsToDelete = null;</span>
<a href="#l21.84"></a><span id="l21.84"> </span>
<a href="#l21.85"></a><span id="l21.85">   // Address book should have no cards present.</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">-  do_check_false(collectChecker.AB.childCards.hasMoreElements());</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+  Assert.ok(!collectChecker.AB.childCards.hasMoreElements());</span>
<a href="#l21.88"></a><span id="l21.88"> </span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-  do_check_eq(collectChecker.AB.cardForEmailAddress(addEmailChecks[0].emailHeader), null);</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+  Assert.equal(collectChecker.AB.cardForEmailAddress(addEmailChecks[0].emailHeader), null);</span>
<a href="#l21.91"></a><span id="l21.91"> </span>
<a href="#l21.92"></a><span id="l21.92">   // Now do all emails at the same time.</span>
<a href="#l21.93"></a><span id="l21.93">   collectChecker.checkAll(addEmailChecks);</span>
<a href="#l21.94"></a><span id="l21.94"> </span>
<a href="#l21.95"></a><span id="l21.95">   // Test - Try and modify various emails and formats.</span>
<a href="#l21.96"></a><span id="l21.96"> </span>
<a href="#l21.97"></a><span id="l21.97">   // Add a basic card with just primary and second email to allow testing</span>
<a href="#l21.98"></a><span id="l21.98">   // of the case where we don't modify when second email is matching.</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineat">@@ -365,17 +365,17 @@ function run_test()</span>
<a href="#l21.100"></a><span id="l21.100"> </span>
<a href="#l21.101"></a><span id="l21.101">   while (childCards.hasMoreElements()) {</span>
<a href="#l21.102"></a><span id="l21.102">     var card = childCards.getNext();</span>
<a href="#l21.103"></a><span id="l21.103">     if (card instanceof Ci.nsIAbCard &amp;&amp;</span>
<a href="#l21.104"></a><span id="l21.104">         card.primaryEmail == kSingleAddress)</span>
<a href="#l21.105"></a><span id="l21.105">       foundCards.push(card);</span>
<a href="#l21.106"></a><span id="l21.106">   }</span>
<a href="#l21.107"></a><span id="l21.107"> </span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-  do_check_eq(foundCards.length, 2);</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineplus">+  Assert.equal(foundCards.length, 2);</span>
<a href="#l21.110"></a><span id="l21.110"> </span>
<a href="#l21.111"></a><span id="l21.111">   if (foundCards[0].displayName != kSingleDisplayName &amp;&amp;</span>
<a href="#l21.112"></a><span id="l21.112">       foundCards[1].displayName != kSingleDisplayName)</span>
<a href="#l21.113"></a><span id="l21.113">     do_throw(&quot;Error, collectSingleCard didn't create a new card&quot;);</span>
<a href="#l21.114"></a><span id="l21.114"> </span>
<a href="#l21.115"></a><span id="l21.115">   if (foundCards[0].displayName != &quot;&quot; &amp;&amp;</span>
<a href="#l21.116"></a><span id="l21.116">       foundCards[1].displayName != &quot;&quot;)</span>
<a href="#l21.117"></a><span id="l21.117">     do_throw(&quot;Error, collectSingleCard created ok, but other card does not exist&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_collection_2.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_collection_2.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -32,20 +32,20 @@ function run_test()</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">   addressCollect.collectAddress(&quot;Other Book &lt;other@book.invalid&gt;&quot;, true,</span>
<a href="#l22.6"></a><span id="l22.6">                                 nsIAbPMF.unknown);</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   let PAB = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">   var childCards = PAB.childCards;</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  do_check_true(childCards.hasMoreElements());</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  Assert.ok(childCards.hasMoreElements());</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15">   var card = childCards.getNext().QueryInterface(Components.interfaces.nsIAbCard);</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-  do_check_eq(card.displayName, &quot;Other Book&quot;);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-  do_check_eq(card.primaryEmail, &quot;other@book.invalid&quot;);</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+  Assert.equal(card.displayName, &quot;Other Book&quot;);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+  Assert.equal(card.primaryEmail, &quot;other@book.invalid&quot;);</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22">   // Check the CAB has no cards.</span>
<a href="#l22.23"></a><span id="l22.23">   let CAB = MailServices.ab.getDirectory(kCABData.URI);</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-  do_check_false(CAB.childCards.hasMoreElements());</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+  Assert.ok(!CAB.childCards.hasMoreElements());</span>
<a href="#l22.27"></a><span id="l22.27"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_ldap1.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_ldap1.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -16,24 +16,24 @@ function run_test() {</span>
<a href="#l23.4"></a><span id="l23.4">   // Test - Create an LDAP directory</span>
<a href="#l23.5"></a><span id="l23.5">   let abUri = MailServices.ab.newAddressBook(&quot;test&quot;, kLDAPTestSpec, kLDAPDirectory);</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">   // Test - Check we have the directory.</span>
<a href="#l23.8"></a><span id="l23.8">   let abDir = MailServices.ab.getDirectory(kLDAPUriPrefix + abUri)</span>
<a href="#l23.9"></a><span id="l23.9">                              .QueryInterface(Components.interfaces.nsIAbLDAPDirectory);</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">   // Test - Check various fields</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  do_check_eq(abDir.dirName, &quot;test&quot;);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-  do_check_eq(abDir.lDAPURL.spec, kLDAPTestSpec);</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-  do_check_true(abDir.readOnly);</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+  Assert.equal(abDir.dirName, &quot;test&quot;);</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+  Assert.equal(abDir.lDAPURL.spec, kLDAPTestSpec);</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+  Assert.ok(abDir.readOnly);</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">   // Test - Write a UTF-8 Auth DN and check it</span>
<a href="#l23.20"></a><span id="l23.20">   abDir.authDn = &quot;test\u00D0&quot;;</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-  do_check_eq(abDir.authDn, &quot;test\u00D0&quot;);</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineplus">+  Assert.equal(abDir.authDn, &quot;test\u00D0&quot;);</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25">   // Test - searchDuringLocalAutocomplete</span>
<a href="#l23.26"></a><span id="l23.26"> </span>
<a href="#l23.27"></a><span id="l23.27">   // Set up an account and identity in the account manager</span>
<a href="#l23.28"></a><span id="l23.28">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30">   const localAcTests =</span>
<a href="#l23.31"></a><span id="l23.31">     [</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineat">@@ -89,13 +89,13 @@ function run_test() {</span>
<a href="#l23.33"></a><span id="l23.33">   function checkAc(element, index, array) {</span>
<a href="#l23.34"></a><span id="l23.34">     dump(&quot;Testing index &quot; + index + &quot;\n&quot;);</span>
<a href="#l23.35"></a><span id="l23.35">     Services.prefs.setBoolPref(&quot;ldap_2.autoComplete.useDirectory&quot;, element.useDir);</span>
<a href="#l23.36"></a><span id="l23.36">     Services.prefs.setCharPref(&quot;ldap_2.autoComplete.directoryServer&quot;, element.dirSer);</span>
<a href="#l23.37"></a><span id="l23.37">     identity.overrideGlobalPref = element.idOver;</span>
<a href="#l23.38"></a><span id="l23.38">     identity.directoryServer = element.idSer;</span>
<a href="#l23.39"></a><span id="l23.39">     Services.io.offline = element.offline;</span>
<a href="#l23.40"></a><span id="l23.40"> </span>
<a href="#l23.41"></a><span id="l23.41" class="difflineminus">-    do_check_eq(abDir.useForAutocomplete(element.idKey), element.result);</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+    Assert.equal(abDir.useForAutocomplete(element.idKey), element.result);</span>
<a href="#l23.43"></a><span id="l23.43">   }</span>
<a href="#l23.44"></a><span id="l23.44"> </span>
<a href="#l23.45"></a><span id="l23.45">   localAcTests.forEach(checkAc);</span>
<a href="#l23.46"></a><span id="l23.46"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_ldap2.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_ldap2.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -21,18 +21,18 @@ function run_test() {</span>
<a href="#l24.4"></a><span id="l24.4">     MailServices.ab.newAddressBook(&quot;\u041C\u0435\u043B\u0435\u043D\u043A\u0438&quot;,</span>
<a href="#l24.5"></a><span id="l24.5">                                    kLDAPTestSpec, kLDAPDirectory);</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7">   // Test - Check we have the directory.</span>
<a href="#l24.8"></a><span id="l24.8">   let abDir = MailServices.ab.getDirectory(kLDAPUriPrefix + abUri)</span>
<a href="#l24.9"></a><span id="l24.9">                              .QueryInterface(Components.interfaces.nsIAbLDAPDirectory);</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11">   // Test - Check various fields</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  do_check_eq(abDir.dirName, &quot;\u041C\u0435\u043B\u0435\u043D\u043A\u0438&quot;);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-  do_check_eq(abDir.lDAPURL.spec, kLDAPTestSpec);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-  do_check_true(abDir.readOnly);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+  Assert.equal(abDir.dirName, &quot;\u041C\u0435\u043B\u0435\u043D\u043A\u0438&quot;);</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+  Assert.equal(abDir.lDAPURL.spec, kLDAPTestSpec);</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+  Assert.ok(abDir.readOnly);</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">   // XXX I'd really like a better check than this, to check that searching</span>
<a href="#l24.20"></a><span id="l24.20">   // works correctly. However we haven't got the support for that at the moment</span>
<a href="#l24.21"></a><span id="l24.21">   // and this at least ensures that we get a consistent ascii based preference</span>
<a href="#l24.22"></a><span id="l24.22">   // for the directory.</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-  do_check_eq(abDir.dirPrefId, &quot;ldap_2.servers._nonascii&quot;);</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+  Assert.equal(abDir.dirPrefId, &quot;ldap_2.servers._nonascii&quot;);</span>
<a href="#l24.25"></a><span id="l24.25"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_ldapOffline.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_ldapOffline.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -44,10 +44,10 @@ function run_test() {</span>
<a href="#l25.4"></a><span id="l25.4">   while (childCards.hasMoreElements())</span>
<a href="#l25.5"></a><span id="l25.5">   {</span>
<a href="#l25.6"></a><span id="l25.6">     // Make sure everything is an nsIAbCard.</span>
<a href="#l25.7"></a><span id="l25.7">     childCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">     ++count;</span>
<a href="#l25.10"></a><span id="l25.10">   }</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  do_check_eq(count, 4);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  Assert.equal(count, 4);</span>
<a href="#l25.14"></a><span id="l25.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_mailList1.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_mailList1.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -14,24 +14,24 @@ function checkLists(childNodes, number) </span>
<a href="#l26.4"></a><span id="l26.4">     mailListArray[i] = null;</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">   // See comment above for matching requirements</span>
<a href="#l26.7"></a><span id="l26.7">   while (childNodes.hasMoreElements()) {</span>
<a href="#l26.8"></a><span id="l26.8">     var list = childNodes.getNext();</span>
<a href="#l26.9"></a><span id="l26.9">     if (list instanceof Components.interfaces.nsIAbDirectory &amp;&amp;</span>
<a href="#l26.10"></a><span id="l26.10">         list.isMailList &amp;&amp; list.dirName.startsWith('TestList')) {</span>
<a href="#l26.11"></a><span id="l26.11">       var index = list.dirName.substr(8, list.dirName.length - 8);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-      do_check_eq(mailListArray[index - 1], null);</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-      do_check_eq(list.URI, kPABData.URI + &quot;/MailList&quot; + index);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+      Assert.equal(mailListArray[index - 1], null);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+      Assert.equal(list.URI, kPABData.URI + &quot;/MailList&quot; + index);</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">       mailListArray[index - 1] = list;</span>
<a href="#l26.18"></a><span id="l26.18">     }</span>
<a href="#l26.19"></a><span id="l26.19">   }</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-  mailListArray.forEach(function (value) { do_check_neq(value, null); });</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+  mailListArray.forEach(function (value) { Assert.notEqual(value, null); });</span>
<a href="#l26.23"></a><span id="l26.23"> }</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25"> function run_test() {</span>
<a href="#l26.26"></a><span id="l26.26">   // Create a new card</span>
<a href="#l26.27"></a><span id="l26.27">   // Test setup - copy the data file into place</span>
<a href="#l26.28"></a><span id="l26.28">   var testAB = do_get_file(&quot;../../../data/abLists1.mab&quot;);</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30">   // Copy the file to the profile directory for a PAB</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_notifications.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_notifications.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -7,25 +7,25 @@</span>
<a href="#l27.4"></a><span id="l27.4">  * - Editing a mailing list properties (name/nickname/notes)</span>
<a href="#l27.5"></a><span id="l27.5">  * - Adding, editing and deleting items in mailing lists</span>
<a href="#l27.6"></a><span id="l27.6">  */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> var abListener = {</span>
<a href="#l27.9"></a><span id="l27.9">   result: [],</span>
<a href="#l27.10"></a><span id="l27.10">   maxResults: 1,</span>
<a href="#l27.11"></a><span id="l27.11">   onItemAdded: function (parentItem, item) {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    do_check_true(this.result.length &lt; this.maxResults);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    Assert.ok(this.result.length &lt; this.maxResults);</span>
<a href="#l27.14"></a><span id="l27.14">     this.result.push([&quot;onItemAdded&quot;, parentItem, item]);</span>
<a href="#l27.15"></a><span id="l27.15">   },</span>
<a href="#l27.16"></a><span id="l27.16">   onItemRemoved: function (parentItem, item) {</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-    do_check_true(this.result.length &lt; this.maxResults);</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+    Assert.ok(this.result.length &lt; this.maxResults);</span>
<a href="#l27.19"></a><span id="l27.19">     this.result.push([&quot;onItemRemoved&quot;, parentItem, item]);</span>
<a href="#l27.20"></a><span id="l27.20">   },</span>
<a href="#l27.21"></a><span id="l27.21">   onItemPropertyChanged: function (item, property, oldValue, newValue) {</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">-    do_check_true(this.result.length &lt; this.maxResults);</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+    Assert.ok(this.result.length &lt; this.maxResults);</span>
<a href="#l27.24"></a><span id="l27.24">     this.result.push([&quot;onItemPropertyChanged&quot;, item, property, oldValue, newValue]);</span>
<a href="#l27.25"></a><span id="l27.25">   }</span>
<a href="#l27.26"></a><span id="l27.26"> };</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28"> function run_test() {</span>
<a href="#l27.29"></a><span id="l27.29">   var i;</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31">   // XXX Getting all directories ensures we create all ABs because the</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineat">@@ -46,47 +46,47 @@ function run_test() {</span>
<a href="#l27.33"></a><span id="l27.33">   var card = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;]</span>
<a href="#l27.34"></a><span id="l27.34">                .createInstance(Ci.nsIAbCard);</span>
<a href="#l27.35"></a><span id="l27.35"> </span>
<a href="#l27.36"></a><span id="l27.36">   card.firstName = &quot;test&quot;;</span>
<a href="#l27.37"></a><span id="l27.37">   card.primaryEmail = &quot;test@foo.invalid&quot;;</span>
<a href="#l27.38"></a><span id="l27.38"> </span>
<a href="#l27.39"></a><span id="l27.39">   var newCard = AB.addCard(card);</span>
<a href="#l27.40"></a><span id="l27.40"> </span>
<a href="#l27.41"></a><span id="l27.41" class="difflineminus">-  do_check_true(newCard instanceof Ci.nsIAbCard);</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">-  do_check_eq(abListener.result[0][0], &quot;onItemAdded&quot;);</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-  do_check_eq(abListener.result[0][1], AB);</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-  do_check_eq(abListener.result[0][2], newCard);</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+  Assert.ok(newCard instanceof Ci.nsIAbCard);</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineplus">+  Assert.equal(abListener.result[0][0], &quot;onItemAdded&quot;);</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineplus">+  Assert.equal(abListener.result[0][1], AB);</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+  Assert.equal(abListener.result[0][2], newCard);</span>
<a href="#l27.49"></a><span id="l27.49">   abListener.result = [];</span>
<a href="#l27.50"></a><span id="l27.50"> </span>
<a href="#l27.51"></a><span id="l27.51">   // Test - modify a card</span>
<a href="#l27.52"></a><span id="l27.52"> </span>
<a href="#l27.53"></a><span id="l27.53">   newCard.lastName = &quot;invalid&quot;;</span>
<a href="#l27.54"></a><span id="l27.54"> </span>
<a href="#l27.55"></a><span id="l27.55">   AB.modifyCard(newCard);</span>
<a href="#l27.56"></a><span id="l27.56"> </span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-  do_check_eq(abListener.result[0][0], &quot;onItemPropertyChanged&quot;);</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineminus">-  do_check_eq(abListener.result[0][1], newCard);</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineminus">-  do_check_eq(abListener.result[0][2], null);</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineminus">-  do_check_eq(abListener.result[0][3], null);</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineminus">-  do_check_eq(abListener.result[0][4], null);</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineplus">+  Assert.equal(abListener.result[0][0], &quot;onItemPropertyChanged&quot;);</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineplus">+  Assert.equal(abListener.result[0][1], newCard);</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineplus">+  Assert.equal(abListener.result[0][2], null);</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineplus">+  Assert.equal(abListener.result[0][3], null);</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineplus">+  Assert.equal(abListener.result[0][4], null);</span>
<a href="#l27.67"></a><span id="l27.67">   abListener.result = [];</span>
<a href="#l27.68"></a><span id="l27.68"> </span>
<a href="#l27.69"></a><span id="l27.69">   // Test - delete a card</span>
<a href="#l27.70"></a><span id="l27.70"> </span>
<a href="#l27.71"></a><span id="l27.71">   var cardsToDelete = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l27.72"></a><span id="l27.72">                         .createInstance(Ci.nsIMutableArray);</span>
<a href="#l27.73"></a><span id="l27.73"> </span>
<a href="#l27.74"></a><span id="l27.74">   cardsToDelete.appendElement(newCard);</span>
<a href="#l27.75"></a><span id="l27.75"> </span>
<a href="#l27.76"></a><span id="l27.76">   AB.deleteCards(cardsToDelete);</span>
<a href="#l27.77"></a><span id="l27.77"> </span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-  do_check_eq(abListener.result[0][0], &quot;onItemRemoved&quot;);</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-  do_check_eq(abListener.result[0][1], AB);</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-  do_check_eq(abListener.result[0][2], newCard);</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+  Assert.equal(abListener.result[0][0], &quot;onItemRemoved&quot;);</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineplus">+  Assert.equal(abListener.result[0][1], AB);</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+  Assert.equal(abListener.result[0][2], newCard);</span>
<a href="#l27.84"></a><span id="l27.84">   abListener.result = [];</span>
<a href="#l27.85"></a><span id="l27.85"> </span>
<a href="#l27.86"></a><span id="l27.86">   print(&quot;Finished Cards&quot;);</span>
<a href="#l27.87"></a><span id="l27.87"> </span>
<a href="#l27.88"></a><span id="l27.88">   // Test - add a mailing list</span>
<a href="#l27.89"></a><span id="l27.89"> </span>
<a href="#l27.90"></a><span id="l27.90">   var mailList = Cc[&quot;@mozilla.org/addressbook/directoryproperty;1&quot;]</span>
<a href="#l27.91"></a><span id="l27.91">                    .createInstance(Ci.nsIAbDirectory);</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineat">@@ -97,56 +97,56 @@ function run_test() {</span>
<a href="#l27.93"></a><span id="l27.93">   mailList.description = &quot;testdescription&quot;;</span>
<a href="#l27.94"></a><span id="l27.94"> </span>
<a href="#l27.95"></a><span id="l27.95">   // For mailing list addition, we expect 2 results, one for the card, one</span>
<a href="#l27.96"></a><span id="l27.96">   // for the directory</span>
<a href="#l27.97"></a><span id="l27.97">   abListener.maxResults = 2;</span>
<a href="#l27.98"></a><span id="l27.98"> </span>
<a href="#l27.99"></a><span id="l27.99">   AB.addMailList(mailList);</span>
<a href="#l27.100"></a><span id="l27.100">  </span>
<a href="#l27.101"></a><span id="l27.101" class="difflineminus">-  do_check_eq(abListener.result.length, 2);</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineminus">-  do_check_eq(abListener.result[0][0], &quot;onItemAdded&quot;);</span>
<a href="#l27.103"></a><span id="l27.103" class="difflineminus">-  do_check_eq(abListener.result[0][1], AB);</span>
<a href="#l27.104"></a><span id="l27.104" class="difflineminus">-  do_check_eq(abListener.result[1][0], &quot;onItemAdded&quot;);</span>
<a href="#l27.105"></a><span id="l27.105" class="difflineminus">-  do_check_eq(abListener.result[1][1], AB);</span>
<a href="#l27.106"></a><span id="l27.106" class="difflineplus">+  Assert.equal(abListener.result.length, 2);</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineplus">+  Assert.equal(abListener.result[0][0], &quot;onItemAdded&quot;);</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineplus">+  Assert.equal(abListener.result[0][1], AB);</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+  Assert.equal(abListener.result[1][0], &quot;onItemAdded&quot;);</span>
<a href="#l27.110"></a><span id="l27.110" class="difflineplus">+  Assert.equal(abListener.result[1][1], AB);</span>
<a href="#l27.111"></a><span id="l27.111"> </span>
<a href="#l27.112"></a><span id="l27.112">   // Now verify the card and the directory</span>
<a href="#l27.113"></a><span id="l27.113">   card = abListener.result[0][2].QueryInterface(Ci.nsIAbCard);</span>
<a href="#l27.114"></a><span id="l27.114" class="difflineminus">-  do_check_true(card.isMailList);</span>
<a href="#l27.115"></a><span id="l27.115" class="difflineminus">-  do_check_eq(card.displayName, &quot;TestList&quot;);</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-  do_check_eq(card.getProperty(&quot;Notes&quot;, &quot;BAD&quot;), &quot;testdescription&quot;);</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineminus">-  do_check_eq(card.getProperty(&quot;NickName&quot;, &quot;BAD&quot;), &quot;test&quot;);</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineplus">+  Assert.ok(card.isMailList);</span>
<a href="#l27.119"></a><span id="l27.119" class="difflineplus">+  Assert.equal(card.displayName, &quot;TestList&quot;);</span>
<a href="#l27.120"></a><span id="l27.120" class="difflineplus">+  Assert.equal(card.getProperty(&quot;Notes&quot;, &quot;BAD&quot;), &quot;testdescription&quot;);</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineplus">+  Assert.equal(card.getProperty(&quot;NickName&quot;, &quot;BAD&quot;), &quot;test&quot;);</span>
<a href="#l27.122"></a><span id="l27.122"> </span>
<a href="#l27.123"></a><span id="l27.123">   var book = abListener.result[1][2].QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l27.124"></a><span id="l27.124" class="difflineminus">-  do_check_true(book.isMailList);</span>
<a href="#l27.125"></a><span id="l27.125" class="difflineminus">-  do_check_eq(book.dirName, &quot;TestList&quot;);</span>
<a href="#l27.126"></a><span id="l27.126" class="difflineminus">-  do_check_eq(book.listNickName, &quot;test&quot;);</span>
<a href="#l27.127"></a><span id="l27.127" class="difflineminus">-  do_check_eq(book.description, &quot;testdescription&quot;);</span>
<a href="#l27.128"></a><span id="l27.128" class="difflineplus">+  Assert.ok(book.isMailList);</span>
<a href="#l27.129"></a><span id="l27.129" class="difflineplus">+  Assert.equal(book.dirName, &quot;TestList&quot;);</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineplus">+  Assert.equal(book.listNickName, &quot;test&quot;);</span>
<a href="#l27.131"></a><span id="l27.131" class="difflineplus">+  Assert.equal(book.description, &quot;testdescription&quot;);</span>
<a href="#l27.132"></a><span id="l27.132"> </span>
<a href="#l27.133"></a><span id="l27.133">   abListener.result = [];</span>
<a href="#l27.134"></a><span id="l27.134"> </span>
<a href="#l27.135"></a><span id="l27.135">   // Test - Remove a list.</span>
<a href="#l27.136"></a><span id="l27.136"> </span>
<a href="#l27.137"></a><span id="l27.137">   AB.deleteDirectory(book);</span>
<a href="#l27.138"></a><span id="l27.138"> </span>
<a href="#l27.139"></a><span id="l27.139" class="difflineminus">-  do_check_eq(abListener.result.length, 2);</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineminus">-  do_check_eq(abListener.result[0][0], &quot;onItemRemoved&quot;);</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineminus">-  do_check_eq(abListener.result[0][1], AB);</span>
<a href="#l27.142"></a><span id="l27.142" class="difflineminus">-  do_check_eq(abListener.result[1][0], &quot;onItemRemoved&quot;);</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineminus">-  do_check_eq(abListener.result[1][1], AB);</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineplus">+  Assert.equal(abListener.result.length, 2);</span>
<a href="#l27.145"></a><span id="l27.145" class="difflineplus">+  Assert.equal(abListener.result[0][0], &quot;onItemRemoved&quot;);</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineplus">+  Assert.equal(abListener.result[0][1], AB);</span>
<a href="#l27.147"></a><span id="l27.147" class="difflineplus">+  Assert.equal(abListener.result[1][0], &quot;onItemRemoved&quot;);</span>
<a href="#l27.148"></a><span id="l27.148" class="difflineplus">+  Assert.equal(abListener.result[1][1], AB);</span>
<a href="#l27.149"></a><span id="l27.149"> </span>
<a href="#l27.150"></a><span id="l27.150">   // Now verify the card and the directory</span>
<a href="#l27.151"></a><span id="l27.151">   card = abListener.result[0][2].QueryInterface(Ci.nsIAbCard);</span>
<a href="#l27.152"></a><span id="l27.152" class="difflineminus">-  do_check_true(card.isMailList);</span>
<a href="#l27.153"></a><span id="l27.153" class="difflineminus">-  do_check_eq(card.displayName, &quot;TestList&quot;);</span>
<a href="#l27.154"></a><span id="l27.154" class="difflineminus">-  do_check_eq(card.getProperty(&quot;Notes&quot;, &quot;BAD&quot;), &quot;testdescription&quot;);</span>
<a href="#l27.155"></a><span id="l27.155" class="difflineminus">-  do_check_eq(card.getProperty(&quot;NickName&quot;, &quot;BAD&quot;), &quot;test&quot;);</span>
<a href="#l27.156"></a><span id="l27.156" class="difflineplus">+  Assert.ok(card.isMailList);</span>
<a href="#l27.157"></a><span id="l27.157" class="difflineplus">+  Assert.equal(card.displayName, &quot;TestList&quot;);</span>
<a href="#l27.158"></a><span id="l27.158" class="difflineplus">+  Assert.equal(card.getProperty(&quot;Notes&quot;, &quot;BAD&quot;), &quot;testdescription&quot;);</span>
<a href="#l27.159"></a><span id="l27.159" class="difflineplus">+  Assert.equal(card.getProperty(&quot;NickName&quot;, &quot;BAD&quot;), &quot;test&quot;);</span>
<a href="#l27.160"></a><span id="l27.160"> </span>
<a href="#l27.161"></a><span id="l27.161">   var book = abListener.result[1][2].QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l27.162"></a><span id="l27.162" class="difflineminus">-  do_check_true(book.isMailList);</span>
<a href="#l27.163"></a><span id="l27.163" class="difflineminus">-  do_check_eq(book.dirName, &quot;TestList&quot;);</span>
<a href="#l27.164"></a><span id="l27.164" class="difflineminus">-  do_check_eq(book.listNickName, &quot;test&quot;);</span>
<a href="#l27.165"></a><span id="l27.165" class="difflineminus">-  do_check_eq(book.description, &quot;testdescription&quot;);</span>
<a href="#l27.166"></a><span id="l27.166" class="difflineplus">+  Assert.ok(book.isMailList);</span>
<a href="#l27.167"></a><span id="l27.167" class="difflineplus">+  Assert.equal(book.dirName, &quot;TestList&quot;);</span>
<a href="#l27.168"></a><span id="l27.168" class="difflineplus">+  Assert.equal(book.listNickName, &quot;test&quot;);</span>
<a href="#l27.169"></a><span id="l27.169" class="difflineplus">+  Assert.equal(book.description, &quot;testdescription&quot;);</span>
<a href="#l27.170"></a><span id="l27.170"> </span>
<a href="#l27.171"></a><span id="l27.171">   // Remove listener</span>
<a href="#l27.172"></a><span id="l27.172"> </span>
<a href="#l27.173"></a><span id="l27.173">   MailServices.ab.removeAddressBookListener(abListener);</span>
<a href="#l27.174"></a><span id="l27.174"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteMyDomain.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -37,86 +37,86 @@ function run_test() {</span>
<a href="#l28.4"></a><span id="l28.4">   // Set up autocomplete parameters</span>
<a href="#l28.5"></a><span id="l28.5">   let params = JSON.stringify({ idKey: identity.key, type: &quot;addr_to&quot; });</span>
<a href="#l28.6"></a><span id="l28.6">   let paramsNews = JSON.stringify({ idKey: identity.key, type: &quot;addr_newsgroups&quot; });</span>
<a href="#l28.7"></a><span id="l28.7">   let paramsFollowup = JSON.stringify({ idKey: identity.key, type: &quot;addr_followup&quot; });</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">   // Test - Valid search - this should return no results (autocomplete disabled)</span>
<a href="#l28.10"></a><span id="l28.10">   acs.startSearch(&quot;test&quot;, params, null, obs);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;test&quot;);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;test&quot;);</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l28.22"></a><span id="l28.22"> </span>
<a href="#l28.23"></a><span id="l28.23">   // Now enable autocomplete for this identity</span>
<a href="#l28.24"></a><span id="l28.24">   identity.autocompleteToMyDomain = true;</span>
<a href="#l28.25"></a><span id="l28.25"> </span>
<a href="#l28.26"></a><span id="l28.26">   // Test - Search with empty string</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28">   acs.startSearch(null, params, null, obs);</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-  do_check_eq(obs._result.searchString, null);</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+  Assert.equal(obs._result.searchString, null);</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l28.40"></a><span id="l28.40"> </span>
<a href="#l28.41"></a><span id="l28.41">   acs.startSearch(&quot;&quot;, params, null, obs);</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;&quot;);</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;&quot;);</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l28.53"></a><span id="l28.53"> </span>
<a href="#l28.54"></a><span id="l28.54">   // Test - Check ignoring result with comma</span>
<a href="#l28.55"></a><span id="l28.55"> </span>
<a href="#l28.56"></a><span id="l28.56">   acs.startSearch(&quot;a,b&quot;, params, null, obs);</span>
<a href="#l28.57"></a><span id="l28.57"> </span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;a,b&quot;);</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;a,b&quot;);</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_FAILURE);</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l28.68"></a><span id="l28.68"> </span>
<a href="#l28.69"></a><span id="l28.69">   // Test - Check returning search string with @ sign</span>
<a href="#l28.70"></a><span id="l28.70"> </span>
<a href="#l28.71"></a><span id="l28.71">   acs.startSearch(&quot;a@b&quot;, params, null, obs);</span>
<a href="#l28.72"></a><span id="l28.72"> </span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;a@b&quot;);</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-  do_check_eq(obs._result.matchCount, 1);</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;a@b&quot;);</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineplus">+  Assert.equal(obs._result.matchCount, 1);</span>
<a href="#l28.83"></a><span id="l28.83"> </span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-  do_check_eq(obs._result.getValueAt(0), &quot;a@b&quot;);</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-  do_check_eq(obs._result.getLabelAt(0), &quot;a@b&quot;);</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-  do_check_eq(obs._result.getCommentAt(0), null);</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-  do_check_eq(obs._result.getStyleAt(0), &quot;default-match&quot;);</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineminus">-  do_check_eq(obs._result.getImageAt(0), null);</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineplus">+  Assert.equal(obs._result.getValueAt(0), &quot;a@b&quot;);</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineplus">+  Assert.equal(obs._result.getLabelAt(0), &quot;a@b&quot;);</span>
<a href="#l28.91"></a><span id="l28.91" class="difflineplus">+  Assert.equal(obs._result.getCommentAt(0), null);</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineplus">+  Assert.equal(obs._result.getStyleAt(0), &quot;default-match&quot;);</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineplus">+  Assert.equal(obs._result.getImageAt(0), null);</span>
<a href="#l28.94"></a><span id="l28.94"> </span>
<a href="#l28.95"></a><span id="l28.95">   // No autocomplete for addr_newsgroups!</span>
<a href="#l28.96"></a><span id="l28.96">   acs.startSearch(&quot;a@b&quot;, paramsNews, null, obsNews);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineminus">-  do_check_true(obsNews._result == null || obsNews._result.matchCount == 0);</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineplus">+  Assert.ok(obsNews._result == null || obsNews._result.matchCount == 0);</span>
<a href="#l28.99"></a><span id="l28.99"> </span>
<a href="#l28.100"></a><span id="l28.100">   // No autocomplete for addr_followup!</span>
<a href="#l28.101"></a><span id="l28.101">   acs.startSearch(&quot;a@b&quot;, paramsFollowup, null, obsFollowup);</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineminus">-  do_check_true(obsFollowup._result == null || obsFollowup._result.matchCount == 0);</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineplus">+  Assert.ok(obsFollowup._result == null || obsFollowup._result.matchCount == 0);</span>
<a href="#l28.104"></a><span id="l28.104"> </span>
<a href="#l28.105"></a><span id="l28.105"> </span>
<a href="#l28.106"></a><span id="l28.106">   // Test - Add default domain</span>
<a href="#l28.107"></a><span id="l28.107"> </span>
<a href="#l28.108"></a><span id="l28.108">   acs.startSearch(&quot;test1&quot;, params, null, obs);</span>
<a href="#l28.109"></a><span id="l28.109"> </span>
<a href="#l28.110"></a><span id="l28.110" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;test1&quot;);</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineminus">-  do_check_eq(obs._result.matchCount, 1);</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;test1&quot;);</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l28.119"></a><span id="l28.119" class="difflineplus">+  Assert.equal(obs._result.matchCount, 1);</span>
<a href="#l28.120"></a><span id="l28.120"> </span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-  do_check_eq(obs._result.getValueAt(0), &quot;test1@foo.invalid&quot;);</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-  do_check_eq(obs._result.getLabelAt(0), &quot;test1@foo.invalid&quot;);</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-  do_check_eq(obs._result.getCommentAt(0), null);</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineminus">-  do_check_eq(obs._result.getStyleAt(0), &quot;default-match&quot;);</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-  do_check_eq(obs._result.getImageAt(0), null);</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineplus">+  Assert.equal(obs._result.getValueAt(0), &quot;test1@foo.invalid&quot;);</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineplus">+  Assert.equal(obs._result.getLabelAt(0), &quot;test1@foo.invalid&quot;);</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineplus">+  Assert.equal(obs._result.getCommentAt(0), null);</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineplus">+  Assert.equal(obs._result.getStyleAt(0), &quot;default-match&quot;);</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineplus">+  Assert.equal(obs._result.getImageAt(0), null);</span>
<a href="#l28.131"></a><span id="l28.131"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -242,145 +242,145 @@ function run_test() {</span>
<a href="#l29.4"></a><span id="l29.4">   Services.prefs.setBoolPref(&quot;mail.enable_autocomplete&quot;, false);</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">   let param = JSON.stringify({ type: &quot;addr_to&quot;  });</span>
<a href="#l29.7"></a><span id="l29.7">   let paramNews = JSON.stringify({ type: &quot;addr_newsgroups&quot;  });</span>
<a href="#l29.8"></a><span id="l29.8">   let paramFollowup = JSON.stringify({ type: &quot;addr_followup&quot;  });</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10">   acs.startSearch(&quot;abc&quot;, param, null, obs);</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;abc&quot;);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_NOMATCH);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;abc&quot;);</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_NOMATCH);</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l29.22"></a><span id="l29.22"> </span>
<a href="#l29.23"></a><span id="l29.23">   // Test - Check Enabling of autocomplete, but with empty string.</span>
<a href="#l29.24"></a><span id="l29.24"> </span>
<a href="#l29.25"></a><span id="l29.25">   Services.prefs.setBoolPref(&quot;mail.enable_autocomplete&quot;, true);</span>
<a href="#l29.26"></a><span id="l29.26"> </span>
<a href="#l29.27"></a><span id="l29.27">   acs.startSearch(null, param, null, obs);</span>
<a href="#l29.28"></a><span id="l29.28"> </span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-  do_check_eq(obs._result.searchString, null);</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_IGNORED);</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineminus">-  do_check_eq(obs._result.defaultIndex, -1);</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineplus">+  Assert.equal(obs._result.searchString, null);</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_IGNORED);</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineplus">+  Assert.equal(obs._result.defaultIndex, -1);</span>
<a href="#l29.41"></a><span id="l29.41"> </span>
<a href="#l29.42"></a><span id="l29.42">   // Test - Check ignoring result with comma</span>
<a href="#l29.43"></a><span id="l29.43"> </span>
<a href="#l29.44"></a><span id="l29.44">   acs.startSearch(&quot;a,b&quot;, param, null, obs);</span>
<a href="#l29.45"></a><span id="l29.45"> </span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;a,b&quot;);</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_IGNORED);</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-  do_check_eq(obs._result.defaultIndex, -1);</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;a,b&quot;);</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_IGNORED);</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineplus">+  Assert.equal(obs._result.defaultIndex, -1);</span>
<a href="#l29.58"></a><span id="l29.58"> </span>
<a href="#l29.59"></a><span id="l29.59">   // Test - No matches</span>
<a href="#l29.60"></a><span id="l29.60"> </span>
<a href="#l29.61"></a><span id="l29.61">   acs.startSearch(&quot;asjdkljdgfjglkfg&quot;, param, null, obs);</span>
<a href="#l29.62"></a><span id="l29.62"> </span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;asjdkljdgfjglkfg&quot;);</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_NOMATCH);</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-  do_check_eq(obs._result.matchCount, 0);</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineminus">-  do_check_eq(obs._result.defaultIndex, -1);</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;asjdkljdgfjglkfg&quot;);</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_NOMATCH);</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineplus">+  Assert.equal(obs._result.matchCount, 0);</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+  Assert.equal(obs._result.defaultIndex, -1);</span>
<a href="#l29.75"></a><span id="l29.75"> </span>
<a href="#l29.76"></a><span id="l29.76">   // Test - Matches</span>
<a href="#l29.77"></a><span id="l29.77"> </span>
<a href="#l29.78"></a><span id="l29.78">   // Basic quick-check</span>
<a href="#l29.79"></a><span id="l29.79">   acs.startSearch(&quot;email&quot;, param, null, obs);</span>
<a href="#l29.80"></a><span id="l29.80"> </span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;email&quot;);</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineminus">-  do_check_eq(obs._result.matchCount, 2);</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-  do_check_eq(obs._result.defaultIndex, 0);</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;email&quot;);</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineplus">+  Assert.equal(obs._result.matchCount, 2);</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineplus">+  Assert.equal(obs._result.defaultIndex, 0);</span>
<a href="#l29.93"></a><span id="l29.93"> </span>
<a href="#l29.94"></a><span id="l29.94" class="difflineminus">-  do_check_eq(obs._result.getValueAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.95"></a><span id="l29.95" class="difflineminus">-  do_check_eq(obs._result.getLabelAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.96"></a><span id="l29.96" class="difflineminus">-  do_check_eq(obs._result.getCommentAt(0), &quot;&quot;);</span>
<a href="#l29.97"></a><span id="l29.97" class="difflineminus">-  do_check_eq(obs._result.getStyleAt(0), &quot;local-abook&quot;);</span>
<a href="#l29.98"></a><span id="l29.98" class="difflineminus">-  do_check_eq(obs._result.getImageAt(0), &quot;&quot;);</span>
<a href="#l29.99"></a><span id="l29.99" class="difflineplus">+  Assert.equal(obs._result.getValueAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.100"></a><span id="l29.100" class="difflineplus">+  Assert.equal(obs._result.getLabelAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.101"></a><span id="l29.101" class="difflineplus">+  Assert.equal(obs._result.getCommentAt(0), &quot;&quot;);</span>
<a href="#l29.102"></a><span id="l29.102" class="difflineplus">+  Assert.equal(obs._result.getStyleAt(0), &quot;local-abook&quot;);</span>
<a href="#l29.103"></a><span id="l29.103" class="difflineplus">+  Assert.equal(obs._result.getImageAt(0), &quot;&quot;);</span>
<a href="#l29.104"></a><span id="l29.104"> </span>
<a href="#l29.105"></a><span id="l29.105">   // quick-check that nothing is found for addr_newsgroups</span>
<a href="#l29.106"></a><span id="l29.106">   acs.startSearch(&quot;email&quot;, paramNews, null, obsNews);</span>
<a href="#l29.107"></a><span id="l29.107" class="difflineminus">-  do_check_true(obsNews._result == null || obsNews._result.matchCount == 0);</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineplus">+  Assert.ok(obsNews._result == null || obsNews._result.matchCount == 0);</span>
<a href="#l29.109"></a><span id="l29.109"> </span>
<a href="#l29.110"></a><span id="l29.110">   // quick-check that nothing is found for  addr_followup</span>
<a href="#l29.111"></a><span id="l29.111">   acs.startSearch(&quot;a@b&quot;, paramFollowup, null, obsFollowup);</span>
<a href="#l29.112"></a><span id="l29.112" class="difflineminus">-  do_check_true(obsFollowup._result == null || obsFollowup._result.matchCount == 0);</span>
<a href="#l29.113"></a><span id="l29.113" class="difflineplus">+  Assert.ok(obsFollowup._result == null || obsFollowup._result.matchCount == 0);</span>
<a href="#l29.114"></a><span id="l29.114"> </span>
<a href="#l29.115"></a><span id="l29.115">   // Now quick-check with the address book name in the comment column.</span>
<a href="#l29.116"></a><span id="l29.116">   Services.prefs.setIntPref(&quot;mail.autoComplete.commentColumn&quot;, 1);</span>
<a href="#l29.117"></a><span id="l29.117"> </span>
<a href="#l29.118"></a><span id="l29.118">   acs.startSearch(&quot;email&quot;, param, null, obs);</span>
<a href="#l29.119"></a><span id="l29.119"> </span>
<a href="#l29.120"></a><span id="l29.120" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.121"></a><span id="l29.121" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;email&quot;);</span>
<a href="#l29.122"></a><span id="l29.122" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.123"></a><span id="l29.123" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.124"></a><span id="l29.124" class="difflineminus">-  do_check_eq(obs._result.matchCount, 2);</span>
<a href="#l29.125"></a><span id="l29.125" class="difflineminus">-  do_check_eq(obs._result.defaultIndex, 0);</span>
<a href="#l29.126"></a><span id="l29.126" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.127"></a><span id="l29.127" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;email&quot;);</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.129"></a><span id="l29.129" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.130"></a><span id="l29.130" class="difflineplus">+  Assert.equal(obs._result.matchCount, 2);</span>
<a href="#l29.131"></a><span id="l29.131" class="difflineplus">+  Assert.equal(obs._result.defaultIndex, 0);</span>
<a href="#l29.132"></a><span id="l29.132"> </span>
<a href="#l29.133"></a><span id="l29.133" class="difflineminus">-  do_check_eq(obs._result.getValueAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.134"></a><span id="l29.134" class="difflineminus">-  do_check_eq(obs._result.getLabelAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.135"></a><span id="l29.135" class="difflineminus">-  do_check_eq(obs._result.getCommentAt(0), kPABData.dirName);</span>
<a href="#l29.136"></a><span id="l29.136" class="difflineminus">-  do_check_eq(obs._result.getStyleAt(0), &quot;local-abook&quot;);</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineminus">-  do_check_eq(obs._result.getImageAt(0), &quot;&quot;);</span>
<a href="#l29.138"></a><span id="l29.138" class="difflineplus">+  Assert.equal(obs._result.getValueAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.139"></a><span id="l29.139" class="difflineplus">+  Assert.equal(obs._result.getLabelAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.140"></a><span id="l29.140" class="difflineplus">+  Assert.equal(obs._result.getCommentAt(0), kPABData.dirName);</span>
<a href="#l29.141"></a><span id="l29.141" class="difflineplus">+  Assert.equal(obs._result.getStyleAt(0), &quot;local-abook&quot;);</span>
<a href="#l29.142"></a><span id="l29.142" class="difflineplus">+  Assert.equal(obs._result.getImageAt(0), &quot;&quot;);</span>
<a href="#l29.143"></a><span id="l29.143"> </span>
<a href="#l29.144"></a><span id="l29.144">   // Check input with different case</span>
<a href="#l29.145"></a><span id="l29.145">   acs.startSearch(&quot;EMAIL&quot;, param, null, obs);</span>
<a href="#l29.146"></a><span id="l29.146"> </span>
<a href="#l29.147"></a><span id="l29.147" class="difflineminus">-  do_check_eq(obs._search, acs);</span>
<a href="#l29.148"></a><span id="l29.148" class="difflineminus">-  do_check_eq(obs._result.searchString, &quot;EMAIL&quot;);</span>
<a href="#l29.149"></a><span id="l29.149" class="difflineminus">-  do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.150"></a><span id="l29.150" class="difflineminus">-  do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.151"></a><span id="l29.151" class="difflineminus">-  do_check_eq(obs._result.matchCount, 2);</span>
<a href="#l29.152"></a><span id="l29.152" class="difflineminus">-  do_check_eq(obs._result.defaultIndex, 0);</span>
<a href="#l29.153"></a><span id="l29.153" class="difflineplus">+  Assert.equal(obs._search, acs);</span>
<a href="#l29.154"></a><span id="l29.154" class="difflineplus">+  Assert.equal(obs._result.searchString, &quot;EMAIL&quot;);</span>
<a href="#l29.155"></a><span id="l29.155" class="difflineplus">+  Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.156"></a><span id="l29.156" class="difflineplus">+  Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.157"></a><span id="l29.157" class="difflineplus">+  Assert.equal(obs._result.matchCount, 2);</span>
<a href="#l29.158"></a><span id="l29.158" class="difflineplus">+  Assert.equal(obs._result.defaultIndex, 0);</span>
<a href="#l29.159"></a><span id="l29.159"> </span>
<a href="#l29.160"></a><span id="l29.160" class="difflineminus">-  do_check_eq(obs._result.getValueAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.161"></a><span id="l29.161" class="difflineminus">-  do_check_eq(obs._result.getLabelAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.162"></a><span id="l29.162" class="difflineminus">-  do_check_eq(obs._result.getCommentAt(0), kPABData.dirName);</span>
<a href="#l29.163"></a><span id="l29.163" class="difflineminus">-  do_check_eq(obs._result.getStyleAt(0), &quot;local-abook&quot;);</span>
<a href="#l29.164"></a><span id="l29.164" class="difflineminus">-  do_check_eq(obs._result.getImageAt(0), &quot;&quot;);</span>
<a href="#l29.165"></a><span id="l29.165" class="difflineplus">+  Assert.equal(obs._result.getValueAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.166"></a><span id="l29.166" class="difflineplus">+  Assert.equal(obs._result.getLabelAt(0), &quot;dis &lt;email@foo.invalid&gt;&quot;);</span>
<a href="#l29.167"></a><span id="l29.167" class="difflineplus">+  Assert.equal(obs._result.getCommentAt(0), kPABData.dirName);</span>
<a href="#l29.168"></a><span id="l29.168" class="difflineplus">+  Assert.equal(obs._result.getStyleAt(0), &quot;local-abook&quot;);</span>
<a href="#l29.169"></a><span id="l29.169" class="difflineplus">+  Assert.equal(obs._result.getImageAt(0), &quot;&quot;);</span>
<a href="#l29.170"></a><span id="l29.170"> </span>
<a href="#l29.171"></a><span id="l29.171">   // Now check multiple matches</span>
<a href="#l29.172"></a><span id="l29.172">   function checkInputItem(element, index, array) {</span>
<a href="#l29.173"></a><span id="l29.173">     let prevRes = obs._result;</span>
<a href="#l29.174"></a><span id="l29.174">     print(&quot;Search #&quot; + index + &quot;: search=&quot; + element.search);</span>
<a href="#l29.175"></a><span id="l29.175">     acs.startSearch(element.search, param, prevRes, obs);</span>
<a href="#l29.176"></a><span id="l29.176"> </span>
<a href="#l29.177"></a><span id="l29.177">     for (var i = 0; i &lt; obs._result.matchCount; i++) {</span>
<a href="#l29.178"></a><span id="l29.178">       print(&quot;... got &quot; + i + &quot;: &quot; + obs._result.getValueAt(i));</span>
<a href="#l29.179"></a><span id="l29.179">     }</span>
<a href="#l29.180"></a><span id="l29.180"> </span>
<a href="#l29.181"></a><span id="l29.181">     for (var i = 0; i &lt; element.expected.length; i++) {</span>
<a href="#l29.182"></a><span id="l29.182">       print(&quot;... expected &quot; + i + &quot; (result &quot; + element.expected[i] + &quot;): &quot; +</span>
<a href="#l29.183"></a><span id="l29.183">             results[element.expected[i]].email);</span>
<a href="#l29.184"></a><span id="l29.184">     }</span>
<a href="#l29.185"></a><span id="l29.185"> </span>
<a href="#l29.186"></a><span id="l29.186" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l29.187"></a><span id="l29.187" class="difflineminus">-    do_check_eq(obs._result.searchString, element.search);</span>
<a href="#l29.188"></a><span id="l29.188" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.189"></a><span id="l29.189" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l29.190"></a><span id="l29.190" class="difflineminus">-    do_check_eq(obs._result.matchCount, element.expected.length);</span>
<a href="#l29.191"></a><span id="l29.191" class="difflineminus">-    do_check_eq(obs._result.defaultIndex, 0);</span>
<a href="#l29.192"></a><span id="l29.192" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l29.193"></a><span id="l29.193" class="difflineplus">+    Assert.equal(obs._result.searchString, element.search);</span>
<a href="#l29.194"></a><span id="l29.194" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l29.195"></a><span id="l29.195" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l29.196"></a><span id="l29.196" class="difflineplus">+    Assert.equal(obs._result.matchCount, element.expected.length);</span>
<a href="#l29.197"></a><span id="l29.197" class="difflineplus">+    Assert.equal(obs._result.defaultIndex, 0);</span>
<a href="#l29.198"></a><span id="l29.198"> </span>
<a href="#l29.199"></a><span id="l29.199">     for (var i = 0; i &lt; element.expected.length; ++i) {</span>
<a href="#l29.200"></a><span id="l29.200" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l29.201"></a><span id="l29.201" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), results[element.expected[i]].email);</span>
<a href="#l29.202"></a><span id="l29.202" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), results[element.expected[i]].dirName);</span>
<a href="#l29.203"></a><span id="l29.203" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l29.204"></a><span id="l29.204" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l29.205"></a><span id="l29.205" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l29.206"></a><span id="l29.206" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), results[element.expected[i]].email);</span>
<a href="#l29.207"></a><span id="l29.207" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), results[element.expected[i]].dirName);</span>
<a href="#l29.208"></a><span id="l29.208" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l29.209"></a><span id="l29.209" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l29.210"></a><span id="l29.210">     }</span>
<a href="#l29.211"></a><span id="l29.211">   }</span>
<a href="#l29.212"></a><span id="l29.212">   function checkInputSet(element, index, array) {</span>
<a href="#l29.213"></a><span id="l29.213">     element.forEach(checkInputItem);</span>
<a href="#l29.214"></a><span id="l29.214">   }</span>
<a href="#l29.215"></a><span id="l29.215"> </span>
<a href="#l29.216"></a><span id="l29.216">   inputs.forEach(checkInputSet);</span>
<a href="#l29.217"></a><span id="l29.217"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch2.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -176,28 +176,28 @@ function run_test() {</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6">   // Test - Matches</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">   // Now check multiple matches</span>
<a href="#l30.9"></a><span id="l30.9">   function checkInputItem(element, index, array) {</span>
<a href="#l30.10"></a><span id="l30.10">     acs.startSearch(element.search, JSON.stringify({ type: &quot;addr_to&quot;, idKey: &quot;&quot; }), lastResult, obs);</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-    do_check_eq(obs._result.searchString, element.search);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-    do_check_eq(obs._result.matchCount, element.expected.length);</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+    Assert.equal(obs._result.searchString, element.search);</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+    Assert.equal(obs._result.matchCount, element.expected.length);</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23">     for (var i = 0; i &lt; element.expected.length; ++i) {</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), results[element.expected[i]].email);</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), results[element.expected[i]].dirName);</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), results[element.expected[i]].email);</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), results[element.expected[i]].dirName);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l30.34"></a><span id="l30.34">     }</span>
<a href="#l30.35"></a><span id="l30.35">   }</span>
<a href="#l30.36"></a><span id="l30.36">   function checkInputSet(element, index, array) {</span>
<a href="#l30.37"></a><span id="l30.37">     element.forEach(checkInputItem);</span>
<a href="#l30.38"></a><span id="l30.38">   }</span>
<a href="#l30.39"></a><span id="l30.39"> </span>
<a href="#l30.40"></a><span id="l30.40">   inputs.forEach(checkInputSet);</span>
<a href="#l30.41"></a><span id="l30.41"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch3.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -87,28 +87,28 @@ function run_test()</span>
<a href="#l31.4"></a><span id="l31.4">       print(&quot;... got &quot; + i + &quot;: &quot; + obs._result.getValueAt(i));</span>
<a href="#l31.5"></a><span id="l31.5">     }</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7">     for (var i = 0; i &lt; element.expected.length; i++) {</span>
<a href="#l31.8"></a><span id="l31.8">       print(&quot;... expected &quot; + i + &quot; (card &quot; + element.expected[i] + &quot;): &quot; +</span>
<a href="#l31.9"></a><span id="l31.9">             cards[element.expected[i]].value);</span>
<a href="#l31.10"></a><span id="l31.10">     }</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-    do_check_eq(obs._result.searchString, element.search);</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-    do_check_eq(obs._result.matchCount, element.expected.length);</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+    Assert.equal(obs._result.searchString, element.search);</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+    Assert.equal(obs._result.matchCount, element.expected.length);</span>
<a href="#l31.22"></a><span id="l31.22"> </span>
<a href="#l31.23"></a><span id="l31.23">     for (var i = 0; i &lt; element.expected.length; ++i) {</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), cards[element.expected[i]].value);</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), cards[element.expected[i]].value);</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), cards[element.expected[i]].value);</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), cards[element.expected[i]].value);</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l31.34"></a><span id="l31.34">       obs._result.QueryInterface(Ci.nsIAbAutoCompleteResult);</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineminus">-      do_check_eq(obs._result.getCardAt(i).firstName,</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">-                  cards[element.expected[i]].firstName);</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+      Assert.equal(obs._result.getCardAt(i).firstName,</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+                   cards[element.expected[i]].firstName);</span>
<a href="#l31.39"></a><span id="l31.39">     }</span>
<a href="#l31.40"></a><span id="l31.40">   }</span>
<a href="#l31.41"></a><span id="l31.41"> </span>
<a href="#l31.42"></a><span id="l31.42">   duplicates.forEach(checkInputItem);</span>
<a href="#l31.43"></a><span id="l31.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch4.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -134,51 +134,51 @@ function run_test()</span>
<a href="#l32.4"></a><span id="l32.4">   function checkSearch(element, index, array) {</span>
<a href="#l32.5"></a><span id="l32.5">     print(&quot;Search #&quot; + index + &quot;: search=&quot; + element);</span>
<a href="#l32.6"></a><span id="l32.6">     acs.startSearch(element, JSON.stringify({ type: &quot;addr_to&quot;, idKey: &quot;&quot; }), null, obs);</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8">     for (var i = 0; i &lt; obs._result.matchCount; i++) {</span>
<a href="#l32.9"></a><span id="l32.9">       print(&quot;... got &quot; + i + &quot;: &quot; + obs._result.getValueAt(i));</span>
<a href="#l32.10"></a><span id="l32.10">     }</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-    do_check_eq(obs._result.searchString, element);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineminus">-    do_check_eq(obs._result.matchCount, expectedResults[index].length);</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineplus">+    Assert.equal(obs._result.searchString, element);</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineplus">+    Assert.equal(obs._result.matchCount, expectedResults[index].length);</span>
<a href="#l32.22"></a><span id="l32.22"> </span>
<a href="#l32.23"></a><span id="l32.23">     for (var i = 0; i &lt; expectedResults[index].length; ++i) {</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), expectedResults[index][i]);</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), expectedResults[index][i]);</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), expectedResults[index][i]);</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), expectedResults[index][i]);</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l32.34"></a><span id="l32.34">       obs._result.QueryInterface(Ci.nsIAbAutoCompleteResult);</span>
<a href="#l32.35"></a><span id="l32.35">     }</span>
<a href="#l32.36"></a><span id="l32.36">   }</span>
<a href="#l32.37"></a><span id="l32.37"> </span>
<a href="#l32.38"></a><span id="l32.38">   searches.forEach(checkSearch);</span>
<a href="#l32.39"></a><span id="l32.39"> </span>
<a href="#l32.40"></a><span id="l32.40">   print(&quot;Checking Reduction of Search Results&quot;);</span>
<a href="#l32.41"></a><span id="l32.41"> </span>
<a href="#l32.42"></a><span id="l32.42">   var lastResult = null;</span>
<a href="#l32.43"></a><span id="l32.43"> </span>
<a href="#l32.44"></a><span id="l32.44">   function checkReductionSearch(element, index, array) {</span>
<a href="#l32.45"></a><span id="l32.45">     acs.startSearch(element, JSON.stringify({ type: &quot;addr_to&quot;, idKey: &quot;&quot; }), lastResult, obs);</span>
<a href="#l32.46"></a><span id="l32.46"> </span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-    do_check_eq(obs._result.searchString, element);</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineminus">-    do_check_eq(obs._result.matchCount, reductionExpectedResults[index].length);</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+    Assert.equal(obs._result.searchString, element);</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+    Assert.equal(obs._result.matchCount, reductionExpectedResults[index].length);</span>
<a href="#l32.57"></a><span id="l32.57"> </span>
<a href="#l32.58"></a><span id="l32.58">     for (var i = 0; i &lt; reductionExpectedResults[index].length; ++i) {</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), reductionExpectedResults[index][i]);</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), reductionExpectedResults[index][i]);</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), reductionExpectedResults[index][i]);</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), reductionExpectedResults[index][i]);</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l32.69"></a><span id="l32.69">       obs._result.QueryInterface(Ci.nsIAbAutoCompleteResult);</span>
<a href="#l32.70"></a><span id="l32.70">     }</span>
<a href="#l32.71"></a><span id="l32.71">     lastResult = obs._result;</span>
<a href="#l32.72"></a><span id="l32.72">   }</span>
<a href="#l32.73"></a><span id="l32.73">   reductionSearches.forEach(checkReductionSearch);</span>
<a href="#l32.74"></a><span id="l32.74"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch5.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -70,35 +70,35 @@ function run_test() {</span>
<a href="#l33.4"></a><span id="l33.4">       print(&quot;... got &quot; + i + &quot;: &quot; + obs._result.getValueAt(i));</span>
<a href="#l33.5"></a><span id="l33.5">     }</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">     for (var i = 0; i &lt; element.expected.length; i++) {</span>
<a href="#l33.8"></a><span id="l33.8">       print(&quot;... expected &quot; + i + &quot; (card &quot; + element.expected[i] + &quot;): &quot; +</span>
<a href="#l33.9"></a><span id="l33.9">             results[element.expected[i]].email);</span>
<a href="#l33.10"></a><span id="l33.10">     }</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-    do_check_eq(obs._result.searchString, element.search);</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-    do_check_eq(obs._result.matchCount, element.expected.length);</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-    do_check_eq(obs._result.defaultIndex, 0);</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+    Assert.equal(obs._result.searchString, element.search);</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineplus">+    Assert.equal(obs._result.matchCount, element.expected.length);</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineplus">+    Assert.equal(obs._result.defaultIndex, 0);</span>
<a href="#l33.24"></a><span id="l33.24"> </span>
<a href="#l33.25"></a><span id="l33.25">     for (let i = 0; i &lt; element.expected.length; ++i) {</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), results[element.expected[i]].dirName);</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), results[element.expected[i]].dirName);</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l33.34"></a><span id="l33.34"> </span>
<a href="#l33.35"></a><span id="l33.35">       // Card at result number 4 is the one with the TB 2 popularity set as &quot;a&quot;</span>
<a href="#l33.36"></a><span id="l33.36">       // in the file, so check that we're now setting the popularity to 10</span>
<a href="#l33.37"></a><span id="l33.37">       // and hence future tests don't have to convert it.</span>
<a href="#l33.38"></a><span id="l33.38">       if (element.expected[i] == 4) {</span>
<a href="#l33.39"></a><span id="l33.39">         let result = obs._result.QueryInterface(Ci.nsIAbAutoCompleteResult);</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineminus">-        do_check_eq(result.getCardAt(i).getProperty(&quot;PopularityIndex&quot;, -1), 10);</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+        Assert.equal(result.getCardAt(i).getProperty(&quot;PopularityIndex&quot;, -1), 10);</span>
<a href="#l33.42"></a><span id="l33.42">       }</span>
<a href="#l33.43"></a><span id="l33.43">     }</span>
<a href="#l33.44"></a><span id="l33.44">   }</span>
<a href="#l33.45"></a><span id="l33.45">   function checkInputSet(element, index, array) {</span>
<a href="#l33.46"></a><span id="l33.46">     element.forEach(checkInputItem);</span>
<a href="#l33.47"></a><span id="l33.47">   }</span>
<a href="#l33.48"></a><span id="l33.48"> </span>
<a href="#l33.49"></a><span id="l33.49">   inputs.forEach(checkInputSet);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch6.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -167,22 +167,22 @@ function run_test()</span>
<a href="#l34.4"></a><span id="l34.4">       print(&quot;... got &quot; + i + &quot;: &quot; + obs._result.getValueAt(i));</span>
<a href="#l34.5"></a><span id="l34.5">     }</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7">     for (var i = 0; i &lt; element.expected.length; i++) {</span>
<a href="#l34.8"></a><span id="l34.8">       print(&quot;... expected &quot; + i + &quot; (card &quot; + element.expected[i] + &quot;): &quot; +</span>
<a href="#l34.9"></a><span id="l34.9">             cards[element.expected[i]].value);</span>
<a href="#l34.10"></a><span id="l34.10">     }</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-    do_check_eq(obs._result.searchString, element.search);</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineminus">-    do_check_eq(obs._result.matchCount, element.expected.length);</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineplus">+    Assert.equal(obs._result.searchString, element.search);</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineplus">+    Assert.equal(obs._result.matchCount, element.expected.length);</span>
<a href="#l34.22"></a><span id="l34.22"> </span>
<a href="#l34.23"></a><span id="l34.23">     for (var i = 0; i &lt; element.expected.length; ++i) {</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), cards[element.expected[i]].value);</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), cards[element.expected[i]].value);</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), cards[element.expected[i]].value);</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), cards[element.expected[i]].value);</span>
<a href="#l34.28"></a><span id="l34.28">     }</span>
<a href="#l34.29"></a><span id="l34.29">   }</span>
<a href="#l34.30"></a><span id="l34.30"> </span>
<a href="#l34.31"></a><span id="l34.31">   inputs.forEach(checkInputItem);</span>
<a href="#l34.32"></a><span id="l34.32"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -133,29 +133,29 @@ function run_test() {</span>
<a href="#l35.4"></a><span id="l35.4">     for (var i = 0; i &lt; obs._result.matchCount; i++) {</span>
<a href="#l35.5"></a><span id="l35.5">       print(&quot;... got &quot; + i + &quot;: &quot; + obs._result.getValueAt(i));</span>
<a href="#l35.6"></a><span id="l35.6">     }</span>
<a href="#l35.7"></a><span id="l35.7">     for (var i = 0; i &lt; element.expected.length; i++) {</span>
<a href="#l35.8"></a><span id="l35.8">       print(&quot;... expected &quot; + i + &quot; (result &quot; + element.expected[i] + &quot;): &quot; +</span>
<a href="#l35.9"></a><span id="l35.9">             results[element.expected[i]].email);</span>
<a href="#l35.10"></a><span id="l35.10">     }</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    do_check_eq(obs._search, acs);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-    do_check_eq(obs._result.searchString, element.search);</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">-    do_check_eq(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">-    do_check_eq(obs._result.errorDescription, null);</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">-    do_check_eq(obs._result.matchCount, element.expected.length);</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-    do_check_eq(obs._result.defaultIndex, 0);</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+    Assert.equal(obs._search, acs);</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+    Assert.equal(obs._result.searchString, element.search);</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+    Assert.equal(obs._result.searchResult, ACR.RESULT_SUCCESS);</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+    Assert.equal(obs._result.errorDescription, null);</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+    Assert.equal(obs._result.matchCount, element.expected.length);</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+    Assert.equal(obs._result.defaultIndex, 0);</span>
<a href="#l35.24"></a><span id="l35.24"> </span>
<a href="#l35.25"></a><span id="l35.25">     for (var i = 0; i &lt; element.expected.length; ++i) {</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">-      do_check_eq(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">-      do_check_eq(obs._result.getLabelAt(i), results[element.expected[i]].email);</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">-      do_check_eq(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineminus">-      do_check_eq(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">-      do_check_eq(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+      Assert.equal(obs._result.getValueAt(i), results[element.expected[i]].email);</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+      Assert.equal(obs._result.getLabelAt(i), results[element.expected[i]].email);</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+      Assert.equal(obs._result.getCommentAt(i), &quot;&quot;);</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+      Assert.equal(obs._result.getStyleAt(i), &quot;local-abook&quot;);</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+      Assert.equal(obs._result.getImageAt(i), &quot;&quot;);</span>
<a href="#l35.36"></a><span id="l35.36">     }</span>
<a href="#l35.37"></a><span id="l35.37">   }</span>
<a href="#l35.38"></a><span id="l35.38">   function checkInputSet(element, index, array) {</span>
<a href="#l35.39"></a><span id="l35.39">     element.forEach(checkInputItem);</span>
<a href="#l35.40"></a><span id="l35.40">   }</span>
<a href="#l35.41"></a><span id="l35.41"> </span>
<a href="#l35.42"></a><span id="l35.42">   inputs.forEach(checkInputSet);</span>
<a href="#l35.43"></a><span id="l35.43"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbManager1.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbManager1.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -56,48 +56,48 @@ function run_test() {</span>
<a href="#l36.4"></a><span id="l36.4">     gAblSingle[i] = new abL;</span>
<a href="#l36.5"></a><span id="l36.5">     MailServices.ab.addAddressBookListener(gAblSingle[i], 1 &lt;&lt; i);</span>
<a href="#l36.6"></a><span id="l36.6">   }</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8">   // Test - Notify listener on all available items</span>
<a href="#l36.9"></a><span id="l36.9"> </span>
<a href="#l36.10"></a><span id="l36.10">   NotifyAbManager();</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  do_check_eq(gAblAll.mReceived, (1 &lt;&lt; numListenerOptions) - 1);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  Assert.equal(gAblAll.mReceived, (1 &lt;&lt; numListenerOptions) - 1);</span>
<a href="#l36.14"></a><span id="l36.14">   gAblAll.mReceived = 0;</span>
<a href="#l36.15"></a><span id="l36.15"> </span>
<a href="#l36.16"></a><span id="l36.16">   for (i = 0; i &lt; numListenerOptions; ++i) {</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-    do_check_eq(gAblSingle[i].mReceived, 1 &lt;&lt; i);</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+    Assert.equal(gAblSingle[i].mReceived, 1 &lt;&lt; i);</span>
<a href="#l36.19"></a><span id="l36.19">     gAblSingle[i].mReceived = 0;</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21">     // And prepare for test 3.</span>
<a href="#l36.22"></a><span id="l36.22">     gAblSingle[i].mAutoRemoveItem = true;</span>
<a href="#l36.23"></a><span id="l36.23">   }</span>
<a href="#l36.24"></a><span id="l36.24"> </span>
<a href="#l36.25"></a><span id="l36.25">   // Test - Remove Single Listeners as we go through the functions</span>
<a href="#l36.26"></a><span id="l36.26"> </span>
<a href="#l36.27"></a><span id="l36.27">   // Check the for loop above for changes to the single listeners.</span>
<a href="#l36.28"></a><span id="l36.28"> </span>
<a href="#l36.29"></a><span id="l36.29">   NotifyAbManager();</span>
<a href="#l36.30"></a><span id="l36.30"> </span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-  do_check_eq(gAblAll.mReceived, (1 &lt;&lt; numListenerOptions) - 1);</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+  Assert.equal(gAblAll.mReceived, (1 &lt;&lt; numListenerOptions) - 1);</span>
<a href="#l36.33"></a><span id="l36.33">   gAblAll.mReceived = 0;</span>
<a href="#l36.34"></a><span id="l36.34"> </span>
<a href="#l36.35"></a><span id="l36.35">   for (i = 0; i &lt; numListenerOptions; ++i) {</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-    do_check_eq(gAblSingle[i].mReceived, 1 &lt;&lt; i);</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineplus">+    Assert.equal(gAblSingle[i].mReceived, 1 &lt;&lt; i);</span>
<a href="#l36.38"></a><span id="l36.38">     gAblSingle[i].mReceived = 0;</span>
<a href="#l36.39"></a><span id="l36.39">   }</span>
<a href="#l36.40"></a><span id="l36.40"> </span>
<a href="#l36.41"></a><span id="l36.41">   // Test - Ensure the single listeners have been removed.</span>
<a href="#l36.42"></a><span id="l36.42"> </span>
<a href="#l36.43"></a><span id="l36.43">   NotifyAbManager();</span>
<a href="#l36.44"></a><span id="l36.44"> </span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-  do_check_eq(gAblAll.mReceived, (1 &lt;&lt;  numListenerOptions) - 1);</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineplus">+  Assert.equal(gAblAll.mReceived, (1 &lt;&lt;  numListenerOptions) - 1);</span>
<a href="#l36.47"></a><span id="l36.47">   gAblAll.mReceived = 0;</span>
<a href="#l36.48"></a><span id="l36.48"> </span>
<a href="#l36.49"></a><span id="l36.49">   for (i = 0; i &lt; numListenerOptions; ++i) {</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-    do_check_eq(gAblSingle[i].mReceived, 0);</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineplus">+    Assert.equal(gAblSingle[i].mReceived, 0);</span>
<a href="#l36.52"></a><span id="l36.52">   }</span>
<a href="#l36.53"></a><span id="l36.53"> </span>
<a href="#l36.54"></a><span id="l36.54">   // Test - Remove main listener</span>
<a href="#l36.55"></a><span id="l36.55"> </span>
<a href="#l36.56"></a><span id="l36.56">   MailServices.ab.removeAddressBookListener(gAblAll);</span>
<a href="#l36.57"></a><span id="l36.57"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbManager2.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbManager2.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -41,69 +41,69 @@ abL.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4"> function checkDirs(aDirs, aDirArray) {</span>
<a href="#l37.5"></a><span id="l37.5">   // Don't modify the passed in array.</span>
<a href="#l37.6"></a><span id="l37.6">   var dirArray = aDirArray.concat();</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8">   while (aDirs.hasMoreElements()) {</span>
<a href="#l37.9"></a><span id="l37.9">     var dir = aDirs.getNext().QueryInterface(nsIAbDirectory);</span>
<a href="#l37.10"></a><span id="l37.10">     var loc = dirArray.indexOf(dir.URI);</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    do_check_eq(MailServices.ab.getDirectory(dir.URI), dir);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    Assert.equal(MailServices.ab.getDirectory(dir.URI), dir);</span>
<a href="#l37.14"></a><span id="l37.14"> </span>
<a href="#l37.15"></a><span id="l37.15">     if (loc == -1)</span>
<a href="#l37.16"></a><span id="l37.16">       do_throw(&quot;Unexpected directory &quot; + dir.URI + &quot; found in address book list&quot;);</span>
<a href="#l37.17"></a><span id="l37.17">     else</span>
<a href="#l37.18"></a><span id="l37.18">       dirArray[loc] = null;</span>
<a href="#l37.19"></a><span id="l37.19">   }</span>
<a href="#l37.20"></a><span id="l37.20"> </span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">-  dirArray.forEach(function(value) { do_check_eq(value, null); });</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineplus">+  dirArray.forEach(function(value) { Assert.equal(value, null); });</span>
<a href="#l37.23"></a><span id="l37.23"> }</span>
<a href="#l37.24"></a><span id="l37.24"> </span>
<a href="#l37.25"></a><span id="l37.25"> function addDirectory(dirName) {</span>
<a href="#l37.26"></a><span id="l37.26">   // Add the directory</span>
<a href="#l37.27"></a><span id="l37.27">   MailServices.ab.newAddressBook(dirName, &quot;&quot;, kPABData.dirType);</span>
<a href="#l37.28"></a><span id="l37.28"> </span>
<a href="#l37.29"></a><span id="l37.29">   // Check for correct notifications</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">-  do_check_eq(gAblAll.mReceived, nsIAbListener.itemAdded);</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+  Assert.equal(gAblAll.mReceived, nsIAbListener.itemAdded);</span>
<a href="#l37.32"></a><span id="l37.32"> </span>
<a href="#l37.33"></a><span id="l37.33">   var newDirectory = gAblAll.mDirectory.QueryInterface(nsIAbDirectory);</span>
<a href="#l37.34"></a><span id="l37.34"> </span>
<a href="#l37.35"></a><span id="l37.35">   gAblAll.mReceived = 0;</span>
<a href="#l37.36"></a><span id="l37.36">   gAblAll.mDirectory = null;</span>
<a href="#l37.37"></a><span id="l37.37"> </span>
<a href="#l37.38"></a><span id="l37.38">   for (var i = 0; i &lt; numListenerOptions; ++i) {</span>
<a href="#l37.39"></a><span id="l37.39">     if (1 &lt;&lt; i == nsIAbListener.itemAdded) {</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineminus">-      do_check_eq(gAblSingle[i].mReceived, nsIAbListener.itemAdded);</span>
<a href="#l37.41"></a><span id="l37.41" class="difflineplus">+      Assert.equal(gAblSingle[i].mReceived, nsIAbListener.itemAdded);</span>
<a href="#l37.42"></a><span id="l37.42">       gAblSingle[i].mReceived = 0;</span>
<a href="#l37.43"></a><span id="l37.43">     }</span>
<a href="#l37.44"></a><span id="l37.44">     else</span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-      do_check_eq(gAblSingle[i].mReceived, 0);</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineplus">+      Assert.equal(gAblSingle[i].mReceived, 0);</span>
<a href="#l37.47"></a><span id="l37.47">   }</span>
<a href="#l37.48"></a><span id="l37.48"> </span>
<a href="#l37.49"></a><span id="l37.49">   return newDirectory;</span>
<a href="#l37.50"></a><span id="l37.50"> }</span>
<a href="#l37.51"></a><span id="l37.51"> </span>
<a href="#l37.52"></a><span id="l37.52"> function removeDirectory(directory) {</span>
<a href="#l37.53"></a><span id="l37.53">   // Remove the directory</span>
<a href="#l37.54"></a><span id="l37.54">   MailServices.ab.deleteAddressBook(directory.URI);</span>
<a href="#l37.55"></a><span id="l37.55"> </span>
<a href="#l37.56"></a><span id="l37.56">   // Check correct notifications</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineminus">-  do_check_eq(gAblAll.mReceived, nsIAbListener.directoryRemoved);</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineminus">-  do_check_eq(gAblAll.mDirectory, directory);</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineplus">+  Assert.equal(gAblAll.mReceived, nsIAbListener.directoryRemoved);</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineplus">+  Assert.equal(gAblAll.mDirectory, directory);</span>
<a href="#l37.61"></a><span id="l37.61"> </span>
<a href="#l37.62"></a><span id="l37.62">   gAblAll.mReceived = 0;</span>
<a href="#l37.63"></a><span id="l37.63">   gAblAll.mDirectory = null;</span>
<a href="#l37.64"></a><span id="l37.64"> </span>
<a href="#l37.65"></a><span id="l37.65">   for (var i = 0; i &lt; numListenerOptions; ++i) {</span>
<a href="#l37.66"></a><span id="l37.66">     if (1 &lt;&lt; i == nsIAbListener.directoryRemoved) {</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineminus">-      do_check_eq(gAblSingle[i].mReceived, nsIAbListener.directoryRemoved);</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineplus">+      Assert.equal(gAblSingle[i].mReceived, nsIAbListener.directoryRemoved);</span>
<a href="#l37.69"></a><span id="l37.69">       gAblSingle[i].mReceived = 0;</span>
<a href="#l37.70"></a><span id="l37.70">     }</span>
<a href="#l37.71"></a><span id="l37.71">     else</span>
<a href="#l37.72"></a><span id="l37.72" class="difflineminus">-      do_check_eq(gAblSingle[i].mReceived, 0);</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineplus">+      Assert.equal(gAblSingle[i].mReceived, 0);</span>
<a href="#l37.74"></a><span id="l37.74">   }</span>
<a href="#l37.75"></a><span id="l37.75"> }</span>
<a href="#l37.76"></a><span id="l37.76"> </span>
<a href="#l37.77"></a><span id="l37.77"> function run_test() {</span>
<a href="#l37.78"></a><span id="l37.78">   var i;</span>
<a href="#l37.79"></a><span id="l37.79"> </span>
<a href="#l37.80"></a><span id="l37.80">   // Set up listeners</span>
<a href="#l37.81"></a><span id="l37.81">   gAblAll = new abL;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbManager3.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbManager3.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -34,40 +34,40 @@ abListener.prototype = {</span>
<a href="#l38.4"></a><span id="l38.4">     this.mReceived = 0;</span>
<a href="#l38.5"></a><span id="l38.5">     this.mDirectory = null;</span>
<a href="#l38.6"></a><span id="l38.6">   }</span>
<a href="#l38.7"></a><span id="l38.7"> }</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9"> function addDirectory(dirName) {</span>
<a href="#l38.10"></a><span id="l38.10">   MailServices.ab.newAddressBook(dirName, &quot;&quot;, kPABData.dirType);</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  do_check_eq(gAbListener.mReceived, Ci.nsIAbListener.itemAdded);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  Assert.equal(gAbListener.mReceived, Ci.nsIAbListener.itemAdded);</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15">   let newDirectory = gAbListener.mDirectory.QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineminus">-  do_check_eq(newDirectory.dirName, dirName);</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineplus">+  Assert.equal(newDirectory.dirName, dirName);</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19">   gAbListener.reset();</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">   return newDirectory;</span>
<a href="#l38.22"></a><span id="l38.22"> }</span>
<a href="#l38.23"></a><span id="l38.23"> </span>
<a href="#l38.24"></a><span id="l38.24"> function renameDirectory(directory, newName) {</span>
<a href="#l38.25"></a><span id="l38.25">   directory.dirName = newName;</span>
<a href="#l38.26"></a><span id="l38.26"> </span>
<a href="#l38.27"></a><span id="l38.27" class="difflineminus">-  do_check_eq(gAbListener.mReceived, Ci.nsIAbListener.itemChanged);</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">-  do_check_eq(gAbListener.mDirectory, directory);</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+  Assert.equal(gAbListener.mReceived, Ci.nsIAbListener.itemChanged);</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineplus">+  Assert.equal(gAbListener.mDirectory, directory);</span>
<a href="#l38.31"></a><span id="l38.31"> </span>
<a href="#l38.32"></a><span id="l38.32">   gAbListener.reset();</span>
<a href="#l38.33"></a><span id="l38.33"> }</span>
<a href="#l38.34"></a><span id="l38.34"> </span>
<a href="#l38.35"></a><span id="l38.35"> function removeDirectory(directory) {</span>
<a href="#l38.36"></a><span id="l38.36">   MailServices.ab.deleteAddressBook(directory.URI);</span>
<a href="#l38.37"></a><span id="l38.37"> </span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-  do_check_eq(gAbListener.mReceived, Ci.nsIAbListener.directoryRemoved);</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-  do_check_eq(gAbListener.mDirectory, directory.QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineplus">+  Assert.equal(gAbListener.mReceived, Ci.nsIAbListener.directoryRemoved);</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineplus">+  Assert.equal(gAbListener.mDirectory, directory.QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l38.42"></a><span id="l38.42"> </span>
<a href="#l38.43"></a><span id="l38.43">   gAbListener.reset();</span>
<a href="#l38.44"></a><span id="l38.44"> }</span>
<a href="#l38.45"></a><span id="l38.45"> </span>
<a href="#l38.46"></a><span id="l38.46"> /**</span>
<a href="#l38.47"></a><span id="l38.47">  * Create 4 addressbooks (directories). Rename the second one and delete</span>
<a href="#l38.48"></a><span id="l38.48">  * the third one. Check if their names are still correct. (bug 745664)</span>
<a href="#l38.49"></a><span id="l38.49">  */</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineat">@@ -83,18 +83,18 @@ function run_test() {</span>
<a href="#l38.51"></a><span id="l38.51"> </span>
<a href="#l38.52"></a><span id="l38.52">   for (let dirName of dirNames) {</span>
<a href="#l38.53"></a><span id="l38.53">     directories.push(addDirectory(dirName));</span>
<a href="#l38.54"></a><span id="l38.54">   }</span>
<a href="#l38.55"></a><span id="l38.55"> </span>
<a href="#l38.56"></a><span id="l38.56">   dirNames[1] = &quot;newTestAb1&quot;;</span>
<a href="#l38.57"></a><span id="l38.57">   renameDirectory(directories[1], dirNames[1]);</span>
<a href="#l38.58"></a><span id="l38.58">   for (let dir in dirNames) {</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-    do_check_eq(dirNames[dir], directories[dir].dirName);</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+    Assert.equal(dirNames[dir], directories[dir].dirName);</span>
<a href="#l38.61"></a><span id="l38.61">   }</span>
<a href="#l38.62"></a><span id="l38.62">   removeDirectory(directories[2]);</span>
<a href="#l38.63"></a><span id="l38.63">   dirNames.splice(2, 1);</span>
<a href="#l38.64"></a><span id="l38.64">   directories.splice(2, 1);</span>
<a href="#l38.65"></a><span id="l38.65"> </span>
<a href="#l38.66"></a><span id="l38.66">   for (let dir in dirNames) {</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineminus">-    do_check_eq(dirNames[dir], directories[dir].dirName);</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+    Assert.equal(dirNames[dir], directories[dir].dirName);</span>
<a href="#l38.69"></a><span id="l38.69">   }</span>
<a href="#l38.70"></a><span id="l38.70"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -28,48 +28,48 @@ function run_test() {</span>
<a href="#l39.4"></a><span id="l39.4">     tempCard = childCards.getNext();</span>
<a href="#l39.5"></a><span id="l39.5"> </span>
<a href="#l39.6"></a><span id="l39.6">     // We want the one with the right email...</span>
<a href="#l39.7"></a><span id="l39.7">     if (tempCard instanceof Components.interfaces.nsIAbCard &amp;&amp;</span>
<a href="#l39.8"></a><span id="l39.8">         tempCard.primaryEmail == &quot;PrimaryEmail1@test.invalid&quot;)</span>
<a href="#l39.9"></a><span id="l39.9">       fullCard = tempCard;</span>
<a href="#l39.10"></a><span id="l39.10">   }</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  do_check_true(fullCard != null);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+  Assert.ok(fullCard != null);</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">   // Test - VCard.</span>
<a href="#l39.16"></a><span id="l39.16"> </span>
<a href="#l39.17"></a><span id="l39.17" class="difflineminus">-  do_check_eq(fullCard.translateTo(&quot;vcard&quot;),</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineminus">-              &quot;begin%3Avcard%0D%0Afn%3ADisplayName1%0D%0An%3ALastName1%3BFirstName1%0D%0Aorg%3AOrganization1%3BDepartment1%0D%0Aadr%3AWorkAddress21%3B%3BWorkAddress1%3BWorkCity1%3BWorkState1%3BWorkZipCode1%3BWorkCountry1%0D%0Aemail%3Binternet%3APrimaryEmail1%40test.invalid%0D%0Atitle%3AJobTitle1%0D%0Atel%3Bwork%3AWorkPhone1%0D%0Atel%3Bfax%3AFaxNumber1%0D%0Atel%3Bpager%3APagerNumber1%0D%0Atel%3Bhome%3AHomePhone1%0D%0Atel%3Bcell%3ACellularNumber1%0D%0Anote%3ANotes1%0D%0Aurl%3Ahttp%3A//WebPage21%0D%0Aversion%3A2.1%0D%0Aend%3Avcard%0D%0A%0D%0A&quot;);</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineplus">+  Assert.equal(fullCard.translateTo(&quot;vcard&quot;),</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineplus">+               &quot;begin%3Avcard%0D%0Afn%3ADisplayName1%0D%0An%3ALastName1%3BFirstName1%0D%0Aorg%3AOrganization1%3BDepartment1%0D%0Aadr%3AWorkAddress21%3B%3BWorkAddress1%3BWorkCity1%3BWorkState1%3BWorkZipCode1%3BWorkCountry1%0D%0Aemail%3Binternet%3APrimaryEmail1%40test.invalid%0D%0Atitle%3AJobTitle1%0D%0Atel%3Bwork%3AWorkPhone1%0D%0Atel%3Bfax%3AFaxNumber1%0D%0Atel%3Bpager%3APagerNumber1%0D%0Atel%3Bhome%3AHomePhone1%0D%0Atel%3Bcell%3ACellularNumber1%0D%0Anote%3ANotes1%0D%0Aurl%3Ahttp%3A//WebPage21%0D%0Aversion%3A2.1%0D%0Aend%3Avcard%0D%0A%0D%0A&quot;);</span>
<a href="#l39.21"></a><span id="l39.21"> </span>
<a href="#l39.22"></a><span id="l39.22">   // Test - XML</span>
<a href="#l39.23"></a><span id="l39.23"> </span>
<a href="#l39.24"></a><span id="l39.24">   // Bug 761304: Starting in TB 15, Thunderbird and SeaMonkey differ in how</span>
<a href="#l39.25"></a><span id="l39.25">   // they handle Chat / IM usernames. Unfortunately, it's not easy to multiplex</span>
<a href="#l39.26"></a><span id="l39.26">   // by appname here in XPCShell tests, so for now, we're going to make sure</span>
<a href="#l39.27"></a><span id="l39.27">   // the XML output matches what we expect from Thunderbird OR SeaMonkey. This</span>
<a href="#l39.28"></a><span id="l39.28">   // is obviously less than ideal, and we should fix this in a follow-up patch</span>
<a href="#l39.29"></a><span id="l39.29">   // in bug 761304</span>
<a href="#l39.30"></a><span id="l39.30"> </span>
<a href="#l39.31"></a><span id="l39.31">   let tbXml = &quot;&lt;GeneratedName&gt;\nDisplayName1&lt;/GeneratedName&gt;\n&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;labelrow&gt;&lt;label&gt;Display Name: &lt;/label&gt;&lt;DisplayName&gt;DisplayName1&lt;/DisplayName&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Nickname: &lt;/label&gt;&lt;NickName&gt;NickName1&lt;/NickName&gt;&lt;/labelrow&gt;&lt;PrimaryEmail&gt;PrimaryEmail1@test.invalid&lt;/PrimaryEmail&gt;&lt;SecondEmail&gt;SecondEmail1\u00D0@test.invalid&lt;/SecondEmail&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Phone&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Work: &lt;/label&gt;&lt;WorkPhone&gt;WorkPhone1&lt;/WorkPhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Home: &lt;/label&gt;&lt;HomePhone&gt;HomePhone1&lt;/HomePhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Fax: &lt;/label&gt;&lt;FaxNumber&gt;FaxNumber1&lt;/FaxNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Pager: &lt;/label&gt;&lt;PagerNumber&gt;PagerNumber1&lt;/PagerNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Mobile: &lt;/label&gt;&lt;CellularNumber&gt;CellularNumber1&lt;/CellularNumber&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Other&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Custom 1: &lt;/label&gt;&lt;Custom1&gt;Custom11&lt;/Custom1&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 2: &lt;/label&gt;&lt;Custom2&gt;Custom21&lt;/Custom2&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 3: &lt;/label&gt;&lt;Custom3&gt;Custom31&lt;/Custom3&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 4: &lt;/label&gt;&lt;Custom4&gt;Custom41&lt;/Custom4&gt;&lt;/labelrow&gt;&lt;Notes&gt;Notes1&lt;/Notes&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Chat&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;AIM: &lt;/label&gt;&lt;_AimScreenName&gt;ScreenName1&lt;/_AimScreenName&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;/td&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Home&lt;/sectiontitle&gt;&lt;HomeAddress&gt;HomeAddress11&lt;/HomeAddress&gt;&lt;HomeAddress2&gt;HomeAddress21&lt;/HomeAddress2&gt;&lt;HomeCity&gt;HomeCity1&lt;/HomeCity&gt;, &lt;HomeState&gt;HomeState1&lt;/HomeState&gt; &lt;HomeZipCode&gt;HomeZipCode1&lt;/HomeZipCode&gt;&lt;HomeCountry&gt;HomeCountry1&lt;/HomeCountry&gt;&lt;WebPage2&gt;http://WebPage11&lt;/WebPage2&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Work&lt;/sectiontitle&gt;&lt;JobTitle&gt;JobTitle1&lt;/JobTitle&gt;&lt;Department&gt;Department1&lt;/Department&gt;&lt;Company&gt;Organization1&lt;/Company&gt;&lt;WorkAddress&gt;WorkAddress1&lt;/WorkAddress&gt;&lt;WorkAddress2&gt;WorkAddress21&lt;/WorkAddress2&gt;&lt;WorkCity&gt;WorkCity1&lt;/WorkCity&gt;, &lt;WorkState&gt;WorkState1&lt;/WorkState&gt; &lt;WorkZipCode&gt;WorkZipCode1&lt;/WorkZipCode&gt;&lt;WorkCountry&gt;WorkCountry1&lt;/WorkCountry&gt;&lt;WebPage1&gt;http://WebPage21&lt;/WebPage1&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;;</span>
<a href="#l39.32"></a><span id="l39.32"> </span>
<a href="#l39.33"></a><span id="l39.33">   let smXml = &quot;&lt;GeneratedName&gt;\nDisplayName1&lt;/GeneratedName&gt;\n&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;labelrow&gt;&lt;label&gt;Display Name: &lt;/label&gt;&lt;DisplayName&gt;DisplayName1&lt;/DisplayName&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Nickname: &lt;/label&gt;&lt;NickName&gt;NickName1&lt;/NickName&gt;&lt;/labelrow&gt;&lt;PrimaryEmail&gt;PrimaryEmail1@test.invalid&lt;/PrimaryEmail&gt;&lt;SecondEmail&gt;SecondEmail1\u00D0@test.invalid&lt;/SecondEmail&gt;&lt;labelrow&gt;&lt;label&gt;Screen Name: &lt;/label&gt;&lt;_AimScreenName&gt;ScreenName1&lt;/_AimScreenName&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Phone&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Work: &lt;/label&gt;&lt;WorkPhone&gt;WorkPhone1&lt;/WorkPhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Home: &lt;/label&gt;&lt;HomePhone&gt;HomePhone1&lt;/HomePhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Fax: &lt;/label&gt;&lt;FaxNumber&gt;FaxNumber1&lt;/FaxNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Pager: &lt;/label&gt;&lt;PagerNumber&gt;PagerNumber1&lt;/PagerNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Mobile: &lt;/label&gt;&lt;CellularNumber&gt;CellularNumber1&lt;/CellularNumber&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Other&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Custom 1: &lt;/label&gt;&lt;Custom1&gt;Custom11&lt;/Custom1&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 2: &lt;/label&gt;&lt;Custom2&gt;Custom21&lt;/Custom2&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 3: &lt;/label&gt;&lt;Custom3&gt;Custom31&lt;/Custom3&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 4: &lt;/label&gt;&lt;Custom4&gt;Custom41&lt;/Custom4&gt;&lt;/labelrow&gt;&lt;Notes&gt;Notes1&lt;/Notes&gt;&lt;/section&gt;&lt;/td&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Home&lt;/sectiontitle&gt;&lt;HomeAddress&gt;HomeAddress11&lt;/HomeAddress&gt;&lt;HomeAddress2&gt;HomeAddress21&lt;/HomeAddress2&gt;&lt;HomeCity&gt;HomeCity1&lt;/HomeCity&gt;, &lt;HomeState&gt;HomeState1&lt;/HomeState&gt; &lt;HomeZipCode&gt;HomeZipCode1&lt;/HomeZipCode&gt;&lt;HomeCountry&gt;HomeCountry1&lt;/HomeCountry&gt;&lt;WebPage2&gt;http://WebPage11&lt;/WebPage2&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Work&lt;/sectiontitle&gt;&lt;JobTitle&gt;JobTitle1&lt;/JobTitle&gt;&lt;Department&gt;Department1&lt;/Department&gt;&lt;Company&gt;Organization1&lt;/Company&gt;&lt;WorkAddress&gt;WorkAddress1&lt;/WorkAddress&gt;&lt;WorkAddress2&gt;WorkAddress21&lt;/WorkAddress2&gt;&lt;WorkCity&gt;WorkCity1&lt;/WorkCity&gt;, &lt;WorkState&gt;WorkState1&lt;/WorkState&gt; &lt;WorkZipCode&gt;WorkZipCode1&lt;/WorkZipCode&gt;&lt;WorkCountry&gt;WorkCountry1&lt;/WorkCountry&gt;&lt;WebPage1&gt;http://WebPage21&lt;/WebPage1&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;;</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35">   let XmlTrans = fullCard.translateTo(&quot;xml&quot;);</span>
<a href="#l39.36"></a><span id="l39.36" class="difflineminus">-  do_check_true(XmlTrans == tbXml || XmlTrans == smXml);</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineplus">+  Assert.ok(XmlTrans == tbXml || XmlTrans == smXml);</span>
<a href="#l39.38"></a><span id="l39.38"> </span>
<a href="#l39.39"></a><span id="l39.39">   // Test - base 64</span>
<a href="#l39.40"></a><span id="l39.40"> </span>
<a href="#l39.41"></a><span id="l39.41">   // Bug 761304: The situation here is the same as for XML with respect to the</span>
<a href="#l39.42"></a><span id="l39.42">   // difference between Thunderbird and SeaMonkey. We'll deal with this in a</span>
<a href="#l39.43"></a><span id="l39.43">   // follow-up to bug 761304.</span>
<a href="#l39.44"></a><span id="l39.44"> </span>
<a href="#l39.45"></a><span id="l39.45">   // btoa is only available for xpcom components or via window.btoa, so we</span>
<a href="#l39.46"></a><span id="l39.46">   // can't use it here.</span>
<a href="#l39.47"></a><span id="l39.47"> </span>
<a href="#l39.48"></a><span id="l39.48">   let tbXmlBase64 = &quot;PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNocm9tZTovL21lc3NhZ2Vib2R5L2NvbnRlbnQvYWRkcmVzc2Jvb2svcHJpbnQuY3NzIj8+CjxkaXJlY3Rvcnk+Cjx0aXRsZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+QWRkcmVzcyBCb29rPC90aXRsZT4KPEdlbmVyYXRlZE5hbWU+CkRpc3BsYXlOYW1lMTwvR2VuZXJhdGVkTmFtZT4KPHRhYmxlPjx0cj48dGQ+PHNlY3Rpb24+PGxhYmVscm93PjxsYWJlbD5EaXNwbGF5IE5hbWU6IDwvbGFiZWw+PERpc3BsYXlOYW1lPkRpc3BsYXlOYW1lMTwvRGlzcGxheU5hbWU+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPk5pY2tuYW1lOiA8L2xhYmVsPjxOaWNrTmFtZT5OaWNrTmFtZTE8L05pY2tOYW1lPjwvbGFiZWxyb3c+PFByaW1hcnlFbWFpbD5QcmltYXJ5RW1haWwxQHRlc3QuaW52YWxpZDwvUHJpbWFyeUVtYWlsPjxTZWNvbmRFbWFpbD5TZWNvbmRFbWFpbDHDkEB0ZXN0LmludmFsaWQ8L1NlY29uZEVtYWlsPjwvc2VjdGlvbj48L3RkPjwvdHI+PHRyPjx0ZD48c2VjdGlvbj48c2VjdGlvbnRpdGxlPlBob25lPC9zZWN0aW9udGl0bGU+PGxhYmVscm93PjxsYWJlbD5Xb3JrOiA8L2xhYmVsPjxXb3JrUGhvbmU+V29ya1Bob25lMTwvV29ya1Bob25lPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5Ib21lOiA8L2xhYmVsPjxIb21lUGhvbmU+SG9tZVBob25lMTwvSG9tZVBob25lPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5GYXg6IDwvbGFiZWw+PEZheE51bWJlcj5GYXhOdW1iZXIxPC9GYXhOdW1iZXI+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPlBhZ2VyOiA8L2xhYmVsPjxQYWdlck51bWJlcj5QYWdlck51bWJlcjE8L1BhZ2VyTnVtYmVyPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5Nb2JpbGU6IDwvbGFiZWw+PENlbGx1bGFyTnVtYmVyPkNlbGx1bGFyTnVtYmVyMTwvQ2VsbHVsYXJOdW1iZXI+PC9sYWJlbHJvdz48L3NlY3Rpb24+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5PdGhlcjwvc2VjdGlvbnRpdGxlPjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDE6IDwvbGFiZWw+PEN1c3RvbTE+Q3VzdG9tMTE8L0N1c3RvbTE+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPkN1c3RvbSAyOiA8L2xhYmVsPjxDdXN0b20yPkN1c3RvbTIxPC9DdXN0b20yPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5DdXN0b20gMzogPC9sYWJlbD48Q3VzdG9tMz5DdXN0b20zMTwvQ3VzdG9tMz48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDQ6IDwvbGFiZWw+PEN1c3RvbTQ+Q3VzdG9tNDE8L0N1c3RvbTQ+PC9sYWJlbHJvdz48Tm90ZXM+Tm90ZXMxPC9Ob3Rlcz48L3NlY3Rpb24+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5DaGF0PC9zZWN0aW9udGl0bGU+PGxhYmVscm93PjxsYWJlbD5BSU06IDwvbGFiZWw+PF9BaW1TY3JlZW5OYW1lPlNjcmVlbk5hbWUxPC9fQWltU2NyZWVuTmFtZT48L2xhYmVscm93Pjwvc2VjdGlvbj48L3RkPjx0ZD48c2VjdGlvbj48c2VjdGlvbnRpdGxlPkhvbWU8L3NlY3Rpb250aXRsZT48SG9tZUFkZHJlc3M+SG9tZUFkZHJlc3MxMTwvSG9tZUFkZHJlc3M+PEhvbWVBZGRyZXNzMj5Ib21lQWRkcmVzczIxPC9Ib21lQWRkcmVzczI+PEhvbWVDaXR5PkhvbWVDaXR5MTwvSG9tZUNpdHk+LCA8SG9tZVN0YXRlPkhvbWVTdGF0ZTE8L0hvbWVTdGF0ZT4gPEhvbWVaaXBDb2RlPkhvbWVaaXBDb2RlMTwvSG9tZVppcENvZGU+PEhvbWVDb3VudHJ5PkhvbWVDb3VudHJ5MTwvSG9tZUNvdW50cnk+PFdlYlBhZ2UyPmh0dHA6Ly9XZWJQYWdlMTE8L1dlYlBhZ2UyPjwvc2VjdGlvbj48c2VjdGlvbj48c2VjdGlvbnRpdGxlPldvcms8L3NlY3Rpb250aXRsZT48Sm9iVGl0bGU+Sm9iVGl0bGUxPC9Kb2JUaXRsZT48RGVwYXJ0bWVudD5EZXBhcnRtZW50MTwvRGVwYXJ0bWVudD48Q29tcGFueT5Pcmdhbml6YXRpb24xPC9Db21wYW55PjxXb3JrQWRkcmVzcz5Xb3JrQWRkcmVzczE8L1dvcmtBZGRyZXNzPjxXb3JrQWRkcmVzczI+V29ya0FkZHJlc3MyMTwvV29ya0FkZHJlc3MyPjxXb3JrQ2l0eT5Xb3JrQ2l0eTE8L1dvcmtDaXR5PiwgPFdvcmtTdGF0ZT5Xb3JrU3RhdGUxPC9Xb3JrU3RhdGU+IDxXb3JrWmlwQ29kZT5Xb3JrWmlwQ29kZTE8L1dvcmtaaXBDb2RlPjxXb3JrQ291bnRyeT5Xb3JrQ291bnRyeTE8L1dvcmtDb3VudHJ5PjxXZWJQYWdlMT5odHRwOi8vV2ViUGFnZTIxPC9XZWJQYWdlMT48L3NlY3Rpb24+PC90ZD48L3RyPjwvdGFibGU+PC9kaXJlY3Rvcnk+Cg==&quot;;</span>
<a href="#l39.49"></a><span id="l39.49"> </span>
<a href="#l39.50"></a><span id="l39.50">   let smXmlBase64 = &quot;PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNocm9tZTovL21lc3NhZ2Vib2R5L2NvbnRlbnQvYWRkcmVzc2Jvb2svcHJpbnQuY3NzIj8+CjxkaXJlY3Rvcnk+Cjx0aXRsZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+QWRkcmVzcyBCb29rPC90aXRsZT4KPEdlbmVyYXRlZE5hbWU+CkRpc3BsYXlOYW1lMTwvR2VuZXJhdGVkTmFtZT4KPHRhYmxlPjx0cj48dGQ+PHNlY3Rpb24+PGxhYmVscm93PjxsYWJlbD5EaXNwbGF5IE5hbWU6IDwvbGFiZWw+PERpc3BsYXlOYW1lPkRpc3BsYXlOYW1lMTwvRGlzcGxheU5hbWU+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPk5pY2tuYW1lOiA8L2xhYmVsPjxOaWNrTmFtZT5OaWNrTmFtZTE8L05pY2tOYW1lPjwvbGFiZWxyb3c+PFByaW1hcnlFbWFpbD5QcmltYXJ5RW1haWwxQHRlc3QuaW52YWxpZDwvUHJpbWFyeUVtYWlsPjxTZWNvbmRFbWFpbD5TZWNvbmRFbWFpbDHDkEB0ZXN0LmludmFsaWQ8L1NlY29uZEVtYWlsPjxsYWJlbHJvdz48bGFiZWw+U2NyZWVuIE5hbWU6IDwvbGFiZWw+PF9BaW1TY3JlZW5OYW1lPlNjcmVlbk5hbWUxPC9fQWltU2NyZWVuTmFtZT48L2xhYmVscm93Pjwvc2VjdGlvbj48L3RkPjwvdHI+PHRyPjx0ZD48c2VjdGlvbj48c2VjdGlvbnRpdGxlPlBob25lPC9zZWN0aW9udGl0bGU+PGxhYmVscm93PjxsYWJlbD5Xb3JrOiA8L2xhYmVsPjxXb3JrUGhvbmU+V29ya1Bob25lMTwvV29ya1Bob25lPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5Ib21lOiA8L2xhYmVsPjxIb21lUGhvbmU+SG9tZVBob25lMTwvSG9tZVBob25lPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5GYXg6IDwvbGFiZWw+PEZheE51bWJlcj5GYXhOdW1iZXIxPC9GYXhOdW1iZXI+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPlBhZ2VyOiA8L2xhYmVsPjxQYWdlck51bWJlcj5QYWdlck51bWJlcjE8L1BhZ2VyTnVtYmVyPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5Nb2JpbGU6IDwvbGFiZWw+PENlbGx1bGFyTnVtYmVyPkNlbGx1bGFyTnVtYmVyMTwvQ2VsbHVsYXJOdW1iZXI+PC9sYWJlbHJvdz48L3NlY3Rpb24+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5PdGhlcjwvc2VjdGlvbnRpdGxlPjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDE6IDwvbGFiZWw+PEN1c3RvbTE+Q3VzdG9tMTE8L0N1c3RvbTE+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPkN1c3RvbSAyOiA8L2xhYmVsPjxDdXN0b20yPkN1c3RvbTIxPC9DdXN0b20yPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5DdXN0b20gMzogPC9sYWJlbD48Q3VzdG9tMz5DdXN0b20zMTwvQ3VzdG9tMz48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDQ6IDwvbGFiZWw+PEN1c3RvbTQ+Q3VzdG9tNDE8L0N1c3RvbTQ+PC9sYWJlbHJvdz48Tm90ZXM+Tm90ZXMxPC9Ob3Rlcz48L3NlY3Rpb24+PC90ZD48dGQ+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5Ib21lPC9zZWN0aW9udGl0bGU+PEhvbWVBZGRyZXNzPkhvbWVBZGRyZXNzMTE8L0hvbWVBZGRyZXNzPjxIb21lQWRkcmVzczI+SG9tZUFkZHJlc3MyMTwvSG9tZUFkZHJlc3MyPjxIb21lQ2l0eT5Ib21lQ2l0eTE8L0hvbWVDaXR5PiwgPEhvbWVTdGF0ZT5Ib21lU3RhdGUxPC9Ib21lU3RhdGU+IDxIb21lWmlwQ29kZT5Ib21lWmlwQ29kZTE8L0hvbWVaaXBDb2RlPjxIb21lQ291bnRyeT5Ib21lQ291bnRyeTE8L0hvbWVDb3VudHJ5PjxXZWJQYWdlMj5odHRwOi8vV2ViUGFnZTExPC9XZWJQYWdlMj48L3NlY3Rpb24+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5Xb3JrPC9zZWN0aW9udGl0bGU+PEpvYlRpdGxlPkpvYlRpdGxlMTwvSm9iVGl0bGU+PERlcGFydG1lbnQ+RGVwYXJ0bWVudDE8L0RlcGFydG1lbnQ+PENvbXBhbnk+T3JnYW5pemF0aW9uMTwvQ29tcGFueT48V29ya0FkZHJlc3M+V29ya0FkZHJlc3MxPC9Xb3JrQWRkcmVzcz48V29ya0FkZHJlc3MyPldvcmtBZGRyZXNzMjE8L1dvcmtBZGRyZXNzMj48V29ya0NpdHk+V29ya0NpdHkxPC9Xb3JrQ2l0eT4sIDxXb3JrU3RhdGU+V29ya1N0YXRlMTwvV29ya1N0YXRlPiA8V29ya1ppcENvZGU+V29ya1ppcENvZGUxPC9Xb3JrWmlwQ29kZT48V29ya0NvdW50cnk+V29ya0NvdW50cnkxPC9Xb3JrQ291bnRyeT48V2ViUGFnZTE+aHR0cDovL1dlYlBhZ2UyMTwvV2ViUGFnZTE+PC9zZWN0aW9uPjwvdGQ+PC90cj48L3RhYmxlPjwvZGlyZWN0b3J5Pgo=&quot;;</span>
<a href="#l39.51"></a><span id="l39.51"> </span>
<a href="#l39.52"></a><span id="l39.52">   let XmlBase64Trans = fullCard.translateTo(&quot;base64xml&quot;);</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54" class="difflineminus">-  do_check_true(XmlBase64Trans == tbXmlBase64 || XmlBase64Trans == smXmlBase64);</span>
<a href="#l39.55"></a><span id="l39.55" class="difflineplus">+  Assert.ok(XmlBase64Trans == tbXmlBase64 || XmlBase64Trans == smXmlBase64);</span>
<a href="#l39.56"></a><span id="l39.56"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_uuid.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_uuid.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -13,110 +13,110 @@ function check_directory(directory) {</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5">   var testModification = !directory.readOnly;</span>
<a href="#l40.6"></a><span id="l40.6">   dump(&quot;Testing &quot; + prefId);</span>
<a href="#l40.7"></a><span id="l40.7">   if (testModification)</span>
<a href="#l40.8"></a><span id="l40.8">     dump(&quot; (with modifications)&quot;);</span>
<a href="#l40.9"></a><span id="l40.9">   dump(&quot;...\n&quot;);</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11">   // Question 1: Is the UUID the preference ID?</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  do_check_eq(prefId, directory.uuid);</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  Assert.equal(prefId, directory.uuid);</span>
<a href="#l40.14"></a><span id="l40.14"> </span>
<a href="#l40.15"></a><span id="l40.15">   // Now we need to run through the cards, checking that each card meets the</span>
<a href="#l40.16"></a><span id="l40.16">   // requirements.</span>
<a href="#l40.17"></a><span id="l40.17">   var seenIds = [], cards = [];</span>
<a href="#l40.18"></a><span id="l40.18">   var enumerator = directory.childCards;</span>
<a href="#l40.19"></a><span id="l40.19">   while (enumerator.hasMoreElements()) {</span>
<a href="#l40.20"></a><span id="l40.20">     var card = enumerator.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l40.21"></a><span id="l40.21">     cards.push(card);</span>
<a href="#l40.22"></a><span id="l40.22"> </span>
<a href="#l40.23"></a><span id="l40.23">     // Question 2.1: Is the directory ID correct?</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineminus">-    do_check_eq(prefId, card.directoryId);</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineplus">+    Assert.equal(prefId, card.directoryId);</span>
<a href="#l40.26"></a><span id="l40.26"> </span>
<a href="#l40.27"></a><span id="l40.27">     // Question 2.2: Is the local ID unique and valid?</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineminus">-    do_check_neq(card.localId, &quot;&quot;);</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineminus">-    do_check_eq(seenIds.indexOf(card.localId), -1);</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineplus">+    Assert.notEqual(card.localId, &quot;&quot;);</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+    Assert.equal(seenIds.indexOf(card.localId), -1);</span>
<a href="#l40.32"></a><span id="l40.32">     seenIds.push(card.localId);</span>
<a href="#l40.33"></a><span id="l40.33"> </span>
<a href="#l40.34"></a><span id="l40.34">     // Question 2.3: Is the format equal to generateUUID?</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineminus">-    do_check_eq(card.uuid, MailServices.ab.generateUUID(prefId, card.localId));</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineplus">+    Assert.equal(card.uuid, MailServices.ab.generateUUID(prefId, card.localId));</span>
<a href="#l40.37"></a><span id="l40.37">   }</span>
<a href="#l40.38"></a><span id="l40.38"> </span>
<a href="#l40.39"></a><span id="l40.39">   // Question 3: Do cards returned via searches return UUIDs correctly?</span>
<a href="#l40.40"></a><span id="l40.40">   var uri = directory.URI;</span>
<a href="#l40.41"></a><span id="l40.41">   uri += &quot;?(or(DisplayName,=,a)(DisplayName,!=,a))&quot;;</span>
<a href="#l40.42"></a><span id="l40.42">   let search = MailServices.ab.getDirectory(uri);</span>
<a href="#l40.43"></a><span id="l40.43"> </span>
<a href="#l40.44"></a><span id="l40.44">   enumerator = search.childCards;</span>
<a href="#l40.45"></a><span id="l40.45">   while (enumerator.hasMoreElements()) {</span>
<a href="#l40.46"></a><span id="l40.46">     var card = enumerator.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l40.47"></a><span id="l40.47"> </span>
<a href="#l40.48"></a><span id="l40.48">     // Question 3.1: Is the directory ID correct?</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineminus">-    do_check_eq(prefId, card.directoryId);</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineplus">+    Assert.equal(prefId, card.directoryId);</span>
<a href="#l40.51"></a><span id="l40.51"> </span>
<a href="#l40.52"></a><span id="l40.52">     // Question 3.2: Is the local ID valid?</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineminus">-    do_check_neq(card.localId, &quot;&quot;);</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineplus">+    Assert.notEqual(card.localId, &quot;&quot;);</span>
<a href="#l40.55"></a><span id="l40.55"> </span>
<a href="#l40.56"></a><span id="l40.56">     // Question 3.3: Is the format equal to generateUUID?</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineminus">-    do_check_eq(card.uuid, MailServices.ab.generateUUID(prefId, card.localId));</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineplus">+    Assert.equal(card.uuid, MailServices.ab.generateUUID(prefId, card.localId));</span>
<a href="#l40.59"></a><span id="l40.59">   }</span>
<a href="#l40.60"></a><span id="l40.60"> </span>
<a href="#l40.61"></a><span id="l40.61">   // The remaining tests deal with modification of address books.</span>
<a href="#l40.62"></a><span id="l40.62">   if (!testModification)</span>
<a href="#l40.63"></a><span id="l40.63">     return;</span>
<a href="#l40.64"></a><span id="l40.64"> </span>
<a href="#l40.65"></a><span id="l40.65">   // Question 4: Does adding a new card properly set the UUID?</span>
<a href="#l40.66"></a><span id="l40.66">   var newCard = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;]</span>
<a href="#l40.67"></a><span id="l40.67">                   .createInstance(Ci.nsIAbCard);</span>
<a href="#l40.68"></a><span id="l40.68">   newCard.displayName = &quot;Test User&quot;;</span>
<a href="#l40.69"></a><span id="l40.69">   newCard.primaryEmail = &quot;user1@test.invalid&quot;;</span>
<a href="#l40.70"></a><span id="l40.70">   newCard.firstName = &quot;Test&quot;;</span>
<a href="#l40.71"></a><span id="l40.71">   newCard.lastName = &quot;User&quot;;</span>
<a href="#l40.72"></a><span id="l40.72"> </span>
<a href="#l40.73"></a><span id="l40.73">   newCard = directory.addCard(newCard);</span>
<a href="#l40.74"></a><span id="l40.74" class="difflineminus">-  do_check_eq(newCard.directoryId, prefId);</span>
<a href="#l40.75"></a><span id="l40.75" class="difflineminus">-  do_check_neq(newCard.localId, &quot;&quot;);</span>
<a href="#l40.76"></a><span id="l40.76" class="difflineminus">-  do_check_eq(seenIds.indexOf(newCard.localId), -1);</span>
<a href="#l40.77"></a><span id="l40.77" class="difflineplus">+  Assert.equal(newCard.directoryId, prefId);</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineplus">+  Assert.notEqual(newCard.localId, &quot;&quot;);</span>
<a href="#l40.79"></a><span id="l40.79" class="difflineplus">+  Assert.equal(seenIds.indexOf(newCard.localId), -1);</span>
<a href="#l40.80"></a><span id="l40.80"> </span>
<a href="#l40.81"></a><span id="l40.81">   // Remove the new card to be stable!</span>
<a href="#l40.82"></a><span id="l40.82">   var array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l40.83"></a><span id="l40.83">   array.appendElement(newCard);</span>
<a href="#l40.84"></a><span id="l40.84">   directory.deleteCards(array);</span>
<a href="#l40.85"></a><span id="l40.85"> </span>
<a href="#l40.86"></a><span id="l40.86">   // We need to iterate over the array of cards to avoid any problems if someone</span>
<a href="#l40.87"></a><span id="l40.87">   // makes the childCards enumerator reflect changes to directory...</span>
<a href="#l40.88"></a><span id="l40.88">   for (var card of cards) {</span>
<a href="#l40.89"></a><span id="l40.89">     // Question 5.1: Does deleting a card properly set the uids?</span>
<a href="#l40.90"></a><span id="l40.90">     var localId = card.localId;</span>
<a href="#l40.91"></a><span id="l40.91">     array.clear();</span>
<a href="#l40.92"></a><span id="l40.92">     array.appendElement(card);</span>
<a href="#l40.93"></a><span id="l40.93">     directory.deleteCards(array);</span>
<a href="#l40.94"></a><span id="l40.94" class="difflineminus">-    do_check_eq(card.directoryId, &quot;&quot;);</span>
<a href="#l40.95"></a><span id="l40.95" class="difflineminus">-    do_check_eq(card.localId, localId);</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineplus">+    Assert.equal(card.directoryId, &quot;&quot;);</span>
<a href="#l40.97"></a><span id="l40.97" class="difflineplus">+    Assert.equal(card.localId, localId);</span>
<a href="#l40.98"></a><span id="l40.98"> </span>
<a href="#l40.99"></a><span id="l40.99">     // Question 5.2: Does readding a card try to best-fit the uid?</span>
<a href="#l40.100"></a><span id="l40.100">     card = directory.addCard(card);</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineminus">-    do_check_eq(card.directoryId, prefId);</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineminus">-    do_check_eq(card.localId, localId);</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineplus">+    Assert.equal(card.directoryId, prefId);</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineplus">+    Assert.equal(card.localId, localId);</span>
<a href="#l40.105"></a><span id="l40.105">   }</span>
<a href="#l40.106"></a><span id="l40.106"> }</span>
<a href="#l40.107"></a><span id="l40.107"> </span>
<a href="#l40.108"></a><span id="l40.108"> function run_test() {</span>
<a href="#l40.109"></a><span id="l40.109">   // Preliminary: we need a directory for local tests</span>
<a href="#l40.110"></a><span id="l40.110">   var testAB = do_get_file(&quot;data/cardForEmail.mab&quot;);</span>
<a href="#l40.111"></a><span id="l40.111"> </span>
<a href="#l40.112"></a><span id="l40.112">   // Copy the file to the profile directory for a PAB</span>
<a href="#l40.113"></a><span id="l40.113">   testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l40.114"></a><span id="l40.114"> </span>
<a href="#l40.115"></a><span id="l40.115">   // Step 1: What is the ID of an empty card?</span>
<a href="#l40.116"></a><span id="l40.116">   var newCard = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;]</span>
<a href="#l40.117"></a><span id="l40.117">                   .createInstance(Ci.nsIAbCard);</span>
<a href="#l40.118"></a><span id="l40.118" class="difflineminus">-  do_check_eq(newCard.uuid, &quot;&quot;);</span>
<a href="#l40.119"></a><span id="l40.119" class="difflineminus">-  do_check_eq(newCard.directoryId, &quot;&quot;);</span>
<a href="#l40.120"></a><span id="l40.120" class="difflineminus">-  do_check_eq(newCard.localId, &quot;&quot;);</span>
<a href="#l40.121"></a><span id="l40.121" class="difflineplus">+  Assert.equal(newCard.uuid, &quot;&quot;);</span>
<a href="#l40.122"></a><span id="l40.122" class="difflineplus">+  Assert.equal(newCard.directoryId, &quot;&quot;);</span>
<a href="#l40.123"></a><span id="l40.123" class="difflineplus">+  Assert.equal(newCard.localId, &quot;&quot;);</span>
<a href="#l40.124"></a><span id="l40.124"> </span>
<a href="#l40.125"></a><span id="l40.125">   // Step 2: Check the directories</span>
<a href="#l40.126"></a><span id="l40.126">   let dirs = MailServices.ab.directories;</span>
<a href="#l40.127"></a><span id="l40.127">   while (dirs.hasMoreElements()) {</span>
<a href="#l40.128"></a><span id="l40.128">     let directory = dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l40.129"></a><span id="l40.129">     check_directory(directory);</span>
<a href="#l40.130"></a><span id="l40.130">   }</span>
<a href="#l40.131"></a><span id="l40.131"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/base/test/unit/test_accountMgr.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_accountMgr.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -48,39 +48,39 @@ function run_test()</span>
<a href="#l41.4"></a><span id="l41.4">   Services.prefs.setCharPref(&quot;mail.accountmanager.accounts&quot;,</span>
<a href="#l41.5"></a><span id="l41.5">                              &quot;account1,account2,account4,account5,account5,account6&quot;);</span>
<a href="#l41.6"></a><span id="l41.6">   // Set the default account to one we're going to get rid of. The account</span>
<a href="#l41.7"></a><span id="l41.7">   //  manager should recover relatively gracefully.</span>
<a href="#l41.8"></a><span id="l41.8">   Services.prefs.setCharPref(&quot;mail.accountmanager.defaultaccount&quot;,</span>
<a href="#l41.9"></a><span id="l41.9">                              &quot;account6&quot;);</span>
<a href="#l41.10"></a><span id="l41.10"> </span>
<a href="#l41.11"></a><span id="l41.11">   // This will force the load of the accounts setup above.</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 3);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">-              &quot;account1,account4,account5&quot;);</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 3);</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineplus">+               &quot;account1,account4,account5&quot;);</span>
<a href="#l41.18"></a><span id="l41.18">   let server5 = MailServices.accounts.getIncomingServer(&quot;server5&quot;)</span>
<a href="#l41.19"></a><span id="l41.19">                   .QueryInterface(Ci.nsIPop3IncomingServer);</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineminus">-  do_check_eq(server5.deferredToAccount, &quot;account1&quot;);</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineplus">+  Assert.equal(server5.deferredToAccount, &quot;account1&quot;);</span>
<a href="#l41.22"></a><span id="l41.22"> </span>
<a href="#l41.23"></a><span id="l41.23">   // Just make sure this doesn't throw an exception, because we did remove the</span>
<a href="#l41.24"></a><span id="l41.24">   // default account.</span>
<a href="#l41.25"></a><span id="l41.25">   let defaultAccount = MailServices.accounts.defaultAccount;</span>
<a href="#l41.26"></a><span id="l41.26">   // GetDefaultAccount should have thrown an exception for null account.</span>
<a href="#l41.27"></a><span id="l41.27" class="difflineminus">-  do_check_neq(defaultAccount, null);</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineplus">+  Assert.notEqual(defaultAccount, null);</span>
<a href="#l41.29"></a><span id="l41.29"> </span>
<a href="#l41.30"></a><span id="l41.30">   // Remove an account, and verify that the account list pref looks OK:</span>
<a href="#l41.31"></a><span id="l41.31">   let server = MailServices.accounts.getIncomingServer(&quot;server4&quot;);</span>
<a href="#l41.32"></a><span id="l41.32"> </span>
<a href="#l41.33"></a><span id="l41.33">   // We need to get the root folder to read from the folder cache</span>
<a href="#l41.34"></a><span id="l41.34">   // before it gets removed or else we'll assert, because we're</span>
<a href="#l41.35"></a><span id="l41.35">   // not completely initialized...</span>
<a href="#l41.36"></a><span id="l41.36">   let flags = server.rootFolder.flags;</span>
<a href="#l41.37"></a><span id="l41.37"> </span>
<a href="#l41.38"></a><span id="l41.38">   MailServices.accounts.removeAccount(MailServices.accounts.FindAccountForServer(server));</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 2);</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineminus">-              &quot;account1,account5&quot;);</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 2);</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineplus">+               &quot;account1,account5&quot;);</span>
<a href="#l41.45"></a><span id="l41.45">   // make sure cleaning up duplicate accounts didn't hork accounts</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.account.account1.server&quot;),</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineminus">-              &quot;server1&quot;);</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.account.account5.server&quot;),</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineminus">-              &quot;server5&quot;);</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.account.account1.server&quot;),</span>
<a href="#l41.51"></a><span id="l41.51" class="difflineplus">+               &quot;server1&quot;);</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.account.account5.server&quot;),</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineplus">+               &quot;server5&quot;);</span>
<a href="#l41.54"></a><span id="l41.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/base/test/unit/test_accountMgrCustomTypes.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_accountMgrCustomTypes.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -32,53 +32,53 @@ function run_test()</span>
<a href="#l42.4"></a><span id="l42.4">   Services.prefs.setIntPref(&quot;mail.server.server2.secondsToLeaveUnavailable&quot;, 2);</span>
<a href="#l42.5"></a><span id="l42.5"> </span>
<a href="#l42.6"></a><span id="l42.6">   Services.prefs.setCharPref(&quot;mail.accountmanager.accounts&quot;,</span>
<a href="#l42.7"></a><span id="l42.7">                              &quot;account1,account2&quot;);</span>
<a href="#l42.8"></a><span id="l42.8">   Services.prefs.setCharPref(&quot;mail.accountmanager.defaultaccount&quot;, &quot;account1&quot;);</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10">   // This will force the load of the accounts setup above.</span>
<a href="#l42.11"></a><span id="l42.11">   // We don't see the invalid account</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 1);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 1);</span>
<a href="#l42.14"></a><span id="l42.14"> </span>
<a href="#l42.15"></a><span id="l42.15">   // but it is really there</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineminus">-              &quot;account1,account2&quot;);</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+               &quot;account1,account2&quot;);</span>
<a href="#l42.20"></a><span id="l42.20"> </span>
<a href="#l42.21"></a><span id="l42.21">   // add a new account (so that we can check if this clobbers the existing</span>
<a href="#l42.22"></a><span id="l42.22">   //  inactive account or its server)</span>
<a href="#l42.23"></a><span id="l42.23">   let newAccount = MailServices.accounts.createAccount();</span>
<a href="#l42.24"></a><span id="l42.24">   let newIdentity = MailServices.accounts.createIdentity();</span>
<a href="#l42.25"></a><span id="l42.25">   newAccount.addIdentity(newIdentity);</span>
<a href="#l42.26"></a><span id="l42.26">   newAccount.defaultIdentity = newIdentity;</span>
<a href="#l42.27"></a><span id="l42.27">   newAccount.incomingServer =</span>
<a href="#l42.28"></a><span id="l42.28">     MailServices.accounts.createIncomingServer(&quot;somename&quot;, &quot;somehost.example.com&quot;, &quot;pop3&quot;);</span>
<a href="#l42.29"></a><span id="l42.29"> </span>
<a href="#l42.30"></a><span id="l42.30">   // no collisions with the inactive account</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-  do_check_neq(newIdentity.key, &quot;id2&quot;);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineminus">-  do_check_neq(newAccount.incomingServer.key, &quot;server2&quot;);</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineminus">-  do_check_neq(newAccount.key, &quot;account2&quot;);</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 2);</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineplus">+  Assert.notEqual(newIdentity.key, &quot;id2&quot;);</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineplus">+  Assert.notEqual(newAccount.incomingServer.key, &quot;server2&quot;);</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineplus">+  Assert.notEqual(newAccount.key, &quot;account2&quot;);</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 2);</span>
<a href="#l42.39"></a><span id="l42.39"> </span>
<a href="#l42.40"></a><span id="l42.40">   MailServices.accounts.UnloadAccounts();</span>
<a href="#l42.41"></a><span id="l42.41"> </span>
<a href="#l42.42"></a><span id="l42.42">   // set the unavailable account to a valid type, and watch it appear.</span>
<a href="#l42.43"></a><span id="l42.43">   Services.prefs.setCharPref(&quot;mail.server.server2.type&quot;, &quot;pop3&quot;);</span>
<a href="#l42.44"></a><span id="l42.44" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 3);</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 3);</span>
<a href="#l42.46"></a><span id="l42.46"> </span>
<a href="#l42.47"></a><span id="l42.47">   // make it bad again, and reload it to restart the timeout before delete</span>
<a href="#l42.48"></a><span id="l42.48">   MailServices.accounts.UnloadAccounts();</span>
<a href="#l42.49"></a><span id="l42.49">   Services.prefs.setCharPref(&quot;mail.server.server2.type&quot;, &quot;invalid&quot;);</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 2);</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 2);</span>
<a href="#l42.52"></a><span id="l42.52">   MailServices.accounts.UnloadAccounts();</span>
<a href="#l42.53"></a><span id="l42.53"> </span>
<a href="#l42.54"></a><span id="l42.54">   // now let the bad type timeout, and watch it magically disappear!</span>
<a href="#l42.55"></a><span id="l42.55">   do_test_pending();</span>
<a href="#l42.56"></a><span id="l42.56">   do_timeout(3000, function () {</span>
<a href="#l42.57"></a><span id="l42.57" class="difflineminus">-    do_check_eq(MailServices.accounts.accounts.length, 2);</span>
<a href="#l42.58"></a><span id="l42.58" class="difflineplus">+    Assert.equal(MailServices.accounts.accounts.length, 2);</span>
<a href="#l42.59"></a><span id="l42.59"> </span>
<a href="#l42.60"></a><span id="l42.60">     // it is now gone</span>
<a href="#l42.61"></a><span id="l42.61" class="difflineminus">-    do_check_eq(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l42.62"></a><span id="l42.62" class="difflineminus">-                &quot;account1,&quot; + newAccount.key);</span>
<a href="#l42.63"></a><span id="l42.63" class="difflineplus">+    Assert.equal(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineplus">+                 &quot;account1,&quot; + newAccount.key);</span>
<a href="#l42.65"></a><span id="l42.65"> </span>
<a href="#l42.66"></a><span id="l42.66">     do_test_finished();</span>
<a href="#l42.67"></a><span id="l42.67">   });</span>
<a href="#l42.68"></a><span id="l42.68"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/base/test/unit/test_accountMigration.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_accountMigration.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -36,92 +36,92 @@ function run_test() {</span>
<a href="#l43.4"></a><span id="l43.4">     &quot;chrome://messenger/content/email=yes@test.invalid&quot;);</span>
<a href="#l43.5"></a><span id="l43.5">   let uriAllowed2 = Services.io.newURI(</span>
<a href="#l43.6"></a><span id="l43.6">     &quot;chrome://messenger/content/email=yes2@test.invalid&quot;);</span>
<a href="#l43.7"></a><span id="l43.7">   let uriDisallowed = Services.io.newURI(</span>
<a href="#l43.8"></a><span id="l43.8">     &quot;chrome://messenger/content/email=no@test.invalid&quot;);</span>
<a href="#l43.9"></a><span id="l43.9"> </span>
<a href="#l43.10"></a><span id="l43.10">   // Check that this email that according to the ab data has (had!)</span>
<a href="#l43.11"></a><span id="l43.11">   // remote content premissions, has no premissions pre migration.</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  do_check_eq(Services.perms.testPermission(uriAllowed, &quot;image&quot;),</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-              Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">-  do_check_eq(Services.perms.testPermission(uriAllowed2, &quot;image&quot;),</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">-              Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-  do_check_eq(Services.perms.testPermission(uriDisallowed, &quot;image&quot;),</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-              Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+  Assert.equal(Services.perms.testPermission(uriAllowed, &quot;image&quot;),</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+               Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+  Assert.equal(Services.perms.testPermission(uriAllowed2, &quot;image&quot;),</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineplus">+               Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineplus">+  Assert.equal(Services.perms.testPermission(uriDisallowed, &quot;image&quot;),</span>
<a href="#l43.23"></a><span id="l43.23" class="difflineplus">+               Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.24"></a><span id="l43.24"> </span>
<a href="#l43.25"></a><span id="l43.25">   // Set default charsets to an encoding no longer supported: VISCII.</span>
<a href="#l43.26"></a><span id="l43.26">   let charset = Components.classes[&quot;@mozilla.org/pref-localizedstring;1&quot;]</span>
<a href="#l43.27"></a><span id="l43.27">                 .createInstance(Components.interfaces.nsIPrefLocalizedString);</span>
<a href="#l43.28"></a><span id="l43.28">   charset.data = &quot;VISCII&quot;;</span>
<a href="#l43.29"></a><span id="l43.29">   Services.prefs.setComplexValue(&quot;mailnews.send_default_charset&quot;,</span>
<a href="#l43.30"></a><span id="l43.30">         Components.interfaces.nsIPrefLocalizedString, charset);</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-  do_check_true(Services.prefs.prefHasUserValue(&quot;mailnews.send_default_charset&quot;));</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+  Assert.ok(Services.prefs.prefHasUserValue(&quot;mailnews.send_default_charset&quot;));</span>
<a href="#l43.33"></a><span id="l43.33">   Services.prefs.setComplexValue(&quot;mailnews.view_default_charset&quot;,</span>
<a href="#l43.34"></a><span id="l43.34">         Components.interfaces.nsIPrefLocalizedString, charset);</span>
<a href="#l43.35"></a><span id="l43.35" class="difflineminus">-  do_check_true(Services.prefs.prefHasUserValue(&quot;mailnews.view_default_charset&quot;));</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineplus">+  Assert.ok(Services.prefs.prefHasUserValue(&quot;mailnews.view_default_charset&quot;));</span>
<a href="#l43.37"></a><span id="l43.37"> </span>
<a href="#l43.38"></a><span id="l43.38">   // Now migrate the prefs.</span>
<a href="#l43.39"></a><span id="l43.39">   migrateMailnews();</span>
<a href="#l43.40"></a><span id="l43.40"> </span>
<a href="#l43.41"></a><span id="l43.41">   // Check what has been set.</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mail.server.server1.authMethod&quot;));</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineminus">-  do_check_true(Services.prefs.prefHasUserValue(&quot;mail.server.server2.authMethod&quot;));</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineminus">-  do_check_eq(Services.prefs.getIntPref(&quot;mail.server.server2.authMethod&quot;),</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineminus">-              Ci.nsMsgAuthMethod.secure);</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mail.server.server1.authMethod&quot;));</span>
<a href="#l43.47"></a><span id="l43.47" class="difflineplus">+  Assert.ok(Services.prefs.prefHasUserValue(&quot;mail.server.server2.authMethod&quot;));</span>
<a href="#l43.48"></a><span id="l43.48" class="difflineplus">+  Assert.equal(Services.prefs.getIntPref(&quot;mail.server.server2.authMethod&quot;),</span>
<a href="#l43.49"></a><span id="l43.49" class="difflineplus">+               Ci.nsMsgAuthMethod.secure);</span>
<a href="#l43.50"></a><span id="l43.50"> </span>
<a href="#l43.51"></a><span id="l43.51">   // Now clear the authMethod for set for server2. This simulates the user</span>
<a href="#l43.52"></a><span id="l43.52">   // setting the value back to &quot;3&quot;, i.e. Ci.nsMsgAuthMethod.passwordCleartext.</span>
<a href="#l43.53"></a><span id="l43.53">   Services.prefs.clearUserPref(&quot;mail.server.server2.authMethod&quot;);</span>
<a href="#l43.54"></a><span id="l43.54"> </span>
<a href="#l43.55"></a><span id="l43.55">   // Now attempt migration again, e.g. a second load of TB</span>
<a href="#l43.56"></a><span id="l43.56">   migrateMailnews();</span>
<a href="#l43.57"></a><span id="l43.57"> </span>
<a href="#l43.58"></a><span id="l43.58">   // This time around, both of these should not be set.</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mail.server.server1.authMethod&quot;));</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mail.server.server2.authMethod&quot;));</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mail.server.server1.authMethod&quot;));</span>
<a href="#l43.62"></a><span id="l43.62" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mail.server.server2.authMethod&quot;));</span>
<a href="#l43.63"></a><span id="l43.63"> </span>
<a href="#l43.64"></a><span id="l43.64"> </span>
<a href="#l43.65"></a><span id="l43.65">   //</span>
<a href="#l43.66"></a><span id="l43.66">   // Now check SMTP</span>
<a href="#l43.67"></a><span id="l43.67">   //</span>
<a href="#l43.68"></a><span id="l43.68"> </span>
<a href="#l43.69"></a><span id="l43.69">   Services.prefs.setCharPref(&quot;mail.smtpservers&quot;, &quot;smtp1,smtp2&quot;);</span>
<a href="#l43.70"></a><span id="l43.70"> </span>
<a href="#l43.71"></a><span id="l43.71">   // smtp1 has nothing set.</span>
<a href="#l43.72"></a><span id="l43.72"> </span>
<a href="#l43.73"></a><span id="l43.73">   // smtp2 has useSecAuth set to true, auth_method unset</span>
<a href="#l43.74"></a><span id="l43.74">   Services.prefs.setBoolPref(&quot;mail.smtpserver.smtp2.useSecAuth&quot;, true);</span>
<a href="#l43.75"></a><span id="l43.75"> </span>
<a href="#l43.76"></a><span id="l43.76">   // Migration should now have added permissions for the address that had them</span>
<a href="#l43.77"></a><span id="l43.77">   // and not for the one that didn't have them.</span>
<a href="#l43.78"></a><span id="l43.78" class="difflineminus">-  do_check_true(Services.prefs.getIntPref(&quot;mail.ab_remote_content.migrated&quot;) &gt; 0);</span>
<a href="#l43.79"></a><span id="l43.79" class="difflineminus">-  do_check_eq(Services.perms.testPermission(uriAllowed, &quot;image&quot;),</span>
<a href="#l43.80"></a><span id="l43.80" class="difflineminus">-              Services.perms.ALLOW_ACTION);</span>
<a href="#l43.81"></a><span id="l43.81" class="difflineminus">-  do_check_eq(Services.perms.testPermission(uriAllowed2, &quot;image&quot;),</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineminus">-              Services.perms.ALLOW_ACTION);</span>
<a href="#l43.83"></a><span id="l43.83" class="difflineminus">-  do_check_eq(Services.perms.testPermission(uriDisallowed, &quot;image&quot;),</span>
<a href="#l43.84"></a><span id="l43.84" class="difflineminus">-              Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.85"></a><span id="l43.85" class="difflineplus">+  Assert.ok(Services.prefs.getIntPref(&quot;mail.ab_remote_content.migrated&quot;) &gt; 0);</span>
<a href="#l43.86"></a><span id="l43.86" class="difflineplus">+  Assert.equal(Services.perms.testPermission(uriAllowed, &quot;image&quot;),</span>
<a href="#l43.87"></a><span id="l43.87" class="difflineplus">+               Services.perms.ALLOW_ACTION);</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineplus">+  Assert.equal(Services.perms.testPermission(uriAllowed2, &quot;image&quot;),</span>
<a href="#l43.89"></a><span id="l43.89" class="difflineplus">+               Services.perms.ALLOW_ACTION);</span>
<a href="#l43.90"></a><span id="l43.90" class="difflineplus">+  Assert.equal(Services.perms.testPermission(uriDisallowed, &quot;image&quot;),</span>
<a href="#l43.91"></a><span id="l43.91" class="difflineplus">+               Services.perms.UNKNOWN_ACTION);</span>
<a href="#l43.92"></a><span id="l43.92"> </span>
<a href="#l43.93"></a><span id="l43.93">   // Migration should have cleared the charset user pref values.</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineminus">-  do_check_true(Services.prefs.getIntPref(&quot;mail.default_charsets.migrated&quot;) &gt; 0);</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mailnews.send_default_charset&quot;));</span>
<a href="#l43.96"></a><span id="l43.96" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mailnews.view_default_charset&quot;));</span>
<a href="#l43.97"></a><span id="l43.97" class="difflineplus">+  Assert.ok(Services.prefs.getIntPref(&quot;mail.default_charsets.migrated&quot;) &gt; 0);</span>
<a href="#l43.98"></a><span id="l43.98" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mailnews.send_default_charset&quot;));</span>
<a href="#l43.99"></a><span id="l43.99" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mailnews.view_default_charset&quot;));</span>
<a href="#l43.100"></a><span id="l43.100"> </span>
<a href="#l43.101"></a><span id="l43.101">   // Now migrate the prefs</span>
<a href="#l43.102"></a><span id="l43.102">   migrateMailnews();</span>
<a href="#l43.103"></a><span id="l43.103"> </span>
<a href="#l43.104"></a><span id="l43.104" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp1.authMethod&quot;));</span>
<a href="#l43.105"></a><span id="l43.105" class="difflineminus">-  do_check_true(Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp2.authMethod&quot;));</span>
<a href="#l43.106"></a><span id="l43.106" class="difflineminus">-  do_check_eq(Services.prefs.getIntPref(&quot;mail.smtpserver.smtp2.authMethod&quot;),</span>
<a href="#l43.107"></a><span id="l43.107" class="difflineminus">-              Ci.nsMsgAuthMethod.secure);</span>
<a href="#l43.108"></a><span id="l43.108" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp1.authMethod&quot;));</span>
<a href="#l43.109"></a><span id="l43.109" class="difflineplus">+  Assert.ok(Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp2.authMethod&quot;));</span>
<a href="#l43.110"></a><span id="l43.110" class="difflineplus">+  Assert.equal(Services.prefs.getIntPref(&quot;mail.smtpserver.smtp2.authMethod&quot;),</span>
<a href="#l43.111"></a><span id="l43.111" class="difflineplus">+               Ci.nsMsgAuthMethod.secure);</span>
<a href="#l43.112"></a><span id="l43.112"> </span>
<a href="#l43.113"></a><span id="l43.113">     // Now clear the authMethod for set for smtp2. This simulates the user</span>
<a href="#l43.114"></a><span id="l43.114">   // setting the value back to &quot;3&quot;, i.e. Ci.nsMsgAuthMethod.passwordCleartext.</span>
<a href="#l43.115"></a><span id="l43.115">   Services.prefs.clearUserPref(&quot;mail.smtpserver.smtp2.authMethod&quot;);</span>
<a href="#l43.116"></a><span id="l43.116"> </span>
<a href="#l43.117"></a><span id="l43.117">   // Now attempt migration again, e.g. a second load of TB</span>
<a href="#l43.118"></a><span id="l43.118">   migrateMailnews();</span>
<a href="#l43.119"></a><span id="l43.119"> </span>
<a href="#l43.120"></a><span id="l43.120">   // This time around, both of these should not be set.</span>
<a href="#l43.121"></a><span id="l43.121" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp1.authMethod&quot;));</span>
<a href="#l43.122"></a><span id="l43.122" class="difflineminus">-  do_check_false(Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp2.authMethod&quot;));</span>
<a href="#l43.123"></a><span id="l43.123" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp1.authMethod&quot;));</span>
<a href="#l43.124"></a><span id="l43.124" class="difflineplus">+  Assert.ok(!Services.prefs.prefHasUserValue(&quot;mail.smtpserver.smtp2.authMethod&quot;));</span>
<a href="#l43.125"></a><span id="l43.125"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/base/test/unit/test_acctRepair.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_acctRepair.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -31,16 +31,16 @@ function run_test()</span>
<a href="#l44.4"></a><span id="l44.4"> </span>
<a href="#l44.5"></a><span id="l44.5">   Services.prefs.setCharPref(&quot;mail.accountmanager.accounts&quot;, &quot;account6&quot;);</span>
<a href="#l44.6"></a><span id="l44.6">   Services.prefs.setCharPref(&quot;mail.accountmanager.defaultaccount&quot;,</span>
<a href="#l44.7"></a><span id="l44.7">                              &quot;account6&quot;);</span>
<a href="#l44.8"></a><span id="l44.8">   Services.prefs.setCharPref(&quot;mail.accountmanager.localfoldersserver&quot;,</span>
<a href="#l44.9"></a><span id="l44.9">                              &quot;server1&quot;);</span>
<a href="#l44.10"></a><span id="l44.10">   // This will force the load of the accounts setup above.</span>
<a href="#l44.11"></a><span id="l44.11">   // We should have created an account for the local folders.</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 2);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">-              &quot;account6,account7&quot;);</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineminus">-  do_check_eq(Services.prefs.getCharPref(&quot;mail.account.account7.server&quot;),</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineminus">-              &quot;server1&quot;);</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 2);</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;),</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineplus">+               &quot;account6,account7&quot;);</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineplus">+  Assert.equal(Services.prefs.getCharPref(&quot;mail.account.account7.server&quot;),</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineplus">+               &quot;server1&quot;);</span>
<a href="#l44.22"></a><span id="l44.22">   let server5 = MailServices.accounts.getIncomingServer(&quot;server5&quot;).QueryInterface(Ci.nsIPop3IncomingServer);</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineminus">-  do_check_eq(server5.deferredToAccount, &quot;account7&quot;);</span>
<a href="#l44.24"></a><span id="l44.24" class="difflineplus">+  Assert.equal(server5.deferredToAccount, &quot;account7&quot;);</span>
<a href="#l44.25"></a><span id="l44.25"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/base/test/unit/test_autoconfigFetchDisk.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_autoconfigFetchDisk.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -44,22 +44,22 @@ try {</span>
<a href="#l45.4"></a><span id="l45.4"> function onTestSuccess(config)</span>
<a href="#l45.5"></a><span id="l45.5"> {</span>
<a href="#l45.6"></a><span id="l45.6">   // Check that we got the expected config.</span>
<a href="#l45.7"></a><span id="l45.7">   xmlReader.replaceVariables(config,</span>
<a href="#l45.8"></a><span id="l45.8">                              &quot;Yamato Nadeshiko&quot;,</span>
<a href="#l45.9"></a><span id="l45.9">                              &quot;yamato.nadeshiko@example.com&quot;,</span>
<a href="#l45.10"></a><span id="l45.10">                              &quot;abc12345&quot;);</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  do_check_eq(config.incoming.username, &quot;yamato.nadeshiko&quot;);</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">-  do_check_eq(config.outgoing.username, &quot;yamato.nadeshiko@example.com&quot;);</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">-  do_check_eq(config.incoming.hostname, &quot;pop.example.com&quot;);</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">-  do_check_eq(config.outgoing.hostname, &quot;smtp.example.com&quot;);</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">-  do_check_eq(config.identity.realname, &quot;Yamato Nadeshiko&quot;);</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineminus">-  do_check_eq(config.identity.emailAddress, &quot;yamato.nadeshiko@example.com&quot;);</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineplus">+  Assert.equal(config.incoming.username, &quot;yamato.nadeshiko&quot;);</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineplus">+  Assert.equal(config.outgoing.username, &quot;yamato.nadeshiko@example.com&quot;);</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineplus">+  Assert.equal(config.incoming.hostname, &quot;pop.example.com&quot;);</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineplus">+  Assert.equal(config.outgoing.hostname, &quot;smtp.example.com&quot;);</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineplus">+  Assert.equal(config.identity.realname, &quot;Yamato Nadeshiko&quot;);</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineplus">+  Assert.equal(config.identity.emailAddress, &quot;yamato.nadeshiko@example.com&quot;);</span>
<a href="#l45.24"></a><span id="l45.24">   do_test_finished();</span>
<a href="#l45.25"></a><span id="l45.25"> }</span>
<a href="#l45.26"></a><span id="l45.26"> </span>
<a href="#l45.27"></a><span id="l45.27"> function onTestFailure(e)</span>
<a href="#l45.28"></a><span id="l45.28"> {</span>
<a href="#l45.29"></a><span id="l45.29">   do_throw(e);</span>
<a href="#l45.30"></a><span id="l45.30"> }</span>
<a href="#l45.31"></a><span id="l45.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/base/test/unit/test_autoconfigUtils.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_autoconfigUtils.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -35,24 +35,24 @@ try {</span>
<a href="#l46.4"></a><span id="l46.4"> /*</span>
<a href="#l46.5"></a><span id="l46.5">  * UTILITIES</span>
<a href="#l46.6"></a><span id="l46.6">  */</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> function assert(aBeTrue, aWhy)</span>
<a href="#l46.9"></a><span id="l46.9"> {</span>
<a href="#l46.10"></a><span id="l46.10">   if (!aBeTrue)</span>
<a href="#l46.11"></a><span id="l46.11">     do_throw(aWhy);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  do_check_true(aBeTrue);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+  Assert.ok(aBeTrue);</span>
<a href="#l46.14"></a><span id="l46.14"> };</span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16"> function assert_equal(aA, aB, aWhy)</span>
<a href="#l46.17"></a><span id="l46.17"> {</span>
<a href="#l46.18"></a><span id="l46.18">   if (aA != aB)</span>
<a href="#l46.19"></a><span id="l46.19">     do_throw(aWhy);</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineminus">-  do_check_eq(aA, aB);</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineplus">+  Assert.equal(aA, aB);</span>
<a href="#l46.22"></a><span id="l46.22"> };</span>
<a href="#l46.23"></a><span id="l46.23"> </span>
<a href="#l46.24"></a><span id="l46.24"> /**</span>
<a href="#l46.25"></a><span id="l46.25">  * Test that two host entries are the same, ignoring the commands.</span>
<a href="#l46.26"></a><span id="l46.26">  */</span>
<a href="#l46.27"></a><span id="l46.27"> function assert_equal_host_entries(hostEntry, expected)</span>
<a href="#l46.28"></a><span id="l46.28"> {</span>
<a href="#l46.29"></a><span id="l46.29">   assert_equal(hostEntry.protocol, expected[0], &quot;Protocols are different&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/base/test/unit/test_autoconfigXML.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_autoconfigXML.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -41,17 +41,17 @@ try {</span>
<a href="#l47.4"></a><span id="l47.4"> /*</span>
<a href="#l47.5"></a><span id="l47.5">  * UTILITIES</span>
<a href="#l47.6"></a><span id="l47.6">  */</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8"> function assert_equal(aA, aB, aWhy)</span>
<a href="#l47.9"></a><span id="l47.9"> {</span>
<a href="#l47.10"></a><span id="l47.10">   if (aA != aB)</span>
<a href="#l47.11"></a><span id="l47.11">     do_throw(aWhy);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  do_check_eq(aA, aB);</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  Assert.equal(aA, aB);</span>
<a href="#l47.14"></a><span id="l47.14"> };</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16"> /**</span>
<a href="#l47.17"></a><span id="l47.17">  * Test that two config entries are the same.</span>
<a href="#l47.18"></a><span id="l47.18">  */</span>
<a href="#l47.19"></a><span id="l47.19"> function assert_equal_config(aA, aB, field)</span>
<a href="#l47.20"></a><span id="l47.20"> {</span>
<a href="#l47.21"></a><span id="l47.21">   assert_equal(aA, aB, &quot;Configured &quot; + field + &quot; is incorrect.&quot;);</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -163,46 +163,46 @@ function test_readFromXML_config1()</span>
<a href="#l47.23"></a><span id="l47.23"> </span>
<a href="#l47.24"></a><span id="l47.24">       '&lt;/emailProvider&gt;' +</span>
<a href="#l47.25"></a><span id="l47.25">     '&lt;/clientConfig&gt;';</span>
<a href="#l47.26"></a><span id="l47.26"> </span>
<a href="#l47.27"></a><span id="l47.27">   var domParser = new DOMParser();</span>
<a href="#l47.28"></a><span id="l47.28">   var config = xmlReader.readFromXML(JXON.build(</span>
<a href="#l47.29"></a><span id="l47.29">     domParser.parseFromString(clientConfigXML, &quot;text/xml&quot;)));</span>
<a href="#l47.30"></a><span id="l47.30"> </span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-  do_check_eq(config instanceof xmlReader.AccountConfig, true);</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-  do_check_eq(&quot;example.com&quot;, config.id);</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">-  do_check_eq(&quot;Example&quot;, config.displayName);</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">-  do_check_neq(-1, config.domains.indexOf(&quot;example.com&quot;));</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineplus">+  Assert.equal(config instanceof xmlReader.AccountConfig, true);</span>
<a href="#l47.36"></a><span id="l47.36" class="difflineplus">+  Assert.equal(&quot;example.com&quot;, config.id);</span>
<a href="#l47.37"></a><span id="l47.37" class="difflineplus">+  Assert.equal(&quot;Example&quot;, config.displayName);</span>
<a href="#l47.38"></a><span id="l47.38" class="difflineplus">+  Assert.notEqual(-1, config.domains.indexOf(&quot;example.com&quot;));</span>
<a href="#l47.39"></a><span id="l47.39">   // 1. incoming server skipped because of an unsupported protocol</span>
<a href="#l47.40"></a><span id="l47.40">   // 2. incoming server skipped because of an so-far unknown auth method</span>
<a href="#l47.41"></a><span id="l47.41">   // 3. incoming server is fine for us: IMAP, SSL, cleartext password</span>
<a href="#l47.42"></a><span id="l47.42">   server = config.incoming;</span>
<a href="#l47.43"></a><span id="l47.43" class="difflineminus">-  do_check_eq(&quot;imapmail.example.com&quot;, server.hostname);</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineminus">-  do_check_eq(&quot;imap&quot;, server.type);</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineminus">-  do_check_eq(2, server.socketType); // SSL</span>
<a href="#l47.46"></a><span id="l47.46" class="difflineminus">-  do_check_eq(3, server.auth); // cleartext password</span>
<a href="#l47.47"></a><span id="l47.47" class="difflineplus">+  Assert.equal(&quot;imapmail.example.com&quot;, server.hostname);</span>
<a href="#l47.48"></a><span id="l47.48" class="difflineplus">+  Assert.equal(&quot;imap&quot;, server.type);</span>
<a href="#l47.49"></a><span id="l47.49" class="difflineplus">+  Assert.equal(2, server.socketType); // SSL</span>
<a href="#l47.50"></a><span id="l47.50" class="difflineplus">+  Assert.equal(3, server.auth); // cleartext password</span>
<a href="#l47.51"></a><span id="l47.51">   // only one more supported incoming server</span>
<a href="#l47.52"></a><span id="l47.52" class="difflineminus">-  do_check_eq(1, config.incomingAlternatives.length);</span>
<a href="#l47.53"></a><span id="l47.53" class="difflineplus">+  Assert.equal(1, config.incomingAlternatives.length);</span>
<a href="#l47.54"></a><span id="l47.54">   // 4. incoming server skipped because of an so-far unknown socketType</span>
<a href="#l47.55"></a><span id="l47.55">   // 5. server: POP</span>
<a href="#l47.56"></a><span id="l47.56">   server = config.incomingAlternatives[0];</span>
<a href="#l47.57"></a><span id="l47.57" class="difflineminus">-  do_check_eq(&quot;popmail.example.com&quot;, server.hostname);</span>
<a href="#l47.58"></a><span id="l47.58" class="difflineminus">-  do_check_eq(&quot;pop3&quot;, server.type);</span>
<a href="#l47.59"></a><span id="l47.59" class="difflineminus">-  do_check_eq(1, server.socketType); // no SSL</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineminus">-  do_check_eq(4, server.auth); // encrypted password</span>
<a href="#l47.61"></a><span id="l47.61" class="difflineplus">+  Assert.equal(&quot;popmail.example.com&quot;, server.hostname);</span>
<a href="#l47.62"></a><span id="l47.62" class="difflineplus">+  Assert.equal(&quot;pop3&quot;, server.type);</span>
<a href="#l47.63"></a><span id="l47.63" class="difflineplus">+  Assert.equal(1, server.socketType); // no SSL</span>
<a href="#l47.64"></a><span id="l47.64" class="difflineplus">+  Assert.equal(4, server.auth); // encrypted password</span>
<a href="#l47.65"></a><span id="l47.65"> </span>
<a href="#l47.66"></a><span id="l47.66">   // SMTP server, most preferred</span>
<a href="#l47.67"></a><span id="l47.67">   server = config.outgoing;</span>
<a href="#l47.68"></a><span id="l47.68" class="difflineminus">-  do_check_eq(&quot;smtpout.example.com&quot;, server.hostname);</span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">-  do_check_eq(&quot;smtp&quot;, server.type);</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineminus">-  do_check_eq(3, server.socketType); // STARTTLS</span>
<a href="#l47.71"></a><span id="l47.71" class="difflineminus">-  do_check_eq(1, server.auth); // no auth</span>
<a href="#l47.72"></a><span id="l47.72" class="difflineplus">+  Assert.equal(&quot;smtpout.example.com&quot;, server.hostname);</span>
<a href="#l47.73"></a><span id="l47.73" class="difflineplus">+  Assert.equal(&quot;smtp&quot;, server.type);</span>
<a href="#l47.74"></a><span id="l47.74" class="difflineplus">+  Assert.equal(3, server.socketType); // STARTTLS</span>
<a href="#l47.75"></a><span id="l47.75" class="difflineplus">+  Assert.equal(1, server.auth); // no auth</span>
<a href="#l47.76"></a><span id="l47.76">   // no other SMTP servers</span>
<a href="#l47.77"></a><span id="l47.77" class="difflineminus">-  do_check_eq(0, config.outgoingAlternatives.length);</span>
<a href="#l47.78"></a><span id="l47.78" class="difflineplus">+  Assert.equal(0, config.outgoingAlternatives.length);</span>
<a href="#l47.79"></a><span id="l47.79"> }</span>
<a href="#l47.80"></a><span id="l47.80"> </span>
<a href="#l47.81"></a><span id="l47.81"> /**</span>
<a href="#l47.82"></a><span id="l47.82">  * Test the replaceVariables method.</span>
<a href="#l47.83"></a><span id="l47.83">  */</span>
<a href="#l47.84"></a><span id="l47.84"> function test_replaceVariables()</span>
<a href="#l47.85"></a><span id="l47.85"> {</span>
<a href="#l47.86"></a><span id="l47.86">   var clientConfigXML =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bccInDatabase.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bccInDatabase.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -32,15 +32,15 @@ function run_test()</span>
<a href="#l48.4"></a><span id="l48.4">                                     &quot;&quot;, copyListener, null);</span>
<a href="#l48.5"></a><span id="l48.5"> }</span>
<a href="#l48.6"></a><span id="l48.6"> </span>
<a href="#l48.7"></a><span id="l48.7"> function continueTest()</span>
<a href="#l48.8"></a><span id="l48.8"> {</span>
<a href="#l48.9"></a><span id="l48.9">   //dump(&quot;\nbccList &gt;&quot; + hdr.bccList);</span>
<a href="#l48.10"></a><span id="l48.10">   //dump(&quot;\nccList &gt;&quot; + hdr.ccList);</span>
<a href="#l48.11"></a><span id="l48.11">   //dump(&quot;\n&quot;);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  do_check_true(hdr.bccList.includes(&quot;Another Person&quot;));</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-  do_check_true(hdr.bccList.includes(&quot;&lt;u1@example.com&gt;&quot;));</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">-  do_check_false(hdr.bccList.includes(&quot;IDoNotExist&quot;));</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineplus">+  Assert.ok(hdr.bccList.includes(&quot;Another Person&quot;));</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineplus">+  Assert.ok(hdr.bccList.includes(&quot;&lt;u1@example.com&gt;&quot;));</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineplus">+  Assert.ok(!hdr.bccList.includes(&quot;IDoNotExist&quot;));</span>
<a href="#l48.18"></a><span id="l48.18">   hdr = null;</span>
<a href="#l48.19"></a><span id="l48.19">   do_test_finished();</span>
<a href="#l48.20"></a><span id="l48.20"> }</span>
<a href="#l48.21"></a><span id="l48.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug366491.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug366491.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -65,18 +65,18 @@ var doTestingListener =</span>
<a href="#l49.4"></a><span id="l49.4"> </span>
<a href="#l49.5"></a><span id="l49.5">     if (!aMsgURI)</span>
<a href="#l49.6"></a><span id="l49.6">       return; // ignore end of batch</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8">     // Have we completed a classification? If so, test</span>
<a href="#l49.9"></a><span id="l49.9">     if (haveClassification)</span>
<a href="#l49.10"></a><span id="l49.10">     {</span>
<a href="#l49.11"></a><span id="l49.11">       let test = tests.shift();</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-      do_check_eq(getSpec(test.fileName), aMsgURI);</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-      do_check_eq(test.junkPercent, aJunkPercent);</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineplus">+      Assert.equal(getSpec(test.fileName), aMsgURI);</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineplus">+      Assert.equal(test.junkPercent, aJunkPercent);</span>
<a href="#l49.16"></a><span id="l49.16">     }</span>
<a href="#l49.17"></a><span id="l49.17"> </span>
<a href="#l49.18"></a><span id="l49.18">     // Do we have more classifications to do? Then classify the first one.</span>
<a href="#l49.19"></a><span id="l49.19">     if (tests.length)</span>
<a href="#l49.20"></a><span id="l49.20">     {</span>
<a href="#l49.21"></a><span id="l49.21">       haveClassification = true;</span>
<a href="#l49.22"></a><span id="l49.22">       MailServices.junk.classifyMessage(getSpec(tests[0].fileName),</span>
<a href="#l49.23"></a><span id="l49.23">         null, doTestingListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug404489.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug404489.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -127,17 +127,17 @@ function TestSearchx(aFolder, aValue, aA</span>
<a href="#l50.4"></a><span id="l50.4"> {</span>
<a href="#l50.5"></a><span id="l50.5">   var searchListener =</span>
<a href="#l50.6"></a><span id="l50.6">   {</span>
<a href="#l50.7"></a><span id="l50.7">     onSearchHit: function(dbHdr, folder) { hitCount++; },</span>
<a href="#l50.8"></a><span id="l50.8">     onSearchDone: function(status)</span>
<a href="#l50.9"></a><span id="l50.9">     {</span>
<a href="#l50.10"></a><span id="l50.10">       print(&quot;Finished search does &quot; + aHitCount + &quot; equal &quot; + hitCount + &quot;?&quot;);</span>
<a href="#l50.11"></a><span id="l50.11">       searchSession = null;</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-      do_check_eq(aHitCount, hitCount);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+      Assert.equal(aHitCount, hitCount);</span>
<a href="#l50.14"></a><span id="l50.14">       if (onDone)</span>
<a href="#l50.15"></a><span id="l50.15">         onDone();</span>
<a href="#l50.16"></a><span id="l50.16">     },</span>
<a href="#l50.17"></a><span id="l50.17">     onNewSearch: function() {hitCount = 0;}</span>
<a href="#l50.18"></a><span id="l50.18">   };</span>
<a href="#l50.19"></a><span id="l50.19"> </span>
<a href="#l50.20"></a><span id="l50.20">   // define and initiate the search session</span>
<a href="#l50.21"></a><span id="l50.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug428427.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug428427.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -136,39 +136,39 @@ var searchListener =</span>
<a href="#l51.4"></a><span id="l51.4">   }</span>
<a href="#l51.5"></a><span id="l51.5"> };</span>
<a href="#l51.6"></a><span id="l51.6"> </span>
<a href="#l51.7"></a><span id="l51.7"> function testVirtualFolder()</span>
<a href="#l51.8"></a><span id="l51.8"> {</span>
<a href="#l51.9"></a><span id="l51.9">   /*** basic functionality tests ***/</span>
<a href="#l51.10"></a><span id="l51.10">   </span>
<a href="#l51.11"></a><span id="l51.11">   // total messages matching search</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-  do_check_eq(4, virtualFolder.getTotalMessages(false));</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+  Assert.equal(4, virtualFolder.getTotalMessages(false));</span>
<a href="#l51.14"></a><span id="l51.14">   </span>
<a href="#l51.15"></a><span id="l51.15">   // total unread messages in search</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineminus">-  do_check_eq(3, virtualFolder.getNumUnread(false));</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineplus">+  Assert.equal(3, virtualFolder.getNumUnread(false));</span>
<a href="#l51.18"></a><span id="l51.18"> </span>
<a href="#l51.19"></a><span id="l51.19">   // change unread of one item in search to decrease count</span>
<a href="#l51.20"></a><span id="l51.20">   var message0 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l51.21"></a><span id="l51.21">   message0.appendElement(hdrs[0]);</span>
<a href="#l51.22"></a><span id="l51.22">   localAccountUtils.inboxFolder.markMessagesRead(message0, true);</span>
<a href="#l51.23"></a><span id="l51.23">   virtualFolder.updateSummaryTotals(true);</span>
<a href="#l51.24"></a><span id="l51.24"> </span>
<a href="#l51.25"></a><span id="l51.25" class="difflineminus">-  do_check_eq(2, virtualFolder.getNumUnread(false));</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineplus">+  Assert.equal(2, virtualFolder.getNumUnread(false));</span>
<a href="#l51.27"></a><span id="l51.27">   </span>
<a href="#l51.28"></a><span id="l51.28">   /*** failures fixed in this bug ***/</span>
<a href="#l51.29"></a><span id="l51.29">    </span>
<a href="#l51.30"></a><span id="l51.30">   // remove tag from one item to decrease count</span>
<a href="#l51.31"></a><span id="l51.31">   var message1 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l51.32"></a><span id="l51.32">   message1.appendElement(hdrs[1]);</span>
<a href="#l51.33"></a><span id="l51.33"> </span>
<a href="#l51.34"></a><span id="l51.34">   localAccountUtils.inboxFolder.removeKeywordsFromMessages(message1, tag1);</span>
<a href="#l51.35"></a><span id="l51.35">   virtualFolder.updateSummaryTotals(true);</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineminus">-  do_check_eq(3, virtualFolder.getTotalMessages(false));</span>
<a href="#l51.37"></a><span id="l51.37" class="difflineminus">-  do_check_eq(1, virtualFolder.getNumUnread(false));</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineplus">+  Assert.equal(3, virtualFolder.getTotalMessages(false));</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineplus">+  Assert.equal(1, virtualFolder.getNumUnread(false));</span>
<a href="#l51.40"></a><span id="l51.40"> </span>
<a href="#l51.41"></a><span id="l51.41">   // End of test, so release our header references</span>
<a href="#l51.42"></a><span id="l51.42">   hdrs = null;</span>
<a href="#l51.43"></a><span id="l51.43"> </span>
<a href="#l51.44"></a><span id="l51.44">   do_test_finished();</span>
<a href="#l51.45"></a><span id="l51.45">   return true;</span>
<a href="#l51.46"></a><span id="l51.46"> }</span>
<a href="#l51.47"></a><span id="l51.47"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug434810.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug434810.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -15,13 +15,13 @@ function run_test()</span>
<a href="#l52.4"></a><span id="l52.4">   var msgProps = Services.strings.createBundle(&quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l52.5"></a><span id="l52.5"> </span>
<a href="#l52.6"></a><span id="l52.6">   var expectedFolders = [ &quot;Inbox&quot; ]; // Inbox hard-coded in localAccountUtils.js</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8">   // These two MailNews adds by default</span>
<a href="#l52.9"></a><span id="l52.9">   expectedFolders.push(msgProps.GetStringFromName(&quot;outboxFolderName&quot;));</span>
<a href="#l52.10"></a><span id="l52.10">   expectedFolders.push(msgProps.GetStringFromName(&quot;trashFolderName&quot;));</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  do_check_eq(rootFolder.numSubFolders, expectedFolders.length);</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  Assert.equal(rootFolder.numSubFolders, expectedFolders.length);</span>
<a href="#l52.14"></a><span id="l52.14">   for (var i = 0; i &lt; expectedFolders.length; ++i)</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineminus">-    do_check_true(rootFolder.containsChildNamed(expectedFolders[i]));</span>
<a href="#l52.16"></a><span id="l52.16" class="difflineminus">-  do_check_true(rootFolder.isAncestorOf(localAccountUtils.inboxFolder));</span>
<a href="#l52.17"></a><span id="l52.17" class="difflineplus">+    Assert.ok(rootFolder.containsChildNamed(expectedFolders[i]));</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineplus">+  Assert.ok(rootFolder.isAncestorOf(localAccountUtils.inboxFolder));</span>
<a href="#l52.19"></a><span id="l52.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug471682.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug471682.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -42,17 +42,17 @@ var step2 =</span>
<a href="#l53.4"></a><span id="l53.4">   SetMessageKey: function(aKey)</span>
<a href="#l53.5"></a><span id="l53.5">   {</span>
<a href="#l53.6"></a><span id="l53.6">     dump(&quot;in set message key\n&quot;);</span>
<a href="#l53.7"></a><span id="l53.7">     gHdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l53.8"></a><span id="l53.8">   },</span>
<a href="#l53.9"></a><span id="l53.9">   SetMessageId: function(aMessageId) {},</span>
<a href="#l53.10"></a><span id="l53.10">   OnStopCopy: function(aStatus)</span>
<a href="#l53.11"></a><span id="l53.11">   {</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-    do_check_neq(gHdr, null);</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+    Assert.notEqual(gHdr, null);</span>
<a href="#l53.14"></a><span id="l53.14">     // copy the message into the subfolder</span>
<a href="#l53.15"></a><span id="l53.15">     var messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l53.16"></a><span id="l53.16">     messages.appendElement(gHdr);</span>
<a href="#l53.17"></a><span id="l53.17">     MailServices.copy.CopyMessages(localAccountUtils.inboxFolder, messages, gSubfolder,</span>
<a href="#l53.18"></a><span id="l53.18">                                    false, step3, null, false);</span>
<a href="#l53.19"></a><span id="l53.19">   }</span>
<a href="#l53.20"></a><span id="l53.20"> };</span>
<a href="#l53.21"></a><span id="l53.21"> </span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -90,15 +90,15 @@ var step5 =</span>
<a href="#l53.23"></a><span id="l53.23">   SetMessageId: function(aMessageId) {},</span>
<a href="#l53.24"></a><span id="l53.24">   OnStopCopy: function(aStatus)</span>
<a href="#l53.25"></a><span id="l53.25">   {</span>
<a href="#l53.26"></a><span id="l53.26">     var dbSize = gSubfolder.msgDatabase.dBFolderInfo.folderSize;</span>
<a href="#l53.27"></a><span id="l53.27">     var dbDate = gSubfolder.msgDatabase.dBFolderInfo.folderDate;</span>
<a href="#l53.28"></a><span id="l53.28">     var filePath = gSubfolder.filePath;</span>
<a href="#l53.29"></a><span id="l53.29">     var date = parseInt(filePath.lastModifiedTime/1000);</span>
<a href="#l53.30"></a><span id="l53.30">     var size = filePath.fileSize;</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-    do_check_eq(size, dbSize);</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineminus">-    do_check_eq(date, dbDate);</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineplus">+    Assert.equal(size, dbSize);</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineplus">+    Assert.equal(date, dbDate);</span>
<a href="#l53.35"></a><span id="l53.35">     // End of test, so release our header reference</span>
<a href="#l53.36"></a><span id="l53.36">     gHdr = null;</span>
<a href="#l53.37"></a><span id="l53.37">     do_test_finished();</span>
<a href="#l53.38"></a><span id="l53.38">   }</span>
<a href="#l53.39"></a><span id="l53.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug514945.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug514945.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -18,19 +18,19 @@ function run_test()</span>
<a href="#l54.4"></a><span id="l54.4">   let BAD_VALUE = 1000000; // some large value that is beyond the array bounds</span>
<a href="#l54.5"></a><span id="l54.5">   let haveExpectedError = false;</span>
<a href="#l54.6"></a><span id="l54.6">   try {</span>
<a href="#l54.7"></a><span id="l54.7">     let isAvailable = validityTable.getAvailable(Ci.nsMsgSearchAttrib.Subject, BAD_VALUE);</span>
<a href="#l54.8"></a><span id="l54.8">   } catch (e) { dump('Error but no crash, this is what we want:' + e + '\n');</span>
<a href="#l54.9"></a><span id="l54.9">                 haveExpectedError = true;</span>
<a href="#l54.10"></a><span id="l54.10">               }</span>
<a href="#l54.11"></a><span id="l54.11"> </span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  do_check_true(haveExpectedError);</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+  Assert.ok(haveExpectedError);</span>
<a href="#l54.14"></a><span id="l54.14"> </span>
<a href="#l54.15"></a><span id="l54.15"> // One of the causes of this is that search term operators are not being</span>
<a href="#l54.16"></a><span id="l54.16"> //  initialized, resulting in random values of the operator. Make sure that is</span>
<a href="#l54.17"></a><span id="l54.17"> //  fixed.</span>
<a href="#l54.18"></a><span id="l54.18"> </span>
<a href="#l54.19"></a><span id="l54.19">   const kSearchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l54.20"></a><span id="l54.20">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l54.21"></a><span id="l54.21">   let searchTerm = kSearchSession.createTerm();</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineminus">-  do_check_eq(searchTerm.op, Ci.nsMsgSearchOp.Contains);</span>
<a href="#l54.23"></a><span id="l54.23" class="difflineplus">+  Assert.equal(searchTerm.op, Ci.nsMsgSearchOp.Contains);</span>
<a href="#l54.24"></a><span id="l54.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/base/test/unit/test_compactColumnSave.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_compactColumnSave.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -46,17 +46,17 @@ function setColumnStates(folder) {</span>
<a href="#l55.4"></a><span id="l55.4">   dbFolderInfo.setCharProperty(this.PERSISTED_COLUMN_PROPERTY_NAME, columnJSON);</span>
<a href="#l55.5"></a><span id="l55.5">   msgDatabase.Commit(Components.interfaces.nsMsgDBCommitType.kLargeCommit);</span>
<a href="#l55.6"></a><span id="l55.6"> }</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8"> function checkPersistentState(folder) {</span>
<a href="#l55.9"></a><span id="l55.9">   let msgDatabase = folder.msgDatabase;</span>
<a href="#l55.10"></a><span id="l55.10">   let dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l55.11"></a><span id="l55.11">   let state = dbFolderInfo.getCharProperty(this.PERSISTED_COLUMN_PROPERTY_NAME);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  do_check_eq(state, columnJSON);</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  Assert.equal(state, columnJSON);</span>
<a href="#l55.14"></a><span id="l55.14">   do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l55.15"></a><span id="l55.15"> }</span>
<a href="#l55.16"></a><span id="l55.16"> </span>
<a href="#l55.17"></a><span id="l55.17"> </span>
<a href="#l55.18"></a><span id="l55.18"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l55.19"></a><span id="l55.19"> var copyListener = </span>
<a href="#l55.20"></a><span id="l55.20"> {</span>
<a href="#l55.21"></a><span id="l55.21">   OnStartCopy: function() {},</span>
<a href="#l55.22"></a><span id="l55.22" class="difflineat">@@ -70,32 +70,32 @@ var copyListener =</span>
<a href="#l55.23"></a><span id="l55.23">     catch(e) {</span>
<a href="#l55.24"></a><span id="l55.24">       dump(&quot;SetMessageKey failed: &quot; + e + &quot;\n&quot;);</span>
<a href="#l55.25"></a><span id="l55.25">     }</span>
<a href="#l55.26"></a><span id="l55.26">   },</span>
<a href="#l55.27"></a><span id="l55.27">   SetMessageId: function(aMessageId) {},</span>
<a href="#l55.28"></a><span id="l55.28">   OnStopCopy: function(aStatus)</span>
<a href="#l55.29"></a><span id="l55.29">   {</span>
<a href="#l55.30"></a><span id="l55.30">     // Check: message successfully copied.</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l55.33"></a><span id="l55.33">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l55.34"></a><span id="l55.34">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l55.35"></a><span id="l55.35">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l55.36"></a><span id="l55.36">     // to return</span>
<a href="#l55.37"></a><span id="l55.37">     do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l55.38"></a><span id="l55.38">   }</span>
<a href="#l55.39"></a><span id="l55.39"> };</span>
<a href="#l55.40"></a><span id="l55.40"> </span>
<a href="#l55.41"></a><span id="l55.41"> var urlListener =</span>
<a href="#l55.42"></a><span id="l55.42"> {</span>
<a href="#l55.43"></a><span id="l55.43">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l55.44"></a><span id="l55.44">   },</span>
<a href="#l55.45"></a><span id="l55.45">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l55.46"></a><span id="l55.46">     // Check: message successfully copied.</span>
<a href="#l55.47"></a><span id="l55.47" class="difflineminus">-    do_check_eq(aExitCode, 0);</span>
<a href="#l55.48"></a><span id="l55.48" class="difflineplus">+    Assert.equal(aExitCode, 0);</span>
<a href="#l55.49"></a><span id="l55.49">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l55.50"></a><span id="l55.50">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l55.51"></a><span id="l55.51">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l55.52"></a><span id="l55.52">     // to return</span>
<a href="#l55.53"></a><span id="l55.53">     do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l55.54"></a><span id="l55.54">   }</span>
<a href="#l55.55"></a><span id="l55.55"> };</span>
<a href="#l55.56"></a><span id="l55.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/base/test/unit/test_compactFailure.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_compactFailure.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -121,17 +121,17 @@ function compact_with_exception(expected</span>
<a href="#l56.4"></a><span id="l56.4">                     .createInstance(Ci.nsIMsgFolderCompactor);</span>
<a href="#l56.5"></a><span id="l56.5">   let listener = new AsyncUrlListener(null, function(url, exitCode) {</span>
<a href="#l56.6"></a><span id="l56.6">     do_throw(&quot;This listener should not be called back.&quot;);</span>
<a href="#l56.7"></a><span id="l56.7">   });</span>
<a href="#l56.8"></a><span id="l56.8">   try {</span>
<a href="#l56.9"></a><span id="l56.9">     compactor.compact(gTargetFolder, false, listener, null);</span>
<a href="#l56.10"></a><span id="l56.10">     do_throw(&quot;nsIMsgFolderCompactor.compact did not fail.&quot;);</span>
<a href="#l56.11"></a><span id="l56.11">   } catch(ex) {</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-    do_check_eq(expectedException, ex.result);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+    Assert.equal(expectedException, ex.result);</span>
<a href="#l56.14"></a><span id="l56.14">   }</span>
<a href="#l56.15"></a><span id="l56.15"> }</span>
<a href="#l56.16"></a><span id="l56.16"> </span>
<a href="#l56.17"></a><span id="l56.17"> function test_compact_without_crash() {</span>
<a href="#l56.18"></a><span id="l56.18">   compact_with_exception(Cr.NS_ERROR_FILE_IS_LOCKED);</span>
<a href="#l56.19"></a><span id="l56.19"> }</span>
<a href="#l56.20"></a><span id="l56.20"> </span>
<a href="#l56.21"></a><span id="l56.21"> function test_compact_without_failure() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyChaining.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyChaining.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -100,14 +100,14 @@ var copyListener =</span>
<a href="#l57.4"></a><span id="l57.4"> {</span>
<a href="#l57.5"></a><span id="l57.5">   OnStartCopy: function() {},</span>
<a href="#l57.6"></a><span id="l57.6">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l57.7"></a><span id="l57.7">   SetMessageKey: function(aKey) {},</span>
<a href="#l57.8"></a><span id="l57.8">   SetMessageId: function(aMessageId) {},</span>
<a href="#l57.9"></a><span id="l57.9">   OnStopCopy: function(aStatus)</span>
<a href="#l57.10"></a><span id="l57.10">   {</span>
<a href="#l57.11"></a><span id="l57.11">     // Check: message successfully copied.</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l57.14"></a><span id="l57.14">     ++gCurTestNum;</span>
<a href="#l57.15"></a><span id="l57.15">     doTest();</span>
<a href="#l57.16"></a><span id="l57.16">   }</span>
<a href="#l57.17"></a><span id="l57.17"> };</span>
<a href="#l57.18"></a><span id="l57.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -50,21 +50,21 @@ var gTestArray =</span>
<a href="#l58.4"></a><span id="l58.4">       PromiseTestUtils.promiseFolderEvent(localAccountUtils.inboxFolder,</span>
<a href="#l58.5"></a><span id="l58.5">                                           &quot;DeleteOrMoveMsgCompleted&quot;);</span>
<a href="#l58.6"></a><span id="l58.6">     MailServices.filters.applyFilters(Ci.nsMsgFilterType.Manual,</span>
<a href="#l58.7"></a><span id="l58.7">                                       messages, localAccountUtils.inboxFolder, null);</span>
<a href="#l58.8"></a><span id="l58.8">     yield promiseFolderEvent;</span>
<a href="#l58.9"></a><span id="l58.9">   },</span>
<a href="#l58.10"></a><span id="l58.10">   function verifyFolders1() {</span>
<a href="#l58.11"></a><span id="l58.11">     // Copy and Move should each now have 1 message in them.</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-    do_check_eq(folderCount(gCopyFolder), 1);</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-    do_check_eq(folderCount(gMoveFolder), 1);</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineplus">+    Assert.equal(folderCount(gCopyFolder), 1);</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineplus">+    Assert.equal(folderCount(gMoveFolder), 1);</span>
<a href="#l58.16"></a><span id="l58.16">     // the local inbox folder should now be empty, since the second</span>
<a href="#l58.17"></a><span id="l58.17">     // operation was a move</span>
<a href="#l58.18"></a><span id="l58.18" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l58.19"></a><span id="l58.19" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l58.20"></a><span id="l58.20">   },</span>
<a href="#l58.21"></a><span id="l58.21">   // just get a message into the local folder</span>
<a href="#l58.22"></a><span id="l58.22">   function *getLocalMessages2() {</span>
<a href="#l58.23"></a><span id="l58.23">     gPOP3Pump.files = gFiles;</span>
<a href="#l58.24"></a><span id="l58.24">     yield gPOP3Pump.run();</span>
<a href="#l58.25"></a><span id="l58.25">   },</span>
<a href="#l58.26"></a><span id="l58.26">   // use the alternate call into the filter service</span>
<a href="#l58.27"></a><span id="l58.27">   function *applyFiltersToFolders() {</span>
<a href="#l58.28"></a><span id="l58.28" class="difflineat">@@ -74,21 +74,21 @@ var gTestArray =</span>
<a href="#l58.29"></a><span id="l58.29">     let promiseFolderEvent =</span>
<a href="#l58.30"></a><span id="l58.30">       PromiseTestUtils.promiseFolderEvent(localAccountUtils.inboxFolder,</span>
<a href="#l58.31"></a><span id="l58.31">                                           &quot;DeleteOrMoveMsgCompleted&quot;);</span>
<a href="#l58.32"></a><span id="l58.32">     MailServices.filters.applyFiltersToFolders(gFilterList, folders, null);</span>
<a href="#l58.33"></a><span id="l58.33">     yield promiseFolderEvent;</span>
<a href="#l58.34"></a><span id="l58.34">   },</span>
<a href="#l58.35"></a><span id="l58.35">   function verifyFolders2() {</span>
<a href="#l58.36"></a><span id="l58.36">     // Copy and Move should each now have 2 message in them.</span>
<a href="#l58.37"></a><span id="l58.37" class="difflineminus">-    do_check_eq(folderCount(gCopyFolder), 2);</span>
<a href="#l58.38"></a><span id="l58.38" class="difflineminus">-    do_check_eq(folderCount(gMoveFolder), 2);</span>
<a href="#l58.39"></a><span id="l58.39" class="difflineplus">+    Assert.equal(folderCount(gCopyFolder), 2);</span>
<a href="#l58.40"></a><span id="l58.40" class="difflineplus">+    Assert.equal(folderCount(gMoveFolder), 2);</span>
<a href="#l58.41"></a><span id="l58.41">     // the local inbox folder should now be empty, since the second</span>
<a href="#l58.42"></a><span id="l58.42">     // operation was a move</span>
<a href="#l58.43"></a><span id="l58.43" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l58.44"></a><span id="l58.44" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l58.45"></a><span id="l58.45">   },</span>
<a href="#l58.46"></a><span id="l58.46">   function endTest() {</span>
<a href="#l58.47"></a><span id="l58.47">     // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l58.48"></a><span id="l58.48">     // server</span>
<a href="#l58.49"></a><span id="l58.49">     dump(&quot; Exiting mail tests\n&quot;);</span>
<a href="#l58.50"></a><span id="l58.50">     gPOP3Pump = null;</span>
<a href="#l58.51"></a><span id="l58.51">   }</span>
<a href="#l58.52"></a><span id="l58.52"> ];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyToInvalidDB.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyToInvalidDB.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -58,16 +58,16 @@ function* actually_run_test() {</span>
<a href="#l59.4"></a><span id="l59.4">   gMsgId1 = msgHdr.messageId;</span>
<a href="#l59.5"></a><span id="l59.5">   messages.appendElement(msgHdr);</span>
<a href="#l59.6"></a><span id="l59.6">   MailServices.copy.CopyMessages(gTestFolder, messages, gTestFolder2, true,</span>
<a href="#l59.7"></a><span id="l59.7">                            asyncCopyListener, null, false);</span>
<a href="#l59.8"></a><span id="l59.8">   yield false;</span>
<a href="#l59.9"></a><span id="l59.9">   try {</span>
<a href="#l59.10"></a><span id="l59.10">     gTestFolder2.getDatabaseWithReparse(asyncUrlListener, null);</span>
<a href="#l59.11"></a><span id="l59.11">   } catch (ex) {</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-    do_check_true(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+    Assert.ok(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l59.14"></a><span id="l59.14">   }</span>
<a href="#l59.15"></a><span id="l59.15">   yield false;</span>
<a href="#l59.16"></a><span id="l59.16">   let msgRestored = gTestFolder2.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l59.17"></a><span id="l59.17">   let msg = mailTestUtils.loadMessageToString(gTestFolder2, msgRestored);</span>
<a href="#l59.18"></a><span id="l59.18" class="difflineminus">-  do_check_eq(msg, gMsg1.toMboxString());</span>
<a href="#l59.19"></a><span id="l59.19" class="difflineplus">+  Assert.equal(msg, gMsg1.toMboxString());</span>
<a href="#l59.20"></a><span id="l59.20">   do_test_finished();</span>
<a href="#l59.21"></a><span id="l59.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/base/test/unit/test_detachToFile.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_detachToFile.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -60,26 +60,26 @@ function* testDetach()</span>
<a href="#l60.4"></a><span id="l60.4"> {</span>
<a href="#l60.5"></a><span id="l60.5">   // This test seems to fail on Linux without the following delay.</span>
<a href="#l60.6"></a><span id="l60.6">   do_timeout(200, async_driver);</span>
<a href="#l60.7"></a><span id="l60.7">   yield false;</span>
<a href="#l60.8"></a><span id="l60.8">   // The message contained a file &quot;check.pdf&quot; which should</span>
<a href="#l60.9"></a><span id="l60.9">   //  now exist in the profile directory.</span>
<a href="#l60.10"></a><span id="l60.10">   let checkFile = do_get_profile().clone();</span>
<a href="#l60.11"></a><span id="l60.11">   checkFile.append(&quot;check.pdf&quot;);</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-  do_check_true(checkFile.exists());</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+  Assert.ok(checkFile.exists());</span>
<a href="#l60.14"></a><span id="l60.14"> </span>
<a href="#l60.15"></a><span id="l60.15">   // The message should now have a detached attachment. Read the message,</span>
<a href="#l60.16"></a><span id="l60.16">   //  and search for &quot;AttachmentDetached&quot; which is added on detachment.</span>
<a href="#l60.17"></a><span id="l60.17"> </span>
<a href="#l60.18"></a><span id="l60.18">   // Get the message header</span>
<a href="#l60.19"></a><span id="l60.19">   let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l60.20"></a><span id="l60.20"> </span>
<a href="#l60.21"></a><span id="l60.21">   let messageContent = getContentFromMessage(msgHdr);</span>
<a href="#l60.22"></a><span id="l60.22" class="difflineminus">-  do_check_true(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l60.23"></a><span id="l60.23" class="difflineplus">+  Assert.ok(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l60.24"></a><span id="l60.24"> }</span>
<a href="#l60.25"></a><span id="l60.25"> </span>
<a href="#l60.26"></a><span id="l60.26"> function SaveAttachmentCallback() {</span>
<a href="#l60.27"></a><span id="l60.27">   this.attachments = null;</span>
<a href="#l60.28"></a><span id="l60.28"> }</span>
<a href="#l60.29"></a><span id="l60.29"> </span>
<a href="#l60.30"></a><span id="l60.30"> SaveAttachmentCallback.prototype = {</span>
<a href="#l60.31"></a><span id="l60.31">   callback: function saveAttachmentCallback_callback(aMsgHdr, aMimeMessage) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/base/test/unit/test_emptyTrash.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_emptyTrash.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -36,32 +36,32 @@ var copyListener =</span>
<a href="#l61.4"></a><span id="l61.4">   {</span>
<a href="#l61.5"></a><span id="l61.5">     let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l61.6"></a><span id="l61.6">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l61.7"></a><span id="l61.7">   },</span>
<a href="#l61.8"></a><span id="l61.8">   SetMessageId: function(aMessageId) {},</span>
<a href="#l61.9"></a><span id="l61.9">   OnStopCopy: function(aStatus)</span>
<a href="#l61.10"></a><span id="l61.10">   {</span>
<a href="#l61.11"></a><span id="l61.11">     // Check: message successfully copied.</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l61.14"></a><span id="l61.14">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l61.15"></a><span id="l61.15">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l61.16"></a><span id="l61.16">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l61.17"></a><span id="l61.17">     // to return</span>
<a href="#l61.18"></a><span id="l61.18">     do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l61.19"></a><span id="l61.19">   }</span>
<a href="#l61.20"></a><span id="l61.20"> };</span>
<a href="#l61.21"></a><span id="l61.21"> </span>
<a href="#l61.22"></a><span id="l61.22"> var urlListener =</span>
<a href="#l61.23"></a><span id="l61.23"> {</span>
<a href="#l61.24"></a><span id="l61.24">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l61.25"></a><span id="l61.25">   },</span>
<a href="#l61.26"></a><span id="l61.26">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l61.27"></a><span id="l61.27">     // Check: message successfully copied.</span>
<a href="#l61.28"></a><span id="l61.28" class="difflineminus">-    do_check_eq(aExitCode, 0);</span>
<a href="#l61.29"></a><span id="l61.29" class="difflineplus">+    Assert.equal(aExitCode, 0);</span>
<a href="#l61.30"></a><span id="l61.30">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l61.31"></a><span id="l61.31">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l61.32"></a><span id="l61.32">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l61.33"></a><span id="l61.33">     // to return</span>
<a href="#l61.34"></a><span id="l61.34">     do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l61.35"></a><span id="l61.35">   }</span>
<a href="#l61.36"></a><span id="l61.36"> };</span>
<a href="#l61.37"></a><span id="l61.37"> </span>
<a href="#l61.38"></a><span id="l61.38" class="difflineat">@@ -108,20 +108,20 @@ var gTestArray =</span>
<a href="#l61.39"></a><span id="l61.39">     // hold onto a db to make sure that empty trash deals with the case</span>
<a href="#l61.40"></a><span id="l61.40">     // of someone holding onto the db, but the trash folder has a null db.</span>
<a href="#l61.41"></a><span id="l61.41">     let gLocalTrashDB = gLocalTrashFolder.msgDatabase;</span>
<a href="#l61.42"></a><span id="l61.42">     gLocalTrashFolder.msgDatabase = null;</span>
<a href="#l61.43"></a><span id="l61.43">     // this is synchronous</span>
<a href="#l61.44"></a><span id="l61.44">     gLocalTrashFolder.emptyTrash(null, null);</span>
<a href="#l61.45"></a><span id="l61.45">     // check that the trash folder is 0 size, that the db has a 0 message count</span>
<a href="#l61.46"></a><span id="l61.46">     // and has no messages.</span>
<a href="#l61.47"></a><span id="l61.47" class="difflineminus">-    do_check_eq(0, gLocalTrashFolder.filePath.fileSize);</span>
<a href="#l61.48"></a><span id="l61.48" class="difflineminus">-    do_check_eq(0, gLocalTrashFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l61.49"></a><span id="l61.49" class="difflineplus">+    Assert.equal(0, gLocalTrashFolder.filePath.fileSize);</span>
<a href="#l61.50"></a><span id="l61.50" class="difflineplus">+    Assert.equal(0, gLocalTrashFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l61.51"></a><span id="l61.51">     let enumerator = gLocalTrashFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l61.52"></a><span id="l61.52" class="difflineminus">-    do_check_eq(false, enumerator.hasMoreElements());</span>
<a href="#l61.53"></a><span id="l61.53" class="difflineplus">+    Assert.equal(false, enumerator.hasMoreElements());</span>
<a href="#l61.54"></a><span id="l61.54">     urlListener.OnStopRunningUrl(null, 0);</span>
<a href="#l61.55"></a><span id="l61.55">   }</span>
<a href="#l61.56"></a><span id="l61.56"> ];</span>
<a href="#l61.57"></a><span id="l61.57"> </span>
<a href="#l61.58"></a><span id="l61.58"> // Our listener, which captures events.</span>
<a href="#l61.59"></a><span id="l61.59"> function gMFListener() {}</span>
<a href="#l61.60"></a><span id="l61.60"> gMFListener.prototype =</span>
<a href="#l61.61"></a><span id="l61.61"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/base/test/unit/test_fix_deferred_accounts.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_fix_deferred_accounts.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -40,16 +40,16 @@ function run_test()</span>
<a href="#l62.4"></a><span id="l62.4">   Services.prefs.setCharPref(&quot;mail.accountmanager.accounts&quot;,</span>
<a href="#l62.5"></a><span id="l62.5">                              &quot;account1,account2,account4,account5&quot;);</span>
<a href="#l62.6"></a><span id="l62.6">   // Set the default account to one we're going to get rid of. The account manager</span>
<a href="#l62.7"></a><span id="l62.7">   // should recover relatively gracefully.</span>
<a href="#l62.8"></a><span id="l62.8">   Services.prefs.setCharPref(&quot;mail.accountmanager.defaultaccount&quot;,</span>
<a href="#l62.9"></a><span id="l62.9">                              &quot;account1&quot;);</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11">   // This will force the load of the accounts setup above.</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  do_check_eq(MailServices.accounts.accounts.length, 3); // hidden account not included</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+  Assert.equal(MailServices.accounts.accounts.length, 3); // hidden account not included</span>
<a href="#l62.14"></a><span id="l62.14">   let server4 = MailServices.accounts.getAccount(&quot;account4&quot;).incomingServer</span>
<a href="#l62.15"></a><span id="l62.15">                             .QueryInterface(Ci.nsIPop3IncomingServer);</span>
<a href="#l62.16"></a><span id="l62.16" class="difflineminus">-  do_check_eq(server4.deferredToAccount, &quot;account1&quot;);</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineplus">+  Assert.equal(server4.deferredToAccount, &quot;account1&quot;);</span>
<a href="#l62.18"></a><span id="l62.18">   let server5 = MailServices.accounts.getAccount(&quot;account5&quot;).incomingServer</span>
<a href="#l62.19"></a><span id="l62.19">                             .QueryInterface(Ci.nsIPop3IncomingServer);</span>
<a href="#l62.20"></a><span id="l62.20" class="difflineminus">-  do_check_eq(server5.deferredToAccount, &quot;account1&quot;);</span>
<a href="#l62.21"></a><span id="l62.21" class="difflineplus">+  Assert.equal(server5.deferredToAccount, &quot;account1&quot;);</span>
<a href="#l62.22"></a><span id="l62.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -47,36 +47,36 @@ var copyListenerWrap =</span>
<a href="#l63.4"></a><span id="l63.4">   SetMessageKey: function(aKey)</span>
<a href="#l63.5"></a><span id="l63.5">   {</span>
<a href="#l63.6"></a><span id="l63.6">     let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l63.7"></a><span id="l63.7">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l63.8"></a><span id="l63.8">   },</span>
<a href="#l63.9"></a><span id="l63.9">   OnStopCopy: function(aStatus)</span>
<a href="#l63.10"></a><span id="l63.10">   {</span>
<a href="#l63.11"></a><span id="l63.11">     // Check: message successfully copied.</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l63.14"></a><span id="l63.14">   }</span>
<a href="#l63.15"></a><span id="l63.15"> };</span>
<a href="#l63.16"></a><span id="l63.16"> </span>
<a href="#l63.17"></a><span id="l63.17"> var urlListenerWrap =</span>
<a href="#l63.18"></a><span id="l63.18"> {</span>
<a href="#l63.19"></a><span id="l63.19">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l63.20"></a><span id="l63.20">     // Check: message successfully copied.</span>
<a href="#l63.21"></a><span id="l63.21" class="difflineminus">-    do_check_eq(aExitCode, 0);</span>
<a href="#l63.22"></a><span id="l63.22" class="difflineplus">+    Assert.equal(aExitCode, 0);</span>
<a href="#l63.23"></a><span id="l63.23"> </span>
<a href="#l63.24"></a><span id="l63.24">     if (gMsgKeys.length &gt; 0) {</span>
<a href="#l63.25"></a><span id="l63.25">       // Bug 854798: Check if the new message keys are the same as before compaction.</span>
<a href="#l63.26"></a><span id="l63.26">       let folderMsgs = gMsgKeys.folder.messages;</span>
<a href="#l63.27"></a><span id="l63.27">       // First message was deleted so skip it in the old array.</span>
<a href="#l63.28"></a><span id="l63.28">       for (let i = 1; i &lt; gMsgKeys.length; i++) {</span>
<a href="#l63.29"></a><span id="l63.29" class="difflineminus">-        do_check_true(folderMsgs.hasMoreElements());</span>
<a href="#l63.30"></a><span id="l63.30" class="difflineplus">+        Assert.ok(folderMsgs.hasMoreElements());</span>
<a href="#l63.31"></a><span id="l63.31">         let header = folderMsgs.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineminus">-        do_check_eq(header.messageKey, gMsgKeys[i]);</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineplus">+        Assert.equal(header.messageKey, gMsgKeys[i]);</span>
<a href="#l63.34"></a><span id="l63.34">       }</span>
<a href="#l63.35"></a><span id="l63.35" class="difflineminus">-      do_check_false(folderMsgs.hasMoreElements());</span>
<a href="#l63.36"></a><span id="l63.36" class="difflineplus">+      Assert.ok(!folderMsgs.hasMoreElements());</span>
<a href="#l63.37"></a><span id="l63.37">       gMsgKeys.length = 0;</span>
<a href="#l63.38"></a><span id="l63.38">     }</span>
<a href="#l63.39"></a><span id="l63.39">   }</span>
<a href="#l63.40"></a><span id="l63.40"> };</span>
<a href="#l63.41"></a><span id="l63.41"> </span>
<a href="#l63.42"></a><span id="l63.42"> function copyFileMessage(file, destFolder, isDraftOrTemplate)</span>
<a href="#l63.43"></a><span id="l63.43"> {</span>
<a href="#l63.44"></a><span id="l63.44">   let listener = new PromiseTestUtils.PromiseCopyListener(copyListenerWrap);</span>
<a href="#l63.45"></a><span id="l63.45" class="difflineat">@@ -130,17 +130,17 @@ function verifyMsgOffsets(folder)</span>
<a href="#l63.46"></a><span id="l63.46">   let enumerator = msgDB.EnumerateMessages();</span>
<a href="#l63.47"></a><span id="l63.47">   if (enumerator)</span>
<a href="#l63.48"></a><span id="l63.48">   {</span>
<a href="#l63.49"></a><span id="l63.49">     while (enumerator.hasMoreElements())</span>
<a href="#l63.50"></a><span id="l63.50">     {</span>
<a href="#l63.51"></a><span id="l63.51">       let header = enumerator.getNext();</span>
<a href="#l63.52"></a><span id="l63.52">       if (header instanceof Components.interfaces.nsIMsgDBHdr) {</span>
<a href="#l63.53"></a><span id="l63.53">         let storeToken = header.getStringProperty(&quot;storeToken&quot;);</span>
<a href="#l63.54"></a><span id="l63.54" class="difflineminus">-        do_check_eq(storeToken, header.messageOffset);</span>
<a href="#l63.55"></a><span id="l63.55" class="difflineplus">+        Assert.equal(storeToken, header.messageOffset);</span>
<a href="#l63.56"></a><span id="l63.56">       }</span>
<a href="#l63.57"></a><span id="l63.57">     }</span>
<a href="#l63.58"></a><span id="l63.58">   }</span>
<a href="#l63.59"></a><span id="l63.59"> }</span>
<a href="#l63.60"></a><span id="l63.60"> </span>
<a href="#l63.61"></a><span id="l63.61"> /*</span>
<a href="#l63.62"></a><span id="l63.62">  * TESTS</span>
<a href="#l63.63"></a><span id="l63.63">  */</span>
<a href="#l63.64"></a><span id="l63.64" class="difflineat">@@ -192,25 +192,25 @@ var gTestArray =</span>
<a href="#l63.65"></a><span id="l63.65">     // Now delete the message</span>
<a href="#l63.66"></a><span id="l63.66">     yield deleteMessages(gLocalFolder3, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l63.67"></a><span id="l63.67"> </span>
<a href="#l63.68"></a><span id="l63.68">     showMessages(gLocalFolder3, &quot;after deleting 1 message to trash&quot;);</span>
<a href="#l63.69"></a><span id="l63.69">   },</span>
<a href="#l63.70"></a><span id="l63.70">   function* compactFolder()</span>
<a href="#l63.71"></a><span id="l63.71">   {</span>
<a href="#l63.72"></a><span id="l63.72">     gExpectedFolderSize = calculateFolderSize(gLocalFolder3);</span>
<a href="#l63.73"></a><span id="l63.73" class="difflineminus">-    do_check_neq(gLocalFolder3.expungedBytes, 0);</span>
<a href="#l63.74"></a><span id="l63.74" class="difflineplus">+    Assert.notEqual(gLocalFolder3.expungedBytes, 0);</span>
<a href="#l63.75"></a><span id="l63.75">     let listener = new PromiseTestUtils.PromiseUrlListener(urlListenerWrap);</span>
<a href="#l63.76"></a><span id="l63.76">     gLocalFolder3.compact(listener, null);</span>
<a href="#l63.77"></a><span id="l63.77">     yield listener.promise;</span>
<a href="#l63.78"></a><span id="l63.78"> </span>
<a href="#l63.79"></a><span id="l63.79">     showMessages(gLocalFolder3, &quot;after compact&quot;);</span>
<a href="#l63.80"></a><span id="l63.80">   },</span>
<a href="#l63.81"></a><span id="l63.81">   function* testDeleteMessages2() {</span>
<a href="#l63.82"></a><span id="l63.82" class="difflineminus">-    do_check_eq(gExpectedFolderSize, gLocalFolder3.filePath.fileSize);</span>
<a href="#l63.83"></a><span id="l63.83" class="difflineplus">+    Assert.equal(gExpectedFolderSize, gLocalFolder3.filePath.fileSize);</span>
<a href="#l63.84"></a><span id="l63.84">     verifyMsgOffsets(gLocalFolder3);</span>
<a href="#l63.85"></a><span id="l63.85">     var folder2DB = gLocalFolder2.msgDatabase;</span>
<a href="#l63.86"></a><span id="l63.86">     gMsgHdrs[0].hdr = folder2DB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l63.87"></a><span id="l63.87"> </span>
<a href="#l63.88"></a><span id="l63.88">     // Store message keys before deletion and compaction.</span>
<a href="#l63.89"></a><span id="l63.89">     gMsgKeys.folder = gLocalFolder2;</span>
<a href="#l63.90"></a><span id="l63.90">     let folderMsgs = gLocalFolder2.messages;</span>
<a href="#l63.91"></a><span id="l63.91">     while (folderMsgs.hasMoreElements()) {</span>
<a href="#l63.92"></a><span id="l63.92" class="difflineat">@@ -255,46 +255,46 @@ var gTestArray =</span>
<a href="#l63.93"></a><span id="l63.93">     // We used to check here that the keys did not change during rebuild.</span>
<a href="#l63.94"></a><span id="l63.94">     // But that is no true in general, it was only conicidental since the</span>
<a href="#l63.95"></a><span id="l63.95">     // checked folder had never been compacted, so the key equaled the offset.</span>
<a href="#l63.96"></a><span id="l63.96">     // We do not in guarantee that, indeed after rebuild we expect the keys</span>
<a href="#l63.97"></a><span id="l63.97">     // to change.</span>
<a href="#l63.98"></a><span id="l63.98">     let checkResult = {</span>
<a href="#l63.99"></a><span id="l63.99">       OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l63.100"></a><span id="l63.100">       // Check: message successfully compacted.</span>
<a href="#l63.101"></a><span id="l63.101" class="difflineminus">-      do_check_eq(aExitCode, 0);</span>
<a href="#l63.102"></a><span id="l63.102" class="difflineplus">+      Assert.equal(aExitCode, 0);</span>
<a href="#l63.103"></a><span id="l63.103">       }</span>
<a href="#l63.104"></a><span id="l63.104">     };</span>
<a href="#l63.105"></a><span id="l63.105">     let listener = new PromiseTestUtils.PromiseUrlListener(checkResult);</span>
<a href="#l63.106"></a><span id="l63.106">     localAccountUtils.inboxFolder.compactAll(listener, null, true);</span>
<a href="#l63.107"></a><span id="l63.107">     yield listener.promise;</span>
<a href="#l63.108"></a><span id="l63.108"> </span>
<a href="#l63.109"></a><span id="l63.109">     showMessages(localAccountUtils.inboxFolder, &quot;after compactAll&quot;);</span>
<a href="#l63.110"></a><span id="l63.110">     showMessages(gLocalFolder2, &quot;after compactAll&quot;);</span>
<a href="#l63.111"></a><span id="l63.111"> </span>
<a href="#l63.112"></a><span id="l63.112">     // For the inbox, which was compacted but not rebuild, key is unchanged.</span>
<a href="#l63.113"></a><span id="l63.113">     let postInboxMsg3Key = localAccountUtils.inboxFolder.msgDatabase</span>
<a href="#l63.114"></a><span id="l63.114">                                             .getMsgHdrForMessageID(gMsg3ID)</span>
<a href="#l63.115"></a><span id="l63.115">                                             .messageKey;</span>
<a href="#l63.116"></a><span id="l63.116" class="difflineminus">-    do_check_eq(preInboxMsg3Key, postInboxMsg3Key);</span>
<a href="#l63.117"></a><span id="l63.117" class="difflineplus">+    Assert.equal(preInboxMsg3Key, postInboxMsg3Key);</span>
<a href="#l63.118"></a><span id="l63.118"> </span>
<a href="#l63.119"></a><span id="l63.119">     // For folder2, which was rebuilt, keys change but all messages should exist.</span>
<a href="#l63.120"></a><span id="l63.120">     let message2 = gLocalFolder2.msgDatabase.getMsgHdrForMessageID(gMsg2ID);</span>
<a href="#l63.121"></a><span id="l63.121" class="difflineminus">-    do_check_true(message2);</span>
<a href="#l63.122"></a><span id="l63.122" class="difflineminus">-    do_check_true(gLocalFolder2.msgDatabase.getMsgHdrForMessageID(gMsg3ID));</span>
<a href="#l63.123"></a><span id="l63.123" class="difflineplus">+    Assert.ok(message2);</span>
<a href="#l63.124"></a><span id="l63.124" class="difflineplus">+    Assert.ok(gLocalFolder2.msgDatabase.getMsgHdrForMessageID(gMsg3ID));</span>
<a href="#l63.125"></a><span id="l63.125"> </span>
<a href="#l63.126"></a><span id="l63.126">     // In folder2, gMsg2ID is the first message. After compact with database</span>
<a href="#l63.127"></a><span id="l63.127">     // rebuild, that key has now changed.</span>
<a href="#l63.128"></a><span id="l63.128" class="difflineminus">-    do_check_neq(message2.messageKey, f2m2Key);</span>
<a href="#l63.129"></a><span id="l63.129" class="difflineplus">+    Assert.notEqual(message2.messageKey, f2m2Key);</span>
<a href="#l63.130"></a><span id="l63.130">   },</span>
<a href="#l63.131"></a><span id="l63.131">   function lastTestCheck()</span>
<a href="#l63.132"></a><span id="l63.132">   {</span>
<a href="#l63.133"></a><span id="l63.133" class="difflineminus">-    do_check_eq(gExpectedInboxSize, localAccountUtils.inboxFolder.filePath.fileSize);</span>
<a href="#l63.134"></a><span id="l63.134" class="difflineminus">-    do_check_eq(gExpectedFolder2Size, gLocalFolder2.filePath.fileSize);</span>
<a href="#l63.135"></a><span id="l63.135" class="difflineminus">-    do_check_eq(gExpectedFolder3Size, gLocalFolder3.filePath.fileSize);</span>
<a href="#l63.136"></a><span id="l63.136" class="difflineplus">+    Assert.equal(gExpectedInboxSize, localAccountUtils.inboxFolder.filePath.fileSize);</span>
<a href="#l63.137"></a><span id="l63.137" class="difflineplus">+    Assert.equal(gExpectedFolder2Size, gLocalFolder2.filePath.fileSize);</span>
<a href="#l63.138"></a><span id="l63.138" class="difflineplus">+    Assert.equal(gExpectedFolder3Size, gLocalFolder3.filePath.fileSize);</span>
<a href="#l63.139"></a><span id="l63.139">     verifyMsgOffsets(gLocalFolder2);</span>
<a href="#l63.140"></a><span id="l63.140">     verifyMsgOffsets(gLocalFolder3);</span>
<a href="#l63.141"></a><span id="l63.141">     verifyMsgOffsets(localAccountUtils.inboxFolder);</span>
<a href="#l63.142"></a><span id="l63.142">   }</span>
<a href="#l63.143"></a><span id="l63.143"> ];</span>
<a href="#l63.144"></a><span id="l63.144"> </span>
<a href="#l63.145"></a><span id="l63.145"> function run_test()</span>
<a href="#l63.146"></a><span id="l63.146"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/base/test/unit/test_folderLookupService.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_folderLookupService.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -12,36 +12,36 @@ var kRootURI = &quot;mailbox://nobody@Local%2</span>
<a href="#l64.4"></a><span id="l64.4"> function run_test() {</span>
<a href="#l64.5"></a><span id="l64.5">   let fls = Components.classes[&quot;@mozilla.org/mail/folder-lookup;1&quot;]</span>
<a href="#l64.6"></a><span id="l64.6">                       .getService(Components.interfaces.nsIFolderLookupService);</span>
<a href="#l64.7"></a><span id="l64.7"> </span>
<a href="#l64.8"></a><span id="l64.8">   // Make sure that the local mail account exists.</span>
<a href="#l64.9"></a><span id="l64.9">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l64.10"></a><span id="l64.10"> </span>
<a href="#l64.11"></a><span id="l64.11">   // There should exist an inbox.</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI + &quot;/Inbox&quot;),</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI + &quot;/Inbox&quot;),</span>
<a href="#l64.14"></a><span id="l64.14">     localAccountUtils.inboxFolder);</span>
<a href="#l64.15"></a><span id="l64.15"> </span>
<a href="#l64.16"></a><span id="l64.16">   // Can we get the root folder?</span>
<a href="#l64.17"></a><span id="l64.17">   let root = localAccountUtils.rootFolder;</span>
<a href="#l64.18"></a><span id="l64.18" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI), root);</span>
<a href="#l64.19"></a><span id="l64.19" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI), root);</span>
<a href="#l64.20"></a><span id="l64.20"> </span>
<a href="#l64.21"></a><span id="l64.21">   // The child folder Child doesn't exist yet... make sure that fls doesn't</span>
<a href="#l64.22"></a><span id="l64.22">   // return it yet</span>
<a href="#l64.23"></a><span id="l64.23" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI + &quot;/Child&quot;), null);</span>
<a href="#l64.24"></a><span id="l64.24" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI + &quot;/Child&quot;), null);</span>
<a href="#l64.25"></a><span id="l64.25"> </span>
<a href="#l64.26"></a><span id="l64.26">   // Create the folder, and then it should exist.</span>
<a href="#l64.27"></a><span id="l64.27">   root.createSubfolder(&quot;Child&quot;, null);</span>
<a href="#l64.28"></a><span id="l64.28" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI + &quot;/Child&quot;),</span>
<a href="#l64.29"></a><span id="l64.29" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI + &quot;/Child&quot;),</span>
<a href="#l64.30"></a><span id="l64.30">     root.getChildNamed(&quot;Child&quot;));</span>
<a href="#l64.31"></a><span id="l64.31"> </span>
<a href="#l64.32"></a><span id="l64.32">   // Try it again... it should load from cache this time.</span>
<a href="#l64.33"></a><span id="l64.33" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI + &quot;/Child&quot;),</span>
<a href="#l64.34"></a><span id="l64.34" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI + &quot;/Child&quot;),</span>
<a href="#l64.35"></a><span id="l64.35">     root.getChildNamed(&quot;Child&quot;));</span>
<a href="#l64.36"></a><span id="l64.36"> </span>
<a href="#l64.37"></a><span id="l64.37">   // Now delete the folder; we should be unable to find it</span>
<a href="#l64.38"></a><span id="l64.38">   root.propagateDelete(root.getChildNamed(&quot;Child&quot;), true, null);</span>
<a href="#l64.39"></a><span id="l64.39" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI + &quot;/Child&quot;), null);</span>
<a href="#l64.40"></a><span id="l64.40" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI + &quot;/Child&quot;), null);</span>
<a href="#l64.41"></a><span id="l64.41"> </span>
<a href="#l64.42"></a><span id="l64.42" class="difflineminus">-  do_check_eq(fls.getFolderForURL(kRootURI + &quot;/&quot;), null);</span>
<a href="#l64.43"></a><span id="l64.43" class="difflineminus">-  do_check_eq(fls.getFolderForURL(&quot;mailbox://idonotexist@Local%20Folders&quot;),</span>
<a href="#l64.44"></a><span id="l64.44" class="difflineplus">+  Assert.equal(fls.getFolderForURL(kRootURI + &quot;/&quot;), null);</span>
<a href="#l64.45"></a><span id="l64.45" class="difflineplus">+  Assert.equal(fls.getFolderForURL(&quot;mailbox://idonotexist@Local%20Folders&quot;),</span>
<a href="#l64.46"></a><span id="l64.46">     null);</span>
<a href="#l64.47"></a><span id="l64.47"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/base/test/unit/test_formatFileSize.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_formatFileSize.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -31,17 +31,17 @@ function test_formatFileSize(aArgs) {</span>
<a href="#l65.4"></a><span id="l65.4"> </span>
<a href="#l65.5"></a><span id="l65.5">   // If the actual string contains a non-numeric character at the position</span>
<a href="#l65.6"></a><span id="l65.6">   // where we'd expect a decimal separator, assume it is a localized separator</span>
<a href="#l65.7"></a><span id="l65.7">   // and just convert it to a dot for easy comparing.</span>
<a href="#l65.8"></a><span id="l65.8">   let separatorPos = aArgs.mantissa.indexOf(&quot;.&quot;);</span>
<a href="#l65.9"></a><span id="l65.9">   if (!isDigit(actual.charAt(separatorPos)))</span>
<a href="#l65.10"></a><span id="l65.10">     actual = actual.substring(0, separatorPos) + &quot;.&quot; + actual.substr(separatorPos + 1);</span>
<a href="#l65.11"></a><span id="l65.11"> </span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  do_check_eq(actual, expected);</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+  Assert.equal(actual, expected);</span>
<a href="#l65.14"></a><span id="l65.14"> }</span>
<a href="#l65.15"></a><span id="l65.15"> </span>
<a href="#l65.16"></a><span id="l65.16"> /* ===== Driver ===== */</span>
<a href="#l65.17"></a><span id="l65.17"> </span>
<a href="#l65.18"></a><span id="l65.18"> var test_data = [</span>
<a href="#l65.19"></a><span id="l65.19">   { bytes:                   0, useKB: false, mantissa:    &quot;0&quot;, units:  &quot;b&quot; },</span>
<a href="#l65.20"></a><span id="l65.20">   { bytes:                   1, useKB: false, mantissa:    &quot;1&quot;, units:  &quot;b&quot; },</span>
<a href="#l65.21"></a><span id="l65.21">   { bytes:                  10, useKB: false, mantissa:   &quot;10&quot;, units:  &quot;b&quot; },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/base/test/unit/test_getMsgTextFromStream.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_getMsgTextFromStream.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -65,15 +65,15 @@ function run_test()</span>
<a href="#l66.4"></a><span id="l66.4">     inStream.init(inFile, -1, -1, Ci.nsIFileInputStream.CLOSE_ON_EOF);</span>
<a href="#l66.5"></a><span id="l66.5"> </span>
<a href="#l66.6"></a><span id="l66.6">     // Now get the message body using getMsgTextFromStream</span>
<a href="#l66.7"></a><span id="l66.7">     var contentType = {};</span>
<a href="#l66.8"></a><span id="l66.8">     var body = folder.getMsgTextFromStream(inStream, &quot;&quot;, test.bytesToRead, 65536,</span>
<a href="#l66.9"></a><span id="l66.9">                                            test.compressQuotes, test.stripHTML, contentType);</span>
<a href="#l66.10"></a><span id="l66.10"> </span>
<a href="#l66.11"></a><span id="l66.11">     // Now we need to compare the output</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-    do_check_eq(test.contentType, contentType.value);</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+    Assert.equal(test.contentType, contentType.value);</span>
<a href="#l66.14"></a><span id="l66.14"> </span>
<a href="#l66.15"></a><span id="l66.15">     var resultFile = do_get_file(kDataRoot + test.name + &quot;.out&quot;);</span>
<a href="#l66.16"></a><span id="l66.16">     var actualBody = mailTestUtils.loadFileToString(resultFile, &quot;UTF-8&quot;);</span>
<a href="#l66.17"></a><span id="l66.17" class="difflineminus">-    do_check_eq(body, actualBody);</span>
<a href="#l66.18"></a><span id="l66.18" class="difflineplus">+    Assert.equal(body, actualBody);</span>
<a href="#l66.19"></a><span id="l66.19">   });</span>
<a href="#l66.20"></a><span id="l66.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/base/test/unit/test_hostnameUtils.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_hostnameUtils.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -97,48 +97,48 @@ function test_IPaddresses() {</span>
<a href="#l67.4"></a><span id="l67.4">   for (let item of kIPsToTest) {</span>
<a href="#l67.5"></a><span id="l67.5">     let result = null;</span>
<a href="#l67.6"></a><span id="l67.6">     let [isValid, address, isIPv6, isLocal, isExtended, wantedResult] = item;</span>
<a href="#l67.7"></a><span id="l67.7">     if (!wantedResult)</span>
<a href="#l67.8"></a><span id="l67.8">       wantedResult = isValid ? address : null;</span>
<a href="#l67.9"></a><span id="l67.9"> </span>
<a href="#l67.10"></a><span id="l67.10">     if (isIPv6) {</span>
<a href="#l67.11"></a><span id="l67.11">       result = isLegalIPv6Address(address);</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-      do_check_eq(result, wantedResult);</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+      Assert.equal(result, wantedResult);</span>
<a href="#l67.14"></a><span id="l67.14">       if (isValid) {</span>
<a href="#l67.15"></a><span id="l67.15">         // If this is valid IPv6, it can't be valid IPv4. The opposite is unknown.</span>
<a href="#l67.16"></a><span id="l67.16">         result = isLegalIPv4Address(address);</span>
<a href="#l67.17"></a><span id="l67.17" class="difflineminus">-        do_check_eq(result, null);</span>
<a href="#l67.18"></a><span id="l67.18" class="difflineplus">+        Assert.equal(result, null);</span>
<a href="#l67.19"></a><span id="l67.19">       }</span>
<a href="#l67.20"></a><span id="l67.20">     } else {</span>
<a href="#l67.21"></a><span id="l67.21">       result = isLegalIPv4Address(address, isExtended);</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineminus">-      do_check_eq(result, wantedResult);</span>
<a href="#l67.23"></a><span id="l67.23" class="difflineplus">+      Assert.equal(result, wantedResult);</span>
<a href="#l67.24"></a><span id="l67.24">       if (isValid) {</span>
<a href="#l67.25"></a><span id="l67.25">         // If this is valid IPv4, it can't be valid IPv6. The opposite is unknown.</span>
<a href="#l67.26"></a><span id="l67.26">         result = isLegalIPv6Address(address);</span>
<a href="#l67.27"></a><span id="l67.27" class="difflineminus">-        do_check_eq(result, null);</span>
<a href="#l67.28"></a><span id="l67.28" class="difflineplus">+        Assert.equal(result, null);</span>
<a href="#l67.29"></a><span id="l67.29">       }</span>
<a href="#l67.30"></a><span id="l67.30">     }</span>
<a href="#l67.31"></a><span id="l67.31"> </span>
<a href="#l67.32"></a><span id="l67.32">     result = isLegalIPAddress(address, isExtended);</span>
<a href="#l67.33"></a><span id="l67.33" class="difflineminus">-    do_check_eq(result, wantedResult);</span>
<a href="#l67.34"></a><span id="l67.34" class="difflineplus">+    Assert.equal(result, wantedResult);</span>
<a href="#l67.35"></a><span id="l67.35"> </span>
<a href="#l67.36"></a><span id="l67.36">     if (isValid) {</span>
<a href="#l67.37"></a><span id="l67.37">       // isLegalLocalIPAddress operates on a normalized address,</span>
<a href="#l67.38"></a><span id="l67.38">       // not the original one.</span>
<a href="#l67.39"></a><span id="l67.39">       result = isLegalLocalIPAddress(result);</span>
<a href="#l67.40"></a><span id="l67.40" class="difflineminus">-      do_check_eq(result, isLocal);</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineplus">+      Assert.equal(result, isLocal);</span>
<a href="#l67.42"></a><span id="l67.42">     }</span>
<a href="#l67.43"></a><span id="l67.43"> </span>
<a href="#l67.44"></a><span id="l67.44">     // If something is a valid IP, it also passes isLegalHostNameOrIP.</span>
<a href="#l67.45"></a><span id="l67.45">     // However, an invalid IP string may still be a valid hostname.</span>
<a href="#l67.46"></a><span id="l67.46">     // So only check success if the IP is valid.</span>
<a href="#l67.47"></a><span id="l67.47">     result = isLegalHostNameOrIP(address, isExtended);</span>
<a href="#l67.48"></a><span id="l67.48">     if (isValid)</span>
<a href="#l67.49"></a><span id="l67.49" class="difflineminus">-      do_check_eq(result, wantedResult);</span>
<a href="#l67.50"></a><span id="l67.50" class="difflineplus">+      Assert.equal(result, wantedResult);</span>
<a href="#l67.51"></a><span id="l67.51">   }</span>
<a href="#l67.52"></a><span id="l67.52"> }</span>
<a href="#l67.53"></a><span id="l67.53"> /**</span>
<a href="#l67.54"></a><span id="l67.54">  * Checks if valid and invalid host names are properly allowed or rejected.</span>
<a href="#l67.55"></a><span id="l67.55">  */</span>
<a href="#l67.56"></a><span id="l67.56"> function test_hostnames() {</span>
<a href="#l67.57"></a><span id="l67.57">   const kHostsToTest = [</span>
<a href="#l67.58"></a><span id="l67.58">     // isValid,	hostname</span>
<a href="#l67.59"></a><span id="l67.59" class="difflineat">@@ -170,20 +170,20 @@ function test_hostnames() {</span>
<a href="#l67.60"></a><span id="l67.60">   ];</span>
<a href="#l67.61"></a><span id="l67.61"> </span>
<a href="#l67.62"></a><span id="l67.62">   for (let item of kHostsToTest) {</span>
<a href="#l67.63"></a><span id="l67.63">     let result = null;</span>
<a href="#l67.64"></a><span id="l67.64">     let [wantedResult, hostname] = item;</span>
<a href="#l67.65"></a><span id="l67.65">     wantedResult = wantedResult ? hostname : null;</span>
<a href="#l67.66"></a><span id="l67.66"> </span>
<a href="#l67.67"></a><span id="l67.67">     result = isLegalHostName(hostname);</span>
<a href="#l67.68"></a><span id="l67.68" class="difflineminus">-    do_check_eq(result, wantedResult);</span>
<a href="#l67.69"></a><span id="l67.69" class="difflineplus">+    Assert.equal(result, wantedResult);</span>
<a href="#l67.70"></a><span id="l67.70"> </span>
<a href="#l67.71"></a><span id="l67.71">     result = isLegalHostNameOrIP(hostname, false);</span>
<a href="#l67.72"></a><span id="l67.72" class="difflineminus">-    do_check_eq(result, wantedResult);</span>
<a href="#l67.73"></a><span id="l67.73" class="difflineplus">+    Assert.equal(result, wantedResult);</span>
<a href="#l67.74"></a><span id="l67.74">   }</span>
<a href="#l67.75"></a><span id="l67.75"> }</span>
<a href="#l67.76"></a><span id="l67.76"> </span>
<a href="#l67.77"></a><span id="l67.77"> var gTests = [</span>
<a href="#l67.78"></a><span id="l67.78">   test_IPaddresses,</span>
<a href="#l67.79"></a><span id="l67.79">   test_hostnames,</span>
<a href="#l67.80"></a><span id="l67.80"> ];</span>
<a href="#l67.81"></a><span id="l67.81"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/base/test/unit/test_inheritedFolderProperties.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_inheritedFolderProperties.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -25,84 +25,84 @@ function run_test()</span>
<a href="#l68.4"></a><span id="l68.4">   const globalPref = &quot;mail.server.default.&quot; + propertyName;</span>
<a href="#l68.5"></a><span id="l68.5">   const globalValue = &quot;iAmGlobal&quot;;</span>
<a href="#l68.6"></a><span id="l68.6">   const folderValue = &quot;iAmFolder&quot;;</span>
<a href="#l68.7"></a><span id="l68.7">   const folderValue2 = &quot;iAmFolder2&quot;;</span>
<a href="#l68.8"></a><span id="l68.8">   const rootValue = &quot;iAmRoot&quot;;</span>
<a href="#l68.9"></a><span id="l68.9">   Services.prefs.setCharPref(globalPref, globalValue);</span>
<a href="#l68.10"></a><span id="l68.10"> </span>
<a href="#l68.11"></a><span id="l68.11">   // test that the global preference is honored</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.14"></a><span id="l68.14" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.15"></a><span id="l68.15" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(invalidName), null);</span>
<a href="#l68.16"></a><span id="l68.16" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(invalidName), null);</span>
<a href="#l68.17"></a><span id="l68.17" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(invalidName), null);</span>
<a href="#l68.18"></a><span id="l68.18" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.19"></a><span id="l68.19" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.20"></a><span id="l68.20" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.21"></a><span id="l68.21" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(invalidName), null);</span>
<a href="#l68.22"></a><span id="l68.22" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(invalidName), null);</span>
<a href="#l68.23"></a><span id="l68.23" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(invalidName), null);</span>
<a href="#l68.24"></a><span id="l68.24"> </span>
<a href="#l68.25"></a><span id="l68.25">   // set a value on a subfolder and check</span>
<a href="#l68.26"></a><span id="l68.26">   subFolder11.setStringProperty(propertyName, folderValue);</span>
<a href="#l68.27"></a><span id="l68.27" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.28"></a><span id="l68.28" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.29"></a><span id="l68.29" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.30"></a><span id="l68.30" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.31"></a><span id="l68.31" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.32"></a><span id="l68.32" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.33"></a><span id="l68.33" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.34"></a><span id="l68.34" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.35"></a><span id="l68.35" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.36"></a><span id="l68.36" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.37"></a><span id="l68.37"> </span>
<a href="#l68.38"></a><span id="l68.38">   // set a root folder value and check</span>
<a href="#l68.39"></a><span id="l68.39">   localAccountUtils.incomingServer.setCharValue(propertyName, rootValue);</span>
<a href="#l68.40"></a><span id="l68.40" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.41"></a><span id="l68.41" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.42"></a><span id="l68.42" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.43"></a><span id="l68.43" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.44"></a><span id="l68.44" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.45"></a><span id="l68.45" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.46"></a><span id="l68.46" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.47"></a><span id="l68.47" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.48"></a><span id="l68.48" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.49"></a><span id="l68.49" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.50"></a><span id="l68.50"> </span>
<a href="#l68.51"></a><span id="l68.51">   // force an empty string</span>
<a href="#l68.52"></a><span id="l68.52">   subFolder12.setForcePropertyEmpty(propertyName, true);</span>
<a href="#l68.53"></a><span id="l68.53" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.54"></a><span id="l68.54" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.55"></a><span id="l68.55" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.56"></a><span id="l68.56" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.57"></a><span id="l68.57" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.58"></a><span id="l68.58" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.59"></a><span id="l68.59" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.60"></a><span id="l68.60" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.61"></a><span id="l68.61" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.62"></a><span id="l68.62" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.63"></a><span id="l68.63"> </span>
<a href="#l68.64"></a><span id="l68.64">   // reset a folder to allow inheritance</span>
<a href="#l68.65"></a><span id="l68.65">   subFolder12.setForcePropertyEmpty(propertyName, false);</span>
<a href="#l68.66"></a><span id="l68.66">   subFolder12.setStringProperty(propertyName, &quot;&quot;);</span>
<a href="#l68.67"></a><span id="l68.67" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.68"></a><span id="l68.68" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.69"></a><span id="l68.69" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.70"></a><span id="l68.70" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.71"></a><span id="l68.71" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.72"></a><span id="l68.72" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.73"></a><span id="l68.73" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.74"></a><span id="l68.74" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.75"></a><span id="l68.75" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.76"></a><span id="l68.76" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.77"></a><span id="l68.77"> </span>
<a href="#l68.78"></a><span id="l68.78">   // force an empty string on the server</span>
<a href="#l68.79"></a><span id="l68.79">   localAccountUtils.incomingServer.setForcePropertyEmpty(propertyName, true);</span>
<a href="#l68.80"></a><span id="l68.80" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.81"></a><span id="l68.81" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.82"></a><span id="l68.82" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.83"></a><span id="l68.83" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.84"></a><span id="l68.84" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.85"></a><span id="l68.85" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.86"></a><span id="l68.86" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.87"></a><span id="l68.87" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.88"></a><span id="l68.88" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.89"></a><span id="l68.89" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), &quot;&quot;);</span>
<a href="#l68.90"></a><span id="l68.90"> </span>
<a href="#l68.91"></a><span id="l68.91">   // reset a server to allow inheritance from the global</span>
<a href="#l68.92"></a><span id="l68.92">   localAccountUtils.incomingServer.setCharValue(propertyName, &quot;&quot;);</span>
<a href="#l68.93"></a><span id="l68.93">   localAccountUtils.incomingServer.setForcePropertyEmpty(propertyName, false);</span>
<a href="#l68.94"></a><span id="l68.94" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.95"></a><span id="l68.95" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.96"></a><span id="l68.96" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.97"></a><span id="l68.97" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.98"></a><span id="l68.98" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.99"></a><span id="l68.99" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.100"></a><span id="l68.100" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.101"></a><span id="l68.101" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.102"></a><span id="l68.102" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.103"></a><span id="l68.103" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), globalValue);</span>
<a href="#l68.104"></a><span id="l68.104"> </span>
<a href="#l68.105"></a><span id="l68.105">   // check with all levels populated</span>
<a href="#l68.106"></a><span id="l68.106">   subFolder21.setStringProperty(propertyName, folderValue2);</span>
<a href="#l68.107"></a><span id="l68.107">   localAccountUtils.incomingServer.setCharValue(propertyName, rootValue);</span>
<a href="#l68.108"></a><span id="l68.108" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.109"></a><span id="l68.109" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.110"></a><span id="l68.110" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.111"></a><span id="l68.111" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue2);</span>
<a href="#l68.112"></a><span id="l68.112" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.113"></a><span id="l68.113" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.114"></a><span id="l68.114" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.115"></a><span id="l68.115" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.116"></a><span id="l68.116" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue2);</span>
<a href="#l68.117"></a><span id="l68.117" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), rootValue);</span>
<a href="#l68.118"></a><span id="l68.118">   </span>
<a href="#l68.119"></a><span id="l68.119">   // clear the global value and the root value</span>
<a href="#l68.120"></a><span id="l68.120">   Services.prefs.clearUserPref(globalPref);</span>
<a href="#l68.121"></a><span id="l68.121">   localAccountUtils.incomingServer.setCharValue(propertyName, &quot;&quot;);</span>
<a href="#l68.122"></a><span id="l68.122" class="difflineminus">-  do_check_eq(rootFolder.getInheritedStringProperty(propertyName), null);</span>
<a href="#l68.123"></a><span id="l68.123" class="difflineminus">-  do_check_eq(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.124"></a><span id="l68.124" class="difflineminus">-  do_check_eq(subFolder12.getInheritedStringProperty(propertyName), null);</span>
<a href="#l68.125"></a><span id="l68.125" class="difflineminus">-  do_check_eq(subFolder21.getInheritedStringProperty(propertyName), folderValue2);</span>
<a href="#l68.126"></a><span id="l68.126" class="difflineminus">-  do_check_eq(subFolder22.getInheritedStringProperty(propertyName), null);</span>
<a href="#l68.127"></a><span id="l68.127" class="difflineplus">+  Assert.equal(rootFolder.getInheritedStringProperty(propertyName), null);</span>
<a href="#l68.128"></a><span id="l68.128" class="difflineplus">+  Assert.equal(subFolder11.getInheritedStringProperty(propertyName), folderValue);</span>
<a href="#l68.129"></a><span id="l68.129" class="difflineplus">+  Assert.equal(subFolder12.getInheritedStringProperty(propertyName), null);</span>
<a href="#l68.130"></a><span id="l68.130" class="difflineplus">+  Assert.equal(subFolder21.getInheritedStringProperty(propertyName), folderValue2);</span>
<a href="#l68.131"></a><span id="l68.131" class="difflineplus">+  Assert.equal(subFolder22.getInheritedStringProperty(propertyName), null);</span>
<a href="#l68.132"></a><span id="l68.132"> </span>
<a href="#l68.133"></a><span id="l68.133"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/base/test/unit/test_iteratorUtils.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_iteratorUtils.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -31,135 +31,135 @@ function parse_xml_file(aFileName) {</span>
<a href="#l69.4"></a><span id="l69.4">  * Tests of the supported toArray and fixIterator arguments.</span>
<a href="#l69.5"></a><span id="l69.5">  */</span>
<a href="#l69.6"></a><span id="l69.6"> function test_fixIterator() {</span>
<a href="#l69.7"></a><span id="l69.7">   let JSIteratorArray = iteratorUtils.toArray([1, 2, 3, 4, 5]);</span>
<a href="#l69.8"></a><span id="l69.8"> </span>
<a href="#l69.9"></a><span id="l69.9">   let JSArray = [];</span>
<a href="#l69.10"></a><span id="l69.10">   let i = 1;</span>
<a href="#l69.11"></a><span id="l69.11">   for (let val of JSIteratorArray) {</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-    do_check_eq(val, i++);</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+    Assert.equal(val, i++);</span>
<a href="#l69.14"></a><span id="l69.14">     JSArray.push(val);</span>
<a href="#l69.15"></a><span id="l69.15">   }</span>
<a href="#l69.16"></a><span id="l69.16"> </span>
<a href="#l69.17"></a><span id="l69.17">   i = 0;</span>
<a href="#l69.18"></a><span id="l69.18">   for (let val of iteratorUtils.fixIterator(JSArray)) {</span>
<a href="#l69.19"></a><span id="l69.19" class="difflineminus">-    do_check_eq(val, JSArray[i++]);</span>
<a href="#l69.20"></a><span id="l69.20" class="difflineplus">+    Assert.equal(val, JSArray[i++]);</span>
<a href="#l69.21"></a><span id="l69.21">   }</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineminus">-  do_check_true(i &gt; 0);</span>
<a href="#l69.23"></a><span id="l69.23" class="difflineplus">+  Assert.ok(i &gt; 0);</span>
<a href="#l69.24"></a><span id="l69.24"> </span>
<a href="#l69.25"></a><span id="l69.25">   let nsIArrayJSArray = [];</span>
<a href="#l69.26"></a><span id="l69.26">   for (let val of JSArray) {</span>
<a href="#l69.27"></a><span id="l69.27">     let nsIArrayMember = Cc[&quot;@mozilla.org/supports-PRUint8;1&quot;]</span>
<a href="#l69.28"></a><span id="l69.28">                            .createInstance(Ci.nsISupportsPRUint8);</span>
<a href="#l69.29"></a><span id="l69.29">     nsIArrayMember.data = val;</span>
<a href="#l69.30"></a><span id="l69.30">     nsIArrayJSArray.push(nsIArrayMember);</span>
<a href="#l69.31"></a><span id="l69.31">   }</span>
<a href="#l69.32"></a><span id="l69.32"> </span>
<a href="#l69.33"></a><span id="l69.33">   let nsIArray = iteratorUtils.toXPCOMArray(nsIArrayJSArray, Ci.nsIMutableArray);</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineminus">-  do_check_eq(nsIArray.length, 5);</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineplus">+  Assert.equal(nsIArray.length, 5);</span>
<a href="#l69.36"></a><span id="l69.36"> </span>
<a href="#l69.37"></a><span id="l69.37">   i = 0;</span>
<a href="#l69.38"></a><span id="l69.38">   for (let val of iteratorUtils.fixIterator(nsIArray)) {</span>
<a href="#l69.39"></a><span id="l69.39" class="difflineminus">-    do_check_eq(val, JSArray[i++]);</span>
<a href="#l69.40"></a><span id="l69.40" class="difflineplus">+    Assert.equal(val, JSArray[i++]);</span>
<a href="#l69.41"></a><span id="l69.41">   }</span>
<a href="#l69.42"></a><span id="l69.42" class="difflineminus">-  do_check_true(i &gt; 0);</span>
<a href="#l69.43"></a><span id="l69.43" class="difflineplus">+  Assert.ok(i &gt; 0);</span>
<a href="#l69.44"></a><span id="l69.44"> </span>
<a href="#l69.45"></a><span id="l69.45">   i = 0;</span>
<a href="#l69.46"></a><span id="l69.46">   for (let val of iteratorUtils.fixIterator(nsIArray.enumerate())) {</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineminus">-    do_check_eq(val, JSArray[i++]);</span>
<a href="#l69.48"></a><span id="l69.48" class="difflineplus">+    Assert.equal(val, JSArray[i++]);</span>
<a href="#l69.49"></a><span id="l69.49">   }</span>
<a href="#l69.50"></a><span id="l69.50" class="difflineminus">-  do_check_true(i &gt; 0);</span>
<a href="#l69.51"></a><span id="l69.51" class="difflineplus">+  Assert.ok(i &gt; 0);</span>
<a href="#l69.52"></a><span id="l69.52"> </span>
<a href="#l69.53"></a><span id="l69.53">   i = 0;</span>
<a href="#l69.54"></a><span id="l69.54">   let JSIteratorArray2 = iteratorUtils.toArray(iteratorUtils.fixIterator(nsIArray));</span>
<a href="#l69.55"></a><span id="l69.55">   for (let val of JSIteratorArray2) {</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineminus">-    do_check_eq(val, JSArray[i++]);</span>
<a href="#l69.57"></a><span id="l69.57" class="difflineplus">+    Assert.equal(val, JSArray[i++]);</span>
<a href="#l69.58"></a><span id="l69.58">   }</span>
<a href="#l69.59"></a><span id="l69.59" class="difflineminus">-  do_check_true(i &gt; 0);</span>
<a href="#l69.60"></a><span id="l69.60" class="difflineplus">+  Assert.ok(i &gt; 0);</span>
<a href="#l69.61"></a><span id="l69.61"> </span>
<a href="#l69.62"></a><span id="l69.62">   // Bug 1126509, test that fixIterator rejects unknown objects.</span>
<a href="#l69.63"></a><span id="l69.63">   let thrown = false;</span>
<a href="#l69.64"></a><span id="l69.64">   let tryIterate = { item: &quot;An object, that is not supported by fixIterator.&quot; };</span>
<a href="#l69.65"></a><span id="l69.65">   try {</span>
<a href="#l69.66"></a><span id="l69.66">     for (let val of iteratorUtils.fixIterator(tryIterate)) { dump(val); }</span>
<a href="#l69.67"></a><span id="l69.67">   } catch (e) {</span>
<a href="#l69.68"></a><span id="l69.68">     // A specific exception is the correct behaviour here.</span>
<a href="#l69.69"></a><span id="l69.69">     if (e.message == &quot;An unsupported object sent to fixIterator: [object Object]&quot;)</span>
<a href="#l69.70"></a><span id="l69.70">       thrown = true;</span>
<a href="#l69.71"></a><span id="l69.71">   }</span>
<a href="#l69.72"></a><span id="l69.72" class="difflineminus">-  do_check_true(thrown);</span>
<a href="#l69.73"></a><span id="l69.73" class="difflineplus">+  Assert.ok(thrown);</span>
<a href="#l69.74"></a><span id="l69.74"> </span>
<a href="#l69.75"></a><span id="l69.75">   thrown = false;</span>
<a href="#l69.76"></a><span id="l69.76">   try {</span>
<a href="#l69.77"></a><span id="l69.77">     for (let val of iteratorUtils.fixIterator(tryIterate)) { dump(val); }</span>
<a href="#l69.78"></a><span id="l69.78">   } catch (e) {</span>
<a href="#l69.79"></a><span id="l69.79">     // A specific exception is the correct behaviour here.</span>
<a href="#l69.80"></a><span id="l69.80">     if (e.message == &quot;An unsupported object sent to fixIterator: [object Object]&quot;)</span>
<a href="#l69.81"></a><span id="l69.81">       thrown = true;</span>
<a href="#l69.82"></a><span id="l69.82">   }</span>
<a href="#l69.83"></a><span id="l69.83" class="difflineminus">-  do_check_true(thrown);</span>
<a href="#l69.84"></a><span id="l69.84" class="difflineplus">+  Assert.ok(thrown);</span>
<a href="#l69.85"></a><span id="l69.85"> </span>
<a href="#l69.86"></a><span id="l69.86">   thrown = false;</span>
<a href="#l69.87"></a><span id="l69.87">   try {</span>
<a href="#l69.88"></a><span id="l69.88">     let result = iteratorUtils.toXPCOMArray(tryIterate, Ci.nsIArray);</span>
<a href="#l69.89"></a><span id="l69.89">   } catch (e) {</span>
<a href="#l69.90"></a><span id="l69.90">     // A specific exception is the correct behaviour here.</span>
<a href="#l69.91"></a><span id="l69.91">     if (e.message == &quot;An unsupported interface requested from toXPCOMArray: nsIArray&quot;)</span>
<a href="#l69.92"></a><span id="l69.92">       thrown = true;</span>
<a href="#l69.93"></a><span id="l69.93">   }</span>
<a href="#l69.94"></a><span id="l69.94" class="difflineminus">-  do_check_true(thrown);</span>
<a href="#l69.95"></a><span id="l69.95" class="difflineplus">+  Assert.ok(thrown);</span>
<a href="#l69.96"></a><span id="l69.96"> }</span>
<a href="#l69.97"></a><span id="l69.97"> </span>
<a href="#l69.98"></a><span id="l69.98"> /**</span>
<a href="#l69.99"></a><span id="l69.99">  * Test that toArray works correctly with a NodeList.</span>
<a href="#l69.100"></a><span id="l69.100">  */</span>
<a href="#l69.101"></a><span id="l69.101"> function test_toArray_NodeList() {</span>
<a href="#l69.102"></a><span id="l69.102">   let xml = parse_xml_file(&quot;nodelist_test.xml&quot;);</span>
<a href="#l69.103"></a><span id="l69.103">   let rootNode = xml.firstChild;</span>
<a href="#l69.104"></a><span id="l69.104">   // Sanity check -- rootNode should have tag &quot;rootnode&quot;</span>
<a href="#l69.105"></a><span id="l69.105" class="difflineminus">-  do_check_eq(rootNode.tagName, &quot;rootnode&quot;);</span>
<a href="#l69.106"></a><span id="l69.106" class="difflineplus">+  Assert.equal(rootNode.tagName, &quot;rootnode&quot;);</span>
<a href="#l69.107"></a><span id="l69.107">   // childNodes is a NodeList</span>
<a href="#l69.108"></a><span id="l69.108">   let childNodes = rootNode.childNodes;</span>
<a href="#l69.109"></a><span id="l69.109">   // Make sure we have at least one child node</span>
<a href="#l69.110"></a><span id="l69.110" class="difflineminus">-  do_check_true(childNodes.length &gt; 0);</span>
<a href="#l69.111"></a><span id="l69.111" class="difflineplus">+  Assert.ok(childNodes.length &gt; 0);</span>
<a href="#l69.112"></a><span id="l69.112">   let childArray = iteratorUtils.toArray(childNodes);</span>
<a href="#l69.113"></a><span id="l69.113" class="difflineminus">-  do_check_eq(childNodes.length, childArray.length);</span>
<a href="#l69.114"></a><span id="l69.114" class="difflineplus">+  Assert.equal(childNodes.length, childArray.length);</span>
<a href="#l69.115"></a><span id="l69.115">   for (let [i, node] of childArray.entries())</span>
<a href="#l69.116"></a><span id="l69.116" class="difflineminus">-    do_check_eq(node, childArray[i]);</span>
<a href="#l69.117"></a><span id="l69.117" class="difflineplus">+    Assert.equal(node, childArray[i]);</span>
<a href="#l69.118"></a><span id="l69.118"> }</span>
<a href="#l69.119"></a><span id="l69.119"> </span>
<a href="#l69.120"></a><span id="l69.120"> /**</span>
<a href="#l69.121"></a><span id="l69.121">  * Test that toArray works correctly with the build-in generator construct.</span>
<a href="#l69.122"></a><span id="l69.122">  */</span>
<a href="#l69.123"></a><span id="l69.123"> function test_toArray_builtin_generator() {</span>
<a href="#l69.124"></a><span id="l69.124">   let arr = [11, 12, 13, 14, 15, 16, 17, 18, 19, 20];</span>
<a href="#l69.125"></a><span id="l69.125">   let generator = function*() {</span>
<a href="#l69.126"></a><span id="l69.126">     for (let elem of arr) {</span>
<a href="#l69.127"></a><span id="l69.127">       yield elem;</span>
<a href="#l69.128"></a><span id="l69.128">     }</span>
<a href="#l69.129"></a><span id="l69.129">   }</span>
<a href="#l69.130"></a><span id="l69.130">   // The resulting array should be the same as 'arr'.</span>
<a href="#l69.131"></a><span id="l69.131">   let generatorArray = iteratorUtils.toArray(generator);</span>
<a href="#l69.132"></a><span id="l69.132" class="difflineminus">-  do_check_eq(arr.length, generatorArray.length);</span>
<a href="#l69.133"></a><span id="l69.133" class="difflineplus">+  Assert.equal(arr.length, generatorArray.length);</span>
<a href="#l69.134"></a><span id="l69.134">   for (let i in arr) {</span>
<a href="#l69.135"></a><span id="l69.135" class="difflineminus">-    do_check_eq(arr[i], generatorArray[i]);</span>
<a href="#l69.136"></a><span id="l69.136" class="difflineplus">+    Assert.equal(arr[i], generatorArray[i]);</span>
<a href="#l69.137"></a><span id="l69.137">   }</span>
<a href="#l69.138"></a><span id="l69.138"> </span>
<a href="#l69.139"></a><span id="l69.139">   // Bug 1126509, test that toArray rejects unknown objects.</span>
<a href="#l69.140"></a><span id="l69.140">   let thrown = false;</span>
<a href="#l69.141"></a><span id="l69.141">   let tryIterate = { item: &quot;An object, that is not supported by toArray.&quot; };</span>
<a href="#l69.142"></a><span id="l69.142">   try {</span>
<a href="#l69.143"></a><span id="l69.143">     let result = iteratorUtils.toArray(tryIterate);</span>
<a href="#l69.144"></a><span id="l69.144">   } catch (e) {</span>
<a href="#l69.145"></a><span id="l69.145">     // A specific exception is the correct behaviour here.</span>
<a href="#l69.146"></a><span id="l69.146">     if (e.message == &quot;An unsupported object sent to toArray: [object Object]&quot;)</span>
<a href="#l69.147"></a><span id="l69.147">       thrown = true;</span>
<a href="#l69.148"></a><span id="l69.148">   }</span>
<a href="#l69.149"></a><span id="l69.149" class="difflineminus">-  do_check_true(thrown);</span>
<a href="#l69.150"></a><span id="l69.150" class="difflineplus">+  Assert.ok(thrown);</span>
<a href="#l69.151"></a><span id="l69.151"> }</span>
<a href="#l69.152"></a><span id="l69.152"> </span>
<a href="#l69.153"></a><span id="l69.153"> var Symbol_iterator = typeof Symbol === &quot;function&quot; &amp;&amp; Symbol.iterator ?</span>
<a href="#l69.154"></a><span id="l69.154">   Symbol.iterator : &quot;@@iterator&quot;;</span>
<a href="#l69.155"></a><span id="l69.155"> </span>
<a href="#l69.156"></a><span id="l69.156"> /**</span>
<a href="#l69.157"></a><span id="l69.157">  * Test that toArray works correctly with a custom iterator.</span>
<a href="#l69.158"></a><span id="l69.158">  */</span>
<a href="#l69.159"></a><span id="l69.159" class="difflineat">@@ -169,19 +169,19 @@ function test_toArray_custom_iterator() </span>
<a href="#l69.160"></a><span id="l69.160">     [Symbol_iterator]: function* testIterator() {</span>
<a href="#l69.161"></a><span id="l69.161">       // C-style for loop so that we don't confuse ourselves with yet another</span>
<a href="#l69.162"></a><span id="l69.162">       // iterator</span>
<a href="#l69.163"></a><span id="l69.163">       for (let i = 0; i &lt; arr.length; i++)</span>
<a href="#l69.164"></a><span id="l69.164">         yield arr[i];</span>
<a href="#l69.165"></a><span id="l69.165">     },</span>
<a href="#l69.166"></a><span id="l69.166">   };</span>
<a href="#l69.167"></a><span id="l69.167">   let iteratorArray = iteratorUtils.toArray(iterator);</span>
<a href="#l69.168"></a><span id="l69.168" class="difflineminus">-  do_check_eq(arr.length, iteratorArray.length);</span>
<a href="#l69.169"></a><span id="l69.169" class="difflineplus">+  Assert.equal(arr.length, iteratorArray.length);</span>
<a href="#l69.170"></a><span id="l69.170">   for (let [i, val] of arr.entries())</span>
<a href="#l69.171"></a><span id="l69.171" class="difflineminus">-    do_check_eq(val, iteratorArray[i]);</span>
<a href="#l69.172"></a><span id="l69.172" class="difflineplus">+    Assert.equal(val, iteratorArray[i]);</span>
<a href="#l69.173"></a><span id="l69.173"> }</span>
<a href="#l69.174"></a><span id="l69.174"> </span>
<a href="#l69.175"></a><span id="l69.175"> var gTests = [</span>
<a href="#l69.176"></a><span id="l69.176">   test_fixIterator,</span>
<a href="#l69.177"></a><span id="l69.177">   test_toArray_NodeList,</span>
<a href="#l69.178"></a><span id="l69.178">   test_toArray_builtin_generator,</span>
<a href="#l69.179"></a><span id="l69.179">   test_toArray_custom_iterator,</span>
<a href="#l69.180"></a><span id="l69.180"> ];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -71,73 +71,73 @@ function continueTest()</span>
<a href="#l70.4"></a><span id="l70.4">   do_test_finished();</span>
<a href="#l70.5"></a><span id="l70.5"> }</span>
<a href="#l70.6"></a><span id="l70.6"> </span>
<a href="#l70.7"></a><span id="l70.7"> function doChecks(server)</span>
<a href="#l70.8"></a><span id="l70.8"> {</span>
<a href="#l70.9"></a><span id="l70.9">   let spamSettings = server.spamSettings;</span>
<a href="#l70.10"></a><span id="l70.10"> </span>
<a href="#l70.11"></a><span id="l70.11">   // default is to use the whitelist</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  do_check_true(spamSettings.useWhiteList);</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+  Assert.ok(spamSettings.useWhiteList);</span>
<a href="#l70.14"></a><span id="l70.14"> </span>
<a href="#l70.15"></a><span id="l70.15">   // check email with the address PrimaryEmail1@test.invalid</span>
<a href="#l70.16"></a><span id="l70.16" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.17"></a><span id="l70.17" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.18"></a><span id="l70.18"> </span>
<a href="#l70.19"></a><span id="l70.19">   // check email without the address</span>
<a href="#l70.20"></a><span id="l70.20" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainExample]));</span>
<a href="#l70.21"></a><span id="l70.21" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainExample]));</span>
<a href="#l70.22"></a><span id="l70.22"> </span>
<a href="#l70.23"></a><span id="l70.23">   //</span>
<a href="#l70.24"></a><span id="l70.24">   // check changes in server-level settings. Although the spamSettings object</span>
<a href="#l70.25"></a><span id="l70.25">   // has methods to set these, those methods are not persistent (which seems</span>
<a href="#l70.26"></a><span id="l70.26">   // strange). You need to set the actual preference, and call initialize on</span>
<a href="#l70.27"></a><span id="l70.27">   // spam settings, to get the settings to be saved persistently and stick, then</span>
<a href="#l70.28"></a><span id="l70.28">   // be recalled into the program. So that's the way that I will test it.</span>
<a href="#l70.29"></a><span id="l70.29">   //</span>
<a href="#l70.30"></a><span id="l70.30"> </span>
<a href="#l70.31"></a><span id="l70.31">   // disable whitelisting</span>
<a href="#l70.32"></a><span id="l70.32">   server.setBoolValue(&quot;useWhiteList&quot;, false);</span>
<a href="#l70.33"></a><span id="l70.33">   spamSettings.initialize(server);</span>
<a href="#l70.34"></a><span id="l70.34"> </span>
<a href="#l70.35"></a><span id="l70.35">   // check that the change was propagated to spamSettings</span>
<a href="#l70.36"></a><span id="l70.36" class="difflineminus">-  do_check_false(spamSettings.useWhiteList);</span>
<a href="#l70.37"></a><span id="l70.37" class="difflineplus">+  Assert.ok(!spamSettings.useWhiteList);</span>
<a href="#l70.38"></a><span id="l70.38"> </span>
<a href="#l70.39"></a><span id="l70.39">   // and affects whitelisting calculationss</span>
<a href="#l70.40"></a><span id="l70.40" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.41"></a><span id="l70.41" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.42"></a><span id="l70.42"> </span>
<a href="#l70.43"></a><span id="l70.43">   // reenable whitelisting</span>
<a href="#l70.44"></a><span id="l70.44">   server.setBoolValue(&quot;useWhiteList&quot;, true);</span>
<a href="#l70.45"></a><span id="l70.45">   spamSettings.initialize(server);</span>
<a href="#l70.46"></a><span id="l70.46" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.47"></a><span id="l70.47" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.48"></a><span id="l70.48"> </span>
<a href="#l70.49"></a><span id="l70.49">   // Set an empty white list.</span>
<a href="#l70.50"></a><span id="l70.50">   // To really empty this, I have to change the default value as well</span>
<a href="#l70.51"></a><span id="l70.51">   Services.prefs.setCharPref(&quot;mail.server.default.whiteListAbURI&quot;, &quot;&quot;);</span>
<a href="#l70.52"></a><span id="l70.52">   server.setCharValue(&quot;whiteListAbURI&quot;, &quot;&quot;);</span>
<a href="#l70.53"></a><span id="l70.53">   spamSettings.initialize(server);</span>
<a href="#l70.54"></a><span id="l70.54" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.55"></a><span id="l70.55" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.56"></a><span id="l70.56"> </span>
<a href="#l70.57"></a><span id="l70.57">   // add a trusted domain. This is a global preference</span>
<a href="#l70.58"></a><span id="l70.58">   Services.prefs.setCharPref(&quot;mail.trusteddomains&quot;, &quot;example.com&quot;);</span>
<a href="#l70.59"></a><span id="l70.59">   spamSettings.initialize(server);</span>
<a href="#l70.60"></a><span id="l70.60"> </span>
<a href="#l70.61"></a><span id="l70.61">   // check email with the address invalid@example.com, a trusted domain</span>
<a href="#l70.62"></a><span id="l70.62" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainExample]));</span>
<a href="#l70.63"></a><span id="l70.63" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainExample]));</span>
<a href="#l70.64"></a><span id="l70.64"> </span>
<a href="#l70.65"></a><span id="l70.65">   // check email without the address</span>
<a href="#l70.66"></a><span id="l70.66" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.67"></a><span id="l70.67" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.68"></a><span id="l70.68"> </span>
<a href="#l70.69"></a><span id="l70.69">   // disable the trusted domain</span>
<a href="#l70.70"></a><span id="l70.70">   Services.prefs.setCharPref(&quot;mail.trusteddomains&quot;, &quot;&quot;);</span>
<a href="#l70.71"></a><span id="l70.71">   spamSettings.initialize(server);</span>
<a href="#l70.72"></a><span id="l70.72" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainExample]));</span>
<a href="#l70.73"></a><span id="l70.73" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainExample]));</span>
<a href="#l70.74"></a><span id="l70.74"> </span>
<a href="#l70.75"></a><span id="l70.75">   // add back the Personal Address Book</span>
<a href="#l70.76"></a><span id="l70.76">   server.setCharValue(&quot;whiteListAbURI&quot;, kPABData.URI);</span>
<a href="#l70.77"></a><span id="l70.77">   spamSettings.initialize(server);</span>
<a href="#l70.78"></a><span id="l70.78" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.79"></a><span id="l70.79" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.80"></a><span id="l70.80"> </span>
<a href="#l70.81"></a><span id="l70.81">   /*</span>
<a href="#l70.82"></a><span id="l70.82">    * tests of whitelist suppression by identity</span>
<a href="#l70.83"></a><span id="l70.83">    */</span>
<a href="#l70.84"></a><span id="l70.84"> </span>
<a href="#l70.85"></a><span id="l70.85">   // setup</span>
<a href="#l70.86"></a><span id="l70.86">   let account = MailServices.accounts.FindAccountForServer(server);</span>
<a href="#l70.87"></a><span id="l70.87">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l70.88"></a><span id="l70.88" class="difflineat">@@ -158,53 +158,53 @@ function doChecks(server)</span>
<a href="#l70.89"></a><span id="l70.89">   // let's just pretend that it works like the real POP3 stuff, and set</span>
<a href="#l70.90"></a><span id="l70.90">   // the correct setting for deferring.</span>
<a href="#l70.91"></a><span id="l70.91">   gPOP3Pump.fakeServer.setCharValue(&quot;deferred_to_account&quot;, &quot;account1&quot;);</span>
<a href="#l70.92"></a><span id="l70.92"> </span>
<a href="#l70.93"></a><span id="l70.93">   // suppress whitelisting for sender</span>
<a href="#l70.94"></a><span id="l70.94">   server.setBoolValue(&quot;inhibitWhiteListingIdentityUser&quot;, true);</span>
<a href="#l70.95"></a><span id="l70.95">   spamSettings.initialize(server);</span>
<a href="#l70.96"></a><span id="l70.96">   // (email does not match yet though)</span>
<a href="#l70.97"></a><span id="l70.97" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.98"></a><span id="l70.98" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.99"></a><span id="l70.99"> </span>
<a href="#l70.100"></a><span id="l70.100">   // add a matching email (mixing case)</span>
<a href="#l70.101"></a><span id="l70.101">   identity.email = &quot;PrimaryEMAIL1@test.INVALID&quot;;</span>
<a href="#l70.102"></a><span id="l70.102">   spamSettings.initialize(server);</span>
<a href="#l70.103"></a><span id="l70.103" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.104"></a><span id="l70.104" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.105"></a><span id="l70.105"> </span>
<a href="#l70.106"></a><span id="l70.106">   // remove the matching email</span>
<a href="#l70.107"></a><span id="l70.107">   identity.email = &quot;iAmNotTheSender@test.invalid&quot;;</span>
<a href="#l70.108"></a><span id="l70.108">   spamSettings.initialize(server);</span>
<a href="#l70.109"></a><span id="l70.109" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.110"></a><span id="l70.110" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.111"></a><span id="l70.111"> </span>
<a href="#l70.112"></a><span id="l70.112">   // add the email to the deferred-from server</span>
<a href="#l70.113"></a><span id="l70.113">   fakeIdentity.email = &quot;PrimaryEMAIL1@test.INVALID&quot;;</span>
<a href="#l70.114"></a><span id="l70.114">   spamSettings.initialize(server);</span>
<a href="#l70.115"></a><span id="l70.115" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.116"></a><span id="l70.116" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.117"></a><span id="l70.117"> </span>
<a href="#l70.118"></a><span id="l70.118">   // stop suppressing identity users</span>
<a href="#l70.119"></a><span id="l70.119">   server.setBoolValue(&quot;inhibitWhiteListingIdentityUser&quot;, false);</span>
<a href="#l70.120"></a><span id="l70.120">   spamSettings.initialize(server);</span>
<a href="#l70.121"></a><span id="l70.121" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.122"></a><span id="l70.122" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.123"></a><span id="l70.123"> </span>
<a href="#l70.124"></a><span id="l70.124">   // remove the matching email from the fake identity</span>
<a href="#l70.125"></a><span id="l70.125">   fakeIdentity.email = &quot;iAmNotTheSender@wrong.invalid&quot;;</span>
<a href="#l70.126"></a><span id="l70.126"> </span>
<a href="#l70.127"></a><span id="l70.127">   // add a fully non-matching domain to the identity</span>
<a href="#l70.128"></a><span id="l70.128">   identity.email = &quot;PrimaryEmail1@wrong.invalid&quot;;</span>
<a href="#l70.129"></a><span id="l70.129"> </span>
<a href="#l70.130"></a><span id="l70.130">   // suppress whitelist by matching domain</span>
<a href="#l70.131"></a><span id="l70.131">   server.setBoolValue(&quot;inhibitWhiteListingIdentityDomain&quot;, true);</span>
<a href="#l70.132"></a><span id="l70.132">   spamSettings.initialize(server);</span>
<a href="#l70.133"></a><span id="l70.133">   // but domain still does not match</span>
<a href="#l70.134"></a><span id="l70.134" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.135"></a><span id="l70.135" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.136"></a><span id="l70.136"> </span>
<a href="#l70.137"></a><span id="l70.137">   // add a matching email to the identity, in the domain (mixing case)</span>
<a href="#l70.138"></a><span id="l70.138">   identity.email = &quot;iAmNotTheSender@TEST.invalid&quot;;</span>
<a href="#l70.139"></a><span id="l70.139">   spamSettings.initialize(server);</span>
<a href="#l70.140"></a><span id="l70.140" class="difflineminus">-  do_check_false(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.141"></a><span id="l70.141" class="difflineplus">+  Assert.ok(!spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.142"></a><span id="l70.142"> </span>
<a href="#l70.143"></a><span id="l70.143">   // stop suppressing whitelist by domain</span>
<a href="#l70.144"></a><span id="l70.144">   server.setBoolValue(&quot;inhibitWhiteListingIdentityDomain&quot;, false);</span>
<a href="#l70.145"></a><span id="l70.145">   spamSettings.initialize(server);</span>
<a href="#l70.146"></a><span id="l70.146" class="difflineminus">-  do_check_true(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.147"></a><span id="l70.147" class="difflineplus">+  Assert.ok(spamSettings.checkWhiteList(hdrs[kDomainTest]));</span>
<a href="#l70.148"></a><span id="l70.148"> }</span>
<a href="#l70.149"></a><span id="l70.149"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/base/test/unit/test_junkingWhenDisabled.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_junkingWhenDisabled.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -123,28 +123,28 @@ function* junkMessages() {</span>
<a href="#l71.4"></a><span id="l71.4"> </span>
<a href="#l71.5"></a><span id="l71.5"> // Our listener, which captures events and does the real tests.</span>
<a href="#l71.6"></a><span id="l71.6"> function gMFListener() {}</span>
<a href="#l71.7"></a><span id="l71.7"> gMFListener.prototype =</span>
<a href="#l71.8"></a><span id="l71.8"> {</span>
<a href="#l71.9"></a><span id="l71.9"> </span>
<a href="#l71.10"></a><span id="l71.10">   msgsMoveCopyCompleted: function (aMove, aSrcMsgs, aDestFolder, aDestMsgs)</span>
<a href="#l71.11"></a><span id="l71.11">   {</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-    do_check_true(aDestFolder.getFlag(Ci.nsMsgFolderFlags.Junk));</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+    Assert.ok(aDestFolder.getFlag(Ci.nsMsgFolderFlags.Junk));</span>
<a href="#l71.14"></a><span id="l71.14">     // I tried to test this by counting messages in the folder, didn't work.</span>
<a href="#l71.15"></a><span id="l71.15">     //  Maybe all updates are not completed yet. Anyway I do it by just</span>
<a href="#l71.16"></a><span id="l71.16">     //  making sure there is something in the destination array.</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineminus">-    do_check_true(aDestMsgs.length &gt; 0);</span>
<a href="#l71.18"></a><span id="l71.18" class="difflineplus">+    Assert.ok(aDestMsgs.length &gt; 0);</span>
<a href="#l71.19"></a><span id="l71.19">     async_driver();</span>
<a href="#l71.20"></a><span id="l71.20">   },</span>
<a href="#l71.21"></a><span id="l71.21"> </span>
<a href="#l71.22"></a><span id="l71.22">   folderAdded: function (aFolder)</span>
<a href="#l71.23"></a><span id="l71.23">   {</span>
<a href="#l71.24"></a><span id="l71.24">     // this should be a junk folder</span>
<a href="#l71.25"></a><span id="l71.25" class="difflineminus">-    do_check_true(aFolder.getFlag(Ci.nsMsgFolderFlags.Junk));</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineplus">+    Assert.ok(aFolder.getFlag(Ci.nsMsgFolderFlags.Junk));</span>
<a href="#l71.27"></a><span id="l71.27">     async_driver();</span>
<a href="#l71.28"></a><span id="l71.28">   },</span>
<a href="#l71.29"></a><span id="l71.29"> </span>
<a href="#l71.30"></a><span id="l71.30"> };</span>
<a href="#l71.31"></a><span id="l71.31"> </span>
<a href="#l71.32"></a><span id="l71.32"> function run_test() {</span>
<a href="#l71.33"></a><span id="l71.33">   gLocalInboxFolder = configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l71.34"></a><span id="l71.34"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/base/test/unit/test_loadVirtualFolders.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_loadVirtualFolders.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -26,14 +26,14 @@ function run_test()</span>
<a href="#l72.4"></a><span id="l72.4">   localMailDir.create(Ci.nsIFile.NORMAL_FILE_TYPE, parseInt(&quot;0644&quot;, 8));</span>
<a href="#l72.5"></a><span id="l72.5">   localMailDir.leafName = &quot;invalidserver-local&quot;;</span>
<a href="#l72.6"></a><span id="l72.6">   localMailDir.create(Ci.nsIFile.NORMAL_FILE_TYPE, parseInt(&quot;0644&quot;, 8));</span>
<a href="#l72.7"></a><span id="l72.7"> </span>
<a href="#l72.8"></a><span id="l72.8">   MailServices.accounts.loadVirtualFolders();</span>
<a href="#l72.9"></a><span id="l72.9">   let unreadLocal = localAccountUtils.incomingServer</span>
<a href="#l72.10"></a><span id="l72.10">                                      .rootMsgFolder.getChildNamed(&quot;unread-local&quot;);</span>
<a href="#l72.11"></a><span id="l72.11">   let searchScope = unreadLocal.msgDatabase.dBFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  do_check_eq(searchScope, &quot;mailbox://nobody@Local%20Folders/Inbox|mailbox://nobody@Local%20Folders/Trash&quot;);</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+  Assert.equal(searchScope, &quot;mailbox://nobody@Local%20Folders/Inbox|mailbox://nobody@Local%20Folders/Trash&quot;);</span>
<a href="#l72.14"></a><span id="l72.14">   let invalidServer = localAccountUtils.incomingServer</span>
<a href="#l72.15"></a><span id="l72.15">                                        .rootMsgFolder.getChildNamed(&quot;invalidserver-local&quot;);</span>
<a href="#l72.16"></a><span id="l72.16">   searchScope = invalidServer.msgDatabase.dBFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l72.17"></a><span id="l72.17" class="difflineminus">-  do_check_eq(searchScope, &quot;mailbox://nobody@Local%20Folders/Inbox&quot;);</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineplus">+  Assert.equal(searchScope, &quot;mailbox://nobody@Local%20Folders/Inbox&quot;);</span>
<a href="#l72.19"></a><span id="l72.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/base/test/unit/test_mailServices.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_mailServices.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -4,18 +4,18 @@</span>
<a href="#l73.4"></a><span id="l73.4"> </span>
<a href="#l73.5"></a><span id="l73.5"> /*</span>
<a href="#l73.6"></a><span id="l73.6">  * Tests for the MailServices module.</span>
<a href="#l73.7"></a><span id="l73.7">  */</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l73.10"></a><span id="l73.10"> </span>
<a href="#l73.11"></a><span id="l73.11"> function check_service(aService, aInterface) {</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-  do_check_true(aService in MailServices);</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineminus">-  do_check_true(MailServices[aService] instanceof aInterface);</span>
<a href="#l73.14"></a><span id="l73.14" class="difflineplus">+  Assert.ok(aService in MailServices);</span>
<a href="#l73.15"></a><span id="l73.15" class="difflineplus">+  Assert.ok(MailServices[aService] instanceof aInterface);</span>
<a href="#l73.16"></a><span id="l73.16"> }</span>
<a href="#l73.17"></a><span id="l73.17"> </span>
<a href="#l73.18"></a><span id="l73.18"> function check_services() {</span>
<a href="#l73.19"></a><span id="l73.19">   check_service(&quot;mailSession&quot;, Ci.nsIMsgMailSession);</span>
<a href="#l73.20"></a><span id="l73.20">   check_service(&quot;accounts&quot;, Ci.nsIMsgAccountManager);</span>
<a href="#l73.21"></a><span id="l73.21">   check_service(&quot;pop3&quot;, Ci.nsIPop3Service);</span>
<a href="#l73.22"></a><span id="l73.22">   check_service(&quot;imap&quot;, Ci.nsIImapService);</span>
<a href="#l73.23"></a><span id="l73.23">   check_service(&quot;nntp&quot;, Ci.nsINntpService);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/base/test/unit/test_mimemaltdetach.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_mimemaltdetach.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -61,29 +61,29 @@ function* testDetach()</span>
<a href="#l74.4"></a><span id="l74.4"> {</span>
<a href="#l74.5"></a><span id="l74.5">   // This test seems to fail on Linux without the following delay.</span>
<a href="#l74.6"></a><span id="l74.6">   do_timeout(200, async_driver);</span>
<a href="#l74.7"></a><span id="l74.7">   yield false;</span>
<a href="#l74.8"></a><span id="l74.8">   // The message contained a file &quot;head_update.txt&quot; which should</span>
<a href="#l74.9"></a><span id="l74.9">   //  now exist in the profile directory.</span>
<a href="#l74.10"></a><span id="l74.10">   let checkFile = do_get_profile().clone();</span>
<a href="#l74.11"></a><span id="l74.11">   checkFile.append(&quot;head_update.txt&quot;);</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-  do_check_true(checkFile.exists());</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineminus">-  do_check_true(checkFile.fileSize &gt; 0);</span>
<a href="#l74.14"></a><span id="l74.14" class="difflineplus">+  Assert.ok(checkFile.exists());</span>
<a href="#l74.15"></a><span id="l74.15" class="difflineplus">+  Assert.ok(checkFile.fileSize &gt; 0);</span>
<a href="#l74.16"></a><span id="l74.16"> </span>
<a href="#l74.17"></a><span id="l74.17">   // The message should now have a detached attachment. Read the message,</span>
<a href="#l74.18"></a><span id="l74.18">   //  and search for &quot;AttachmentDetached&quot; which is added on detachment.</span>
<a href="#l74.19"></a><span id="l74.19"> </span>
<a href="#l74.20"></a><span id="l74.20">   // Get the message header</span>
<a href="#l74.21"></a><span id="l74.21">   let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l74.22"></a><span id="l74.22"> </span>
<a href="#l74.23"></a><span id="l74.23">   let messageContent = getContentFromMessage(msgHdr);</span>
<a href="#l74.24"></a><span id="l74.24" class="difflineminus">-  do_check_true(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l74.25"></a><span id="l74.25" class="difflineplus">+  Assert.ok(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l74.26"></a><span id="l74.26">   // Make sure the body survived the detach.</span>
<a href="#l74.27"></a><span id="l74.27" class="difflineminus">-  do_check_true(messageContent.includes(&quot;body hello&quot;));</span>
<a href="#l74.28"></a><span id="l74.28" class="difflineplus">+  Assert.ok(messageContent.includes(&quot;body hello&quot;));</span>
<a href="#l74.29"></a><span id="l74.29"> }</span>
<a href="#l74.30"></a><span id="l74.30"> </span>
<a href="#l74.31"></a><span id="l74.31"> function SaveAttachmentCallback() {</span>
<a href="#l74.32"></a><span id="l74.32">   this.attachments = null;</span>
<a href="#l74.33"></a><span id="l74.33"> }</span>
<a href="#l74.34"></a><span id="l74.34"> </span>
<a href="#l74.35"></a><span id="l74.35"> SaveAttachmentCallback.prototype = {</span>
<a href="#l74.36"></a><span id="l74.36">   callback: function saveAttachmentCallback_callback(aMsgHdr, aMimeMessage) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/base/test/unit/test_newMailNotification.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_newMailNotification.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -15,25 +15,25 @@ var iNMNS = Ci.mozINewMailNotificationSe</span>
<a href="#l75.4"></a><span id="l75.4">  * of listeners (and not the wrong ones) and doesn't show up after being removed</span>
<a href="#l75.5"></a><span id="l75.5">  */</span>
<a href="#l75.6"></a><span id="l75.6"> add_test(function testListeners() {</span>
<a href="#l75.7"></a><span id="l75.7">   let notif = MailServices.newMailNotification.wrappedJSObject;</span>
<a href="#l75.8"></a><span id="l75.8">   let listener = {a: 1};</span>
<a href="#l75.9"></a><span id="l75.9"> </span>
<a href="#l75.10"></a><span id="l75.10">   notif.addListener(listener, iNMNS.count);</span>
<a href="#l75.11"></a><span id="l75.11">   let list = notif._listenersForFlag(iNMNS.count);</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-  do_check_eq(list.length, 1);</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineminus">-  do_check_eq(list[0], listener);</span>
<a href="#l75.14"></a><span id="l75.14" class="difflineplus">+  Assert.equal(list.length, 1);</span>
<a href="#l75.15"></a><span id="l75.15" class="difflineplus">+  Assert.equal(list[0], listener);</span>
<a href="#l75.16"></a><span id="l75.16"> </span>
<a href="#l75.17"></a><span id="l75.17">   let newlist = notif._listenersForFlag(iNMNS.messages);</span>
<a href="#l75.18"></a><span id="l75.18" class="difflineminus">-  do_check_eq(newlist.length, 0);</span>
<a href="#l75.19"></a><span id="l75.19" class="difflineplus">+  Assert.equal(newlist.length, 0);</span>
<a href="#l75.20"></a><span id="l75.20"> </span>
<a href="#l75.21"></a><span id="l75.21">   notif.removeListener(listener);</span>
<a href="#l75.22"></a><span id="l75.22">   list = notif._listenersForFlag(iNMNS.count);</span>
<a href="#l75.23"></a><span id="l75.23" class="difflineminus">-  do_check_eq(list.length, 0);</span>
<a href="#l75.24"></a><span id="l75.24" class="difflineplus">+  Assert.equal(list.length, 0);</span>
<a href="#l75.25"></a><span id="l75.25"> </span>
<a href="#l75.26"></a><span id="l75.26">   run_next_test();</span>
<a href="#l75.27"></a><span id="l75.27"> });</span>
<a href="#l75.28"></a><span id="l75.28"> </span>
<a href="#l75.29"></a><span id="l75.29"> /*</span>
<a href="#l75.30"></a><span id="l75.30">  * Register a listener for two types and another for one type, make sure they show up,</span>
<a href="#l75.31"></a><span id="l75.31">  * remove one and make sure the other stays put</span>
<a href="#l75.32"></a><span id="l75.32">  */</span>
<a href="#l75.33"></a><span id="l75.33" class="difflineat">@@ -42,28 +42,28 @@ add_test(function testMultiListeners() {</span>
<a href="#l75.34"></a><span id="l75.34">   let l1 = {a: 1};</span>
<a href="#l75.35"></a><span id="l75.35">   let l2 = {b: 2};</span>
<a href="#l75.36"></a><span id="l75.36"> </span>
<a href="#l75.37"></a><span id="l75.37">   notif.addListener(l1, (iNMNS.count | iNMNS.messages));</span>
<a href="#l75.38"></a><span id="l75.38">   // do_check_eq(notif._listeners.length, 1);</span>
<a href="#l75.39"></a><span id="l75.39">   notif.addListener(l2, iNMNS.messages);</span>
<a href="#l75.40"></a><span id="l75.40">   // do_check_eq(notif._listeners.length, 2);</span>
<a href="#l75.41"></a><span id="l75.41">   let list = notif._listenersForFlag(iNMNS.count);</span>
<a href="#l75.42"></a><span id="l75.42" class="difflineminus">-  do_check_eq(list.length, 1);</span>
<a href="#l75.43"></a><span id="l75.43" class="difflineminus">-  do_check_eq(list[0], l1);</span>
<a href="#l75.44"></a><span id="l75.44" class="difflineplus">+  Assert.equal(list.length, 1);</span>
<a href="#l75.45"></a><span id="l75.45" class="difflineplus">+  Assert.equal(list[0], l1);</span>
<a href="#l75.46"></a><span id="l75.46"> </span>
<a href="#l75.47"></a><span id="l75.47">   let newlist = notif._listenersForFlag(iNMNS.messages);</span>
<a href="#l75.48"></a><span id="l75.48" class="difflineminus">-  do_check_eq(newlist.length, 2);</span>
<a href="#l75.49"></a><span id="l75.49" class="difflineplus">+  Assert.equal(newlist.length, 2);</span>
<a href="#l75.50"></a><span id="l75.50"> </span>
<a href="#l75.51"></a><span id="l75.51">   notif.removeListener(l1);</span>
<a href="#l75.52"></a><span id="l75.52">   list = notif._listenersForFlag(iNMNS.count);</span>
<a href="#l75.53"></a><span id="l75.53" class="difflineminus">-  do_check_eq(list.length, 0);</span>
<a href="#l75.54"></a><span id="l75.54" class="difflineplus">+  Assert.equal(list.length, 0);</span>
<a href="#l75.55"></a><span id="l75.55">   newlist = notif._listenersForFlag(iNMNS.messages);</span>
<a href="#l75.56"></a><span id="l75.56" class="difflineminus">-  do_check_eq(newlist.length, 1);</span>
<a href="#l75.57"></a><span id="l75.57" class="difflineminus">-  do_check_eq(newlist[0], l2);</span>
<a href="#l75.58"></a><span id="l75.58" class="difflineplus">+  Assert.equal(newlist.length, 1);</span>
<a href="#l75.59"></a><span id="l75.59" class="difflineplus">+  Assert.equal(newlist[0], l2);</span>
<a href="#l75.60"></a><span id="l75.60">   notif.removeListener(l2);</span>
<a href="#l75.61"></a><span id="l75.61"> </span>
<a href="#l75.62"></a><span id="l75.62">   run_next_test();</span>
<a href="#l75.63"></a><span id="l75.63"> });</span>
<a href="#l75.64"></a><span id="l75.64"> </span>
<a href="#l75.65"></a><span id="l75.65"> var countInboxesPref = &quot;mail.notification.count.inbox_only&quot;;</span>
<a href="#l75.66"></a><span id="l75.66"> </span>
<a href="#l75.67"></a><span id="l75.67"> /* Make sure we get a notification call when the unread count changes on an Inbox */</span>
<a href="#l75.68"></a><span id="l75.68" class="difflineat">@@ -76,40 +76,40 @@ add_test(function testNotifyInbox() {</span>
<a href="#l75.69"></a><span id="l75.69">     URI: &quot;Test Inbox&quot;,</span>
<a href="#l75.70"></a><span id="l75.70">     flags: Ci.nsMsgFolderFlags.Mail | Ci.nsMsgFolderFlags.Inbox</span>
<a href="#l75.71"></a><span id="l75.71">   };</span>
<a href="#l75.72"></a><span id="l75.72"> </span>
<a href="#l75.73"></a><span id="l75.73">   let notif = MailServices.newMailNotification.wrappedJSObject;</span>
<a href="#l75.74"></a><span id="l75.74">   notif.addListener(mockListener, iNMNS.count);</span>
<a href="#l75.75"></a><span id="l75.75"> </span>
<a href="#l75.76"></a><span id="l75.76">   notif.OnItemIntPropertyChanged(folder, &quot;TotalUnreadMessages&quot;, 0, 2);</span>
<a href="#l75.77"></a><span id="l75.77" class="difflineminus">-  do_check_true(notified);</span>
<a href="#l75.78"></a><span id="l75.78" class="difflineplus">+  Assert.ok(notified);</span>
<a href="#l75.79"></a><span id="l75.79"> </span>
<a href="#l75.80"></a><span id="l75.80">   // Special folders should never count</span>
<a href="#l75.81"></a><span id="l75.81">   let special = {</span>
<a href="#l75.82"></a><span id="l75.82">     URI: &quot;Test Special&quot;,</span>
<a href="#l75.83"></a><span id="l75.83">     flags: Ci.nsMsgFolderFlags.Mail | Ci.nsMsgFolderFlags.Junk</span>
<a href="#l75.84"></a><span id="l75.84">   };</span>
<a href="#l75.85"></a><span id="l75.85">   notified = false;</span>
<a href="#l75.86"></a><span id="l75.86">   notif.OnItemIntPropertyChanged(special, &quot;TotalUnreadMessages&quot;, 0, 2);</span>
<a href="#l75.87"></a><span id="l75.87" class="difflineminus">-  do_check_false(notified);</span>
<a href="#l75.88"></a><span id="l75.88" class="difflineplus">+  Assert.ok(!notified);</span>
<a href="#l75.89"></a><span id="l75.89"> </span>
<a href="#l75.90"></a><span id="l75.90">   // by default, non-inbox should not count</span>
<a href="#l75.91"></a><span id="l75.91">   let nonInbox = {</span>
<a href="#l75.92"></a><span id="l75.92">     URI: &quot;Test Non-Inbox&quot;,</span>
<a href="#l75.93"></a><span id="l75.93">     flags: Ci.nsMsgFolderFlags.Mail</span>
<a href="#l75.94"></a><span id="l75.94">   };</span>
<a href="#l75.95"></a><span id="l75.95">   notified = false;</span>
<a href="#l75.96"></a><span id="l75.96">   notif.OnItemIntPropertyChanged(nonInbox, &quot;TotalUnreadMessages&quot;, 0, 2);</span>
<a href="#l75.97"></a><span id="l75.97" class="difflineminus">-  do_check_false(notified);</span>
<a href="#l75.98"></a><span id="l75.98" class="difflineplus">+  Assert.ok(!notified);</span>
<a href="#l75.99"></a><span id="l75.99"> </span>
<a href="#l75.100"></a><span id="l75.100">   // Try setting the pref to count non-inboxes and notifying a non-inbox</span>
<a href="#l75.101"></a><span id="l75.101">   Services.prefs.setBoolPref(countInboxesPref, false);</span>
<a href="#l75.102"></a><span id="l75.102">   notified = false;</span>
<a href="#l75.103"></a><span id="l75.103">   notif.OnItemIntPropertyChanged(nonInbox, &quot;TotalUnreadMessages&quot;, 0, 2);</span>
<a href="#l75.104"></a><span id="l75.104" class="difflineminus">-  do_check_true(notified);</span>
<a href="#l75.105"></a><span id="l75.105" class="difflineplus">+  Assert.ok(notified);</span>
<a href="#l75.106"></a><span id="l75.106"> </span>
<a href="#l75.107"></a><span id="l75.107">   run_next_test();</span>
<a href="#l75.108"></a><span id="l75.108"> });</span>
<a href="#l75.109"></a><span id="l75.109"> </span>
<a href="#l75.110"></a><span id="l75.110"> function run_test() {</span>
<a href="#l75.111"></a><span id="l75.111">   run_next_test();</span>
<a href="#l75.112"></a><span id="l75.112"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgFolder.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgFolder.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -22,74 +22,74 @@ function run_test() {</span>
<a href="#l76.4"></a><span id="l76.4"> </span>
<a href="#l76.5"></a><span id="l76.5">   var caught = false;</span>
<a href="#l76.6"></a><span id="l76.6">   try {</span>
<a href="#l76.7"></a><span id="l76.7">     root.getChildNamed(&quot;folder&quot;);</span>
<a href="#l76.8"></a><span id="l76.8">   }</span>
<a href="#l76.9"></a><span id="l76.9">   catch (e) {</span>
<a href="#l76.10"></a><span id="l76.10">     caught = true;</span>
<a href="#l76.11"></a><span id="l76.11">   }</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  do_check_eq(caught, true);</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+  Assert.equal(caught, true);</span>
<a href="#l76.14"></a><span id="l76.14"> </span>
<a href="#l76.15"></a><span id="l76.15">   caught = false;</span>
<a href="#l76.16"></a><span id="l76.16">   try {</span>
<a href="#l76.17"></a><span id="l76.17">     root.getChildNamed(&quot;Trash1&quot;);</span>
<a href="#l76.18"></a><span id="l76.18">   }</span>
<a href="#l76.19"></a><span id="l76.19">   catch (e) {</span>
<a href="#l76.20"></a><span id="l76.20">     caught = true;</span>
<a href="#l76.21"></a><span id="l76.21">   }</span>
<a href="#l76.22"></a><span id="l76.22" class="difflineminus">-  do_check_eq(caught, true);</span>
<a href="#l76.23"></a><span id="l76.23" class="difflineplus">+  Assert.equal(caught, true);</span>
<a href="#l76.24"></a><span id="l76.24"> </span>
<a href="#l76.25"></a><span id="l76.25">   var folder1 = root.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l76.26"></a><span id="l76.26"> </span>
<a href="#l76.27"></a><span id="l76.27" class="difflineminus">-  do_check_neq(folder1, folder2);</span>
<a href="#l76.28"></a><span id="l76.28" class="difflineminus">-  do_check_eq(folder1.prettyName, &quot;folder1&quot;);</span>
<a href="#l76.29"></a><span id="l76.29" class="difflineplus">+  Assert.notEqual(folder1, folder2);</span>
<a href="#l76.30"></a><span id="l76.30" class="difflineplus">+  Assert.equal(folder1.prettyName, &quot;folder1&quot;);</span>
<a href="#l76.31"></a><span id="l76.31"> </span>
<a href="#l76.32"></a><span id="l76.32">   var folder2 = root.getChildNamed(&quot;FOLDER1&quot;);</span>
<a href="#l76.33"></a><span id="l76.33"> </span>
<a href="#l76.34"></a><span id="l76.34" class="difflineminus">-  do_check_eq(folder1, folder2);</span>
<a href="#l76.35"></a><span id="l76.35" class="difflineplus">+  Assert.equal(folder1, folder2);</span>
<a href="#l76.36"></a><span id="l76.36"> </span>
<a href="#l76.37"></a><span id="l76.37">   // Check special folders aren't deletable, and that normal folders are.</span>
<a href="#l76.38"></a><span id="l76.38">   if (!root.containsChildNamed(&quot;Inbox&quot;))</span>
<a href="#l76.39"></a><span id="l76.39">     root.createSubfolder(&quot;Inbox&quot;, null);</span>
<a href="#l76.40"></a><span id="l76.40">   var inbox = root.getChildNamed(&quot;Inbox&quot;);</span>
<a href="#l76.41"></a><span id="l76.41">   inbox.setFlag(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l76.42"></a><span id="l76.42" class="difflineminus">-  do_check_false(inbox.deletable);</span>
<a href="#l76.43"></a><span id="l76.43" class="difflineplus">+  Assert.ok(!inbox.deletable);</span>
<a href="#l76.44"></a><span id="l76.44"> </span>
<a href="#l76.45"></a><span id="l76.45">   if (!root.containsChildNamed(&quot;Drafts&quot;))</span>
<a href="#l76.46"></a><span id="l76.46">     root.createSubfolder(&quot;Drafts&quot;, null);</span>
<a href="#l76.47"></a><span id="l76.47">   var drafts = root.getChildNamed(&quot;Drafts&quot;);</span>
<a href="#l76.48"></a><span id="l76.48">   drafts.setFlag(Ci.nsMsgFolderFlags.Drafts);</span>
<a href="#l76.49"></a><span id="l76.49" class="difflineminus">-  do_check_false(drafts.deletable);</span>
<a href="#l76.50"></a><span id="l76.50" class="difflineplus">+  Assert.ok(!drafts.deletable);</span>
<a href="#l76.51"></a><span id="l76.51"> </span>
<a href="#l76.52"></a><span id="l76.52">   if (!root.containsChildNamed(&quot;Templates&quot;))</span>
<a href="#l76.53"></a><span id="l76.53">     root.createSubfolder(&quot;Templates&quot;, null);</span>
<a href="#l76.54"></a><span id="l76.54">   var templates = root.getChildNamed(&quot;Templates&quot;);</span>
<a href="#l76.55"></a><span id="l76.55">   templates.setFlag(Ci.nsMsgFolderFlags.Templates);</span>
<a href="#l76.56"></a><span id="l76.56" class="difflineminus">-  do_check_false(templates.deletable);</span>
<a href="#l76.57"></a><span id="l76.57" class="difflineplus">+  Assert.ok(!templates.deletable);</span>
<a href="#l76.58"></a><span id="l76.58"> </span>
<a href="#l76.59"></a><span id="l76.59">   if (!root.containsChildNamed(&quot;Sent&quot;))</span>
<a href="#l76.60"></a><span id="l76.60">      root.createSubfolder(&quot;Sent&quot;, null);</span>
<a href="#l76.61"></a><span id="l76.61">   var sent = root.getChildNamed(&quot;Sent&quot;);</span>
<a href="#l76.62"></a><span id="l76.62">   sent.setFlag(Ci.nsMsgFolderFlags.SentMail);</span>
<a href="#l76.63"></a><span id="l76.63" class="difflineminus">-  do_check_false(sent.deletable);</span>
<a href="#l76.64"></a><span id="l76.64" class="difflineplus">+  Assert.ok(!sent.deletable);</span>
<a href="#l76.65"></a><span id="l76.65"> </span>
<a href="#l76.66"></a><span id="l76.66">   if (!root.containsChildNamed(&quot;Archives&quot;))</span>
<a href="#l76.67"></a><span id="l76.67">     root.createSubfolder(&quot;Archives&quot;, null);</span>
<a href="#l76.68"></a><span id="l76.68">   var archives = root.getChildNamed(&quot;Archives&quot;);</span>
<a href="#l76.69"></a><span id="l76.69">   archives.setFlag(Ci.nsMsgFolderFlags.Archive);</span>
<a href="#l76.70"></a><span id="l76.70" class="difflineminus">-  do_check_false(archives.deletable);</span>
<a href="#l76.71"></a><span id="l76.71" class="difflineplus">+  Assert.ok(!archives.deletable);</span>
<a href="#l76.72"></a><span id="l76.72"> </span>
<a href="#l76.73"></a><span id="l76.73">   if (!root.containsChildNamed(&quot;Trash&quot;))</span>
<a href="#l76.74"></a><span id="l76.74">     root.createSubfolder(&quot;Trash&quot;, null);</span>
<a href="#l76.75"></a><span id="l76.75">   var trash = root.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l76.76"></a><span id="l76.76">   trash.setFlag(Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l76.77"></a><span id="l76.77" class="difflineminus">-  do_check_false(trash.deletable);</span>
<a href="#l76.78"></a><span id="l76.78" class="difflineplus">+  Assert.ok(!trash.deletable);</span>
<a href="#l76.79"></a><span id="l76.79"> </span>
<a href="#l76.80"></a><span id="l76.80">   if (!root.containsChildNamed(&quot;Outbox&quot;))</span>
<a href="#l76.81"></a><span id="l76.81">     root.createSubfolder(&quot;Outbox&quot;, null);</span>
<a href="#l76.82"></a><span id="l76.82">   var outbox = root.getChildNamed(&quot;Outbox&quot;);</span>
<a href="#l76.83"></a><span id="l76.83">   outbox.setFlag(Ci.nsMsgFolderFlags.Queue);</span>
<a href="#l76.84"></a><span id="l76.84" class="difflineminus">-  do_check_false(outbox.deletable);</span>
<a href="#l76.85"></a><span id="l76.85" class="difflineplus">+  Assert.ok(!outbox.deletable);</span>
<a href="#l76.86"></a><span id="l76.86"> </span>
<a href="#l76.87"></a><span id="l76.87">   // test a normal folder is deletable</span>
<a href="#l76.88"></a><span id="l76.88" class="difflineminus">-  do_check_true(folder1.deletable);</span>
<a href="#l76.89"></a><span id="l76.89" class="difflineplus">+  Assert.ok(folder1.deletable);</span>
<a href="#l76.90"></a><span id="l76.90"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgFolderListener.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgFolderListener.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -33,89 +33,89 @@ var gIndividualFlags =</span>
<a href="#l77.4"></a><span id="l77.4"> // Our listener, which captures events.</span>
<a href="#l77.5"></a><span id="l77.5"> function gMFListener() {}</span>
<a href="#l77.6"></a><span id="l77.6"> gMFListener.prototype =</span>
<a href="#l77.7"></a><span id="l77.7"> {</span>
<a href="#l77.8"></a><span id="l77.8">   mReceived: 0,</span>
<a href="#l77.9"></a><span id="l77.9">   mRemoveSelf: false,</span>
<a href="#l77.10"></a><span id="l77.10">   msgAdded: function (aMsg)</span>
<a href="#l77.11"></a><span id="l77.11">   {</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.msgAdded, 0);</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.msgAdded, 0);</span>
<a href="#l77.14"></a><span id="l77.14">     this.mReceived |= nsIMFNService.msgAdded;</span>
<a href="#l77.15"></a><span id="l77.15">     if (this.mRemoveSelf)</span>
<a href="#l77.16"></a><span id="l77.16">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.17"></a><span id="l77.17">   },</span>
<a href="#l77.18"></a><span id="l77.18"> </span>
<a href="#l77.19"></a><span id="l77.19">   msgsClassified: function (aMsgs, aJunkProcessed, aTraitProcessed)</span>
<a href="#l77.20"></a><span id="l77.20">   {</span>
<a href="#l77.21"></a><span id="l77.21" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.msgsClassified, 0);</span>
<a href="#l77.22"></a><span id="l77.22" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.msgsClassified, 0);</span>
<a href="#l77.23"></a><span id="l77.23">     this.mReceived |= nsIMFNService.msgsClassified;</span>
<a href="#l77.24"></a><span id="l77.24">     if (this.mRemoveSelf)</span>
<a href="#l77.25"></a><span id="l77.25">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.26"></a><span id="l77.26">   },</span>
<a href="#l77.27"></a><span id="l77.27"> </span>
<a href="#l77.28"></a><span id="l77.28">   msgsDeleted: function (aMsgs)</span>
<a href="#l77.29"></a><span id="l77.29">   {</span>
<a href="#l77.30"></a><span id="l77.30" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.msgsDeleted, 0);</span>
<a href="#l77.31"></a><span id="l77.31" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.msgsDeleted, 0);</span>
<a href="#l77.32"></a><span id="l77.32">     this.mReceived |= nsIMFNService.msgsDeleted;</span>
<a href="#l77.33"></a><span id="l77.33">     if (this.mRemoveSelf)</span>
<a href="#l77.34"></a><span id="l77.34">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.35"></a><span id="l77.35">   },</span>
<a href="#l77.36"></a><span id="l77.36"> </span>
<a href="#l77.37"></a><span id="l77.37">   msgsMoveCopyCompleted: function (aMove, aSrcMsgs, aDestFolder, aDestMsgs)</span>
<a href="#l77.38"></a><span id="l77.38">   {</span>
<a href="#l77.39"></a><span id="l77.39" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.msgsMoveCopyCompleted, 0);</span>
<a href="#l77.40"></a><span id="l77.40" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.msgsMoveCopyCompleted, 0);</span>
<a href="#l77.41"></a><span id="l77.41">     this.mReceived |= nsIMFNService.msgsMoveCopyCompleted;</span>
<a href="#l77.42"></a><span id="l77.42">     if (this.mRemoveSelf)</span>
<a href="#l77.43"></a><span id="l77.43">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.44"></a><span id="l77.44">   },</span>
<a href="#l77.45"></a><span id="l77.45"> </span>
<a href="#l77.46"></a><span id="l77.46">   msgKeyChanged: function(aOldMsgKey, aNewMsgHdr)</span>
<a href="#l77.47"></a><span id="l77.47">   {</span>
<a href="#l77.48"></a><span id="l77.48" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.msgKeyChanged, 0);</span>
<a href="#l77.49"></a><span id="l77.49" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.msgKeyChanged, 0);</span>
<a href="#l77.50"></a><span id="l77.50">     this.mReceived |= nsIMFNService.msgKeyChanged;</span>
<a href="#l77.51"></a><span id="l77.51">     if (this.mRemoveSelf)</span>
<a href="#l77.52"></a><span id="l77.52">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.53"></a><span id="l77.53">   },</span>
<a href="#l77.54"></a><span id="l77.54"> </span>
<a href="#l77.55"></a><span id="l77.55">   folderAdded: function (aFolder)</span>
<a href="#l77.56"></a><span id="l77.56">   {</span>
<a href="#l77.57"></a><span id="l77.57" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.folderAdded, 0);</span>
<a href="#l77.58"></a><span id="l77.58" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.folderAdded, 0);</span>
<a href="#l77.59"></a><span id="l77.59">     this.mReceived |= nsIMFNService.folderAdded;</span>
<a href="#l77.60"></a><span id="l77.60">     if (this.mRemoveSelf)</span>
<a href="#l77.61"></a><span id="l77.61">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.62"></a><span id="l77.62">   },</span>
<a href="#l77.63"></a><span id="l77.63"> </span>
<a href="#l77.64"></a><span id="l77.64">   folderDeleted: function (aFolder)</span>
<a href="#l77.65"></a><span id="l77.65">   {</span>
<a href="#l77.66"></a><span id="l77.66" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.folderDeleted, 0);</span>
<a href="#l77.67"></a><span id="l77.67" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.folderDeleted, 0);</span>
<a href="#l77.68"></a><span id="l77.68">     this.mReceived |= nsIMFNService.folderDeleted;</span>
<a href="#l77.69"></a><span id="l77.69">     if (this.mRemoveSelf)</span>
<a href="#l77.70"></a><span id="l77.70">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.71"></a><span id="l77.71">   },</span>
<a href="#l77.72"></a><span id="l77.72"> </span>
<a href="#l77.73"></a><span id="l77.73">   folderMoveCopyCompleted: function (aMove, aSrcFolder, aDestFolder)</span>
<a href="#l77.74"></a><span id="l77.74">   {</span>
<a href="#l77.75"></a><span id="l77.75" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.folderMoveCopyCompleted, 0);</span>
<a href="#l77.76"></a><span id="l77.76" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.folderMoveCopyCompleted, 0);</span>
<a href="#l77.77"></a><span id="l77.77">     this.mReceived |= nsIMFNService.folderMoveCopyCompleted;</span>
<a href="#l77.78"></a><span id="l77.78">     if (this.mRemoveSelf)</span>
<a href="#l77.79"></a><span id="l77.79">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.80"></a><span id="l77.80">   },</span>
<a href="#l77.81"></a><span id="l77.81"> </span>
<a href="#l77.82"></a><span id="l77.82">   folderRenamed: function (aOrigFolder, aNewFolder)</span>
<a href="#l77.83"></a><span id="l77.83">   {</span>
<a href="#l77.84"></a><span id="l77.84" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.folderRenamed, 0);</span>
<a href="#l77.85"></a><span id="l77.85" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.folderRenamed, 0);</span>
<a href="#l77.86"></a><span id="l77.86">     this.mReceived |= nsIMFNService.folderRenamed;</span>
<a href="#l77.87"></a><span id="l77.87">     if (this.mRemoveSelf)</span>
<a href="#l77.88"></a><span id="l77.88">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.89"></a><span id="l77.89">   },</span>
<a href="#l77.90"></a><span id="l77.90"> </span>
<a href="#l77.91"></a><span id="l77.91">   itemEvent: function (aItem, aEvent, aData, aString)</span>
<a href="#l77.92"></a><span id="l77.92">   {</span>
<a href="#l77.93"></a><span id="l77.93" class="difflineminus">-    do_check_eq(this.mReceived &amp; nsIMFNService.itemEvent, 0);</span>
<a href="#l77.94"></a><span id="l77.94" class="difflineplus">+    Assert.equal(this.mReceived &amp; nsIMFNService.itemEvent, 0);</span>
<a href="#l77.95"></a><span id="l77.95">     this.mReceived |= nsIMFNService.itemEvent;</span>
<a href="#l77.96"></a><span id="l77.96">     if (this.mRemoveSelf)</span>
<a href="#l77.97"></a><span id="l77.97">       MailServices.mfn.removeListener(this);</span>
<a href="#l77.98"></a><span id="l77.98">   }</span>
<a href="#l77.99"></a><span id="l77.99"> };</span>
<a href="#l77.100"></a><span id="l77.100"> </span>
<a href="#l77.101"></a><span id="l77.101"> function NotifyMsgFolderListeners()</span>
<a href="#l77.102"></a><span id="l77.102"> {</span>
<a href="#l77.103"></a><span id="l77.103" class="difflineat">@@ -146,31 +146,31 @@ function run_test()</span>
<a href="#l77.104"></a><span id="l77.104"> </span>
<a href="#l77.105"></a><span id="l77.105">   // Test: Notify the listeners of all events.</span>
<a href="#l77.106"></a><span id="l77.106">   NotifyMsgFolderListeners();</span>
<a href="#l77.107"></a><span id="l77.107"> </span>
<a href="#l77.108"></a><span id="l77.108">   // Test: check whether the correct number of notifications have been received.</span>
<a href="#l77.109"></a><span id="l77.109">   // Then remove the listeners</span>
<a href="#l77.110"></a><span id="l77.110">   var checkFlag = function (flag) {</span>
<a href="#l77.111"></a><span id="l77.111">     var listener = singleListeners.shift();</span>
<a href="#l77.112"></a><span id="l77.112" class="difflineminus">-    do_check_eq(listener.mReceived, flag);</span>
<a href="#l77.113"></a><span id="l77.113" class="difflineplus">+    Assert.equal(listener.mReceived, flag);</span>
<a href="#l77.114"></a><span id="l77.114">     listener.mRemoveSelf = true;</span>
<a href="#l77.115"></a><span id="l77.115">     listener.mReceived = 0;</span>
<a href="#l77.116"></a><span id="l77.116">     singleListeners.push(listener);</span>
<a href="#l77.117"></a><span id="l77.117">   };</span>
<a href="#l77.118"></a><span id="l77.118">   gIndividualFlags.forEach(checkFlag);</span>
<a href="#l77.119"></a><span id="l77.119"> </span>
<a href="#l77.120"></a><span id="l77.120">   // We'll do one more set of notifications, and remove ourselves in the middle of them</span>
<a href="#l77.121"></a><span id="l77.121">   NotifyMsgFolderListeners();</span>
<a href="#l77.122"></a><span id="l77.122"> </span>
<a href="#l77.123"></a><span id="l77.123">   // Test: all listeners should be removed at this point</span>
<a href="#l77.124"></a><span id="l77.124" class="difflineminus">-  do_check_false(MailServices.mfn.hasListeners);</span>
<a href="#l77.125"></a><span id="l77.125" class="difflineplus">+  Assert.ok(!MailServices.mfn.hasListeners);</span>
<a href="#l77.126"></a><span id="l77.126"> </span>
<a href="#l77.127"></a><span id="l77.127">   // Test: Send notifications again. Check that we don't receive any notifications.</span>
<a href="#l77.128"></a><span id="l77.128">   singleListeners.forEach(function (listener) { listener.mReceived = 0; });</span>
<a href="#l77.129"></a><span id="l77.129"> </span>
<a href="#l77.130"></a><span id="l77.130">   NotifyMsgFolderListeners();</span>
<a href="#l77.131"></a><span id="l77.131"> </span>
<a href="#l77.132"></a><span id="l77.132">   var checkNotReceived = function() {</span>
<a href="#l77.133"></a><span id="l77.133" class="difflineminus">-    do_check_eq(singleListeners.shift().mReceived, 0);</span>
<a href="#l77.134"></a><span id="l77.134" class="difflineplus">+    Assert.equal(singleListeners.shift().mReceived, 0);</span>
<a href="#l77.135"></a><span id="l77.135">   }</span>
<a href="#l77.136"></a><span id="l77.136">   gIndividualFlags.forEach(checkNotReceived);</span>
<a href="#l77.137"></a><span id="l77.137"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgTagService.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgTagService.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -24,52 +24,52 @@ function run_test()</span>
<a href="#l78.4"></a><span id="l78.4">   MailServices.tags.addTagForKey(tag1, tag1, null, null);</span>
<a href="#l78.5"></a><span id="l78.5"> </span>
<a href="#l78.6"></a><span id="l78.6">   // delete any existing tags</span>
<a href="#l78.7"></a><span id="l78.7">   let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l78.8"></a><span id="l78.8">   for (var i = 0; i &lt; tagArray.length; i++)</span>
<a href="#l78.9"></a><span id="l78.9">     MailServices.tags.deleteKey(tagArray[i].key);</span>
<a href="#l78.10"></a><span id="l78.10"> </span>
<a href="#l78.11"></a><span id="l78.11">   // make sure added tag is now gone</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.14"></a><span id="l78.14"> </span>
<a href="#l78.15"></a><span id="l78.15">   // add single tag, and check again</span>
<a href="#l78.16"></a><span id="l78.16">   MailServices.tags.addTagForKey(tag1, tag1, null, null);</span>
<a href="#l78.17"></a><span id="l78.17" class="difflineminus">-  do_check_true(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.18"></a><span id="l78.18" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.19"></a><span id="l78.19" class="difflineplus">+  Assert.ok(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.20"></a><span id="l78.20" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.21"></a><span id="l78.21"> </span>
<a href="#l78.22"></a><span id="l78.22">   // add second tag and check</span>
<a href="#l78.23"></a><span id="l78.23">   MailServices.tags.addTagForKey(tag4, tag4, null, null);</span>
<a href="#l78.24"></a><span id="l78.24" class="difflineminus">-  do_check_true(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.25"></a><span id="l78.25" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag2));</span>
<a href="#l78.26"></a><span id="l78.26" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag3));</span>
<a href="#l78.27"></a><span id="l78.27" class="difflineminus">-  do_check_true(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.28"></a><span id="l78.28" class="difflineplus">+  Assert.ok(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.29"></a><span id="l78.29" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag2));</span>
<a href="#l78.30"></a><span id="l78.30" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag3));</span>
<a href="#l78.31"></a><span id="l78.31" class="difflineplus">+  Assert.ok(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.32"></a><span id="l78.32"> </span>
<a href="#l78.33"></a><span id="l78.33">   // delete a tag and check</span>
<a href="#l78.34"></a><span id="l78.34">   MailServices.tags.deleteKey(tag1);</span>
<a href="#l78.35"></a><span id="l78.35" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.36"></a><span id="l78.36" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag2));</span>
<a href="#l78.37"></a><span id="l78.37" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag3));</span>
<a href="#l78.38"></a><span id="l78.38" class="difflineminus">-  do_check_true(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.39"></a><span id="l78.39" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.40"></a><span id="l78.40" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag2));</span>
<a href="#l78.41"></a><span id="l78.41" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag3));</span>
<a href="#l78.42"></a><span id="l78.42" class="difflineplus">+  Assert.ok(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.43"></a><span id="l78.43"> </span>
<a href="#l78.44"></a><span id="l78.44">   // add many tags and check again</span>
<a href="#l78.45"></a><span id="l78.45">   for (i = 0; i &lt; 100; i++)</span>
<a href="#l78.46"></a><span id="l78.46">     MailServices.tags.addTagForKey(i, &quot;lotsatags&quot; + i, null, null);</span>
<a href="#l78.47"></a><span id="l78.47" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.48"></a><span id="l78.48" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag2));</span>
<a href="#l78.49"></a><span id="l78.49" class="difflineminus">-  do_check_false(MailServices.tags.isValidKey(tag3));</span>
<a href="#l78.50"></a><span id="l78.50" class="difflineminus">-  do_check_true(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.51"></a><span id="l78.51" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag1));</span>
<a href="#l78.52"></a><span id="l78.52" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag2));</span>
<a href="#l78.53"></a><span id="l78.53" class="difflineplus">+  Assert.ok(!MailServices.tags.isValidKey(tag3));</span>
<a href="#l78.54"></a><span id="l78.54" class="difflineplus">+  Assert.ok(MailServices.tags.isValidKey(tag4));</span>
<a href="#l78.55"></a><span id="l78.55"> </span>
<a href="#l78.56"></a><span id="l78.56">   for (i = 0; i &lt; 100; i++)</span>
<a href="#l78.57"></a><span id="l78.57">   {</span>
<a href="#l78.58"></a><span id="l78.58" class="difflineminus">-    do_check_true(MailServices.tags.isValidKey(i));</span>
<a href="#l78.59"></a><span id="l78.59" class="difflineplus">+    Assert.ok(MailServices.tags.isValidKey(i));</span>
<a href="#l78.60"></a><span id="l78.60">     // make sure it knows the difference betweens tags and keys</span>
<a href="#l78.61"></a><span id="l78.61" class="difflineminus">-    do_check_false(MailServices.tags.isValidKey(&quot;lotsatags&quot; + i));</span>
<a href="#l78.62"></a><span id="l78.62" class="difflineplus">+    Assert.ok(!MailServices.tags.isValidKey(&quot;lotsatags&quot; + i));</span>
<a href="#l78.63"></a><span id="l78.63">     // are we confused by key at start of tag?</span>
<a href="#l78.64"></a><span id="l78.64" class="difflineminus">-    do_check_false(MailServices.tags.isValidKey(i + &quot;lotsatags&quot;));</span>
<a href="#l78.65"></a><span id="l78.65" class="difflineplus">+    Assert.ok(!MailServices.tags.isValidKey(i + &quot;lotsatags&quot;));</span>
<a href="#l78.66"></a><span id="l78.66">   }</span>
<a href="#l78.67"></a><span id="l78.67"> }</span>
<a href="#l78.68"></a><span id="l78.68"> </span>
<a href="#l78.69"></a><span id="l78.69"> /*  </span>
<a href="#l78.70"></a><span id="l78.70">   function printTags()</span>
<a href="#l78.71"></a><span id="l78.71">   {</span>
<a href="#l78.72"></a><span id="l78.72">     let tags = MailServices.tags.getAllTags({});</span>
<a href="#l78.73"></a><span id="l78.73">     for (var i = 0; i &lt; tags.length; i++)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMailDirProvider.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMailDirProvider.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -10,13 +10,13 @@ function run_test() {</span>
<a href="#l79.4"></a><span id="l79.4">   const items = [ { key: &quot;MailD&quot;, value: &quot;Mail&quot; },</span>
<a href="#l79.5"></a><span id="l79.5">                   { key: &quot;IMapMD&quot;, value: &quot;ImapMail&quot; },</span>
<a href="#l79.6"></a><span id="l79.6">                   { key: &quot;NewsD&quot;, value: &quot;News&quot; },</span>
<a href="#l79.7"></a><span id="l79.7">                   { key: &quot;MFCaF&quot;, value: &quot;panacea.dat&quot; } ];</span>
<a href="#l79.8"></a><span id="l79.8"> </span>
<a href="#l79.9"></a><span id="l79.9">   items.forEach(function(item) {</span>
<a href="#l79.10"></a><span id="l79.10">     var dir = Services.dirsvc.get(item.key, Ci.nsIFile);</span>
<a href="#l79.11"></a><span id="l79.11">     dump(do_get_profile().path + &quot; &quot; + dir.path + &quot;\n&quot;);</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-    do_check_true(do_get_profile().equals(dir.parent));</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineplus">+    Assert.ok(do_get_profile().equals(dir.parent));</span>
<a href="#l79.14"></a><span id="l79.14"> </span>
<a href="#l79.15"></a><span id="l79.15" class="difflineminus">-    do_check_eq(dir.leafName, item.value);</span>
<a href="#l79.16"></a><span id="l79.16" class="difflineplus">+    Assert.equal(dir.leafName, item.value);</span>
<a href="#l79.17"></a><span id="l79.17">   });</span>
<a href="#l79.18"></a><span id="l79.18"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -48,24 +48,24 @@ function* real_test() {</span>
<a href="#l80.4"></a><span id="l80.4">   let dbView = Components.classes[dbviewContractId]</span>
<a href="#l80.5"></a><span id="l80.5">                          .createInstance(Components.interfaces.nsIMsgDBView);</span>
<a href="#l80.6"></a><span id="l80.6">   dbView.init(null, null, null);</span>
<a href="#l80.7"></a><span id="l80.7">   var outCount = {};</span>
<a href="#l80.8"></a><span id="l80.8">   dbView.open(folder, SortType.byDate, SortOrder.ascending, 0, outCount);</span>
<a href="#l80.9"></a><span id="l80.9"> </span>
<a href="#l80.10"></a><span id="l80.10">   // Did we add all the messages properly?</span>
<a href="#l80.11"></a><span id="l80.11">   let treeView = dbView.QueryInterface(Components.interfaces.nsITreeView);</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-  do_check_eq(treeView.rowCount, tests.length);</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+  Assert.equal(treeView.rowCount, tests.length);</span>
<a href="#l80.14"></a><span id="l80.14"> </span>
<a href="#l80.15"></a><span id="l80.15">   // For each test, make sure that the display is correct.</span>
<a href="#l80.16"></a><span id="l80.16">   tests.forEach(function (data, i) {</span>
<a href="#l80.17"></a><span id="l80.17">     do_print(&quot;Checking data for &quot; + uneval(data));</span>
<a href="#l80.18"></a><span id="l80.18">     let expected = data[1];</span>
<a href="#l80.19"></a><span id="l80.19">     for (let column in expected) {</span>
<a href="#l80.20"></a><span id="l80.20" class="difflineminus">-      do_check_eq(dbView.cellTextForColumn(i, column), expected[column]);</span>
<a href="#l80.21"></a><span id="l80.21" class="difflineplus">+      Assert.equal(dbView.cellTextForColumn(i, column), expected[column]);</span>
<a href="#l80.22"></a><span id="l80.22">     }</span>
<a href="#l80.23"></a><span id="l80.23">   });</span>
<a href="#l80.24"></a><span id="l80.24"> }</span>
<a href="#l80.25"></a><span id="l80.25"> </span>
<a href="#l80.26"></a><span id="l80.26"> function run_test() {</span>
<a href="#l80.27"></a><span id="l80.27">   configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l80.28"></a><span id="l80.28">   async_run_tests([real_test]);</span>
<a href="#l80.29"></a><span id="l80.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgMailSession_Alerts.js</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -13,18 +13,18 @@ var gDialogTitle = null;</span>
<a href="#l81.4"></a><span id="l81.4"> var gText = null;</span>
<a href="#l81.5"></a><span id="l81.5"> </span>
<a href="#l81.6"></a><span id="l81.6"> function reset() {</span>
<a href="#l81.7"></a><span id="l81.7">   gDialogTitle = null;</span>
<a href="#l81.8"></a><span id="l81.8">   gText = null;</span>
<a href="#l81.9"></a><span id="l81.9"> }</span>
<a href="#l81.10"></a><span id="l81.10"> </span>
<a href="#l81.11"></a><span id="l81.11"> function alert(aDialogTitle, aText) {</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineminus">-  do_check_eq(gText, null);</span>
<a href="#l81.14"></a><span id="l81.14" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.15"></a><span id="l81.15" class="difflineplus">+  Assert.equal(gText, null);</span>
<a href="#l81.16"></a><span id="l81.16"> </span>
<a href="#l81.17"></a><span id="l81.17">   gDialogTitle = aDialogTitle;</span>
<a href="#l81.18"></a><span id="l81.18">   gText = aText;</span>
<a href="#l81.19"></a><span id="l81.19"> }</span>
<a href="#l81.20"></a><span id="l81.20"> </span>
<a href="#l81.21"></a><span id="l81.21"> var msgWindow = {</span>
<a href="#l81.22"></a><span id="l81.22">   get promptDialog() {</span>
<a href="#l81.23"></a><span id="l81.23">     return alertUtilsPrompts;</span>
<a href="#l81.24"></a><span id="l81.24" class="difflineat">@@ -51,18 +51,18 @@ alertListener.prototype = {</span>
<a href="#l81.25"></a><span id="l81.25">   mMsgWindow: null,</span>
<a href="#l81.26"></a><span id="l81.26"> </span>
<a href="#l81.27"></a><span id="l81.27">   reset: function () {</span>
<a href="#l81.28"></a><span id="l81.28">     this.mMessage = null;</span>
<a href="#l81.29"></a><span id="l81.29">     this.mMsgWindow = null;</span>
<a href="#l81.30"></a><span id="l81.30">   },</span>
<a href="#l81.31"></a><span id="l81.31"> </span>
<a href="#l81.32"></a><span id="l81.32">   onAlert: function (aMessage, aMsgWindow) {</span>
<a href="#l81.33"></a><span id="l81.33" class="difflineminus">-    do_check_eq(this.mMessage, null);</span>
<a href="#l81.34"></a><span id="l81.34" class="difflineminus">-    do_check_eq(this.mMsgWindow, null);</span>
<a href="#l81.35"></a><span id="l81.35" class="difflineplus">+    Assert.equal(this.mMessage, null);</span>
<a href="#l81.36"></a><span id="l81.36" class="difflineplus">+    Assert.equal(this.mMsgWindow, null);</span>
<a href="#l81.37"></a><span id="l81.37"> </span>
<a href="#l81.38"></a><span id="l81.38">     this.mMessage = aMessage;</span>
<a href="#l81.39"></a><span id="l81.39">     this.mMsgWindow = aMsgWindow;</span>
<a href="#l81.40"></a><span id="l81.40"> </span>
<a href="#l81.41"></a><span id="l81.41">     return this.mReturn;</span>
<a href="#l81.42"></a><span id="l81.42">   }</span>
<a href="#l81.43"></a><span id="l81.43"> };</span>
<a href="#l81.44"></a><span id="l81.44"> </span>
<a href="#l81.45"></a><span id="l81.45" class="difflineat">@@ -72,142 +72,142 @@ function run_test()</span>
<a href="#l81.46"></a><span id="l81.46"> </span>
<a href="#l81.47"></a><span id="l81.47">   reset();</span>
<a href="#l81.48"></a><span id="l81.48"> </span>
<a href="#l81.49"></a><span id="l81.49">   msgUrl._msgWindow = msgWindow;</span>
<a href="#l81.50"></a><span id="l81.50"> </span>
<a href="#l81.51"></a><span id="l81.51">   MailServices.mailSession.alertUser(&quot;test message&quot;, msgUrl);</span>
<a href="#l81.52"></a><span id="l81.52"> </span>
<a href="#l81.53"></a><span id="l81.53">   // The dialog title doesn't get set at the moment.</span>
<a href="#l81.54"></a><span id="l81.54" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.55"></a><span id="l81.55" class="difflineminus">-  do_check_eq(gText, &quot;test message&quot;);</span>
<a href="#l81.56"></a><span id="l81.56" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.57"></a><span id="l81.57" class="difflineplus">+  Assert.equal(gText, &quot;test message&quot;);</span>
<a href="#l81.58"></a><span id="l81.58"> </span>
<a href="#l81.59"></a><span id="l81.59">   // Test - No listeners and no msgWindow, check no alerts.</span>
<a href="#l81.60"></a><span id="l81.60"> </span>
<a href="#l81.61"></a><span id="l81.61">   reset();</span>
<a href="#l81.62"></a><span id="l81.62"> </span>
<a href="#l81.63"></a><span id="l81.63">   msgUrl._msgWindow = null;</span>
<a href="#l81.64"></a><span id="l81.64"> </span>
<a href="#l81.65"></a><span id="l81.65">   MailServices.mailSession.alertUser(&quot;test no message&quot;, msgUrl);</span>
<a href="#l81.66"></a><span id="l81.66"> </span>
<a href="#l81.67"></a><span id="l81.67">   // The dialog title doesn't get set at the moment.</span>
<a href="#l81.68"></a><span id="l81.68" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.69"></a><span id="l81.69" class="difflineminus">-  do_check_eq(gText, null);</span>
<a href="#l81.70"></a><span id="l81.70" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.71"></a><span id="l81.71" class="difflineplus">+  Assert.equal(gText, null);</span>
<a href="#l81.72"></a><span id="l81.72"> </span>
<a href="#l81.73"></a><span id="l81.73">   // Test - One listener, returning false (prompt should still happen).</span>
<a href="#l81.74"></a><span id="l81.74"> </span>
<a href="#l81.75"></a><span id="l81.75">   reset();</span>
<a href="#l81.76"></a><span id="l81.76"> </span>
<a href="#l81.77"></a><span id="l81.77">   var listener1 = new alertListener();</span>
<a href="#l81.78"></a><span id="l81.78">   listener1.mReturn = false;</span>
<a href="#l81.79"></a><span id="l81.79"> </span>
<a href="#l81.80"></a><span id="l81.80">   MailServices.mailSession.addUserFeedbackListener(listener1);</span>
<a href="#l81.81"></a><span id="l81.81"> </span>
<a href="#l81.82"></a><span id="l81.82">   msgUrl._msgWindow = msgWindow;</span>
<a href="#l81.83"></a><span id="l81.83"> </span>
<a href="#l81.84"></a><span id="l81.84">   MailServices.mailSession.alertUser(&quot;message test&quot;, msgUrl);</span>
<a href="#l81.85"></a><span id="l81.85"> </span>
<a href="#l81.86"></a><span id="l81.86" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.87"></a><span id="l81.87" class="difflineminus">-  do_check_eq(gText, &quot;message test&quot;);</span>
<a href="#l81.88"></a><span id="l81.88" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.89"></a><span id="l81.89" class="difflineplus">+  Assert.equal(gText, &quot;message test&quot;);</span>
<a href="#l81.90"></a><span id="l81.90"> </span>
<a href="#l81.91"></a><span id="l81.91" class="difflineminus">-  do_check_eq(listener1.mMessage, &quot;message test&quot;);</span>
<a href="#l81.92"></a><span id="l81.92" class="difflineminus">-  do_check_neq(listener1.mMsgWindow, null);</span>
<a href="#l81.93"></a><span id="l81.93" class="difflineplus">+  Assert.equal(listener1.mMessage, &quot;message test&quot;);</span>
<a href="#l81.94"></a><span id="l81.94" class="difflineplus">+  Assert.notEqual(listener1.mMsgWindow, null);</span>
<a href="#l81.95"></a><span id="l81.95"> </span>
<a href="#l81.96"></a><span id="l81.96">   // Test - One listener, returning false, no msg window (prompt shouldn't</span>
<a href="#l81.97"></a><span id="l81.97">   //        happen).</span>
<a href="#l81.98"></a><span id="l81.98"> </span>
<a href="#l81.99"></a><span id="l81.99">   reset();</span>
<a href="#l81.100"></a><span id="l81.100">   listener1.reset();</span>
<a href="#l81.101"></a><span id="l81.101"> </span>
<a href="#l81.102"></a><span id="l81.102">   MailServices.mailSession.alertUser(&quot;message test no prompt&quot;, null);</span>
<a href="#l81.103"></a><span id="l81.103"> </span>
<a href="#l81.104"></a><span id="l81.104" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.105"></a><span id="l81.105" class="difflineminus">-  do_check_eq(gText, null);</span>
<a href="#l81.106"></a><span id="l81.106" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.107"></a><span id="l81.107" class="difflineplus">+  Assert.equal(gText, null);</span>
<a href="#l81.108"></a><span id="l81.108"> </span>
<a href="#l81.109"></a><span id="l81.109" class="difflineminus">-  do_check_eq(listener1.mMessage, &quot;message test no prompt&quot;);</span>
<a href="#l81.110"></a><span id="l81.110" class="difflineminus">-  do_check_eq(listener1.mMsgWindow, null);</span>
<a href="#l81.111"></a><span id="l81.111" class="difflineplus">+  Assert.equal(listener1.mMessage, &quot;message test no prompt&quot;);</span>
<a href="#l81.112"></a><span id="l81.112" class="difflineplus">+  Assert.equal(listener1.mMsgWindow, null);</span>
<a href="#l81.113"></a><span id="l81.113"> </span>
<a href="#l81.114"></a><span id="l81.114">   // Test - Two listeners, both returning false (prompt should happen).</span>
<a href="#l81.115"></a><span id="l81.115"> </span>
<a href="#l81.116"></a><span id="l81.116">   reset();</span>
<a href="#l81.117"></a><span id="l81.117">   listener1.reset();</span>
<a href="#l81.118"></a><span id="l81.118"> </span>
<a href="#l81.119"></a><span id="l81.119">   var listener2 = new alertListener();</span>
<a href="#l81.120"></a><span id="l81.120">   listener2.mReturn = false;</span>
<a href="#l81.121"></a><span id="l81.121"> </span>
<a href="#l81.122"></a><span id="l81.122">   MailServices.mailSession.addUserFeedbackListener(listener2);</span>
<a href="#l81.123"></a><span id="l81.123"> </span>
<a href="#l81.124"></a><span id="l81.124">   msgUrl._msgWindow = msgWindow;</span>
<a href="#l81.125"></a><span id="l81.125"> </span>
<a href="#l81.126"></a><span id="l81.126">   MailServices.mailSession.alertUser(&quot;two listeners&quot;, msgUrl);</span>
<a href="#l81.127"></a><span id="l81.127"> </span>
<a href="#l81.128"></a><span id="l81.128" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.129"></a><span id="l81.129" class="difflineminus">-  do_check_eq(gText, &quot;two listeners&quot;);</span>
<a href="#l81.130"></a><span id="l81.130" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.131"></a><span id="l81.131" class="difflineplus">+  Assert.equal(gText, &quot;two listeners&quot;);</span>
<a href="#l81.132"></a><span id="l81.132"> </span>
<a href="#l81.133"></a><span id="l81.133" class="difflineminus">-  do_check_eq(listener1.mMessage, &quot;two listeners&quot;);</span>
<a href="#l81.134"></a><span id="l81.134" class="difflineminus">-  do_check_neq(listener1.mMsgWindow, null);</span>
<a href="#l81.135"></a><span id="l81.135" class="difflineplus">+  Assert.equal(listener1.mMessage, &quot;two listeners&quot;);</span>
<a href="#l81.136"></a><span id="l81.136" class="difflineplus">+  Assert.notEqual(listener1.mMsgWindow, null);</span>
<a href="#l81.137"></a><span id="l81.137"> </span>
<a href="#l81.138"></a><span id="l81.138" class="difflineminus">-  do_check_eq(listener2.mMessage, &quot;two listeners&quot;);</span>
<a href="#l81.139"></a><span id="l81.139" class="difflineminus">-  do_check_neq(listener2.mMsgWindow, null);</span>
<a href="#l81.140"></a><span id="l81.140" class="difflineplus">+  Assert.equal(listener2.mMessage, &quot;two listeners&quot;);</span>
<a href="#l81.141"></a><span id="l81.141" class="difflineplus">+  Assert.notEqual(listener2.mMsgWindow, null);</span>
<a href="#l81.142"></a><span id="l81.142"> </span>
<a href="#l81.143"></a><span id="l81.143">   // Test - Two listeners, one returning true (prompt shouldn't happen).</span>
<a href="#l81.144"></a><span id="l81.144"> </span>
<a href="#l81.145"></a><span id="l81.145">   reset();</span>
<a href="#l81.146"></a><span id="l81.146">   listener1.reset();</span>
<a href="#l81.147"></a><span id="l81.147">   listener2.reset();</span>
<a href="#l81.148"></a><span id="l81.148"> </span>
<a href="#l81.149"></a><span id="l81.149">   listener2.mReturn = true;</span>
<a href="#l81.150"></a><span id="l81.150"> </span>
<a href="#l81.151"></a><span id="l81.151">   msgUrl._msgWindow = msgWindow;</span>
<a href="#l81.152"></a><span id="l81.152"> </span>
<a href="#l81.153"></a><span id="l81.153">   MailServices.mailSession.alertUser(&quot;no prompt&quot;, msgUrl);</span>
<a href="#l81.154"></a><span id="l81.154"> </span>
<a href="#l81.155"></a><span id="l81.155" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.156"></a><span id="l81.156" class="difflineminus">-  do_check_eq(gText, null);</span>
<a href="#l81.157"></a><span id="l81.157" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.158"></a><span id="l81.158" class="difflineplus">+  Assert.equal(gText, null);</span>
<a href="#l81.159"></a><span id="l81.159"> </span>
<a href="#l81.160"></a><span id="l81.160" class="difflineminus">-  do_check_eq(listener1.mMessage, &quot;no prompt&quot;);</span>
<a href="#l81.161"></a><span id="l81.161" class="difflineminus">-  do_check_neq(listener1.mMsgWindow, null);</span>
<a href="#l81.162"></a><span id="l81.162" class="difflineplus">+  Assert.equal(listener1.mMessage, &quot;no prompt&quot;);</span>
<a href="#l81.163"></a><span id="l81.163" class="difflineplus">+  Assert.notEqual(listener1.mMsgWindow, null);</span>
<a href="#l81.164"></a><span id="l81.164"> </span>
<a href="#l81.165"></a><span id="l81.165" class="difflineminus">-  do_check_eq(listener2.mMessage, &quot;no prompt&quot;);</span>
<a href="#l81.166"></a><span id="l81.166" class="difflineminus">-  do_check_neq(listener2.mMsgWindow, null);</span>
<a href="#l81.167"></a><span id="l81.167" class="difflineplus">+  Assert.equal(listener2.mMessage, &quot;no prompt&quot;);</span>
<a href="#l81.168"></a><span id="l81.168" class="difflineplus">+  Assert.notEqual(listener2.mMsgWindow, null);</span>
<a href="#l81.169"></a><span id="l81.169"> </span>
<a href="#l81.170"></a><span id="l81.170">   // Test - Remove a listener.</span>
<a href="#l81.171"></a><span id="l81.171"> </span>
<a href="#l81.172"></a><span id="l81.172">   reset();</span>
<a href="#l81.173"></a><span id="l81.173">   listener1.reset();</span>
<a href="#l81.174"></a><span id="l81.174">   listener2.reset();</span>
<a href="#l81.175"></a><span id="l81.175"> </span>
<a href="#l81.176"></a><span id="l81.176">   MailServices.mailSession.removeUserFeedbackListener(listener1);</span>
<a href="#l81.177"></a><span id="l81.177"> </span>
<a href="#l81.178"></a><span id="l81.178">   msgUrl._msgWindow = msgWindow;</span>
<a href="#l81.179"></a><span id="l81.179"> </span>
<a href="#l81.180"></a><span id="l81.180">   MailServices.mailSession.alertUser(&quot;remove listener&quot;, msgUrl);</span>
<a href="#l81.181"></a><span id="l81.181"> </span>
<a href="#l81.182"></a><span id="l81.182" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.183"></a><span id="l81.183" class="difflineminus">-  do_check_eq(gText, null);</span>
<a href="#l81.184"></a><span id="l81.184" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.185"></a><span id="l81.185" class="difflineplus">+  Assert.equal(gText, null);</span>
<a href="#l81.186"></a><span id="l81.186"> </span>
<a href="#l81.187"></a><span id="l81.187" class="difflineminus">-  do_check_eq(listener1.mMessage, null);</span>
<a href="#l81.188"></a><span id="l81.188" class="difflineminus">-  do_check_eq(listener1.mMsgWindow, null);</span>
<a href="#l81.189"></a><span id="l81.189" class="difflineplus">+  Assert.equal(listener1.mMessage, null);</span>
<a href="#l81.190"></a><span id="l81.190" class="difflineplus">+  Assert.equal(listener1.mMsgWindow, null);</span>
<a href="#l81.191"></a><span id="l81.191"> </span>
<a href="#l81.192"></a><span id="l81.192" class="difflineminus">-  do_check_eq(listener2.mMessage, &quot;remove listener&quot;);</span>
<a href="#l81.193"></a><span id="l81.193" class="difflineminus">-  do_check_neq(listener2.mMsgWindow, null);</span>
<a href="#l81.194"></a><span id="l81.194" class="difflineplus">+  Assert.equal(listener2.mMessage, &quot;remove listener&quot;);</span>
<a href="#l81.195"></a><span id="l81.195" class="difflineplus">+  Assert.notEqual(listener2.mMsgWindow, null);</span>
<a href="#l81.196"></a><span id="l81.196"> </span>
<a href="#l81.197"></a><span id="l81.197">   // Test - Remove the other listener.</span>
<a href="#l81.198"></a><span id="l81.198"> </span>
<a href="#l81.199"></a><span id="l81.199">   reset();</span>
<a href="#l81.200"></a><span id="l81.200">   listener1.reset();</span>
<a href="#l81.201"></a><span id="l81.201">   listener2.reset();</span>
<a href="#l81.202"></a><span id="l81.202"> </span>
<a href="#l81.203"></a><span id="l81.203">   MailServices.mailSession.removeUserFeedbackListener(listener2);</span>
<a href="#l81.204"></a><span id="l81.204"> </span>
<a href="#l81.205"></a><span id="l81.205">   msgUrl._msgWindow = msgWindow;</span>
<a href="#l81.206"></a><span id="l81.206"> </span>
<a href="#l81.207"></a><span id="l81.207">   MailServices.mailSession.alertUser(&quot;no listeners&quot;, msgUrl);</span>
<a href="#l81.208"></a><span id="l81.208"> </span>
<a href="#l81.209"></a><span id="l81.209" class="difflineminus">-  do_check_eq(gDialogTitle, null);</span>
<a href="#l81.210"></a><span id="l81.210" class="difflineminus">-  do_check_eq(gText, &quot;no listeners&quot;);</span>
<a href="#l81.211"></a><span id="l81.211" class="difflineplus">+  Assert.equal(gDialogTitle, null);</span>
<a href="#l81.212"></a><span id="l81.212" class="difflineplus">+  Assert.equal(gText, &quot;no listeners&quot;);</span>
<a href="#l81.213"></a><span id="l81.213"> </span>
<a href="#l81.214"></a><span id="l81.214" class="difflineminus">-  do_check_eq(listener1.mMessage, null);</span>
<a href="#l81.215"></a><span id="l81.215" class="difflineminus">-  do_check_eq(listener1.mMsgWindow, null);</span>
<a href="#l81.216"></a><span id="l81.216" class="difflineplus">+  Assert.equal(listener1.mMessage, null);</span>
<a href="#l81.217"></a><span id="l81.217" class="difflineplus">+  Assert.equal(listener1.mMsgWindow, null);</span>
<a href="#l81.218"></a><span id="l81.218"> </span>
<a href="#l81.219"></a><span id="l81.219" class="difflineminus">-  do_check_eq(listener2.mMessage, null);</span>
<a href="#l81.220"></a><span id="l81.220" class="difflineminus">-  do_check_eq(listener2.mMsgWindow, null);</span>
<a href="#l81.221"></a><span id="l81.221" class="difflineplus">+  Assert.equal(listener2.mMessage, null);</span>
<a href="#l81.222"></a><span id="l81.222" class="difflineplus">+  Assert.equal(listener2.mMsgWindow, null);</span>
<a href="#l81.223"></a><span id="l81.223"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgMailSession_Listeners.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -70,64 +70,64 @@ function NotifyMailSession() {</span>
<a href="#l82.4"></a><span id="l82.4">     gMailSessionNotifier.OnItemUnicharPropertyChanged(null, null, null, null);</span>
<a href="#l82.5"></a><span id="l82.5">     gMailSessionNotifier.OnItemPropertyFlagChanged(null, null, null, null);</span>
<a href="#l82.6"></a><span id="l82.6">     gMailSessionNotifier.OnItemEvent(null, null);</span>
<a href="#l82.7"></a><span id="l82.7"> }</span>
<a href="#l82.8"></a><span id="l82.8"> </span>
<a href="#l82.9"></a><span id="l82.9"> function run_test() {</span>
<a href="#l82.10"></a><span id="l82.10">   var i;</span>
<a href="#l82.11"></a><span id="l82.11"> </span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-  do_check_true(MailServices.mailSession != null);</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+  Assert.ok(MailServices.mailSession != null);</span>
<a href="#l82.14"></a><span id="l82.14"> </span>
<a href="#l82.15"></a><span id="l82.15">   // Test - Add a listener</span>
<a href="#l82.16"></a><span id="l82.16"> </span>
<a href="#l82.17"></a><span id="l82.17">   gFLAll = new fL;</span>
<a href="#l82.18"></a><span id="l82.18"> </span>
<a href="#l82.19"></a><span id="l82.19">   MailServices.mailSession.AddFolderListener(gFLAll, nsIFolderListener.all);</span>
<a href="#l82.20"></a><span id="l82.20"> </span>
<a href="#l82.21"></a><span id="l82.21">   for (i = 0; i &lt; numListenerFunctions; ++i) {</span>
<a href="#l82.22"></a><span id="l82.22">     gFLSingle[i] = new fL;</span>
<a href="#l82.23"></a><span id="l82.23">     MailServices.mailSession.AddFolderListener(gFLSingle[i], Math.pow(2, i));</span>
<a href="#l82.24"></a><span id="l82.24">   }</span>
<a href="#l82.25"></a><span id="l82.25"> </span>
<a href="#l82.26"></a><span id="l82.26">   // Test - Notify listener on all available items</span>
<a href="#l82.27"></a><span id="l82.27"> </span>
<a href="#l82.28"></a><span id="l82.28">   NotifyMailSession();</span>
<a href="#l82.29"></a><span id="l82.29"> </span>
<a href="#l82.30"></a><span id="l82.30" class="difflineminus">-  do_check_eq(gFLAll.mReceived, Math.pow(2, numListenerFunctions) - 1);</span>
<a href="#l82.31"></a><span id="l82.31" class="difflineplus">+  Assert.equal(gFLAll.mReceived, Math.pow(2, numListenerFunctions) - 1);</span>
<a href="#l82.32"></a><span id="l82.32">   gFLAll.mReceived = 0;</span>
<a href="#l82.33"></a><span id="l82.33"> </span>
<a href="#l82.34"></a><span id="l82.34">   for (i = 0; i &lt; numListenerFunctions; ++i) {</span>
<a href="#l82.35"></a><span id="l82.35" class="difflineminus">-    do_check_eq(gFLSingle[i].mReceived, Math.pow(2, i));</span>
<a href="#l82.36"></a><span id="l82.36" class="difflineplus">+    Assert.equal(gFLSingle[i].mReceived, Math.pow(2, i));</span>
<a href="#l82.37"></a><span id="l82.37">     gFLSingle[i].mReceived = 0;</span>
<a href="#l82.38"></a><span id="l82.38"> </span>
<a href="#l82.39"></a><span id="l82.39">     // And prepare for test 3.</span>
<a href="#l82.40"></a><span id="l82.40">     gFLSingle[i].mAutoRemoveItem = true;</span>
<a href="#l82.41"></a><span id="l82.41">   }</span>
<a href="#l82.42"></a><span id="l82.42"> </span>
<a href="#l82.43"></a><span id="l82.43">   // Test - Remove Single Listeners as we go through the functions</span>
<a href="#l82.44"></a><span id="l82.44"> </span>
<a href="#l82.45"></a><span id="l82.45">   // Check the for loop above for changes to the single listeners.</span>
<a href="#l82.46"></a><span id="l82.46"> </span>
<a href="#l82.47"></a><span id="l82.47">   NotifyMailSession();</span>
<a href="#l82.48"></a><span id="l82.48"> </span>
<a href="#l82.49"></a><span id="l82.49" class="difflineminus">-  do_check_eq(gFLAll.mReceived, Math.pow(2, numListenerFunctions) - 1);</span>
<a href="#l82.50"></a><span id="l82.50" class="difflineplus">+  Assert.equal(gFLAll.mReceived, Math.pow(2, numListenerFunctions) - 1);</span>
<a href="#l82.51"></a><span id="l82.51">   gFLAll.mReceived = 0;</span>
<a href="#l82.52"></a><span id="l82.52"> </span>
<a href="#l82.53"></a><span id="l82.53">   for (i = 0; i &lt; numListenerFunctions; ++i) {</span>
<a href="#l82.54"></a><span id="l82.54" class="difflineminus">-    do_check_eq(gFLSingle[i].mReceived, Math.pow(2, i));</span>
<a href="#l82.55"></a><span id="l82.55" class="difflineplus">+    Assert.equal(gFLSingle[i].mReceived, Math.pow(2, i));</span>
<a href="#l82.56"></a><span id="l82.56">     gFLSingle[i].mReceived = 0;</span>
<a href="#l82.57"></a><span id="l82.57">   }</span>
<a href="#l82.58"></a><span id="l82.58"> </span>
<a href="#l82.59"></a><span id="l82.59">   // Test - Ensure the single listeners have been removed.</span>
<a href="#l82.60"></a><span id="l82.60"> </span>
<a href="#l82.61"></a><span id="l82.61">   NotifyMailSession();</span>
<a href="#l82.62"></a><span id="l82.62"> </span>
<a href="#l82.63"></a><span id="l82.63" class="difflineminus">-  do_check_eq(gFLAll.mReceived, Math.pow(2, numListenerFunctions) - 1);</span>
<a href="#l82.64"></a><span id="l82.64" class="difflineplus">+  Assert.equal(gFLAll.mReceived, Math.pow(2, numListenerFunctions) - 1);</span>
<a href="#l82.65"></a><span id="l82.65">   gFLAll.mReceived = 0;</span>
<a href="#l82.66"></a><span id="l82.66"> </span>
<a href="#l82.67"></a><span id="l82.67">   for (i = 0; i &lt; numListenerFunctions; ++i)</span>
<a href="#l82.68"></a><span id="l82.68" class="difflineminus">-    do_check_eq(gFLSingle[i].mReceived, 0);</span>
<a href="#l82.69"></a><span id="l82.69" class="difflineplus">+    Assert.equal(gFLSingle[i].mReceived, 0);</span>
<a href="#l82.70"></a><span id="l82.70"> </span>
<a href="#l82.71"></a><span id="l82.71">   // Test - Remove main listener</span>
<a href="#l82.72"></a><span id="l82.72"> </span>
<a href="#l82.73"></a><span id="l82.73">   MailServices.mailSession.RemoveFolderListener(gFLAll);</span>
<a href="#l82.74"></a><span id="l82.74"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgTraitService.js</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgTraitService.js</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -15,108 +15,108 @@ var kJunkIndex = Ci.nsIJunkMailPlugin.JU</span>
<a href="#l83.4"></a><span id="l83.4"> var proId = &quot;TheProTrait&quot;;</span>
<a href="#l83.5"></a><span id="l83.5"> var proName = &quot;ProName&quot;;</span>
<a href="#l83.6"></a><span id="l83.6"> var antiId = &quot;TheAntiTrait&quot;;</span>
<a href="#l83.7"></a><span id="l83.7"> var antiName = &quot;AntiName&quot;;</span>
<a href="#l83.8"></a><span id="l83.8"> </span>
<a href="#l83.9"></a><span id="l83.9"> function run_test()</span>
<a href="#l83.10"></a><span id="l83.10"> {</span>
<a href="#l83.11"></a><span id="l83.11">   // Check lastIndex prior to adding, 3 - 1000 are reserved for mailnews</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-  do_check_eq(ts.lastIndex, 1000);</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+  Assert.equal(ts.lastIndex, 1000);</span>
<a href="#l83.14"></a><span id="l83.14"> </span>
<a href="#l83.15"></a><span id="l83.15">   // basic junk as traits should be setup automatically</span>
<a href="#l83.16"></a><span id="l83.16" class="difflineminus">-  do_check_eq(kGoodId,</span>
<a href="#l83.17"></a><span id="l83.17" class="difflineminus">-              Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + kGoodIndex));</span>
<a href="#l83.18"></a><span id="l83.18" class="difflineminus">-  do_check_eq(kJunkId,</span>
<a href="#l83.19"></a><span id="l83.19" class="difflineminus">-              Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + kJunkIndex));</span>
<a href="#l83.20"></a><span id="l83.20" class="difflineminus">-  do_check_eq(kGoodId,</span>
<a href="#l83.21"></a><span id="l83.21" class="difflineminus">-              Services.prefs.getCharPref(&quot;mailnews.traits.antiId.&quot; + kJunkIndex));</span>
<a href="#l83.22"></a><span id="l83.22" class="difflineminus">-  do_check_true(Services.prefs.getBoolPref(&quot;mailnews.traits.enabled.&quot; + kJunkIndex));</span>
<a href="#l83.23"></a><span id="l83.23" class="difflineplus">+  Assert.equal(kGoodId,</span>
<a href="#l83.24"></a><span id="l83.24" class="difflineplus">+               Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + kGoodIndex));</span>
<a href="#l83.25"></a><span id="l83.25" class="difflineplus">+  Assert.equal(kJunkId,</span>
<a href="#l83.26"></a><span id="l83.26" class="difflineplus">+               Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + kJunkIndex));</span>
<a href="#l83.27"></a><span id="l83.27" class="difflineplus">+  Assert.equal(kGoodId,</span>
<a href="#l83.28"></a><span id="l83.28" class="difflineplus">+               Services.prefs.getCharPref(&quot;mailnews.traits.antiId.&quot; + kJunkIndex));</span>
<a href="#l83.29"></a><span id="l83.29" class="difflineplus">+  Assert.ok(Services.prefs.getBoolPref(&quot;mailnews.traits.enabled.&quot; + kJunkIndex));</span>
<a href="#l83.30"></a><span id="l83.30"> </span>
<a href="#l83.31"></a><span id="l83.31">   // add the pro and anti test traits</span>
<a href="#l83.32"></a><span id="l83.32" class="difflineminus">-  do_check_false(ts.isRegistered(proId));</span>
<a href="#l83.33"></a><span id="l83.33" class="difflineplus">+  Assert.ok(!ts.isRegistered(proId));</span>
<a href="#l83.34"></a><span id="l83.34">   var proIndex = ts.registerTrait(proId);</span>
<a href="#l83.35"></a><span id="l83.35" class="difflineminus">-  do_check_true(ts.isRegistered(proId));</span>
<a href="#l83.36"></a><span id="l83.36" class="difflineminus">-  do_check_eq(proIndex, 1001);</span>
<a href="#l83.37"></a><span id="l83.37" class="difflineminus">-  do_check_eq(proIndex, ts.getIndex(proId));</span>
<a href="#l83.38"></a><span id="l83.38" class="difflineminus">-  do_check_eq(proId, ts.getId(proIndex));</span>
<a href="#l83.39"></a><span id="l83.39" class="difflineplus">+  Assert.ok(ts.isRegistered(proId));</span>
<a href="#l83.40"></a><span id="l83.40" class="difflineplus">+  Assert.equal(proIndex, 1001);</span>
<a href="#l83.41"></a><span id="l83.41" class="difflineplus">+  Assert.equal(proIndex, ts.getIndex(proId));</span>
<a href="#l83.42"></a><span id="l83.42" class="difflineplus">+  Assert.equal(proId, ts.getId(proIndex));</span>
<a href="#l83.43"></a><span id="l83.43">   var antiIndex = ts.registerTrait(antiId);</span>
<a href="#l83.44"></a><span id="l83.44" class="difflineminus">-  do_check_eq(proIndex, 1001);</span>
<a href="#l83.45"></a><span id="l83.45" class="difflineminus">-  do_check_eq(antiIndex, 1002);</span>
<a href="#l83.46"></a><span id="l83.46" class="difflineplus">+  Assert.equal(proIndex, 1001);</span>
<a href="#l83.47"></a><span id="l83.47" class="difflineplus">+  Assert.equal(antiIndex, 1002);</span>
<a href="#l83.48"></a><span id="l83.48"> </span>
<a href="#l83.49"></a><span id="l83.49">   // check setting and getting things through the service</span>
<a href="#l83.50"></a><span id="l83.50">   ts.setName(proId, proName);</span>
<a href="#l83.51"></a><span id="l83.51" class="difflineminus">-  do_check_eq(proName, ts.getName(proId));</span>
<a href="#l83.52"></a><span id="l83.52" class="difflineminus">-  do_check_false(ts.getEnabled(proId));</span>
<a href="#l83.53"></a><span id="l83.53" class="difflineplus">+  Assert.equal(proName, ts.getName(proId));</span>
<a href="#l83.54"></a><span id="l83.54" class="difflineplus">+  Assert.ok(!ts.getEnabled(proId));</span>
<a href="#l83.55"></a><span id="l83.55">   ts.setEnabled(proId, true);</span>
<a href="#l83.56"></a><span id="l83.56" class="difflineminus">-  do_check_true(ts.getEnabled(proId));</span>
<a href="#l83.57"></a><span id="l83.57" class="difflineplus">+  Assert.ok(ts.getEnabled(proId));</span>
<a href="#l83.58"></a><span id="l83.58">   ts.setAntiId(proId, antiId);</span>
<a href="#l83.59"></a><span id="l83.59" class="difflineminus">-  do_check_eq(antiId, ts.getAntiId(proId));</span>
<a href="#l83.60"></a><span id="l83.60" class="difflineplus">+  Assert.equal(antiId, ts.getAntiId(proId));</span>
<a href="#l83.61"></a><span id="l83.61">   var proArray = {};</span>
<a href="#l83.62"></a><span id="l83.62">   var antiArray = {};</span>
<a href="#l83.63"></a><span id="l83.63">   ts.getEnabledIndices({}, proArray, antiArray);</span>
<a href="#l83.64"></a><span id="l83.64" class="difflineminus">-  do_check_eq(proArray.value.length, 2);</span>
<a href="#l83.65"></a><span id="l83.65" class="difflineminus">-  do_check_eq(antiArray.value.length, 2);</span>
<a href="#l83.66"></a><span id="l83.66" class="difflineminus">-  do_check_eq(proArray.value[1], proIndex);</span>
<a href="#l83.67"></a><span id="l83.67" class="difflineminus">-  do_check_eq(antiArray.value[1], antiIndex);</span>
<a href="#l83.68"></a><span id="l83.68" class="difflineplus">+  Assert.equal(proArray.value.length, 2);</span>
<a href="#l83.69"></a><span id="l83.69" class="difflineplus">+  Assert.equal(antiArray.value.length, 2);</span>
<a href="#l83.70"></a><span id="l83.70" class="difflineplus">+  Assert.equal(proArray.value[1], proIndex);</span>
<a href="#l83.71"></a><span id="l83.71" class="difflineplus">+  Assert.equal(antiArray.value[1], antiIndex);</span>
<a href="#l83.72"></a><span id="l83.72"> </span>
<a href="#l83.73"></a><span id="l83.73">   // check of aliases</span>
<a href="#l83.74"></a><span id="l83.74">   // add three random aliases</span>
<a href="#l83.75"></a><span id="l83.75">   ts.addAlias(1, 501);</span>
<a href="#l83.76"></a><span id="l83.76">   ts.addAlias(1, 502);</span>
<a href="#l83.77"></a><span id="l83.77">   ts.addAlias(1, 601);</span>
<a href="#l83.78"></a><span id="l83.78">   let aliases = ts.getAliases(1, {});</span>
<a href="#l83.79"></a><span id="l83.79" class="difflineminus">-  do_check_eq(aliases[0], 501);</span>
<a href="#l83.80"></a><span id="l83.80" class="difflineminus">-  do_check_eq(aliases[1], 502);</span>
<a href="#l83.81"></a><span id="l83.81" class="difflineminus">-  do_check_eq(aliases[2], 601);</span>
<a href="#l83.82"></a><span id="l83.82" class="difflineplus">+  Assert.equal(aliases[0], 501);</span>
<a href="#l83.83"></a><span id="l83.83" class="difflineplus">+  Assert.equal(aliases[1], 502);</span>
<a href="#l83.84"></a><span id="l83.84" class="difflineplus">+  Assert.equal(aliases[2], 601);</span>
<a href="#l83.85"></a><span id="l83.85"> </span>
<a href="#l83.86"></a><span id="l83.86">   // remove the middle one</span>
<a href="#l83.87"></a><span id="l83.87">   ts.removeAlias(1, 502);</span>
<a href="#l83.88"></a><span id="l83.88">   aliases = ts.getAliases(1, {});</span>
<a href="#l83.89"></a><span id="l83.89" class="difflineminus">-  do_check_eq(aliases.length, 2);</span>
<a href="#l83.90"></a><span id="l83.90" class="difflineminus">-  do_check_eq(aliases[0], 501);</span>
<a href="#l83.91"></a><span id="l83.91" class="difflineminus">-  do_check_eq(aliases[1], 601);</span>
<a href="#l83.92"></a><span id="l83.92" class="difflineplus">+  Assert.equal(aliases.length, 2);</span>
<a href="#l83.93"></a><span id="l83.93" class="difflineplus">+  Assert.equal(aliases[0], 501);</span>
<a href="#l83.94"></a><span id="l83.94" class="difflineplus">+  Assert.equal(aliases[1], 601);</span>
<a href="#l83.95"></a><span id="l83.95"> </span>
<a href="#l83.96"></a><span id="l83.96">   // try to add an existing value</span>
<a href="#l83.97"></a><span id="l83.97">   ts.addAlias(1, 501);</span>
<a href="#l83.98"></a><span id="l83.98">   aliases = ts.getAliases(1, {});</span>
<a href="#l83.99"></a><span id="l83.99" class="difflineminus">-  do_check_eq(aliases.length, 2);</span>
<a href="#l83.100"></a><span id="l83.100" class="difflineminus">-  do_check_eq(aliases[0], 501);</span>
<a href="#l83.101"></a><span id="l83.101" class="difflineminus">-  do_check_eq(aliases[1], 601);</span>
<a href="#l83.102"></a><span id="l83.102" class="difflineplus">+  Assert.equal(aliases.length, 2);</span>
<a href="#l83.103"></a><span id="l83.103" class="difflineplus">+  Assert.equal(aliases[0], 501);</span>
<a href="#l83.104"></a><span id="l83.104" class="difflineplus">+  Assert.equal(aliases[1], 601);</span>
<a href="#l83.105"></a><span id="l83.105"> </span>
<a href="#l83.106"></a><span id="l83.106">   // now let's make sure this got saved in preferences</span>
<a href="#l83.107"></a><span id="l83.107" class="difflineminus">-  do_check_eq(proId,</span>
<a href="#l83.108"></a><span id="l83.108" class="difflineminus">-              Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + proIndex));</span>
<a href="#l83.109"></a><span id="l83.109" class="difflineminus">-  do_check_eq(proName,</span>
<a href="#l83.110"></a><span id="l83.110" class="difflineminus">-              Services.prefs.getCharPref(&quot;mailnews.traits.name.&quot; + proIndex));</span>
<a href="#l83.111"></a><span id="l83.111" class="difflineminus">-  do_check_true(Services.prefs.getBoolPref(&quot;mailnews.traits.enabled.&quot; + proIndex));</span>
<a href="#l83.112"></a><span id="l83.112" class="difflineminus">-  do_check_eq(antiId,</span>
<a href="#l83.113"></a><span id="l83.113" class="difflineminus">-              Services.prefs.getCharPref(&quot;mailnews.traits.antiId.&quot; + proIndex));</span>
<a href="#l83.114"></a><span id="l83.114" class="difflineplus">+  Assert.equal(proId,</span>
<a href="#l83.115"></a><span id="l83.115" class="difflineplus">+               Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + proIndex));</span>
<a href="#l83.116"></a><span id="l83.116" class="difflineplus">+  Assert.equal(proName,</span>
<a href="#l83.117"></a><span id="l83.117" class="difflineplus">+               Services.prefs.getCharPref(&quot;mailnews.traits.name.&quot; + proIndex));</span>
<a href="#l83.118"></a><span id="l83.118" class="difflineplus">+  Assert.ok(Services.prefs.getBoolPref(&quot;mailnews.traits.enabled.&quot; + proIndex));</span>
<a href="#l83.119"></a><span id="l83.119" class="difflineplus">+  Assert.equal(antiId,</span>
<a href="#l83.120"></a><span id="l83.120" class="difflineplus">+               Services.prefs.getCharPref(&quot;mailnews.traits.antiId.&quot; + proIndex));</span>
<a href="#l83.121"></a><span id="l83.121"> </span>
<a href="#l83.122"></a><span id="l83.122">   // remove the pro trait</span>
<a href="#l83.123"></a><span id="l83.123">   ts.unRegisterTrait(proId);</span>
<a href="#l83.124"></a><span id="l83.124" class="difflineminus">-  do_check_false(ts.isRegistered(proId));</span>
<a href="#l83.125"></a><span id="l83.125" class="difflineplus">+  Assert.ok(!ts.isRegistered(proId));</span>
<a href="#l83.126"></a><span id="l83.126"> </span>
<a href="#l83.127"></a><span id="l83.127">   // check that this is also removed from prefs. The get calls should fail</span>
<a href="#l83.128"></a><span id="l83.128">   try {</span>
<a href="#l83.129"></a><span id="l83.129">     Services.prefs.getCharPref(&quot;mailnews.traits.id.&quot; + proIndex);</span>
<a href="#l83.130"></a><span id="l83.130" class="difflineminus">-    do_check_true(false);</span>
<a href="#l83.131"></a><span id="l83.131" class="difflineplus">+    Assert.ok(false);</span>
<a href="#l83.132"></a><span id="l83.132">   }</span>
<a href="#l83.133"></a><span id="l83.133">   catch (e) {}</span>
<a href="#l83.134"></a><span id="l83.134"> </span>
<a href="#l83.135"></a><span id="l83.135">   try {</span>
<a href="#l83.136"></a><span id="l83.136">     Services.prefs.getCharPref(&quot;mailnews.traits.name.&quot; + proIndex);</span>
<a href="#l83.137"></a><span id="l83.137" class="difflineminus">-    do_check_true(false);</span>
<a href="#l83.138"></a><span id="l83.138" class="difflineplus">+    Assert.ok(false);</span>
<a href="#l83.139"></a><span id="l83.139">   }</span>
<a href="#l83.140"></a><span id="l83.140">   catch (e) {}</span>
<a href="#l83.141"></a><span id="l83.141"> </span>
<a href="#l83.142"></a><span id="l83.142">   try {</span>
<a href="#l83.143"></a><span id="l83.143">     Services.prefs.getBoolPref(&quot;mailnews.traits.enabled.&quot; + proIndex);</span>
<a href="#l83.144"></a><span id="l83.144" class="difflineminus">-    do_check_true(false);</span>
<a href="#l83.145"></a><span id="l83.145" class="difflineplus">+    Assert.ok(false);</span>
<a href="#l83.146"></a><span id="l83.146">   }</span>
<a href="#l83.147"></a><span id="l83.147">   catch (e) {}</span>
<a href="#l83.148"></a><span id="l83.148"> </span>
<a href="#l83.149"></a><span id="l83.149">   try {</span>
<a href="#l83.150"></a><span id="l83.150">     Services.prefs.getCharPref(&quot;mailnews.traits.antiId.&quot; + proIndex);</span>
<a href="#l83.151"></a><span id="l83.151" class="difflineminus">-    do_check_true(false);</span>
<a href="#l83.152"></a><span id="l83.152" class="difflineplus">+    Assert.ok(false);</span>
<a href="#l83.153"></a><span id="l83.153">   }</span>
<a href="#l83.154"></a><span id="l83.154">   catch(e) {}</span>
<a href="#l83.155"></a><span id="l83.155"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -40,25 +40,25 @@ var gTests =</span>
<a href="#l84.4"></a><span id="l84.4">     fileName: kJunkFile,</span>
<a href="#l84.5"></a><span id="l84.5">     traitId: MailServices.junk.JUNK_TRAIT,</span>
<a href="#l84.6"></a><span id="l84.6">   },</span>
<a href="#l84.7"></a><span id="l84.7">   // test a filter that acts on GOOD messages</span>
<a href="#l84.8"></a><span id="l84.8">   {</span>
<a href="#l84.9"></a><span id="l84.9">     command: kClass,</span>
<a href="#l84.10"></a><span id="l84.10">     fileName: kGoodFile,</span>
<a href="#l84.11"></a><span id="l84.11">     test: function testClassGood() {</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-      do_check_eq(kPriorityHigh, gMsgHdr.priority);</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+      Assert.equal(kPriorityHigh, gMsgHdr.priority);</span>
<a href="#l84.14"></a><span id="l84.14">     }</span>
<a href="#l84.15"></a><span id="l84.15">   },</span>
<a href="#l84.16"></a><span id="l84.16">   // test a filter that acts on JUNK messages</span>
<a href="#l84.17"></a><span id="l84.17">   {</span>
<a href="#l84.18"></a><span id="l84.18">     command: kClass,</span>
<a href="#l84.19"></a><span id="l84.19">     fileName: kJunkFile,</span>
<a href="#l84.20"></a><span id="l84.20">     test: function testClassJunk() {</span>
<a href="#l84.21"></a><span id="l84.21" class="difflineminus">-      do_check_eq(kPriorityLow, gMsgHdr.priority);</span>
<a href="#l84.22"></a><span id="l84.22" class="difflineplus">+      Assert.equal(kPriorityLow, gMsgHdr.priority);</span>
<a href="#l84.23"></a><span id="l84.23">     }</span>
<a href="#l84.24"></a><span id="l84.24">   },</span>
<a href="#l84.25"></a><span id="l84.25">   /**/</span>
<a href="#l84.26"></a><span id="l84.26"> ]</span>
<a href="#l84.27"></a><span id="l84.27"> </span>
<a href="#l84.28"></a><span id="l84.28"> // main test</span>
<a href="#l84.29"></a><span id="l84.29"> function run_test()</span>
<a href="#l84.30"></a><span id="l84.30"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -37,55 +37,55 @@ var gTestArray =</span>
<a href="#l85.4"></a><span id="l85.4">   // just get a message into the local folder</span>
<a href="#l85.5"></a><span id="l85.5">   function *getLocalMessages1() {</span>
<a href="#l85.6"></a><span id="l85.6">     gPOP3Pump.files = gFiles;</span>
<a href="#l85.7"></a><span id="l85.7">     let promise1 = PromiseTestUtils.promiseFolderNotification(gMoveFolder, &quot;msgsClassified&quot;);</span>
<a href="#l85.8"></a><span id="l85.8">     let promise2 = gPOP3Pump.run();</span>
<a href="#l85.9"></a><span id="l85.9">     yield Promise.all([promise1, promise2]);</span>
<a href="#l85.10"></a><span id="l85.10">   },</span>
<a href="#l85.11"></a><span id="l85.11">   function verifyFolders1() {</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-    do_check_eq(folderCount(gMoveFolder), 2);</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+    Assert.equal(folderCount(gMoveFolder), 2);</span>
<a href="#l85.14"></a><span id="l85.14">     // the local inbox folder should now be empty, since the second</span>
<a href="#l85.15"></a><span id="l85.15">     // operation was a move</span>
<a href="#l85.16"></a><span id="l85.16" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l85.17"></a><span id="l85.17" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l85.18"></a><span id="l85.18"> </span>
<a href="#l85.19"></a><span id="l85.19">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l85.20"></a><span id="l85.20">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l85.21"></a><span id="l85.21">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l85.22"></a><span id="l85.22">     // Check that the messages have content</span>
<a href="#l85.23"></a><span id="l85.23">     messageContent = getContentFromMessage(firstMsgHdr);</span>
<a href="#l85.24"></a><span id="l85.24" class="difflineminus">-    do_check_true(messageContent.includes(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l85.25"></a><span id="l85.25" class="difflineplus">+    Assert.ok(messageContent.includes(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l85.26"></a><span id="l85.26">     messageContent = getContentFromMessage(secondMsgHdr);</span>
<a href="#l85.27"></a><span id="l85.27" class="difflineminus">-    do_check_true(messageContent.includes(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l85.28"></a><span id="l85.28" class="difflineplus">+    Assert.ok(messageContent.includes(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l85.29"></a><span id="l85.29">   },</span>
<a href="#l85.30"></a><span id="l85.30">   function* copyMovedMessages() {</span>
<a href="#l85.31"></a><span id="l85.31">     let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l85.32"></a><span id="l85.32">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l85.33"></a><span id="l85.33">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l85.34"></a><span id="l85.34">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l85.35"></a><span id="l85.35">     messages.appendElement(firstMsgHdr);</span>
<a href="#l85.36"></a><span id="l85.36">     messages.appendElement(secondMsgHdr);</span>
<a href="#l85.37"></a><span id="l85.37">     let promiseCopyListener = new PromiseTestUtils.PromiseCopyListener();</span>
<a href="#l85.38"></a><span id="l85.38">     MailServices.copy.CopyMessages(gMoveFolder, messages, gMoveFolder2, false,</span>
<a href="#l85.39"></a><span id="l85.39">                                    promiseCopyListener, null, false);</span>
<a href="#l85.40"></a><span id="l85.40">     let promiseMoveMsg =</span>
<a href="#l85.41"></a><span id="l85.41">       PromiseTestUtils.promiseFolderEvent(gMoveFolder, &quot;DeleteOrMoveMsgCompleted&quot;);</span>
<a href="#l85.42"></a><span id="l85.42">     yield Promise.all([promiseCopyListener.promise, promiseMoveMsg]);</span>
<a href="#l85.43"></a><span id="l85.43">   },</span>
<a href="#l85.44"></a><span id="l85.44">   function verifyFolders2() {</span>
<a href="#l85.45"></a><span id="l85.45" class="difflineminus">-    do_check_eq(folderCount(gMoveFolder2), 2);</span>
<a href="#l85.46"></a><span id="l85.46" class="difflineplus">+    Assert.equal(folderCount(gMoveFolder2), 2);</span>
<a href="#l85.47"></a><span id="l85.47"> </span>
<a href="#l85.48"></a><span id="l85.48">     let enumerator = gMoveFolder2.msgDatabase.EnumerateMessages();</span>
<a href="#l85.49"></a><span id="l85.49">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l85.50"></a><span id="l85.50">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l85.51"></a><span id="l85.51">     // Check that the messages have content</span>
<a href="#l85.52"></a><span id="l85.52">     messageContent = getContentFromMessage(firstMsgHdr);</span>
<a href="#l85.53"></a><span id="l85.53" class="difflineminus">-    do_check_true(messageContent.includes(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l85.54"></a><span id="l85.54" class="difflineplus">+    Assert.ok(messageContent.includes(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l85.55"></a><span id="l85.55">     messageContent = getContentFromMessage(secondMsgHdr);</span>
<a href="#l85.56"></a><span id="l85.56" class="difflineminus">-    do_check_true(messageContent.includes(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l85.57"></a><span id="l85.57" class="difflineplus">+    Assert.ok(messageContent.includes(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l85.58"></a><span id="l85.58">   },</span>
<a href="#l85.59"></a><span id="l85.59">   function endTest() {</span>
<a href="#l85.60"></a><span id="l85.60">     dump(&quot;Exiting mail tests\n&quot;);</span>
<a href="#l85.61"></a><span id="l85.61">     gPOP3Pump = null;</span>
<a href="#l85.62"></a><span id="l85.62">   }</span>
<a href="#l85.63"></a><span id="l85.63"> ];</span>
<a href="#l85.64"></a><span id="l85.64"> </span>
<a href="#l85.65"></a><span id="l85.65"> function folderCount(folder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/base/test/unit/test_retention.js</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_retention.js</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -40,28 +40,28 @@ function* actually_run_test() {</span>
<a href="#l86.4"></a><span id="l86.4">   gTestFolder.msgDatabase = null;</span>
<a href="#l86.5"></a><span id="l86.5">   gTestFolder.applyRetentionSettings();</span>
<a href="#l86.6"></a><span id="l86.6">   const gDbService = Cc[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l86.7"></a><span id="l86.7">                        .getService(Ci.nsIMsgDBService);</span>
<a href="#l86.8"></a><span id="l86.8">   // adding messages leaves some headers around as garbage - make sure</span>
<a href="#l86.9"></a><span id="l86.9">   // those are cleaned up so the db will get closed.</span>
<a href="#l86.10"></a><span id="l86.10">   Components.utils.forceGC();</span>
<a href="#l86.11"></a><span id="l86.11">   Components.utils.forceCC();</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-  do_check_eq(gDbService.cachedDBForFolder(gTestFolder), null);</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+  Assert.equal(gDbService.cachedDBForFolder(gTestFolder), null);</span>
<a href="#l86.14"></a><span id="l86.14">   // no retention settings, so we should have the same number of messages.</span>
<a href="#l86.15"></a><span id="l86.15" class="difflineminus">-  do_check_eq(numMessages, gTestFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l86.16"></a><span id="l86.16" class="difflineplus">+  Assert.equal(numMessages, gTestFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l86.17"></a><span id="l86.17">   let serverSettings = gTestFolder.server.retentionSettings;</span>
<a href="#l86.18"></a><span id="l86.18">   serverSettings.retainByPreference = Ci.nsIMsgRetentionSettings.nsMsgRetainByNumHeaders;</span>
<a href="#l86.19"></a><span id="l86.19">   serverSettings.numHeadersToKeep = 9;</span>
<a href="#l86.20"></a><span id="l86.20">   gTestFolder.server.retentionSettings = serverSettings;</span>
<a href="#l86.21"></a><span id="l86.21">   gTestFolder.applyRetentionSettings();</span>
<a href="#l86.22"></a><span id="l86.22">   // no retention settings, so we should have the same number of messages.</span>
<a href="#l86.23"></a><span id="l86.23" class="difflineminus">-  do_check_eq(9, gTestFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l86.24"></a><span id="l86.24" class="difflineplus">+  Assert.equal(9, gTestFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l86.25"></a><span id="l86.25">   let folderSettings = gTestFolder.retentionSettings;</span>
<a href="#l86.26"></a><span id="l86.26">   folderSettings.retainByPreference = Ci.nsIMsgRetentionSettings.nsMsgRetainByNumHeaders;</span>
<a href="#l86.27"></a><span id="l86.27">   folderSettings.numHeadersToKeep = 8;</span>
<a href="#l86.28"></a><span id="l86.28">   folderSettings.useServerDefaults = false;</span>
<a href="#l86.29"></a><span id="l86.29">   gTestFolder.retentionSettings = folderSettings;</span>
<a href="#l86.30"></a><span id="l86.30">   gTestFolder.applyRetentionSettings();</span>
<a href="#l86.31"></a><span id="l86.31">   // no retention settings, so we should have the same number of messages.</span>
<a href="#l86.32"></a><span id="l86.32" class="difflineminus">-  do_check_eq(8, gTestFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l86.33"></a><span id="l86.33" class="difflineplus">+  Assert.equal(8, gTestFolder.msgDatabase.dBFolderInfo.numMessages);</span>
<a href="#l86.34"></a><span id="l86.34">   do_test_finished();</span>
<a href="#l86.35"></a><span id="l86.35"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/base/test/unit/test_search.js</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_search.js</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -292,17 +292,17 @@ function testSearch()</span>
<a href="#l87.4"></a><span id="l87.4"> {</span>
<a href="#l87.5"></a><span id="l87.5">   var test = Tests.shift();</span>
<a href="#l87.6"></a><span id="l87.6">   if (test &amp;&amp; test.dbHeader)</span>
<a href="#l87.7"></a><span id="l87.7">   {</span>
<a href="#l87.8"></a><span id="l87.8">     //  test of a custom db header</span>
<a href="#l87.9"></a><span id="l87.9">     dump(&quot;testing dbHeader &quot; + test.dbHeader + &quot;\n&quot;);</span>
<a href="#l87.10"></a><span id="l87.10">     customValue = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder)</span>
<a href="#l87.11"></a><span id="l87.11">                                .getProperty(test.dbHeader);</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-    do_check_eq(customValue, test.testString);</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+    Assert.equal(customValue, test.testString);</span>
<a href="#l87.14"></a><span id="l87.14">     do_timeout(0, testSearch);</span>
<a href="#l87.15"></a><span id="l87.15">   }</span>
<a href="#l87.16"></a><span id="l87.16">   else if (test)</span>
<a href="#l87.17"></a><span id="l87.17">   {</span>
<a href="#l87.18"></a><span id="l87.18">     dump(&quot;testing for string '&quot; + test.testString + &quot;'\n&quot;);</span>
<a href="#l87.19"></a><span id="l87.19">     testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l87.20"></a><span id="l87.20">                          test.testString,</span>
<a href="#l87.21"></a><span id="l87.21">                          test.testAttribute,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchBoolean.js</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchBoolean.js</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -169,17 +169,17 @@ function run_test()</span>
<a href="#l88.4"></a><span id="l88.4"> }</span>
<a href="#l88.5"></a><span id="l88.5"> </span>
<a href="#l88.6"></a><span id="l88.6"> var gTest = null;</span>
<a href="#l88.7"></a><span id="l88.7"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l88.8"></a><span id="l88.8"> function testSearch()</span>
<a href="#l88.9"></a><span id="l88.9"> {</span>
<a href="#l88.10"></a><span id="l88.10">   // tests the previous search</span>
<a href="#l88.11"></a><span id="l88.11">   if (gTest)</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-    do_check_eq(gHitCount, gTest.matches ? 1 : 0);</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineplus">+    Assert.equal(gHitCount, gTest.matches ? 1 : 0);</span>
<a href="#l88.14"></a><span id="l88.14">   gTest = Tests.shift();</span>
<a href="#l88.15"></a><span id="l88.15">   if (gTest)</span>
<a href="#l88.16"></a><span id="l88.16">   {</span>
<a href="#l88.17"></a><span id="l88.17">     gHdr.setStringProperty(&quot;a&quot;, gTest.A ? &quot;T&quot; : &quot;F&quot;);</span>
<a href="#l88.18"></a><span id="l88.18">     gHdr.setStringProperty(&quot;b&quot;, gTest.B ? &quot;T&quot; : &quot;F&quot;);</span>
<a href="#l88.19"></a><span id="l88.19">     gHdr.setStringProperty(&quot;c&quot;, gTest.C ? &quot;T&quot; : &quot;F&quot;);</span>
<a href="#l88.20"></a><span id="l88.20">     gHdr.setStringProperty(&quot;d&quot;, gTest.D ? &quot;T&quot; : &quot;F&quot;);</span>
<a href="#l88.21"></a><span id="l88.21">     try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchLocalizationStrings.js</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchLocalizationStrings.js</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -50,12 +50,12 @@ function run_test()</span>
<a href="#l89.4"></a><span id="l89.4">       {</span>
<a href="#l89.5"></a><span id="l89.5">         dump(&quot;\n&quot; + e);</span>
<a href="#l89.6"></a><span id="l89.6">       }</span>
<a href="#l89.7"></a><span id="l89.7">       valid = valid &amp;&amp; localizedString &amp;&amp; (localizedString.length &gt; 0);</span>
<a href="#l89.8"></a><span id="l89.8">       if (!valid)</span>
<a href="#l89.9"></a><span id="l89.9">         dump(&quot;\nNo valid property for scope = &quot; + scope</span>
<a href="#l89.10"></a><span id="l89.10">               + &quot; attribute = &quot; + attribute</span>
<a href="#l89.11"></a><span id="l89.11">               + &quot; property = &quot; + property);</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-      do_check_true(valid);</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+      Assert.ok(valid);</span>
<a href="#l89.14"></a><span id="l89.14">     }</span>
<a href="#l89.15"></a><span id="l89.15">   }</span>
<a href="#l89.16"></a><span id="l89.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/base/test/unit/test_testsuite_base64.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_testsuite_base64.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -8,16 +8,16 @@</span>
<a href="#l90.4"></a><span id="l90.4">  */</span>
<a href="#l90.5"></a><span id="l90.5"> </span>
<a href="#l90.6"></a><span id="l90.6"> function run_test()</span>
<a href="#l90.7"></a><span id="l90.7"> {</span>
<a href="#l90.8"></a><span id="l90.8">   var plain = &quot;testtesttest&quot;;</span>
<a href="#l90.9"></a><span id="l90.9">   var encoded = &quot;dGVzdHRlc3R0ZXN0&quot;;</span>
<a href="#l90.10"></a><span id="l90.10"> </span>
<a href="#l90.11"></a><span id="l90.11">   // correct encoding according to spec</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-  do_check_eq(btoa(plain), encoded); // encode</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineminus">-  do_check_eq(atob(encoded), plain); // decode</span>
<a href="#l90.14"></a><span id="l90.14" class="difflineplus">+  Assert.equal(btoa(plain), encoded); // encode</span>
<a href="#l90.15"></a><span id="l90.15" class="difflineplus">+  Assert.equal(atob(encoded), plain); // decode</span>
<a href="#l90.16"></a><span id="l90.16"> </span>
<a href="#l90.17"></a><span id="l90.17">   // roundtrip works</span>
<a href="#l90.18"></a><span id="l90.18" class="difflineminus">-  do_check_eq(atob(btoa(plain)), plain);</span>
<a href="#l90.19"></a><span id="l90.19" class="difflineminus">-  do_check_eq(btoa(atob(encoded)), encoded);</span>
<a href="#l90.20"></a><span id="l90.20" class="difflineplus">+  Assert.equal(atob(btoa(plain)), plain);</span>
<a href="#l90.21"></a><span id="l90.21" class="difflineplus">+  Assert.equal(btoa(atob(encoded)), encoded);</span>
<a href="#l90.22"></a><span id="l90.22">   return true;</span>
<a href="#l90.23"></a><span id="l90.23"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_testsuite_fakeserverAuth.js</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -22,37 +22,37 @@ function run_test()</span>
<a href="#l91.4"></a><span id="l91.4"> /**</span>
<a href="#l91.5"></a><span id="l91.5">  * Test AUTH PLAIN</span>
<a href="#l91.6"></a><span id="l91.6">  */</span>
<a href="#l91.7"></a><span id="l91.7"> function authPLAIN()</span>
<a href="#l91.8"></a><span id="l91.8"> {</span>
<a href="#l91.9"></a><span id="l91.9">   // roundtrip works</span>
<a href="#l91.10"></a><span id="l91.10">   var line = AuthPLAIN.encodeLine(kUsername, kPassword);</span>
<a href="#l91.11"></a><span id="l91.11">   var req = AuthPLAIN.decodeLine(line);</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  do_check_eq(req.username, kUsername);</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineminus">-  do_check_eq(req.password, kPassword);</span>
<a href="#l91.14"></a><span id="l91.14" class="difflineplus">+  Assert.equal(req.username, kUsername);</span>
<a href="#l91.15"></a><span id="l91.15" class="difflineplus">+  Assert.equal(req.password, kPassword);</span>
<a href="#l91.16"></a><span id="l91.16"> </span>
<a href="#l91.17"></a><span id="l91.17">   // correct encoding</span>
<a href="#l91.18"></a><span id="l91.18" class="difflineminus">-  do_check_eq(line, &quot;AGZyZWQxAHdpbG1hMg==&quot;);</span>
<a href="#l91.19"></a><span id="l91.19" class="difflineplus">+  Assert.equal(line, &quot;AGZyZWQxAHdpbG1hMg==&quot;);</span>
<a href="#l91.20"></a><span id="l91.20"> };</span>
<a href="#l91.21"></a><span id="l91.21"> </span>
<a href="#l91.22"></a><span id="l91.22"> /**</span>
<a href="#l91.23"></a><span id="l91.23">  * Test AUTH CRAM-MD5</span>
<a href="#l91.24"></a><span id="l91.24">  */</span>
<a href="#l91.25"></a><span id="l91.25"> function authCRAMMD5()</span>
<a href="#l91.26"></a><span id="l91.26"> {</span>
<a href="#l91.27"></a><span id="l91.27">   // AuthCRAM.createChallenge() creates a different challenge each time</span>
<a href="#l91.28"></a><span id="l91.28">   var hardcodedChallenge = btoa(&quot;&lt;123@fake.invalid&gt;&quot;);</span>
<a href="#l91.29"></a><span id="l91.29">   var hardcodedResponse = &quot;ZnJlZDEgOTA5YjgwMmM3NTI5NTJlYzI2NjgyMTNmYTdjNWU0ZjQ=&quot;;</span>
<a href="#l91.30"></a><span id="l91.30"> </span>
<a href="#l91.31"></a><span id="l91.31">   // correct encoding</span>
<a href="#l91.32"></a><span id="l91.32">   var req = AuthCRAM.decodeLine(hardcodedResponse);</span>
<a href="#l91.33"></a><span id="l91.33" class="difflineminus">-  do_check_eq(req.username, kUsername);</span>
<a href="#l91.34"></a><span id="l91.34" class="difflineplus">+  Assert.equal(req.username, kUsername);</span>
<a href="#l91.35"></a><span id="l91.35">   var expectedDigest = AuthCRAM.encodeCRAMMD5(hardcodedChallenge, kPassword);</span>
<a href="#l91.36"></a><span id="l91.36" class="difflineminus">-  do_check_eq(req.digest, expectedDigest);</span>
<a href="#l91.37"></a><span id="l91.37" class="difflineplus">+  Assert.equal(req.digest, expectedDigest);</span>
<a href="#l91.38"></a><span id="l91.38"> </span>
<a href="#l91.39"></a><span id="l91.39">   var challenge = AuthCRAM.createChallenge(&quot;fake.invalid&quot;);</span>
<a href="#l91.40"></a><span id="l91.40">   challenge = atob(challenge); // decode. function currently returns it already encoded</span>
<a href="#l91.41"></a><span id="l91.41">   var challengeSplit = challenge.split(&quot;@&quot;);</span>
<a href="#l91.42"></a><span id="l91.42" class="difflineminus">-  do_check_eq(challengeSplit.length, 2);</span>
<a href="#l91.43"></a><span id="l91.43" class="difflineminus">-  do_check_eq(challengeSplit[1], &quot;fake.invalid&gt;&quot;);</span>
<a href="#l91.44"></a><span id="l91.44" class="difflineminus">-  do_check_eq(challengeSplit[0][0], &quot;&lt;&quot;);</span>
<a href="#l91.45"></a><span id="l91.45" class="difflineplus">+  Assert.equal(challengeSplit.length, 2);</span>
<a href="#l91.46"></a><span id="l91.46" class="difflineplus">+  Assert.equal(challengeSplit[1], &quot;fake.invalid&gt;&quot;);</span>
<a href="#l91.47"></a><span id="l91.47" class="difflineplus">+  Assert.equal(challengeSplit[0][0], &quot;&lt;&quot;);</span>
<a href="#l91.48"></a><span id="l91.48"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -39,36 +39,36 @@ function* setupMailboxes()</span>
<a href="#l92.4"></a><span id="l92.4">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Sent&quot;, {specialUseFlag : &quot;\\Sent&quot;});</span>
<a href="#l92.5"></a><span id="l92.5">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Spam&quot;, {specialUseFlag : &quot;\\Spam&quot;});</span>
<a href="#l92.6"></a><span id="l92.6">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Starred&quot;, {specialUseFlag : &quot;\\Starred&quot;});</span>
<a href="#l92.7"></a><span id="l92.7">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Trash&quot;, {specialUseFlag : &quot;\\Trash&quot;});</span>
<a href="#l92.8"></a><span id="l92.8">   IMAPPump.daemon.createMailbox(&quot;test&quot;, {});</span>
<a href="#l92.9"></a><span id="l92.9"> </span>
<a href="#l92.10"></a><span id="l92.10">   handler = IMAPPump.server._handlerCreator(IMAPPump.daemon);</span>
<a href="#l92.11"></a><span id="l92.11">   let response = handler.onError('1', 'LOGIN user password');</span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-  do_check_true(response.includes('OK'));</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineplus">+  Assert.ok(response.includes('OK'));</span>
<a href="#l92.14"></a><span id="l92.14">   // wait for imap pump to do its thing or else we get memory leaks</span>
<a href="#l92.15"></a><span id="l92.15">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l92.16"></a><span id="l92.16">   yield false;</span>
<a href="#l92.17"></a><span id="l92.17"> }</span>
<a href="#l92.18"></a><span id="l92.18"> </span>
<a href="#l92.19"></a><span id="l92.19"> // test that 'XLIST &quot;&quot; &quot;*&quot;' returns the proper responses</span>
<a href="#l92.20"></a><span id="l92.20"> function* testXlist()</span>
<a href="#l92.21"></a><span id="l92.21"> {</span>
<a href="#l92.22"></a><span id="l92.22">   let response = handler.onError('2', 'XLIST &quot;&quot; &quot;*&quot;');</span>
<a href="#l92.23"></a><span id="l92.23"> </span>
<a href="#l92.24"></a><span id="l92.24" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\Inbox) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l92.25"></a><span id="l92.25" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Noselect \\HasChildren) &quot;/&quot; &quot;[Gmail]&quot;'));</span>
<a href="#l92.26"></a><span id="l92.26" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\AllMail) &quot;/&quot; &quot;[Gmail]/All Mail&quot;'));</span>
<a href="#l92.27"></a><span id="l92.27" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\Drafts) &quot;/&quot; &quot;[Gmail]/Drafts&quot;'));</span>
<a href="#l92.28"></a><span id="l92.28" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\Sent) &quot;/&quot; &quot;[Gmail]/Sent&quot;'));</span>
<a href="#l92.29"></a><span id="l92.29" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\Spam) &quot;/&quot; &quot;[Gmail]/Spam&quot;'));</span>
<a href="#l92.30"></a><span id="l92.30" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\Starred) &quot;/&quot; &quot;[Gmail]/Starred&quot;'));</span>
<a href="#l92.31"></a><span id="l92.31" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren \\Trash) &quot;/&quot; &quot;[Gmail]/Trash&quot;'));</span>
<a href="#l92.32"></a><span id="l92.32" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren) &quot;/&quot; &quot;test&quot;'));</span>
<a href="#l92.33"></a><span id="l92.33" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\Inbox) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l92.34"></a><span id="l92.34" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Noselect \\HasChildren) &quot;/&quot; &quot;[Gmail]&quot;'));</span>
<a href="#l92.35"></a><span id="l92.35" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\AllMail) &quot;/&quot; &quot;[Gmail]/All Mail&quot;'));</span>
<a href="#l92.36"></a><span id="l92.36" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\Drafts) &quot;/&quot; &quot;[Gmail]/Drafts&quot;'));</span>
<a href="#l92.37"></a><span id="l92.37" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\Sent) &quot;/&quot; &quot;[Gmail]/Sent&quot;'));</span>
<a href="#l92.38"></a><span id="l92.38" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\Spam) &quot;/&quot; &quot;[Gmail]/Spam&quot;'));</span>
<a href="#l92.39"></a><span id="l92.39" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\Starred) &quot;/&quot; &quot;[Gmail]/Starred&quot;'));</span>
<a href="#l92.40"></a><span id="l92.40" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren \\Trash) &quot;/&quot; &quot;[Gmail]/Trash&quot;'));</span>
<a href="#l92.41"></a><span id="l92.41" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren) &quot;/&quot; &quot;test&quot;'));</span>
<a href="#l92.42"></a><span id="l92.42"> </span>
<a href="#l92.43"></a><span id="l92.43">   yield true;</span>
<a href="#l92.44"></a><span id="l92.44"> }</span>
<a href="#l92.45"></a><span id="l92.45"> </span>
<a href="#l92.46"></a><span id="l92.46"> // Cleanup at end</span>
<a href="#l92.47"></a><span id="l92.47"> function endTest()</span>
<a href="#l92.48"></a><span id="l92.48"> {</span>
<a href="#l92.49"></a><span id="l92.49">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -47,106 +47,106 @@ function* setupMailboxes()</span>
<a href="#l93.4"></a><span id="l93.4">                                             subscribed : true});</span>
<a href="#l93.5"></a><span id="l93.5">   IMAPPump.daemon.createMailbox(&quot;Tofu&quot;, {});</span>
<a href="#l93.6"></a><span id="l93.6">   IMAPPump.daemon.createMailbox(&quot;Vegetable&quot;, {subscribed : true});</span>
<a href="#l93.7"></a><span id="l93.7">   IMAPPump.daemon.createMailbox(&quot;Vegetable/Broccoli&quot;, {subscribed : true});</span>
<a href="#l93.8"></a><span id="l93.8">   IMAPPump.daemon.createMailbox(&quot;Vegetable/Corn&quot;, {});</span>
<a href="#l93.9"></a><span id="l93.9"> </span>
<a href="#l93.10"></a><span id="l93.10">   handler = IMAPPump.server._handlerCreator(IMAPPump.daemon);</span>
<a href="#l93.11"></a><span id="l93.11">   let response = handler.onError('1', 'LOGIN user password');</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-  do_check_true(response.includes('OK'));</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+  Assert.ok(response.includes('OK'));</span>
<a href="#l93.14"></a><span id="l93.14">   // wait for imap pump to do it's thing or else we get memory leaks</span>
<a href="#l93.15"></a><span id="l93.15">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l93.16"></a><span id="l93.16">   yield false;</span>
<a href="#l93.17"></a><span id="l93.17"> }</span>
<a href="#l93.18"></a><span id="l93.18"> </span>
<a href="#l93.19"></a><span id="l93.19"> // test that 'LIST &quot;&quot; &quot;*&quot;' returns the proper responses (standard LIST usage)</span>
<a href="#l93.20"></a><span id="l93.20"> function* testList()</span>
<a href="#l93.21"></a><span id="l93.21"> {</span>
<a href="#l93.22"></a><span id="l93.22">   let response = handler.onError('2', 'LIST &quot;&quot; &quot;*&quot;');</span>
<a href="#l93.23"></a><span id="l93.23"> </span>
<a href="#l93.24"></a><span id="l93.24" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.25"></a><span id="l93.25" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l93.26"></a><span id="l93.26" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Apple&quot;'));</span>
<a href="#l93.27"></a><span id="l93.27" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l93.28"></a><span id="l93.28" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.29"></a><span id="l93.29" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.30"></a><span id="l93.30" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.31"></a><span id="l93.31" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l93.32"></a><span id="l93.32" class="difflineminus">-  do_check_false(response.includes('Peach'));</span>
<a href="#l93.33"></a><span id="l93.33" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.34"></a><span id="l93.34" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l93.35"></a><span id="l93.35" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Apple&quot;'));</span>
<a href="#l93.36"></a><span id="l93.36" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l93.37"></a><span id="l93.37" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.38"></a><span id="l93.38" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.39"></a><span id="l93.39" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.40"></a><span id="l93.40" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l93.41"></a><span id="l93.41" class="difflineplus">+  Assert.ok(!response.includes('Peach'));</span>
<a href="#l93.42"></a><span id="l93.42"> </span>
<a href="#l93.43"></a><span id="l93.43">   yield true;</span>
<a href="#l93.44"></a><span id="l93.44"> }</span>
<a href="#l93.45"></a><span id="l93.45"> </span>
<a href="#l93.46"></a><span id="l93.46"> // test that 'LIST (SUBSCRIBED) &quot;&quot; &quot;*&quot;' returns the proper responses</span>
<a href="#l93.47"></a><span id="l93.47"> function* testListSelectSubscribed()</span>
<a href="#l93.48"></a><span id="l93.48"> {</span>
<a href="#l93.49"></a><span id="l93.49">   let response = handler.onError('3', 'LIST (SUBSCRIBED) &quot;&quot; &quot;*&quot;');</span>
<a href="#l93.50"></a><span id="l93.50"> </span>
<a href="#l93.51"></a><span id="l93.51" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Marked \\NoInferiors \\Subscribed) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.52"></a><span id="l93.52" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l93.53"></a><span id="l93.53" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed \\NonExistent) &quot;/&quot; &quot;Fruit/Peach&quot;'));</span>
<a href="#l93.54"></a><span id="l93.54" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.55"></a><span id="l93.55" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.56"></a><span id="l93.56" class="difflineminus">-  do_check_false(response.includes('&quot;Fruit&quot;'));</span>
<a href="#l93.57"></a><span id="l93.57" class="difflineminus">-  do_check_false(response.includes('Apple'));</span>
<a href="#l93.58"></a><span id="l93.58" class="difflineminus">-  do_check_false(response.includes('Tofu'));</span>
<a href="#l93.59"></a><span id="l93.59" class="difflineminus">-  do_check_false(response.includes('Corn'));</span>
<a href="#l93.60"></a><span id="l93.60" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Marked \\NoInferiors \\Subscribed) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.61"></a><span id="l93.61" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l93.62"></a><span id="l93.62" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed \\NonExistent) &quot;/&quot; &quot;Fruit/Peach&quot;'));</span>
<a href="#l93.63"></a><span id="l93.63" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.64"></a><span id="l93.64" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.65"></a><span id="l93.65" class="difflineplus">+  Assert.ok(!response.includes('&quot;Fruit&quot;'));</span>
<a href="#l93.66"></a><span id="l93.66" class="difflineplus">+  Assert.ok(!response.includes('Apple'));</span>
<a href="#l93.67"></a><span id="l93.67" class="difflineplus">+  Assert.ok(!response.includes('Tofu'));</span>
<a href="#l93.68"></a><span id="l93.68" class="difflineplus">+  Assert.ok(!response.includes('Corn'));</span>
<a href="#l93.69"></a><span id="l93.69"> </span>
<a href="#l93.70"></a><span id="l93.70">   yield true;</span>
<a href="#l93.71"></a><span id="l93.71"> }</span>
<a href="#l93.72"></a><span id="l93.72"> </span>
<a href="#l93.73"></a><span id="l93.73"> // test that 'LIST &quot;&quot; &quot;%&quot; RETURN (CHILDEREN)' returns the proper responses</span>
<a href="#l93.74"></a><span id="l93.74"> function* testListReturnChilderen()</span>
<a href="#l93.75"></a><span id="l93.75"> {</span>
<a href="#l93.76"></a><span id="l93.76">   let response = handler.onError('4', 'LIST &quot;&quot; &quot;%&quot; RETURN (CHILDREN)');</span>
<a href="#l93.77"></a><span id="l93.77"> </span>
<a href="#l93.78"></a><span id="l93.78" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.79"></a><span id="l93.79" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasChildren) &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l93.80"></a><span id="l93.80" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasNoChildren) &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.81"></a><span id="l93.81" class="difflineminus">-  do_check_true(response.includes('* LIST (\\HasChildren) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.82"></a><span id="l93.82" class="difflineminus">-  do_check_false(response.includes('Apple'));</span>
<a href="#l93.83"></a><span id="l93.83" class="difflineminus">-  do_check_false(response.includes('Banana'));</span>
<a href="#l93.84"></a><span id="l93.84" class="difflineminus">-  do_check_false(response.includes('Peach'));</span>
<a href="#l93.85"></a><span id="l93.85" class="difflineminus">-  do_check_false(response.includes('Broccoli'));</span>
<a href="#l93.86"></a><span id="l93.86" class="difflineminus">-  do_check_false(response.includes('Corn'));</span>
<a href="#l93.87"></a><span id="l93.87" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.88"></a><span id="l93.88" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasChildren) &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l93.89"></a><span id="l93.89" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasNoChildren) &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.90"></a><span id="l93.90" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\HasChildren) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.91"></a><span id="l93.91" class="difflineplus">+  Assert.ok(!response.includes('Apple'));</span>
<a href="#l93.92"></a><span id="l93.92" class="difflineplus">+  Assert.ok(!response.includes('Banana'));</span>
<a href="#l93.93"></a><span id="l93.93" class="difflineplus">+  Assert.ok(!response.includes('Peach'));</span>
<a href="#l93.94"></a><span id="l93.94" class="difflineplus">+  Assert.ok(!response.includes('Broccoli'));</span>
<a href="#l93.95"></a><span id="l93.95" class="difflineplus">+  Assert.ok(!response.includes('Corn'));</span>
<a href="#l93.96"></a><span id="l93.96"> </span>
<a href="#l93.97"></a><span id="l93.97">   yield true;</span>
<a href="#l93.98"></a><span id="l93.98"> }</span>
<a href="#l93.99"></a><span id="l93.99"> </span>
<a href="#l93.100"></a><span id="l93.100"> // test that 'LIST &quot;&quot; &quot;*&quot; RETURN (SUBSCRIBED)' returns the proper responses</span>
<a href="#l93.101"></a><span id="l93.101"> function* testListReturnSubscribed()</span>
<a href="#l93.102"></a><span id="l93.102"> {</span>
<a href="#l93.103"></a><span id="l93.103">   let response = handler.onError('5', 'LIST &quot;&quot; &quot;*&quot; RETURN (SUBSCRIBED)');</span>
<a href="#l93.104"></a><span id="l93.104"> </span>
<a href="#l93.105"></a><span id="l93.105" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Marked \\NoInferiors \\Subscribed) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.106"></a><span id="l93.106" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l93.107"></a><span id="l93.107" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Apple&quot;'));</span>
<a href="#l93.108"></a><span id="l93.108" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l93.109"></a><span id="l93.109" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.110"></a><span id="l93.110" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.111"></a><span id="l93.111" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.112"></a><span id="l93.112" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l93.113"></a><span id="l93.113" class="difflineminus">-  do_check_false(response.includes('Peach'));</span>
<a href="#l93.114"></a><span id="l93.114" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Marked \\NoInferiors \\Subscribed) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.115"></a><span id="l93.115" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l93.116"></a><span id="l93.116" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Apple&quot;'));</span>
<a href="#l93.117"></a><span id="l93.117" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l93.118"></a><span id="l93.118" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.119"></a><span id="l93.119" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l93.120"></a><span id="l93.120" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.121"></a><span id="l93.121" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l93.122"></a><span id="l93.122" class="difflineplus">+  Assert.ok(!response.includes('Peach'));</span>
<a href="#l93.123"></a><span id="l93.123"> </span>
<a href="#l93.124"></a><span id="l93.124">   yield true;</span>
<a href="#l93.125"></a><span id="l93.125"> }</span>
<a href="#l93.126"></a><span id="l93.126"> </span>
<a href="#l93.127"></a><span id="l93.127"> // test that 'LIST &quot;&quot; (&quot;INBOX&quot; &quot;Tofu&quot; &quot;Vegetable/%&quot;)' returns the proper responses</span>
<a href="#l93.128"></a><span id="l93.128"> function* testListSelectMultiple()</span>
<a href="#l93.129"></a><span id="l93.129"> {</span>
<a href="#l93.130"></a><span id="l93.130">   let response = handler._dispatchCommand('LIST', ['', '(&quot;INBOX&quot; &quot;Tofu&quot; &quot;Vegetable/%&quot;)']);</span>
<a href="#l93.131"></a><span id="l93.131"> </span>
<a href="#l93.132"></a><span id="l93.132" class="difflineminus">-  do_check_true(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.133"></a><span id="l93.133" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.134"></a><span id="l93.134" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.135"></a><span id="l93.135" class="difflineminus">-  do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l93.136"></a><span id="l93.136" class="difflineminus">-  do_check_false(response.includes('&quot;Vegetable&quot;'));</span>
<a href="#l93.137"></a><span id="l93.137" class="difflineminus">-  do_check_false(response.includes('Fruit'));</span>
<a href="#l93.138"></a><span id="l93.138" class="difflineminus">-  do_check_false(response.includes('Peach'));</span>
<a href="#l93.139"></a><span id="l93.139" class="difflineplus">+  Assert.ok(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l93.140"></a><span id="l93.140" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l93.141"></a><span id="l93.141" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l93.142"></a><span id="l93.142" class="difflineplus">+  Assert.ok(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l93.143"></a><span id="l93.143" class="difflineplus">+  Assert.ok(!response.includes('&quot;Vegetable&quot;'));</span>
<a href="#l93.144"></a><span id="l93.144" class="difflineplus">+  Assert.ok(!response.includes('Fruit'));</span>
<a href="#l93.145"></a><span id="l93.145" class="difflineplus">+  Assert.ok(!response.includes('Peach'));</span>
<a href="#l93.146"></a><span id="l93.146"> </span>
<a href="#l93.147"></a><span id="l93.147">   yield true;</span>
<a href="#l93.148"></a><span id="l93.148"> }</span>
<a href="#l93.149"></a><span id="l93.149"> </span>
<a href="#l93.150"></a><span id="l93.150"> // Cleanup at end</span>
<a href="#l93.151"></a><span id="l93.151"> function endTest()</span>
<a href="#l93.152"></a><span id="l93.152"> {</span>
<a href="#l93.153"></a><span id="l93.153">   handler = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/compose/test/unit/head_compose.js</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/compose/test/unit/head_compose.js</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -63,17 +63,17 @@ var test;</span>
<a href="#l94.4"></a><span id="l94.4"> </span>
<a href="#l94.5"></a><span id="l94.5"> function do_check_transaction(real, expected) {</span>
<a href="#l94.6"></a><span id="l94.6">   // real.them may have an extra QUIT on the end, where the stream is only</span>
<a href="#l94.7"></a><span id="l94.7">   // closed after we have a chance to process it and not them. We therefore</span>
<a href="#l94.8"></a><span id="l94.8">   // excise this from the list</span>
<a href="#l94.9"></a><span id="l94.9">   if (real.them[real.them.length-1] == &quot;QUIT&quot;)</span>
<a href="#l94.10"></a><span id="l94.10">     real.them.pop();</span>
<a href="#l94.11"></a><span id="l94.11"> </span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-  do_check_eq(real.them.join(&quot;,&quot;), expected.join(&quot;,&quot;));</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+  Assert.equal(real.them.join(&quot;,&quot;), expected.join(&quot;,&quot;));</span>
<a href="#l94.14"></a><span id="l94.14">   dump(&quot;Passed test &quot; + test + &quot;\n&quot;);</span>
<a href="#l94.15"></a><span id="l94.15"> }</span>
<a href="#l94.16"></a><span id="l94.16"> </span>
<a href="#l94.17"></a><span id="l94.17"> // This listener is designed just to call OnStopCopy() when its OnStopCopy</span>
<a href="#l94.18"></a><span id="l94.18"> // function is called - the rest of the functions are unneeded for a lot of</span>
<a href="#l94.19"></a><span id="l94.19"> // tests (but we can't use asyncCopyListener because we need the</span>
<a href="#l94.20"></a><span id="l94.20"> // nsIMsgSendListener interface as well).</span>
<a href="#l94.21"></a><span id="l94.21"> var copyListener = {</span>
<a href="#l94.22"></a><span id="l94.22" class="difflineat">@@ -190,27 +190,27 @@ function richCreateMessage(fields, attac</span>
<a href="#l94.23"></a><span id="l94.23">                      account ? account.key : &quot;&quot;, null,</span>
<a href="#l94.24"></a><span id="l94.24">                      progress);</span>
<a href="#l94.25"></a><span id="l94.25">   return promise;</span>
<a href="#l94.26"></a><span id="l94.26"> }</span>
<a href="#l94.27"></a><span id="l94.27"> </span>
<a href="#l94.28"></a><span id="l94.28"> function getAttachmentFromContent(aContent) {</span>
<a href="#l94.29"></a><span id="l94.29">   function getBoundaryStringFromContent(aContent) {</span>
<a href="#l94.30"></a><span id="l94.30">     let found = aContent.match(/Content-Type: multipart\/mixed;\s+boundary=&quot;(.*?)&quot;/);</span>
<a href="#l94.31"></a><span id="l94.31" class="difflineminus">-    do_check_neq(found, null);</span>
<a href="#l94.32"></a><span id="l94.32" class="difflineminus">-    do_check_eq(found.length, 2);</span>
<a href="#l94.33"></a><span id="l94.33" class="difflineplus">+    Assert.notEqual(found, null);</span>
<a href="#l94.34"></a><span id="l94.34" class="difflineplus">+    Assert.equal(found.length, 2);</span>
<a href="#l94.35"></a><span id="l94.35"> </span>
<a href="#l94.36"></a><span id="l94.36">     return found[1];</span>
<a href="#l94.37"></a><span id="l94.37">   };</span>
<a href="#l94.38"></a><span id="l94.38"> </span>
<a href="#l94.39"></a><span id="l94.39">   let boundary = getBoundaryStringFromContent(aContent);</span>
<a href="#l94.40"></a><span id="l94.40">   let regex = new RegExp(&quot;\\r\\n\\r\\n--&quot; + boundary + &quot;\\r\\n&quot; +</span>
<a href="#l94.41"></a><span id="l94.41">                          &quot;([\\s\\S]*?)\\r\\n&quot; +</span>
<a href="#l94.42"></a><span id="l94.42">                          &quot;--&quot; + boundary + &quot;--&quot;, &quot;m&quot;);</span>
<a href="#l94.43"></a><span id="l94.43">   let attachments = aContent.match(regex);</span>
<a href="#l94.44"></a><span id="l94.44" class="difflineminus">-  do_check_neq(attachments, null);</span>
<a href="#l94.45"></a><span id="l94.45" class="difflineminus">-  do_check_eq(attachments.length, 2);</span>
<a href="#l94.46"></a><span id="l94.46" class="difflineplus">+  Assert.notEqual(attachments, null);</span>
<a href="#l94.47"></a><span id="l94.47" class="difflineplus">+  Assert.equal(attachments.length, 2);</span>
<a href="#l94.48"></a><span id="l94.48">   return attachments[1];</span>
<a href="#l94.49"></a><span id="l94.49"> }</span>
<a href="#l94.50"></a><span id="l94.50"> </span>
<a href="#l94.51"></a><span id="l94.51"> do_register_cleanup(function() {</span>
<a href="#l94.52"></a><span id="l94.52">   load(gDEPTH + &quot;mailnews/resources/mailShutdown.js&quot;);</span>
<a href="#l94.53"></a><span id="l94.53"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_attachment.js</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_attachment.js</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -75,44 +75,44 @@ var expectedCTList1 = {</span>
<a href="#l95.4"></a><span id="l95.4"> </span>
<a href="#l95.5"></a><span id="l95.5">   RFC2231: 'Content-Type: text/plain; charset=US-ASCII\r\n'</span>
<a href="#l95.6"></a><span id="l95.6"> }</span>
<a href="#l95.7"></a><span id="l95.7"> </span>
<a href="#l95.8"></a><span id="l95.8"> function checkAttachment(expectedCD, expectedCT) {</span>
<a href="#l95.9"></a><span id="l95.9">   let msgData = mailTestUtils</span>
<a href="#l95.10"></a><span id="l95.10">     .loadMessageToString(gDraftFolder, mailTestUtils.firstMsgHdr(gDraftFolder));</span>
<a href="#l95.11"></a><span id="l95.11">   let pos = msgData.indexOf(&quot;Content-Disposition:&quot;);</span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-  do_check_neq(pos, -1);</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+  Assert.notEqual(pos, -1);</span>
<a href="#l95.14"></a><span id="l95.14">   let contentDisposition = msgData.substr(pos);</span>
<a href="#l95.15"></a><span id="l95.15">   pos = 0;</span>
<a href="#l95.16"></a><span id="l95.16">   do {</span>
<a href="#l95.17"></a><span id="l95.17">     pos = contentDisposition.indexOf(&quot;\n&quot;, pos);</span>
<a href="#l95.18"></a><span id="l95.18" class="difflineminus">-    do_check_neq(pos, -1);</span>
<a href="#l95.19"></a><span id="l95.19" class="difflineplus">+    Assert.notEqual(pos, -1);</span>
<a href="#l95.20"></a><span id="l95.20">     pos++;</span>
<a href="#l95.21"></a><span id="l95.21">   } while (contentDisposition.startsWith(&quot; &quot;, pos));</span>
<a href="#l95.22"></a><span id="l95.22">   contentDisposition = contentDisposition.substr(0, pos);</span>
<a href="#l95.23"></a><span id="l95.23" class="difflineminus">-  do_check_eq(contentDisposition, expectedCD);</span>
<a href="#l95.24"></a><span id="l95.24" class="difflineplus">+  Assert.equal(contentDisposition, expectedCD);</span>
<a href="#l95.25"></a><span id="l95.25"> </span>
<a href="#l95.26"></a><span id="l95.26">   pos = msgData.indexOf(&quot;Content-Type:&quot;); // multipart</span>
<a href="#l95.27"></a><span id="l95.27" class="difflineminus">-  do_check_neq(pos, -1);</span>
<a href="#l95.28"></a><span id="l95.28" class="difflineplus">+  Assert.notEqual(pos, -1);</span>
<a href="#l95.29"></a><span id="l95.29">   msgData = msgData.substr(pos + 13);</span>
<a href="#l95.30"></a><span id="l95.30">   pos = msgData.indexOf(&quot;Content-Type:&quot;); // body</span>
<a href="#l95.31"></a><span id="l95.31" class="difflineminus">-  do_check_neq(pos, -1);</span>
<a href="#l95.32"></a><span id="l95.32" class="difflineplus">+  Assert.notEqual(pos, -1);</span>
<a href="#l95.33"></a><span id="l95.33">   msgData = msgData.substr(pos + 13);</span>
<a href="#l95.34"></a><span id="l95.34">   pos = msgData.indexOf(&quot;Content-Type:&quot;); // first attachment</span>
<a href="#l95.35"></a><span id="l95.35" class="difflineminus">-  do_check_neq(pos, -1);</span>
<a href="#l95.36"></a><span id="l95.36" class="difflineplus">+  Assert.notEqual(pos, -1);</span>
<a href="#l95.37"></a><span id="l95.37">   var contentType = msgData.substr(pos);</span>
<a href="#l95.38"></a><span id="l95.38">   pos = 0;</span>
<a href="#l95.39"></a><span id="l95.39">   do {</span>
<a href="#l95.40"></a><span id="l95.40">     pos = contentType.indexOf(&quot;\n&quot;, pos);</span>
<a href="#l95.41"></a><span id="l95.41" class="difflineminus">-    do_check_neq(pos, -1);</span>
<a href="#l95.42"></a><span id="l95.42" class="difflineplus">+    Assert.notEqual(pos, -1);</span>
<a href="#l95.43"></a><span id="l95.43">     pos++;</span>
<a href="#l95.44"></a><span id="l95.44">   } while (contentType.startsWith(&quot; &quot;, pos));</span>
<a href="#l95.45"></a><span id="l95.45">   contentType = contentType.substr(0, pos);</span>
<a href="#l95.46"></a><span id="l95.46" class="difflineminus">-  do_check_eq(contentType, expectedCT);</span>
<a href="#l95.47"></a><span id="l95.47" class="difflineplus">+  Assert.equal(contentType, expectedCT);</span>
<a href="#l95.48"></a><span id="l95.48"> }</span>
<a href="#l95.49"></a><span id="l95.49"> </span>
<a href="#l95.50"></a><span id="l95.50"> function* testInput0() {</span>
<a href="#l95.51"></a><span id="l95.51">   for (let folding in ParamFoldingPref) {</span>
<a href="#l95.52"></a><span id="l95.52">     Services.prefs.setIntPref(&quot;mail.strictly_mime.parm_folding&quot;, ParamFoldingPref[folding]);</span>
<a href="#l95.53"></a><span id="l95.53">     yield createMessage(input0);</span>
<a href="#l95.54"></a><span id="l95.54">     checkAttachment(expectedCD0, expectedCTList0[folding]);</span>
<a href="#l95.55"></a><span id="l95.55">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_attachment_intl.js</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_attachment_intl.js</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -8,27 +8,27 @@ var prettyResult = &quot;\u65e5\u672c\u8a9e.j</span>
<a href="#l96.4"></a><span id="l96.4"> </span>
<a href="#l96.5"></a><span id="l96.5"> function doAttachmentUrlTest() {</span>
<a href="#l96.6"></a><span id="l96.6">   // handles non-ascii url in nsIMsgAttachment</span>
<a href="#l96.7"></a><span id="l96.7"> </span>
<a href="#l96.8"></a><span id="l96.8">   var attachment = Cc[&quot;@mozilla.org/messengercompose/attachment;1&quot;]</span>
<a href="#l96.9"></a><span id="l96.9">                      .createInstance(Ci.nsIMsgAttachment);</span>
<a href="#l96.10"></a><span id="l96.10">   attachment.url = nonAsciiUrl;</span>
<a href="#l96.11"></a><span id="l96.11"> </span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-  do_check_eq(attachment.url, nonAsciiUrl);</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+  Assert.equal(attachment.url, nonAsciiUrl);</span>
<a href="#l96.14"></a><span id="l96.14"> }</span>
<a href="#l96.15"></a><span id="l96.15"> </span>
<a href="#l96.16"></a><span id="l96.16"> function doPrettyNameTest() {</span>
<a href="#l96.17"></a><span id="l96.17">   // handles non-ascii url in nsIMsgCompose</span>
<a href="#l96.18"></a><span id="l96.18"> </span>
<a href="#l96.19"></a><span id="l96.19">   var msgCompose = Cc[&quot;@mozilla.org/messengercompose/compose;1&quot;]</span>
<a href="#l96.20"></a><span id="l96.20">                      .createInstance(Ci.nsIMsgCompose);</span>
<a href="#l96.21"></a><span id="l96.21"> </span>
<a href="#l96.22"></a><span id="l96.22" class="difflineminus">-  do_check_eq(msgCompose.AttachmentPrettyName(nonAsciiUrl, null),</span>
<a href="#l96.23"></a><span id="l96.23" class="difflineminus">-              prettyResult);</span>
<a href="#l96.24"></a><span id="l96.24" class="difflineplus">+  Assert.equal(msgCompose.AttachmentPrettyName(nonAsciiUrl, null),</span>
<a href="#l96.25"></a><span id="l96.25" class="difflineplus">+               prettyResult);</span>
<a href="#l96.26"></a><span id="l96.26"> }</span>
<a href="#l96.27"></a><span id="l96.27"> </span>
<a href="#l96.28"></a><span id="l96.28"> function run_test() {</span>
<a href="#l96.29"></a><span id="l96.29">   doAttachmentUrlTest();</span>
<a href="#l96.30"></a><span id="l96.30">   doPrettyNameTest();</span>
<a href="#l96.31"></a><span id="l96.31"> </span>
<a href="#l96.32"></a><span id="l96.32">   do_test_finished();</span>
<a href="#l96.33"></a><span id="l96.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_autoReply.js</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_autoReply.js</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -152,20 +152,20 @@ function testReply(aHrdIdx, aTemplateHdr</span>
<a href="#l97.4"></a><span id="l97.4">                        &quot;&amp;subject=&quot; + templateHdr.mime2DecodedSubject;</span>
<a href="#l97.5"></a><span id="l97.5">   MailServices.compose.replyWithTemplate(msgHdr, msgTemplateUri, null,</span>
<a href="#l97.6"></a><span id="l97.6">     localAccountUtils.incomingServer);</span>
<a href="#l97.7"></a><span id="l97.7">   gServer.performTest();</span>
<a href="#l97.8"></a><span id="l97.8"> </span>
<a href="#l97.9"></a><span id="l97.9">   let headers, body;</span>
<a href="#l97.10"></a><span id="l97.10">   [headers, body] = MimeParser.extractHeadersAndBody(gServer._daemon.post);</span>
<a href="#l97.11"></a><span id="l97.11">   //dump(&quot;xxxmagnus gServer._daemon.post=&quot; + gServer._daemon.post + &quot;\n&quot;);</span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-  do_check_true(headers.get(&quot;Subject&quot;).startsWith(&quot;Auto: &quot;));</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineminus">-  do_check_eq(headers.get(&quot;Auto-submitted&quot;), &quot;auto-replied&quot;);</span>
<a href="#l97.14"></a><span id="l97.14" class="difflineminus">-  do_check_eq(headers.get(&quot;In-Reply-To&quot;), &quot;&lt;&quot; + msgHdr.messageId + &quot;&gt;&quot;);</span>
<a href="#l97.15"></a><span id="l97.15" class="difflineminus">-  do_check_eq(headers.get(&quot;References&quot;), &quot;&lt;&quot; + msgHdr.messageId + &quot;&gt;&quot;);</span>
<a href="#l97.16"></a><span id="l97.16" class="difflineplus">+  Assert.ok(headers.get(&quot;Subject&quot;).startsWith(&quot;Auto: &quot;));</span>
<a href="#l97.17"></a><span id="l97.17" class="difflineplus">+  Assert.equal(headers.get(&quot;Auto-submitted&quot;), &quot;auto-replied&quot;);</span>
<a href="#l97.18"></a><span id="l97.18" class="difflineplus">+  Assert.equal(headers.get(&quot;In-Reply-To&quot;), &quot;&lt;&quot; + msgHdr.messageId + &quot;&gt;&quot;);</span>
<a href="#l97.19"></a><span id="l97.19" class="difflineplus">+  Assert.equal(headers.get(&quot;References&quot;), &quot;&lt;&quot; + msgHdr.messageId + &quot;&gt;&quot;);</span>
<a href="#l97.20"></a><span id="l97.20">   // XXX: something's wrong with how the fake server gets the data.</span>
<a href="#l97.21"></a><span id="l97.21">   // The text gets converted to UTF-8 (regardless of what it is) at some point.</span>
<a href="#l97.22"></a><span id="l97.22">   // Suspect a bug with how BinaryInputStream handles the strings.</span>
<a href="#l97.23"></a><span id="l97.23">   if (templateHdr.Charset == &quot;windows-1252&quot;) {</span>
<a href="#l97.24"></a><span id="l97.24">     // XXX: should really check for &quot;��� åäö&quot;</span>
<a href="#l97.25"></a><span id="l97.25">     if (!body.includes(&quot;åäö xlatin1&quot;)) { // template-latin1 contains this</span>
<a href="#l97.26"></a><span id="l97.26">       do_throw(&quot;latin1 body didn't go through!  hdr msgid=&quot; +</span>
<a href="#l97.27"></a><span id="l97.27">                templateHdr.messageId + &quot;, msgbody=&quot; + body);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_bug235432.js</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_bug235432.js</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -90,17 +90,17 @@ function createExpectedTemporaryFile() {</span>
<a href="#l98.4"></a><span id="l98.4">   expectedFile.remove(false);</span>
<a href="#l98.5"></a><span id="l98.5"> </span>
<a href="#l98.6"></a><span id="l98.6">   return expectedFile;</span>
<a href="#l98.7"></a><span id="l98.7"> }</span>
<a href="#l98.8"></a><span id="l98.8"> </span>
<a href="#l98.9"></a><span id="l98.9"> function OnStopCopy(aStatus) {</span>
<a href="#l98.10"></a><span id="l98.10">   msgSend.abort();</span>
<a href="#l98.11"></a><span id="l98.11"> </span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-  do_check_false(expectedTemporaryFile.exists());</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+  Assert.ok(!expectedTemporaryFile.exists());</span>
<a href="#l98.14"></a><span id="l98.14"> </span>
<a href="#l98.15"></a><span id="l98.15">   do_test_finished();</span>
<a href="#l98.16"></a><span id="l98.16"> }</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18"> function run_test() {</span>
<a href="#l98.19"></a><span id="l98.19">   do_test_pending();</span>
<a href="#l98.20"></a><span id="l98.20">   copyFileMessageInLocalFolder(testmail, 0, &quot;&quot;, null, send_message_later);</span>
<a href="#l98.21"></a><span id="l98.21"> }</span>
<a href="#l98.22"></a><span id="l98.22" class="difflineat">@@ -144,10 +144,10 @@ function send_message_later(aMessageHead</span>
<a href="#l98.23"></a><span id="l98.23">                                null,</span>
<a href="#l98.24"></a><span id="l98.24">                                null,</span>
<a href="#l98.25"></a><span id="l98.25">                                null,</span>
<a href="#l98.26"></a><span id="l98.26">                                null,</span>
<a href="#l98.27"></a><span id="l98.27">                                copyListener,</span>
<a href="#l98.28"></a><span id="l98.28">                                null,</span>
<a href="#l98.29"></a><span id="l98.29">                                &quot;&quot;,</span>
<a href="#l98.30"></a><span id="l98.30">                                Ci.nsIMsgCompType.New);</span>
<a href="#l98.31"></a><span id="l98.31" class="difflineminus">-  do_check_true(expectedTemporaryFile.exists());</span>
<a href="#l98.32"></a><span id="l98.32" class="difflineplus">+  Assert.ok(expectedTemporaryFile.exists());</span>
<a href="#l98.33"></a><span id="l98.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_bug474774.js</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_bug474774.js</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -28,46 +28,46 @@ function msll() {</span>
<a href="#l99.4"></a><span id="l99.4"> }</span>
<a href="#l99.5"></a><span id="l99.5"> </span>
<a href="#l99.6"></a><span id="l99.6"> msll.prototype = {</span>
<a href="#l99.7"></a><span id="l99.7">   _initialTotal: 0,</span>
<a href="#l99.8"></a><span id="l99.8"> </span>
<a href="#l99.9"></a><span id="l99.9">   // nsIMsgSendLaterListener</span>
<a href="#l99.10"></a><span id="l99.10">   onStartSending: function (aTotalMessageCount) {</span>
<a href="#l99.11"></a><span id="l99.11">     this._initialTotal = 1;</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, true);</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, true);</span>
<a href="#l99.14"></a><span id="l99.14">   },</span>
<a href="#l99.15"></a><span id="l99.15">   onMessageStartSending: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l99.16"></a><span id="l99.16">                                    aMessageHeader, aIdentity) {</span>
<a href="#l99.17"></a><span id="l99.17">   },</span>
<a href="#l99.18"></a><span id="l99.18">   onMessageSendProgress: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l99.19"></a><span id="l99.19">                                    aMessageSendPercent, aMessageCopyPercent) {</span>
<a href="#l99.20"></a><span id="l99.20">     // XXX Enable this function</span>
<a href="#l99.21"></a><span id="l99.21">   },</span>
<a href="#l99.22"></a><span id="l99.22">   onMessageSendError: function (aCurrentMessage, aMessageHeader, aStatus,</span>
<a href="#l99.23"></a><span id="l99.23">                                 aMsg) {</span>
<a href="#l99.24"></a><span id="l99.24">     do_throw(&quot;onMessageSendError should not have been called, status: &quot; + aStatus);</span>
<a href="#l99.25"></a><span id="l99.25">   },</span>
<a href="#l99.26"></a><span id="l99.26">   onStopSending: function (aStatus, aMsg, aTotalTried, aSuccessful) {</span>
<a href="#l99.27"></a><span id="l99.27">     print(&quot;msll onStopSending\n&quot;);</span>
<a href="#l99.28"></a><span id="l99.28">     try {</span>
<a href="#l99.29"></a><span id="l99.29" class="difflineminus">-      do_check_eq(aSuccessful, 1);</span>
<a href="#l99.30"></a><span id="l99.30" class="difflineminus">-      do_check_eq(aStatus, 0);</span>
<a href="#l99.31"></a><span id="l99.31" class="difflineminus">-      do_check_eq(aTotalTried, 1);</span>
<a href="#l99.32"></a><span id="l99.32" class="difflineminus">-      do_check_eq(this._initialTotal, 1);</span>
<a href="#l99.33"></a><span id="l99.33" class="difflineminus">-      do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l99.34"></a><span id="l99.34" class="difflineplus">+      Assert.equal(aSuccessful, 1);</span>
<a href="#l99.35"></a><span id="l99.35" class="difflineplus">+      Assert.equal(aStatus, 0);</span>
<a href="#l99.36"></a><span id="l99.36" class="difflineplus">+      Assert.equal(aTotalTried, 1);</span>
<a href="#l99.37"></a><span id="l99.37" class="difflineplus">+      Assert.equal(this._initialTotal, 1);</span>
<a href="#l99.38"></a><span id="l99.38" class="difflineplus">+      Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l99.39"></a><span id="l99.39"> </span>
<a href="#l99.40"></a><span id="l99.40">       do_check_transaction(server.playTransaction(),</span>
<a href="#l99.41"></a><span id="l99.41">                            [&quot;EHLO test&quot;,</span>
<a href="#l99.42"></a><span id="l99.42">                             &quot;MAIL FROM:&lt;&quot; + kSender + &quot;&gt; BODY=8BITMIME SIZE=&quot; + originalData.length,</span>
<a href="#l99.43"></a><span id="l99.43">                             &quot;RCPT TO:&lt;&quot; + kTo + &quot;&gt;&quot;,</span>
<a href="#l99.44"></a><span id="l99.44">                             &quot;DATA&quot;]);</span>
<a href="#l99.45"></a><span id="l99.45"> </span>
<a href="#l99.46"></a><span id="l99.46">       // Compare data file to what the server received</span>
<a href="#l99.47"></a><span id="l99.47" class="difflineminus">-      do_check_eq(originalData, server._daemon.post);</span>
<a href="#l99.48"></a><span id="l99.48" class="difflineplus">+      Assert.equal(originalData, server._daemon.post);</span>
<a href="#l99.49"></a><span id="l99.49"> </span>
<a href="#l99.50"></a><span id="l99.50">       // Now wait till the copy is finished for the sent message</span>
<a href="#l99.51"></a><span id="l99.51">       do_test_pending();</span>
<a href="#l99.52"></a><span id="l99.52">     } catch (e) {</span>
<a href="#l99.53"></a><span id="l99.53">       do_throw(e);</span>
<a href="#l99.54"></a><span id="l99.54">     } finally {</span>
<a href="#l99.55"></a><span id="l99.55">       server.stop();</span>
<a href="#l99.56"></a><span id="l99.56"> </span>
<a href="#l99.57"></a><span id="l99.57" class="difflineat">@@ -79,38 +79,38 @@ msll.prototype = {</span>
<a href="#l99.58"></a><span id="l99.58">   }</span>
<a href="#l99.59"></a><span id="l99.59"> };</span>
<a href="#l99.60"></a><span id="l99.60"> </span>
<a href="#l99.61"></a><span id="l99.61"> function OnStopCopy(aStatus)</span>
<a href="#l99.62"></a><span id="l99.62"> {</span>
<a href="#l99.63"></a><span id="l99.63">   do_test_finished();</span>
<a href="#l99.64"></a><span id="l99.64"> </span>
<a href="#l99.65"></a><span id="l99.65">   try {</span>
<a href="#l99.66"></a><span id="l99.66" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l99.67"></a><span id="l99.67" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l99.68"></a><span id="l99.68"> </span>
<a href="#l99.69"></a><span id="l99.69">     // Check this is false before we start sending</span>
<a href="#l99.70"></a><span id="l99.70" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l99.71"></a><span id="l99.71" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l99.72"></a><span id="l99.72"> </span>
<a href="#l99.73"></a><span id="l99.73">     let folder = msgSendLater.getUnsentMessagesFolder(identity);</span>
<a href="#l99.74"></a><span id="l99.74"> </span>
<a href="#l99.75"></a><span id="l99.75">     // Check we have a message in the unsent message folder</span>
<a href="#l99.76"></a><span id="l99.76" class="difflineminus">-    do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l99.77"></a><span id="l99.77" class="difflineplus">+    Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l99.78"></a><span id="l99.78"> </span>
<a href="#l99.79"></a><span id="l99.79">     // Now do a comparison of what is in the sent mail folder</span>
<a href="#l99.80"></a><span id="l99.80">     let msgData = mailTestUtils</span>
<a href="#l99.81"></a><span id="l99.81">       .loadMessageToString(folder, mailTestUtils.firstMsgHdr(folder));</span>
<a href="#l99.82"></a><span id="l99.82"> </span>
<a href="#l99.83"></a><span id="l99.83">     // Skip the headers etc that mailnews adds</span>
<a href="#l99.84"></a><span id="l99.84">     var pos = msgData.indexOf(&quot;From:&quot;);</span>
<a href="#l99.85"></a><span id="l99.85" class="difflineminus">-    do_check_neq(pos, -1);</span>
<a href="#l99.86"></a><span id="l99.86" class="difflineplus">+    Assert.notEqual(pos, -1);</span>
<a href="#l99.87"></a><span id="l99.87"> </span>
<a href="#l99.88"></a><span id="l99.88">     msgData = msgData.substr(pos);</span>
<a href="#l99.89"></a><span id="l99.89"> </span>
<a href="#l99.90"></a><span id="l99.90">     // Check the data is matching.</span>
<a href="#l99.91"></a><span id="l99.91" class="difflineminus">-    do_check_eq(originalData, msgData);</span>
<a href="#l99.92"></a><span id="l99.92" class="difflineplus">+    Assert.equal(originalData, msgData);</span>
<a href="#l99.93"></a><span id="l99.93"> </span>
<a href="#l99.94"></a><span id="l99.94">     do_test_pending();</span>
<a href="#l99.95"></a><span id="l99.95">     sendMessageLater();</span>
<a href="#l99.96"></a><span id="l99.96">   } catch (e) {</span>
<a href="#l99.97"></a><span id="l99.97">     do_throw(e);</span>
<a href="#l99.98"></a><span id="l99.98">   } finally {</span>
<a href="#l99.99"></a><span id="l99.99">     server.stop();</span>
<a href="#l99.100"></a><span id="l99.100"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_detectAttachmentCharset.js</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_detectAttachmentCharset.js</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -6,23 +6,23 @@</span>
<a href="#l100.4"></a><span id="l100.4"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l100.5"></a><span id="l100.5"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l100.6"></a><span id="l100.6"> </span>
<a href="#l100.7"></a><span id="l100.7"> function checkAttachmentCharset(expectedCharset) {</span>
<a href="#l100.8"></a><span id="l100.8">   let msgData = mailTestUtils</span>
<a href="#l100.9"></a><span id="l100.9">     .loadMessageToString(gDraftFolder, mailTestUtils.firstMsgHdr(gDraftFolder));</span>
<a href="#l100.10"></a><span id="l100.10">   let attachmentData = getAttachmentFromContent(msgData);</span>
<a href="#l100.11"></a><span id="l100.11"> </span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-  do_check_eq(expectedCharset, getContentCharset(attachmentData));</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineplus">+  Assert.equal(expectedCharset, getContentCharset(attachmentData));</span>
<a href="#l100.14"></a><span id="l100.14"> }</span>
<a href="#l100.15"></a><span id="l100.15"> </span>
<a href="#l100.16"></a><span id="l100.16"> function getContentCharset(aContent) {</span>
<a href="#l100.17"></a><span id="l100.17">   let found = aContent.match(/^Content-Type: text\/plain; charset=(.*?);/);</span>
<a href="#l100.18"></a><span id="l100.18">   if (found) {</span>
<a href="#l100.19"></a><span id="l100.19" class="difflineminus">-    do_check_eq(found.length, 2);</span>
<a href="#l100.20"></a><span id="l100.20" class="difflineplus">+    Assert.equal(found.length, 2);</span>
<a href="#l100.21"></a><span id="l100.21">     return found[1];</span>
<a href="#l100.22"></a><span id="l100.22">   }</span>
<a href="#l100.23"></a><span id="l100.23">   return null;</span>
<a href="#l100.24"></a><span id="l100.24"> }</span>
<a href="#l100.25"></a><span id="l100.25"> </span>
<a href="#l100.26"></a><span id="l100.26"> function *testUTF8() {</span>
<a href="#l100.27"></a><span id="l100.27">   yield createMessage(do_get_file(&quot;data/test-UTF-8.txt&quot;));</span>
<a href="#l100.28"></a><span id="l100.28">   checkAttachmentCharset(&quot;UTF-8&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_longLines.js</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_longLines.js</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -36,46 +36,46 @@ function checkDraftHeadersAndBody(expect</span>
<a href="#l101.4"></a><span id="l101.4"> </span>
<a href="#l101.5"></a><span id="l101.5">   // Remove line breaks and decode from base64 if required.</span>
<a href="#l101.6"></a><span id="l101.6">   if (expectedHeaders[&quot;Content-Transfer-Encoding&quot;] == &quot;base64&quot;)</span>
<a href="#l101.7"></a><span id="l101.7">     body = atob(body.replace(/\r\n/g, &quot;&quot;));</span>
<a href="#l101.8"></a><span id="l101.8"> </span>
<a href="#l101.9"></a><span id="l101.9">   if (charset == &quot;UTF-8&quot;) {</span>
<a href="#l101.10"></a><span id="l101.10">     let expectedBinary = String.fromCharCode.apply(undefined,</span>
<a href="#l101.11"></a><span id="l101.11">       new TextEncoder(&quot;UTF-8&quot;).encode(expectedBody));</span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-    do_check_eq(body, expectedBinary);</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineplus">+    Assert.equal(body, expectedBinary);</span>
<a href="#l101.14"></a><span id="l101.14">   } else {</span>
<a href="#l101.15"></a><span id="l101.15">     let strView = stringToTypedArray(body);</span>
<a href="#l101.16"></a><span id="l101.16">     let decodedBody = new TextDecoder(charset).decode(strView);</span>
<a href="#l101.17"></a><span id="l101.17" class="difflineminus">-    do_check_eq(decodedBody, expectedBody);</span>
<a href="#l101.18"></a><span id="l101.18" class="difflineplus">+    Assert.equal(decodedBody, expectedBody);</span>
<a href="#l101.19"></a><span id="l101.19">   }</span>
<a href="#l101.20"></a><span id="l101.20"> }</span>
<a href="#l101.21"></a><span id="l101.21"> </span>
<a href="#l101.22"></a><span id="l101.22"> function checkMessageHeaders(msgData, expectedHeaders, partNum = &quot;&quot;) {</span>
<a href="#l101.23"></a><span id="l101.23">   let seen = false;</span>
<a href="#l101.24"></a><span id="l101.24">   let handler = {</span>
<a href="#l101.25"></a><span id="l101.25">     startPart: function (part, headers) {</span>
<a href="#l101.26"></a><span id="l101.26">       if (part != partNum)</span>
<a href="#l101.27"></a><span id="l101.27">         return;</span>
<a href="#l101.28"></a><span id="l101.28">       seen = true;</span>
<a href="#l101.29"></a><span id="l101.29">       for (let header in expectedHeaders) {</span>
<a href="#l101.30"></a><span id="l101.30">         let expected = expectedHeaders[header];</span>
<a href="#l101.31"></a><span id="l101.31">         if (expected === undefined)</span>
<a href="#l101.32"></a><span id="l101.32" class="difflineminus">-          do_check_false(headers.has(header));</span>
<a href="#l101.33"></a><span id="l101.33" class="difflineplus">+          Assert.ok(!headers.has(header));</span>
<a href="#l101.34"></a><span id="l101.34">         else {</span>
<a href="#l101.35"></a><span id="l101.35">           let value = headers.getRawHeader(header);</span>
<a href="#l101.36"></a><span id="l101.36" class="difflineminus">-          do_check_eq(value.length, 1);</span>
<a href="#l101.37"></a><span id="l101.37" class="difflineplus">+          Assert.equal(value.length, 1);</span>
<a href="#l101.38"></a><span id="l101.38">           value[0] = value[0].replace(/boundary=[^;]*(;|$)/, &quot;boundary=.&quot;);</span>
<a href="#l101.39"></a><span id="l101.39" class="difflineminus">-          do_check_eq(value[0], expected);</span>
<a href="#l101.40"></a><span id="l101.40" class="difflineplus">+          Assert.equal(value[0], expected);</span>
<a href="#l101.41"></a><span id="l101.41">         }</span>
<a href="#l101.42"></a><span id="l101.42">       }</span>
<a href="#l101.43"></a><span id="l101.43">     }</span>
<a href="#l101.44"></a><span id="l101.44">   };</span>
<a href="#l101.45"></a><span id="l101.45">   MimeParser.parseSync(msgData, handler, {onerror: function (e) { throw e; }});</span>
<a href="#l101.46"></a><span id="l101.46" class="difflineminus">-  do_check_true(seen);</span>
<a href="#l101.47"></a><span id="l101.47" class="difflineplus">+  Assert.ok(seen);</span>
<a href="#l101.48"></a><span id="l101.48"> }</span>
<a href="#l101.49"></a><span id="l101.49"> </span>
<a href="#l101.50"></a><span id="l101.50"> // Create a line with 600 letters 'a' with acute accent, encoded as</span>
<a href="#l101.51"></a><span id="l101.51"> // two bytes c3a1 in UTF-8.</span>
<a href="#l101.52"></a><span id="l101.52"> let longMultibyteLine = &quot;\u00E1&quot;.repeat(600);</span>
<a href="#l101.53"></a><span id="l101.53"> </span>
<a href="#l101.54"></a><span id="l101.54"> // And here a line with a Korean character, encoded as three bytes</span>
<a href="#l101.55"></a><span id="l101.55"> // ec9588 in UTF-8.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_mailtoURL.js</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_mailtoURL.js</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -12,45 +12,45 @@ function run_test() {</span>
<a href="#l102.4"></a><span id="l102.4">   function test(aTest) {</span>
<a href="#l102.5"></a><span id="l102.5">     var uri = Services.io.newURI(aTest.url);</span>
<a href="#l102.6"></a><span id="l102.6">     uri = uri.QueryInterface(Components.interfaces.nsIMailtoUrl);</span>
<a href="#l102.7"></a><span id="l102.7"> </span>
<a href="#l102.8"></a><span id="l102.8">     var to = {}, cc = {}, bcc = {}, subject = {}, body = {}, html = {},</span>
<a href="#l102.9"></a><span id="l102.9">         reference = {}, newsgroup = {}, composeformat = {};</span>
<a href="#l102.10"></a><span id="l102.10">     uri.getMessageContents(to, cc, bcc, subject, body, html, reference,</span>
<a href="#l102.11"></a><span id="l102.11">                            newsgroup, composeformat);</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-    do_check_eq(aTest.to, to.value);</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineminus">-    do_check_eq(aTest.cc, cc.value);</span>
<a href="#l102.14"></a><span id="l102.14" class="difflineminus">-    do_check_eq(aTest.bcc, bcc.value);</span>
<a href="#l102.15"></a><span id="l102.15" class="difflineminus">-    do_check_eq(aTest.subject, subject.value);</span>
<a href="#l102.16"></a><span id="l102.16" class="difflineminus">-    do_check_eq(aTest.body, body.value);</span>
<a href="#l102.17"></a><span id="l102.17" class="difflineminus">-    do_check_eq(aTest.html, html.value);</span>
<a href="#l102.18"></a><span id="l102.18" class="difflineminus">-    do_check_eq(aTest.reference, reference.value);</span>
<a href="#l102.19"></a><span id="l102.19" class="difflineminus">-    do_check_eq(aTest.newsgroup, newsgroup.value);</span>
<a href="#l102.20"></a><span id="l102.20" class="difflineminus">-    do_check_eq(aTest.composeformat, composeformat.value);</span>
<a href="#l102.21"></a><span id="l102.21" class="difflineminus">-    do_check_eq(aTest.from, uri.fromPart);</span>
<a href="#l102.22"></a><span id="l102.22" class="difflineminus">-    do_check_eq(aTest.followupto, uri.followUpToPart);</span>
<a href="#l102.23"></a><span id="l102.23" class="difflineminus">-    do_check_eq(aTest.organization, uri.organizationPart);</span>
<a href="#l102.24"></a><span id="l102.24" class="difflineminus">-    do_check_eq(aTest.replyto, uri.replyToPart);</span>
<a href="#l102.25"></a><span id="l102.25" class="difflineminus">-    do_check_eq(aTest.priority, uri.priorityPart);</span>
<a href="#l102.26"></a><span id="l102.26" class="difflineminus">-    do_check_eq(aTest.newshost, uri.newsHostPart);</span>
<a href="#l102.27"></a><span id="l102.27" class="difflineminus">-    do_check_true(uri.equals(uri));</span>
<a href="#l102.28"></a><span id="l102.28" class="difflineplus">+    Assert.equal(aTest.to, to.value);</span>
<a href="#l102.29"></a><span id="l102.29" class="difflineplus">+    Assert.equal(aTest.cc, cc.value);</span>
<a href="#l102.30"></a><span id="l102.30" class="difflineplus">+    Assert.equal(aTest.bcc, bcc.value);</span>
<a href="#l102.31"></a><span id="l102.31" class="difflineplus">+    Assert.equal(aTest.subject, subject.value);</span>
<a href="#l102.32"></a><span id="l102.32" class="difflineplus">+    Assert.equal(aTest.body, body.value);</span>
<a href="#l102.33"></a><span id="l102.33" class="difflineplus">+    Assert.equal(aTest.html, html.value);</span>
<a href="#l102.34"></a><span id="l102.34" class="difflineplus">+    Assert.equal(aTest.reference, reference.value);</span>
<a href="#l102.35"></a><span id="l102.35" class="difflineplus">+    Assert.equal(aTest.newsgroup, newsgroup.value);</span>
<a href="#l102.36"></a><span id="l102.36" class="difflineplus">+    Assert.equal(aTest.composeformat, composeformat.value);</span>
<a href="#l102.37"></a><span id="l102.37" class="difflineplus">+    Assert.equal(aTest.from, uri.fromPart);</span>
<a href="#l102.38"></a><span id="l102.38" class="difflineplus">+    Assert.equal(aTest.followupto, uri.followUpToPart);</span>
<a href="#l102.39"></a><span id="l102.39" class="difflineplus">+    Assert.equal(aTest.organization, uri.organizationPart);</span>
<a href="#l102.40"></a><span id="l102.40" class="difflineplus">+    Assert.equal(aTest.replyto, uri.replyToPart);</span>
<a href="#l102.41"></a><span id="l102.41" class="difflineplus">+    Assert.equal(aTest.priority, uri.priorityPart);</span>
<a href="#l102.42"></a><span id="l102.42" class="difflineplus">+    Assert.equal(aTest.newshost, uri.newsHostPart);</span>
<a href="#l102.43"></a><span id="l102.43" class="difflineplus">+    Assert.ok(uri.equals(uri));</span>
<a href="#l102.44"></a><span id="l102.44">   }</span>
<a href="#l102.45"></a><span id="l102.45"> </span>
<a href="#l102.46"></a><span id="l102.46">   for (var i = 0; i &lt; tests.length; i++)</span>
<a href="#l102.47"></a><span id="l102.47">     test(tests[i]);</span>
<a href="#l102.48"></a><span id="l102.48"> </span>
<a href="#l102.49"></a><span id="l102.49">   // Test cloning reparses the url by checking the to field.</span>
<a href="#l102.50"></a><span id="l102.50">   let uriToClone = Services.io.newURI(tests[0].url);</span>
<a href="#l102.51"></a><span id="l102.51">   let clonedUrl = uriToClone.clone().QueryInterface(Components.interfaces.nsIMailtoUrl);</span>
<a href="#l102.52"></a><span id="l102.52">   var to = {}, cc = {}, bcc = {}, subject = {}, body = {}, html = {},</span>
<a href="#l102.53"></a><span id="l102.53">       reference = {}, newsgroup = {}, composeformat = {};</span>
<a href="#l102.54"></a><span id="l102.54">   clonedUrl.getMessageContents(to, cc, bcc, subject, body, html, reference,</span>
<a href="#l102.55"></a><span id="l102.55">                                newsgroup, composeformat);</span>
<a href="#l102.56"></a><span id="l102.56" class="difflineminus">-  do_check_eq(to.value, tests[0].to);</span>
<a href="#l102.57"></a><span id="l102.57" class="difflineplus">+  Assert.equal(to.value, tests[0].to);</span>
<a href="#l102.58"></a><span id="l102.58"> };</span>
<a href="#l102.59"></a><span id="l102.59"> </span>
<a href="#l102.60"></a><span id="l102.60"> var tests = [</span>
<a href="#l102.61"></a><span id="l102.61">   {</span>
<a href="#l102.62"></a><span id="l102.62">     url: &quot;mailto:one@example.com&quot;,</span>
<a href="#l102.63"></a><span id="l102.63">     to: &quot;one@example.com&quot;,</span>
<a href="#l102.64"></a><span id="l102.64">     cc: &quot;&quot;,</span>
<a href="#l102.65"></a><span id="l102.65">     bcc: &quot;&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_messageHeaders.js</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_messageHeaders.js</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -58,28 +58,28 @@ function checkMessageHeaders(msgData, ex</span>
<a href="#l103.4"></a><span id="l103.4">   let handler = {</span>
<a href="#l103.5"></a><span id="l103.5">     startPart: function (part, headers) {</span>
<a href="#l103.6"></a><span id="l103.6">       if (part != partNum)</span>
<a href="#l103.7"></a><span id="l103.7">         return;</span>
<a href="#l103.8"></a><span id="l103.8">       seen = true;</span>
<a href="#l103.9"></a><span id="l103.9">       for (let header in expectedHeaders) {</span>
<a href="#l103.10"></a><span id="l103.10">         let expected = expectedHeaders[header];</span>
<a href="#l103.11"></a><span id="l103.11">         if (expected === undefined)</span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-          do_check_false(headers.has(header));</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineplus">+          Assert.ok(!headers.has(header));</span>
<a href="#l103.14"></a><span id="l103.14">         else {</span>
<a href="#l103.15"></a><span id="l103.15">           let value = headers.getRawHeader(header);</span>
<a href="#l103.16"></a><span id="l103.16" class="difflineminus">-          do_check_eq(value.length, 1);</span>
<a href="#l103.17"></a><span id="l103.17" class="difflineplus">+          Assert.equal(value.length, 1);</span>
<a href="#l103.18"></a><span id="l103.18">           value[0] = value[0].replace(/boundary=[^;]*(;|$)/, &quot;boundary=.&quot;);</span>
<a href="#l103.19"></a><span id="l103.19" class="difflineminus">-          do_check_eq(value[0], expected);</span>
<a href="#l103.20"></a><span id="l103.20" class="difflineplus">+          Assert.equal(value[0], expected);</span>
<a href="#l103.21"></a><span id="l103.21">         }</span>
<a href="#l103.22"></a><span id="l103.22">       }</span>
<a href="#l103.23"></a><span id="l103.23">     }</span>
<a href="#l103.24"></a><span id="l103.24">   };</span>
<a href="#l103.25"></a><span id="l103.25">   MimeParser.parseSync(msgData, handler, {onerror: function (e) { throw e; }});</span>
<a href="#l103.26"></a><span id="l103.26" class="difflineminus">-  do_check_true(seen);</span>
<a href="#l103.27"></a><span id="l103.27" class="difflineplus">+  Assert.ok(seen);</span>
<a href="#l103.28"></a><span id="l103.28"> }</span>
<a href="#l103.29"></a><span id="l103.29"> </span>
<a href="#l103.30"></a><span id="l103.30"> function* testEnvelope() {</span>
<a href="#l103.31"></a><span id="l103.31">   let fields = new CompFields();</span>
<a href="#l103.32"></a><span id="l103.32">   let identity = getSmtpIdentity(&quot;from@tinderbox.invalid&quot;,</span>
<a href="#l103.33"></a><span id="l103.33">     getBasicSmtpServer());</span>
<a href="#l103.34"></a><span id="l103.34">   identity.fullName = &quot;Me&quot;;</span>
<a href="#l103.35"></a><span id="l103.35">   identity.organization = &quot;World Destruction Committee&quot;;</span>
<a href="#l103.36"></a><span id="l103.36" class="difflineat">@@ -220,19 +220,19 @@ function* testOtherHeaders() {</span>
<a href="#l103.37"></a><span id="l103.37">     &quot;X-Priority&quot;: &quot;2 (High)&quot;,</span>
<a href="#l103.38"></a><span id="l103.38">     &quot;References&quot;: &quot;&lt;fake@tinderbox.invalid&gt; &lt;more@test.invalid&gt;&quot;,</span>
<a href="#l103.39"></a><span id="l103.39">     &quot;In-Reply-To&quot;: &quot;&lt;more@test.invalid&gt;&quot;,</span>
<a href="#l103.40"></a><span id="l103.40">     &quot;X-Fake-Header&quot;: &quot;124&quot;,</span>
<a href="#l103.41"></a><span id="l103.41">   });</span>
<a href="#l103.42"></a><span id="l103.42"> </span>
<a href="#l103.43"></a><span id="l103.43">   // Check headers with dynamic content</span>
<a href="#l103.44"></a><span id="l103.44">   let headers = MimeParser.extractHeaders(msgData);</span>
<a href="#l103.45"></a><span id="l103.45" class="difflineminus">-  do_check_true(headers.has(&quot;Message-Id&quot;));</span>
<a href="#l103.46"></a><span id="l103.46" class="difflineminus">-  do_check_true(headers.getRawHeader(&quot;Message-Id&quot;)[0]</span>
<a href="#l103.47"></a><span id="l103.47" class="difflineminus">-                       .endsWith(&quot;@tinderbox.invalid&gt;&quot;));</span>
<a href="#l103.48"></a><span id="l103.48" class="difflineplus">+  Assert.ok(headers.has(&quot;Message-Id&quot;));</span>
<a href="#l103.49"></a><span id="l103.49" class="difflineplus">+  Assert.ok(headers.getRawHeader(&quot;Message-Id&quot;)[0]</span>
<a href="#l103.50"></a><span id="l103.50" class="difflineplus">+                   .endsWith(&quot;@tinderbox.invalid&gt;&quot;));</span>
<a href="#l103.51"></a><span id="l103.51">   // This is a very special crafted check. We don't know when the message was</span>
<a href="#l103.52"></a><span id="l103.52">   // actually created, but we have bounds on it, from above. From</span>
<a href="#l103.53"></a><span id="l103.53">   // experimentation, there are a few ways you can create dates that Date.parse</span>
<a href="#l103.54"></a><span id="l103.54">   // can't handle (specifically related to how 2-digit years). However, the</span>
<a href="#l103.55"></a><span id="l103.55">   // optimal RFC 5322 form is supported by Date.parse. If Date.parse fails, we</span>
<a href="#l103.56"></a><span id="l103.56">   // have a form that we shouldn't be using anyways.</span>
<a href="#l103.57"></a><span id="l103.57">   let date = new Date(headers.getRawHeader(&quot;Date&quot;)[0]);</span>
<a href="#l103.58"></a><span id="l103.58">   // If we have clock skew within the test, then our results are going to be</span>
<a href="#l103.59"></a><span id="l103.59" class="difflineat">@@ -240,17 +240,17 @@ function* testOtherHeaders() {</span>
<a href="#l103.60"></a><span id="l103.60">   if (before &gt; after) {</span>
<a href="#l103.61"></a><span id="l103.61">     do_print(&quot;Clock skew detected, skipping date check&quot;);</span>
<a href="#l103.62"></a><span id="l103.62">   } else {</span>
<a href="#l103.63"></a><span id="l103.63">     // In case this all took place within one second, remove sub-millisecond</span>
<a href="#l103.64"></a><span id="l103.64">     // timing (Date headers only carry second-level precision).</span>
<a href="#l103.65"></a><span id="l103.65">     before = before - before % 1000;</span>
<a href="#l103.66"></a><span id="l103.66">     after = after - after % 1000;</span>
<a href="#l103.67"></a><span id="l103.67">     do_print(before + &quot; &lt;= &quot; + date + &quot; &lt;= &quot; + after + &quot;?&quot;);</span>
<a href="#l103.68"></a><span id="l103.68" class="difflineminus">-    do_check_true(before &lt;= date &amp;&amp; date &lt;= after);</span>
<a href="#l103.69"></a><span id="l103.69" class="difflineplus">+    Assert.ok(before &lt;= date &amp;&amp; date &lt;= after);</span>
<a href="#l103.70"></a><span id="l103.70">   }</span>
<a href="#l103.71"></a><span id="l103.71"> </span>
<a href="#l103.72"></a><span id="l103.72"> </span>
<a href="#l103.73"></a><span id="l103.73">   // We truncate too-long References. Check this.</span>
<a href="#l103.74"></a><span id="l103.74">   let references = [];</span>
<a href="#l103.75"></a><span id="l103.75">   for (let i = 0; i &lt; 100; i++)</span>
<a href="#l103.76"></a><span id="l103.76">     references.push(&quot;&lt;&quot; + i + &quot;@test.invalid&gt;&quot;);</span>
<a href="#l103.77"></a><span id="l103.77">   let expected = references.slice(47);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsIMsgCompFields.js</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsIMsgCompFields.js</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -9,53 +9,53 @@ var Ci = Components.interfaces;</span>
<a href="#l104.4"></a><span id="l104.4"> var nsMsgCompFields = Components.Constructor(</span>
<a href="#l104.5"></a><span id="l104.5">   &quot;@mozilla.org/messengercompose/composefields;1&quot;,</span>
<a href="#l104.6"></a><span id="l104.6">   Ci.nsIMsgCompFields);</span>
<a href="#l104.7"></a><span id="l104.7"> </span>
<a href="#l104.8"></a><span id="l104.8"> function check_headers(enumerator, container) {</span>
<a href="#l104.9"></a><span id="l104.9">   let checkValues = new Set(container.map(header =&gt; header.toLowerCase()));</span>
<a href="#l104.10"></a><span id="l104.10">   while (enumerator.hasMore()) {</span>
<a href="#l104.11"></a><span id="l104.11">     let value = enumerator.getNext().toLowerCase();</span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-    do_check_true(checkValues.has(value));</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+    Assert.ok(checkValues.has(value));</span>
<a href="#l104.14"></a><span id="l104.14">     checkValues.delete(value);</span>
<a href="#l104.15"></a><span id="l104.15">   }</span>
<a href="#l104.16"></a><span id="l104.16" class="difflineminus">-  do_check_eq(checkValues.size, 0);</span>
<a href="#l104.17"></a><span id="l104.17" class="difflineplus">+  Assert.equal(checkValues.size, 0);</span>
<a href="#l104.18"></a><span id="l104.18"> }</span>
<a href="#l104.19"></a><span id="l104.19"> </span>
<a href="#l104.20"></a><span id="l104.20"> function run_test() {</span>
<a href="#l104.21"></a><span id="l104.21">   let fields = new nsMsgCompFields;</span>
<a href="#l104.22"></a><span id="l104.22" class="difflineminus">-  do_check_true(fields instanceof Ci.nsIMsgCompFields);</span>
<a href="#l104.23"></a><span id="l104.23" class="difflineminus">-  do_check_true(fields instanceof Ci.msgIStructuredHeaders);</span>
<a href="#l104.24"></a><span id="l104.24" class="difflineminus">-  do_check_true(fields instanceof Ci.msgIWritableStructuredHeaders);</span>
<a href="#l104.25"></a><span id="l104.25" class="difflineplus">+  Assert.ok(fields instanceof Ci.nsIMsgCompFields);</span>
<a href="#l104.26"></a><span id="l104.26" class="difflineplus">+  Assert.ok(fields instanceof Ci.msgIStructuredHeaders);</span>
<a href="#l104.27"></a><span id="l104.27" class="difflineplus">+  Assert.ok(fields instanceof Ci.msgIWritableStructuredHeaders);</span>
<a href="#l104.28"></a><span id="l104.28">   check_headers(fields.headerNames, []);</span>
<a href="#l104.29"></a><span id="l104.29" class="difflineminus">-  do_check_false(fields.hasRecipients);</span>
<a href="#l104.30"></a><span id="l104.30" class="difflineplus">+  Assert.ok(!fields.hasRecipients);</span>
<a href="#l104.31"></a><span id="l104.31"> </span>
<a href="#l104.32"></a><span id="l104.32">   // Try some basic headers</span>
<a href="#l104.33"></a><span id="l104.33">   fields.setHeader(&quot;From&quot;, [{name: &quot;&quot;, email: &quot;a@test.invalid&quot;}]);</span>
<a href="#l104.34"></a><span id="l104.34">   let from = fields.getHeader(&quot;from&quot;);</span>
<a href="#l104.35"></a><span id="l104.35" class="difflineminus">-  do_check_eq(from.length, 1);</span>
<a href="#l104.36"></a><span id="l104.36" class="difflineminus">-  do_check_eq(from[0].email, &quot;a@test.invalid&quot;);</span>
<a href="#l104.37"></a><span id="l104.37" class="difflineplus">+  Assert.equal(from.length, 1);</span>
<a href="#l104.38"></a><span id="l104.38" class="difflineplus">+  Assert.equal(from[0].email, &quot;a@test.invalid&quot;);</span>
<a href="#l104.39"></a><span id="l104.39">   check_headers(fields.headerNames, [&quot;From&quot;]);</span>
<a href="#l104.40"></a><span id="l104.40" class="difflineminus">-  do_check_false(fields.hasRecipients);</span>
<a href="#l104.41"></a><span id="l104.41" class="difflineplus">+  Assert.ok(!fields.hasRecipients);</span>
<a href="#l104.42"></a><span id="l104.42"> </span>
<a href="#l104.43"></a><span id="l104.43">   // Add a To header</span>
<a href="#l104.44"></a><span id="l104.44">   fields.setHeader(&quot;To&quot;, [{name: &quot;&quot;, email: &quot;b@test.invalid&quot;}]);</span>
<a href="#l104.45"></a><span id="l104.45">   check_headers(fields.headerNames, [&quot;From&quot;, &quot;To&quot;]);</span>
<a href="#l104.46"></a><span id="l104.46" class="difflineminus">-  do_check_true(fields.hasRecipients);</span>
<a href="#l104.47"></a><span id="l104.47" class="difflineplus">+  Assert.ok(fields.hasRecipients);</span>
<a href="#l104.48"></a><span id="l104.48"> </span>
<a href="#l104.49"></a><span id="l104.49">   // Delete a header...</span>
<a href="#l104.50"></a><span id="l104.50">   fields.deleteHeader(&quot;from&quot;);</span>
<a href="#l104.51"></a><span id="l104.51" class="difflineminus">-  do_check_eq(fields.getHeader(&quot;From&quot;), undefined);</span>
<a href="#l104.52"></a><span id="l104.52" class="difflineplus">+  Assert.equal(fields.getHeader(&quot;From&quot;), undefined);</span>
<a href="#l104.53"></a><span id="l104.53">   check_headers(fields.headerNames, [&quot;To&quot;]);</span>
<a href="#l104.54"></a><span id="l104.54"> </span>
<a href="#l104.55"></a><span id="l104.55">   // Subject should work and not convert to RFC 2047.</span>
<a href="#l104.56"></a><span id="l104.56">   fields.subject = &quot;\u79c1\u306f\u4ef6\u540d\u5348\u524d&quot;;</span>
<a href="#l104.57"></a><span id="l104.57" class="difflineminus">-  do_check_eq(fields.subject, &quot;\u79c1\u306f\u4ef6\u540d\u5348\u524d&quot;);</span>
<a href="#l104.58"></a><span id="l104.58" class="difflineminus">-  do_check_eq(fields.getHeader(&quot;Subject&quot;),</span>
<a href="#l104.59"></a><span id="l104.59" class="difflineplus">+  Assert.equal(fields.subject, &quot;\u79c1\u306f\u4ef6\u540d\u5348\u524d&quot;);</span>
<a href="#l104.60"></a><span id="l104.60" class="difflineplus">+  Assert.equal(fields.getHeader(&quot;Subject&quot;),</span>
<a href="#l104.61"></a><span id="l104.61">     &quot;\u79c1\u306f\u4ef6\u540d\u5348\u524d&quot;);</span>
<a href="#l104.62"></a><span id="l104.62"> </span>
<a href="#l104.63"></a><span id="l104.63">   // Check header synchronization.</span>
<a href="#l104.64"></a><span id="l104.64">   fields.from = &quot;a@test.invalid&quot;;</span>
<a href="#l104.65"></a><span id="l104.65" class="difflineminus">-  do_check_eq(fields.from, &quot;a@test.invalid&quot;);</span>
<a href="#l104.66"></a><span id="l104.66" class="difflineminus">-  do_check_eq(fields.getHeader(&quot;From&quot;)[0].email, &quot;a@test.invalid&quot;);</span>
<a href="#l104.67"></a><span id="l104.67" class="difflineplus">+  Assert.equal(fields.from, &quot;a@test.invalid&quot;);</span>
<a href="#l104.68"></a><span id="l104.68" class="difflineplus">+  Assert.equal(fields.getHeader(&quot;From&quot;)[0].email, &quot;a@test.invalid&quot;);</span>
<a href="#l104.69"></a><span id="l104.69">   fields.from = null;</span>
<a href="#l104.70"></a><span id="l104.70" class="difflineminus">-  do_check_eq(fields.getHeader(&quot;From&quot;), undefined);</span>
<a href="#l104.71"></a><span id="l104.71" class="difflineplus">+  Assert.equal(fields.getHeader(&quot;From&quot;), undefined);</span>
<a href="#l104.72"></a><span id="l104.72"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsMsgCompose1.js</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsMsgCompose1.js</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -35,20 +35,20 @@ function checkPopulate(aTo, aCheckTo)</span>
<a href="#l105.4"></a><span id="l105.4"> </span>
<a href="#l105.5"></a><span id="l105.5">   params.composeFields = fields;</span>
<a href="#l105.6"></a><span id="l105.6"> </span>
<a href="#l105.7"></a><span id="l105.7">   msgCompose.initialize(params);</span>
<a href="#l105.8"></a><span id="l105.8"> </span>
<a href="#l105.9"></a><span id="l105.9">   msgCompose.expandMailingLists();</span>
<a href="#l105.10"></a><span id="l105.10">   let addresses = fields.getHeader(&quot;To&quot;);</span>
<a href="#l105.11"></a><span id="l105.11">   let checkEmails = MailServices.headerParser.parseDecodedHeader(aCheckTo);</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-  do_check_eq(addresses.length, checkEmails.length);</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineplus">+  Assert.equal(addresses.length, checkEmails.length);</span>
<a href="#l105.14"></a><span id="l105.14">   for (let i = 0; i &lt; addresses.length; i++) {</span>
<a href="#l105.15"></a><span id="l105.15" class="difflineminus">-    do_check_eq(addresses[i].name, checkEmails[i].name);</span>
<a href="#l105.16"></a><span id="l105.16" class="difflineminus">-    do_check_eq(addresses[i].email, checkEmails[i].email);</span>
<a href="#l105.17"></a><span id="l105.17" class="difflineplus">+    Assert.equal(addresses[i].name, checkEmails[i].name);</span>
<a href="#l105.18"></a><span id="l105.18" class="difflineplus">+    Assert.equal(addresses[i].email, checkEmails[i].email);</span>
<a href="#l105.19"></a><span id="l105.19">   }</span>
<a href="#l105.20"></a><span id="l105.20"> }</span>
<a href="#l105.21"></a><span id="l105.21"> </span>
<a href="#l105.22"></a><span id="l105.22"> function run_test() {</span>
<a href="#l105.23"></a><span id="l105.23">   // Test setup - copy the data files into place</span>
<a href="#l105.24"></a><span id="l105.24">   var testAB = do_get_file(&quot;../../../data/abLists1.mab&quot;);</span>
<a href="#l105.25"></a><span id="l105.25"> </span>
<a href="#l105.26"></a><span id="l105.26">   // Copy the file to the profile directory for a PAB</span>
<a href="#l105.27"></a><span id="l105.27" class="difflineat">@@ -91,19 +91,19 @@ function run_test() {</span>
<a href="#l105.28"></a><span id="l105.28">   params = Components.classes[MsgComposeParamsContractID]</span>
<a href="#l105.29"></a><span id="l105.29">                      .createInstance(nsIMsgComposeParams);</span>
<a href="#l105.30"></a><span id="l105.30"> </span>
<a href="#l105.31"></a><span id="l105.31">   params.composeFields = fields;</span>
<a href="#l105.32"></a><span id="l105.32"> </span>
<a href="#l105.33"></a><span id="l105.33">   msgCompose.initialize(params);</span>
<a href="#l105.34"></a><span id="l105.34"> </span>
<a href="#l105.35"></a><span id="l105.35">   msgCompose.expandMailingLists();</span>
<a href="#l105.36"></a><span id="l105.36" class="difflineminus">-  do_check_eq(fields.to, &quot;test2@foo1.invalid&quot;);</span>
<a href="#l105.37"></a><span id="l105.37" class="difflineminus">-  do_check_eq(fields.cc, &quot;test3@foo1.invalid&quot;);</span>
<a href="#l105.38"></a><span id="l105.38" class="difflineminus">-  do_check_eq(fields.bcc, &quot;test4@foo1.invalid&quot;);</span>
<a href="#l105.39"></a><span id="l105.39" class="difflineplus">+  Assert.equal(fields.to, &quot;test2@foo1.invalid&quot;);</span>
<a href="#l105.40"></a><span id="l105.40" class="difflineplus">+  Assert.equal(fields.cc, &quot;test3@foo1.invalid&quot;);</span>
<a href="#l105.41"></a><span id="l105.41" class="difflineplus">+  Assert.equal(fields.bcc, &quot;test4@foo1.invalid&quot;);</span>
<a href="#l105.42"></a><span id="l105.42"> </span>
<a href="#l105.43"></a><span id="l105.43">   // Test - expandMailingLists with plain text.</span>
<a href="#l105.44"></a><span id="l105.44"> </span>
<a href="#l105.45"></a><span id="l105.45">   checkPopulate(&quot;test4@foo.invalid&quot;, &quot;test4@foo.invalid&quot;);</span>
<a href="#l105.46"></a><span id="l105.46"> </span>
<a href="#l105.47"></a><span id="l105.47">   // Test - expandMailingLists with html.</span>
<a href="#l105.48"></a><span id="l105.48"> </span>
<a href="#l105.49"></a><span id="l105.49">   checkPopulate(&quot;test5@foo.invalid&quot;, &quot;test5@foo.invalid&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsMsgCompose2.js</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsMsgCompose2.js</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -58,58 +58,58 @@ function NotifySendListeners() {</span>
<a href="#l106.4"></a><span id="l106.4">   gMsgCompose.onStopSending(null, null, null, null);</span>
<a href="#l106.5"></a><span id="l106.5">   gMsgCompose.onGetDraftFolderURI(null);</span>
<a href="#l106.6"></a><span id="l106.6">   gMsgCompose.onSendNotPerformed(null, null);</span>
<a href="#l106.7"></a><span id="l106.7"> }</span>
<a href="#l106.8"></a><span id="l106.8"> </span>
<a href="#l106.9"></a><span id="l106.9"> function run_test() {</span>
<a href="#l106.10"></a><span id="l106.10">   var i;</span>
<a href="#l106.11"></a><span id="l106.11"> </span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-  do_check_true(gMsgCompose != null);</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineplus">+  Assert.ok(gMsgCompose != null);</span>
<a href="#l106.14"></a><span id="l106.14"> </span>
<a href="#l106.15"></a><span id="l106.15">   // Test - Add a listener</span>
<a href="#l106.16"></a><span id="l106.16"> </span>
<a href="#l106.17"></a><span id="l106.17">   for (i = 0; i &lt; numSendListenerFunctions + 1; ++i) {</span>
<a href="#l106.18"></a><span id="l106.18">     gSLAll[i] = new sendListener();</span>
<a href="#l106.19"></a><span id="l106.19">     gMsgCompose.addMsgSendListener(gSLAll[i]);</span>
<a href="#l106.20"></a><span id="l106.20">   }</span>
<a href="#l106.21"></a><span id="l106.21"> </span>
<a href="#l106.22"></a><span id="l106.22">   // Test - Notify all listeners</span>
<a href="#l106.23"></a><span id="l106.23"> </span>
<a href="#l106.24"></a><span id="l106.24">   NotifySendListeners();</span>
<a href="#l106.25"></a><span id="l106.25"> </span>
<a href="#l106.26"></a><span id="l106.26">   for (i = 0; i &lt; numSendListenerFunctions + 1; ++i) {</span>
<a href="#l106.27"></a><span id="l106.27" class="difflineminus">-    do_check_eq(gSLAll[i].mReceived, 0x3F);</span>
<a href="#l106.28"></a><span id="l106.28" class="difflineplus">+    Assert.equal(gSLAll[i].mReceived, 0x3F);</span>
<a href="#l106.29"></a><span id="l106.29">     gSLAll[i].mReceived = 0;</span>
<a href="#l106.30"></a><span id="l106.30"> </span>
<a href="#l106.31"></a><span id="l106.31">     // And prepare for test 3.</span>
<a href="#l106.32"></a><span id="l106.32">     gSLAll[i].mAutoRemoveItem = 1 &lt;&lt; i;</span>
<a href="#l106.33"></a><span id="l106.33">   }</span>
<a href="#l106.34"></a><span id="l106.34"> </span>
<a href="#l106.35"></a><span id="l106.35">   // Test - Remove some listeners as we go</span>
<a href="#l106.36"></a><span id="l106.36"> </span>
<a href="#l106.37"></a><span id="l106.37">   NotifySendListeners();</span>
<a href="#l106.38"></a><span id="l106.38"> </span>
<a href="#l106.39"></a><span id="l106.39">   var currentReceived = 0;</span>
<a href="#l106.40"></a><span id="l106.40"> </span>
<a href="#l106.41"></a><span id="l106.41">   for (i = 0; i &lt; numSendListenerFunctions + 1; ++i) {</span>
<a href="#l106.42"></a><span id="l106.42">     if (i &lt; numSendListenerFunctions)</span>
<a href="#l106.43"></a><span id="l106.43">       currentReceived += 1 &lt;&lt; i;</span>
<a href="#l106.44"></a><span id="l106.44"> </span>
<a href="#l106.45"></a><span id="l106.45" class="difflineminus">-    do_check_eq(gSLAll[i].mReceived, currentReceived);</span>
<a href="#l106.46"></a><span id="l106.46" class="difflineplus">+    Assert.equal(gSLAll[i].mReceived, currentReceived);</span>
<a href="#l106.47"></a><span id="l106.47">     gSLAll[i].mReceived = 0;</span>
<a href="#l106.48"></a><span id="l106.48">   }</span>
<a href="#l106.49"></a><span id="l106.49"> </span>
<a href="#l106.50"></a><span id="l106.50">   // Test - Ensure the listeners have been removed.</span>
<a href="#l106.51"></a><span id="l106.51"> </span>
<a href="#l106.52"></a><span id="l106.52">   NotifySendListeners();</span>
<a href="#l106.53"></a><span id="l106.53"> </span>
<a href="#l106.54"></a><span id="l106.54">   for (i = 0; i &lt; numSendListenerFunctions + 1; ++i) {</span>
<a href="#l106.55"></a><span id="l106.55">     if (i &lt; numSendListenerFunctions)</span>
<a href="#l106.56"></a><span id="l106.56" class="difflineminus">-      do_check_eq(gSLAll[i].mReceived, 0);</span>
<a href="#l106.57"></a><span id="l106.57" class="difflineplus">+      Assert.equal(gSLAll[i].mReceived, 0);</span>
<a href="#l106.58"></a><span id="l106.58">     else</span>
<a href="#l106.59"></a><span id="l106.59" class="difflineminus">-      do_check_eq(gSLAll[i].mReceived, 0x3F);</span>
<a href="#l106.60"></a><span id="l106.60" class="difflineplus">+      Assert.equal(gSLAll[i].mReceived, 0x3F);</span>
<a href="#l106.61"></a><span id="l106.61">   }</span>
<a href="#l106.62"></a><span id="l106.62"> </span>
<a href="#l106.63"></a><span id="l106.63">   // Test - Remove main listener</span>
<a href="#l106.64"></a><span id="l106.64">     </span>
<a href="#l106.65"></a><span id="l106.65">   gMsgCompose.removeMsgSendListener(gSLAll[numSendListenerFunctions]);</span>
<a href="#l106.66"></a><span id="l106.66"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsMsgCompose3.js</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsMsgCompose3.js</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -48,41 +48,41 @@ function checkPopulate(aTo, aCheckTo)</span>
<a href="#l107.4"></a><span id="l107.4">                  .createInstance(Ci.nsIMsgComposeParams);</span>
<a href="#l107.5"></a><span id="l107.5"> </span>
<a href="#l107.6"></a><span id="l107.6">   params.composeFields = fields;</span>
<a href="#l107.7"></a><span id="l107.7"> </span>
<a href="#l107.8"></a><span id="l107.8">   msgCompose.initialize(params);</span>
<a href="#l107.9"></a><span id="l107.9"> </span>
<a href="#l107.10"></a><span id="l107.10">   do_check_eq(msgCompose.expandMailingLists());</span>
<a href="#l107.11"></a><span id="l107.11"> </span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-  do_check_eq(fields.to, aCheckTo);</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineplus">+  Assert.equal(fields.to, aCheckTo);</span>
<a href="#l107.14"></a><span id="l107.14"> }</span>
<a href="#l107.15"></a><span id="l107.15"> </span>
<a href="#l107.16"></a><span id="l107.16"> function run_test() {</span>
<a href="#l107.17"></a><span id="l107.17">   // Test setup - copy the data files into place</span>
<a href="#l107.18"></a><span id="l107.18">   let testAB = do_get_file(&quot;../../../data/tb2hexpopularity.mab&quot;);</span>
<a href="#l107.19"></a><span id="l107.19"> </span>
<a href="#l107.20"></a><span id="l107.20">   // Copy the file to the profile directory for a PAB</span>
<a href="#l107.21"></a><span id="l107.21">   testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l107.22"></a><span id="l107.22"> </span>
<a href="#l107.23"></a><span id="l107.23">   // Check the popularity index on a couple of cards.</span>
<a href="#l107.24"></a><span id="l107.24">   let AB = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l107.25"></a><span id="l107.25"> </span>
<a href="#l107.26"></a><span id="l107.26">   for (let i = 0; i &lt; TESTS.length; ++i) {</span>
<a href="#l107.27"></a><span id="l107.27">     let card = AB.cardForEmailAddress(TESTS[i].email);</span>
<a href="#l107.28"></a><span id="l107.28" class="difflineminus">-    do_check_true(!!card);</span>
<a href="#l107.29"></a><span id="l107.29" class="difflineplus">+    Assert.ok(!!card);</span>
<a href="#l107.30"></a><span id="l107.30"> </span>
<a href="#l107.31"></a><span id="l107.31">     // Thunderbird 2 stored its popularityIndexes as hex, hence when we read it</span>
<a href="#l107.32"></a><span id="l107.32">     // now we're going to get a hex value. The AB has a value of &quot;a&quot;.</span>
<a href="#l107.33"></a><span id="l107.33" class="difflineminus">-    do_check_eq(card.getProperty(&quot;PopularityIndex&quot;, -1), TESTS[i].prePopularity);</span>
<a href="#l107.34"></a><span id="l107.34" class="difflineplus">+    Assert.equal(card.getProperty(&quot;PopularityIndex&quot;, -1), TESTS[i].prePopularity);</span>
<a href="#l107.35"></a><span id="l107.35"> </span>
<a href="#l107.36"></a><span id="l107.36">     // Call the check populate function.</span>
<a href="#l107.37"></a><span id="l107.37">     checkPopulate(TESTS[i].email, TESTS[i].email);</span>
<a href="#l107.38"></a><span id="l107.38"> </span>
<a href="#l107.39"></a><span id="l107.39">     // Now we've run check populate, check the popularityIndex has increased.</span>
<a href="#l107.40"></a><span id="l107.40">     card = AB.cardForEmailAddress(TESTS[i].email);</span>
<a href="#l107.41"></a><span id="l107.41" class="difflineminus">-    do_check_true(!!card);</span>
<a href="#l107.42"></a><span id="l107.42" class="difflineplus">+    Assert.ok(!!card);</span>
<a href="#l107.43"></a><span id="l107.43"> </span>
<a href="#l107.44"></a><span id="l107.44">     // Thunderbird 2 stored its popularityIndexes as hex, hence when we read it</span>
<a href="#l107.45"></a><span id="l107.45">     // now we're going to get a hex value. The AB has a value of &quot;a&quot;.</span>
<a href="#l107.46"></a><span id="l107.46" class="difflineminus">-    do_check_eq(card.getProperty(&quot;PopularityIndex&quot;, -1), TESTS[i].postPopularity);</span>
<a href="#l107.47"></a><span id="l107.47" class="difflineplus">+    Assert.equal(card.getProperty(&quot;PopularityIndex&quot;, -1), TESTS[i].postPopularity);</span>
<a href="#l107.48"></a><span id="l107.48">   }</span>
<a href="#l107.49"></a><span id="l107.49"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsMsgCompose4.js</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsMsgCompose4.js</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -38,17 +38,17 @@ function checkPopulate(aTo, aNewsgroups,</span>
<a href="#l108.4"></a><span id="l108.4">   var params = Components.classes[MsgComposeParamsContractID]</span>
<a href="#l108.5"></a><span id="l108.5">                          .createInstance(nsIMsgComposeParams);</span>
<a href="#l108.6"></a><span id="l108.6"> </span>
<a href="#l108.7"></a><span id="l108.7">   params.composeFields = fields;</span>
<a href="#l108.8"></a><span id="l108.8"> </span>
<a href="#l108.9"></a><span id="l108.9">   msgCompose.initialize(params);</span>
<a href="#l108.10"></a><span id="l108.10"> </span>
<a href="#l108.11"></a><span id="l108.11">   msgCompose.expandMailingLists();</span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-  do_check_eq(msgCompose.determineHTMLAction(aConvertible), aSendFormat);</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+  Assert.equal(msgCompose.determineHTMLAction(aConvertible), aSendFormat);</span>
<a href="#l108.14"></a><span id="l108.14"> }</span>
<a href="#l108.15"></a><span id="l108.15"> </span>
<a href="#l108.16"></a><span id="l108.16"> function run_test() {</span>
<a href="#l108.17"></a><span id="l108.17">   // Test setup - copy the data files into place</span>
<a href="#l108.18"></a><span id="l108.18">   var testAB = do_get_file(&quot;../../../data/abLists1.mab&quot;);</span>
<a href="#l108.19"></a><span id="l108.19"> </span>
<a href="#l108.20"></a><span id="l108.20">   // Copy the file to the profile directory for a PAB</span>
<a href="#l108.21"></a><span id="l108.21">   testAB.copyTo(do_get_profile(), kPABData.fileName);</span>
<a href="#l108.22"></a><span id="l108.22" class="difflineat">@@ -92,22 +92,22 @@ function run_test() {</span>
<a href="#l108.23"></a><span id="l108.23"> </span>
<a href="#l108.24"></a><span id="l108.24">   params.composeFields = fields;</span>
<a href="#l108.25"></a><span id="l108.25"> </span>
<a href="#l108.26"></a><span id="l108.26">   msgCompose.initialize(params);</span>
<a href="#l108.27"></a><span id="l108.27"> </span>
<a href="#l108.28"></a><span id="l108.28">   var nonHTMLRecipients = new Object();</span>
<a href="#l108.29"></a><span id="l108.29"> </span>
<a href="#l108.30"></a><span id="l108.30">   Services.prefs.setIntPref(&quot;mail.default_html_action&quot;, SendFormat.AskUser);</span>
<a href="#l108.31"></a><span id="l108.31" class="difflineminus">-  do_check_eq(msgCompose.determineHTMLAction(nsIMsgCompConvertible.No),</span>
<a href="#l108.32"></a><span id="l108.32" class="difflineminus">-              SendFormat.AskUser);</span>
<a href="#l108.33"></a><span id="l108.33" class="difflineplus">+  Assert.equal(msgCompose.determineHTMLAction(nsIMsgCompConvertible.No),</span>
<a href="#l108.34"></a><span id="l108.34" class="difflineplus">+               SendFormat.AskUser);</span>
<a href="#l108.35"></a><span id="l108.35"> </span>
<a href="#l108.36"></a><span id="l108.36" class="difflineminus">-  do_check_eq(fields.to, &quot;test2@foo1.invalid&quot;);</span>
<a href="#l108.37"></a><span id="l108.37" class="difflineminus">-  do_check_eq(fields.cc, &quot;test3@foo1.invalid&quot;);</span>
<a href="#l108.38"></a><span id="l108.38" class="difflineminus">-  do_check_eq(fields.bcc, &quot;test4@foo1.invalid&quot;);</span>
<a href="#l108.39"></a><span id="l108.39" class="difflineplus">+  Assert.equal(fields.to, &quot;test2@foo1.invalid&quot;);</span>
<a href="#l108.40"></a><span id="l108.40" class="difflineplus">+  Assert.equal(fields.cc, &quot;test3@foo1.invalid&quot;);</span>
<a href="#l108.41"></a><span id="l108.41" class="difflineplus">+  Assert.equal(fields.bcc, &quot;test4@foo1.invalid&quot;);</span>
<a href="#l108.42"></a><span id="l108.42"> </span>
<a href="#l108.43"></a><span id="l108.43">   // Test - determineHTMLAction with plain text.</span>
<a href="#l108.44"></a><span id="l108.44"> </span>
<a href="#l108.45"></a><span id="l108.45">   checkPopulate(&quot;test4@foo.invalid&quot;, &quot;&quot;, SendFormat.PlainText);</span>
<a href="#l108.46"></a><span id="l108.46"> </span>
<a href="#l108.47"></a><span id="l108.47">   // Test - determineHTMLAction with html.</span>
<a href="#l108.48"></a><span id="l108.48"> </span>
<a href="#l108.49"></a><span id="l108.49">   checkPopulate(&quot;test5@foo.invalid&quot;, &quot;&quot;, SendFormat.HTML);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsSmtpService1.js</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsSmtpService1.js</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -8,50 +8,50 @@ var nsISmtpService = Components.interfac</span>
<a href="#l109.4"></a><span id="l109.4"> </span>
<a href="#l109.5"></a><span id="l109.5"> function run_test() {</span>
<a href="#l109.6"></a><span id="l109.6">   var smtpService = Components.classes[SmtpServiceContractID]</span>
<a href="#l109.7"></a><span id="l109.7">                               .getService(nsISmtpService);</span>
<a href="#l109.8"></a><span id="l109.8"> </span>
<a href="#l109.9"></a><span id="l109.9">   // Test - no servers</span>
<a href="#l109.10"></a><span id="l109.10"> </span>
<a href="#l109.11"></a><span id="l109.11">   var smtpServers = smtpService.servers;</span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-  do_check_false(smtpServers.hasMoreElements());</span>
<a href="#l109.13"></a><span id="l109.13" class="difflineplus">+  Assert.ok(!smtpServers.hasMoreElements());</span>
<a href="#l109.14"></a><span id="l109.14"> </span>
<a href="#l109.15"></a><span id="l109.15" class="difflineminus">-  do_check_eq(smtpService.defaultServer, null);</span>
<a href="#l109.16"></a><span id="l109.16" class="difflineplus">+  Assert.equal(smtpService.defaultServer, null);</span>
<a href="#l109.17"></a><span id="l109.17"> </span>
<a href="#l109.18"></a><span id="l109.18">   // Test - add single server, and check</span>
<a href="#l109.19"></a><span id="l109.19"> </span>
<a href="#l109.20"></a><span id="l109.20">   var smtpServer = smtpService.createServer();</span>
<a href="#l109.21"></a><span id="l109.21"> </span>
<a href="#l109.22"></a><span id="l109.22">   smtpServer.hostname = &quot;localhost&quot;;</span>
<a href="#l109.23"></a><span id="l109.23">   smtpServer.description = &quot;test&quot;;</span>
<a href="#l109.24"></a><span id="l109.24"> </span>
<a href="#l109.25"></a><span id="l109.25">   smtpService.defaultServer = smtpServer;</span>
<a href="#l109.26"></a><span id="l109.26"> </span>
<a href="#l109.27"></a><span id="l109.27">   // Test - Check to see there is only one element in the server list</span>
<a href="#l109.28"></a><span id="l109.28">   smtpServers = smtpService.servers;</span>
<a href="#l109.29"></a><span id="l109.29" class="difflineminus">-  do_check_true(smtpServers.hasMoreElements());</span>
<a href="#l109.30"></a><span id="l109.30" class="difflineminus">-  do_check_eq(smtpServer, smtpServers.getNext());</span>
<a href="#l109.31"></a><span id="l109.31" class="difflineminus">-  do_check_false(smtpServers.hasMoreElements());</span>
<a href="#l109.32"></a><span id="l109.32" class="difflineplus">+  Assert.ok(smtpServers.hasMoreElements());</span>
<a href="#l109.33"></a><span id="l109.33" class="difflineplus">+  Assert.equal(smtpServer, smtpServers.getNext());</span>
<a href="#l109.34"></a><span id="l109.34" class="difflineplus">+  Assert.ok(!smtpServers.hasMoreElements());</span>
<a href="#l109.35"></a><span id="l109.35"> </span>
<a href="#l109.36"></a><span id="l109.36">   // Test - Find the server in different ways</span>
<a href="#l109.37"></a><span id="l109.37" class="difflineminus">-  do_check_eq(smtpServer, smtpService.findServer(&quot;&quot;, &quot;localhost&quot;));</span>
<a href="#l109.38"></a><span id="l109.38" class="difflineminus">-  do_check_eq(smtpServer, smtpService.getServerByKey(smtpServer.key));</span>
<a href="#l109.39"></a><span id="l109.39" class="difflineplus">+  Assert.equal(smtpServer, smtpService.findServer(&quot;&quot;, &quot;localhost&quot;));</span>
<a href="#l109.40"></a><span id="l109.40" class="difflineplus">+  Assert.equal(smtpServer, smtpService.getServerByKey(smtpServer.key));</span>
<a href="#l109.41"></a><span id="l109.41"> </span>
<a href="#l109.42"></a><span id="l109.42">   // Test - Try finding one that doesn't exist.</span>
<a href="#l109.43"></a><span id="l109.43" class="difflineminus">-  do_check_eq(null, smtpService.findServer(&quot;&quot;, &quot;test&quot;));</span>
<a href="#l109.44"></a><span id="l109.44" class="difflineplus">+  Assert.equal(null, smtpService.findServer(&quot;&quot;, &quot;test&quot;));</span>
<a href="#l109.45"></a><span id="l109.45"> </span>
<a href="#l109.46"></a><span id="l109.46">   // Test - Check default server is still ok</span>
<a href="#l109.47"></a><span id="l109.47" class="difflineminus">-  do_check_eq(smtpServer, smtpService.defaultServer);</span>
<a href="#l109.48"></a><span id="l109.48" class="difflineplus">+  Assert.equal(smtpServer, smtpService.defaultServer);</span>
<a href="#l109.49"></a><span id="l109.49"> </span>
<a href="#l109.50"></a><span id="l109.50">   // Test - Delete the only server</span>
<a href="#l109.51"></a><span id="l109.51">   smtpService.deleteServer(smtpServer);</span>
<a href="#l109.52"></a><span id="l109.52"> </span>
<a href="#l109.53"></a><span id="l109.53">   smtpServers = smtpService.servers;</span>
<a href="#l109.54"></a><span id="l109.54" class="difflineminus">-  do_check_false(smtpServers.hasMoreElements());</span>
<a href="#l109.55"></a><span id="l109.55" class="difflineplus">+  Assert.ok(!smtpServers.hasMoreElements());</span>
<a href="#l109.56"></a><span id="l109.56">  </span>
<a href="#l109.57"></a><span id="l109.57">   //    do_check_eq(null, smtpService.defaultServer);</span>
<a href="#l109.58"></a><span id="l109.58"> </span>
<a href="#l109.59"></a><span id="l109.59">   // Test - add multiple servers</span>
<a href="#l109.60"></a><span id="l109.60"> </span>
<a href="#l109.61"></a><span id="l109.61">   var smtpServerArray = new Array(3);</span>
<a href="#l109.62"></a><span id="l109.62">   var i;</span>
<a href="#l109.63"></a><span id="l109.63"> </span>
<a href="#l109.64"></a><span id="l109.64" class="difflineat">@@ -78,33 +78,33 @@ function run_test() {</span>
<a href="#l109.65"></a><span id="l109.65">   while (smtpServers.hasMoreElements()) {</span>
<a href="#l109.66"></a><span id="l109.66">     var smtpServer = smtpServers.getNext();</span>
<a href="#l109.67"></a><span id="l109.67"> </span>
<a href="#l109.68"></a><span id="l109.68">     for (i = 0; i &lt; 3; ++i)</span>
<a href="#l109.69"></a><span id="l109.69">       if (smtpServer == smtpServerArray[i])</span>
<a href="#l109.70"></a><span id="l109.70">         found[i] = true;</span>
<a href="#l109.71"></a><span id="l109.71">   }</span>
<a href="#l109.72"></a><span id="l109.72"> </span>
<a href="#l109.73"></a><span id="l109.73" class="difflineminus">-  do_check_eq(found, &quot;true,true,true&quot;);</span>
<a href="#l109.74"></a><span id="l109.74" class="difflineplus">+  Assert.equal(found, &quot;true,true,true&quot;);</span>
<a href="#l109.75"></a><span id="l109.75"> </span>
<a href="#l109.76"></a><span id="l109.76">   // Test - Find the servers.</span>
<a href="#l109.77"></a><span id="l109.77"> </span>
<a href="#l109.78"></a><span id="l109.78" class="difflineminus">-  do_check_eq(smtpServerArray[0], smtpService.findServer(&quot;user&quot;, &quot;localhost&quot;));</span>
<a href="#l109.79"></a><span id="l109.79" class="difflineminus">-  do_check_eq(smtpServerArray[1], smtpService.findServer(&quot;user1&quot;, &quot;localhost&quot;));</span>
<a href="#l109.80"></a><span id="l109.80" class="difflineminus">-  do_check_eq(smtpServerArray[2], smtpService.findServer(&quot;&quot;, &quot;localhost1&quot;));</span>
<a href="#l109.81"></a><span id="l109.81" class="difflineplus">+  Assert.equal(smtpServerArray[0], smtpService.findServer(&quot;user&quot;, &quot;localhost&quot;));</span>
<a href="#l109.82"></a><span id="l109.82" class="difflineplus">+  Assert.equal(smtpServerArray[1], smtpService.findServer(&quot;user1&quot;, &quot;localhost&quot;));</span>
<a href="#l109.83"></a><span id="l109.83" class="difflineplus">+  Assert.equal(smtpServerArray[2], smtpService.findServer(&quot;&quot;, &quot;localhost1&quot;));</span>
<a href="#l109.84"></a><span id="l109.84"> </span>
<a href="#l109.85"></a><span id="l109.85" class="difflineminus">-  do_check_eq(null, smtpService.findServer(&quot;user2&quot;, &quot;localhost&quot;));</span>
<a href="#l109.86"></a><span id="l109.86" class="difflineplus">+  Assert.equal(null, smtpService.findServer(&quot;user2&quot;, &quot;localhost&quot;));</span>
<a href="#l109.87"></a><span id="l109.87"> </span>
<a href="#l109.88"></a><span id="l109.88">   // XXX: FIXME</span>
<a href="#l109.89"></a><span id="l109.89">   // do_check_eq(null, smtpService.findServer(&quot;&quot;, &quot;localhost&quot;));</span>
<a href="#l109.90"></a><span id="l109.90"> </span>
<a href="#l109.91"></a><span id="l109.91">   for (i = 0; i &lt; 3; ++i)</span>
<a href="#l109.92"></a><span id="l109.92" class="difflineminus">-    do_check_eq(smtpServerArray[i],</span>
<a href="#l109.93"></a><span id="l109.93" class="difflineminus">-                smtpService.getServerByKey(smtpServerArray[i].key));</span>
<a href="#l109.94"></a><span id="l109.94" class="difflineplus">+    Assert.equal(smtpServerArray[i],</span>
<a href="#l109.95"></a><span id="l109.95" class="difflineplus">+                 smtpService.getServerByKey(smtpServerArray[i].key));</span>
<a href="#l109.96"></a><span id="l109.96"> </span>
<a href="#l109.97"></a><span id="l109.97">   // Test - Delete the servers</span>
<a href="#l109.98"></a><span id="l109.98"> </span>
<a href="#l109.99"></a><span id="l109.99">   for (i = 0; i &lt; 3; ++i)</span>
<a href="#l109.100"></a><span id="l109.100">     smtpService.deleteServer(smtpServerArray[i]);</span>
<a href="#l109.101"></a><span id="l109.101"> </span>
<a href="#l109.102"></a><span id="l109.102">   smtpServers = smtpService.servers;</span>
<a href="#l109.103"></a><span id="l109.103" class="difflineminus">-  do_check_false(smtpServers.hasMoreElements());</span>
<a href="#l109.104"></a><span id="l109.104" class="difflineplus">+  Assert.ok(!smtpServers.hasMoreElements());</span>
<a href="#l109.105"></a><span id="l109.105"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_saveDraft.js</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_saveDraft.js</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l110.4"></a><span id="l110.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l110.5"></a><span id="l110.5"> /*</span>
<a href="#l110.6"></a><span id="l110.6">  * Test suite for checking correctly saved as draft with unread.</span>
<a href="#l110.7"></a><span id="l110.7">  */</span>
<a href="#l110.8"></a><span id="l110.8"> </span>
<a href="#l110.9"></a><span id="l110.9"> add_task(function* checkDraft() {</span>
<a href="#l110.10"></a><span id="l110.10">   yield createMessage();</span>
<a href="#l110.11"></a><span id="l110.11" class="difflineminus">-  do_check_eq(gDraftFolder.getTotalMessages(false), 1);</span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-  do_check_eq(gDraftFolder.getNumUnread(false), 1);</span>
<a href="#l110.13"></a><span id="l110.13" class="difflineplus">+  Assert.equal(gDraftFolder.getTotalMessages(false), 1);</span>
<a href="#l110.14"></a><span id="l110.14" class="difflineplus">+  Assert.equal(gDraftFolder.getNumUnread(false), 1);</span>
<a href="#l110.15"></a><span id="l110.15"> });</span>
<a href="#l110.16"></a><span id="l110.16"> </span>
<a href="#l110.17"></a><span id="l110.17"> function run_test() {</span>
<a href="#l110.18"></a><span id="l110.18">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l110.19"></a><span id="l110.19">   run_next_test();</span>
<a href="#l110.20"></a><span id="l110.20"> }</span>
<a href="#l110.21"></a><span id="l110.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendBackground.js</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendBackground.js</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -26,51 +26,51 @@ function msll() {</span>
<a href="#l111.4"></a><span id="l111.4"> }</span>
<a href="#l111.5"></a><span id="l111.5"> </span>
<a href="#l111.6"></a><span id="l111.6"> msll.prototype = {</span>
<a href="#l111.7"></a><span id="l111.7">   _initialTotal: 0,</span>
<a href="#l111.8"></a><span id="l111.8"> </span>
<a href="#l111.9"></a><span id="l111.9">   // nsIMsgSendLaterListener</span>
<a href="#l111.10"></a><span id="l111.10">   onStartSending: function (aTotal) {</span>
<a href="#l111.11"></a><span id="l111.11">     this._initialTotal = 1;</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-    do_check_eq(gMsgSendLater.sendingMessages, true);</span>
<a href="#l111.13"></a><span id="l111.13" class="difflineminus">-    do_check_eq(aTotal, 1);</span>
<a href="#l111.14"></a><span id="l111.14" class="difflineplus">+    Assert.equal(gMsgSendLater.sendingMessages, true);</span>
<a href="#l111.15"></a><span id="l111.15" class="difflineplus">+    Assert.equal(aTotal, 1);</span>
<a href="#l111.16"></a><span id="l111.16">   },</span>
<a href="#l111.17"></a><span id="l111.17">   onMessageStartSending: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l111.18"></a><span id="l111.18">                                    aMessageHeader, aIdentity) {</span>
<a href="#l111.19"></a><span id="l111.19">   },</span>
<a href="#l111.20"></a><span id="l111.20">   onMessageSendProgress: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l111.21"></a><span id="l111.21">                                    aMessageSendPercent, aMessageCopyPercent) {</span>
<a href="#l111.22"></a><span id="l111.22">   }, </span>
<a href="#l111.23"></a><span id="l111.23">   onMessageSendError: function (aCurrentMessage, aMessageHeader, aStatus,</span>
<a href="#l111.24"></a><span id="l111.24">                                 aMsg) {</span>
<a href="#l111.25"></a><span id="l111.25">     do_throw(&quot;onMessageSendError should not have been called, status: &quot; + aStatus);</span>
<a href="#l111.26"></a><span id="l111.26">   },</span>
<a href="#l111.27"></a><span id="l111.27">   onStopSending: function (aStatus, aMsg, aTotalTried, aSuccessful) {</span>
<a href="#l111.28"></a><span id="l111.28">     do_test_finished();</span>
<a href="#l111.29"></a><span id="l111.29">     print(&quot;msll onStopSending\n&quot;);</span>
<a href="#l111.30"></a><span id="l111.30">     try {</span>
<a href="#l111.31"></a><span id="l111.31" class="difflineminus">-      do_check_eq(aStatus, 0);</span>
<a href="#l111.32"></a><span id="l111.32" class="difflineminus">-      do_check_eq(aTotalTried, 1);</span>
<a href="#l111.33"></a><span id="l111.33" class="difflineminus">-      do_check_eq(aSuccessful, 1);</span>
<a href="#l111.34"></a><span id="l111.34" class="difflineminus">-      do_check_eq(this._initialTotal, 1);</span>
<a href="#l111.35"></a><span id="l111.35" class="difflineminus">-      do_check_eq(gMsgSendLater.sendingMessages, false);</span>
<a href="#l111.36"></a><span id="l111.36" class="difflineplus">+      Assert.equal(aStatus, 0);</span>
<a href="#l111.37"></a><span id="l111.37" class="difflineplus">+      Assert.equal(aTotalTried, 1);</span>
<a href="#l111.38"></a><span id="l111.38" class="difflineplus">+      Assert.equal(aSuccessful, 1);</span>
<a href="#l111.39"></a><span id="l111.39" class="difflineplus">+      Assert.equal(this._initialTotal, 1);</span>
<a href="#l111.40"></a><span id="l111.40" class="difflineplus">+      Assert.equal(gMsgSendLater.sendingMessages, false);</span>
<a href="#l111.41"></a><span id="l111.41"> </span>
<a href="#l111.42"></a><span id="l111.42">       do_check_transaction(server.playTransaction(),</span>
<a href="#l111.43"></a><span id="l111.43">                            [&quot;EHLO test&quot;,</span>
<a href="#l111.44"></a><span id="l111.44">                             &quot;MAIL FROM:&lt;&quot; + kSender + &quot;&gt; BODY=8BITMIME SIZE=&quot; + originalData.length,</span>
<a href="#l111.45"></a><span id="l111.45">                             &quot;RCPT TO:&lt;&quot; + kTo + &quot;&gt;&quot;,</span>
<a href="#l111.46"></a><span id="l111.46">                             &quot;DATA&quot;]);</span>
<a href="#l111.47"></a><span id="l111.47"> </span>
<a href="#l111.48"></a><span id="l111.48">       // Compare data file to what the server received</span>
<a href="#l111.49"></a><span id="l111.49" class="difflineminus">-      do_check_eq(originalData, server._daemon.post);</span>
<a href="#l111.50"></a><span id="l111.50" class="difflineplus">+      Assert.equal(originalData, server._daemon.post);</span>
<a href="#l111.51"></a><span id="l111.51"> </span>
<a href="#l111.52"></a><span id="l111.52">       // check there's still one message left in the folder</span>
<a href="#l111.53"></a><span id="l111.53" class="difflineminus">-      do_check_eq(gMsgSendLater.getUnsentMessagesFolder(null)</span>
<a href="#l111.54"></a><span id="l111.54" class="difflineminus">-                               .getTotalMessages(false), 1);</span>
<a href="#l111.55"></a><span id="l111.55" class="difflineplus">+      Assert.equal(gMsgSendLater.getUnsentMessagesFolder(null)</span>
<a href="#l111.56"></a><span id="l111.56" class="difflineplus">+                                .getTotalMessages(false), 1);</span>
<a href="#l111.57"></a><span id="l111.57"> </span>
<a href="#l111.58"></a><span id="l111.58">       finished = true;</span>
<a href="#l111.59"></a><span id="l111.59">     } catch (e) {</span>
<a href="#l111.60"></a><span id="l111.60">       do_throw(e);</span>
<a href="#l111.61"></a><span id="l111.61">     } finally {</span>
<a href="#l111.62"></a><span id="l111.62">       server.stop();</span>
<a href="#l111.63"></a><span id="l111.63"> </span>
<a href="#l111.64"></a><span id="l111.64">       var thread = gThreadManager.currentThread;</span>
<a href="#l111.65"></a><span id="l111.65" class="difflineat">@@ -92,17 +92,17 @@ function run_test() {</span>
<a href="#l111.66"></a><span id="l111.66">   // Now load (and internally initialize) the send later service</span>
<a href="#l111.67"></a><span id="l111.67">   gMsgSendLater = Cc[&quot;@mozilla.org/messengercompose/sendlater;1&quot;]</span>
<a href="#l111.68"></a><span id="l111.68">                     .getService(Ci.nsIMsgSendLater);</span>
<a href="#l111.69"></a><span id="l111.69"> </span>
<a href="#l111.70"></a><span id="l111.70">   // Test file - for bug 429891</span>
<a href="#l111.71"></a><span id="l111.71">   originalData = IOUtils.loadFileToString(testFile1);</span>
<a href="#l111.72"></a><span id="l111.72"> </span>
<a href="#l111.73"></a><span id="l111.73">   // Check that the send later service thinks we don't have messages to send</span>
<a href="#l111.74"></a><span id="l111.74" class="difflineminus">-  do_check_eq(gMsgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l111.75"></a><span id="l111.75" class="difflineplus">+  Assert.equal(gMsgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l111.76"></a><span id="l111.76"> </span>
<a href="#l111.77"></a><span id="l111.77">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l111.78"></a><span id="l111.78"> </span>
<a href="#l111.79"></a><span id="l111.79">   let account = MailServices.accounts.createAccount();</span>
<a href="#l111.80"></a><span id="l111.80">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l111.81"></a><span id="l111.81"> </span>
<a href="#l111.82"></a><span id="l111.82">   // Start the fake SMTP server</span>
<a href="#l111.83"></a><span id="l111.83">   server = setupServerDaemon();</span>
<a href="#l111.84"></a><span id="l111.84" class="difflineat">@@ -111,17 +111,17 @@ function run_test() {</span>
<a href="#l111.85"></a><span id="l111.85">   identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l111.86"></a><span id="l111.86"> </span>
<a href="#l111.87"></a><span id="l111.87">   account.addIdentity(identity);</span>
<a href="#l111.88"></a><span id="l111.88">   account.defaultIdentity = identity;</span>
<a href="#l111.89"></a><span id="l111.89">   account.incomingServer = incomingServer;</span>
<a href="#l111.90"></a><span id="l111.90"> </span>
<a href="#l111.91"></a><span id="l111.91">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l111.92"></a><span id="l111.92"> </span>
<a href="#l111.93"></a><span id="l111.93" class="difflineminus">-  do_check_eq(identity.doFcc, true);</span>
<a href="#l111.94"></a><span id="l111.94" class="difflineplus">+  Assert.equal(identity.doFcc, true);</span>
<a href="#l111.95"></a><span id="l111.95"> </span>
<a href="#l111.96"></a><span id="l111.96">   // Now prepare to actually &quot;send&quot; the message later, i.e. dump it in the</span>
<a href="#l111.97"></a><span id="l111.97">   // unsent messages folder.</span>
<a href="#l111.98"></a><span id="l111.98"> </span>
<a href="#l111.99"></a><span id="l111.99">   var compFields = Cc[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l111.100"></a><span id="l111.100">                      .createInstance(Ci.nsIMsgCompFields);</span>
<a href="#l111.101"></a><span id="l111.101"> </span>
<a href="#l111.102"></a><span id="l111.102">   compFields.from = identity.email;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMailAddressIDN.js</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMailAddressIDN.js</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -25,18 +25,18 @@ var NS_ERROR_BUT_DONT_SHOW_ALERT = 0x805</span>
<a href="#l112.4"></a><span id="l112.4"> // nsIPrompt</span>
<a href="#l112.5"></a><span id="l112.5"> function alert(aDialogText, aText)</span>
<a href="#l112.6"></a><span id="l112.6"> {</span>
<a href="#l112.7"></a><span id="l112.7">   // ignore without domain situation (this is crash test)</span>
<a href="#l112.8"></a><span id="l112.8">   if (test == kToInvalidWithoutDomain)</span>
<a href="#l112.9"></a><span id="l112.9">     return;</span>
<a href="#l112.10"></a><span id="l112.10"> </span>
<a href="#l112.11"></a><span id="l112.11">   // we should only get here for the kToInvalid test case</span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-  do_check_eq(test, kToInvalid);</span>
<a href="#l112.13"></a><span id="l112.13" class="difflineminus">-  do_check_eq(aText, expectedAlertMessage);</span>
<a href="#l112.14"></a><span id="l112.14" class="difflineplus">+  Assert.equal(test, kToInvalid);</span>
<a href="#l112.15"></a><span id="l112.15" class="difflineplus">+  Assert.equal(aText, expectedAlertMessage);</span>
<a href="#l112.16"></a><span id="l112.16"> }</span>
<a href="#l112.17"></a><span id="l112.17"> </span>
<a href="#l112.18"></a><span id="l112.18"> </span>
<a href="#l112.19"></a><span id="l112.19"> // message listener implementations</span>
<a href="#l112.20"></a><span id="l112.20"> function msgListener(aRecipient)</span>
<a href="#l112.21"></a><span id="l112.21"> {</span>
<a href="#l112.22"></a><span id="l112.22">   this.rcpt = aRecipient;</span>
<a href="#l112.23"></a><span id="l112.23"> }</span>
<a href="#l112.24"></a><span id="l112.24" class="difflineat">@@ -46,24 +46,24 @@ msgListener.prototype =</span>
<a href="#l112.25"></a><span id="l112.25">   // nsIMsgSendListener</span>
<a href="#l112.26"></a><span id="l112.26">   onStartSending: function (aMsgID, aMsgSize) {},</span>
<a href="#l112.27"></a><span id="l112.27">   onProgress: function (aMsgID, aProgress, aProgressMax) {},</span>
<a href="#l112.28"></a><span id="l112.28">   onStatus: function (aMsgID, aMsg) {},</span>
<a href="#l112.29"></a><span id="l112.29">   onStopSending: function (aMsgID, aStatus, aMsg, aReturnFile)</span>
<a href="#l112.30"></a><span id="l112.30">   {</span>
<a href="#l112.31"></a><span id="l112.31">     try</span>
<a href="#l112.32"></a><span id="l112.32">     {</span>
<a href="#l112.33"></a><span id="l112.33" class="difflineminus">-      do_check_eq(aStatus, 0);</span>
<a href="#l112.34"></a><span id="l112.34" class="difflineplus">+      Assert.equal(aStatus, 0);</span>
<a href="#l112.35"></a><span id="l112.35">       do_check_transaction(server.playTransaction(),</span>
<a href="#l112.36"></a><span id="l112.36">                            [&quot;EHLO test&quot;,</span>
<a href="#l112.37"></a><span id="l112.37">                             &quot;MAIL FROM:&lt;&quot; + kSender + &quot;&gt; BODY=8BITMIME SIZE=&quot; + originalData.length,</span>
<a href="#l112.38"></a><span id="l112.38">                             &quot;RCPT TO:&lt;&quot; + this.rcpt + &quot;&gt;&quot;,</span>
<a href="#l112.39"></a><span id="l112.39">                             &quot;DATA&quot;]);</span>
<a href="#l112.40"></a><span id="l112.40">       // Compare data file to what the server received</span>
<a href="#l112.41"></a><span id="l112.41" class="difflineminus">-      do_check_eq(originalData, server._daemon.post);</span>
<a href="#l112.42"></a><span id="l112.42" class="difflineplus">+      Assert.equal(originalData, server._daemon.post);</span>
<a href="#l112.43"></a><span id="l112.43">     }</span>
<a href="#l112.44"></a><span id="l112.44">     catch (e)</span>
<a href="#l112.45"></a><span id="l112.45">     {</span>
<a href="#l112.46"></a><span id="l112.46">       do_throw(e);</span>
<a href="#l112.47"></a><span id="l112.47">     }</span>
<a href="#l112.48"></a><span id="l112.48">     finally</span>
<a href="#l112.49"></a><span id="l112.49">     {</span>
<a href="#l112.50"></a><span id="l112.50">       server.stop();</span>
<a href="#l112.51"></a><span id="l112.51" class="difflineat">@@ -77,27 +77,27 @@ msgListener.prototype =</span>
<a href="#l112.52"></a><span id="l112.52"> </span>
<a href="#l112.53"></a><span id="l112.53">   // nsIMsgCopyServiceListener</span>
<a href="#l112.54"></a><span id="l112.54">   OnStartCopy: function () {},</span>
<a href="#l112.55"></a><span id="l112.55">   OnProgress: function (aProgress, aProgressMax) {},</span>
<a href="#l112.56"></a><span id="l112.56">   SetMessageKey: function (aKey) {},</span>
<a href="#l112.57"></a><span id="l112.57">   GetMessageId: function (aMessageId) {},</span>
<a href="#l112.58"></a><span id="l112.58">   OnStopCopy: function (aStatus)</span>
<a href="#l112.59"></a><span id="l112.59">   {</span>
<a href="#l112.60"></a><span id="l112.60" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l112.61"></a><span id="l112.61" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l112.62"></a><span id="l112.62">     try</span>
<a href="#l112.63"></a><span id="l112.63">     {</span>
<a href="#l112.64"></a><span id="l112.64">       // Now do a comparison of what is in the sent mail folder</span>
<a href="#l112.65"></a><span id="l112.65">       let msgData = mailTestUtils</span>
<a href="#l112.66"></a><span id="l112.66">         .loadMessageToString(sentFolder, mailTestUtils.firstMsgHdr(sentFolder));</span>
<a href="#l112.67"></a><span id="l112.67">       // Skip the headers etc that mailnews adds</span>
<a href="#l112.68"></a><span id="l112.68">       var pos = msgData.indexOf(&quot;From:&quot;);</span>
<a href="#l112.69"></a><span id="l112.69" class="difflineminus">-      do_check_neq(pos, -1);</span>
<a href="#l112.70"></a><span id="l112.70" class="difflineplus">+      Assert.notEqual(pos, -1);</span>
<a href="#l112.71"></a><span id="l112.71">       msgData = msgData.substr(pos);</span>
<a href="#l112.72"></a><span id="l112.72" class="difflineminus">-      do_check_eq(originalData, msgData);</span>
<a href="#l112.73"></a><span id="l112.73" class="difflineplus">+      Assert.equal(originalData, msgData);</span>
<a href="#l112.74"></a><span id="l112.74">     }</span>
<a href="#l112.75"></a><span id="l112.75">     catch (e)</span>
<a href="#l112.76"></a><span id="l112.76">     {</span>
<a href="#l112.77"></a><span id="l112.77">       do_throw(e);</span>
<a href="#l112.78"></a><span id="l112.78">     }</span>
<a href="#l112.79"></a><span id="l112.79">     finally</span>
<a href="#l112.80"></a><span id="l112.80">     {</span>
<a href="#l112.81"></a><span id="l112.81">       finished = true;</span>
<a href="#l112.82"></a><span id="l112.82" class="difflineat">@@ -118,17 +118,17 @@ msgListener.prototype =</span>
<a href="#l112.83"></a><span id="l112.83"> </span>
<a href="#l112.84"></a><span id="l112.84"> </span>
<a href="#l112.85"></a><span id="l112.85"> function DoSendTest(aRecipient, aRecipientExpected, aExceptionExpected)</span>
<a href="#l112.86"></a><span id="l112.86"> {</span>
<a href="#l112.87"></a><span id="l112.87">   server = setupServerDaemon();</span>
<a href="#l112.88"></a><span id="l112.88">   server.start();</span>
<a href="#l112.89"></a><span id="l112.89">   var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l112.90"></a><span id="l112.90">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l112.91"></a><span id="l112.91" class="difflineminus">-  do_check_eq(identity.doFcc, true);</span>
<a href="#l112.92"></a><span id="l112.92" class="difflineplus">+  Assert.equal(identity.doFcc, true);</span>
<a href="#l112.93"></a><span id="l112.93"> </span>
<a href="#l112.94"></a><span id="l112.94">   // Random test file with data we don't actually care about. ;-)</span>
<a href="#l112.95"></a><span id="l112.95">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l112.96"></a><span id="l112.96">   originalData = IOUtils.loadFileToString(testFile);</span>
<a href="#l112.97"></a><span id="l112.97"> </span>
<a href="#l112.98"></a><span id="l112.98">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l112.99"></a><span id="l112.99">   // the server if something fails.</span>
<a href="#l112.100"></a><span id="l112.100">   var exceptionCaught = 0;</span>
<a href="#l112.101"></a><span id="l112.101" class="difflineat">@@ -158,17 +158,17 @@ function DoSendTest(aRecipient, aRecipie</span>
<a href="#l112.102"></a><span id="l112.102">   }</span>
<a href="#l112.103"></a><span id="l112.103">   finally</span>
<a href="#l112.104"></a><span id="l112.104">   {</span>
<a href="#l112.105"></a><span id="l112.105">     server.stop();</span>
<a href="#l112.106"></a><span id="l112.106">     var thread = gThreadManager.currentThread;</span>
<a href="#l112.107"></a><span id="l112.107">     while (thread.hasPendingEvents())</span>
<a href="#l112.108"></a><span id="l112.108">       thread.processNextEvent(true);</span>
<a href="#l112.109"></a><span id="l112.109">   }</span>
<a href="#l112.110"></a><span id="l112.110" class="difflineminus">-  do_check_eq(exceptionCaught, aExceptionExpected);</span>
<a href="#l112.111"></a><span id="l112.111" class="difflineplus">+  Assert.equal(exceptionCaught, aExceptionExpected);</span>
<a href="#l112.112"></a><span id="l112.112"> }</span>
<a href="#l112.113"></a><span id="l112.113"> </span>
<a href="#l112.114"></a><span id="l112.114"> </span>
<a href="#l112.115"></a><span id="l112.115"> function run_test()</span>
<a href="#l112.116"></a><span id="l112.116"> {</span>
<a href="#l112.117"></a><span id="l112.117">   type = &quot;sendMailAddressIDN&quot;;</span>
<a href="#l112.118"></a><span id="l112.118">   registerAlertTestUtils();</span>
<a href="#l112.119"></a><span id="l112.119">   var composeProps = Services.strings.createBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageFile.js</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageFile.js</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -30,26 +30,26 @@ msl.prototype = {</span>
<a href="#l113.4"></a><span id="l113.4">   onStartSending: function (aMsgID, aMsgSize) {</span>
<a href="#l113.5"></a><span id="l113.5">   },</span>
<a href="#l113.6"></a><span id="l113.6">   onProgress: function (aMsgID, aProgress, aProgressMax) {</span>
<a href="#l113.7"></a><span id="l113.7">   },</span>
<a href="#l113.8"></a><span id="l113.8">   onStatus: function (aMsgID, aMsg) {</span>
<a href="#l113.9"></a><span id="l113.9">   },</span>
<a href="#l113.10"></a><span id="l113.10">   onStopSending: function (aMsgID, aStatus, aMsg, aReturnFile) {</span>
<a href="#l113.11"></a><span id="l113.11">     try {</span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-      do_check_eq(aStatus, 0);</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineplus">+      Assert.equal(aStatus, 0);</span>
<a href="#l113.14"></a><span id="l113.14"> </span>
<a href="#l113.15"></a><span id="l113.15">       do_check_transaction(server.playTransaction(),</span>
<a href="#l113.16"></a><span id="l113.16">                            [&quot;EHLO test&quot;,</span>
<a href="#l113.17"></a><span id="l113.17">                             &quot;MAIL FROM:&lt;&quot; + kSender + &quot;&gt; BODY=8BITMIME SIZE=&quot; + originalData.length,</span>
<a href="#l113.18"></a><span id="l113.18">                             &quot;RCPT TO:&lt;&quot; + kTo + &quot;&gt;&quot;,</span>
<a href="#l113.19"></a><span id="l113.19">                             &quot;DATA&quot;]);</span>
<a href="#l113.20"></a><span id="l113.20"> </span>
<a href="#l113.21"></a><span id="l113.21">       // Compare data file to what the server received</span>
<a href="#l113.22"></a><span id="l113.22" class="difflineminus">-      do_check_eq(originalData, server._daemon.post);</span>
<a href="#l113.23"></a><span id="l113.23" class="difflineplus">+      Assert.equal(originalData, server._daemon.post);</span>
<a href="#l113.24"></a><span id="l113.24">     } catch (e) {</span>
<a href="#l113.25"></a><span id="l113.25">       do_throw(e);</span>
<a href="#l113.26"></a><span id="l113.26">     } finally {</span>
<a href="#l113.27"></a><span id="l113.27">       server.stop();</span>
<a href="#l113.28"></a><span id="l113.28"> </span>
<a href="#l113.29"></a><span id="l113.29">       var thread = gThreadManager.currentThread;</span>
<a href="#l113.30"></a><span id="l113.30">       while (thread.hasPendingEvents())</span>
<a href="#l113.31"></a><span id="l113.31">         thread.processNextEvent(false);</span>
<a href="#l113.32"></a><span id="l113.32" class="difflineat">@@ -65,29 +65,29 @@ msl.prototype = {</span>
<a href="#l113.33"></a><span id="l113.33">   },</span>
<a href="#l113.34"></a><span id="l113.34">   OnProgress: function (aProgress, aProgressMax) {</span>
<a href="#l113.35"></a><span id="l113.35">   },</span>
<a href="#l113.36"></a><span id="l113.36">   SetMessageKey: function (aKey) {</span>
<a href="#l113.37"></a><span id="l113.37">   },</span>
<a href="#l113.38"></a><span id="l113.38">   GetMessageId: function (aMessageId) {</span>
<a href="#l113.39"></a><span id="l113.39">   },</span>
<a href="#l113.40"></a><span id="l113.40">   OnStopCopy: function (aStatus) {</span>
<a href="#l113.41"></a><span id="l113.41" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l113.42"></a><span id="l113.42" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l113.43"></a><span id="l113.43">     try {</span>
<a href="#l113.44"></a><span id="l113.44">       // Now do a comparison of what is in the sent mail folder</span>
<a href="#l113.45"></a><span id="l113.45">       let msgData = mailTestUtils</span>
<a href="#l113.46"></a><span id="l113.46">         .loadMessageToString(sentFolder, mailTestUtils.firstMsgHdr(sentFolder));</span>
<a href="#l113.47"></a><span id="l113.47"> </span>
<a href="#l113.48"></a><span id="l113.48">       // Skip the headers etc that mailnews adds</span>
<a href="#l113.49"></a><span id="l113.49">       var pos = msgData.indexOf(&quot;From:&quot;);</span>
<a href="#l113.50"></a><span id="l113.50" class="difflineminus">-      do_check_neq(pos, -1);</span>
<a href="#l113.51"></a><span id="l113.51" class="difflineplus">+      Assert.notEqual(pos, -1);</span>
<a href="#l113.52"></a><span id="l113.52"> </span>
<a href="#l113.53"></a><span id="l113.53">       msgData = msgData.substr(pos);</span>
<a href="#l113.54"></a><span id="l113.54"> </span>
<a href="#l113.55"></a><span id="l113.55" class="difflineminus">-      do_check_eq(originalData, msgData);</span>
<a href="#l113.56"></a><span id="l113.56" class="difflineplus">+      Assert.equal(originalData, msgData);</span>
<a href="#l113.57"></a><span id="l113.57">     } catch (e) {</span>
<a href="#l113.58"></a><span id="l113.58">       do_throw(e);</span>
<a href="#l113.59"></a><span id="l113.59">     } finally {</span>
<a href="#l113.60"></a><span id="l113.60">       finished = true;</span>
<a href="#l113.61"></a><span id="l113.61">       do_test_finished();</span>
<a href="#l113.62"></a><span id="l113.62">     }</span>
<a href="#l113.63"></a><span id="l113.63">   },</span>
<a href="#l113.64"></a><span id="l113.64"> </span>
<a href="#l113.65"></a><span id="l113.65" class="difflineat">@@ -117,17 +117,17 @@ function run_test() {</span>
<a href="#l113.66"></a><span id="l113.66">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l113.67"></a><span id="l113.67"> </span>
<a href="#l113.68"></a><span id="l113.68">   server.start();</span>
<a href="#l113.69"></a><span id="l113.69">   var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l113.70"></a><span id="l113.70">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l113.71"></a><span id="l113.71"> </span>
<a href="#l113.72"></a><span id="l113.72">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l113.73"></a><span id="l113.73"> </span>
<a href="#l113.74"></a><span id="l113.74" class="difflineminus">-  do_check_eq(identity.doFcc, true);</span>
<a href="#l113.75"></a><span id="l113.75" class="difflineplus">+  Assert.equal(identity.doFcc, true);</span>
<a href="#l113.76"></a><span id="l113.76"> </span>
<a href="#l113.77"></a><span id="l113.77">   var msgSend = Cc[&quot;@mozilla.org/messengercompose/send;1&quot;]</span>
<a href="#l113.78"></a><span id="l113.78">                   .createInstance(Ci.nsIMsgSend);</span>
<a href="#l113.79"></a><span id="l113.79"> </span>
<a href="#l113.80"></a><span id="l113.80">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l113.81"></a><span id="l113.81">   // the server if something fails.</span>
<a href="#l113.82"></a><span id="l113.82">   try {</span>
<a href="#l113.83"></a><span id="l113.83">     // A test to check that we are sending files correctly, including checking</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater.js</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater.js</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -37,17 +37,17 @@ function msll() {</span>
<a href="#l114.4"></a><span id="l114.4"> </span>
<a href="#l114.5"></a><span id="l114.5"> msll.prototype = {</span>
<a href="#l114.6"></a><span id="l114.6">   _initialTotal: 0,</span>
<a href="#l114.7"></a><span id="l114.7">   _startedSending: false,</span>
<a href="#l114.8"></a><span id="l114.8"> </span>
<a href="#l114.9"></a><span id="l114.9">   // nsIMsgSendLaterListener</span>
<a href="#l114.10"></a><span id="l114.10">   onStartSending: function (aTotalMessageCount) {</span>
<a href="#l114.11"></a><span id="l114.11">     this._initialTotal = 1;</span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, true);</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, true);</span>
<a href="#l114.14"></a><span id="l114.14">   },</span>
<a href="#l114.15"></a><span id="l114.15">   onMessageStartSending: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l114.16"></a><span id="l114.16">                                    aMessageHeader, aIdentity) {</span>
<a href="#l114.17"></a><span id="l114.17">     this._startedSending = true;</span>
<a href="#l114.18"></a><span id="l114.18">   },</span>
<a href="#l114.19"></a><span id="l114.19">   onMessageSendProgress: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l114.20"></a><span id="l114.20">                                    aMessageSendPercent, aMessageCopyPercent) {</span>
<a href="#l114.21"></a><span id="l114.21">     // XXX Enable this function</span>
<a href="#l114.22"></a><span id="l114.22" class="difflineat">@@ -55,31 +55,31 @@ msll.prototype = {</span>
<a href="#l114.23"></a><span id="l114.23">   onMessageSendError: function (aCurrentMessage, aMessageHeader, aStatus,</span>
<a href="#l114.24"></a><span id="l114.24">                                 aMsg) {</span>
<a href="#l114.25"></a><span id="l114.25">     do_throw(&quot;onMessageSendError should not have been called, status: &quot; + aStatus);</span>
<a href="#l114.26"></a><span id="l114.26">   },</span>
<a href="#l114.27"></a><span id="l114.27">   onStopSending: function (aStatus, aMsg, aTotalTried, aSuccessful) {</span>
<a href="#l114.28"></a><span id="l114.28">     do_test_finished();</span>
<a href="#l114.29"></a><span id="l114.29">     print(&quot;msll onStopSending\n&quot;);</span>
<a href="#l114.30"></a><span id="l114.30">     try {</span>
<a href="#l114.31"></a><span id="l114.31" class="difflineminus">-      do_check_eq(this._startedSending, true);</span>
<a href="#l114.32"></a><span id="l114.32" class="difflineminus">-      do_check_eq(aStatus, 0);</span>
<a href="#l114.33"></a><span id="l114.33" class="difflineminus">-      do_check_eq(aTotalTried, 1);</span>
<a href="#l114.34"></a><span id="l114.34" class="difflineminus">-      do_check_eq(aSuccessful, 1);</span>
<a href="#l114.35"></a><span id="l114.35" class="difflineminus">-      do_check_eq(this._initialTotal, 1);</span>
<a href="#l114.36"></a><span id="l114.36" class="difflineminus">-      do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l114.37"></a><span id="l114.37" class="difflineplus">+      Assert.equal(this._startedSending, true);</span>
<a href="#l114.38"></a><span id="l114.38" class="difflineplus">+      Assert.equal(aStatus, 0);</span>
<a href="#l114.39"></a><span id="l114.39" class="difflineplus">+      Assert.equal(aTotalTried, 1);</span>
<a href="#l114.40"></a><span id="l114.40" class="difflineplus">+      Assert.equal(aSuccessful, 1);</span>
<a href="#l114.41"></a><span id="l114.41" class="difflineplus">+      Assert.equal(this._initialTotal, 1);</span>
<a href="#l114.42"></a><span id="l114.42" class="difflineplus">+      Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l114.43"></a><span id="l114.43"> </span>
<a href="#l114.44"></a><span id="l114.44">       do_check_transaction(server.playTransaction(),</span>
<a href="#l114.45"></a><span id="l114.45">                            [&quot;EHLO test&quot;,</span>
<a href="#l114.46"></a><span id="l114.46">                             &quot;MAIL FROM:&lt;&quot; + kSender + &quot;&gt; BODY=8BITMIME SIZE=&quot; + originalData.length,</span>
<a href="#l114.47"></a><span id="l114.47">                             &quot;RCPT TO:&lt;&quot; + kTo + &quot;&gt;&quot;,</span>
<a href="#l114.48"></a><span id="l114.48">                             &quot;DATA&quot;]);</span>
<a href="#l114.49"></a><span id="l114.49"> </span>
<a href="#l114.50"></a><span id="l114.50">       // Compare data file to what the server received</span>
<a href="#l114.51"></a><span id="l114.51" class="difflineminus">-      do_check_eq(originalData, server._daemon.post);</span>
<a href="#l114.52"></a><span id="l114.52" class="difflineplus">+      Assert.equal(originalData, server._daemon.post);</span>
<a href="#l114.53"></a><span id="l114.53"> </span>
<a href="#l114.54"></a><span id="l114.54">       finished = true;</span>
<a href="#l114.55"></a><span id="l114.55">     } catch (e) {</span>
<a href="#l114.56"></a><span id="l114.56">       do_throw(e);</span>
<a href="#l114.57"></a><span id="l114.57">     } finally {</span>
<a href="#l114.58"></a><span id="l114.58">       server.stop();</span>
<a href="#l114.59"></a><span id="l114.59"> </span>
<a href="#l114.60"></a><span id="l114.60">       var thread = gThreadManager.currentThread;</span>
<a href="#l114.61"></a><span id="l114.61" class="difflineat">@@ -88,40 +88,40 @@ msll.prototype = {</span>
<a href="#l114.62"></a><span id="l114.62">     }</span>
<a href="#l114.63"></a><span id="l114.63">   }</span>
<a href="#l114.64"></a><span id="l114.64"> };</span>
<a href="#l114.65"></a><span id="l114.65"> </span>
<a href="#l114.66"></a><span id="l114.66"> function OnStopCopy(aStatus) {</span>
<a href="#l114.67"></a><span id="l114.67">   dump(&quot;OnStopCopy()\n&quot;);</span>
<a href="#l114.68"></a><span id="l114.68"> </span>
<a href="#l114.69"></a><span id="l114.69">   try {</span>
<a href="#l114.70"></a><span id="l114.70" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l114.71"></a><span id="l114.71" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l114.72"></a><span id="l114.72"> </span>
<a href="#l114.73"></a><span id="l114.73">     // Check this is false before we start sending</span>
<a href="#l114.74"></a><span id="l114.74" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l114.75"></a><span id="l114.75" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l114.76"></a><span id="l114.76"> </span>
<a href="#l114.77"></a><span id="l114.77">     let folder = msgSendLater.getUnsentMessagesFolder(identity);</span>
<a href="#l114.78"></a><span id="l114.78"> </span>
<a href="#l114.79"></a><span id="l114.79">     // Check we have a message in the unsent message folder</span>
<a href="#l114.80"></a><span id="l114.80" class="difflineminus">-    do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l114.81"></a><span id="l114.81" class="difflineplus">+    Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l114.82"></a><span id="l114.82"> </span>
<a href="#l114.83"></a><span id="l114.83">     // Check that the send later service thinks we have messages to send</span>
<a href="#l114.84"></a><span id="l114.84" class="difflineminus">-    do_check_eq(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l114.85"></a><span id="l114.85" class="difflineplus">+    Assert.equal(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l114.86"></a><span id="l114.86"> </span>
<a href="#l114.87"></a><span id="l114.87">     // Now do a comparison of what is in the sent mail folder</span>
<a href="#l114.88"></a><span id="l114.88">     let msgData = mailTestUtils</span>
<a href="#l114.89"></a><span id="l114.89">       .loadMessageToString(folder, mailTestUtils.firstMsgHdr(folder));</span>
<a href="#l114.90"></a><span id="l114.90">     // Skip the headers etc that mailnews adds</span>
<a href="#l114.91"></a><span id="l114.91">     var pos = msgData.indexOf(&quot;From:&quot;);</span>
<a href="#l114.92"></a><span id="l114.92" class="difflineminus">-    do_check_neq(pos, -1);</span>
<a href="#l114.93"></a><span id="l114.93" class="difflineplus">+    Assert.notEqual(pos, -1);</span>
<a href="#l114.94"></a><span id="l114.94"> </span>
<a href="#l114.95"></a><span id="l114.95">     msgData = msgData.substr(pos);</span>
<a href="#l114.96"></a><span id="l114.96"> </span>
<a href="#l114.97"></a><span id="l114.97">     // Check the data is matching.</span>
<a href="#l114.98"></a><span id="l114.98" class="difflineminus">-    do_check_eq(originalData, msgData);</span>
<a href="#l114.99"></a><span id="l114.99" class="difflineplus">+    Assert.equal(originalData, msgData);</span>
<a href="#l114.100"></a><span id="l114.100"> </span>
<a href="#l114.101"></a><span id="l114.101">     sendMessageLater();</span>
<a href="#l114.102"></a><span id="l114.102">   } catch (e) {</span>
<a href="#l114.103"></a><span id="l114.103">     do_throw(e);</span>
<a href="#l114.104"></a><span id="l114.104">   } finally {</span>
<a href="#l114.105"></a><span id="l114.105">     server.stop();</span>
<a href="#l114.106"></a><span id="l114.106"> </span>
<a href="#l114.107"></a><span id="l114.107">     var thread = gThreadManager.currentThread;</span>
<a href="#l114.108"></a><span id="l114.108" class="difflineat">@@ -178,33 +178,33 @@ function run_test() {</span>
<a href="#l114.109"></a><span id="l114.109">   // Test file - for bug 429891</span>
<a href="#l114.110"></a><span id="l114.110">   originalData = IOUtils.loadFileToString(testFile);</span>
<a href="#l114.111"></a><span id="l114.111"> </span>
<a href="#l114.112"></a><span id="l114.112">   // Ensure we have a local mail account, an normal account and appropriate</span>
<a href="#l114.113"></a><span id="l114.113">   // servers and identities.</span>
<a href="#l114.114"></a><span id="l114.114">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l114.115"></a><span id="l114.115"> </span>
<a href="#l114.116"></a><span id="l114.116">   // Check that the send later service thinks we don't have messages to send</span>
<a href="#l114.117"></a><span id="l114.117" class="difflineminus">-  do_check_eq(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l114.118"></a><span id="l114.118" class="difflineplus">+  Assert.equal(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l114.119"></a><span id="l114.119"> </span>
<a href="#l114.120"></a><span id="l114.120">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l114.121"></a><span id="l114.121"> </span>
<a href="#l114.122"></a><span id="l114.122">   let account = MailServices.accounts.createAccount();</span>
<a href="#l114.123"></a><span id="l114.123">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l114.124"></a><span id="l114.124"> </span>
<a href="#l114.125"></a><span id="l114.125">   smtpServer = getBasicSmtpServer(1);</span>
<a href="#l114.126"></a><span id="l114.126">   identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l114.127"></a><span id="l114.127"> </span>
<a href="#l114.128"></a><span id="l114.128">   account.addIdentity(identity);</span>
<a href="#l114.129"></a><span id="l114.129">   account.defaultIdentity = identity;</span>
<a href="#l114.130"></a><span id="l114.130">   account.incomingServer = incomingServer;</span>
<a href="#l114.131"></a><span id="l114.131"> </span>
<a href="#l114.132"></a><span id="l114.132">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l114.133"></a><span id="l114.133"> </span>
<a href="#l114.134"></a><span id="l114.134" class="difflineminus">-  do_check_eq(identity.doFcc, true);</span>
<a href="#l114.135"></a><span id="l114.135" class="difflineplus">+  Assert.equal(identity.doFcc, true);</span>
<a href="#l114.136"></a><span id="l114.136"> </span>
<a href="#l114.137"></a><span id="l114.137">   // Now prepare to actually &quot;send&quot; the message later, i.e. dump it in the</span>
<a href="#l114.138"></a><span id="l114.138">   // unsent messages folder.</span>
<a href="#l114.139"></a><span id="l114.139"> </span>
<a href="#l114.140"></a><span id="l114.140">   var compFields = Cc[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l114.141"></a><span id="l114.141">                      .createInstance(Ci.nsIMsgCompFields);</span>
<a href="#l114.142"></a><span id="l114.142"> </span>
<a href="#l114.143"></a><span id="l114.143">   compFields.from = identity.email;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater2.js</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater2.js</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -54,50 +54,50 @@ msll.prototype = {</span>
<a href="#l115.4"></a><span id="l115.4">   checkMessageSend: function(aCurrentMessage) {</span>
<a href="#l115.5"></a><span id="l115.5">     do_check_transaction(server.playTransaction(),</span>
<a href="#l115.6"></a><span id="l115.6">                          [&quot;EHLO test&quot;,</span>
<a href="#l115.7"></a><span id="l115.7">                           &quot;MAIL FROM:&lt;&quot; + kSender + &quot;&gt; BODY=8BITMIME SIZE=&quot; + gMsgFileData[gMsgOrder[aCurrentMessage - 1]].length,</span>
<a href="#l115.8"></a><span id="l115.8">                           &quot;RCPT TO:&lt;&quot; + kTo + &quot;&gt;&quot;,</span>
<a href="#l115.9"></a><span id="l115.9">                           &quot;DATA&quot;]);</span>
<a href="#l115.10"></a><span id="l115.10"> </span>
<a href="#l115.11"></a><span id="l115.11">     // Compare data file to what the server received</span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-    do_check_eq(gMsgFileData[gMsgOrder[aCurrentMessage - 1]], server._daemon.post);</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineplus">+    Assert.equal(gMsgFileData[gMsgOrder[aCurrentMessage - 1]], server._daemon.post);</span>
<a href="#l115.14"></a><span id="l115.14">   },</span>
<a href="#l115.15"></a><span id="l115.15"> </span>
<a href="#l115.16"></a><span id="l115.16">   // nsIMsgSendLaterListener</span>
<a href="#l115.17"></a><span id="l115.17">   onStartSending: function (aTotalMessageCount) {</span>
<a href="#l115.18"></a><span id="l115.18" class="difflineminus">-    do_check_eq(aTotalMessageCount, gMsgOrder.length);</span>
<a href="#l115.19"></a><span id="l115.19" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, true);</span>
<a href="#l115.20"></a><span id="l115.20" class="difflineplus">+    Assert.equal(aTotalMessageCount, gMsgOrder.length);</span>
<a href="#l115.21"></a><span id="l115.21" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, true);</span>
<a href="#l115.22"></a><span id="l115.22">   },</span>
<a href="#l115.23"></a><span id="l115.23">   onMessageStartSending: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l115.24"></a><span id="l115.24">                                    aMessageHeader, aIdentity) {</span>
<a href="#l115.25"></a><span id="l115.25">     if (gLastSentMessage &gt; 0)</span>
<a href="#l115.26"></a><span id="l115.26">       this.checkMessageSend(aCurrentMessage);</span>
<a href="#l115.27"></a><span id="l115.27" class="difflineminus">-    do_check_eq(gLastSentMessage + 1, aCurrentMessage);</span>
<a href="#l115.28"></a><span id="l115.28" class="difflineplus">+    Assert.equal(gLastSentMessage + 1, aCurrentMessage);</span>
<a href="#l115.29"></a><span id="l115.29">     gLastSentMessage = aCurrentMessage;</span>
<a href="#l115.30"></a><span id="l115.30">   },</span>
<a href="#l115.31"></a><span id="l115.31">   onMessageSendProgress: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l115.32"></a><span id="l115.32">                                    aMessageSendPercent, aMessageCopyPercent) {</span>
<a href="#l115.33"></a><span id="l115.33" class="difflineminus">-    do_check_eq(aTotalMessageCount, gMsgOrder.length);</span>
<a href="#l115.34"></a><span id="l115.34" class="difflineminus">-    do_check_eq(gLastSentMessage, aCurrentMessage);</span>
<a href="#l115.35"></a><span id="l115.35" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, true);</span>
<a href="#l115.36"></a><span id="l115.36" class="difflineplus">+    Assert.equal(aTotalMessageCount, gMsgOrder.length);</span>
<a href="#l115.37"></a><span id="l115.37" class="difflineplus">+    Assert.equal(gLastSentMessage, aCurrentMessage);</span>
<a href="#l115.38"></a><span id="l115.38" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, true);</span>
<a href="#l115.39"></a><span id="l115.39">   },</span>
<a href="#l115.40"></a><span id="l115.40">   onMessageSendError: function (aCurrentMessage, aMessageHeader, aStatus,</span>
<a href="#l115.41"></a><span id="l115.41">                                 aMsg) {</span>
<a href="#l115.42"></a><span id="l115.42">     do_throw(&quot;onMessageSendError should not have been called, status: &quot; + aStatus);</span>
<a href="#l115.43"></a><span id="l115.43">   },</span>
<a href="#l115.44"></a><span id="l115.44">   onStopSending: function (aStatus, aMsg, aTotalTried, aSuccessful) {</span>
<a href="#l115.45"></a><span id="l115.45">     try {</span>
<a href="#l115.46"></a><span id="l115.46" class="difflineminus">-      do_check_eq(aStatus, 0);</span>
<a href="#l115.47"></a><span id="l115.47" class="difflineminus">-      do_check_eq(aTotalTried, aSuccessful);</span>
<a href="#l115.48"></a><span id="l115.48" class="difflineminus">-      do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l115.49"></a><span id="l115.49" class="difflineplus">+      Assert.equal(aStatus, 0);</span>
<a href="#l115.50"></a><span id="l115.50" class="difflineplus">+      Assert.equal(aTotalTried, aSuccessful);</span>
<a href="#l115.51"></a><span id="l115.51" class="difflineplus">+      Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l115.52"></a><span id="l115.52"> </span>
<a href="#l115.53"></a><span id="l115.53">       // Check that the send later service now thinks we don't have messages to</span>
<a href="#l115.54"></a><span id="l115.54">       // send.</span>
<a href="#l115.55"></a><span id="l115.55" class="difflineminus">-      do_check_eq(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l115.56"></a><span id="l115.56" class="difflineplus">+      Assert.equal(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l115.57"></a><span id="l115.57"> </span>
<a href="#l115.58"></a><span id="l115.58">       this.checkMessageSend(gLastSentMessage);</span>
<a href="#l115.59"></a><span id="l115.59">     } catch (e) {</span>
<a href="#l115.60"></a><span id="l115.60">       dump(e);</span>
<a href="#l115.61"></a><span id="l115.61">       do_throw(e);</span>
<a href="#l115.62"></a><span id="l115.62">     }</span>
<a href="#l115.63"></a><span id="l115.63">     // The extra timeout here is to work around an issue where sometimes</span>
<a href="#l115.64"></a><span id="l115.64">     // the sendUnsentMessages is completely synchronous up until onStopSending</span>
<a href="#l115.65"></a><span id="l115.65" class="difflineat">@@ -108,26 +108,26 @@ msll.prototype = {</span>
<a href="#l115.66"></a><span id="l115.66">   }</span>
<a href="#l115.67"></a><span id="l115.67"> };</span>
<a href="#l115.68"></a><span id="l115.68"> </span>
<a href="#l115.69"></a><span id="l115.69"> // This function is used to find out when the copying of the message to the</span>
<a href="#l115.70"></a><span id="l115.70"> // unsent message folder is completed, and hence can fire off the actual</span>
<a href="#l115.71"></a><span id="l115.71"> // sending of the message.</span>
<a href="#l115.72"></a><span id="l115.72"> function OnStopCopy(aStatus)</span>
<a href="#l115.73"></a><span id="l115.73"> {</span>
<a href="#l115.74"></a><span id="l115.74" class="difflineminus">-  do_check_eq(aStatus, 0);</span>
<a href="#l115.75"></a><span id="l115.75" class="difflineplus">+  Assert.equal(aStatus, 0);</span>
<a href="#l115.76"></a><span id="l115.76"> </span>
<a href="#l115.77"></a><span id="l115.77">   // Check this is false before we start sending</span>
<a href="#l115.78"></a><span id="l115.78" class="difflineminus">-  do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l115.79"></a><span id="l115.79" class="difflineplus">+  Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l115.80"></a><span id="l115.80"> </span>
<a href="#l115.81"></a><span id="l115.81">   // Check that the send later service thinks we have messages to send.</span>
<a href="#l115.82"></a><span id="l115.82" class="difflineminus">-  do_check_eq(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l115.83"></a><span id="l115.83" class="difflineplus">+  Assert.equal(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l115.84"></a><span id="l115.84"> </span>
<a href="#l115.85"></a><span id="l115.85">   // Check we have a message in the unsent message folder</span>
<a href="#l115.86"></a><span id="l115.86" class="difflineminus">-  do_check_eq(gSentFolder.getTotalMessages(false), gMsgOrder.length);</span>
<a href="#l115.87"></a><span id="l115.87" class="difflineplus">+  Assert.equal(gSentFolder.getTotalMessages(false), gMsgOrder.length);</span>
<a href="#l115.88"></a><span id="l115.88"> </span>
<a href="#l115.89"></a><span id="l115.89">   // Start the next step after a brief time so that functions can finish</span>
<a href="#l115.90"></a><span id="l115.90">   // properly</span>
<a href="#l115.91"></a><span id="l115.91">   async_driver();</span>
<a href="#l115.92"></a><span id="l115.92"> }</span>
<a href="#l115.93"></a><span id="l115.93"> </span>
<a href="#l115.94"></a><span id="l115.94"> function sendMessageLater(aTestFileIndex)</span>
<a href="#l115.95"></a><span id="l115.95"> {</span>
<a href="#l115.96"></a><span id="l115.96" class="difflineat">@@ -187,17 +187,17 @@ function* actually_run_test() {</span>
<a href="#l115.97"></a><span id="l115.97"> </span>
<a href="#l115.98"></a><span id="l115.98">   dump(&quot;Copy Mesage from file to folder\n&quot;);</span>
<a href="#l115.99"></a><span id="l115.99">   yield async_run({func: sendMessageLater, args: [0]});</span>
<a href="#l115.100"></a><span id="l115.100"> </span>
<a href="#l115.101"></a><span id="l115.101">   dump(&quot;Send unsent message\n&quot;);</span>
<a href="#l115.102"></a><span id="l115.102">   yield async_run({func: sendUnsentMessages});</span>
<a href="#l115.103"></a><span id="l115.103"> </span>
<a href="#l115.104"></a><span id="l115.104">   // Check sent folder is now empty.</span>
<a href="#l115.105"></a><span id="l115.105" class="difflineminus">-  do_check_eq(gSentFolder.getTotalMessages(false), 0);</span>
<a href="#l115.106"></a><span id="l115.106" class="difflineplus">+  Assert.equal(gSentFolder.getTotalMessages(false), 0);</span>
<a href="#l115.107"></a><span id="l115.107"> </span>
<a href="#l115.108"></a><span id="l115.108">   // Reset the server</span>
<a href="#l115.109"></a><span id="l115.109">   server.stop();</span>
<a href="#l115.110"></a><span id="l115.110">   server.resetTest();</span>
<a href="#l115.111"></a><span id="l115.111"> </span>
<a href="#l115.112"></a><span id="l115.112">   // and reset counts</span>
<a href="#l115.113"></a><span id="l115.113">   resetCounts();</span>
<a href="#l115.114"></a><span id="l115.114"> </span>
<a href="#l115.115"></a><span id="l115.115" class="difflineat">@@ -220,17 +220,17 @@ function run_test() {</span>
<a href="#l115.116"></a><span id="l115.116">     gMsgFileData[i] = IOUtils.loadFileToString(gMsgFile[i]);</span>
<a href="#l115.117"></a><span id="l115.117">   }</span>
<a href="#l115.118"></a><span id="l115.118"> </span>
<a href="#l115.119"></a><span id="l115.119">   // Ensure we have a local mail account, an normal account and appropriate</span>
<a href="#l115.120"></a><span id="l115.120">   // servers and identities.</span>
<a href="#l115.121"></a><span id="l115.121">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l115.122"></a><span id="l115.122"> </span>
<a href="#l115.123"></a><span id="l115.123">   // Check that the send later service thinks we don't have messages to send.</span>
<a href="#l115.124"></a><span id="l115.124" class="difflineminus">-  do_check_eq(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l115.125"></a><span id="l115.125" class="difflineplus">+  Assert.equal(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l115.126"></a><span id="l115.126"> </span>
<a href="#l115.127"></a><span id="l115.127">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l115.128"></a><span id="l115.128"> </span>
<a href="#l115.129"></a><span id="l115.129">   let account = MailServices.accounts.createAccount();</span>
<a href="#l115.130"></a><span id="l115.130">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l115.131"></a><span id="l115.131"> </span>
<a href="#l115.132"></a><span id="l115.132">   smtpServer = getBasicSmtpServer(1);</span>
<a href="#l115.133"></a><span id="l115.133">   identity = getSmtpIdentity(kSender, smtpServer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater3.js</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater3.js</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineat">@@ -39,72 +39,72 @@ function msll() {</span>
<a href="#l116.4"></a><span id="l116.4"> </span>
<a href="#l116.5"></a><span id="l116.5"> msll.prototype = {</span>
<a href="#l116.6"></a><span id="l116.6">   _initialTotal: 0,</span>
<a href="#l116.7"></a><span id="l116.7">   _errorRaised: false,</span>
<a href="#l116.8"></a><span id="l116.8"> </span>
<a href="#l116.9"></a><span id="l116.9">   // nsIMsgSendLaterListener</span>
<a href="#l116.10"></a><span id="l116.10">   onStartSending: function (aTotal) {</span>
<a href="#l116.11"></a><span id="l116.11">     this._initialTotal = 1;</span>
<a href="#l116.12"></a><span id="l116.12" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, true);</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, true);</span>
<a href="#l116.14"></a><span id="l116.14">   },</span>
<a href="#l116.15"></a><span id="l116.15">   onMessageStartSending: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l116.16"></a><span id="l116.16">                                    aMessageHeader, aIdentity) {</span>
<a href="#l116.17"></a><span id="l116.17">   },</span>
<a href="#l116.18"></a><span id="l116.18">   onMessageSendProgress: function (aCurrentMessage, aTotalMessageCount,</span>
<a href="#l116.19"></a><span id="l116.19">                                    aMessageSendPercent, aMessageCopyPercent) {</span>
<a href="#l116.20"></a><span id="l116.20">   },</span>
<a href="#l116.21"></a><span id="l116.21">   onMessageSendError: function (aCurrentMessage, aMessageHeader, aStatus,</span>
<a href="#l116.22"></a><span id="l116.22">                                 aMsg) {</span>
<a href="#l116.23"></a><span id="l116.23">     this._errorRaised = true;</span>
<a href="#l116.24"></a><span id="l116.24">   },</span>
<a href="#l116.25"></a><span id="l116.25">   onStopSending: function (aStatus, aMsg, aTotal, aSuccessful) {</span>
<a href="#l116.26"></a><span id="l116.26">     print(&quot;msll onStopSending\n&quot;);</span>
<a href="#l116.27"></a><span id="l116.27"> </span>
<a href="#l116.28"></a><span id="l116.28">     // NS_ERROR_SMTP_SEND_FAILED_REFUSED is 2153066798</span>
<a href="#l116.29"></a><span id="l116.29" class="difflineminus">-    do_check_eq(aStatus, 2153066798);</span>
<a href="#l116.30"></a><span id="l116.30" class="difflineminus">-    do_check_eq(aTotal, 1);</span>
<a href="#l116.31"></a><span id="l116.31" class="difflineminus">-    do_check_eq(aSuccessful, 0);</span>
<a href="#l116.32"></a><span id="l116.32" class="difflineminus">-    do_check_eq(this._initialTotal, 1);</span>
<a href="#l116.33"></a><span id="l116.33" class="difflineminus">-    do_check_eq(this._errorRaised, true);</span>
<a href="#l116.34"></a><span id="l116.34" class="difflineminus">-    do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l116.35"></a><span id="l116.35" class="difflineplus">+    Assert.equal(aStatus, 2153066798);</span>
<a href="#l116.36"></a><span id="l116.36" class="difflineplus">+    Assert.equal(aTotal, 1);</span>
<a href="#l116.37"></a><span id="l116.37" class="difflineplus">+    Assert.equal(aSuccessful, 0);</span>
<a href="#l116.38"></a><span id="l116.38" class="difflineplus">+    Assert.equal(this._initialTotal, 1);</span>
<a href="#l116.39"></a><span id="l116.39" class="difflineplus">+    Assert.equal(this._errorRaised, true);</span>
<a href="#l116.40"></a><span id="l116.40" class="difflineplus">+    Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l116.41"></a><span id="l116.41">     // Check that the send later service still thinks we have messages to send.</span>
<a href="#l116.42"></a><span id="l116.42" class="difflineminus">-    do_check_eq(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l116.43"></a><span id="l116.43" class="difflineplus">+    Assert.equal(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l116.44"></a><span id="l116.44"> </span>
<a href="#l116.45"></a><span id="l116.45">     do_test_finished();</span>
<a href="#l116.46"></a><span id="l116.46">   }</span>
<a href="#l116.47"></a><span id="l116.47"> };</span>
<a href="#l116.48"></a><span id="l116.48"> </span>
<a href="#l116.49"></a><span id="l116.49"> function OnStopCopy(aStatus) {</span>
<a href="#l116.50"></a><span id="l116.50" class="difflineminus">-  do_check_eq(aStatus, 0);</span>
<a href="#l116.51"></a><span id="l116.51" class="difflineplus">+  Assert.equal(aStatus, 0);</span>
<a href="#l116.52"></a><span id="l116.52"> </span>
<a href="#l116.53"></a><span id="l116.53">   // Check this is false before we start sending</span>
<a href="#l116.54"></a><span id="l116.54" class="difflineminus">-  do_check_eq(msgSendLater.sendingMessages, false);</span>
<a href="#l116.55"></a><span id="l116.55" class="difflineplus">+  Assert.equal(msgSendLater.sendingMessages, false);</span>
<a href="#l116.56"></a><span id="l116.56"> </span>
<a href="#l116.57"></a><span id="l116.57">   let folder = msgSendLater.getUnsentMessagesFolder(identity);</span>
<a href="#l116.58"></a><span id="l116.58"> </span>
<a href="#l116.59"></a><span id="l116.59">   // Check that the send later service thinks we have messages to send.</span>
<a href="#l116.60"></a><span id="l116.60" class="difflineminus">-  do_check_eq(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l116.61"></a><span id="l116.61" class="difflineplus">+  Assert.equal(msgSendLater.hasUnsentMessages(identity), true);</span>
<a href="#l116.62"></a><span id="l116.62"> </span>
<a href="#l116.63"></a><span id="l116.63">   // Check we have a message in the unsent message folder</span>
<a href="#l116.64"></a><span id="l116.64" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l116.65"></a><span id="l116.65" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l116.66"></a><span id="l116.66"> </span>
<a href="#l116.67"></a><span id="l116.67">   </span>
<a href="#l116.68"></a><span id="l116.68">   // Now do a comparison of what is in the unsent mail folder</span>
<a href="#l116.69"></a><span id="l116.69">   let msgData = mailTestUtils</span>
<a href="#l116.70"></a><span id="l116.70">     .loadMessageToString(folder, mailTestUtils.firstMsgHdr(folder));</span>
<a href="#l116.71"></a><span id="l116.71"> </span>
<a href="#l116.72"></a><span id="l116.72">   // Skip the headers etc that mailnews adds</span>
<a href="#l116.73"></a><span id="l116.73">   var pos = msgData.indexOf(&quot;From:&quot;);</span>
<a href="#l116.74"></a><span id="l116.74" class="difflineminus">-  do_check_neq(pos, -1);</span>
<a href="#l116.75"></a><span id="l116.75" class="difflineplus">+  Assert.notEqual(pos, -1);</span>
<a href="#l116.76"></a><span id="l116.76"> </span>
<a href="#l116.77"></a><span id="l116.77">   msgData = msgData.substr(pos);</span>
<a href="#l116.78"></a><span id="l116.78"> </span>
<a href="#l116.79"></a><span id="l116.79">   // Check the data is matching.</span>
<a href="#l116.80"></a><span id="l116.80" class="difflineminus">-  do_check_eq(originalData, msgData);</span>
<a href="#l116.81"></a><span id="l116.81" class="difflineplus">+  Assert.equal(originalData, msgData);</span>
<a href="#l116.82"></a><span id="l116.82"> </span>
<a href="#l116.83"></a><span id="l116.83">   do_timeout(0, sendMessageLater);</span>
<a href="#l116.84"></a><span id="l116.84"> }</span>
<a href="#l116.85"></a><span id="l116.85"> </span>
<a href="#l116.86"></a><span id="l116.86"> // This function does the actual send later</span>
<a href="#l116.87"></a><span id="l116.87"> function sendMessageLater()</span>
<a href="#l116.88"></a><span id="l116.88"> {</span>
<a href="#l116.89"></a><span id="l116.89">   // No server for this test, just attempt to send unsent and wait.</span>
<a href="#l116.90"></a><span id="l116.90" class="difflineat">@@ -122,17 +122,17 @@ function run_test() {</span>
<a href="#l116.91"></a><span id="l116.91">   // Test file - for bug 429891</span>
<a href="#l116.92"></a><span id="l116.92">   originalData = IOUtils.loadFileToString(testFile);</span>
<a href="#l116.93"></a><span id="l116.93"> </span>
<a href="#l116.94"></a><span id="l116.94">   // Ensure we have a local mail account, an normal account and appropriate</span>
<a href="#l116.95"></a><span id="l116.95">   // servers and identities.</span>
<a href="#l116.96"></a><span id="l116.96">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l116.97"></a><span id="l116.97"> </span>
<a href="#l116.98"></a><span id="l116.98">   // Check that the send later service thinks we don't have messages to send.</span>
<a href="#l116.99"></a><span id="l116.99" class="difflineminus">-  do_check_eq(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l116.100"></a><span id="l116.100" class="difflineplus">+  Assert.equal(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l116.101"></a><span id="l116.101"> </span>
<a href="#l116.102"></a><span id="l116.102">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l116.103"></a><span id="l116.103"> </span>
<a href="#l116.104"></a><span id="l116.104">   let account = MailServices.accounts.createAccount();</span>
<a href="#l116.105"></a><span id="l116.105">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l116.106"></a><span id="l116.106"> </span>
<a href="#l116.107"></a><span id="l116.107">   var smtpServer = getBasicSmtpServer();</span>
<a href="#l116.108"></a><span id="l116.108">   identity = getSmtpIdentity(kSender, smtpServer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPassword2.js</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPassword2.js</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -29,40 +29,40 @@ add_task(function *() {</span>
<a href="#l117.4"></a><span id="l117.4">   smtpServer2.username = kUser2;</span>
<a href="#l117.5"></a><span id="l117.5"> </span>
<a href="#l117.6"></a><span id="l117.6">   var i;</span>
<a href="#l117.7"></a><span id="l117.7">   var count = {};</span>
<a href="#l117.8"></a><span id="l117.8"> </span>
<a href="#l117.9"></a><span id="l117.9">   // Test - Check there are two logins to begin with.</span>
<a href="#l117.10"></a><span id="l117.10">   let logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l117.11"></a><span id="l117.11"> </span>
<a href="#l117.12"></a><span id="l117.12" class="difflineminus">-  do_check_eq(count.value, 2);</span>
<a href="#l117.13"></a><span id="l117.13" class="difflineplus">+  Assert.equal(count.value, 2);</span>
<a href="#l117.14"></a><span id="l117.14"> </span>
<a href="#l117.15"></a><span id="l117.15">   // These will either be one way around or the other.</span>
<a href="#l117.16"></a><span id="l117.16">   if (logins[0].username == kUser1) {</span>
<a href="#l117.17"></a><span id="l117.17" class="difflineminus">-    do_check_eq(logins[1].username, kUser2);</span>
<a href="#l117.18"></a><span id="l117.18" class="difflineplus">+    Assert.equal(logins[1].username, kUser2);</span>
<a href="#l117.19"></a><span id="l117.19">   } else {</span>
<a href="#l117.20"></a><span id="l117.20" class="difflineminus">-    do_check_eq(logins[0].username, kUser2);</span>
<a href="#l117.21"></a><span id="l117.21" class="difflineminus">-    do_check_eq(logins[1].username, kUser1);</span>
<a href="#l117.22"></a><span id="l117.22" class="difflineplus">+    Assert.equal(logins[0].username, kUser2);</span>
<a href="#l117.23"></a><span id="l117.23" class="difflineplus">+    Assert.equal(logins[1].username, kUser1);</span>
<a href="#l117.24"></a><span id="l117.24">   }</span>
<a href="#l117.25"></a><span id="l117.25"> </span>
<a href="#l117.26"></a><span id="l117.26">   // Test - Remove a login via the incoming server</span>
<a href="#l117.27"></a><span id="l117.27">   smtpServer1.forgetPassword();</span>
<a href="#l117.28"></a><span id="l117.28"> </span>
<a href="#l117.29"></a><span id="l117.29">   logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l117.30"></a><span id="l117.30"> </span>
<a href="#l117.31"></a><span id="l117.31">   // should be one login left for kUser2</span>
<a href="#l117.32"></a><span id="l117.32" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l117.33"></a><span id="l117.33" class="difflineminus">-  do_check_eq(logins[0].username, kUser2);</span>
<a href="#l117.34"></a><span id="l117.34" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l117.35"></a><span id="l117.35" class="difflineplus">+  Assert.equal(logins[0].username, kUser2);</span>
<a href="#l117.36"></a><span id="l117.36"> </span>
<a href="#l117.37"></a><span id="l117.37">   // Test - Remove the other login via the incoming server</span>
<a href="#l117.38"></a><span id="l117.38">   smtpServer2.forgetPassword();</span>
<a href="#l117.39"></a><span id="l117.39"> </span>
<a href="#l117.40"></a><span id="l117.40">   logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l117.41"></a><span id="l117.41"> </span>
<a href="#l117.42"></a><span id="l117.42">   // There should be no login left.</span>
<a href="#l117.43"></a><span id="l117.43" class="difflineminus">-  do_check_eq(count.value, 0);</span>
<a href="#l117.44"></a><span id="l117.44" class="difflineminus">-  do_check_eq(logins.length, 0);</span>
<a href="#l117.45"></a><span id="l117.45" class="difflineplus">+  Assert.equal(count.value, 0);</span>
<a href="#l117.46"></a><span id="l117.46" class="difflineplus">+  Assert.equal(logins.length, 0);</span>
<a href="#l117.47"></a><span id="l117.47"> });</span>
<a href="#l117.48"></a><span id="l117.48"> </span>
<a href="#l117.49"></a><span id="l117.49"> function run_test() {</span>
<a href="#l117.50"></a><span id="l117.50">   run_next_test();</span>
<a href="#l117.51"></a><span id="l117.51"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPasswordFailure1.js</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPasswordFailure1.js</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineat">@@ -27,17 +27,17 @@ var kUsername = &quot;testsmtp&quot;;</span>
<a href="#l118.4"></a><span id="l118.4"> // json file.</span>
<a href="#l118.5"></a><span id="l118.5"> var kInvalidPassword = &quot;smtptest&quot;;</span>
<a href="#l118.6"></a><span id="l118.6"> var kValidPassword = &quot;smtptest1&quot;;</span>
<a href="#l118.7"></a><span id="l118.7"> </span>
<a href="#l118.8"></a><span id="l118.8"> function alert(aDialogText, aText)</span>
<a href="#l118.9"></a><span id="l118.9"> {</span>
<a href="#l118.10"></a><span id="l118.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l118.11"></a><span id="l118.11">   // attempt shouldn't.</span>
<a href="#l118.12"></a><span id="l118.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l118.13"></a><span id="l118.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l118.14"></a><span id="l118.14"> </span>
<a href="#l118.15"></a><span id="l118.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l118.16"></a><span id="l118.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l118.17"></a><span id="l118.17"> }</span>
<a href="#l118.18"></a><span id="l118.18"> </span>
<a href="#l118.19"></a><span id="l118.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l118.20"></a><span id="l118.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l118.21"></a><span id="l118.21">   switch (++attempt) {</span>
<a href="#l118.22"></a><span id="l118.22" class="difflineat">@@ -97,28 +97,28 @@ add_task(function *() {</span>
<a href="#l118.23"></a><span id="l118.23">     MailServices.smtp.sendMailMessage(testFile, kTo, identity,</span>
<a href="#l118.24"></a><span id="l118.24">                                       null, null, null, null,</span>
<a href="#l118.25"></a><span id="l118.25">                                       false, {}, {});</span>
<a href="#l118.26"></a><span id="l118.26"> </span>
<a href="#l118.27"></a><span id="l118.27">     server.performTest();</span>
<a href="#l118.28"></a><span id="l118.28"> </span>
<a href="#l118.29"></a><span id="l118.29">     dump(&quot;End Send\n&quot;);</span>
<a href="#l118.30"></a><span id="l118.30"> </span>
<a href="#l118.31"></a><span id="l118.31" class="difflineminus">-    do_check_eq(attempt, 2);</span>
<a href="#l118.32"></a><span id="l118.32" class="difflineplus">+    Assert.equal(attempt, 2);</span>
<a href="#l118.33"></a><span id="l118.33"> </span>
<a href="#l118.34"></a><span id="l118.34">     // Check that we haven't forgetton the login even though we've retried and</span>
<a href="#l118.35"></a><span id="l118.35">     // canceled.</span>
<a href="#l118.36"></a><span id="l118.36">     let count = {};</span>
<a href="#l118.37"></a><span id="l118.37">     let logins = Services.logins</span>
<a href="#l118.38"></a><span id="l118.38">                          .findLogins(count, &quot;smtp://localhost&quot;, null,</span>
<a href="#l118.39"></a><span id="l118.39">                                      &quot;smtp://localhost&quot;);</span>
<a href="#l118.40"></a><span id="l118.40"> </span>
<a href="#l118.41"></a><span id="l118.41" class="difflineminus">-    do_check_eq(count.value, 1);</span>
<a href="#l118.42"></a><span id="l118.42" class="difflineminus">-    do_check_eq(logins[0].username, kUsername);</span>
<a href="#l118.43"></a><span id="l118.43" class="difflineminus">-    do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l118.44"></a><span id="l118.44" class="difflineplus">+    Assert.equal(count.value, 1);</span>
<a href="#l118.45"></a><span id="l118.45" class="difflineplus">+    Assert.equal(logins[0].username, kUsername);</span>
<a href="#l118.46"></a><span id="l118.46" class="difflineplus">+    Assert.equal(logins[0].password, kInvalidPassword);</span>
<a href="#l118.47"></a><span id="l118.47">   } catch (e) {</span>
<a href="#l118.48"></a><span id="l118.48">     do_throw(e);</span>
<a href="#l118.49"></a><span id="l118.49">   } finally {</span>
<a href="#l118.50"></a><span id="l118.50">     server.stop();</span>
<a href="#l118.51"></a><span id="l118.51"> </span>
<a href="#l118.52"></a><span id="l118.52">     var thread = gThreadManager.currentThread;</span>
<a href="#l118.53"></a><span id="l118.53">     while (thread.hasPendingEvents())</span>
<a href="#l118.54"></a><span id="l118.54">       thread.processNextEvent(true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPasswordFailure2.js</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPasswordFailure2.js</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -27,17 +27,17 @@ var kUsername = &quot;testsmtp&quot;;</span>
<a href="#l119.4"></a><span id="l119.4"> // file.</span>
<a href="#l119.5"></a><span id="l119.5"> var kInvalidPassword = &quot;smtptest&quot;;</span>
<a href="#l119.6"></a><span id="l119.6"> var kValidPassword = &quot;smtptest1&quot;;</span>
<a href="#l119.7"></a><span id="l119.7"> </span>
<a href="#l119.8"></a><span id="l119.8"> function alert(aDialogText, aText)</span>
<a href="#l119.9"></a><span id="l119.9"> {</span>
<a href="#l119.10"></a><span id="l119.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l119.11"></a><span id="l119.11">   // attempt shouldn't.</span>
<a href="#l119.12"></a><span id="l119.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l119.13"></a><span id="l119.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l119.14"></a><span id="l119.14"> </span>
<a href="#l119.15"></a><span id="l119.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l119.16"></a><span id="l119.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l119.17"></a><span id="l119.17"> }</span>
<a href="#l119.18"></a><span id="l119.18"> </span>
<a href="#l119.19"></a><span id="l119.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l119.20"></a><span id="l119.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l119.21"></a><span id="l119.21">   switch (++attempt) {</span>
<a href="#l119.22"></a><span id="l119.22" class="difflineat">@@ -109,17 +109,17 @@ add_task(function *() {</span>
<a href="#l119.23"></a><span id="l119.23">     MailServices.smtp.sendMailMessage(testFile, kTo, identity,</span>
<a href="#l119.24"></a><span id="l119.24">                                       null, null, null, null,</span>
<a href="#l119.25"></a><span id="l119.25">                                       false, {}, {});</span>
<a href="#l119.26"></a><span id="l119.26"> </span>
<a href="#l119.27"></a><span id="l119.27">     server.performTest();</span>
<a href="#l119.28"></a><span id="l119.28"> </span>
<a href="#l119.29"></a><span id="l119.29">     dump(&quot;End Send\n&quot;);</span>
<a href="#l119.30"></a><span id="l119.30"> </span>
<a href="#l119.31"></a><span id="l119.31" class="difflineminus">-    do_check_eq(attempt, 2);</span>
<a href="#l119.32"></a><span id="l119.32" class="difflineplus">+    Assert.equal(attempt, 2);</span>
<a href="#l119.33"></a><span id="l119.33"> </span>
<a href="#l119.34"></a><span id="l119.34">     var transaction = server.playTransaction();</span>
<a href="#l119.35"></a><span id="l119.35">     do_check_transaction(transaction, [&quot;EHLO test&quot;,</span>
<a href="#l119.36"></a><span id="l119.36">                                        // attempt 3 invalid password</span>
<a href="#l119.37"></a><span id="l119.37">                                        &quot;AUTH PLAIN &quot; + AuthPLAIN.encodeLine(kUsername, kInvalidPassword),</span>
<a href="#l119.38"></a><span id="l119.38">                                        &quot;AUTH LOGIN&quot;,</span>
<a href="#l119.39"></a><span id="l119.39">                                        // attempt 4 which retries</span>
<a href="#l119.40"></a><span id="l119.40">                                        &quot;AUTH PLAIN &quot; + AuthPLAIN.encodeLine(kUsername, kInvalidPassword),</span>
<a href="#l119.41"></a><span id="l119.41" class="difflineat">@@ -132,19 +132,19 @@ add_task(function *() {</span>
<a href="#l119.42"></a><span id="l119.42"> </span>
<a href="#l119.43"></a><span id="l119.43"> </span>
<a href="#l119.44"></a><span id="l119.44">       // Now check the new one has been saved.</span>
<a href="#l119.45"></a><span id="l119.45">       let count = {};</span>
<a href="#l119.46"></a><span id="l119.46">       let logins = Services.logins</span>
<a href="#l119.47"></a><span id="l119.47">                            .findLogins(count, &quot;smtp://localhost&quot;, null,</span>
<a href="#l119.48"></a><span id="l119.48">                                        &quot;smtp://localhost&quot;);</span>
<a href="#l119.49"></a><span id="l119.49"> </span>
<a href="#l119.50"></a><span id="l119.50" class="difflineminus">-    do_check_eq(count.value, 1);</span>
<a href="#l119.51"></a><span id="l119.51" class="difflineminus">-    do_check_eq(logins[0].username, kUsername);</span>
<a href="#l119.52"></a><span id="l119.52" class="difflineminus">-    do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l119.53"></a><span id="l119.53" class="difflineplus">+    Assert.equal(count.value, 1);</span>
<a href="#l119.54"></a><span id="l119.54" class="difflineplus">+    Assert.equal(logins[0].username, kUsername);</span>
<a href="#l119.55"></a><span id="l119.55" class="difflineplus">+    Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l119.56"></a><span id="l119.56">     do_test_finished();</span>
<a href="#l119.57"></a><span id="l119.57"> </span>
<a href="#l119.58"></a><span id="l119.58">   } catch (e) {</span>
<a href="#l119.59"></a><span id="l119.59">     do_throw(e);</span>
<a href="#l119.60"></a><span id="l119.60">   } finally {</span>
<a href="#l119.61"></a><span id="l119.61">     server.stop();</span>
<a href="#l119.62"></a><span id="l119.62"> </span>
<a href="#l119.63"></a><span id="l119.63">     var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPasswordFailure3.js</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPasswordFailure3.js</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -25,17 +25,17 @@ var kUsername = &quot;testsmtp&quot;;</span>
<a href="#l120.4"></a><span id="l120.4"> // file.</span>
<a href="#l120.5"></a><span id="l120.5"> var kInvalidPassword = &quot;smtptest&quot;;</span>
<a href="#l120.6"></a><span id="l120.6"> var kValidPassword = &quot;smtptest1&quot;;</span>
<a href="#l120.7"></a><span id="l120.7"> </span>
<a href="#l120.8"></a><span id="l120.8"> function alert(aDialogText, aText)</span>
<a href="#l120.9"></a><span id="l120.9"> {</span>
<a href="#l120.10"></a><span id="l120.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l120.11"></a><span id="l120.11">   // attempt shouldn't.</span>
<a href="#l120.12"></a><span id="l120.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l120.13"></a><span id="l120.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l120.14"></a><span id="l120.14"> </span>
<a href="#l120.15"></a><span id="l120.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l120.16"></a><span id="l120.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l120.17"></a><span id="l120.17"> }</span>
<a href="#l120.18"></a><span id="l120.18"> </span>
<a href="#l120.19"></a><span id="l120.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l120.20"></a><span id="l120.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l120.21"></a><span id="l120.21">   switch (++attempt) {</span>
<a href="#l120.22"></a><span id="l120.22" class="difflineat">@@ -109,26 +109,26 @@ add_task(function *() {</span>
<a href="#l120.23"></a><span id="l120.23">   server.performTest();</span>
<a href="#l120.24"></a><span id="l120.24"> });</span>
<a href="#l120.25"></a><span id="l120.25"> </span>
<a href="#l120.26"></a><span id="l120.26"> var URLListener = {</span>
<a href="#l120.27"></a><span id="l120.27">   OnStartRunningUrl: function(url) { },</span>
<a href="#l120.28"></a><span id="l120.28">   OnStopRunningUrl: function(url, rc)</span>
<a href="#l120.29"></a><span id="l120.29">   {</span>
<a href="#l120.30"></a><span id="l120.30">     // Check for ok status.</span>
<a href="#l120.31"></a><span id="l120.31" class="difflineminus">-    do_check_eq(rc, 0);</span>
<a href="#l120.32"></a><span id="l120.32" class="difflineplus">+    Assert.equal(rc, 0);</span>
<a href="#l120.33"></a><span id="l120.33">     // Now check the new password has been saved.</span>
<a href="#l120.34"></a><span id="l120.34">     let count = {};</span>
<a href="#l120.35"></a><span id="l120.35">     let logins = Services.logins</span>
<a href="#l120.36"></a><span id="l120.36">                          .findLogins(count, &quot;smtp://localhost&quot;, null,</span>
<a href="#l120.37"></a><span id="l120.37">                                      &quot;smtp://localhost&quot;);</span>
<a href="#l120.38"></a><span id="l120.38"> </span>
<a href="#l120.39"></a><span id="l120.39" class="difflineminus">-    do_check_eq(count.value, 1);</span>
<a href="#l120.40"></a><span id="l120.40" class="difflineminus">-    do_check_eq(logins[0].username, kUsername);</span>
<a href="#l120.41"></a><span id="l120.41" class="difflineminus">-    do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l120.42"></a><span id="l120.42" class="difflineplus">+    Assert.equal(count.value, 1);</span>
<a href="#l120.43"></a><span id="l120.43" class="difflineplus">+    Assert.equal(logins[0].username, kUsername);</span>
<a href="#l120.44"></a><span id="l120.44" class="difflineplus">+    Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l120.45"></a><span id="l120.45"> </span>
<a href="#l120.46"></a><span id="l120.46">     server.stop();</span>
<a href="#l120.47"></a><span id="l120.47"> </span>
<a href="#l120.48"></a><span id="l120.48">     var thread = gThreadManager.currentThread;</span>
<a href="#l120.49"></a><span id="l120.49">     while (thread.hasPendingEvents())</span>
<a href="#l120.50"></a><span id="l120.50">       thread.processNextEvent(true);</span>
<a href="#l120.51"></a><span id="l120.51"> </span>
<a href="#l120.52"></a><span id="l120.52">     do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpProtocols.js</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpProtocols.js</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -23,35 +23,35 @@ var protocols =</span>
<a href="#l121.4"></a><span id="l121.4"> function run_test() {</span>
<a href="#l121.5"></a><span id="l121.5">   for (var part = 0; part &lt; protocols.length; ++part) {</span>
<a href="#l121.6"></a><span id="l121.6">     print(&quot;protocol: &quot; + protocols[part].protocol);</span>
<a href="#l121.7"></a><span id="l121.7"> </span>
<a href="#l121.8"></a><span id="l121.8">     var pH = Cc[&quot;@mozilla.org/network/protocol;1?name=&quot; +</span>
<a href="#l121.9"></a><span id="l121.9">                 protocols[part].protocol]</span>
<a href="#l121.10"></a><span id="l121.10">                .createInstance(Ci.nsIProtocolHandler);</span>
<a href="#l121.11"></a><span id="l121.11"> </span>
<a href="#l121.12"></a><span id="l121.12" class="difflineminus">-    do_check_eq(pH.scheme, protocols[part].protocol);</span>
<a href="#l121.13"></a><span id="l121.13" class="difflineminus">-    do_check_eq(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l121.14"></a><span id="l121.14" class="difflineminus">-    do_check_eq(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l121.15"></a><span id="l121.15" class="difflineplus">+    Assert.equal(pH.scheme, protocols[part].protocol);</span>
<a href="#l121.16"></a><span id="l121.16" class="difflineplus">+    Assert.equal(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l121.17"></a><span id="l121.17" class="difflineplus">+    Assert.equal(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l121.18"></a><span id="l121.18"> </span>
<a href="#l121.19"></a><span id="l121.19">     // Whip through some of the ports to check we get the right results.</span>
<a href="#l121.20"></a><span id="l121.20">     for (let i = 0; i &lt; 1024; ++i)</span>
<a href="#l121.21"></a><span id="l121.21" class="difflineminus">-      do_check_eq(pH.allowPort(i, &quot;&quot;), (i == protocols[part].defaultPort));</span>
<a href="#l121.22"></a><span id="l121.22" class="difflineplus">+      Assert.equal(pH.allowPort(i, &quot;&quot;), (i == protocols[part].defaultPort));</span>
<a href="#l121.23"></a><span id="l121.23"> </span>
<a href="#l121.24"></a><span id="l121.24">     // Check we get a URI when we ask for one</span>
<a href="#l121.25"></a><span id="l121.25">     var uri = pH.newURI(protocols[part].urlSpec);</span>
<a href="#l121.26"></a><span id="l121.26"> </span>
<a href="#l121.27"></a><span id="l121.27">     uri.QueryInterface(Ci.nsISmtpUrl);</span>
<a href="#l121.28"></a><span id="l121.28"> </span>
<a href="#l121.29"></a><span id="l121.29" class="difflineminus">-    do_check_eq(uri.spec, protocols[part].urlSpec);</span>
<a href="#l121.30"></a><span id="l121.30" class="difflineplus">+    Assert.equal(uri.spec, protocols[part].urlSpec);</span>
<a href="#l121.31"></a><span id="l121.31"> </span>
<a href="#l121.32"></a><span id="l121.32">     try {</span>
<a href="#l121.33"></a><span id="l121.33">       // This call should throw NS_ERROR_NOT_IMPLEMENTED. If it doesn't,</span>
<a href="#l121.34"></a><span id="l121.34">       // then we should implement a new test for it.</span>
<a href="#l121.35"></a><span id="l121.35">       pH.newChannel(uri);</span>
<a href="#l121.36"></a><span id="l121.36">       // If it didn't throw, then shout about it.</span>
<a href="#l121.37"></a><span id="l121.37">       do_throw(&quot;newChannel not throwing NS_ERROR_NOT_IMPLEMENTED.&quot;);</span>
<a href="#l121.38"></a><span id="l121.38">     }</span>
<a href="#l121.39"></a><span id="l121.39">     catch (ex) {</span>
<a href="#l121.40"></a><span id="l121.40" class="difflineminus">-      do_check_eq(ex.result, Cr.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l121.41"></a><span id="l121.41" class="difflineplus">+      Assert.equal(ex.result, Cr.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l121.42"></a><span id="l121.42">     }</span>
<a href="#l121.43"></a><span id="l121.43">   }</span>
<a href="#l121.44"></a><span id="l121.44"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpURL.js</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpURL.js</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -16,12 +16,12 @@ var smtpURLs =</span>
<a href="#l122.4"></a><span id="l122.4"> </span>
<a href="#l122.5"></a><span id="l122.5"> function run_test() {</span>
<a href="#l122.6"></a><span id="l122.6">   var url;</span>
<a href="#l122.7"></a><span id="l122.7">   for (var part = 0; part &lt; smtpURLs.length; ++part) {</span>
<a href="#l122.8"></a><span id="l122.8">     print(&quot;url: &quot; + smtpURLs[part].url);</span>
<a href="#l122.9"></a><span id="l122.9"> </span>
<a href="#l122.10"></a><span id="l122.10">     url = Services.io.newURI(smtpURLs[part].url);</span>
<a href="#l122.11"></a><span id="l122.11"> </span>
<a href="#l122.12"></a><span id="l122.12" class="difflineminus">-    do_check_eq(url.spec, smtpURLs[part].spec);</span>
<a href="#l122.13"></a><span id="l122.13" class="difflineminus">-    do_check_eq(url.username, smtpURLs[part].username);</span>
<a href="#l122.14"></a><span id="l122.14" class="difflineplus">+    Assert.equal(url.spec, smtpURLs[part].spec);</span>
<a href="#l122.15"></a><span id="l122.15" class="difflineplus">+    Assert.equal(url.username, smtpURLs[part].username);</span>
<a href="#l122.16"></a><span id="l122.16">   }</span>
<a href="#l122.17"></a><span id="l122.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_splitRecipients.js</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_splitRecipients.js</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -106,15 +106,15 @@ function run_test() {</span>
<a href="#l123.4"></a><span id="l123.4"> </span>
<a href="#l123.5"></a><span id="l123.5">   for (var part = 0; part &lt; splitRecipientsTests.length; ++part) {</span>
<a href="#l123.6"></a><span id="l123.6">     var count = {};</span>
<a href="#l123.7"></a><span id="l123.7">     print(&quot;Test: &quot; + splitRecipientsTests[part].recipients);</span>
<a href="#l123.8"></a><span id="l123.8">     var result = fields.splitRecipients(splitRecipientsTests[part].recipients,</span>
<a href="#l123.9"></a><span id="l123.9">                                         splitRecipientsTests[part].emailAddressOnly,</span>
<a href="#l123.10"></a><span id="l123.10">                                         count);</span>
<a href="#l123.11"></a><span id="l123.11"> </span>
<a href="#l123.12"></a><span id="l123.12" class="difflineminus">-    do_check_eq(splitRecipientsTests[part].count, count.value);</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineminus">-    do_check_eq(splitRecipientsTests[part].count, result.length);</span>
<a href="#l123.14"></a><span id="l123.14" class="difflineplus">+    Assert.equal(splitRecipientsTests[part].count, count.value);</span>
<a href="#l123.15"></a><span id="l123.15" class="difflineplus">+    Assert.equal(splitRecipientsTests[part].count, result.length);</span>
<a href="#l123.16"></a><span id="l123.16"> </span>
<a href="#l123.17"></a><span id="l123.17">     for (var item = 0; item &lt; count.value; ++item)</span>
<a href="#l123.18"></a><span id="l123.18" class="difflineminus">-      do_check_eq(splitRecipientsTests[part].result[item], result[item]);</span>
<a href="#l123.19"></a><span id="l123.19" class="difflineplus">+      Assert.equal(splitRecipientsTests[part].result[item], result[item]);</span>
<a href="#l123.20"></a><span id="l123.20">   }</span>
<a href="#l123.21"></a><span id="l123.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_staleTemporaryFileCleanup.js</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -30,17 +30,17 @@ function collect_expected_temporary_file</span>
<a href="#l124.4"></a><span id="l124.4">   files.push(create_temporary_files_for(&quot;nscopy.tmp&quot;));</span>
<a href="#l124.5"></a><span id="l124.5">   files.push(create_temporary_files_for(&quot;nscopy.tmp&quot;));</span>
<a href="#l124.6"></a><span id="l124.6"> </span>
<a href="#l124.7"></a><span id="l124.7">   return files;</span>
<a href="#l124.8"></a><span id="l124.8"> }</span>
<a href="#l124.9"></a><span id="l124.9"> </span>
<a href="#l124.10"></a><span id="l124.10"> function check_files_not_exist(files) {</span>
<a href="#l124.11"></a><span id="l124.11">   files.forEach(function(file) {</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineminus">-    do_check_false(file.exists());</span>
<a href="#l124.13"></a><span id="l124.13" class="difflineplus">+    Assert.ok(!file.exists());</span>
<a href="#l124.14"></a><span id="l124.14">   });</span>
<a href="#l124.15"></a><span id="l124.15"> }</span>
<a href="#l124.16"></a><span id="l124.16"> </span>
<a href="#l124.17"></a><span id="l124.17"> function run_test() {</span>
<a href="#l124.18"></a><span id="l124.18">   gExpectedFiles = collect_expected_temporary_files();</span>
<a href="#l124.19"></a><span id="l124.19">   do_register_cleanup(function() {</span>
<a href="#l124.20"></a><span id="l124.20">     gExpectedFiles.forEach(function(file) {</span>
<a href="#l124.21"></a><span id="l124.21">       if (file.exists())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_temporaryFilesRemoved.js</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_temporaryFilesRemoved.js</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -49,17 +49,17 @@ function collect_expected_temporary_file</span>
<a href="#l125.4"></a><span id="l125.4">   files.push(get_temporary_files_for(&quot;nsemail.eml&quot;));</span>
<a href="#l125.5"></a><span id="l125.5">   files.push(get_temporary_files_for(&quot;nscopy.tmp&quot;));</span>
<a href="#l125.6"></a><span id="l125.6"> </span>
<a href="#l125.7"></a><span id="l125.7">   return files;</span>
<a href="#l125.8"></a><span id="l125.8"> }</span>
<a href="#l125.9"></a><span id="l125.9"> </span>
<a href="#l125.10"></a><span id="l125.10"> function check_files_not_exist(files) {</span>
<a href="#l125.11"></a><span id="l125.11">   files.forEach(function(file) {</span>
<a href="#l125.12"></a><span id="l125.12" class="difflineminus">-    do_check_false(file.exists());</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineplus">+    Assert.ok(!file.exists());</span>
<a href="#l125.14"></a><span id="l125.14">   });</span>
<a href="#l125.15"></a><span id="l125.15"> }</span>
<a href="#l125.16"></a><span id="l125.16"> </span>
<a href="#l125.17"></a><span id="l125.17"> function check_result() {</span>
<a href="#l125.18"></a><span id="l125.18">   // temp files should be deleted as soon as the draft is finished saving.</span>
<a href="#l125.19"></a><span id="l125.19">   check_files_not_exist(gExpectedFiles);</span>
<a href="#l125.20"></a><span id="l125.20"> </span>
<a href="#l125.21"></a><span id="l125.21">   do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_gloda_content.js</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_gloda_content.js</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -152,17 +152,17 @@ function verify_message_content(aInfo, a</span>
<a href="#l126.4"></a><span id="l126.4">   if (aMimeMsg == null)</span>
<a href="#l126.5"></a><span id="l126.5">     do_throw(&quot;Message streaming should work; check test_mime_emitter.js first&quot;);</span>
<a href="#l126.6"></a><span id="l126.6"> </span>
<a href="#l126.7"></a><span id="l126.7">   whittleCount = 0;</span>
<a href="#l126.8"></a><span id="l126.8">   let content = Gloda.getMessageContent(aGlodaMsg, aMimeMsg);</span>
<a href="#l126.9"></a><span id="l126.9">   if (whittleCount != 1)</span>
<a href="#l126.10"></a><span id="l126.10">     do_throw(&quot;Whittle count is &quot; + whittleCount + &quot; but should be 1!&quot;);</span>
<a href="#l126.11"></a><span id="l126.11"> </span>
<a href="#l126.12"></a><span id="l126.12" class="difflineminus">-  do_check_eq(content.getContentString(), aInfo.expected);</span>
<a href="#l126.13"></a><span id="l126.13" class="difflineplus">+  Assert.equal(content.getContentString(), aInfo.expected);</span>
<a href="#l126.14"></a><span id="l126.14"> }</span>
<a href="#l126.15"></a><span id="l126.15"> </span>
<a href="#l126.16"></a><span id="l126.16"> /* ===== Driver ===== */</span>
<a href="#l126.17"></a><span id="l126.17"> </span>
<a href="#l126.18"></a><span id="l126.18"> var tests = [</span>
<a href="#l126.19"></a><span id="l126.19">   parameterizeTest(setup_create_message, messageInfos),</span>
<a href="#l126.20"></a><span id="l126.20">   setup_inject_messages,</span>
<a href="#l126.21"></a><span id="l126.21">   parameterizeTest(test_stream_message, messageInfos),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_index_junk.js</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_index_junk.js</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -102,17 +102,17 @@ function* test_mark_as_junk_is_deletion_</span>
<a href="#l127.4"></a><span id="l127.4">   yield wait_for_gloda_indexer([], {deleted: msgSet});</span>
<a href="#l127.5"></a><span id="l127.5"> </span>
<a href="#l127.6"></a><span id="l127.6"> </span>
<a href="#l127.7"></a><span id="l127.7">   mark_sub_test_start(&quot;mark as non-junk gets indexed&quot;);</span>
<a href="#l127.8"></a><span id="l127.8">   msgSet.setJunk(false);</span>
<a href="#l127.9"></a><span id="l127.9">   yield wait_for_gloda_indexer([msgSet], {augment: true});</span>
<a href="#l127.10"></a><span id="l127.10"> </span>
<a href="#l127.11"></a><span id="l127.11">   // we should have reused the existing gloda message so it should keep the id</span>
<a href="#l127.12"></a><span id="l127.12" class="difflineminus">-  do_check_eq(glodaId, msgSet.glodaMessages[0].id);</span>
<a href="#l127.13"></a><span id="l127.13" class="difflineplus">+  Assert.equal(glodaId, msgSet.glodaMessages[0].id);</span>
<a href="#l127.14"></a><span id="l127.14"> }</span>
<a href="#l127.15"></a><span id="l127.15"> </span>
<a href="#l127.16"></a><span id="l127.16"> /**</span>
<a href="#l127.17"></a><span id="l127.17">  * Moving a message to the junk folder is equivalent to deletion.  Gloda does</span>
<a href="#l127.18"></a><span id="l127.18">  *  not index junk folders at all, which is why this is an important and</span>
<a href="#l127.19"></a><span id="l127.19">  *  independent determination from marking a message directly as junk.</span>
<a href="#l127.20"></a><span id="l127.20">  *</span>
<a href="#l127.21"></a><span id="l127.21">  * The move to the junk folder is performed without using any explicit junk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_index_messages.js</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_index_messages.js</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -40,43 +40,43 @@ var goOffline = false;</span>
<a href="#l128.4"></a><span id="l128.4"> function* test_pending_commit_tracker_flushes_correctly() {</span>
<a href="#l128.5"></a><span id="l128.5">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l128.6"></a><span id="l128.6">   yield wait_for_message_injection();</span>
<a href="#l128.7"></a><span id="l128.7">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l128.8"></a><span id="l128.8"> </span>
<a href="#l128.9"></a><span id="l128.9">   // before the flush, there should be no gloda-id property</span>
<a href="#l128.10"></a><span id="l128.10">   let msgHdr = msgSet.getMsgHdr(0);</span>
<a href="#l128.11"></a><span id="l128.11">   // get it as a string to make sure it's empty rather than possessing a value</span>
<a href="#l128.12"></a><span id="l128.12" class="difflineminus">-  do_check_eq(msgHdr.getStringProperty(&quot;gloda-id&quot;), &quot;&quot;);</span>
<a href="#l128.13"></a><span id="l128.13" class="difflineplus">+  Assert.equal(msgHdr.getStringProperty(&quot;gloda-id&quot;), &quot;&quot;);</span>
<a href="#l128.14"></a><span id="l128.14"> </span>
<a href="#l128.15"></a><span id="l128.15">   yield wait_for_gloda_db_flush();</span>
<a href="#l128.16"></a><span id="l128.16"> </span>
<a href="#l128.17"></a><span id="l128.17">   // after the flush there should be a gloda-id property and it should</span>
<a href="#l128.18"></a><span id="l128.18">   //  equal the gloda id</span>
<a href="#l128.19"></a><span id="l128.19">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l128.20"></a><span id="l128.20" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-id&quot;), gmsg.id);</span>
<a href="#l128.21"></a><span id="l128.21" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-id&quot;), gmsg.id);</span>
<a href="#l128.22"></a><span id="l128.22"> </span>
<a href="#l128.23"></a><span id="l128.23">   // make sure no dirty property was written...</span>
<a href="#l128.24"></a><span id="l128.24" class="difflineminus">-  do_check_eq(msgHdr.getStringProperty(&quot;gloda-dirty&quot;), &quot;&quot;);</span>
<a href="#l128.25"></a><span id="l128.25" class="difflineplus">+  Assert.equal(msgHdr.getStringProperty(&quot;gloda-dirty&quot;), &quot;&quot;);</span>
<a href="#l128.26"></a><span id="l128.26"> </span>
<a href="#l128.27"></a><span id="l128.27">   // modify the message</span>
<a href="#l128.28"></a><span id="l128.28">   msgSet.setRead(true);</span>
<a href="#l128.29"></a><span id="l128.29">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.30"></a><span id="l128.30"> </span>
<a href="#l128.31"></a><span id="l128.31">   // now there should be a dirty property and it should be 1...</span>
<a href="#l128.32"></a><span id="l128.32" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l128.33"></a><span id="l128.33" class="difflineminus">-              GlodaMsgIndexer.kMessageDirty);</span>
<a href="#l128.34"></a><span id="l128.34" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l128.35"></a><span id="l128.35" class="difflineplus">+               GlodaMsgIndexer.kMessageDirty);</span>
<a href="#l128.36"></a><span id="l128.36"> </span>
<a href="#l128.37"></a><span id="l128.37">   // flush</span>
<a href="#l128.38"></a><span id="l128.38">   yield wait_for_gloda_db_flush();</span>
<a href="#l128.39"></a><span id="l128.39"> </span>
<a href="#l128.40"></a><span id="l128.40">   // now dirty should be 0 and the gloda id should still be the same</span>
<a href="#l128.41"></a><span id="l128.41" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l128.42"></a><span id="l128.42" class="difflineminus">-              GlodaMsgIndexer.kMessageClean);</span>
<a href="#l128.43"></a><span id="l128.43" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-id&quot;), gmsg.id);</span>
<a href="#l128.44"></a><span id="l128.44" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l128.45"></a><span id="l128.45" class="difflineplus">+               GlodaMsgIndexer.kMessageClean);</span>
<a href="#l128.46"></a><span id="l128.46" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-id&quot;), gmsg.id);</span>
<a href="#l128.47"></a><span id="l128.47"> }</span>
<a href="#l128.48"></a><span id="l128.48"> </span>
<a href="#l128.49"></a><span id="l128.49"> /**</span>
<a href="#l128.50"></a><span id="l128.50">  * Make sure that PendingCommitTracker causes a msgdb commit to occur so that</span>
<a href="#l128.51"></a><span id="l128.51">  *  if the nsIMsgFolder's msgDatabase attribute has already been nulled</span>
<a href="#l128.52"></a><span id="l128.52">  *  (which is normally how we force a msgdb commit), that the changes to the</span>
<a href="#l128.53"></a><span id="l128.53">  *  header actually hit the disk.</span>
<a href="#l128.54"></a><span id="l128.54">  */</span>
<a href="#l128.55"></a><span id="l128.55" class="difflineat">@@ -91,17 +91,17 @@ function* test_pending_commit_causes_msg</span>
<a href="#l128.56"></a><span id="l128.56">   // make the commit happen, this causes the header to get set.</span>
<a href="#l128.57"></a><span id="l128.57">   yield wait_for_gloda_db_flush();</span>
<a href="#l128.58"></a><span id="l128.58">   // Force a GC.  this will kill off the header and the database, losing data</span>
<a href="#l128.59"></a><span id="l128.59">   //  if we are not protecting it.</span>
<a href="#l128.60"></a><span id="l128.60">   Components.utils.forceGC();</span>
<a href="#l128.61"></a><span id="l128.61"> </span>
<a href="#l128.62"></a><span id="l128.62">   // now retrieve the header and make sure it has the gloda id set!</span>
<a href="#l128.63"></a><span id="l128.63">   let msgHdr = msgSet.getMsgHdr(0);</span>
<a href="#l128.64"></a><span id="l128.64" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-id&quot;), msgSet.glodaMessages[0].id);</span>
<a href="#l128.65"></a><span id="l128.65" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-id&quot;), msgSet.glodaMessages[0].id);</span>
<a href="#l128.66"></a><span id="l128.66"> }</span>
<a href="#l128.67"></a><span id="l128.67"> </span>
<a href="#l128.68"></a><span id="l128.68"> /**</span>
<a href="#l128.69"></a><span id="l128.69">  * Give the indexing sweep a workout.</span>
<a href="#l128.70"></a><span id="l128.70">  *</span>
<a href="#l128.71"></a><span id="l128.71">  * This includes:</span>
<a href="#l128.72"></a><span id="l128.72">  * - Basic indexing sweep across never-before-indexed folders.</span>
<a href="#l128.73"></a><span id="l128.73">  * - Indexing sweep across folders with just some changes.</span>
<a href="#l128.74"></a><span id="l128.74" class="difflineat">@@ -185,17 +185,17 @@ function* test_indexing_sweep() {</span>
<a href="#l128.75"></a><span id="l128.75">   var callbackInvoked = false;</span>
<a href="#l128.76"></a><span id="l128.76">   mark_sub_test_start(&quot;forced folder indexing&quot;);</span>
<a href="#l128.77"></a><span id="l128.77">   GlodaMsgIndexer.indexFolder(get_real_injection_folder(folderA), {</span>
<a href="#l128.78"></a><span id="l128.78">     force: true,</span>
<a href="#l128.79"></a><span id="l128.79">     callback: function() {</span>
<a href="#l128.80"></a><span id="l128.80">       callbackInvoked = true;</span>
<a href="#l128.81"></a><span id="l128.81">     }});</span>
<a href="#l128.82"></a><span id="l128.82">   yield wait_for_gloda_indexer([setA1, setA2]);</span>
<a href="#l128.83"></a><span id="l128.83" class="difflineminus">-  do_check_true(callbackInvoked);</span>
<a href="#l128.84"></a><span id="l128.84" class="difflineplus">+  Assert.ok(callbackInvoked);</span>
<a href="#l128.85"></a><span id="l128.85"> }</span>
<a href="#l128.86"></a><span id="l128.86"> </span>
<a href="#l128.87"></a><span id="l128.87"> </span>
<a href="#l128.88"></a><span id="l128.88"> /**</span>
<a href="#l128.89"></a><span id="l128.89">  * We used to screw up and downgrade filthy folders to dirty if we saw an event</span>
<a href="#l128.90"></a><span id="l128.90">  *  happen in the folder before we got to the folder; this tests that we no</span>
<a href="#l128.91"></a><span id="l128.91">  *  longer do that.</span>
<a href="#l128.92"></a><span id="l128.92">  */</span>
<a href="#l128.93"></a><span id="l128.93" class="difflineat">@@ -208,19 +208,19 @@ function* test_event_driven_indexing_doe</span>
<a href="#l128.94"></a><span id="l128.94">   // fake marking the folder filthy.</span>
<a href="#l128.95"></a><span id="l128.95">   let glodaFolder = Gloda.getFolderForFolder(get_real_injection_folder(folder));</span>
<a href="#l128.96"></a><span id="l128.96">   glodaFolder._dirtyStatus = glodaFolder.kFolderFilthy;</span>
<a href="#l128.97"></a><span id="l128.97"> </span>
<a href="#l128.98"></a><span id="l128.98">   // generate an event in the folder</span>
<a href="#l128.99"></a><span id="l128.99">   msgSet.setRead(true);</span>
<a href="#l128.100"></a><span id="l128.100">   // make sure the indexer did not do anything and the folder is still filthy.</span>
<a href="#l128.101"></a><span id="l128.101">   yield wait_for_gloda_indexer([]);</span>
<a href="#l128.102"></a><span id="l128.102" class="difflineminus">-  do_check_eq(glodaFolder._dirtyStatus, glodaFolder.kFolderFilthy);</span>
<a href="#l128.103"></a><span id="l128.103" class="difflineplus">+  Assert.equal(glodaFolder._dirtyStatus, glodaFolder.kFolderFilthy);</span>
<a href="#l128.104"></a><span id="l128.104">   // also, the message should not have actually gotten marked dirty</span>
<a href="#l128.105"></a><span id="l128.105" class="difflineminus">-  do_check_eq(msgSet.getMsgHdr(0).getUint32Property(&quot;gloda-dirty&quot;), 0);</span>
<a href="#l128.106"></a><span id="l128.106" class="difflineplus">+  Assert.equal(msgSet.getMsgHdr(0).getUint32Property(&quot;gloda-dirty&quot;), 0);</span>
<a href="#l128.107"></a><span id="l128.107"> </span>
<a href="#l128.108"></a><span id="l128.108">   // let's make the message un-read again for consistency with the gloda state</span>
<a href="#l128.109"></a><span id="l128.109">   msgSet.setRead(false);</span>
<a href="#l128.110"></a><span id="l128.110">   // make the folder dirty and let an indexing sweep take care of this so we</span>
<a href="#l128.111"></a><span id="l128.111">   //  don't get extra events in subsequent tests.</span>
<a href="#l128.112"></a><span id="l128.112">   glodaFolder._dirtyStatus = glodaFolder.kFolderDirty;</span>
<a href="#l128.113"></a><span id="l128.113">   GlodaMsgIndexer.indexingSweepNeeded = true;</span>
<a href="#l128.114"></a><span id="l128.114">   // (the message won't get indexed though)</span>
<a href="#l128.115"></a><span id="l128.115" class="difflineat">@@ -239,17 +239,17 @@ function* test_indexing_never_priority()</span>
<a href="#l128.116"></a><span id="l128.116"> </span>
<a href="#l128.117"></a><span id="l128.117">   // explicitly tell gloda to never index this folder</span>
<a href="#l128.118"></a><span id="l128.118">   let XPCOMFolder = get_real_injection_folder(folder);</span>
<a href="#l128.119"></a><span id="l128.119">   let glodaFolder = Gloda.getFolderForFolder(XPCOMFolder);</span>
<a href="#l128.120"></a><span id="l128.120">   GlodaMsgIndexer.setFolderIndexingPriority(XPCOMFolder,</span>
<a href="#l128.121"></a><span id="l128.121">                                             glodaFolder.kIndexingNeverPriority);</span>
<a href="#l128.122"></a><span id="l128.122"> </span>
<a href="#l128.123"></a><span id="l128.123">   // verify that the setter and getter do the right thing</span>
<a href="#l128.124"></a><span id="l128.124" class="difflineminus">-  do_check_eq(glodaFolder.indexingPriority, glodaFolder.kIndexingNeverPriority);</span>
<a href="#l128.125"></a><span id="l128.125" class="difflineplus">+  Assert.equal(glodaFolder.indexingPriority, glodaFolder.kIndexingNeverPriority);</span>
<a href="#l128.126"></a><span id="l128.126"> </span>
<a href="#l128.127"></a><span id="l128.127">   // check that existing message is marked as deleted</span>
<a href="#l128.128"></a><span id="l128.128">   yield wait_for_gloda_indexer([], {deleted: [msgSet]});</span>
<a href="#l128.129"></a><span id="l128.129"> </span>
<a href="#l128.130"></a><span id="l128.130">   // make sure the deletion hit the database</span>
<a href="#l128.131"></a><span id="l128.131">   yield sqlExpectCount(1,</span>
<a href="#l128.132"></a><span id="l128.132">     &quot;SELECT COUNT(*) from folderLocations WHERE id = ? AND indexingPriority = ?&quot;,</span>
<a href="#l128.133"></a><span id="l128.133">      glodaFolder.id, glodaFolder.kIndexingNeverPriority);</span>
<a href="#l128.134"></a><span id="l128.134" class="difflineat">@@ -296,17 +296,17 @@ function* test_setting_indexing_priority</span>
<a href="#l128.135"></a><span id="l128.135"> }</span>
<a href="#l128.136"></a><span id="l128.136"> </span>
<a href="#l128.137"></a><span id="l128.137"> /* ===== Threading / Conversation Grouping ===== */</span>
<a href="#l128.138"></a><span id="l128.138"> </span>
<a href="#l128.139"></a><span id="l128.139"> var gSynMessages = [];</span>
<a href="#l128.140"></a><span id="l128.140"> function allMessageInSameConversation(aSynthMessage, aGlodaMessage, aConvID) {</span>
<a href="#l128.141"></a><span id="l128.141">   if (aConvID === undefined)</span>
<a href="#l128.142"></a><span id="l128.142">     return aGlodaMessage.conversationID;</span>
<a href="#l128.143"></a><span id="l128.143" class="difflineminus">-  do_check_eq(aConvID, aGlodaMessage.conversationID);</span>
<a href="#l128.144"></a><span id="l128.144" class="difflineplus">+  Assert.equal(aConvID, aGlodaMessage.conversationID);</span>
<a href="#l128.145"></a><span id="l128.145">   // Cheat and stash the synthetic message (we need them for one of the IMAP</span>
<a href="#l128.146"></a><span id="l128.146">   // tests)</span>
<a href="#l128.147"></a><span id="l128.147">   gSynMessages.push(aSynthMessage);</span>
<a href="#l128.148"></a><span id="l128.148">   return aConvID;</span>
<a href="#l128.149"></a><span id="l128.149"> }</span>
<a href="#l128.150"></a><span id="l128.150"> </span>
<a href="#l128.151"></a><span id="l128.151"> /**</span>
<a href="#l128.152"></a><span id="l128.152">  * Test our conversation/threading logic in the straight-forward direct</span>
<a href="#l128.153"></a><span id="l128.153" class="difflineat">@@ -356,19 +356,19 @@ function* test_attachment_flag() {</span>
<a href="#l128.154"></a><span id="l128.154">   yield wait_for_gloda_indexer(msgSet,</span>
<a href="#l128.155"></a><span id="l128.155">                                {verifier: verify_attachment_flag});</span>
<a href="#l128.156"></a><span id="l128.156"> </span>
<a href="#l128.157"></a><span id="l128.157"> }</span>
<a href="#l128.158"></a><span id="l128.158"> </span>
<a href="#l128.159"></a><span id="l128.159"> function verify_attachment_flag(smsg, gmsg) {</span>
<a href="#l128.160"></a><span id="l128.160">   // -- attachments. We won't have these if we don't have fulltext results</span>
<a href="#l128.161"></a><span id="l128.161">   if (expectFulltextResults) {</span>
<a href="#l128.162"></a><span id="l128.162" class="difflineminus">-    do_check_eq(gmsg.attachmentNames.length, 0);</span>
<a href="#l128.163"></a><span id="l128.163" class="difflineminus">-    do_check_eq(gmsg.attachmentInfos.length, 0);</span>
<a href="#l128.164"></a><span id="l128.164" class="difflineminus">-    do_check_false(gmsg.folderMessage.flags &amp; Ci.nsMsgMessageFlags.Attachment);</span>
<a href="#l128.165"></a><span id="l128.165" class="difflineplus">+    Assert.equal(gmsg.attachmentNames.length, 0);</span>
<a href="#l128.166"></a><span id="l128.166" class="difflineplus">+    Assert.equal(gmsg.attachmentInfos.length, 0);</span>
<a href="#l128.167"></a><span id="l128.167" class="difflineplus">+    Assert.equal(false, gmsg.folderMessage.flags &amp; Ci.nsMsgMessageFlags.Attachment);</span>
<a href="#l128.168"></a><span id="l128.168">   }</span>
<a href="#l128.169"></a><span id="l128.169"> }</span>
<a href="#l128.170"></a><span id="l128.170"> /* ===== Fundamental Attributes (per fundattr.js) ===== */</span>
<a href="#l128.171"></a><span id="l128.171"> </span>
<a href="#l128.172"></a><span id="l128.172"> /**</span>
<a href="#l128.173"></a><span id="l128.173">  * Save the synthetic message created in test_attributes_fundamental for the</span>
<a href="#l128.174"></a><span id="l128.174">  *  benefit of test_attributes_fundamental_from_disk.</span>
<a href="#l128.175"></a><span id="l128.175">  */</span>
<a href="#l128.176"></a><span id="l128.176" class="difflineat">@@ -427,60 +427,60 @@ function verify_attributes_fundamental(s</span>
<a href="#l128.177"></a><span id="l128.177">   fundamentalGlodaMessageId = gmsg.id;</span>
<a href="#l128.178"></a><span id="l128.178">   if (gmsg.attachmentInfos) {</span>
<a href="#l128.179"></a><span id="l128.179">     fundamentalGlodaMsgAttachmentUrls =</span>
<a href="#l128.180"></a><span id="l128.180">       gmsg.attachmentInfos.map(att =&gt; att.url);</span>
<a href="#l128.181"></a><span id="l128.181">   } else {</span>
<a href="#l128.182"></a><span id="l128.182">     fundamentalGlodaMsgAttachmentUrls = [];</span>
<a href="#l128.183"></a><span id="l128.183">   }</span>
<a href="#l128.184"></a><span id="l128.184"> </span>
<a href="#l128.185"></a><span id="l128.185" class="difflineminus">-  do_check_eq(gmsg.folderURI,</span>
<a href="#l128.186"></a><span id="l128.186" class="difflineminus">-              get_real_injection_folder(fundamentalFolderHandle).URI);</span>
<a href="#l128.187"></a><span id="l128.187" class="difflineplus">+  Assert.equal(gmsg.folderURI,</span>
<a href="#l128.188"></a><span id="l128.188" class="difflineplus">+               get_real_injection_folder(fundamentalFolderHandle).URI);</span>
<a href="#l128.189"></a><span id="l128.189"> </span>
<a href="#l128.190"></a><span id="l128.190">   // -- subject</span>
<a href="#l128.191"></a><span id="l128.191" class="difflineminus">-  do_check_eq(smsg.subject, gmsg.conversation.subject);</span>
<a href="#l128.192"></a><span id="l128.192" class="difflineminus">-  do_check_eq(smsg.subject, gmsg.subject);</span>
<a href="#l128.193"></a><span id="l128.193" class="difflineplus">+  Assert.equal(smsg.subject, gmsg.conversation.subject);</span>
<a href="#l128.194"></a><span id="l128.194" class="difflineplus">+  Assert.equal(smsg.subject, gmsg.subject);</span>
<a href="#l128.195"></a><span id="l128.195"> </span>
<a href="#l128.196"></a><span id="l128.196">   // -- contact/identity information</span>
<a href="#l128.197"></a><span id="l128.197">   // - from</span>
<a href="#l128.198"></a><span id="l128.198">   // check the e-mail address</span>
<a href="#l128.199"></a><span id="l128.199" class="difflineminus">-  do_check_eq(gmsg.from.kind, &quot;email&quot;);</span>
<a href="#l128.200"></a><span id="l128.200" class="difflineminus">-  do_check_eq(smsg.fromAddress, gmsg.from.value);</span>
<a href="#l128.201"></a><span id="l128.201" class="difflineplus">+  Assert.equal(gmsg.from.kind, &quot;email&quot;);</span>
<a href="#l128.202"></a><span id="l128.202" class="difflineplus">+  Assert.equal(smsg.fromAddress, gmsg.from.value);</span>
<a href="#l128.203"></a><span id="l128.203">   // check the name</span>
<a href="#l128.204"></a><span id="l128.204" class="difflineminus">-  do_check_eq(smsg.fromName, gmsg.from.contact.name);</span>
<a href="#l128.205"></a><span id="l128.205" class="difflineplus">+  Assert.equal(smsg.fromName, gmsg.from.contact.name);</span>
<a href="#l128.206"></a><span id="l128.206"> </span>
<a href="#l128.207"></a><span id="l128.207">   // - to</span>
<a href="#l128.208"></a><span id="l128.208" class="difflineminus">-  do_check_eq(smsg.toAddress, gmsg.to[0].value);</span>
<a href="#l128.209"></a><span id="l128.209" class="difflineminus">-  do_check_eq(smsg.toName, gmsg.to[0].contact.name);</span>
<a href="#l128.210"></a><span id="l128.210" class="difflineplus">+  Assert.equal(smsg.toAddress, gmsg.to[0].value);</span>
<a href="#l128.211"></a><span id="l128.211" class="difflineplus">+  Assert.equal(smsg.toName, gmsg.to[0].contact.name);</span>
<a href="#l128.212"></a><span id="l128.212"> </span>
<a href="#l128.213"></a><span id="l128.213">   // date</span>
<a href="#l128.214"></a><span id="l128.214" class="difflineminus">-  do_check_eq(smsg.date.valueOf(), gmsg.date.valueOf());</span>
<a href="#l128.215"></a><span id="l128.215" class="difflineplus">+  Assert.equal(smsg.date.valueOf(), gmsg.date.valueOf());</span>
<a href="#l128.216"></a><span id="l128.216"> </span>
<a href="#l128.217"></a><span id="l128.217">   // -- message ID</span>
<a href="#l128.218"></a><span id="l128.218" class="difflineminus">-  do_check_eq(smsg.messageId, gmsg.headerMessageID);</span>
<a href="#l128.219"></a><span id="l128.219" class="difflineplus">+  Assert.equal(smsg.messageId, gmsg.headerMessageID);</span>
<a href="#l128.220"></a><span id="l128.220"> </span>
<a href="#l128.221"></a><span id="l128.221">   // -- attachments. We won't have these if we don't have fulltext results</span>
<a href="#l128.222"></a><span id="l128.222">   if (expectFulltextResults) {</span>
<a href="#l128.223"></a><span id="l128.223" class="difflineminus">-    do_check_eq(gmsg.attachmentTypes.length, 1);</span>
<a href="#l128.224"></a><span id="l128.224" class="difflineminus">-    do_check_eq(gmsg.attachmentTypes[0], &quot;text/plain&quot;);</span>
<a href="#l128.225"></a><span id="l128.225" class="difflineminus">-    do_check_eq(gmsg.attachmentNames.length, 1);</span>
<a href="#l128.226"></a><span id="l128.226" class="difflineminus">-    do_check_eq(gmsg.attachmentNames[0], &quot;bob.txt&quot;);</span>
<a href="#l128.227"></a><span id="l128.227" class="difflineplus">+    Assert.equal(gmsg.attachmentTypes.length, 1);</span>
<a href="#l128.228"></a><span id="l128.228" class="difflineplus">+    Assert.equal(gmsg.attachmentTypes[0], &quot;text/plain&quot;);</span>
<a href="#l128.229"></a><span id="l128.229" class="difflineplus">+    Assert.equal(gmsg.attachmentNames.length, 1);</span>
<a href="#l128.230"></a><span id="l128.230" class="difflineplus">+    Assert.equal(gmsg.attachmentNames[0], &quot;bob.txt&quot;);</span>
<a href="#l128.231"></a><span id="l128.231"> </span>
<a href="#l128.232"></a><span id="l128.232">     let expectedInfos = [</span>
<a href="#l128.233"></a><span id="l128.233">       // the name for that one is generated randomly</span>
<a href="#l128.234"></a><span id="l128.234">       { contentType: &quot;message/rfc822&quot; },</span>
<a href="#l128.235"></a><span id="l128.235">       { name: &quot;bob.txt&quot;, contentType: &quot;text/plain&quot; },</span>
<a href="#l128.236"></a><span id="l128.236">     ];</span>
<a href="#l128.237"></a><span id="l128.237">     let expectedSize = 14;</span>
<a href="#l128.238"></a><span id="l128.238" class="difflineminus">-    do_check_eq(gmsg.attachmentInfos.length, 2);</span>
<a href="#l128.239"></a><span id="l128.239" class="difflineplus">+    Assert.equal(gmsg.attachmentInfos.length, 2);</span>
<a href="#l128.240"></a><span id="l128.240">     for (let [i, attInfos] of gmsg.attachmentInfos.entries()) {</span>
<a href="#l128.241"></a><span id="l128.241">       for (let k in expectedInfos[i])</span>
<a href="#l128.242"></a><span id="l128.242" class="difflineminus">-        do_check_eq(attInfos[k], expectedInfos[i][k]);</span>
<a href="#l128.243"></a><span id="l128.243" class="difflineplus">+        Assert.equal(attInfos[k], expectedInfos[i][k]);</span>
<a href="#l128.244"></a><span id="l128.244">       // because it's unreliable and depends on the platform</span>
<a href="#l128.245"></a><span id="l128.245" class="difflineminus">-      do_check_true(Math.abs(attInfos.size - expectedSize) &lt;= 2);</span>
<a href="#l128.246"></a><span id="l128.246" class="difflineplus">+      Assert.ok(Math.abs(attInfos.size - expectedSize) &lt;= 2);</span>
<a href="#l128.247"></a><span id="l128.247">       // check that the attachment URLs are correct</span>
<a href="#l128.248"></a><span id="l128.248">       let channel = NetUtil.newChannel({</span>
<a href="#l128.249"></a><span id="l128.249">          uri: attInfos.url,</span>
<a href="#l128.250"></a><span id="l128.250">          loadingPrincipal: Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l128.251"></a><span id="l128.251">          securityFlags: Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l128.252"></a><span id="l128.252">          contentPolicyType: Ci.nsIContentPolicy.TYPE_OTHER</span>
<a href="#l128.253"></a><span id="l128.253">       });</span>
<a href="#l128.254"></a><span id="l128.254"> </span>
<a href="#l128.255"></a><span id="l128.255" class="difflineat">@@ -489,18 +489,18 @@ function verify_attributes_fundamental(s</span>
<a href="#l128.256"></a><span id="l128.256">         channel.open();</span>
<a href="#l128.257"></a><span id="l128.257">       } catch (e) {</span>
<a href="#l128.258"></a><span id="l128.258">         do_throw(new Error(&quot;Invalid attachment URL&quot;));</span>
<a href="#l128.259"></a><span id="l128.259">       }</span>
<a href="#l128.260"></a><span id="l128.260">     }</span>
<a href="#l128.261"></a><span id="l128.261">   }</span>
<a href="#l128.262"></a><span id="l128.262">   else {</span>
<a href="#l128.263"></a><span id="l128.263">     // Make sure we don't actually get attachments!</span>
<a href="#l128.264"></a><span id="l128.264" class="difflineminus">-    do_check_eq(gmsg.attachmentTypes, null);</span>
<a href="#l128.265"></a><span id="l128.265" class="difflineminus">-    do_check_eq(gmsg.attachmentNames, null);</span>
<a href="#l128.266"></a><span id="l128.266" class="difflineplus">+    Assert.equal(gmsg.attachmentTypes, null);</span>
<a href="#l128.267"></a><span id="l128.267" class="difflineplus">+    Assert.equal(gmsg.attachmentNames, null);</span>
<a href="#l128.268"></a><span id="l128.268">   }</span>
<a href="#l128.269"></a><span id="l128.269"> }</span>
<a href="#l128.270"></a><span id="l128.270"> </span>
<a href="#l128.271"></a><span id="l128.271"> /**</span>
<a href="#l128.272"></a><span id="l128.272">  * We now move the message into another folder, wait for it to be indexed,</span>
<a href="#l128.273"></a><span id="l128.273">  * and make sure the magic url getter for GlodaAttachment returns a proper</span>
<a href="#l128.274"></a><span id="l128.274">  * URL.</span>
<a href="#l128.275"></a><span id="l128.275">  */</span>
<a href="#l128.276"></a><span id="l128.276" class="difflineat">@@ -516,21 +516,21 @@ function* test_moved_message_attributes(</span>
<a href="#l128.277"></a><span id="l128.277">   yield wait_for_gloda_indexer([ignoreSet]);</span>
<a href="#l128.278"></a><span id="l128.278"> </span>
<a href="#l128.279"></a><span id="l128.279">   // this is a fast move (third parameter set to true)</span>
<a href="#l128.280"></a><span id="l128.280">   yield async_move_messages(fundamentalMsgSet, destFolder, true);</span>
<a href="#l128.281"></a><span id="l128.281"> </span>
<a href="#l128.282"></a><span id="l128.282">   yield wait_for_gloda_indexer(fundamentalMsgSet, {</span>
<a href="#l128.283"></a><span id="l128.283">     verifier: function (newSynMsg, newGlodaMsg) {</span>
<a href="#l128.284"></a><span id="l128.284">       // verify we still have the same number of attachments</span>
<a href="#l128.285"></a><span id="l128.285" class="difflineminus">-      do_check_eq(fundamentalGlodaMsgAttachmentUrls.length,</span>
<a href="#l128.286"></a><span id="l128.286" class="difflineplus">+      Assert.equal(fundamentalGlodaMsgAttachmentUrls.length,</span>
<a href="#l128.287"></a><span id="l128.287">         newGlodaMsg.attachmentInfos.length);</span>
<a href="#l128.288"></a><span id="l128.288">       for (let [i, attInfos] of newGlodaMsg.attachmentInfos.entries()) {</span>
<a href="#l128.289"></a><span id="l128.289">         // verify the url has changed</span>
<a href="#l128.290"></a><span id="l128.290" class="difflineminus">-        do_check_neq(fundamentalGlodaMsgAttachmentUrls[i], attInfos.url);</span>
<a href="#l128.291"></a><span id="l128.291" class="difflineplus">+        Assert.notEqual(fundamentalGlodaMsgAttachmentUrls[i], attInfos.url);</span>
<a href="#l128.292"></a><span id="l128.292">         // and verify that the new url is still valid</span>
<a href="#l128.293"></a><span id="l128.293">         let channel = NetUtil.newChannel({</span>
<a href="#l128.294"></a><span id="l128.294">            uri: attInfos.url,</span>
<a href="#l128.295"></a><span id="l128.295">            loadingPrincipal: Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l128.296"></a><span id="l128.296">            securityFlags: Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l128.297"></a><span id="l128.297">            contentPolicyType: Ci.nsIContentPolicy.TYPE_OTHER</span>
<a href="#l128.298"></a><span id="l128.298">         });</span>
<a href="#l128.299"></a><span id="l128.299">         try {</span>
<a href="#l128.300"></a><span id="l128.300" class="difflineat">@@ -584,59 +584,59 @@ function* test_attributes_explicit() {</span>
<a href="#l128.301"></a><span id="l128.301">   yield wait_for_message_injection();</span>
<a href="#l128.302"></a><span id="l128.302">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l128.303"></a><span id="l128.303">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l128.304"></a><span id="l128.304"> </span>
<a href="#l128.305"></a><span id="l128.305">   // -- Star</span>
<a href="#l128.306"></a><span id="l128.306">   mark_sub_test_start(&quot;Star&quot;);</span>
<a href="#l128.307"></a><span id="l128.307">   msgSet.setStarred(true);</span>
<a href="#l128.308"></a><span id="l128.308">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.309"></a><span id="l128.309" class="difflineminus">-  do_check_eq(gmsg.starred, true);</span>
<a href="#l128.310"></a><span id="l128.310" class="difflineplus">+  Assert.equal(gmsg.starred, true);</span>
<a href="#l128.311"></a><span id="l128.311"> </span>
<a href="#l128.312"></a><span id="l128.312">   msgSet.setStarred(false);</span>
<a href="#l128.313"></a><span id="l128.313">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.314"></a><span id="l128.314" class="difflineminus">-  do_check_eq(gmsg.starred, false);</span>
<a href="#l128.315"></a><span id="l128.315" class="difflineplus">+  Assert.equal(gmsg.starred, false);</span>
<a href="#l128.316"></a><span id="l128.316"> </span>
<a href="#l128.317"></a><span id="l128.317">   // -- Read / Unread</span>
<a href="#l128.318"></a><span id="l128.318">   mark_sub_test_start(&quot;Read/Unread&quot;);</span>
<a href="#l128.319"></a><span id="l128.319">   msgSet.setRead(true);</span>
<a href="#l128.320"></a><span id="l128.320">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.321"></a><span id="l128.321" class="difflineminus">-  do_check_eq(gmsg.read, true);</span>
<a href="#l128.322"></a><span id="l128.322" class="difflineplus">+  Assert.equal(gmsg.read, true);</span>
<a href="#l128.323"></a><span id="l128.323"> </span>
<a href="#l128.324"></a><span id="l128.324">   msgSet.setRead(false);</span>
<a href="#l128.325"></a><span id="l128.325">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.326"></a><span id="l128.326" class="difflineminus">-  do_check_eq(gmsg.read, false);</span>
<a href="#l128.327"></a><span id="l128.327" class="difflineplus">+  Assert.equal(gmsg.read, false);</span>
<a href="#l128.328"></a><span id="l128.328"> </span>
<a href="#l128.329"></a><span id="l128.329">   // -- Tags</span>
<a href="#l128.330"></a><span id="l128.330">   mark_sub_test_start(&quot;Tags&quot;);</span>
<a href="#l128.331"></a><span id="l128.331">   // note that the tag service does not guarantee stable nsIMsgTag references,</span>
<a href="#l128.332"></a><span id="l128.332">   //  nor does noun_tag go too far out of its way to provide stability.</span>
<a href="#l128.333"></a><span id="l128.333">   //  However, it is stable as long as we don't spook it by bringing new tags</span>
<a href="#l128.334"></a><span id="l128.334">   //  into the equation.</span>
<a href="#l128.335"></a><span id="l128.335">   let tagOne = TagNoun.getTag(&quot;$label1&quot;);</span>
<a href="#l128.336"></a><span id="l128.336">   let tagTwo = TagNoun.getTag(&quot;$label2&quot;);</span>
<a href="#l128.337"></a><span id="l128.337"> </span>
<a href="#l128.338"></a><span id="l128.338">   msgSet.addTag(tagOne.key);</span>
<a href="#l128.339"></a><span id="l128.339">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.340"></a><span id="l128.340" class="difflineminus">-  do_check_neq(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.341"></a><span id="l128.341" class="difflineplus">+  Assert.notEqual(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.342"></a><span id="l128.342"> </span>
<a href="#l128.343"></a><span id="l128.343">   msgSet.addTag(tagTwo.key);</span>
<a href="#l128.344"></a><span id="l128.344">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.345"></a><span id="l128.345" class="difflineminus">-  do_check_neq(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.346"></a><span id="l128.346" class="difflineminus">-  do_check_neq(gmsg.tags.indexOf(tagTwo), -1);</span>
<a href="#l128.347"></a><span id="l128.347" class="difflineplus">+  Assert.notEqual(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.348"></a><span id="l128.348" class="difflineplus">+  Assert.notEqual(gmsg.tags.indexOf(tagTwo), -1);</span>
<a href="#l128.349"></a><span id="l128.349"> </span>
<a href="#l128.350"></a><span id="l128.350">   msgSet.removeTag(tagOne.key);</span>
<a href="#l128.351"></a><span id="l128.351">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.352"></a><span id="l128.352" class="difflineminus">-  do_check_eq(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.353"></a><span id="l128.353" class="difflineminus">-  do_check_neq(gmsg.tags.indexOf(tagTwo), -1);</span>
<a href="#l128.354"></a><span id="l128.354" class="difflineplus">+  Assert.equal(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.355"></a><span id="l128.355" class="difflineplus">+  Assert.notEqual(gmsg.tags.indexOf(tagTwo), -1);</span>
<a href="#l128.356"></a><span id="l128.356"> </span>
<a href="#l128.357"></a><span id="l128.357">   msgSet.removeTag(tagTwo.key);</span>
<a href="#l128.358"></a><span id="l128.358">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.359"></a><span id="l128.359" class="difflineminus">-  do_check_eq(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.360"></a><span id="l128.360" class="difflineminus">-  do_check_eq(gmsg.tags.indexOf(tagTwo), -1);</span>
<a href="#l128.361"></a><span id="l128.361" class="difflineplus">+  Assert.equal(gmsg.tags.indexOf(tagOne), -1);</span>
<a href="#l128.362"></a><span id="l128.362" class="difflineplus">+  Assert.equal(gmsg.tags.indexOf(tagTwo), -1);</span>
<a href="#l128.363"></a><span id="l128.363"> </span>
<a href="#l128.364"></a><span id="l128.364">   // -- Replied To</span>
<a href="#l128.365"></a><span id="l128.365"> </span>
<a href="#l128.366"></a><span id="l128.366">   // -- Forwarded</span>
<a href="#l128.367"></a><span id="l128.367"> }</span>
<a href="#l128.368"></a><span id="l128.368"> </span>
<a href="#l128.369"></a><span id="l128.369"> </span>
<a href="#l128.370"></a><span id="l128.370"> /**</span>
<a href="#l128.371"></a><span id="l128.371" class="difflineat">@@ -647,31 +647,31 @@ function* test_attributes_cant_query() {</span>
<a href="#l128.372"></a><span id="l128.372">   yield wait_for_message_injection();</span>
<a href="#l128.373"></a><span id="l128.373">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l128.374"></a><span id="l128.374">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l128.375"></a><span id="l128.375"> </span>
<a href="#l128.376"></a><span id="l128.376">   // -- Star</span>
<a href="#l128.377"></a><span id="l128.377">   mark_sub_test_start(&quot;Star&quot;);</span>
<a href="#l128.378"></a><span id="l128.378">   msgSet.setStarred(true);</span>
<a href="#l128.379"></a><span id="l128.379">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.380"></a><span id="l128.380" class="difflineminus">-  do_check_eq(gmsg.starred, true);</span>
<a href="#l128.381"></a><span id="l128.381" class="difflineplus">+  Assert.equal(gmsg.starred, true);</span>
<a href="#l128.382"></a><span id="l128.382"> </span>
<a href="#l128.383"></a><span id="l128.383">   msgSet.setStarred(false);</span>
<a href="#l128.384"></a><span id="l128.384">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.385"></a><span id="l128.385" class="difflineminus">-  do_check_eq(gmsg.starred, false);</span>
<a href="#l128.386"></a><span id="l128.386" class="difflineplus">+  Assert.equal(gmsg.starred, false);</span>
<a href="#l128.387"></a><span id="l128.387"> </span>
<a href="#l128.388"></a><span id="l128.388">   // -- Read / Unread</span>
<a href="#l128.389"></a><span id="l128.389">   mark_sub_test_start(&quot;Read/Unread&quot;);</span>
<a href="#l128.390"></a><span id="l128.390">   msgSet.setRead(true);</span>
<a href="#l128.391"></a><span id="l128.391">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.392"></a><span id="l128.392" class="difflineminus">-  do_check_eq(gmsg.read, true);</span>
<a href="#l128.393"></a><span id="l128.393" class="difflineplus">+  Assert.equal(gmsg.read, true);</span>
<a href="#l128.394"></a><span id="l128.394"> </span>
<a href="#l128.395"></a><span id="l128.395">   msgSet.setRead(false);</span>
<a href="#l128.396"></a><span id="l128.396">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.397"></a><span id="l128.397" class="difflineminus">-  do_check_eq(gmsg.read, false);</span>
<a href="#l128.398"></a><span id="l128.398" class="difflineplus">+  Assert.equal(gmsg.read, false);</span>
<a href="#l128.399"></a><span id="l128.399"> </span>
<a href="#l128.400"></a><span id="l128.400">   let readDbAttr = Gloda.getAttrDef(Gloda.BUILT_IN, &quot;read&quot;);</span>
<a href="#l128.401"></a><span id="l128.401">   let readId = readDbAttr.id;</span>
<a href="#l128.402"></a><span id="l128.402"> </span>
<a href="#l128.403"></a><span id="l128.403">   yield sqlExpectCount(0, &quot;SELECT COUNT(*) FROM messageAttributes WHERE attributeID = ?1&quot;,</span>
<a href="#l128.404"></a><span id="l128.404">                        readId);</span>
<a href="#l128.405"></a><span id="l128.405"> </span>
<a href="#l128.406"></a><span id="l128.406">   // -- Replied To</span>
<a href="#l128.407"></a><span id="l128.407" class="difflineat">@@ -694,21 +694,21 @@ function* test_people_in_addressbook() {</span>
<a href="#l128.408"></a><span id="l128.408">   let [folder, msgSet] = make_folder_with_sets([</span>
<a href="#l128.409"></a><span id="l128.409">     { count: 1, to: [recipPair], from: senderPair }]);</span>
<a href="#l128.410"></a><span id="l128.410">   yield wait_for_message_injection();</span>
<a href="#l128.411"></a><span id="l128.411">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l128.412"></a><span id="l128.412">   let gmsg = msgSet.glodaMessages[0],</span>
<a href="#l128.413"></a><span id="l128.413">       senderIdentity = gmsg.from,</span>
<a href="#l128.414"></a><span id="l128.414">       recipIdentity = gmsg.to[0];</span>
<a href="#l128.415"></a><span id="l128.415"> </span>
<a href="#l128.416"></a><span id="l128.416" class="difflineminus">-  do_check_neq(senderIdentity.contact, null);</span>
<a href="#l128.417"></a><span id="l128.417" class="difflineminus">-  do_check_true(senderIdentity.inAddressBook);</span>
<a href="#l128.418"></a><span id="l128.418" class="difflineplus">+  Assert.notEqual(senderIdentity.contact, null);</span>
<a href="#l128.419"></a><span id="l128.419" class="difflineplus">+  Assert.ok(senderIdentity.inAddressBook);</span>
<a href="#l128.420"></a><span id="l128.420"> </span>
<a href="#l128.421"></a><span id="l128.421" class="difflineminus">-  do_check_neq(recipIdentity.contact, null);</span>
<a href="#l128.422"></a><span id="l128.422" class="difflineminus">-  do_check_true(recipIdentity.inAddressBook);</span>
<a href="#l128.423"></a><span id="l128.423" class="difflineplus">+  Assert.notEqual(recipIdentity.contact, null);</span>
<a href="#l128.424"></a><span id="l128.424" class="difflineplus">+  Assert.ok(recipIdentity.inAddressBook);</span>
<a href="#l128.425"></a><span id="l128.425"> }</span>
<a href="#l128.426"></a><span id="l128.426"> </span>
<a href="#l128.427"></a><span id="l128.427"> /* ===== fulltexts Indexing ===== */</span>
<a href="#l128.428"></a><span id="l128.428"> </span>
<a href="#l128.429"></a><span id="l128.429"> /**</span>
<a href="#l128.430"></a><span id="l128.430">  * Make sure that we are using the saneBodySize flag.  This is basically the</span>
<a href="#l128.431"></a><span id="l128.431">  *  test_sane_bodies test from test_mime_emitter but we pull the indexedBodyText</span>
<a href="#l128.432"></a><span id="l128.432">  *  off the message to check and also make sure that the text contents slice</span>
<a href="#l128.433"></a><span id="l128.433" class="difflineat">@@ -734,18 +734,18 @@ function* test_streamed_bodies_are_size_</span>
<a href="#l128.434"></a><span id="l128.434"> </span>
<a href="#l128.435"></a><span id="l128.435">   if (goOffline) {</span>
<a href="#l128.436"></a><span id="l128.436">     yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l128.437"></a><span id="l128.437">     yield make_folder_and_contents_offline(folder);</span>
<a href="#l128.438"></a><span id="l128.438">   }</span>
<a href="#l128.439"></a><span id="l128.439"> </span>
<a href="#l128.440"></a><span id="l128.440">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l128.441"></a><span id="l128.441">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l128.442"></a><span id="l128.442" class="difflineminus">-  do_check_true(gmsg.indexedBodyText.startsWith(&quot;aabb&quot;));</span>
<a href="#l128.443"></a><span id="l128.443" class="difflineminus">-  do_check_false(gmsg.indexedBodyText.includes(&quot;xxyy&quot;));</span>
<a href="#l128.444"></a><span id="l128.444" class="difflineplus">+  Assert.ok(gmsg.indexedBodyText.startsWith(&quot;aabb&quot;));</span>
<a href="#l128.445"></a><span id="l128.445" class="difflineplus">+  Assert.ok(!gmsg.indexedBodyText.includes(&quot;xxyy&quot;));</span>
<a href="#l128.446"></a><span id="l128.446"> </span>
<a href="#l128.447"></a><span id="l128.447">   if (gmsg.indexedBodyText.length &gt; (20 * 1024 + 58 + 10))</span>
<a href="#l128.448"></a><span id="l128.448">     do_throw(&quot;indexed body text is too big! (&quot; + gmsg.indexedBodyText.length +</span>
<a href="#l128.449"></a><span id="l128.449">              &quot;)&quot;);</span>
<a href="#l128.450"></a><span id="l128.450"> }</span>
<a href="#l128.451"></a><span id="l128.451"> </span>
<a href="#l128.452"></a><span id="l128.452"> </span>
<a href="#l128.453"></a><span id="l128.453"> /* ===== Message Deletion ===== */</span>
<a href="#l128.454"></a><span id="l128.454" class="difflineat">@@ -783,17 +783,17 @@ function* test_message_deletion() {</span>
<a href="#l128.455"></a><span id="l128.455">   let firstColl = queryExpect(firstQuery, firstSet);</span>
<a href="#l128.456"></a><span id="l128.456">   yield false; // queryExpect is async but returns a value...</span>
<a href="#l128.457"></a><span id="l128.457"> </span>
<a href="#l128.458"></a><span id="l128.458">   // delete it (not trash! delete!)</span>
<a href="#l128.459"></a><span id="l128.459">   yield async_delete_messages(firstSet);</span>
<a href="#l128.460"></a><span id="l128.460">   // which should result in an apparent deletion</span>
<a href="#l128.461"></a><span id="l128.461">   yield wait_for_gloda_indexer([], {deleted: firstSet});</span>
<a href="#l128.462"></a><span id="l128.462">   // and our collection from that query should now be empty</span>
<a href="#l128.463"></a><span id="l128.463" class="difflineminus">-  do_check_eq(firstColl.items.length, 0);</span>
<a href="#l128.464"></a><span id="l128.464" class="difflineplus">+  Assert.equal(firstColl.items.length, 0);</span>
<a href="#l128.465"></a><span id="l128.465"> </span>
<a href="#l128.466"></a><span id="l128.466">   // make sure it no longer shows up in a standard query</span>
<a href="#l128.467"></a><span id="l128.467">   firstColl = queryExpect(firstQuery, []);</span>
<a href="#l128.468"></a><span id="l128.468">   yield false; // queryExpect is async</span>
<a href="#l128.469"></a><span id="l128.469"> </span>
<a href="#l128.470"></a><span id="l128.470">   // make sure it shows up in a privileged query</span>
<a href="#l128.471"></a><span id="l128.471">   let privQuery = Gloda.newQuery(Gloda.NOUN_MESSAGE, {</span>
<a href="#l128.472"></a><span id="l128.472">                       noDbQueryValidityConstraints: true,</span>
<a href="#l128.473"></a><span id="l128.473" class="difflineat">@@ -834,17 +834,17 @@ function* test_message_deletion() {</span>
<a href="#l128.474"></a><span id="l128.474">   let twinColl = queryExpect(twinQuery, twinSet);</span>
<a href="#l128.475"></a><span id="l128.475">   yield false; // queryExpect is async</span>
<a href="#l128.476"></a><span id="l128.476"> </span>
<a href="#l128.477"></a><span id="l128.477">   // delete the twin</span>
<a href="#l128.478"></a><span id="l128.478">   yield async_delete_messages(twinSet);</span>
<a href="#l128.479"></a><span id="l128.479">   // which should result in an apparent deletion</span>
<a href="#l128.480"></a><span id="l128.480">   yield wait_for_gloda_indexer([], {deleted: twinSet});</span>
<a href="#l128.481"></a><span id="l128.481">   // it should disappear from the collection</span>
<a href="#l128.482"></a><span id="l128.482" class="difflineminus">-  do_check_eq(twinColl.items.length, 0);</span>
<a href="#l128.483"></a><span id="l128.483" class="difflineplus">+  Assert.equal(twinColl.items.length, 0);</span>
<a href="#l128.484"></a><span id="l128.484"> </span>
<a href="#l128.485"></a><span id="l128.485">   // no longer show up in the standard query</span>
<a href="#l128.486"></a><span id="l128.486">   twinColl = queryExpect(twinQuery, []);</span>
<a href="#l128.487"></a><span id="l128.487">   yield false; // queryExpect is async</span>
<a href="#l128.488"></a><span id="l128.488"> </span>
<a href="#l128.489"></a><span id="l128.489">   // still show up in a privileged query</span>
<a href="#l128.490"></a><span id="l128.490">   privQuery = Gloda.newQuery(Gloda.NOUN_MESSAGE, {</span>
<a href="#l128.491"></a><span id="l128.491">                                noDbQueryValidityConstraints: true,</span>
<a href="#l128.492"></a><span id="l128.492" class="difflineat">@@ -862,18 +862,18 @@ function* test_message_deletion() {</span>
<a href="#l128.493"></a><span id="l128.493">   yield sqlExpectCount(0, &quot;SELECT COUNT(*) FROM messagesText WHERE docid = ?1&quot;,</span>
<a href="#l128.494"></a><span id="l128.494">                        twinSet.glodaMessages[0].id);</span>
<a href="#l128.495"></a><span id="l128.495"> </span>
<a href="#l128.496"></a><span id="l128.496">   // it still should show up in the privileged query; it's a ghost!</span>
<a href="#l128.497"></a><span id="l128.497">   let privColl = queryExpect(privQuery, twinSet);</span>
<a href="#l128.498"></a><span id="l128.498">   yield false; // queryExpect is async</span>
<a href="#l128.499"></a><span id="l128.499">   // make sure it looks like a ghost.</span>
<a href="#l128.500"></a><span id="l128.500">   let twinGhost = privColl.items[0];</span>
<a href="#l128.501"></a><span id="l128.501" class="difflineminus">-  do_check_eq(twinGhost._folderID, null);</span>
<a href="#l128.502"></a><span id="l128.502" class="difflineminus">-  do_check_eq(twinGhost._messageKey, null);</span>
<a href="#l128.503"></a><span id="l128.503" class="difflineplus">+  Assert.equal(twinGhost._folderID, null);</span>
<a href="#l128.504"></a><span id="l128.504" class="difflineplus">+  Assert.equal(twinGhost._messageKey, null);</span>
<a href="#l128.505"></a><span id="l128.505"> </span>
<a href="#l128.506"></a><span id="l128.506">   // make sure the conversation still exists...</span>
<a href="#l128.507"></a><span id="l128.507">   queryExpect(convQuery, [conv]);</span>
<a href="#l128.508"></a><span id="l128.508">   yield false; // queryExpect is async</span>
<a href="#l128.509"></a><span id="l128.509"> </span>
<a href="#l128.510"></a><span id="l128.510"> </span>
<a href="#l128.511"></a><span id="l128.511">   // -- non-last message, not a twin</span>
<a href="#l128.512"></a><span id="l128.512">   // This should blow away the message, the ghosts, and the conversation.</span>
<a href="#l128.513"></a><span id="l128.513" class="difflineat">@@ -883,17 +883,17 @@ function* test_message_deletion() {</span>
<a href="#l128.514"></a><span id="l128.514">   let secondQuery = Gloda.newQuery(Gloda.NOUN_MESSAGE);</span>
<a href="#l128.515"></a><span id="l128.515">   secondQuery.headerMessageID(secondSet.synMessages[0].messageId);</span>
<a href="#l128.516"></a><span id="l128.516">   let secondColl = queryExpect(secondQuery, secondSet);</span>
<a href="#l128.517"></a><span id="l128.517">   yield false; // queryExpect is async</span>
<a href="#l128.518"></a><span id="l128.518"> </span>
<a href="#l128.519"></a><span id="l128.519">   // delete it and make sure it gets marked deleted appropriately</span>
<a href="#l128.520"></a><span id="l128.520">   yield async_delete_messages(secondSet);</span>
<a href="#l128.521"></a><span id="l128.521">   yield wait_for_gloda_indexer([], {deleted: secondSet});</span>
<a href="#l128.522"></a><span id="l128.522" class="difflineminus">-  do_check_eq(secondColl.items.length, 0);</span>
<a href="#l128.523"></a><span id="l128.523" class="difflineplus">+  Assert.equal(secondColl.items.length, 0);</span>
<a href="#l128.524"></a><span id="l128.524"> </span>
<a href="#l128.525"></a><span id="l128.525">   // still show up in a privileged query</span>
<a href="#l128.526"></a><span id="l128.526">   privQuery = Gloda.newQuery(Gloda.NOUN_MESSAGE, {</span>
<a href="#l128.527"></a><span id="l128.527">                                noDbQueryValidityConstraints: true,</span>
<a href="#l128.528"></a><span id="l128.528">                              });</span>
<a href="#l128.529"></a><span id="l128.529">   privQuery.headerMessageID(secondSet.synMessages[0].messageId);</span>
<a href="#l128.530"></a><span id="l128.530">   queryExpect(privQuery, secondSet);</span>
<a href="#l128.531"></a><span id="l128.531">   yield false; // queryExpect is async</span>
<a href="#l128.532"></a><span id="l128.532" class="difflineat">@@ -904,17 +904,17 @@ function* test_message_deletion() {</span>
<a href="#l128.533"></a><span id="l128.533"> </span>
<a href="#l128.534"></a><span id="l128.534">   // it should no longer show up in a privileged query; we killed the ghosts</span>
<a href="#l128.535"></a><span id="l128.535">   queryExpect(privQuery, []);</span>
<a href="#l128.536"></a><span id="l128.536">   yield false; // queryExpect is async</span>
<a href="#l128.537"></a><span id="l128.537"> </span>
<a href="#l128.538"></a><span id="l128.538">   // - the conversation should have disappeared too</span>
<a href="#l128.539"></a><span id="l128.539">   // (we have no listener to watch for it to have disappeared from convQuery but</span>
<a href="#l128.540"></a><span id="l128.540">   //  this is basically how glodaTestHelper does its thing anyways.)</span>
<a href="#l128.541"></a><span id="l128.541" class="difflineminus">-  do_check_eq(convColl.items.length, 0);</span>
<a href="#l128.542"></a><span id="l128.542" class="difflineplus">+  Assert.equal(convColl.items.length, 0);</span>
<a href="#l128.543"></a><span id="l128.543"> </span>
<a href="#l128.544"></a><span id="l128.544">   // make sure the query fails to find it too</span>
<a href="#l128.545"></a><span id="l128.545">   queryExpect(convQuery, []);</span>
<a href="#l128.546"></a><span id="l128.546">   yield false; // queryExpect is async</span>
<a href="#l128.547"></a><span id="l128.547"> </span>
<a href="#l128.548"></a><span id="l128.548"> </span>
<a href="#l128.549"></a><span id="l128.549">   // -- identity culling verification</span>
<a href="#l128.550"></a><span id="l128.550">   mark_sub_test_start(&quot;identity culling verification&quot;);</span>
<a href="#l128.551"></a><span id="l128.551" class="difflineat">@@ -1048,24 +1048,24 @@ function* test_folder_deletion_nested() </span>
<a href="#l128.552"></a><span id="l128.552">   yield move_folder(folder2, folder1);</span>
<a href="#l128.553"></a><span id="l128.553"> </span>
<a href="#l128.554"></a><span id="l128.554">   // add a trash folder, and move folder1 into it</span>
<a href="#l128.555"></a><span id="l128.555">   let trash = make_empty_folder(null, [Ci.nsMsgFolderFlags.Trash]);</span>
<a href="#l128.556"></a><span id="l128.556">   yield move_folder(folder1, trash);</span>
<a href="#l128.557"></a><span id="l128.557"> </span>
<a href="#l128.558"></a><span id="l128.558">   let descendentFolders = get_nsIMsgFolder(trash).descendants;</span>
<a href="#l128.559"></a><span id="l128.559">   let folders = Array.from(fixIterator(descendentFolders, Ci.nsIMsgFolder));</span>
<a href="#l128.560"></a><span id="l128.560" class="difflineminus">-  do_check_eq(folders.length, 2);</span>
<a href="#l128.561"></a><span id="l128.561" class="difflineplus">+  Assert.equal(folders.length, 2);</span>
<a href="#l128.562"></a><span id="l128.562">   let [newFolder1, newFolder2] = folders;</span>
<a href="#l128.563"></a><span id="l128.563"> </span>
<a href="#l128.564"></a><span id="l128.564">   let glodaFolder1 = Gloda.getFolderForFolder(newFolder1);</span>
<a href="#l128.565"></a><span id="l128.565">   let glodaFolder2 = Gloda.getFolderForFolder(newFolder2);</span>
<a href="#l128.566"></a><span id="l128.566"> </span>
<a href="#l128.567"></a><span id="l128.567">   // verify that Gloda properly marked this folder as not to be indexed anymore </span>
<a href="#l128.568"></a><span id="l128.568" class="difflineminus">-  do_check_eq(glodaFolder1.indexingPriority, glodaFolder1.kIndexingNeverPriority);</span>
<a href="#l128.569"></a><span id="l128.569" class="difflineplus">+  Assert.equal(glodaFolder1.indexingPriority, glodaFolder1.kIndexingNeverPriority);</span>
<a href="#l128.570"></a><span id="l128.570"> </span>
<a href="#l128.571"></a><span id="l128.571">   // check that existing message is marked as deleted</span>
<a href="#l128.572"></a><span id="l128.572">   yield wait_for_gloda_indexer([], {deleted: [msgSet1, msgSet2]});</span>
<a href="#l128.573"></a><span id="l128.573"> </span>
<a href="#l128.574"></a><span id="l128.574">   // make sure the deletion hit the database</span>
<a href="#l128.575"></a><span id="l128.575">   yield sqlExpectCount(1,</span>
<a href="#l128.576"></a><span id="l128.576">     &quot;SELECT COUNT(*) from folderLocations WHERE id = ? AND indexingPriority = ?&quot;,</span>
<a href="#l128.577"></a><span id="l128.577">      glodaFolder1.id, glodaFolder1.kIndexingNeverPriority);</span>
<a href="#l128.578"></a><span id="l128.578" class="difflineat">@@ -1128,42 +1128,42 @@ function* test_message_moving() {</span>
<a href="#l128.579"></a><span id="l128.579">   yield async_move_messages(msgSet, destFolder, true);</span>
<a href="#l128.580"></a><span id="l128.580"> </span>
<a href="#l128.581"></a><span id="l128.581">   // - make sure gloda sees it in the new folder</span>
<a href="#l128.582"></a><span id="l128.582">   // Since we are doing offline IMAP moves, the fast-path should be taken and</span>
<a href="#l128.583"></a><span id="l128.583">   //  so we should receive an itemsModified notification without a call to</span>
<a href="#l128.584"></a><span id="l128.584">   //  Gloda.grokNounItem.</span>
<a href="#l128.585"></a><span id="l128.585">   yield wait_for_gloda_indexer(msgSet, {fullyIndexed: 0});</span>
<a href="#l128.586"></a><span id="l128.586"> </span>
<a href="#l128.587"></a><span id="l128.587" class="difflineminus">-  do_check_eq(gmsg.folderURI,</span>
<a href="#l128.588"></a><span id="l128.588" class="difflineminus">-              get_real_injection_folder(destFolder).URI);</span>
<a href="#l128.589"></a><span id="l128.589" class="difflineplus">+  Assert.equal(gmsg.folderURI,</span>
<a href="#l128.590"></a><span id="l128.590" class="difflineplus">+               get_real_injection_folder(destFolder).URI);</span>
<a href="#l128.591"></a><span id="l128.591"> </span>
<a href="#l128.592"></a><span id="l128.592">   // - make sure the message key is correct!</span>
<a href="#l128.593"></a><span id="l128.593" class="difflineminus">-  do_check_eq(gmsg.messageKey, msgSet.getMsgHdr(0).messageKey);</span>
<a href="#l128.594"></a><span id="l128.594" class="difflineplus">+  Assert.equal(gmsg.messageKey, msgSet.getMsgHdr(0).messageKey);</span>
<a href="#l128.595"></a><span id="l128.595">   // (sanity check that the messageKey actually changed for the message...)</span>
<a href="#l128.596"></a><span id="l128.596" class="difflineminus">-  do_check_neq(gmsg.messageKey, oldMessageKey);</span>
<a href="#l128.597"></a><span id="l128.597" class="difflineplus">+  Assert.notEqual(gmsg.messageKey, oldMessageKey);</span>
<a href="#l128.598"></a><span id="l128.598"> </span>
<a href="#l128.599"></a><span id="l128.599">   // - make sure the indexer's _keyChangedBatchInfo dict is empty</span>
<a href="#l128.600"></a><span id="l128.600">   for (let evilKey in GlodaMsgIndexer._keyChangedBatchInfo) {</span>
<a href="#l128.601"></a><span id="l128.601">     let evilValue = GlodaMsgIndexer._keyChangedBatchInfo[evilKey];</span>
<a href="#l128.602"></a><span id="l128.602">     mark_failure([&quot;GlodaMsgIndexer._keyChangedBatchInfo should be empty but&quot;,</span>
<a href="#l128.603"></a><span id="l128.603">                   &quot;has key:&quot;,  evilKey, &quot;and value:&quot;, evilValue, &quot;.&quot;]);</span>
<a href="#l128.604"></a><span id="l128.604">   }</span>
<a href="#l128.605"></a><span id="l128.605"> </span>
<a href="#l128.606"></a><span id="l128.606">   // - slowpath (IMAP online) move it back to its origin folder</span>
<a href="#l128.607"></a><span id="l128.607">   mark_sub_test_start(&quot;move it back&quot;);</span>
<a href="#l128.608"></a><span id="l128.608">   yield async_move_messages(msgSet, srcFolder, false);</span>
<a href="#l128.609"></a><span id="l128.609">   // In the IMAP case we will end up reindexing the message because we will</span>
<a href="#l128.610"></a><span id="l128.610">   //  not be able to fast-path, but the local case will still be fast-pathed.</span>
<a href="#l128.611"></a><span id="l128.611">   yield wait_for_gloda_indexer(msgSet,</span>
<a href="#l128.612"></a><span id="l128.612">                                {fullyIndexed: message_injection_is_local() ?</span>
<a href="#l128.613"></a><span id="l128.613">                                                 0 : 1});</span>
<a href="#l128.614"></a><span id="l128.614" class="difflineminus">-  do_check_eq(gmsg.folderURI,</span>
<a href="#l128.615"></a><span id="l128.615" class="difflineminus">-              get_real_injection_folder(srcFolder).URI);</span>
<a href="#l128.616"></a><span id="l128.616" class="difflineminus">-  do_check_eq(gmsg.messageKey, msgSet.getMsgHdr(0).messageKey);</span>
<a href="#l128.617"></a><span id="l128.617" class="difflineplus">+  Assert.equal(gmsg.folderURI,</span>
<a href="#l128.618"></a><span id="l128.618" class="difflineplus">+               get_real_injection_folder(srcFolder).URI);</span>
<a href="#l128.619"></a><span id="l128.619" class="difflineplus">+  Assert.equal(gmsg.messageKey, msgSet.getMsgHdr(0).messageKey);</span>
<a href="#l128.620"></a><span id="l128.620"> }</span>
<a href="#l128.621"></a><span id="l128.621"> </span>
<a href="#l128.622"></a><span id="l128.622"> /**</span>
<a href="#l128.623"></a><span id="l128.623">  * Moving a gloda-indexed message out of a filthy folder should result in the</span>
<a href="#l128.624"></a><span id="l128.624">  *  destination message not having a gloda-id.</span>
<a href="#l128.625"></a><span id="l128.625">  */</span>
<a href="#l128.626"></a><span id="l128.626"> </span>
<a href="#l128.627"></a><span id="l128.627"> /* ===== Message Copying ===== */</span>
<a href="#l128.628"></a><span id="l128.628" class="difflineat">@@ -1211,17 +1211,17 @@ function* test_filthy_moves_slash_move_f</span>
<a href="#l128.629"></a><span id="l128.629">   // - disable event driven indexing so we don't get interference from indexing</span>
<a href="#l128.630"></a><span id="l128.630">   configure_gloda_indexing({event: false});</span>
<a href="#l128.631"></a><span id="l128.631"> </span>
<a href="#l128.632"></a><span id="l128.632">   // - move</span>
<a href="#l128.633"></a><span id="l128.633">   yield async_move_messages(msgSet, destFolder);</span>
<a href="#l128.634"></a><span id="l128.634"> </span>
<a href="#l128.635"></a><span id="l128.635">   // - verify the target has no gloda-id!</span>
<a href="#l128.636"></a><span id="l128.636">   mark_action(&quot;actual&quot;, &quot;checking&quot;, [msgSet.getMsgHdr(0)]);</span>
<a href="#l128.637"></a><span id="l128.637" class="difflineminus">-  do_check_eq(msgSet.getMsgHdr(0).getUint32Property(&quot;gloda-id&quot;), 0);</span>
<a href="#l128.638"></a><span id="l128.638" class="difflineplus">+  Assert.equal(msgSet.getMsgHdr(0).getUint32Property(&quot;gloda-id&quot;), 0);</span>
<a href="#l128.639"></a><span id="l128.639"> </span>
<a href="#l128.640"></a><span id="l128.640">   // - re-enable indexing and let the indexer run</span>
<a href="#l128.641"></a><span id="l128.641">   // (we don't want to affect other tests)</span>
<a href="#l128.642"></a><span id="l128.642">   configure_gloda_indexing({});</span>
<a href="#l128.643"></a><span id="l128.643">   yield wait_for_gloda_indexer([msgSet]);</span>
<a href="#l128.644"></a><span id="l128.644"> }</span>
<a href="#l128.645"></a><span id="l128.645"> </span>
<a href="#l128.646"></a><span id="l128.646"> var tests = [</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -22,18 +22,18 @@ function getLiveFolderCount() {</span>
<a href="#l129.4"></a><span id="l129.4"> </span>
<a href="#l129.5"></a><span id="l129.5"> /**</span>
<a href="#l129.6"></a><span id="l129.6">  * Meddle with internals of live folder tracking, create a synthetic message and</span>
<a href="#l129.7"></a><span id="l129.7">  *  index it. We do the actual work involving the headers and folders in</span>
<a href="#l129.8"></a><span id="l129.8">  *  poke_and_verify_msf_closure.</span>
<a href="#l129.9"></a><span id="l129.9">  */</span>
<a href="#l129.10"></a><span id="l129.10"> function* test_msf_closure() {</span>
<a href="#l129.11"></a><span id="l129.11">   // before doing anything, the indexer should not be tracking any live folders</span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-  do_check_false(GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.13"></a><span id="l129.13" class="difflineminus">-  do_check_eq(0, getLiveFolderCount());</span>
<a href="#l129.14"></a><span id="l129.14" class="difflineplus">+  Assert.ok(!GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.15"></a><span id="l129.15" class="difflineplus">+  Assert.equal(0, getLiveFolderCount());</span>
<a href="#l129.16"></a><span id="l129.16"> </span>
<a href="#l129.17"></a><span id="l129.17">   // make the datastore's folder cleanup timer never be at risk of firing</span>
<a href="#l129.18"></a><span id="l129.18">   GlodaDatastore._folderCleanupTimerInterval = 1000000000;</span>
<a href="#l129.19"></a><span id="l129.19">   // set the acceptably old threshold so it will never age out</span>
<a href="#l129.20"></a><span id="l129.20">   GlodaFolder.prototype.ACCEPTABLY_OLD_THRESHOLD = 1000000000;</span>
<a href="#l129.21"></a><span id="l129.21"> </span>
<a href="#l129.22"></a><span id="l129.22">   // create a synthetic message</span>
<a href="#l129.23"></a><span id="l129.23">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l129.24"></a><span id="l129.24" class="difflineat">@@ -48,58 +48,58 @@ function* test_msf_closure() {</span>
<a href="#l129.25"></a><span id="l129.25">  *</span>
<a href="#l129.26"></a><span id="l129.26">  * @param aSynthMessage The synthetic message we indexed.</span>
<a href="#l129.27"></a><span id="l129.27">  * @param aGlodaMessage Its exciting gloda representation</span>
<a href="#l129.28"></a><span id="l129.28">  */</span>
<a href="#l129.29"></a><span id="l129.29"> function poke_and_verify_msf_closure(aSynthMessage, aGlodaMessage) {</span>
<a href="#l129.30"></a><span id="l129.30">   // get the nsIMsgDBHdr</span>
<a href="#l129.31"></a><span id="l129.31">   let header = aGlodaMessage.folderMessage;</span>
<a href="#l129.32"></a><span id="l129.32">   // if we don't have a header, this test is unlikely to work...</span>
<a href="#l129.33"></a><span id="l129.33" class="difflineminus">-  do_check_true(header !== null);</span>
<a href="#l129.34"></a><span id="l129.34" class="difflineplus">+  Assert.ok(header !== null);</span>
<a href="#l129.35"></a><span id="l129.35"> </span>
<a href="#l129.36"></a><span id="l129.36">   // we need a reference to the glodaFolder</span>
<a href="#l129.37"></a><span id="l129.37">   let glodaFolder = aGlodaMessage.folder;</span>
<a href="#l129.38"></a><span id="l129.38"> </span>
<a href="#l129.39"></a><span id="l129.39">   // -- check that everyone is tracking things correctly</span>
<a href="#l129.40"></a><span id="l129.40">   // the message's folder should be holding an XPCOM reference to the folder</span>
<a href="#l129.41"></a><span id="l129.41" class="difflineminus">-  do_check_true(glodaFolder._xpcomFolder !== null);</span>
<a href="#l129.42"></a><span id="l129.42" class="difflineplus">+  Assert.ok(glodaFolder._xpcomFolder !== null);</span>
<a href="#l129.43"></a><span id="l129.43">   // the cleanup timer should now be alive</span>
<a href="#l129.44"></a><span id="l129.44" class="difflineminus">-  do_check_true(GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.45"></a><span id="l129.45" class="difflineplus">+  Assert.ok(GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.46"></a><span id="l129.46">   // live folder count should be one</span>
<a href="#l129.47"></a><span id="l129.47" class="difflineminus">-  do_check_eq(1, getLiveFolderCount());</span>
<a href="#l129.48"></a><span id="l129.48" class="difflineplus">+  Assert.equal(1, getLiveFolderCount());</span>
<a href="#l129.49"></a><span id="l129.49"> </span>
<a href="#l129.50"></a><span id="l129.50">   // -- simulate a timer cleanup firing...</span>
<a href="#l129.51"></a><span id="l129.51">   GlodaDatastore._performFolderCleanup();</span>
<a href="#l129.52"></a><span id="l129.52"> </span>
<a href="#l129.53"></a><span id="l129.53">   // -- verify that things are still as they were before the cleanup firing</span>
<a href="#l129.54"></a><span id="l129.54">   // the message's folder should be holding an XPCOM reference to the folder</span>
<a href="#l129.55"></a><span id="l129.55" class="difflineminus">-  do_check_true(glodaFolder._xpcomFolder !== null);</span>
<a href="#l129.56"></a><span id="l129.56" class="difflineplus">+  Assert.ok(glodaFolder._xpcomFolder !== null);</span>
<a href="#l129.57"></a><span id="l129.57">   // the cleanup timer should now be alive</span>
<a href="#l129.58"></a><span id="l129.58" class="difflineminus">-  do_check_true(GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.59"></a><span id="l129.59" class="difflineplus">+  Assert.ok(GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.60"></a><span id="l129.60">   // live folder count should be one</span>
<a href="#l129.61"></a><span id="l129.61" class="difflineminus">-  do_check_eq(1, getLiveFolderCount());</span>
<a href="#l129.62"></a><span id="l129.62" class="difflineplus">+  Assert.equal(1, getLiveFolderCount());</span>
<a href="#l129.63"></a><span id="l129.63"> </span>
<a href="#l129.64"></a><span id="l129.64">   // -- change oldness constant so that it cannot help but be true</span>
<a href="#l129.65"></a><span id="l129.65">   // (the goal is to avoid getting tricked by the granularity of the timer</span>
<a href="#l129.66"></a><span id="l129.66">   //  updates, as well as to make sure our logic is right by skewing the</span>
<a href="#l129.67"></a><span id="l129.67">   //  constant wildly, so that if our logic was backwards, we would fail.)</span>
<a href="#l129.68"></a><span id="l129.68">   // put the threshold 1000 seconds in the future; the event must be older than</span>
<a href="#l129.69"></a><span id="l129.69">   //  the future, for obvious reasons.</span>
<a href="#l129.70"></a><span id="l129.70">   GlodaFolder.prototype.ACCEPTABLY_OLD_THRESHOLD = -1000000;</span>
<a href="#l129.71"></a><span id="l129.71"> </span>
<a href="#l129.72"></a><span id="l129.72">   // -- simulate a timer cleanup firing...</span>
<a href="#l129.73"></a><span id="l129.73">   GlodaDatastore._performFolderCleanup();</span>
<a href="#l129.74"></a><span id="l129.74"> </span>
<a href="#l129.75"></a><span id="l129.75">   // -- verify that cleanup has occurred and the cleanup mechanism shutdown.</span>
<a href="#l129.76"></a><span id="l129.76">   // the message's folder should no longer be holding an XPCOM reference</span>
<a href="#l129.77"></a><span id="l129.77" class="difflineminus">-  do_check_true(glodaFolder._xpcomFolder === null);</span>
<a href="#l129.78"></a><span id="l129.78" class="difflineplus">+  Assert.ok(glodaFolder._xpcomFolder === null);</span>
<a href="#l129.79"></a><span id="l129.79">   // the cleanup timer should now be dead</span>
<a href="#l129.80"></a><span id="l129.80" class="difflineminus">-  do_check_false(GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.81"></a><span id="l129.81" class="difflineplus">+  Assert.ok(!GlodaDatastore._folderCleanupActive);</span>
<a href="#l129.82"></a><span id="l129.82">   // live folder count should be zero</span>
<a href="#l129.83"></a><span id="l129.83" class="difflineminus">-  do_check_eq(0, getLiveFolderCount());</span>
<a href="#l129.84"></a><span id="l129.84" class="difflineplus">+  Assert.equal(0, getLiveFolderCount());</span>
<a href="#l129.85"></a><span id="l129.85"> }</span>
<a href="#l129.86"></a><span id="l129.86"> </span>
<a href="#l129.87"></a><span id="l129.87"> var tests = [</span>
<a href="#l129.88"></a><span id="l129.88">   test_msf_closure,</span>
<a href="#l129.89"></a><span id="l129.89"> ];</span>
<a href="#l129.90"></a><span id="l129.90"> </span>
<a href="#l129.91"></a><span id="l129.91"> function run_test() {</span>
<a href="#l129.92"></a><span id="l129.92">   // we only need to test using local folders, although it is important that</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l130.1"></a><span id="l130.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_corrupt_database.js</span>
<a href="#l130.2"></a><span id="l130.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_corrupt_database.js</span>
<a href="#l130.3"></a><span id="l130.3" class="difflineat">@@ -98,35 +98,35 @@ function test_corrupt_databases_get_repo</span>
<a href="#l130.4"></a><span id="l130.4"> </span>
<a href="#l130.5"></a><span id="l130.5">   // - init gloda, get warnings</span>
<a href="#l130.6"></a><span id="l130.6">   mark_sub_test_start(&quot;init gloda&quot;);</span>
<a href="#l130.7"></a><span id="l130.7">   Components.utils.import(&quot;resource:///modules/gloda/public.js&quot;);</span>
<a href="#l130.8"></a><span id="l130.8">   mark_sub_test_start(&quot;gloda inited, checking&quot;);</span>
<a href="#l130.9"></a><span id="l130.9"> </span>
<a href="#l130.10"></a><span id="l130.10">   mark_action(&quot;actual&quot;, &quot;Counting appender counts&quot;, [countingAppender.counts]);</span>
<a href="#l130.11"></a><span id="l130.11">   // we expect 2 warnings</span>
<a href="#l130.12"></a><span id="l130.12" class="difflineminus">-  do_check_eq(countingAppender.getCountForLevel(Log4Moz.Level.Warn), 2);</span>
<a href="#l130.13"></a><span id="l130.13" class="difflineplus">+  Assert.equal(countingAppender.getCountForLevel(Log4Moz.Level.Warn), 2);</span>
<a href="#l130.14"></a><span id="l130.14">   // and no errors</span>
<a href="#l130.15"></a><span id="l130.15" class="difflineminus">-  do_check_eq(countingAppender.getCountForLevel(Log4Moz.Level.Error), 0);</span>
<a href="#l130.16"></a><span id="l130.16" class="difflineplus">+  Assert.equal(countingAppender.getCountForLevel(Log4Moz.Level.Error), 0);</span>
<a href="#l130.17"></a><span id="l130.17"> </span>
<a href="#l130.18"></a><span id="l130.18">   // - make sure the datastore has an actual database</span>
<a href="#l130.19"></a><span id="l130.19">   Components.utils.import(&quot;resource:///modules/gloda/datastore.js&quot;);</span>
<a href="#l130.20"></a><span id="l130.20"> </span>
<a href="#l130.21"></a><span id="l130.21">   // Make sure that the datastoreID was overwritten</span>
<a href="#l130.22"></a><span id="l130.22" class="difflineminus">-  do_check_neq(Gloda.datastoreID, kOriginalDatastoreID);</span>
<a href="#l130.23"></a><span id="l130.23" class="difflineplus">+  Assert.notEqual(Gloda.datastoreID, kOriginalDatastoreID);</span>
<a href="#l130.24"></a><span id="l130.24">   // And for good measure, make sure that the pref was also overwritten</span>
<a href="#l130.25"></a><span id="l130.25">   let currentDatastoreID = Services.prefs.getCharPref(kDatastoreIDPref);</span>
<a href="#l130.26"></a><span id="l130.26" class="difflineminus">-  do_check_neq(currentDatastoreID, kOriginalDatastoreID);</span>
<a href="#l130.27"></a><span id="l130.27" class="difflineplus">+  Assert.notEqual(currentDatastoreID, kOriginalDatastoreID);</span>
<a href="#l130.28"></a><span id="l130.28">   // We'll also ensure that the Gloda.datastoreID matches the one stashed</span>
<a href="#l130.29"></a><span id="l130.29">   // in prefs...</span>
<a href="#l130.30"></a><span id="l130.30" class="difflineminus">-  do_check_eq(currentDatastoreID, Gloda.datastoreID);</span>
<a href="#l130.31"></a><span id="l130.31" class="difflineplus">+  Assert.equal(currentDatastoreID, Gloda.datastoreID);</span>
<a href="#l130.32"></a><span id="l130.32">   // And finally, we'll make sure that the datastoreID is a string with length</span>
<a href="#l130.33"></a><span id="l130.33">   // greater than 0.</span>
<a href="#l130.34"></a><span id="l130.34" class="difflineminus">-  do_check_eq(typeof(Gloda.datastoreID), &quot;string&quot;);</span>
<a href="#l130.35"></a><span id="l130.35" class="difflineminus">-  do_check_true(Gloda.datastoreID.length &gt; 0);</span>
<a href="#l130.36"></a><span id="l130.36" class="difflineplus">+  Assert.equal(typeof(Gloda.datastoreID), &quot;string&quot;);</span>
<a href="#l130.37"></a><span id="l130.37" class="difflineplus">+  Assert.ok(Gloda.datastoreID.length &gt; 0);</span>
<a href="#l130.38"></a><span id="l130.38"> </span>
<a href="#l130.39"></a><span id="l130.39">   if (!GlodaDatastore.asyncConnection)</span>
<a href="#l130.40"></a><span id="l130.40">     do_throw(&quot;No database connection suggests no database!&quot;);</span>
<a href="#l130.41"></a><span id="l130.41"> }</span>
<a href="#l130.42"></a><span id="l130.42"> </span>
<a href="#l130.43"></a><span id="l130.43"> var tests = [</span>
<a href="#l130.44"></a><span id="l130.44">   test_corrupt_databases_get_reported_and_blown_away,</span>
<a href="#l130.45"></a><span id="l130.45"> ];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l131.1"></a><span id="l131.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_folder_logic.js</span>
<a href="#l131.2"></a><span id="l131.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_folder_logic.js</span>
<a href="#l131.3"></a><span id="l131.3" class="difflineat">@@ -8,38 +8,38 @@ load(&quot;resources/glodaTestHelper.js&quot;);</span>
<a href="#l131.4"></a><span id="l131.4"> </span>
<a href="#l131.5"></a><span id="l131.5"> /**</span>
<a href="#l131.6"></a><span id="l131.6">  * Newly created folders should not be filthy (at least as long as they have</span>
<a href="#l131.7"></a><span id="l131.7">  *  nothing in them.)</span>
<a href="#l131.8"></a><span id="l131.8">  */</span>
<a href="#l131.9"></a><span id="l131.9"> function test_newly_created_folders_start_clean() {</span>
<a href="#l131.10"></a><span id="l131.10">   let msgFolder = make_empty_folder();</span>
<a href="#l131.11"></a><span id="l131.11">   let glodaFolder = Gloda.getFolderForFolder(msgFolder);</span>
<a href="#l131.12"></a><span id="l131.12" class="difflineminus">-  do_check_eq(glodaFolder.dirtyStatus, glodaFolder.kFolderClean);</span>
<a href="#l131.13"></a><span id="l131.13" class="difflineplus">+  Assert.equal(glodaFolder.dirtyStatus, glodaFolder.kFolderClean);</span>
<a href="#l131.14"></a><span id="l131.14"> }</span>
<a href="#l131.15"></a><span id="l131.15"> </span>
<a href="#l131.16"></a><span id="l131.16"> /**</span>
<a href="#l131.17"></a><span id="l131.17">  * Deleted folders should not leave behind any mapping, and that mapping</span>
<a href="#l131.18"></a><span id="l131.18">  *  definitely should not interfere with a newly created folder of the same</span>
<a href="#l131.19"></a><span id="l131.19">  *  name.</span>
<a href="#l131.20"></a><span id="l131.20">  */</span>
<a href="#l131.21"></a><span id="l131.21"> function* test_deleted_folder_tombstones_get_forgotten() {</span>
<a href="#l131.22"></a><span id="l131.22">   let oldFolder = make_empty_folder(&quot;volver&quot;);</span>
<a href="#l131.23"></a><span id="l131.23">   let oldGlodaFolder = Gloda.getFolderForFolder(oldFolder);</span>
<a href="#l131.24"></a><span id="l131.24">   yield async_delete_folder(oldFolder);</span>
<a href="#l131.25"></a><span id="l131.25"> </span>
<a href="#l131.26"></a><span id="l131.26">   // the tombstone needs to know it is deleted</span>
<a href="#l131.27"></a><span id="l131.27" class="difflineminus">-  do_check_true(oldGlodaFolder._deleted);</span>
<a href="#l131.28"></a><span id="l131.28" class="difflineplus">+  Assert.ok(oldGlodaFolder._deleted);</span>
<a href="#l131.29"></a><span id="l131.29"> </span>
<a href="#l131.30"></a><span id="l131.30">   let newFolder = make_empty_folder(&quot;volver&quot;);</span>
<a href="#l131.31"></a><span id="l131.31">   let newGlodaFolder = Gloda.getFolderForFolder(newFolder);</span>
<a href="#l131.32"></a><span id="l131.32"> </span>
<a href="#l131.33"></a><span id="l131.33">   // this folder better not be the same and better not think it is deleted.</span>
<a href="#l131.34"></a><span id="l131.34" class="difflineminus">-  do_check_neq(oldGlodaFolder, newGlodaFolder);</span>
<a href="#l131.35"></a><span id="l131.35" class="difflineminus">-  do_check_false(newGlodaFolder._deleted);</span>
<a href="#l131.36"></a><span id="l131.36" class="difflineplus">+  Assert.notEqual(oldGlodaFolder, newGlodaFolder);</span>
<a href="#l131.37"></a><span id="l131.37" class="difflineplus">+  Assert.ok(!newGlodaFolder._deleted);</span>
<a href="#l131.38"></a><span id="l131.38"> }</span>
<a href="#l131.39"></a><span id="l131.39"> </span>
<a href="#l131.40"></a><span id="l131.40"> var tests = [</span>
<a href="#l131.41"></a><span id="l131.41">   test_newly_created_folders_start_clean,</span>
<a href="#l131.42"></a><span id="l131.42">   test_deleted_folder_tombstones_get_forgotten,</span>
<a href="#l131.43"></a><span id="l131.43"> ];</span>
<a href="#l131.44"></a><span id="l131.44"> </span>
<a href="#l131.45"></a><span id="l131.45"> function run_test() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l132.1"></a><span id="l132.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js</span>
<a href="#l132.2"></a><span id="l132.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js</span>
<a href="#l132.3"></a><span id="l132.3" class="difflineat">@@ -101,23 +101,23 @@ function* test_index(aPhrase) {</span>
<a href="#l132.4"></a><span id="l132.4">  */</span>
<a href="#l132.5"></a><span id="l132.5"> function verify_index(smsg, gmsg) {</span>
<a href="#l132.6"></a><span id="l132.6">   let [charset, actual] = smsg.callerData;</span>
<a href="#l132.7"></a><span id="l132.7">   let subject = gmsg.subject;</span>
<a href="#l132.8"></a><span id="l132.8">   let indexedBodyText = gmsg.indexedBodyText.trim();</span>
<a href="#l132.9"></a><span id="l132.9">   let attachmentName = gmsg.attachmentNames[0];</span>
<a href="#l132.10"></a><span id="l132.10">   LOG.debug(&quot;using character set: &quot; + charset + &quot; actual: &quot; + actual);</span>
<a href="#l132.11"></a><span id="l132.11">   LOG.debug(&quot;subject: &quot; + subject + &quot; (len: &quot; + subject.length + &quot;)&quot;);</span>
<a href="#l132.12"></a><span id="l132.12" class="difflineminus">-  do_check_eq(actual, subject);</span>
<a href="#l132.13"></a><span id="l132.13" class="difflineplus">+  Assert.equal(actual, subject);</span>
<a href="#l132.14"></a><span id="l132.14">   LOG.debug(&quot;body: &quot; + indexedBodyText +</span>
<a href="#l132.15"></a><span id="l132.15">       &quot; (len: &quot; + indexedBodyText.length + &quot;)&quot;);</span>
<a href="#l132.16"></a><span id="l132.16" class="difflineminus">-  do_check_eq(actual, indexedBodyText);</span>
<a href="#l132.17"></a><span id="l132.17" class="difflineplus">+  Assert.equal(actual, indexedBodyText);</span>
<a href="#l132.18"></a><span id="l132.18">   LOG.debug(&quot;attachment name:&quot; + attachmentName +</span>
<a href="#l132.19"></a><span id="l132.19">       &quot; (len: &quot; + attachmentName.length + &quot;)&quot;);</span>
<a href="#l132.20"></a><span id="l132.20" class="difflineminus">-  do_check_eq(actual, attachmentName);</span>
<a href="#l132.21"></a><span id="l132.21" class="difflineplus">+  Assert.equal(actual, attachmentName);</span>
<a href="#l132.22"></a><span id="l132.22"> }</span>
<a href="#l132.23"></a><span id="l132.23"> </span>
<a href="#l132.24"></a><span id="l132.24"> /**</span>
<a href="#l132.25"></a><span id="l132.25">  * - Check that the 'aa' token was never emitted (we don't emit two-letter</span>
<a href="#l132.26"></a><span id="l132.26">  *   tokens unless they're CJK).</span>
<a href="#l132.27"></a><span id="l132.27">  * - Check that the '\u81ea\u52d5' token was emitted, because it's CJK.</span>
<a href="#l132.28"></a><span id="l132.28">  * - Check that the 'bbb' token was duly emitted (three letters is more than two</span>
<a href="#l132.29"></a><span id="l132.29">  *   letters so it's tokenized).</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l133.1"></a><span id="l133.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_addressbook.js</span>
<a href="#l133.2"></a><span id="l133.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_addressbook.js</span>
<a href="#l133.3"></a><span id="l133.3" class="difflineat">@@ -70,44 +70,44 @@ function* setup_create_identity() {</span>
<a href="#l133.4"></a><span id="l133.4">   let identQuery = Gloda.newQuery(Gloda.NOUN_IDENTITY);</span>
<a href="#l133.5"></a><span id="l133.5">   identQuery.kind(&quot;email&quot;);</span>
<a href="#l133.6"></a><span id="l133.6">   identQuery.value(EMAIL_ADDRESS);</span>
<a href="#l133.7"></a><span id="l133.7">   identityCollection = queryExpect(identQuery, [EMAIL_ADDRESS]);</span>
<a href="#l133.8"></a><span id="l133.8">   yield false;</span>
<a href="#l133.9"></a><span id="l133.9"> </span>
<a href="#l133.10"></a><span id="l133.10">   // now the identity exists... make sure it is in cache.</span>
<a href="#l133.11"></a><span id="l133.11">   let identity = get_cached_gloda_identity_for_email(EMAIL_ADDRESS);</span>
<a href="#l133.12"></a><span id="l133.12" class="difflineminus">-  do_check_neq(identity, null);</span>
<a href="#l133.13"></a><span id="l133.13" class="difflineplus">+  Assert.notEqual(identity, null);</span>
<a href="#l133.14"></a><span id="l133.14"> </span>
<a href="#l133.15"></a><span id="l133.15">   // and make sure it has no idea what the current state of the card is.</span>
<a href="#l133.16"></a><span id="l133.16">   if (identity._hasAddressBookCard !== undefined)</span>
<a href="#l133.17"></a><span id="l133.17">     do_throw(&quot;We should have no idea about the state of the ab card, but &quot; +</span>
<a href="#l133.18"></a><span id="l133.18">              &quot;it's: &quot; + identity._hasAddressBookCard);</span>
<a href="#l133.19"></a><span id="l133.19"> }</span>
<a href="#l133.20"></a><span id="l133.20"> </span>
<a href="#l133.21"></a><span id="l133.21"> /**</span>
<a href="#l133.22"></a><span id="l133.22">  * (Re-)Add a card for that e-mail, make sure we update the cached identity ab</span>
<a href="#l133.23"></a><span id="l133.23">  *  card state.</span>
<a href="#l133.24"></a><span id="l133.24">  */</span>
<a href="#l133.25"></a><span id="l133.25"> function test_add_card_cache_indication() {</span>
<a href="#l133.26"></a><span id="l133.26">   add_card(EMAIL_ADDRESS, DISPLAY_NAME);</span>
<a href="#l133.27"></a><span id="l133.27"> </span>
<a href="#l133.28"></a><span id="l133.28">   let identity = get_cached_gloda_identity_for_email(EMAIL_ADDRESS);</span>
<a href="#l133.29"></a><span id="l133.29" class="difflineminus">-  do_check_eq(identity._hasAddressBookCard, true);</span>
<a href="#l133.30"></a><span id="l133.30" class="difflineplus">+  Assert.equal(identity._hasAddressBookCard, true);</span>
<a href="#l133.31"></a><span id="l133.31"> }</span>
<a href="#l133.32"></a><span id="l133.32"> </span>
<a href="#l133.33"></a><span id="l133.33"> /**</span>
<a href="#l133.34"></a><span id="l133.34">  * Remove the card we added in setup, make sure we update the cached identity</span>
<a href="#l133.35"></a><span id="l133.35">  *  ab card state.</span>
<a href="#l133.36"></a><span id="l133.36">  */</span>
<a href="#l133.37"></a><span id="l133.37"> function test_remove_card_cache_indication() {</span>
<a href="#l133.38"></a><span id="l133.38">   delete_card(EMAIL_ADDRESS);</span>
<a href="#l133.39"></a><span id="l133.39"> </span>
<a href="#l133.40"></a><span id="l133.40">   let identity = get_cached_gloda_identity_for_email(EMAIL_ADDRESS);</span>
<a href="#l133.41"></a><span id="l133.41" class="difflineminus">-  do_check_eq(identity._hasAddressBookCard, false);</span>
<a href="#l133.42"></a><span id="l133.42" class="difflineplus">+  Assert.equal(identity._hasAddressBookCard, false);</span>
<a href="#l133.43"></a><span id="l133.43"> }</span>
<a href="#l133.44"></a><span id="l133.44"> </span>
<a href="#l133.45"></a><span id="l133.45"> </span>
<a href="#l133.46"></a><span id="l133.46"> var tests = [</span>
<a href="#l133.47"></a><span id="l133.47">   // - events update identity._hasAddressBookCard correctly</span>
<a href="#l133.48"></a><span id="l133.48">   setup_create_identity,</span>
<a href="#l133.49"></a><span id="l133.49">   test_add_card_cache_indication,</span>
<a href="#l133.50"></a><span id="l133.50">   test_remove_card_cache_indication,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l134.1"></a><span id="l134.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_bad_messages.js</span>
<a href="#l134.2"></a><span id="l134.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_bad_messages.js</span>
<a href="#l134.3"></a><span id="l134.3" class="difflineat">@@ -38,20 +38,20 @@ function* test_illegal_message(aInfo) {</span>
<a href="#l134.4"></a><span id="l134.4">   yield wait_for_message_injection();</span>
<a href="#l134.5"></a><span id="l134.5"> </span>
<a href="#l134.6"></a><span id="l134.6">   // indexing should complete without actually indexing the message</span>
<a href="#l134.7"></a><span id="l134.7">   yield wait_for_gloda_indexer([], {recovered: 1, failedToRecover: 0,</span>
<a href="#l134.8"></a><span id="l134.8">                                     cleanedUp: 0, hadNoCleanUp: 0});</span>
<a href="#l134.9"></a><span id="l134.9"> </span>
<a href="#l134.10"></a><span id="l134.10">   // make sure the header has the expected gloda bad message state.</span>
<a href="#l134.11"></a><span id="l134.11">   let msgHdr = msgSet.getMsgHdr(0);</span>
<a href="#l134.12"></a><span id="l134.12" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-id&quot;), GLODA_BAD_MESSAGE_ID);</span>
<a href="#l134.13"></a><span id="l134.13" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-id&quot;), GLODA_BAD_MESSAGE_ID);</span>
<a href="#l134.14"></a><span id="l134.14"> </span>
<a href="#l134.15"></a><span id="l134.15">   // make sure gloda does not think the message is indexed</span>
<a href="#l134.16"></a><span id="l134.16" class="difflineminus">-  do_check_eq(Gloda.isMessageIndexed(msgHdr), false);</span>
<a href="#l134.17"></a><span id="l134.17" class="difflineplus">+  Assert.equal(Gloda.isMessageIndexed(msgHdr), false);</span>
<a href="#l134.18"></a><span id="l134.18"> }</span>
<a href="#l134.19"></a><span id="l134.19"> </span>
<a href="#l134.20"></a><span id="l134.20"> /**</span>
<a href="#l134.21"></a><span id="l134.21">  * A byzantine failure to stream should not sink us.  Fake a failure.</span>
<a href="#l134.22"></a><span id="l134.22">  */</span>
<a href="#l134.23"></a><span id="l134.23"> function* test_streaming_failure() {</span>
<a href="#l134.24"></a><span id="l134.24">   configure_gloda_indexing({injectFaultIn: &quot;streaming&quot;});</span>
<a href="#l134.25"></a><span id="l134.25"> </span>
<a href="#l134.26"></a><span id="l134.26" class="difflineat">@@ -60,20 +60,20 @@ function* test_streaming_failure() {</span>
<a href="#l134.27"></a><span id="l134.27">   yield wait_for_message_injection();</span>
<a href="#l134.28"></a><span id="l134.28"> </span>
<a href="#l134.29"></a><span id="l134.29">   // indexing should complete without actually indexing the message</span>
<a href="#l134.30"></a><span id="l134.30">   yield wait_for_gloda_indexer([], {recovered: 1, failedToRecover: 0,</span>
<a href="#l134.31"></a><span id="l134.31">                                     cleanedUp: 0, hadNoCleanUp: 0});</span>
<a href="#l134.32"></a><span id="l134.32"> </span>
<a href="#l134.33"></a><span id="l134.33">   // make sure the header has the expected gloda bad message state.</span>
<a href="#l134.34"></a><span id="l134.34">   let msgHdr = msgSet.getMsgHdr(0);</span>
<a href="#l134.35"></a><span id="l134.35" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-id&quot;), GLODA_BAD_MESSAGE_ID);</span>
<a href="#l134.36"></a><span id="l134.36" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-id&quot;), GLODA_BAD_MESSAGE_ID);</span>
<a href="#l134.37"></a><span id="l134.37"> </span>
<a href="#l134.38"></a><span id="l134.38">   // make sure gloda does not think the message is indexed</span>
<a href="#l134.39"></a><span id="l134.39" class="difflineminus">-  do_check_eq(Gloda.isMessageIndexed(msgHdr), false);</span>
<a href="#l134.40"></a><span id="l134.40" class="difflineplus">+  Assert.equal(Gloda.isMessageIndexed(msgHdr), false);</span>
<a href="#l134.41"></a><span id="l134.41"> </span>
<a href="#l134.42"></a><span id="l134.42">   configure_gloda_indexing({});</span>
<a href="#l134.43"></a><span id="l134.43"> }</span>
<a href="#l134.44"></a><span id="l134.44"> </span>
<a href="#l134.45"></a><span id="l134.45"> /**</span>
<a href="#l134.46"></a><span id="l134.46">  * If we have one bad message followed by a good message, the good message</span>
<a href="#l134.47"></a><span id="l134.47">  *  should still get indexed.  Additionally, if we do a sweep on the folder,</span>
<a href="#l134.48"></a><span id="l134.48">  *  we should not attempt to index the message again.</span>
<a href="#l134.49"></a><span id="l134.49" class="difflineat">@@ -111,25 +111,25 @@ function* test_reindex_on_dirty_clear_di</span>
<a href="#l134.50"></a><span id="l134.50"> </span>
<a href="#l134.51"></a><span id="l134.51">   // mark the message dirty, force the folder to be indexed</span>
<a href="#l134.52"></a><span id="l134.52">   let msgHdr = msgSet.getMsgHdr(0);</span>
<a href="#l134.53"></a><span id="l134.53">   msgHdr.setUint32Property(&quot;gloda-dirty&quot;, 1);</span>
<a href="#l134.54"></a><span id="l134.54">   GlodaMsgIndexer.indexFolder(gInbox);</span>
<a href="#l134.55"></a><span id="l134.55">   yield wait_for_gloda_indexer([], {recovered: 1, failedToRecover: 0,</span>
<a href="#l134.56"></a><span id="l134.56">                                     cleanedUp: 0, hadNoCleanUp: 0});</span>
<a href="#l134.57"></a><span id="l134.57">   // now the message should be clean</span>
<a href="#l134.58"></a><span id="l134.58" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-dirty&quot;), 0);</span>
<a href="#l134.59"></a><span id="l134.59" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-dirty&quot;), 0);</span>
<a href="#l134.60"></a><span id="l134.60"> </span>
<a href="#l134.61"></a><span id="l134.61">   // eh, check again with filtyh</span>
<a href="#l134.62"></a><span id="l134.62">   msgHdr.setUint32Property(&quot;gloda-dirty&quot;, 2);</span>
<a href="#l134.63"></a><span id="l134.63">   GlodaMsgIndexer.indexFolder(gInbox);</span>
<a href="#l134.64"></a><span id="l134.64">   yield wait_for_gloda_indexer([], {recovered: 1, failedToRecover: 0,</span>
<a href="#l134.65"></a><span id="l134.65">                                     cleanedUp: 0, hadNoCleanUp: 0});</span>
<a href="#l134.66"></a><span id="l134.66">   // now the message should be clean</span>
<a href="#l134.67"></a><span id="l134.67" class="difflineminus">-  do_check_eq(msgHdr.getUint32Property(&quot;gloda-dirty&quot;), 0);</span>
<a href="#l134.68"></a><span id="l134.68" class="difflineplus">+  Assert.equal(msgHdr.getUint32Property(&quot;gloda-dirty&quot;), 0);</span>
<a href="#l134.69"></a><span id="l134.69"> }</span>
<a href="#l134.70"></a><span id="l134.70"> </span>
<a href="#l134.71"></a><span id="l134.71"> var tests = [</span>
<a href="#l134.72"></a><span id="l134.72">   parameterizeTest(test_illegal_message, illegalMessageTemplates),</span>
<a href="#l134.73"></a><span id="l134.73">   test_streaming_failure,</span>
<a href="#l134.74"></a><span id="l134.74">   test_recovery_and_no_second_attempts,</span>
<a href="#l134.75"></a><span id="l134.75">   test_reindex_on_dirty_clear_dirty_on_fail,</span>
<a href="#l134.76"></a><span id="l134.76"> ];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l135.1"></a><span id="l135.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_compaction.js</span>
<a href="#l135.2"></a><span id="l135.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_compaction.js</span>
<a href="#l135.3"></a><span id="l135.3" class="difflineat">@@ -133,17 +133,17 @@ function* test_sweep_performs_compaction</span>
<a href="#l135.4"></a><span id="l135.4">   msgFolder.compact(asyncUrlListener, null);</span>
<a href="#l135.5"></a><span id="l135.5">   yield false;</span>
<a href="#l135.6"></a><span id="l135.6"> </span>
<a href="#l135.7"></a><span id="l135.7">   // Erase the compaction job.</span>
<a href="#l135.8"></a><span id="l135.8">   GlodaIndexer.purgeJobsUsingFilter(() =&gt; true);</span>
<a href="#l135.9"></a><span id="l135.9"> </span>
<a href="#l135.10"></a><span id="l135.10">   // Make sure the folder is marked compacted...</span>
<a href="#l135.11"></a><span id="l135.11">   let glodaFolder = Gloda.getFolderForFolder(msgFolder);</span>
<a href="#l135.12"></a><span id="l135.12" class="difflineminus">-  do_check_true(glodaFolder.compacted);</span>
<a href="#l135.13"></a><span id="l135.13" class="difflineplus">+  Assert.ok(glodaFolder.compacted);</span>
<a href="#l135.14"></a><span id="l135.14"> </span>
<a href="#l135.15"></a><span id="l135.15">   // Re-enable indexing and fire up an indexing pass</span>
<a href="#l135.16"></a><span id="l135.16">   configure_gloda_indexing({event: true});</span>
<a href="#l135.17"></a><span id="l135.17">   GlodaMsgIndexer.indexingSweepNeeded = true;</span>
<a href="#l135.18"></a><span id="l135.18">   yield wait_for_gloda_indexer();</span>
<a href="#l135.19"></a><span id="l135.19"> </span>
<a href="#l135.20"></a><span id="l135.20">   // Make sure the compaction happened</span>
<a href="#l135.21"></a><span id="l135.21">   verify_message_keys(staySet);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l136.1"></a><span id="l136.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_messages_local.js</span>
<a href="#l136.2"></a><span id="l136.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_messages_local.js</span>
<a href="#l136.3"></a><span id="l136.3" class="difflineat">@@ -44,18 +44,18 @@ function* test_fromjson_of_removed_tag()</span>
<a href="#l136.4"></a><span id="l136.4">   yield wait_for_message_injection();</span>
<a href="#l136.5"></a><span id="l136.5">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l136.6"></a><span id="l136.6">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l136.7"></a><span id="l136.7"> </span>
<a href="#l136.8"></a><span id="l136.8">   // -- tag</span>
<a href="#l136.9"></a><span id="l136.9">   let tag = TagNoun.getTag(&quot;$label4&quot;);</span>
<a href="#l136.10"></a><span id="l136.10">   msgSet.addTag(tag.key);</span>
<a href="#l136.11"></a><span id="l136.11">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l136.12"></a><span id="l136.12" class="difflineminus">-  do_check_eq(gmsg.tags.length, 1);</span>
<a href="#l136.13"></a><span id="l136.13" class="difflineminus">-  do_check_eq(gmsg.tags[0].key, tag.key);</span>
<a href="#l136.14"></a><span id="l136.14" class="difflineplus">+  Assert.equal(gmsg.tags.length, 1);</span>
<a href="#l136.15"></a><span id="l136.15" class="difflineplus">+  Assert.equal(gmsg.tags[0].key, tag.key);</span>
<a href="#l136.16"></a><span id="l136.16"> </span>
<a href="#l136.17"></a><span id="l136.17">   // -- forget about the tag, TagNoun!</span>
<a href="#l136.18"></a><span id="l136.18">   delete TagNoun._tagMap[tag.key];</span>
<a href="#l136.19"></a><span id="l136.19">   // this also means we have to replace the tag service with a liar.</span>
<a href="#l136.20"></a><span id="l136.20">   let realTagService = TagNoun._msgTagService;</span>
<a href="#l136.21"></a><span id="l136.21">   TagNoun._msgTagService = {</span>
<a href="#l136.22"></a><span id="l136.22">     isValidKey: function() {return false;} // lies!</span>
<a href="#l136.23"></a><span id="l136.23">   };</span>
<a href="#l136.24"></a><span id="l136.24" class="difflineat">@@ -71,29 +71,29 @@ function* test_fromjson_of_removed_tag()</span>
<a href="#l136.25"></a><span id="l136.25">   yield false; // queryExpect is async</span>
<a href="#l136.26"></a><span id="l136.26"> </span>
<a href="#l136.27"></a><span id="l136.27">   // -- put the tag back in TagNoun before we check and possibly explode</span>
<a href="#l136.28"></a><span id="l136.28">   TagNoun._tagMap[tag.key] = tag;</span>
<a href="#l136.29"></a><span id="l136.29">   TagNoun._msgTagService = realTagService;</span>
<a href="#l136.30"></a><span id="l136.30"> </span>
<a href="#l136.31"></a><span id="l136.31">   // -- verify the message apparently has no tags (despite no reindex)</span>
<a href="#l136.32"></a><span id="l136.32">   gmsg = coll.items[0];</span>
<a href="#l136.33"></a><span id="l136.33" class="difflineminus">-  do_check_eq(gmsg.tags.length, 0);</span>
<a href="#l136.34"></a><span id="l136.34" class="difflineplus">+  Assert.equal(gmsg.tags.length, 0);</span>
<a href="#l136.35"></a><span id="l136.35"> }</span>
<a href="#l136.36"></a><span id="l136.36"> tests.unshift(test_fromjson_of_removed_tag);</span>
<a href="#l136.37"></a><span id="l136.37"> </span>
<a href="#l136.38"></a><span id="l136.38"> /**</span>
<a href="#l136.39"></a><span id="l136.39">  * Test that we are using hasOwnProperty or a properly guarding dict for</span>
<a href="#l136.40"></a><span id="l136.40">  *  NounTag so that if someone created a tag called &quot;watch&quot; and then deleted</span>
<a href="#l136.41"></a><span id="l136.41">  *  it, we don't end up exposing the watch function as the tag.</span>
<a href="#l136.42"></a><span id="l136.42">  *</span>
<a href="#l136.43"></a><span id="l136.43">  * Strictly speaking, this does not really belong here, but it's a matched set</span>
<a href="#l136.44"></a><span id="l136.44">  *  with the previous test.</span>
<a href="#l136.45"></a><span id="l136.45">  */</span>
<a href="#l136.46"></a><span id="l136.46"> function test_nountag_does_not_think_it_has_watch_tag_when_it_does_not() {</span>
<a href="#l136.47"></a><span id="l136.47" class="difflineminus">-  do_check_eq(TagNoun.fromJSON(&quot;watch&quot;), undefined);</span>
<a href="#l136.48"></a><span id="l136.48" class="difflineplus">+  Assert.equal(TagNoun.fromJSON(&quot;watch&quot;), undefined);</span>
<a href="#l136.49"></a><span id="l136.49"> }</span>
<a href="#l136.50"></a><span id="l136.50"> tests.unshift(test_nountag_does_not_think_it_has_watch_tag_when_it_does_not);</span>
<a href="#l136.51"></a><span id="l136.51"> </span>
<a href="#l136.52"></a><span id="l136.52"> function run_test() {</span>
<a href="#l136.53"></a><span id="l136.53">   configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l136.54"></a><span id="l136.54">   glodaHelperRunTests(tests);</span>
<a href="#l136.55"></a><span id="l136.55"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l137.1"></a><span id="l137.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_sweep_folder.js</span>
<a href="#l137.2"></a><span id="l137.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_sweep_folder.js</span>
<a href="#l137.3"></a><span id="l137.3" class="difflineat">@@ -57,17 +57,17 @@ function* _spin_folder_indexer_gen(aFold</span>
<a href="#l137.4"></a><span id="l137.4">   }</span>
<a href="#l137.5"></a><span id="l137.5">   catch(ex) {</span>
<a href="#l137.6"></a><span id="l137.6">     // it's okay if this is from our exploding enumerator wrapper.</span>
<a href="#l137.7"></a><span id="l137.7">     if (ex != expectedReaper)</span>
<a href="#l137.8"></a><span id="l137.8">       do_throw(ex);</span>
<a href="#l137.9"></a><span id="l137.9">   }</span>
<a href="#l137.10"></a><span id="l137.10"> </span>
<a href="#l137.11"></a><span id="l137.11">   if (aExpectedJobGoal !== undefined)</span>
<a href="#l137.12"></a><span id="l137.12" class="difflineminus">-    do_check_eq(job.goal, aExpectedJobGoal);</span>
<a href="#l137.13"></a><span id="l137.13" class="difflineplus">+    Assert.equal(job.goal, aExpectedJobGoal);</span>
<a href="#l137.14"></a><span id="l137.14"> }</span>
<a href="#l137.15"></a><span id="l137.15"> </span>
<a href="#l137.16"></a><span id="l137.16"> /**</span>
<a href="#l137.17"></a><span id="l137.17">  * The value itself does not matter; it just needs to be present and be in a</span>
<a href="#l137.18"></a><span id="l137.18">  *  certain range for our logic testing.</span>
<a href="#l137.19"></a><span id="l137.19">  */</span>
<a href="#l137.20"></a><span id="l137.20"> var arbitraryGlodaId = 4096;</span>
<a href="#l137.21"></a><span id="l137.21"> </span>
<a href="#l137.22"></a><span id="l137.22" class="difflineat">@@ -92,27 +92,27 @@ function* test_propagate_filthy_from_fol</span>
<a href="#l137.23"></a><span id="l137.23">     &quot;SELECT COUNT(*) FROM folderLocations WHERE id = ? &quot; +</span>
<a href="#l137.24"></a><span id="l137.24">       &quot;AND dirtyStatus = ?&quot;, glodaFolder.id, glodaFolder.kFolderFilthy);</span>
<a href="#l137.25"></a><span id="l137.25"> </span>
<a href="#l137.26"></a><span id="l137.26">   // index the folder, aborting at the second get enumerator request</span>
<a href="#l137.27"></a><span id="l137.27">   explode_enumeration_after = 2;</span>
<a href="#l137.28"></a><span id="l137.28">   yield spin_folder_indexer(folder);</span>
<a href="#l137.29"></a><span id="l137.29"> </span>
<a href="#l137.30"></a><span id="l137.30">   // the folder should only be dirty</span>
<a href="#l137.31"></a><span id="l137.31" class="difflineminus">-  do_check_eq(glodaFolder.dirtyStatus, glodaFolder.kFolderDirty);</span>
<a href="#l137.32"></a><span id="l137.32" class="difflineplus">+  Assert.equal(glodaFolder.dirtyStatus, glodaFolder.kFolderDirty);</span>
<a href="#l137.33"></a><span id="l137.33">   // make sure the database sees it as dirty</span>
<a href="#l137.34"></a><span id="l137.34">   yield sqlExpectCount(1,</span>
<a href="#l137.35"></a><span id="l137.35">     &quot;SELECT COUNT(*) FROM folderLocations WHERE id = ? &quot; +</span>
<a href="#l137.36"></a><span id="l137.36">       &quot;AND dirtyStatus = ?&quot;, glodaFolder.id, glodaFolder.kFolderDirty);</span>
<a href="#l137.37"></a><span id="l137.37"> </span>
<a href="#l137.38"></a><span id="l137.38">   // The messages should be filthy per the headers (we force a commit of the</span>
<a href="#l137.39"></a><span id="l137.39">   //  database.)</span>
<a href="#l137.40"></a><span id="l137.40">   for (let msgHdr of msgSet.msgHdrs()) {</span>
<a href="#l137.41"></a><span id="l137.41" class="difflineminus">-    do_check_eq(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l137.42"></a><span id="l137.42" class="difflineminus">-                GlodaMsgIndexer.kMessageFilthy);</span>
<a href="#l137.43"></a><span id="l137.43" class="difflineplus">+    Assert.equal(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l137.44"></a><span id="l137.44" class="difflineplus">+                 GlodaMsgIndexer.kMessageFilthy);</span>
<a href="#l137.45"></a><span id="l137.45">   }</span>
<a href="#l137.46"></a><span id="l137.46"> }</span>
<a href="#l137.47"></a><span id="l137.47"> </span>
<a href="#l137.48"></a><span id="l137.48"> </span>
<a href="#l137.49"></a><span id="l137.49"> /**</span>
<a href="#l137.50"></a><span id="l137.50">  * Make sure our counting pass and our indexing passes gets it right.  We test</span>
<a href="#l137.51"></a><span id="l137.51">  *  with 0,1,2 messages matching.</span>
<a href="#l137.52"></a><span id="l137.52">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l138.1"></a><span id="l138.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_intl.js</span>
<a href="#l138.2"></a><span id="l138.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_intl.js</span>
<a href="#l138.3"></a><span id="l138.3" class="difflineat">@@ -226,23 +226,23 @@ function* test_index(aPhrase) {</span>
<a href="#l138.4"></a><span id="l138.4">  */</span>
<a href="#l138.5"></a><span id="l138.5"> function verify_index(smsg, gmsg) {</span>
<a href="#l138.6"></a><span id="l138.6">   let [charset, actual] = smsg.callerData;</span>
<a href="#l138.7"></a><span id="l138.7">   let subject = gmsg.subject;</span>
<a href="#l138.8"></a><span id="l138.8">   let indexedBodyText = gmsg.indexedBodyText.trim();</span>
<a href="#l138.9"></a><span id="l138.9">   let attachmentName = gmsg.attachmentNames[0];</span>
<a href="#l138.10"></a><span id="l138.10">   LOG.debug(&quot;using character set: &quot; + charset + &quot; actual: &quot; + actual);</span>
<a href="#l138.11"></a><span id="l138.11">   LOG.debug(&quot;subject: &quot; + subject + &quot; (len: &quot; + subject.length + &quot;)&quot;);</span>
<a href="#l138.12"></a><span id="l138.12" class="difflineminus">-  do_check_eq(actual, subject);</span>
<a href="#l138.13"></a><span id="l138.13" class="difflineplus">+  Assert.equal(actual, subject);</span>
<a href="#l138.14"></a><span id="l138.14">   LOG.debug(&quot;body: &quot; + indexedBodyText +</span>
<a href="#l138.15"></a><span id="l138.15">       &quot; (len: &quot; + indexedBodyText.length + &quot;)&quot;);</span>
<a href="#l138.16"></a><span id="l138.16" class="difflineminus">-  do_check_eq(actual, indexedBodyText);</span>
<a href="#l138.17"></a><span id="l138.17" class="difflineplus">+  Assert.equal(actual, indexedBodyText);</span>
<a href="#l138.18"></a><span id="l138.18">   LOG.debug(&quot;attachment name:&quot; + attachmentName +</span>
<a href="#l138.19"></a><span id="l138.19">       &quot; (len: &quot; + attachmentName.length + &quot;)&quot;);</span>
<a href="#l138.20"></a><span id="l138.20" class="difflineminus">-  do_check_eq(actual, attachmentName);</span>
<a href="#l138.21"></a><span id="l138.21" class="difflineplus">+  Assert.equal(actual, attachmentName);</span>
<a href="#l138.22"></a><span id="l138.22"> }</span>
<a href="#l138.23"></a><span id="l138.23"> </span>
<a href="#l138.24"></a><span id="l138.24"> /**</span>
<a href="#l138.25"></a><span id="l138.25">  * For each phrase, make sure that all of the searchPhrases either match or fail</span>
<a href="#l138.26"></a><span id="l138.26">  *  to match as appropriate.</span>
<a href="#l138.27"></a><span id="l138.27">  */</span>
<a href="#l138.28"></a><span id="l138.28"> function* test_fulltextsearch(aPhrase)</span>
<a href="#l138.29"></a><span id="l138.29"> {</span>
<a href="#l138.30"></a><span id="l138.30" class="difflineat">@@ -270,21 +270,21 @@ function* test_encoding_complications_wi</span>
<a href="#l138.31"></a><span id="l138.31">   // Use the thing with the comma in it for all cases; previously there was an</span>
<a href="#l138.32"></a><span id="l138.32">   //  asymmetry between to and cc...</span>
<a href="#l138.33"></a><span id="l138.33">   let smsg = gMessageGenerator.makeMessage({</span>
<a href="#l138.34"></a><span id="l138.34">     from: encodedCommaPair,</span>
<a href="#l138.35"></a><span id="l138.35">     to: [encodedCommaPair],</span>
<a href="#l138.36"></a><span id="l138.36">     cc: [encodedCommaPair],</span>
<a href="#l138.37"></a><span id="l138.37">   });</span>
<a href="#l138.38"></a><span id="l138.38">   function verify_sammy_snake(smsg, gmsg) {</span>
<a href="#l138.39"></a><span id="l138.39" class="difflineminus">-    do_check_eq(gmsg.from.contact.name, decodedName);</span>
<a href="#l138.40"></a><span id="l138.40" class="difflineminus">-    do_check_eq(gmsg.to.length, 1);</span>
<a href="#l138.41"></a><span id="l138.41" class="difflineminus">-    do_check_eq(gmsg.to[0].id, gmsg.from.id);</span>
<a href="#l138.42"></a><span id="l138.42" class="difflineminus">-    do_check_eq(gmsg.cc.length, 1);</span>
<a href="#l138.43"></a><span id="l138.43" class="difflineminus">-    do_check_eq(gmsg.cc[0].id, gmsg.from.id);</span>
<a href="#l138.44"></a><span id="l138.44" class="difflineplus">+    Assert.equal(gmsg.from.contact.name, decodedName);</span>
<a href="#l138.45"></a><span id="l138.45" class="difflineplus">+    Assert.equal(gmsg.to.length, 1);</span>
<a href="#l138.46"></a><span id="l138.46" class="difflineplus">+    Assert.equal(gmsg.to[0].id, gmsg.from.id);</span>
<a href="#l138.47"></a><span id="l138.47" class="difflineplus">+    Assert.equal(gmsg.cc.length, 1);</span>
<a href="#l138.48"></a><span id="l138.48" class="difflineplus">+    Assert.equal(gmsg.cc[0].id, gmsg.from.id);</span>
<a href="#l138.49"></a><span id="l138.49">   }</span>
<a href="#l138.50"></a><span id="l138.50"> </span>
<a href="#l138.51"></a><span id="l138.51">   let synSet = new SyntheticMessageSet([smsg]);</span>
<a href="#l138.52"></a><span id="l138.52">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l138.53"></a><span id="l138.53">   yield wait_for_gloda_indexer(synSet, {verifier: verify_sammy_snake});</span>
<a href="#l138.54"></a><span id="l138.54"> }</span>
<a href="#l138.55"></a><span id="l138.55"> </span>
<a href="#l138.56"></a><span id="l138.56"> /* ===== Driver ===== */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l139.1"></a><span id="l139.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_migration.js</span>
<a href="#l139.2"></a><span id="l139.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_migration.js</span>
<a href="#l139.3"></a><span id="l139.3" class="difflineat">@@ -67,47 +67,47 @@ function* test_fix_missing_contacts_and_</span>
<a href="#l139.4"></a><span id="l139.4">   //    id marker so that our scan will see them.</span>
<a href="#l139.5"></a><span id="l139.5">   for (let msgHdr of yesMsgSet.msgHdrs()) {</span>
<a href="#l139.6"></a><span id="l139.6">     msgHdr.setUint32Property(&quot;gloda-id&quot;, GLODA_OLD_BAD_MESSAGE_ID);</span>
<a href="#l139.7"></a><span id="l139.7">   }</span>
<a href="#l139.8"></a><span id="l139.8"> </span>
<a href="#l139.9"></a><span id="l139.9">   // - mark the db schema version to the version with the bug (26)</span>
<a href="#l139.10"></a><span id="l139.10">   // sanity check that gloda actually populates the value with the current</span>
<a href="#l139.11"></a><span id="l139.11">   //  version correctly...</span>
<a href="#l139.12"></a><span id="l139.12" class="difflineminus">-  do_check_eq(GlodaDatastore._actualSchemaVersion,</span>
<a href="#l139.13"></a><span id="l139.13" class="difflineminus">-              GlodaDatastore._schemaVersion);</span>
<a href="#l139.14"></a><span id="l139.14" class="difflineplus">+  Assert.equal(GlodaDatastore._actualSchemaVersion,</span>
<a href="#l139.15"></a><span id="l139.15" class="difflineplus">+               GlodaDatastore._schemaVersion);</span>
<a href="#l139.16"></a><span id="l139.16">   GlodaDatastore._actualSchemaVersion = 26;</span>
<a href="#l139.17"></a><span id="l139.17">   yield sqlRun(&quot;PRAGMA user_version = 26&quot;);</span>
<a href="#l139.18"></a><span id="l139.18">   // make sure that took, since we check it below as a success indicator.</span>
<a href="#l139.19"></a><span id="l139.19">   let verRows = yield sqlRun(&quot;PRAGMA user_version&quot;);</span>
<a href="#l139.20"></a><span id="l139.20" class="difflineminus">-  do_check_eq(verRows[0].getInt64(0), 26);</span>
<a href="#l139.21"></a><span id="l139.21" class="difflineplus">+  Assert.equal(verRows[0].getInt64(0), 26);</span>
<a href="#l139.22"></a><span id="l139.22"> </span>
<a href="#l139.23"></a><span id="l139.23"> </span>
<a href="#l139.24"></a><span id="l139.24">   // -- test</span>
<a href="#l139.25"></a><span id="l139.25">   // - trigger the migration logic and request an indexing sweep</span>
<a href="#l139.26"></a><span id="l139.26">   GlodaMsgIndexer.disable();</span>
<a href="#l139.27"></a><span id="l139.27">   GlodaMsgIndexer.enable();</span>
<a href="#l139.28"></a><span id="l139.28">   GlodaMsgIndexer.initialSweep();</span>
<a href="#l139.29"></a><span id="l139.29"> </span>
<a href="#l139.30"></a><span id="l139.30">   // - wait for the indexer to complete, expecting that the messages that we</span>
<a href="#l139.31"></a><span id="l139.31">   //    marked bad will get indexed but not the good messages.</span>
<a href="#l139.32"></a><span id="l139.32">   yield wait_for_gloda_indexer(yesMsgSet, { augment: true });</span>
<a href="#l139.33"></a><span id="l139.33"> </span>
<a href="#l139.34"></a><span id="l139.34">   // - verify that the identities have contacts again</span>
<a href="#l139.35"></a><span id="l139.35">   // must have the contact object</span>
<a href="#l139.36"></a><span id="l139.36" class="difflineminus">-  do_check_neq(yesMsgSet.glodaMessages[0].from.contact, undefined);</span>
<a href="#l139.37"></a><span id="l139.37" class="difflineplus">+  Assert.notEqual(yesMsgSet.glodaMessages[0].from.contact, undefined);</span>
<a href="#l139.38"></a><span id="l139.38">   // the contact's name should come from the address book card</span>
<a href="#l139.39"></a><span id="l139.39" class="difflineminus">-  do_check_eq(yesMsgSet.glodaMessages[0].from.contact.name, abPeeps[0][0]);</span>
<a href="#l139.40"></a><span id="l139.40" class="difflineplus">+  Assert.equal(yesMsgSet.glodaMessages[0].from.contact.name, abPeeps[0][0]);</span>
<a href="#l139.41"></a><span id="l139.41"> </span>
<a href="#l139.42"></a><span id="l139.42">   // - verify that the schema version changed from gloda's perspective and from</span>
<a href="#l139.43"></a><span id="l139.43">   //    the db's perspective</span>
<a href="#l139.44"></a><span id="l139.44">   verRows = yield sqlRun(&quot;PRAGMA user_version&quot;);</span>
<a href="#l139.45"></a><span id="l139.45" class="difflineminus">-  do_check_eq(verRows[0].getInt64(0), GlodaDatastore._schemaVersion);</span>
<a href="#l139.46"></a><span id="l139.46" class="difflineminus">-  do_check_eq(GlodaDatastore._actualSchemaVersion,</span>
<a href="#l139.47"></a><span id="l139.47" class="difflineminus">-              GlodaDatastore._schemaVersion);</span>
<a href="#l139.48"></a><span id="l139.48" class="difflineplus">+  Assert.equal(verRows[0].getInt64(0), GlodaDatastore._schemaVersion);</span>
<a href="#l139.49"></a><span id="l139.49" class="difflineplus">+  Assert.equal(GlodaDatastore._actualSchemaVersion,</span>
<a href="#l139.50"></a><span id="l139.50" class="difflineplus">+               GlodaDatastore._schemaVersion);</span>
<a href="#l139.51"></a><span id="l139.51"> }</span>
<a href="#l139.52"></a><span id="l139.52"> </span>
<a href="#l139.53"></a><span id="l139.53"> var tests = [</span>
<a href="#l139.54"></a><span id="l139.54">   test_fix_missing_contacts_and_fallout,</span>
<a href="#l139.55"></a><span id="l139.55"> ];</span>
<a href="#l139.56"></a><span id="l139.56"> </span>
<a href="#l139.57"></a><span id="l139.57"> function run_test() {</span>
<a href="#l139.58"></a><span id="l139.58">   configure_message_injection({mode: &quot;local&quot;});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l140.1"></a><span id="l140.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_mime_attachments_size.js</span>
<a href="#l140.2"></a><span id="l140.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_mime_attachments_size.js</span>
<a href="#l140.3"></a><span id="l140.3" class="difflineat">@@ -199,30 +199,30 @@ function check_attachments(aMimeMsg, eps</span>
<a href="#l140.4"></a><span id="l140.4">    * the bytes for the extra line. Since newlines in emails are \n, most of the</span>
<a href="#l140.5"></a><span id="l140.5">    * time we get att.size = 174 instead of 173.</span>
<a href="#l140.6"></a><span id="l140.6">    *</span>
<a href="#l140.7"></a><span id="l140.7">    * The good news is, it's just a fixed extra cost. There no issues with the</span>
<a href="#l140.8"></a><span id="l140.8">    * inner contents of the attachment, you can add as many newlines as you want</span>
<a href="#l140.9"></a><span id="l140.9">    * in it, Unix or Windows, the count won't get past the bounds.</span>
<a href="#l140.10"></a><span id="l140.10">    */</span>
<a href="#l140.11"></a><span id="l140.11"> </span>
<a href="#l140.12"></a><span id="l140.12" class="difflineminus">-  do_check_true(aMimeMsg.allUserAttachments.length &gt; 0);</span>
<a href="#l140.13"></a><span id="l140.13" class="difflineplus">+  Assert.ok(aMimeMsg.allUserAttachments.length &gt; 0);</span>
<a href="#l140.14"></a><span id="l140.14"> </span>
<a href="#l140.15"></a><span id="l140.15">   let totalSize = htmlText.length;</span>
<a href="#l140.16"></a><span id="l140.16"> </span>
<a href="#l140.17"></a><span id="l140.17">   for (let att of aMimeMsg.allUserAttachments) {</span>
<a href="#l140.18"></a><span id="l140.18">     dump(&quot;*** Attachment now is &quot; + att.name + &quot; &quot; + att.size + &quot;\n&quot;);</span>
<a href="#l140.19"></a><span id="l140.19" class="difflineminus">-    do_check_true(Math.abs(att.size - originalTextByteCount) &lt;= epsilon);</span>
<a href="#l140.20"></a><span id="l140.20" class="difflineplus">+    Assert.ok(Math.abs(att.size - originalTextByteCount) &lt;= epsilon);</span>
<a href="#l140.21"></a><span id="l140.21">     totalSize += att.size;</span>
<a href="#l140.22"></a><span id="l140.22">   }</span>
<a href="#l140.23"></a><span id="l140.23"> </span>
<a href="#l140.24"></a><span id="l140.24">   // undefined means true</span>
<a href="#l140.25"></a><span id="l140.25">   if (checkTotalSize !== false) {</span>
<a href="#l140.26"></a><span id="l140.26">     dump(&quot;*** Total size comparison: &quot; + totalSize + &quot; vs &quot; + aMimeMsg.size + &quot;\n&quot;);</span>
<a href="#l140.27"></a><span id="l140.27" class="difflineminus">-    do_check_true(Math.abs(aMimeMsg.size - totalSize) &lt;= epsilon);</span>
<a href="#l140.28"></a><span id="l140.28" class="difflineplus">+    Assert.ok(Math.abs(aMimeMsg.size - totalSize) &lt;= epsilon);</span>
<a href="#l140.29"></a><span id="l140.29">   }</span>
<a href="#l140.30"></a><span id="l140.30"> </span>
<a href="#l140.31"></a><span id="l140.31">   async_driver();</span>
<a href="#l140.32"></a><span id="l140.32"> }</span>
<a href="#l140.33"></a><span id="l140.33"> </span>
<a href="#l140.34"></a><span id="l140.34"> function* test_message_attachments(info) {</span>
<a href="#l140.35"></a><span id="l140.35">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l140.36"></a><span id="l140.36">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l140.37"></a><span id="l140.37" class="difflineat">@@ -277,17 +277,17 @@ var bogusMessageInfos = [</span>
<a href="#l140.38"></a><span id="l140.38"> ];</span>
<a href="#l140.39"></a><span id="l140.39"> </span>
<a href="#l140.40"></a><span id="l140.40"> function check_bogus_parts(aMimeMsg, { epsilon, checkSize }) {</span>
<a href="#l140.41"></a><span id="l140.41">   if (aMimeMsg == null)</span>
<a href="#l140.42"></a><span id="l140.42">     do_throw(&quot;We really should have gotten a result!&quot;);</span>
<a href="#l140.43"></a><span id="l140.43"> </span>
<a href="#l140.44"></a><span id="l140.44">   // First make sure the size is computed properly</span>
<a href="#l140.45"></a><span id="l140.45">   let x = parseInt(aMimeMsg.size);</span>
<a href="#l140.46"></a><span id="l140.46" class="difflineminus">-  do_check_false(isNaN(x));</span>
<a href="#l140.47"></a><span id="l140.47" class="difflineplus">+  Assert.ok(!isNaN(x));</span>
<a href="#l140.48"></a><span id="l140.48"> </span>
<a href="#l140.49"></a><span id="l140.49">   let sep = (&quot;@mozilla.org/windows-registry-key;1&quot; in Cc) ? &quot;\r\n&quot; : &quot;\n&quot;;</span>
<a href="#l140.50"></a><span id="l140.50"> </span>
<a href="#l140.51"></a><span id="l140.51">   // dump(aMimeMsg.prettyString()+&quot;\n&quot;);</span>
<a href="#l140.52"></a><span id="l140.52"> </span>
<a href="#l140.53"></a><span id="l140.53">   if (checkSize) {</span>
<a href="#l140.54"></a><span id="l140.54">     let partSize = 0;</span>
<a href="#l140.55"></a><span id="l140.55">     // The attachment, although a MimeUnknown part, is actually plain/text that</span>
<a href="#l140.56"></a><span id="l140.56" class="difflineat">@@ -298,17 +298,17 @@ function check_bogus_parts(aMimeMsg, { e</span>
<a href="#l140.57"></a><span id="l140.57">     }</span>
<a href="#l140.58"></a><span id="l140.58">     // That's the newline between the headers and the message body.</span>
<a href="#l140.59"></a><span id="l140.59">     partSize += sep.length;</span>
<a href="#l140.60"></a><span id="l140.60">     // That's the message body.</span>
<a href="#l140.61"></a><span id="l140.61">     partSize += originalTextByteCount;</span>
<a href="#l140.62"></a><span id="l140.62">     // That's the total length that's to be returned by the MimeMessage abstraction.</span>
<a href="#l140.63"></a><span id="l140.63">     let totalSize = htmlText.length + partSize;</span>
<a href="#l140.64"></a><span id="l140.64">     dump(totalSize+&quot; vs &quot;+aMimeMsg.size+&quot;\n&quot;);</span>
<a href="#l140.65"></a><span id="l140.65" class="difflineminus">-    do_check_true(Math.abs(aMimeMsg.size - totalSize) &lt;= epsilon);</span>
<a href="#l140.66"></a><span id="l140.66" class="difflineplus">+    Assert.ok(Math.abs(aMimeMsg.size - totalSize) &lt;= epsilon);</span>
<a href="#l140.67"></a><span id="l140.67">   }</span>
<a href="#l140.68"></a><span id="l140.68"> </span>
<a href="#l140.69"></a><span id="l140.69">   async_driver();</span>
<a href="#l140.70"></a><span id="l140.70"> }</span>
<a href="#l140.71"></a><span id="l140.71"> </span>
<a href="#l140.72"></a><span id="l140.72"> function* test_bogus_messages(info) {</span>
<a href="#l140.73"></a><span id="l140.73">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l140.74"></a><span id="l140.74">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l140.75"></a><span id="l140.75" class="difflineat">@@ -342,17 +342,17 @@ function* test_have_attachments(info) {</span>
<a href="#l140.76"></a><span id="l140.76">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l140.77"></a><span id="l140.77">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l140.78"></a><span id="l140.78"> </span>
<a href="#l140.79"></a><span id="l140.79">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l140.80"></a><span id="l140.80">   // dump(synMsg.toMboxString());</span>
<a href="#l140.81"></a><span id="l140.81"> </span>
<a href="#l140.82"></a><span id="l140.82">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l140.83"></a><span id="l140.83">     try {</span>
<a href="#l140.84"></a><span id="l140.84" class="difflineminus">-      do_check_eq(aMimeMsg.allUserAttachments.length, info.number);</span>
<a href="#l140.85"></a><span id="l140.85" class="difflineplus">+      Assert.equal(aMimeMsg.allUserAttachments.length, info.number);</span>
<a href="#l140.86"></a><span id="l140.86">       async_driver();</span>
<a href="#l140.87"></a><span id="l140.87">     } catch (e) {</span>
<a href="#l140.88"></a><span id="l140.88">       do_throw(e);</span>
<a href="#l140.89"></a><span id="l140.89">     }</span>
<a href="#l140.90"></a><span id="l140.90">   });</span>
<a href="#l140.91"></a><span id="l140.91"> </span>
<a href="#l140.92"></a><span id="l140.92">   yield false;</span>
<a href="#l140.93"></a><span id="l140.93"> }</span>
<a href="#l140.94"></a><span id="l140.94" class="difflineat">@@ -367,14 +367,14 @@ var tests = [</span>
<a href="#l140.95"></a><span id="l140.95"> </span>
<a href="#l140.96"></a><span id="l140.96"> var gInbox;</span>
<a href="#l140.97"></a><span id="l140.97"> </span>
<a href="#l140.98"></a><span id="l140.98"> function run_test() {</span>
<a href="#l140.99"></a><span id="l140.99">   // Sanity check: figure out how many bytes the original text occupies in UTF-8 encoding</span>
<a href="#l140.100"></a><span id="l140.100">   let converter = Cc[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]</span>
<a href="#l140.101"></a><span id="l140.101">                     .createInstance(Ci.nsIScriptableUnicodeConverter);</span>
<a href="#l140.102"></a><span id="l140.102">   converter.charset = &quot;UTF-8&quot;;</span>
<a href="#l140.103"></a><span id="l140.103" class="difflineminus">-  do_check_eq(converter.ConvertFromUnicode(originalText).length, originalTextByteCount);</span>
<a href="#l140.104"></a><span id="l140.104" class="difflineplus">+  Assert.equal(converter.ConvertFromUnicode(originalText).length, originalTextByteCount);</span>
<a href="#l140.105"></a><span id="l140.105"> </span>
<a href="#l140.106"></a><span id="l140.106">   // use mbox injection because the fake server chokes sometimes right now</span>
<a href="#l140.107"></a><span id="l140.107">   gInbox = configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l140.108"></a><span id="l140.108">   async_run_tests(tests);</span>
<a href="#l140.109"></a><span id="l140.109"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l141.1"></a><span id="l141.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_mime_emitter.js</span>
<a href="#l141.2"></a><span id="l141.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_mime_emitter.js</span>
<a href="#l141.3"></a><span id="l141.3" class="difflineat">@@ -320,32 +320,32 @@ function synTransformBody(aSynBodyPart) </span>
<a href="#l141.4"></a><span id="l141.4">     text = text.replace(/bold/g, &quot;B&quot;)</span>
<a href="#l141.5"></a><span id="l141.5">                .replace(/italic/g, &quot;I&quot;) + &quot;\n&lt;BR&gt;&quot;;</span>
<a href="#l141.6"></a><span id="l141.6">   }</span>
<a href="#l141.7"></a><span id="l141.7">   return text;</span>
<a href="#l141.8"></a><span id="l141.8"> }</span>
<a href="#l141.9"></a><span id="l141.9"> </span>
<a href="#l141.10"></a><span id="l141.10"> function verify_body_part_equivalence(aSynBodyPart, aMimePart) {</span>
<a href="#l141.11"></a><span id="l141.11">   // the content-type devoid of parameters should match</span>
<a href="#l141.12"></a><span id="l141.12" class="difflineminus">-  do_check_eq(aSynBodyPart._contentType, aMimePart.contentType);</span>
<a href="#l141.13"></a><span id="l141.13" class="difflineplus">+  Assert.equal(aSynBodyPart._contentType, aMimePart.contentType);</span>
<a href="#l141.14"></a><span id="l141.14"> </span>
<a href="#l141.15"></a><span id="l141.15">   // the header representation of the content-type should also match unless</span>
<a href="#l141.16"></a><span id="l141.16">   //  this is an rfc822 part, in which case it should only match for the</span>
<a href="#l141.17"></a><span id="l141.17">   //  actual contents.</span>
<a href="#l141.18"></a><span id="l141.18">   if (aMimePart.contentType != &quot;message/rfc822&quot;)</span>
<a href="#l141.19"></a><span id="l141.19" class="difflineminus">-    do_check_eq(aSynBodyPart.contentTypeHeaderValue.replace(</span>
<a href="#l141.20"></a><span id="l141.20" class="difflineminus">-                  deathToNewlineTypeThings, &quot;&quot;),</span>
<a href="#l141.21"></a><span id="l141.21" class="difflineminus">-                aMimePart.get(&quot;content-type&quot;).replace(</span>
<a href="#l141.22"></a><span id="l141.22" class="difflineminus">-                  deathToNewlineTypeThings, &quot;&quot;));</span>
<a href="#l141.23"></a><span id="l141.23" class="difflineplus">+    Assert.equal(aSynBodyPart.contentTypeHeaderValue.replace(</span>
<a href="#l141.24"></a><span id="l141.24" class="difflineplus">+                   deathToNewlineTypeThings, &quot;&quot;),</span>
<a href="#l141.25"></a><span id="l141.25" class="difflineplus">+                 aMimePart.get(&quot;content-type&quot;).replace(</span>
<a href="#l141.26"></a><span id="l141.26" class="difflineplus">+                   deathToNewlineTypeThings, &quot;&quot;));</span>
<a href="#l141.27"></a><span id="l141.27"> </span>
<a href="#l141.28"></a><span id="l141.28">   // XXX body part checking will get brittle if we ever actually encode things!</span>
<a href="#l141.29"></a><span id="l141.29">   if (aSynBodyPart.body &amp;&amp; !aSynBodyPart._filename &amp;&amp;</span>
<a href="#l141.30"></a><span id="l141.30">       aSynBodyPart._contentType.startsWith(&quot;text/&quot;))</span>
<a href="#l141.31"></a><span id="l141.31" class="difflineminus">-    do_check_eq(synTransformBody(aSynBodyPart),</span>
<a href="#l141.32"></a><span id="l141.32" class="difflineminus">-                aMimePart.body.trim().replace(/\r/g, &quot;&quot;));</span>
<a href="#l141.33"></a><span id="l141.33" class="difflineplus">+    Assert.equal(synTransformBody(aSynBodyPart),</span>
<a href="#l141.34"></a><span id="l141.34" class="difflineplus">+                 aMimePart.body.trim().replace(/\r/g, &quot;&quot;));</span>
<a href="#l141.35"></a><span id="l141.35">   if (aSynBodyPart.parts) {</span>
<a href="#l141.36"></a><span id="l141.36">     let iPart;</span>
<a href="#l141.37"></a><span id="l141.37">     let realPartOffsetCompensator = 0;</span>
<a href="#l141.38"></a><span id="l141.38">     for (iPart = 0; iPart &lt; aSynBodyPart.parts.length; iPart++) {</span>
<a href="#l141.39"></a><span id="l141.39">       let subSyn = aSynBodyPart.parts[iPart];</span>
<a href="#l141.40"></a><span id="l141.40">       // If this is a degenerate empty, it should not produce output, so</span>
<a href="#l141.41"></a><span id="l141.41">       //  compensate for the offset drift and get on with our lives.</span>
<a href="#l141.42"></a><span id="l141.42">       if (subSyn instanceof SyntheticDegeneratePartEmpty) {</span>
<a href="#l141.43"></a><span id="l141.43" class="difflineat">@@ -405,17 +405,17 @@ function* test_sane_bodies() {</span>
<a href="#l141.44"></a><span id="l141.44">   // 60 bytes long... (becomes 59 on the other side when \r is dropped)</span>
<a href="#l141.45"></a><span id="l141.45">   let hugeString =</span>
<a href="#l141.46"></a><span id="l141.46">     &quot;don't know what you want but I can't  stream it anymore...\r\n&quot;;</span>
<a href="#l141.47"></a><span id="l141.47">   const powahsOfTwo = 10;</span>
<a href="#l141.48"></a><span id="l141.48">   for (let i = 0; i &lt; powahsOfTwo; i++) {</span>
<a href="#l141.49"></a><span id="l141.49">     hugeString = hugeString + hugeString;</span>
<a href="#l141.50"></a><span id="l141.50">   }</span>
<a href="#l141.51"></a><span id="l141.51">   // this will come out to be 60k, of course.</span>
<a href="#l141.52"></a><span id="l141.52" class="difflineminus">-  do_check_eq(hugeString.length, 60 * Math.pow(2, powahsOfTwo));</span>
<a href="#l141.53"></a><span id="l141.53" class="difflineplus">+  Assert.equal(hugeString.length, 60 * Math.pow(2, powahsOfTwo));</span>
<a href="#l141.54"></a><span id="l141.54"> </span>
<a href="#l141.55"></a><span id="l141.55">   let synMsg = gMessageGenerator.makeMessage(</span>
<a href="#l141.56"></a><span id="l141.56">     {body: {body: hugeString, contentType: &quot;text/plain&quot;}});</span>
<a href="#l141.57"></a><span id="l141.57">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l141.58"></a><span id="l141.58">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l141.59"></a><span id="l141.59"> </span>
<a href="#l141.60"></a><span id="l141.60">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l141.61"></a><span id="l141.61"> </span>
<a href="#l141.62"></a><span id="l141.62" class="difflineat">@@ -512,37 +512,37 @@ function* test_attachments_correctness (</span>
<a href="#l141.63"></a><span id="l141.63">     let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l141.64"></a><span id="l141.64">     // dump(synMsg.toMboxString()+&quot;\n\n&quot;);</span>
<a href="#l141.65"></a><span id="l141.65"> </span>
<a href="#l141.66"></a><span id="l141.66">     MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l141.67"></a><span id="l141.67">       try {</span>
<a href="#l141.68"></a><span id="l141.68">         let expected = expectedAttachmentsInfo[i];</span>
<a href="#l141.69"></a><span id="l141.69">         if (&quot;firstAttachmentName&quot; in expected) {</span>
<a href="#l141.70"></a><span id="l141.70">           let att = aMimeMsg.allUserAttachments[0];</span>
<a href="#l141.71"></a><span id="l141.71" class="difflineminus">-          do_check_eq(att.name.length, expected.firstAttachmentName.length);</span>
<a href="#l141.72"></a><span id="l141.72" class="difflineplus">+          Assert.equal(att.name.length, expected.firstAttachmentName.length);</span>
<a href="#l141.73"></a><span id="l141.73">           for (let i = 0; i &lt; att.name.length; ++i)</span>
<a href="#l141.74"></a><span id="l141.74" class="difflineminus">-            do_check_eq(att.name.charCodeAt(i), expected.firstAttachmentName.charCodeAt(i));</span>
<a href="#l141.75"></a><span id="l141.75" class="difflineplus">+            Assert.equal(att.name.charCodeAt(i), expected.firstAttachmentName.charCodeAt(i));</span>
<a href="#l141.76"></a><span id="l141.76">         }</span>
<a href="#l141.77"></a><span id="l141.77"> </span>
<a href="#l141.78"></a><span id="l141.78" class="difflineminus">-        do_check_eq(aMimeMsg.allAttachments.length, expected.allAttachmentsContentTypes.length);</span>
<a href="#l141.79"></a><span id="l141.79" class="difflineplus">+        Assert.equal(aMimeMsg.allAttachments.length, expected.allAttachmentsContentTypes.length);</span>
<a href="#l141.80"></a><span id="l141.80">         for (let [j, att] of aMimeMsg.allAttachments.entries())</span>
<a href="#l141.81"></a><span id="l141.81" class="difflineminus">-          do_check_eq(att.contentType, expected.allAttachmentsContentTypes[j]);</span>
<a href="#l141.82"></a><span id="l141.82" class="difflineplus">+          Assert.equal(att.contentType, expected.allAttachmentsContentTypes[j]);</span>
<a href="#l141.83"></a><span id="l141.83"> </span>
<a href="#l141.84"></a><span id="l141.84" class="difflineminus">-        do_check_eq(aMimeMsg.allUserAttachments.length, expected.allUserAttachmentsContentTypes.length);</span>
<a href="#l141.85"></a><span id="l141.85" class="difflineplus">+        Assert.equal(aMimeMsg.allUserAttachments.length, expected.allUserAttachmentsContentTypes.length);</span>
<a href="#l141.86"></a><span id="l141.86">         for (let [j, att] of aMimeMsg.allUserAttachments.entries())</span>
<a href="#l141.87"></a><span id="l141.87" class="difflineminus">-          do_check_eq(att.contentType, expected.allUserAttachmentsContentTypes[j]);</span>
<a href="#l141.88"></a><span id="l141.88" class="difflineplus">+          Assert.equal(att.contentType, expected.allUserAttachmentsContentTypes[j]);</span>
<a href="#l141.89"></a><span id="l141.89"> </span>
<a href="#l141.90"></a><span id="l141.90">         // Test</span>
<a href="#l141.91"></a><span id="l141.91">         for (let att of aMimeMsg.allUserAttachments) {</span>
<a href="#l141.92"></a><span id="l141.92">           let uri = aMsgHdr.folder.getUriForMsg(aMsgHdr);</span>
<a href="#l141.93"></a><span id="l141.93">           let glodaAttachment =</span>
<a href="#l141.94"></a><span id="l141.94">             GlodaFundAttr.glodaAttFromMimeAtt({ folderMessageURI: uri }, att);</span>
<a href="#l141.95"></a><span id="l141.95">           // The GlodaAttachment appends the filename, which is not always</span>
<a href="#l141.96"></a><span id="l141.96">           // present</span>
<a href="#l141.97"></a><span id="l141.97" class="difflineminus">-          do_check_true(glodaAttachment.url.startsWith(att.url));</span>
<a href="#l141.98"></a><span id="l141.98" class="difflineplus">+          Assert.ok(glodaAttachment.url.startsWith(att.url));</span>
<a href="#l141.99"></a><span id="l141.99">         }</span>
<a href="#l141.100"></a><span id="l141.100"> </span>
<a href="#l141.101"></a><span id="l141.101">       } catch (e) {</span>
<a href="#l141.102"></a><span id="l141.102">         dump(aMimeMsg.prettyString()+&quot;\n&quot;);</span>
<a href="#l141.103"></a><span id="l141.103">         do_throw(e);</span>
<a href="#l141.104"></a><span id="l141.104">       }</span>
<a href="#l141.105"></a><span id="l141.105"> </span>
<a href="#l141.106"></a><span id="l141.106">       async_driver();</span>
<a href="#l141.107"></a><span id="l141.107" class="difflineat">@@ -574,18 +574,18 @@ function* test_part12_not_an_attachment(</span>
<a href="#l141.108"></a><span id="l141.108">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l141.109"></a><span id="l141.109">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l141.110"></a><span id="l141.110"> </span>
<a href="#l141.111"></a><span id="l141.111">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l141.112"></a><span id="l141.112">   // dump(synMsg.toMboxString());</span>
<a href="#l141.113"></a><span id="l141.113"> </span>
<a href="#l141.114"></a><span id="l141.114">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l141.115"></a><span id="l141.115">     try {</span>
<a href="#l141.116"></a><span id="l141.116" class="difflineminus">-      do_check_true(aMimeMsg.allUserAttachments.length == 0);</span>
<a href="#l141.117"></a><span id="l141.117" class="difflineminus">-      do_check_true(aMimeMsg.allAttachments.length == 0);</span>
<a href="#l141.118"></a><span id="l141.118" class="difflineplus">+      Assert.ok(aMimeMsg.allUserAttachments.length == 0);</span>
<a href="#l141.119"></a><span id="l141.119" class="difflineplus">+      Assert.ok(aMimeMsg.allAttachments.length == 0);</span>
<a href="#l141.120"></a><span id="l141.120">     } catch (e) {</span>
<a href="#l141.121"></a><span id="l141.121">       do_throw(e);</span>
<a href="#l141.122"></a><span id="l141.122">     }</span>
<a href="#l141.123"></a><span id="l141.123">     async_driver();</span>
<a href="#l141.124"></a><span id="l141.124">   });</span>
<a href="#l141.125"></a><span id="l141.125"> </span>
<a href="#l141.126"></a><span id="l141.126">   yield false;</span>
<a href="#l141.127"></a><span id="l141.127"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l142.1"></a><span id="l142.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_noun_mimetype.js</span>
<a href="#l142.2"></a><span id="l142.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_noun_mimetype.js</span>
<a href="#l142.3"></a><span id="l142.3" class="difflineat">@@ -64,43 +64,43 @@ function test_basics() {</span>
<a href="#l142.4"></a><span id="l142.4">   if (!passResults.length)</span>
<a href="#l142.5"></a><span id="l142.5">     python = MimeTypeNoun.getMimeType(&quot;text/x-python&quot;);</span>
<a href="#l142.6"></a><span id="l142.6">   // but always add it to the results now, as we need consistent ordering</span>
<a href="#l142.7"></a><span id="l142.7">   //  since we use a list.</span>
<a href="#l142.8"></a><span id="l142.8">   curPassResults.push(python);</span>
<a href="#l142.9"></a><span id="l142.9"> </span>
<a href="#l142.10"></a><span id="l142.10"> </span>
<a href="#l142.11"></a><span id="l142.11">   // sanity-checking the parsing</span>
<a href="#l142.12"></a><span id="l142.12" class="difflineminus">-  do_check_eq(jpeg.type, &quot;image&quot;);</span>
<a href="#l142.13"></a><span id="l142.13" class="difflineminus">-  do_check_eq(jpeg.subType, &quot;jpeg&quot;);</span>
<a href="#l142.14"></a><span id="l142.14" class="difflineplus">+  Assert.equal(jpeg.type, &quot;image&quot;);</span>
<a href="#l142.15"></a><span id="l142.15" class="difflineplus">+  Assert.equal(jpeg.subType, &quot;jpeg&quot;);</span>
<a href="#l142.16"></a><span id="l142.16"> </span>
<a href="#l142.17"></a><span id="l142.17">   // - make sure the numeric trickiness for the block stuff is actually doing</span>
<a href="#l142.18"></a><span id="l142.18">   //  the right thing!</span>
<a href="#l142.19"></a><span id="l142.19">   const BLOCK_SIZE = MimeTypeNoun.TYPE_BLOCK_SIZE;</span>
<a href="#l142.20"></a><span id="l142.20">   // same blocks</span>
<a href="#l142.21"></a><span id="l142.21" class="difflineminus">-  do_check_eq(Math.floor(jpeg.id / BLOCK_SIZE),</span>
<a href="#l142.22"></a><span id="l142.22" class="difflineminus">-              Math.floor(png.id / BLOCK_SIZE));</span>
<a href="#l142.23"></a><span id="l142.23" class="difflineminus">-  do_check_eq(Math.floor(html.id / BLOCK_SIZE),</span>
<a href="#l142.24"></a><span id="l142.24" class="difflineminus">-              Math.floor(plain.id / BLOCK_SIZE));</span>
<a href="#l142.25"></a><span id="l142.25" class="difflineplus">+  Assert.equal(Math.floor(jpeg.id / BLOCK_SIZE),</span>
<a href="#l142.26"></a><span id="l142.26" class="difflineplus">+               Math.floor(png.id / BLOCK_SIZE));</span>
<a href="#l142.27"></a><span id="l142.27" class="difflineplus">+  Assert.equal(Math.floor(html.id / BLOCK_SIZE),</span>
<a href="#l142.28"></a><span id="l142.28" class="difflineplus">+               Math.floor(plain.id / BLOCK_SIZE));</span>
<a href="#l142.29"></a><span id="l142.29">   // different blocks</span>
<a href="#l142.30"></a><span id="l142.30" class="difflineminus">-  do_check_neq(Math.floor(jpeg.id / BLOCK_SIZE),</span>
<a href="#l142.31"></a><span id="l142.31" class="difflineminus">-               Math.floor(html.id / BLOCK_SIZE));</span>
<a href="#l142.32"></a><span id="l142.32" class="difflineplus">+  Assert.notEqual(Math.floor(jpeg.id / BLOCK_SIZE),</span>
<a href="#l142.33"></a><span id="l142.33" class="difflineplus">+                  Math.floor(html.id / BLOCK_SIZE));</span>
<a href="#l142.34"></a><span id="l142.34"> }</span>
<a href="#l142.35"></a><span id="l142.35"> </span>
<a href="#l142.36"></a><span id="l142.36"> function test_parameters() {</span>
<a href="#l142.37"></a><span id="l142.37">   let plain = MimeTypeNoun.getMimeType(&quot;text/plain&quot;);</span>
<a href="#l142.38"></a><span id="l142.38" class="difflineminus">-  do_check_eq(plain, MimeTypeNoun.getMimeType('text/plain; charset=&quot;UTF-8&quot;'));</span>
<a href="#l142.39"></a><span id="l142.39" class="difflineplus">+  Assert.equal(plain, MimeTypeNoun.getMimeType('text/plain; charset=&quot;UTF-8&quot;'));</span>
<a href="#l142.40"></a><span id="l142.40"> }</span>
<a href="#l142.41"></a><span id="l142.41"> </span>
<a href="#l142.42"></a><span id="l142.42"> function verify_passes_are_the_same() {</span>
<a href="#l142.43"></a><span id="l142.43">   var firstPassResults = passResults[0];</span>
<a href="#l142.44"></a><span id="l142.44">   for (let iType = 0; iType &lt; curPassResults.length; iType++) {</span>
<a href="#l142.45"></a><span id="l142.45">     for (let iPass = 1; iPass &lt; passResults.length; iPass++) {</span>
<a href="#l142.46"></a><span id="l142.46" class="difflineminus">-      do_check_eq(firstPassResults[iType].id,</span>
<a href="#l142.47"></a><span id="l142.47" class="difflineminus">-                  passResults[iPass][iType].id);</span>
<a href="#l142.48"></a><span id="l142.48" class="difflineplus">+      Assert.equal(firstPassResults[iType].id,</span>
<a href="#l142.49"></a><span id="l142.49" class="difflineplus">+                   passResults[iPass][iType].id);</span>
<a href="#l142.50"></a><span id="l142.50">     }</span>
<a href="#l142.51"></a><span id="l142.51">   }</span>
<a href="#l142.52"></a><span id="l142.52"> }</span>
<a href="#l142.53"></a><span id="l142.53"> </span>
<a href="#l142.54"></a><span id="l142.54"> /* ===== Driver ===== */</span>
<a href="#l142.55"></a><span id="l142.55"> </span>
<a href="#l142.56"></a><span id="l142.56"> var tests = [</span>
<a href="#l142.57"></a><span id="l142.57">   // do two passes of test_basics making sure that persisted values really</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l143.1"></a><span id="l143.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_nuke_migration.js</span>
<a href="#l143.2"></a><span id="l143.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_nuke_migration.js</span>
<a href="#l143.3"></a><span id="l143.3" class="difflineat">@@ -55,10 +55,10 @@ function run_test() {</span>
<a href="#l143.4"></a><span id="l143.4">   // - make the old database</span>
<a href="#l143.5"></a><span id="l143.5">   make_out_of_date_database();</span>
<a href="#l143.6"></a><span id="l143.6"> </span>
<a href="#l143.7"></a><span id="l143.7">   // - tickle gloda</span>
<a href="#l143.8"></a><span id="l143.8">   // public.js loads gloda.js which self-initializes and initializes the datastore</span>
<a href="#l143.9"></a><span id="l143.9">   Components.utils.import(&quot;resource:///modules/gloda/public.js&quot;);</span>
<a href="#l143.10"></a><span id="l143.10">   Components.utils.import(&quot;resource:///modules/gloda/datastore.js&quot;);</span>
<a href="#l143.11"></a><span id="l143.11"> </span>
<a href="#l143.12"></a><span id="l143.12" class="difflineminus">-  do_check_neq(GlodaDatastore.asyncConnection, null);</span>
<a href="#l143.13"></a><span id="l143.13" class="difflineplus">+  Assert.notEqual(GlodaDatastore.asyncConnection, null);</span>
<a href="#l143.14"></a><span id="l143.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l144.1"></a><span id="l144.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_query_core.js</span>
<a href="#l144.2"></a><span id="l144.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_query_core.js</span>
<a href="#l144.3"></a><span id="l144.3" class="difflineat">@@ -338,17 +338,17 @@ function* test_empty_set_logic() {</span>
<a href="#l144.4"></a><span id="l144.4">   query = Gloda.newQuery(WidgetNoun.id);</span>
<a href="#l144.5"></a><span id="l144.5">   query.inum(testUnique);</span>
<a href="#l144.6"></a><span id="l144.6">   query.multiIntAttr(null);</span>
<a href="#l144.7"></a><span id="l144.7">   queryExpect(query, [nonSingularWidgets[0]]);</span>
<a href="#l144.8"></a><span id="l144.8">   yield false;</span>
<a href="#l144.9"></a><span id="l144.9"> </span>
<a href="#l144.10"></a><span id="l144.10">   // make sure that the query doesn't explode when it has to handle a case</span>
<a href="#l144.11"></a><span id="l144.11">   //  that's not supposed to match</span>
<a href="#l144.12"></a><span id="l144.12" class="difflineminus">-  do_check_false(query.test(singularWidgets[0]));</span>
<a href="#l144.13"></a><span id="l144.13" class="difflineplus">+  Assert.ok(!query.test(singularWidgets[0]));</span>
<a href="#l144.14"></a><span id="l144.14"> }</span>
<a href="#l144.15"></a><span id="l144.15"> </span>
<a href="#l144.16"></a><span id="l144.16"> /* === Search === */</span>
<a href="#l144.17"></a><span id="l144.17"> /*</span>
<a href="#l144.18"></a><span id="l144.18">  * The conceit of our search is that more recent messages are better than older</span>
<a href="#l144.19"></a><span id="l144.19">  *  messages.  But at the same time, we care about some messages more than</span>
<a href="#l144.20"></a><span id="l144.20">  *  others (in general), and we care about messages that match search terms</span>
<a href="#l144.21"></a><span id="l144.21">  *  more strongly too.  So we introduce a general 'score' heuristic which we</span>
<a href="#l144.22"></a><span id="l144.22" class="difflineat">@@ -428,17 +428,17 @@ var WIDGET_FULLTEXT_QUERY_EXPLICIT_SQL =</span>
<a href="#l144.23"></a><span id="l144.23">     &quot;FROM ext_widget, ext_widgetText WHERE ext_widgetText MATCH ?&quot; +</span>
<a href="#l144.24"></a><span id="l144.24">     &quot; AND ext_widget.id == ext_widgetText.docid&quot;;</span>
<a href="#l144.25"></a><span id="l144.25"> </span>
<a href="#l144.26"></a><span id="l144.26"> /**</span>
<a href="#l144.27"></a><span id="l144.27">  * Used by queryExpect to verify</span>
<a href="#l144.28"></a><span id="l144.28">  */</span>
<a href="#l144.29"></a><span id="l144.29"> function verify_widget_order_and_stashing(aZeroBasedIndex, aWidget,</span>
<a href="#l144.30"></a><span id="l144.30">                                           aCollection) {</span>
<a href="#l144.31"></a><span id="l144.31" class="difflineminus">-  do_check_eq(aZeroBasedIndex, aWidget.inum);</span>
<a href="#l144.32"></a><span id="l144.32" class="difflineplus">+  Assert.equal(aZeroBasedIndex, aWidget.inum);</span>
<a href="#l144.33"></a><span id="l144.33">   if (!aCollection.stashedColumns[aWidget.id] ||</span>
<a href="#l144.34"></a><span id="l144.34">       !aCollection.stashedColumns[aWidget.id].length)</span>
<a href="#l144.35"></a><span id="l144.35">     do_throw(&quot;no stashed information for widget: &quot; + aWidget);</span>
<a href="#l144.36"></a><span id="l144.36"> }</span>
<a href="#l144.37"></a><span id="l144.37"> </span>
<a href="#l144.38"></a><span id="l144.38"> /**</span>
<a href="#l144.39"></a><span id="l144.39">  * Test the fundamentals of the search ranking idiom we use elsewhere.  This</span>
<a href="#l144.40"></a><span id="l144.40">  *  is primarily a simplified</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l145.1"></a><span id="l145.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js</span>
<a href="#l145.2"></a><span id="l145.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js</span>
<a href="#l145.3"></a><span id="l145.3" class="difflineat">@@ -44,42 +44,42 @@ function* test_smime_mimemsg() {</span>
<a href="#l145.4"></a><span id="l145.4">   let synSet = new SyntheticMessageSet([msg]);</span>
<a href="#l145.5"></a><span id="l145.5">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l145.6"></a><span id="l145.6"> </span>
<a href="#l145.7"></a><span id="l145.7">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l145.8"></a><span id="l145.8"> </span>
<a href="#l145.9"></a><span id="l145.9">   // Make sure by default, MimeMessages do not include encrypted parts</span>
<a href="#l145.10"></a><span id="l145.10">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l145.11"></a><span id="l145.11">     // First make sure the MIME structure is as we expect it to be.</span>
<a href="#l145.12"></a><span id="l145.12" class="difflineminus">-    do_check_eq(aMimeMsg.parts.length, 1);</span>
<a href="#l145.13"></a><span id="l145.13" class="difflineplus">+    Assert.equal(aMimeMsg.parts.length, 1);</span>
<a href="#l145.14"></a><span id="l145.14">     // Then, make sure the MimeUnknown part there has the encrypted flag</span>
<a href="#l145.15"></a><span id="l145.15" class="difflineminus">-    do_check_true(aMimeMsg.parts[0].isEncrypted);</span>
<a href="#l145.16"></a><span id="l145.16" class="difflineplus">+    Assert.ok(aMimeMsg.parts[0].isEncrypted);</span>
<a href="#l145.17"></a><span id="l145.17">     // And that we can't &quot;see through&quot; the MimeUnknown container</span>
<a href="#l145.18"></a><span id="l145.18" class="difflineminus">-    do_check_eq(aMimeMsg.parts[0].parts.length, 0);</span>
<a href="#l145.19"></a><span id="l145.19" class="difflineplus">+    Assert.equal(aMimeMsg.parts[0].parts.length, 0);</span>
<a href="#l145.20"></a><span id="l145.20">     // Make sure we can't see the attachment</span>
<a href="#l145.21"></a><span id="l145.21" class="difflineminus">-    do_check_eq(aMimeMsg.allUserAttachments.length, 0);</span>
<a href="#l145.22"></a><span id="l145.22" class="difflineplus">+    Assert.equal(aMimeMsg.allUserAttachments.length, 0);</span>
<a href="#l145.23"></a><span id="l145.23">     async_driver();</span>
<a href="#l145.24"></a><span id="l145.24">   }, true, {</span>
<a href="#l145.25"></a><span id="l145.25">   });</span>
<a href="#l145.26"></a><span id="l145.26"> </span>
<a href="#l145.27"></a><span id="l145.27">   yield false;</span>
<a href="#l145.28"></a><span id="l145.28"> </span>
<a href="#l145.29"></a><span id="l145.29">   // Now what about we specifically ask to &quot;see&quot; the encrypted parts?</span>
<a href="#l145.30"></a><span id="l145.30">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l145.31"></a><span id="l145.31">     // First make sure the MIME structure is as we expect it to be.</span>
<a href="#l145.32"></a><span id="l145.32" class="difflineminus">-    do_check_eq(aMimeMsg.parts.length, 1);</span>
<a href="#l145.33"></a><span id="l145.33" class="difflineplus">+    Assert.equal(aMimeMsg.parts.length, 1);</span>
<a href="#l145.34"></a><span id="l145.34">     // Then, make sure the MimeUnknown part there has the encrypted flag</span>
<a href="#l145.35"></a><span id="l145.35" class="difflineminus">-    do_check_true(aMimeMsg.parts[0].isEncrypted);</span>
<a href="#l145.36"></a><span id="l145.36" class="difflineplus">+    Assert.ok(aMimeMsg.parts[0].isEncrypted);</span>
<a href="#l145.37"></a><span id="l145.37">     // And that we can &quot;see through&quot; the MimeUnknown container</span>
<a href="#l145.38"></a><span id="l145.38" class="difflineminus">-    do_check_eq(aMimeMsg.parts[0].parts.length, 1);</span>
<a href="#l145.39"></a><span id="l145.39" class="difflineminus">-    do_check_eq(aMimeMsg.parts[0].parts[0].parts.length, 1);</span>
<a href="#l145.40"></a><span id="l145.40" class="difflineminus">-    do_check_eq(aMimeMsg.parts[0].parts[0].parts[0].parts.length, 2);</span>
<a href="#l145.41"></a><span id="l145.41" class="difflineplus">+    Assert.equal(aMimeMsg.parts[0].parts.length, 1);</span>
<a href="#l145.42"></a><span id="l145.42" class="difflineplus">+    Assert.equal(aMimeMsg.parts[0].parts[0].parts.length, 1);</span>
<a href="#l145.43"></a><span id="l145.43" class="difflineplus">+    Assert.equal(aMimeMsg.parts[0].parts[0].parts[0].parts.length, 2);</span>
<a href="#l145.44"></a><span id="l145.44">     // Make sure we can see the attachment</span>
<a href="#l145.45"></a><span id="l145.45" class="difflineminus">-    do_check_eq(aMimeMsg.allUserAttachments.length, 1);</span>
<a href="#l145.46"></a><span id="l145.46" class="difflineminus">-    do_check_eq(aMimeMsg.allUserAttachments[0].contentType, &quot;image/jpeg&quot;);</span>
<a href="#l145.47"></a><span id="l145.47" class="difflineplus">+    Assert.equal(aMimeMsg.allUserAttachments.length, 1);</span>
<a href="#l145.48"></a><span id="l145.48" class="difflineplus">+    Assert.equal(aMimeMsg.allUserAttachments[0].contentType, &quot;image/jpeg&quot;);</span>
<a href="#l145.49"></a><span id="l145.49">     async_driver();</span>
<a href="#l145.50"></a><span id="l145.50">     // Extra little bit of testing</span>
<a href="#l145.51"></a><span id="l145.51">   }, true, {</span>
<a href="#l145.52"></a><span id="l145.52">     examineEncryptedParts: true,</span>
<a href="#l145.53"></a><span id="l145.53">   });</span>
<a href="#l145.54"></a><span id="l145.54">   yield false;</span>
<a href="#l145.55"></a><span id="l145.55"> }</span>
<a href="#l145.56"></a><span id="l145.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l146.1"></a><span id="l146.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_filter_enumerator.js</span>
<a href="#l146.2"></a><span id="l146.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_filter_enumerator.js</span>
<a href="#l146.3"></a><span id="l146.3" class="difflineat">@@ -80,39 +80,39 @@ function run_test() {</span>
<a href="#l146.4"></a><span id="l146.4">   value.str = &quot;gloda-id&quot;;</span>
<a href="#l146.5"></a><span id="l146.5">   value.attrib = nsMsgSearchAttrib.HdrProperty;</span>
<a href="#l146.6"></a><span id="l146.6">   searchTerm.value = value;</span>
<a href="#l146.7"></a><span id="l146.7">   searchTerms.appendElement(searchTerm);</span>
<a href="#l146.8"></a><span id="l146.8"> </span>
<a href="#l146.9"></a><span id="l146.9">   let filterEnumerator = inboxDB.getFilterEnumerator(searchTerms);</span>
<a href="#l146.10"></a><span id="l146.10">   let numMatches = {};</span>
<a href="#l146.11"></a><span id="l146.11">   let keepGoing = inboxDB.nextMatchingHdrs(filterEnumerator, 100, 100, null, numMatches);</span>
<a href="#l146.12"></a><span id="l146.12" class="difflineminus">-  do_check_eq(kNumExpectedMatches, numMatches.value);</span>
<a href="#l146.13"></a><span id="l146.13" class="difflineminus">-  do_check_false(keepGoing);</span>
<a href="#l146.14"></a><span id="l146.14" class="difflineplus">+  Assert.equal(kNumExpectedMatches, numMatches.value);</span>
<a href="#l146.15"></a><span id="l146.15" class="difflineplus">+  Assert.ok(!keepGoing);</span>
<a href="#l146.16"></a><span id="l146.16">   filterEnumerator = inboxDB.getFilterEnumerator(searchTerms);</span>
<a href="#l146.17"></a><span id="l146.17">   let matchingHdrs = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l146.18"></a><span id="l146.18">   do {</span>
<a href="#l146.19"></a><span id="l146.19">     keepGoing = inboxDB.nextMatchingHdrs(filterEnumerator, 5, 5, matchingHdrs, numMatches);</span>
<a href="#l146.20"></a><span id="l146.20">   }</span>
<a href="#l146.21"></a><span id="l146.21">   while (keepGoing);</span>
<a href="#l146.22"></a><span id="l146.22" class="difflineminus">-  do_check_eq(kNumExpectedMatches, matchingHdrs.length);</span>
<a href="#l146.23"></a><span id="l146.23" class="difflineplus">+  Assert.equal(kNumExpectedMatches, matchingHdrs.length);</span>
<a href="#l146.24"></a><span id="l146.24">   let firstMatch = matchingHdrs.queryElementAt(0, Ci.nsIMsgDBHdr);</span>
<a href="#l146.25"></a><span id="l146.25" class="difflineminus">-  do_check_eq(firstMatch.messageId, gMessages[1].messageId);</span>
<a href="#l146.26"></a><span id="l146.26" class="difflineplus">+  Assert.equal(firstMatch.messageId, gMessages[1].messageId);</span>
<a href="#l146.27"></a><span id="l146.27">   let secondMatch = matchingHdrs.queryElementAt(1, Ci.nsIMsgDBHdr);</span>
<a href="#l146.28"></a><span id="l146.28" class="difflineminus">-  do_check_eq(secondMatch.messageId, gMessages[3].messageId);</span>
<a href="#l146.29"></a><span id="l146.29" class="difflineplus">+  Assert.equal(secondMatch.messageId, gMessages[3].messageId);</span>
<a href="#l146.30"></a><span id="l146.30"> </span>
<a href="#l146.31"></a><span id="l146.31">   // try it backwards, with roller skates:</span>
<a href="#l146.32"></a><span id="l146.32">   filterEnumerator = inboxDB.getFilterEnumerator(searchTerms, true);</span>
<a href="#l146.33"></a><span id="l146.33">   matchingHdrs.clear();</span>
<a href="#l146.34"></a><span id="l146.34">   do {</span>
<a href="#l146.35"></a><span id="l146.35">     keepGoing = inboxDB.nextMatchingHdrs(filterEnumerator, 5, 5, matchingHdrs, numMatches);</span>
<a href="#l146.36"></a><span id="l146.36">   }</span>
<a href="#l146.37"></a><span id="l146.37">   while (keepGoing);</span>
<a href="#l146.38"></a><span id="l146.38" class="difflineminus">-  do_check_eq(kNumExpectedMatches, matchingHdrs.length);</span>
<a href="#l146.39"></a><span id="l146.39" class="difflineplus">+  Assert.equal(kNumExpectedMatches, matchingHdrs.length);</span>
<a href="#l146.40"></a><span id="l146.40">   firstMatch = matchingHdrs.queryElementAt(0, Ci.nsIMsgDBHdr);</span>
<a href="#l146.41"></a><span id="l146.41" class="difflineminus">-  do_check_eq(firstMatch.messageId, gMessages[12].messageId);</span>
<a href="#l146.42"></a><span id="l146.42" class="difflineplus">+  Assert.equal(firstMatch.messageId, gMessages[12].messageId);</span>
<a href="#l146.43"></a><span id="l146.43">   secondMatch = matchingHdrs.queryElementAt(1, Ci.nsIMsgDBHdr);</span>
<a href="#l146.44"></a><span id="l146.44" class="difflineminus">-  do_check_eq(secondMatch.messageId, gMessages[11].messageId);</span>
<a href="#l146.45"></a><span id="l146.45" class="difflineplus">+  Assert.equal(secondMatch.messageId, gMessages[11].messageId);</span>
<a href="#l146.46"></a><span id="l146.46">   let tenthMatch = matchingHdrs.queryElementAt(9, Ci.nsIMsgDBHdr);</span>
<a href="#l146.47"></a><span id="l146.47" class="difflineminus">-  do_check_eq(tenthMatch.messageId, gMessages[1].messageId);</span>
<a href="#l146.48"></a><span id="l146.48" class="difflineplus">+  Assert.equal(tenthMatch.messageId, gMessages[1].messageId);</span>
<a href="#l146.49"></a><span id="l146.49"> </span>
<a href="#l146.50"></a><span id="l146.50">   do_test_finished();</span>
<a href="#l146.51"></a><span id="l146.51"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l147.1"></a><span id="l147.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_maildb.js</span>
<a href="#l147.2"></a><span id="l147.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_maildb.js</span>
<a href="#l147.3"></a><span id="l147.3" class="difflineat">@@ -15,24 +15,24 @@ var gTestArray =</span>
<a href="#l147.4"></a><span id="l147.4">   function test_db_open() {</span>
<a href="#l147.5"></a><span id="l147.5">     dbService = Components.classes[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l147.6"></a><span id="l147.6">                             .getService(Components.interfaces.nsIMsgDBService);</span>
<a href="#l147.7"></a><span id="l147.7">     // Get the root folder</span>
<a href="#l147.8"></a><span id="l147.8">     let root = localAccountUtils.incomingServer.rootFolder;</span>
<a href="#l147.9"></a><span id="l147.9">     root.createSubfolder(&quot;dbTest&quot;, null);</span>
<a href="#l147.10"></a><span id="l147.10">     gTestFolder = root.getChildNamed(&quot;dbTest&quot;);</span>
<a href="#l147.11"></a><span id="l147.11">     let db = dbService.openFolderDB(gTestFolder, true);</span>
<a href="#l147.12"></a><span id="l147.12" class="difflineminus">-    do_check_neq(db, null);</span>
<a href="#l147.13"></a><span id="l147.13" class="difflineplus">+    Assert.notEqual(db, null);</span>
<a href="#l147.14"></a><span id="l147.14">     db.dBFolderInfo.highWater = 10;</span>
<a href="#l147.15"></a><span id="l147.15">     db.Close(true);</span>
<a href="#l147.16"></a><span id="l147.16">     db = dbService.openFolderDB(gTestFolder, true);</span>
<a href="#l147.17"></a><span id="l147.17" class="difflineminus">-    do_check_neq(db, null);</span>
<a href="#l147.18"></a><span id="l147.18" class="difflineminus">-    do_check_eq(db.dBFolderInfo.highWater, 10);</span>
<a href="#l147.19"></a><span id="l147.19" class="difflineplus">+    Assert.notEqual(db, null);</span>
<a href="#l147.20"></a><span id="l147.20" class="difflineplus">+    Assert.equal(db.dBFolderInfo.highWater, 10);</span>
<a href="#l147.21"></a><span id="l147.21">     db.dBFolderInfo.onKeyAdded(15);</span>
<a href="#l147.22"></a><span id="l147.22" class="difflineminus">-    do_check_eq(db.dBFolderInfo.highWater, 15);</span>
<a href="#l147.23"></a><span id="l147.23" class="difflineplus">+    Assert.equal(db.dBFolderInfo.highWater, 15);</span>
<a href="#l147.24"></a><span id="l147.24">     db.Close(true);</span>
<a href="#l147.25"></a><span id="l147.25">     db.ForceClosed();</span>
<a href="#l147.26"></a><span id="l147.26">     db = null;</span>
<a href="#l147.27"></a><span id="l147.27">     doTest(++gCurTestNum);</span>
<a href="#l147.28"></a><span id="l147.28">   },</span>
<a href="#l147.29"></a><span id="l147.29">   function test_async_open() {</span>
<a href="#l147.30"></a><span id="l147.30">     let messageGenerator = new MessageGenerator();</span>
<a href="#l147.31"></a><span id="l147.31">     let localFolder = gTestFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l147.32"></a><span id="l147.32" class="difflineat">@@ -94,17 +94,17 @@ function run_test() {</span>
<a href="#l147.33"></a><span id="l147.33"> function openMore(db)</span>
<a href="#l147.34"></a><span id="l147.34"> {</span>
<a href="#l147.35"></a><span id="l147.35">   let done = dbService.openMore(db, 1);</span>
<a href="#l147.36"></a><span id="l147.36">   dump(&quot;in openMore done = &quot; + done + &quot;\n&quot;);</span>
<a href="#l147.37"></a><span id="l147.37">   if (!done)</span>
<a href="#l147.38"></a><span id="l147.38">     mailTestUtils.do_timeout_function(0, openMore, null, [db]);</span>
<a href="#l147.39"></a><span id="l147.39">   else {</span>
<a href="#l147.40"></a><span id="l147.40">     // just check that we can get something out of the db.</span>
<a href="#l147.41"></a><span id="l147.41" class="difflineminus">-    do_check_eq(db.dBFolderInfo.numMessages, kNumTestMessages);</span>
<a href="#l147.42"></a><span id="l147.42" class="difflineplus">+    Assert.equal(db.dBFolderInfo.numMessages, kNumTestMessages);</span>
<a href="#l147.43"></a><span id="l147.43">     db.Close(true);</span>
<a href="#l147.44"></a><span id="l147.44">     db.ForceClosed();</span>
<a href="#l147.45"></a><span id="l147.45">     db = null;</span>
<a href="#l147.46"></a><span id="l147.46">     doTest(++gCurTestNum);</span>
<a href="#l147.47"></a><span id="l147.47">   }</span>
<a href="#l147.48"></a><span id="l147.48"> }</span>
<a href="#l147.49"></a><span id="l147.49"> </span>
<a href="#l147.50"></a><span id="l147.50"> function openMoreAsync(db)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l148.1"></a><span id="l148.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</span>
<a href="#l148.2"></a><span id="l148.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</span>
<a href="#l148.3"></a><span id="l148.3" class="difflineat">@@ -33,32 +33,32 @@ function continue_test()</span>
<a href="#l148.4"></a><span id="l148.4">   var enumerator = gHdr.propertyEnumerator;</span>
<a href="#l148.5"></a><span id="l148.5">   var properties = [];</span>
<a href="#l148.6"></a><span id="l148.6">   while (enumerator.hasMore())</span>
<a href="#l148.7"></a><span id="l148.7">   {</span>
<a href="#l148.8"></a><span id="l148.8">     var property = enumerator.getNext();</span>
<a href="#l148.9"></a><span id="l148.9">     //dump(&quot;\nProperty is &quot; + property);</span>
<a href="#l148.10"></a><span id="l148.10">     properties.push(property);</span>
<a href="#l148.11"></a><span id="l148.11">   }</span>
<a href="#l148.12"></a><span id="l148.12" class="difflineminus">-  do_check_true(properties.indexOf(&quot;flags&quot;) &gt;= 0);</span>
<a href="#l148.13"></a><span id="l148.13" class="difflineminus">-  do_check_true(properties.indexOf(&quot;size&quot;) &gt;= 0);</span>
<a href="#l148.14"></a><span id="l148.14" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;flags&quot;) &gt;= 0);</span>
<a href="#l148.15"></a><span id="l148.15" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;size&quot;) &gt;= 0);</span>
<a href="#l148.16"></a><span id="l148.16">   // this will be added in the next section, but does not exist yet</span>
<a href="#l148.17"></a><span id="l148.17" class="difflineminus">-  do_check_true(properties.indexOf(&quot;iamnew&quot;) &lt; 0);</span>
<a href="#l148.18"></a><span id="l148.18" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;iamnew&quot;) &lt; 0);</span>
<a href="#l148.19"></a><span id="l148.19"> </span>
<a href="#l148.20"></a><span id="l148.20">   // add a new property, and make sure that it appears</span>
<a href="#l148.21"></a><span id="l148.21">   gHdr.setStringProperty(&quot;iamnew&quot;, &quot;somevalue&quot;);</span>
<a href="#l148.22"></a><span id="l148.22"> </span>
<a href="#l148.23"></a><span id="l148.23">   enumerator = gHdr.propertyEnumerator;</span>
<a href="#l148.24"></a><span id="l148.24">   properties = [];</span>
<a href="#l148.25"></a><span id="l148.25">   while (enumerator.hasMore())</span>
<a href="#l148.26"></a><span id="l148.26">   {</span>
<a href="#l148.27"></a><span id="l148.27">     property = enumerator.getNext();</span>
<a href="#l148.28"></a><span id="l148.28">     //dump(&quot;\nProperty 2 is &quot; + property);</span>
<a href="#l148.29"></a><span id="l148.29">     properties.push(property);</span>
<a href="#l148.30"></a><span id="l148.30">   }</span>
<a href="#l148.31"></a><span id="l148.31" class="difflineminus">-  do_check_true(properties.indexOf(&quot;flags&quot;) &gt;= 0);</span>
<a href="#l148.32"></a><span id="l148.32" class="difflineminus">-  do_check_true(properties.indexOf(&quot;size&quot;) &gt;= 0);</span>
<a href="#l148.33"></a><span id="l148.33" class="difflineminus">-  do_check_true(properties.indexOf(&quot;iamnew&quot;) &gt;= 0);</span>
<a href="#l148.34"></a><span id="l148.34" class="difflineminus">-  do_check_true(properties.indexOf(&quot;idonotexist&quot;) &lt; 0);</span>
<a href="#l148.35"></a><span id="l148.35" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;flags&quot;) &gt;= 0);</span>
<a href="#l148.36"></a><span id="l148.36" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;size&quot;) &gt;= 0);</span>
<a href="#l148.37"></a><span id="l148.37" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;iamnew&quot;) &gt;= 0);</span>
<a href="#l148.38"></a><span id="l148.38" class="difflineplus">+  Assert.ok(properties.indexOf(&quot;idonotexist&quot;) &lt; 0);</span>
<a href="#l148.39"></a><span id="l148.39"> </span>
<a href="#l148.40"></a><span id="l148.40">   gHdr = null;</span>
<a href="#l148.41"></a><span id="l148.41">   do_test_finished();</span>
<a href="#l148.42"></a><span id="l148.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l149.1"></a><span id="l149.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_references_parsing.js</span>
<a href="#l149.2"></a><span id="l149.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_references_parsing.js</span>
<a href="#l149.3"></a><span id="l149.3" class="difflineat">@@ -63,21 +63,21 @@ function test_references_header_parsing(</span>
<a href="#l149.4"></a><span id="l149.4">       }</span>
<a href="#l149.5"></a><span id="l149.5"> </span>
<a href="#l149.6"></a><span id="l149.6">       dump(&quot;Got:\n&quot;);</span>
<a href="#l149.7"></a><span id="l149.7"> </span>
<a href="#l149.8"></a><span id="l149.8">       for (iResult = 0; iResult &lt; aMsgHdr.numReferences; iResult++) {</span>
<a href="#l149.9"></a><span id="l149.9">         dump(&quot;'&quot; + aMsgHdr.getStringReference(iResult) +  &quot;'\n&quot;);</span>
<a href="#l149.10"></a><span id="l149.10">       }</span>
<a href="#l149.11"></a><span id="l149.11">       </span>
<a href="#l149.12"></a><span id="l149.12" class="difflineminus">-      do_check_eq(aMsgHdr.numReferences, results.length);</span>
<a href="#l149.13"></a><span id="l149.13" class="difflineplus">+      Assert.equal(aMsgHdr.numReferences, results.length);</span>
<a href="#l149.14"></a><span id="l149.14">     }</span>
<a href="#l149.15"></a><span id="l149.15">     </span>
<a href="#l149.16"></a><span id="l149.16">     for (iResult = 0; iResult &lt; results.length; iResult++) {</span>
<a href="#l149.17"></a><span id="l149.17" class="difflineminus">-      do_check_eq(aMsgHdr.getStringReference(iResult), results[iResult]);</span>
<a href="#l149.18"></a><span id="l149.18" class="difflineplus">+      Assert.equal(aMsgHdr.getStringReference(iResult), results[iResult]);</span>
<a href="#l149.19"></a><span id="l149.19">     }</span>
<a href="#l149.20"></a><span id="l149.20">   }</span>
<a href="#l149.21"></a><span id="l149.21">   </span>
<a href="#l149.22"></a><span id="l149.22">   do_test_finished();</span>
<a href="#l149.23"></a><span id="l149.23"> }</span>
<a href="#l149.24"></a><span id="l149.24"> </span>
<a href="#l149.25"></a><span id="l149.25"> /*</span>
<a href="#l149.26"></a><span id="l149.26">  * This infrastructure down here exists just to get</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l150.1"></a><span id="l150.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js</span>
<a href="#l150.2"></a><span id="l150.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js</span>
<a href="#l150.3"></a><span id="l150.3" class="difflineat">@@ -66,23 +66,23 @@ function TrainingData() {</span>
<a href="#l150.4"></a><span id="l150.4">   }</span>
<a href="#l150.5"></a><span id="l150.5">   </span>
<a href="#l150.6"></a><span id="l150.6">   // method specifications</span>
<a href="#l150.7"></a><span id="l150.7">   </span>
<a href="#l150.8"></a><span id="l150.8">   function read() {</span>
<a href="#l150.9"></a><span id="l150.9">     var file = getJunkStatFile();</span>
<a href="#l150.10"></a><span id="l150.10"> </span>
<a href="#l150.11"></a><span id="l150.11">     // does the file exist?</span>
<a href="#l150.12"></a><span id="l150.12" class="difflineminus">-    do_check_true(file.exists());</span>
<a href="#l150.13"></a><span id="l150.13" class="difflineplus">+    Assert.ok(file.exists());</span>
<a href="#l150.14"></a><span id="l150.14"> </span>
<a href="#l150.15"></a><span id="l150.15">     var fileStream = getBinStream(file);</span>
<a href="#l150.16"></a><span id="l150.16">     </span>
<a href="#l150.17"></a><span id="l150.17">     // check magic number</span>
<a href="#l150.18"></a><span id="l150.18">     var iMagicNumber = fileStream.read32();</span>
<a href="#l150.19"></a><span id="l150.19" class="difflineminus">-    do_check_eq(iMagicNumber, 0xFEEDFACE);</span>
<a href="#l150.20"></a><span id="l150.20" class="difflineplus">+    Assert.equal(iMagicNumber, 0xFEEDFACE);</span>
<a href="#l150.21"></a><span id="l150.21">     </span>
<a href="#l150.22"></a><span id="l150.22">     // get ham'n'spam numbers</span>
<a href="#l150.23"></a><span id="l150.23">     this.mGoodMessages = fileStream.read32();</span>
<a href="#l150.24"></a><span id="l150.24">     this.mJunkMessages = fileStream.read32();</span>
<a href="#l150.25"></a><span id="l150.25"> </span>
<a href="#l150.26"></a><span id="l150.26">     // Read good tokens</span>
<a href="#l150.27"></a><span id="l150.27">     this.mGoodTokens = fileStream.read32();</span>
<a href="#l150.28"></a><span id="l150.28">     var iRefCount, iTokenLen, sToken;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l151.1"></a><span id="l151.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js</span>
<a href="#l151.2"></a><span id="l151.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_bug228675.js</span>
<a href="#l151.3"></a><span id="l151.3" class="difflineat">@@ -86,18 +86,18 @@ var doTestingListener =</span>
<a href="#l151.4"></a><span id="l151.4">     count: 4 token: money</span>
<a href="#l151.5"></a><span id="l151.5">     count: 4 token: to:careful reader &lt;reader@example.org&gt;</span>
<a href="#l151.6"></a><span id="l151.6">     count: 2 token: money!</span>
<a href="#l151.7"></a><span id="l151.7">     */</span>
<a href="#l151.8"></a><span id="l151.8">     </span>
<a href="#l151.9"></a><span id="l151.9">     // Shrinking divides all counts by two. In comments, I show the</span>
<a href="#l151.10"></a><span id="l151.10">     // calculation for each test, (pre-shrink count)/2.</span>
<a href="#l151.11"></a><span id="l151.11"> </span>
<a href="#l151.12"></a><span id="l151.12" class="difflineminus">-    do_check_eq(trainingData.mGoodMessages, 1); //  2/2</span>
<a href="#l151.13"></a><span id="l151.13" class="difflineminus">-    do_check_eq(trainingData.mJunkMessages, 2); //  4/2</span>
<a href="#l151.14"></a><span id="l151.14" class="difflineplus">+    Assert.equal(trainingData.mGoodMessages, 1); //  2/2</span>
<a href="#l151.15"></a><span id="l151.15" class="difflineplus">+    Assert.equal(trainingData.mJunkMessages, 2); //  4/2</span>
<a href="#l151.16"></a><span id="l151.16">     checkToken(&quot;money&quot;, 0, 2);  // (0/2, 4/2)</span>
<a href="#l151.17"></a><span id="l151.17">     checkToken(&quot;subject:report&quot;, 0, 0);  // (1/2, 0/2)</span>
<a href="#l151.18"></a><span id="l151.18">     checkToken(&quot;to:careful reader &lt;reader@example.org&gt;&quot;, 1, 2); // (2/2, 4/2)</span>
<a href="#l151.19"></a><span id="l151.19">     checkToken(&quot;make&quot;, 0, 1); // (0/2, 3/2)</span>
<a href="#l151.20"></a><span id="l151.20">     checkToken(&quot;important&quot;, 1, 0); // (2/2, 0/2)</span>
<a href="#l151.21"></a><span id="l151.21">     </span>
<a href="#l151.22"></a><span id="l151.22">     do_test_finished();</span>
<a href="#l151.23"></a><span id="l151.23">   }</span>
<a href="#l151.24"></a><span id="l151.24" class="difflineat">@@ -107,11 +107,11 @@ var doTestingListener =</span>
<a href="#l151.25"></a><span id="l151.25"> </span>
<a href="#l151.26"></a><span id="l151.26"> function checkToken(aToken, aGoodCount, aJunkCount)</span>
<a href="#l151.27"></a><span id="l151.27"> {</span>
<a href="#l151.28"></a><span id="l151.28">   print(&quot; checking &quot; + aToken);</span>
<a href="#l151.29"></a><span id="l151.29">   var goodCount = trainingData.mGoodCounts[aToken];</span>
<a href="#l151.30"></a><span id="l151.30">   var junkCount = trainingData.mJunkCounts[aToken];</span>
<a href="#l151.31"></a><span id="l151.31">   if (!goodCount) goodCount = 0;</span>
<a href="#l151.32"></a><span id="l151.32">   if (!junkCount) junkCount = 0;</span>
<a href="#l151.33"></a><span id="l151.33" class="difflineminus">-  do_check_eq(goodCount, aGoodCount);</span>
<a href="#l151.34"></a><span id="l151.34" class="difflineminus">-  do_check_eq(junkCount, aJunkCount);</span>
<a href="#l151.35"></a><span id="l151.35" class="difflineplus">+  Assert.equal(goodCount, aGoodCount);</span>
<a href="#l151.36"></a><span id="l151.36" class="difflineplus">+  Assert.equal(junkCount, aJunkCount);</span>
<a href="#l151.37"></a><span id="l151.37"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l152.1"></a><span id="l152.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js</span>
<a href="#l152.2"></a><span id="l152.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_customTokenization.js</span>
<a href="#l152.3"></a><span id="l152.3" class="difflineat">@@ -103,24 +103,24 @@ var listener =</span>
<a href="#l152.4"></a><span id="l152.4">     print(&quot;Details for &quot; + aMsgURI);</span>
<a href="#l152.5"></a><span id="l152.5">     for (var i = 0; i &lt; aTokenString.length; i++)</span>
<a href="#l152.6"></a><span id="l152.6">       print(&quot;Token &quot; + aTokenString[i]);</span>
<a href="#l152.7"></a><span id="l152.7"> </span>
<a href="#l152.8"></a><span id="l152.8">     // we should have these tokens</span>
<a href="#l152.9"></a><span id="l152.9">     for (var value of gTest.tokens)</span>
<a href="#l152.10"></a><span id="l152.10">     {</span>
<a href="#l152.11"></a><span id="l152.11">       print(&quot;We should have '&quot; + value + &quot;'? &quot;);</span>
<a href="#l152.12"></a><span id="l152.12" class="difflineminus">-      do_check_true(aTokenString.indexOf(value) &gt;= 0);</span>
<a href="#l152.13"></a><span id="l152.13" class="difflineplus">+      Assert.ok(aTokenString.indexOf(value) &gt;= 0);</span>
<a href="#l152.14"></a><span id="l152.14">     }</span>
<a href="#l152.15"></a><span id="l152.15"> </span>
<a href="#l152.16"></a><span id="l152.16">     // should not have these tokens</span>
<a href="#l152.17"></a><span id="l152.17">     for (var value of gTest.nottokens)</span>
<a href="#l152.18"></a><span id="l152.18">     {</span>
<a href="#l152.19"></a><span id="l152.19">       print(&quot;We should not have '&quot; + value + &quot;'? &quot;);</span>
<a href="#l152.20"></a><span id="l152.20" class="difflineminus">-      do_check_true(aTokenString.indexOf(value) &lt; 0);</span>
<a href="#l152.21"></a><span id="l152.21" class="difflineplus">+      Assert.ok(aTokenString.indexOf(value) &lt; 0);</span>
<a href="#l152.22"></a><span id="l152.22">     }</span>
<a href="#l152.23"></a><span id="l152.23">     startCommand();</span>
<a href="#l152.24"></a><span id="l152.24">   }</span>
<a href="#l152.25"></a><span id="l152.25"> };</span>
<a href="#l152.26"></a><span id="l152.26"> </span>
<a href="#l152.27"></a><span id="l152.27"> // start the next test command</span>
<a href="#l152.28"></a><span id="l152.28"> function startCommand()</span>
<a href="#l152.29"></a><span id="l152.29"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l153.1"></a><span id="l153.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</span>
<a href="#l153.2"></a><span id="l153.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</span>
<a href="#l153.3"></a><span id="l153.3" class="difflineat">@@ -290,44 +290,44 @@ var junkListener =</span>
<a href="#l153.4"></a><span id="l153.4">     if (!aMsgURI)</span>
<a href="#l153.5"></a><span id="l153.5">       return; // ignore end-of-batch signal</span>
<a href="#l153.6"></a><span id="l153.6">     //print(&quot;Message URI is &quot; + aMsgURI);</span>
<a href="#l153.7"></a><span id="l153.7">     //print(&quot;Junk percent is &quot; + aJunkPercent);</span>
<a href="#l153.8"></a><span id="l153.8">     //print(&quot;Classification is &quot; + aClassification);</span>
<a href="#l153.9"></a><span id="l153.9">     var command = gTest.command;</span>
<a href="#l153.10"></a><span id="l153.10">     var junkPercent = gTest.junkPercent;</span>
<a href="#l153.11"></a><span id="l153.11">     // file returned correctly</span>
<a href="#l153.12"></a><span id="l153.12" class="difflineminus">-    do_check_eq(getSpec(gTest.fileName), aMsgURI);</span>
<a href="#l153.13"></a><span id="l153.13" class="difflineplus">+    Assert.equal(getSpec(gTest.fileName), aMsgURI);</span>
<a href="#l153.14"></a><span id="l153.14"> </span>
<a href="#l153.15"></a><span id="l153.15">     // checks of aClassification</span>
<a href="#l153.16"></a><span id="l153.16"> </span>
<a href="#l153.17"></a><span id="l153.17">     // forget returns unclassified</span>
<a href="#l153.18"></a><span id="l153.18">     if (command == kForgetJ || command == kForgetT)</span>
<a href="#l153.19"></a><span id="l153.19" class="difflineminus">-      do_check_eq(aClassification, kUnclassified);</span>
<a href="#l153.20"></a><span id="l153.20" class="difflineplus">+      Assert.equal(aClassification, kUnclassified);</span>
<a href="#l153.21"></a><span id="l153.21">     // classification or train should return an actual classification</span>
<a href="#l153.22"></a><span id="l153.22">     else</span>
<a href="#l153.23"></a><span id="l153.23">     {</span>
<a href="#l153.24"></a><span id="l153.24">       // check junk classification set by default cutoff of 90</span>
<a href="#l153.25"></a><span id="l153.25">       var isGood = Math.abs(junkPercent) &lt; 90;</span>
<a href="#l153.26"></a><span id="l153.26">       if (junkPercent &lt; 0)</span>
<a href="#l153.27"></a><span id="l153.27">         isGood = !isGood;</span>
<a href="#l153.28"></a><span id="l153.28" class="difflineminus">-      do_check_eq(aClassification, isGood ? kGood : kJunk);</span>
<a href="#l153.29"></a><span id="l153.29" class="difflineplus">+      Assert.equal(aClassification, isGood ? kGood : kJunk);</span>
<a href="#l153.30"></a><span id="l153.30">     }</span>
<a href="#l153.31"></a><span id="l153.31"> </span>
<a href="#l153.32"></a><span id="l153.32">     // checks of aJunkPercent</span>
<a href="#l153.33"></a><span id="l153.33"> </span>
<a href="#l153.34"></a><span id="l153.34">     if (command == kClassJ || command == kClassT)</span>
<a href="#l153.35"></a><span id="l153.35">       // classify returns the actual junk percents</span>
<a href="#l153.36"></a><span id="l153.36" class="difflineminus">-      do_check_eq(Math.abs(junkPercent), aJunkPercent);</span>
<a href="#l153.37"></a><span id="l153.37" class="difflineplus">+      Assert.equal(Math.abs(junkPercent), aJunkPercent);</span>
<a href="#l153.38"></a><span id="l153.38">     else if (command == kTrainJ || command == kTrainT)</span>
<a href="#l153.39"></a><span id="l153.39">       // train returns the ham and spam limits</span>
<a href="#l153.40"></a><span id="l153.40" class="difflineminus">-      do_check_eq(aJunkPercent, junkPercent &lt; 90 ? kIsHamScore : kIsSpamScore);</span>
<a href="#l153.41"></a><span id="l153.41" class="difflineplus">+      Assert.equal(aJunkPercent, junkPercent &lt; 90 ? kIsHamScore : kIsSpamScore);</span>
<a href="#l153.42"></a><span id="l153.42">     else</span>
<a href="#l153.43"></a><span id="l153.43">       // forget always returns 0</span>
<a href="#l153.44"></a><span id="l153.44" class="difflineminus">-      do_check_eq(aJunkPercent, 0);</span>
<a href="#l153.45"></a><span id="l153.45" class="difflineplus">+      Assert.equal(aJunkPercent, 0);</span>
<a href="#l153.46"></a><span id="l153.46"> </span>
<a href="#l153.47"></a><span id="l153.47">     // if the current test includes a trait listener, it will</span>
<a href="#l153.48"></a><span id="l153.48">     // run next, so we defer to it for starting the next command</span>
<a href="#l153.49"></a><span id="l153.49">     if (gTest.traitListener)</span>
<a href="#l153.50"></a><span id="l153.50">       return;</span>
<a href="#l153.51"></a><span id="l153.51">     startCommand();</span>
<a href="#l153.52"></a><span id="l153.52">   }</span>
<a href="#l153.53"></a><span id="l153.53"> };</span>
<a href="#l153.54"></a><span id="l153.54" class="difflineat">@@ -340,52 +340,52 @@ var traitListener =</span>
<a href="#l153.55"></a><span id="l153.55">     if (!aMsgURI)</span>
<a href="#l153.56"></a><span id="l153.56">       return; //ignore end-of-batch signal</span>
<a href="#l153.57"></a><span id="l153.57">     //print(&quot;(Trait Listener)Message URI is &quot; + aMsgURI);</span>
<a href="#l153.58"></a><span id="l153.58">     //print(&quot;(Trait Listener)Junk percent is &quot; + aPercents);</span>
<a href="#l153.59"></a><span id="l153.59">     var command = gTest.command;</span>
<a href="#l153.60"></a><span id="l153.60">     var junkPercent = gTest.junkPercent;</span>
<a href="#l153.61"></a><span id="l153.61">     //print(&quot;command, junkPercent is &quot; + command + &quot; , &quot; + junkPercent);</span>
<a href="#l153.62"></a><span id="l153.62"> </span>
<a href="#l153.63"></a><span id="l153.63" class="difflineminus">-    do_check_eq(getSpec(gTest.fileName), aMsgURI);</span>
<a href="#l153.64"></a><span id="l153.64" class="difflineplus">+    Assert.equal(getSpec(gTest.fileName), aMsgURI);</span>
<a href="#l153.65"></a><span id="l153.65"> </span>
<a href="#l153.66"></a><span id="l153.66">     // checks of aPercents</span>
<a href="#l153.67"></a><span id="l153.67"> </span>
<a href="#l153.68"></a><span id="l153.68">     if (command == kForgetJ || command == kForgetT)</span>
<a href="#l153.69"></a><span id="l153.69">       // &quot;forgets&quot; with null newClassifications does not return a percent</span>
<a href="#l153.70"></a><span id="l153.70" class="difflineminus">-      do_check_eq(aPercents.length, 0);</span>
<a href="#l153.71"></a><span id="l153.71" class="difflineplus">+      Assert.equal(aPercents.length, 0);</span>
<a href="#l153.72"></a><span id="l153.72">     else</span>
<a href="#l153.73"></a><span id="l153.73">     {</span>
<a href="#l153.74"></a><span id="l153.74">       var percent = aPercents[0];</span>
<a href="#l153.75"></a><span id="l153.75">       //print(&quot;Percent is &quot; + percent);</span>
<a href="#l153.76"></a><span id="l153.76">       if (command == kClassJ || command == kClassT)</span>
<a href="#l153.77"></a><span id="l153.77">       // Classify returns actual percents</span>
<a href="#l153.78"></a><span id="l153.78" class="difflineminus">-        do_check_eq(percent, junkPercent);</span>
<a href="#l153.79"></a><span id="l153.79" class="difflineplus">+        Assert.equal(percent, junkPercent);</span>
<a href="#l153.80"></a><span id="l153.80">       else</span>
<a href="#l153.81"></a><span id="l153.81">       // Train simply returns 100</span>
<a href="#l153.82"></a><span id="l153.82" class="difflineminus">-        do_check_eq(percent, 100);</span>
<a href="#l153.83"></a><span id="l153.83" class="difflineplus">+        Assert.equal(percent, 100);</span>
<a href="#l153.84"></a><span id="l153.84">     }</span>
<a href="#l153.85"></a><span id="l153.85"> </span>
<a href="#l153.86"></a><span id="l153.86">     // checks of aTraits</span>
<a href="#l153.87"></a><span id="l153.87"> </span>
<a href="#l153.88"></a><span id="l153.88">     if (command == kForgetJ || command == kForgetT)</span>
<a href="#l153.89"></a><span id="l153.89">       // &quot;forgets&quot; with null newClassifications does not return a</span>
<a href="#l153.90"></a><span id="l153.90">       // classification</span>
<a href="#l153.91"></a><span id="l153.91" class="difflineminus">-      do_check_eq(aTraits.length, 0);</span>
<a href="#l153.92"></a><span id="l153.92" class="difflineplus">+      Assert.equal(aTraits.length, 0);</span>
<a href="#l153.93"></a><span id="l153.93">     else if (command == kClassJ || command == kClassT)</span>
<a href="#l153.94"></a><span id="l153.94">     {</span>
<a href="#l153.95"></a><span id="l153.95">       // classification just returns the tested &quot;Pro&quot; trait (junk)</span>
<a href="#l153.96"></a><span id="l153.96">       var trait = aTraits[0];</span>
<a href="#l153.97"></a><span id="l153.97" class="difflineminus">-      do_check_eq(trait, kJunkTrait);</span>
<a href="#l153.98"></a><span id="l153.98" class="difflineplus">+      Assert.equal(trait, kJunkTrait);</span>
<a href="#l153.99"></a><span id="l153.99">     }</span>
<a href="#l153.100"></a><span id="l153.100">     else</span>
<a href="#l153.101"></a><span id="l153.101">     {</span>
<a href="#l153.102"></a><span id="l153.102">       // training returns the actual trait trained</span>
<a href="#l153.103"></a><span id="l153.103">       var trait = aTraits[0];</span>
<a href="#l153.104"></a><span id="l153.104" class="difflineminus">-      do_check_eq(trait, junkPercent &lt; 90 ? kGoodTrait : kJunkTrait);</span>
<a href="#l153.105"></a><span id="l153.105" class="difflineplus">+      Assert.equal(trait, junkPercent &lt; 90 ? kGoodTrait : kJunkTrait);</span>
<a href="#l153.106"></a><span id="l153.106">     }</span>
<a href="#l153.107"></a><span id="l153.107"> </span>
<a href="#l153.108"></a><span id="l153.108">     // All done, start the next test</span>
<a href="#l153.109"></a><span id="l153.109">     startCommand();</span>
<a href="#l153.110"></a><span id="l153.110">   }</span>
<a href="#l153.111"></a><span id="l153.111"> };</span>
<a href="#l153.112"></a><span id="l153.112"> </span>
<a href="#l153.113"></a><span id="l153.113"> // start the next test command</span>
<a href="#l153.114"></a><span id="l153.114" class="difflineat">@@ -488,15 +488,15 @@ function startCommand()</span>
<a href="#l153.115"></a><span id="l153.115">       let msgCount = {};</span>
<a href="#l153.116"></a><span id="l153.116">       let nsIMsgCorpus = MailServices.junk.QueryInterface(Ci.nsIMsgCorpus);</span>
<a href="#l153.117"></a><span id="l153.117">       let tokenCount = nsIMsgCorpus.corpusCounts(null, {});</span>
<a href="#l153.118"></a><span id="l153.118">       nsIMsgCorpus.corpusCounts(kJunkTrait, msgCount);</span>
<a href="#l153.119"></a><span id="l153.119">       let junkCount = msgCount.value;</span>
<a href="#l153.120"></a><span id="l153.120">       nsIMsgCorpus.corpusCounts(kGoodTrait, msgCount);</span>
<a href="#l153.121"></a><span id="l153.121">       let goodCount = msgCount.value;</span>
<a href="#l153.122"></a><span id="l153.122">       print(&quot;tokenCount, junkCount, goodCount is &quot; + tokenCount, junkCount, goodCount);</span>
<a href="#l153.123"></a><span id="l153.123" class="difflineminus">-      do_check_eq(tokenCount, gTest.tokenCount);</span>
<a href="#l153.124"></a><span id="l153.124" class="difflineminus">-      do_check_eq(junkCount, gTest.junkCount);</span>
<a href="#l153.125"></a><span id="l153.125" class="difflineminus">-      do_check_eq(goodCount, gTest.goodCount);</span>
<a href="#l153.126"></a><span id="l153.126" class="difflineplus">+      Assert.equal(tokenCount, gTest.tokenCount);</span>
<a href="#l153.127"></a><span id="l153.127" class="difflineplus">+      Assert.equal(junkCount, gTest.junkCount);</span>
<a href="#l153.128"></a><span id="l153.128" class="difflineplus">+      Assert.equal(goodCount, gTest.goodCount);</span>
<a href="#l153.129"></a><span id="l153.129">       do_timeout(0, startCommand);</span>
<a href="#l153.130"></a><span id="l153.130">       break;</span>
<a href="#l153.131"></a><span id="l153.131">   }</span>
<a href="#l153.132"></a><span id="l153.132"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l154.1"></a><span id="l154.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js</span>
<a href="#l154.2"></a><span id="l154.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_msgCorpus.js</span>
<a href="#l154.3"></a><span id="l154.3" class="difflineat">@@ -31,102 +31,102 @@ var gTests =</span>
<a href="#l154.4"></a><span id="l154.4">   function checkLoadOnce() {</span>
<a href="#l154.5"></a><span id="l154.5">     let fileName = &quot;msgCorpus.dat&quot;;</span>
<a href="#l154.6"></a><span id="l154.6">     let file = do_get_file(&quot;resources/&quot; + fileName);</span>
<a href="#l154.7"></a><span id="l154.7">     msgCorpus.updateData(file, true);</span>
<a href="#l154.8"></a><span id="l154.8"> </span>
<a href="#l154.9"></a><span id="l154.9">     // check message counts</span>
<a href="#l154.10"></a><span id="l154.10">     let messageCount = {};</span>
<a href="#l154.11"></a><span id="l154.11">     msgCorpus.corpusCounts(1001, messageCount);</span>
<a href="#l154.12"></a><span id="l154.12" class="difflineminus">-    do_check_eq(2, messageCount.value);</span>
<a href="#l154.13"></a><span id="l154.13" class="difflineplus">+    Assert.equal(2, messageCount.value);</span>
<a href="#l154.14"></a><span id="l154.14">     msgCorpus.corpusCounts(1003, messageCount);</span>
<a href="#l154.15"></a><span id="l154.15" class="difflineminus">-    do_check_eq(1, messageCount.value);</span>
<a href="#l154.16"></a><span id="l154.16" class="difflineplus">+    Assert.equal(1, messageCount.value);</span>
<a href="#l154.17"></a><span id="l154.17"> </span>
<a href="#l154.18"></a><span id="l154.18">     for (let i = 0; i &lt; tokenData.length; i++) {</span>
<a href="#l154.19"></a><span id="l154.19">       let id = tokenData[i][0];</span>
<a href="#l154.20"></a><span id="l154.20">       let count = tokenData[i][1];</span>
<a href="#l154.21"></a><span id="l154.21">       let word = tokenData[i][2];</span>
<a href="#l154.22"></a><span id="l154.22" class="difflineminus">-      do_check_eq(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.23"></a><span id="l154.23" class="difflineplus">+      Assert.equal(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.24"></a><span id="l154.24">     }</span>
<a href="#l154.25"></a><span id="l154.25">   },</span>
<a href="#l154.26"></a><span id="l154.26">   function checkLoadTwice() {</span>
<a href="#l154.27"></a><span id="l154.27">     let fileName = &quot;msgCorpus.dat&quot;;</span>
<a href="#l154.28"></a><span id="l154.28">     let file = do_get_file(&quot;resources/&quot; + fileName);</span>
<a href="#l154.29"></a><span id="l154.29">     msgCorpus.updateData(file, true);</span>
<a href="#l154.30"></a><span id="l154.30"> </span>
<a href="#l154.31"></a><span id="l154.31">     // check message counts</span>
<a href="#l154.32"></a><span id="l154.32">     let messageCount = {};</span>
<a href="#l154.33"></a><span id="l154.33">     msgCorpus.corpusCounts(1001, messageCount);</span>
<a href="#l154.34"></a><span id="l154.34" class="difflineminus">-    do_check_eq(4, messageCount.value);</span>
<a href="#l154.35"></a><span id="l154.35" class="difflineplus">+    Assert.equal(4, messageCount.value);</span>
<a href="#l154.36"></a><span id="l154.36">     msgCorpus.corpusCounts(1003, messageCount);</span>
<a href="#l154.37"></a><span id="l154.37" class="difflineminus">-    do_check_eq(2, messageCount.value);</span>
<a href="#l154.38"></a><span id="l154.38" class="difflineplus">+    Assert.equal(2, messageCount.value);</span>
<a href="#l154.39"></a><span id="l154.39"> </span>
<a href="#l154.40"></a><span id="l154.40">     for (let i = 0; i &lt; tokenData.length; i++) {</span>
<a href="#l154.41"></a><span id="l154.41">       let id = tokenData[i][0];</span>
<a href="#l154.42"></a><span id="l154.42">       let count = 2 * tokenData[i][1];</span>
<a href="#l154.43"></a><span id="l154.43">       let word = tokenData[i][2];</span>
<a href="#l154.44"></a><span id="l154.44" class="difflineminus">-      do_check_eq(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.45"></a><span id="l154.45" class="difflineplus">+      Assert.equal(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.46"></a><span id="l154.46">     }</span>
<a href="#l154.47"></a><span id="l154.47">   },</span>
<a href="#l154.48"></a><span id="l154.48">   // remap the ids in the file to different local ids</span>
<a href="#l154.49"></a><span id="l154.49">   function loadWithRemap() {</span>
<a href="#l154.50"></a><span id="l154.50">     let fileName = &quot;msgCorpus.dat&quot;;</span>
<a href="#l154.51"></a><span id="l154.51">     let file = do_get_file(&quot;resources/&quot; + fileName);</span>
<a href="#l154.52"></a><span id="l154.52">     msgCorpus.updateData(file, true, 2, [1001, 1003], [1, 3]);</span>
<a href="#l154.53"></a><span id="l154.53"> </span>
<a href="#l154.54"></a><span id="l154.54">     for (let i = 0; i &lt; tokenData.length; i++) {</span>
<a href="#l154.55"></a><span id="l154.55">       let id = tokenData[i][0] - 1000;</span>
<a href="#l154.56"></a><span id="l154.56">       let count = tokenData[i][1];</span>
<a href="#l154.57"></a><span id="l154.57">       let word = tokenData[i][2];</span>
<a href="#l154.58"></a><span id="l154.58" class="difflineminus">-      do_check_eq(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.59"></a><span id="l154.59" class="difflineplus">+      Assert.equal(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.60"></a><span id="l154.60">     }</span>
<a href="#l154.61"></a><span id="l154.61">   },</span>
<a href="#l154.62"></a><span id="l154.62">   // test removing data</span>
<a href="#l154.63"></a><span id="l154.63">   function checkRemove() {</span>
<a href="#l154.64"></a><span id="l154.64">     let fileName = &quot;msgCorpus.dat&quot;;</span>
<a href="#l154.65"></a><span id="l154.65">     let file = do_get_file(&quot;resources/&quot; + fileName);</span>
<a href="#l154.66"></a><span id="l154.66">     msgCorpus.updateData(file, false);</span>
<a href="#l154.67"></a><span id="l154.67"> </span>
<a href="#l154.68"></a><span id="l154.68">     // check message counts</span>
<a href="#l154.69"></a><span id="l154.69">     let messageCount = {};</span>
<a href="#l154.70"></a><span id="l154.70">     msgCorpus.corpusCounts(1001, messageCount);</span>
<a href="#l154.71"></a><span id="l154.71" class="difflineminus">-    do_check_eq(2, messageCount.value);</span>
<a href="#l154.72"></a><span id="l154.72" class="difflineplus">+    Assert.equal(2, messageCount.value);</span>
<a href="#l154.73"></a><span id="l154.73">     msgCorpus.corpusCounts(1003, messageCount);</span>
<a href="#l154.74"></a><span id="l154.74" class="difflineminus">-    do_check_eq(1, messageCount.value);</span>
<a href="#l154.75"></a><span id="l154.75" class="difflineplus">+    Assert.equal(1, messageCount.value);</span>
<a href="#l154.76"></a><span id="l154.76"> </span>
<a href="#l154.77"></a><span id="l154.77">     for (let i = 0; i &lt; tokenData.length; i++) {</span>
<a href="#l154.78"></a><span id="l154.78">       let id = tokenData[i][0];</span>
<a href="#l154.79"></a><span id="l154.79">       let count = tokenData[i][1];</span>
<a href="#l154.80"></a><span id="l154.80">       let word = tokenData[i][2];</span>
<a href="#l154.81"></a><span id="l154.81" class="difflineminus">-      do_check_eq(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.82"></a><span id="l154.82" class="difflineplus">+      Assert.equal(count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.83"></a><span id="l154.83">     }</span>
<a href="#l154.84"></a><span id="l154.84">   },</span>
<a href="#l154.85"></a><span id="l154.85">   // test clearing a trait</span>
<a href="#l154.86"></a><span id="l154.86">   function checkClear() {</span>
<a href="#l154.87"></a><span id="l154.87">     let messageCountObject = {};</span>
<a href="#l154.88"></a><span id="l154.88">     /*</span>
<a href="#l154.89"></a><span id="l154.89">     msgCorpus.corpusCounts(1001, messageCountObject);</span>
<a href="#l154.90"></a><span id="l154.90">     let v1001 = messageCountObject.value;</span>
<a href="#l154.91"></a><span id="l154.91">     msgCorpus.corpusCounts(1003, messageCountObject);</span>
<a href="#l154.92"></a><span id="l154.92">     let v1003 = messageCountObject.value;</span>
<a href="#l154.93"></a><span id="l154.93">     dump(&quot;pre-clear value &quot; + v1001 + &quot; &quot; + v1003 + &quot;\n&quot;);</span>
<a href="#l154.94"></a><span id="l154.94">     /**/</span>
<a href="#l154.95"></a><span id="l154.95">     msgCorpus.clearTrait(1001);</span>
<a href="#l154.96"></a><span id="l154.96">     // check that the message count is zero</span>
<a href="#l154.97"></a><span id="l154.97">     msgCorpus.corpusCounts(1001, messageCountObject);</span>
<a href="#l154.98"></a><span id="l154.98" class="difflineminus">-    do_check_eq(0, messageCountObject.value);</span>
<a href="#l154.99"></a><span id="l154.99" class="difflineplus">+    Assert.equal(0, messageCountObject.value);</span>
<a href="#l154.100"></a><span id="l154.100">     // but the other trait should still have counts</span>
<a href="#l154.101"></a><span id="l154.101">     msgCorpus.corpusCounts(1003, messageCountObject);</span>
<a href="#l154.102"></a><span id="l154.102" class="difflineminus">-    do_check_eq(1, messageCountObject.value);</span>
<a href="#l154.103"></a><span id="l154.103" class="difflineplus">+    Assert.equal(1, messageCountObject.value);</span>
<a href="#l154.104"></a><span id="l154.104">     // check that token count was cleared</span>
<a href="#l154.105"></a><span id="l154.105">     for (let i = 0; i &lt; tokenData.length; i++) {</span>
<a href="#l154.106"></a><span id="l154.106">       let id = tokenData[i][0];</span>
<a href="#l154.107"></a><span id="l154.107">       let count = tokenData[i][1];</span>
<a href="#l154.108"></a><span id="l154.108">       let word = tokenData[i][2];</span>
<a href="#l154.109"></a><span id="l154.109" class="difflineminus">-      do_check_eq(id == 1001 ? 0 : count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.110"></a><span id="l154.110" class="difflineplus">+      Assert.equal(id == 1001 ? 0 : count, msgCorpus.getTokenCount(word, id));</span>
<a href="#l154.111"></a><span id="l154.111">     }</span>
<a href="#l154.112"></a><span id="l154.112">   },</span>
<a href="#l154.113"></a><span id="l154.113"> </span>
<a href="#l154.114"></a><span id="l154.114"> ]</span>
<a href="#l154.115"></a><span id="l154.115"> </span>
<a href="#l154.116"></a><span id="l154.116"> // main test</span>
<a href="#l154.117"></a><span id="l154.117"> function run_test()</span>
<a href="#l154.118"></a><span id="l154.118"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l155.1"></a><span id="l155.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js</span>
<a href="#l155.2"></a><span id="l155.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_traitAliases.js</span>
<a href="#l155.3"></a><span id="l155.3" class="difflineat">@@ -107,17 +107,17 @@ var listener =</span>
<a href="#l155.4"></a><span id="l155.4"> {</span>
<a href="#l155.5"></a><span id="l155.5">   //nsIMsgTraitClassificationListener implementation</span>
<a href="#l155.6"></a><span id="l155.6">   onMessageTraitsClassified: function(aMsgURI, {}, aTraits, aPercents)</span>
<a href="#l155.7"></a><span id="l155.7">   {</span>
<a href="#l155.8"></a><span id="l155.8">     //print(&quot;Message URI is &quot; + aMsgURI);</span>
<a href="#l155.9"></a><span id="l155.9">     if (!aMsgURI)</span>
<a href="#l155.10"></a><span id="l155.10">       return; //ignore end-of-batch signal</span>
<a href="#l155.11"></a><span id="l155.11"> </span>
<a href="#l155.12"></a><span id="l155.12" class="difflineminus">-    do_check_eq(aPercents[0], gTest.percent)</span>
<a href="#l155.13"></a><span id="l155.13" class="difflineplus">+    Assert.equal(aPercents[0], gTest.percent)</span>
<a href="#l155.14"></a><span id="l155.14">     // All done, start the next test</span>
<a href="#l155.15"></a><span id="l155.15">     startCommand();</span>
<a href="#l155.16"></a><span id="l155.16">   },</span>
<a href="#l155.17"></a><span id="l155.17"> };</span>
<a href="#l155.18"></a><span id="l155.18"> </span>
<a href="#l155.19"></a><span id="l155.19"> // start the next test command</span>
<a href="#l155.20"></a><span id="l155.20"> function startCommand()</span>
<a href="#l155.21"></a><span id="l155.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l156.1"></a><span id="l156.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js</span>
<a href="#l156.2"></a><span id="l156.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_traits.js</span>
<a href="#l156.3"></a><span id="l156.3" class="difflineat">@@ -117,23 +117,23 @@ var listener =</span>
<a href="#l156.4"></a><span id="l156.4">   {</span>
<a href="#l156.5"></a><span id="l156.5">     //print(&quot;Message URI is &quot; + aMsgURI);</span>
<a href="#l156.6"></a><span id="l156.6">     if (!aMsgURI)</span>
<a href="#l156.7"></a><span id="l156.7">       return; //ignore end-of-batch signal</span>
<a href="#l156.8"></a><span id="l156.8"> </span>
<a href="#l156.9"></a><span id="l156.9">     switch (gTest.command)</span>
<a href="#l156.10"></a><span id="l156.10">     {</span>
<a href="#l156.11"></a><span id="l156.11">       case kClass:</span>
<a href="#l156.12"></a><span id="l156.12" class="difflineminus">-        do_check_eq(gTest.files[gTest.currentIndex], aMsgURI);</span>
<a href="#l156.13"></a><span id="l156.13" class="difflineplus">+        Assert.equal(gTest.files[gTest.currentIndex], aMsgURI);</span>
<a href="#l156.14"></a><span id="l156.14">         var currentPercents = gTest.percents[gTest.currentIndex];</span>
<a href="#l156.15"></a><span id="l156.15">         for (var i = 0; i &lt; currentPercents.length; i++)</span>
<a href="#l156.16"></a><span id="l156.16">         {</span>
<a href="#l156.17"></a><span id="l156.17">           //print(&quot;expecting score &quot; + currentPercents[i] +</span>
<a href="#l156.18"></a><span id="l156.18">           //      &quot; got score &quot; + aPercents[i]);</span>
<a href="#l156.19"></a><span id="l156.19" class="difflineminus">-          do_check_eq(currentPercents[i], aPercents[i]);</span>
<a href="#l156.20"></a><span id="l156.20" class="difflineplus">+          Assert.equal(currentPercents[i], aPercents[i]);</span>
<a href="#l156.21"></a><span id="l156.21">         }</span>
<a href="#l156.22"></a><span id="l156.22">         gTest.currentIndex++;</span>
<a href="#l156.23"></a><span id="l156.23">         break;</span>
<a href="#l156.24"></a><span id="l156.24"> </span>
<a href="#l156.25"></a><span id="l156.25">       case kTrain:</span>
<a href="#l156.26"></a><span id="l156.26">         // We tested this some in test_junkAsTraits.js, so let's not bother</span>
<a href="#l156.27"></a><span id="l156.27">       default:</span>
<a href="#l156.28"></a><span id="l156.28">         break;</span>
<a href="#l156.29"></a><span id="l156.29" class="difflineat">@@ -146,23 +146,23 @@ var listener =</span>
<a href="#l156.30"></a><span id="l156.30">                                   aTokenPercents, aRunningPercents)</span>
<a href="#l156.31"></a><span id="l156.31">   {</span>
<a href="#l156.32"></a><span id="l156.32">     print(&quot;Details for &quot; + aMsgURI);</span>
<a href="#l156.33"></a><span id="l156.33">     for (var i = 0; i &lt; aTokenString.length; i++)</span>
<a href="#l156.34"></a><span id="l156.34">     {</span>
<a href="#l156.35"></a><span id="l156.35">       print(&quot;Percent &quot; + aTokenPercents[i] +</span>
<a href="#l156.36"></a><span id="l156.36">             &quot; Running &quot; + aRunningPercents[i] +</span>
<a href="#l156.37"></a><span id="l156.37">             &quot; Token &quot; + aTokenString[i]);</span>
<a href="#l156.38"></a><span id="l156.38" class="difflineminus">-      do_check_true(aTokenString[i] in gTest.percents);</span>
<a href="#l156.39"></a><span id="l156.39" class="difflineplus">+      Assert.ok(aTokenString[i] in gTest.percents);</span>
<a href="#l156.40"></a><span id="l156.40"> </span>
<a href="#l156.41"></a><span id="l156.41" class="difflineminus">-      do_check_eq(gTest.percents[aTokenString[i]], aTokenPercents[i]);</span>
<a href="#l156.42"></a><span id="l156.42" class="difflineminus">-      do_check_eq(gTest.runnings[i], aRunningPercents[i]);</span>
<a href="#l156.43"></a><span id="l156.43" class="difflineplus">+      Assert.equal(gTest.percents[aTokenString[i]], aTokenPercents[i]);</span>
<a href="#l156.44"></a><span id="l156.44" class="difflineplus">+      Assert.equal(gTest.runnings[i], aRunningPercents[i]);</span>
<a href="#l156.45"></a><span id="l156.45">       delete gTest.percents[aTokenString[i]];</span>
<a href="#l156.46"></a><span id="l156.46">     }</span>
<a href="#l156.47"></a><span id="l156.47" class="difflineminus">-    do_check_eq(Object.keys(gTest.percents).length, 0);</span>
<a href="#l156.48"></a><span id="l156.48" class="difflineplus">+    Assert.equal(Object.keys(gTest.percents).length, 0);</span>
<a href="#l156.49"></a><span id="l156.49">     gTest.currentIndex++;</span>
<a href="#l156.50"></a><span id="l156.50">     startCommand();</span>
<a href="#l156.51"></a><span id="l156.51">   }</span>
<a href="#l156.52"></a><span id="l156.52"> };</span>
<a href="#l156.53"></a><span id="l156.53"> </span>
<a href="#l156.54"></a><span id="l156.54"> // start the next test command</span>
<a href="#l156.55"></a><span id="l156.55"> function startCommand()</span>
<a href="#l156.56"></a><span id="l156.56"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l157.1"></a><span id="l157.1" class="difflineminus">--- a/mailnews/extensions/mdn/test/unit/test_askuser.js</span>
<a href="#l157.2"></a><span id="l157.2" class="difflineplus">+++ b/mailnews/extensions/mdn/test/unit/test_askuser.js</span>
<a href="#l157.3"></a><span id="l157.3" class="difflineat">@@ -41,15 +41,15 @@ function run_test()</span>
<a href="#l157.4"></a><span id="l157.4">   // Everything looks good so far, let's generate the MDN response.</span>
<a href="#l157.5"></a><span id="l157.5">   var mdnGenerator = Components.classes[&quot;@mozilla.org/messenger-mdn/generator;1&quot;]</span>
<a href="#l157.6"></a><span id="l157.6">                                .createInstance(Components.interfaces.nsIMsgMdnGenerator);</span>
<a href="#l157.7"></a><span id="l157.7">   const MDN_DISPOSE_TYPE_DISPLAYED = 0;</span>
<a href="#l157.8"></a><span id="l157.8"> </span>
<a href="#l157.9"></a><span id="l157.9">   Services.prefs.setIntPref(&quot;mail.mdn.report.outside_domain&quot;, 1);</span>
<a href="#l157.10"></a><span id="l157.10">   var askUser = mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder,</span>
<a href="#l157.11"></a><span id="l157.11">                                      msgHdr.messageKey, mimeHdr, false);</span>
<a href="#l157.12"></a><span id="l157.12" class="difflineminus">-  do_check_false(askUser);</span>
<a href="#l157.13"></a><span id="l157.13" class="difflineplus">+  Assert.ok(!askUser);</span>
<a href="#l157.14"></a><span id="l157.14"> </span>
<a href="#l157.15"></a><span id="l157.15">   Services.prefs.setIntPref(&quot;mail.mdn.report.outside_domain&quot;, 2);</span>
<a href="#l157.16"></a><span id="l157.16">   var askUser = mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder,</span>
<a href="#l157.17"></a><span id="l157.17">                                      msgHdr.messageKey, mimeHdr, false);</span>
<a href="#l157.18"></a><span id="l157.18" class="difflineminus">-  do_check_true(askUser);</span>
<a href="#l157.19"></a><span id="l157.19" class="difflineplus">+  Assert.ok(askUser);</span>
<a href="#l157.20"></a><span id="l157.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l158.1"></a><span id="l158.1" class="difflineminus">--- a/mailnews/extensions/mdn/test/unit/test_mdnFlags.js</span>
<a href="#l158.2"></a><span id="l158.2" class="difflineplus">+++ b/mailnews/extensions/mdn/test/unit/test_mdnFlags.js</span>
<a href="#l158.3"></a><span id="l158.3" class="difflineat">@@ -47,11 +47,11 @@ function run_test()</span>
<a href="#l158.4"></a><span id="l158.4">   // Everything looks good so far, let's generate the MDN response.</span>
<a href="#l158.5"></a><span id="l158.5">   var mdnGenerator = Components.classes[&quot;@mozilla.org/messenger-mdn/generator;1&quot;]</span>
<a href="#l158.6"></a><span id="l158.6">                                .createInstance(Components.interfaces.nsIMsgMdnGenerator);</span>
<a href="#l158.7"></a><span id="l158.7">   const MDN_DISPOSE_TYPE_DISPLAYED = 0;</span>
<a href="#l158.8"></a><span id="l158.8"> </span>
<a href="#l158.9"></a><span id="l158.9">   mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder,</span>
<a href="#l158.10"></a><span id="l158.10">                        msgHdr.messageKey, mimeHdr, false);</span>
<a href="#l158.11"></a><span id="l158.11">   mdnGenerator.userDeclined();</span>
<a href="#l158.12"></a><span id="l158.12" class="difflineminus">-  do_check_neq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.MDNReportSent, 0);</span>
<a href="#l158.13"></a><span id="l158.13" class="difflineminus">-  do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.MDNReportNeeded, 0);</span>
<a href="#l158.14"></a><span id="l158.14" class="difflineplus">+  Assert.notEqual(msgHdr.flags &amp; Ci.nsMsgMessageFlags.MDNReportSent, 0);</span>
<a href="#l158.15"></a><span id="l158.15" class="difflineplus">+  Assert.equal(msgHdr.flags &amp; Ci.nsMsgMessageFlags.MDNReportNeeded, 0);</span>
<a href="#l158.16"></a><span id="l158.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l159.1"></a><span id="l159.1" class="difflineminus">--- a/mailnews/imap/test/unit/head_server.js</span>
<a href="#l159.2"></a><span id="l159.2" class="difflineplus">+++ b/mailnews/imap/test/unit/head_server.js</span>
<a href="#l159.3"></a><span id="l159.3" class="difflineat">@@ -86,17 +86,17 @@ function do_check_transaction(fromServer</span>
<a href="#l159.4"></a><span id="l159.4">     if (withParams)</span>
<a href="#l159.5"></a><span id="l159.5">       realTransaction.push(line.substr(components[0].length + 1));</span>
<a href="#l159.6"></a><span id="l159.6">     else if (components[1] == &quot;authenticate&quot;)</span>
<a href="#l159.7"></a><span id="l159.7">       realTransaction.push(components[1] + &quot; &quot; + components[2].toUpperCase());</span>
<a href="#l159.8"></a><span id="l159.8">     else</span>
<a href="#l159.9"></a><span id="l159.9">       realTransaction.push(components[1]);</span>
<a href="#l159.10"></a><span id="l159.10">   }</span>
<a href="#l159.11"></a><span id="l159.11"> </span>
<a href="#l159.12"></a><span id="l159.12" class="difflineminus">-  do_check_eq(realTransaction.join(&quot;, &quot;), expected.join(&quot;, &quot;));</span>
<a href="#l159.13"></a><span id="l159.13" class="difflineplus">+  Assert.equal(realTransaction.join(&quot;, &quot;), expected.join(&quot;, &quot;));</span>
<a href="#l159.14"></a><span id="l159.14"> }</span>
<a href="#l159.15"></a><span id="l159.15"> </span>
<a href="#l159.16"></a><span id="l159.16"> /**</span>
<a href="#l159.17"></a><span id="l159.17">  * add a simple message to the IMAP pump mailbox</span>
<a href="#l159.18"></a><span id="l159.18">  */</span>
<a href="#l159.19"></a><span id="l159.19"> function addImapMessage()</span>
<a href="#l159.20"></a><span id="l159.20"> {</span>
<a href="#l159.21"></a><span id="l159.21">   let messages = [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l160.1"></a><span id="l160.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l160.2"></a><span id="l160.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l160.3"></a><span id="l160.3" class="difflineat">@@ -36,19 +36,19 @@ var tests = [</span>
<a href="#l160.4"></a><span id="l160.4">     if (enumerator) {</span>
<a href="#l160.5"></a><span id="l160.5">       let now = new Date();</span>
<a href="#l160.6"></a><span id="l160.6">       let dateInSeconds = now.getSeconds();</span>
<a href="#l160.7"></a><span id="l160.7">       let cutOffDateInSeconds = dateInSeconds - (5 * 60 * 24);</span>
<a href="#l160.8"></a><span id="l160.8">       while (enumerator.hasMoreElements()) {</span>
<a href="#l160.9"></a><span id="l160.9">         let header = enumerator.getNext();</span>
<a href="#l160.10"></a><span id="l160.10">         if (header instanceof Components.interfaces.nsIMsgDBHdr) {</span>
<a href="#l160.11"></a><span id="l160.11">           if (header.dateInSeconds &lt; cutOffDateInSeconds)</span>
<a href="#l160.12"></a><span id="l160.12" class="difflineminus">-            do_check_eq(header.getStringProperty(&quot;pendingRemoval&quot;), &quot;1&quot;);</span>
<a href="#l160.13"></a><span id="l160.13" class="difflineplus">+            Assert.equal(header.getStringProperty(&quot;pendingRemoval&quot;), &quot;1&quot;);</span>
<a href="#l160.14"></a><span id="l160.14">           else</span>
<a href="#l160.15"></a><span id="l160.15" class="difflineminus">-            do_check_eq(header.getStringProperty(&quot;pendingRemoval&quot;), &quot;&quot;);</span>
<a href="#l160.16"></a><span id="l160.16" class="difflineplus">+            Assert.equal(header.getStringProperty(&quot;pendingRemoval&quot;), &quot;&quot;);</span>
<a href="#l160.17"></a><span id="l160.17">         }</span>
<a href="#l160.18"></a><span id="l160.18">       }</span>
<a href="#l160.19"></a><span id="l160.19">     }</span>
<a href="#l160.20"></a><span id="l160.20">   },</span>
<a href="#l160.21"></a><span id="l160.21">   teardown</span>
<a href="#l160.22"></a><span id="l160.22"> ];</span>
<a href="#l160.23"></a><span id="l160.23"> </span>
<a href="#l160.24"></a><span id="l160.24"> function setup() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l161.1"></a><span id="l161.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l161.2"></a><span id="l161.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l161.3"></a><span id="l161.3" class="difflineat">@@ -43,19 +43,19 @@ function* downloadAllForOffline() {</span>
<a href="#l161.4"></a><span id="l161.4">   yield false;</span>
<a href="#l161.5"></a><span id="l161.5"> }</span>
<a href="#l161.6"></a><span id="l161.6"> </span>
<a href="#l161.7"></a><span id="l161.7"> function checkBccs() {</span>
<a href="#l161.8"></a><span id="l161.8">   // locate the new message by enumerating through the database</span>
<a href="#l161.9"></a><span id="l161.9">   let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l161.10"></a><span id="l161.10">   while(enumerator.hasMoreElements()) {</span>
<a href="#l161.11"></a><span id="l161.11">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l161.12"></a><span id="l161.12" class="difflineminus">-    do_check_true(hdr.bccList.includes(&quot;Another Person&quot;));</span>
<a href="#l161.13"></a><span id="l161.13" class="difflineminus">-    do_check_true(hdr.bccList.includes(&quot;&lt;u1@example.com&gt;&quot;));</span>
<a href="#l161.14"></a><span id="l161.14" class="difflineminus">-    do_check_false(hdr.bccList.includes(&quot;IDoNotExist&quot;));</span>
<a href="#l161.15"></a><span id="l161.15" class="difflineplus">+    Assert.ok(hdr.bccList.includes(&quot;Another Person&quot;));</span>
<a href="#l161.16"></a><span id="l161.16" class="difflineplus">+    Assert.ok(hdr.bccList.includes(&quot;&lt;u1@example.com&gt;&quot;));</span>
<a href="#l161.17"></a><span id="l161.17" class="difflineplus">+    Assert.ok(!hdr.bccList.includes(&quot;IDoNotExist&quot;));</span>
<a href="#l161.18"></a><span id="l161.18">   }</span>
<a href="#l161.19"></a><span id="l161.19"> }</span>
<a href="#l161.20"></a><span id="l161.20"> </span>
<a href="#l161.21"></a><span id="l161.21"> function teardown() {</span>
<a href="#l161.22"></a><span id="l161.22">   teardownIMAPPump();</span>
<a href="#l161.23"></a><span id="l161.23"> }</span>
<a href="#l161.24"></a><span id="l161.24"> </span>
<a href="#l161.25"></a><span id="l161.25"> function run_test() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l162.1"></a><span id="l162.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l162.2"></a><span id="l162.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l162.3"></a><span id="l162.3" class="difflineat">@@ -54,17 +54,17 @@ function* setup() {</span>
<a href="#l162.4"></a><span id="l162.4">    */</span>
<a href="#l162.5"></a><span id="l162.5">   gIMAPService.SaveMessageToDisk(&quot;imap-message://user@localhost/INBOX#&quot;</span>
<a href="#l162.6"></a><span id="l162.6">                                  + (IMAPPump.mailbox.uidnext-1), gSavedMsgFile,</span>
<a href="#l162.7"></a><span id="l162.7">                                  false, asyncUrlListener, {}, true, null);</span>
<a href="#l162.8"></a><span id="l162.8">   yield false;</span>
<a href="#l162.9"></a><span id="l162.9"> }</span>
<a href="#l162.10"></a><span id="l162.10"> </span>
<a href="#l162.11"></a><span id="l162.11"> function checkSavedMessage() {</span>
<a href="#l162.12"></a><span id="l162.12" class="difflineminus">-  do_check_eq(IOUtils.loadFileToString(gMsgFile),</span>
<a href="#l162.13"></a><span id="l162.13" class="difflineplus">+  Assert.equal(IOUtils.loadFileToString(gMsgFile),</span>
<a href="#l162.14"></a><span id="l162.14"> 	      IOUtils.loadFileToString(gSavedMsgFile));</span>
<a href="#l162.15"></a><span id="l162.15"> }</span>
<a href="#l162.16"></a><span id="l162.16"> </span>
<a href="#l162.17"></a><span id="l162.17"> function teardown() {</span>
<a href="#l162.18"></a><span id="l162.18">   try {</span>
<a href="#l162.19"></a><span id="l162.19">     gSavedMsgFile.remove(false);</span>
<a href="#l162.20"></a><span id="l162.20">   }</span>
<a href="#l162.21"></a><span id="l162.21">   catch (ex) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l163.1"></a><span id="l163.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l163.2"></a><span id="l163.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l163.3"></a><span id="l163.3" class="difflineat">@@ -81,18 +81,18 @@ function* verifyContentLength()</span>
<a href="#l163.4"></a><span id="l163.4"> </span>
<a href="#l163.5"></a><span id="l163.5">   // Read all the contents</span>
<a href="#l163.6"></a><span id="l163.6">   channel.asyncOpen(gStreamListener, null);</span>
<a href="#l163.7"></a><span id="l163.7">   yield false;</span>
<a href="#l163.8"></a><span id="l163.8">   // Now check whether our stream listener got the right bytes</span>
<a href="#l163.9"></a><span id="l163.9">   // First, clean up line endings to avoid CRLF vs. LF differences</span>
<a href="#l163.10"></a><span id="l163.10">   let origData = IOUtils.loadFileToString(gFile).replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l163.11"></a><span id="l163.11">   let streamData = gStreamListener._data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l163.12"></a><span id="l163.12" class="difflineminus">-  do_check_eq(origData.length, streamData.length);</span>
<a href="#l163.13"></a><span id="l163.13" class="difflineminus">-  do_check_eq(origData, streamData);</span>
<a href="#l163.14"></a><span id="l163.14" class="difflineplus">+  Assert.equal(origData.length, streamData.length);</span>
<a href="#l163.15"></a><span id="l163.15" class="difflineplus">+  Assert.equal(origData, streamData);</span>
<a href="#l163.16"></a><span id="l163.16"> </span>
<a href="#l163.17"></a><span id="l163.17">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l163.18"></a><span id="l163.18">   // let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l163.19"></a><span id="l163.19">   //                                        null, null);</span>
<a href="#l163.20"></a><span id="l163.20">   // let attachmentChannel = Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l163.21"></a><span id="l163.21">   //                                                        null,</span>
<a href="#l163.22"></a><span id="l163.22">   //                                                        Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l163.23"></a><span id="l163.23">   //                                                        null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l164.1"></a><span id="l164.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l164.2"></a><span id="l164.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l164.3"></a><span id="l164.3" class="difflineat">@@ -75,17 +75,17 @@ function checkOfflineStore(prevOfflineSt</span>
<a href="#l164.4"></a><span id="l164.4">       // starts with &quot;From &quot; - otherwise, it returns an error.</span>
<a href="#l164.5"></a><span id="l164.5">       if (header instanceof Components.interfaces.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l164.6"></a><span id="l164.6">          (header.flags &amp; Ci.nsMsgMessageFlags.Offline))</span>
<a href="#l164.7"></a><span id="l164.7">         IMAPPump.inbox.getOfflineFileStream(header.messageKey, offset, size).close();</span>
<a href="#l164.8"></a><span id="l164.8">     }</span>
<a href="#l164.9"></a><span id="l164.9">   }</span>
<a href="#l164.10"></a><span id="l164.10">   // check that the offline store shrunk by at least 100 bytes.</span>
<a href="#l164.11"></a><span id="l164.11">   // (exact calculation might be fragile).</span>
<a href="#l164.12"></a><span id="l164.12" class="difflineminus">-  do_check_true(prevOfflineStoreSize &gt; IMAPPump.inbox.filePath.fileSize + 100);</span>
<a href="#l164.13"></a><span id="l164.13" class="difflineplus">+  Assert.ok(prevOfflineStoreSize &gt; IMAPPump.inbox.filePath.fileSize + 100);</span>
<a href="#l164.14"></a><span id="l164.14"> }</span>
<a href="#l164.15"></a><span id="l164.15"> </span>
<a href="#l164.16"></a><span id="l164.16"> var tests = [</span>
<a href="#l164.17"></a><span id="l164.17">   setup,</span>
<a href="#l164.18"></a><span id="l164.18">   function* downloadForOffline() {</span>
<a href="#l164.19"></a><span id="l164.19">     // ...and download for offline use.</span>
<a href="#l164.20"></a><span id="l164.20">     dump(&quot;Downloading for offline use\n&quot;);</span>
<a href="#l164.21"></a><span id="l164.21">     IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l164.22"></a><span id="l164.22" class="difflineat">@@ -108,17 +108,17 @@ var tests = [</span>
<a href="#l164.23"></a><span id="l164.23">     // compact the offline store.</span>
<a href="#l164.24"></a><span id="l164.24">     IMAPPump.inbox.compact(asyncUrlListener, gDummyMsgWindow);</span>
<a href="#l164.25"></a><span id="l164.25">     yield false;</span>
<a href="#l164.26"></a><span id="l164.26">   },</span>
<a href="#l164.27"></a><span id="l164.27">   function* deleteOneMessage() {</span>
<a href="#l164.28"></a><span id="l164.28">     // check that nstmp file has been cleaned up.</span>
<a href="#l164.29"></a><span id="l164.29">     let tmpFile = gRootFolder.filePath;</span>
<a href="#l164.30"></a><span id="l164.30">     tmpFile.append(&quot;nstmp&quot;);</span>
<a href="#l164.31"></a><span id="l164.31" class="difflineminus">-    do_check_false(tmpFile.exists());</span>
<a href="#l164.32"></a><span id="l164.32" class="difflineplus">+    Assert.ok(!tmpFile.exists());</span>
<a href="#l164.33"></a><span id="l164.33">     dump(&quot;deleting one message\n&quot;);</span>
<a href="#l164.34"></a><span id="l164.34">     IMAPPump.incomingServer.deleteModel = Ci.nsMsgImapDeleteModels.MoveToTrash;</span>
<a href="#l164.35"></a><span id="l164.35">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l164.36"></a><span id="l164.36">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l164.37"></a><span id="l164.37">     array.appendElement(msgHdr);</span>
<a href="#l164.38"></a><span id="l164.38">     IMAPPump.inbox.deleteMessages(array, null, false, true, CopyListener, false);</span>
<a href="#l164.39"></a><span id="l164.39">     let trashFolder = gRootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l164.40"></a><span id="l164.40">     // hack to force uid validity to get initialized for trash.</span>
<a href="#l164.41"></a><span id="l164.41" class="difflineat">@@ -141,22 +141,22 @@ var tests = [</span>
<a href="#l164.42"></a><span id="l164.42">     IMAPPump.inbox.markPendingRemoval(msgHdr, true);</span>
<a href="#l164.43"></a><span id="l164.43">     gImapInboxOfflineStoreSize = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l164.44"></a><span id="l164.44">     gRootFolder.compactAll(asyncUrlListener, null, true);</span>
<a href="#l164.45"></a><span id="l164.45">     yield false;</span>
<a href="#l164.46"></a><span id="l164.46">   },</span>
<a href="#l164.47"></a><span id="l164.47">   function* checkCompactionResult() {</span>
<a href="#l164.48"></a><span id="l164.48">     let tmpFile = gRootFolder.filePath;</span>
<a href="#l164.49"></a><span id="l164.49">     tmpFile.append(&quot;nstmp&quot;);</span>
<a href="#l164.50"></a><span id="l164.50" class="difflineminus">-    do_check_false(tmpFile.exists());</span>
<a href="#l164.51"></a><span id="l164.51" class="difflineplus">+    Assert.ok(!tmpFile.exists());</span>
<a href="#l164.52"></a><span id="l164.52">     checkOfflineStore(gImapInboxOfflineStoreSize);</span>
<a href="#l164.53"></a><span id="l164.53">     asyncUrlListener.OnStopRunningUrl(null, 0);</span>
<a href="#l164.54"></a><span id="l164.54">     yield false;</span>
<a href="#l164.55"></a><span id="l164.55">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l164.56"></a><span id="l164.56" class="difflineminus">-    do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Offline, 0);</span>
<a href="#l164.57"></a><span id="l164.57" class="difflineplus">+    Assert.equal(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Offline, 0);</span>
<a href="#l164.58"></a><span id="l164.58">   },</span>
<a href="#l164.59"></a><span id="l164.59">   teardown</span>
<a href="#l164.60"></a><span id="l164.60"> ];</span>
<a href="#l164.61"></a><span id="l164.61"> </span>
<a href="#l164.62"></a><span id="l164.62"> function setup() {</span>
<a href="#l164.63"></a><span id="l164.63">   setupIMAPPump();</span>
<a href="#l164.64"></a><span id="l164.64"> </span>
<a href="#l164.65"></a><span id="l164.65">   gRootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l164.66"></a><span id="l164.66" class="difflineat">@@ -190,17 +190,17 @@ var CopyListener = {</span>
<a href="#l164.67"></a><span id="l164.67">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l164.68"></a><span id="l164.68">   SetMessageKey: function(aKey) {</span>
<a href="#l164.69"></a><span id="l164.69">     let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l164.70"></a><span id="l164.70">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l164.71"></a><span id="l164.71">   },</span>
<a href="#l164.72"></a><span id="l164.72">   SetMessageId: function(aMessageId) {},</span>
<a href="#l164.73"></a><span id="l164.73">   OnStopCopy: function(aStatus) {</span>
<a href="#l164.74"></a><span id="l164.74">     // Check: message successfully copied.</span>
<a href="#l164.75"></a><span id="l164.75" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l164.76"></a><span id="l164.76" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l164.77"></a><span id="l164.77">     async_driver();</span>
<a href="#l164.78"></a><span id="l164.78">   }</span>
<a href="#l164.79"></a><span id="l164.79"> };</span>
<a href="#l164.80"></a><span id="l164.80"> </span>
<a href="#l164.81"></a><span id="l164.81"> function teardown() {</span>
<a href="#l164.82"></a><span id="l164.82">   gRootFolder = null;</span>
<a href="#l164.83"></a><span id="l164.83">   teardownIMAPPump();</span>
<a href="#l164.84"></a><span id="l164.84"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l165.1"></a><span id="l165.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l165.2"></a><span id="l165.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l165.3"></a><span id="l165.3" class="difflineat">@@ -71,25 +71,25 @@ var tests = [</span>
<a href="#l165.4"></a><span id="l165.4">   },</span>
<a href="#l165.5"></a><span id="l165.5">   function* update2() {</span>
<a href="#l165.6"></a><span id="l165.6">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l165.7"></a><span id="l165.7">     folder2.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l165.8"></a><span id="l165.8">     yield false;</span>
<a href="#l165.9"></a><span id="l165.9">   },</span>
<a href="#l165.10"></a><span id="l165.10">   function verifyFolders() {</span>
<a href="#l165.11"></a><span id="l165.11">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l165.12"></a><span id="l165.12" class="difflineminus">-    do_check_eq(folderCount(folder1), 2);</span>
<a href="#l165.13"></a><span id="l165.13" class="difflineplus">+    Assert.equal(folderCount(folder1), 2);</span>
<a href="#l165.14"></a><span id="l165.14">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l165.15"></a><span id="l165.15" class="difflineminus">-    do_check_true(folder2 !== null);</span>
<a href="#l165.16"></a><span id="l165.16" class="difflineplus">+    Assert.ok(folder2 !== null);</span>
<a href="#l165.17"></a><span id="l165.17">     // folder 1 and 2 should each now have two messages in them.</span>
<a href="#l165.18"></a><span id="l165.18" class="difflineminus">-    do_check_true(folder1 !== null);</span>
<a href="#l165.19"></a><span id="l165.19" class="difflineminus">-    do_check_eq(folderCount(folder2), 2);</span>
<a href="#l165.20"></a><span id="l165.20" class="difflineplus">+    Assert.ok(folder1 !== null);</span>
<a href="#l165.21"></a><span id="l165.21" class="difflineplus">+    Assert.equal(folderCount(folder2), 2);</span>
<a href="#l165.22"></a><span id="l165.22">     // The local inbox folder should now be empty, since the second</span>
<a href="#l165.23"></a><span id="l165.23">     // operation was a move.</span>
<a href="#l165.24"></a><span id="l165.24" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l165.25"></a><span id="l165.25" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l165.26"></a><span id="l165.26">   },</span>
<a href="#l165.27"></a><span id="l165.27">   teardown</span>
<a href="#l165.28"></a><span id="l165.28"> ];</span>
<a href="#l165.29"></a><span id="l165.29"> </span>
<a href="#l165.30"></a><span id="l165.30"> function folderCount(folder)</span>
<a href="#l165.31"></a><span id="l165.31"> {</span>
<a href="#l165.32"></a><span id="l165.32">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l165.33"></a><span id="l165.33">   let count = 0;</span>
<a href="#l165.34"></a><span id="l165.34" class="difflineat">@@ -131,23 +131,23 @@ var CopyListener =</span>
<a href="#l165.35"></a><span id="l165.35">   SetMessageKey: function(aKey)</span>
<a href="#l165.36"></a><span id="l165.36">   {</span>
<a href="#l165.37"></a><span id="l165.37">     gLastKey = aKey;</span>
<a href="#l165.38"></a><span id="l165.38">   },</span>
<a href="#l165.39"></a><span id="l165.39">   SetMessageId: function(aMessageId) {},</span>
<a href="#l165.40"></a><span id="l165.40">   OnStopCopy: function(aStatus)</span>
<a href="#l165.41"></a><span id="l165.41">   {</span>
<a href="#l165.42"></a><span id="l165.42">     // Check: message successfully copied.</span>
<a href="#l165.43"></a><span id="l165.43" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l165.44"></a><span id="l165.44" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l165.45"></a><span id="l165.45">     async_driver();</span>
<a href="#l165.46"></a><span id="l165.46">   }</span>
<a href="#l165.47"></a><span id="l165.47"> };</span>
<a href="#l165.48"></a><span id="l165.48"> </span>
<a href="#l165.49"></a><span id="l165.49"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l165.50"></a><span id="l165.50" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l165.51"></a><span id="l165.51" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l165.52"></a><span id="l165.52"> };</span>
<a href="#l165.53"></a><span id="l165.53"> </span>
<a href="#l165.54"></a><span id="l165.54"> function teardown() {</span>
<a href="#l165.55"></a><span id="l165.55">   gMessages.clear();</span>
<a href="#l165.56"></a><span id="l165.56">   teardownIMAPPump();</span>
<a href="#l165.57"></a><span id="l165.57"> }</span>
<a href="#l165.58"></a><span id="l165.58"> </span>
<a href="#l165.59"></a><span id="l165.59"> function run_test() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l166.1"></a><span id="l166.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js</span>
<a href="#l166.2"></a><span id="l166.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js</span>
<a href="#l166.3"></a><span id="l166.3" class="difflineat">@@ -60,19 +60,19 @@ function* testStoreCustomList()</span>
<a href="#l166.4"></a><span id="l166.4"> }</span>
<a href="#l166.5"></a><span id="l166.5"> </span>
<a href="#l166.6"></a><span id="l166.6"> // listens for response from customCommandResult request for X-CUSTOM-LIST</span>
<a href="#l166.7"></a><span id="l166.7"> var storeCustomListSetListener = {</span>
<a href="#l166.8"></a><span id="l166.8">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l166.9"></a><span id="l166.9"> </span>
<a href="#l166.10"></a><span id="l166.10">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l166.11"></a><span id="l166.11">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l166.12"></a><span id="l166.12" class="difflineminus">-    do_check_eq(aUrl.customCommandResult,</span>
<a href="#l166.13"></a><span id="l166.13" class="difflineplus">+    Assert.equal(aUrl.customCommandResult,</span>
<a href="#l166.14"></a><span id="l166.14">       &quot;(&quot; + gMessage.xCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l166.15"></a><span id="l166.15" class="difflineminus">-    do_check_eq(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l166.16"></a><span id="l166.16" class="difflineplus">+    Assert.equal(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l166.17"></a><span id="l166.17">     async_driver();</span>
<a href="#l166.18"></a><span id="l166.18">   }</span>
<a href="#l166.19"></a><span id="l166.19"> };</span>
<a href="#l166.20"></a><span id="l166.20"> </span>
<a href="#l166.21"></a><span id="l166.21"> function* testStoreMinusCustomList()</span>
<a href="#l166.22"></a><span id="l166.22"> {</span>
<a href="#l166.23"></a><span id="l166.23">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l166.24"></a><span id="l166.24">   gExpectedLength--;</span>
<a href="#l166.25"></a><span id="l166.25" class="difflineat">@@ -84,19 +84,19 @@ function* testStoreMinusCustomList()</span>
<a href="#l166.26"></a><span id="l166.26"> }</span>
<a href="#l166.27"></a><span id="l166.27"> </span>
<a href="#l166.28"></a><span id="l166.28"> // listens for response from customCommandResult request for X-CUSTOM-LIST</span>
<a href="#l166.29"></a><span id="l166.29"> var storeCustomListRemovedListener = {</span>
<a href="#l166.30"></a><span id="l166.30">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l166.31"></a><span id="l166.31"> </span>
<a href="#l166.32"></a><span id="l166.32">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l166.33"></a><span id="l166.33">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l166.34"></a><span id="l166.34" class="difflineminus">-    do_check_eq(aUrl.customCommandResult,</span>
<a href="#l166.35"></a><span id="l166.35" class="difflineplus">+    Assert.equal(aUrl.customCommandResult,</span>
<a href="#l166.36"></a><span id="l166.36">       &quot;(&quot; + gMessage.xCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l166.37"></a><span id="l166.37" class="difflineminus">-    do_check_eq(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l166.38"></a><span id="l166.38" class="difflineplus">+    Assert.equal(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l166.39"></a><span id="l166.39">     async_driver();</span>
<a href="#l166.40"></a><span id="l166.40">   }</span>
<a href="#l166.41"></a><span id="l166.41"> };</span>
<a href="#l166.42"></a><span id="l166.42"> </span>
<a href="#l166.43"></a><span id="l166.43"> function* testStorePlusCustomList()</span>
<a href="#l166.44"></a><span id="l166.44"> {</span>
<a href="#l166.45"></a><span id="l166.45">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l166.46"></a><span id="l166.46">   gExpectedLength++;</span>
<a href="#l166.47"></a><span id="l166.47" class="difflineat">@@ -108,19 +108,19 @@ function* testStorePlusCustomList()</span>
<a href="#l166.48"></a><span id="l166.48"> }</span>
<a href="#l166.49"></a><span id="l166.49"> </span>
<a href="#l166.50"></a><span id="l166.50"> // listens for response from customCommandResult request for X-CUSTOM-LIST</span>
<a href="#l166.51"></a><span id="l166.51"> var storeCustomListAddedListener = {</span>
<a href="#l166.52"></a><span id="l166.52">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l166.53"></a><span id="l166.53"> </span>
<a href="#l166.54"></a><span id="l166.54">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l166.55"></a><span id="l166.55">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l166.56"></a><span id="l166.56" class="difflineminus">-    do_check_eq(aUrl.customCommandResult,</span>
<a href="#l166.57"></a><span id="l166.57" class="difflineplus">+    Assert.equal(aUrl.customCommandResult,</span>
<a href="#l166.58"></a><span id="l166.58">       &quot;(&quot; + gMessage.xCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l166.59"></a><span id="l166.59" class="difflineminus">-    do_check_eq(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l166.60"></a><span id="l166.60" class="difflineplus">+    Assert.equal(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l166.61"></a><span id="l166.61">     async_driver();</span>
<a href="#l166.62"></a><span id="l166.62">   }</span>
<a href="#l166.63"></a><span id="l166.63"> };</span>
<a href="#l166.64"></a><span id="l166.64"> </span>
<a href="#l166.65"></a><span id="l166.65"> </span>
<a href="#l166.66"></a><span id="l166.66"> // Cleanup at end</span>
<a href="#l166.67"></a><span id="l166.67"> function endTest()</span>
<a href="#l166.68"></a><span id="l166.68"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l167.1"></a><span id="l167.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l167.2"></a><span id="l167.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l167.3"></a><span id="l167.3" class="difflineat">@@ -91,17 +91,17 @@ function* streamMessages() {</span>
<a href="#l167.4"></a><span id="l167.4">       yield false;</span>
<a href="#l167.5"></a><span id="l167.5">       let buf = gStreamListener._data;</span>
<a href="#l167.6"></a><span id="l167.6">       dump(&quot;##########\nTesting---&gt;&quot; + fileNames[i-1] +</span>
<a href="#l167.7"></a><span id="l167.7">            &quot;; 'prefer plain text': &quot; + isPlain + &quot;\n&quot; +</span>
<a href="#l167.8"></a><span id="l167.8">            buf + &quot;\n&quot; +</span>
<a href="#l167.9"></a><span id="l167.9">            &quot;##########\nTesting---&gt;&quot; + fileNames[i-1] +</span>
<a href="#l167.10"></a><span id="l167.10">            &quot;; 'prefer plain text': &quot; + isPlain + &quot;\n&quot;);</span>
<a href="#l167.11"></a><span id="l167.11">       try {</span>
<a href="#l167.12"></a><span id="l167.12" class="difflineminus">-        do_check_true(buf.includes(marker));</span>
<a href="#l167.13"></a><span id="l167.13" class="difflineplus">+        Assert.ok(buf.includes(marker));</span>
<a href="#l167.14"></a><span id="l167.14">       }</span>
<a href="#l167.15"></a><span id="l167.15">       catch(e){}</span>
<a href="#l167.16"></a><span id="l167.16">     }</span>
<a href="#l167.17"></a><span id="l167.17">   }</span>
<a href="#l167.18"></a><span id="l167.18">   yield true;</span>
<a href="#l167.19"></a><span id="l167.19"> }</span>
<a href="#l167.20"></a><span id="l167.20"> </span>
<a href="#l167.21"></a><span id="l167.21"> var gStreamListener = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l168.1"></a><span id="l168.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l168.2"></a><span id="l168.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l168.3"></a><span id="l168.3" class="difflineat">@@ -27,17 +27,17 @@ function run_test() {</span>
<a href="#l168.4"></a><span id="l168.4">   daemon.createMailbox(&quot;folder 2&quot;, {subscribed : true});</span>
<a href="#l168.5"></a><span id="l168.5">   gFolder2Mailbox = daemon.getMailbox(&quot;folder 2&quot;);</span>
<a href="#l168.6"></a><span id="l168.6">   addMessageToFolder(gFolder2Mailbox);</span>
<a href="#l168.7"></a><span id="l168.7">   gServer = makeServer(daemon, &quot;&quot;);</span>
<a href="#l168.8"></a><span id="l168.8"> </span>
<a href="#l168.9"></a><span id="l168.9">   gImapServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l168.10"></a><span id="l168.10"> </span>
<a href="#l168.11"></a><span id="l168.11">   // Bug 1050840: check a newly created server has the default number of connections</span>
<a href="#l168.12"></a><span id="l168.12" class="difflineminus">-  do_check_eq(gImapServer.maximumConnectionsNumber, 5);</span>
<a href="#l168.13"></a><span id="l168.13" class="difflineplus">+  Assert.equal(gImapServer.maximumConnectionsNumber, 5);</span>
<a href="#l168.14"></a><span id="l168.14">   gImapServer.maximumConnectionsNumber = 1;</span>
<a href="#l168.15"></a><span id="l168.15"> </span>
<a href="#l168.16"></a><span id="l168.16">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l168.17"></a><span id="l168.17"> </span>
<a href="#l168.18"></a><span id="l168.18">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l168.19"></a><span id="l168.19">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l168.20"></a><span id="l168.20">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l168.21"></a><span id="l168.21">   localAccount.addIdentity(identity);</span>
<a href="#l168.22"></a><span id="l168.22" class="difflineat">@@ -85,17 +85,17 @@ function* checkStatSelect() {</span>
<a href="#l168.23"></a><span id="l168.23">   gIMAPInbox.updateFolder(null);</span>
<a href="#l168.24"></a><span id="l168.24">   gServer.performTest(&quot;NOOP&quot;);</span>
<a href="#l168.25"></a><span id="l168.25">   yield true;</span>
<a href="#l168.26"></a><span id="l168.26"> }</span>
<a href="#l168.27"></a><span id="l168.27"> </span>
<a href="#l168.28"></a><span id="l168.28"> function* checkStatNoSelect() {</span>
<a href="#l168.29"></a><span id="l168.29">   // folder 2 should have been stat'd, but not folder 1. All we can really check</span>
<a href="#l168.30"></a><span id="l168.30">   // is that folder 2 was stat'd and that its unread msg count is 1</span>
<a href="#l168.31"></a><span id="l168.31" class="difflineminus">-  do_check_eq(gFolder2.getNumUnread(false), 1);</span>
<a href="#l168.32"></a><span id="l168.32" class="difflineplus">+  Assert.equal(gFolder2.getNumUnread(false), 1);</span>
<a href="#l168.33"></a><span id="l168.33">   addMessageToFolder(gFolder2Mailbox);</span>
<a href="#l168.34"></a><span id="l168.34">   gFolder1.clearFlag(Ci.nsMsgFolderFlags.ImapNoselect);</span>
<a href="#l168.35"></a><span id="l168.35">   gServer._test = true;</span>
<a href="#l168.36"></a><span id="l168.36">   // we've cleared the ImapNoselect flag, so we will attempt to STAT folder 1,</span>
<a href="#l168.37"></a><span id="l168.37">   // which will fail. So we verify that we go on and STAT folder 2, and that</span>
<a href="#l168.38"></a><span id="l168.38">   // it picks up the message we added to it above.</span>
<a href="#l168.39"></a><span id="l168.39">   MailServices.mailSession.AddFolderListener(gFolderListener,</span>
<a href="#l168.40"></a><span id="l168.40">                                              Ci.nsIFolderListener.boolPropertyChanged);</span>
<a href="#l168.41"></a><span id="l168.41" class="difflineat">@@ -114,17 +114,17 @@ function addMessageToFolder(mbox) {</span>
<a href="#l168.42"></a><span id="l168.42">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l168.43"></a><span id="l168.43">                        btoa(messages[0].toMessageString()));</span>
<a href="#l168.44"></a><span id="l168.44">   let message = new imapMessage(msgURI.spec, mbox.uidnext++);</span>
<a href="#l168.45"></a><span id="l168.45">   mbox.addMessage(message);</span>
<a href="#l168.46"></a><span id="l168.46"> }</span>
<a href="#l168.47"></a><span id="l168.47"> </span>
<a href="#l168.48"></a><span id="l168.48"> function* endTest()</span>
<a href="#l168.49"></a><span id="l168.49"> {</span>
<a href="#l168.50"></a><span id="l168.50" class="difflineminus">-  do_check_eq(gFolder2.getNumUnread(false), 2);</span>
<a href="#l168.51"></a><span id="l168.51" class="difflineplus">+  Assert.equal(gFolder2.getNumUnread(false), 2);</span>
<a href="#l168.52"></a><span id="l168.52">   // Clean up the server in preparation</span>
<a href="#l168.53"></a><span id="l168.53">   gServer.resetTest();</span>
<a href="#l168.54"></a><span id="l168.54">   gImapServer.closeCachedConnections();</span>
<a href="#l168.55"></a><span id="l168.55">   gServer.performTest();</span>
<a href="#l168.56"></a><span id="l168.56">   gServer.stop();</span>
<a href="#l168.57"></a><span id="l168.57">   yield true;</span>
<a href="#l168.58"></a><span id="l168.58"> }</span>
<a href="#l168.59"></a><span id="l168.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l169.1"></a><span id="l169.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_fetchCustomAttribute.js</span>
<a href="#l169.2"></a><span id="l169.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_fetchCustomAttribute.js</span>
<a href="#l169.3"></a><span id="l169.3" class="difflineat">@@ -59,17 +59,17 @@ function* testFetchCustomValue()</span>
<a href="#l169.4"></a><span id="l169.4"> }</span>
<a href="#l169.5"></a><span id="l169.5"> </span>
<a href="#l169.6"></a><span id="l169.6"> // listens for resposne from fetchCustomMsgAttribute request for X-CUSTOM-VALUE</span>
<a href="#l169.7"></a><span id="l169.7"> var fetchCustomValueListener = {</span>
<a href="#l169.8"></a><span id="l169.8">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l169.9"></a><span id="l169.9"> </span>
<a href="#l169.10"></a><span id="l169.10">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l169.11"></a><span id="l169.11">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l169.12"></a><span id="l169.12" class="difflineminus">-    do_check_eq(aUrl.customAttributeResult, gCustomValue);</span>
<a href="#l169.13"></a><span id="l169.13" class="difflineplus">+    Assert.equal(aUrl.customAttributeResult, gCustomValue);</span>
<a href="#l169.14"></a><span id="l169.14">     async_driver();</span>
<a href="#l169.15"></a><span id="l169.15">   }</span>
<a href="#l169.16"></a><span id="l169.16"> };</span>
<a href="#l169.17"></a><span id="l169.17"> </span>
<a href="#l169.18"></a><span id="l169.18"> // Used to verify that nsIServerResponseParser.msg_fetch() can handle a parenthesis group - Bug 735542</span>
<a href="#l169.19"></a><span id="l169.19"> function* testFetchCustomList()</span>
<a href="#l169.20"></a><span id="l169.20"> {</span>
<a href="#l169.21"></a><span id="l169.21">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l169.22"></a><span id="l169.22" class="difflineat">@@ -80,17 +80,17 @@ function* testFetchCustomList()</span>
<a href="#l169.23"></a><span id="l169.23"> }</span>
<a href="#l169.24"></a><span id="l169.24"> </span>
<a href="#l169.25"></a><span id="l169.25"> // listens for response from fetchCustomMsgAttribute request for X-CUSTOM-LIST</span>
<a href="#l169.26"></a><span id="l169.26"> var fetchCustomListListener = {</span>
<a href="#l169.27"></a><span id="l169.27">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l169.28"></a><span id="l169.28"> </span>
<a href="#l169.29"></a><span id="l169.29">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l169.30"></a><span id="l169.30">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l169.31"></a><span id="l169.31" class="difflineminus">-    do_check_eq(aUrl.customAttributeResult, &quot;(&quot; + gCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l169.32"></a><span id="l169.32" class="difflineplus">+    Assert.equal(aUrl.customAttributeResult, &quot;(&quot; + gCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l169.33"></a><span id="l169.33">     async_driver();</span>
<a href="#l169.34"></a><span id="l169.34">   }</span>
<a href="#l169.35"></a><span id="l169.35"> };</span>
<a href="#l169.36"></a><span id="l169.36"> </span>
<a href="#l169.37"></a><span id="l169.37"> // Cleanup at end</span>
<a href="#l169.38"></a><span id="l169.38"> function endTest()</span>
<a href="#l169.39"></a><span id="l169.39"> {</span>
<a href="#l169.40"></a><span id="l169.40">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l170.1"></a><span id="l170.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_filterCustomHeaders.js</span>
<a href="#l170.2"></a><span id="l170.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_filterCustomHeaders.js</span>
<a href="#l170.3"></a><span id="l170.3" class="difflineat">@@ -58,17 +58,17 @@ function* setupTest() {</span>
<a href="#l170.4"></a><span id="l170.4">   IMAPPump.mailbox.addMessage(new imapMessage(msgfileuri.spec,</span>
<a href="#l170.5"></a><span id="l170.5">                                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l170.6"></a><span id="l170.6">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l170.7"></a><span id="l170.7">   yield false;</span>
<a href="#l170.8"></a><span id="l170.8"> }</span>
<a href="#l170.9"></a><span id="l170.9"> </span>
<a href="#l170.10"></a><span id="l170.10"> function* checkFilterResults() {</span>
<a href="#l170.11"></a><span id="l170.11">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l170.12"></a><span id="l170.12" class="difflineminus">-  do_check_true(msgHdr.isRead);</span>
<a href="#l170.13"></a><span id="l170.13" class="difflineplus">+  Assert.ok(msgHdr.isRead);</span>
<a href="#l170.14"></a><span id="l170.14">   yield true;</span>
<a href="#l170.15"></a><span id="l170.15"> }</span>
<a href="#l170.16"></a><span id="l170.16"> </span>
<a href="#l170.17"></a><span id="l170.17"> // Cleanup</span>
<a href="#l170.18"></a><span id="l170.18"> function endTest() {</span>
<a href="#l170.19"></a><span id="l170.19">   IMAPPump.server.performTest(&quot;UID STORE&quot;);</span>
<a href="#l170.20"></a><span id="l170.20">   teardownIMAPPump();</span>
<a href="#l170.21"></a><span id="l170.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l171.1"></a><span id="l171.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_folderOfflineFlags.js</span>
<a href="#l171.2"></a><span id="l171.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_folderOfflineFlags.js</span>
<a href="#l171.3"></a><span id="l171.3" class="difflineat">@@ -50,57 +50,57 @@ function* setup() {</span>
<a href="#l171.4"></a><span id="l171.4"> </span>
<a href="#l171.5"></a><span id="l171.5">   yield false;</span>
<a href="#l171.6"></a><span id="l171.6"> }</span>
<a href="#l171.7"></a><span id="l171.7"> </span>
<a href="#l171.8"></a><span id="l171.8"> /**</span>
<a href="#l171.9"></a><span id="l171.9">  * Test that folders generally are marked for offline use by default.</span>
<a href="#l171.10"></a><span id="l171.10">  */</span>
<a href="#l171.11"></a><span id="l171.11"> function* testGeneralFoldersOffline() {</span>
<a href="#l171.12"></a><span id="l171.12" class="difflineminus">-  do_check_true(IMAPPump.inbox.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.13"></a><span id="l171.13" class="difflineplus">+  Assert.ok(IMAPPump.inbox.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.14"></a><span id="l171.14"> </span>
<a href="#l171.15"></a><span id="l171.15">   let gmail = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;[Gmail]&quot;);</span>
<a href="#l171.16"></a><span id="l171.16"> </span>
<a href="#l171.17"></a><span id="l171.17">   let allmail = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Archive);</span>
<a href="#l171.18"></a><span id="l171.18" class="difflineminus">-  do_check_true(allmail.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.19"></a><span id="l171.19" class="difflineplus">+  Assert.ok(allmail.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.20"></a><span id="l171.20"> </span>
<a href="#l171.21"></a><span id="l171.21">   let drafts = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Drafts);</span>
<a href="#l171.22"></a><span id="l171.22" class="difflineminus">-  do_check_true(drafts.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.23"></a><span id="l171.23" class="difflineplus">+  Assert.ok(drafts.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.24"></a><span id="l171.24"> </span>
<a href="#l171.25"></a><span id="l171.25">   let sent = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.SentMail);</span>
<a href="#l171.26"></a><span id="l171.26" class="difflineminus">-  do_check_true(sent.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.27"></a><span id="l171.27" class="difflineplus">+  Assert.ok(sent.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.28"></a><span id="l171.28"> </span>
<a href="#l171.29"></a><span id="l171.29">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l171.30"></a><span id="l171.30"> </span>
<a href="#l171.31"></a><span id="l171.31">   let folder1 =  rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l171.32"></a><span id="l171.32" class="difflineminus">-  do_check_true(folder1.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.33"></a><span id="l171.33" class="difflineplus">+  Assert.ok(folder1.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.34"></a><span id="l171.34"> </span>
<a href="#l171.35"></a><span id="l171.35">   let folder2 =  rootFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l171.36"></a><span id="l171.36" class="difflineminus">-  do_check_true(folder2.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.37"></a><span id="l171.37" class="difflineplus">+  Assert.ok(folder2.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.38"></a><span id="l171.38"> </span>
<a href="#l171.39"></a><span id="l171.39">   yield true;</span>
<a href="#l171.40"></a><span id="l171.40"> }</span>
<a href="#l171.41"></a><span id="l171.41"> </span>
<a href="#l171.42"></a><span id="l171.42"> /**</span>
<a href="#l171.43"></a><span id="l171.43">  * Test that Trash isn't flagged for offline use by default.</span>
<a href="#l171.44"></a><span id="l171.44">  */</span>
<a href="#l171.45"></a><span id="l171.45"> function* testTrashNotOffline() {</span>
<a href="#l171.46"></a><span id="l171.46">   let gmail = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;[Gmail]&quot;);</span>
<a href="#l171.47"></a><span id="l171.47">   let trash = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l171.48"></a><span id="l171.48" class="difflineminus">-  do_check_false(trash.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.49"></a><span id="l171.49" class="difflineplus">+  Assert.ok(!trash.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.50"></a><span id="l171.50">   yield true;</span>
<a href="#l171.51"></a><span id="l171.51"> }</span>
<a href="#l171.52"></a><span id="l171.52"> </span>
<a href="#l171.53"></a><span id="l171.53"> /**</span>
<a href="#l171.54"></a><span id="l171.54">  * Test that Junk isn't flagged for offline use by default.</span>
<a href="#l171.55"></a><span id="l171.55">  */</span>
<a href="#l171.56"></a><span id="l171.56"> function* testJunkNotOffline() {</span>
<a href="#l171.57"></a><span id="l171.57">   let gmail = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;[Gmail]&quot;);</span>
<a href="#l171.58"></a><span id="l171.58">   let spam = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Junk);</span>
<a href="#l171.59"></a><span id="l171.59" class="difflineminus">-  do_check_false(spam.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.60"></a><span id="l171.60" class="difflineplus">+  Assert.ok(!spam.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l171.61"></a><span id="l171.61">   yield true;</span>
<a href="#l171.62"></a><span id="l171.62"> }</span>
<a href="#l171.63"></a><span id="l171.63"> </span>
<a href="#l171.64"></a><span id="l171.64"> /** Cleanup at the end. */</span>
<a href="#l171.65"></a><span id="l171.65"> function teardown() {</span>
<a href="#l171.66"></a><span id="l171.66">   teardownIMAPPump();</span>
<a href="#l171.67"></a><span id="l171.67"> }</span>
<a href="#l171.68"></a><span id="l171.68"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l172.1"></a><span id="l172.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_gmailAttributes.js</span>
<a href="#l172.2"></a><span id="l172.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_gmailAttributes.js</span>
<a href="#l172.3"></a><span id="l172.3" class="difflineat">@@ -60,32 +60,32 @@ function* loadImapMessage()</span>
<a href="#l172.4"></a><span id="l172.4">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l172.5"></a><span id="l172.5">   yield false;</span>
<a href="#l172.6"></a><span id="l172.6"> }</span>
<a href="#l172.7"></a><span id="l172.7"> </span>
<a href="#l172.8"></a><span id="l172.8"> function testFetchXGmMsgid()</span>
<a href="#l172.9"></a><span id="l172.9"> {</span>
<a href="#l172.10"></a><span id="l172.10">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l172.11"></a><span id="l172.11">   let val = msgHdr.getStringProperty(&quot;X-GM-MSGID&quot;);</span>
<a href="#l172.12"></a><span id="l172.12" class="difflineminus">-  do_check_eq(val, gXGmMsgid);</span>
<a href="#l172.13"></a><span id="l172.13" class="difflineplus">+  Assert.equal(val, gXGmMsgid);</span>
<a href="#l172.14"></a><span id="l172.14"> }</span>
<a href="#l172.15"></a><span id="l172.15"> </span>
<a href="#l172.16"></a><span id="l172.16"> function testFetchXGmThrid()</span>
<a href="#l172.17"></a><span id="l172.17"> {</span>
<a href="#l172.18"></a><span id="l172.18">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l172.19"></a><span id="l172.19">   let val = msgHdr.getStringProperty(&quot;X-GM-THRID&quot;);</span>
<a href="#l172.20"></a><span id="l172.20" class="difflineminus">-  do_check_eq(val, gXGmThrid);</span>
<a href="#l172.21"></a><span id="l172.21" class="difflineplus">+  Assert.equal(val, gXGmThrid);</span>
<a href="#l172.22"></a><span id="l172.22"> }</span>
<a href="#l172.23"></a><span id="l172.23"> </span>
<a href="#l172.24"></a><span id="l172.24"> function testFetchXGmLabels()</span>
<a href="#l172.25"></a><span id="l172.25"> {</span>
<a href="#l172.26"></a><span id="l172.26">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l172.27"></a><span id="l172.27">   let val = msgHdr.getStringProperty(&quot;X-GM-LABELS&quot;);</span>
<a href="#l172.28"></a><span id="l172.28">    // We need to remove the starting &quot;(&quot; and ending &quot;)&quot; from gXGmLabels while comparing</span>
<a href="#l172.29"></a><span id="l172.29" class="difflineminus">-  do_check_eq(val, gXGmLabels.substring(1 ,gXGmLabels.length - 1));</span>
<a href="#l172.30"></a><span id="l172.30" class="difflineplus">+  Assert.equal(val, gXGmLabels.substring(1 ,gXGmLabels.length - 1));</span>
<a href="#l172.31"></a><span id="l172.31"> }</span>
<a href="#l172.32"></a><span id="l172.32"> </span>
<a href="#l172.33"></a><span id="l172.33"> // Cleanup at end</span>
<a href="#l172.34"></a><span id="l172.34"> function endTest()</span>
<a href="#l172.35"></a><span id="l172.35"> {</span>
<a href="#l172.36"></a><span id="l172.36">   teardownIMAPPump();</span>
<a href="#l172.37"></a><span id="l172.37"> }</span>
<a href="#l172.38"></a><span id="l172.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l173.1"></a><span id="l173.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</span>
<a href="#l173.2"></a><span id="l173.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</span>
<a href="#l173.3"></a><span id="l173.3" class="difflineat">@@ -180,58 +180,58 @@ function* crossStreaming() {</span>
<a href="#l173.4"></a><span id="l173.4">   /**</span>
<a href="#l173.5"></a><span id="l173.5">    * Streaming message1 from fooFolder. message1 is present in</span>
<a href="#l173.6"></a><span id="l173.6">    * offline store of inbox. We now test that streaming the message1</span>
<a href="#l173.7"></a><span id="l173.7">    * from fooFolder does not make us add message1 to offline store of</span>
<a href="#l173.8"></a><span id="l173.8">    * fooFolder. We check this by comparing the sizes of inbox and fooFolder</span>
<a href="#l173.9"></a><span id="l173.9">    * before and after streaming.</span>
<a href="#l173.10"></a><span id="l173.10">    */</span>
<a href="#l173.11"></a><span id="l173.11">   let msg2 = fooFolder.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l173.12"></a><span id="l173.12" class="difflineminus">-  do_check_true(msg2 !== null);</span>
<a href="#l173.13"></a><span id="l173.13" class="difflineplus">+  Assert.ok(msg2 !== null);</span>
<a href="#l173.14"></a><span id="l173.14">   let msgURI = fooFolder.getUriForMsg(msg2);</span>
<a href="#l173.15"></a><span id="l173.15">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l173.16"></a><span id="l173.16">   let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l173.17"></a><span id="l173.17">   // pass true for aLocalOnly since message should be in offline store of Inbox.</span>
<a href="#l173.18"></a><span id="l173.18">   msgServ.streamMessage(msgURI, gStreamListener, null, null, false, &quot;&quot;, true);</span>
<a href="#l173.19"></a><span id="l173.19">   gFooOfflineStoreSizeFinal = fooFolder.filePath.fileSize;</span>
<a href="#l173.20"></a><span id="l173.20">   gImapInboxOfflineStoreSizeFinal = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l173.21"></a><span id="l173.21" class="difflineminus">-  do_check_eq(gFooOfflineStoreSizeFinal, gFooOfflineStoreSizeInitial);</span>
<a href="#l173.22"></a><span id="l173.22" class="difflineminus">-  do_check_eq(gImapInboxOfflineStoreSizeFinal,gImapInboxOfflineStoreSizeInitial);</span>
<a href="#l173.23"></a><span id="l173.23" class="difflineplus">+  Assert.equal(gFooOfflineStoreSizeFinal, gFooOfflineStoreSizeInitial);</span>
<a href="#l173.24"></a><span id="l173.24" class="difflineplus">+  Assert.equal(gImapInboxOfflineStoreSizeFinal,gImapInboxOfflineStoreSizeInitial);</span>
<a href="#l173.25"></a><span id="l173.25">   yield false;</span>
<a href="#l173.26"></a><span id="l173.26"> }</span>
<a href="#l173.27"></a><span id="l173.27"> </span>
<a href="#l173.28"></a><span id="l173.28"> function teardown() {</span>
<a href="#l173.29"></a><span id="l173.29">   teardownIMAPPump();</span>
<a href="#l173.30"></a><span id="l173.30"> }</span>
<a href="#l173.31"></a><span id="l173.31"> </span>
<a href="#l173.32"></a><span id="l173.32"> function run_test() {</span>
<a href="#l173.33"></a><span id="l173.33">   async_run_tests(tests);</span>
<a href="#l173.34"></a><span id="l173.34"> }</span>
<a href="#l173.35"></a><span id="l173.35"> </span>
<a href="#l173.36"></a><span id="l173.36"> /*</span>
<a href="#l173.37"></a><span id="l173.37">  * helper functions</span>
<a href="#l173.38"></a><span id="l173.38">  */</span>
<a href="#l173.39"></a><span id="l173.39"> </span>
<a href="#l173.40"></a><span id="l173.40"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l173.41"></a><span id="l173.41" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l173.42"></a><span id="l173.42" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l173.43"></a><span id="l173.43"> };</span>
<a href="#l173.44"></a><span id="l173.44"> </span>
<a href="#l173.45"></a><span id="l173.45">  // We use this as a display consumer</span>
<a href="#l173.46"></a><span id="l173.46"> var streamListener =</span>
<a href="#l173.47"></a><span id="l173.47"> {</span>
<a href="#l173.48"></a><span id="l173.48">   _data: &quot;&quot;,</span>
<a href="#l173.49"></a><span id="l173.49"> </span>
<a href="#l173.50"></a><span id="l173.50">   QueryInterface:</span>
<a href="#l173.51"></a><span id="l173.51">     XPCOMUtils.generateQI([Ci.nsIStreamListener, Ci.nsIRequestObserver]),</span>
<a href="#l173.52"></a><span id="l173.52"> </span>
<a href="#l173.53"></a><span id="l173.53">   // nsIRequestObserver</span>
<a href="#l173.54"></a><span id="l173.54">   onStartRequest: function(aRequest, aContext) {</span>
<a href="#l173.55"></a><span id="l173.55">   },</span>
<a href="#l173.56"></a><span id="l173.56">   onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l173.57"></a><span id="l173.57" class="difflineminus">-    do_check_eq(aStatusCode, 0);</span>
<a href="#l173.58"></a><span id="l173.58" class="difflineplus">+    Assert.equal(aStatusCode, 0);</span>
<a href="#l173.59"></a><span id="l173.59">   },</span>
<a href="#l173.60"></a><span id="l173.60"> </span>
<a href="#l173.61"></a><span id="l173.61">   // nsIStreamListener</span>
<a href="#l173.62"></a><span id="l173.62">   onDataAvailable: function(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l173.63"></a><span id="l173.63">     let scriptStream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l173.64"></a><span id="l173.64">                           .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l173.65"></a><span id="l173.65"> </span>
<a href="#l173.66"></a><span id="l173.66">     scriptStream.init(aInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l174.1"></a><span id="l174.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l174.2"></a><span id="l174.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l174.3"></a><span id="l174.3" class="difflineat">@@ -47,19 +47,19 @@ function* loadImapMessage()</span>
<a href="#l174.4"></a><span id="l174.4">   let msgURI =</span>
<a href="#l174.5"></a><span id="l174.5">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l174.6"></a><span id="l174.6">                        btoa(smsg.toMessageString()));</span>
<a href="#l174.7"></a><span id="l174.7">   let imapInbox = IMAPPump.daemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l174.8"></a><span id="l174.8">   let message = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l174.9"></a><span id="l174.9">   IMAPPump.mailbox.addMessage(message);</span>
<a href="#l174.10"></a><span id="l174.10">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l174.11"></a><span id="l174.11">   yield false;</span>
<a href="#l174.12"></a><span id="l174.12" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l174.13"></a><span id="l174.13" class="difflineplus">+  Assert.equal(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l174.14"></a><span id="l174.14">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l174.15"></a><span id="l174.15" class="difflineminus">-  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l174.16"></a><span id="l174.16" class="difflineplus">+  Assert.ok(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l174.17"></a><span id="l174.17"> </span>
<a href="#l174.18"></a><span id="l174.18">   yield true;</span>
<a href="#l174.19"></a><span id="l174.19"> }</span>
<a href="#l174.20"></a><span id="l174.20"> </span>
<a href="#l174.21"></a><span id="l174.21"> // process the message through mime</span>
<a href="#l174.22"></a><span id="l174.22"> function* startMime()</span>
<a href="#l174.23"></a><span id="l174.23"> {</span>
<a href="#l174.24"></a><span id="l174.24">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l174.25"></a><span id="l174.25" class="difflineat">@@ -90,26 +90,26 @@ function* testDetach()</span>
<a href="#l174.26"></a><span id="l174.26"> {</span>
<a href="#l174.27"></a><span id="l174.27">   // This test seems to fail on Linux without the following delay.</span>
<a href="#l174.28"></a><span id="l174.28">   mailTestUtils.do_timeout_function(200, async_driver);</span>
<a href="#l174.29"></a><span id="l174.29">   yield false;</span>
<a href="#l174.30"></a><span id="l174.30">   // Check that the file attached to the message now exists in the profile </span>
<a href="#l174.31"></a><span id="l174.31">   // directory.</span>
<a href="#l174.32"></a><span id="l174.32">   let checkFile = do_get_profile().clone();</span>
<a href="#l174.33"></a><span id="l174.33">   checkFile.append(kAttachFileName);</span>
<a href="#l174.34"></a><span id="l174.34" class="difflineminus">-  do_check_true(checkFile.exists());</span>
<a href="#l174.35"></a><span id="l174.35" class="difflineplus">+  Assert.ok(checkFile.exists());</span>
<a href="#l174.36"></a><span id="l174.36"> </span>
<a href="#l174.37"></a><span id="l174.37">   // The message should now have a detached attachment. Read the message,</span>
<a href="#l174.38"></a><span id="l174.38">   //  and search for &quot;AttachmentDetached&quot; which is added on detachment.</span>
<a href="#l174.39"></a><span id="l174.39"> </span>
<a href="#l174.40"></a><span id="l174.40">   // Get the message header - detached copy has UID 2.</span>
<a href="#l174.41"></a><span id="l174.41">   let msgHdr = IMAPPump.inbox.GetMessageHeader(2);</span>
<a href="#l174.42"></a><span id="l174.42" class="difflineminus">-  do_check_true(msgHdr !== null);</span>
<a href="#l174.43"></a><span id="l174.43" class="difflineplus">+  Assert.ok(msgHdr !== null);</span>
<a href="#l174.44"></a><span id="l174.44">   let messageContent = getContentFromMessage(msgHdr);</span>
<a href="#l174.45"></a><span id="l174.45" class="difflineminus">-  do_check_true(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l174.46"></a><span id="l174.46" class="difflineplus">+  Assert.ok(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l174.47"></a><span id="l174.47"> }</span>
<a href="#l174.48"></a><span id="l174.48"> </span>
<a href="#l174.49"></a><span id="l174.49"> // Cleanup</span>
<a href="#l174.50"></a><span id="l174.50"> function endTest()</span>
<a href="#l174.51"></a><span id="l174.51"> {</span>
<a href="#l174.52"></a><span id="l174.52">   teardownIMAPPump();</span>
<a href="#l174.53"></a><span id="l174.53"> }</span>
<a href="#l174.54"></a><span id="l174.54"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l175.1"></a><span id="l175.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAuthMethods.js</span>
<a href="#l175.2"></a><span id="l175.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAuthMethods.js</span>
<a href="#l175.3"></a><span id="l175.3" class="difflineat">@@ -97,17 +97,17 @@ function nextTest() {</span>
<a href="#l175.4"></a><span id="l175.4">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l175.5"></a><span id="l175.5">     msgServer.authMethod = thisTest.clientAuthMethod;</span>
<a href="#l175.6"></a><span id="l175.6"> </span>
<a href="#l175.7"></a><span id="l175.7">     // connect</span>
<a href="#l175.8"></a><span id="l175.8">     incomingServer.performExpand(null);</span>
<a href="#l175.9"></a><span id="l175.9">     server.performTest(&quot;LSUB&quot;);</span>
<a href="#l175.10"></a><span id="l175.10"> </span>
<a href="#l175.11"></a><span id="l175.11">     dump(&quot;should &quot; + (thisTest.expectSuccess ? &quot;&quot;:&quot;not &quot;) + &quot;be logged in\n&quot;);</span>
<a href="#l175.12"></a><span id="l175.12" class="difflineminus">-    do_check_eq(true, incomingServer instanceof Ci.nsIImapServerSink);</span>
<a href="#l175.13"></a><span id="l175.13" class="difflineplus">+    Assert.equal(true, incomingServer instanceof Ci.nsIImapServerSink);</span>
<a href="#l175.14"></a><span id="l175.14">     //do_check_eq(thisTest.expectSuccess, incomingServer.userAuthenticated); TODO fails second time</span>
<a href="#l175.15"></a><span id="l175.15">     //var rootFolder = incomingServer.rootFolder;</span>
<a href="#l175.16"></a><span id="l175.16">     // Client creates fake Inbox, so check other folder</span>
<a href="#l175.17"></a><span id="l175.17">     //do_check_eq(thisTest.expectSuccess,</span>
<a href="#l175.18"></a><span id="l175.18">     //    rootFolder.containsChildNamed(&quot;somemailbox&quot;)); TODO</span>
<a href="#l175.19"></a><span id="l175.19">     do_check_transaction(server.playTransaction(), thisTest.transaction, false);</span>
<a href="#l175.20"></a><span id="l175.20"> </span>
<a href="#l175.21"></a><span id="l175.21">     do {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l176.1"></a><span id="l176.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l176.2"></a><span id="l176.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l176.3"></a><span id="l176.3" class="difflineat">@@ -52,17 +52,17 @@ var gTargetFolder;</span>
<a href="#l176.4"></a><span id="l176.4"> </span>
<a href="#l176.5"></a><span id="l176.5"> function* test_createTargetFolder()</span>
<a href="#l176.6"></a><span id="l176.6"> {</span>
<a href="#l176.7"></a><span id="l176.7">   gAutoSyncManager.addListener(gAutoSyncListener);</span>
<a href="#l176.8"></a><span id="l176.8"> </span>
<a href="#l176.9"></a><span id="l176.9">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;targetFolder&quot;, null);</span>
<a href="#l176.10"></a><span id="l176.10">   yield false;</span>
<a href="#l176.11"></a><span id="l176.11">   gTargetFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;targetFolder&quot;);</span>
<a href="#l176.12"></a><span id="l176.12" class="difflineminus">-  do_check_true(gTargetFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l176.13"></a><span id="l176.13" class="difflineplus">+  Assert.ok(gTargetFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l176.14"></a><span id="l176.14">   // set folder to be checked for new messages when inbox is checked.</span>
<a href="#l176.15"></a><span id="l176.15">   gTargetFolder.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l176.16"></a><span id="l176.16"> }</span>
<a href="#l176.17"></a><span id="l176.17"> </span>
<a href="#l176.18"></a><span id="l176.18"> function* test_checkForNewMessages()</span>
<a href="#l176.19"></a><span id="l176.19"> {</span>
<a href="#l176.20"></a><span id="l176.20">   addMessageToFolder(gTargetFolder);</span>
<a href="#l176.21"></a><span id="l176.21">   // This will update the INBOX and STATUS targetFolder. We only care about</span>
<a href="#l176.22"></a><span id="l176.22" class="difflineat">@@ -86,17 +86,17 @@ function test_triggerAutoSyncIdle()</span>
<a href="#l176.23"></a><span id="l176.23"> }</span>
<a href="#l176.24"></a><span id="l176.24"> </span>
<a href="#l176.25"></a><span id="l176.25"> // move the message to a diffent folder</span>
<a href="#l176.26"></a><span id="l176.26"> function* test_moveMessageToTargetFolder()</span>
<a href="#l176.27"></a><span id="l176.27"> {</span>
<a href="#l176.28"></a><span id="l176.28">   let observer = gAutoSyncManager.QueryInterface(Ci.nsIObserver);</span>
<a href="#l176.29"></a><span id="l176.29">   observer.observe(null, &quot;mail:appIdle&quot;, &quot;back&quot;);</span>
<a href="#l176.30"></a><span id="l176.30">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l176.31"></a><span id="l176.31" class="difflineminus">-  do_check_true(msgHdr !== null);</span>
<a href="#l176.32"></a><span id="l176.32" class="difflineplus">+  Assert.ok(msgHdr !== null);</span>
<a href="#l176.33"></a><span id="l176.33"> </span>
<a href="#l176.34"></a><span id="l176.34">   // Now move this message to the target folder.</span>
<a href="#l176.35"></a><span id="l176.35">   let messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l176.36"></a><span id="l176.36">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l176.37"></a><span id="l176.37">   messages.appendElement(msgHdr);</span>
<a href="#l176.38"></a><span id="l176.38">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, gTargetFolder, true,</span>
<a href="#l176.39"></a><span id="l176.39">                                  asyncCopyListener, null, false);</span>
<a href="#l176.40"></a><span id="l176.40">   yield false;</span>
<a href="#l176.41"></a><span id="l176.41" class="difflineat">@@ -117,23 +117,23 @@ function* test_waitForTargetUpdate()</span>
<a href="#l176.42"></a><span id="l176.42"> </span>
<a href="#l176.43"></a><span id="l176.43"> // Cleanup</span>
<a href="#l176.44"></a><span id="l176.44"> function endTest()</span>
<a href="#l176.45"></a><span id="l176.45"> {</span>
<a href="#l176.46"></a><span id="l176.46">   let enumerator = gTargetFolder.messages;</span>
<a href="#l176.47"></a><span id="l176.47">   let numMsgs = 0;</span>
<a href="#l176.48"></a><span id="l176.48">   while (enumerator.hasMoreElements()) {</span>
<a href="#l176.49"></a><span id="l176.49">     numMsgs++;</span>
<a href="#l176.50"></a><span id="l176.50" class="difflineminus">-    do_check_neq(enumerator.getNext()</span>
<a href="#l176.51"></a><span id="l176.51" class="difflineminus">-                  .QueryInterface(Ci.nsIMsgDBHdr).flags &amp; msgFlagOffline, 0);</span>
<a href="#l176.52"></a><span id="l176.52" class="difflineplus">+    Assert.notEqual(enumerator.getNext()</span>
<a href="#l176.53"></a><span id="l176.53" class="difflineplus">+                     .QueryInterface(Ci.nsIMsgDBHdr).flags &amp; msgFlagOffline, 0);</span>
<a href="#l176.54"></a><span id="l176.54">   }</span>
<a href="#l176.55"></a><span id="l176.55" class="difflineminus">-  do_check_eq(2, numMsgs);</span>
<a href="#l176.56"></a><span id="l176.56" class="difflineminus">-  do_check_eq(gAutoSyncListener._waitingForUpdateList.length, 0);</span>
<a href="#l176.57"></a><span id="l176.57" class="difflineminus">-  do_check_false(gAutoSyncListener._waitingForDiscovery);</span>
<a href="#l176.58"></a><span id="l176.58" class="difflineminus">-  do_check_false(gAutoSyncListener._waitingForUpdate);</span>
<a href="#l176.59"></a><span id="l176.59" class="difflineplus">+  Assert.equal(2, numMsgs);</span>
<a href="#l176.60"></a><span id="l176.60" class="difflineplus">+  Assert.equal(gAutoSyncListener._waitingForUpdateList.length, 0);</span>
<a href="#l176.61"></a><span id="l176.61" class="difflineplus">+  Assert.ok(!gAutoSyncListener._waitingForDiscovery);</span>
<a href="#l176.62"></a><span id="l176.62" class="difflineplus">+  Assert.ok(!gAutoSyncListener._waitingForUpdate);</span>
<a href="#l176.63"></a><span id="l176.63">   teardownIMAPPump();</span>
<a href="#l176.64"></a><span id="l176.64"> }</span>
<a href="#l176.65"></a><span id="l176.65"> </span>
<a href="#l176.66"></a><span id="l176.66"> function run_test()</span>
<a href="#l176.67"></a><span id="l176.67"> {</span>
<a href="#l176.68"></a><span id="l176.68">   // Add folder listeners that will capture async events</span>
<a href="#l176.69"></a><span id="l176.69">   const nsIMFNService = Ci.nsIMsgFolderNotificationService;</span>
<a href="#l176.70"></a><span id="l176.70">   let flags =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l177.1"></a><span id="l177.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapChunks.js</span>
<a href="#l177.2"></a><span id="l177.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapChunks.js</span>
<a href="#l177.3"></a><span id="l177.3" class="difflineat">@@ -101,20 +101,20 @@ function endTest()</span>
<a href="#l177.4"></a><span id="l177.4"> }</span>
<a href="#l177.5"></a><span id="l177.5"> </span>
<a href="#l177.6"></a><span id="l177.6"> var UrlListener = </span>
<a href="#l177.7"></a><span id="l177.7"> {</span>
<a href="#l177.8"></a><span id="l177.8">   OnStartRunningUrl: function(url) { },</span>
<a href="#l177.9"></a><span id="l177.9">   OnStopRunningUrl: function(url, rc)</span>
<a href="#l177.10"></a><span id="l177.10">   {</span>
<a href="#l177.11"></a><span id="l177.11">     // operation succeeded</span>
<a href="#l177.12"></a><span id="l177.12" class="difflineminus">-    do_check_eq(rc, 0);</span>
<a href="#l177.13"></a><span id="l177.13" class="difflineplus">+    Assert.equal(rc, 0);</span>
<a href="#l177.14"></a><span id="l177.14"> </span>
<a href="#l177.15"></a><span id="l177.15">     // File contents were not modified</span>
<a href="#l177.16"></a><span id="l177.16" class="difflineminus">-    do_check_eq(IOUtils.loadFileToString(gMsgFile),</span>
<a href="#l177.17"></a><span id="l177.17" class="difflineplus">+    Assert.equal(IOUtils.loadFileToString(gMsgFile),</span>
<a href="#l177.18"></a><span id="l177.18"> 		IOUtils.loadFileToString(gSavedMsgFile));</span>
<a href="#l177.19"></a><span id="l177.19"> </span>
<a href="#l177.20"></a><span id="l177.20">     // The file doesn't get closed straight away, but does after a little bit.</span>
<a href="#l177.21"></a><span id="l177.21">     // So wait, and then remove it. We need to test this to ensure we don't</span>
<a href="#l177.22"></a><span id="l177.22">     // indefinitely lock the file.</span>
<a href="#l177.23"></a><span id="l177.23">     do_timeout(1000, endTest);</span>
<a href="#l177.24"></a><span id="l177.24">   }</span>
<a href="#l177.25"></a><span id="l177.25"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l178.1"></a><span id="l178.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l178.2"></a><span id="l178.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l178.3"></a><span id="l178.3" class="difflineat">@@ -66,29 +66,29 @@ function verifyContentLength() {</span>
<a href="#l178.4"></a><span id="l178.4"> </span>
<a href="#l178.5"></a><span id="l178.5">   // Get a channel from this URI, and check its content length</span>
<a href="#l178.6"></a><span id="l178.6">   let channel = Services.io.newChannelFromURI2(urlToRun,</span>
<a href="#l178.7"></a><span id="l178.7">                                                null,</span>
<a href="#l178.8"></a><span id="l178.8">                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l178.9"></a><span id="l178.9">                                                null,</span>
<a href="#l178.10"></a><span id="l178.10">                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l178.11"></a><span id="l178.11">                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l178.12"></a><span id="l178.12" class="difflineminus">-  do_check_eq(channel.contentLength, gFile.fileSize);</span>
<a href="#l178.13"></a><span id="l178.13" class="difflineplus">+  Assert.equal(channel.contentLength, gFile.fileSize);</span>
<a href="#l178.14"></a><span id="l178.14"> </span>
<a href="#l178.15"></a><span id="l178.15">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l178.16"></a><span id="l178.16">   let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;);</span>
<a href="#l178.17"></a><span id="l178.17">   let attachmentChannel = Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l178.18"></a><span id="l178.18">                                                          null,</span>
<a href="#l178.19"></a><span id="l178.19">                                                          Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l178.20"></a><span id="l178.20">                                                          null,</span>
<a href="#l178.21"></a><span id="l178.21">                                                          Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l178.22"></a><span id="l178.22">                                                          Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l178.23"></a><span id="l178.23">   // Currently attachments have their content length set to the length of the</span>
<a href="#l178.24"></a><span id="l178.24">   // entire message</span>
<a href="#l178.25"></a><span id="l178.25" class="difflineminus">-  do_check_eq(attachmentChannel.contentLength, gFile.fileSize);</span>
<a href="#l178.26"></a><span id="l178.26" class="difflineplus">+  Assert.equal(attachmentChannel.contentLength, gFile.fileSize);</span>
<a href="#l178.27"></a><span id="l178.27"> }</span>
<a href="#l178.28"></a><span id="l178.28"> </span>
<a href="#l178.29"></a><span id="l178.29"> function teardown() {</span>
<a href="#l178.30"></a><span id="l178.30">   MailServices.mfn.removeListener(msgFolderListener);</span>
<a href="#l178.31"></a><span id="l178.31">   teardownIMAPPump();</span>
<a href="#l178.32"></a><span id="l178.32"> }</span>
<a href="#l178.33"></a><span id="l178.33"> </span>
<a href="#l178.34"></a><span id="l178.34"> function run_test() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l179.1"></a><span id="l179.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapCopyTimeout.js</span>
<a href="#l179.2"></a><span id="l179.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapCopyTimeout.js</span>
<a href="#l179.3"></a><span id="l179.3" class="difflineat">@@ -19,17 +19,17 @@ load(&quot;../../../resources/messageGenerato</span>
<a href="#l179.4"></a><span id="l179.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l179.5"></a><span id="l179.5"> </span>
<a href="#l179.6"></a><span id="l179.6"> setupIMAPPump();</span>
<a href="#l179.7"></a><span id="l179.7"> </span>
<a href="#l179.8"></a><span id="l179.8"> var gGotAlert = false;</span>
<a href="#l179.9"></a><span id="l179.9"> var gGotMsgAdded = false;</span>
<a href="#l179.10"></a><span id="l179.10"> </span>
<a href="#l179.11"></a><span id="l179.11"> function alert(aDialogTitle, aText) {</span>
<a href="#l179.12"></a><span id="l179.12" class="difflineminus">-  do_check_true(aText.startsWith(&quot;Connection to server localhost timed out.&quot;));</span>
<a href="#l179.13"></a><span id="l179.13" class="difflineplus">+  Assert.ok(aText.startsWith(&quot;Connection to server localhost timed out.&quot;));</span>
<a href="#l179.14"></a><span id="l179.14">   gGotAlert = true;</span>
<a href="#l179.15"></a><span id="l179.15">   async_driver();</span>
<a href="#l179.16"></a><span id="l179.16"> }</span>
<a href="#l179.17"></a><span id="l179.17"> </span>
<a href="#l179.18"></a><span id="l179.18"> var CopyListener = {</span>
<a href="#l179.19"></a><span id="l179.19">   OnStartCopy: function() {},</span>
<a href="#l179.20"></a><span id="l179.20">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l179.21"></a><span id="l179.21">   SetMessageKey: function(aMsgKey) {},</span>
<a href="#l179.22"></a><span id="l179.22" class="difflineat">@@ -51,17 +51,17 @@ var tests = [</span>
<a href="#l179.23"></a><span id="l179.23"> </span>
<a href="#l179.24"></a><span id="l179.24"> var gTargetFolder;</span>
<a href="#l179.25"></a><span id="l179.25"> function* createTargetFolder()</span>
<a href="#l179.26"></a><span id="l179.26"> {</span>
<a href="#l179.27"></a><span id="l179.27">   IMAPPump.daemon.copySleep = 5000;</span>
<a href="#l179.28"></a><span id="l179.28">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;targetFolder&quot;, null);</span>
<a href="#l179.29"></a><span id="l179.29">   yield false;</span>
<a href="#l179.30"></a><span id="l179.30">   gTargetFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;targetFolder&quot;);</span>
<a href="#l179.31"></a><span id="l179.31" class="difflineminus">-  do_check_true(gTargetFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l179.32"></a><span id="l179.32" class="difflineplus">+  Assert.ok(gTargetFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l179.33"></a><span id="l179.33">   gTargetFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l179.34"></a><span id="l179.34">   yield false;</span>
<a href="#l179.35"></a><span id="l179.35"> }</span>
<a href="#l179.36"></a><span id="l179.36"> </span>
<a href="#l179.37"></a><span id="l179.37"> // load and update a message in the imap fake server</span>
<a href="#l179.38"></a><span id="l179.38"> function* loadImapMessage()</span>
<a href="#l179.39"></a><span id="l179.39"> {</span>
<a href="#l179.40"></a><span id="l179.40">   let messages = [];</span>
<a href="#l179.41"></a><span id="l179.41" class="difflineat">@@ -71,19 +71,19 @@ function* loadImapMessage()</span>
<a href="#l179.42"></a><span id="l179.42">   let msgURI =</span>
<a href="#l179.43"></a><span id="l179.43">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l179.44"></a><span id="l179.44">                        btoa(messages[0].toMessageString()));</span>
<a href="#l179.45"></a><span id="l179.45">   let imapInbox = IMAPPump.daemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l179.46"></a><span id="l179.46">   var gMessage = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l179.47"></a><span id="l179.47">   IMAPPump.mailbox.addMessage(gMessage);</span>
<a href="#l179.48"></a><span id="l179.48">   IMAPPump.inbox.updateFolder(null);</span>
<a href="#l179.49"></a><span id="l179.49">   yield false;</span>
<a href="#l179.50"></a><span id="l179.50" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l179.51"></a><span id="l179.51" class="difflineplus">+  Assert.equal(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l179.52"></a><span id="l179.52">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l179.53"></a><span id="l179.53" class="difflineminus">-  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l179.54"></a><span id="l179.54" class="difflineplus">+  Assert.ok(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l179.55"></a><span id="l179.55"> </span>
<a href="#l179.56"></a><span id="l179.56">   yield true;</span>
<a href="#l179.57"></a><span id="l179.57"> }</span>
<a href="#l179.58"></a><span id="l179.58"> </span>
<a href="#l179.59"></a><span id="l179.59"> // move the message to a diffent folder</span>
<a href="#l179.60"></a><span id="l179.60"> function* moveMessageToTargetFolder()</span>
<a href="#l179.61"></a><span id="l179.61"> {</span>
<a href="#l179.62"></a><span id="l179.62">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l179.63"></a><span id="l179.63" class="difflineat">@@ -112,25 +112,25 @@ function* updateTargetFolder()</span>
<a href="#l179.64"></a><span id="l179.64"> {</span>
<a href="#l179.65"></a><span id="l179.65">   gTargetFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l179.66"></a><span id="l179.66">   yield false;</span>
<a href="#l179.67"></a><span id="l179.67"> }</span>
<a href="#l179.68"></a><span id="l179.68"> </span>
<a href="#l179.69"></a><span id="l179.69"> // Cleanup</span>
<a href="#l179.70"></a><span id="l179.70"> function endTest()</span>
<a href="#l179.71"></a><span id="l179.71"> {</span>
<a href="#l179.72"></a><span id="l179.72" class="difflineminus">-  do_check_true(gGotAlert);</span>
<a href="#l179.73"></a><span id="l179.73" class="difflineplus">+  Assert.ok(gGotAlert);</span>
<a href="#l179.74"></a><span id="l179.74">   // Make sure neither source nor target folder have offline events.</span>
<a href="#l179.75"></a><span id="l179.75" class="difflineminus">-  do_check_false(IMAPPump.inbox.getFlag(Ci.nsMsgFolderFlags.OfflineEvents));</span>
<a href="#l179.76"></a><span id="l179.76" class="difflineminus">-  do_check_false(gTargetFolder.getFlag(Ci.nsMsgFolderFlags.OfflineEvents));</span>
<a href="#l179.77"></a><span id="l179.77" class="difflineplus">+  Assert.ok(!IMAPPump.inbox.getFlag(Ci.nsMsgFolderFlags.OfflineEvents));</span>
<a href="#l179.78"></a><span id="l179.78" class="difflineplus">+  Assert.ok(!gTargetFolder.getFlag(Ci.nsMsgFolderFlags.OfflineEvents));</span>
<a href="#l179.79"></a><span id="l179.79"> </span>
<a href="#l179.80"></a><span id="l179.80">   // fake server does the copy, but then times out, so make sure the target</span>
<a href="#l179.81"></a><span id="l179.81">   // folder has only 1 message, not the multiple ones it would have if we</span>
<a href="#l179.82"></a><span id="l179.82">   // retried.</span>
<a href="#l179.83"></a><span id="l179.83" class="difflineminus">-  do_check_eq(gTargetFolder.getTotalMessages(false), 1);</span>
<a href="#l179.84"></a><span id="l179.84" class="difflineplus">+  Assert.equal(gTargetFolder.getTotalMessages(false), 1);</span>
<a href="#l179.85"></a><span id="l179.85">   teardownIMAPPump();</span>
<a href="#l179.86"></a><span id="l179.86"> }</span>
<a href="#l179.87"></a><span id="l179.87"> </span>
<a href="#l179.88"></a><span id="l179.88"> // listeners</span>
<a href="#l179.89"></a><span id="l179.89"> </span>
<a href="#l179.90"></a><span id="l179.90"> var mfnListener =</span>
<a href="#l179.91"></a><span id="l179.91"> {</span>
<a href="#l179.92"></a><span id="l179.92">   folderAdded: function folderAdded(aFolder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l180.1"></a><span id="l180.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js</span>
<a href="#l180.2"></a><span id="l180.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js</span>
<a href="#l180.3"></a><span id="l180.3" class="difflineat">@@ -81,32 +81,32 @@ var gTestArray =</span>
<a href="#l180.4"></a><span id="l180.4">     Assert.ok(gHeader.isRead);</span>
<a href="#l180.5"></a><span id="l180.5">   },</span>
<a href="#l180.6"></a><span id="l180.6">   function *KillThread() {</span>
<a href="#l180.7"></a><span id="l180.7">     gAction.type = Ci.nsMsgFilterAction.KillThread;</span>
<a href="#l180.8"></a><span id="l180.8">     yield setupTest(gFilter, gAction);</span>
<a href="#l180.9"></a><span id="l180.9">     // In non-postplugin, count here is 0 and not 1.  Need to investigate.</span>
<a href="#l180.10"></a><span id="l180.10">     testCounts(false, 1, 0, 0);</span>
<a href="#l180.11"></a><span id="l180.11">     let thread = db().GetThreadContainingMsgHdr(gHeader);</span>
<a href="#l180.12"></a><span id="l180.12" class="difflineminus">-    do_check_neq(0, thread.flags &amp; Ci.nsMsgMessageFlags.Ignored);</span>
<a href="#l180.13"></a><span id="l180.13" class="difflineplus">+    Assert.notEqual(0, thread.flags &amp; Ci.nsMsgMessageFlags.Ignored);</span>
<a href="#l180.14"></a><span id="l180.14">   },</span>
<a href="#l180.15"></a><span id="l180.15">   function *WatchThread() {</span>
<a href="#l180.16"></a><span id="l180.16">     gAction.type = Ci.nsMsgFilterAction.WatchThread;</span>
<a href="#l180.17"></a><span id="l180.17">     yield setupTest(gFilter, gAction);</span>
<a href="#l180.18"></a><span id="l180.18">     // In non-postplugin, count here is 0 and not 1.  Need to investigate.</span>
<a href="#l180.19"></a><span id="l180.19">     testCounts(false, 1, 0, 0);</span>
<a href="#l180.20"></a><span id="l180.20">     let thread = db().GetThreadContainingMsgHdr(gHeader);</span>
<a href="#l180.21"></a><span id="l180.21" class="difflineminus">-    do_check_neq(0, thread.flags &amp; Ci.nsMsgMessageFlags.Watched);</span>
<a href="#l180.22"></a><span id="l180.22" class="difflineplus">+    Assert.notEqual(0, thread.flags &amp; Ci.nsMsgMessageFlags.Watched);</span>
<a href="#l180.23"></a><span id="l180.23">   },</span>
<a href="#l180.24"></a><span id="l180.24">   function *KillSubthread() {</span>
<a href="#l180.25"></a><span id="l180.25">     gAction.type = Ci.nsMsgFilterAction.KillSubthread;</span>
<a href="#l180.26"></a><span id="l180.26">     yield setupTest(gFilter, gAction);</span>
<a href="#l180.27"></a><span id="l180.27">     // In non-postplugin, count here is 0 and not 1.  Need to investigate.</span>
<a href="#l180.28"></a><span id="l180.28">     testCounts(false, 1, 0, 0);</span>
<a href="#l180.29"></a><span id="l180.29" class="difflineminus">-    do_check_neq(0, gHeader.flags &amp; Ci.nsMsgMessageFlags.Ignored);</span>
<a href="#l180.30"></a><span id="l180.30" class="difflineplus">+    Assert.notEqual(0, gHeader.flags &amp; Ci.nsMsgMessageFlags.Ignored);</span>
<a href="#l180.31"></a><span id="l180.31">   },</span>
<a href="#l180.32"></a><span id="l180.32">   // this tests for marking message as junk</span>
<a href="#l180.33"></a><span id="l180.33">   function *JunkScore() {</span>
<a href="#l180.34"></a><span id="l180.34">     gAction.type = Ci.nsMsgFilterAction.JunkScore;</span>
<a href="#l180.35"></a><span id="l180.35">     gAction.junkScore = 100;</span>
<a href="#l180.36"></a><span id="l180.36">     yield setupTest(gFilter, gAction);</span>
<a href="#l180.37"></a><span id="l180.37">     // marking as junk resets new but not unread</span>
<a href="#l180.38"></a><span id="l180.38">     testCounts(false, 1, 0, 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l181.1"></a><span id="l181.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFlagChange.js</span>
<a href="#l181.2"></a><span id="l181.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFlagChange.js</span>
<a href="#l181.3"></a><span id="l181.3" class="difflineat">@@ -30,77 +30,77 @@ var tests = [</span>
<a href="#l181.4"></a><span id="l181.4">   },</span>
<a href="#l181.5"></a><span id="l181.5">   function* simulateForwardFlagSet() {</span>
<a href="#l181.6"></a><span id="l181.6">     gMessage.setFlag(&quot;$Forwarded&quot;);</span>
<a href="#l181.7"></a><span id="l181.7">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.8"></a><span id="l181.8">     yield false;</span>
<a href="#l181.9"></a><span id="l181.9">   },</span>
<a href="#l181.10"></a><span id="l181.10">   function* checkForwardedFlagSet() {</span>
<a href="#l181.11"></a><span id="l181.11">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l181.12"></a><span id="l181.12" class="difflineminus">-    do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Forwarded,</span>
<a href="#l181.13"></a><span id="l181.13" class="difflineplus">+    Assert.equal(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Forwarded,</span>
<a href="#l181.14"></a><span id="l181.14">       Ci.nsMsgMessageFlags.Forwarded);</span>
<a href="#l181.15"></a><span id="l181.15">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.16"></a><span id="l181.16">     yield false;</span>
<a href="#l181.17"></a><span id="l181.17">   },</span>
<a href="#l181.18"></a><span id="l181.18">   function* clearForwardedFlag() {</span>
<a href="#l181.19"></a><span id="l181.19">     gMessage.clearFlag(&quot;$Forwarded&quot;);</span>
<a href="#l181.20"></a><span id="l181.20">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.21"></a><span id="l181.21">     yield false;</span>
<a href="#l181.22"></a><span id="l181.22">   },</span>
<a href="#l181.23"></a><span id="l181.23">   function* checkForwardedFlagCleared() {</span>
<a href="#l181.24"></a><span id="l181.24">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l181.25"></a><span id="l181.25" class="difflineminus">-    do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Forwarded, 0);</span>
<a href="#l181.26"></a><span id="l181.26" class="difflineplus">+    Assert.equal(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Forwarded, 0);</span>
<a href="#l181.27"></a><span id="l181.27">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.28"></a><span id="l181.28">     yield false;</span>
<a href="#l181.29"></a><span id="l181.29">   },</span>
<a href="#l181.30"></a><span id="l181.30">   function* setSeenFlag() {</span>
<a href="#l181.31"></a><span id="l181.31">     gMessage.setFlag(&quot;\\Seen&quot;);</span>
<a href="#l181.32"></a><span id="l181.32">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.33"></a><span id="l181.33">     yield false;</span>
<a href="#l181.34"></a><span id="l181.34">   },</span>
<a href="#l181.35"></a><span id="l181.35">   function* checkSeenFlagSet() {</span>
<a href="#l181.36"></a><span id="l181.36">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l181.37"></a><span id="l181.37" class="difflineminus">-    do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Read,</span>
<a href="#l181.38"></a><span id="l181.38" class="difflineminus">-                Ci.nsMsgMessageFlags.Read);</span>
<a href="#l181.39"></a><span id="l181.39" class="difflineplus">+    Assert.equal(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Read,</span>
<a href="#l181.40"></a><span id="l181.40" class="difflineplus">+                 Ci.nsMsgMessageFlags.Read);</span>
<a href="#l181.41"></a><span id="l181.41">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.42"></a><span id="l181.42">     yield false;</span>
<a href="#l181.43"></a><span id="l181.43">   },</span>
<a href="#l181.44"></a><span id="l181.44">   function* simulateRepliedFlagSet() {</span>
<a href="#l181.45"></a><span id="l181.45">     gMessage.setFlag(&quot;\\Answered&quot;);</span>
<a href="#l181.46"></a><span id="l181.46">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.47"></a><span id="l181.47">     yield false;</span>
<a href="#l181.48"></a><span id="l181.48">   },</span>
<a href="#l181.49"></a><span id="l181.49">   function* checkRepliedFlagSet() {</span>
<a href="#l181.50"></a><span id="l181.50">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l181.51"></a><span id="l181.51" class="difflineminus">-    do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Replied,</span>
<a href="#l181.52"></a><span id="l181.52" class="difflineplus">+    Assert.equal(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Replied,</span>
<a href="#l181.53"></a><span id="l181.53">       Ci.nsMsgMessageFlags.Replied);</span>
<a href="#l181.54"></a><span id="l181.54">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.55"></a><span id="l181.55">     yield false;</span>
<a href="#l181.56"></a><span id="l181.56">   },</span>
<a href="#l181.57"></a><span id="l181.57">   function* simulateTagAdded() {</span>
<a href="#l181.58"></a><span id="l181.58">     gMessage.setFlag(&quot;randomtag&quot;);</span>
<a href="#l181.59"></a><span id="l181.59">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.60"></a><span id="l181.60">     yield false;</span>
<a href="#l181.61"></a><span id="l181.61">   },</span>
<a href="#l181.62"></a><span id="l181.62">   function* checkTagSet() {</span>
<a href="#l181.63"></a><span id="l181.63">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l181.64"></a><span id="l181.64">     let keywords = msgHdr.getStringProperty(&quot;keywords&quot;);</span>
<a href="#l181.65"></a><span id="l181.65" class="difflineminus">-    do_check_true(keywords.includes(&quot;randomtag&quot;));</span>
<a href="#l181.66"></a><span id="l181.66" class="difflineplus">+    Assert.ok(keywords.includes(&quot;randomtag&quot;));</span>
<a href="#l181.67"></a><span id="l181.67">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.68"></a><span id="l181.68">     yield false;</span>
<a href="#l181.69"></a><span id="l181.69">   },</span>
<a href="#l181.70"></a><span id="l181.70">   function* clearTag() {</span>
<a href="#l181.71"></a><span id="l181.71">     gMessage.clearFlag(&quot;randomtag&quot;);</span>
<a href="#l181.72"></a><span id="l181.72">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.73"></a><span id="l181.73">     yield false;</span>
<a href="#l181.74"></a><span id="l181.74">   },</span>
<a href="#l181.75"></a><span id="l181.75">   function checkTagCleared() {</span>
<a href="#l181.76"></a><span id="l181.76">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l181.77"></a><span id="l181.77">     let keywords = msgHdr.getStringProperty(&quot;keywords&quot;);</span>
<a href="#l181.78"></a><span id="l181.78" class="difflineminus">-    do_check_false(keywords.includes(&quot;randomtag&quot;));</span>
<a href="#l181.79"></a><span id="l181.79" class="difflineplus">+    Assert.ok(!keywords.includes(&quot;randomtag&quot;));</span>
<a href="#l181.80"></a><span id="l181.80">   },</span>
<a href="#l181.81"></a><span id="l181.81">   teardown</span>
<a href="#l181.82"></a><span id="l181.82"> ];</span>
<a href="#l181.83"></a><span id="l181.83"> </span>
<a href="#l181.84"></a><span id="l181.84"> function* setup() {</span>
<a href="#l181.85"></a><span id="l181.85">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span>
<a href="#l181.86"></a><span id="l181.86"> </span>
<a href="#l181.87"></a><span id="l181.87">   setupIMAPPump();</span>
<a href="#l181.88"></a><span id="l181.88" class="difflineat">@@ -120,17 +120,17 @@ function* setup() {</span>
<a href="#l181.89"></a><span id="l181.89">   IMAPPump.mailbox.addMessage(gMessage);</span>
<a href="#l181.90"></a><span id="l181.90"> </span>
<a href="#l181.91"></a><span id="l181.91">   // update folder to download header.</span>
<a href="#l181.92"></a><span id="l181.92">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l181.93"></a><span id="l181.93">   yield false;</span>
<a href="#l181.94"></a><span id="l181.94"> }</span>
<a href="#l181.95"></a><span id="l181.95"> </span>
<a href="#l181.96"></a><span id="l181.96"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l181.97"></a><span id="l181.97" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l181.98"></a><span id="l181.98" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l181.99"></a><span id="l181.99"> };</span>
<a href="#l181.100"></a><span id="l181.100"> </span>
<a href="#l181.101"></a><span id="l181.101"> function teardown() {</span>
<a href="#l181.102"></a><span id="l181.102">   teardownIMAPPump();</span>
<a href="#l181.103"></a><span id="l181.103"> }</span>
<a href="#l181.104"></a><span id="l181.104"> </span>
<a href="#l181.105"></a><span id="l181.105"> function run_test() {</span>
<a href="#l181.106"></a><span id="l181.106">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l182.1"></a><span id="l182.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l182.2"></a><span id="l182.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l182.3"></a><span id="l182.3" class="difflineat">@@ -40,19 +40,19 @@ var tests = [</span>
<a href="#l182.4"></a><span id="l182.4">   },</span>
<a href="#l182.5"></a><span id="l182.5">   function verifyFolders() {</span>
<a href="#l182.6"></a><span id="l182.6">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l182.7"></a><span id="l182.7">     dump(&quot;found folder1\n&quot;);</span>
<a href="#l182.8"></a><span id="l182.8">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l182.9"></a><span id="l182.9">     dump(&quot;found folder2\n&quot;);</span>
<a href="#l182.10"></a><span id="l182.10">     let folder3 = IMAPPump.inbox.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l182.11"></a><span id="l182.11">     dump(&quot;found folder3\n&quot;);</span>
<a href="#l182.12"></a><span id="l182.12" class="difflineminus">-    do_check_true(folder1 !== null);</span>
<a href="#l182.13"></a><span id="l182.13" class="difflineminus">-    do_check_true(folder2 !== null);</span>
<a href="#l182.14"></a><span id="l182.14" class="difflineminus">-    do_check_true(folder3 !== null);</span>
<a href="#l182.15"></a><span id="l182.15" class="difflineplus">+    Assert.ok(folder1 !== null);</span>
<a href="#l182.16"></a><span id="l182.16" class="difflineplus">+    Assert.ok(folder2 !== null);</span>
<a href="#l182.17"></a><span id="l182.17" class="difflineplus">+    Assert.ok(folder3 !== null);</span>
<a href="#l182.18"></a><span id="l182.18">   },</span>
<a href="#l182.19"></a><span id="l182.19">   function* moveImapFolder1() {</span>
<a href="#l182.20"></a><span id="l182.20">     let folders = new Array;</span>
<a href="#l182.21"></a><span id="l182.21">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l182.22"></a><span id="l182.22">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l182.23"></a><span id="l182.23">     folders.push(folder2.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l182.24"></a><span id="l182.24">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l182.25"></a><span id="l182.25">     MailServices.copy.CopyFolders(array, folder1, true, CopyListener, null);</span>
<a href="#l182.26"></a><span id="l182.26" class="difflineat">@@ -69,19 +69,19 @@ var tests = [</span>
<a href="#l182.27"></a><span id="l182.27">   },</span>
<a href="#l182.28"></a><span id="l182.28">   function verifyImapFolders() {</span>
<a href="#l182.29"></a><span id="l182.29">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l182.30"></a><span id="l182.30">     dump(&quot;found folder1\n&quot;);</span>
<a href="#l182.31"></a><span id="l182.31">     let folder2 = folder1.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l182.32"></a><span id="l182.32">     dump(&quot;found folder2\n&quot;);</span>
<a href="#l182.33"></a><span id="l182.33">     let folder3 = folder1.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l182.34"></a><span id="l182.34">     dump(&quot;found folder3\n&quot;);</span>
<a href="#l182.35"></a><span id="l182.35" class="difflineminus">-    do_check_true(folder1 !== null);</span>
<a href="#l182.36"></a><span id="l182.36" class="difflineminus">-    do_check_true(folder2 !== null);</span>
<a href="#l182.37"></a><span id="l182.37" class="difflineminus">-    do_check_true(folder3 !== null);</span>
<a href="#l182.38"></a><span id="l182.38" class="difflineplus">+    Assert.ok(folder1 !== null);</span>
<a href="#l182.39"></a><span id="l182.39" class="difflineplus">+    Assert.ok(folder2 !== null);</span>
<a href="#l182.40"></a><span id="l182.40" class="difflineplus">+    Assert.ok(folder3 !== null);</span>
<a href="#l182.41"></a><span id="l182.41">   },</span>
<a href="#l182.42"></a><span id="l182.42">   function* testImapFolderCopyFailure() {</span>
<a href="#l182.43"></a><span id="l182.43">     let folders = new Array;</span>
<a href="#l182.44"></a><span id="l182.44">     folders.push(gNotEmptyLocal4.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l182.45"></a><span id="l182.45">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l182.46"></a><span id="l182.46">     IMAPPump.daemon.commandToFail = &quot;APPEND&quot;;</span>
<a href="#l182.47"></a><span id="l182.47">     // we expect NS_MSG_ERROR_IMAP_COMMAND_FAILED;</span>
<a href="#l182.48"></a><span id="l182.48">     CopyListener._expectedStatus = 0x80550021;</span>
<a href="#l182.49"></a><span id="l182.49" class="difflineat">@@ -122,17 +122,17 @@ function setup() {</span>
<a href="#l182.50"></a><span id="l182.50"> var CopyListener = {</span>
<a href="#l182.51"></a><span id="l182.51">   _expectedStatus : 0,</span>
<a href="#l182.52"></a><span id="l182.52">   OnStartCopy: function() {},</span>
<a href="#l182.53"></a><span id="l182.53">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l182.54"></a><span id="l182.54">   SetMessageKey: function(aKey) {},</span>
<a href="#l182.55"></a><span id="l182.55">   SetMessageId: function(aMessageId) {},</span>
<a href="#l182.56"></a><span id="l182.56">   OnStopCopy: function(aStatus) {</span>
<a href="#l182.57"></a><span id="l182.57">     // Check: message successfully copied.</span>
<a href="#l182.58"></a><span id="l182.58" class="difflineminus">-    do_check_eq(aStatus, this._expectedStatus);</span>
<a href="#l182.59"></a><span id="l182.59" class="difflineplus">+    Assert.equal(aStatus, this._expectedStatus);</span>
<a href="#l182.60"></a><span id="l182.60">     async_driver();</span>
<a href="#l182.61"></a><span id="l182.61">   }</span>
<a href="#l182.62"></a><span id="l182.62"> };</span>
<a href="#l182.63"></a><span id="l182.63"> </span>
<a href="#l182.64"></a><span id="l182.64"> function teardown() {</span>
<a href="#l182.65"></a><span id="l182.65">   teardownIMAPPump();</span>
<a href="#l182.66"></a><span id="l182.66"> }</span>
<a href="#l182.67"></a><span id="l182.67"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l183.1"></a><span id="l183.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHdrChunking.js</span>
<a href="#l183.2"></a><span id="l183.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHdrChunking.js</span>
<a href="#l183.3"></a><span id="l183.3" class="difflineat">@@ -67,26 +67,26 @@ function* uploadImapMessages()</span>
<a href="#l183.4"></a><span id="l183.4">   // updateFolderWithListener with null for nsIMsgWindow makes biff notify.</span>
<a href="#l183.5"></a><span id="l183.5">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l183.6"></a><span id="l183.6">   yield false;</span>
<a href="#l183.7"></a><span id="l183.7"> }</span>
<a href="#l183.8"></a><span id="l183.8"> </span>
<a href="#l183.9"></a><span id="l183.9"> function* testMessageFetched() {</span>
<a href="#l183.10"></a><span id="l183.10">   // If we're really chunking, then the message fetch should have started before</span>
<a href="#l183.11"></a><span id="l183.11">   // we finished the updateFolder URL.</span>
<a href="#l183.12"></a><span id="l183.12" class="difflineminus">-  do_check_true(gFolderListener._gotNewMailBiff);</span>
<a href="#l183.13"></a><span id="l183.13" class="difflineplus">+  Assert.ok(gFolderListener._gotNewMailBiff);</span>
<a href="#l183.14"></a><span id="l183.14">   // Should have only downloaded first chunk of headers when message</span>
<a href="#l183.15"></a><span id="l183.15">   // has finished streaming.</span>
<a href="#l183.16"></a><span id="l183.16" class="difflineminus">-  do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 3);</span>
<a href="#l183.17"></a><span id="l183.17" class="difflineplus">+  Assert.equal(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 3);</span>
<a href="#l183.18"></a><span id="l183.18">   yield false;</span>
<a href="#l183.19"></a><span id="l183.19"> }</span>
<a href="#l183.20"></a><span id="l183.20"> </span>
<a href="#l183.21"></a><span id="l183.21"> function* testHdrsDownloaded() {</span>
<a href="#l183.22"></a><span id="l183.22">   // Make sure we got all 10 headers.</span>
<a href="#l183.23"></a><span id="l183.23" class="difflineminus">-  do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 10);</span>
<a href="#l183.24"></a><span id="l183.24" class="difflineplus">+  Assert.equal(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 10);</span>
<a href="#l183.25"></a><span id="l183.25">   yield true;</span>
<a href="#l183.26"></a><span id="l183.26"> }</span>
<a href="#l183.27"></a><span id="l183.27"> </span>
<a href="#l183.28"></a><span id="l183.28"> // Cleanup</span>
<a href="#l183.29"></a><span id="l183.29"> function endTest() {</span>
<a href="#l183.30"></a><span id="l183.30">   teardownIMAPPump();</span>
<a href="#l183.31"></a><span id="l183.31"> }</span>
<a href="#l183.32"></a><span id="l183.32"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l184.1"></a><span id="l184.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHdrStreaming.js</span>
<a href="#l184.2"></a><span id="l184.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHdrStreaming.js</span>
<a href="#l184.3"></a><span id="l184.3" class="difflineat">@@ -32,18 +32,18 @@ var streamListener =</span>
<a href="#l184.4"></a><span id="l184.4"> </span>
<a href="#l184.5"></a><span id="l184.5">   QueryInterface:</span>
<a href="#l184.6"></a><span id="l184.6">     XPCOMUtils.generateQI([Ci.nsIStreamListener, Ci.nsIRequestObserver]),</span>
<a href="#l184.7"></a><span id="l184.7"> </span>
<a href="#l184.8"></a><span id="l184.8">   // nsIRequestObserver</span>
<a href="#l184.9"></a><span id="l184.9">   onStartRequest: function(aRequest, aContext) {</span>
<a href="#l184.10"></a><span id="l184.10">   },</span>
<a href="#l184.11"></a><span id="l184.11">   onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l184.12"></a><span id="l184.12" class="difflineminus">-    do_check_eq(aStatusCode, 0);</span>
<a href="#l184.13"></a><span id="l184.13" class="difflineminus">-    do_check_true(this._data.includes(&quot;Content-Type&quot;));</span>
<a href="#l184.14"></a><span id="l184.14" class="difflineplus">+    Assert.equal(aStatusCode, 0);</span>
<a href="#l184.15"></a><span id="l184.15" class="difflineplus">+    Assert.ok(this._data.includes(&quot;Content-Type&quot;));</span>
<a href="#l184.16"></a><span id="l184.16">     async_driver();</span>
<a href="#l184.17"></a><span id="l184.17">   },</span>
<a href="#l184.18"></a><span id="l184.18"> </span>
<a href="#l184.19"></a><span id="l184.19">   // nsIStreamListener</span>
<a href="#l184.20"></a><span id="l184.20">   onDataAvailable: function(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l184.21"></a><span id="l184.21">     if (this._stream == null) {</span>
<a href="#l184.22"></a><span id="l184.22">       this._stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l184.23"></a><span id="l184.23">       this._stream.init(aInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l185.1"></a><span id="l185.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l185.2"></a><span id="l185.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l185.3"></a><span id="l185.3" class="difflineat">@@ -114,17 +114,17 @@ function* doMoves() {</span>
<a href="#l185.4"></a><span id="l185.4">                                  CopyListener, gDummyMsgWindow, true);</span>
<a href="#l185.5"></a><span id="l185.5">   yield false;</span>
<a href="#l185.6"></a><span id="l185.6">   gIMAPInbox.updateFolderWithListener(null, UrlListener);</span>
<a href="#l185.7"></a><span id="l185.7">   yield false;</span>
<a href="#l185.8"></a><span id="l185.8">   gFolder1.updateFolderWithListener(gDummyMsgWindow, UrlListener);</span>
<a href="#l185.9"></a><span id="l185.9">   yield false;</span>
<a href="#l185.10"></a><span id="l185.10">   // Check that playing back offline events gets rid of dummy</span>
<a href="#l185.11"></a><span id="l185.11">   // headers, and thus highWater is recalculated.</span>
<a href="#l185.12"></a><span id="l185.12" class="difflineminus">-  do_check_eq(gFolder1.msgDatabase.dBFolderInfo.highWater, 6);</span>
<a href="#l185.13"></a><span id="l185.13" class="difflineplus">+  Assert.equal(gFolder1.msgDatabase.dBFolderInfo.highWater, 6);</span>
<a href="#l185.14"></a><span id="l185.14">   headers1 = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l185.15"></a><span id="l185.15">                 .createInstance(Ci.nsIMutableArray);</span>
<a href="#l185.16"></a><span id="l185.16">   msgEnumerator = gIMAPInbox.msgDatabase.EnumerateMessages();</span>
<a href="#l185.17"></a><span id="l185.17">   for (let i = 0; i &lt; 5 &amp;&amp; msgEnumerator.hasMoreElements(); i++)</span>
<a href="#l185.18"></a><span id="l185.18">   {</span>
<a href="#l185.19"></a><span id="l185.19">     let header = msgEnumerator.getNext();</span>
<a href="#l185.20"></a><span id="l185.20">     if (header instanceof Components.interfaces.nsIMsgDBHdr)</span>
<a href="#l185.21"></a><span id="l185.21">       headers1.appendElement(header);</span>
<a href="#l185.22"></a><span id="l185.22" class="difflineat">@@ -140,40 +140,40 @@ function* doMoves() {</span>
<a href="#l185.23"></a><span id="l185.23"> </span>
<a href="#l185.24"></a><span id="l185.24">   gFolder1.msgDatabase.DeleteHeader(msgHdr, null, true, false);</span>
<a href="#l185.25"></a><span id="l185.25">   gIMAPInbox.updateFolderWithListener(null, UrlListener);</span>
<a href="#l185.26"></a><span id="l185.26">   yield false;</span>
<a href="#l185.27"></a><span id="l185.27">   // this should clear the dummy headers.</span>
<a href="#l185.28"></a><span id="l185.28">   gFolder1.updateFolderWithListener(gDummyMsgWindow, UrlListener);</span>
<a href="#l185.29"></a><span id="l185.29">   yield false;</span>
<a href="#l185.30"></a><span id="l185.30">   let serverSink = gIMAPIncomingServer.QueryInterface(Ci.nsIImapServerSink);</span>
<a href="#l185.31"></a><span id="l185.31" class="difflineminus">-  do_check_eq(gFolder1.msgDatabase.dBFolderInfo.highWater, 11);</span>
<a href="#l185.32"></a><span id="l185.32" class="difflineplus">+  Assert.equal(gFolder1.msgDatabase.dBFolderInfo.highWater, 11);</span>
<a href="#l185.33"></a><span id="l185.33">   yield true;</span>
<a href="#l185.34"></a><span id="l185.34"> }</span>
<a href="#l185.35"></a><span id="l185.35"> </span>
<a href="#l185.36"></a><span id="l185.36"> var UrlListener =</span>
<a href="#l185.37"></a><span id="l185.37"> {</span>
<a href="#l185.38"></a><span id="l185.38">   OnStartRunningUrl: function(url) { },</span>
<a href="#l185.39"></a><span id="l185.39">   OnStopRunningUrl: function(url, rc)</span>
<a href="#l185.40"></a><span id="l185.40">   {</span>
<a href="#l185.41"></a><span id="l185.41">     // Check for ok status.</span>
<a href="#l185.42"></a><span id="l185.42" class="difflineminus">-    do_check_eq(rc, 0);</span>
<a href="#l185.43"></a><span id="l185.43" class="difflineplus">+    Assert.equal(rc, 0);</span>
<a href="#l185.44"></a><span id="l185.44">     async_driver();</span>
<a href="#l185.45"></a><span id="l185.45">   }</span>
<a href="#l185.46"></a><span id="l185.46"> };</span>
<a href="#l185.47"></a><span id="l185.47"> </span>
<a href="#l185.48"></a><span id="l185.48"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l185.49"></a><span id="l185.49"> var CopyListener = </span>
<a href="#l185.50"></a><span id="l185.50"> {</span>
<a href="#l185.51"></a><span id="l185.51">   OnStartCopy: function() {},</span>
<a href="#l185.52"></a><span id="l185.52">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l185.53"></a><span id="l185.53">   SetMessageKey: function(aKey){},</span>
<a href="#l185.54"></a><span id="l185.54">   SetMessageId: function(aMessageId) {},</span>
<a href="#l185.55"></a><span id="l185.55">   OnStopCopy: function(aStatus){</span>
<a href="#l185.56"></a><span id="l185.56" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l185.57"></a><span id="l185.57" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l185.58"></a><span id="l185.58">     async_driver();</span>
<a href="#l185.59"></a><span id="l185.59">   }</span>
<a href="#l185.60"></a><span id="l185.60"> };</span>
<a href="#l185.61"></a><span id="l185.61"> </span>
<a href="#l185.62"></a><span id="l185.62"> // Definition of tests</span>
<a href="#l185.63"></a><span id="l185.63"> var tests = [</span>
<a href="#l185.64"></a><span id="l185.64">   setupFolders,</span>
<a href="#l185.65"></a><span id="l185.65">   doMoves,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l186.1"></a><span id="l186.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapID.js</span>
<a href="#l186.2"></a><span id="l186.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapID.js</span>
<a href="#l186.3"></a><span id="l186.3" class="difflineat">@@ -23,17 +23,17 @@ add_task(function* setup() {</span>
<a href="#l186.4"></a><span id="l186.4"> add_task(function* updateInbox() {</span>
<a href="#l186.5"></a><span id="l186.5">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l186.6"></a><span id="l186.6">   let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l186.7"></a><span id="l186.7">   IMAPPump.inbox.updateFolderWithListener(null, promiseUrlListener);</span>
<a href="#l186.8"></a><span id="l186.8">   yield promiseUrlListener.promise;</span>
<a href="#l186.9"></a><span id="l186.9"> });</span>
<a href="#l186.10"></a><span id="l186.10"> </span>
<a href="#l186.11"></a><span id="l186.11"> add_task(function checkIDHandling() {</span>
<a href="#l186.12"></a><span id="l186.12" class="difflineminus">-  do_check_eq(IMAPPump.daemon.clientID, &quot;(\&quot;name\&quot; \&quot;xpcshell\&quot; \&quot;version\&quot; \&quot;1\&quot;)&quot;);</span>
<a href="#l186.13"></a><span id="l186.13" class="difflineminus">-  do_check_eq(IMAPPump.incomingServer.serverIDPref, kIDResponse);</span>
<a href="#l186.14"></a><span id="l186.14" class="difflineplus">+  Assert.equal(IMAPPump.daemon.clientID, &quot;(\&quot;name\&quot; \&quot;xpcshell\&quot; \&quot;version\&quot; \&quot;1\&quot;)&quot;);</span>
<a href="#l186.15"></a><span id="l186.15" class="difflineplus">+  Assert.equal(IMAPPump.incomingServer.serverIDPref, kIDResponse);</span>
<a href="#l186.16"></a><span id="l186.16"> });</span>
<a href="#l186.17"></a><span id="l186.17"> </span>
<a href="#l186.18"></a><span id="l186.18"> add_task(teardownIMAPPump);</span>
<a href="#l186.19"></a><span id="l186.19"> </span>
<a href="#l186.20"></a><span id="l186.20"> function run_test() {</span>
<a href="#l186.21"></a><span id="l186.21">   run_next_test();</span>
<a href="#l186.22"></a><span id="l186.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l187.1"></a><span id="l187.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapPasswordFailure.js</span>
<a href="#l187.2"></a><span id="l187.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapPasswordFailure.js</span>
<a href="#l187.3"></a><span id="l187.3" class="difflineat">@@ -82,70 +82,70 @@ add_task(function *() {</span>
<a href="#l187.4"></a><span id="l187.4">   // out of the signons file (first removing the value that</span>
<a href="#l187.5"></a><span id="l187.5">   // createLocalIMAPServer puts in there).</span>
<a href="#l187.6"></a><span id="l187.6">   incomingServer.password = &quot;&quot;;</span>
<a href="#l187.7"></a><span id="l187.7">   let password = incomingServer.getPasswordWithUI(&quot;Prompt Message&quot;,</span>
<a href="#l187.8"></a><span id="l187.8">                                                   &quot;Prompt Title&quot;, null, {});</span>
<a href="#l187.9"></a><span id="l187.9"> </span>
<a href="#l187.10"></a><span id="l187.10">   // The fake server expects one password, but we're feeding it an invalid one</span>
<a href="#l187.11"></a><span id="l187.11">   // initially so that we can check what happens when password is denied.</span>
<a href="#l187.12"></a><span id="l187.12" class="difflineminus">-  do_check_eq(password, kInvalidPassword);</span>
<a href="#l187.13"></a><span id="l187.13" class="difflineplus">+  Assert.equal(password, kInvalidPassword);</span>
<a href="#l187.14"></a><span id="l187.14"> </span>
<a href="#l187.15"></a><span id="l187.15">   // First step, try and perform a subscribe where we won't be able to log in.</span>
<a href="#l187.16"></a><span id="l187.16">   // This covers attempts 1 and 2 in confirmEx.</span>
<a href="#l187.17"></a><span id="l187.17">   dump(&quot;\nperformExpand 1\n\n&quot;);</span>
<a href="#l187.18"></a><span id="l187.18"> </span>
<a href="#l187.19"></a><span id="l187.19">   incomingServer.performExpand(gDummyMsgWindow);</span>
<a href="#l187.20"></a><span id="l187.20">   server.performTest(&quot;SUBSCRIBE&quot;);</span>
<a href="#l187.21"></a><span id="l187.21"> </span>
<a href="#l187.22"></a><span id="l187.22">   dump(&quot;\nfinished subscribe 1\n\n&quot;);</span>
<a href="#l187.23"></a><span id="l187.23"> </span>
<a href="#l187.24"></a><span id="l187.24" class="difflineminus">-  do_check_eq(attempt, 2);</span>
<a href="#l187.25"></a><span id="l187.25" class="difflineplus">+  Assert.equal(attempt, 2);</span>
<a href="#l187.26"></a><span id="l187.26"> </span>
<a href="#l187.27"></a><span id="l187.27">   let rootFolder = incomingServer.rootFolder;</span>
<a href="#l187.28"></a><span id="l187.28" class="difflineminus">-  do_check_true(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l187.29"></a><span id="l187.29" class="difflineminus">-  do_check_false(rootFolder.containsChildNamed(&quot;Subscribed&quot;));</span>
<a href="#l187.30"></a><span id="l187.30" class="difflineplus">+  Assert.ok(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l187.31"></a><span id="l187.31" class="difflineplus">+  Assert.ok(!rootFolder.containsChildNamed(&quot;Subscribed&quot;));</span>
<a href="#l187.32"></a><span id="l187.32"> </span>
<a href="#l187.33"></a><span id="l187.33">   // Check that we haven't forgotten the login even though we've retried and</span>
<a href="#l187.34"></a><span id="l187.34">   // canceled.</span>
<a href="#l187.35"></a><span id="l187.35"> </span>
<a href="#l187.36"></a><span id="l187.36">   let count = {};</span>
<a href="#l187.37"></a><span id="l187.37">   let logins = Services.logins.findLogins(count, &quot;imap://localhost&quot;, null,</span>
<a href="#l187.38"></a><span id="l187.38">                                           &quot;imap://localhost&quot;);</span>
<a href="#l187.39"></a><span id="l187.39"> </span>
<a href="#l187.40"></a><span id="l187.40" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l187.41"></a><span id="l187.41" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l187.42"></a><span id="l187.42" class="difflineminus">-  do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l187.43"></a><span id="l187.43" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l187.44"></a><span id="l187.44" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l187.45"></a><span id="l187.45" class="difflineplus">+  Assert.equal(logins[0].password, kInvalidPassword);</span>
<a href="#l187.46"></a><span id="l187.46"> </span>
<a href="#l187.47"></a><span id="l187.47">   server.resetTest();</span>
<a href="#l187.48"></a><span id="l187.48"> </span>
<a href="#l187.49"></a><span id="l187.49">   dump(&quot;\nperformExpand 2\n\n&quot;);</span>
<a href="#l187.50"></a><span id="l187.50"> </span>
<a href="#l187.51"></a><span id="l187.51">   incomingServer.performExpand(gDummyMsgWindow);</span>
<a href="#l187.52"></a><span id="l187.52">   server.performTest(&quot;SUBSCRIBE&quot;);</span>
<a href="#l187.53"></a><span id="l187.53"> </span>
<a href="#l187.54"></a><span id="l187.54">   dump(&quot;\nfinished subscribe 2\n&quot;);</span>
<a href="#l187.55"></a><span id="l187.55"> </span>
<a href="#l187.56"></a><span id="l187.56" class="difflineminus">-  do_check_true(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l187.57"></a><span id="l187.57" class="difflineminus">-  do_check_true(rootFolder.containsChildNamed(&quot;Subscribed&quot;));</span>
<a href="#l187.58"></a><span id="l187.58" class="difflineplus">+  Assert.ok(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l187.59"></a><span id="l187.59" class="difflineplus">+  Assert.ok(rootFolder.containsChildNamed(&quot;Subscribed&quot;));</span>
<a href="#l187.60"></a><span id="l187.60"> </span>
<a href="#l187.61"></a><span id="l187.61">   // Now check the new one has been saved.</span>
<a href="#l187.62"></a><span id="l187.62">   logins = Services.logins.findLogins(count, &quot;imap://localhost&quot;, null,</span>
<a href="#l187.63"></a><span id="l187.63">                                       &quot;imap://localhost&quot;);</span>
<a href="#l187.64"></a><span id="l187.64"> </span>
<a href="#l187.65"></a><span id="l187.65" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l187.66"></a><span id="l187.66" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l187.67"></a><span id="l187.67" class="difflineminus">-  do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l187.68"></a><span id="l187.68" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l187.69"></a><span id="l187.69" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l187.70"></a><span id="l187.70" class="difflineplus">+  Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l187.71"></a><span id="l187.71"> </span>
<a href="#l187.72"></a><span id="l187.72">   // Remove the login via the incoming server.</span>
<a href="#l187.73"></a><span id="l187.73">   incomingServer.forgetPassword();</span>
<a href="#l187.74"></a><span id="l187.74">   logins = Services.logins.findLogins(count, &quot;imap://localhost&quot;, null,</span>
<a href="#l187.75"></a><span id="l187.75">                                       &quot;imap://localhost&quot;);</span>
<a href="#l187.76"></a><span id="l187.76"> </span>
<a href="#l187.77"></a><span id="l187.77" class="difflineminus">-  do_check_eq(count.value, 0);</span>
<a href="#l187.78"></a><span id="l187.78" class="difflineplus">+  Assert.equal(count.value, 0);</span>
<a href="#l187.79"></a><span id="l187.79"> </span>
<a href="#l187.80"></a><span id="l187.80">   do_timeout(500, endTest);</span>
<a href="#l187.81"></a><span id="l187.81"> });</span>
<a href="#l187.82"></a><span id="l187.82"> </span>
<a href="#l187.83"></a><span id="l187.83"> function endTest() {</span>
<a href="#l187.84"></a><span id="l187.84">   incomingServer.closeCachedConnections();</span>
<a href="#l187.85"></a><span id="l187.85">   server.stop();</span>
<a href="#l187.86"></a><span id="l187.86"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l188.1"></a><span id="l188.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapProtocols.js</span>
<a href="#l188.2"></a><span id="l188.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapProtocols.js</span>
<a href="#l188.3"></a><span id="l188.3" class="difflineat">@@ -30,25 +30,25 @@ function run_test() {</span>
<a href="#l188.4"></a><span id="l188.4"> </span>
<a href="#l188.5"></a><span id="l188.5">   for (var part = 0; part &lt; protocols.length; ++part) {</span>
<a href="#l188.6"></a><span id="l188.6">     print(&quot;protocol: &quot; + protocols[part].protocol);</span>
<a href="#l188.7"></a><span id="l188.7"> </span>
<a href="#l188.8"></a><span id="l188.8">     var pH = Cc[&quot;@mozilla.org/network/protocol;1?name=&quot; +</span>
<a href="#l188.9"></a><span id="l188.9">                 protocols[part].protocol]</span>
<a href="#l188.10"></a><span id="l188.10">                .createInstance(Ci.nsIProtocolHandler);</span>
<a href="#l188.11"></a><span id="l188.11"> </span>
<a href="#l188.12"></a><span id="l188.12" class="difflineminus">-    do_check_eq(pH.scheme, protocols[part].protocol);</span>
<a href="#l188.13"></a><span id="l188.13" class="difflineminus">-    do_check_eq(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l188.14"></a><span id="l188.14" class="difflineminus">-    do_check_eq(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l188.15"></a><span id="l188.15" class="difflineplus">+    Assert.equal(pH.scheme, protocols[part].protocol);</span>
<a href="#l188.16"></a><span id="l188.16" class="difflineplus">+    Assert.equal(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l188.17"></a><span id="l188.17" class="difflineplus">+    Assert.equal(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l188.18"></a><span id="l188.18"> </span>
<a href="#l188.19"></a><span id="l188.19">     // Whip through some of the ports to check we get the right results.</span>
<a href="#l188.20"></a><span id="l188.20">     // IMAP allows connecting to any port.</span>
<a href="#l188.21"></a><span id="l188.21">     for (let i = 0; i &lt; 1024; ++i)</span>
<a href="#l188.22"></a><span id="l188.22" class="difflineminus">-      do_check_true(pH.allowPort(i, &quot;&quot;));</span>
<a href="#l188.23"></a><span id="l188.23" class="difflineplus">+      Assert.ok(pH.allowPort(i, &quot;&quot;));</span>
<a href="#l188.24"></a><span id="l188.24"> </span>
<a href="#l188.25"></a><span id="l188.25">     // Check we get a URI when we ask for one</span>
<a href="#l188.26"></a><span id="l188.26">     var uri = pH.newURI(protocols[part].urlSpec);</span>
<a href="#l188.27"></a><span id="l188.27"> </span>
<a href="#l188.28"></a><span id="l188.28">     uri.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l188.29"></a><span id="l188.29"> </span>
<a href="#l188.30"></a><span id="l188.30" class="difflineminus">-    do_check_eq(uri.spec, protocols[part].urlSpec);</span>
<a href="#l188.31"></a><span id="l188.31" class="difflineplus">+    Assert.equal(uri.spec, protocols[part].urlSpec);</span>
<a href="#l188.32"></a><span id="l188.32">   }</span>
<a href="#l188.33"></a><span id="l188.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l189.1"></a><span id="l189.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapRename.js</span>
<a href="#l189.2"></a><span id="l189.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapRename.js</span>
<a href="#l189.3"></a><span id="l189.3" class="difflineat">@@ -35,19 +35,19 @@ function* test_rename() {</span>
<a href="#l189.4"></a><span id="l189.4"> </span>
<a href="#l189.5"></a><span id="l189.5">   targetFolder.rename(&quot;folder \u00e1&quot;, null);</span>
<a href="#l189.6"></a><span id="l189.6"> </span>
<a href="#l189.7"></a><span id="l189.7">   IMAPPump.server.performTest(&quot;RENAME&quot;);</span>
<a href="#l189.8"></a><span id="l189.8">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l189.9"></a><span id="l189.9">   yield false;</span>
<a href="#l189.10"></a><span id="l189.10"> </span>
<a href="#l189.11"></a><span id="l189.11">   let folder = rootFolder.getChildNamed(&quot;folder \u00e1&quot;);</span>
<a href="#l189.12"></a><span id="l189.12" class="difflineminus">-  do_check_true(folder.msgDatabase.summaryValid);</span>
<a href="#l189.13"></a><span id="l189.13" class="difflineminus">-  do_check_eq(&quot;folder &amp;AOE-&quot;, folder.filePath.leafName);</span>
<a href="#l189.14"></a><span id="l189.14" class="difflineminus">-  do_check_eq(&quot;folder \u00e1&quot;, folder.prettyName);</span>
<a href="#l189.15"></a><span id="l189.15" class="difflineplus">+  Assert.ok(folder.msgDatabase.summaryValid);</span>
<a href="#l189.16"></a><span id="l189.16" class="difflineplus">+  Assert.equal(&quot;folder &amp;AOE-&quot;, folder.filePath.leafName);</span>
<a href="#l189.17"></a><span id="l189.17" class="difflineplus">+  Assert.equal(&quot;folder \u00e1&quot;, folder.prettyName);</span>
<a href="#l189.18"></a><span id="l189.18"> </span>
<a href="#l189.19"></a><span id="l189.19">   yield true;</span>
<a href="#l189.20"></a><span id="l189.20"> }</span>
<a href="#l189.21"></a><span id="l189.21"> </span>
<a href="#l189.22"></a><span id="l189.22"> var mfnListener =</span>
<a href="#l189.23"></a><span id="l189.23"> {</span>
<a href="#l189.24"></a><span id="l189.24">   folderAdded: function folderAdded(aFolder)</span>
<a href="#l189.25"></a><span id="l189.25">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l190.1"></a><span id="l190.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapSearch.js</span>
<a href="#l190.2"></a><span id="l190.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapSearch.js</span>
<a href="#l190.3"></a><span id="l190.3" class="difflineat">@@ -243,34 +243,34 @@ var searchTests =</span>
<a href="#l190.4"></a><span id="l190.4"> // load and update a message in the imap fake server</span>
<a href="#l190.5"></a><span id="l190.5"> function* loadImapMessage()</span>
<a href="#l190.6"></a><span id="l190.6"> {</span>
<a href="#l190.7"></a><span id="l190.7">   IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l190.8"></a><span id="l190.8">                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l190.9"></a><span id="l190.9">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l190.10"></a><span id="l190.10">   yield false;</span>
<a href="#l190.11"></a><span id="l190.11"> </span>
<a href="#l190.12"></a><span id="l190.12" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l190.13"></a><span id="l190.13" class="difflineplus">+  Assert.equal(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l190.14"></a><span id="l190.14">   yield true;</span>
<a href="#l190.15"></a><span id="l190.15"> }</span>
<a href="#l190.16"></a><span id="l190.16"> </span>
<a href="#l190.17"></a><span id="l190.17"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l190.18"></a><span id="l190.18"> var testObject;</span>
<a href="#l190.19"></a><span id="l190.19"> function* testSearch()</span>
<a href="#l190.20"></a><span id="l190.20"> {</span>
<a href="#l190.21"></a><span id="l190.21">   while (searchTests.length)</span>
<a href="#l190.22"></a><span id="l190.22">   {</span>
<a href="#l190.23"></a><span id="l190.23">     let test = searchTests.shift();</span>
<a href="#l190.24"></a><span id="l190.24">     if (test.dbHeader)</span>
<a href="#l190.25"></a><span id="l190.25">     {</span>
<a href="#l190.26"></a><span id="l190.26">       //  test of a custom db header</span>
<a href="#l190.27"></a><span id="l190.27">       dump(&quot;testing dbHeader &quot; + test.dbHeader + &quot;\n&quot;);</span>
<a href="#l190.28"></a><span id="l190.28">       let customValue = mailTestUtils.firstMsgHdr(IMAPPump.inbox)</span>
<a href="#l190.29"></a><span id="l190.29">                                      .getProperty(test.dbHeader);</span>
<a href="#l190.30"></a><span id="l190.30" class="difflineminus">-      do_check_eq(customValue, test.testString);</span>
<a href="#l190.31"></a><span id="l190.31" class="difflineplus">+      Assert.equal(customValue, test.testString);</span>
<a href="#l190.32"></a><span id="l190.32">     }</span>
<a href="#l190.33"></a><span id="l190.33">     else</span>
<a href="#l190.34"></a><span id="l190.34">     {</span>
<a href="#l190.35"></a><span id="l190.35">       dump(&quot;testing for string '&quot; + test.testString + &quot;'\n&quot;);</span>
<a href="#l190.36"></a><span id="l190.36">       testObject = new TestSearch(IMAPPump.inbox,</span>
<a href="#l190.37"></a><span id="l190.37">                            test.testString,</span>
<a href="#l190.38"></a><span id="l190.38">                            test.testAttribute,</span>
<a href="#l190.39"></a><span id="l190.39">                            test.op,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l191.1"></a><span id="l191.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStatusCloseDBs.js</span>
<a href="#l191.2"></a><span id="l191.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStatusCloseDBs.js</span>
<a href="#l191.3"></a><span id="l191.3" class="difflineat">@@ -33,19 +33,19 @@ function* setup() {</span>
<a href="#l191.4"></a><span id="l191.4">   IMAPPump.server.performTest(&quot;STATUS&quot;);</span>
<a href="#l191.5"></a><span id="l191.5">   mailTestUtils.do_timeout_function(1000, async_driver);</span>
<a href="#l191.6"></a><span id="l191.6">   yield false;</span>
<a href="#l191.7"></a><span id="l191.7"> }</span>
<a href="#l191.8"></a><span id="l191.8"> </span>
<a href="#l191.9"></a><span id="l191.9"> function check() {</span>
<a href="#l191.10"></a><span id="l191.10">   const gDbService = Cc[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l191.11"></a><span id="l191.11">                        .getService(Ci.nsIMsgDBService);</span>
<a href="#l191.12"></a><span id="l191.12" class="difflineminus">-  do_check_true(gDbService.cachedDBForFolder(IMAPPump.inbox) !== null);</span>
<a href="#l191.13"></a><span id="l191.13" class="difflineminus">-  do_check_true(gDbService.cachedDBForFolder(gFolder1) === null);</span>
<a href="#l191.14"></a><span id="l191.14" class="difflineminus">-  do_check_true(gDbService.cachedDBForFolder(gFolder2) === null);</span>
<a href="#l191.15"></a><span id="l191.15" class="difflineplus">+  Assert.ok(gDbService.cachedDBForFolder(IMAPPump.inbox) !== null);</span>
<a href="#l191.16"></a><span id="l191.16" class="difflineplus">+  Assert.ok(gDbService.cachedDBForFolder(gFolder1) === null);</span>
<a href="#l191.17"></a><span id="l191.17" class="difflineplus">+  Assert.ok(gDbService.cachedDBForFolder(gFolder2) === null);</span>
<a href="#l191.18"></a><span id="l191.18"> }</span>
<a href="#l191.19"></a><span id="l191.19"> </span>
<a href="#l191.20"></a><span id="l191.20"> function teardown() {</span>
<a href="#l191.21"></a><span id="l191.21">   teardownIMAPPump();</span>
<a href="#l191.22"></a><span id="l191.22"> }</span>
<a href="#l191.23"></a><span id="l191.23"> </span>
<a href="#l191.24"></a><span id="l191.24"> function run_test() {</span>
<a href="#l191.25"></a><span id="l191.25">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l192.1"></a><span id="l192.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l192.2"></a><span id="l192.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l192.3"></a><span id="l192.3" class="difflineat">@@ -40,17 +40,17 @@ var streamListener =</span>
<a href="#l192.4"></a><span id="l192.4"> </span>
<a href="#l192.5"></a><span id="l192.5">   QueryInterface:</span>
<a href="#l192.6"></a><span id="l192.6">     XPCOMUtils.generateQI([Ci.nsIStreamListener, Ci.nsIRequestObserver]),</span>
<a href="#l192.7"></a><span id="l192.7"> </span>
<a href="#l192.8"></a><span id="l192.8">   // nsIRequestObserver</span>
<a href="#l192.9"></a><span id="l192.9">   onStartRequest: function(aRequest, aContext) {</span>
<a href="#l192.10"></a><span id="l192.10">   },</span>
<a href="#l192.11"></a><span id="l192.11">   onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l192.12"></a><span id="l192.12" class="difflineminus">-    do_check_eq(aStatusCode, 0);</span>
<a href="#l192.13"></a><span id="l192.13" class="difflineplus">+    Assert.equal(aStatusCode, 0);</span>
<a href="#l192.14"></a><span id="l192.14">   },</span>
<a href="#l192.15"></a><span id="l192.15"> </span>
<a href="#l192.16"></a><span id="l192.16">   // nsIStreamListener</span>
<a href="#l192.17"></a><span id="l192.17">   onDataAvailable: function(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l192.18"></a><span id="l192.18">     let scriptStream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l192.19"></a><span id="l192.19">                          .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l192.20"></a><span id="l192.20"> </span>
<a href="#l192.21"></a><span id="l192.21">     scriptStream.init(aInputStream);</span>
<a href="#l192.22"></a><span id="l192.22" class="difflineat">@@ -129,31 +129,31 @@ var tests = [</span>
<a href="#l192.23"></a><span id="l192.23">                                             null,</span>
<a href="#l192.24"></a><span id="l192.24">                                             asyncUrlListener,</span>
<a href="#l192.25"></a><span id="l192.25">                                             null,</span>
<a href="#l192.26"></a><span id="l192.26">                                             url);</span>
<a href="#l192.27"></a><span id="l192.27">     yield false;</span>
<a href="#l192.28"></a><span id="l192.28">   },</span>
<a href="#l192.29"></a><span id="l192.29">   function* select2ndMsg() {</span>
<a href="#l192.30"></a><span id="l192.30">     let msg1 = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l192.31"></a><span id="l192.31" class="difflineminus">-    do_check_neq(msg1.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l192.32"></a><span id="l192.32" class="difflineplus">+    Assert.notEqual(msg1.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l192.33"></a><span id="l192.33">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l192.34"></a><span id="l192.34">     let msg2 = db.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l192.35"></a><span id="l192.35">     let url = new Object;</span>
<a href="#l192.36"></a><span id="l192.36">     gIMAPService.DisplayMessage(IMAPPump.inbox.getUriForMsg(msg2),</span>
<a href="#l192.37"></a><span id="l192.37">                                             streamListener,</span>
<a href="#l192.38"></a><span id="l192.38">                                             null,</span>
<a href="#l192.39"></a><span id="l192.39">                                             asyncUrlListener,</span>
<a href="#l192.40"></a><span id="l192.40">                                             null,</span>
<a href="#l192.41"></a><span id="l192.41">                                             url);</span>
<a href="#l192.42"></a><span id="l192.42">     yield false;</span>
<a href="#l192.43"></a><span id="l192.43">   },</span>
<a href="#l192.44"></a><span id="l192.44">   function* select3rdMsg() {</span>
<a href="#l192.45"></a><span id="l192.45">     let msg2 = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l192.46"></a><span id="l192.46" class="difflineminus">-    do_check_neq(msg2.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l192.47"></a><span id="l192.47" class="difflineplus">+    Assert.notEqual(msg2.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l192.48"></a><span id="l192.48">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l192.49"></a><span id="l192.49">     let msg3 = db.getMsgHdrForMessageID(gMsgId3);</span>
<a href="#l192.50"></a><span id="l192.50">     let url = new Object;</span>
<a href="#l192.51"></a><span id="l192.51">     gIMAPService.DisplayMessage(IMAPPump.inbox.getUriForMsg(msg3),</span>
<a href="#l192.52"></a><span id="l192.52">                                             streamListener,</span>
<a href="#l192.53"></a><span id="l192.53">                                             null,</span>
<a href="#l192.54"></a><span id="l192.54">                                             asyncUrlListener,</span>
<a href="#l192.55"></a><span id="l192.55">                                             null,</span>
<a href="#l192.56"></a><span id="l192.56" class="difflineat">@@ -211,17 +211,17 @@ var tests = [</span>
<a href="#l192.57"></a><span id="l192.57">                                                  IMAPPump.inbox,</span>
<a href="#l192.58"></a><span id="l192.58">                                                  asyncUrlListener,</span>
<a href="#l192.59"></a><span id="l192.59">                                                  null);</span>
<a href="#l192.60"></a><span id="l192.60">     yield false;</span>
<a href="#l192.61"></a><span id="l192.61">   },</span>
<a href="#l192.62"></a><span id="l192.62">   function checkOfflineStoreSize()</span>
<a href="#l192.63"></a><span id="l192.63">   {</span>
<a href="#l192.64"></a><span id="l192.64">     dump(&quot;checking offline store size\n&quot;);</span>
<a href="#l192.65"></a><span id="l192.65" class="difflineminus">-    do_check_true(IMAPPump.inbox.filePath.fileSize &lt;= gImapInboxOfflineStoreSize);</span>
<a href="#l192.66"></a><span id="l192.66" class="difflineplus">+    Assert.ok(IMAPPump.inbox.filePath.fileSize &lt;= gImapInboxOfflineStoreSize);</span>
<a href="#l192.67"></a><span id="l192.67">   },</span>
<a href="#l192.68"></a><span id="l192.68">   teardown</span>
<a href="#l192.69"></a><span id="l192.69"> ]</span>
<a href="#l192.70"></a><span id="l192.70"> </span>
<a href="#l192.71"></a><span id="l192.71"> var gStreamListener = {</span>
<a href="#l192.72"></a><span id="l192.72">   QueryInterface : XPCOMUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l192.73"></a><span id="l192.73">   _stream : null,</span>
<a href="#l192.74"></a><span id="l192.74">   _data : null,</span>
<a href="#l192.75"></a><span id="l192.75" class="difflineat">@@ -236,17 +236,17 @@ var gStreamListener = {</span>
<a href="#l192.76"></a><span id="l192.76">       this._stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l192.77"></a><span id="l192.77">       this._stream.init(aInputStream);</span>
<a href="#l192.78"></a><span id="l192.78">     }</span>
<a href="#l192.79"></a><span id="l192.79">     this._data += this._stream.read(aCount);</span>
<a href="#l192.80"></a><span id="l192.80">   },</span>
<a href="#l192.81"></a><span id="l192.81"> };</span>
<a href="#l192.82"></a><span id="l192.82"> </span>
<a href="#l192.83"></a><span id="l192.83"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l192.84"></a><span id="l192.84" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l192.85"></a><span id="l192.85" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l192.86"></a><span id="l192.86"> };</span>
<a href="#l192.87"></a><span id="l192.87"> </span>
<a href="#l192.88"></a><span id="l192.88"> function teardown() {</span>
<a href="#l192.89"></a><span id="l192.89">   teardownIMAPPump();</span>
<a href="#l192.90"></a><span id="l192.90"> }</span>
<a href="#l192.91"></a><span id="l192.91"> </span>
<a href="#l192.92"></a><span id="l192.92"> function run_test() {</span>
<a href="#l192.93"></a><span id="l192.93">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l193.1"></a><span id="l193.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l193.2"></a><span id="l193.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l193.3"></a><span id="l193.3" class="difflineat">@@ -76,17 +76,17 @@ var tests = [</span>
<a href="#l193.4"></a><span id="l193.4">     IMAPPump.inbox.deleteMessages(gMessages, gMsgWindow, false, true, asyncCopyListener, true);</span>
<a href="#l193.5"></a><span id="l193.5">     yield false;</span>
<a href="#l193.6"></a><span id="l193.6">   },</span>
<a href="#l193.7"></a><span id="l193.7">   function* expunge() {</span>
<a href="#l193.8"></a><span id="l193.8">     IMAPPump.inbox.expunge(asyncUrlListener, gMsgWindow);</span>
<a href="#l193.9"></a><span id="l193.9">     yield false;</span>
<a href="#l193.10"></a><span id="l193.10"> </span>
<a href="#l193.11"></a><span id="l193.11">     // Ensure that the message has been surely deleted.</span>
<a href="#l193.12"></a><span id="l193.12" class="difflineminus">-    do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 3);</span>
<a href="#l193.13"></a><span id="l193.13" class="difflineplus">+    Assert.equal(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 3);</span>
<a href="#l193.14"></a><span id="l193.14">   },</span>
<a href="#l193.15"></a><span id="l193.15">   function* undoDelete() {</span>
<a href="#l193.16"></a><span id="l193.16">     gMsgWindow.transactionManager.undoTransaction();</span>
<a href="#l193.17"></a><span id="l193.17">     // after undo, we select the trash and then the inbox, so that we sync</span>
<a href="#l193.18"></a><span id="l193.18">     // up with the server, and clear out the effects of having done the</span>
<a href="#l193.19"></a><span id="l193.19">     // delete offline.</span>
<a href="#l193.20"></a><span id="l193.20">     let trash = gRootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l193.21"></a><span id="l193.21">     trash.QueryInterface(Ci.nsIMsgImapMailFolder)</span>
<a href="#l193.22"></a><span id="l193.22" class="difflineat">@@ -94,18 +94,18 @@ var tests = [</span>
<a href="#l193.23"></a><span id="l193.23">     yield false;</span>
<a href="#l193.24"></a><span id="l193.24">   },</span>
<a href="#l193.25"></a><span id="l193.25">   function* goBackToInbox() {</span>
<a href="#l193.26"></a><span id="l193.26">     IMAPPump.inbox.updateFolderWithListener(gMsgWindow, asyncUrlListener);</span>
<a href="#l193.27"></a><span id="l193.27">     yield false;</span>
<a href="#l193.28"></a><span id="l193.28">   },</span>
<a href="#l193.29"></a><span id="l193.29">   function verifyFolders() {</span>
<a href="#l193.30"></a><span id="l193.30">     let msgRestored = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l193.31"></a><span id="l193.31" class="difflineminus">-    do_check_true(msgRestored !== null);</span>
<a href="#l193.32"></a><span id="l193.32" class="difflineminus">-    do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 4);</span>
<a href="#l193.33"></a><span id="l193.33" class="difflineplus">+    Assert.ok(msgRestored !== null);</span>
<a href="#l193.34"></a><span id="l193.34" class="difflineplus">+    Assert.equal(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 4);</span>
<a href="#l193.35"></a><span id="l193.35">   },</span>
<a href="#l193.36"></a><span id="l193.36">   teardown</span>
<a href="#l193.37"></a><span id="l193.37"> ];</span>
<a href="#l193.38"></a><span id="l193.38"> </span>
<a href="#l193.39"></a><span id="l193.39"> function setup() {</span>
<a href="#l193.40"></a><span id="l193.40">   setupIMAPPump();</span>
<a href="#l193.41"></a><span id="l193.41"> </span>
<a href="#l193.42"></a><span id="l193.42">   var listener1 = new alertListener();</span>
<a href="#l193.43"></a><span id="l193.43" class="difflineat">@@ -132,17 +132,17 @@ function setup() {</span>
<a href="#l193.44"></a><span id="l193.44">   addMessagesToServer([{file: gMsgFile1, messageId: gMsgId1},</span>
<a href="#l193.45"></a><span id="l193.45">                        {file: gMsgFile4, messageId: gMsgId4},</span>
<a href="#l193.46"></a><span id="l193.46">                        {file: gMsgFile5, messageId: gMsgId5},</span>
<a href="#l193.47"></a><span id="l193.47">                        {file: gMsgFile2, messageId: gMsgId2}],</span>
<a href="#l193.48"></a><span id="l193.48">                       IMAPPump.mailbox, IMAPPump.inbox);</span>
<a href="#l193.49"></a><span id="l193.49"> }</span>
<a href="#l193.50"></a><span id="l193.50"> </span>
<a href="#l193.51"></a><span id="l193.51"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l193.52"></a><span id="l193.52" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l193.53"></a><span id="l193.53" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l193.54"></a><span id="l193.54"> };</span>
<a href="#l193.55"></a><span id="l193.55"> </span>
<a href="#l193.56"></a><span id="l193.56"> function teardown() {</span>
<a href="#l193.57"></a><span id="l193.57">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l193.58"></a><span id="l193.58">   // server</span>
<a href="#l193.59"></a><span id="l193.59">   gMessages.clear();</span>
<a href="#l193.60"></a><span id="l193.60">   gMsgWindow.closeWindow();</span>
<a href="#l193.61"></a><span id="l193.61">   gMsgWindow = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l194.1"></a><span id="l194.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUrls.js</span>
<a href="#l194.2"></a><span id="l194.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUrls.js</span>
<a href="#l194.3"></a><span id="l194.3" class="difflineat">@@ -15,13 +15,13 @@ setupIMAPPump();</span>
<a href="#l194.4"></a><span id="l194.4">  */</span>
<a href="#l194.5"></a><span id="l194.5"> </span>
<a href="#l194.6"></a><span id="l194.6"> function run_test()</span>
<a href="#l194.7"></a><span id="l194.7"> {</span>
<a href="#l194.8"></a><span id="l194.8">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l194.9"></a><span id="l194.9">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l194.10"></a><span id="l194.10">   let uri = {};</span>
<a href="#l194.11"></a><span id="l194.11">   imapS.GetUrlForUri(&quot;imap-message://user@localhost/INBOX#4294967168&quot;, uri, null);</span>
<a href="#l194.12"></a><span id="l194.12" class="difflineminus">-  do_check_eq(uri.value.spec, &quot;imap://user@localhost:&quot; + IMAPPump.server.port +</span>
<a href="#l194.13"></a><span id="l194.13" class="difflineplus">+  Assert.equal(uri.value.spec, &quot;imap://user@localhost:&quot; + IMAPPump.server.port +</span>
<a href="#l194.14"></a><span id="l194.14">       &quot;/fetch%3EUID%3E%5EINBOX%3E4294967168&quot;);</span>
<a href="#l194.15"></a><span id="l194.15">   teardownIMAPPump();</span>
<a href="#l194.16"></a><span id="l194.16"> }</span>
<a href="#l194.17"></a><span id="l194.17"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l195.1"></a><span id="l195.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l195.2"></a><span id="l195.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l195.3"></a><span id="l195.3" class="difflineat">@@ -98,17 +98,17 @@ function* check_result() {</span>
<a href="#l195.4"></a><span id="l195.4">   // Call downloadAllForOffline() a second time.</span>
<a href="#l195.5"></a><span id="l195.5">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l195.6"></a><span id="l195.6">   yield false;</span>
<a href="#l195.7"></a><span id="l195.7"> </span>
<a href="#l195.8"></a><span id="l195.8">   // Make sure offline store grew (i.e., we were not writing over data).</span>
<a href="#l195.9"></a><span id="l195.9">   let offlineStoreSize = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l195.10"></a><span id="l195.10">   do_print(&quot;Offline store size (after 2nd downloadAllForOffline()) = &quot; +</span>
<a href="#l195.11"></a><span id="l195.11">            offlineStoreSize + &quot;. (Msg hdr offsets should be close to it.)&quot;);</span>
<a href="#l195.12"></a><span id="l195.12" class="difflineminus">-  do_check_true(offlineStoreSize &gt; gOfflineStoreSize);</span>
<a href="#l195.13"></a><span id="l195.13" class="difflineplus">+  Assert.ok(offlineStoreSize &gt; gOfflineStoreSize);</span>
<a href="#l195.14"></a><span id="l195.14"> </span>
<a href="#l195.15"></a><span id="l195.15">   // Verify that the message headers have the offline flag set.</span>
<a href="#l195.16"></a><span id="l195.16">   let msgEnumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l195.17"></a><span id="l195.17">   let offset = {};</span>
<a href="#l195.18"></a><span id="l195.18">   let size = {};</span>
<a href="#l195.19"></a><span id="l195.19">   while (msgEnumerator.hasMoreElements()) {</span>
<a href="#l195.20"></a><span id="l195.20">     let header = msgEnumerator.getNext();</span>
<a href="#l195.21"></a><span id="l195.21">     // Verify that each message has been downloaded and looks OK.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l196.1"></a><span id="l196.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_listClosesDB.js</span>
<a href="#l196.2"></a><span id="l196.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_listClosesDB.js</span>
<a href="#l196.3"></a><span id="l196.3" class="difflineat">@@ -40,17 +40,17 @@ function* setup() {</span>
<a href="#l196.4"></a><span id="l196.4"> function* updateInbox() {</span>
<a href="#l196.5"></a><span id="l196.5">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l196.6"></a><span id="l196.6">   yield false;</span>
<a href="#l196.7"></a><span id="l196.7"> }</span>
<a href="#l196.8"></a><span id="l196.8"> </span>
<a href="#l196.9"></a><span id="l196.9"> function checkCachedDBForFolder() {</span>
<a href="#l196.10"></a><span id="l196.10">   const gDbService = Cc[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l196.11"></a><span id="l196.11">                        .getService(Ci.nsIMsgDBService);</span>
<a href="#l196.12"></a><span id="l196.12" class="difflineminus">-  do_check_eq(gDbService.cachedDBForFolder(gSub3), null);</span>
<a href="#l196.13"></a><span id="l196.13" class="difflineplus">+  Assert.equal(gDbService.cachedDBForFolder(gSub3), null);</span>
<a href="#l196.14"></a><span id="l196.14"> }</span>
<a href="#l196.15"></a><span id="l196.15"> </span>
<a href="#l196.16"></a><span id="l196.16"> function teardown() {</span>
<a href="#l196.17"></a><span id="l196.17">   teardownIMAPPump();</span>
<a href="#l196.18"></a><span id="l196.18"> }</span>
<a href="#l196.19"></a><span id="l196.19"> </span>
<a href="#l196.20"></a><span id="l196.20"> function run_test() {</span>
<a href="#l196.21"></a><span id="l196.21">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l197.1"></a><span id="l197.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_listSubscribed.js</span>
<a href="#l197.2"></a><span id="l197.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_listSubscribed.js</span>
<a href="#l197.3"></a><span id="l197.3" class="difflineat">@@ -52,35 +52,35 @@ function* setupMailboxes()</span>
<a href="#l197.4"></a><span id="l197.4"> </span>
<a href="#l197.5"></a><span id="l197.5"> // tests that LIST (SUBSCRIBED) returns the proper response</span>
<a href="#l197.6"></a><span id="l197.6"> function* testListSubscribed()</span>
<a href="#l197.7"></a><span id="l197.7"> {</span>
<a href="#l197.8"></a><span id="l197.8">   // check that we have \Noselect and \Noinferiors flags - these would not have</span>
<a href="#l197.9"></a><span id="l197.9">   // been returned if we had used LSUB instead of LIST(SUBSCRIBED)</span>
<a href="#l197.10"></a><span id="l197.10">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l197.11"></a><span id="l197.11">   let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l197.12"></a><span id="l197.12" class="difflineminus">-  do_check_true(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l197.13"></a><span id="l197.13" class="difflineminus">-  do_check_false(folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l197.14"></a><span id="l197.14" class="difflineplus">+  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l197.15"></a><span id="l197.15" class="difflineplus">+  Assert.ok(!folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l197.16"></a><span id="l197.16"> </span>
<a href="#l197.17"></a><span id="l197.17">   // make sure the above test was not a fluke</span>
<a href="#l197.18"></a><span id="l197.18">   let folder11 = folder1.getChildNamed(&quot;folder11&quot;);</span>
<a href="#l197.19"></a><span id="l197.19" class="difflineminus">-  do_check_false(folder11.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l197.20"></a><span id="l197.20" class="difflineminus">-  do_check_true(folder11.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l197.21"></a><span id="l197.21" class="difflineplus">+  Assert.ok(!folder11.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l197.22"></a><span id="l197.22" class="difflineplus">+  Assert.ok(folder11.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l197.23"></a><span id="l197.23"> </span>
<a href="#l197.24"></a><span id="l197.24">   // test that \NonExistent implies \Noselect</span>
<a href="#l197.25"></a><span id="l197.25">   let folder2 = rootFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l197.26"></a><span id="l197.26" class="difflineminus">-  do_check_true(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l197.27"></a><span id="l197.27" class="difflineplus">+  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l197.28"></a><span id="l197.28"> </span>
<a href="#l197.29"></a><span id="l197.29">   // should not get a folder3 since it is not subscribed</span>
<a href="#l197.30"></a><span id="l197.30">   let folder3;</span>
<a href="#l197.31"></a><span id="l197.31">   try {</span>
<a href="#l197.32"></a><span id="l197.32">     folder3 = rootFolder.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l197.33"></a><span id="l197.33">   } catch (ex) {}</span>
<a href="#l197.34"></a><span id="l197.34">   //do_check_false(folder1.getFlag(nsMsgFolderFlags.Subscribed));</span>
<a href="#l197.35"></a><span id="l197.35" class="difflineminus">-  do_check_null(folder3);</span>
<a href="#l197.36"></a><span id="l197.36" class="difflineplus">+  Assert.equal(null, folder3);</span>
<a href="#l197.37"></a><span id="l197.37"> </span>
<a href="#l197.38"></a><span id="l197.38">   yield true;</span>
<a href="#l197.39"></a><span id="l197.39"> }</span>
<a href="#l197.40"></a><span id="l197.40"> </span>
<a href="#l197.41"></a><span id="l197.41"> function* testZimbraServerVersions() {</span>
<a href="#l197.42"></a><span id="l197.42">   // older versions of Zimbra can crash if we send LIST (SUBSCRIBED) so we want</span>
<a href="#l197.43"></a><span id="l197.43">   // to make sure that we are checking for versions</span>
<a href="#l197.44"></a><span id="l197.44"> </span>
<a href="#l197.45"></a><span id="l197.45" class="difflineat">@@ -100,17 +100,17 @@ function* testZimbraServerVersions() {</span>
<a href="#l197.46"></a><span id="l197.46">     IMAPPump.incomingServer.closeCachedConnections();</span>
<a href="#l197.47"></a><span id="l197.47">     IMAPPump.incomingServer.performExpand(null);</span>
<a href="#l197.48"></a><span id="l197.48">     // select inbox is just to wait on performExpand since performExpand does not have listener</span>
<a href="#l197.49"></a><span id="l197.49">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l197.50"></a><span id="l197.50">     yield false;</span>
<a href="#l197.51"></a><span id="l197.51">     // if we send LSUB instead of LIST(SUBSCRIBED), then we should not have \NoSelect flag</span>
<a href="#l197.52"></a><span id="l197.52">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l197.53"></a><span id="l197.53">     let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l197.54"></a><span id="l197.54" class="difflineminus">-    do_check_eq(folder1.getFlag(nsMsgFolderFlags.ImapNoselect), testValues[i].expectedResult);</span>
<a href="#l197.55"></a><span id="l197.55" class="difflineplus">+    Assert.equal(folder1.getFlag(nsMsgFolderFlags.ImapNoselect), testValues[i].expectedResult);</span>
<a href="#l197.56"></a><span id="l197.56">   }</span>
<a href="#l197.57"></a><span id="l197.57"> }</span>
<a href="#l197.58"></a><span id="l197.58"> </span>
<a href="#l197.59"></a><span id="l197.59"> // Cleanup at end</span>
<a href="#l197.60"></a><span id="l197.60"> function endTest()</span>
<a href="#l197.61"></a><span id="l197.61"> {</span>
<a href="#l197.62"></a><span id="l197.62">   teardownIMAPPump();</span>
<a href="#l197.63"></a><span id="l197.63"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l198.1"></a><span id="l198.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l198.2"></a><span id="l198.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l198.3"></a><span id="l198.3" class="difflineat">@@ -73,24 +73,24 @@ var tests = [</span>
<a href="#l198.4"></a><span id="l198.4">     yield false;</span>
<a href="#l198.5"></a><span id="l198.5">   },</span>
<a href="#l198.6"></a><span id="l198.6">   function verifyFolders() {</span>
<a href="#l198.7"></a><span id="l198.7">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l198.8"></a><span id="l198.8">     listMessages(folder1);</span>
<a href="#l198.9"></a><span id="l198.9">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l198.10"></a><span id="l198.10">     listMessages(folder2);</span>
<a href="#l198.11"></a><span id="l198.11">     listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l198.12"></a><span id="l198.12" class="difflineminus">-    do_check_neq(folder1, null);</span>
<a href="#l198.13"></a><span id="l198.13" class="difflineminus">-    do_check_neq(folder2, null);</span>
<a href="#l198.14"></a><span id="l198.14" class="difflineplus">+    Assert.notEqual(folder1, null);</span>
<a href="#l198.15"></a><span id="l198.15" class="difflineplus">+    Assert.notEqual(folder2, null);</span>
<a href="#l198.16"></a><span id="l198.16">     // folder 1 and 2 should each now have 2 messages in them.</span>
<a href="#l198.17"></a><span id="l198.17" class="difflineminus">-    do_check_eq(folderCount(folder1), 2);</span>
<a href="#l198.18"></a><span id="l198.18" class="difflineminus">-    do_check_eq(folderCount(folder2), 2);</span>
<a href="#l198.19"></a><span id="l198.19" class="difflineplus">+    Assert.equal(folderCount(folder1), 2);</span>
<a href="#l198.20"></a><span id="l198.20" class="difflineplus">+    Assert.equal(folderCount(folder2), 2);</span>
<a href="#l198.21"></a><span id="l198.21">     // the local inbox folder should now be empty, since the second</span>
<a href="#l198.22"></a><span id="l198.22">     // operation was a move</span>
<a href="#l198.23"></a><span id="l198.23" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l198.24"></a><span id="l198.24" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l198.25"></a><span id="l198.25">   },</span>
<a href="#l198.26"></a><span id="l198.26">   teardown</span>
<a href="#l198.27"></a><span id="l198.27"> ];</span>
<a href="#l198.28"></a><span id="l198.28"> </span>
<a href="#l198.29"></a><span id="l198.29"> function folderCount(folder)</span>
<a href="#l198.30"></a><span id="l198.30"> {</span>
<a href="#l198.31"></a><span id="l198.31">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l198.32"></a><span id="l198.32">   let count = 0;</span>
<a href="#l198.33"></a><span id="l198.33" class="difflineat">@@ -126,23 +126,23 @@ var CopyListener =</span>
<a href="#l198.34"></a><span id="l198.34">   SetMessageKey: function SetMessageKey(aKey)</span>
<a href="#l198.35"></a><span id="l198.35">   {</span>
<a href="#l198.36"></a><span id="l198.36">     gLastKey = aKey;</span>
<a href="#l198.37"></a><span id="l198.37">   },</span>
<a href="#l198.38"></a><span id="l198.38">   SetMessageId: function SetMessageId(aMessageId) {},</span>
<a href="#l198.39"></a><span id="l198.39">   OnStopCopy: function OnStopCopy(aStatus)</span>
<a href="#l198.40"></a><span id="l198.40">   {</span>
<a href="#l198.41"></a><span id="l198.41">     // Check: message successfully copied.</span>
<a href="#l198.42"></a><span id="l198.42" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l198.43"></a><span id="l198.43" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l198.44"></a><span id="l198.44">     async_driver();</span>
<a href="#l198.45"></a><span id="l198.45">   }</span>
<a href="#l198.46"></a><span id="l198.46"> };</span>
<a href="#l198.47"></a><span id="l198.47"> </span>
<a href="#l198.48"></a><span id="l198.48"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l198.49"></a><span id="l198.49" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l198.50"></a><span id="l198.50" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l198.51"></a><span id="l198.51"> };</span>
<a href="#l198.52"></a><span id="l198.52"> </span>
<a href="#l198.53"></a><span id="l198.53"> function listMessages(folder) {</span>
<a href="#l198.54"></a><span id="l198.54">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l198.55"></a><span id="l198.55">   var msgCount = 0;</span>
<a href="#l198.56"></a><span id="l198.56">   dump(&quot;listing messages for &quot; + folder.prettyName + &quot;\n&quot;);</span>
<a href="#l198.57"></a><span id="l198.57">   while(enumerator.hasMoreElements())</span>
<a href="#l198.58"></a><span id="l198.58">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l199.1"></a><span id="l199.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l199.2"></a><span id="l199.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l199.3"></a><span id="l199.3" class="difflineat">@@ -40,17 +40,17 @@ var quarantineTests = [</span>
<a href="#l199.4"></a><span id="l199.4"> ];</span>
<a href="#l199.5"></a><span id="l199.5"> </span>
<a href="#l199.6"></a><span id="l199.6"> function* createSubfolder()</span>
<a href="#l199.7"></a><span id="l199.7"> {</span>
<a href="#l199.8"></a><span id="l199.8">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;subfolder&quot;, null);</span>
<a href="#l199.9"></a><span id="l199.9">   dl('wait for folderAdded notification');</span>
<a href="#l199.10"></a><span id="l199.10">   yield false;</span>
<a href="#l199.11"></a><span id="l199.11">   gSubfolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;subfolder&quot;);</span>
<a href="#l199.12"></a><span id="l199.12" class="difflineminus">-  do_check_true(gSubfolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l199.13"></a><span id="l199.13" class="difflineplus">+  Assert.ok(gSubfolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l199.14"></a><span id="l199.14">   gSubfolder.updateFolderWithListener(null, urlListener);</span>
<a href="#l199.15"></a><span id="l199.15">   dl('wait for OnStopRunningURL');</span>
<a href="#l199.16"></a><span id="l199.16">   yield false;</span>
<a href="#l199.17"></a><span id="l199.17"> }</span>
<a href="#l199.18"></a><span id="l199.18"> </span>
<a href="#l199.19"></a><span id="l199.19"> function* getLocalMessages() {</span>
<a href="#l199.20"></a><span id="l199.20">   // setup copy then move mail filters on the inbox</span>
<a href="#l199.21"></a><span id="l199.21">   let filterList = gPOP3Pump.fakeServer.getFilterList(null);</span>
<a href="#l199.22"></a><span id="l199.22" class="difflineat">@@ -100,18 +100,18 @@ function* updateSubfolderAndTest() {</span>
<a href="#l199.23"></a><span id="l199.23"> </span>
<a href="#l199.24"></a><span id="l199.24">   // kill some time</span>
<a href="#l199.25"></a><span id="l199.25">   do_timeout(200, async_driver);</span>
<a href="#l199.26"></a><span id="l199.26">   yield false;</span>
<a href="#l199.27"></a><span id="l199.27"> </span>
<a href="#l199.28"></a><span id="l199.28">   // test</span>
<a href="#l199.29"></a><span id="l199.29">   listMessages(gSubfolder);</span>
<a href="#l199.30"></a><span id="l199.30">   listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l199.31"></a><span id="l199.31" class="difflineminus">-  do_check_eq(folderCount(gSubfolder), 1);</span>
<a href="#l199.32"></a><span id="l199.32" class="difflineminus">-  do_check_eq(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l199.33"></a><span id="l199.33" class="difflineplus">+  Assert.equal(folderCount(gSubfolder), 1);</span>
<a href="#l199.34"></a><span id="l199.34" class="difflineplus">+  Assert.equal(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l199.35"></a><span id="l199.35"> }</span>
<a href="#l199.36"></a><span id="l199.36"> </span>
<a href="#l199.37"></a><span id="l199.37"> function* get2Messages()</span>
<a href="#l199.38"></a><span id="l199.38"> {</span>
<a href="#l199.39"></a><span id="l199.39">   gPOP3Pump.files = [&quot;../../../data/bugmail10&quot;,</span>
<a href="#l199.40"></a><span id="l199.40">                      &quot;../../../data/draft1&quot;];</span>
<a href="#l199.41"></a><span id="l199.41">   gPOP3Pump.onDone = function() {dump('POP3Pump done\n');async_driver();};</span>
<a href="#l199.42"></a><span id="l199.42">   gPOP3Pump.run();</span>
<a href="#l199.43"></a><span id="l199.43" class="difflineat">@@ -133,18 +133,18 @@ function* updateSubfolderAndTest2() {</span>
<a href="#l199.44"></a><span id="l199.44"> </span>
<a href="#l199.45"></a><span id="l199.45">   // kill some time</span>
<a href="#l199.46"></a><span id="l199.46">   do_timeout(1000, async_driver);</span>
<a href="#l199.47"></a><span id="l199.47">   yield false;</span>
<a href="#l199.48"></a><span id="l199.48"> </span>
<a href="#l199.49"></a><span id="l199.49">   //test</span>
<a href="#l199.50"></a><span id="l199.50">   listMessages(gSubfolder);</span>
<a href="#l199.51"></a><span id="l199.51">   listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l199.52"></a><span id="l199.52" class="difflineminus">-  do_check_eq(folderCount(gSubfolder), 3);</span>
<a href="#l199.53"></a><span id="l199.53" class="difflineminus">-  do_check_eq(folderCount(localAccountUtils.inboxFolder), 3);</span>
<a href="#l199.54"></a><span id="l199.54" class="difflineplus">+  Assert.equal(folderCount(gSubfolder), 3);</span>
<a href="#l199.55"></a><span id="l199.55" class="difflineplus">+  Assert.equal(folderCount(localAccountUtils.inboxFolder), 3);</span>
<a href="#l199.56"></a><span id="l199.56"> }</span>
<a href="#l199.57"></a><span id="l199.57"> </span>
<a href="#l199.58"></a><span id="l199.58"> function endTest()</span>
<a href="#l199.59"></a><span id="l199.59"> {</span>
<a href="#l199.60"></a><span id="l199.60">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l199.61"></a><span id="l199.61">   // server</span>
<a href="#l199.62"></a><span id="l199.62">   dl(&quot;Exiting mail tests&quot;);</span>
<a href="#l199.63"></a><span id="l199.63">   gPOP3Pump = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l200.1"></a><span id="l200.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_lsub.js</span>
<a href="#l200.2"></a><span id="l200.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_lsub.js</span>
<a href="#l200.3"></a><span id="l200.3" class="difflineat">@@ -46,35 +46,35 @@ function* setupMailboxes()</span>
<a href="#l200.4"></a><span id="l200.4"> function* testLsub()</span>
<a href="#l200.5"></a><span id="l200.5"> {</span>
<a href="#l200.6"></a><span id="l200.6">   let nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l200.7"></a><span id="l200.7"> </span>
<a href="#l200.8"></a><span id="l200.8">   // check that we have \Noselect and \Noinferiors flags - these would not have</span>
<a href="#l200.9"></a><span id="l200.9">   // been returned if we had used LSUB instead of LIST(SUBSCRIBED)</span>
<a href="#l200.10"></a><span id="l200.10">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l200.11"></a><span id="l200.11">   let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l200.12"></a><span id="l200.12" class="difflineminus">-  do_check_true(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l200.13"></a><span id="l200.13" class="difflineminus">-  do_check_false(folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l200.14"></a><span id="l200.14" class="difflineplus">+  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l200.15"></a><span id="l200.15" class="difflineplus">+  Assert.ok(!folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l200.16"></a><span id="l200.16"> </span>
<a href="#l200.17"></a><span id="l200.17">   // make sure the above test was not a fluke</span>
<a href="#l200.18"></a><span id="l200.18">   let folder11 = folder1.getChildNamed(&quot;folder11&quot;);</span>
<a href="#l200.19"></a><span id="l200.19" class="difflineminus">-  do_check_false(folder11.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l200.20"></a><span id="l200.20" class="difflineminus">-  do_check_true(folder11.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l200.21"></a><span id="l200.21" class="difflineplus">+  Assert.ok(!folder11.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l200.22"></a><span id="l200.22" class="difflineplus">+  Assert.ok(folder11.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l200.23"></a><span id="l200.23"> </span>
<a href="#l200.24"></a><span id="l200.24">   // test that \NonExistent implies \Noselect</span>
<a href="#l200.25"></a><span id="l200.25">   let folder2 = rootFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l200.26"></a><span id="l200.26" class="difflineminus">-  do_check_true(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l200.27"></a><span id="l200.27" class="difflineplus">+  Assert.ok(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l200.28"></a><span id="l200.28"> </span>
<a href="#l200.29"></a><span id="l200.29">   // should not get a folder3 since it is not subscribed</span>
<a href="#l200.30"></a><span id="l200.30">   let folder3;</span>
<a href="#l200.31"></a><span id="l200.31">   try {</span>
<a href="#l200.32"></a><span id="l200.32">     folder3 = rootFolder.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l200.33"></a><span id="l200.33">   } catch (ex) {}</span>
<a href="#l200.34"></a><span id="l200.34">   //do_check_false(folder1.getFlag(nsMsgFolderFlags.Subscribed));</span>
<a href="#l200.35"></a><span id="l200.35" class="difflineminus">-  do_check_null(folder3);</span>
<a href="#l200.36"></a><span id="l200.36" class="difflineplus">+  Assert.equal(null, folder3);</span>
<a href="#l200.37"></a><span id="l200.37"> </span>
<a href="#l200.38"></a><span id="l200.38">   yield true;</span>
<a href="#l200.39"></a><span id="l200.39"> }</span>
<a href="#l200.40"></a><span id="l200.40"> </span>
<a href="#l200.41"></a><span id="l200.41"> // Cleanup at end</span>
<a href="#l200.42"></a><span id="l200.42"> function endTest()</span>
<a href="#l200.43"></a><span id="l200.43"> {</span>
<a href="#l200.44"></a><span id="l200.44">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l201.1"></a><span id="l201.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_mailboxes.js</span>
<a href="#l201.2"></a><span id="l201.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_mailboxes.js</span>
<a href="#l201.3"></a><span id="l201.3" class="difflineat">@@ -28,37 +28,37 @@ function* setup() {</span>
<a href="#l201.4"></a><span id="l201.4"> </span>
<a href="#l201.5"></a><span id="l201.5"> var tests = [</span>
<a href="#l201.6"></a><span id="l201.6">   setup,</span>
<a href="#l201.7"></a><span id="l201.7">   function* checkDiscovery() {</span>
<a href="#l201.8"></a><span id="l201.8">     dump(&quot;in check discovery\n&quot;);</span>
<a href="#l201.9"></a><span id="l201.9">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l201.10"></a><span id="l201.10">     // Check that we've subscribed to the boxes returned by LSUB. We also get</span>
<a href="#l201.11"></a><span id="l201.11">     // checking of proper i18n in mailboxes for free here.</span>
<a href="#l201.12"></a><span id="l201.12" class="difflineminus">-    do_check_true(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l201.13"></a><span id="l201.13" class="difflineminus">-    do_check_true(rootFolder.containsChildNamed(&quot;TRASH&quot;));</span>
<a href="#l201.14"></a><span id="l201.14" class="difflineplus">+    Assert.ok(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l201.15"></a><span id="l201.15" class="difflineplus">+    Assert.ok(rootFolder.containsChildNamed(&quot;TRASH&quot;));</span>
<a href="#l201.16"></a><span id="l201.16">     // Make sure we haven't created an extra &quot;Trash&quot; folder.</span>
<a href="#l201.17"></a><span id="l201.17">     let trashes = rootFolder.getFoldersWithFlags(Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l201.18"></a><span id="l201.18" class="difflineminus">-    do_check_eq(trashes.length, 1);</span>
<a href="#l201.19"></a><span id="l201.19" class="difflineminus">-    do_check_eq(rootFolder.numSubFolders, 3);</span>
<a href="#l201.20"></a><span id="l201.20" class="difflineminus">-    do_check_true(rootFolder.containsChildNamed(folderName1));</span>
<a href="#l201.21"></a><span id="l201.21" class="difflineplus">+    Assert.equal(trashes.length, 1);</span>
<a href="#l201.22"></a><span id="l201.22" class="difflineplus">+    Assert.equal(rootFolder.numSubFolders, 3);</span>
<a href="#l201.23"></a><span id="l201.23" class="difflineplus">+    Assert.ok(rootFolder.containsChildNamed(folderName1));</span>
<a href="#l201.24"></a><span id="l201.24">     // This is not a subscribed box, so we shouldn't be subscribing to it.</span>
<a href="#l201.25"></a><span id="l201.25" class="difflineminus">-    do_check_false(rootFolder.containsChildNamed(&quot;Unsubscribed box&quot;));</span>
<a href="#l201.26"></a><span id="l201.26" class="difflineplus">+    Assert.ok(!rootFolder.containsChildNamed(&quot;Unsubscribed box&quot;));</span>
<a href="#l201.27"></a><span id="l201.27"> </span>
<a href="#l201.28"></a><span id="l201.28">     let i18nChild = rootFolder.getChildNamed(folderName1);</span>
<a href="#l201.29"></a><span id="l201.29"> </span>
<a href="#l201.30"></a><span id="l201.30">     MailServices.imap.renameLeaf(i18nChild,</span>
<a href="#l201.31"></a><span id="l201.31">                                  folderName2,</span>
<a href="#l201.32"></a><span id="l201.32">                                  asyncUrlListener,</span>
<a href="#l201.33"></a><span id="l201.33">                                  null);</span>
<a href="#l201.34"></a><span id="l201.34">     yield false;</span>
<a href="#l201.35"></a><span id="l201.35">   },</span>
<a href="#l201.36"></a><span id="l201.36">   function* checkRename() {</span>
<a href="#l201.37"></a><span id="l201.37">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l201.38"></a><span id="l201.38" class="difflineminus">-    do_check_true(rootFolder.containsChildNamed(folderName2));</span>
<a href="#l201.39"></a><span id="l201.39" class="difflineplus">+    Assert.ok(rootFolder.containsChildNamed(folderName2));</span>
<a href="#l201.40"></a><span id="l201.40">     let newChild = rootFolder.getChildNamed(folderName2).</span>
<a href="#l201.41"></a><span id="l201.41">                    QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l201.42"></a><span id="l201.42">     newChild.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l201.43"></a><span id="l201.43">     yield false;</span>
<a href="#l201.44"></a><span id="l201.44">   },</span>
<a href="#l201.45"></a><span id="l201.45">   function checkEmptyFolder() {</span>
<a href="#l201.46"></a><span id="l201.46">     try {</span>
<a href="#l201.47"></a><span id="l201.47">     let serverSink = IMAPPump.server.QueryInterface(Ci.nsIImapServerSink);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l202.1"></a><span id="l202.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineDraftDataloss.js</span>
<a href="#l202.2"></a><span id="l202.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineDraftDataloss.js</span>
<a href="#l202.3"></a><span id="l202.3" class="difflineat">@@ -32,17 +32,17 @@ var tests = [</span>
<a href="#l202.4"></a><span id="l202.4"> </span>
<a href="#l202.5"></a><span id="l202.5"> var gDraftsFolder;</span>
<a href="#l202.6"></a><span id="l202.6"> </span>
<a href="#l202.7"></a><span id="l202.7"> function* createDraftsFolder()</span>
<a href="#l202.8"></a><span id="l202.8"> {</span>
<a href="#l202.9"></a><span id="l202.9">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Drafts&quot;, null);</span>
<a href="#l202.10"></a><span id="l202.10">   yield false;</span>
<a href="#l202.11"></a><span id="l202.11">   gDraftsFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Drafts&quot;);</span>
<a href="#l202.12"></a><span id="l202.12" class="difflineminus">-  do_check_true(gDraftsFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l202.13"></a><span id="l202.13" class="difflineplus">+  Assert.ok(gDraftsFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l202.14"></a><span id="l202.14">   gDraftsFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l202.15"></a><span id="l202.15">   yield false;</span>
<a href="#l202.16"></a><span id="l202.16"> }</span>
<a href="#l202.17"></a><span id="l202.17"> function* goOffline()</span>
<a href="#l202.18"></a><span id="l202.18"> {</span>
<a href="#l202.19"></a><span id="l202.19">   // Don't prompt about offline download when going offline</span>
<a href="#l202.20"></a><span id="l202.20">   Services.prefs.setIntPref(&quot;offline.download.download_messages&quot;, 2);</span>
<a href="#l202.21"></a><span id="l202.21"> </span>
<a href="#l202.22"></a><span id="l202.22" class="difflineat">@@ -75,17 +75,17 @@ function* saveDraft()</span>
<a href="#l202.23"></a><span id="l202.23"> </span>
<a href="#l202.24"></a><span id="l202.24">   let progress = Cc[&quot;@mozilla.org/messenger/progress;1&quot;]</span>
<a href="#l202.25"></a><span id="l202.25">                    .createInstance(Ci.nsIMsgProgress);</span>
<a href="#l202.26"></a><span id="l202.26">   progress.registerListener(progressListener);</span>
<a href="#l202.27"></a><span id="l202.27">   msgCompose.SendMsg(Ci.nsIMsgSend.nsMsgSaveAsDraft, identity, &quot;&quot;, null,</span>
<a href="#l202.28"></a><span id="l202.28">                      progress);</span>
<a href="#l202.29"></a><span id="l202.29">   yield false;</span>
<a href="#l202.30"></a><span id="l202.30">   // verify that message is not on the server yet</span>
<a href="#l202.31"></a><span id="l202.31" class="difflineminus">-  do_check_eq(IMAPPump.daemon.getMailbox(&quot;Drafts&quot;)._messages.length, 0);</span>
<a href="#l202.32"></a><span id="l202.32" class="difflineplus">+  Assert.equal(IMAPPump.daemon.getMailbox(&quot;Drafts&quot;)._messages.length, 0);</span>
<a href="#l202.33"></a><span id="l202.33"> }</span>
<a href="#l202.34"></a><span id="l202.34"> </span>
<a href="#l202.35"></a><span id="l202.35"> function* goOnline()</span>
<a href="#l202.36"></a><span id="l202.36"> {</span>
<a href="#l202.37"></a><span id="l202.37">   let offlineManager = Cc[&quot;@mozilla.org/messenger/offline-manager;1&quot;]</span>
<a href="#l202.38"></a><span id="l202.38">                        .getService(Ci.nsIMsgOfflineManager);</span>
<a href="#l202.39"></a><span id="l202.39">   IMAPPump.daemon.closing = false;</span>
<a href="#l202.40"></a><span id="l202.40">   Services.io.offline = false;</span>
<a href="#l202.41"></a><span id="l202.41" class="difflineat">@@ -101,17 +101,17 @@ function* goOnline()</span>
<a href="#l202.42"></a><span id="l202.42">   }</span>
<a href="#l202.43"></a><span id="l202.43">   waitForNotInProgress();</span>
<a href="#l202.44"></a><span id="l202.44">   yield false;</span>
<a href="#l202.45"></a><span id="l202.45"> }</span>
<a href="#l202.46"></a><span id="l202.46"> </span>
<a href="#l202.47"></a><span id="l202.47"> function* checkResult()</span>
<a href="#l202.48"></a><span id="l202.48"> {</span>
<a href="#l202.49"></a><span id="l202.49">   // verify that message is now on the server</span>
<a href="#l202.50"></a><span id="l202.50" class="difflineminus">-  do_check_eq(IMAPPump.daemon.getMailbox(&quot;Drafts&quot;)._messages.length, 1);</span>
<a href="#l202.51"></a><span id="l202.51" class="difflineplus">+  Assert.equal(IMAPPump.daemon.getMailbox(&quot;Drafts&quot;)._messages.length, 1);</span>
<a href="#l202.52"></a><span id="l202.52">   yield true;</span>
<a href="#l202.53"></a><span id="l202.53"> }</span>
<a href="#l202.54"></a><span id="l202.54"> </span>
<a href="#l202.55"></a><span id="l202.55"> function* endTest()</span>
<a href="#l202.56"></a><span id="l202.56"> {</span>
<a href="#l202.57"></a><span id="l202.57">   teardownIMAPPump();</span>
<a href="#l202.58"></a><span id="l202.58">   yield true;</span>
<a href="#l202.59"></a><span id="l202.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l203.1"></a><span id="l203.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlinePlayback.js</span>
<a href="#l203.2"></a><span id="l203.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlinePlayback.js</span>
<a href="#l203.3"></a><span id="l203.3" class="difflineat">@@ -85,19 +85,19 @@ var tests = [</span>
<a href="#l203.4"></a><span id="l203.4">     let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l203.5"></a><span id="l203.5">     IMAPPump.inbox.updateFolderWithListener(null, promiseUrlListener);</span>
<a href="#l203.6"></a><span id="l203.6">     yield promiseUrlListener.promise;</span>
<a href="#l203.7"></a><span id="l203.7">   },</span>
<a href="#l203.8"></a><span id="l203.8">   function checkDone() {</span>
<a href="#l203.9"></a><span id="l203.9">     let msgHdr1 = gSecondFolder.msgDatabase.getMsgHdrForMessageID(gSynthMessage1.messageId);</span>
<a href="#l203.10"></a><span id="l203.10">     let msgHdr2 = gThirdFolder.msgDatabase.getMsgHdrForMessageID(gSynthMessage2.messageId);</span>
<a href="#l203.11"></a><span id="l203.11">     let msgHdr3 = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l203.12"></a><span id="l203.12" class="difflineminus">-    do_check_neq(msgHdr1, null);</span>
<a href="#l203.13"></a><span id="l203.13" class="difflineminus">-    do_check_neq(msgHdr2, null);</span>
<a href="#l203.14"></a><span id="l203.14" class="difflineminus">-    do_check_neq(msgHdr3, null);</span>
<a href="#l203.15"></a><span id="l203.15" class="difflineplus">+    Assert.notEqual(msgHdr1, null);</span>
<a href="#l203.16"></a><span id="l203.16" class="difflineplus">+    Assert.notEqual(msgHdr2, null);</span>
<a href="#l203.17"></a><span id="l203.17" class="difflineplus">+    Assert.notEqual(msgHdr3, null);</span>
<a href="#l203.18"></a><span id="l203.18">   },</span>
<a href="#l203.19"></a><span id="l203.19">   teardownIMAPPump</span>
<a href="#l203.20"></a><span id="l203.20"> ];</span>
<a href="#l203.21"></a><span id="l203.21"> </span>
<a href="#l203.22"></a><span id="l203.22"> function *setup() {</span>
<a href="#l203.23"></a><span id="l203.23"> </span>
<a href="#l203.24"></a><span id="l203.24">   /*</span>
<a href="#l203.25"></a><span id="l203.25">    * Set up an IMAP server.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l204.1"></a><span id="l204.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l204.2"></a><span id="l204.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l204.3"></a><span id="l204.3" class="difflineat">@@ -50,17 +50,17 @@ function checkOfflineStore(prevOfflineSt</span>
<a href="#l204.4"></a><span id="l204.4">       // starts with &quot;From &quot; - otherwise, it returns an error.</span>
<a href="#l204.5"></a><span id="l204.5">       if (header instanceof Components.interfaces.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l204.6"></a><span id="l204.6">          (header.flags &amp; Ci.nsMsgMessageFlags.Offline))</span>
<a href="#l204.7"></a><span id="l204.7">         IMAPPump.inbox.getOfflineFileStream(header.messageKey, offset, size).close();</span>
<a href="#l204.8"></a><span id="l204.8">     }</span>
<a href="#l204.9"></a><span id="l204.9">   }</span>
<a href="#l204.10"></a><span id="l204.10">   // check that the offline store shrunk by at least 100 bytes.</span>
<a href="#l204.11"></a><span id="l204.11">   // (exact calculation might be fragile).</span>
<a href="#l204.12"></a><span id="l204.12" class="difflineminus">-  do_check_true(prevOfflineStoreSize &gt; IMAPPump.inbox.filePath.fileSize + 100);</span>
<a href="#l204.13"></a><span id="l204.13" class="difflineplus">+  Assert.ok(prevOfflineStoreSize &gt; IMAPPump.inbox.filePath.fileSize + 100);</span>
<a href="#l204.14"></a><span id="l204.14"> }</span>
<a href="#l204.15"></a><span id="l204.15"> </span>
<a href="#l204.16"></a><span id="l204.16"> var tests = [</span>
<a href="#l204.17"></a><span id="l204.17">   setup,</span>
<a href="#l204.18"></a><span id="l204.18">   function* downloadForOffline() {</span>
<a href="#l204.19"></a><span id="l204.19">     // ...and download for offline use.</span>
<a href="#l204.20"></a><span id="l204.20">     dump(&quot;Downloading for offline use\n&quot;);</span>
<a href="#l204.21"></a><span id="l204.21">     IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l204.22"></a><span id="l204.22" class="difflineat">@@ -93,17 +93,17 @@ var tests = [</span>
<a href="#l204.23"></a><span id="l204.23">     IMAPPump.inbox.compact(asyncUrlListener, gDummyMsgWindow);</span>
<a href="#l204.24"></a><span id="l204.24">     // Stream the message w/o a stream listener in an attempt to get the url</span>
<a href="#l204.25"></a><span id="l204.25">     // started more quickly, while the compact is still going on.</span>
<a href="#l204.26"></a><span id="l204.26">     msgServ.streamMessage(msgURI, null, null, asyncUrlListener, false, &quot;&quot;, false);</span>
<a href="#l204.27"></a><span id="l204.27">     yield false;</span>
<a href="#l204.28"></a><span id="l204.28"> </span>
<a href="#l204.29"></a><span id="l204.29">     // Because we're streaming the message while compaction is going on,</span>
<a href="#l204.30"></a><span id="l204.30">     // we should not have stored it for offline use.</span>
<a href="#l204.31"></a><span id="l204.31" class="difflineminus">-    do_check_false(gStreamedHdr.flags &amp; Ci.nsMsgMessageFlags.Offline);</span>
<a href="#l204.32"></a><span id="l204.32" class="difflineplus">+    Assert.equal(false, gStreamedHdr.flags &amp; Ci.nsMsgMessageFlags.Offline);</span>
<a href="#l204.33"></a><span id="l204.33"> </span>
<a href="#l204.34"></a><span id="l204.34">     yield false;</span>
<a href="#l204.35"></a><span id="l204.35">   },</span>
<a href="#l204.36"></a><span id="l204.36">   function* deleteAnOtherMsg() {</span>
<a href="#l204.37"></a><span id="l204.37">     let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l204.38"></a><span id="l204.38">     let msgHdr = enumerator.getNext();</span>
<a href="#l204.39"></a><span id="l204.39">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l204.40"></a><span id="l204.40">     array.appendElement(msgHdr);</span>
<a href="#l204.41"></a><span id="l204.41" class="difflineat">@@ -138,17 +138,17 @@ var tests = [</span>
<a href="#l204.42"></a><span id="l204.42">     array.appendElement(msgHdr);</span>
<a href="#l204.43"></a><span id="l204.43">     IMAPPump.inbox.compact(asyncUrlListener, gDummyMsgWindow);</span>
<a href="#l204.44"></a><span id="l204.44">     MailServices.copy.CopyMessages(gIMAPTrashFolder, array, IMAPPump.inbox, true,</span>
<a href="#l204.45"></a><span id="l204.45">                                    CopyListener, null, true);</span>
<a href="#l204.46"></a><span id="l204.46">   },</span>
<a href="#l204.47"></a><span id="l204.47">   function* verifyNoOfflineMsg() {</span>
<a href="#l204.48"></a><span id="l204.48">     try {</span>
<a href="#l204.49"></a><span id="l204.49">     let movedMsg = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMovedMsgId);</span>
<a href="#l204.50"></a><span id="l204.50" class="difflineminus">-    do_check_false(movedMsg.flags &amp; Ci.nsMsgMessageFlags.Offline);</span>
<a href="#l204.51"></a><span id="l204.51" class="difflineplus">+    Assert.equal(false, movedMsg.flags &amp; Ci.nsMsgMessageFlags.Offline);</span>
<a href="#l204.52"></a><span id="l204.52">     } catch (ex) {dump(ex);}</span>
<a href="#l204.53"></a><span id="l204.53">     yield false;</span>
<a href="#l204.54"></a><span id="l204.54">     yield false;</span>
<a href="#l204.55"></a><span id="l204.55">   },</span>
<a href="#l204.56"></a><span id="l204.56">   teardown</span>
<a href="#l204.57"></a><span id="l204.57"> ];</span>
<a href="#l204.58"></a><span id="l204.58"> </span>
<a href="#l204.59"></a><span id="l204.59"> function run_test() {</span>
<a href="#l204.60"></a><span id="l204.60" class="difflineat">@@ -190,17 +190,17 @@ var CopyListener =</span>
<a href="#l204.61"></a><span id="l204.61">   {</span>
<a href="#l204.62"></a><span id="l204.62">     let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l204.63"></a><span id="l204.63">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l204.64"></a><span id="l204.64">   },</span>
<a href="#l204.65"></a><span id="l204.65">   SetMessageId: function(aMessageId) {},</span>
<a href="#l204.66"></a><span id="l204.66">   OnStopCopy: function(aStatus)</span>
<a href="#l204.67"></a><span id="l204.67">   {</span>
<a href="#l204.68"></a><span id="l204.68">     // Check: message successfully copied.</span>
<a href="#l204.69"></a><span id="l204.69" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l204.70"></a><span id="l204.70" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l204.71"></a><span id="l204.71">     async_driver();</span>
<a href="#l204.72"></a><span id="l204.72">   }</span>
<a href="#l204.73"></a><span id="l204.73"> };</span>
<a href="#l204.74"></a><span id="l204.74"> </span>
<a href="#l204.75"></a><span id="l204.75"> function teardown() {</span>
<a href="#l204.76"></a><span id="l204.76">   gMsgImapInboxFolder = null;</span>
<a href="#l204.77"></a><span id="l204.77">   gIMAPTrashFolder = null;</span>
<a href="#l204.78"></a><span id="l204.78"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l205.1"></a><span id="l205.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_partsOnDemand.js</span>
<a href="#l205.2"></a><span id="l205.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_partsOnDemand.js</span>
<a href="#l205.3"></a><span id="l205.3" class="difflineat">@@ -64,32 +64,32 @@ function* loadImapMessage()</span>
<a href="#l205.4"></a><span id="l205.4">   // though we will fallback to fetching the whole message.</span>
<a href="#l205.5"></a><span id="l205.5">   file = do_get_file(&quot;../../../data/bodystructuretest3&quot;);</span>
<a href="#l205.6"></a><span id="l205.6">   msgURI = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l205.7"></a><span id="l205.7">   message = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l205.8"></a><span id="l205.8">   IMAPPump.mailbox.addMessage(message);</span>
<a href="#l205.9"></a><span id="l205.9">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l205.10"></a><span id="l205.10">   yield false;</span>
<a href="#l205.11"></a><span id="l205.11"> </span>
<a href="#l205.12"></a><span id="l205.12" class="difflineminus">-  do_check_eq(2, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l205.13"></a><span id="l205.13" class="difflineplus">+  Assert.equal(2, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l205.14"></a><span id="l205.14">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l205.15"></a><span id="l205.15" class="difflineminus">-  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l205.16"></a><span id="l205.16" class="difflineplus">+  Assert.ok(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l205.17"></a><span id="l205.17">   yield true;</span>
<a href="#l205.18"></a><span id="l205.18"> }</span>
<a href="#l205.19"></a><span id="l205.19"> </span>
<a href="#l205.20"></a><span id="l205.20"> // process the message through mime</span>
<a href="#l205.21"></a><span id="l205.21"> function* startMime()</span>
<a href="#l205.22"></a><span id="l205.22"> {</span>
<a href="#l205.23"></a><span id="l205.23">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l205.24"></a><span id="l205.24"> </span>
<a href="#l205.25"></a><span id="l205.25">   mimeMsg.MsgHdrToMimeMessage(msgHdr, this, function (aMsgHdr, aMimeMessage) {</span>
<a href="#l205.26"></a><span id="l205.26">     let url = aMimeMessage.allUserAttachments[0].url;</span>
<a href="#l205.27"></a><span id="l205.27">     // A URL containing this string indicates that the attachment will be</span>
<a href="#l205.28"></a><span id="l205.28">     // downloaded on demand.</span>
<a href="#l205.29"></a><span id="l205.29" class="difflineminus">-    do_check_true(url.includes(&quot;/;section=&quot;));</span>
<a href="#l205.30"></a><span id="l205.30" class="difflineplus">+    Assert.ok(url.includes(&quot;/;section=&quot;));</span>
<a href="#l205.31"></a><span id="l205.31">     async_driver();</span>
<a href="#l205.32"></a><span id="l205.32">   }, true /* allowDownload */, { partsOnDemand: true, examineEncryptedParts: true });</span>
<a href="#l205.33"></a><span id="l205.33">   yield false;</span>
<a href="#l205.34"></a><span id="l205.34"> }</span>
<a href="#l205.35"></a><span id="l205.35"> </span>
<a href="#l205.36"></a><span id="l205.36"> // test that we don't mark all inline messages as read.</span>
<a href="#l205.37"></a><span id="l205.37"> function* testAllInlineMessage()</span>
<a href="#l205.38"></a><span id="l205.38"> {</span>
<a href="#l205.39"></a><span id="l205.39" class="difflineat">@@ -105,26 +105,26 @@ function* testAllInlineMessage()</span>
<a href="#l205.40"></a><span id="l205.40">   }</span>
<a href="#l205.41"></a><span id="l205.41"> }</span>
<a href="#l205.42"></a><span id="l205.42"> </span>
<a href="#l205.43"></a><span id="l205.43"> function* updateCounts()</span>
<a href="#l205.44"></a><span id="l205.44"> {</span>
<a href="#l205.45"></a><span id="l205.45">   // select the trash, then the inbox again, to force an update of the </span>
<a href="#l205.46"></a><span id="l205.46">   // read state of messages.</span>
<a href="#l205.47"></a><span id="l205.47">   let trash = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l205.48"></a><span id="l205.48" class="difflineminus">-  do_check_true(trash instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l205.49"></a><span id="l205.49" class="difflineplus">+  Assert.ok(trash instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l205.50"></a><span id="l205.50">   trash.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l205.51"></a><span id="l205.51">   yield false;</span>
<a href="#l205.52"></a><span id="l205.52">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l205.53"></a><span id="l205.53">   yield false;</span>
<a href="#l205.54"></a><span id="l205.54"> }</span>
<a href="#l205.55"></a><span id="l205.55"> </span>
<a href="#l205.56"></a><span id="l205.56"> function* testNotRead()</span>
<a href="#l205.57"></a><span id="l205.57"> {</span>
<a href="#l205.58"></a><span id="l205.58" class="difflineminus">-  do_check_eq(2, IMAPPump.inbox.getNumUnread(false));</span>
<a href="#l205.59"></a><span id="l205.59" class="difflineplus">+  Assert.equal(2, IMAPPump.inbox.getNumUnread(false));</span>
<a href="#l205.60"></a><span id="l205.60">   yield true;</span>
<a href="#l205.61"></a><span id="l205.61"> }</span>
<a href="#l205.62"></a><span id="l205.62"> </span>
<a href="#l205.63"></a><span id="l205.63"> // Cleanup</span>
<a href="#l205.64"></a><span id="l205.64"> function endTest()</span>
<a href="#l205.65"></a><span id="l205.65"> {</span>
<a href="#l205.66"></a><span id="l205.66">   teardownIMAPPump();</span>
<a href="#l205.67"></a><span id="l205.67"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l206.1"></a><span id="l206.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_preserveDataOnMove.js</span>
<a href="#l206.2"></a><span id="l206.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_preserveDataOnMove.js</span>
<a href="#l206.3"></a><span id="l206.3" class="difflineat">@@ -29,33 +29,33 @@ var tests = [</span>
<a href="#l206.4"></a><span id="l206.4"> </span>
<a href="#l206.5"></a><span id="l206.5"> var gSubfolder;</span>
<a href="#l206.6"></a><span id="l206.6"> function* createSubfolder()</span>
<a href="#l206.7"></a><span id="l206.7"> {</span>
<a href="#l206.8"></a><span id="l206.8">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Subfolder&quot;, null);</span>
<a href="#l206.9"></a><span id="l206.9">   dl('wait for folderAdded notification');</span>
<a href="#l206.10"></a><span id="l206.10">   yield false;</span>
<a href="#l206.11"></a><span id="l206.11">   gSubfolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Subfolder&quot;);</span>
<a href="#l206.12"></a><span id="l206.12" class="difflineminus">-  do_check_true(gSubfolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l206.13"></a><span id="l206.13" class="difflineplus">+  Assert.ok(gSubfolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l206.14"></a><span id="l206.14">   gSubfolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l206.15"></a><span id="l206.15">   dl('wait for OnStopRunningURL');</span>
<a href="#l206.16"></a><span id="l206.16">   yield false;</span>
<a href="#l206.17"></a><span id="l206.17"> }</span>
<a href="#l206.18"></a><span id="l206.18"> </span>
<a href="#l206.19"></a><span id="l206.19"> // load and update a message in the imap fake server</span>
<a href="#l206.20"></a><span id="l206.20"> function* loadImapMessage()</span>
<a href="#l206.21"></a><span id="l206.21"> {</span>
<a href="#l206.22"></a><span id="l206.22">   IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l206.23"></a><span id="l206.23">                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l206.24"></a><span id="l206.24">   IMAPPump.inbox.updateFolder(null);</span>
<a href="#l206.25"></a><span id="l206.25">   dl('wait for msgAdded notification');</span>
<a href="#l206.26"></a><span id="l206.26">   yield false;</span>
<a href="#l206.27"></a><span id="l206.27" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l206.28"></a><span id="l206.28" class="difflineplus">+  Assert.equal(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l206.29"></a><span id="l206.29">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l206.30"></a><span id="l206.30" class="difflineminus">-  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l206.31"></a><span id="l206.31" class="difflineplus">+  Assert.ok(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l206.32"></a><span id="l206.32"> </span>
<a href="#l206.33"></a><span id="l206.33">   // set an arbitrary property</span>
<a href="#l206.34"></a><span id="l206.34">   msgHdr.setStringProperty(&quot;testprop&quot;, &quot;somevalue&quot;);</span>
<a href="#l206.35"></a><span id="l206.35">   yield true;</span>
<a href="#l206.36"></a><span id="l206.36"> }</span>
<a href="#l206.37"></a><span id="l206.37"> </span>
<a href="#l206.38"></a><span id="l206.38"> // move the message to a subfolder</span>
<a href="#l206.39"></a><span id="l206.39"> function* moveMessageToSubfolder()</span>
<a href="#l206.40"></a><span id="l206.40" class="difflineat">@@ -85,17 +85,17 @@ function* moveMessageToSubfolder()</span>
<a href="#l206.41"></a><span id="l206.41"> function* testPropertyOnMove()</span>
<a href="#l206.42"></a><span id="l206.42"> {</span>
<a href="#l206.43"></a><span id="l206.43">   gSubfolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l206.44"></a><span id="l206.44">   dl('wait for msgAdded');</span>
<a href="#l206.45"></a><span id="l206.45">   yield false; // wait for msgAdded notification</span>
<a href="#l206.46"></a><span id="l206.46">   dl('wait for OnStopRunningURL');</span>
<a href="#l206.47"></a><span id="l206.47">   yield false; // wait for OnStopRunningUrl</span>
<a href="#l206.48"></a><span id="l206.48">   let msgHdr = mailTestUtils.firstMsgHdr(gSubfolder);</span>
<a href="#l206.49"></a><span id="l206.49" class="difflineminus">-  do_check_eq(msgHdr.getStringProperty(&quot;testprop&quot;), &quot;somevalue&quot;);</span>
<a href="#l206.50"></a><span id="l206.50" class="difflineplus">+  Assert.equal(msgHdr.getStringProperty(&quot;testprop&quot;), &quot;somevalue&quot;);</span>
<a href="#l206.51"></a><span id="l206.51">   yield true;</span>
<a href="#l206.52"></a><span id="l206.52"> }</span>
<a href="#l206.53"></a><span id="l206.53"> </span>
<a href="#l206.54"></a><span id="l206.54"> // Cleanup</span>
<a href="#l206.55"></a><span id="l206.55"> function endTest()</span>
<a href="#l206.56"></a><span id="l206.56"> {</span>
<a href="#l206.57"></a><span id="l206.57">   teardownIMAPPump();</span>
<a href="#l206.58"></a><span id="l206.58"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l207.1"></a><span id="l207.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_saveImapDraft.js</span>
<a href="#l207.2"></a><span id="l207.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_saveImapDraft.js</span>
<a href="#l207.3"></a><span id="l207.3" class="difflineat">@@ -30,17 +30,17 @@ var tests = [</span>
<a href="#l207.4"></a><span id="l207.4"> </span>
<a href="#l207.5"></a><span id="l207.5"> var gDraftsFolder;</span>
<a href="#l207.6"></a><span id="l207.6"> function* createDraftsFolder()</span>
<a href="#l207.7"></a><span id="l207.7"> {</span>
<a href="#l207.8"></a><span id="l207.8">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Drafts&quot;, null);</span>
<a href="#l207.9"></a><span id="l207.9">   dl('wait for folderAdded');</span>
<a href="#l207.10"></a><span id="l207.10">   yield false;</span>
<a href="#l207.11"></a><span id="l207.11">   gDraftsFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Drafts&quot;);</span>
<a href="#l207.12"></a><span id="l207.12" class="difflineminus">-  do_check_true(gDraftsFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l207.13"></a><span id="l207.13" class="difflineplus">+  Assert.ok(gDraftsFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l207.14"></a><span id="l207.14">   gDraftsFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l207.15"></a><span id="l207.15">   dl('wait for OnStopRunningURL');</span>
<a href="#l207.16"></a><span id="l207.16">   yield false;</span>
<a href="#l207.17"></a><span id="l207.17"> }</span>
<a href="#l207.18"></a><span id="l207.18"> </span>
<a href="#l207.19"></a><span id="l207.19"> function* saveDraft()</span>
<a href="#l207.20"></a><span id="l207.20"> {</span>
<a href="#l207.21"></a><span id="l207.21">   var msgCompose = Cc[&quot;@mozilla.org/messengercompose/compose;1&quot;]</span>
<a href="#l207.22"></a><span id="l207.22" class="difflineat">@@ -69,18 +69,18 @@ function* updateDrafts()</span>
<a href="#l207.23"></a><span id="l207.23">   dump(&quot;updating drafts\n&quot;);</span>
<a href="#l207.24"></a><span id="l207.24">   gDraftsFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l207.25"></a><span id="l207.25">   yield false;</span>
<a href="#l207.26"></a><span id="l207.26"> }</span>
<a href="#l207.27"></a><span id="l207.27"> </span>
<a href="#l207.28"></a><span id="l207.28"> function* checkResult()</span>
<a href="#l207.29"></a><span id="l207.29"> {</span>
<a href="#l207.30"></a><span id="l207.30">   dump(&quot;checking result\n&quot;);</span>
<a href="#l207.31"></a><span id="l207.31" class="difflineminus">-  do_check_eq(gDraftsFolder.getTotalMessages(false), 1);</span>
<a href="#l207.32"></a><span id="l207.32" class="difflineminus">-  do_check_eq(gDraftsFolder.getNumUnread(false), 1);</span>
<a href="#l207.33"></a><span id="l207.33" class="difflineplus">+  Assert.equal(gDraftsFolder.getTotalMessages(false), 1);</span>
<a href="#l207.34"></a><span id="l207.34" class="difflineplus">+  Assert.equal(gDraftsFolder.getNumUnread(false), 1);</span>
<a href="#l207.35"></a><span id="l207.35">   yield true;</span>
<a href="#l207.36"></a><span id="l207.36"> }</span>
<a href="#l207.37"></a><span id="l207.37"> </span>
<a href="#l207.38"></a><span id="l207.38"> function* endTest()</span>
<a href="#l207.39"></a><span id="l207.39"> {</span>
<a href="#l207.40"></a><span id="l207.40">   teardownIMAPPump();</span>
<a href="#l207.41"></a><span id="l207.41">   yield true;</span>
<a href="#l207.42"></a><span id="l207.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l208.1"></a><span id="l208.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_saveTemplate.js</span>
<a href="#l208.2"></a><span id="l208.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_saveTemplate.js</span>
<a href="#l208.3"></a><span id="l208.3" class="difflineat">@@ -72,29 +72,29 @@ function* saveAsTemplate() {</span>
<a href="#l208.4"></a><span id="l208.4">   let hdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l208.5"></a><span id="l208.5">   let uri = IMAPPump.inbox.getUriForMsg(hdr);</span>
<a href="#l208.6"></a><span id="l208.6">   const Ci = Components.interfaces;</span>
<a href="#l208.7"></a><span id="l208.7">   let identity = MailServices.accounts</span>
<a href="#l208.8"></a><span id="l208.8">                   .getFirstIdentityForServer(IMAPPump.incomingServer);</span>
<a href="#l208.9"></a><span id="l208.9">   identity.stationeryFolder = IMAPPump.incomingServer.rootFolder.URI + &quot;/Templates&quot;;</span>
<a href="#l208.10"></a><span id="l208.10">   let templates = MailUtils.getFolderForURI(identity.stationeryFolder, false);</span>
<a href="#l208.11"></a><span id="l208.11">   // Verify that Templates folder doesn't exist, and then create it.</span>
<a href="#l208.12"></a><span id="l208.12" class="difflineminus">-  do_check_eq(templates.parent, null);</span>
<a href="#l208.13"></a><span id="l208.13" class="difflineplus">+  Assert.equal(templates.parent, null);</span>
<a href="#l208.14"></a><span id="l208.14">   templates.setFlag(Ci.nsMsgFolderFlags.Templates);</span>
<a href="#l208.15"></a><span id="l208.15">   templates.createStorageIfMissing(new saveAsUrlListener(uri, identity));</span>
<a href="#l208.16"></a><span id="l208.16">   yield false;</span>
<a href="#l208.17"></a><span id="l208.17"> }</span>
<a href="#l208.18"></a><span id="l208.18"> </span>
<a href="#l208.19"></a><span id="l208.19"> // listener for saveAsTemplate adding a message to the templates folder.</span>
<a href="#l208.20"></a><span id="l208.20"> var mfnListener =</span>
<a href="#l208.21"></a><span id="l208.21"> {</span>
<a href="#l208.22"></a><span id="l208.22">   msgAdded: function msgAdded(aMsg)</span>
<a href="#l208.23"></a><span id="l208.23">   {</span>
<a href="#l208.24"></a><span id="l208.24">     // Check this is the templates folder.</span>
<a href="#l208.25"></a><span id="l208.25" class="difflineminus">-    do_check_eq(aMsg.folder.prettyName, &quot;Templates&quot;);</span>
<a href="#l208.26"></a><span id="l208.26" class="difflineplus">+    Assert.equal(aMsg.folder.prettyName, &quot;Templates&quot;);</span>
<a href="#l208.27"></a><span id="l208.27">     async_driver();</span>
<a href="#l208.28"></a><span id="l208.28">   },</span>
<a href="#l208.29"></a><span id="l208.29"> };</span>
<a href="#l208.30"></a><span id="l208.30"> </span>
<a href="#l208.31"></a><span id="l208.31"> </span>
<a href="#l208.32"></a><span id="l208.32"> function run_test()</span>
<a href="#l208.33"></a><span id="l208.33"> {</span>
<a href="#l208.34"></a><span id="l208.34">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l209.1"></a><span id="l209.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_starttlsFailure.js</span>
<a href="#l209.2"></a><span id="l209.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_starttlsFailure.js</span>
<a href="#l209.3"></a><span id="l209.3" class="difflineat">@@ -9,17 +9,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l209.4"></a><span id="l209.4"> </span>
<a href="#l209.5"></a><span id="l209.5"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l209.6"></a><span id="l209.6"> load(&quot;../../../resources/alertTestUtils.js&quot;);</span>
<a href="#l209.7"></a><span id="l209.7"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l209.8"></a><span id="l209.8"> </span>
<a href="#l209.9"></a><span id="l209.9"> var gGotAlert = false;</span>
<a href="#l209.10"></a><span id="l209.10"> </span>
<a href="#l209.11"></a><span id="l209.11"> function alert(aDialogTitle, aText) {</span>
<a href="#l209.12"></a><span id="l209.12" class="difflineminus">-  do_check_true(aText.startsWith(&quot;Server localhost has disconnected&quot;));</span>
<a href="#l209.13"></a><span id="l209.13" class="difflineplus">+  Assert.ok(aText.startsWith(&quot;Server localhost has disconnected&quot;));</span>
<a href="#l209.14"></a><span id="l209.14">   gGotAlert = true;</span>
<a href="#l209.15"></a><span id="l209.15"> }</span>
<a href="#l209.16"></a><span id="l209.16"> </span>
<a href="#l209.17"></a><span id="l209.17"> var tests = [</span>
<a href="#l209.18"></a><span id="l209.18">   setup,</span>
<a href="#l209.19"></a><span id="l209.19">   check_alert,</span>
<a href="#l209.20"></a><span id="l209.20">   teardown</span>
<a href="#l209.21"></a><span id="l209.21"> ];</span>
<a href="#l209.22"></a><span id="l209.22" class="difflineat">@@ -52,21 +52,21 @@ function* setup() {</span>
<a href="#l209.23"></a><span id="l209.23"> </span>
<a href="#l209.24"></a><span id="l209.24">   registerAlertTestUtils();</span>
<a href="#l209.25"></a><span id="l209.25"> </span>
<a href="#l209.26"></a><span id="l209.26">   IMAPPump.inbox.updateFolderWithListener(gDummyMsgWindow, asyncUrlListener);</span>
<a href="#l209.27"></a><span id="l209.27">   yield false;</span>
<a href="#l209.28"></a><span id="l209.28"> }</span>
<a href="#l209.29"></a><span id="l209.29"> </span>
<a href="#l209.30"></a><span id="l209.30"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l209.31"></a><span id="l209.31" class="difflineminus">-  do_check_false(Components.isSuccessCode(aExitCode));</span>
<a href="#l209.32"></a><span id="l209.32" class="difflineplus">+  Assert.ok(!Components.isSuccessCode(aExitCode));</span>
<a href="#l209.33"></a><span id="l209.33"> };</span>
<a href="#l209.34"></a><span id="l209.34"> </span>
<a href="#l209.35"></a><span id="l209.35"> function check_alert() {</span>
<a href="#l209.36"></a><span id="l209.36" class="difflineminus">-  do_check_true(gGotAlert);</span>
<a href="#l209.37"></a><span id="l209.37" class="difflineplus">+  Assert.ok(gGotAlert);</span>
<a href="#l209.38"></a><span id="l209.38"> }</span>
<a href="#l209.39"></a><span id="l209.39"> </span>
<a href="#l209.40"></a><span id="l209.40"> function teardown() {</span>
<a href="#l209.41"></a><span id="l209.41">   IMAPPump.incomingServer.closeCachedConnections();</span>
<a href="#l209.42"></a><span id="l209.42">   IMAPPump.server.stop();</span>
<a href="#l209.43"></a><span id="l209.43"> </span>
<a href="#l209.44"></a><span id="l209.44">   var thread = gThreadManager.currentThread;</span>
<a href="#l209.45"></a><span id="l209.45">   while (thread.hasPendingEvents())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l210.1"></a><span id="l210.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</span>
<a href="#l210.2"></a><span id="l210.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</span>
<a href="#l210.3"></a><span id="l210.3" class="difflineat">@@ -25,17 +25,17 @@ function stop_server() {</span>
<a href="#l210.4"></a><span id="l210.4"> var asyncCopyListener = {</span>
<a href="#l210.5"></a><span id="l210.5">   OnStartCopy: function() {},</span>
<a href="#l210.6"></a><span id="l210.6">   SetMessageKey: function(aMsgKey) {},</span>
<a href="#l210.7"></a><span id="l210.7">   GetMessageId: function() {},</span>
<a href="#l210.8"></a><span id="l210.8">   OnProgress: function(aProgress, aProgressMax) {</span>
<a href="#l210.9"></a><span id="l210.9">     stop_server();</span>
<a href="#l210.10"></a><span id="l210.10">   },</span>
<a href="#l210.11"></a><span id="l210.11">   OnStopCopy: function(aStatus) {</span>
<a href="#l210.12"></a><span id="l210.12" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l210.13"></a><span id="l210.13" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l210.14"></a><span id="l210.14">     async_driver();</span>
<a href="#l210.15"></a><span id="l210.15">   }</span>
<a href="#l210.16"></a><span id="l210.16"> };</span>
<a href="#l210.17"></a><span id="l210.17"> </span>
<a href="#l210.18"></a><span id="l210.18"> var tests = [</span>
<a href="#l210.19"></a><span id="l210.19">   setup_messages,</span>
<a href="#l210.20"></a><span id="l210.20">   move_messages,</span>
<a href="#l210.21"></a><span id="l210.21">   check_messages</span>
<a href="#l210.22"></a><span id="l210.22" class="difflineat">@@ -59,18 +59,18 @@ function* move_messages() {</span>
<a href="#l210.23"></a><span id="l210.23">   let msg = IMAPPump.inbox.msgDatabase.GetMsgHdrForKey(IMAPPump.mailbox.uidnext - 1);</span>
<a href="#l210.24"></a><span id="l210.24">   messages.appendElement(msg);</span>
<a href="#l210.25"></a><span id="l210.25">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, localAccountUtils.inboxFolder,</span>
<a href="#l210.26"></a><span id="l210.26">                                  true, asyncCopyListener, null, false);</span>
<a href="#l210.27"></a><span id="l210.27">   yield false;</span>
<a href="#l210.28"></a><span id="l210.28"> }</span>
<a href="#l210.29"></a><span id="l210.29"> </span>
<a href="#l210.30"></a><span id="l210.30"> function* check_messages() {</span>
<a href="#l210.31"></a><span id="l210.31" class="difflineminus">-  do_check_eq(IMAPPump.inbox.getTotalMessages(false), 1);</span>
<a href="#l210.32"></a><span id="l210.32" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l210.33"></a><span id="l210.33" class="difflineplus">+  Assert.equal(IMAPPump.inbox.getTotalMessages(false), 1);</span>
<a href="#l210.34"></a><span id="l210.34" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l210.35"></a><span id="l210.35">   yield true;</span>
<a href="#l210.36"></a><span id="l210.36"> }</span>
<a href="#l210.37"></a><span id="l210.37"> </span>
<a href="#l210.38"></a><span id="l210.38"> function run_test() {</span>
<a href="#l210.39"></a><span id="l210.39">   do_register_cleanup(function() {</span>
<a href="#l210.40"></a><span id="l210.40">     // IMAPPump.server.performTest() brings this test to a halt,</span>
<a href="#l210.41"></a><span id="l210.41">     // so we need teardownIMAPPump() without IMAPPump.server.performTest().</span>
<a href="#l210.42"></a><span id="l210.42">     IMAPPump.inbox = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l211.1"></a><span id="l211.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_subfolderLocation.js</span>
<a href="#l211.2"></a><span id="l211.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_subfolderLocation.js</span>
<a href="#l211.3"></a><span id="l211.3" class="difflineat">@@ -26,19 +26,19 @@ add_task(function () {</span>
<a href="#l211.4"></a><span id="l211.4"> // load and update a message in the imap fake server</span>
<a href="#l211.5"></a><span id="l211.5"> add_task(function* loadImapMessage() {</span>
<a href="#l211.6"></a><span id="l211.6">   IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l211.7"></a><span id="l211.7">                               IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l211.8"></a><span id="l211.8">   let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l211.9"></a><span id="l211.9">   IMAPPump.inbox.updateFolderWithListener(gDummyMsgWindow, promiseUrlListener);</span>
<a href="#l211.10"></a><span id="l211.10">   yield promiseUrlListener.promise;</span>
<a href="#l211.11"></a><span id="l211.11"> </span>
<a href="#l211.12"></a><span id="l211.12" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l211.13"></a><span id="l211.13" class="difflineplus">+  Assert.equal(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l211.14"></a><span id="l211.14">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l211.15"></a><span id="l211.15" class="difflineminus">-  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l211.16"></a><span id="l211.16" class="difflineplus">+  Assert.ok(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l211.17"></a><span id="l211.17"> });</span>
<a href="#l211.18"></a><span id="l211.18"> </span>
<a href="#l211.19"></a><span id="l211.19"> add_task(function* downloadOffline() {</span>
<a href="#l211.20"></a><span id="l211.20">   // ...and download for offline use.</span>
<a href="#l211.21"></a><span id="l211.21">   let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l211.22"></a><span id="l211.22">   IMAPPump.inbox.downloadAllForOffline(promiseUrlListener, null);</span>
<a href="#l211.23"></a><span id="l211.23">   yield promiseUrlListener.promise;</span>
<a href="#l211.24"></a><span id="l211.24"> });</span>
<a href="#l211.25"></a><span id="l211.25" class="difflineat">@@ -57,17 +57,17 @@ add_task(function* addSubfolder() {</span>
<a href="#l211.26"></a><span id="l211.26"> add_task(function storeAddSubfolder() {</span>
<a href="#l211.27"></a><span id="l211.27">   IMAPPump.incomingServer.msgStore.createFolder(IMAPPump.inbox, folderName2);</span>
<a href="#l211.28"></a><span id="l211.28"> });</span>
<a href="#l211.29"></a><span id="l211.29"> </span>
<a href="#l211.30"></a><span id="l211.30"> // test that folders created with store and folder have the same parent</span>
<a href="#l211.31"></a><span id="l211.31"> add_task(function testSubfolder() {</span>
<a href="#l211.32"></a><span id="l211.32">   let subfolder1 = IMAPPump.inbox.getChildNamed(folderName1);</span>
<a href="#l211.33"></a><span id="l211.33">   let subfolder2 = IMAPPump.inbox.getChildNamed(folderName2);</span>
<a href="#l211.34"></a><span id="l211.34" class="difflineminus">-  do_check_eq(subfolder1.filePath.parent.path, subfolder2.filePath.parent.path);</span>
<a href="#l211.35"></a><span id="l211.35" class="difflineplus">+  Assert.equal(subfolder1.filePath.parent.path, subfolder2.filePath.parent.path);</span>
<a href="#l211.36"></a><span id="l211.36"> });</span>
<a href="#l211.37"></a><span id="l211.37"> </span>
<a href="#l211.38"></a><span id="l211.38"> // Cleanup at end</span>
<a href="#l211.39"></a><span id="l211.39"> add_task(teardownIMAPPump);</span>
<a href="#l211.40"></a><span id="l211.40"> </span>
<a href="#l211.41"></a><span id="l211.41"> function run_test() {</span>
<a href="#l211.42"></a><span id="l211.42">   run_next_test();</span>
<a href="#l211.43"></a><span id="l211.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l212.1"></a><span id="l212.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_syncChanges.js</span>
<a href="#l212.2"></a><span id="l212.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_syncChanges.js</span>
<a href="#l212.3"></a><span id="l212.3" class="difflineat">@@ -33,17 +33,17 @@ var tests = [</span>
<a href="#l212.4"></a><span id="l212.4">     gMessage.setFlag(&quot;\\Deleted&quot;);</span>
<a href="#l212.5"></a><span id="l212.5">     IMAPPump.inbox.expunge(asyncUrlListener, null);</span>
<a href="#l212.6"></a><span id="l212.6">     yield false;</span>
<a href="#l212.7"></a><span id="l212.7">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l212.8"></a><span id="l212.8">     yield false;</span>
<a href="#l212.9"></a><span id="l212.9">   },</span>
<a href="#l212.10"></a><span id="l212.10">   function checkMailboxEmpty() {</span>
<a href="#l212.11"></a><span id="l212.11">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l212.12"></a><span id="l212.12" class="difflineminus">-    do_check_eq(IMAPPump.inbox.getTotalMessages(false), 0);</span>
<a href="#l212.13"></a><span id="l212.13" class="difflineplus">+    Assert.equal(IMAPPump.inbox.getTotalMessages(false), 0);</span>
<a href="#l212.14"></a><span id="l212.14">   },</span>
<a href="#l212.15"></a><span id="l212.15">   teardown</span>
<a href="#l212.16"></a><span id="l212.16"> ];</span>
<a href="#l212.17"></a><span id="l212.17"> </span>
<a href="#l212.18"></a><span id="l212.18"> function* setup() {</span>
<a href="#l212.19"></a><span id="l212.19">   /*</span>
<a href="#l212.20"></a><span id="l212.20">    * Set up an IMAP server.</span>
<a href="#l212.21"></a><span id="l212.21">    */</span>
<a href="#l212.22"></a><span id="l212.22" class="difflineat">@@ -63,17 +63,17 @@ function* setup() {</span>
<a href="#l212.23"></a><span id="l212.23">   IMAPPump.mailbox.addMessage(gMessage);</span>
<a href="#l212.24"></a><span id="l212.24"> </span>
<a href="#l212.25"></a><span id="l212.25">   // update folder to download header.</span>
<a href="#l212.26"></a><span id="l212.26">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l212.27"></a><span id="l212.27">   yield false;</span>
<a href="#l212.28"></a><span id="l212.28"> }</span>
<a href="#l212.29"></a><span id="l212.29"> </span>
<a href="#l212.30"></a><span id="l212.30"> asyncUrlListener.callback = function(aUrl, aExitCode) {</span>
<a href="#l212.31"></a><span id="l212.31" class="difflineminus">-  do_check_eq(aExitCode, 0);</span>
<a href="#l212.32"></a><span id="l212.32" class="difflineplus">+  Assert.equal(aExitCode, 0);</span>
<a href="#l212.33"></a><span id="l212.33"> };</span>
<a href="#l212.34"></a><span id="l212.34"> </span>
<a href="#l212.35"></a><span id="l212.35"> function teardown() {</span>
<a href="#l212.36"></a><span id="l212.36">   teardownIMAPPump();</span>
<a href="#l212.37"></a><span id="l212.37"> }</span>
<a href="#l212.38"></a><span id="l212.38"> </span>
<a href="#l212.39"></a><span id="l212.39"> function run_test() {</span>
<a href="#l212.40"></a><span id="l212.40">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l213.1"></a><span id="l213.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_trustSpamAssassin.js</span>
<a href="#l213.2"></a><span id="l213.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_trustSpamAssassin.js</span>
<a href="#l213.3"></a><span id="l213.3" class="difflineat">@@ -37,17 +37,17 @@ var tests = [</span>
<a href="#l213.4"></a><span id="l213.4"> </span>
<a href="#l213.5"></a><span id="l213.5"> var gJunkFolder;</span>
<a href="#l213.6"></a><span id="l213.6"> function* createJunkFolder()</span>
<a href="#l213.7"></a><span id="l213.7"> {</span>
<a href="#l213.8"></a><span id="l213.8">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Junk&quot;, null);</span>
<a href="#l213.9"></a><span id="l213.9">   dl('wait for folderAdded');</span>
<a href="#l213.10"></a><span id="l213.10">   yield false;</span>
<a href="#l213.11"></a><span id="l213.11">   gJunkFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Junk&quot;);</span>
<a href="#l213.12"></a><span id="l213.12" class="difflineminus">-  do_check_true(gJunkFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l213.13"></a><span id="l213.13" class="difflineplus">+  Assert.ok(gJunkFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l213.14"></a><span id="l213.14">   gJunkFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l213.15"></a><span id="l213.15">   dl('wait for OnStopRunningURL');</span>
<a href="#l213.16"></a><span id="l213.16">   yield false;</span>
<a href="#l213.17"></a><span id="l213.17"> }</span>
<a href="#l213.18"></a><span id="l213.18"> </span>
<a href="#l213.19"></a><span id="l213.19"> /*</span>
<a href="#l213.20"></a><span id="l213.20">  * Load and update a message in the imap fake server, should move</span>
<a href="#l213.21"></a><span id="l213.21">  *  SpamAssassin-marked junk message to junk folder</span>
<a href="#l213.22"></a><span id="l213.22" class="difflineat">@@ -65,18 +65,18 @@ function* loadImapMessage()</span>
<a href="#l213.23"></a><span id="l213.23">   yield false;</span>
<a href="#l213.24"></a><span id="l213.24">   gJunkFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l213.25"></a><span id="l213.25">   dl('wait for OnStopRunningURL');</span>
<a href="#l213.26"></a><span id="l213.26">   yield false;</span>
<a href="#l213.27"></a><span id="l213.27"> }</span>
<a href="#l213.28"></a><span id="l213.28"> </span>
<a href="#l213.29"></a><span id="l213.29"> function* testMessageInJunk()</span>
<a href="#l213.30"></a><span id="l213.30"> {</span>
<a href="#l213.31"></a><span id="l213.31" class="difflineminus">-  do_check_eq(0, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l213.32"></a><span id="l213.32" class="difflineminus">-  do_check_eq(1, gJunkFolder.getTotalMessages(false));</span>
<a href="#l213.33"></a><span id="l213.33" class="difflineplus">+  Assert.equal(0, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l213.34"></a><span id="l213.34" class="difflineplus">+  Assert.equal(1, gJunkFolder.getTotalMessages(false));</span>
<a href="#l213.35"></a><span id="l213.35">   yield true;</span>
<a href="#l213.36"></a><span id="l213.36"> }</span>
<a href="#l213.37"></a><span id="l213.37"> </span>
<a href="#l213.38"></a><span id="l213.38"> function* markMessageAsGood()</span>
<a href="#l213.39"></a><span id="l213.39"> {</span>
<a href="#l213.40"></a><span id="l213.40">   /*</span>
<a href="#l213.41"></a><span id="l213.41">    * This is done in the application in nsMsgDBView, which is difficult</span>
<a href="#l213.42"></a><span id="l213.42">    *  to test in xpcshell tests. We aren't really trying to test that here</span>
<a href="#l213.43"></a><span id="l213.43" class="difflineat">@@ -117,18 +117,18 @@ function* updateFoldersAndCheck()</span>
<a href="#l213.44"></a><span id="l213.44"> {</span>
<a href="#l213.45"></a><span id="l213.45">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l213.46"></a><span id="l213.46">   dl('wait for OnStopRunningURL');</span>
<a href="#l213.47"></a><span id="l213.47">   yield false;</span>
<a href="#l213.48"></a><span id="l213.48">   gJunkFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l213.49"></a><span id="l213.49">   dl('wait for OnStopRunningURL');</span>
<a href="#l213.50"></a><span id="l213.50">   yield false;</span>
<a href="#l213.51"></a><span id="l213.51">   // bug 540385 causes this test to fail</span>
<a href="#l213.52"></a><span id="l213.52" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l213.53"></a><span id="l213.53" class="difflineminus">-  do_check_eq(0, gJunkFolder.getTotalMessages(false));</span>
<a href="#l213.54"></a><span id="l213.54" class="difflineplus">+  Assert.equal(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l213.55"></a><span id="l213.55" class="difflineplus">+  Assert.equal(0, gJunkFolder.getTotalMessages(false));</span>
<a href="#l213.56"></a><span id="l213.56">   yield true;</span>
<a href="#l213.57"></a><span id="l213.57"> }</span>
<a href="#l213.58"></a><span id="l213.58"> </span>
<a href="#l213.59"></a><span id="l213.59"> function endTest()</span>
<a href="#l213.60"></a><span id="l213.60"> {</span>
<a href="#l213.61"></a><span id="l213.61">   teardownIMAPPump();</span>
<a href="#l213.62"></a><span id="l213.62"> }</span>
<a href="#l213.63"></a><span id="l213.63"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l214.1"></a><span id="l214.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l214.2"></a><span id="l214.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l214.3"></a><span id="l214.3" class="difflineat">@@ -21,39 +21,39 @@ var gGenericImportHelper;</span>
<a href="#l214.4"></a><span id="l214.4"> function GenericImportHelper(aModuleType, aModuleSearchString, aFile)</span>
<a href="#l214.5"></a><span id="l214.5"> {</span>
<a href="#l214.6"></a><span id="l214.6">   gGenericImportHelper = null;</span>
<a href="#l214.7"></a><span id="l214.7">   if (![&quot;addressbook&quot;, &quot;mail&quot;, &quot;settings&quot;, &quot;filters&quot;].includes(aModuleType))</span>
<a href="#l214.8"></a><span id="l214.8">     do_throw(&quot;Unexpected type passed to the GenericImportHelper constructor&quot;);</span>
<a href="#l214.9"></a><span id="l214.9">   this.mModuleType = aModuleType;</span>
<a href="#l214.10"></a><span id="l214.10">   this.mModuleSearchString = aModuleSearchString;</span>
<a href="#l214.11"></a><span id="l214.11">   this.mInterface = this._findInterface();</span>
<a href="#l214.12"></a><span id="l214.12" class="difflineminus">-  do_check_neq(this.mInterface, null);</span>
<a href="#l214.13"></a><span id="l214.13" class="difflineplus">+  Assert.notEqual(this.mInterface, null);</span>
<a href="#l214.14"></a><span id="l214.14"> </span>
<a href="#l214.15"></a><span id="l214.15">   this.mFile = aFile; // checked in the beginImport method</span>
<a href="#l214.16"></a><span id="l214.16"> }</span>
<a href="#l214.17"></a><span id="l214.17"> </span>
<a href="#l214.18"></a><span id="l214.18"> GenericImportHelper.prototype =</span>
<a href="#l214.19"></a><span id="l214.19"> {</span>
<a href="#l214.20"></a><span id="l214.20">   interfaceType: Ci.nsIImportGeneric,</span>
<a href="#l214.21"></a><span id="l214.21">   /**</span>
<a href="#l214.22"></a><span id="l214.22">    * GenericImportHelper.beginImport</span>
<a href="#l214.23"></a><span id="l214.23">    * Imports the given address book export or mail data and invoke </span>
<a href="#l214.24"></a><span id="l214.24">    * checkProgress of child class to check the data,</span>
<a href="#l214.25"></a><span id="l214.25">    */</span>
<a href="#l214.26"></a><span id="l214.26">   beginImport: function() {</span>
<a href="#l214.27"></a><span id="l214.27" class="difflineminus">-    do_check_true(this.mFile instanceof Ci.nsIFile &amp;&amp; this.mFile.exists());</span>
<a href="#l214.28"></a><span id="l214.28" class="difflineplus">+    Assert.ok(this.mFile instanceof Ci.nsIFile &amp;&amp; this.mFile.exists());</span>
<a href="#l214.29"></a><span id="l214.29"> </span>
<a href="#l214.30"></a><span id="l214.30">     if (this.mModuleType == &quot;addressbook&quot;)</span>
<a href="#l214.31"></a><span id="l214.31">       this.mInterface.SetData(&quot;addressLocation&quot;, this.mFile);</span>
<a href="#l214.32"></a><span id="l214.32">     else if (this.mModuleType == &quot;mail&quot;)</span>
<a href="#l214.33"></a><span id="l214.33">       this.mInterface.SetData(&quot;mailLocation&quot;, this.mFile);</span>
<a href="#l214.34"></a><span id="l214.34"> </span>
<a href="#l214.35"></a><span id="l214.35" class="difflineminus">-    do_check_true(this.mInterface.WantsProgress());</span>
<a href="#l214.36"></a><span id="l214.36" class="difflineminus">-    do_check_true(this.mInterface.BeginImport(null, null));</span>
<a href="#l214.37"></a><span id="l214.37" class="difflineplus">+    Assert.ok(this.mInterface.WantsProgress());</span>
<a href="#l214.38"></a><span id="l214.38" class="difflineplus">+    Assert.ok(this.mInterface.BeginImport(null, null));</span>
<a href="#l214.39"></a><span id="l214.39">     do_test_pending();</span>
<a href="#l214.40"></a><span id="l214.40">     this.checkProgress();</span>
<a href="#l214.41"></a><span id="l214.41">   },</span>
<a href="#l214.42"></a><span id="l214.42">   /**</span>
<a href="#l214.43"></a><span id="l214.43">    * GenericImportHelper.getInterface</span>
<a href="#l214.44"></a><span id="l214.44">    *</span>
<a href="#l214.45"></a><span id="l214.45">    * @return An nsIImportGeneric import interface.</span>
<a href="#l214.46"></a><span id="l214.46">    */</span>
<a href="#l214.47"></a><span id="l214.47" class="difflineat">@@ -80,19 +80,19 @@ GenericImportHelper.prototype =</span>
<a href="#l214.48"></a><span id="l214.48">   },</span>
<a href="#l214.49"></a><span id="l214.49">   /**</span>
<a href="#l214.50"></a><span id="l214.50">    * GenericImportHelper.checkProgress</span>
<a href="#l214.51"></a><span id="l214.51">    * Checks the progress of an import every 200 milliseconds until it is</span>
<a href="#l214.52"></a><span id="l214.52">    * complete.  Checks the test results if there is an original address book,</span>
<a href="#l214.53"></a><span id="l214.53">    * otherwise evaluates the optional command, or calls do_test_finished().</span>
<a href="#l214.54"></a><span id="l214.54">    */</span>
<a href="#l214.55"></a><span id="l214.55">   checkProgress: function() {</span>
<a href="#l214.56"></a><span id="l214.56" class="difflineminus">-    do_check_true(this.mInterface &amp;&amp;</span>
<a href="#l214.57"></a><span id="l214.57" class="difflineminus">-                  this.mInterface instanceof Ci.nsIImportGeneric);</span>
<a href="#l214.58"></a><span id="l214.58" class="difflineminus">-    do_check_true(this.mInterface.ContinueImport());</span>
<a href="#l214.59"></a><span id="l214.59" class="difflineplus">+    Assert.ok(this.mInterface &amp;&amp;</span>
<a href="#l214.60"></a><span id="l214.60" class="difflineplus">+              this.mInterface instanceof Ci.nsIImportGeneric);</span>
<a href="#l214.61"></a><span id="l214.61" class="difflineplus">+    Assert.ok(this.mInterface.ContinueImport());</span>
<a href="#l214.62"></a><span id="l214.62">     // if the import isn't done, check again in 200 milliseconds.</span>
<a href="#l214.63"></a><span id="l214.63">     if (this.mInterface.GetProgress() != 100) {</span>
<a href="#l214.64"></a><span id="l214.64">       // use the helper object to check the progress of the import after 200 ms</span>
<a href="#l214.65"></a><span id="l214.65">       gGenericImportHelper = this;</span>
<a href="#l214.66"></a><span id="l214.66">       do_timeout(200, function(){gGenericImportHelper.checkProgress();});</span>
<a href="#l214.67"></a><span id="l214.67">     } else { // if it is done, check the results or finish the test.</span>
<a href="#l214.68"></a><span id="l214.68">       this.checkResults();</span>
<a href="#l214.69"></a><span id="l214.69">       do_test_finished();</span>
<a href="#l214.70"></a><span id="l214.70" class="difflineat">@@ -228,42 +228,42 @@ AbImportHelper.prototype =</span>
<a href="#l214.71"></a><span id="l214.71">     if (!this.mJsonCards)</span>
<a href="#l214.72"></a><span id="l214.72">       do_throw(&quot;The address book must be setup before checking results&quot;);</span>
<a href="#l214.73"></a><span id="l214.73">     // When do_test_pending() was called and there is an error the test hangs.</span>
<a href="#l214.74"></a><span id="l214.74">     // This try/catch block will catch any errors and call do_throw() with the</span>
<a href="#l214.75"></a><span id="l214.75">     // error to throw the error and avoid the hang.</span>
<a href="#l214.76"></a><span id="l214.76">     try {</span>
<a href="#l214.77"></a><span id="l214.77">       // make sure an address book was created</span>
<a href="#l214.78"></a><span id="l214.78">       var newAb = this.getAbByName(this.mAbName);</span>
<a href="#l214.79"></a><span id="l214.79" class="difflineminus">-      do_check_neq(newAb, null);</span>
<a href="#l214.80"></a><span id="l214.80" class="difflineminus">-      do_check_true(newAb instanceof Ci.nsIAbDirectory &amp;&amp;</span>
<a href="#l214.81"></a><span id="l214.81" class="difflineminus">-                    newAb.childCards instanceof Ci.nsISimpleEnumerator);</span>
<a href="#l214.82"></a><span id="l214.82" class="difflineplus">+      Assert.notEqual(newAb, null);</span>
<a href="#l214.83"></a><span id="l214.83" class="difflineplus">+      Assert.ok(newAb instanceof Ci.nsIAbDirectory &amp;&amp;</span>
<a href="#l214.84"></a><span id="l214.84" class="difflineplus">+                newAb.childCards instanceof Ci.nsISimpleEnumerator);</span>
<a href="#l214.85"></a><span id="l214.85">       // get the imported card(s) and check each one</span>
<a href="#l214.86"></a><span id="l214.86">       var iter = newAb.childCards;</span>
<a href="#l214.87"></a><span id="l214.87">       var count = 0;</span>
<a href="#l214.88"></a><span id="l214.88">       for (; iter.hasMoreElements(); count++) {</span>
<a href="#l214.89"></a><span id="l214.89">         var importedCard = iter.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l214.90"></a><span id="l214.90">         this.compareCards(this.mJsonCards[count], importedCard);</span>
<a href="#l214.91"></a><span id="l214.91">       }</span>
<a href="#l214.92"></a><span id="l214.92">       // make sure there are the same number of cards in the address book and</span>
<a href="#l214.93"></a><span id="l214.93">       // the JSON array</span>
<a href="#l214.94"></a><span id="l214.94" class="difflineminus">-      do_check_eq(count, this.mJsonCards.length);</span>
<a href="#l214.95"></a><span id="l214.95" class="difflineplus">+      Assert.equal(count, this.mJsonCards.length);</span>
<a href="#l214.96"></a><span id="l214.96">       do_test_finished();</span>
<a href="#l214.97"></a><span id="l214.97">     } catch(e) { do_throw(e); }</span>
<a href="#l214.98"></a><span id="l214.98">   },</span>
<a href="#l214.99"></a><span id="l214.99">   /**</span>
<a href="#l214.100"></a><span id="l214.100">    * AbImportHelper.getAbByName</span>
<a href="#l214.101"></a><span id="l214.101">    * Returns the Address Book (if any) with the given name.</span>
<a href="#l214.102"></a><span id="l214.102">    *</span>
<a href="#l214.103"></a><span id="l214.103">    * @param aName The name of the Address Book to find.</span>
<a href="#l214.104"></a><span id="l214.104">    * @return An nsIAbDirectory, if found.</span>
<a href="#l214.105"></a><span id="l214.105">    *         null if the requested Address Book could not be found.</span>
<a href="#l214.106"></a><span id="l214.106">    */</span>
<a href="#l214.107"></a><span id="l214.107">   getAbByName: function(aName) {</span>
<a href="#l214.108"></a><span id="l214.108" class="difflineminus">-    do_check_true(aName &amp;&amp; aName.length &gt; 0);</span>
<a href="#l214.109"></a><span id="l214.109" class="difflineplus">+    Assert.ok(aName &amp;&amp; aName.length &gt; 0);</span>
<a href="#l214.110"></a><span id="l214.110"> </span>
<a href="#l214.111"></a><span id="l214.111">     var iter = MailServices.ab.directories;</span>
<a href="#l214.112"></a><span id="l214.112">     var data = null;</span>
<a href="#l214.113"></a><span id="l214.113">     while (iter.hasMoreElements()) {</span>
<a href="#l214.114"></a><span id="l214.114">       data = iter.getNext();</span>
<a href="#l214.115"></a><span id="l214.115">       if (data instanceof Ci.nsIAbDirectory)</span>
<a href="#l214.116"></a><span id="l214.116">         if (data.dirName == aName)</span>
<a href="#l214.117"></a><span id="l214.117">           return data;</span>
<a href="#l214.118"></a><span id="l214.118" class="difflineat">@@ -276,17 +276,17 @@ AbImportHelper.prototype =</span>
<a href="#l214.119"></a><span id="l214.119">    * values of a supported attribute are different.</span>
<a href="#l214.120"></a><span id="l214.120">    *</span>
<a href="#l214.121"></a><span id="l214.121">    * @param aJsonCard The object decoded from addressbook.json.</span>
<a href="#l214.122"></a><span id="l214.122">    * @param aCard     The imported card to compare with.</span>
<a href="#l214.123"></a><span id="l214.123">    */</span>
<a href="#l214.124"></a><span id="l214.124">   compareCards: function(aJsonCard, aCard) {</span>
<a href="#l214.125"></a><span id="l214.125">     for (var i in aJsonCard)</span>
<a href="#l214.126"></a><span id="l214.126">       if (this.mSupportedAttributes.indexOf(i) &gt;= 0)</span>
<a href="#l214.127"></a><span id="l214.127" class="difflineminus">-        do_check_eq(aJsonCard[i], aCard.getProperty(i, &quot;BAD&quot;));</span>
<a href="#l214.128"></a><span id="l214.128" class="difflineplus">+        Assert.equal(aJsonCard[i], aCard.getProperty(i, &quot;BAD&quot;));</span>
<a href="#l214.129"></a><span id="l214.129">   },</span>
<a href="#l214.130"></a><span id="l214.130">   /**</span>
<a href="#l214.131"></a><span id="l214.131">    * AbImportHelper.getJsonCards</span>
<a href="#l214.132"></a><span id="l214.132">    * Gets an array of &quot;cards&quot; from the JSON file addressbook.json located in the</span>
<a href="#l214.133"></a><span id="l214.133">    * mailnews/import/test/resources folder.  The array should contain objects</span>
<a href="#l214.134"></a><span id="l214.134">    * with the expected properties and values of the cards in the imported</span>
<a href="#l214.135"></a><span id="l214.135">    * address book.</span>
<a href="#l214.136"></a><span id="l214.136">    * See addressbook.json for an example and AB_README for more details.</span>
<a href="#l214.137"></a><span id="l214.137" class="difflineat">@@ -314,17 +314,17 @@ AbImportHelper.prototype =</span>
<a href="#l214.138"></a><span id="l214.138">     // get the entire file into the json string</span>
<a href="#l214.139"></a><span id="l214.139">     while(istream.readString(4096, str) != 0)</span>
<a href="#l214.140"></a><span id="l214.140">       json += str.value;</span>
<a href="#l214.141"></a><span id="l214.141">     // close the input streams</span>
<a href="#l214.142"></a><span id="l214.142">     istream.close();</span>
<a href="#l214.143"></a><span id="l214.143">     fis.close();</span>
<a href="#l214.144"></a><span id="l214.144">     // decode the JSON and get the array of cards</span>
<a href="#l214.145"></a><span id="l214.145">     var arr = JSON.parse(json)[aName];</span>
<a href="#l214.146"></a><span id="l214.146" class="difflineminus">-    do_check_true(arr &amp;&amp; arr.length &gt; 0);</span>
<a href="#l214.147"></a><span id="l214.147" class="difflineplus">+    Assert.ok(arr &amp;&amp; arr.length &gt; 0);</span>
<a href="#l214.148"></a><span id="l214.148">     return arr;</span>
<a href="#l214.149"></a><span id="l214.149">   },</span>
<a href="#l214.150"></a><span id="l214.150"> </span>
<a href="#l214.151"></a><span id="l214.151">   setSupportedAttributes: function(attributes) {</span>
<a href="#l214.152"></a><span id="l214.152">     this.mSupportedAttributes = attributes;</span>
<a href="#l214.153"></a><span id="l214.153">   }</span>
<a href="#l214.154"></a><span id="l214.154"> };</span>
<a href="#l214.155"></a><span id="l214.155"> </span>
<a href="#l214.156"></a><span id="l214.156" class="difflineat">@@ -348,43 +348,43 @@ function MailImportHelper(aFile, aModule</span>
<a href="#l214.157"></a><span id="l214.157">   this.mExpected = aExpected;</span>
<a href="#l214.158"></a><span id="l214.158"> }</span>
<a href="#l214.159"></a><span id="l214.159"> </span>
<a href="#l214.160"></a><span id="l214.160"> MailImportHelper.prototype =</span>
<a href="#l214.161"></a><span id="l214.161"> {</span>
<a href="#l214.162"></a><span id="l214.162">   __proto__: GenericImportHelper.prototype,</span>
<a href="#l214.163"></a><span id="l214.163">   interfaceType: Ci.nsIImportGeneric,</span>
<a href="#l214.164"></a><span id="l214.164">   _checkEqualFolder: function(expectedFolder, actualFolder) {</span>
<a href="#l214.165"></a><span id="l214.165" class="difflineminus">-    do_check_eq(expectedFolder.leafName, actualFolder.name);</span>
<a href="#l214.166"></a><span id="l214.166" class="difflineplus">+    Assert.equal(expectedFolder.leafName, actualFolder.name);</span>
<a href="#l214.167"></a><span id="l214.167">     let expectedSubFolderCount = 0;</span>
<a href="#l214.168"></a><span id="l214.168"> </span>
<a href="#l214.169"></a><span id="l214.169">     let expectedEnumerator = expectedFolder.directoryEntries;</span>
<a href="#l214.170"></a><span id="l214.170">     let expectedSubFolders = [];</span>
<a href="#l214.171"></a><span id="l214.171">     while (expectedEnumerator.hasMoreElements()) {</span>
<a href="#l214.172"></a><span id="l214.172">       let entry = expectedEnumerator.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l214.173"></a><span id="l214.173">       if (entry.isDirectory()) {</span>
<a href="#l214.174"></a><span id="l214.174">         expectedSubFolderCount++;</span>
<a href="#l214.175"></a><span id="l214.175">         expectedSubFolders.push(entry);</span>
<a href="#l214.176"></a><span id="l214.176">       }</span>
<a href="#l214.177"></a><span id="l214.177">     }</span>
<a href="#l214.178"></a><span id="l214.178" class="difflineminus">-    do_check_eq(expectedSubFolderCount, actualFolder.numSubFolders);</span>
<a href="#l214.179"></a><span id="l214.179" class="difflineplus">+    Assert.equal(expectedSubFolderCount, actualFolder.numSubFolders);</span>
<a href="#l214.180"></a><span id="l214.180"> </span>
<a href="#l214.181"></a><span id="l214.181">     let actualEnumerator = actualFolder.subFolders;</span>
<a href="#l214.182"></a><span id="l214.182">     for (let i = 0; i &lt; expectedSubFolderCount; i++) {</span>
<a href="#l214.183"></a><span id="l214.183">       let expectedSubFolder = expectedSubFolders[i];</span>
<a href="#l214.184"></a><span id="l214.184">       let actualSubFolder = actualEnumerator.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l214.185"></a><span id="l214.185">       this._checkEqualFolder(expectedSubFolder, actualSubFolder);</span>
<a href="#l214.186"></a><span id="l214.186">     }</span>
<a href="#l214.187"></a><span id="l214.187">   },</span>
<a href="#l214.188"></a><span id="l214.188"> </span>
<a href="#l214.189"></a><span id="l214.189">   checkResults: function() {</span>
<a href="#l214.190"></a><span id="l214.190">     let rootFolder = MailServices.accounts.localFoldersServer.rootFolder;</span>
<a href="#l214.191"></a><span id="l214.191" class="difflineminus">-    do_check_true(rootFolder.containsChildNamed(this.mFile.leafName));</span>
<a href="#l214.192"></a><span id="l214.192" class="difflineplus">+    Assert.ok(rootFolder.containsChildNamed(this.mFile.leafName));</span>
<a href="#l214.193"></a><span id="l214.193">     let importedFolder = rootFolder.getChildNamed(this.mFile.leafName);</span>
<a href="#l214.194"></a><span id="l214.194" class="difflineminus">-    do_check_neq(importedFolder, null);</span>
<a href="#l214.195"></a><span id="l214.195" class="difflineplus">+    Assert.notEqual(importedFolder, null);</span>
<a href="#l214.196"></a><span id="l214.196"> </span>
<a href="#l214.197"></a><span id="l214.197">     this._checkEqualFolder(this.mExpected, importedFolder);</span>
<a href="#l214.198"></a><span id="l214.198">   }</span>
<a href="#l214.199"></a><span id="l214.199"> }</span>
<a href="#l214.200"></a><span id="l214.200"> </span>
<a href="#l214.201"></a><span id="l214.201"> /**</span>
<a href="#l214.202"></a><span id="l214.202">  * SettingsImportHelper</span>
<a href="#l214.203"></a><span id="l214.203">  * A helper for settings imports.</span>
<a href="#l214.204"></a><span id="l214.204" class="difflineat">@@ -414,71 +414,71 @@ SettingsImportHelper.prototype =</span>
<a href="#l214.205"></a><span id="l214.205">    * Imports settings from a specific file or auto-located if the file is null,</span>
<a href="#l214.206"></a><span id="l214.206">    * and compare the import results with the expected array.</span>
<a href="#l214.207"></a><span id="l214.207">    */</span>
<a href="#l214.208"></a><span id="l214.208">   beginImport: function() {</span>
<a href="#l214.209"></a><span id="l214.209">     this._ensureNoAccounts();</span>
<a href="#l214.210"></a><span id="l214.210">     if (this.mFile)</span>
<a href="#l214.211"></a><span id="l214.211">       this.mInterface.SetLocation(this.mFile);</span>
<a href="#l214.212"></a><span id="l214.212">     else</span>
<a href="#l214.213"></a><span id="l214.213" class="difflineminus">-      do_check_eq(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l214.214"></a><span id="l214.214" class="difflineminus">-    do_check_eq(true, this.mInterface.Import({}));</span>
<a href="#l214.215"></a><span id="l214.215" class="difflineplus">+      Assert.equal(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l214.216"></a><span id="l214.216" class="difflineplus">+    Assert.equal(true, this.mInterface.Import({}));</span>
<a href="#l214.217"></a><span id="l214.217">     this.checkResults();</span>
<a href="#l214.218"></a><span id="l214.218">   },</span>
<a href="#l214.219"></a><span id="l214.219"> </span>
<a href="#l214.220"></a><span id="l214.220">   _ensureNoAccounts: function() {</span>
<a href="#l214.221"></a><span id="l214.221">     let accounts = MailServices.accounts.accounts;</span>
<a href="#l214.222"></a><span id="l214.222"> </span>
<a href="#l214.223"></a><span id="l214.223">     for (let i = 0; i &lt; accounts.length; i++) {</span>
<a href="#l214.224"></a><span id="l214.224">       let account = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l214.225"></a><span id="l214.225">       MailServices.accounts.removeAccount(account);</span>
<a href="#l214.226"></a><span id="l214.226">     }</span>
<a href="#l214.227"></a><span id="l214.227">   },</span>
<a href="#l214.228"></a><span id="l214.228"> </span>
<a href="#l214.229"></a><span id="l214.229">   _checkSmtpServer: function(expected, actual) {</span>
<a href="#l214.230"></a><span id="l214.230" class="difflineminus">-    do_check_eq(expected.port, actual.port);</span>
<a href="#l214.231"></a><span id="l214.231" class="difflineminus">-    do_check_eq(expected.username, actual.username);</span>
<a href="#l214.232"></a><span id="l214.232" class="difflineminus">-    do_check_eq(expected.authMethod, actual.authMethod);</span>
<a href="#l214.233"></a><span id="l214.233" class="difflineminus">-    do_check_eq(expected.socketType, actual.socketType);</span>
<a href="#l214.234"></a><span id="l214.234" class="difflineplus">+    Assert.equal(expected.port, actual.port);</span>
<a href="#l214.235"></a><span id="l214.235" class="difflineplus">+    Assert.equal(expected.username, actual.username);</span>
<a href="#l214.236"></a><span id="l214.236" class="difflineplus">+    Assert.equal(expected.authMethod, actual.authMethod);</span>
<a href="#l214.237"></a><span id="l214.237" class="difflineplus">+    Assert.equal(expected.socketType, actual.socketType);</span>
<a href="#l214.238"></a><span id="l214.238">   },</span>
<a href="#l214.239"></a><span id="l214.239"> </span>
<a href="#l214.240"></a><span id="l214.240">   _checkIdentity: function(expected, actual) {</span>
<a href="#l214.241"></a><span id="l214.241" class="difflineminus">-    do_check_eq(expected.fullName, actual.fullName);</span>
<a href="#l214.242"></a><span id="l214.242" class="difflineminus">-    do_check_eq(expected.email, actual.email);</span>
<a href="#l214.243"></a><span id="l214.243" class="difflineminus">-    do_check_eq(expected.replyTo, actual.replyTo);</span>
<a href="#l214.244"></a><span id="l214.244" class="difflineminus">-    do_check_eq(expected.organization, actual.organization);</span>
<a href="#l214.245"></a><span id="l214.245" class="difflineplus">+    Assert.equal(expected.fullName, actual.fullName);</span>
<a href="#l214.246"></a><span id="l214.246" class="difflineplus">+    Assert.equal(expected.email, actual.email);</span>
<a href="#l214.247"></a><span id="l214.247" class="difflineplus">+    Assert.equal(expected.replyTo, actual.replyTo);</span>
<a href="#l214.248"></a><span id="l214.248" class="difflineplus">+    Assert.equal(expected.organization, actual.organization);</span>
<a href="#l214.249"></a><span id="l214.249">   },</span>
<a href="#l214.250"></a><span id="l214.250"> </span>
<a href="#l214.251"></a><span id="l214.251">   _checkPop3IncomingServer: function(expected, actual) {</span>
<a href="#l214.252"></a><span id="l214.252" class="difflineminus">-    do_check_eq(expected.leaveMessagesOnServer, actual.leaveMessagesOnServer);</span>
<a href="#l214.253"></a><span id="l214.253" class="difflineminus">-    do_check_eq(expected.deleteMailLeftOnServer, actual.deleteMailLeftOnServer);</span>
<a href="#l214.254"></a><span id="l214.254" class="difflineminus">-    do_check_eq(expected.deleteByAgeFromServer, actual.deleteByAgeFromServer);</span>
<a href="#l214.255"></a><span id="l214.255" class="difflineminus">-    do_check_eq(expected.numDaysToLeaveOnServer, actual.numDaysToLeaveOnServer);</span>
<a href="#l214.256"></a><span id="l214.256" class="difflineplus">+    Assert.equal(expected.leaveMessagesOnServer, actual.leaveMessagesOnServer);</span>
<a href="#l214.257"></a><span id="l214.257" class="difflineplus">+    Assert.equal(expected.deleteMailLeftOnServer, actual.deleteMailLeftOnServer);</span>
<a href="#l214.258"></a><span id="l214.258" class="difflineplus">+    Assert.equal(expected.deleteByAgeFromServer, actual.deleteByAgeFromServer);</span>
<a href="#l214.259"></a><span id="l214.259" class="difflineplus">+    Assert.equal(expected.numDaysToLeaveOnServer, actual.numDaysToLeaveOnServer);</span>
<a href="#l214.260"></a><span id="l214.260">   },</span>
<a href="#l214.261"></a><span id="l214.261"> </span>
<a href="#l214.262"></a><span id="l214.262">   _checkIncomingServer: function(expected, actual) {</span>
<a href="#l214.263"></a><span id="l214.263" class="difflineminus">-    do_check_eq(expected.type, actual.type);</span>
<a href="#l214.264"></a><span id="l214.264" class="difflineminus">-    do_check_eq(expected.port, actual.port);</span>
<a href="#l214.265"></a><span id="l214.265" class="difflineminus">-    do_check_eq(expected.username, actual.username);</span>
<a href="#l214.266"></a><span id="l214.266" class="difflineminus">-    do_check_eq(expected.isSecure, actual.isSecure);</span>
<a href="#l214.267"></a><span id="l214.267" class="difflineminus">-    do_check_eq(expected.hostName, actual.hostName);</span>
<a href="#l214.268"></a><span id="l214.268" class="difflineminus">-    do_check_eq(expected.prettyName, actual.prettyName);</span>
<a href="#l214.269"></a><span id="l214.269" class="difflineminus">-    do_check_eq(expected.authMethod, actual.authMethod);</span>
<a href="#l214.270"></a><span id="l214.270" class="difflineminus">-    do_check_eq(expected.socketType, actual.socketType);</span>
<a href="#l214.271"></a><span id="l214.271" class="difflineminus">-    do_check_eq(expected.doBiff, actual.doBiff);</span>
<a href="#l214.272"></a><span id="l214.272" class="difflineminus">-    do_check_eq(expected.biffMinutes, actual.biffMinutes);</span>
<a href="#l214.273"></a><span id="l214.273" class="difflineplus">+    Assert.equal(expected.type, actual.type);</span>
<a href="#l214.274"></a><span id="l214.274" class="difflineplus">+    Assert.equal(expected.port, actual.port);</span>
<a href="#l214.275"></a><span id="l214.275" class="difflineplus">+    Assert.equal(expected.username, actual.username);</span>
<a href="#l214.276"></a><span id="l214.276" class="difflineplus">+    Assert.equal(expected.isSecure, actual.isSecure);</span>
<a href="#l214.277"></a><span id="l214.277" class="difflineplus">+    Assert.equal(expected.hostName, actual.hostName);</span>
<a href="#l214.278"></a><span id="l214.278" class="difflineplus">+    Assert.equal(expected.prettyName, actual.prettyName);</span>
<a href="#l214.279"></a><span id="l214.279" class="difflineplus">+    Assert.equal(expected.authMethod, actual.authMethod);</span>
<a href="#l214.280"></a><span id="l214.280" class="difflineplus">+    Assert.equal(expected.socketType, actual.socketType);</span>
<a href="#l214.281"></a><span id="l214.281" class="difflineplus">+    Assert.equal(expected.doBiff, actual.doBiff);</span>
<a href="#l214.282"></a><span id="l214.282" class="difflineplus">+    Assert.equal(expected.biffMinutes, actual.biffMinutes);</span>
<a href="#l214.283"></a><span id="l214.283"> </span>
<a href="#l214.284"></a><span id="l214.284">     if (expected.type == &quot;pop3&quot;)</span>
<a href="#l214.285"></a><span id="l214.285">       this._checkPop3IncomingServer(expected, actual.QueryInterface(Ci.nsIPop3IncomingServer));</span>
<a href="#l214.286"></a><span id="l214.286">   },</span>
<a href="#l214.287"></a><span id="l214.287"> </span>
<a href="#l214.288"></a><span id="l214.288">   _checkAccount: function(expected, actual) {</span>
<a href="#l214.289"></a><span id="l214.289">     this._checkIncomingServer(expected.incomingServer, actual.incomingServer);</span>
<a href="#l214.290"></a><span id="l214.290"> </span>
<a href="#l214.291"></a><span id="l214.291" class="difflineminus">-    do_check_eq(1, actual.identities.length);</span>
<a href="#l214.292"></a><span id="l214.292" class="difflineplus">+    Assert.equal(1, actual.identities.length);</span>
<a href="#l214.293"></a><span id="l214.293">     let actualIdentity = actual.identities.queryElementAt(0, Ci.nsIMsgIdentity);</span>
<a href="#l214.294"></a><span id="l214.294">     this._checkIdentity(expected.identity, actualIdentity);</span>
<a href="#l214.295"></a><span id="l214.295"> </span>
<a href="#l214.296"></a><span id="l214.296">     if (expected.incomingServer.type != &quot;nntp&quot;) {</span>
<a href="#l214.297"></a><span id="l214.297">       let actualSmtpServer = MailServices.smtp.getServerByKey(actualIdentity.smtpServerKey);</span>
<a href="#l214.298"></a><span id="l214.298">       this._checkSmtpServer(expected.smtpServer, actualSmtpServer);</span>
<a href="#l214.299"></a><span id="l214.299">     }</span>
<a href="#l214.300"></a><span id="l214.300">   },</span>
<a href="#l214.301"></a><span id="l214.301" class="difflineat">@@ -499,18 +499,18 @@ SettingsImportHelper.prototype =</span>
<a href="#l214.302"></a><span id="l214.302"> </span>
<a href="#l214.303"></a><span id="l214.303">   checkResults: function() {</span>
<a href="#l214.304"></a><span id="l214.304">     accounts = MailServices.accounts.accounts;</span>
<a href="#l214.305"></a><span id="l214.305">     for (let i = 0; i &lt; accounts.length - 1; i++) {</span>
<a href="#l214.306"></a><span id="l214.306">       let actualAccount = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l214.307"></a><span id="l214.307">       if (this._isLocalMailAccount(actualAccount))</span>
<a href="#l214.308"></a><span id="l214.308">         continue;</span>
<a href="#l214.309"></a><span id="l214.309">       let expectedAccounts = this._findExpectedAccount(actualAccount);</span>
<a href="#l214.310"></a><span id="l214.310" class="difflineminus">-      do_check_neq(null, expectedAccounts);</span>
<a href="#l214.311"></a><span id="l214.311" class="difflineminus">-      do_check_eq(1, expectedAccounts.length);</span>
<a href="#l214.312"></a><span id="l214.312" class="difflineplus">+      Assert.notEqual(null, expectedAccounts);</span>
<a href="#l214.313"></a><span id="l214.313" class="difflineplus">+      Assert.equal(1, expectedAccounts.length);</span>
<a href="#l214.314"></a><span id="l214.314">       this._checkAccount(expectedAccounts[0], actualAccount);</span>
<a href="#l214.315"></a><span id="l214.315">     }</span>
<a href="#l214.316"></a><span id="l214.316">   }</span>
<a href="#l214.317"></a><span id="l214.317"> }</span>
<a href="#l214.318"></a><span id="l214.318"> </span>
<a href="#l214.319"></a><span id="l214.319"> /**</span>
<a href="#l214.320"></a><span id="l214.320">  * FiltersImportHelper</span>
<a href="#l214.321"></a><span id="l214.321">  * A helper for filter imports.</span>
<a href="#l214.322"></a><span id="l214.322" class="difflineat">@@ -539,18 +539,18 @@ FiltersImportHelper.prototype =</span>
<a href="#l214.323"></a><span id="l214.323">    * FiltersImportHelper.beginImport</span>
<a href="#l214.324"></a><span id="l214.324">    * Imports filters from a specific file/folder or auto-located if the file is null,</span>
<a href="#l214.325"></a><span id="l214.325">    * and compare the import results with the expected array.</span>
<a href="#l214.326"></a><span id="l214.326">    */</span>
<a href="#l214.327"></a><span id="l214.327">   beginImport: function() {</span>
<a href="#l214.328"></a><span id="l214.328">     if (this.mFile)</span>
<a href="#l214.329"></a><span id="l214.329">       this.mInterface.SetLocation(this.mFile);</span>
<a href="#l214.330"></a><span id="l214.330">     else</span>
<a href="#l214.331"></a><span id="l214.331" class="difflineminus">-      do_check_eq(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l214.332"></a><span id="l214.332" class="difflineminus">-    do_check_eq(true, this.mInterface.Import({}));</span>
<a href="#l214.333"></a><span id="l214.333" class="difflineplus">+      Assert.equal(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l214.334"></a><span id="l214.334" class="difflineplus">+    Assert.equal(true, this.mInterface.Import({}));</span>
<a href="#l214.335"></a><span id="l214.335">     this.checkResults();</span>
<a href="#l214.336"></a><span id="l214.336">   },</span>
<a href="#l214.337"></a><span id="l214.337"> </span>
<a href="#l214.338"></a><span id="l214.338">   _loopOverFilters: function(aFilterList, aCondition) {</span>
<a href="#l214.339"></a><span id="l214.339">     let result = 0;</span>
<a href="#l214.340"></a><span id="l214.340">     for (let i = 0; i &lt; aFilterList.filterCount; i++) {</span>
<a href="#l214.341"></a><span id="l214.341">       let filter = aFilterList.getFilterAt(i);</span>
<a href="#l214.342"></a><span id="l214.342">       if (aCondition(filter))</span>
<a href="#l214.343"></a><span id="l214.343" class="difflineat">@@ -559,26 +559,26 @@ FiltersImportHelper.prototype =</span>
<a href="#l214.344"></a><span id="l214.344">     return result;</span>
<a href="#l214.345"></a><span id="l214.345">   },</span>
<a href="#l214.346"></a><span id="l214.346"> </span>
<a href="#l214.347"></a><span id="l214.347">   checkResults: function() {</span>
<a href="#l214.348"></a><span id="l214.348">     let expected = this.mExpected;</span>
<a href="#l214.349"></a><span id="l214.349">     let server = MailServices.accounts.localFoldersServer;</span>
<a href="#l214.350"></a><span id="l214.350">     let filterList = server.getFilterList(null);</span>
<a href="#l214.351"></a><span id="l214.351">     if (&quot;count&quot; in expected)</span>
<a href="#l214.352"></a><span id="l214.352" class="difflineminus">-      do_check_eq(filterList.filterCount, expected.count);</span>
<a href="#l214.353"></a><span id="l214.353" class="difflineplus">+      Assert.equal(filterList.filterCount, expected.count);</span>
<a href="#l214.354"></a><span id="l214.354">     if (&quot;enabled&quot; in expected)</span>
<a href="#l214.355"></a><span id="l214.355" class="difflineminus">-      do_check_eq(this._loopOverFilters(filterList, f =&gt; f.enabled), expected.enabled);</span>
<a href="#l214.356"></a><span id="l214.356" class="difflineplus">+      Assert.equal(this._loopOverFilters(filterList, f =&gt; f.enabled), expected.enabled);</span>
<a href="#l214.357"></a><span id="l214.357">     if (&quot;incoming&quot; in expected) {</span>
<a href="#l214.358"></a><span id="l214.358" class="difflineminus">-      do_check_eq(this._loopOverFilters(filterList,</span>
<a href="#l214.359"></a><span id="l214.359" class="difflineminus">-                                        f =&gt; (f.filterType &amp; Ci.nsMsgFilterType.InboxRule)),</span>
<a href="#l214.360"></a><span id="l214.360" class="difflineminus">-                                        expected.incoming);</span>
<a href="#l214.361"></a><span id="l214.361" class="difflineplus">+      Assert.equal(this._loopOverFilters(filterList,</span>
<a href="#l214.362"></a><span id="l214.362" class="difflineplus">+                                         f =&gt; (f.filterType &amp; Ci.nsMsgFilterType.InboxRule)),</span>
<a href="#l214.363"></a><span id="l214.363" class="difflineplus">+                                         expected.incoming);</span>
<a href="#l214.364"></a><span id="l214.364">     }</span>
<a href="#l214.365"></a><span id="l214.365">     if (&quot;outgoing&quot; in expected) {</span>
<a href="#l214.366"></a><span id="l214.366" class="difflineminus">-      do_check_eq(this._loopOverFilters(filterList,</span>
<a href="#l214.367"></a><span id="l214.367" class="difflineminus">-                                        f =&gt; (f.filterType &amp; Ci.nsMsgFilterType.PostOutgoing)),</span>
<a href="#l214.368"></a><span id="l214.368" class="difflineminus">-                                        expected.outgoing);</span>
<a href="#l214.369"></a><span id="l214.369" class="difflineplus">+      Assert.equal(this._loopOverFilters(filterList,</span>
<a href="#l214.370"></a><span id="l214.370" class="difflineplus">+                                         f =&gt; (f.filterType &amp; Ci.nsMsgFilterType.PostOutgoing)),</span>
<a href="#l214.371"></a><span id="l214.371" class="difflineplus">+                                         expected.outgoing);</span>
<a href="#l214.372"></a><span id="l214.372">     }</span>
<a href="#l214.373"></a><span id="l214.373">   }</span>
<a href="#l214.374"></a><span id="l214.374"> }</span>
<a href="#l214.375"></a><span id="l214.375"> </span>
<a href="#l214.376"></a><span id="l214.376"> </span>
<a href="#l214.377"></a><span id="l214.377"> do_load_manifest(&quot;resources/TestMailImporter.manifest&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l215.1"></a><span id="l215.1" class="difflineminus">--- a/mailnews/import/test/unit/test_bug_437556.js</span>
<a href="#l215.2"></a><span id="l215.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_bug_437556.js</span>
<a href="#l215.3"></a><span id="l215.3" class="difflineat">@@ -8,16 +8,16 @@ function run_test()</span>
<a href="#l215.4"></a><span id="l215.4">   var errorStr = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l215.5"></a><span id="l215.5">                   .createInstance(Ci.nsISupportsString);</span>
<a href="#l215.6"></a><span id="l215.6">   // get the Address Book text import interface and make sure it succeeded</span>
<a href="#l215.7"></a><span id="l215.7">   var helper = new AbImportHelper(file, &quot;Text file&quot;);</span>
<a href="#l215.8"></a><span id="l215.8">   helper.setFieldMap(null);</span>
<a href="#l215.9"></a><span id="l215.9">   helper.setAddressBookLocation(file);</span>
<a href="#l215.10"></a><span id="l215.10"> </span>
<a href="#l215.11"></a><span id="l215.11">   var abInterface = helper.getInterface();</span>
<a href="#l215.12"></a><span id="l215.12" class="difflineminus">-  do_check_neq(abInterface, null);</span>
<a href="#l215.13"></a><span id="l215.13" class="difflineplus">+  Assert.notEqual(abInterface, null);</span>
<a href="#l215.14"></a><span id="l215.14">   // prepare to start the import</span>
<a href="#l215.15"></a><span id="l215.15" class="difflineminus">-  do_check_true(abInterface.WantsProgress());</span>
<a href="#l215.16"></a><span id="l215.16" class="difflineplus">+  Assert.ok(abInterface.WantsProgress());</span>
<a href="#l215.17"></a><span id="l215.17">   // start the import</span>
<a href="#l215.18"></a><span id="l215.18">   // BeginImport should return false and log an error if the fieldMap isn't set</span>
<a href="#l215.19"></a><span id="l215.19" class="difflineminus">-  do_check_false(abInterface.BeginImport(null, errorStr));</span>
<a href="#l215.20"></a><span id="l215.20" class="difflineminus">-  do_check_neq(errorStr, &quot;&quot;);</span>
<a href="#l215.21"></a><span id="l215.21" class="difflineplus">+  Assert.ok(!abInterface.BeginImport(null, errorStr));</span>
<a href="#l215.22"></a><span id="l215.22" class="difflineplus">+  Assert.notEqual(errorStr, &quot;&quot;);</span>
<a href="#l215.23"></a><span id="l215.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l216.1"></a><span id="l216.1" class="difflineminus">--- a/mailnews/import/test/unit/test_csv_GetSample.js</span>
<a href="#l216.2"></a><span id="l216.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_csv_GetSample.js</span>
<a href="#l216.3"></a><span id="l216.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l216.4"></a><span id="l216.4"> function run_test() {</span>
<a href="#l216.5"></a><span id="l216.5">   var file = do_get_file(&quot;resources/tab_comma_mixed.csv&quot;);</span>
<a href="#l216.6"></a><span id="l216.6">   var helper = new AbImportHelper(file, &quot;Text file&quot;);</span>
<a href="#l216.7"></a><span id="l216.7">   var genericInterface = helper.getInterface();</span>
<a href="#l216.8"></a><span id="l216.8" class="difflineminus">-  do_check_neq(genericInterface, null);</span>
<a href="#l216.9"></a><span id="l216.9" class="difflineplus">+  Assert.notEqual(genericInterface, null);</span>
<a href="#l216.10"></a><span id="l216.10">   let abInterface = genericInterface.GetData(&quot;addressInterface&quot;)</span>
<a href="#l216.11"></a><span id="l216.11">                      .QueryInterface(Ci.nsIImportAddressBooks);</span>
<a href="#l216.12"></a><span id="l216.12">   abInterface.SetSampleLocation(file);</span>
<a href="#l216.13"></a><span id="l216.13">   let recordExists = {};</span>
<a href="#l216.14"></a><span id="l216.14"> </span>
<a href="#l216.15"></a><span id="l216.15">   let sampleData = abInterface.GetSampleData(3, recordExists);</span>
<a href="#l216.16"></a><span id="l216.16" class="difflineminus">-  do_check_true(recordExists.value);</span>
<a href="#l216.17"></a><span id="l216.17" class="difflineminus">-  do_check_eq(sampleData, &quot;4\n4\n4\n4\n4@host.invalid&quot;);</span>
<a href="#l216.18"></a><span id="l216.18" class="difflineplus">+  Assert.ok(recordExists.value);</span>
<a href="#l216.19"></a><span id="l216.19" class="difflineplus">+  Assert.equal(sampleData, &quot;4\n4\n4\n4\n4@host.invalid&quot;);</span>
<a href="#l216.20"></a><span id="l216.20"> }</span>
<a href="#l216.21"></a><span id="l216.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l217.1"></a><span id="l217.1" class="difflineminus">--- a/mailnews/intl/test/unit/CharsetConversionTests.js</span>
<a href="#l217.2"></a><span id="l217.2" class="difflineplus">+++ b/mailnews/intl/test/unit/CharsetConversionTests.js</span>
<a href="#l217.3"></a><span id="l217.3" class="difflineat">@@ -23,33 +23,33 @@ function checkDecode(converter, charset,</span>
<a href="#l217.4"></a><span id="l217.4">   }</span>
<a href="#l217.5"></a><span id="l217.5"> </span>
<a href="#l217.6"></a><span id="l217.6">   dump(&quot;testing decoding from &quot; + charset + &quot; to Unicode.\n&quot;);</span>
<a href="#l217.7"></a><span id="l217.7">   try {</span>
<a href="#l217.8"></a><span id="l217.8">     var outText = converter.ConvertToUnicode(inText) + converter.Finish();</span>
<a href="#l217.9"></a><span id="l217.9">   } catch(e) {</span>
<a href="#l217.10"></a><span id="l217.10">     outText = &quot;\ufffd&quot;;</span>
<a href="#l217.11"></a><span id="l217.11">   }</span>
<a href="#l217.12"></a><span id="l217.12" class="difflineminus">-  do_check_eq(outText, expectedText);</span>
<a href="#l217.13"></a><span id="l217.13" class="difflineplus">+  Assert.equal(outText, expectedText);</span>
<a href="#l217.14"></a><span id="l217.14"> }</span>
<a href="#l217.15"></a><span id="l217.15"> </span>
<a href="#l217.16"></a><span id="l217.16"> function checkEncode(converter, charset, inText, expectedText)</span>
<a href="#l217.17"></a><span id="l217.17"> {</span>
<a href="#l217.18"></a><span id="l217.18">   let manager = Cc['@mozilla.org/charset-converter-manager;1']</span>
<a href="#l217.19"></a><span id="l217.19">                   .getService(Ci.nsICharsetConverterManager);</span>
<a href="#l217.20"></a><span id="l217.20"> </span>
<a href="#l217.21"></a><span id="l217.21">   try {</span>
<a href="#l217.22"></a><span id="l217.22">     converter.charset = manager.getCharsetAlias(charset);</span>
<a href="#l217.23"></a><span id="l217.23">   } catch(e) {</span>
<a href="#l217.24"></a><span id="l217.24">     converter.charset = &quot;iso-8859-1&quot;;</span>
<a href="#l217.25"></a><span id="l217.25">   }</span>
<a href="#l217.26"></a><span id="l217.26"> </span>
<a href="#l217.27"></a><span id="l217.27">   dump(&quot;testing encoding from Unicode to &quot; + charset + &quot;\n&quot;);</span>
<a href="#l217.28"></a><span id="l217.28">   var outText = converter.ConvertFromUnicode(inText) + converter.Finish();</span>
<a href="#l217.29"></a><span id="l217.29" class="difflineminus">-  do_check_eq(outText, expectedText);</span>
<a href="#l217.30"></a><span id="l217.30" class="difflineplus">+  Assert.equal(outText, expectedText);</span>
<a href="#l217.31"></a><span id="l217.31"> }</span>
<a href="#l217.32"></a><span id="l217.32"> </span>
<a href="#l217.33"></a><span id="l217.33"> function testDecodeAliases()</span>
<a href="#l217.34"></a><span id="l217.34"> {</span>
<a href="#l217.35"></a><span id="l217.35">   var converter = CreateScriptableConverter();</span>
<a href="#l217.36"></a><span id="l217.36">   for (var i = 0; i &lt; aliases.length; ++i) {</span>
<a href="#l217.37"></a><span id="l217.37">     checkDecode(converter, aliases[i], inString, expectedString);</span>
<a href="#l217.38"></a><span id="l217.38">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l218.1"></a><span id="l218.1" class="difflineminus">--- a/mailnews/local/test/unit/head_maillocal.js</span>
<a href="#l218.2"></a><span id="l218.2" class="difflineplus">+++ b/mailnews/local/test/unit/head_maillocal.js</span>
<a href="#l218.3"></a><span id="l218.3" class="difflineat">@@ -113,17 +113,17 @@ function do_check_transaction(real, expe</span>
<a href="#l218.4"></a><span id="l218.4">     real = real[real.length - 1];</span>
<a href="#l218.5"></a><span id="l218.5"> </span>
<a href="#l218.6"></a><span id="l218.6">   // real.them may have an extra QUIT on the end, where the stream is only</span>
<a href="#l218.7"></a><span id="l218.7">   // closed after we have a chance to process it and not them. We therefore</span>
<a href="#l218.8"></a><span id="l218.8">   // excise this from the list</span>
<a href="#l218.9"></a><span id="l218.9">   if (real.them[real.them.length-1] == &quot;QUIT&quot;)</span>
<a href="#l218.10"></a><span id="l218.10">     real.them.pop();</span>
<a href="#l218.11"></a><span id="l218.11"> </span>
<a href="#l218.12"></a><span id="l218.12" class="difflineminus">-  do_check_eq(real.them.join(&quot;,&quot;), expected.join(&quot;,&quot;));</span>
<a href="#l218.13"></a><span id="l218.13" class="difflineplus">+  Assert.equal(real.them.join(&quot;,&quot;), expected.join(&quot;,&quot;));</span>
<a href="#l218.14"></a><span id="l218.14">   dump(&quot;Passed test &quot; + test + &quot;\n&quot;);</span>
<a href="#l218.15"></a><span id="l218.15"> }</span>
<a href="#l218.16"></a><span id="l218.16"> </span>
<a href="#l218.17"></a><span id="l218.17"> function create_temporary_directory() {</span>
<a href="#l218.18"></a><span id="l218.18">   let directory = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l218.19"></a><span id="l218.19">   directory.append(&quot;mailFolder&quot;);</span>
<a href="#l218.20"></a><span id="l218.20">   directory.createUnique(Ci.nsIFile.DIRECTORY_TYPE, parseInt(&quot;0700&quot;, 8));</span>
<a href="#l218.21"></a><span id="l218.21">   return directory;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l219.1"></a><span id="l219.1" class="difflineminus">--- a/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l219.2"></a><span id="l219.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l219.3"></a><span id="l219.3" class="difflineat">@@ -23,20 +23,20 @@ var urlListener =</span>
<a href="#l219.4"></a><span id="l219.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l219.5"></a><span id="l219.5">   },</span>
<a href="#l219.6"></a><span id="l219.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l219.7"></a><span id="l219.7">     try {</span>
<a href="#l219.8"></a><span id="l219.8">       var transaction = server.playTransaction();</span>
<a href="#l219.9"></a><span id="l219.9"> </span>
<a href="#l219.10"></a><span id="l219.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l219.11"></a><span id="l219.11"> </span>
<a href="#l219.12"></a><span id="l219.12" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 2);</span>
<a href="#l219.13"></a><span id="l219.13" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getNumUnread(false), 1);</span>
<a href="#l219.14"></a><span id="l219.14" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 2);</span>
<a href="#l219.15"></a><span id="l219.15" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getNumUnread(false), 1);</span>
<a href="#l219.16"></a><span id="l219.16"> </span>
<a href="#l219.17"></a><span id="l219.17" class="difflineminus">-      do_check_eq(result, 0);</span>
<a href="#l219.18"></a><span id="l219.18" class="difflineplus">+      Assert.equal(result, 0);</span>
<a href="#l219.19"></a><span id="l219.19">     }</span>
<a href="#l219.20"></a><span id="l219.20">     catch (e) {</span>
<a href="#l219.21"></a><span id="l219.21">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l219.22"></a><span id="l219.22">       server.stop();</span>
<a href="#l219.23"></a><span id="l219.23"> </span>
<a href="#l219.24"></a><span id="l219.24">       var thread = gThreadManager.currentThread;</span>
<a href="#l219.25"></a><span id="l219.25">       while (thread.hasPendingEvents())</span>
<a href="#l219.26"></a><span id="l219.26">         thread.processNextEvent(true);</span>
<a href="#l219.27"></a><span id="l219.27" class="difflineat">@@ -141,14 +141,14 @@ function run_test() {</span>
<a href="#l219.28"></a><span id="l219.28">   filter.enabled = true;</span>
<a href="#l219.29"></a><span id="l219.29"> </span>
<a href="#l219.30"></a><span id="l219.30">   filters.insertFilterAt(0, filter);</span>
<a href="#l219.31"></a><span id="l219.31"> </span>
<a href="#l219.32"></a><span id="l219.32">   incomingServer.setFilterList(filters);</span>
<a href="#l219.33"></a><span id="l219.33"> </span>
<a href="#l219.34"></a><span id="l219.34">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l219.35"></a><span id="l219.35">   // setup issue.</span>
<a href="#l219.36"></a><span id="l219.36" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l219.37"></a><span id="l219.37" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l219.38"></a><span id="l219.38"> </span>
<a href="#l219.39"></a><span id="l219.39">   do_test_pending();</span>
<a href="#l219.40"></a><span id="l219.40"> </span>
<a href="#l219.41"></a><span id="l219.41">   testNext();</span>
<a href="#l219.42"></a><span id="l219.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l220.1"></a><span id="l220.1" class="difflineminus">--- a/mailnews/local/test/unit/test_fileName.js</span>
<a href="#l220.2"></a><span id="l220.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_fileName.js</span>
<a href="#l220.3"></a><span id="l220.3" class="difflineat">@@ -77,31 +77,31 @@ function run_test() {</span>
<a href="#l220.4"></a><span id="l220.4">   // Note: Inbox is not created automatically when there is no deferred server,</span>
<a href="#l220.5"></a><span id="l220.5">   // so we need to create it.</span>
<a href="#l220.6"></a><span id="l220.6">   localAccountUtils.inboxFolder = rootFolder.createLocalSubfolder(&quot;Inbox&quot;);</span>
<a href="#l220.7"></a><span id="l220.7">   // a local inbox should have a Mail flag!</span>
<a href="#l220.8"></a><span id="l220.8">   localAccountUtils.inboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l220.9"></a><span id="l220.9"> </span>
<a href="#l220.10"></a><span id="l220.10">   rootFolder = localAccountUtils.incomingServer.rootMsgFolder;</span>
<a href="#l220.11"></a><span id="l220.11">   bugmail = rootFolder.getChildNamed(testFolderName);</span>
<a href="#l220.12"></a><span id="l220.12" class="difflineminus">-  do_check_eq(bugmail.getTotalMessages(false), 1);</span>
<a href="#l220.13"></a><span id="l220.13" class="difflineplus">+  Assert.equal(bugmail.getTotalMessages(false), 1);</span>
<a href="#l220.14"></a><span id="l220.14">   bugmail = pop3Root.getChildNamed(testFolderName);</span>
<a href="#l220.15"></a><span id="l220.15" class="difflineminus">-  do_check_eq(bugmail.getTotalMessages(false), 1);</span>
<a href="#l220.16"></a><span id="l220.16" class="difflineplus">+  Assert.equal(bugmail.getTotalMessages(false), 1);</span>
<a href="#l220.17"></a><span id="l220.17"> </span>
<a href="#l220.18"></a><span id="l220.18">   // Check if creating an empty folder returns a proper error</span>
<a href="#l220.19"></a><span id="l220.19">   // instead of crash (bug 831190).</span>
<a href="#l220.20"></a><span id="l220.20">   try {</span>
<a href="#l220.21"></a><span id="l220.21">     rootFolder.createSubfolder(&quot;&quot;, null);</span>
<a href="#l220.22"></a><span id="l220.22">     do_throw(&quot;createSubfolder() should have failed on empty folder name.&quot;);</span>
<a href="#l220.23"></a><span id="l220.23">   } catch (e) {</span>
<a href="#l220.24"></a><span id="l220.24">     // NS_MSG_ERROR_INVALID_FOLDER_NAME</span>
<a href="#l220.25"></a><span id="l220.25" class="difflineminus">-    do_check_eq(e.result, 2153054242);</span>
<a href="#l220.26"></a><span id="l220.26" class="difflineplus">+    Assert.equal(e.result, 2153054242);</span>
<a href="#l220.27"></a><span id="l220.27">   }</span>
<a href="#l220.28"></a><span id="l220.28"> </span>
<a href="#l220.29"></a><span id="l220.29">   // And try to create an existing folder again.</span>
<a href="#l220.30"></a><span id="l220.30">   try {</span>
<a href="#l220.31"></a><span id="l220.31">     rootFolder.createSubfolder(testFolderName, null);</span>
<a href="#l220.32"></a><span id="l220.32">     do_throw(&quot;createSubfolder() should have failed on existing folder.&quot;);</span>
<a href="#l220.33"></a><span id="l220.33">   } catch (e) {</span>
<a href="#l220.34"></a><span id="l220.34">     // NS_MSG_FOLDER_EXISTS</span>
<a href="#l220.35"></a><span id="l220.35" class="difflineminus">-    do_check_eq(e.result, 2153054227);</span>
<a href="#l220.36"></a><span id="l220.36" class="difflineplus">+    Assert.equal(e.result, 2153054227);</span>
<a href="#l220.37"></a><span id="l220.37">   }</span>
<a href="#l220.38"></a><span id="l220.38"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l221.1"></a><span id="l221.1" class="difflineminus">--- a/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l221.2"></a><span id="l221.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l221.3"></a><span id="l221.3" class="difflineat">@@ -21,17 +21,17 @@ var gMsgFile2 = do_get_file(&quot;../../../da</span>
<a href="#l221.4"></a><span id="l221.4"> </span>
<a href="#l221.5"></a><span id="l221.5"> var gTargetFolder = null;</span>
<a href="#l221.6"></a><span id="l221.6"> </span>
<a href="#l221.7"></a><span id="l221.7"> var tests = [</span>
<a href="#l221.8"></a><span id="l221.8">   function* setup()</span>
<a href="#l221.9"></a><span id="l221.9">   {</span>
<a href="#l221.10"></a><span id="l221.10">     do_timeout(5000, function() {</span>
<a href="#l221.11"></a><span id="l221.11">       // should be done by now</span>
<a href="#l221.12"></a><span id="l221.12" class="difflineminus">-      do_check_true(false);</span>
<a href="#l221.13"></a><span id="l221.13" class="difflineplus">+      Assert.ok(false);</span>
<a href="#l221.14"></a><span id="l221.14">     });</span>
<a href="#l221.15"></a><span id="l221.15">  </span>
<a href="#l221.16"></a><span id="l221.16">     if (typeof localAccountUtils.inboxFolder == 'undefined')</span>
<a href="#l221.17"></a><span id="l221.17">       localAccountUtils.loadLocalMailAccount();</span>
<a href="#l221.18"></a><span id="l221.18">     localAccountUtils.rootFolder.createSubfolder(&quot;target&quot;, null);</span>
<a href="#l221.19"></a><span id="l221.19">     gTargetFolder = localAccountUtils.rootFolder.getChildNamed(&quot;target&quot;);</span>
<a href="#l221.20"></a><span id="l221.20"> </span>
<a href="#l221.21"></a><span id="l221.21">     MailServices.copy.CopyFileMessage(gMsgFile1, gTargetFolder, null, false, 0,</span>
<a href="#l221.22"></a><span id="l221.22" class="difflineat">@@ -48,19 +48,19 @@ var tests = [</span>
<a href="#l221.23"></a><span id="l221.23">   {</span>
<a href="#l221.24"></a><span id="l221.24">     // get message headers for the target folder</span>
<a href="#l221.25"></a><span id="l221.25">     let enumerator = gTargetFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l221.26"></a><span id="l221.26">     var msgCount = 0;</span>
<a href="#l221.27"></a><span id="l221.27">     while(enumerator.hasMoreElements())</span>
<a href="#l221.28"></a><span id="l221.28">     {</span>
<a href="#l221.29"></a><span id="l221.29">       msgCount++;</span>
<a href="#l221.30"></a><span id="l221.30">       let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l221.31"></a><span id="l221.31" class="difflineminus">-      do_check_eq(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l221.32"></a><span id="l221.32" class="difflineplus">+      Assert.equal(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l221.33"></a><span id="l221.33">     }</span>
<a href="#l221.34"></a><span id="l221.34" class="difflineminus">-    do_check_eq(msgCount, 2);</span>
<a href="#l221.35"></a><span id="l221.35" class="difflineplus">+    Assert.equal(msgCount, 2);</span>
<a href="#l221.36"></a><span id="l221.36"> </span>
<a href="#l221.37"></a><span id="l221.37">     // try an update</span>
<a href="#l221.38"></a><span id="l221.38">     mailTestUtils.updateFolderAndNotify(gTargetFolder, function () {</span>
<a href="#l221.39"></a><span id="l221.39">       dump(&quot;after FolderLoaded1\n&quot;);</span>
<a href="#l221.40"></a><span id="l221.40">       async_driver();</span>
<a href="#l221.41"></a><span id="l221.41">     });</span>
<a href="#l221.42"></a><span id="l221.42">     yield false;</span>
<a href="#l221.43"></a><span id="l221.43">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l222.1"></a><span id="l222.1" class="difflineminus">--- a/mailnews/local/test/unit/test_localFolder.js</span>
<a href="#l222.2"></a><span id="l222.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_localFolder.js</span>
<a href="#l222.3"></a><span id="l222.3" class="difflineat">@@ -27,23 +27,23 @@ function check_sub_folders(expected, act</span>
<a href="#l222.4"></a><span id="l222.4">     let actualFolder = actual.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l222.5"></a><span id="l222.5">     let index;</span>
<a href="#l222.6"></a><span id="l222.6">     for (index = 0; index &lt; expected.length; index++) {</span>
<a href="#l222.7"></a><span id="l222.7">       if (expected[index].name == actualFolder.name) {</span>
<a href="#l222.8"></a><span id="l222.8">         break;</span>
<a href="#l222.9"></a><span id="l222.9">       }</span>
<a href="#l222.10"></a><span id="l222.10">     }</span>
<a href="#l222.11"></a><span id="l222.11">     // If index goes out of bounds, probably we didn't find the name.</span>
<a href="#l222.12"></a><span id="l222.12" class="difflineminus">-    do_check_true(index &lt; expected.length);</span>
<a href="#l222.13"></a><span id="l222.13" class="difflineplus">+    Assert.ok(index &lt; expected.length);</span>
<a href="#l222.14"></a><span id="l222.14"> </span>
<a href="#l222.15"></a><span id="l222.15">     let pluggableStore = actualFolder.msgStore;</span>
<a href="#l222.16"></a><span id="l222.16">     pluggableStore.discoverSubFolders(actualFolder, true);</span>
<a href="#l222.17"></a><span id="l222.17" class="difflineminus">-    do_check_eq(!!expected[index].subFolders, actualFolder.hasSubFolders);</span>
<a href="#l222.18"></a><span id="l222.18" class="difflineplus">+    Assert.equal(!!expected[index].subFolders, actualFolder.hasSubFolders);</span>
<a href="#l222.19"></a><span id="l222.19">     if (actualFolder.hasSubFolders) {</span>
<a href="#l222.20"></a><span id="l222.20" class="difflineminus">-      do_check_eq(expected[index].subFolders.length, actualFolder.numSubFolders);</span>
<a href="#l222.21"></a><span id="l222.21" class="difflineplus">+      Assert.equal(expected[index].subFolders.length, actualFolder.numSubFolders);</span>
<a href="#l222.22"></a><span id="l222.22">       check_sub_folders(expected[index].subFolders, actualFolder.subFolders);</span>
<a href="#l222.23"></a><span id="l222.23">     }</span>
<a href="#l222.24"></a><span id="l222.24">   }</span>
<a href="#l222.25"></a><span id="l222.25"> }</span>
<a href="#l222.26"></a><span id="l222.26"> </span>
<a href="#l222.27"></a><span id="l222.27"> /**</span>
<a href="#l222.28"></a><span id="l222.28">  * Test default mailbox without creating any subfolders.</span>
<a href="#l222.29"></a><span id="l222.29">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l223.1"></a><span id="l223.1" class="difflineminus">--- a/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l223.2"></a><span id="l223.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l223.3"></a><span id="l223.3" class="difflineat">@@ -17,17 +17,17 @@ var gFile = do_get_file(&quot;../../../data/m</span>
<a href="#l223.4"></a><span id="l223.4"> function run_test()</span>
<a href="#l223.5"></a><span id="l223.5"> {</span>
<a href="#l223.6"></a><span id="l223.6">   do_test_pending();</span>
<a href="#l223.7"></a><span id="l223.7">   copyFileMessageInLocalFolder(gFile, 0, &quot;&quot;, null, verifyContentLength);</span>
<a href="#l223.8"></a><span id="l223.8"> }</span>
<a href="#l223.9"></a><span id="l223.9"> </span>
<a href="#l223.10"></a><span id="l223.10"> function verifyContentLength(aMessageHeaderKeys, aStatus)</span>
<a href="#l223.11"></a><span id="l223.11"> {</span>
<a href="#l223.12"></a><span id="l223.12" class="difflineminus">-  do_check_neq(aMessageHeaderKeys, null);</span>
<a href="#l223.13"></a><span id="l223.13" class="difflineplus">+  Assert.notEqual(aMessageHeaderKeys, null);</span>
<a href="#l223.14"></a><span id="l223.14">   // First get the message URI</span>
<a href="#l223.15"></a><span id="l223.15">   let msgHdr = localAccountUtils.inboxFolder.GetMessageHeader(aMessageHeaderKeys[0]);</span>
<a href="#l223.16"></a><span id="l223.16">   let messageUri = localAccountUtils.inboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l223.17"></a><span id="l223.17">   // Convert this to a URI that necko can run</span>
<a href="#l223.18"></a><span id="l223.18">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l223.19"></a><span id="l223.19">   let neckoURL = {};</span>
<a href="#l223.20"></a><span id="l223.20">   let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l223.21"></a><span id="l223.21">   messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l223.22"></a><span id="l223.22" class="difflineat">@@ -37,24 +37,24 @@ function verifyContentLength(aMessageHea</span>
<a href="#l223.23"></a><span id="l223.23"> </span>
<a href="#l223.24"></a><span id="l223.24">   // Get a channel from this URI, and check its content length</span>
<a href="#l223.25"></a><span id="l223.25">   let channel = Services.io.newChannelFromURI2(urlToRun,</span>
<a href="#l223.26"></a><span id="l223.26">                                                null,</span>
<a href="#l223.27"></a><span id="l223.27">                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l223.28"></a><span id="l223.28">                                                null,</span>
<a href="#l223.29"></a><span id="l223.29">                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l223.30"></a><span id="l223.30">                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l223.31"></a><span id="l223.31" class="difflineminus">-  do_check_eq(channel.contentLength, gFile.fileSize);</span>
<a href="#l223.32"></a><span id="l223.32" class="difflineplus">+  Assert.equal(channel.contentLength, gFile.fileSize);</span>
<a href="#l223.33"></a><span id="l223.33"> </span>
<a href="#l223.34"></a><span id="l223.34">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l223.35"></a><span id="l223.35">   let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;);</span>
<a href="#l223.36"></a><span id="l223.36">   let attachmentChannel = Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l223.37"></a><span id="l223.37">                                                          null,</span>
<a href="#l223.38"></a><span id="l223.38">                                                          Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l223.39"></a><span id="l223.39">                                                          null,</span>
<a href="#l223.40"></a><span id="l223.40">                                                          Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l223.41"></a><span id="l223.41">                                                          Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l223.42"></a><span id="l223.42">   // Currently attachments have their content length set to the length of the</span>
<a href="#l223.43"></a><span id="l223.43">   // entire message</span>
<a href="#l223.44"></a><span id="l223.44" class="difflineminus">-  do_check_eq(channel.contentLength, gFile.fileSize);</span>
<a href="#l223.45"></a><span id="l223.45" class="difflineplus">+  Assert.equal(channel.contentLength, gFile.fileSize);</span>
<a href="#l223.46"></a><span id="l223.46"> </span>
<a href="#l223.47"></a><span id="l223.47">   do_test_finished();</span>
<a href="#l223.48"></a><span id="l223.48"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l224.1"></a><span id="l224.1" class="difflineminus">--- a/mailnews/local/test/unit/test_mailboxProtocol.js</span>
<a href="#l224.2"></a><span id="l224.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_mailboxProtocol.js</span>
<a href="#l224.3"></a><span id="l224.3" class="difflineat">@@ -22,27 +22,27 @@ function run_test()</span>
<a href="#l224.4"></a><span id="l224.4"> {</span>
<a href="#l224.5"></a><span id="l224.5">   for (var part = 0; part &lt; protocols.length; ++part) {</span>
<a href="#l224.6"></a><span id="l224.6">     print(&quot;protocol: &quot; + protocols[part].protocol);</span>
<a href="#l224.7"></a><span id="l224.7"> </span>
<a href="#l224.8"></a><span id="l224.8">     var pH = Cc[&quot;@mozilla.org/network/protocol;1?name=&quot; +</span>
<a href="#l224.9"></a><span id="l224.9">                 protocols[part].protocol]</span>
<a href="#l224.10"></a><span id="l224.10">                .createInstance(Ci.nsIProtocolHandler);</span>
<a href="#l224.11"></a><span id="l224.11"> </span>
<a href="#l224.12"></a><span id="l224.12" class="difflineminus">-    do_check_eq(pH.scheme, protocols[part].protocol);</span>
<a href="#l224.13"></a><span id="l224.13" class="difflineminus">-    do_check_eq(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l224.14"></a><span id="l224.14" class="difflineminus">-    do_check_eq(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l224.15"></a><span id="l224.15" class="difflineplus">+    Assert.equal(pH.scheme, protocols[part].protocol);</span>
<a href="#l224.16"></a><span id="l224.16" class="difflineplus">+    Assert.equal(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l224.17"></a><span id="l224.17" class="difflineplus">+    Assert.equal(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l224.18"></a><span id="l224.18"> </span>
<a href="#l224.19"></a><span id="l224.19">     // Whip through some of the ports to check we get the right results.</span>
<a href="#l224.20"></a><span id="l224.20">     for (let i = 0; i &lt; 1024; ++i)</span>
<a href="#l224.21"></a><span id="l224.21" class="difflineminus">-      do_check_eq(pH.allowPort(i, &quot;&quot;), false);</span>
<a href="#l224.22"></a><span id="l224.22" class="difflineplus">+      Assert.equal(pH.allowPort(i, &quot;&quot;), false);</span>
<a href="#l224.23"></a><span id="l224.23"> </span>
<a href="#l224.24"></a><span id="l224.24">     // Check we get a URI when we ask for one</span>
<a href="#l224.25"></a><span id="l224.25">     var uri = pH.newURI(protocols[part].urlSpec);</span>
<a href="#l224.26"></a><span id="l224.26"> </span>
<a href="#l224.27"></a><span id="l224.27">     uri.QueryInterface(Ci.nsIMailboxUrl);</span>
<a href="#l224.28"></a><span id="l224.28"> </span>
<a href="#l224.29"></a><span id="l224.29" class="difflineminus">-    do_check_eq(uri.spec, protocols[part].urlSpec);</span>
<a href="#l224.30"></a><span id="l224.30" class="difflineplus">+    Assert.equal(uri.spec, protocols[part].urlSpec);</span>
<a href="#l224.31"></a><span id="l224.31"> </span>
<a href="#l224.32"></a><span id="l224.32">     // XXX This fails on Windows</span>
<a href="#l224.33"></a><span id="l224.33">     // do_check_neq(pH.newChannel(uri), null);</span>
<a href="#l224.34"></a><span id="l224.34">   }</span>
<a href="#l224.35"></a><span id="l224.35"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l225.1"></a><span id="l225.1" class="difflineminus">--- a/mailnews/local/test/unit/test_movemailDownload.js</span>
<a href="#l225.2"></a><span id="l225.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_movemailDownload.js</span>
<a href="#l225.3"></a><span id="l225.3" class="difflineat">@@ -54,19 +54,19 @@ var gTestArray = [</span>
<a href="#l225.4"></a><span id="l225.4">     gMsgHdrs = [];</span>
<a href="#l225.5"></a><span id="l225.5">     // get message headers for the inbox folder</span>
<a href="#l225.6"></a><span id="l225.6">     let enumerator = gMoveMailInbox.msgDatabase.EnumerateMessages();</span>
<a href="#l225.7"></a><span id="l225.7">     var msgCount = 0;</span>
<a href="#l225.8"></a><span id="l225.8">     let hdr;</span>
<a href="#l225.9"></a><span id="l225.9">     while (enumerator.hasMoreElements()) {</span>
<a href="#l225.10"></a><span id="l225.10">       let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l225.11"></a><span id="l225.11">       gMsgHdrs.push(hdr);</span>
<a href="#l225.12"></a><span id="l225.12" class="difflineminus">-      do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l225.13"></a><span id="l225.13" class="difflineplus">+      Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l225.14"></a><span id="l225.14">     }</span>
<a href="#l225.15"></a><span id="l225.15" class="difflineminus">-    do_check_eq(msgCount, 3);</span>
<a href="#l225.16"></a><span id="l225.16" class="difflineplus">+    Assert.equal(msgCount, 3);</span>
<a href="#l225.17"></a><span id="l225.17">   },</span>
<a href="#l225.18"></a><span id="l225.18">   function *streamMessages() {</span>
<a href="#l225.19"></a><span id="l225.19">     for (let msgHdr of gMsgHdrs)</span>
<a href="#l225.20"></a><span id="l225.20">       yield streamNextMessage(msgHdr);</span>
<a href="#l225.21"></a><span id="l225.21">   }</span>
<a href="#l225.22"></a><span id="l225.22"> ];</span>
<a href="#l225.23"></a><span id="l225.23"> </span>
<a href="#l225.24"></a><span id="l225.24"> function run_test()</span>
<a href="#l225.25"></a><span id="l225.25" class="difflineat">@@ -85,10 +85,10 @@ var streamNextMessage = Task.async(funct</span>
<a href="#l225.26"></a><span id="l225.26">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l225.27"></a><span id="l225.27">   let msgURI = aMsgHdr.folder.getUriForMsg(aMsgHdr);</span>
<a href="#l225.28"></a><span id="l225.28">   dump(&quot;streaming msg &quot; + msgURI + &quot; store token = &quot; +</span>
<a href="#l225.29"></a><span id="l225.29">        aMsgHdr.getStringProperty(&quot;storeToken&quot;));</span>
<a href="#l225.30"></a><span id="l225.30">   let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l225.31"></a><span id="l225.31">   let streamListener = new PromiseTestUtils.PromiseStreamListener();</span>
<a href="#l225.32"></a><span id="l225.32">   msgServ.streamMessage(msgURI, streamListener, null, null, false, &quot;&quot;, true);</span>
<a href="#l225.33"></a><span id="l225.33">   let data = yield streamListener.promise;</span>
<a href="#l225.34"></a><span id="l225.34" class="difflineminus">-  do_check_true(data.startsWith(&quot;From &quot;));</span>
<a href="#l225.35"></a><span id="l225.35" class="difflineplus">+  Assert.ok(data.startsWith(&quot;From &quot;));</span>
<a href="#l225.36"></a><span id="l225.36"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l226.1"></a><span id="l226.1" class="difflineminus">--- a/mailnews/local/test/unit/test_msgCopy.js</span>
<a href="#l226.2"></a><span id="l226.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_msgCopy.js</span>
<a href="#l226.3"></a><span id="l226.3" class="difflineat">@@ -14,13 +14,13 @@ var tag1 = &quot;istag&quot;;</span>
<a href="#l226.4"></a><span id="l226.4"> function run_test()</span>
<a href="#l226.5"></a><span id="l226.5"> {</span>
<a href="#l226.6"></a><span id="l226.6">   do_test_pending();</span>
<a href="#l226.7"></a><span id="l226.7">   copyFileMessageInLocalFolder(bugmail11, 0, tag1, null, test_keywords);</span>
<a href="#l226.8"></a><span id="l226.8"> }</span>
<a href="#l226.9"></a><span id="l226.9"> </span>
<a href="#l226.10"></a><span id="l226.10"> function test_keywords(aMessageHeaderKeys, aStatus) {</span>
<a href="#l226.11"></a><span id="l226.11">   let headerKeys = aMessageHeaderKeys;</span>
<a href="#l226.12"></a><span id="l226.12" class="difflineminus">-  do_check_neq(headerKeys, null);</span>
<a href="#l226.13"></a><span id="l226.13" class="difflineplus">+  Assert.notEqual(headerKeys, null);</span>
<a href="#l226.14"></a><span id="l226.14">   let copiedMessage = localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]);</span>
<a href="#l226.15"></a><span id="l226.15" class="difflineminus">-  do_check_eq(copiedMessage.getStringProperty(&quot;keywords&quot;), tag1);</span>
<a href="#l226.16"></a><span id="l226.16" class="difflineplus">+  Assert.equal(copiedMessage.getStringProperty(&quot;keywords&quot;), tag1);</span>
<a href="#l226.17"></a><span id="l226.17">   do_test_finished();</span>
<a href="#l226.18"></a><span id="l226.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l227.1"></a><span id="l227.1" class="difflineminus">--- a/mailnews/local/test/unit/test_msgIDParsing.js</span>
<a href="#l227.2"></a><span id="l227.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_msgIDParsing.js</span>
<a href="#l227.3"></a><span id="l227.3" class="difflineat">@@ -14,17 +14,17 @@ var headers =</span>
<a href="#l227.4"></a><span id="l227.4">   &quot;to: bob@t2.example.net\r\n&quot; +</span>
<a href="#l227.5"></a><span id="l227.5">   &quot;message-id:   \r\n   &lt;abcmessageid&gt;\r\n&quot;;</span>
<a href="#l227.6"></a><span id="l227.6"> </span>
<a href="#l227.7"></a><span id="l227.7"> function testMsgID()</span>
<a href="#l227.8"></a><span id="l227.8"> {</span>
<a href="#l227.9"></a><span id="l227.9">   let localFolder = localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l227.10"></a><span id="l227.10">   localAccountUtils.inboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l227.11"></a><span id="l227.11">   let msgHdr = localAccountUtils.inboxFolder.firstNewMessage;</span>
<a href="#l227.12"></a><span id="l227.12" class="difflineminus">-  do_check_eq(msgHdr.messageId, &quot;abcmessageid&quot;);</span>
<a href="#l227.13"></a><span id="l227.13" class="difflineplus">+  Assert.equal(msgHdr.messageId, &quot;abcmessageid&quot;);</span>
<a href="#l227.14"></a><span id="l227.14"> }</span>
<a href="#l227.15"></a><span id="l227.15"> </span>
<a href="#l227.16"></a><span id="l227.16"> function run_test()</span>
<a href="#l227.17"></a><span id="l227.17"> {</span>
<a href="#l227.18"></a><span id="l227.18">   for (let storeID of localAccountUtils.pluggableStores) {</span>
<a href="#l227.19"></a><span id="l227.19">     localAccountUtils.loadLocalMailAccount(storeID);</span>
<a href="#l227.20"></a><span id="l227.20">     testMsgID();</span>
<a href="#l227.21"></a><span id="l227.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l228.1"></a><span id="l228.1" class="difflineminus">--- a/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js</span>
<a href="#l228.2"></a><span id="l228.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_nsIMsgLocalMailFolder.js</span>
<a href="#l228.3"></a><span id="l228.3" class="difflineat">@@ -9,66 +9,66 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l228.4"></a><span id="l228.4"> Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l228.5"></a><span id="l228.5"> /**</span>
<a href="#l228.6"></a><span id="l228.6">  * Bug 66763</span>
<a href="#l228.7"></a><span id="l228.7">  * Test deletion of a folder with a name already existing in Trash.</span>
<a href="#l228.8"></a><span id="l228.8">  */</span>
<a href="#l228.9"></a><span id="l228.9"> function subtest_folder_deletion(root) {</span>
<a href="#l228.10"></a><span id="l228.10">   // Now we only have &lt;root&gt; and some default subfolders, like Trash.</span>
<a href="#l228.11"></a><span id="l228.11">   let trash = root.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l228.12"></a><span id="l228.12" class="difflineminus">-  do_check_false(trash.hasSubFolders);</span>
<a href="#l228.13"></a><span id="l228.13" class="difflineplus">+  Assert.ok(!trash.hasSubFolders);</span>
<a href="#l228.14"></a><span id="l228.14"> </span>
<a href="#l228.15"></a><span id="l228.15">   // Create new &quot;folder&quot; in root.</span>
<a href="#l228.16"></a><span id="l228.16">   let folder = root.createLocalSubfolder(&quot;folder&quot;);</span>
<a href="#l228.17"></a><span id="l228.17">   let path = folder.filePath;</span>
<a href="#l228.18"></a><span id="l228.18" class="difflineminus">-  do_check_true(path.exists());</span>
<a href="#l228.19"></a><span id="l228.19" class="difflineplus">+  Assert.ok(path.exists());</span>
<a href="#l228.20"></a><span id="l228.20"> </span>
<a href="#l228.21"></a><span id="l228.21">   // Delete &quot;folder&quot; into Trash.</span>
<a href="#l228.22"></a><span id="l228.22">   let folderArray = toXPCOMArray([folder], Ci.nsIMutableArray);</span>
<a href="#l228.23"></a><span id="l228.23">   root.deleteSubFolders(folderArray, null);</span>
<a href="#l228.24"></a><span id="l228.24" class="difflineminus">-  do_check_false(path.exists());</span>
<a href="#l228.25"></a><span id="l228.25" class="difflineminus">-  do_check_eq(trash.numSubFolders, 1);</span>
<a href="#l228.26"></a><span id="l228.26" class="difflineplus">+  Assert.ok(!path.exists());</span>
<a href="#l228.27"></a><span id="l228.27" class="difflineplus">+  Assert.equal(trash.numSubFolders, 1);</span>
<a href="#l228.28"></a><span id="l228.28">   let folderDeleted = trash.getChildNamed(&quot;folder&quot;);</span>
<a href="#l228.29"></a><span id="l228.29"> </span>
<a href="#l228.30"></a><span id="l228.30">   // Create another &quot;folder&quot; in root.</span>
<a href="#l228.31"></a><span id="l228.31">   folder = root.createLocalSubfolder(&quot;folder&quot;);</span>
<a href="#l228.32"></a><span id="l228.32">   // Delete &quot;folder&quot; into Trash again.</span>
<a href="#l228.33"></a><span id="l228.33">   folderArray = toXPCOMArray([folder], Ci.nsIMutableArray);</span>
<a href="#l228.34"></a><span id="l228.34">   root.deleteSubFolders(folderArray, null);</span>
<a href="#l228.35"></a><span id="l228.35" class="difflineminus">-  do_check_eq(trash.numSubFolders, 2);</span>
<a href="#l228.36"></a><span id="l228.36" class="difflineplus">+  Assert.equal(trash.numSubFolders, 2);</span>
<a href="#l228.37"></a><span id="l228.37">   // The folder should be automatically renamed as the same name already is in Trash.</span>
<a href="#l228.38"></a><span id="l228.38">   let folderDeleted2 = trash.getChildNamed(&quot;folder(2)&quot;);</span>
<a href="#l228.39"></a><span id="l228.39"> </span>
<a href="#l228.40"></a><span id="l228.40">   // Create yet another &quot;folder&quot; in root.</span>
<a href="#l228.41"></a><span id="l228.41">   folder = root.createLocalSubfolder(&quot;folder&quot;);</span>
<a href="#l228.42"></a><span id="l228.42"> </span>
<a href="#l228.43"></a><span id="l228.43">   // But now with another subfolder</span>
<a href="#l228.44"></a><span id="l228.44">   let subfolder = folder.QueryInterface(Ci.nsIMsgLocalMailFolder)</span>
<a href="#l228.45"></a><span id="l228.45">                         .createLocalSubfolder(&quot;subfolder&quot;);</span>
<a href="#l228.46"></a><span id="l228.46"> </span>
<a href="#l228.47"></a><span id="l228.47">   // Delete folder into Trash again</span>
<a href="#l228.48"></a><span id="l228.48">   folderArray = toXPCOMArray([folder], Ci.nsIMutableArray);</span>
<a href="#l228.49"></a><span id="l228.49">   root.deleteSubFolders(folderArray, null);</span>
<a href="#l228.50"></a><span id="l228.50" class="difflineminus">-  do_check_eq(trash.numSubFolders, 3);</span>
<a href="#l228.51"></a><span id="l228.51" class="difflineplus">+  Assert.equal(trash.numSubFolders, 3);</span>
<a href="#l228.52"></a><span id="l228.52">   // The folder should be automatically renamed as the same name already is in Trash</span>
<a href="#l228.53"></a><span id="l228.53">   // but the subfolder should be untouched.</span>
<a href="#l228.54"></a><span id="l228.54">   let folderDeleted3 = trash.getChildNamed(&quot;folder(3)&quot;);</span>
<a href="#l228.55"></a><span id="l228.55" class="difflineminus">-  do_check_neq(folderDeleted3, null);</span>
<a href="#l228.56"></a><span id="l228.56" class="difflineminus">-  do_check_true(folderDeleted3.containsChildNamed(&quot;subfolder&quot;));</span>
<a href="#l228.57"></a><span id="l228.57" class="difflineplus">+  Assert.notEqual(folderDeleted3, null);</span>
<a href="#l228.58"></a><span id="l228.58" class="difflineplus">+  Assert.ok(folderDeleted3.containsChildNamed(&quot;subfolder&quot;));</span>
<a href="#l228.59"></a><span id="l228.59">   // Now we have &lt;root&gt;</span>
<a href="#l228.60"></a><span id="l228.60">   //               +--Trash</span>
<a href="#l228.61"></a><span id="l228.61">   //                    +--folder</span>
<a href="#l228.62"></a><span id="l228.62">   //                    +--folder(2)</span>
<a href="#l228.63"></a><span id="l228.63">   //                    +--folder(3)</span>
<a href="#l228.64"></a><span id="l228.64">   //                         +--subfolder</span>
<a href="#l228.65"></a><span id="l228.65"> </span>
<a href="#l228.66"></a><span id="l228.66">   // Create another &quot;folder(3)&quot; in root.</span>
<a href="#l228.67"></a><span id="l228.67" class="difflineminus">-  do_check_false(root.containsChildNamed(&quot;folder(3)&quot;));</span>
<a href="#l228.68"></a><span id="l228.68" class="difflineplus">+  Assert.ok(!root.containsChildNamed(&quot;folder(3)&quot;));</span>
<a href="#l228.69"></a><span id="l228.69">   folder = root.createLocalSubfolder(&quot;folder(3)&quot;);</span>
<a href="#l228.70"></a><span id="l228.70" class="difflineminus">-  do_check_true(root.containsChildNamed(&quot;folder(3)&quot;));</span>
<a href="#l228.71"></a><span id="l228.71" class="difflineplus">+  Assert.ok(root.containsChildNamed(&quot;folder(3)&quot;));</span>
<a href="#l228.72"></a><span id="l228.72">   // Now try to move &quot;folder(3)&quot; from Trash back to root.</span>
<a href="#l228.73"></a><span id="l228.73">   // That should fail, because the user gets a prompt about it and that does</span>
<a href="#l228.74"></a><span id="l228.74">   // not work in xpcshell.</span>
<a href="#l228.75"></a><span id="l228.75">   try {</span>
<a href="#l228.76"></a><span id="l228.76">     root.copyFolderLocal(folderDeleted3, true, null, null);</span>
<a href="#l228.77"></a><span id="l228.77">     do_throw(&quot;copyFolderLocal() should have failed here due to user prompt!&quot;);</span>
<a href="#l228.78"></a><span id="l228.78">   } catch (e) {</span>
<a href="#l228.79"></a><span id="l228.79">     // Catch only the expected error NS_MSG_ERROR_COPY_FOLDER_ABORTED,</span>
<a href="#l228.80"></a><span id="l228.80" class="difflineat">@@ -85,198 +85,198 @@ function subtest_folder_deletion(root) {</span>
<a href="#l228.81"></a><span id="l228.81"> function subtest_folder_operations(root) {</span>
<a href="#l228.82"></a><span id="l228.82">   // Test - num/hasSubFolders</span>
<a href="#l228.83"></a><span id="l228.83"> </span>
<a href="#l228.84"></a><span id="l228.84">   // Get the current number of folders</span>
<a href="#l228.85"></a><span id="l228.85">   var numSubFolders = root.numSubFolders;</span>
<a href="#l228.86"></a><span id="l228.86"> </span>
<a href="#l228.87"></a><span id="l228.87">   var folder = root.createLocalSubfolder(&quot;folder1&quot;).QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l228.88"></a><span id="l228.88"> </span>
<a href="#l228.89"></a><span id="l228.89" class="difflineminus">-  do_check_true(root.hasSubFolders);</span>
<a href="#l228.90"></a><span id="l228.90" class="difflineminus">-  do_check_eq(root.numSubFolders, numSubFolders + 1);</span>
<a href="#l228.91"></a><span id="l228.91" class="difflineplus">+  Assert.ok(root.hasSubFolders);</span>
<a href="#l228.92"></a><span id="l228.92" class="difflineplus">+  Assert.equal(root.numSubFolders, numSubFolders + 1);</span>
<a href="#l228.93"></a><span id="l228.93"> </span>
<a href="#l228.94"></a><span id="l228.94" class="difflineminus">-  do_check_false(folder.hasSubFolders);</span>
<a href="#l228.95"></a><span id="l228.95" class="difflineminus">-  do_check_eq(folder.numSubFolders, 0);</span>
<a href="#l228.96"></a><span id="l228.96" class="difflineplus">+  Assert.ok(!folder.hasSubFolders);</span>
<a href="#l228.97"></a><span id="l228.97" class="difflineplus">+  Assert.equal(folder.numSubFolders, 0);</span>
<a href="#l228.98"></a><span id="l228.98"> </span>
<a href="#l228.99"></a><span id="l228.99">   var folder2 = folder.createLocalSubfolder(&quot;folder2&quot;);</span>
<a href="#l228.100"></a><span id="l228.100"> </span>
<a href="#l228.101"></a><span id="l228.101" class="difflineminus">-  do_check_true(folder.hasSubFolders);</span>
<a href="#l228.102"></a><span id="l228.102" class="difflineminus">-  do_check_eq(folder.numSubFolders, 1);</span>
<a href="#l228.103"></a><span id="l228.103" class="difflineplus">+  Assert.ok(folder.hasSubFolders);</span>
<a href="#l228.104"></a><span id="l228.104" class="difflineplus">+  Assert.equal(folder.numSubFolders, 1);</span>
<a href="#l228.105"></a><span id="l228.105"> </span>
<a href="#l228.106"></a><span id="l228.106">   // Now we have &lt;root&gt;</span>
<a href="#l228.107"></a><span id="l228.107">   //               +--folder1</span>
<a href="#l228.108"></a><span id="l228.108">   //                    +--folder2</span>
<a href="#l228.109"></a><span id="l228.109"> </span>
<a href="#l228.110"></a><span id="l228.110">   // Test - getChildNamed</span>
<a href="#l228.111"></a><span id="l228.111"> </span>
<a href="#l228.112"></a><span id="l228.112" class="difflineminus">-  do_check_eq(root.getChildNamed(&quot;folder1&quot;), folder);</span>
<a href="#l228.113"></a><span id="l228.113" class="difflineplus">+  Assert.equal(root.getChildNamed(&quot;folder1&quot;), folder);</span>
<a href="#l228.114"></a><span id="l228.114"> </span>
<a href="#l228.115"></a><span id="l228.115">   // Check for non match, this should throw</span>
<a href="#l228.116"></a><span id="l228.116">   var thrown = false;</span>
<a href="#l228.117"></a><span id="l228.117">   try {</span>
<a href="#l228.118"></a><span id="l228.118">     root.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l228.119"></a><span id="l228.119">   }</span>
<a href="#l228.120"></a><span id="l228.120">   catch (e) {</span>
<a href="#l228.121"></a><span id="l228.121">     thrown = true;</span>
<a href="#l228.122"></a><span id="l228.122">   }</span>
<a href="#l228.123"></a><span id="l228.123"> </span>
<a href="#l228.124"></a><span id="l228.124" class="difflineminus">-  do_check_true(thrown);</span>
<a href="#l228.125"></a><span id="l228.125" class="difflineplus">+  Assert.ok(thrown);</span>
<a href="#l228.126"></a><span id="l228.126"> </span>
<a href="#l228.127"></a><span id="l228.127">   // folder2 is a child of folder however.</span>
<a href="#l228.128"></a><span id="l228.128">   var folder2 = folder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l228.129"></a><span id="l228.129"> </span>
<a href="#l228.130"></a><span id="l228.130">   // Test - isAncestorOf</span>
<a href="#l228.131"></a><span id="l228.131"> </span>
<a href="#l228.132"></a><span id="l228.132" class="difflineminus">-  do_check_true(folder.isAncestorOf(folder2));</span>
<a href="#l228.133"></a><span id="l228.133" class="difflineminus">-  do_check_true(root.isAncestorOf(folder2));</span>
<a href="#l228.134"></a><span id="l228.134" class="difflineminus">-  do_check_false(folder.isAncestorOf(root));</span>
<a href="#l228.135"></a><span id="l228.135" class="difflineplus">+  Assert.ok(folder.isAncestorOf(folder2));</span>
<a href="#l228.136"></a><span id="l228.136" class="difflineplus">+  Assert.ok(root.isAncestorOf(folder2));</span>
<a href="#l228.137"></a><span id="l228.137" class="difflineplus">+  Assert.ok(!folder.isAncestorOf(root));</span>
<a href="#l228.138"></a><span id="l228.138"> </span>
<a href="#l228.139"></a><span id="l228.139">   // Test - FoldersWithFlag</span>
<a href="#l228.140"></a><span id="l228.140"> </span>
<a href="#l228.141"></a><span id="l228.141">   const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l228.142"></a><span id="l228.142"> </span>
<a href="#l228.143"></a><span id="l228.143">   folder.setFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l228.144"></a><span id="l228.144" class="difflineminus">-  do_check_true(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.145"></a><span id="l228.145" class="difflineminus">-  do_check_false(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.146"></a><span id="l228.146" class="difflineplus">+  Assert.ok(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.147"></a><span id="l228.147" class="difflineplus">+  Assert.ok(!folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.148"></a><span id="l228.148"> </span>
<a href="#l228.149"></a><span id="l228.149">   folder.setFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l228.150"></a><span id="l228.150" class="difflineminus">-  do_check_true(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.151"></a><span id="l228.151" class="difflineminus">-  do_check_true(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.152"></a><span id="l228.152" class="difflineplus">+  Assert.ok(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.153"></a><span id="l228.153" class="difflineplus">+  Assert.ok(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.154"></a><span id="l228.154"> </span>
<a href="#l228.155"></a><span id="l228.155">   folder.toggleFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l228.156"></a><span id="l228.156" class="difflineminus">-  do_check_false(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.157"></a><span id="l228.157" class="difflineminus">-  do_check_true(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.158"></a><span id="l228.158" class="difflineplus">+  Assert.ok(!folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.159"></a><span id="l228.159" class="difflineplus">+  Assert.ok(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.160"></a><span id="l228.160"> </span>
<a href="#l228.161"></a><span id="l228.161">   folder.clearFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l228.162"></a><span id="l228.162" class="difflineminus">-  do_check_false(folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.163"></a><span id="l228.163" class="difflineminus">-  do_check_false(folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.164"></a><span id="l228.164" class="difflineplus">+  Assert.ok(!folder.getFlag(nsMsgFolderFlags.CheckNew));</span>
<a href="#l228.165"></a><span id="l228.165" class="difflineplus">+  Assert.ok(!folder.getFlag(nsMsgFolderFlags.Offline));</span>
<a href="#l228.166"></a><span id="l228.166"> </span>
<a href="#l228.167"></a><span id="l228.167">   folder.setFlag(nsMsgFolderFlags.Favorite);</span>
<a href="#l228.168"></a><span id="l228.168">   folder2.setFlag(nsMsgFolderFlags.Favorite);</span>
<a href="#l228.169"></a><span id="l228.169">   folder.setFlag(nsMsgFolderFlags.CheckNew);</span>
<a href="#l228.170"></a><span id="l228.170">   folder2.setFlag(nsMsgFolderFlags.Offline);</span>
<a href="#l228.171"></a><span id="l228.171"> </span>
<a href="#l228.172"></a><span id="l228.172" class="difflineminus">-  do_check_eq(root.getFolderWithFlags(nsMsgFolderFlags.CheckNew),</span>
<a href="#l228.173"></a><span id="l228.173" class="difflineminus">-              folder);</span>
<a href="#l228.174"></a><span id="l228.174" class="difflineplus">+  Assert.equal(root.getFolderWithFlags(nsMsgFolderFlags.CheckNew),</span>
<a href="#l228.175"></a><span id="l228.175" class="difflineplus">+               folder);</span>
<a href="#l228.176"></a><span id="l228.176"> </span>
<a href="#l228.177"></a><span id="l228.177">   // Test - Move folders around</span>
<a href="#l228.178"></a><span id="l228.178"> </span>
<a href="#l228.179"></a><span id="l228.179">   var folder3 = root.createLocalSubfolder(&quot;folder3&quot;);</span>
<a href="#l228.180"></a><span id="l228.180">   var folder3Local = folder3.QueryInterface(Components.interfaces.nsIMsgLocalMailFolder);</span>
<a href="#l228.181"></a><span id="l228.181">   var folder1Local = folder.QueryInterface(Components.interfaces.nsIMsgLocalMailFolder);</span>
<a href="#l228.182"></a><span id="l228.182"> </span>
<a href="#l228.183"></a><span id="l228.183">   // put a single message in folder1.</span>
<a href="#l228.184"></a><span id="l228.184">   let messageGenerator = new MessageGenerator();</span>
<a href="#l228.185"></a><span id="l228.185">   let message = messageGenerator.makeMessage();</span>
<a href="#l228.186"></a><span id="l228.186">   let hdr = folder1Local.addMessage(message.toMboxString());</span>
<a href="#l228.187"></a><span id="l228.187" class="difflineminus">-  do_check_eq(message.messageId, hdr.messageId);</span>
<a href="#l228.188"></a><span id="l228.188" class="difflineplus">+  Assert.equal(message.messageId, hdr.messageId);</span>
<a href="#l228.189"></a><span id="l228.189"> </span>
<a href="#l228.190"></a><span id="l228.190">   folder3Local.copyFolderLocal(folder, true, null, null);</span>
<a href="#l228.191"></a><span id="l228.191"> </span>
<a href="#l228.192"></a><span id="l228.192">   // Test - Get the new folders, make sure the old ones don't exist</span>
<a href="#l228.193"></a><span id="l228.193"> </span>
<a href="#l228.194"></a><span id="l228.194">   var folder1Moved = folder3.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l228.195"></a><span id="l228.195">   var folder2Moved = folder1Moved.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l228.196"></a><span id="l228.196"> </span>
<a href="#l228.197"></a><span id="l228.197">   thrown = false;</span>
<a href="#l228.198"></a><span id="l228.198">   try {</span>
<a href="#l228.199"></a><span id="l228.199">     root.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l228.200"></a><span id="l228.200">   }</span>
<a href="#l228.201"></a><span id="l228.201">   catch (e) {</span>
<a href="#l228.202"></a><span id="l228.202">     thrown = true;</span>
<a href="#l228.203"></a><span id="l228.203">   }</span>
<a href="#l228.204"></a><span id="l228.204"> </span>
<a href="#l228.205"></a><span id="l228.205" class="difflineminus">-  do_check_true(thrown);</span>
<a href="#l228.206"></a><span id="l228.206" class="difflineplus">+  Assert.ok(thrown);</span>
<a href="#l228.207"></a><span id="l228.207"> </span>
<a href="#l228.208"></a><span id="l228.208">   if (folder.filePath.exists())</span>
<a href="#l228.209"></a><span id="l228.209">     dump(&quot;shouldn't exist - folder file path &quot; + folder.URI + &quot;\n&quot;);</span>
<a href="#l228.210"></a><span id="l228.210" class="difflineminus">-  do_check_false(folder.filePath.exists());</span>
<a href="#l228.211"></a><span id="l228.211" class="difflineplus">+  Assert.ok(!folder.filePath.exists());</span>
<a href="#l228.212"></a><span id="l228.212">   if (folder2.filePath.exists())</span>
<a href="#l228.213"></a><span id="l228.213">     dump(&quot;shouldn't exist - folder2 file path &quot; + folder2.URI + &quot;\n&quot;);</span>
<a href="#l228.214"></a><span id="l228.214" class="difflineminus">-  do_check_false(folder2.filePath.exists());</span>
<a href="#l228.215"></a><span id="l228.215" class="difflineplus">+  Assert.ok(!folder2.filePath.exists());</span>
<a href="#l228.216"></a><span id="l228.216"> </span>
<a href="#l228.217"></a><span id="l228.217">   // make sure getting the db doesn't throw an exception</span>
<a href="#l228.218"></a><span id="l228.218">   let db = folder1Moved.msgDatabase;</span>
<a href="#l228.219"></a><span id="l228.219" class="difflineminus">-  do_check_true(db.summaryValid);</span>
<a href="#l228.220"></a><span id="l228.220" class="difflineplus">+  Assert.ok(db.summaryValid);</span>
<a href="#l228.221"></a><span id="l228.221"> </span>
<a href="#l228.222"></a><span id="l228.222">   // Move folders back, get them</span>
<a href="#l228.223"></a><span id="l228.223">   var rootLocal = root.QueryInterface(Components.interfaces.nsIMsgLocalMailFolder);</span>
<a href="#l228.224"></a><span id="l228.224">   rootLocal.copyFolderLocal(folder1Moved, true, null, null);</span>
<a href="#l228.225"></a><span id="l228.225">   folder = root.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l228.226"></a><span id="l228.226">   folder2 = folder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l228.227"></a><span id="l228.227"> </span>
<a href="#l228.228"></a><span id="l228.228">   // Test - Rename (test that .msf file is renamed as well)</span>
<a href="#l228.229"></a><span id="l228.229">   folder.rename(&quot;folder1-newname&quot;, null);</span>
<a href="#l228.230"></a><span id="l228.230">   // make sure getting the db doesn't throw an exception, and is valid</span>
<a href="#l228.231"></a><span id="l228.231">   folder = rootLocal.getChildNamed(&quot;folder1-newname&quot;);</span>
<a href="#l228.232"></a><span id="l228.232">   db = folder.msgDatabase;</span>
<a href="#l228.233"></a><span id="l228.233" class="difflineminus">-  do_check_true(db.summaryValid);</span>
<a href="#l228.234"></a><span id="l228.234" class="difflineplus">+  Assert.ok(db.summaryValid);</span>
<a href="#l228.235"></a><span id="l228.235"> </span>
<a href="#l228.236"></a><span id="l228.236">   folder.rename(&quot;folder1&quot;, null);</span>
<a href="#l228.237"></a><span id="l228.237">   folder = rootLocal.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l228.238"></a><span id="l228.238"> </span>
<a href="#l228.239"></a><span id="l228.239">   // Test - propagateDelete (this tests recursiveDelete as well)</span>
<a href="#l228.240"></a><span id="l228.240">   // The folders will be removed from disk completely, not merely to Trash.</span>
<a href="#l228.241"></a><span id="l228.241"> </span>
<a href="#l228.242"></a><span id="l228.242">   var path1 = folder.filePath;</span>
<a href="#l228.243"></a><span id="l228.243">   var path2 = folder2.filePath;</span>
<a href="#l228.244"></a><span id="l228.244">   var path3 = folder3.filePath;</span>
<a href="#l228.245"></a><span id="l228.245"> </span>
<a href="#l228.246"></a><span id="l228.246" class="difflineminus">-  do_check_true(path1.exists());</span>
<a href="#l228.247"></a><span id="l228.247" class="difflineminus">-  do_check_true(path2.exists());</span>
<a href="#l228.248"></a><span id="l228.248" class="difflineminus">-  do_check_true(path3.exists());</span>
<a href="#l228.249"></a><span id="l228.249" class="difflineplus">+  Assert.ok(path1.exists());</span>
<a href="#l228.250"></a><span id="l228.250" class="difflineplus">+  Assert.ok(path2.exists());</span>
<a href="#l228.251"></a><span id="l228.251" class="difflineplus">+  Assert.ok(path3.exists());</span>
<a href="#l228.252"></a><span id="l228.252"> </span>
<a href="#l228.253"></a><span id="l228.253">   // First try deleting folder3 -- folder1 and folder2 paths should still exist</span>
<a href="#l228.254"></a><span id="l228.254">   root.propagateDelete(folder3, true, null);</span>
<a href="#l228.255"></a><span id="l228.255"> </span>
<a href="#l228.256"></a><span id="l228.256" class="difflineminus">-  do_check_true(path1.exists());</span>
<a href="#l228.257"></a><span id="l228.257" class="difflineminus">-  do_check_true(path2.exists());</span>
<a href="#l228.258"></a><span id="l228.258" class="difflineminus">-  do_check_false(path3.exists());</span>
<a href="#l228.259"></a><span id="l228.259" class="difflineplus">+  Assert.ok(path1.exists());</span>
<a href="#l228.260"></a><span id="l228.260" class="difflineplus">+  Assert.ok(path2.exists());</span>
<a href="#l228.261"></a><span id="l228.261" class="difflineplus">+  Assert.ok(!path3.exists());</span>
<a href="#l228.262"></a><span id="l228.262"> </span>
<a href="#l228.263"></a><span id="l228.263">   root.propagateDelete(folder, true, null);</span>
<a href="#l228.264"></a><span id="l228.264"> </span>
<a href="#l228.265"></a><span id="l228.265" class="difflineminus">-  do_check_false(path1.exists());</span>
<a href="#l228.266"></a><span id="l228.266" class="difflineminus">-  do_check_false(path2.exists());</span>
<a href="#l228.267"></a><span id="l228.267" class="difflineplus">+  Assert.ok(!path1.exists());</span>
<a href="#l228.268"></a><span id="l228.268" class="difflineplus">+  Assert.ok(!path2.exists());</span>
<a href="#l228.269"></a><span id="l228.269"> }</span>
<a href="#l228.270"></a><span id="l228.270"> </span>
<a href="#l228.271"></a><span id="l228.271"> function test_store_rename(root) {</span>
<a href="#l228.272"></a><span id="l228.272">   let folder1 = root.createLocalSubfolder(&quot;newfolder1&quot;)</span>
<a href="#l228.273"></a><span id="l228.273">                     .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l228.274"></a><span id="l228.274" class="difflineminus">-  do_check_true(root.hasSubFolders);</span>
<a href="#l228.275"></a><span id="l228.275" class="difflineminus">-  do_check_false(folder1.hasSubFolders);</span>
<a href="#l228.276"></a><span id="l228.276" class="difflineplus">+  Assert.ok(root.hasSubFolders);</span>
<a href="#l228.277"></a><span id="l228.277" class="difflineplus">+  Assert.ok(!folder1.hasSubFolders);</span>
<a href="#l228.278"></a><span id="l228.278">   let folder2 = folder1.createLocalSubfolder(&quot;newfolder1-sub&quot;);</span>
<a href="#l228.279"></a><span id="l228.279">   let folder3 = root.createLocalSubfolder(&quot;newfolder3&quot;)</span>
<a href="#l228.280"></a><span id="l228.280">                     .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l228.281"></a><span id="l228.281">   let folder3Subfolder = folder3.createLocalSubfolder(&quot;newfolder3-sub&quot;);</span>
<a href="#l228.282"></a><span id="l228.282"> </span>
<a href="#l228.283"></a><span id="l228.283" class="difflineminus">-  do_check_true(folder1.hasSubFolders);</span>
<a href="#l228.284"></a><span id="l228.284" class="difflineminus">-  do_check_false(folder2.hasSubFolders);</span>
<a href="#l228.285"></a><span id="l228.285" class="difflineminus">-  do_check_true(folder3.hasSubFolders);</span>
<a href="#l228.286"></a><span id="l228.286" class="difflineplus">+  Assert.ok(folder1.hasSubFolders);</span>
<a href="#l228.287"></a><span id="l228.287" class="difflineplus">+  Assert.ok(!folder2.hasSubFolders);</span>
<a href="#l228.288"></a><span id="l228.288" class="difflineplus">+  Assert.ok(folder3.hasSubFolders);</span>
<a href="#l228.289"></a><span id="l228.289"> </span>
<a href="#l228.290"></a><span id="l228.290">   folder1.rename(&quot;folder1&quot;, null);</span>
<a href="#l228.291"></a><span id="l228.291" class="difflineminus">-  do_check_true(root.containsChildNamed(&quot;folder1&quot;));</span>
<a href="#l228.292"></a><span id="l228.292" class="difflineplus">+  Assert.ok(root.containsChildNamed(&quot;folder1&quot;));</span>
<a href="#l228.293"></a><span id="l228.293">   folder1 = root.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l228.294"></a><span id="l228.294"> </span>
<a href="#l228.295"></a><span id="l228.295">   folder1.rename(&quot;newfolder1&quot;, null);</span>
<a href="#l228.296"></a><span id="l228.296" class="difflineminus">-  do_check_true(root.containsChildNamed(&quot;newfolder1&quot;));</span>
<a href="#l228.297"></a><span id="l228.297" class="difflineplus">+  Assert.ok(root.containsChildNamed(&quot;newfolder1&quot;));</span>
<a href="#l228.298"></a><span id="l228.298">   folder1 = root.getChildNamed(&quot;newfolder1&quot;);</span>
<a href="#l228.299"></a><span id="l228.299">   folder2 = folder1.getChildNamed(&quot;newfolder1-sub&quot;);</span>
<a href="#l228.300"></a><span id="l228.300"> </span>
<a href="#l228.301"></a><span id="l228.301" class="difflineminus">-  do_check_true(folder1.containsChildNamed(folder2.name));</span>
<a href="#l228.302"></a><span id="l228.302" class="difflineminus">-  do_check_true(folder2.filePath.exists());</span>
<a href="#l228.303"></a><span id="l228.303" class="difflineplus">+  Assert.ok(folder1.containsChildNamed(folder2.name));</span>
<a href="#l228.304"></a><span id="l228.304" class="difflineplus">+  Assert.ok(folder2.filePath.exists());</span>
<a href="#l228.305"></a><span id="l228.305"> </span>
<a href="#l228.306"></a><span id="l228.306">   folder3 = root.getChildNamed(&quot;newfolder3&quot;);</span>
<a href="#l228.307"></a><span id="l228.307">   root.propagateDelete(folder3, true, null);</span>
<a href="#l228.308"></a><span id="l228.308" class="difflineminus">-  do_check_false(root.containsChildNamed(&quot;newfolder3&quot;));</span>
<a href="#l228.309"></a><span id="l228.309" class="difflineplus">+  Assert.ok(!root.containsChildNamed(&quot;newfolder3&quot;));</span>
<a href="#l228.310"></a><span id="l228.310">   folder3 = root.createLocalSubfolder(&quot;newfolder3&quot;);</span>
<a href="#l228.311"></a><span id="l228.311">   folder3SubFolder = folder3.createLocalSubfolder(&quot;newfolder3-sub&quot;);</span>
<a href="#l228.312"></a><span id="l228.312">   folder3.rename(&quot;folder3&quot;, null);</span>
<a href="#l228.313"></a><span id="l228.313"> </span>
<a href="#l228.314"></a><span id="l228.314" class="difflineminus">-  do_check_true(root.containsChildNamed(&quot;folder3&quot;));</span>
<a href="#l228.315"></a><span id="l228.315" class="difflineminus">-  do_check_false(root.containsChildNamed(&quot;newfolder3&quot;));</span>
<a href="#l228.316"></a><span id="l228.316" class="difflineplus">+  Assert.ok(root.containsChildNamed(&quot;folder3&quot;));</span>
<a href="#l228.317"></a><span id="l228.317" class="difflineplus">+  Assert.ok(!root.containsChildNamed(&quot;newfolder3&quot;));</span>
<a href="#l228.318"></a><span id="l228.318"> }</span>
<a href="#l228.319"></a><span id="l228.319"> </span>
<a href="#l228.320"></a><span id="l228.320"> var gPluggableStores = [</span>
<a href="#l228.321"></a><span id="l228.321">   &quot;@mozilla.org/msgstore/berkeleystore;1&quot;,</span>
<a href="#l228.322"></a><span id="l228.322">   &quot;@mozilla.org/msgstore/maildirstore;1&quot;</span>
<a href="#l228.323"></a><span id="l228.323"> ];</span>
<a href="#l228.324"></a><span id="l228.324"> </span>
<a href="#l228.325"></a><span id="l228.325"> function run_all_tests(aHostName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l229.1"></a><span id="l229.1" class="difflineminus">--- a/mailnews/local/test/unit/test_over2GBMailboxes.js</span>
<a href="#l229.2"></a><span id="l229.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_over2GBMailboxes.js</span>
<a href="#l229.3"></a><span id="l229.3" class="difflineat">@@ -73,32 +73,32 @@ function getMessageHdr()</span>
<a href="#l229.4"></a><span id="l229.4"> }</span>
<a href="#l229.5"></a><span id="l229.5"> </span>
<a href="#l229.6"></a><span id="l229.6"> function copyMessages()</span>
<a href="#l229.7"></a><span id="l229.7"> {</span>
<a href="#l229.8"></a><span id="l229.8">   // Make sure inbox file grew (i.e., we were not writing over data).</span>
<a href="#l229.9"></a><span id="l229.9">   let localInboxSize = localAccountUtils.inboxFolder.filePath.fileSize;</span>
<a href="#l229.10"></a><span id="l229.10">   do_print(&quot;Local inbox size (after copyFileMessageInLocalFolder()) = &quot; +</span>
<a href="#l229.11"></a><span id="l229.11">            localInboxSize);</span>
<a href="#l229.12"></a><span id="l229.12" class="difflineminus">-  do_check_true(localInboxSize &gt; gLocalInboxSize);</span>
<a href="#l229.13"></a><span id="l229.13" class="difflineplus">+  Assert.ok(localInboxSize &gt; gLocalInboxSize);</span>
<a href="#l229.14"></a><span id="l229.14"> </span>
<a href="#l229.15"></a><span id="l229.15">   // Copy the message into the subfolder.</span>
<a href="#l229.16"></a><span id="l229.16">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l229.17"></a><span id="l229.17">   messages.appendElement(getMessageHdr());</span>
<a href="#l229.18"></a><span id="l229.18">   MailServices.copy.CopyMessages(localAccountUtils.inboxFolder, messages,</span>
<a href="#l229.19"></a><span id="l229.19">                                  gLocalTrashFolder,</span>
<a href="#l229.20"></a><span id="l229.20">                                  false, copyListener2, null, false);</span>
<a href="#l229.21"></a><span id="l229.21"> }</span>
<a href="#l229.22"></a><span id="l229.22"> </span>
<a href="#l229.23"></a><span id="l229.23"> var copyListener2 = {</span>
<a href="#l229.24"></a><span id="l229.24">   OnStartCopy : function() {},</span>
<a href="#l229.25"></a><span id="l229.25">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l229.26"></a><span id="l229.26">   SetMessageKey : function(aKey) {},</span>
<a href="#l229.27"></a><span id="l229.27">   OnStopCopy : function(aStatus) {</span>
<a href="#l229.28"></a><span id="l229.28" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l229.29"></a><span id="l229.29" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l229.30"></a><span id="l229.30"> </span>
<a href="#l229.31"></a><span id="l229.31">     do_timeout(0, accessOver2GBMsg);</span>
<a href="#l229.32"></a><span id="l229.32">   }</span>
<a href="#l229.33"></a><span id="l229.33"> };</span>
<a href="#l229.34"></a><span id="l229.34"> </span>
<a href="#l229.35"></a><span id="l229.35"> // streamMessage() test by over 2 GiB mail offset.</span>
<a href="#l229.36"></a><span id="l229.36"> function accessOver2GBMsg()</span>
<a href="#l229.37"></a><span id="l229.37"> {</span>
<a href="#l229.38"></a><span id="l229.38" class="difflineat">@@ -120,17 +120,17 @@ var gStreamListener = {</span>
<a href="#l229.39"></a><span id="l229.39">     let fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l229.40"></a><span id="l229.40">                     .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l229.41"></a><span id="l229.41">     let stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l229.42"></a><span id="l229.42">                    .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l229.43"></a><span id="l229.43"> </span>
<a href="#l229.44"></a><span id="l229.44">     fstream.init(bugmail10, -1, 0, 0);</span>
<a href="#l229.45"></a><span id="l229.45">     stream.init(fstream);</span>
<a href="#l229.46"></a><span id="l229.46">     let original = stream.read(this._data.length);</span>
<a href="#l229.47"></a><span id="l229.47" class="difflineminus">-    do_check_eq(this._data, original);</span>
<a href="#l229.48"></a><span id="l229.48" class="difflineplus">+    Assert.equal(this._data, original);</span>
<a href="#l229.49"></a><span id="l229.49"> </span>
<a href="#l229.50"></a><span id="l229.50">     do_timeout(0, endTest);</span>
<a href="#l229.51"></a><span id="l229.51">   },</span>
<a href="#l229.52"></a><span id="l229.52">   onDataAvailable : function (aRequest, aContext, aInputStream, aOff, aCount) {</span>
<a href="#l229.53"></a><span id="l229.53">     if (this._stream == null) {</span>
<a href="#l229.54"></a><span id="l229.54">       this._stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l229.55"></a><span id="l229.55">       this._stream.init(aInputStream);</span>
<a href="#l229.56"></a><span id="l229.56">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l230.1"></a><span id="l230.1" class="difflineminus">--- a/mailnews/local/test/unit/test_over4GBMailboxes.js</span>
<a href="#l230.2"></a><span id="l230.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_over4GBMailboxes.js</span>
<a href="#l230.3"></a><span id="l230.3" class="difflineat">@@ -43,17 +43,17 @@ var gInboxSize = 0;            // The si</span>
<a href="#l230.4"></a><span id="l230.4"> var gInbox;                    // The nsIMsgFolder object of the Inbox folder in Local Folders</span>
<a href="#l230.5"></a><span id="l230.5"> var gExpectedNewMessages = 0;  // The number of messages pushed manually into the mbox file</span>
<a href="#l230.6"></a><span id="l230.6"> </span>
<a href="#l230.7"></a><span id="l230.7"> // This alert() is triggered when file size becomes close (enough) to or</span>
<a href="#l230.8"></a><span id="l230.8"> // exceeds 4 GiB.</span>
<a href="#l230.9"></a><span id="l230.9"> // See hardcoded value in nsMsgBrkMBoxStore::HasSpaceAvailable().</span>
<a href="#l230.10"></a><span id="l230.10"> function alert(aDialogTitle, aText) {</span>
<a href="#l230.11"></a><span id="l230.11">   // See &quot;/*/locales/en-US/chrome/*/messenger.properties &gt; mailboxTooLarge&quot;.</span>
<a href="#l230.12"></a><span id="l230.12" class="difflineminus">-  do_check_true(aText.startsWith(&quot;The folder Inbox is full, and can't hold any more messages.&quot;));</span>
<a href="#l230.13"></a><span id="l230.13" class="difflineplus">+  Assert.ok(aText.startsWith(&quot;The folder Inbox is full, and can't hold any more messages.&quot;));</span>
<a href="#l230.14"></a><span id="l230.14">   gGotAlert = true;</span>
<a href="#l230.15"></a><span id="l230.15"> }</span>
<a href="#l230.16"></a><span id="l230.16"> </span>
<a href="#l230.17"></a><span id="l230.17"> // A stub nsIMsgFolderListener that only listens to changes on Inbox and stores</span>
<a href="#l230.18"></a><span id="l230.18"> // the seen values for interesting folder properties so we can later test them.</span>
<a href="#l230.19"></a><span id="l230.19"> var FListener = {</span>
<a href="#l230.20"></a><span id="l230.20">   folderSize: [-1], // an array of seen values of &quot;FolderSize&quot;</span>
<a href="#l230.21"></a><span id="l230.21">   totalMsgs: [-1],  // an array of seen values of &quot;TotalMessages&quot;</span>
<a href="#l230.22"></a><span id="l230.22" class="difflineat">@@ -149,20 +149,20 @@ function growInbox(aWantedSize) {</span>
<a href="#l230.23"></a><span id="l230.23">     msgsAdded++;</span>
<a href="#l230.24"></a><span id="l230.24"> </span>
<a href="#l230.25"></a><span id="l230.25">     // Refresh 'gInboxFile'.</span>
<a href="#l230.26"></a><span id="l230.26">     gInboxFile = gInbox.filePath;</span>
<a href="#l230.27"></a><span id="l230.27">     localSize = gInboxFile.clone().fileSize;</span>
<a href="#l230.28"></a><span id="l230.28">   }</span>
<a href="#l230.29"></a><span id="l230.29">   while (localSize &lt; aWantedSize);</span>
<a href="#l230.30"></a><span id="l230.30"> </span>
<a href="#l230.31"></a><span id="l230.31" class="difflineminus">-  do_check_eq(gInboxFile.clone().fileSize, aWantedSize);</span>
<a href="#l230.32"></a><span id="l230.32" class="difflineplus">+  Assert.equal(gInboxFile.clone().fileSize, aWantedSize);</span>
<a href="#l230.33"></a><span id="l230.33">   do_print(&quot;Local inbox size = &quot; + localSize + &quot;bytes = &quot; +</span>
<a href="#l230.34"></a><span id="l230.34">            mailTestUtils.toMiBString(localSize));</span>
<a href="#l230.35"></a><span id="l230.35" class="difflineminus">-  do_check_eq(localSize, aWantedSize);</span>
<a href="#l230.36"></a><span id="l230.36" class="difflineplus">+  Assert.equal(localSize, aWantedSize);</span>
<a href="#l230.37"></a><span id="l230.37">   return msgsAdded;</span>
<a href="#l230.38"></a><span id="l230.38"> }</span>
<a href="#l230.39"></a><span id="l230.39"> </span>
<a href="#l230.40"></a><span id="l230.40"> function run_test()</span>
<a href="#l230.41"></a><span id="l230.41"> {</span>
<a href="#l230.42"></a><span id="l230.42">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l230.43"></a><span id="l230.43"> </span>
<a href="#l230.44"></a><span id="l230.44">   allow4GBFolders(false);</span>
<a href="#l230.45"></a><span id="l230.45" class="difflineat">@@ -205,52 +205,52 @@ function run_test()</span>
<a href="#l230.46"></a><span id="l230.46"> </span>
<a href="#l230.47"></a><span id="l230.47">   // Force the db closed, so that getDatabaseWithReparse will notice</span>
<a href="#l230.48"></a><span id="l230.48">   // that it's out of date.</span>
<a href="#l230.49"></a><span id="l230.49">   gInbox.msgDatabase.ForceClosed();</span>
<a href="#l230.50"></a><span id="l230.50">   gInbox.msgDatabase = null;</span>
<a href="#l230.51"></a><span id="l230.51">   try {</span>
<a href="#l230.52"></a><span id="l230.52">     gInbox.getDatabaseWithReparse(ParseListener_run_test, gDummyMsgWindow);</span>
<a href="#l230.53"></a><span id="l230.53">   } catch (ex) {</span>
<a href="#l230.54"></a><span id="l230.54" class="difflineminus">-    do_check_eq(ex.result, Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l230.55"></a><span id="l230.55" class="difflineplus">+    Assert.equal(ex.result, Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l230.56"></a><span id="l230.56">   }</span>
<a href="#l230.57"></a><span id="l230.57">   // Execution continues in downloadUnder4GiB() when done.</span>
<a href="#l230.58"></a><span id="l230.58"> }</span>
<a href="#l230.59"></a><span id="l230.59"> </span>
<a href="#l230.60"></a><span id="l230.60"> /**</span>
<a href="#l230.61"></a><span id="l230.61">  * Check we can download new mail when we are near 4GiB limit but do not cross it.</span>
<a href="#l230.62"></a><span id="l230.62">  */</span>
<a href="#l230.63"></a><span id="l230.63"> function downloadUnder4GiB()</span>
<a href="#l230.64"></a><span id="l230.64"> {</span>
<a href="#l230.65"></a><span id="l230.65">   // Check fake POP3 server is ready.</span>
<a href="#l230.66"></a><span id="l230.66" class="difflineminus">-  do_check_neq(gPOP3Pump.fakeServer, null);</span>
<a href="#l230.67"></a><span id="l230.67" class="difflineplus">+  Assert.notEqual(gPOP3Pump.fakeServer, null);</span>
<a href="#l230.68"></a><span id="l230.68"> </span>
<a href="#l230.69"></a><span id="l230.69">   // Download a file that still fits into the limit.</span>
<a href="#l230.70"></a><span id="l230.70">   let bigFile = do_get_file(&quot;../../../data/mime-torture&quot;);</span>
<a href="#l230.71"></a><span id="l230.71" class="difflineminus">-  do_check_true(bigFile.fileSize &gt;= 1024 * 1024);</span>
<a href="#l230.72"></a><span id="l230.72" class="difflineminus">-  do_check_true(bigFile.fileSize &lt;= 1024 * 1024 * 2);</span>
<a href="#l230.73"></a><span id="l230.73" class="difflineplus">+  Assert.ok(bigFile.fileSize &gt;= 1024 * 1024);</span>
<a href="#l230.74"></a><span id="l230.74" class="difflineplus">+  Assert.ok(bigFile.fileSize &lt;= 1024 * 1024 * 2);</span>
<a href="#l230.75"></a><span id="l230.75"> </span>
<a href="#l230.76"></a><span id="l230.76">   gPOP3Pump.files = [&quot;../../../data/mime-torture&quot;];</span>
<a href="#l230.77"></a><span id="l230.77">   gPOP3Pump.onDone = downloadOver4GiB_fail;</span>
<a href="#l230.78"></a><span id="l230.78">   // It must succeed.</span>
<a href="#l230.79"></a><span id="l230.79">   gPOP3Pump.run(Cr.NS_OK);</span>
<a href="#l230.80"></a><span id="l230.80">   // Execution continues in downloadOver4GiB_fail() when done.</span>
<a href="#l230.81"></a><span id="l230.81"> }</span>
<a href="#l230.82"></a><span id="l230.82"> </span>
<a href="#l230.83"></a><span id="l230.83"> /**</span>
<a href="#l230.84"></a><span id="l230.84">  * Bug 640371</span>
<a href="#l230.85"></a><span id="l230.85">  * Check we will not cross the 4GiB limit when downloading new mail.</span>
<a href="#l230.86"></a><span id="l230.86">  */</span>
<a href="#l230.87"></a><span id="l230.87"> function downloadOver4GiB_fail()</span>
<a href="#l230.88"></a><span id="l230.88"> {</span>
<a href="#l230.89"></a><span id="l230.89">   let localInboxSize = gInboxFile.clone().fileSize;</span>
<a href="#l230.90"></a><span id="l230.90" class="difflineminus">-  do_check_true(localInboxSize &gt;= kNearLimit);</span>
<a href="#l230.91"></a><span id="l230.91" class="difflineminus">-  do_check_true(localInboxSize &lt; kSizeLimit);</span>
<a href="#l230.92"></a><span id="l230.92" class="difflineminus">-  do_check_eq(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.93"></a><span id="l230.93" class="difflineminus">-  do_check_true(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.94"></a><span id="l230.94" class="difflineplus">+  Assert.ok(localInboxSize &gt;= kNearLimit);</span>
<a href="#l230.95"></a><span id="l230.95" class="difflineplus">+  Assert.ok(localInboxSize &lt; kSizeLimit);</span>
<a href="#l230.96"></a><span id="l230.96" class="difflineplus">+  Assert.equal(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.97"></a><span id="l230.97" class="difflineplus">+  Assert.ok(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.98"></a><span id="l230.98">   // The big file is between 1 and 2 MiB. Append it 16 times to attempt to cross the 4GiB limit.</span>
<a href="#l230.99"></a><span id="l230.99">   gPOP3Pump.files = [&quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.100"></a><span id="l230.100">                      &quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.101"></a><span id="l230.101">                      &quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.102"></a><span id="l230.102">                      &quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.103"></a><span id="l230.103">                      &quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.104"></a><span id="l230.104">                      &quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.105"></a><span id="l230.105">                      &quot;../../../data/mime-torture&quot;, &quot;../../../data/mime-torture&quot;,</span>
<a href="#l230.106"></a><span id="l230.106" class="difflineat">@@ -294,40 +294,40 @@ function downloadOver4GiB_success()</span>
<a href="#l230.107"></a><span id="l230.107"> /**</span>
<a href="#l230.108"></a><span id="l230.108">  * Bug 608449</span>
<a href="#l230.109"></a><span id="l230.109">  * Check we can parse a folder if it is above 4GiB.</span>
<a href="#l230.110"></a><span id="l230.110">  */</span>
<a href="#l230.111"></a><span id="l230.111"> function downloadOver4GiB_success_check()</span>
<a href="#l230.112"></a><span id="l230.112"> {</span>
<a href="#l230.113"></a><span id="l230.113">   let localInboxSize = gInboxFile.clone().fileSize;</span>
<a href="#l230.114"></a><span id="l230.114">   dump(&quot;Local inbox size (after downloadOver4GiB_success) = &quot; + localInboxSize + &quot;\n&quot;);</span>
<a href="#l230.115"></a><span id="l230.115" class="difflineminus">-  do_check_true(localInboxSize &gt; kSizeLimit);</span>
<a href="#l230.116"></a><span id="l230.116" class="difflineminus">-  do_check_true(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.117"></a><span id="l230.117" class="difflineplus">+  Assert.ok(localInboxSize &gt; kSizeLimit);</span>
<a href="#l230.118"></a><span id="l230.118" class="difflineplus">+  Assert.ok(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.119"></a><span id="l230.119"> </span>
<a href="#l230.120"></a><span id="l230.120">   // Bug 789679</span>
<a href="#l230.121"></a><span id="l230.121">   // Check if the public SizeOnDisk method can return sizes above 4GB.</span>
<a href="#l230.122"></a><span id="l230.122" class="difflineminus">-  do_check_eq(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.123"></a><span id="l230.123" class="difflineplus">+  Assert.equal(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.124"></a><span id="l230.124"> </span>
<a href="#l230.125"></a><span id="l230.125">   // Bug 813459</span>
<a href="#l230.126"></a><span id="l230.126">   // Check if the OnItemIntPropertyChanged folder listener hook can return</span>
<a href="#l230.127"></a><span id="l230.127">   // values above 2^32 for properties where it is relevant.</span>
<a href="#l230.128"></a><span id="l230.128" class="difflineminus">-  do_check_eq(FListener.sizeHistory(0), gInbox.sizeOnDisk);</span>
<a href="#l230.129"></a><span id="l230.129" class="difflineminus">-  do_check_true(FListener.sizeHistory(1) &lt; FListener.sizeHistory(0));</span>
<a href="#l230.130"></a><span id="l230.130" class="difflineminus">-  do_check_eq(FListener.msgsHistory(0),</span>
<a href="#l230.131"></a><span id="l230.131" class="difflineminus">-              FListener.msgsHistory(16) + gExpectedNewMessages);</span>
<a href="#l230.132"></a><span id="l230.132" class="difflineminus">-  do_check_eq(gInbox.expungedBytes, 0);</span>
<a href="#l230.133"></a><span id="l230.133" class="difflineplus">+  Assert.equal(FListener.sizeHistory(0), gInbox.sizeOnDisk);</span>
<a href="#l230.134"></a><span id="l230.134" class="difflineplus">+  Assert.ok(FListener.sizeHistory(1) &lt; FListener.sizeHistory(0));</span>
<a href="#l230.135"></a><span id="l230.135" class="difflineplus">+  Assert.equal(FListener.msgsHistory(0),</span>
<a href="#l230.136"></a><span id="l230.136" class="difflineplus">+               FListener.msgsHistory(16) + gExpectedNewMessages);</span>
<a href="#l230.137"></a><span id="l230.137" class="difflineplus">+  Assert.equal(gInbox.expungedBytes, 0);</span>
<a href="#l230.138"></a><span id="l230.138"> </span>
<a href="#l230.139"></a><span id="l230.139">   // Bug 1183490</span>
<a href="#l230.140"></a><span id="l230.140">   // Check that the message keys are below 4GB (thus no offset),</span>
<a href="#l230.141"></a><span id="l230.141">   // actually just incrementing by 1 for each message.</span>
<a href="#l230.142"></a><span id="l230.142">   let msgs = gInbox.messages;</span>
<a href="#l230.143"></a><span id="l230.143">   let key = 0;</span>
<a href="#l230.144"></a><span id="l230.144">   while (msgs.hasMoreElements()) {</span>
<a href="#l230.145"></a><span id="l230.145">     key++;</span>
<a href="#l230.146"></a><span id="l230.146" class="difflineminus">-    do_check_eq(msgs.getNext().QueryInterface(Ci.nsIMsgDBHdr).messageKey, key);</span>
<a href="#l230.147"></a><span id="l230.147" class="difflineplus">+    Assert.equal(msgs.getNext().QueryInterface(Ci.nsIMsgDBHdr).messageKey, key);</span>
<a href="#l230.148"></a><span id="l230.148">   }</span>
<a href="#l230.149"></a><span id="l230.149"> </span>
<a href="#l230.150"></a><span id="l230.150">   copyIntoOver4GiB_fail();</span>
<a href="#l230.151"></a><span id="l230.151"> }</span>
<a href="#l230.152"></a><span id="l230.152"> </span>
<a href="#l230.153"></a><span id="l230.153"> /**</span>
<a href="#l230.154"></a><span id="l230.154">  * Bug 598104</span>
<a href="#l230.155"></a><span id="l230.155">  * Check that copy operation does not allow to grow a local folder above 4 GiB.</span>
<a href="#l230.156"></a><span id="l230.156" class="difflineat">@@ -344,19 +344,19 @@ function copyIntoOver4GiB_fail()</span>
<a href="#l230.157"></a><span id="l230.157">   // to local inbox.</span>
<a href="#l230.158"></a><span id="l230.158">   gGotAlert = false;</span>
<a href="#l230.159"></a><span id="l230.159">   let file = do_get_file(&quot;../../../data/mime-torture&quot;);</span>
<a href="#l230.160"></a><span id="l230.160">   copyFileMessageInLocalFolder(file, 0, &quot;&quot;, gDummyMsgWindow, copyIntoOver4GiB_fail_check);</span>
<a href="#l230.161"></a><span id="l230.161"> }</span>
<a href="#l230.162"></a><span id="l230.162"> </span>
<a href="#l230.163"></a><span id="l230.163"> function copyIntoOver4GiB_fail_check(aMessageHeadersKeys, aStatus)</span>
<a href="#l230.164"></a><span id="l230.164"> {</span>
<a href="#l230.165"></a><span id="l230.165" class="difflineminus">-  do_check_false(Components.isSuccessCode(aStatus));</span>
<a href="#l230.166"></a><span id="l230.166" class="difflineminus">-  do_check_eq(aMessageHeadersKeys.length, 0);</span>
<a href="#l230.167"></a><span id="l230.167" class="difflineminus">-  do_check_true(gGotAlert);</span>
<a href="#l230.168"></a><span id="l230.168" class="difflineplus">+  Assert.ok(!Components.isSuccessCode(aStatus));</span>
<a href="#l230.169"></a><span id="l230.169" class="difflineplus">+  Assert.equal(aMessageHeadersKeys.length, 0);</span>
<a href="#l230.170"></a><span id="l230.170" class="difflineplus">+  Assert.ok(gGotAlert);</span>
<a href="#l230.171"></a><span id="l230.171"> </span>
<a href="#l230.172"></a><span id="l230.172">   // Make sure inbox file did not grow (i.e., no data were appended).</span>
<a href="#l230.173"></a><span id="l230.173">   let newLocalInboxSize = gInboxFile.clone().fileSize;</span>
<a href="#l230.174"></a><span id="l230.174">   do_print(&quot;Local inbox size (after copyFileMessageInLocalFolder()) = &quot; +</span>
<a href="#l230.175"></a><span id="l230.175">            newLocalInboxSize);</span>
<a href="#l230.176"></a><span id="l230.176">   copyIntoOver4GiB_success();</span>
<a href="#l230.177"></a><span id="l230.177"> }</span>
<a href="#l230.178"></a><span id="l230.178"> </span>
<a href="#l230.179"></a><span id="l230.179" class="difflineat">@@ -372,58 +372,58 @@ function copyIntoOver4GiB_success()</span>
<a href="#l230.180"></a><span id="l230.180"> </span>
<a href="#l230.181"></a><span id="l230.181">   // This message will be preserved in CompactUnder4GB.</span>
<a href="#l230.182"></a><span id="l230.182">   gGotAlert = false;</span>
<a href="#l230.183"></a><span id="l230.183">   let file = do_get_file(&quot;../../../data/mime-torture&quot;);</span>
<a href="#l230.184"></a><span id="l230.184">   copyFileMessageInLocalFolder(file, 0, &quot;&quot;, gDummyMsgWindow, copyIntoOver4GiB_success_check1);</span>
<a href="#l230.185"></a><span id="l230.185"> }</span>
<a href="#l230.186"></a><span id="l230.186"> </span>
<a href="#l230.187"></a><span id="l230.187"> function copyIntoOver4GiB_success_check1(aMessageHeadersKeys, aStatus) {</span>
<a href="#l230.188"></a><span id="l230.188" class="difflineminus">-  do_check_true(Components.isSuccessCode(aStatus));</span>
<a href="#l230.189"></a><span id="l230.189" class="difflineminus">-  do_check_eq(aMessageHeadersKeys[0], 60);</span>
<a href="#l230.190"></a><span id="l230.190" class="difflineminus">-  do_check_false(gGotAlert);</span>
<a href="#l230.191"></a><span id="l230.191" class="difflineplus">+  Assert.ok(Components.isSuccessCode(aStatus));</span>
<a href="#l230.192"></a><span id="l230.192" class="difflineplus">+  Assert.equal(aMessageHeadersKeys[0], 60);</span>
<a href="#l230.193"></a><span id="l230.193" class="difflineplus">+  Assert.ok(!gGotAlert);</span>
<a href="#l230.194"></a><span id="l230.194"> </span>
<a href="#l230.195"></a><span id="l230.195">   // This message will be removed in compactOver4GB.</span>
<a href="#l230.196"></a><span id="l230.196">   let file = do_get_file(&quot;../../../data/mime-torture&quot;);</span>
<a href="#l230.197"></a><span id="l230.197">   copyFileMessageInLocalFolder(file, 0, &quot;&quot;, gDummyMsgWindow, copyIntoOver4GiB_success_check2);</span>
<a href="#l230.198"></a><span id="l230.198"> }</span>
<a href="#l230.199"></a><span id="l230.199"> </span>
<a href="#l230.200"></a><span id="l230.200"> function copyIntoOver4GiB_success_check2(aMessageHeadersKeys, aStatus) {</span>
<a href="#l230.201"></a><span id="l230.201" class="difflineminus">-  do_check_true(Components.isSuccessCode(aStatus));</span>
<a href="#l230.202"></a><span id="l230.202" class="difflineminus">-  do_check_eq(aMessageHeadersKeys[1], 61);</span>
<a href="#l230.203"></a><span id="l230.203" class="difflineminus">-  do_check_false(gGotAlert);</span>
<a href="#l230.204"></a><span id="l230.204" class="difflineplus">+  Assert.ok(Components.isSuccessCode(aStatus));</span>
<a href="#l230.205"></a><span id="l230.205" class="difflineplus">+  Assert.equal(aMessageHeadersKeys[1], 61);</span>
<a href="#l230.206"></a><span id="l230.206" class="difflineplus">+  Assert.ok(!gGotAlert);</span>
<a href="#l230.207"></a><span id="l230.207"> </span>
<a href="#l230.208"></a><span id="l230.208" class="difflineminus">-  do_check_eq(FListener.msgsHistory(0),</span>
<a href="#l230.209"></a><span id="l230.209" class="difflineminus">-              FListener.msgsHistory(2) + gExpectedNewMessages);</span>
<a href="#l230.210"></a><span id="l230.210" class="difflineplus">+  Assert.equal(FListener.msgsHistory(0),</span>
<a href="#l230.211"></a><span id="l230.211" class="difflineplus">+               FListener.msgsHistory(2) + gExpectedNewMessages);</span>
<a href="#l230.212"></a><span id="l230.212"> </span>
<a href="#l230.213"></a><span id="l230.213">   compactOver4GiB();</span>
<a href="#l230.214"></a><span id="l230.214"> }</span>
<a href="#l230.215"></a><span id="l230.215"> </span>
<a href="#l230.216"></a><span id="l230.216"> /**</span>
<a href="#l230.217"></a><span id="l230.217">  * Bug 794303</span>
<a href="#l230.218"></a><span id="l230.218">  * Check we can compact a folder that stays above 4 GiB after compact.</span>
<a href="#l230.219"></a><span id="l230.219">  */</span>
<a href="#l230.220"></a><span id="l230.220"> function compactOver4GiB()</span>
<a href="#l230.221"></a><span id="l230.221"> {</span>
<a href="#l230.222"></a><span id="l230.222">   gInboxSize = gInboxFile.clone().fileSize;</span>
<a href="#l230.223"></a><span id="l230.223" class="difflineminus">-  do_check_true(gInboxSize &gt; kSizeLimit);</span>
<a href="#l230.224"></a><span id="l230.224" class="difflineminus">-  do_check_eq(gInbox.expungedBytes, 0);</span>
<a href="#l230.225"></a><span id="l230.225" class="difflineplus">+  Assert.ok(gInboxSize &gt; kSizeLimit);</span>
<a href="#l230.226"></a><span id="l230.226" class="difflineplus">+  Assert.equal(gInbox.expungedBytes, 0);</span>
<a href="#l230.227"></a><span id="l230.227">   // Delete the last small message at folder end.</span>
<a href="#l230.228"></a><span id="l230.228">   let enumerator = gInbox.messages;</span>
<a href="#l230.229"></a><span id="l230.229">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l230.230"></a><span id="l230.230">   let sizeToExpunge = 0;</span>
<a href="#l230.231"></a><span id="l230.231">   while (enumerator.hasMoreElements()) {</span>
<a href="#l230.232"></a><span id="l230.232">     let header = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l230.233"></a><span id="l230.233">     if (!enumerator.hasMoreElements()) {</span>
<a href="#l230.234"></a><span id="l230.234">       messages.appendElement(header);</span>
<a href="#l230.235"></a><span id="l230.235">       sizeToExpunge = header.messageSize;</span>
<a href="#l230.236"></a><span id="l230.236">     }</span>
<a href="#l230.237"></a><span id="l230.237">   }</span>
<a href="#l230.238"></a><span id="l230.238">   gInbox.deleteMessages(messages, null, true, false, null, false);</span>
<a href="#l230.239"></a><span id="l230.239" class="difflineminus">-  do_check_eq(gInbox.expungedBytes, sizeToExpunge);</span>
<a href="#l230.240"></a><span id="l230.240" class="difflineplus">+  Assert.equal(gInbox.expungedBytes, sizeToExpunge);</span>
<a href="#l230.241"></a><span id="l230.241"> </span>
<a href="#l230.242"></a><span id="l230.242">   /* Unfortunately, the compaction now would kill the sparse markings in the file</span>
<a href="#l230.243"></a><span id="l230.243">    * so it will really take 4GiB of space in the filesystem and may be slow</span>
<a href="#l230.244"></a><span id="l230.244">    * (e.g. it takes ~450s on TB-try). Therefore we run this part of the test randomly,</span>
<a href="#l230.245"></a><span id="l230.245">    * only in 1 of 100 runs. Considering the number of times all the tests are run</span>
<a href="#l230.246"></a><span id="l230.246">    * per check-in, this still runs this test after several check-ins.*/</span>
<a href="#l230.247"></a><span id="l230.247">   if (Math.random() * 100 &lt; 1) {</span>
<a href="#l230.248"></a><span id="l230.248">     // Note: compact() will also add 'X-Mozilla-Status' and 'X-Mozilla-Status2'</span>
<a href="#l230.249"></a><span id="l230.249" class="difflineat">@@ -439,28 +439,28 @@ function compactOver4GiB()</span>
<a href="#l230.250"></a><span id="l230.250"> </span>
<a href="#l230.251"></a><span id="l230.251"> /**</span>
<a href="#l230.252"></a><span id="l230.252">  * Bug 608449</span>
<a href="#l230.253"></a><span id="l230.253">  * Check we can compact a folder to get it under 4 GiB.</span>
<a href="#l230.254"></a><span id="l230.254">  */</span>
<a href="#l230.255"></a><span id="l230.255"> function compactUnder4GiB()</span>
<a href="#l230.256"></a><span id="l230.256"> {</span>
<a href="#l230.257"></a><span id="l230.257">   // The folder is still above 4GB.</span>
<a href="#l230.258"></a><span id="l230.258" class="difflineminus">-  do_check_true(gInboxFile.clone().fileSize &gt; kSizeLimit);</span>
<a href="#l230.259"></a><span id="l230.259" class="difflineplus">+  Assert.ok(gInboxFile.clone().fileSize &gt; kSizeLimit);</span>
<a href="#l230.260"></a><span id="l230.260">   let folderSize = gInbox.sizeOnDisk;</span>
<a href="#l230.261"></a><span id="l230.261">   let totalMsgs = gInbox.getTotalMessages(false);</span>
<a href="#l230.262"></a><span id="l230.262">   // Let's close the database and re-open the folder (hopefully dumping memory caches)</span>
<a href="#l230.263"></a><span id="l230.263">   // and re-reading the values from disk (msg database). That is to test if</span>
<a href="#l230.264"></a><span id="l230.264">   // the values were properly serialized to the database.</span>
<a href="#l230.265"></a><span id="l230.265">   gInbox.ForceDBClosed();</span>
<a href="#l230.266"></a><span id="l230.266">   gInbox.msgDatabase = null;</span>
<a href="#l230.267"></a><span id="l230.267">   gInbox.getDatabaseWOReparse();</span>
<a href="#l230.268"></a><span id="l230.268"> </span>
<a href="#l230.269"></a><span id="l230.269" class="difflineminus">-  do_check_eq(gInbox.sizeOnDisk, folderSize);</span>
<a href="#l230.270"></a><span id="l230.270" class="difflineminus">-  do_check_eq(gInbox.getTotalMessages(false), totalMsgs);</span>
<a href="#l230.271"></a><span id="l230.271" class="difflineplus">+  Assert.equal(gInbox.sizeOnDisk, folderSize);</span>
<a href="#l230.272"></a><span id="l230.272" class="difflineplus">+  Assert.equal(gInbox.getTotalMessages(false), totalMsgs);</span>
<a href="#l230.273"></a><span id="l230.273"> </span>
<a href="#l230.274"></a><span id="l230.274">   // Very last header in folder is retained,</span>
<a href="#l230.275"></a><span id="l230.275">   // but all other preceding headers are marked as deleted.</span>
<a href="#l230.276"></a><span id="l230.276">   let enumerator = gInbox.messages;</span>
<a href="#l230.277"></a><span id="l230.277">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l230.278"></a><span id="l230.278">   let sizeToExpunge = gInbox.expungedBytes; // If compact in compactOver4GB was skipped, this is not 0.</span>
<a href="#l230.279"></a><span id="l230.279">   while (enumerator.hasMoreElements()) {</span>
<a href="#l230.280"></a><span id="l230.280">     let header = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l230.281"></a><span id="l230.281" class="difflineat">@@ -468,83 +468,83 @@ function compactUnder4GiB()</span>
<a href="#l230.282"></a><span id="l230.282">       messages.appendElement(header);</span>
<a href="#l230.283"></a><span id="l230.283">       sizeToExpunge += header.messageSize;</span>
<a href="#l230.284"></a><span id="l230.284">     }</span>
<a href="#l230.285"></a><span id="l230.285">   }</span>
<a href="#l230.286"></a><span id="l230.286">   gInbox.deleteMessages(messages, null, true, false, null, false);</span>
<a href="#l230.287"></a><span id="l230.287"> </span>
<a href="#l230.288"></a><span id="l230.288">   // Bug 894012: size of messages to expunge is now higher than 4GB.</span>
<a href="#l230.289"></a><span id="l230.289">   // Only the small 1MiB message remains.</span>
<a href="#l230.290"></a><span id="l230.290" class="difflineminus">-  do_check_eq(gInbox.expungedBytes, sizeToExpunge);</span>
<a href="#l230.291"></a><span id="l230.291" class="difflineminus">-  do_check_true(sizeToExpunge &gt; kSizeLimit);</span>
<a href="#l230.292"></a><span id="l230.292" class="difflineplus">+  Assert.equal(gInbox.expungedBytes, sizeToExpunge);</span>
<a href="#l230.293"></a><span id="l230.293" class="difflineplus">+  Assert.ok(sizeToExpunge &gt; kSizeLimit);</span>
<a href="#l230.294"></a><span id="l230.294"> </span>
<a href="#l230.295"></a><span id="l230.295">   // Note: compact() will also add 'X-Mozilla-Status' and 'X-Mozilla-Status2'</span>
<a href="#l230.296"></a><span id="l230.296">   // lines to message(s).</span>
<a href="#l230.297"></a><span id="l230.297">   gInbox.compact(CompactListener_compactUnder4GiB, null);</span>
<a href="#l230.298"></a><span id="l230.298">   // Test ends after compaction is done.</span>
<a href="#l230.299"></a><span id="l230.299"> }</span>
<a href="#l230.300"></a><span id="l230.300"> </span>
<a href="#l230.301"></a><span id="l230.301"> var ParseListener_run_test =</span>
<a href="#l230.302"></a><span id="l230.302"> {</span>
<a href="#l230.303"></a><span id="l230.303">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l230.304"></a><span id="l230.304">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l230.305"></a><span id="l230.305">     // Check: reparse successful</span>
<a href="#l230.306"></a><span id="l230.306" class="difflineminus">-    do_check_eq(aExitCode, Cr.NS_OK);</span>
<a href="#l230.307"></a><span id="l230.307" class="difflineminus">-    do_check_neq(gInbox.msgDatabase, null);</span>
<a href="#l230.308"></a><span id="l230.308" class="difflineminus">-    do_check_true(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.309"></a><span id="l230.309" class="difflineplus">+    Assert.equal(aExitCode, Cr.NS_OK);</span>
<a href="#l230.310"></a><span id="l230.310" class="difflineplus">+    Assert.notEqual(gInbox.msgDatabase, null);</span>
<a href="#l230.311"></a><span id="l230.311" class="difflineplus">+    Assert.ok(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.312"></a><span id="l230.312">     // Bug 813459</span>
<a href="#l230.313"></a><span id="l230.313">     // Check if the OnItemIntPropertyChanged folder listener hook can return</span>
<a href="#l230.314"></a><span id="l230.314">     // values below 2^32 for properties which are not 64 bits long.</span>
<a href="#l230.315"></a><span id="l230.315" class="difflineminus">-    do_check_eq(FListener.msgsHistory(0), gExpectedNewMessages);</span>
<a href="#l230.316"></a><span id="l230.316" class="difflineminus">-    do_check_eq(FListener.msgsHistory(0), gInbox.getTotalMessages(false));</span>
<a href="#l230.317"></a><span id="l230.317" class="difflineminus">-    do_check_eq(FListener.sizeHistory(0), gInbox.sizeOnDisk);</span>
<a href="#l230.318"></a><span id="l230.318" class="difflineplus">+    Assert.equal(FListener.msgsHistory(0), gExpectedNewMessages);</span>
<a href="#l230.319"></a><span id="l230.319" class="difflineplus">+    Assert.equal(FListener.msgsHistory(0), gInbox.getTotalMessages(false));</span>
<a href="#l230.320"></a><span id="l230.320" class="difflineplus">+    Assert.equal(FListener.sizeHistory(0), gInbox.sizeOnDisk);</span>
<a href="#l230.321"></a><span id="l230.321"> </span>
<a href="#l230.322"></a><span id="l230.322">     downloadUnder4GiB();</span>
<a href="#l230.323"></a><span id="l230.323">   }</span>
<a href="#l230.324"></a><span id="l230.324"> };</span>
<a href="#l230.325"></a><span id="l230.325"> </span>
<a href="#l230.326"></a><span id="l230.326"> var CompactListener_compactOver4GiB =</span>
<a href="#l230.327"></a><span id="l230.327"> {</span>
<a href="#l230.328"></a><span id="l230.328">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l230.329"></a><span id="l230.329">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l230.330"></a><span id="l230.330">     // Check: message successfully copied.</span>
<a href="#l230.331"></a><span id="l230.331" class="difflineminus">-    do_check_eq(aExitCode, Cr.NS_OK);</span>
<a href="#l230.332"></a><span id="l230.332" class="difflineminus">-    do_check_true(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.333"></a><span id="l230.333" class="difflineplus">+    Assert.equal(aExitCode, Cr.NS_OK);</span>
<a href="#l230.334"></a><span id="l230.334" class="difflineplus">+    Assert.ok(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.335"></a><span id="l230.335">     // Check that folder size is still above max limit ...</span>
<a href="#l230.336"></a><span id="l230.336">     let localInboxSize = gInbox.filePath.clone().fileSize;</span>
<a href="#l230.337"></a><span id="l230.337">     do_print(&quot;Local inbox size (after compact 1) = &quot; + localInboxSize);</span>
<a href="#l230.338"></a><span id="l230.338" class="difflineminus">-    do_check_true(localInboxSize &gt; kSizeLimit);</span>
<a href="#l230.339"></a><span id="l230.339" class="difflineplus">+    Assert.ok(localInboxSize &gt; kSizeLimit);</span>
<a href="#l230.340"></a><span id="l230.340">     // ... but it got smaller by removing 1 message.</span>
<a href="#l230.341"></a><span id="l230.341" class="difflineminus">-    do_check_true(gInboxSize &gt; localInboxSize);</span>
<a href="#l230.342"></a><span id="l230.342" class="difflineminus">-    do_check_eq(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.343"></a><span id="l230.343" class="difflineplus">+    Assert.ok(gInboxSize &gt; localInboxSize);</span>
<a href="#l230.344"></a><span id="l230.344" class="difflineplus">+    Assert.equal(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.345"></a><span id="l230.345"> </span>
<a href="#l230.346"></a><span id="l230.346">     compactUnder4GiB();</span>
<a href="#l230.347"></a><span id="l230.347">   }</span>
<a href="#l230.348"></a><span id="l230.348"> };</span>
<a href="#l230.349"></a><span id="l230.349"> </span>
<a href="#l230.350"></a><span id="l230.350"> var CompactListener_compactUnder4GiB =</span>
<a href="#l230.351"></a><span id="l230.351"> {</span>
<a href="#l230.352"></a><span id="l230.352">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l230.353"></a><span id="l230.353">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l230.354"></a><span id="l230.354">     // Check: message successfully copied.</span>
<a href="#l230.355"></a><span id="l230.355" class="difflineminus">-    do_check_eq(aExitCode, Cr.NS_OK);</span>
<a href="#l230.356"></a><span id="l230.356" class="difflineminus">-    do_check_true(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.357"></a><span id="l230.357" class="difflineplus">+    Assert.equal(aExitCode, Cr.NS_OK);</span>
<a href="#l230.358"></a><span id="l230.358" class="difflineplus">+    Assert.ok(gInbox.msgDatabase.summaryValid);</span>
<a href="#l230.359"></a><span id="l230.359"> </span>
<a href="#l230.360"></a><span id="l230.360">     // Check that folder size isn't much bigger than our sparse block size, ...</span>
<a href="#l230.361"></a><span id="l230.361">     let localInboxSize = gInbox.filePath.clone().fileSize;</span>
<a href="#l230.362"></a><span id="l230.362">     do_print(&quot;Local inbox size (after compact 2) = &quot; + localInboxSize);</span>
<a href="#l230.363"></a><span id="l230.363" class="difflineminus">-    do_check_eq(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.364"></a><span id="l230.364" class="difflineminus">-    do_check_true(localInboxSize &lt; kSparseBlockSize + 1000);</span>
<a href="#l230.365"></a><span id="l230.365" class="difflineplus">+    Assert.equal(gInbox.sizeOnDisk, localInboxSize);</span>
<a href="#l230.366"></a><span id="l230.366" class="difflineplus">+    Assert.ok(localInboxSize &lt; kSparseBlockSize + 1000);</span>
<a href="#l230.367"></a><span id="l230.367">     // ... i.e., that we just have one message.</span>
<a href="#l230.368"></a><span id="l230.368" class="difflineminus">-    do_check_eq(gInbox.getTotalMessages(false), 1);</span>
<a href="#l230.369"></a><span id="l230.369" class="difflineminus">-    do_check_eq(FListener.sizeHistory(0), gInbox.sizeOnDisk);</span>
<a href="#l230.370"></a><span id="l230.370" class="difflineminus">-    do_check_eq(FListener.msgsHistory(0), 1);</span>
<a href="#l230.371"></a><span id="l230.371" class="difflineplus">+    Assert.equal(gInbox.getTotalMessages(false), 1);</span>
<a href="#l230.372"></a><span id="l230.372" class="difflineplus">+    Assert.equal(FListener.sizeHistory(0), gInbox.sizeOnDisk);</span>
<a href="#l230.373"></a><span id="l230.373" class="difflineplus">+    Assert.equal(FListener.msgsHistory(0), 1);</span>
<a href="#l230.374"></a><span id="l230.374"> </span>
<a href="#l230.375"></a><span id="l230.375">     // The message has its key preserved in compact.</span>
<a href="#l230.376"></a><span id="l230.376" class="difflineminus">-    do_check_eq(gInbox.messages.getNext().QueryInterface(Ci.nsIMsgDBHdr).messageKey, 60);</span>
<a href="#l230.377"></a><span id="l230.377" class="difflineplus">+    Assert.equal(gInbox.messages.getNext().QueryInterface(Ci.nsIMsgDBHdr).messageKey, 60);</span>
<a href="#l230.378"></a><span id="l230.378"> </span>
<a href="#l230.379"></a><span id="l230.379">     endTest();</span>
<a href="#l230.380"></a><span id="l230.380">   }</span>
<a href="#l230.381"></a><span id="l230.381"> };</span>
<a href="#l230.382"></a><span id="l230.382"> </span>
<a href="#l230.383"></a><span id="l230.383"> function endTest()</span>
<a href="#l230.384"></a><span id="l230.384"> {</span>
<a href="#l230.385"></a><span id="l230.385">   MailServices.mailSession.RemoveFolderListener(FListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l231.1"></a><span id="l231.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3AuthMethods.js</span>
<a href="#l231.2"></a><span id="l231.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3AuthMethods.js</span>
<a href="#l231.3"></a><span id="l231.3" class="difflineat">@@ -60,19 +60,19 @@ var tests = [</span>
<a href="#l231.4"></a><span id="l231.4"> </span>
<a href="#l231.5"></a><span id="l231.5"> var urlListener =</span>
<a href="#l231.6"></a><span id="l231.6"> {</span>
<a href="#l231.7"></a><span id="l231.7">   OnStartRunningUrl: function (url) {</span>
<a href="#l231.8"></a><span id="l231.8">   },</span>
<a href="#l231.9"></a><span id="l231.9">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l231.10"></a><span id="l231.10">     try {</span>
<a href="#l231.11"></a><span id="l231.11">       if (thisTest.expectSuccess)</span>
<a href="#l231.12"></a><span id="l231.12" class="difflineminus">-        do_check_eq(result, 0);</span>
<a href="#l231.13"></a><span id="l231.13" class="difflineplus">+        Assert.equal(result, 0);</span>
<a href="#l231.14"></a><span id="l231.14">       else</span>
<a href="#l231.15"></a><span id="l231.15" class="difflineminus">-        do_check_neq(result, 0);</span>
<a href="#l231.16"></a><span id="l231.16" class="difflineplus">+        Assert.notEqual(result, 0);</span>
<a href="#l231.17"></a><span id="l231.17"> </span>
<a href="#l231.18"></a><span id="l231.18">       var transaction = server.playTransaction();</span>
<a href="#l231.19"></a><span id="l231.19">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l231.20"></a><span id="l231.20"> </span>
<a href="#l231.21"></a><span id="l231.21">       do_timeout(0, checkBusy);</span>
<a href="#l231.22"></a><span id="l231.22">     } catch (e) {</span>
<a href="#l231.23"></a><span id="l231.23">       server.stop();</span>
<a href="#l231.24"></a><span id="l231.24">       var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l232.1"></a><span id="l232.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Download.js</span>
<a href="#l232.2"></a><span id="l232.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Download.js</span>
<a href="#l232.3"></a><span id="l232.3" class="difflineat">@@ -34,19 +34,19 @@ function continueTest()</span>
<a href="#l232.4"></a><span id="l232.4">   // get message headers for the inbox folder</span>
<a href="#l232.5"></a><span id="l232.5">   let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l232.6"></a><span id="l232.6">   var msgCount = 0;</span>
<a href="#l232.7"></a><span id="l232.7">   let hdr;</span>
<a href="#l232.8"></a><span id="l232.8">   while (enumerator.hasMoreElements())</span>
<a href="#l232.9"></a><span id="l232.9">   {</span>
<a href="#l232.10"></a><span id="l232.10">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l232.11"></a><span id="l232.11">     gMsgHdrs.push(hdr);</span>
<a href="#l232.12"></a><span id="l232.12" class="difflineminus">-    do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l232.13"></a><span id="l232.13" class="difflineplus">+    Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l232.14"></a><span id="l232.14">   }</span>
<a href="#l232.15"></a><span id="l232.15" class="difflineminus">-  do_check_eq(msgCount, 3);</span>
<a href="#l232.16"></a><span id="l232.16" class="difflineplus">+  Assert.equal(msgCount, 3);</span>
<a href="#l232.17"></a><span id="l232.17">   gPOP3Pump = null;</span>
<a href="#l232.18"></a><span id="l232.18">   streamNextMessage();</span>
<a href="#l232.19"></a><span id="l232.19"> }</span>
<a href="#l232.20"></a><span id="l232.20"> </span>
<a href="#l232.21"></a><span id="l232.21"> function streamNextMessage()</span>
<a href="#l232.22"></a><span id="l232.22"> {</span>
<a href="#l232.23"></a><span id="l232.23">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l232.24"></a><span id="l232.24">   let msghdr = gMsgHdrs[gHdrIndex];</span>
<a href="#l232.25"></a><span id="l232.25" class="difflineat">@@ -60,17 +60,17 @@ gStreamListener = {</span>
<a href="#l232.26"></a><span id="l232.26">   _stream : null,</span>
<a href="#l232.27"></a><span id="l232.27">   _data : null,</span>
<a href="#l232.28"></a><span id="l232.28">   onStartRequest : function (aRequest, aContext) {</span>
<a href="#l232.29"></a><span id="l232.29">     this._stream = null;</span>
<a href="#l232.30"></a><span id="l232.30">     this._data = &quot;&quot;;</span>
<a href="#l232.31"></a><span id="l232.31">   },</span>
<a href="#l232.32"></a><span id="l232.32">   onStopRequest : function (aRequest, aContext, aStatusCode) {</span>
<a href="#l232.33"></a><span id="l232.33">     // check that the streamed message starts with &quot;From &quot;</span>
<a href="#l232.34"></a><span id="l232.34" class="difflineminus">-    do_check_true(this._data.startsWith(&quot;From &quot;));</span>
<a href="#l232.35"></a><span id="l232.35" class="difflineplus">+    Assert.ok(this._data.startsWith(&quot;From &quot;));</span>
<a href="#l232.36"></a><span id="l232.36">     if (++gHdrIndex == gFiles.length)</span>
<a href="#l232.37"></a><span id="l232.37">       do_test_finished();</span>
<a href="#l232.38"></a><span id="l232.38">     else</span>
<a href="#l232.39"></a><span id="l232.39">       streamNextMessage();</span>
<a href="#l232.40"></a><span id="l232.40">   },</span>
<a href="#l232.41"></a><span id="l232.41">   onDataAvailable : function (aRequest, aContext, aInputStream, aOff, aCount) {</span>
<a href="#l232.42"></a><span id="l232.42">     if (this._stream == null) {</span>
<a href="#l232.43"></a><span id="l232.43">       this._stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(Ci.nsIScriptableInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l233.1"></a><span id="l233.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</span>
<a href="#l233.2"></a><span id="l233.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</span>
<a href="#l233.3"></a><span id="l233.3" class="difflineat">@@ -23,27 +23,27 @@ function run_test()</span>
<a href="#l233.4"></a><span id="l233.4">   gPOP3Pump.run();</span>
<a href="#l233.5"></a><span id="l233.5"> }</span>
<a href="#l233.6"></a><span id="l233.6"> </span>
<a href="#l233.7"></a><span id="l233.7"> function continueTest()</span>
<a href="#l233.8"></a><span id="l233.8"> {</span>
<a href="#l233.9"></a><span id="l233.9">   dump(&quot;temp file path = &quot; + gExpectedFiles[0].path + &quot;\n&quot;);</span>
<a href="#l233.10"></a><span id="l233.10">   dump(&quot;temp file path = &quot; + gExpectedFiles[1].path + &quot;\n&quot;);</span>
<a href="#l233.11"></a><span id="l233.11">   for (let expectedFile of gExpectedFiles)</span>
<a href="#l233.12"></a><span id="l233.12" class="difflineminus">-    do_check_false(expectedFile.exists());</span>
<a href="#l233.13"></a><span id="l233.13" class="difflineplus">+    Assert.ok(!expectedFile.exists());</span>
<a href="#l233.14"></a><span id="l233.14"> </span>
<a href="#l233.15"></a><span id="l233.15">   // get message headers for the inbox folder</span>
<a href="#l233.16"></a><span id="l233.16">   let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l233.17"></a><span id="l233.17">   var msgCount = 0;</span>
<a href="#l233.18"></a><span id="l233.18">   while (enumerator.hasMoreElements())</span>
<a href="#l233.19"></a><span id="l233.19">   {</span>
<a href="#l233.20"></a><span id="l233.20">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l233.21"></a><span id="l233.21" class="difflineminus">-    do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l233.22"></a><span id="l233.22" class="difflineplus">+    Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l233.23"></a><span id="l233.23">   }</span>
<a href="#l233.24"></a><span id="l233.24" class="difflineminus">-  do_check_eq(msgCount, 2);</span>
<a href="#l233.25"></a><span id="l233.25" class="difflineplus">+  Assert.equal(msgCount, 2);</span>
<a href="#l233.26"></a><span id="l233.26">   gPOP3Pump = null;</span>
<a href="#l233.27"></a><span id="l233.27">   do_test_finished();</span>
<a href="#l233.28"></a><span id="l233.28"> }</span>
<a href="#l233.29"></a><span id="l233.29"> </span>
<a href="#l233.30"></a><span id="l233.30"> function createExpectedTemporaryFiles(numFiles) {</span>
<a href="#l233.31"></a><span id="l233.31">   function createTemporaryFile() {</span>
<a href="#l233.32"></a><span id="l233.32">     let file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l233.33"></a><span id="l233.33">     file.append(&quot;newmsg&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l234.1"></a><span id="l234.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Duplicates.js</span>
<a href="#l234.2"></a><span id="l234.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Duplicates.js</span>
<a href="#l234.3"></a><span id="l234.3" class="difflineat">@@ -25,14 +25,14 @@ function run_test()</span>
<a href="#l234.4"></a><span id="l234.4"> function continueTest()</span>
<a href="#l234.5"></a><span id="l234.5"> {</span>
<a href="#l234.6"></a><span id="l234.6">   // get message headers for the inbox folder</span>
<a href="#l234.7"></a><span id="l234.7">   let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l234.8"></a><span id="l234.8">   var msgCount = 0;</span>
<a href="#l234.9"></a><span id="l234.9">   while (enumerator.hasMoreElements())</span>
<a href="#l234.10"></a><span id="l234.10">   {</span>
<a href="#l234.11"></a><span id="l234.11">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l234.12"></a><span id="l234.12" class="difflineminus">-    do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l234.13"></a><span id="l234.13" class="difflineplus">+    Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l234.14"></a><span id="l234.14">   }</span>
<a href="#l234.15"></a><span id="l234.15" class="difflineminus">-  do_check_eq(msgCount, 2);</span>
<a href="#l234.16"></a><span id="l234.16" class="difflineplus">+  Assert.equal(msgCount, 2);</span>
<a href="#l234.17"></a><span id="l234.17">   gPOP3Pump = null;</span>
<a href="#l234.18"></a><span id="l234.18">   do_test_finished();</span>
<a href="#l234.19"></a><span id="l234.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l235.1"></a><span id="l235.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3FilterActions.js</span>
<a href="#l235.2"></a><span id="l235.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3FilterActions.js</span>
<a href="#l235.3"></a><span id="l235.3" class="difflineat">@@ -54,59 +54,59 @@ var gTestArray =</span>
<a href="#l235.4"></a><span id="l235.4">     gFilterList.insertFilterAt(0, gFilter);</span>
<a href="#l235.5"></a><span id="l235.5">   },</span>
<a href="#l235.6"></a><span id="l235.6">   // just get a message into the local folder</span>
<a href="#l235.7"></a><span id="l235.7">   function *getLocalMessages1() {</span>
<a href="#l235.8"></a><span id="l235.8">     gPOP3Pump.files = gFiles;</span>
<a href="#l235.9"></a><span id="l235.9">     yield gPOP3Pump.run();</span>
<a href="#l235.10"></a><span id="l235.10">   },</span>
<a href="#l235.11"></a><span id="l235.11">   function *verifyFolders2() {</span>
<a href="#l235.12"></a><span id="l235.12" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 2);</span>
<a href="#l235.13"></a><span id="l235.13" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 2);</span>
<a href="#l235.14"></a><span id="l235.14"> </span>
<a href="#l235.15"></a><span id="l235.15">     // invalidate the inbox summary file, to be sure that we wrote the keywords</span>
<a href="#l235.16"></a><span id="l235.16">     // into the mailbox.</span>
<a href="#l235.17"></a><span id="l235.17">     localAccountUtils.inboxFolder.msgDatabase.summaryValid = false;</span>
<a href="#l235.18"></a><span id="l235.18">     localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l235.19"></a><span id="l235.19">     localAccountUtils.inboxFolder.ForceDBClosed();</span>
<a href="#l235.20"></a><span id="l235.20">     let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l235.21"></a><span id="l235.21">     try {</span>
<a href="#l235.22"></a><span id="l235.22">       localAccountUtils.inboxFolder</span>
<a href="#l235.23"></a><span id="l235.23">                        .getDatabaseWithReparse(promiseUrlListener, null);</span>
<a href="#l235.24"></a><span id="l235.24">     } catch (ex) {</span>
<a href="#l235.25"></a><span id="l235.25">       yield promiseUrlListener.promise;</span>
<a href="#l235.26"></a><span id="l235.26" class="difflineminus">-      do_check_true(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l235.27"></a><span id="l235.27" class="difflineplus">+      Assert.ok(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l235.28"></a><span id="l235.28">       return;</span>
<a href="#l235.29"></a><span id="l235.29">     }</span>
<a href="#l235.30"></a><span id="l235.30"> </span>
<a href="#l235.31"></a><span id="l235.31">     // This statement is never reached.</span>
<a href="#l235.32"></a><span id="l235.32" class="difflineminus">-    do_check_true(false);</span>
<a href="#l235.33"></a><span id="l235.33" class="difflineplus">+    Assert.ok(false);</span>
<a href="#l235.34"></a><span id="l235.34">   },</span>
<a href="#l235.35"></a><span id="l235.35">   function verifyMessages() {</span>
<a href="#l235.36"></a><span id="l235.36">     let hdrs = [];</span>
<a href="#l235.37"></a><span id="l235.37">     let keys = [];</span>
<a href="#l235.38"></a><span id="l235.38">     let enumerator = localAccountUtils.inboxFolder.msgDatabase</span>
<a href="#l235.39"></a><span id="l235.39">                                                   .EnumerateMessages();</span>
<a href="#l235.40"></a><span id="l235.40">     while (enumerator.hasMoreElements()) {</span>
<a href="#l235.41"></a><span id="l235.41">       let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l235.42"></a><span id="l235.42">       keys.push(hdr.messageKey);</span>
<a href="#l235.43"></a><span id="l235.43">       hdrs.push(hdr);</span>
<a href="#l235.44"></a><span id="l235.44">     }</span>
<a href="#l235.45"></a><span id="l235.45" class="difflineminus">-    do_check_false(localAccountUtils.inboxFolder</span>
<a href="#l235.46"></a><span id="l235.46" class="difflineminus">-                                    .fetchMsgPreviewText(keys, keys.length,</span>
<a href="#l235.47"></a><span id="l235.47" class="difflineminus">-                                                         false, null));</span>
<a href="#l235.48"></a><span id="l235.48" class="difflineplus">+    Assert.ok(!localAccountUtils.inboxFolder</span>
<a href="#l235.49"></a><span id="l235.49" class="difflineplus">+                                .fetchMsgPreviewText(keys, keys.length,</span>
<a href="#l235.50"></a><span id="l235.50" class="difflineplus">+                                                     false, null));</span>
<a href="#l235.51"></a><span id="l235.51">     let preview1 = hdrs[0].getStringProperty('preview');</span>
<a href="#l235.52"></a><span id="l235.52">     let preview2 = hdrs[1].getStringProperty('preview');</span>
<a href="#l235.53"></a><span id="l235.53" class="difflineminus">-    do_check_eq(preview1, previews[hdrs[0].subject]);</span>
<a href="#l235.54"></a><span id="l235.54" class="difflineminus">-    do_check_eq(preview2, previews[hdrs[1].subject]);</span>
<a href="#l235.55"></a><span id="l235.55" class="difflineminus">-    do_check_eq(hdrs[0].getStringProperty('keywords'), &quot;TheTag&quot;);</span>
<a href="#l235.56"></a><span id="l235.56" class="difflineminus">-    do_check_eq(hdrs[1].getStringProperty('keywords'), &quot;TheTag&quot;);</span>
<a href="#l235.57"></a><span id="l235.57" class="difflineminus">-    do_check_eq(hdrs[0].flags, Ci.nsMsgMessageFlags.Read |</span>
<a href="#l235.58"></a><span id="l235.58" class="difflineminus">-                               Ci.nsMsgMessageFlags.Marked);</span>
<a href="#l235.59"></a><span id="l235.59" class="difflineminus">-    do_check_eq(hdrs[1].flags, Ci.nsMsgMessageFlags.Read |</span>
<a href="#l235.60"></a><span id="l235.60" class="difflineminus">-                               Ci.nsMsgMessageFlags.Marked);</span>
<a href="#l235.61"></a><span id="l235.61" class="difflineplus">+    Assert.equal(preview1, previews[hdrs[0].subject]);</span>
<a href="#l235.62"></a><span id="l235.62" class="difflineplus">+    Assert.equal(preview2, previews[hdrs[1].subject]);</span>
<a href="#l235.63"></a><span id="l235.63" class="difflineplus">+    Assert.equal(hdrs[0].getStringProperty('keywords'), &quot;TheTag&quot;);</span>
<a href="#l235.64"></a><span id="l235.64" class="difflineplus">+    Assert.equal(hdrs[1].getStringProperty('keywords'), &quot;TheTag&quot;);</span>
<a href="#l235.65"></a><span id="l235.65" class="difflineplus">+    Assert.equal(hdrs[0].flags, Ci.nsMsgMessageFlags.Read |</span>
<a href="#l235.66"></a><span id="l235.66" class="difflineplus">+                                Ci.nsMsgMessageFlags.Marked);</span>
<a href="#l235.67"></a><span id="l235.67" class="difflineplus">+    Assert.equal(hdrs[1].flags, Ci.nsMsgMessageFlags.Read |</span>
<a href="#l235.68"></a><span id="l235.68" class="difflineplus">+                                Ci.nsMsgMessageFlags.Marked);</span>
<a href="#l235.69"></a><span id="l235.69">   }</span>
<a href="#l235.70"></a><span id="l235.70"> ];</span>
<a href="#l235.71"></a><span id="l235.71"> </span>
<a href="#l235.72"></a><span id="l235.72"> function folderCount(folder)</span>
<a href="#l235.73"></a><span id="l235.73"> {</span>
<a href="#l235.74"></a><span id="l235.74">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l235.75"></a><span id="l235.75">   let count = 0;</span>
<a href="#l235.76"></a><span id="l235.76">   while (enumerator.hasMoreElements())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l236.1"></a><span id="l236.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GSSAPIFail.js</span>
<a href="#l236.2"></a><span id="l236.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GSSAPIFail.js</span>
<a href="#l236.3"></a><span id="l236.3" class="difflineat">@@ -58,19 +58,19 @@ var tests = [</span>
<a href="#l236.4"></a><span id="l236.4"> </span>
<a href="#l236.5"></a><span id="l236.5"> var urlListener =</span>
<a href="#l236.6"></a><span id="l236.6"> {</span>
<a href="#l236.7"></a><span id="l236.7">   OnStartRunningUrl: function (url) {</span>
<a href="#l236.8"></a><span id="l236.8">   },</span>
<a href="#l236.9"></a><span id="l236.9">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l236.10"></a><span id="l236.10">     try {</span>
<a href="#l236.11"></a><span id="l236.11">       if (thisTest.expectSuccess)</span>
<a href="#l236.12"></a><span id="l236.12" class="difflineminus">-        do_check_eq(result, 0);</span>
<a href="#l236.13"></a><span id="l236.13" class="difflineplus">+        Assert.equal(result, 0);</span>
<a href="#l236.14"></a><span id="l236.14">       else</span>
<a href="#l236.15"></a><span id="l236.15" class="difflineminus">-        do_check_neq(result, 0);</span>
<a href="#l236.16"></a><span id="l236.16" class="difflineplus">+        Assert.notEqual(result, 0);</span>
<a href="#l236.17"></a><span id="l236.17"> </span>
<a href="#l236.18"></a><span id="l236.18">       var transaction = server.playTransaction();</span>
<a href="#l236.19"></a><span id="l236.19">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l236.20"></a><span id="l236.20"> </span>
<a href="#l236.21"></a><span id="l236.21">       do_timeout(0, checkBusy);</span>
<a href="#l236.22"></a><span id="l236.22">     } catch (e) {</span>
<a href="#l236.23"></a><span id="l236.23">       server.stop();</span>
<a href="#l236.24"></a><span id="l236.24">       var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l237.1"></a><span id="l237.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l237.2"></a><span id="l237.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l237.3"></a><span id="l237.3" class="difflineat">@@ -26,20 +26,20 @@ var urlListener =</span>
<a href="#l237.4"></a><span id="l237.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l237.5"></a><span id="l237.5">   },</span>
<a href="#l237.6"></a><span id="l237.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l237.7"></a><span id="l237.7">     try {</span>
<a href="#l237.8"></a><span id="l237.8">       var transaction = server.playTransaction();</span>
<a href="#l237.9"></a><span id="l237.9"> </span>
<a href="#l237.10"></a><span id="l237.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l237.11"></a><span id="l237.11"> </span>
<a href="#l237.12"></a><span id="l237.12" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l237.13"></a><span id="l237.13" class="difflineminus">-                  thisTest.messages.length);</span>
<a href="#l237.14"></a><span id="l237.14" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l237.15"></a><span id="l237.15" class="difflineplus">+                   thisTest.messages.length);</span>
<a href="#l237.16"></a><span id="l237.16"> </span>
<a href="#l237.17"></a><span id="l237.17" class="difflineminus">-      do_check_eq(result, 0);</span>
<a href="#l237.18"></a><span id="l237.18" class="difflineplus">+      Assert.equal(result, 0);</span>
<a href="#l237.19"></a><span id="l237.19">     }</span>
<a href="#l237.20"></a><span id="l237.20">     catch (e) {</span>
<a href="#l237.21"></a><span id="l237.21">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l237.22"></a><span id="l237.22">       server.stop();</span>
<a href="#l237.23"></a><span id="l237.23"> </span>
<a href="#l237.24"></a><span id="l237.24">       var thread = gThreadManager.currentThread;</span>
<a href="#l237.25"></a><span id="l237.25">       while (thread.hasPendingEvents())</span>
<a href="#l237.26"></a><span id="l237.26">         thread.processNextEvent(true);</span>
<a href="#l237.27"></a><span id="l237.27" class="difflineat">@@ -118,14 +118,14 @@ function run_test() {</span>
<a href="#l237.28"></a><span id="l237.28">   server = server[1];</span>
<a href="#l237.29"></a><span id="l237.29">   server.start();</span>
<a href="#l237.30"></a><span id="l237.30"> </span>
<a href="#l237.31"></a><span id="l237.31">   // Set up the basic accounts and folders</span>
<a href="#l237.32"></a><span id="l237.32">   incomingServer = createPop3ServerAndLocalFolders(server.port);</span>
<a href="#l237.33"></a><span id="l237.33"> </span>
<a href="#l237.34"></a><span id="l237.34">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l237.35"></a><span id="l237.35">   // setup issue.</span>
<a href="#l237.36"></a><span id="l237.36" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l237.37"></a><span id="l237.37" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l237.38"></a><span id="l237.38"> </span>
<a href="#l237.39"></a><span id="l237.39">   do_test_pending();</span>
<a href="#l237.40"></a><span id="l237.40"> </span>
<a href="#l237.41"></a><span id="l237.41">   testNext();</span>
<a href="#l237.42"></a><span id="l237.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l238.1"></a><span id="l238.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MoveFilter.js</span>
<a href="#l238.2"></a><span id="l238.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MoveFilter.js</span>
<a href="#l238.3"></a><span id="l238.3" class="difflineat">@@ -49,51 +49,51 @@ var gTestArray =</span>
<a href="#l238.4"></a><span id="l238.4">     gFilterList.insertFilterAt(0, gFilter);</span>
<a href="#l238.5"></a><span id="l238.5">   },</span>
<a href="#l238.6"></a><span id="l238.6">   // just get a message into the local folder</span>
<a href="#l238.7"></a><span id="l238.7">   function *getLocalMessages1() {</span>
<a href="#l238.8"></a><span id="l238.8">     gPOP3Pump.files = gFiles;</span>
<a href="#l238.9"></a><span id="l238.9">     yield gPOP3Pump.run();</span>
<a href="#l238.10"></a><span id="l238.10">   },</span>
<a href="#l238.11"></a><span id="l238.11">   function *verifyFolders2() {</span>
<a href="#l238.12"></a><span id="l238.12" class="difflineminus">-    do_check_eq(folderCount(gMoveFolder), 2);</span>
<a href="#l238.13"></a><span id="l238.13" class="difflineplus">+    Assert.equal(folderCount(gMoveFolder), 2);</span>
<a href="#l238.14"></a><span id="l238.14">     // the local inbox folder should now be empty, since we moved incoming mail.</span>
<a href="#l238.15"></a><span id="l238.15" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l238.16"></a><span id="l238.16" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l238.17"></a><span id="l238.17"> </span>
<a href="#l238.18"></a><span id="l238.18">     // invalidate the inbox summary file, to be sure that we really moved</span>
<a href="#l238.19"></a><span id="l238.19">     // the mail.</span>
<a href="#l238.20"></a><span id="l238.20">     localAccountUtils.inboxFolder.msgDatabase.summaryValid = false;</span>
<a href="#l238.21"></a><span id="l238.21">     localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l238.22"></a><span id="l238.22">     localAccountUtils.inboxFolder.ForceDBClosed();</span>
<a href="#l238.23"></a><span id="l238.23">     let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l238.24"></a><span id="l238.24">     try {</span>
<a href="#l238.25"></a><span id="l238.25">       localAccountUtils.inboxFolder</span>
<a href="#l238.26"></a><span id="l238.26">                        .getDatabaseWithReparse(promiseUrlListener, null);</span>
<a href="#l238.27"></a><span id="l238.27">     } catch(ex) {</span>
<a href="#l238.28"></a><span id="l238.28">       yield promiseUrlListener.promise;</span>
<a href="#l238.29"></a><span id="l238.29" class="difflineminus">-      do_check_true(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l238.30"></a><span id="l238.30" class="difflineplus">+      Assert.ok(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l238.31"></a><span id="l238.31">       return;</span>
<a href="#l238.32"></a><span id="l238.32">     }</span>
<a href="#l238.33"></a><span id="l238.33">     // This statement isn't reached since the error is thrown.</span>
<a href="#l238.34"></a><span id="l238.34" class="difflineminus">-    do_check_true(false);</span>
<a href="#l238.35"></a><span id="l238.35" class="difflineplus">+    Assert.ok(false);</span>
<a href="#l238.36"></a><span id="l238.36">   },</span>
<a href="#l238.37"></a><span id="l238.37">   function verifyMessages() {</span>
<a href="#l238.38"></a><span id="l238.38">     let hdrs = [];</span>
<a href="#l238.39"></a><span id="l238.39">     let keys = [];</span>
<a href="#l238.40"></a><span id="l238.40">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l238.41"></a><span id="l238.41">     while (enumerator.hasMoreElements())</span>
<a href="#l238.42"></a><span id="l238.42">     {</span>
<a href="#l238.43"></a><span id="l238.43">       let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l238.44"></a><span id="l238.44">       keys.push(hdr.messageKey);</span>
<a href="#l238.45"></a><span id="l238.45">       hdrs.push(hdr);</span>
<a href="#l238.46"></a><span id="l238.46">     }</span>
<a href="#l238.47"></a><span id="l238.47" class="difflineminus">-    do_check_false(gMoveFolder.fetchMsgPreviewText(keys, keys.length, false,</span>
<a href="#l238.48"></a><span id="l238.48" class="difflineminus">-                                                   null));</span>
<a href="#l238.49"></a><span id="l238.49" class="difflineminus">-    do_check_eq(hdrs[0].getStringProperty('preview'), previews[hdrs[0].subject]);</span>
<a href="#l238.50"></a><span id="l238.50" class="difflineminus">-    do_check_eq(hdrs[1].getStringProperty('preview'), previews[hdrs[1].subject]);</span>
<a href="#l238.51"></a><span id="l238.51" class="difflineplus">+    Assert.ok(!gMoveFolder.fetchMsgPreviewText(keys, keys.length, false,</span>
<a href="#l238.52"></a><span id="l238.52" class="difflineplus">+                                               null));</span>
<a href="#l238.53"></a><span id="l238.53" class="difflineplus">+    Assert.equal(hdrs[0].getStringProperty('preview'), previews[hdrs[0].subject]);</span>
<a href="#l238.54"></a><span id="l238.54" class="difflineplus">+    Assert.equal(hdrs[1].getStringProperty('preview'), previews[hdrs[1].subject]);</span>
<a href="#l238.55"></a><span id="l238.55">   },</span>
<a href="#l238.56"></a><span id="l238.56"> ];</span>
<a href="#l238.57"></a><span id="l238.57"> </span>
<a href="#l238.58"></a><span id="l238.58"> function folderCount(folder)</span>
<a href="#l238.59"></a><span id="l238.59"> {</span>
<a href="#l238.60"></a><span id="l238.60">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l238.61"></a><span id="l238.61">   let count = 0;</span>
<a href="#l238.62"></a><span id="l238.62">   while (enumerator.hasMoreElements())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l239.1"></a><span id="l239.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MoveFilter2.js</span>
<a href="#l239.2"></a><span id="l239.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MoveFilter2.js</span>
<a href="#l239.3"></a><span id="l239.3" class="difflineat">@@ -48,42 +48,42 @@ var gTestArray =</span>
<a href="#l239.4"></a><span id="l239.4">     gFilterList.insertFilterAt(0, gFilter);</span>
<a href="#l239.5"></a><span id="l239.5">   },</span>
<a href="#l239.6"></a><span id="l239.6">   // just get a message into the local folder</span>
<a href="#l239.7"></a><span id="l239.7">   function *getLocalMessages1() {</span>
<a href="#l239.8"></a><span id="l239.8">     gPOP3Pump.files = gFiles;</span>
<a href="#l239.9"></a><span id="l239.9">     yield gPOP3Pump.run();</span>
<a href="#l239.10"></a><span id="l239.10">   },</span>
<a href="#l239.11"></a><span id="l239.11">   function verifyFolders2() {</span>
<a href="#l239.12"></a><span id="l239.12" class="difflineminus">-    do_check_eq(folderCount(gMoveFolder), 1);</span>
<a href="#l239.13"></a><span id="l239.13" class="difflineplus">+    Assert.equal(folderCount(gMoveFolder), 1);</span>
<a href="#l239.14"></a><span id="l239.14">     // the local inbox folder should have one message.</span>
<a href="#l239.15"></a><span id="l239.15" class="difflineminus">-    do_check_eq(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l239.16"></a><span id="l239.16" class="difflineplus">+    Assert.equal(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l239.17"></a><span id="l239.17">   },</span>
<a href="#l239.18"></a><span id="l239.18">   function verifyMessages() {</span>
<a href="#l239.19"></a><span id="l239.19">     // check MoveFolder message</span>
<a href="#l239.20"></a><span id="l239.20">     let hdrs = [];</span>
<a href="#l239.21"></a><span id="l239.21">     let keys = [];</span>
<a href="#l239.22"></a><span id="l239.22">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l239.23"></a><span id="l239.23">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l239.24"></a><span id="l239.24">     keys.push(hdr.messageKey);</span>
<a href="#l239.25"></a><span id="l239.25">     hdrs.push(hdr);</span>
<a href="#l239.26"></a><span id="l239.26" class="difflineminus">-    do_check_false(gMoveFolder.fetchMsgPreviewText(keys, keys.length,</span>
<a href="#l239.27"></a><span id="l239.27" class="difflineminus">-                                                   false, null));</span>
<a href="#l239.28"></a><span id="l239.28" class="difflineminus">-    do_check_eq(hdrs[0].getStringProperty('preview'), bugmail10_preview);</span>
<a href="#l239.29"></a><span id="l239.29" class="difflineplus">+    Assert.ok(!gMoveFolder.fetchMsgPreviewText(keys, keys.length,</span>
<a href="#l239.30"></a><span id="l239.30" class="difflineplus">+                                               false, null));</span>
<a href="#l239.31"></a><span id="l239.31" class="difflineplus">+    Assert.equal(hdrs[0].getStringProperty('preview'), bugmail10_preview);</span>
<a href="#l239.32"></a><span id="l239.32">     // check inbox message</span>
<a href="#l239.33"></a><span id="l239.33">     hdrs = [];</span>
<a href="#l239.34"></a><span id="l239.34">     keys = [];</span>
<a href="#l239.35"></a><span id="l239.35">     enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l239.36"></a><span id="l239.36">     hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l239.37"></a><span id="l239.37">     keys.push(hdr.messageKey);</span>
<a href="#l239.38"></a><span id="l239.38">     hdrs.push(hdr);</span>
<a href="#l239.39"></a><span id="l239.39" class="difflineminus">-    do_check_false(localAccountUtils.inboxFolder</span>
<a href="#l239.40"></a><span id="l239.40" class="difflineminus">-                                    .fetchMsgPreviewText(keys, keys.length,</span>
<a href="#l239.41"></a><span id="l239.41" class="difflineminus">-                                                         false, null));</span>
<a href="#l239.42"></a><span id="l239.42" class="difflineminus">-    do_check_eq(hdrs[0].getStringProperty('preview'), basic1_preview);</span>
<a href="#l239.43"></a><span id="l239.43" class="difflineplus">+    Assert.ok(!localAccountUtils.inboxFolder</span>
<a href="#l239.44"></a><span id="l239.44" class="difflineplus">+                                .fetchMsgPreviewText(keys, keys.length,</span>
<a href="#l239.45"></a><span id="l239.45" class="difflineplus">+                                                     false, null));</span>
<a href="#l239.46"></a><span id="l239.46" class="difflineplus">+    Assert.equal(hdrs[0].getStringProperty('preview'), basic1_preview);</span>
<a href="#l239.47"></a><span id="l239.47">   }</span>
<a href="#l239.48"></a><span id="l239.48"> ];</span>
<a href="#l239.49"></a><span id="l239.49"> </span>
<a href="#l239.50"></a><span id="l239.50"> function folderCount(folder)</span>
<a href="#l239.51"></a><span id="l239.51"> {</span>
<a href="#l239.52"></a><span id="l239.52">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l239.53"></a><span id="l239.53">   let count = 0;</span>
<a href="#l239.54"></a><span id="l239.54">   while (enumerator.hasMoreElements())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l240.1"></a><span id="l240.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MultiCopy.js</span>
<a href="#l240.2"></a><span id="l240.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MultiCopy.js</span>
<a href="#l240.3"></a><span id="l240.3" class="difflineat">@@ -37,19 +37,19 @@ add_task(function* runPump() {</span>
<a href="#l240.4"></a><span id="l240.4">   // Accumulate messages to copy.</span>
<a href="#l240.5"></a><span id="l240.5">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l240.6"></a><span id="l240.6">   let enumerator = inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l240.7"></a><span id="l240.7">   let msgCount = 0;</span>
<a href="#l240.8"></a><span id="l240.8">   while (enumerator.hasMoreElements()) {</span>
<a href="#l240.9"></a><span id="l240.9">     msgCount++;</span>
<a href="#l240.10"></a><span id="l240.10">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l240.11"></a><span id="l240.11">     messages.appendElement(hdr);</span>
<a href="#l240.12"></a><span id="l240.12" class="difflineminus">-    do_check_eq(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l240.13"></a><span id="l240.13" class="difflineplus">+    Assert.equal(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l240.14"></a><span id="l240.14">   }</span>
<a href="#l240.15"></a><span id="l240.15" class="difflineminus">-  do_check_eq(messages.length, 2);</span>
<a href="#l240.16"></a><span id="l240.16" class="difflineplus">+  Assert.equal(messages.length, 2);</span>
<a href="#l240.17"></a><span id="l240.17"> </span>
<a href="#l240.18"></a><span id="l240.18">   // Create a test folder on the Local Folders account.</span>
<a href="#l240.19"></a><span id="l240.19">   let testFolder = localAccountUtils.rootFolder</span>
<a href="#l240.20"></a><span id="l240.20">                                     .QueryInterface(Ci.nsIMsgLocalMailFolder)</span>
<a href="#l240.21"></a><span id="l240.21">                                     .createLocalSubfolder(&quot;test&quot;);</span>
<a href="#l240.22"></a><span id="l240.22">   dump(&quot;testFolder is at &quot; + testFolder.filePath.path + &quot;\n&quot;);</span>
<a href="#l240.23"></a><span id="l240.23"> </span>
<a href="#l240.24"></a><span id="l240.24">   // Copy messages to that folder.</span>
<a href="#l240.25"></a><span id="l240.25" class="difflineat">@@ -65,30 +65,30 @@ add_task(function* runPump() {</span>
<a href="#l240.26"></a><span id="l240.26">   let subjects = [];</span>
<a href="#l240.27"></a><span id="l240.27">   while (enumerator.hasMoreElements()) {</span>
<a href="#l240.28"></a><span id="l240.28">     msgCount++;</span>
<a href="#l240.29"></a><span id="l240.29">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l240.30"></a><span id="l240.30">     messages.appendElement(hdr);</span>
<a href="#l240.31"></a><span id="l240.31">     dump(&quot;Subject: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l240.32"></a><span id="l240.32">     subjects.push(hdr.subject);</span>
<a href="#l240.33"></a><span id="l240.33">   }</span>
<a href="#l240.34"></a><span id="l240.34" class="difflineminus">-  do_check_eq(messages.length, 2);</span>
<a href="#l240.35"></a><span id="l240.35" class="difflineplus">+  Assert.equal(messages.length, 2);</span>
<a href="#l240.36"></a><span id="l240.36"> </span>
<a href="#l240.37"></a><span id="l240.37">   // Check for subjects. maildir order for messages may not match</span>
<a href="#l240.38"></a><span id="l240.38">   // order for creation, hence the array.includes.</span>
<a href="#l240.39"></a><span id="l240.39">   for (let subject of testSubjects) {</span>
<a href="#l240.40"></a><span id="l240.40" class="difflineminus">-    do_check_true(subjects.includes(subject));</span>
<a href="#l240.41"></a><span id="l240.41" class="difflineplus">+    Assert.ok(subjects.includes(subject));</span>
<a href="#l240.42"></a><span id="l240.42">   }</span>
<a href="#l240.43"></a><span id="l240.43"> </span>
<a href="#l240.44"></a><span id="l240.44">   // Make sure the body matches the message.</span>
<a href="#l240.45"></a><span id="l240.45">   enumerator = testFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l240.46"></a><span id="l240.46">   while (enumerator.hasMoreElements()) {</span>
<a href="#l240.47"></a><span id="l240.47">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l240.48"></a><span id="l240.48">     let body = mailTestUtils.loadMessageToString(testFolder, hdr);</span>
<a href="#l240.49"></a><span id="l240.49" class="difflineminus">-    do_check_true(body.indexOf(hdr.subject) &gt;= 0);</span>
<a href="#l240.50"></a><span id="l240.50" class="difflineplus">+    Assert.ok(body.indexOf(hdr.subject) &gt;= 0);</span>
<a href="#l240.51"></a><span id="l240.51">   }</span>
<a href="#l240.52"></a><span id="l240.52"> </span>
<a href="#l240.53"></a><span id="l240.53">   gPOP3Pump = null;</span>
<a href="#l240.54"></a><span id="l240.54"> });</span>
<a href="#l240.55"></a><span id="l240.55"> </span>
<a href="#l240.56"></a><span id="l240.56"> function run_test() {</span>
<a href="#l240.57"></a><span id="l240.57">   run_next_test();</span>
<a href="#l240.58"></a><span id="l240.58"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l241.1"></a><span id="l241.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MultiCopy2.js</span>
<a href="#l241.2"></a><span id="l241.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MultiCopy2.js</span>
<a href="#l241.3"></a><span id="l241.3" class="difflineat">@@ -45,17 +45,17 @@ add_task(function* maildirToMbox() {</span>
<a href="#l241.4"></a><span id="l241.4"> </span>
<a href="#l241.5"></a><span id="l241.5">   // Accumulate messages to copy.</span>
<a href="#l241.6"></a><span id="l241.6">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l241.7"></a><span id="l241.7">   let enumerator = gInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l241.8"></a><span id="l241.8">   while (enumerator.hasMoreElements()) {</span>
<a href="#l241.9"></a><span id="l241.9">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l241.10"></a><span id="l241.10">     messages.appendElement(hdr);</span>
<a href="#l241.11"></a><span id="l241.11">   }</span>
<a href="#l241.12"></a><span id="l241.12" class="difflineminus">-  do_check_eq(messages.length, 2);</span>
<a href="#l241.13"></a><span id="l241.13" class="difflineplus">+  Assert.equal(messages.length, 2);</span>
<a href="#l241.14"></a><span id="l241.14"> </span>
<a href="#l241.15"></a><span id="l241.15">   // Move messages to mbox test folder.</span>
<a href="#l241.16"></a><span id="l241.16">   let promiseCopyListener = new PromiseTestUtils.PromiseCopyListener();</span>
<a href="#l241.17"></a><span id="l241.17">   MailServices.copy.CopyMessages(gInboxFolder, messages, gTestFolder, true,</span>
<a href="#l241.18"></a><span id="l241.18">                                  promiseCopyListener, null, false);</span>
<a href="#l241.19"></a><span id="l241.19">   yield promiseCopyListener.promise;</span>
<a href="#l241.20"></a><span id="l241.20"> </span>
<a href="#l241.21"></a><span id="l241.21">   // Check the destination headers.</span>
<a href="#l241.22"></a><span id="l241.22" class="difflineat">@@ -63,47 +63,47 @@ add_task(function* maildirToMbox() {</span>
<a href="#l241.23"></a><span id="l241.23">   enumerator = gTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l241.24"></a><span id="l241.24">   let subjects = [];</span>
<a href="#l241.25"></a><span id="l241.25">   while (enumerator.hasMoreElements()) {</span>
<a href="#l241.26"></a><span id="l241.26">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l241.27"></a><span id="l241.27">     messages.appendElement(hdr);</span>
<a href="#l241.28"></a><span id="l241.28">     dump(&quot;Subject: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l241.29"></a><span id="l241.29">     subjects.push(hdr.subject);</span>
<a href="#l241.30"></a><span id="l241.30">   }</span>
<a href="#l241.31"></a><span id="l241.31" class="difflineminus">-  do_check_eq(messages.length, 2);</span>
<a href="#l241.32"></a><span id="l241.32" class="difflineplus">+  Assert.equal(messages.length, 2);</span>
<a href="#l241.33"></a><span id="l241.33"> </span>
<a href="#l241.34"></a><span id="l241.34">   // messages should be missing from source</span>
<a href="#l241.35"></a><span id="l241.35" class="difflineminus">-  do_check_eq(gInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l241.36"></a><span id="l241.36" class="difflineplus">+  Assert.equal(gInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l241.37"></a><span id="l241.37"> </span>
<a href="#l241.38"></a><span id="l241.38">   // Check for subjects. maildir order for messages may not match</span>
<a href="#l241.39"></a><span id="l241.39">   // order for creation, hence the array.includes.</span>
<a href="#l241.40"></a><span id="l241.40">   for (let subject of gTestSubjects) {</span>
<a href="#l241.41"></a><span id="l241.41" class="difflineminus">-    do_check_true(subjects.includes(subject));</span>
<a href="#l241.42"></a><span id="l241.42" class="difflineplus">+    Assert.ok(subjects.includes(subject));</span>
<a href="#l241.43"></a><span id="l241.43">   }</span>
<a href="#l241.44"></a><span id="l241.44"> </span>
<a href="#l241.45"></a><span id="l241.45">   // Make sure the body matches the message.</span>
<a href="#l241.46"></a><span id="l241.46">   enumerator = gTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l241.47"></a><span id="l241.47">   while (enumerator.hasMoreElements()) {</span>
<a href="#l241.48"></a><span id="l241.48">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l241.49"></a><span id="l241.49">     let body = mailTestUtils.loadMessageToString(gTestFolder, hdr);</span>
<a href="#l241.50"></a><span id="l241.50" class="difflineminus">-    do_check_true(body.indexOf(hdr.subject) &gt;= 0);</span>
<a href="#l241.51"></a><span id="l241.51" class="difflineplus">+    Assert.ok(body.indexOf(hdr.subject) &gt;= 0);</span>
<a href="#l241.52"></a><span id="l241.52">   }</span>
<a href="#l241.53"></a><span id="l241.53"> });</span>
<a href="#l241.54"></a><span id="l241.54"> </span>
<a href="#l241.55"></a><span id="l241.55"> add_task(function* mboxToMaildir() {</span>
<a href="#l241.56"></a><span id="l241.56">   // Test for multiple message copy for mbox-&gt;maildir.</span>
<a href="#l241.57"></a><span id="l241.57"> </span>
<a href="#l241.58"></a><span id="l241.58">   // Accumulate messages to copy.</span>
<a href="#l241.59"></a><span id="l241.59">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l241.60"></a><span id="l241.60">   let enumerator = gTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l241.61"></a><span id="l241.61">   while (enumerator.hasMoreElements()) {</span>
<a href="#l241.62"></a><span id="l241.62">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l241.63"></a><span id="l241.63">     messages.appendElement(hdr);</span>
<a href="#l241.64"></a><span id="l241.64">   }</span>
<a href="#l241.65"></a><span id="l241.65" class="difflineminus">-  do_check_eq(messages.length, 2);</span>
<a href="#l241.66"></a><span id="l241.66" class="difflineplus">+  Assert.equal(messages.length, 2);</span>
<a href="#l241.67"></a><span id="l241.67"> </span>
<a href="#l241.68"></a><span id="l241.68">   // Move messages to inbox folder.</span>
<a href="#l241.69"></a><span id="l241.69">   let promiseCopyListener = new PromiseTestUtils.PromiseCopyListener();</span>
<a href="#l241.70"></a><span id="l241.70">   MailServices.copy.CopyMessages(gTestFolder, messages, gInboxFolder, true,</span>
<a href="#l241.71"></a><span id="l241.71">                                  promiseCopyListener, null, false);</span>
<a href="#l241.72"></a><span id="l241.72">   yield promiseCopyListener.promise;</span>
<a href="#l241.73"></a><span id="l241.73"> </span>
<a href="#l241.74"></a><span id="l241.74">   // Check the destination headers.</span>
<a href="#l241.75"></a><span id="l241.75" class="difflineat">@@ -111,33 +111,33 @@ add_task(function* mboxToMaildir() {</span>
<a href="#l241.76"></a><span id="l241.76">   enumerator = gInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l241.77"></a><span id="l241.77">   let subjects = [];</span>
<a href="#l241.78"></a><span id="l241.78">   while (enumerator.hasMoreElements()) {</span>
<a href="#l241.79"></a><span id="l241.79">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l241.80"></a><span id="l241.80">     messages.appendElement(hdr);</span>
<a href="#l241.81"></a><span id="l241.81">     dump(&quot;Subject: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l241.82"></a><span id="l241.82">     subjects.push(hdr.subject);</span>
<a href="#l241.83"></a><span id="l241.83">   }</span>
<a href="#l241.84"></a><span id="l241.84" class="difflineminus">-  do_check_eq(messages.length, 2);</span>
<a href="#l241.85"></a><span id="l241.85" class="difflineplus">+  Assert.equal(messages.length, 2);</span>
<a href="#l241.86"></a><span id="l241.86"> </span>
<a href="#l241.87"></a><span id="l241.87">   // messages should be missing from source</span>
<a href="#l241.88"></a><span id="l241.88" class="difflineminus">-  do_check_eq(gTestFolder.getTotalMessages(false), 0);</span>
<a href="#l241.89"></a><span id="l241.89" class="difflineplus">+  Assert.equal(gTestFolder.getTotalMessages(false), 0);</span>
<a href="#l241.90"></a><span id="l241.90"> </span>
<a href="#l241.91"></a><span id="l241.91">   // Check for subjects. maildir order for messages may not match</span>
<a href="#l241.92"></a><span id="l241.92">   // order for creation, hence the array.includes.</span>
<a href="#l241.93"></a><span id="l241.93">   for (let subject of gTestSubjects) {</span>
<a href="#l241.94"></a><span id="l241.94" class="difflineminus">-    do_check_true(subjects.includes(subject));</span>
<a href="#l241.95"></a><span id="l241.95" class="difflineplus">+    Assert.ok(subjects.includes(subject));</span>
<a href="#l241.96"></a><span id="l241.96">   }</span>
<a href="#l241.97"></a><span id="l241.97"> </span>
<a href="#l241.98"></a><span id="l241.98">   // Make sure the body matches the message.</span>
<a href="#l241.99"></a><span id="l241.99">   enumerator = gInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l241.100"></a><span id="l241.100">   while (enumerator.hasMoreElements()) {</span>
<a href="#l241.101"></a><span id="l241.101">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l241.102"></a><span id="l241.102">     let body = mailTestUtils.loadMessageToString(gInboxFolder, hdr);</span>
<a href="#l241.103"></a><span id="l241.103" class="difflineminus">-    do_check_true(body.indexOf(hdr.subject) &gt;= 0);</span>
<a href="#l241.104"></a><span id="l241.104" class="difflineplus">+    Assert.ok(body.indexOf(hdr.subject) &gt;= 0);</span>
<a href="#l241.105"></a><span id="l241.105">   }</span>
<a href="#l241.106"></a><span id="l241.106"> });</span>
<a href="#l241.107"></a><span id="l241.107"> </span>
<a href="#l241.108"></a><span id="l241.108"> add_task(function testCleanup() {</span>
<a href="#l241.109"></a><span id="l241.109">   gPOP3Pump = null;</span>
<a href="#l241.110"></a><span id="l241.110"> });</span>
<a href="#l241.111"></a><span id="l241.111"> </span>
<a href="#l241.112"></a><span id="l241.112"> function run_test() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l242.1"></a><span id="l242.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l242.2"></a><span id="l242.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l242.3"></a><span id="l242.3" class="difflineat">@@ -25,20 +25,20 @@ var urlListener =</span>
<a href="#l242.4"></a><span id="l242.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l242.5"></a><span id="l242.5">   },</span>
<a href="#l242.6"></a><span id="l242.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l242.7"></a><span id="l242.7">     try {</span>
<a href="#l242.8"></a><span id="l242.8">       var transaction = server.playTransaction();</span>
<a href="#l242.9"></a><span id="l242.9"> </span>
<a href="#l242.10"></a><span id="l242.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l242.11"></a><span id="l242.11"> </span>
<a href="#l242.12"></a><span id="l242.12" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l242.13"></a><span id="l242.13" class="difflineminus">-                  thisTest.messages.length);</span>
<a href="#l242.14"></a><span id="l242.14" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l242.15"></a><span id="l242.15" class="difflineplus">+                   thisTest.messages.length);</span>
<a href="#l242.16"></a><span id="l242.16"> </span>
<a href="#l242.17"></a><span id="l242.17" class="difflineminus">-      do_check_eq(result, 0);</span>
<a href="#l242.18"></a><span id="l242.18" class="difflineplus">+      Assert.equal(result, 0);</span>
<a href="#l242.19"></a><span id="l242.19">     }</span>
<a href="#l242.20"></a><span id="l242.20">     catch (e) {</span>
<a href="#l242.21"></a><span id="l242.21">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l242.22"></a><span id="l242.22">       server.stop();</span>
<a href="#l242.23"></a><span id="l242.23"> </span>
<a href="#l242.24"></a><span id="l242.24">       var thread = gThreadManager.currentThread;</span>
<a href="#l242.25"></a><span id="l242.25">       while (thread.hasPendingEvents())</span>
<a href="#l242.26"></a><span id="l242.26">         thread.processNextEvent(true);</span>
<a href="#l242.27"></a><span id="l242.27" class="difflineat">@@ -133,17 +133,17 @@ add_task(function *() {</span>
<a href="#l242.28"></a><span id="l242.28">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l242.29"></a><span id="l242.29"> </span>
<a href="#l242.30"></a><span id="l242.30">   incomingServer = MailServices.accounts.createIncomingServer(&quot;testpop3&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l242.31"></a><span id="l242.31"> </span>
<a href="#l242.32"></a><span id="l242.32">   incomingServer.port = server.port;</span>
<a href="#l242.33"></a><span id="l242.33"> </span>
<a href="#l242.34"></a><span id="l242.34">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l242.35"></a><span id="l242.35">   // setup issue.</span>
<a href="#l242.36"></a><span id="l242.36" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l242.37"></a><span id="l242.37" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l242.38"></a><span id="l242.38"> </span>
<a href="#l242.39"></a><span id="l242.39">   do_test_pending();</span>
<a href="#l242.40"></a><span id="l242.40"> </span>
<a href="#l242.41"></a><span id="l242.41">   testNext();</span>
<a href="#l242.42"></a><span id="l242.42"> });</span>
<a href="#l242.43"></a><span id="l242.43"> </span>
<a href="#l242.44"></a><span id="l242.44"> function run_test() {</span>
<a href="#l242.45"></a><span id="l242.45">   run_next_test();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l243.1"></a><span id="l243.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l243.2"></a><span id="l243.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l243.3"></a><span id="l243.3" class="difflineat">@@ -27,20 +27,20 @@ var urlListener =</span>
<a href="#l243.4"></a><span id="l243.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l243.5"></a><span id="l243.5">   },</span>
<a href="#l243.6"></a><span id="l243.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l243.7"></a><span id="l243.7">     try {</span>
<a href="#l243.8"></a><span id="l243.8">       var transaction = server.playTransaction();</span>
<a href="#l243.9"></a><span id="l243.9"> </span>
<a href="#l243.10"></a><span id="l243.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l243.11"></a><span id="l243.11"> </span>
<a href="#l243.12"></a><span id="l243.12" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l243.13"></a><span id="l243.13" class="difflineminus">-                  thisTest.messages.length);</span>
<a href="#l243.14"></a><span id="l243.14" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l243.15"></a><span id="l243.15" class="difflineplus">+                   thisTest.messages.length);</span>
<a href="#l243.16"></a><span id="l243.16"> </span>
<a href="#l243.17"></a><span id="l243.17" class="difflineminus">-      do_check_eq(result, 0);</span>
<a href="#l243.18"></a><span id="l243.18" class="difflineplus">+      Assert.equal(result, 0);</span>
<a href="#l243.19"></a><span id="l243.19">     }</span>
<a href="#l243.20"></a><span id="l243.20">     catch (e) {</span>
<a href="#l243.21"></a><span id="l243.21">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l243.22"></a><span id="l243.22">       server.stop();</span>
<a href="#l243.23"></a><span id="l243.23"> </span>
<a href="#l243.24"></a><span id="l243.24">       var thread = gThreadManager.currentThread;</span>
<a href="#l243.25"></a><span id="l243.25">       while (thread.hasPendingEvents())</span>
<a href="#l243.26"></a><span id="l243.26">         thread.processNextEvent(true);</span>
<a href="#l243.27"></a><span id="l243.27" class="difflineat">@@ -168,17 +168,17 @@ add_task(function *() {</span>
<a href="#l243.28"></a><span id="l243.28">   // a local inbox should have a Mail flag!</span>
<a href="#l243.29"></a><span id="l243.29">   localAccountUtils.inboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l243.30"></a><span id="l243.30"> </span>
<a href="#l243.31"></a><span id="l243.31">   // Create the incoming server with &quot;original&quot; details.</span>
<a href="#l243.32"></a><span id="l243.32">   incomingServer = MailServices.accounts.getIncomingServer(&quot;server2&quot;);</span>
<a href="#l243.33"></a><span id="l243.33"> </span>
<a href="#l243.34"></a><span id="l243.34">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l243.35"></a><span id="l243.35">   // setup issue.</span>
<a href="#l243.36"></a><span id="l243.36" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l243.37"></a><span id="l243.37" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l243.38"></a><span id="l243.38"> </span>
<a href="#l243.39"></a><span id="l243.39">   do_test_pending();</span>
<a href="#l243.40"></a><span id="l243.40"> </span>
<a href="#l243.41"></a><span id="l243.41">   testNext();</span>
<a href="#l243.42"></a><span id="l243.42"> });</span>
<a href="#l243.43"></a><span id="l243.43"> </span>
<a href="#l243.44"></a><span id="l243.44"> function run_test() {</span>
<a href="#l243.45"></a><span id="l243.45">   run_next_test();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l244.1"></a><span id="l244.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password3.js</span>
<a href="#l244.2"></a><span id="l244.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password3.js</span>
<a href="#l244.3"></a><span id="l244.3" class="difflineat">@@ -30,50 +30,50 @@ add_task(function *() {</span>
<a href="#l244.4"></a><span id="l244.4">   let incomingServer2 = MailServices.accounts.createIncomingServer(kUser2, kHostname,</span>
<a href="#l244.5"></a><span id="l244.5">                                                                    kProtocol);</span>
<a href="#l244.6"></a><span id="l244.6"> </span>
<a href="#l244.7"></a><span id="l244.7">   var count = {};</span>
<a href="#l244.8"></a><span id="l244.8"> </span>
<a href="#l244.9"></a><span id="l244.9">   // Test - Check there are two logins to begin with.</span>
<a href="#l244.10"></a><span id="l244.10">   var logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l244.11"></a><span id="l244.11"> </span>
<a href="#l244.12"></a><span id="l244.12" class="difflineminus">-  do_check_eq(count.value, 2);</span>
<a href="#l244.13"></a><span id="l244.13" class="difflineminus">-  do_check_eq(logins.length, 2);</span>
<a href="#l244.14"></a><span id="l244.14" class="difflineplus">+  Assert.equal(count.value, 2);</span>
<a href="#l244.15"></a><span id="l244.15" class="difflineplus">+  Assert.equal(logins.length, 2);</span>
<a href="#l244.16"></a><span id="l244.16"> </span>
<a href="#l244.17"></a><span id="l244.17">   // These will either be one way around or the other.</span>
<a href="#l244.18"></a><span id="l244.18">   if (logins[0].username == kUser1) {</span>
<a href="#l244.19"></a><span id="l244.19" class="difflineminus">-    do_check_eq(logins[1].username, kUser2);</span>
<a href="#l244.20"></a><span id="l244.20" class="difflineplus">+    Assert.equal(logins[1].username, kUser2);</span>
<a href="#l244.21"></a><span id="l244.21">   } else {</span>
<a href="#l244.22"></a><span id="l244.22" class="difflineminus">-    do_check_eq(logins[0].username, kUser2);</span>
<a href="#l244.23"></a><span id="l244.23" class="difflineminus">-    do_check_eq(logins[1].username, kUser1);</span>
<a href="#l244.24"></a><span id="l244.24" class="difflineplus">+    Assert.equal(logins[0].username, kUser2);</span>
<a href="#l244.25"></a><span id="l244.25" class="difflineplus">+    Assert.equal(logins[1].username, kUser1);</span>
<a href="#l244.26"></a><span id="l244.26">   }</span>
<a href="#l244.27"></a><span id="l244.27"> </span>
<a href="#l244.28"></a><span id="l244.28">   // Test - Remove a login via the incoming server</span>
<a href="#l244.29"></a><span id="l244.29">   incomingServer1.forgetPassword();</span>
<a href="#l244.30"></a><span id="l244.30"> </span>
<a href="#l244.31"></a><span id="l244.31">   logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l244.32"></a><span id="l244.32"> </span>
<a href="#l244.33"></a><span id="l244.33">   // should be one login left for kUser2</span>
<a href="#l244.34"></a><span id="l244.34" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l244.35"></a><span id="l244.35" class="difflineminus">-  do_check_eq(logins[0].username, kUser2);</span>
<a href="#l244.36"></a><span id="l244.36" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l244.37"></a><span id="l244.37" class="difflineplus">+  Assert.equal(logins[0].username, kUser2);</span>
<a href="#l244.38"></a><span id="l244.38"> </span>
<a href="#l244.39"></a><span id="l244.39">   // Bug 561056 - Expand username to also contain domain (i.e. full email).</span>
<a href="#l244.40"></a><span id="l244.40">   incomingServer2.realUsername = kUser2 + &quot;@local.host&quot;;</span>
<a href="#l244.41"></a><span id="l244.41"> </span>
<a href="#l244.42"></a><span id="l244.42">   logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l244.43"></a><span id="l244.43"> </span>
<a href="#l244.44"></a><span id="l244.44">   // There should still be the one login left for kUser2</span>
<a href="#l244.45"></a><span id="l244.45" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l244.46"></a><span id="l244.46" class="difflineminus">-  do_check_eq(logins[0].username, kUser2);</span>
<a href="#l244.47"></a><span id="l244.47" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l244.48"></a><span id="l244.48" class="difflineplus">+  Assert.equal(logins[0].username, kUser2);</span>
<a href="#l244.49"></a><span id="l244.49"> </span>
<a href="#l244.50"></a><span id="l244.50">   // Change username to another one.</span>
<a href="#l244.51"></a><span id="l244.51">   incomingServer2.realUsername = &quot;testpop&quot;;</span>
<a href="#l244.52"></a><span id="l244.52"> </span>
<a href="#l244.53"></a><span id="l244.53">   logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l244.54"></a><span id="l244.54"> </span>
<a href="#l244.55"></a><span id="l244.55">   // There should be no login left.</span>
<a href="#l244.56"></a><span id="l244.56" class="difflineminus">-  do_check_eq(count.value, 0);</span>
<a href="#l244.57"></a><span id="l244.57" class="difflineminus">-  do_check_eq(logins.length, 0);</span>
<a href="#l244.58"></a><span id="l244.58" class="difflineplus">+  Assert.equal(count.value, 0);</span>
<a href="#l244.59"></a><span id="l244.59" class="difflineplus">+  Assert.equal(logins.length, 0);</span>
<a href="#l244.60"></a><span id="l244.60"> });</span>
<a href="#l244.61"></a><span id="l244.61"> </span>
<a href="#l244.62"></a><span id="l244.62"> function run_test() {</span>
<a href="#l244.63"></a><span id="l244.63">   run_next_test();</span>
<a href="#l244.64"></a><span id="l244.64"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l245.1"></a><span id="l245.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure.js</span>
<a href="#l245.2"></a><span id="l245.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure.js</span>
<a href="#l245.3"></a><span id="l245.3" class="difflineat">@@ -28,17 +28,17 @@ var attempt = 0;</span>
<a href="#l245.4"></a><span id="l245.4"> var kUserName = &quot;testpop3&quot;;</span>
<a href="#l245.5"></a><span id="l245.5"> var kInvalidPassword = &quot;pop3test&quot;;</span>
<a href="#l245.6"></a><span id="l245.6"> var kValidPassword = &quot;testpop3&quot;;</span>
<a href="#l245.7"></a><span id="l245.7"> </span>
<a href="#l245.8"></a><span id="l245.8"> function alert(aDialogText, aText)</span>
<a href="#l245.9"></a><span id="l245.9"> {</span>
<a href="#l245.10"></a><span id="l245.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l245.11"></a><span id="l245.11">   // attempt shouldn't.</span>
<a href="#l245.12"></a><span id="l245.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l245.13"></a><span id="l245.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l245.14"></a><span id="l245.14"> </span>
<a href="#l245.15"></a><span id="l245.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l245.16"></a><span id="l245.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l245.17"></a><span id="l245.17"> }</span>
<a href="#l245.18"></a><span id="l245.18"> </span>
<a href="#l245.19"></a><span id="l245.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l245.20"></a><span id="l245.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l245.21"></a><span id="l245.21">   switch (++attempt) {</span>
<a href="#l245.22"></a><span id="l245.22" class="difflineat">@@ -86,21 +86,21 @@ var urlListener =</span>
<a href="#l245.23"></a><span id="l245.23"> {</span>
<a href="#l245.24"></a><span id="l245.24">   OnStartRunningUrl: function (url) {</span>
<a href="#l245.25"></a><span id="l245.25">   },</span>
<a href="#l245.26"></a><span id="l245.26">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l245.27"></a><span id="l245.27">     try {</span>
<a href="#l245.28"></a><span id="l245.28">       var transaction = server.playTransaction();</span>
<a href="#l245.29"></a><span id="l245.29"> </span>
<a href="#l245.30"></a><span id="l245.30">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l245.31"></a><span id="l245.31" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l245.32"></a><span id="l245.32" class="difflineminus">-                  attempt == 4 ? 1 : 0);</span>
<a href="#l245.33"></a><span id="l245.33" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l245.34"></a><span id="l245.34" class="difflineplus">+                   attempt == 4 ? 1 : 0);</span>
<a href="#l245.35"></a><span id="l245.35"> </span>
<a href="#l245.36"></a><span id="l245.36">       // If we've just cancelled, expect binding aborted rather than success.</span>
<a href="#l245.37"></a><span id="l245.37" class="difflineminus">-      do_check_eq(result, attempt == 2 ? Cr.NS_BINDING_ABORTED : 0);</span>
<a href="#l245.38"></a><span id="l245.38" class="difflineplus">+      Assert.equal(result, attempt == 2 ? Cr.NS_BINDING_ABORTED : 0);</span>
<a href="#l245.39"></a><span id="l245.39">       async_driver();</span>
<a href="#l245.40"></a><span id="l245.40">     }</span>
<a href="#l245.41"></a><span id="l245.41">     catch (e) {</span>
<a href="#l245.42"></a><span id="l245.42">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l245.43"></a><span id="l245.43">       server.stop();</span>
<a href="#l245.44"></a><span id="l245.44"> </span>
<a href="#l245.45"></a><span id="l245.45">       var thread = gThreadManager.currentThread;</span>
<a href="#l245.46"></a><span id="l245.46">       while (thread.hasPendingEvents())</span>
<a href="#l245.47"></a><span id="l245.47" class="difflineat">@@ -128,27 +128,27 @@ function* getMail1()</span>
<a href="#l245.48"></a><span id="l245.48">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l245.49"></a><span id="l245.49"> </span>
<a href="#l245.50"></a><span id="l245.50">   // Now get mail</span>
<a href="#l245.51"></a><span id="l245.51">   getPopMail();</span>
<a href="#l245.52"></a><span id="l245.52">   yield false;</span>
<a href="#l245.53"></a><span id="l245.53"> </span>
<a href="#l245.54"></a><span id="l245.54">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l245.55"></a><span id="l245.55"> </span>
<a href="#l245.56"></a><span id="l245.56" class="difflineminus">-  do_check_eq(attempt, 2);</span>
<a href="#l245.57"></a><span id="l245.57" class="difflineplus">+  Assert.equal(attempt, 2);</span>
<a href="#l245.58"></a><span id="l245.58"> </span>
<a href="#l245.59"></a><span id="l245.59">   // Check that we haven't forgotten the login even though we've retried and</span>
<a href="#l245.60"></a><span id="l245.60">   // canceled.</span>
<a href="#l245.61"></a><span id="l245.61">   let count = {};</span>
<a href="#l245.62"></a><span id="l245.62">   let logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l245.63"></a><span id="l245.63">                                           &quot;mailbox://localhost&quot;);</span>
<a href="#l245.64"></a><span id="l245.64"> </span>
<a href="#l245.65"></a><span id="l245.65" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l245.66"></a><span id="l245.66" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l245.67"></a><span id="l245.67" class="difflineminus">-  do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l245.68"></a><span id="l245.68" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l245.69"></a><span id="l245.69" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l245.70"></a><span id="l245.70" class="difflineplus">+  Assert.equal(logins[0].password, kInvalidPassword);</span>
<a href="#l245.71"></a><span id="l245.71"> </span>
<a href="#l245.72"></a><span id="l245.72">   server.resetTest();</span>
<a href="#l245.73"></a><span id="l245.73">   yield true;</span>
<a href="#l245.74"></a><span id="l245.74"> }</span>
<a href="#l245.75"></a><span id="l245.75"> </span>
<a href="#l245.76"></a><span id="l245.76"> function* getMail2()</span>
<a href="#l245.77"></a><span id="l245.77"> {</span>
<a href="#l245.78"></a><span id="l245.78">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l245.79"></a><span id="l245.79" class="difflineat">@@ -158,19 +158,19 @@ function* getMail2()</span>
<a href="#l245.80"></a><span id="l245.80">   yield false;</span>
<a href="#l245.81"></a><span id="l245.81">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l245.82"></a><span id="l245.82"> </span>
<a href="#l245.83"></a><span id="l245.83">   // Now check the new one has been saved.</span>
<a href="#l245.84"></a><span id="l245.84">   let count = {};</span>
<a href="#l245.85"></a><span id="l245.85">   let logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l245.86"></a><span id="l245.86">                                           &quot;mailbox://localhost&quot;);</span>
<a href="#l245.87"></a><span id="l245.87"> </span>
<a href="#l245.88"></a><span id="l245.88" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l245.89"></a><span id="l245.89" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l245.90"></a><span id="l245.90" class="difflineminus">-  do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l245.91"></a><span id="l245.91" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l245.92"></a><span id="l245.92" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l245.93"></a><span id="l245.93" class="difflineplus">+  Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l245.94"></a><span id="l245.94">   yield true;</span>
<a href="#l245.95"></a><span id="l245.95"> }</span>
<a href="#l245.96"></a><span id="l245.96"> </span>
<a href="#l245.97"></a><span id="l245.97"> function* end_test()</span>
<a href="#l245.98"></a><span id="l245.98"> {</span>
<a href="#l245.99"></a><span id="l245.99">   do_test_finished();</span>
<a href="#l245.100"></a><span id="l245.100"> }</span>
<a href="#l245.101"></a><span id="l245.101"> </span>
<a href="#l245.102"></a><span id="l245.102" class="difflineat">@@ -205,17 +205,17 @@ add_task(function *() {</span>
<a href="#l245.103"></a><span id="l245.103">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l245.104"></a><span id="l245.104"> </span>
<a href="#l245.105"></a><span id="l245.105">   incomingServer = MailServices.accounts.createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l245.106"></a><span id="l245.106"> </span>
<a href="#l245.107"></a><span id="l245.107">   incomingServer.port = server.port;</span>
<a href="#l245.108"></a><span id="l245.108"> </span>
<a href="#l245.109"></a><span id="l245.109">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l245.110"></a><span id="l245.110">   // setup issue.</span>
<a href="#l245.111"></a><span id="l245.111" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l245.112"></a><span id="l245.112" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l245.113"></a><span id="l245.113"> </span>
<a href="#l245.114"></a><span id="l245.114">   do_test_pending();</span>
<a href="#l245.115"></a><span id="l245.115"> </span>
<a href="#l245.116"></a><span id="l245.116">   actually_run_test();</span>
<a href="#l245.117"></a><span id="l245.117"> });</span>
<a href="#l245.118"></a><span id="l245.118"> </span>
<a href="#l245.119"></a><span id="l245.119"> function run_test() {</span>
<a href="#l245.120"></a><span id="l245.120">   run_next_test();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l246.1"></a><span id="l246.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l246.2"></a><span id="l246.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l246.3"></a><span id="l246.3" class="difflineat">@@ -29,17 +29,17 @@ var logins;</span>
<a href="#l246.4"></a><span id="l246.4"> var kUserName = &quot;testpop3&quot;;</span>
<a href="#l246.5"></a><span id="l246.5"> var kInvalidPassword = &quot;pop3test&quot;;</span>
<a href="#l246.6"></a><span id="l246.6"> var kValidPassword = &quot;testpop3&quot;;</span>
<a href="#l246.7"></a><span id="l246.7"> </span>
<a href="#l246.8"></a><span id="l246.8"> function alert(aDialogText, aText)</span>
<a href="#l246.9"></a><span id="l246.9"> {</span>
<a href="#l246.10"></a><span id="l246.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l246.11"></a><span id="l246.11">   // attempt shouldn't.</span>
<a href="#l246.12"></a><span id="l246.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l246.13"></a><span id="l246.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l246.14"></a><span id="l246.14"> </span>
<a href="#l246.15"></a><span id="l246.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l246.16"></a><span id="l246.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l246.17"></a><span id="l246.17"> }</span>
<a href="#l246.18"></a><span id="l246.18"> </span>
<a href="#l246.19"></a><span id="l246.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l246.20"></a><span id="l246.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l246.21"></a><span id="l246.21">   switch (++attempt) {</span>
<a href="#l246.22"></a><span id="l246.22" class="difflineat">@@ -82,23 +82,23 @@ function getPopMail() {</span>
<a href="#l246.23"></a><span id="l246.23"> </span>
<a href="#l246.24"></a><span id="l246.24"> var urlListener =</span>
<a href="#l246.25"></a><span id="l246.25"> {</span>
<a href="#l246.26"></a><span id="l246.26">   OnStartRunningUrl: function (url) {</span>
<a href="#l246.27"></a><span id="l246.27">   },</span>
<a href="#l246.28"></a><span id="l246.28">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l246.29"></a><span id="l246.29">     try {</span>
<a href="#l246.30"></a><span id="l246.30">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l246.31"></a><span id="l246.31" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l246.32"></a><span id="l246.32" class="difflineminus">-                  attempt == 4 ? 1 : 0);</span>
<a href="#l246.33"></a><span id="l246.33" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l246.34"></a><span id="l246.34" class="difflineplus">+                   attempt == 4 ? 1 : 0);</span>
<a href="#l246.35"></a><span id="l246.35"> </span>
<a href="#l246.36"></a><span id="l246.36">       // If we've just cancelled, expect failure rather than success</span>
<a href="#l246.37"></a><span id="l246.37">       // because the server dropped the connection.</span>
<a href="#l246.38"></a><span id="l246.38">       dump(&quot;in onStopRunning, result = &quot; + result + &quot;\n&quot;);</span>
<a href="#l246.39"></a><span id="l246.39" class="difflineminus">-      do_check_eq(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l246.40"></a><span id="l246.40" class="difflineplus">+      Assert.equal(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l246.41"></a><span id="l246.41">       async_driver();</span>
<a href="#l246.42"></a><span id="l246.42">     }</span>
<a href="#l246.43"></a><span id="l246.43">     catch (e) {</span>
<a href="#l246.44"></a><span id="l246.44">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l246.45"></a><span id="l246.45">       server.stop();</span>
<a href="#l246.46"></a><span id="l246.46"> </span>
<a href="#l246.47"></a><span id="l246.47">       var thread = gThreadManager.currentThread;</span>
<a href="#l246.48"></a><span id="l246.48">       while (thread.hasPendingEvents())</span>
<a href="#l246.49"></a><span id="l246.49" class="difflineat">@@ -124,26 +124,26 @@ function actually_run_test() {</span>
<a href="#l246.50"></a><span id="l246.50"> function* getMail1() {</span>
<a href="#l246.51"></a><span id="l246.51">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l246.52"></a><span id="l246.52"> </span>
<a href="#l246.53"></a><span id="l246.53">   // Now get mail</span>
<a href="#l246.54"></a><span id="l246.54">   getPopMail();</span>
<a href="#l246.55"></a><span id="l246.55">   yield false;</span>
<a href="#l246.56"></a><span id="l246.56">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l246.57"></a><span id="l246.57"> </span>
<a href="#l246.58"></a><span id="l246.58" class="difflineminus">-  do_check_eq(attempt, 2);</span>
<a href="#l246.59"></a><span id="l246.59" class="difflineplus">+  Assert.equal(attempt, 2);</span>
<a href="#l246.60"></a><span id="l246.60"> </span>
<a href="#l246.61"></a><span id="l246.61">   // Check that we haven't forgetton the login even though we've retried and</span>
<a href="#l246.62"></a><span id="l246.62">   // canceled.</span>
<a href="#l246.63"></a><span id="l246.63">   logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l246.64"></a><span id="l246.64">                                       &quot;mailbox://localhost&quot;);</span>
<a href="#l246.65"></a><span id="l246.65"> </span>
<a href="#l246.66"></a><span id="l246.66" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l246.67"></a><span id="l246.67" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l246.68"></a><span id="l246.68" class="difflineminus">-  do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l246.69"></a><span id="l246.69" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l246.70"></a><span id="l246.70" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l246.71"></a><span id="l246.71" class="difflineplus">+  Assert.equal(logins[0].password, kInvalidPassword);</span>
<a href="#l246.72"></a><span id="l246.72"> </span>
<a href="#l246.73"></a><span id="l246.73">   server.resetTest();</span>
<a href="#l246.74"></a><span id="l246.74">   yield true;</span>
<a href="#l246.75"></a><span id="l246.75"> }</span>
<a href="#l246.76"></a><span id="l246.76"> </span>
<a href="#l246.77"></a><span id="l246.77"> function* getMail2() {</span>
<a href="#l246.78"></a><span id="l246.78">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l246.79"></a><span id="l246.79"> </span>
<a href="#l246.80"></a><span id="l246.80" class="difflineat">@@ -153,19 +153,19 @@ function* getMail2() {</span>
<a href="#l246.81"></a><span id="l246.81">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l246.82"></a><span id="l246.82"> }</span>
<a href="#l246.83"></a><span id="l246.83"> </span>
<a href="#l246.84"></a><span id="l246.84"> function* endTest() {</span>
<a href="#l246.85"></a><span id="l246.85">   // Now check the new one has been saved.</span>
<a href="#l246.86"></a><span id="l246.86">   logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l246.87"></a><span id="l246.87">                                       &quot;mailbox://localhost&quot;);</span>
<a href="#l246.88"></a><span id="l246.88"> </span>
<a href="#l246.89"></a><span id="l246.89" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l246.90"></a><span id="l246.90" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l246.91"></a><span id="l246.91" class="difflineminus">-  do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l246.92"></a><span id="l246.92" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l246.93"></a><span id="l246.93" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l246.94"></a><span id="l246.94" class="difflineplus">+  Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l246.95"></a><span id="l246.95">   yield true;</span>
<a href="#l246.96"></a><span id="l246.96"> }</span>
<a href="#l246.97"></a><span id="l246.97"> </span>
<a href="#l246.98"></a><span id="l246.98"> function run_test()</span>
<a href="#l246.99"></a><span id="l246.99"> {</span>
<a href="#l246.100"></a><span id="l246.100">   mailTestUtils.registerUMimTypProvider();</span>
<a href="#l246.101"></a><span id="l246.101"> </span>
<a href="#l246.102"></a><span id="l246.102">   // Disable new mail notifications</span>
<a href="#l246.103"></a><span id="l246.103" class="difflineat">@@ -201,12 +201,12 @@ function run_test()</span>
<a href="#l246.104"></a><span id="l246.104">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l246.105"></a><span id="l246.105"> </span>
<a href="#l246.106"></a><span id="l246.106">   incomingServer = MailServices.accounts</span>
<a href="#l246.107"></a><span id="l246.107">                     .createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l246.108"></a><span id="l246.108">   incomingServer.port = server.port;</span>
<a href="#l246.109"></a><span id="l246.109"> </span>
<a href="#l246.110"></a><span id="l246.110">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l246.111"></a><span id="l246.111">   // setup issue.</span>
<a href="#l246.112"></a><span id="l246.112" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l246.113"></a><span id="l246.113" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l246.114"></a><span id="l246.114"> </span>
<a href="#l246.115"></a><span id="l246.115">   actually_run_test();</span>
<a href="#l246.116"></a><span id="l246.116"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l247.1"></a><span id="l247.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l247.2"></a><span id="l247.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l247.3"></a><span id="l247.3" class="difflineat">@@ -31,17 +31,17 @@ var logins;</span>
<a href="#l247.4"></a><span id="l247.4"> var kUserName = &quot;testpop3&quot;;</span>
<a href="#l247.5"></a><span id="l247.5"> var kInvalidPassword = &quot;pop3test&quot;;</span>
<a href="#l247.6"></a><span id="l247.6"> var kValidPassword = &quot;testpop3&quot;;</span>
<a href="#l247.7"></a><span id="l247.7"> </span>
<a href="#l247.8"></a><span id="l247.8"> function alert(aDialogText, aText)</span>
<a href="#l247.9"></a><span id="l247.9"> {</span>
<a href="#l247.10"></a><span id="l247.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l247.11"></a><span id="l247.11">   // attempt shouldn't.</span>
<a href="#l247.12"></a><span id="l247.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l247.13"></a><span id="l247.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l247.14"></a><span id="l247.14"> </span>
<a href="#l247.15"></a><span id="l247.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l247.16"></a><span id="l247.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l247.17"></a><span id="l247.17"> }</span>
<a href="#l247.18"></a><span id="l247.18"> </span>
<a href="#l247.19"></a><span id="l247.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l247.20"></a><span id="l247.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l247.21"></a><span id="l247.21">   switch (++attempt) {</span>
<a href="#l247.22"></a><span id="l247.22" class="difflineat">@@ -84,23 +84,23 @@ function getPopMail() {</span>
<a href="#l247.23"></a><span id="l247.23"> </span>
<a href="#l247.24"></a><span id="l247.24"> var urlListener =</span>
<a href="#l247.25"></a><span id="l247.25"> {</span>
<a href="#l247.26"></a><span id="l247.26">   OnStartRunningUrl: function (url) {</span>
<a href="#l247.27"></a><span id="l247.27">   },</span>
<a href="#l247.28"></a><span id="l247.28">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l247.29"></a><span id="l247.29">     try {</span>
<a href="#l247.30"></a><span id="l247.30">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l247.31"></a><span id="l247.31" class="difflineminus">-      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l247.32"></a><span id="l247.32" class="difflineminus">-                  attempt == 4 ? 1 : 0);</span>
<a href="#l247.33"></a><span id="l247.33" class="difflineplus">+      Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l247.34"></a><span id="l247.34" class="difflineplus">+                   attempt == 4 ? 1 : 0);</span>
<a href="#l247.35"></a><span id="l247.35"> </span>
<a href="#l247.36"></a><span id="l247.36">       // If we've just cancelled, expect failure rather than success</span>
<a href="#l247.37"></a><span id="l247.37">       // because the server dropped the connection.</span>
<a href="#l247.38"></a><span id="l247.38">       dump(&quot;in onStopRunning, result = &quot; + result + &quot;\n&quot;);</span>
<a href="#l247.39"></a><span id="l247.39" class="difflineminus">-      do_check_eq(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l247.40"></a><span id="l247.40" class="difflineplus">+      Assert.equal(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l247.41"></a><span id="l247.41">       async_driver();</span>
<a href="#l247.42"></a><span id="l247.42">     }</span>
<a href="#l247.43"></a><span id="l247.43">     catch (e) {</span>
<a href="#l247.44"></a><span id="l247.44">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l247.45"></a><span id="l247.45">       server.stop();</span>
<a href="#l247.46"></a><span id="l247.46"> </span>
<a href="#l247.47"></a><span id="l247.47">       var thread = gThreadManager.currentThread;</span>
<a href="#l247.48"></a><span id="l247.48">       while (thread.hasPendingEvents())</span>
<a href="#l247.49"></a><span id="l247.49" class="difflineat">@@ -126,26 +126,26 @@ function actually_run_test() {</span>
<a href="#l247.50"></a><span id="l247.50"> function* getMail1() {</span>
<a href="#l247.51"></a><span id="l247.51">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l247.52"></a><span id="l247.52"> </span>
<a href="#l247.53"></a><span id="l247.53">   // Now get mail</span>
<a href="#l247.54"></a><span id="l247.54">   getPopMail();</span>
<a href="#l247.55"></a><span id="l247.55">   yield false;</span>
<a href="#l247.56"></a><span id="l247.56">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l247.57"></a><span id="l247.57"> </span>
<a href="#l247.58"></a><span id="l247.58" class="difflineminus">-  do_check_eq(attempt, 2);</span>
<a href="#l247.59"></a><span id="l247.59" class="difflineplus">+  Assert.equal(attempt, 2);</span>
<a href="#l247.60"></a><span id="l247.60"> </span>
<a href="#l247.61"></a><span id="l247.61">   // Check that we haven't forgetton the login even though we've retried and</span>
<a href="#l247.62"></a><span id="l247.62">   // canceled.</span>
<a href="#l247.63"></a><span id="l247.63">   logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l247.64"></a><span id="l247.64">                                       &quot;mailbox://localhost&quot;);</span>
<a href="#l247.65"></a><span id="l247.65"> </span>
<a href="#l247.66"></a><span id="l247.66" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l247.67"></a><span id="l247.67" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l247.68"></a><span id="l247.68" class="difflineminus">-  do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l247.69"></a><span id="l247.69" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l247.70"></a><span id="l247.70" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l247.71"></a><span id="l247.71" class="difflineplus">+  Assert.equal(logins[0].password, kInvalidPassword);</span>
<a href="#l247.72"></a><span id="l247.72"> </span>
<a href="#l247.73"></a><span id="l247.73">   server.resetTest();</span>
<a href="#l247.74"></a><span id="l247.74">   yield true;</span>
<a href="#l247.75"></a><span id="l247.75"> }</span>
<a href="#l247.76"></a><span id="l247.76"> </span>
<a href="#l247.77"></a><span id="l247.77"> function* getMail2() {</span>
<a href="#l247.78"></a><span id="l247.78">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l247.79"></a><span id="l247.79"> </span>
<a href="#l247.80"></a><span id="l247.80" class="difflineat">@@ -155,19 +155,19 @@ function* getMail2() {</span>
<a href="#l247.81"></a><span id="l247.81">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l247.82"></a><span id="l247.82"> }</span>
<a href="#l247.83"></a><span id="l247.83"> </span>
<a href="#l247.84"></a><span id="l247.84"> function* endTest() {</span>
<a href="#l247.85"></a><span id="l247.85">   // Now check the new one has been saved.</span>
<a href="#l247.86"></a><span id="l247.86">   logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l247.87"></a><span id="l247.87">                                       &quot;mailbox://localhost&quot;);</span>
<a href="#l247.88"></a><span id="l247.88"> </span>
<a href="#l247.89"></a><span id="l247.89" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l247.90"></a><span id="l247.90" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l247.91"></a><span id="l247.91" class="difflineminus">-  do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l247.92"></a><span id="l247.92" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l247.93"></a><span id="l247.93" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l247.94"></a><span id="l247.94" class="difflineplus">+  Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l247.95"></a><span id="l247.95">   yield true;</span>
<a href="#l247.96"></a><span id="l247.96"> }</span>
<a href="#l247.97"></a><span id="l247.97"> </span>
<a href="#l247.98"></a><span id="l247.98"> function run_test()</span>
<a href="#l247.99"></a><span id="l247.99"> {</span>
<a href="#l247.100"></a><span id="l247.100">   mailTestUtils.registerUMimTypProvider();</span>
<a href="#l247.101"></a><span id="l247.101"> </span>
<a href="#l247.102"></a><span id="l247.102">   // Disable new mail notifications</span>
<a href="#l247.103"></a><span id="l247.103" class="difflineat">@@ -202,12 +202,12 @@ function run_test()</span>
<a href="#l247.104"></a><span id="l247.104">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l247.105"></a><span id="l247.105"> </span>
<a href="#l247.106"></a><span id="l247.106">   incomingServer = MailServices.accounts</span>
<a href="#l247.107"></a><span id="l247.107">                     .createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l247.108"></a><span id="l247.108">   incomingServer.port = server.port;</span>
<a href="#l247.109"></a><span id="l247.109"> </span>
<a href="#l247.110"></a><span id="l247.110">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l247.111"></a><span id="l247.111">   // setup issue.</span>
<a href="#l247.112"></a><span id="l247.112" class="difflineminus">-  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l247.113"></a><span id="l247.113" class="difflineplus">+  Assert.equal(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l247.114"></a><span id="l247.114"> </span>
<a href="#l247.115"></a><span id="l247.115">   actually_run_test();</span>
<a href="#l247.116"></a><span id="l247.116"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l248.1"></a><span id="l248.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l248.2"></a><span id="l248.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l248.3"></a><span id="l248.3" class="difflineat">@@ -18,17 +18,17 @@ add_task(function* runPump() {</span>
<a href="#l248.4"></a><span id="l248.4">   yield gPOP3Pump.run();</span>
<a href="#l248.5"></a><span id="l248.5"> </span>
<a href="#l248.6"></a><span id="l248.6">   // get message headers for the inbox folder</span>
<a href="#l248.7"></a><span id="l248.7">   let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l248.8"></a><span id="l248.8">   var msgCount = 0;</span>
<a href="#l248.9"></a><span id="l248.9">   while (enumerator.hasMoreElements()) {</span>
<a href="#l248.10"></a><span id="l248.10">     msgCount++;</span>
<a href="#l248.11"></a><span id="l248.11">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l248.12"></a><span id="l248.12" class="difflineminus">-    do_check_eq(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l248.13"></a><span id="l248.13" class="difflineplus">+    Assert.equal(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l248.14"></a><span id="l248.14">   }</span>
<a href="#l248.15"></a><span id="l248.15" class="difflineminus">-  do_check_eq(msgCount, 2);</span>
<a href="#l248.16"></a><span id="l248.16" class="difflineplus">+  Assert.equal(msgCount, 2);</span>
<a href="#l248.17"></a><span id="l248.17">   gPOP3Pump = null;</span>
<a href="#l248.18"></a><span id="l248.18"> });</span>
<a href="#l248.19"></a><span id="l248.19"> </span>
<a href="#l248.20"></a><span id="l248.20"> function run_test() {</span>
<a href="#l248.21"></a><span id="l248.21">   run_next_test();</span>
<a href="#l248.22"></a><span id="l248.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l249.1"></a><span id="l249.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</span>
<a href="#l249.2"></a><span id="l249.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</span>
<a href="#l249.3"></a><span id="l249.3" class="difflineat">@@ -36,17 +36,17 @@ var expectedTransaction = [ &quot;AUTH&quot;, &quot;CAP</span>
<a href="#l249.4"></a><span id="l249.4"> </span>
<a href="#l249.5"></a><span id="l249.5"> var urlListener =</span>
<a href="#l249.6"></a><span id="l249.6"> {</span>
<a href="#l249.7"></a><span id="l249.7">   OnStartRunningUrl: function (url) {</span>
<a href="#l249.8"></a><span id="l249.8">   },</span>
<a href="#l249.9"></a><span id="l249.9">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l249.10"></a><span id="l249.10">     try {</span>
<a href="#l249.11"></a><span id="l249.11">       // We should be getting an error here, because we couldn't log in.</span>
<a href="#l249.12"></a><span id="l249.12" class="difflineminus">-      do_check_eq(result, Cr.NS_ERROR_FAILURE);</span>
<a href="#l249.13"></a><span id="l249.13" class="difflineplus">+      Assert.equal(result, Cr.NS_ERROR_FAILURE);</span>
<a href="#l249.14"></a><span id="l249.14"> </span>
<a href="#l249.15"></a><span id="l249.15">       var transaction = server.playTransaction();</span>
<a href="#l249.16"></a><span id="l249.16">       do_check_transaction(transaction, expectedTransaction);</span>
<a href="#l249.17"></a><span id="l249.17"> </span>
<a href="#l249.18"></a><span id="l249.18">       do_timeout(0, endTest);</span>
<a href="#l249.19"></a><span id="l249.19">     } catch (e) {</span>
<a href="#l249.20"></a><span id="l249.20">       server.stop();</span>
<a href="#l249.21"></a><span id="l249.21">       var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l250.1"></a><span id="l250.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</span>
<a href="#l250.2"></a><span id="l250.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</span>
<a href="#l250.3"></a><span id="l250.3" class="difflineat">@@ -12,17 +12,17 @@ var test = &quot;Server which advertises CRAM</span>
<a href="#l250.4"></a><span id="l250.4"> var expectedTransaction = [ &quot;AUTH&quot;, &quot;CAPA&quot;, &quot;AUTH CRAM-MD5&quot;, &quot;AUTH PLAIN&quot;, &quot;STAT&quot; ];</span>
<a href="#l250.5"></a><span id="l250.5"> </span>
<a href="#l250.6"></a><span id="l250.6"> var urlListener =</span>
<a href="#l250.7"></a><span id="l250.7"> {</span>
<a href="#l250.8"></a><span id="l250.8">   OnStartRunningUrl: function (url) {</span>
<a href="#l250.9"></a><span id="l250.9">   },</span>
<a href="#l250.10"></a><span id="l250.10">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l250.11"></a><span id="l250.11">     try {</span>
<a href="#l250.12"></a><span id="l250.12" class="difflineminus">-      do_check_eq(result, 0);</span>
<a href="#l250.13"></a><span id="l250.13" class="difflineplus">+      Assert.equal(result, 0);</span>
<a href="#l250.14"></a><span id="l250.14"> </span>
<a href="#l250.15"></a><span id="l250.15">       var transaction = server.playTransaction();</span>
<a href="#l250.16"></a><span id="l250.16">       do_check_transaction(transaction, expectedTransaction);</span>
<a href="#l250.17"></a><span id="l250.17"> </span>
<a href="#l250.18"></a><span id="l250.18">       do_timeout(0, checkBusy);</span>
<a href="#l250.19"></a><span id="l250.19">     } catch (e) {</span>
<a href="#l250.20"></a><span id="l250.20">       server.stop();</span>
<a href="#l250.21"></a><span id="l250.21">       var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l251.1"></a><span id="l251.1" class="difflineminus">--- a/mailnews/local/test/unit/test_preview.js</span>
<a href="#l251.2"></a><span id="l251.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_preview.js</span>
<a href="#l251.3"></a><span id="l251.3" class="difflineat">@@ -9,20 +9,20 @@ function run_test() {</span>
<a href="#l251.4"></a><span id="l251.4"> }</span>
<a href="#l251.5"></a><span id="l251.5"> </span>
<a href="#l251.6"></a><span id="l251.6"> function copy_next_message(aMessageHeaderKeys, aStatus) {</span>
<a href="#l251.7"></a><span id="l251.7">   copyFileMessageInLocalFolder(bugmail11, 0, &quot;&quot;, null, test_preview);</span>
<a href="#l251.8"></a><span id="l251.8"> }</span>
<a href="#l251.9"></a><span id="l251.9"> </span>
<a href="#l251.10"></a><span id="l251.10"> function test_preview(aMessageHeaderKeys, aStatus) {</span>
<a href="#l251.11"></a><span id="l251.11">   let headerKeys = aMessageHeaderKeys;</span>
<a href="#l251.12"></a><span id="l251.12" class="difflineminus">-  do_check_neq(headerKeys, null);</span>
<a href="#l251.13"></a><span id="l251.13" class="difflineminus">-  do_check_eq(headerKeys.length, 2);</span>
<a href="#l251.14"></a><span id="l251.14" class="difflineplus">+  Assert.notEqual(headerKeys, null);</span>
<a href="#l251.15"></a><span id="l251.15" class="difflineplus">+  Assert.equal(headerKeys.length, 2);</span>
<a href="#l251.16"></a><span id="l251.16">   try {</span>
<a href="#l251.17"></a><span id="l251.17">     localAccountUtils.inboxFolder.fetchMsgPreviewText(headerKeys,</span>
<a href="#l251.18"></a><span id="l251.18">                                           headerKeys.length, false, null);</span>
<a href="#l251.19"></a><span id="l251.19" class="difflineminus">-    do_check_eq(localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]).getStringProperty('preview'),</span>
<a href="#l251.20"></a><span id="l251.20" class="difflineminus">-                bugmail10_preview);</span>
<a href="#l251.21"></a><span id="l251.21" class="difflineminus">-    do_check_eq(localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[1]).getStringProperty('preview'),</span>
<a href="#l251.22"></a><span id="l251.22" class="difflineminus">-                bugmail11_preview);</span>
<a href="#l251.23"></a><span id="l251.23" class="difflineplus">+    Assert.equal(localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]).getStringProperty('preview'),</span>
<a href="#l251.24"></a><span id="l251.24" class="difflineplus">+                 bugmail10_preview);</span>
<a href="#l251.25"></a><span id="l251.25" class="difflineplus">+    Assert.equal(localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[1]).getStringProperty('preview'),</span>
<a href="#l251.26"></a><span id="l251.26" class="difflineplus">+                 bugmail11_preview);</span>
<a href="#l251.27"></a><span id="l251.27">   } catch(ex) {dump(ex); do_throw(ex) }</span>
<a href="#l251.28"></a><span id="l251.28">   do_test_finished();</span>
<a href="#l251.29"></a><span id="l251.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l252.1"></a><span id="l252.1" class="difflineminus">--- a/mailnews/local/test/unit/test_saveMessage.js</span>
<a href="#l252.2"></a><span id="l252.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_saveMessage.js</span>
<a href="#l252.3"></a><span id="l252.3" class="difflineat">@@ -18,41 +18,41 @@ function run_test()</span>
<a href="#l252.4"></a><span id="l252.4">     do_throw('SaveMessageToDisk did not complete within 10 seconds' +</span>
<a href="#l252.5"></a><span id="l252.5">       '(incorrect messageURI?). ABORTING.');</span>
<a href="#l252.6"></a><span id="l252.6">   });</span>
<a href="#l252.7"></a><span id="l252.7">   copyFileMessageInLocalFolder(dot, 0, &quot;&quot;, null, save_message);</span>
<a href="#l252.8"></a><span id="l252.8"> }</span>
<a href="#l252.9"></a><span id="l252.9"> </span>
<a href="#l252.10"></a><span id="l252.10"> function save_message(aMessageHeaderKeys, aStatus) {</span>
<a href="#l252.11"></a><span id="l252.11">   let headerKeys = aMessageHeaderKeys;</span>
<a href="#l252.12"></a><span id="l252.12" class="difflineminus">-  do_check_neq(headerKeys, null);</span>
<a href="#l252.13"></a><span id="l252.13" class="difflineplus">+  Assert.notEqual(headerKeys, null);</span>
<a href="#l252.14"></a><span id="l252.14"> </span>
<a href="#l252.15"></a><span id="l252.15">   let message = localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]);</span>
<a href="#l252.16"></a><span id="l252.16">   let msgURI = localAccountUtils.inboxFolder.getUriForMsg(message);</span>
<a href="#l252.17"></a><span id="l252.17">   let messageService = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=mailbox-message&quot;]</span>
<a href="#l252.18"></a><span id="l252.18">                        .getService(Ci.nsIMsgMessageService);</span>
<a href="#l252.19"></a><span id="l252.19">   messageService.SaveMessageToDisk(msgURI, saveFile,</span>
<a href="#l252.20"></a><span id="l252.20">                                     false, UrlListener, {}, true, null);</span>
<a href="#l252.21"></a><span id="l252.21"> }</span>
<a href="#l252.22"></a><span id="l252.22"> </span>
<a href="#l252.23"></a><span id="l252.23"> function check_each_line(aExpectedLines, aActualLines) {</span>
<a href="#l252.24"></a><span id="l252.24">   let expectedStrings = aExpectedLines.split(MSG_LINEBREAK);</span>
<a href="#l252.25"></a><span id="l252.25">   let actualStrings = aActualLines.split(MSG_LINEBREAK);</span>
<a href="#l252.26"></a><span id="l252.26"> </span>
<a href="#l252.27"></a><span id="l252.27">   expectedStrings.shift();</span>
<a href="#l252.28"></a><span id="l252.28" class="difflineminus">-  do_check_eq(expectedStrings.length, actualStrings.length);</span>
<a href="#l252.29"></a><span id="l252.29" class="difflineplus">+  Assert.equal(expectedStrings.length, actualStrings.length);</span>
<a href="#l252.30"></a><span id="l252.30">   for (let line = 0; line &lt; expectedStrings.length; line++)</span>
<a href="#l252.31"></a><span id="l252.31" class="difflineminus">-    do_check_eq(expectedStrings[line], actualStrings[line]);</span>
<a href="#l252.32"></a><span id="l252.32" class="difflineplus">+    Assert.equal(expectedStrings[line], actualStrings[line]);</span>
<a href="#l252.33"></a><span id="l252.33"> }</span>
<a href="#l252.34"></a><span id="l252.34"> </span>
<a href="#l252.35"></a><span id="l252.35"> var UrlListener = {</span>
<a href="#l252.36"></a><span id="l252.36">   OnStartRunningUrl: function(aUrl) {</span>
<a href="#l252.37"></a><span id="l252.37">   },</span>
<a href="#l252.38"></a><span id="l252.38">   OnStopRunningUrl: function(aUrl, aExitCode) {</span>
<a href="#l252.39"></a><span id="l252.39" class="difflineminus">-    do_check_eq(aExitCode, 0);</span>
<a href="#l252.40"></a><span id="l252.40" class="difflineplus">+    Assert.equal(aExitCode, 0);</span>
<a href="#l252.41"></a><span id="l252.41">     check_each_line(IOUtils.loadFileToString(dot),</span>
<a href="#l252.42"></a><span id="l252.42"> 		    IOUtils.loadFileToString(saveFile));</span>
<a href="#l252.43"></a><span id="l252.43">     do_test_finished();</span>
<a href="#l252.44"></a><span id="l252.44">   }</span>
<a href="#l252.45"></a><span id="l252.45"> };</span>
<a href="#l252.46"></a><span id="l252.46"> </span>
<a href="#l252.47"></a><span id="l252.47"> function teardown() {</span>
<a href="#l252.48"></a><span id="l252.48">   if (saveFile.exists())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l253.1"></a><span id="l253.1" class="difflineminus">--- a/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l253.2"></a><span id="l253.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l253.3"></a><span id="l253.3" class="difflineat">@@ -37,33 +37,33 @@ function* loadMessages()</span>
<a href="#l253.4"></a><span id="l253.4"> </span>
<a href="#l253.5"></a><span id="l253.5">   // get message headers for the inbox folder</span>
<a href="#l253.6"></a><span id="l253.6">   let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l253.7"></a><span id="l253.7">   var msgCount = 0;</span>
<a href="#l253.8"></a><span id="l253.8">   while(enumerator.hasMoreElements())</span>
<a href="#l253.9"></a><span id="l253.9">   {</span>
<a href="#l253.10"></a><span id="l253.10">     msgCount++;</span>
<a href="#l253.11"></a><span id="l253.11">     gHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l253.12"></a><span id="l253.12" class="difflineminus">-    do_check_eq(gHdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l253.13"></a><span id="l253.13" class="difflineplus">+    Assert.equal(gHdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l253.14"></a><span id="l253.14">   }</span>
<a href="#l253.15"></a><span id="l253.15" class="difflineminus">-  do_check_eq(msgCount, 1);</span>
<a href="#l253.16"></a><span id="l253.16" class="difflineplus">+  Assert.equal(msgCount, 1);</span>
<a href="#l253.17"></a><span id="l253.17">   gPOP3Pump = null;</span>
<a href="#l253.18"></a><span id="l253.18"> }</span>
<a href="#l253.19"></a><span id="l253.19"> </span>
<a href="#l253.20"></a><span id="l253.20"> function* goodStreaming()</span>
<a href="#l253.21"></a><span id="l253.21"> {</span>
<a href="#l253.22"></a><span id="l253.22">   // try to stream the headers of the last message</span>
<a href="#l253.23"></a><span id="l253.23">   let uri = gHdr.folder.getUriForMsg(gHdr);</span>
<a href="#l253.24"></a><span id="l253.24">   let messageService = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger)</span>
<a href="#l253.25"></a><span id="l253.25">                                                      .messageServiceFromURI(uri);</span>
<a href="#l253.26"></a><span id="l253.26">   messageService.streamHeaders(uri, createStreamListener(</span>
<a href="#l253.27"></a><span id="l253.27">     function theString(k) {</span>
<a href="#l253.28"></a><span id="l253.28">       dump('the string:\n' + k + '\n');</span>
<a href="#l253.29"></a><span id="l253.29">       // The message contains this header</span>
<a href="#l253.30"></a><span id="l253.30" class="difflineminus">-      do_check_true(k.includes(&quot;X-Mozilla-Draft-Info: internal/draft; vcard=0; receipt=0; DSN=0; uuencode=0&quot;));</span>
<a href="#l253.31"></a><span id="l253.31" class="difflineplus">+      Assert.ok(k.includes(&quot;X-Mozilla-Draft-Info: internal/draft; vcard=0; receipt=0; DSN=0; uuencode=0&quot;));</span>
<a href="#l253.32"></a><span id="l253.32">       async_driver();</span>
<a href="#l253.33"></a><span id="l253.33">     }), null, true);</span>
<a href="#l253.34"></a><span id="l253.34">   yield false;</span>
<a href="#l253.35"></a><span id="l253.35"> }</span>
<a href="#l253.36"></a><span id="l253.36"> </span>
<a href="#l253.37"></a><span id="l253.37"> // crash from bug 752768</span>
<a href="#l253.38"></a><span id="l253.38"> function badStreaming()</span>
<a href="#l253.39"></a><span id="l253.39"> {</span>
<a href="#l253.40"></a><span id="l253.40" class="difflineat">@@ -79,17 +79,17 @@ function badStreaming()</span>
<a href="#l253.41"></a><span id="l253.41"> </span>
<a href="#l253.42"></a><span id="l253.42">   let messageService = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger)</span>
<a href="#l253.43"></a><span id="l253.43">                                                      .messageServiceFromURI(uri);</span>
<a href="#l253.44"></a><span id="l253.44">   let haveError = false;</span>
<a href="#l253.45"></a><span id="l253.45">   try {</span>
<a href="#l253.46"></a><span id="l253.46">     messageService.streamHeaders(uri, createStreamListener(</span>
<a href="#l253.47"></a><span id="l253.47">       function theString(k) {} ), null, true);</span>
<a href="#l253.48"></a><span id="l253.48">   } catch (e) {haveError = true;}</span>
<a href="#l253.49"></a><span id="l253.49" class="difflineminus">-  do_check_true(haveError);</span>
<a href="#l253.50"></a><span id="l253.50" class="difflineplus">+  Assert.ok(haveError);</span>
<a href="#l253.51"></a><span id="l253.51"> }</span>
<a href="#l253.52"></a><span id="l253.52"> </span>
<a href="#l253.53"></a><span id="l253.53"> // This function is adapted from the Conversations addon, which</span>
<a href="#l253.54"></a><span id="l253.54"> //  seems to be one of the drivers for the creation of streamHeaders</span>
<a href="#l253.55"></a><span id="l253.55"> /**</span>
<a href="#l253.56"></a><span id="l253.56">  * Creates a stream listener that will call k once done, passing it the string</span>
<a href="#l253.57"></a><span id="l253.57">  * that has been read.</span>
<a href="#l253.58"></a><span id="l253.58">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l254.1"></a><span id="l254.1" class="difflineminus">--- a/mailnews/local/test/unit/test_undoDelete.js</span>
<a href="#l254.2"></a><span id="l254.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_undoDelete.js</span>
<a href="#l254.3"></a><span id="l254.3" class="difflineat">@@ -31,17 +31,17 @@ var gTestArray =</span>
<a href="#l254.4"></a><span id="l254.4">   function undoDelete() {</span>
<a href="#l254.5"></a><span id="l254.5">     gMsgWindow.transactionManager.undoTransaction();</span>
<a href="#l254.6"></a><span id="l254.6">     // There's no listener for this, so we'll just have to wait a little.</span>
<a href="#l254.7"></a><span id="l254.7">     do_timeout(1500, function(){doTest(++gCurTestNum);});</span>
<a href="#l254.8"></a><span id="l254.8">   },</span>
<a href="#l254.9"></a><span id="l254.9">   function verifyFolders() {</span>
<a href="#l254.10"></a><span id="l254.10">     let msgRestored = gTestFolder.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l254.11"></a><span id="l254.11">     let msg = mailTestUtils.loadMessageToString(gTestFolder, msgRestored);</span>
<a href="#l254.12"></a><span id="l254.12" class="difflineminus">-    do_check_eq(msg, gMsg1.toMboxString());</span>
<a href="#l254.13"></a><span id="l254.13" class="difflineplus">+    Assert.equal(msg, gMsg1.toMboxString());</span>
<a href="#l254.14"></a><span id="l254.14">     doTest(++gCurTestNum);</span>
<a href="#l254.15"></a><span id="l254.15">   },</span>
<a href="#l254.16"></a><span id="l254.16"> ];</span>
<a href="#l254.17"></a><span id="l254.17"> </span>
<a href="#l254.18"></a><span id="l254.18"> function run_test()</span>
<a href="#l254.19"></a><span id="l254.19"> {</span>
<a href="#l254.20"></a><span id="l254.20">   configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l254.21"></a><span id="l254.21"> </span>
<a href="#l254.22"></a><span id="l254.22" class="difflineat">@@ -98,34 +98,34 @@ var CopyListener =</span>
<a href="#l254.23"></a><span id="l254.23">   OnStartCopy: function() {},</span>
<a href="#l254.24"></a><span id="l254.24">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l254.25"></a><span id="l254.25">   SetMessageKey: function(aKey){},</span>
<a href="#l254.26"></a><span id="l254.26">   SetMessageId: function(aMessageId) {},</span>
<a href="#l254.27"></a><span id="l254.27">   OnStopCopy: function(aStatus)</span>
<a href="#l254.28"></a><span id="l254.28">   {</span>
<a href="#l254.29"></a><span id="l254.29">     dump(&quot;in OnStopCopy &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l254.30"></a><span id="l254.30">     // Check: message successfully copied.</span>
<a href="#l254.31"></a><span id="l254.31" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l254.32"></a><span id="l254.32" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l254.33"></a><span id="l254.33">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l254.34"></a><span id="l254.34">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l254.35"></a><span id="l254.35">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l254.36"></a><span id="l254.36">     // to return</span>
<a href="#l254.37"></a><span id="l254.37">     do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l254.38"></a><span id="l254.38">   }</span>
<a href="#l254.39"></a><span id="l254.39"> };</span>
<a href="#l254.40"></a><span id="l254.40"> </span>
<a href="#l254.41"></a><span id="l254.41"> </span>
<a href="#l254.42"></a><span id="l254.42"> // nsIURLListener implementation - runs next test</span>
<a href="#l254.43"></a><span id="l254.43"> var URLListener =</span>
<a href="#l254.44"></a><span id="l254.44"> {</span>
<a href="#l254.45"></a><span id="l254.45">   OnStartRunningUrl: function(aURL) {},</span>
<a href="#l254.46"></a><span id="l254.46">   OnStopRunningUrl: function(aURL, aStatus)</span>
<a href="#l254.47"></a><span id="l254.47">   {</span>
<a href="#l254.48"></a><span id="l254.48">     dump(&quot;in OnStopRunningURL &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l254.49"></a><span id="l254.49" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l254.50"></a><span id="l254.50" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l254.51"></a><span id="l254.51">     do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l254.52"></a><span id="l254.52">   }</span>
<a href="#l254.53"></a><span id="l254.53"> }</span>
<a href="#l254.54"></a><span id="l254.54"> </span>
<a href="#l254.55"></a><span id="l254.55"> function endTest()</span>
<a href="#l254.56"></a><span id="l254.56"> {</span>
<a href="#l254.57"></a><span id="l254.57">   // Cleanup, null out everything</span>
<a href="#l254.58"></a><span id="l254.58">   gMessages.clear();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l255.1"></a><span id="l255.1" class="difflineminus">--- a/mailnews/local/test/unit/test_verifyLogon.js</span>
<a href="#l255.2"></a><span id="l255.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_verifyLogon.js</span>
<a href="#l255.3"></a><span id="l255.3" class="difflineat">@@ -33,17 +33,17 @@ function verifyPop3Logon(validPassword) </span>
<a href="#l255.4"></a><span id="l255.4"> }</span>
<a href="#l255.5"></a><span id="l255.5"> </span>
<a href="#l255.6"></a><span id="l255.6"> var urlListener =</span>
<a href="#l255.7"></a><span id="l255.7"> {</span>
<a href="#l255.8"></a><span id="l255.8">   expectSucess : false,</span>
<a href="#l255.9"></a><span id="l255.9">   OnStartRunningUrl: function (url) {</span>
<a href="#l255.10"></a><span id="l255.10">   },</span>
<a href="#l255.11"></a><span id="l255.11">   OnStopRunningUrl: function (url, aResult) {</span>
<a href="#l255.12"></a><span id="l255.12" class="difflineminus">-    do_check_eq(Components.isSuccessCode(aResult), this.expectSuccess);</span>
<a href="#l255.13"></a><span id="l255.13" class="difflineplus">+    Assert.equal(Components.isSuccessCode(aResult), this.expectSuccess);</span>
<a href="#l255.14"></a><span id="l255.14">   }</span>
<a href="#l255.15"></a><span id="l255.15"> };</span>
<a href="#l255.16"></a><span id="l255.16"> </span>
<a href="#l255.17"></a><span id="l255.17"> function actually_run_test() {</span>
<a href="#l255.18"></a><span id="l255.18">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l255.19"></a><span id="l255.19"> </span>
<a href="#l255.20"></a><span id="l255.20">   // check that verifyLogon fails with bad password</span>
<a href="#l255.21"></a><span id="l255.21">   verifyPop3Logon(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l256.1"></a><span id="l256.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js</span>
<a href="#l256.2"></a><span id="l256.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_EncodeMimePartIIStr_UTF8.js</span>
<a href="#l256.3"></a><span id="l256.3" class="difflineat">@@ -18,13 +18,13 @@ function run_test() {</span>
<a href="#l256.4"></a><span id="l256.4">     [&quot;crash test@foo.invalid&gt;&quot;, true, &quot;\&quot;crash test\&quot;@foo.invalid&quot;],</span>
<a href="#l256.5"></a><span id="l256.5">     [&quot;MXR now displays links to Github log &amp; Blame for\r\n Gaia/Rust/Servo&quot;, false,</span>
<a href="#l256.6"></a><span id="l256.6">      &quot;MXR now displays links to Github log &amp; Blame for\r\n Gaia/Rust/Servo&quot;],</span>
<a href="#l256.7"></a><span id="l256.7">     [&quot;-----------------------:&quot;, false, &quot;-----------------------:&quot;],</span>
<a href="#l256.8"></a><span id="l256.8">   ];</span>
<a href="#l256.9"></a><span id="l256.9"> </span>
<a href="#l256.10"></a><span id="l256.10">   for (i = 0; i &lt; checks.length; ++i)</span>
<a href="#l256.11"></a><span id="l256.11">   {</span>
<a href="#l256.12"></a><span id="l256.12" class="difflineminus">-    do_check_eq(</span>
<a href="#l256.13"></a><span id="l256.13" class="difflineplus">+    Assert.equal(</span>
<a href="#l256.14"></a><span id="l256.14">       MailServices.mimeConverter.encodeMimePartIIStr_UTF8(checks[i][0], checks[i][1], &quot;UTF-8&quot;, &quot;Subject&quot;.length, 72),</span>
<a href="#l256.15"></a><span id="l256.15">       checks[i][2]);</span>
<a href="#l256.16"></a><span id="l256.16">   }</span>
<a href="#l256.17"></a><span id="l256.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l257.1"></a><span id="l257.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_alternate_p7m_handling.js</span>
<a href="#l257.2"></a><span id="l257.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_alternate_p7m_handling.js</span>
<a href="#l257.3"></a><span id="l257.3" class="difflineat">@@ -33,17 +33,17 @@ function* thunderbird_default(info) {</span>
<a href="#l257.4"></a><span id="l257.4">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l257.5"></a><span id="l257.5">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l257.6"></a><span id="l257.6">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l257.7"></a><span id="l257.7"> </span>
<a href="#l257.8"></a><span id="l257.8">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l257.9"></a><span id="l257.9"> </span>
<a href="#l257.10"></a><span id="l257.10">   MsgHdrToMimeMessage(msgHdr, null, function (aMsgHdr, aMimeMsg) {</span>
<a href="#l257.11"></a><span id="l257.11">     try {</span>
<a href="#l257.12"></a><span id="l257.12" class="difflineminus">-      do_check_true(aMimeMsg.allUserAttachments.length == 0);</span>
<a href="#l257.13"></a><span id="l257.13" class="difflineplus">+      Assert.ok(aMimeMsg.allUserAttachments.length == 0);</span>
<a href="#l257.14"></a><span id="l257.14">       do_print(&quot;Strange p7m is discarded, so attachment number is 0 (thunderbird default behaviour)&quot;);</span>
<a href="#l257.15"></a><span id="l257.15">       async_driver();</span>
<a href="#l257.16"></a><span id="l257.16">     } catch (err) {</span>
<a href="#l257.17"></a><span id="l257.17">       do_throw(err);</span>
<a href="#l257.18"></a><span id="l257.18">     }</span>
<a href="#l257.19"></a><span id="l257.19">   });</span>
<a href="#l257.20"></a><span id="l257.20"> </span>
<a href="#l257.21"></a><span id="l257.21">   yield false;</span>
<a href="#l257.22"></a><span id="l257.22" class="difflineat">@@ -55,17 +55,17 @@ function* set_preference_to_true(info) {</span>
<a href="#l257.23"></a><span id="l257.23">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l257.24"></a><span id="l257.24"> </span>
<a href="#l257.25"></a><span id="l257.25">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l257.26"></a><span id="l257.26"> </span>
<a href="#l257.27"></a><span id="l257.27">   Services.prefs.setBoolPref(&quot;mailnews.p7m_external&quot;, true);</span>
<a href="#l257.28"></a><span id="l257.28"> </span>
<a href="#l257.29"></a><span id="l257.29">   MsgHdrToMimeMessage(msgHdr, null, function (aMsgHdr, aMimeMsg) {</span>
<a href="#l257.30"></a><span id="l257.30">     try {</span>
<a href="#l257.31"></a><span id="l257.31" class="difflineminus">-      do_check_true(aMimeMsg.allUserAttachments.length == 1);</span>
<a href="#l257.32"></a><span id="l257.32" class="difflineplus">+      Assert.ok(aMimeMsg.allUserAttachments.length == 1);</span>
<a href="#l257.33"></a><span id="l257.33">       do_print(&quot;Setting preference mailnews.p7m_external to true&quot;);</span>
<a href="#l257.34"></a><span id="l257.34">       do_print(&quot;Strange p7m is presented to the end user as attachment (attachment number = 1)&quot;);</span>
<a href="#l257.35"></a><span id="l257.35">       async_driver();</span>
<a href="#l257.36"></a><span id="l257.36">     } catch (err) {</span>
<a href="#l257.37"></a><span id="l257.37">       do_throw(err);</span>
<a href="#l257.38"></a><span id="l257.38">     }</span>
<a href="#l257.39"></a><span id="l257.39">   });</span>
<a href="#l257.40"></a><span id="l257.40"> </span>
<a href="#l257.41"></a><span id="l257.41" class="difflineat">@@ -78,17 +78,17 @@ function* set_preference_to_false(info) </span>
<a href="#l257.42"></a><span id="l257.42">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l257.43"></a><span id="l257.43"> </span>
<a href="#l257.44"></a><span id="l257.44">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l257.45"></a><span id="l257.45"> </span>
<a href="#l257.46"></a><span id="l257.46">   Services.prefs.setBoolPref(&quot;mailnews.p7m_external&quot;, false);</span>
<a href="#l257.47"></a><span id="l257.47"> </span>
<a href="#l257.48"></a><span id="l257.48">   MsgHdrToMimeMessage(msgHdr, null, function (aMsgHdr, aMimeMsg) {</span>
<a href="#l257.49"></a><span id="l257.49">     try {</span>
<a href="#l257.50"></a><span id="l257.50" class="difflineminus">-      do_check_true(aMimeMsg.allUserAttachments.length == 0);</span>
<a href="#l257.51"></a><span id="l257.51" class="difflineplus">+      Assert.ok(aMimeMsg.allUserAttachments.length == 0);</span>
<a href="#l257.52"></a><span id="l257.52">       do_print(&quot;Setting preference mailnews.p7m_external to false&quot;);</span>
<a href="#l257.53"></a><span id="l257.53">       do_print(&quot;Strange p7m is discarded, so attachment number is 0 (thunderbird default behaviour)&quot;);</span>
<a href="#l257.54"></a><span id="l257.54">       async_driver();</span>
<a href="#l257.55"></a><span id="l257.55">     } catch (err) {</span>
<a href="#l257.56"></a><span id="l257.56">       do_throw(err);</span>
<a href="#l257.57"></a><span id="l257.57">     }</span>
<a href="#l257.58"></a><span id="l257.58">   });</span>
<a href="#l257.59"></a><span id="l257.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l258.1"></a><span id="l258.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_attachment_size.js</span>
<a href="#l258.2"></a><span id="l258.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_attachment_size.js</span>
<a href="#l258.3"></a><span id="l258.3" class="difflineat">@@ -207,17 +207,17 @@ var gStreamListener = {</span>
<a href="#l258.4"></a><span id="l258.4">     //  attachments, this allows us to properly discard the nested attachment</span>
<a href="#l258.5"></a><span id="l258.5">     //  sizes.</span>
<a href="#l258.6"></a><span id="l258.6">     // msgHdrViewOverlay.js has a stack of attachment infos that properly</span>
<a href="#l258.7"></a><span id="l258.7">     //  handles this.</span>
<a href="#l258.8"></a><span id="l258.8">     gMessageHeaderSink.size = null;</span>
<a href="#l258.9"></a><span id="l258.9">   },</span>
<a href="#l258.10"></a><span id="l258.10">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l258.11"></a><span id="l258.11">     dump(&quot;*** Size is &quot;+gMessageHeaderSink.size+&quot; (expecting &quot;+this.expectedSize+&quot;)\n\n&quot;);</span>
<a href="#l258.12"></a><span id="l258.12" class="difflineminus">-    do_check_true(Math.abs(gMessageHeaderSink.size - this.expectedSize) &lt;= epsilon);</span>
<a href="#l258.13"></a><span id="l258.13" class="difflineplus">+    Assert.ok(Math.abs(gMessageHeaderSink.size - this.expectedSize) &lt;= epsilon);</span>
<a href="#l258.14"></a><span id="l258.14">     this._stream = null;</span>
<a href="#l258.15"></a><span id="l258.15">     async_driver();</span>
<a href="#l258.16"></a><span id="l258.16">   },</span>
<a href="#l258.17"></a><span id="l258.17"> </span>
<a href="#l258.18"></a><span id="l258.18">   // nsIStreamListener part</span>
<a href="#l258.19"></a><span id="l258.19">   _stream : null,</span>
<a href="#l258.20"></a><span id="l258.20"> </span>
<a href="#l258.21"></a><span id="l258.21">   onDataAvailable: function (aRequest,aContext,aInputStream,aOffset,aCount) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l259.1"></a><span id="l259.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_badContentType.js</span>
<a href="#l259.2"></a><span id="l259.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_badContentType.js</span>
<a href="#l259.3"></a><span id="l259.3" class="difflineat">@@ -53,17 +53,17 @@ var gStreamListener = {</span>
<a href="#l259.4"></a><span id="l259.4">     // We reset the size here because we know that we only expect one attachment</span>
<a href="#l259.5"></a><span id="l259.5">     //  per test email</span>
<a href="#l259.6"></a><span id="l259.6">     // msgHdrViewOverlay.js has a stack of attachment infos that properly</span>
<a href="#l259.7"></a><span id="l259.7">     //  handles this.</span>
<a href="#l259.8"></a><span id="l259.8">     gMessageHeaderSink.size = null;</span>
<a href="#l259.9"></a><span id="l259.9">   },</span>
<a href="#l259.10"></a><span id="l259.10">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l259.11"></a><span id="l259.11">     dump(&quot;*** ContentType is &quot;+gMessageHeaderSink.contentType+&quot; (expecting &quot;+this.expectedContentType+&quot;)\n\n&quot;);</span>
<a href="#l259.12"></a><span id="l259.12" class="difflineminus">-    do_check_eq(gMessageHeaderSink.contentType, this.expectedContentType);</span>
<a href="#l259.13"></a><span id="l259.13" class="difflineplus">+    Assert.equal(gMessageHeaderSink.contentType, this.expectedContentType);</span>
<a href="#l259.14"></a><span id="l259.14">     this._stream = null;</span>
<a href="#l259.15"></a><span id="l259.15">     async_driver();</span>
<a href="#l259.16"></a><span id="l259.16">   },</span>
<a href="#l259.17"></a><span id="l259.17"> </span>
<a href="#l259.18"></a><span id="l259.18">   // nsIStreamListener part</span>
<a href="#l259.19"></a><span id="l259.19">   _stream : null,</span>
<a href="#l259.20"></a><span id="l259.20"> </span>
<a href="#l259.21"></a><span id="l259.21">   onDataAvailable: function (aRequest,aContext,aInputStream,aOffset,aCount) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l260.1"></a><span id="l260.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_bug493544.js</span>
<a href="#l260.2"></a><span id="l260.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_bug493544.js</span>
<a href="#l260.3"></a><span id="l260.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l260.4"></a><span id="l260.4" class="difflineminus">-﻿//</span>
<a href="#l260.5"></a><span id="l260.5" class="difflineplus">+//</span>
<a href="#l260.6"></a><span id="l260.6"> // Tests if a multi-line MIME header is parsed even if it violates RFC 2047</span>
<a href="#l260.7"></a><span id="l260.7"> //</span>
<a href="#l260.8"></a><span id="l260.8"> </span>
<a href="#l260.9"></a><span id="l260.9"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l260.10"></a><span id="l260.10"> </span>
<a href="#l260.11"></a><span id="l260.11"> function run_test() {</span>
<a href="#l260.12"></a><span id="l260.12">   const headers = [</span>
<a href="#l260.13"></a><span id="l260.13">     { encoded:</span>
<a href="#l260.14"></a><span id="l260.14" class="difflineat">@@ -76,11 +76,11 @@ function run_test() {</span>
<a href="#l260.15"></a><span id="l260.15">     }, // Regression test for bug 227290</span>
<a href="#l260.16"></a><span id="l260.16">   ];</span>
<a href="#l260.17"></a><span id="l260.17"> </span>
<a href="#l260.18"></a><span id="l260.18">   for (let i = 0; i &lt; headers.length; ++i) {</span>
<a href="#l260.19"></a><span id="l260.19">     let decoded = MailServices.mimeConverter.decodeMimeHeader(headers[i].encoded,</span>
<a href="#l260.20"></a><span id="l260.20">                                                               headers[i].defaultCharset,</span>
<a href="#l260.21"></a><span id="l260.21">                                                               headers[i].overrideCharset,</span>
<a href="#l260.22"></a><span id="l260.22">                                                               headers[i].eatContinuation);</span>
<a href="#l260.23"></a><span id="l260.23" class="difflineminus">-    do_check_eq(decoded, headers[i].decoded);</span>
<a href="#l260.24"></a><span id="l260.24" class="difflineplus">+    Assert.equal(decoded, headers[i].decoded);</span>
<a href="#l260.25"></a><span id="l260.25">   }</span>
<a href="#l260.26"></a><span id="l260.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l261.1"></a><span id="l261.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_hidden_attachments.js</span>
<a href="#l261.2"></a><span id="l261.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_hidden_attachments.js</span>
<a href="#l261.3"></a><span id="l261.3" class="difflineat">@@ -97,25 +97,25 @@ var gStreamListener = {</span>
<a href="#l261.4"></a><span id="l261.4">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l261.5"></a><span id="l261.5"> </span>
<a href="#l261.6"></a><span id="l261.6">   // nsIRequestObserver part</span>
<a href="#l261.7"></a><span id="l261.7">   onStartRequest: function (aRequest, aContext) {</span>
<a href="#l261.8"></a><span id="l261.8">   },</span>
<a href="#l261.9"></a><span id="l261.9">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l261.10"></a><span id="l261.10">     let expectedAttachments = this.allAttachments.filter(i =&gt; i.shouldShow).</span>
<a href="#l261.11"></a><span id="l261.11">       map(i =&gt; i.filename);</span>
<a href="#l261.12"></a><span id="l261.12" class="difflineminus">-    do_check_eq(expectedAttachments.length,</span>
<a href="#l261.13"></a><span id="l261.13" class="difflineminus">-                gMessageHeaderSink.attachments.length);</span>
<a href="#l261.14"></a><span id="l261.14" class="difflineplus">+    Assert.equal(expectedAttachments.length,</span>
<a href="#l261.15"></a><span id="l261.15" class="difflineplus">+                 gMessageHeaderSink.attachments.length);</span>
<a href="#l261.16"></a><span id="l261.16"> </span>
<a href="#l261.17"></a><span id="l261.17">     for (let i = 0; i &lt; gMessageHeaderSink.attachments.length; i++) {</span>
<a href="#l261.18"></a><span id="l261.18">       // If the expected attachment's name is empty, we probably generated a</span>
<a href="#l261.19"></a><span id="l261.19">       // name like &quot;Part 1.2&quot;, so don't bother checking that the names match</span>
<a href="#l261.20"></a><span id="l261.20">       // (they won't).</span>
<a href="#l261.21"></a><span id="l261.21">       if (expectedAttachments[i])</span>
<a href="#l261.22"></a><span id="l261.22" class="difflineminus">-        do_check_eq(expectedAttachments[i], gMessageHeaderSink.attachments[i]);</span>
<a href="#l261.23"></a><span id="l261.23" class="difflineplus">+        Assert.equal(expectedAttachments[i], gMessageHeaderSink.attachments[i]);</span>
<a href="#l261.24"></a><span id="l261.24">     }</span>
<a href="#l261.25"></a><span id="l261.25">     this._stream = null;</span>
<a href="#l261.26"></a><span id="l261.26"> </span>
<a href="#l261.27"></a><span id="l261.27">     async_driver();</span>
<a href="#l261.28"></a><span id="l261.28">   },</span>
<a href="#l261.29"></a><span id="l261.29"> </span>
<a href="#l261.30"></a><span id="l261.30">   // nsIStreamListener part</span>
<a href="#l261.31"></a><span id="l261.31">   _stream : null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l262.1"></a><span id="l262.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_jsmime_charset.js</span>
<a href="#l262.2"></a><span id="l262.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_jsmime_charset.js</span>
<a href="#l262.3"></a><span id="l262.3" class="difflineat">@@ -16,12 +16,12 @@ var tests = [</span>
<a href="#l262.4"></a><span id="l262.4"> ];</span>
<a href="#l262.5"></a><span id="l262.5"> </span>
<a href="#l262.6"></a><span id="l262.6"> function run_test() {</span>
<a href="#l262.7"></a><span id="l262.7">   for (let test of tests) {</span>
<a href="#l262.8"></a><span id="l262.8">     dump(&quot;Testing message &quot; + test[0]);</span>
<a href="#l262.9"></a><span id="l262.9">     let value = test[0];</span>
<a href="#l262.10"></a><span id="l262.10">     if (test.length &gt; 2)</span>
<a href="#l262.11"></a><span id="l262.11">       value = jsmime.headerparser.convert8BitHeader(value, test[2])</span>
<a href="#l262.12"></a><span id="l262.12" class="difflineminus">-    do_check_eq(jsmime.headerparser.parseStructuredHeader(&quot;Subject&quot;, value),</span>
<a href="#l262.13"></a><span id="l262.13" class="difflineplus">+    Assert.equal(jsmime.headerparser.parseStructuredHeader(&quot;Subject&quot;, value),</span>
<a href="#l262.14"></a><span id="l262.14">       test[1]);</span>
<a href="#l262.15"></a><span id="l262.15">   }</span>
<a href="#l262.16"></a><span id="l262.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l263.1"></a><span id="l263.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_message_attachment.js</span>
<a href="#l263.2"></a><span id="l263.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_message_attachment.js</span>
<a href="#l263.3"></a><span id="l263.3" class="difflineat">@@ -72,20 +72,20 @@ var gStreamListener = {</span>
<a href="#l263.4"></a><span id="l263.4">   },</span>
<a href="#l263.5"></a><span id="l263.5">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l263.6"></a><span id="l263.6">     // Check that the attachments' filenames are as expected. Just use a regex</span>
<a href="#l263.7"></a><span id="l263.7">     // here because it's simple.</span>
<a href="#l263.8"></a><span id="l263.8">     let regex = /&lt;legend class=&quot;mimeAttachmentHeaderName&quot;&gt;(.*?)&lt;\/legend&gt;/gi;</span>
<a href="#l263.9"></a><span id="l263.9"> </span>
<a href="#l263.10"></a><span id="l263.10">     for (let attachment of messages[this.index].attachments) {</span>
<a href="#l263.11"></a><span id="l263.11">       let match = regex.exec(this.contents);</span>
<a href="#l263.12"></a><span id="l263.12" class="difflineminus">-      do_check_neq(match, null);</span>
<a href="#l263.13"></a><span id="l263.13" class="difflineminus">-      do_check_eq(match[1], attachment.expectedFilename || attachment.filename);</span>
<a href="#l263.14"></a><span id="l263.14" class="difflineplus">+      Assert.notEqual(match, null);</span>
<a href="#l263.15"></a><span id="l263.15" class="difflineplus">+      Assert.equal(match[1], attachment.expectedFilename || attachment.filename);</span>
<a href="#l263.16"></a><span id="l263.16">     }</span>
<a href="#l263.17"></a><span id="l263.17" class="difflineminus">-    do_check_eq(regex.exec(this.contents), null);</span>
<a href="#l263.18"></a><span id="l263.18" class="difflineplus">+    Assert.equal(regex.exec(this.contents), null);</span>
<a href="#l263.19"></a><span id="l263.19"> </span>
<a href="#l263.20"></a><span id="l263.20">     this.index++;</span>
<a href="#l263.21"></a><span id="l263.21">     async_driver();</span>
<a href="#l263.22"></a><span id="l263.22">   },</span>
<a href="#l263.23"></a><span id="l263.23"> </span>
<a href="#l263.24"></a><span id="l263.24">   // nsIStreamListener part</span>
<a href="#l263.25"></a><span id="l263.25">   onDataAvailable: function (aRequest,aContext,aInputStream,aOffset,aCount) {</span>
<a href="#l263.26"></a><span id="l263.26">     if (this.stream === null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l264.1"></a><span id="l264.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_mimeContentType.js</span>
<a href="#l264.2"></a><span id="l264.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_mimeContentType.js</span>
<a href="#l264.3"></a><span id="l264.3" class="difflineat">@@ -67,11 +67,11 @@ function run_test()</span>
<a href="#l264.4"></a><span id="l264.4">                   .createInstance(Components.interfaces.nsIMimeHeaders);</span>
<a href="#l264.5"></a><span id="l264.5"> </span>
<a href="#l264.6"></a><span id="l264.6">   for (let i = 0; i &lt; headers.length; i++) {</span>
<a href="#l264.7"></a><span id="l264.7">     mimeHdr.initialize(headers[i].header);</span>
<a href="#l264.8"></a><span id="l264.8">     let receivedHeader = mimeHdr.extractHeader(&quot;Content-Type&quot;, false);</span>
<a href="#l264.9"></a><span id="l264.9"> </span>
<a href="#l264.10"></a><span id="l264.10">     dump(&quot;\nTesting Content-Type: &quot; + receivedHeader + &quot; == &quot; + headers[i].result + &quot;\n&quot;);</span>
<a href="#l264.11"></a><span id="l264.11"> </span>
<a href="#l264.12"></a><span id="l264.12" class="difflineminus">-    do_check_eq(receivedHeader, headers[i].result);</span>
<a href="#l264.13"></a><span id="l264.13" class="difflineplus">+    Assert.equal(receivedHeader, headers[i].result);</span>
<a href="#l264.14"></a><span id="l264.14">   }</span>
<a href="#l264.15"></a><span id="l264.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l265.1"></a><span id="l265.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js</span>
<a href="#l265.2"></a><span id="l265.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_nsIMsgHeaderParser1.js</span>
<a href="#l265.3"></a><span id="l265.3" class="difflineat">@@ -23,16 +23,16 @@ function run_test() {</span>
<a href="#l265.4"></a><span id="l265.4">     [&quot;trailing&quot;, &quot;t1@example.com &quot;, &quot;trailing &lt;t1@example.com&gt;&quot;],</span>
<a href="#l265.5"></a><span id="l265.5">     [&quot;leading&quot;, &quot; t2@example.com&quot;, &quot;leading &lt;t2@example.com&gt;&quot;],</span>
<a href="#l265.6"></a><span id="l265.6">     [&quot;leading trailing&quot;, &quot; t3@example.com  &quot;, &quot;leading trailing &lt;t3@example.com&gt;&quot;],</span>
<a href="#l265.7"></a><span id="l265.7">     [&quot;&quot;, &quot; t4@example.com  &quot;, &quot;t4@example.com&quot;],</span>
<a href="#l265.8"></a><span id="l265.8">   ];</span>
<a href="#l265.9"></a><span id="l265.9"> </span>
<a href="#l265.10"></a><span id="l265.10">   // Test - empty strings</span>
<a href="#l265.11"></a><span id="l265.11"> </span>
<a href="#l265.12"></a><span id="l265.12" class="difflineminus">-  do_check_eq(MailServices.headerParser.makeMimeAddress(&quot;&quot;, &quot;&quot;), &quot;&quot;);</span>
<a href="#l265.13"></a><span id="l265.13" class="difflineplus">+  Assert.equal(MailServices.headerParser.makeMimeAddress(&quot;&quot;, &quot;&quot;), &quot;&quot;);</span>
<a href="#l265.14"></a><span id="l265.14"> </span>
<a href="#l265.15"></a><span id="l265.15">   // Test - makeMimeAddress</span>
<a href="#l265.16"></a><span id="l265.16"> </span>
<a href="#l265.17"></a><span id="l265.17">   for (let i = 0; i &lt; checks.length; ++i)</span>
<a href="#l265.18"></a><span id="l265.18" class="difflineminus">-    do_check_eq(MailServices.headerParser.makeMimeAddress(checks[i][0], checks[i][1]),</span>
<a href="#l265.19"></a><span id="l265.19" class="difflineminus">-                checks[i][2]);</span>
<a href="#l265.20"></a><span id="l265.20" class="difflineplus">+    Assert.equal(MailServices.headerParser.makeMimeAddress(checks[i][0], checks[i][1]),</span>
<a href="#l265.21"></a><span id="l265.21" class="difflineplus">+                 checks[i][2]);</span>
<a href="#l265.22"></a><span id="l265.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l266.1"></a><span id="l266.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js</span>
<a href="#l266.2"></a><span id="l266.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_nsIMsgHeaderParser2.js</span>
<a href="#l266.3"></a><span id="l266.3" class="difflineat">@@ -56,20 +56,20 @@ function run_test() {</span>
<a href="#l266.4"></a><span id="l266.4"> </span>
<a href="#l266.5"></a><span id="l266.5">   // this used to cause memory read overruns</span>
<a href="#l266.6"></a><span id="l266.6">   let addresses = {}, names = {}, fullAddresses = {};</span>
<a href="#l266.7"></a><span id="l266.7">   MailServices.headerParser.parseHeadersWithArray(&quot;\&quot; \&quot;@a a;b&quot;, addresses, names, fullAddresses);</span>
<a href="#l266.8"></a><span id="l266.8"> </span>
<a href="#l266.9"></a><span id="l266.9"> </span>
<a href="#l266.10"></a><span id="l266.10">   // Test - empty strings</span>
<a href="#l266.11"></a><span id="l266.11"> </span>
<a href="#l266.12"></a><span id="l266.12" class="difflineminus">-  do_check_eq(MailServices.headerParser.extractHeaderAddressMailboxes(&quot;&quot;), &quot;&quot;);</span>
<a href="#l266.13"></a><span id="l266.13" class="difflineminus">-  do_check_eq(MailServices.headerParser.extractHeaderAddressNames(&quot;&quot;), &quot;&quot;);</span>
<a href="#l266.14"></a><span id="l266.14" class="difflineminus">-  do_check_eq(MailServices.headerParser.extractHeaderAddressName(&quot;&quot;), &quot;&quot;);</span>
<a href="#l266.15"></a><span id="l266.15" class="difflineplus">+  Assert.equal(MailServices.headerParser.extractHeaderAddressMailboxes(&quot;&quot;), &quot;&quot;);</span>
<a href="#l266.16"></a><span id="l266.16" class="difflineplus">+  Assert.equal(MailServices.headerParser.extractHeaderAddressNames(&quot;&quot;), &quot;&quot;);</span>
<a href="#l266.17"></a><span id="l266.17" class="difflineplus">+  Assert.equal(MailServices.headerParser.extractHeaderAddressName(&quot;&quot;), &quot;&quot;);</span>
<a href="#l266.18"></a><span id="l266.18"> </span>
<a href="#l266.19"></a><span id="l266.19">   // Test - extractHeaderAddressMailboxes</span>
<a href="#l266.20"></a><span id="l266.20"> </span>
<a href="#l266.21"></a><span id="l266.21">   for (let i = 0; i &lt; checks.length; ++i) {</span>
<a href="#l266.22"></a><span id="l266.22" class="difflineminus">-    do_check_eq(MailServices.headerParser.extractHeaderAddressMailboxes(checks[i][0]), checks[i][1]);</span>
<a href="#l266.23"></a><span id="l266.23" class="difflineminus">-    do_check_eq(MailServices.headerParser.extractHeaderAddressNames(checks[i][0]), checks[i][2]);</span>
<a href="#l266.24"></a><span id="l266.24" class="difflineminus">-    do_check_eq(MailServices.headerParser.extractHeaderAddressName(checks[i][0]), checks[i][3]);</span>
<a href="#l266.25"></a><span id="l266.25" class="difflineplus">+    Assert.equal(MailServices.headerParser.extractHeaderAddressMailboxes(checks[i][0]), checks[i][1]);</span>
<a href="#l266.26"></a><span id="l266.26" class="difflineplus">+    Assert.equal(MailServices.headerParser.extractHeaderAddressNames(checks[i][0]), checks[i][2]);</span>
<a href="#l266.27"></a><span id="l266.27" class="difflineplus">+    Assert.equal(MailServices.headerParser.extractHeaderAddressName(checks[i][0]), checks[i][3]);</span>
<a href="#l266.28"></a><span id="l266.28">   }</span>
<a href="#l266.29"></a><span id="l266.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l267.1"></a><span id="l267.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js</span>
<a href="#l267.2"></a><span id="l267.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_nsIMsgHeaderParser3.js</span>
<a href="#l267.3"></a><span id="l267.3" class="difflineat">@@ -54,20 +54,20 @@ function run_test() {</span>
<a href="#l267.4"></a><span id="l267.4">       expectedResult: &quot;A group: foo bar &lt;foo@bar.invalid&gt;;&quot; },</span>
<a href="#l267.5"></a><span id="l267.5">     { addrs: &quot;A group: foo bar &lt;foo@bar.invalid&gt;;, foo &lt;ghj@foo.invalid&gt;&quot;,</span>
<a href="#l267.6"></a><span id="l267.6">       otherAddrs: &quot;foo &lt;foo@bar.invalid&gt;&quot;,</span>
<a href="#l267.7"></a><span id="l267.7">       expectedResult: &quot;A group: ; , foo &lt;ghj@foo.invalid&gt;&quot; },</span>
<a href="#l267.8"></a><span id="l267.8">   ];</span>
<a href="#l267.9"></a><span id="l267.9"> </span>
<a href="#l267.10"></a><span id="l267.10">   // Test - empty strings</span>
<a href="#l267.11"></a><span id="l267.11"> </span>
<a href="#l267.12"></a><span id="l267.12" class="difflineminus">-  do_check_eq(MailServices.headerParser.removeDuplicateAddresses(&quot;&quot;, &quot;&quot;), &quot;&quot;);</span>
<a href="#l267.13"></a><span id="l267.13" class="difflineminus">-  do_check_eq(MailServices.headerParser.removeDuplicateAddresses(&quot;&quot;, &quot;test@foo.invalid&quot;), &quot;&quot;);</span>
<a href="#l267.14"></a><span id="l267.14" class="difflineplus">+  Assert.equal(MailServices.headerParser.removeDuplicateAddresses(&quot;&quot;, &quot;&quot;), &quot;&quot;);</span>
<a href="#l267.15"></a><span id="l267.15" class="difflineplus">+  Assert.equal(MailServices.headerParser.removeDuplicateAddresses(&quot;&quot;, &quot;test@foo.invalid&quot;), &quot;&quot;);</span>
<a href="#l267.16"></a><span id="l267.16"> </span>
<a href="#l267.17"></a><span id="l267.17">   // Test - removeDuplicateAddresses</span>
<a href="#l267.18"></a><span id="l267.18"> </span>
<a href="#l267.19"></a><span id="l267.19">   for (let i = 0; i &lt; checks.length; ++i) {</span>
<a href="#l267.20"></a><span id="l267.20">     dump(&quot;Test &quot; + i + &quot;\n&quot;);</span>
<a href="#l267.21"></a><span id="l267.21" class="difflineminus">-    do_check_eq(MailServices.headerParser.removeDuplicateAddresses(checks[i].addrs,</span>
<a href="#l267.22"></a><span id="l267.22" class="difflineminus">-                checks[i].otherAddrs),</span>
<a href="#l267.23"></a><span id="l267.23" class="difflineplus">+    Assert.equal(MailServices.headerParser.removeDuplicateAddresses(checks[i].addrs,</span>
<a href="#l267.24"></a><span id="l267.24" class="difflineplus">+                 checks[i].otherAddrs),</span>
<a href="#l267.25"></a><span id="l267.25">     checks[i].expectedResult);</span>
<a href="#l267.26"></a><span id="l267.26">   }</span>
<a href="#l267.27"></a><span id="l267.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l268.1"></a><span id="l268.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js</span>
<a href="#l268.2"></a><span id="l268.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_nsIMsgHeaderParser4.js</span>
<a href="#l268.3"></a><span id="l268.3" class="difflineat">@@ -53,15 +53,15 @@ function run_test() {</span>
<a href="#l268.4"></a><span id="l268.4">   ];</span>
<a href="#l268.5"></a><span id="l268.5"> </span>
<a href="#l268.6"></a><span id="l268.6">   // Test -  strings</span>
<a href="#l268.7"></a><span id="l268.7"> </span>
<a href="#l268.8"></a><span id="l268.8">   for (let i = 0; i &lt; checks.length; ++i) {</span>
<a href="#l268.9"></a><span id="l268.9">     dump(&quot;Test &quot; + i + &quot;\n&quot;);</span>
<a href="#l268.10"></a><span id="l268.10">     let addrs = MailServices.headerParser.makeFromDisplayAddress(checks[i].displayString, {});</span>
<a href="#l268.11"></a><span id="l268.11">     let checkaddrs = checks[i].addresses;</span>
<a href="#l268.12"></a><span id="l268.12" class="difflineminus">-    do_check_eq(addrs.length, checkaddrs.length);</span>
<a href="#l268.13"></a><span id="l268.13" class="difflineplus">+    Assert.equal(addrs.length, checkaddrs.length);</span>
<a href="#l268.14"></a><span id="l268.14">     for (let j = 0; j &lt; addrs.length; j++) {</span>
<a href="#l268.15"></a><span id="l268.15" class="difflineminus">-      do_check_eq(addrs[j].name, checkaddrs[j][0]);</span>
<a href="#l268.16"></a><span id="l268.16" class="difflineminus">-      do_check_eq(addrs[j].email, checkaddrs[j][1]);</span>
<a href="#l268.17"></a><span id="l268.17" class="difflineplus">+      Assert.equal(addrs[j].name, checkaddrs[j][0]);</span>
<a href="#l268.18"></a><span id="l268.18" class="difflineplus">+      Assert.equal(addrs[j].email, checkaddrs[j][1]);</span>
<a href="#l268.19"></a><span id="l268.19">     }</span>
<a href="#l268.20"></a><span id="l268.20">   }</span>
<a href="#l268.21"></a><span id="l268.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l269.1"></a><span id="l269.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js</span>
<a href="#l269.2"></a><span id="l269.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_nsIMsgHeaderParser5.js</span>
<a href="#l269.3"></a><span id="l269.3" class="difflineat">@@ -3,20 +3,20 @@</span>
<a href="#l269.4"></a><span id="l269.4">  * Test suite for nsIMsgHeaderParser functions:</span>
<a href="#l269.5"></a><span id="l269.5">  *   parseDecodedHeader</span>
<a href="#l269.6"></a><span id="l269.6">  *   parseEncodedHeader</span>
<a href="#l269.7"></a><span id="l269.7">  */</span>
<a href="#l269.8"></a><span id="l269.8"> </span>
<a href="#l269.9"></a><span id="l269.9"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l269.10"></a><span id="l269.10"> </span>
<a href="#l269.11"></a><span id="l269.11"> function equalArrays(arr1, arr2) {</span>
<a href="#l269.12"></a><span id="l269.12" class="difflineminus">-  do_check_eq(arr1.length, arr2.length);</span>
<a href="#l269.13"></a><span id="l269.13" class="difflineplus">+  Assert.equal(arr1.length, arr2.length);</span>
<a href="#l269.14"></a><span id="l269.14">   for (let i = 0; i &lt; arr1.length; i++) {</span>
<a href="#l269.15"></a><span id="l269.15" class="difflineminus">-    do_check_eq(arr1[i].name, arr2[i].name);</span>
<a href="#l269.16"></a><span id="l269.16" class="difflineminus">-    do_check_eq(arr1[i].email, arr2[i].email);</span>
<a href="#l269.17"></a><span id="l269.17" class="difflineplus">+    Assert.equal(arr1[i].name, arr2[i].name);</span>
<a href="#l269.18"></a><span id="l269.18" class="difflineplus">+    Assert.equal(arr1[i].email, arr2[i].email);</span>
<a href="#l269.19"></a><span id="l269.19">   }</span>
<a href="#l269.20"></a><span id="l269.20"> }</span>
<a href="#l269.21"></a><span id="l269.21"> </span>
<a href="#l269.22"></a><span id="l269.22"> function run_test() {</span>
<a href="#l269.23"></a><span id="l269.23">   // In this array, the sub arrays consist of the following elements:</span>
<a href="#l269.24"></a><span id="l269.24">   // 0: input string</span>
<a href="#l269.25"></a><span id="l269.25">   // 1: expected output from parseDecodedHeader</span>
<a href="#l269.26"></a><span id="l269.26">   // 2: expected output from parseEncodedHeader</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l270.1"></a><span id="l270.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_parseHeadersWithArray.js</span>
<a href="#l270.2"></a><span id="l270.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_parseHeadersWithArray.js</span>
<a href="#l270.3"></a><span id="l270.3" class="difflineat">@@ -4,13 +4,13 @@</span>
<a href="#l270.4"></a><span id="l270.4">  */</span>
<a href="#l270.5"></a><span id="l270.5"> </span>
<a href="#l270.6"></a><span id="l270.6"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l270.7"></a><span id="l270.7"> </span>
<a href="#l270.8"></a><span id="l270.8"> function run_test() {</span>
<a href="#l270.9"></a><span id="l270.9">   let addresses = {}, names = {}, fullAddresses = {};</span>
<a href="#l270.10"></a><span id="l270.10">   let n = MailServices.headerParser.parseHeadersWithArray(&quot;example@host.invalid&quot;,</span>
<a href="#l270.11"></a><span id="l270.11">                                                           addresses, names, fullAddresses);</span>
<a href="#l270.12"></a><span id="l270.12" class="difflineminus">-  do_check_eq(1, n);</span>
<a href="#l270.13"></a><span id="l270.13" class="difflineminus">-  do_check_eq(&quot;example@host.invalid&quot;, addresses.value[0]);</span>
<a href="#l270.14"></a><span id="l270.14" class="difflineminus">-  do_check_eq(null, names.value[0]);</span>
<a href="#l270.15"></a><span id="l270.15" class="difflineminus">-  do_check_eq(&quot;example@host.invalid&quot;, fullAddresses.value[0]);</span>
<a href="#l270.16"></a><span id="l270.16" class="difflineplus">+  Assert.equal(1, n);</span>
<a href="#l270.17"></a><span id="l270.17" class="difflineplus">+  Assert.equal(&quot;example@host.invalid&quot;, addresses.value[0]);</span>
<a href="#l270.18"></a><span id="l270.18" class="difflineplus">+  Assert.equal(null, names.value[0]);</span>
<a href="#l270.19"></a><span id="l270.19" class="difflineplus">+  Assert.equal(&quot;example@host.invalid&quot;, fullAddresses.value[0]);</span>
<a href="#l270.20"></a><span id="l270.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l271.1"></a><span id="l271.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_parser.js</span>
<a href="#l271.2"></a><span id="l271.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_parser.js</span>
<a href="#l271.3"></a><span id="l271.3" class="difflineat">@@ -18,19 +18,19 @@ function compare_objects(real, expected)</span>
<a href="#l271.4"></a><span id="l271.4">     for (let [k, v] of real) {</span>
<a href="#l271.5"></a><span id="l271.5">       newreal[k] = v;</span>
<a href="#l271.6"></a><span id="l271.6">     }</span>
<a href="#l271.7"></a><span id="l271.7">     real = newreal;</span>
<a href="#l271.8"></a><span id="l271.8">   }</span>
<a href="#l271.9"></a><span id="l271.9">   var a = uneval(real), b = uneval(expected);</span>
<a href="#l271.10"></a><span id="l271.10">   // Very long strings don't get printed out fully (unless they're wrong)</span>
<a href="#l271.11"></a><span id="l271.11">   if ((a.length &gt; 100 || b.length &gt; 100) &amp;&amp; (a == b))</span>
<a href="#l271.12"></a><span id="l271.12" class="difflineminus">-    do_check_true(a == b);</span>
<a href="#l271.13"></a><span id="l271.13" class="difflineplus">+    Assert.ok(a == b);</span>
<a href="#l271.14"></a><span id="l271.14">   else</span>
<a href="#l271.15"></a><span id="l271.15" class="difflineminus">-    do_check_eq(a, b);</span>
<a href="#l271.16"></a><span id="l271.16" class="difflineplus">+    Assert.equal(a, b);</span>
<a href="#l271.17"></a><span id="l271.17"> }</span>
<a href="#l271.18"></a><span id="l271.18"> </span>
<a href="#l271.19"></a><span id="l271.19"> /// Returns and deletes object[field] if present, or undefined if not.</span>
<a href="#l271.20"></a><span id="l271.20"> function extract_field(object, field) {</span>
<a href="#l271.21"></a><span id="l271.21">   if (field in object) {</span>
<a href="#l271.22"></a><span id="l271.22">     var result = object[field];</span>
<a href="#l271.23"></a><span id="l271.23">     delete object[field];</span>
<a href="#l271.24"></a><span id="l271.24">     return result;</span>
<a href="#l271.25"></a><span id="l271.25" class="difflineat">@@ -142,64 +142,64 @@ var parser_tests = [</span>
<a href="#l271.26"></a><span id="l271.26"> </span>
<a href="#l271.27"></a><span id="l271.27"> function test_parser(message, opts, results) {</span>
<a href="#l271.28"></a><span id="l271.28">   var checkingHeaders = !(results instanceof Array);</span>
<a href="#l271.29"></a><span id="l271.29">   var calls = 0, dataCalls = 0;</span>
<a href="#l271.30"></a><span id="l271.30">   var fusingParts = extract_field(opts, &quot;_nofuseparts&quot;) === undefined;</span>
<a href="#l271.31"></a><span id="l271.31">   var emitter = {</span>
<a href="#l271.32"></a><span id="l271.32">     stack: [],</span>
<a href="#l271.33"></a><span id="l271.33">     startMessage: function emitter_startMsg() {</span>
<a href="#l271.34"></a><span id="l271.34" class="difflineminus">-      do_check_eq(this.stack.length, 0);</span>
<a href="#l271.35"></a><span id="l271.35" class="difflineplus">+      Assert.equal(this.stack.length, 0);</span>
<a href="#l271.36"></a><span id="l271.36">       calls++;</span>
<a href="#l271.37"></a><span id="l271.37">       this.partData = '';</span>
<a href="#l271.38"></a><span id="l271.38">     },</span>
<a href="#l271.39"></a><span id="l271.39">     endMessage: function emitter_endMsg() {</span>
<a href="#l271.40"></a><span id="l271.40" class="difflineminus">-      do_check_eq(this.stack.length, 0);</span>
<a href="#l271.41"></a><span id="l271.41" class="difflineplus">+      Assert.equal(this.stack.length, 0);</span>
<a href="#l271.42"></a><span id="l271.42">       calls++;</span>
<a href="#l271.43"></a><span id="l271.43">     },</span>
<a href="#l271.44"></a><span id="l271.44">     startPart: function emitter_startPart(partNum, headers) {</span>
<a href="#l271.45"></a><span id="l271.45">       this.stack.push(partNum);</span>
<a href="#l271.46"></a><span id="l271.46">       if (checkingHeaders) {</span>
<a href="#l271.47"></a><span id="l271.47" class="difflineminus">-        do_check_true(partNum in results);</span>
<a href="#l271.48"></a><span id="l271.48" class="difflineplus">+        Assert.ok(partNum in results);</span>
<a href="#l271.49"></a><span id="l271.49">         compare_objects(headers, results[partNum]);</span>
<a href="#l271.50"></a><span id="l271.50">         if (fusingParts)</span>
<a href="#l271.51"></a><span id="l271.51" class="difflineminus">-          do_check_eq(this.partData, '');</span>
<a href="#l271.52"></a><span id="l271.52" class="difflineplus">+          Assert.equal(this.partData, '');</span>
<a href="#l271.53"></a><span id="l271.53">       }</span>
<a href="#l271.54"></a><span id="l271.54">     },</span>
<a href="#l271.55"></a><span id="l271.55">     deliverPartData: function emitter_partData(partNum, data) {</span>
<a href="#l271.56"></a><span id="l271.56" class="difflineminus">-      do_check_eq(this.stack[this.stack.length - 1], partNum);</span>
<a href="#l271.57"></a><span id="l271.57" class="difflineplus">+      Assert.equal(this.stack[this.stack.length - 1], partNum);</span>
<a href="#l271.58"></a><span id="l271.58">       try {</span>
<a href="#l271.59"></a><span id="l271.59">         if (!checkingHeaders) {</span>
<a href="#l271.60"></a><span id="l271.60">           if (fusingParts)</span>
<a href="#l271.61"></a><span id="l271.61">             this.partData += data;</span>
<a href="#l271.62"></a><span id="l271.62">           else {</span>
<a href="#l271.63"></a><span id="l271.63" class="difflineminus">-            do_check_eq(partNum, results[dataCalls][0]);</span>
<a href="#l271.64"></a><span id="l271.64" class="difflineplus">+            Assert.equal(partNum, results[dataCalls][0]);</span>
<a href="#l271.65"></a><span id="l271.65">             compare_objects(data, results[dataCalls][1]);</span>
<a href="#l271.66"></a><span id="l271.66">           }</span>
<a href="#l271.67"></a><span id="l271.67">         }</span>
<a href="#l271.68"></a><span id="l271.68">       } finally {</span>
<a href="#l271.69"></a><span id="l271.69">         if (!fusingParts)</span>
<a href="#l271.70"></a><span id="l271.70">           dataCalls++;</span>
<a href="#l271.71"></a><span id="l271.71">       }</span>
<a href="#l271.72"></a><span id="l271.72">     },</span>
<a href="#l271.73"></a><span id="l271.73">     endPart: function emitter_endPart(partNum) {</span>
<a href="#l271.74"></a><span id="l271.74">       if (this.partData != '') {</span>
<a href="#l271.75"></a><span id="l271.75" class="difflineminus">-        do_check_eq(partNum, results[dataCalls][0]);</span>
<a href="#l271.76"></a><span id="l271.76" class="difflineplus">+        Assert.equal(partNum, results[dataCalls][0]);</span>
<a href="#l271.77"></a><span id="l271.77">         compare_objects(this.partData, results[dataCalls][1]);</span>
<a href="#l271.78"></a><span id="l271.78">         dataCalls++;</span>
<a href="#l271.79"></a><span id="l271.79">         this.partData = '';</span>
<a href="#l271.80"></a><span id="l271.80">       }</span>
<a href="#l271.81"></a><span id="l271.81" class="difflineminus">-      do_check_eq(this.stack.pop(), partNum);</span>
<a href="#l271.82"></a><span id="l271.82" class="difflineplus">+      Assert.equal(this.stack.pop(), partNum);</span>
<a href="#l271.83"></a><span id="l271.83">     }</span>
<a href="#l271.84"></a><span id="l271.84">   };</span>
<a href="#l271.85"></a><span id="l271.85">   opts.onerror = function (e) { throw e; };</span>
<a href="#l271.86"></a><span id="l271.86">   MimeParser.parseSync(message, emitter, opts);</span>
<a href="#l271.87"></a><span id="l271.87" class="difflineminus">-  do_check_eq(calls, 2);</span>
<a href="#l271.88"></a><span id="l271.88" class="difflineplus">+  Assert.equal(calls, 2);</span>
<a href="#l271.89"></a><span id="l271.89">   if (!checkingHeaders)</span>
<a href="#l271.90"></a><span id="l271.90" class="difflineminus">-    do_check_eq(dataCalls, results.length);</span>
<a href="#l271.91"></a><span id="l271.91" class="difflineplus">+    Assert.equal(dataCalls, results.length);</span>
<a href="#l271.92"></a><span id="l271.92"> }</span>
<a href="#l271.93"></a><span id="l271.93"> </span>
<a href="#l271.94"></a><span id="l271.94"> var ATTACH = MimeParser.HEADER_PARAMETER;</span>
<a href="#l271.95"></a><span id="l271.95"> // Format of tests:</span>
<a href="#l271.96"></a><span id="l271.96"> // entry[0] = header</span>
<a href="#l271.97"></a><span id="l271.97"> // entry[1] = flags</span>
<a href="#l271.98"></a><span id="l271.98"> // entry[2] = result to match</span>
<a href="#l271.99"></a><span id="l271.99"> var header_tests = [</span>
<a href="#l271.100"></a><span id="l271.100" class="difflineat">@@ -216,17 +216,17 @@ var header_tests = [</span>
<a href="#l271.101"></a><span id="l271.101">   ['a;b=1;c=2', MimeParser.HEADER_PARAMETER, [&quot;a&quot;, {&quot;b&quot;: &quot;1&quot;, &quot;c&quot;: &quot;2&quot;}]],</span>
<a href="#l271.102"></a><span id="l271.102">   ['a;b=&quot;a\\', MimeParser.HEADER_PARAMETER, [&quot;a&quot;, {&quot;b&quot;: &quot;a&quot;}]],</span>
<a href="#l271.103"></a><span id="l271.103">   ['a;b', MimeParser.HEADER_PARAMETER, [&quot;a&quot;, {}]],</span>
<a href="#l271.104"></a><span id="l271.104">   ['a;b=&quot;;&quot;;c=d', MimeParser.HEADER_PARAMETER, [&quot;a&quot;, {&quot;b&quot;: ';', 'c': &quot;d&quot;}]],</span>
<a href="#l271.105"></a><span id="l271.105"> ];</span>
<a href="#l271.106"></a><span id="l271.106"> </span>
<a href="#l271.107"></a><span id="l271.107"> function test_header(headerValue, flags, expected) {</span>
<a href="#l271.108"></a><span id="l271.108">   let result = MimeParser.parseHeaderField(headerValue, flags);</span>
<a href="#l271.109"></a><span id="l271.109" class="difflineminus">-  do_check_eq(result.preSemi, expected[0]);</span>
<a href="#l271.110"></a><span id="l271.110" class="difflineplus">+  Assert.equal(result.preSemi, expected[0]);</span>
<a href="#l271.111"></a><span id="l271.111">   compare_objects(result, expected[1]);</span>
<a href="#l271.112"></a><span id="l271.112"> }</span>
<a href="#l271.113"></a><span id="l271.113"> </span>
<a href="#l271.114"></a><span id="l271.114"> function run_test() {</span>
<a href="#l271.115"></a><span id="l271.115">   for (let test of parser_tests) {</span>
<a href="#l271.116"></a><span id="l271.116">     dump(&quot;Testing message &quot; + test[0]);</span>
<a href="#l271.117"></a><span id="l271.117">     if (test[1] instanceof Array)</span>
<a href="#l271.118"></a><span id="l271.118">       dump(&quot; using &quot; + test[1].length + &quot; packets&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l272.1"></a><span id="l272.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_rfc822_body.js</span>
<a href="#l272.2"></a><span id="l272.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_rfc822_body.js</span>
<a href="#l272.3"></a><span id="l272.3" class="difflineat">@@ -37,18 +37,18 @@ var messages = [</span>
<a href="#l272.4"></a><span id="l272.4"> var gStreamListener = {</span>
<a href="#l272.5"></a><span id="l272.5">   stream: null,</span>
<a href="#l272.6"></a><span id="l272.6">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l272.7"></a><span id="l272.7"> </span>
<a href="#l272.8"></a><span id="l272.8">   // nsIRequestObserver part</span>
<a href="#l272.9"></a><span id="l272.9">   onStartRequest: function (aRequest, aContext) {</span>
<a href="#l272.10"></a><span id="l272.10">   },</span>
<a href="#l272.11"></a><span id="l272.11">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l272.12"></a><span id="l272.12" class="difflineminus">-    do_check_eq(gMessageHeaderSink.attachmentCount,</span>
<a href="#l272.13"></a><span id="l272.13" class="difflineminus">-                this.expectedAttachmentCount);</span>
<a href="#l272.14"></a><span id="l272.14" class="difflineplus">+    Assert.equal(gMessageHeaderSink.attachmentCount,</span>
<a href="#l272.15"></a><span id="l272.15" class="difflineplus">+                 this.expectedAttachmentCount);</span>
<a href="#l272.16"></a><span id="l272.16">     async_driver();</span>
<a href="#l272.17"></a><span id="l272.17">   },</span>
<a href="#l272.18"></a><span id="l272.18"> </span>
<a href="#l272.19"></a><span id="l272.19">   // nsIStreamListener part</span>
<a href="#l272.20"></a><span id="l272.20">   onDataAvailable: function (aRequest,aContext,aInputStream,aOffset,aCount) {</span>
<a href="#l272.21"></a><span id="l272.21">     if (this.stream === null) {</span>
<a href="#l272.22"></a><span id="l272.22">       this.stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].</span>
<a href="#l272.23"></a><span id="l272.23">                     createInstance(Ci.nsIScriptableInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l273.1"></a><span id="l273.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_structured_headers.js</span>
<a href="#l273.2"></a><span id="l273.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_structured_headers.js</span>
<a href="#l273.3"></a><span id="l273.3" class="difflineat">@@ -10,160 +10,160 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l273.4"></a><span id="l273.4"> /// Verify that a specific XPCOM error code is thrown.</span>
<a href="#l273.5"></a><span id="l273.5"> function verifyError(block, errorCode) {</span>
<a href="#l273.6"></a><span id="l273.6">   let caught = undefined;</span>
<a href="#l273.7"></a><span id="l273.7">   try {</span>
<a href="#l273.8"></a><span id="l273.8">     block();</span>
<a href="#l273.9"></a><span id="l273.9">   } catch (actual) {</span>
<a href="#l273.10"></a><span id="l273.10">     caught = actual.result;</span>
<a href="#l273.11"></a><span id="l273.11">   }</span>
<a href="#l273.12"></a><span id="l273.12" class="difflineminus">-  do_check_eq(caught, errorCode);</span>
<a href="#l273.13"></a><span id="l273.13" class="difflineplus">+  Assert.equal(caught, errorCode);</span>
<a href="#l273.14"></a><span id="l273.14"> }</span>
<a href="#l273.15"></a><span id="l273.15"> </span>
<a href="#l273.16"></a><span id="l273.16"> var StructuredHeaders = CC(&quot;@mozilla.org/messenger/structuredheaders;1&quot;,</span>
<a href="#l273.17"></a><span id="l273.17">                            Ci.msgIWritableStructuredHeaders);</span>
<a href="#l273.18"></a><span id="l273.18"> </span>
<a href="#l273.19"></a><span id="l273.19"> add_task(function* check_addressing() {</span>
<a href="#l273.20"></a><span id="l273.20">   let headers = new StructuredHeaders();</span>
<a href="#l273.21"></a><span id="l273.21">   headers.setHeader(&quot;To&quot;, [{name: &quot;undisclosed-recipients&quot;, group: []}]);</span>
<a href="#l273.22"></a><span id="l273.22" class="difflineminus">-  do_check_true(Array.isArray(headers.getHeader(&quot;To&quot;)));</span>
<a href="#l273.23"></a><span id="l273.23" class="difflineplus">+  Assert.ok(Array.isArray(headers.getHeader(&quot;To&quot;)));</span>
<a href="#l273.24"></a><span id="l273.24">   let flat = headers.getAddressingHeader(&quot;To&quot;, false);</span>
<a href="#l273.25"></a><span id="l273.25" class="difflineminus">-  do_check_true(Array.isArray(flat));</span>
<a href="#l273.26"></a><span id="l273.26" class="difflineminus">-  do_check_eq(flat.length, 0);</span>
<a href="#l273.27"></a><span id="l273.27" class="difflineplus">+  Assert.ok(Array.isArray(flat));</span>
<a href="#l273.28"></a><span id="l273.28" class="difflineplus">+  Assert.equal(flat.length, 0);</span>
<a href="#l273.29"></a><span id="l273.29">   let full = headers.getAddressingHeader(&quot;To&quot;, true);</span>
<a href="#l273.30"></a><span id="l273.30" class="difflineminus">-  do_check_true(Array.isArray(full));</span>
<a href="#l273.31"></a><span id="l273.31" class="difflineminus">-  do_check_eq(full.length, 1);</span>
<a href="#l273.32"></a><span id="l273.32" class="difflineminus">-  do_check_eq(full[0].name, &quot;undisclosed-recipients&quot;);</span>
<a href="#l273.33"></a><span id="l273.33" class="difflineminus">-  do_check_true(Array.isArray(full[0].group));</span>
<a href="#l273.34"></a><span id="l273.34" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;To&quot;), &quot;undisclosed-recipients: ;&quot;);</span>
<a href="#l273.35"></a><span id="l273.35" class="difflineplus">+  Assert.ok(Array.isArray(full));</span>
<a href="#l273.36"></a><span id="l273.36" class="difflineplus">+  Assert.equal(full.length, 1);</span>
<a href="#l273.37"></a><span id="l273.37" class="difflineplus">+  Assert.equal(full[0].name, &quot;undisclosed-recipients&quot;);</span>
<a href="#l273.38"></a><span id="l273.38" class="difflineplus">+  Assert.ok(Array.isArray(full[0].group));</span>
<a href="#l273.39"></a><span id="l273.39" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;To&quot;), &quot;undisclosed-recipients: ;&quot;);</span>
<a href="#l273.40"></a><span id="l273.40"> </span>
<a href="#l273.41"></a><span id="l273.41">   headers.setHeader(&quot;To&quot;, [{name: &quot;\u00D3&quot;, email: &quot;test@foo.invalid&quot;}]);</span>
<a href="#l273.42"></a><span id="l273.42" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;To&quot;),</span>
<a href="#l273.43"></a><span id="l273.43" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;To&quot;),</span>
<a href="#l273.44"></a><span id="l273.44">     &quot;=?UTF-8?B?w5M=?= &lt;test@foo.invalid&gt;&quot;);</span>
<a href="#l273.45"></a><span id="l273.45">   headers.setAddressingHeader(&quot;To&quot;,</span>
<a href="#l273.46"></a><span id="l273.46">     [{name: &quot;Comma, Name&quot;, email: &quot;test@foo.invalid&quot;}], 1);</span>
<a href="#l273.47"></a><span id="l273.47" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;To&quot;),</span>
<a href="#l273.48"></a><span id="l273.48" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;To&quot;),</span>
<a href="#l273.49"></a><span id="l273.49">     &quot;\&quot;Comma, Name\&quot; &lt;test@foo.invalid&gt;&quot;);</span>
<a href="#l273.50"></a><span id="l273.50"> });</span>
<a href="#l273.51"></a><span id="l273.51"> </span>
<a href="#l273.52"></a><span id="l273.52"> add_task(function* check_custom_header() {</span>
<a href="#l273.53"></a><span id="l273.53">   // Load an extension for our custom header.</span>
<a href="#l273.54"></a><span id="l273.54">   let url = Services.io.newFileURI(do_get_file(&quot;custom_header.js&quot;)).spec;</span>
<a href="#l273.55"></a><span id="l273.55">   let promise = new Promise((resolve, reject) =&gt; {</span>
<a href="#l273.56"></a><span id="l273.56">     function observer(subject, topic, data) {</span>
<a href="#l273.57"></a><span id="l273.57" class="difflineminus">-      do_check_eq(topic, &quot;xpcom-category-entry-added&quot;);</span>
<a href="#l273.58"></a><span id="l273.58" class="difflineminus">-      do_check_eq(data, &quot;custom-mime-encoder&quot;);</span>
<a href="#l273.59"></a><span id="l273.59" class="difflineplus">+      Assert.equal(topic, &quot;xpcom-category-entry-added&quot;);</span>
<a href="#l273.60"></a><span id="l273.60" class="difflineplus">+      Assert.equal(data, &quot;custom-mime-encoder&quot;);</span>
<a href="#l273.61"></a><span id="l273.61">       resolve();</span>
<a href="#l273.62"></a><span id="l273.62">       Services.obs.removeObserver(observer, &quot;xpcom-category-entry-added&quot;);</span>
<a href="#l273.63"></a><span id="l273.63">     }</span>
<a href="#l273.64"></a><span id="l273.64">     Services.obs.addObserver(observer, &quot;xpcom-category-entry-added&quot;);</span>
<a href="#l273.65"></a><span id="l273.65">   });</span>
<a href="#l273.66"></a><span id="l273.66">   Cc[&quot;@mozilla.org/categorymanager;1&quot;]</span>
<a href="#l273.67"></a><span id="l273.67">     .getService(Ci.nsICategoryManager)</span>
<a href="#l273.68"></a><span id="l273.68">     .addCategoryEntry(&quot;custom-mime-encoder&quot;, &quot;X-Unusual&quot;, url, false, true);</span>
<a href="#l273.69"></a><span id="l273.69">   // The category manager doesn't fire until a later timestep.</span>
<a href="#l273.70"></a><span id="l273.70">   yield promise;</span>
<a href="#l273.71"></a><span id="l273.71">   let headers = new StructuredHeaders();</span>
<a href="#l273.72"></a><span id="l273.72">   headers.setRawHeader(&quot;X-Unusual&quot;, &quot;10&quot;, null);</span>
<a href="#l273.73"></a><span id="l273.73" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;X-Unusual&quot;), 16);</span>
<a href="#l273.74"></a><span id="l273.74" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;X-Unusual&quot;), 16);</span>
<a href="#l273.75"></a><span id="l273.75">   headers.setHeader(&quot;X-Unusual&quot;, 32);</span>
<a href="#l273.76"></a><span id="l273.76" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;X-Unusual&quot;), &quot;20&quot;);</span>
<a href="#l273.77"></a><span id="l273.77" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;X-Unusual&quot;), &quot;20&quot;);</span>
<a href="#l273.78"></a><span id="l273.78"> });</span>
<a href="#l273.79"></a><span id="l273.79"> </span>
<a href="#l273.80"></a><span id="l273.80"> add_task(function* check_raw() {</span>
<a href="#l273.81"></a><span id="l273.81">   let headers = new StructuredHeaders();</span>
<a href="#l273.82"></a><span id="l273.82" class="difflineminus">-  do_check_false(headers.hasHeader(&quot;Date&quot;));</span>
<a href="#l273.83"></a><span id="l273.83" class="difflineplus">+  Assert.ok(!headers.hasHeader(&quot;Date&quot;));</span>
<a href="#l273.84"></a><span id="l273.84">   let day = new Date(&quot;2000-01-01T00:00:00Z&quot;);</span>
<a href="#l273.85"></a><span id="l273.85">   headers.setHeader(&quot;Date&quot;, day);</span>
<a href="#l273.86"></a><span id="l273.86" class="difflineminus">-  do_check_true(headers.hasHeader(&quot;Date&quot;));</span>
<a href="#l273.87"></a><span id="l273.87" class="difflineminus">-  do_check_true(headers.hasHeader(&quot;date&quot;));</span>
<a href="#l273.88"></a><span id="l273.88" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Date&quot;), day);</span>
<a href="#l273.89"></a><span id="l273.89" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;date&quot;), day);</span>
<a href="#l273.90"></a><span id="l273.90" class="difflineplus">+  Assert.ok(headers.hasHeader(&quot;Date&quot;));</span>
<a href="#l273.91"></a><span id="l273.91" class="difflineplus">+  Assert.ok(headers.hasHeader(&quot;date&quot;));</span>
<a href="#l273.92"></a><span id="l273.92" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Date&quot;), day);</span>
<a href="#l273.93"></a><span id="l273.93" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;date&quot;), day);</span>
<a href="#l273.94"></a><span id="l273.94">   verifyError(() =&gt; headers.getUnstructuredHeader(&quot;Date&quot;),</span>
<a href="#l273.95"></a><span id="l273.95">     Components.results.NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l273.96"></a><span id="l273.96">   verifyError(() =&gt; headers.getAddressingHeader(&quot;Date&quot;),</span>
<a href="#l273.97"></a><span id="l273.97">     Components.results.NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l273.98"></a><span id="l273.98">   // This is easier than trying to match the actual value for the Date header,</span>
<a href="#l273.99"></a><span id="l273.99">   // since that depends on the current timezone.</span>
<a href="#l273.100"></a><span id="l273.100" class="difflineminus">-  do_check_eq(new Date(headers.getRawHeader(&quot;Date&quot;)).getTime(), day.getTime());</span>
<a href="#l273.101"></a><span id="l273.101" class="difflineplus">+  Assert.equal(new Date(headers.getRawHeader(&quot;Date&quot;)).getTime(), day.getTime());</span>
<a href="#l273.102"></a><span id="l273.102"> </span>
<a href="#l273.103"></a><span id="l273.103">   // Otherwise, the string values should work.</span>
<a href="#l273.104"></a><span id="l273.104">   headers.setRawHeader(&quot;Custom-Date&quot;, &quot;1 Jan 2000 00:00:00 +0000&quot;, null);</span>
<a href="#l273.105"></a><span id="l273.105" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;Custom-Date&quot;), &quot;1 Jan 2000 00:00:00 +0000&quot;);</span>
<a href="#l273.106"></a><span id="l273.106" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;Custom-Date&quot;), &quot;1 Jan 2000 00:00:00 +0000&quot;);</span>
<a href="#l273.107"></a><span id="l273.107">   headers.deleteHeader(&quot;Custom-Date&quot;);</span>
<a href="#l273.108"></a><span id="l273.108"> </span>
<a href="#l273.109"></a><span id="l273.109">   headers.setUnstructuredHeader(&quot;Content-Description&quot;, &quot;A description!&quot;);</span>
<a href="#l273.110"></a><span id="l273.110" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Content-Description&quot;), &quot;A description!&quot;);</span>
<a href="#l273.111"></a><span id="l273.111" class="difflineminus">-  do_check_eq(headers.getUnstructuredHeader(&quot;Content-Description&quot;),</span>
<a href="#l273.112"></a><span id="l273.112" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Content-Description&quot;), &quot;A description!&quot;);</span>
<a href="#l273.113"></a><span id="l273.113" class="difflineplus">+  Assert.equal(headers.getUnstructuredHeader(&quot;Content-Description&quot;),</span>
<a href="#l273.114"></a><span id="l273.114">     &quot;A description!&quot;);</span>
<a href="#l273.115"></a><span id="l273.115">   verifyError(() =&gt; headers.getAddressingHeader(&quot;Content-Description&quot;),</span>
<a href="#l273.116"></a><span id="l273.116">     Components.results.NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l273.117"></a><span id="l273.117" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;Content-Description&quot;),</span>
<a href="#l273.118"></a><span id="l273.118" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;Content-Description&quot;),</span>
<a href="#l273.119"></a><span id="l273.119">     &quot;A description!&quot;);</span>
<a href="#l273.120"></a><span id="l273.120"> </span>
<a href="#l273.121"></a><span id="l273.121" class="difflineminus">-  do_check_false(headers.hasHeader(&quot;Subject&quot;));</span>
<a href="#l273.122"></a><span id="l273.122" class="difflineminus">-  do_check_true(headers.getUnstructuredHeader(&quot;Subject&quot;) === null);</span>
<a href="#l273.123"></a><span id="l273.123" class="difflineplus">+  Assert.ok(!headers.hasHeader(&quot;Subject&quot;));</span>
<a href="#l273.124"></a><span id="l273.124" class="difflineplus">+  Assert.ok(headers.getUnstructuredHeader(&quot;Subject&quot;) === null);</span>
<a href="#l273.125"></a><span id="l273.125">   headers.setRawHeader(&quot;Subject&quot;, &quot;=?UTF-8?B?56eB44Gv5Lu25ZCN5Y2I5YmN?=&quot;,</span>
<a href="#l273.126"></a><span id="l273.126">     &quot;US-ASCII&quot;);</span>
<a href="#l273.127"></a><span id="l273.127" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Subject&quot;),</span>
<a href="#l273.128"></a><span id="l273.128" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Subject&quot;),</span>
<a href="#l273.129"></a><span id="l273.129">     &quot;\u79c1\u306f\u4ef6\u540d\u5348\u524d&quot;);</span>
<a href="#l273.130"></a><span id="l273.130" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;Subject&quot;),</span>
<a href="#l273.131"></a><span id="l273.131" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;Subject&quot;),</span>
<a href="#l273.132"></a><span id="l273.132">     &quot;=?UTF-8?B?56eB44Gv5Lu25ZCN5Y2I5YmN?=&quot;);</span>
<a href="#l273.133"></a><span id="l273.133"> </span>
<a href="#l273.134"></a><span id="l273.134">   // Multiple found headers</span>
<a href="#l273.135"></a><span id="l273.135" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Not-Found-Anywhere&quot;), undefined);</span>
<a href="#l273.136"></a><span id="l273.136" class="difflineminus">-  do_check_neq(headers.getHeader(&quot;Not-Found-Anywhere&quot;), &quot;&quot;);</span>
<a href="#l273.137"></a><span id="l273.137" class="difflineminus">-  do_check_eq(headers.getRawHeader(&quot;Not-Found-Anywhere&quot;), undefined);</span>
<a href="#l273.138"></a><span id="l273.138" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Not-Found-Anywhere&quot;), undefined);</span>
<a href="#l273.139"></a><span id="l273.139" class="difflineplus">+  Assert.notEqual(headers.getHeader(&quot;Not-Found-Anywhere&quot;), &quot;&quot;);</span>
<a href="#l273.140"></a><span id="l273.140" class="difflineplus">+  Assert.equal(headers.getRawHeader(&quot;Not-Found-Anywhere&quot;), undefined);</span>
<a href="#l273.141"></a><span id="l273.141">   headers.setHeader(&quot;Not-Found-Anywhere&quot;, 515);</span>
<a href="#l273.142"></a><span id="l273.142" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Not-Found-Anywhere&quot;), 515);</span>
<a href="#l273.143"></a><span id="l273.143" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Not-Found-Anywhere&quot;), 515);</span>
<a href="#l273.144"></a><span id="l273.144">   headers.deleteHeader(&quot;not-found-anywhere&quot;);</span>
<a href="#l273.145"></a><span id="l273.145" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Not-Found-Anywhere&quot;), undefined);</span>
<a href="#l273.146"></a><span id="l273.146" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Not-Found-Anywhere&quot;), undefined);</span>
<a href="#l273.147"></a><span id="l273.147"> </span>
<a href="#l273.148"></a><span id="l273.148">   // Check the enumeration of header values.</span>
<a href="#l273.149"></a><span id="l273.149">   headers.setHeader(&quot;unabashed-random-header&quot;, false);</span>
<a href="#l273.150"></a><span id="l273.150">   let headerList = [&quot;Date&quot;, &quot;Content-Description&quot;, &quot;Subject&quot;,</span>
<a href="#l273.151"></a><span id="l273.151">     &quot;Unabashed-Random-Header&quot;];</span>
<a href="#l273.152"></a><span id="l273.152">   let enumerator = headers.headerNames;</span>
<a href="#l273.153"></a><span id="l273.153">   while (enumerator.hasMore()) {</span>
<a href="#l273.154"></a><span id="l273.154">     let value = enumerator.getNext();</span>
<a href="#l273.155"></a><span id="l273.155" class="difflineminus">-    do_check_eq(value.toLowerCase(), headerList.shift().toLowerCase());</span>
<a href="#l273.156"></a><span id="l273.156" class="difflineplus">+    Assert.equal(value.toLowerCase(), headerList.shift().toLowerCase());</span>
<a href="#l273.157"></a><span id="l273.157">   }</span>
<a href="#l273.158"></a><span id="l273.158"> </span>
<a href="#l273.159"></a><span id="l273.159">   // Check that copying works</span>
<a href="#l273.160"></a><span id="l273.160">   let moreHeaders = new StructuredHeaders();</span>
<a href="#l273.161"></a><span id="l273.161">   moreHeaders.addAllHeaders(headers);</span>
<a href="#l273.162"></a><span id="l273.162">   enumerator = headers.headerNames;</span>
<a href="#l273.163"></a><span id="l273.163">   while (enumerator.hasMore()) {</span>
<a href="#l273.164"></a><span id="l273.164">     let value = enumerator.getNext();</span>
<a href="#l273.165"></a><span id="l273.165" class="difflineminus">-    do_check_eq(moreHeaders.getHeader(value), headers.getHeader(value));</span>
<a href="#l273.166"></a><span id="l273.166" class="difflineplus">+    Assert.equal(moreHeaders.getHeader(value), headers.getHeader(value));</span>
<a href="#l273.167"></a><span id="l273.167">   }</span>
<a href="#l273.168"></a><span id="l273.168">   headers.deleteHeader(&quot;Date&quot;);</span>
<a href="#l273.169"></a><span id="l273.169" class="difflineminus">-  do_check_true(moreHeaders.hasHeader(&quot;Date&quot;));</span>
<a href="#l273.170"></a><span id="l273.170" class="difflineplus">+  Assert.ok(moreHeaders.hasHeader(&quot;Date&quot;));</span>
<a href="#l273.171"></a><span id="l273.171"> })</span>
<a href="#l273.172"></a><span id="l273.172"> </span>
<a href="#l273.173"></a><span id="l273.173"> add_task(function* check_nsIMimeHeaders() {</span>
<a href="#l273.174"></a><span id="l273.174">   let headers = Cc[&quot;@mozilla.org/messenger/mimeheaders;1&quot;]</span>
<a href="#l273.175"></a><span id="l273.175">                   .createInstance(Ci.nsIMimeHeaders);</span>
<a href="#l273.176"></a><span id="l273.176" class="difflineminus">-  do_check_true(headers instanceof Ci.msgIStructuredHeaders);</span>
<a href="#l273.177"></a><span id="l273.177" class="difflineminus">-  do_check_false(headers instanceof Ci.msgIWritableStructuredHeaders);</span>
<a href="#l273.178"></a><span id="l273.178" class="difflineplus">+  Assert.ok(headers instanceof Ci.msgIStructuredHeaders);</span>
<a href="#l273.179"></a><span id="l273.179" class="difflineplus">+  Assert.equal(false, headers instanceof Ci.msgIWritableStructuredHeaders);</span>
<a href="#l273.180"></a><span id="l273.180">   headers.initialize(mailTestUtils.loadFileToString(</span>
<a href="#l273.181"></a><span id="l273.181">     do_get_file(&quot;../../../data/draft1&quot;)));</span>
<a href="#l273.182"></a><span id="l273.182" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;To&quot;).length, 1);</span>
<a href="#l273.183"></a><span id="l273.183" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;To&quot;)[0].email, &quot;bugmail@example.org&quot;);</span>
<a href="#l273.184"></a><span id="l273.184" class="difflineminus">-  do_check_eq(headers.getAddressingHeader(&quot;To&quot;).length, 1);</span>
<a href="#l273.185"></a><span id="l273.185" class="difflineminus">-  do_check_eq(headers.getHeader(&quot;Content-Type&quot;).type, &quot;text/html&quot;);</span>
<a href="#l273.186"></a><span id="l273.186" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;To&quot;).length, 1);</span>
<a href="#l273.187"></a><span id="l273.187" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;To&quot;)[0].email, &quot;bugmail@example.org&quot;);</span>
<a href="#l273.188"></a><span id="l273.188" class="difflineplus">+  Assert.equal(headers.getAddressingHeader(&quot;To&quot;).length, 1);</span>
<a href="#l273.189"></a><span id="l273.189" class="difflineplus">+  Assert.equal(headers.getHeader(&quot;Content-Type&quot;).type, &quot;text/html&quot;);</span>
<a href="#l273.190"></a><span id="l273.190"> </span>
<a href="#l273.191"></a><span id="l273.191">   let headerList = [&quot;X-Mozilla-Status&quot;, &quot;X-Mozilla-Status2&quot;, &quot;X-Mozilla-Keys&quot;,</span>
<a href="#l273.192"></a><span id="l273.192">     &quot;FCC&quot;, &quot;BCC&quot;, &quot;X-Identity-Key&quot;, &quot;Message-ID&quot;, &quot;Date&quot;, &quot;From&quot;,</span>
<a href="#l273.193"></a><span id="l273.193">     &quot;X-Mozilla-Draft-Info&quot;, &quot;User-Agent&quot;, &quot;MIME-Version&quot;, &quot;To&quot;, &quot;Subject&quot;,</span>
<a href="#l273.194"></a><span id="l273.194">     &quot;Content-Type&quot;, &quot;Content-Transfer-Encoding&quot;];</span>
<a href="#l273.195"></a><span id="l273.195">   let enumerator = headers.headerNames;</span>
<a href="#l273.196"></a><span id="l273.196">   while (enumerator.hasMore()) {</span>
<a href="#l273.197"></a><span id="l273.197">     let value = enumerator.getNext();</span>
<a href="#l273.198"></a><span id="l273.198" class="difflineminus">-    do_check_eq(value.toLowerCase(), headerList.shift().toLowerCase());</span>
<a href="#l273.199"></a><span id="l273.199" class="difflineplus">+    Assert.equal(value.toLowerCase(), headerList.shift().toLowerCase());</span>
<a href="#l273.200"></a><span id="l273.200">   }</span>
<a href="#l273.201"></a><span id="l273.201"> });</span>
<a href="#l273.202"></a><span id="l273.202"> </span>
<a href="#l273.203"></a><span id="l273.203"> add_task(function* checkBuildMimeText() {</span>
<a href="#l273.204"></a><span id="l273.204">   let headers = new StructuredHeaders();</span>
<a href="#l273.205"></a><span id="l273.205">   headers.setHeader(&quot;To&quot;, [{name: &quot;François Smith&quot;, email: &quot;user@☃.invalid&quot;}]);</span>
<a href="#l273.206"></a><span id="l273.206">   headers.setHeader(&quot;From&quot;, [{name: &quot;John Doe&quot;, email: &quot;jdoe@test.invalid&quot;}]);</span>
<a href="#l273.207"></a><span id="l273.207">   headers.setHeader(&quot;Subject&quot;, &quot;A subject that spans a distance quite in &quot; +</span>
<a href="#l273.208"></a><span id="l273.208" class="difflineat">@@ -171,24 +171,24 @@ add_task(function* checkBuildMimeText() </span>
<a href="#l273.209"></a><span id="l273.209">   headers.setHeader(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101 Thunderbird/40.0a1&quot;);</span>
<a href="#l273.210"></a><span id="l273.210">   let mimeText =</span>
<a href="#l273.211"></a><span id="l273.211">     &quot;To: =?UTF-8?Q?Fran=c3=a7ois_Smith?= &lt;user@☃.invalid&gt;\r\n&quot; +</span>
<a href="#l273.212"></a><span id="l273.212">     &quot;From: John Doe &lt;jdoe@test.invalid&gt;\r\n&quot; +</span>
<a href="#l273.213"></a><span id="l273.213">     &quot;Subject: A subject that spans a distance quite in excess of 80 characters so\r\n&quot; +</span>
<a href="#l273.214"></a><span id="l273.214">       &quot; as to force an intermediary CRLF\r\n&quot; +</span>
<a href="#l273.215"></a><span id="l273.215">     &quot;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101\r\n&quot; +</span>
<a href="#l273.216"></a><span id="l273.216">       &quot; Thunderbird/40.0a1\r\n&quot;;</span>
<a href="#l273.217"></a><span id="l273.217" class="difflineminus">-  do_check_eq(headers.buildMimeText(), mimeText);</span>
<a href="#l273.218"></a><span id="l273.218" class="difflineplus">+  Assert.equal(headers.buildMimeText(), mimeText);</span>
<a href="#l273.219"></a><span id="l273.219"> </span>
<a href="#l273.220"></a><span id="l273.220">   // Check the version used for the nsIMimeHeaders implementation. This requires</span>
<a href="#l273.221"></a><span id="l273.221">   // initializing with a UTF-8 version.</span>
<a href="#l273.222"></a><span id="l273.222">   let utf8Text = mimeText.replace(&quot;☃&quot;, &quot;\xe2\x98\x83&quot;);</span>
<a href="#l273.223"></a><span id="l273.223">   let mimeHeaders = Cc[&quot;@mozilla.org/messenger/mimeheaders;1&quot;]</span>
<a href="#l273.224"></a><span id="l273.224">                       .createInstance(Ci.nsIMimeHeaders);</span>
<a href="#l273.225"></a><span id="l273.225">   mimeHeaders.initialize(utf8Text);</span>
<a href="#l273.226"></a><span id="l273.226" class="difflineminus">-  do_check_eq(mimeHeaders.getHeader(&quot;To&quot;)[0].email, &quot;user@☃.invalid&quot;);</span>
<a href="#l273.227"></a><span id="l273.227" class="difflineminus">-  do_check_eq(mimeHeaders.buildMimeText(), mimeText);</span>
<a href="#l273.228"></a><span id="l273.228" class="difflineminus">-  do_check_eq(mimeHeaders.allHeaders, utf8Text);</span>
<a href="#l273.229"></a><span id="l273.229" class="difflineplus">+  Assert.equal(mimeHeaders.getHeader(&quot;To&quot;)[0].email, &quot;user@☃.invalid&quot;);</span>
<a href="#l273.230"></a><span id="l273.230" class="difflineplus">+  Assert.equal(mimeHeaders.buildMimeText(), mimeText);</span>
<a href="#l273.231"></a><span id="l273.231" class="difflineplus">+  Assert.equal(mimeHeaders.allHeaders, utf8Text);</span>
<a href="#l273.232"></a><span id="l273.232"> });</span>
<a href="#l273.233"></a><span id="l273.233"> </span>
<a href="#l273.234"></a><span id="l273.234"> function run_test() {</span>
<a href="#l273.235"></a><span id="l273.235">   run_next_test();</span>
<a href="#l273.236"></a><span id="l273.236"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l274.1"></a><span id="l274.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_text_attachment.js</span>
<a href="#l274.2"></a><span id="l274.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_text_attachment.js</span>
<a href="#l274.3"></a><span id="l274.3" class="difflineat">@@ -35,17 +35,17 @@ var gStreamListener = {</span>
<a href="#l274.4"></a><span id="l274.4">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l274.5"></a><span id="l274.5"> </span>
<a href="#l274.6"></a><span id="l274.6">   _str:&quot;&quot;,</span>
<a href="#l274.7"></a><span id="l274.7">   // nsIRequestObserver part</span>
<a href="#l274.8"></a><span id="l274.8">   onStartRequest: function (aRequest, aContext) {</span>
<a href="#l274.9"></a><span id="l274.9">   },</span>
<a href="#l274.10"></a><span id="l274.10">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l274.11"></a><span id="l274.11">     // check that text attachment contents didn't end up inline.</span>
<a href="#l274.12"></a><span id="l274.12" class="difflineminus">-    do_check_true(!this._str.includes(textAttachment));</span>
<a href="#l274.13"></a><span id="l274.13" class="difflineplus">+    Assert.ok(!this._str.includes(textAttachment));</span>
<a href="#l274.14"></a><span id="l274.14">     async_driver();</span>
<a href="#l274.15"></a><span id="l274.15">   },</span>
<a href="#l274.16"></a><span id="l274.16"> </span>
<a href="#l274.17"></a><span id="l274.17">   /* okay, our onDataAvailable should actually never be called.  the stream</span>
<a href="#l274.18"></a><span id="l274.18">      converter is actually eating everything except the start and stop</span>
<a href="#l274.19"></a><span id="l274.19">      notification. */</span>
<a href="#l274.20"></a><span id="l274.20">   // nsIStreamListener part</span>
<a href="#l274.21"></a><span id="l274.21">   _stream : null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l275.1"></a><span id="l275.1" class="difflineminus">--- a/mailnews/news/test/unit/head_server_setup.js</span>
<a href="#l275.2"></a><span id="l275.2" class="difflineplus">+++ b/mailnews/news/test/unit/head_server_setup.js</span>
<a href="#l275.3"></a><span id="l275.3" class="difflineat">@@ -193,17 +193,17 @@ function resetFolder(folder) {</span>
<a href="#l275.4"></a><span id="l275.4"> </span>
<a href="#l275.5"></a><span id="l275.5"> function do_check_transaction(real, expected) {</span>
<a href="#l275.6"></a><span id="l275.6">   // real.them may have an extra QUIT on the end, where the stream is only</span>
<a href="#l275.7"></a><span id="l275.7">   // closed after we have a chance to process it and not them. We therefore</span>
<a href="#l275.8"></a><span id="l275.8">   // excise this from the list</span>
<a href="#l275.9"></a><span id="l275.9">   if (real.them[real.them.length-1] == &quot;QUIT&quot;)</span>
<a href="#l275.10"></a><span id="l275.10">     real.them.pop();</span>
<a href="#l275.11"></a><span id="l275.11"> </span>
<a href="#l275.12"></a><span id="l275.12" class="difflineminus">-  do_check_eq(real.them.join(&quot;,&quot;), expected.join(&quot;,&quot;));</span>
<a href="#l275.13"></a><span id="l275.13" class="difflineplus">+  Assert.equal(real.them.join(&quot;,&quot;), expected.join(&quot;,&quot;));</span>
<a href="#l275.14"></a><span id="l275.14">   dump(&quot;Passed test &quot; + test + &quot;\n&quot;);</span>
<a href="#l275.15"></a><span id="l275.15"> }</span>
<a href="#l275.16"></a><span id="l275.16"> </span>
<a href="#l275.17"></a><span id="l275.17"> function make_article(file) {</span>
<a href="#l275.18"></a><span id="l275.18">   var fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l275.19"></a><span id="l275.19">                   .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l275.20"></a><span id="l275.20">   var sstream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l275.21"></a><span id="l275.21">                   .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l275.22"></a><span id="l275.22" class="difflineat">@@ -226,17 +226,17 @@ var articleTextListener = {</span>
<a href="#l275.23"></a><span id="l275.23"> </span>
<a href="#l275.24"></a><span id="l275.24">   QueryInterface:</span>
<a href="#l275.25"></a><span id="l275.25">     XPCOMUtils.generateQI([Ci.nsIStreamListener, Ci.nsIRequestObserver]),</span>
<a href="#l275.26"></a><span id="l275.26"> </span>
<a href="#l275.27"></a><span id="l275.27">   // nsIRequestObserver</span>
<a href="#l275.28"></a><span id="l275.28">   onStartRequest: function(aRequest, aContext) {</span>
<a href="#l275.29"></a><span id="l275.29">   },</span>
<a href="#l275.30"></a><span id="l275.30">   onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l275.31"></a><span id="l275.31" class="difflineminus">-    do_check_eq(aStatusCode, 0);</span>
<a href="#l275.32"></a><span id="l275.32" class="difflineplus">+    Assert.equal(aStatusCode, 0);</span>
<a href="#l275.33"></a><span id="l275.33"> </span>
<a href="#l275.34"></a><span id="l275.34">     // Reduce any \r\n to just \n so we can do a good comparison on any</span>
<a href="#l275.35"></a><span id="l275.35">     // platform.</span>
<a href="#l275.36"></a><span id="l275.36">     this.data = this.data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l275.37"></a><span id="l275.37">     this.finished = true;</span>
<a href="#l275.38"></a><span id="l275.38">   },</span>
<a href="#l275.39"></a><span id="l275.39"> </span>
<a href="#l275.40"></a><span id="l275.40">   // nsIStreamListener</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l276.1"></a><span id="l276.1" class="difflineminus">--- a/mailnews/news/test/unit/test_biff.js</span>
<a href="#l276.2"></a><span id="l276.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_biff.js</span>
<a href="#l276.3"></a><span id="l276.3" class="difflineat">@@ -38,11 +38,11 @@ function run_test() {</span>
<a href="#l276.4"></a><span id="l276.4">   localserver.performBiff(null);</span>
<a href="#l276.5"></a><span id="l276.5">   server.performTest();</span>
<a href="#l276.6"></a><span id="l276.6">   MailServices.mfn.removeListener(listener);</span>
<a href="#l276.7"></a><span id="l276.7"> </span>
<a href="#l276.8"></a><span id="l276.8">   // We marked, via our filters, one of the messages read. So if we do not</span>
<a href="#l276.9"></a><span id="l276.9">   // have 1 read message, either we're not running the filters on biff, or the</span>
<a href="#l276.10"></a><span id="l276.10">   // filters aren't working. This is disambiguated by the test_filter.js test.</span>
<a href="#l276.11"></a><span id="l276.11">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l276.12"></a><span id="l276.12" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), folder.getNumUnread(false) + 1);</span>
<a href="#l276.13"></a><span id="l276.13" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), folder.getNumUnread(false) + 1);</span>
<a href="#l276.14"></a><span id="l276.14">   server.stop();</span>
<a href="#l276.15"></a><span id="l276.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l277.1"></a><span id="l277.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l277.2"></a><span id="l277.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l277.3"></a><span id="l277.3" class="difflineat">@@ -8,34 +8,34 @@ function run_test() {</span>
<a href="#l277.4"></a><span id="l277.4">   var server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l277.5"></a><span id="l277.5">   server.start();</span>
<a href="#l277.6"></a><span id="l277.6"> </span>
<a href="#l277.7"></a><span id="l277.7">   // Correct URI?</span>
<a href="#l277.8"></a><span id="l277.8">   let uri = Services.io.newURI(&quot;news://localhost:&quot; + server.port +</span>
<a href="#l277.9"></a><span id="l277.9">                                  &quot;/1@regular.invalid&quot;);</span>
<a href="#l277.10"></a><span id="l277.10">   let newsUri = uri.QueryInterface(Ci.nsINntpUrl)</span>
<a href="#l277.11"></a><span id="l277.11">                    .QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l277.12"></a><span id="l277.12" class="difflineminus">-  do_check_eq(uri.port, server.port);</span>
<a href="#l277.13"></a><span id="l277.13" class="difflineminus">-  do_check_eq(newsUri.server, null);</span>
<a href="#l277.14"></a><span id="l277.14" class="difflineminus">-  do_check_eq(newsUri.messageID, &quot;1@regular.invalid&quot;);</span>
<a href="#l277.15"></a><span id="l277.15" class="difflineminus">-  do_check_eq(newsUri.folder, null);</span>
<a href="#l277.16"></a><span id="l277.16" class="difflineplus">+  Assert.equal(uri.port, server.port);</span>
<a href="#l277.17"></a><span id="l277.17" class="difflineplus">+  Assert.equal(newsUri.server, null);</span>
<a href="#l277.18"></a><span id="l277.18" class="difflineplus">+  Assert.equal(newsUri.messageID, &quot;1@regular.invalid&quot;);</span>
<a href="#l277.19"></a><span id="l277.19" class="difflineplus">+  Assert.equal(newsUri.folder, null);</span>
<a href="#l277.20"></a><span id="l277.20"> </span>
<a href="#l277.21"></a><span id="l277.21">   // Run the URI and make sure we get the message</span>
<a href="#l277.22"></a><span id="l277.22">   let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l277.23"></a><span id="l277.23">                                                null,</span>
<a href="#l277.24"></a><span id="l277.24">                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l277.25"></a><span id="l277.25">                                                null,</span>
<a href="#l277.26"></a><span id="l277.26">                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l277.27"></a><span id="l277.27">                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l277.28"></a><span id="l277.28">   channel.asyncOpen(articleTextListener, null);</span>
<a href="#l277.29"></a><span id="l277.29"> </span>
<a href="#l277.30"></a><span id="l277.30">   // Run the server</span>
<a href="#l277.31"></a><span id="l277.31">   var thread = gThreadManager.currentThread;</span>
<a href="#l277.32"></a><span id="l277.32">   while (!articleTextListener.finished)</span>
<a href="#l277.33"></a><span id="l277.33">     thread.processNextEvent(true);</span>
<a href="#l277.34"></a><span id="l277.34"> </span>
<a href="#l277.35"></a><span id="l277.35" class="difflineminus">-  do_check_eq(articleTextListener.data,</span>
<a href="#l277.36"></a><span id="l277.36" class="difflineplus">+  Assert.equal(articleTextListener.data,</span>
<a href="#l277.37"></a><span id="l277.37">     daemon.getArticle(&quot;&lt;1@regular.invalid&gt;&quot;).fullText);</span>
<a href="#l277.38"></a><span id="l277.38"> </span>
<a href="#l277.39"></a><span id="l277.39">   // Shut down connections</span>
<a href="#l277.40"></a><span id="l277.40">   MailServices.accounts.closeCachedConnections();</span>
<a href="#l277.41"></a><span id="l277.41">   server.stop();</span>
<a href="#l277.42"></a><span id="l277.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l278.1"></a><span id="l278.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug403242.js</span>
<a href="#l278.2"></a><span id="l278.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug403242.js</span>
<a href="#l278.3"></a><span id="l278.3" class="difflineat">@@ -22,29 +22,29 @@ function run_test() {</span>
<a href="#l278.4"></a><span id="l278.4">   let uri = folder.generateMessageURI(1);</span>
<a href="#l278.5"></a><span id="l278.5">   var msgService = Cc['@mozilla.org/messenger/messageservice;1?type=news']</span>
<a href="#l278.6"></a><span id="l278.6">                      .getService(Ci.nsIMsgMessageService);</span>
<a href="#l278.7"></a><span id="l278.7"> </span>
<a href="#l278.8"></a><span id="l278.8">   // Does the URL lie to us?</span>
<a href="#l278.9"></a><span id="l278.9">   let outObj = { value: null };</span>
<a href="#l278.10"></a><span id="l278.10">   msgService.GetUrlForUri(uri, outObj, null);</span>
<a href="#l278.11"></a><span id="l278.11">   let neckoUrl = outObj.value.QueryInterface(Ci.nsINntpUrl);</span>
<a href="#l278.12"></a><span id="l278.12" class="difflineminus">-  do_check_eq(neckoUrl.newsAction, Ci.nsINntpUrl.ActionFetchArticle);</span>
<a href="#l278.13"></a><span id="l278.13" class="difflineplus">+  Assert.equal(neckoUrl.newsAction, Ci.nsINntpUrl.ActionFetchArticle);</span>
<a href="#l278.14"></a><span id="l278.14"> </span>
<a href="#l278.15"></a><span id="l278.15">   // Pretend to display the message</span>
<a href="#l278.16"></a><span id="l278.16">   msgService.DisplayMessage(uri, articleTextListener, null, null, null, {});</span>
<a href="#l278.17"></a><span id="l278.17">   // Get the server to run</span>
<a href="#l278.18"></a><span id="l278.18">   var thread = gThreadManager.currentThread;</span>
<a href="#l278.19"></a><span id="l278.19">   while (!articleTextListener.finished)</span>
<a href="#l278.20"></a><span id="l278.20">     thread.processNextEvent(true);</span>
<a href="#l278.21"></a><span id="l278.21">   localserver.closeCachedConnections();</span>
<a href="#l278.22"></a><span id="l278.22">   server.stop();</span>
<a href="#l278.23"></a><span id="l278.23"> </span>
<a href="#l278.24"></a><span id="l278.24">   // Correct text?</span>
<a href="#l278.25"></a><span id="l278.25" class="difflineminus">-  do_check_eq(articleTextListener.data, daemon.getGroup(&quot;test1&quot;)[1].fullText);</span>
<a href="#l278.26"></a><span id="l278.26" class="difflineplus">+  Assert.equal(articleTextListener.data, daemon.getGroup(&quot;test1&quot;)[1].fullText);</span>
<a href="#l278.27"></a><span id="l278.27"> </span>
<a href="#l278.28"></a><span id="l278.28">   // No illegal commands?</span>
<a href="#l278.29"></a><span id="l278.29">   test = &quot;bug 403242&quot;;</span>
<a href="#l278.30"></a><span id="l278.30">   let transaction = server.playTransaction();</span>
<a href="#l278.31"></a><span id="l278.31">   do_check_transaction(transaction[transaction.length - 1],</span>
<a href="#l278.32"></a><span id="l278.32">     [&quot;MODE READER&quot;, &quot;GROUP test1&quot;, &quot;ARTICLE 1&quot;]);</span>
<a href="#l278.33"></a><span id="l278.33"> </span>
<a href="#l278.34"></a><span id="l278.34"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l279.1"></a><span id="l279.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug540288.js</span>
<a href="#l279.2"></a><span id="l279.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug540288.js</span>
<a href="#l279.3"></a><span id="l279.3" class="difflineat">@@ -15,22 +15,22 @@ var streamListener =</span>
<a href="#l279.4"></a><span id="l279.4"> </span>
<a href="#l279.5"></a><span id="l279.5">   QueryInterface:</span>
<a href="#l279.6"></a><span id="l279.6">     XPCOMUtils.generateQI([Ci.nsIStreamListener, Ci.nsIRequestObserver]),</span>
<a href="#l279.7"></a><span id="l279.7"> </span>
<a href="#l279.8"></a><span id="l279.8">   // nsIRequestObserver</span>
<a href="#l279.9"></a><span id="l279.9">   onStartRequest: function(aRequest, aContext) {</span>
<a href="#l279.10"></a><span id="l279.10">   },</span>
<a href="#l279.11"></a><span id="l279.11">   onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l279.12"></a><span id="l279.12" class="difflineminus">-    do_check_eq(aStatusCode, 0);</span>
<a href="#l279.13"></a><span id="l279.13" class="difflineplus">+    Assert.equal(aStatusCode, 0);</span>
<a href="#l279.14"></a><span id="l279.14"> </span>
<a href="#l279.15"></a><span id="l279.15">     // Reduce any \r\n to just \n so we can do a good comparison on any</span>
<a href="#l279.16"></a><span id="l279.16">     // platform.</span>
<a href="#l279.17"></a><span id="l279.17">     var reduced = this._data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l279.18"></a><span id="l279.18" class="difflineminus">-    do_check_eq(reduced, kSimpleNewsArticle);</span>
<a href="#l279.19"></a><span id="l279.19" class="difflineplus">+    Assert.equal(reduced, kSimpleNewsArticle);</span>
<a href="#l279.20"></a><span id="l279.20"> </span>
<a href="#l279.21"></a><span id="l279.21">     // We must finish closing connections and tidying up after a timeout</span>
<a href="#l279.22"></a><span id="l279.22">     // so that the thread has time to unwrap itself.</span>
<a href="#l279.23"></a><span id="l279.23">     do_timeout(0, doTestFinished);</span>
<a href="#l279.24"></a><span id="l279.24">   },</span>
<a href="#l279.25"></a><span id="l279.25"> </span>
<a href="#l279.26"></a><span id="l279.26">   // nsIStreamListener</span>
<a href="#l279.27"></a><span id="l279.27">   onDataAvailable: function(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l279.28"></a><span id="l279.28" class="difflineat">@@ -65,29 +65,29 @@ function run_test() {</span>
<a href="#l279.29"></a><span id="l279.29">   uri.spec = &quot;news://localhost:&quot; + server.port + &quot;/TSS1%40nntp.test&quot;;</span>
<a href="#l279.30"></a><span id="l279.30"> </span>
<a href="#l279.31"></a><span id="l279.31">   try {</span>
<a href="#l279.32"></a><span id="l279.32">     // Add an empty message to the cache</span>
<a href="#l279.33"></a><span id="l279.33">     MailServices.nntp</span>
<a href="#l279.34"></a><span id="l279.34">                 .cacheStorage</span>
<a href="#l279.35"></a><span id="l279.35">                 .asyncOpenURI(uri, &quot;&quot;, Ci.nsICacheStorage.OPEN_NORMALLY, {</span>
<a href="#l279.36"></a><span id="l279.36">       onCacheEntryAvailable: function(cacheEntry, isNew, appCache, status) {</span>
<a href="#l279.37"></a><span id="l279.37" class="difflineminus">-        do_check_eq(status, Components.results.NS_OK);</span>
<a href="#l279.38"></a><span id="l279.38" class="difflineplus">+        Assert.equal(status, Components.results.NS_OK);</span>
<a href="#l279.39"></a><span id="l279.39"> </span>
<a href="#l279.40"></a><span id="l279.40">         cacheEntry.markValid();</span>
<a href="#l279.41"></a><span id="l279.41"> </span>
<a href="#l279.42"></a><span id="l279.42">         // Get the folder and new mail</span>
<a href="#l279.43"></a><span id="l279.43">         var folder = localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l279.44"></a><span id="l279.44">         folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l279.45"></a><span id="l279.45">         folder.getNewMessages(null, {</span>
<a href="#l279.46"></a><span id="l279.46">           OnStopRunningUrl: function () { localserver.closeCachedConnections(); }});</span>
<a href="#l279.47"></a><span id="l279.47">         server.performTest();</span>
<a href="#l279.48"></a><span id="l279.48"> </span>
<a href="#l279.49"></a><span id="l279.49" class="difflineminus">-        do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l279.50"></a><span id="l279.50" class="difflineminus">-        do_check_true(folder.hasNewMessages);</span>
<a href="#l279.51"></a><span id="l279.51" class="difflineplus">+        Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l279.52"></a><span id="l279.52" class="difflineplus">+        Assert.ok(folder.hasNewMessages);</span>
<a href="#l279.53"></a><span id="l279.53"> </span>
<a href="#l279.54"></a><span id="l279.54">         server.resetTest();</span>
<a href="#l279.55"></a><span id="l279.55"> </span>
<a href="#l279.56"></a><span id="l279.56">         var message = folder.firstNewMessage;</span>
<a href="#l279.57"></a><span id="l279.57"> </span>
<a href="#l279.58"></a><span id="l279.58">         var messageUri = folder.getUriForMsg(message);</span>
<a href="#l279.59"></a><span id="l279.59"> </span>
<a href="#l279.60"></a><span id="l279.60">         MailServices.nntp</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l280.1"></a><span id="l280.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug695309.js</span>
<a href="#l280.2"></a><span id="l280.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug695309.js</span>
<a href="#l280.3"></a><span id="l280.3" class="difflineat">@@ -30,29 +30,29 @@ var tests = [</span>
<a href="#l280.4"></a><span id="l280.4">   test_newMsgs,</span>
<a href="#l280.5"></a><span id="l280.5">   trigger_bug,</span>
<a href="#l280.6"></a><span id="l280.6">   cleanUp</span>
<a href="#l280.7"></a><span id="l280.7"> ];</span>
<a href="#l280.8"></a><span id="l280.8"> </span>
<a href="#l280.9"></a><span id="l280.9"> function* test_newMsgs() {</span>
<a href="#l280.10"></a><span id="l280.10">   // Start by initializing the folder, and mark some messages as read.</span>
<a href="#l280.11"></a><span id="l280.11">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l280.12"></a><span id="l280.12" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 0);</span>
<a href="#l280.13"></a><span id="l280.13" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 0);</span>
<a href="#l280.14"></a><span id="l280.14">   folder.getNewMessages(null, asyncUrlListener);</span>
<a href="#l280.15"></a><span id="l280.15">   // Do another folder to use up both connections</span>
<a href="#l280.16"></a><span id="l280.16">   localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;)</span>
<a href="#l280.17"></a><span id="l280.17">                         .getNewMessages(null, asyncUrlListener);</span>
<a href="#l280.18"></a><span id="l280.18">   // Two things to listen for -- yield twice</span>
<a href="#l280.19"></a><span id="l280.19">   yield false;</span>
<a href="#l280.20"></a><span id="l280.20">   yield false;</span>
<a href="#l280.21"></a><span id="l280.21">   folder.QueryInterface(Ci.nsIMsgNewsFolder)</span>
<a href="#l280.22"></a><span id="l280.22">         .setReadSetFromStr(&quot;1-3&quot;);</span>
<a href="#l280.23"></a><span id="l280.23" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false) - folder.getNumUnread(false), 3);</span>
<a href="#l280.24"></a><span id="l280.24" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false) - folder.getNumUnread(false), 3);</span>
<a href="#l280.25"></a><span id="l280.25">   highWater = folder.getTotalMessages(false);</span>
<a href="#l280.26"></a><span id="l280.26" class="difflineminus">-  do_check_eq(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l280.27"></a><span id="l280.27" class="difflineplus">+  Assert.equal(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l280.28"></a><span id="l280.28"> }</span>
<a href="#l280.29"></a><span id="l280.29"> </span>
<a href="#l280.30"></a><span id="l280.30"> function* trigger_bug() {</span>
<a href="#l280.31"></a><span id="l280.31">   // Kill the connection and start it up again.</span>
<a href="#l280.32"></a><span id="l280.32">   dump(&quot;Stopping server!\n&quot;);</span>
<a href="#l280.33"></a><span id="l280.33">   server.stop();</span>
<a href="#l280.34"></a><span id="l280.34">   server.start();</span>
<a href="#l280.35"></a><span id="l280.35"> </span>
<a href="#l280.36"></a><span id="l280.36" class="difflineat">@@ -75,34 +75,34 @@ function* trigger_bug() {</span>
<a href="#l280.37"></a><span id="l280.37">       }</span>
<a href="#l280.38"></a><span id="l280.38">     },</span>
<a href="#l280.39"></a><span id="l280.39">     QueryInterface: XPCOMUtils.generateQI([Ci.nsIFolderListener])</span>
<a href="#l280.40"></a><span id="l280.40">   };</span>
<a href="#l280.41"></a><span id="l280.41">   MailServices.mailSession.AddFolderListener(folderListener, Ci.nsIFolderListener.event);</span>
<a href="#l280.42"></a><span id="l280.42">   // Again, two things will need to be listened for</span>
<a href="#l280.43"></a><span id="l280.43">   yield false;</span>
<a href="#l280.44"></a><span id="l280.44">   yield false;</span>
<a href="#l280.45"></a><span id="l280.45" class="difflineminus">-  do_check_eq(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l280.46"></a><span id="l280.46" class="difflineplus">+  Assert.equal(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l280.47"></a><span id="l280.47">   yield true;</span>
<a href="#l280.48"></a><span id="l280.48"> }</span>
<a href="#l280.49"></a><span id="l280.49"> function cleanUp() {</span>
<a href="#l280.50"></a><span id="l280.50">   localserver.closeCachedConnections();</span>
<a href="#l280.51"></a><span id="l280.51"> }</span>
<a href="#l280.52"></a><span id="l280.52"> function run_test() {</span>
<a href="#l280.53"></a><span id="l280.53">   daemon = setupNNTPDaemon();</span>
<a href="#l280.54"></a><span id="l280.54">   server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l280.55"></a><span id="l280.55">   server.start();</span>
<a href="#l280.56"></a><span id="l280.56">   localserver = setupLocalServer(server.port);</span>
<a href="#l280.57"></a><span id="l280.57"> </span>
<a href="#l280.58"></a><span id="l280.58">   // Bug 1050840:</span>
<a href="#l280.59"></a><span id="l280.59">   // Check if invalid value of the max_cached_connections pref</span>
<a href="#l280.60"></a><span id="l280.60">   // is properly folded into a sane value.</span>
<a href="#l280.61"></a><span id="l280.61">   localserver.maximumConnectionsNumber = -5;</span>
<a href="#l280.62"></a><span id="l280.62" class="difflineminus">-  do_check_eq(localserver.maximumConnectionsNumber, 1);</span>
<a href="#l280.63"></a><span id="l280.63" class="difflineplus">+  Assert.equal(localserver.maximumConnectionsNumber, 1);</span>
<a href="#l280.64"></a><span id="l280.64"> </span>
<a href="#l280.65"></a><span id="l280.65">   localserver.maximumConnectionsNumber = 0;</span>
<a href="#l280.66"></a><span id="l280.66" class="difflineminus">-  do_check_eq(localserver.maximumConnectionsNumber, 2);</span>
<a href="#l280.67"></a><span id="l280.67" class="difflineplus">+  Assert.equal(localserver.maximumConnectionsNumber, 2);</span>
<a href="#l280.68"></a><span id="l280.68"> </span>
<a href="#l280.69"></a><span id="l280.69">   localserver.maximumConnectionsNumber = 2;</span>
<a href="#l280.70"></a><span id="l280.70"> </span>
<a href="#l280.71"></a><span id="l280.71">   async_run_tests(tests);</span>
<a href="#l280.72"></a><span id="l280.72"> }</span>
<a href="#l280.73"></a><span id="l280.73"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l281.1"></a><span id="l281.1" class="difflineminus">--- a/mailnews/news/test/unit/test_filter.js</span>
<a href="#l281.2"></a><span id="l281.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_filter.js</span>
<a href="#l281.3"></a><span id="l281.3" class="difflineat">@@ -45,21 +45,21 @@ function testAttrib(handler, daemon, loc</span>
<a href="#l281.4"></a><span id="l281.4"> </span>
<a href="#l281.5"></a><span id="l281.5">   var headerEnum = folder.messages;</span>
<a href="#l281.6"></a><span id="l281.6">   var headers = [];</span>
<a href="#l281.7"></a><span id="l281.7">   while (headerEnum.hasMoreElements())</span>
<a href="#l281.8"></a><span id="l281.8">     headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l281.9"></a><span id="l281.9"> </span>
<a href="#l281.10"></a><span id="l281.10">   try</span>
<a href="#l281.11"></a><span id="l281.11">   {</span>
<a href="#l281.12"></a><span id="l281.12" class="difflineminus">-    do_check_eq(headers.length, 8);</span>
<a href="#l281.13"></a><span id="l281.13" class="difflineplus">+    Assert.equal(headers.length, 8);</span>
<a href="#l281.14"></a><span id="l281.14">     for (var header of headers) {</span>
<a href="#l281.15"></a><span id="l281.15">       var id = header.messageId;</span>
<a href="#l281.16"></a><span id="l281.16">       dump(&quot;Testing message &quot;+id+&quot;\n&quot;);</span>
<a href="#l281.17"></a><span id="l281.17" class="difflineminus">-      do_check_eq(header[attribResults[id][0]], attribResults[id][1]);</span>
<a href="#l281.18"></a><span id="l281.18" class="difflineplus">+      Assert.equal(header[attribResults[id][0]], attribResults[id][1]);</span>
<a href="#l281.19"></a><span id="l281.19">     }</span>
<a href="#l281.20"></a><span id="l281.20">   } catch (e) {</span>
<a href="#l281.21"></a><span id="l281.21">     print(server.playTransaction().them);</span>
<a href="#l281.22"></a><span id="l281.22">     throw e;</span>
<a href="#l281.23"></a><span id="l281.23">   } finally {</span>
<a href="#l281.24"></a><span id="l281.24">     server.stop();</span>
<a href="#l281.25"></a><span id="l281.25">   }</span>
<a href="#l281.26"></a><span id="l281.26"> </span>
<a href="#l281.27"></a><span id="l281.27" class="difflineat">@@ -102,24 +102,24 @@ function testAction(handler, daemon, loc</span>
<a href="#l281.28"></a><span id="l281.28"> </span>
<a href="#l281.29"></a><span id="l281.29">   var headerEnum = folder.messages;</span>
<a href="#l281.30"></a><span id="l281.30">   var headers = [];</span>
<a href="#l281.31"></a><span id="l281.31">   while (headerEnum.hasMoreElements())</span>
<a href="#l281.32"></a><span id="l281.32">     headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l281.33"></a><span id="l281.33"> </span>
<a href="#l281.34"></a><span id="l281.34">   try</span>
<a href="#l281.35"></a><span id="l281.35">   {</span>
<a href="#l281.36"></a><span id="l281.36" class="difflineminus">-    do_check_eq(headers.length, 7);</span>
<a href="#l281.37"></a><span id="l281.37" class="difflineplus">+    Assert.equal(headers.length, 7);</span>
<a href="#l281.38"></a><span id="l281.38">     for (var header of headers) {</span>
<a href="#l281.39"></a><span id="l281.39">       var id = header.messageId;</span>
<a href="#l281.40"></a><span id="l281.40">       dump(&quot;Testing message &quot;+id+&quot;\n&quot;);</span>
<a href="#l281.41"></a><span id="l281.41">       if (actionResults[id] instanceof Array)</span>
<a href="#l281.42"></a><span id="l281.42" class="difflineminus">-        do_check_eq(header[actionResults[id][0]], actionResults[id][1]);</span>
<a href="#l281.43"></a><span id="l281.43" class="difflineplus">+        Assert.equal(header[actionResults[id][0]], actionResults[id][1]);</span>
<a href="#l281.44"></a><span id="l281.44">       else</span>
<a href="#l281.45"></a><span id="l281.45" class="difflineminus">-        do_check_true(actionResults[id](header, folder));</span>
<a href="#l281.46"></a><span id="l281.46" class="difflineplus">+        Assert.ok(actionResults[id](header, folder));</span>
<a href="#l281.47"></a><span id="l281.47">     }</span>
<a href="#l281.48"></a><span id="l281.48">   } catch (e) {</span>
<a href="#l281.49"></a><span id="l281.49">     print(server.playTransaction().them);</span>
<a href="#l281.50"></a><span id="l281.50">     throw e;</span>
<a href="#l281.51"></a><span id="l281.51">   } finally {</span>
<a href="#l281.52"></a><span id="l281.52">     server.stop();</span>
<a href="#l281.53"></a><span id="l281.53">   }</span>
<a href="#l281.54"></a><span id="l281.54"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l282.1"></a><span id="l282.1" class="difflineminus">--- a/mailnews/news/test/unit/test_getNewsMessage.js</span>
<a href="#l282.2"></a><span id="l282.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_getNewsMessage.js</span>
<a href="#l282.3"></a><span id="l282.3" class="difflineat">@@ -20,22 +20,22 @@ var streamListener =</span>
<a href="#l282.4"></a><span id="l282.4"> </span>
<a href="#l282.5"></a><span id="l282.5">   QueryInterface:</span>
<a href="#l282.6"></a><span id="l282.6">     XPCOMUtils.generateQI([Ci.nsIStreamListener, Ci.nsIRequestObserver]),</span>
<a href="#l282.7"></a><span id="l282.7"> </span>
<a href="#l282.8"></a><span id="l282.8">   // nsIRequestObserver</span>
<a href="#l282.9"></a><span id="l282.9">   onStartRequest: function(aRequest, aContext) {</span>
<a href="#l282.10"></a><span id="l282.10">   },</span>
<a href="#l282.11"></a><span id="l282.11">   onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l282.12"></a><span id="l282.12" class="difflineminus">-    do_check_eq(aStatusCode, 0);</span>
<a href="#l282.13"></a><span id="l282.13" class="difflineplus">+    Assert.equal(aStatusCode, 0);</span>
<a href="#l282.14"></a><span id="l282.14"> </span>
<a href="#l282.15"></a><span id="l282.15">     // Reduce any \r\n to just \n so we can do a good comparison on any</span>
<a href="#l282.16"></a><span id="l282.16">     // platform.</span>
<a href="#l282.17"></a><span id="l282.17">     var reduced = this._data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l282.18"></a><span id="l282.18" class="difflineminus">-    do_check_eq(reduced, kSimpleNewsArticle);</span>
<a href="#l282.19"></a><span id="l282.19" class="difflineplus">+    Assert.equal(reduced, kSimpleNewsArticle);</span>
<a href="#l282.20"></a><span id="l282.20"> </span>
<a href="#l282.21"></a><span id="l282.21">     // We must finish closing connections and tidying up after a timeout</span>
<a href="#l282.22"></a><span id="l282.22">     // so that the thread has time to unwrap itself.</span>
<a href="#l282.23"></a><span id="l282.23">     do_timeout(0, doTestFinished);</span>
<a href="#l282.24"></a><span id="l282.24">   },</span>
<a href="#l282.25"></a><span id="l282.25"> </span>
<a href="#l282.26"></a><span id="l282.26">   // nsIStreamListener</span>
<a href="#l282.27"></a><span id="l282.27">   onDataAvailable: function(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l282.28"></a><span id="l282.28" class="difflineat">@@ -68,18 +68,18 @@ function run_test() {</span>
<a href="#l282.29"></a><span id="l282.29">   try {</span>
<a href="#l282.30"></a><span id="l282.30">     // Get the folder and new mail</span>
<a href="#l282.31"></a><span id="l282.31">     var folder = localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l282.32"></a><span id="l282.32">     folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l282.33"></a><span id="l282.33">     folder.getNewMessages(null, {</span>
<a href="#l282.34"></a><span id="l282.34">       OnStopRunningUrl: function () { localserver.closeCachedConnections(); }});</span>
<a href="#l282.35"></a><span id="l282.35">     server.performTest();</span>
<a href="#l282.36"></a><span id="l282.36"> </span>
<a href="#l282.37"></a><span id="l282.37" class="difflineminus">-    do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l282.38"></a><span id="l282.38" class="difflineminus">-    do_check_true(folder.hasNewMessages);</span>
<a href="#l282.39"></a><span id="l282.39" class="difflineplus">+    Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l282.40"></a><span id="l282.40" class="difflineplus">+    Assert.ok(folder.hasNewMessages);</span>
<a href="#l282.41"></a><span id="l282.41">  </span>
<a href="#l282.42"></a><span id="l282.42">     server.resetTest();</span>
<a href="#l282.43"></a><span id="l282.43"> </span>
<a href="#l282.44"></a><span id="l282.44">     var message = folder.firstNewMessage;</span>
<a href="#l282.45"></a><span id="l282.45"> </span>
<a href="#l282.46"></a><span id="l282.46">     var messageUri = folder.getUriForMsg(message);</span>
<a href="#l282.47"></a><span id="l282.47"> </span>
<a href="#l282.48"></a><span id="l282.48">     var nntpService = Cc[&quot;@mozilla.org/messenger/nntpservice;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l283.1"></a><span id="l283.1" class="difflineminus">--- a/mailnews/news/test/unit/test_internalUris.js</span>
<a href="#l283.2"></a><span id="l283.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_internalUris.js</span>
<a href="#l283.3"></a><span id="l283.3" class="difflineat">@@ -36,20 +36,20 @@ var tests = [</span>
<a href="#l283.4"></a><span id="l283.4">   test_postMessage,</span>
<a href="#l283.5"></a><span id="l283.5">   test_escapedName,</span>
<a href="#l283.6"></a><span id="l283.6">   cleanUp</span>
<a href="#l283.7"></a><span id="l283.7"> ];</span>
<a href="#l283.8"></a><span id="l283.8"> </span>
<a href="#l283.9"></a><span id="l283.9"> function* test_newMsgs() {</span>
<a href="#l283.10"></a><span id="l283.10">   // This tests nsMsgNewsFolder::GetNewsMessages via getNewMessages</span>
<a href="#l283.11"></a><span id="l283.11">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l283.12"></a><span id="l283.12" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 0);</span>
<a href="#l283.13"></a><span id="l283.13" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 0);</span>
<a href="#l283.14"></a><span id="l283.14">   folder.getNewMessages(null, asyncUrlListener);</span>
<a href="#l283.15"></a><span id="l283.15">   yield false;</span>
<a href="#l283.16"></a><span id="l283.16" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 8);</span>
<a href="#l283.17"></a><span id="l283.17" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 8);</span>
<a href="#l283.18"></a><span id="l283.18">   yield true;</span>
<a href="#l283.19"></a><span id="l283.19"> }</span>
<a href="#l283.20"></a><span id="l283.20"> </span>
<a href="#l283.21"></a><span id="l283.21"> // Prompts for cancel</span>
<a href="#l283.22"></a><span id="l283.22"> function alert(title, text) {}</span>
<a href="#l283.23"></a><span id="l283.23"> function confirmEx(title, text, flags) {  return 0; }</span>
<a href="#l283.24"></a><span id="l283.24"> </span>
<a href="#l283.25"></a><span id="l283.25"> function* test_cancel() {</span>
<a href="#l283.26"></a><span id="l283.26" class="difflineat">@@ -65,17 +65,17 @@ function* test_cancel() {</span>
<a href="#l283.27"></a><span id="l283.27">       }</span>
<a href="#l283.28"></a><span id="l283.28">     }</span>
<a href="#l283.29"></a><span id="l283.29">   };</span>
<a href="#l283.30"></a><span id="l283.30">   MailServices.mailSession.AddFolderListener(folderListener, Ci.nsIFolderListener.event);</span>
<a href="#l283.31"></a><span id="l283.31">   folder.QueryInterface(Ci.nsIMsgNewsFolder)</span>
<a href="#l283.32"></a><span id="l283.32">         .cancelMessage(hdr, dummyMsgWindow);</span>
<a href="#l283.33"></a><span id="l283.33">   yield false;</span>
<a href="#l283.34"></a><span id="l283.34"> </span>
<a href="#l283.35"></a><span id="l283.35" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 7);</span>
<a href="#l283.36"></a><span id="l283.36" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 7);</span>
<a href="#l283.37"></a><span id="l283.37">   yield true;</span>
<a href="#l283.38"></a><span id="l283.38"> }</span>
<a href="#l283.39"></a><span id="l283.39"> </span>
<a href="#l283.40"></a><span id="l283.40"> function* test_fetchMessage() {</span>
<a href="#l283.41"></a><span id="l283.41">   // Tests nsNntpService::CreateMessageIDURL via FetchMessage</span>
<a href="#l283.42"></a><span id="l283.42">   var statuscode = -1;</span>
<a href="#l283.43"></a><span id="l283.43">   let streamlistener = {</span>
<a href="#l283.44"></a><span id="l283.44">     onDataAvailable: function() {},</span>
<a href="#l283.45"></a><span id="l283.45" class="difflineat">@@ -85,17 +85,17 @@ function* test_fetchMessage() {</span>
<a href="#l283.46"></a><span id="l283.46">       statuscode = aStatus;</span>
<a href="#l283.47"></a><span id="l283.47">     },</span>
<a href="#l283.48"></a><span id="l283.48">     QueryInterface: XPCOMUtils.generateQI([Ci.nsIStreamListener,</span>
<a href="#l283.49"></a><span id="l283.49">                                            Ci.nsIRequestObserver])</span>
<a href="#l283.50"></a><span id="l283.50">   };</span>
<a href="#l283.51"></a><span id="l283.51">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l283.52"></a><span id="l283.52">   MailServices.nntp.fetchMessage(folder, 2, null, streamlistener, asyncUrlListener);</span>
<a href="#l283.53"></a><span id="l283.53">   yield false;</span>
<a href="#l283.54"></a><span id="l283.54" class="difflineminus">-  do_check_eq(statuscode, Components.results.NS_OK);</span>
<a href="#l283.55"></a><span id="l283.55" class="difflineplus">+  Assert.equal(statuscode, Components.results.NS_OK);</span>
<a href="#l283.56"></a><span id="l283.56">   yield true;</span>
<a href="#l283.57"></a><span id="l283.57"> }</span>
<a href="#l283.58"></a><span id="l283.58"> </span>
<a href="#l283.59"></a><span id="l283.59"> function* test_search() {</span>
<a href="#l283.60"></a><span id="l283.60">   // This tests nsNntpService::Search</span>
<a href="#l283.61"></a><span id="l283.61">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l283.62"></a><span id="l283.62">   var searchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l283.63"></a><span id="l283.63">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l283.64"></a><span id="l283.64" class="difflineat">@@ -119,17 +119,17 @@ function* test_search() {</span>
<a href="#l283.65"></a><span id="l283.65">     },</span>
<a href="#l283.66"></a><span id="l283.66">     onNewSearch: function() { hitCount = 0; }</span>
<a href="#l283.67"></a><span id="l283.67">   };</span>
<a href="#l283.68"></a><span id="l283.68">   searchSession.registerListener(searchListener);</span>
<a href="#l283.69"></a><span id="l283.69"> </span>
<a href="#l283.70"></a><span id="l283.70">   searchSession.search(null);</span>
<a href="#l283.71"></a><span id="l283.71">   yield false;</span>
<a href="#l283.72"></a><span id="l283.72"> </span>
<a href="#l283.73"></a><span id="l283.73" class="difflineminus">-  do_check_eq(hitCount, 1);</span>
<a href="#l283.74"></a><span id="l283.74" class="difflineplus">+  Assert.equal(hitCount, 1);</span>
<a href="#l283.75"></a><span id="l283.75">   yield true;</span>
<a href="#l283.76"></a><span id="l283.76"> }</span>
<a href="#l283.77"></a><span id="l283.77"> </span>
<a href="#l283.78"></a><span id="l283.78"> function* test_grouplist() {</span>
<a href="#l283.79"></a><span id="l283.79">   // This tests nsNntpService::GetListOfGroupsOnServer</span>
<a href="#l283.80"></a><span id="l283.80">   let subserver = localserver.QueryInterface(Ci.nsISubscribableServer);</span>
<a href="#l283.81"></a><span id="l283.81">   let subscribeListener = {</span>
<a href="#l283.82"></a><span id="l283.82">     OnDonePopulating: function () { async_driver(); }</span>
<a href="#l283.83"></a><span id="l283.83" class="difflineat">@@ -151,29 +151,29 @@ function* test_grouplist() {</span>
<a href="#l283.84"></a><span id="l283.84">     return groups;</span>
<a href="#l283.85"></a><span id="l283.85">   }</span>
<a href="#l283.86"></a><span id="l283.86"> </span>
<a href="#l283.87"></a><span id="l283.87">   MailServices.nntp.getListOfGroupsOnServer(localserver, null, false);</span>
<a href="#l283.88"></a><span id="l283.88">   yield false;</span>
<a href="#l283.89"></a><span id="l283.89"> </span>
<a href="#l283.90"></a><span id="l283.90">   let groups = enumGroups(&quot;&quot;);</span>
<a href="#l283.91"></a><span id="l283.91">   for (let group in daemon._groups)</span>
<a href="#l283.92"></a><span id="l283.92" class="difflineminus">-    do_check_true(groups.indexOf(group) &gt;= 0);</span>
<a href="#l283.93"></a><span id="l283.93" class="difflineplus">+    Assert.ok(groups.indexOf(group) &gt;= 0);</span>
<a href="#l283.94"></a><span id="l283.94"> </span>
<a href="#l283.95"></a><span id="l283.95">   // Release reference, somehow impedes GC of 'subserver'.</span>
<a href="#l283.96"></a><span id="l283.96">   subserver.subscribeListener = null;</span>
<a href="#l283.97"></a><span id="l283.97">   yield true;</span>
<a href="#l283.98"></a><span id="l283.98"> }</span>
<a href="#l283.99"></a><span id="l283.99"> </span>
<a href="#l283.100"></a><span id="l283.100"> function* test_postMessage() {</span>
<a href="#l283.101"></a><span id="l283.101">   // This tests nsNntpService::SetUpNntpUrlForPosting via PostMessage</span>
<a href="#l283.102"></a><span id="l283.102">   MailServices.nntp.postMessage(do_get_file(&quot;postings/post2.eml&quot;), &quot;misc.test&quot;,</span>
<a href="#l283.103"></a><span id="l283.103">     localserver.key, asyncUrlListener, null);</span>
<a href="#l283.104"></a><span id="l283.104">   yield false;</span>
<a href="#l283.105"></a><span id="l283.105" class="difflineminus">-  do_check_eq(daemon.getGroup(&quot;misc.test&quot;).keys.length, 1);</span>
<a href="#l283.106"></a><span id="l283.106" class="difflineplus">+  Assert.equal(daemon.getGroup(&quot;misc.test&quot;).keys.length, 1);</span>
<a href="#l283.107"></a><span id="l283.107">   yield true;</span>
<a href="#l283.108"></a><span id="l283.108"> }</span>
<a href="#l283.109"></a><span id="l283.109"> </span>
<a href="#l283.110"></a><span id="l283.110"> // Not tested because it requires UI, and this is insufficient, I think.</span>
<a href="#l283.111"></a><span id="l283.111"> function test_forwardInline() {</span>
<a href="#l283.112"></a><span id="l283.112">   // This tests mime_parse_stream_complete via forwarding inline</span>
<a href="#l283.113"></a><span id="l283.113">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l283.114"></a><span id="l283.114">   let hdr = folder.msgDatabase.GetMsgHdrForKey(1);</span>
<a href="#l283.115"></a><span id="l283.115" class="difflineat">@@ -204,17 +204,17 @@ function* test_escapedName() {</span>
<a href="#l283.116"></a><span id="l283.116">     onStopRequest: function (aRequest, aContext, aStatus) {</span>
<a href="#l283.117"></a><span id="l283.117">       statuscode = aStatus;</span>
<a href="#l283.118"></a><span id="l283.118">     },</span>
<a href="#l283.119"></a><span id="l283.119">     QueryInterface: XPCOMUtils.generateQI([Ci.nsIStreamListener,</span>
<a href="#l283.120"></a><span id="l283.120">                                            Ci.nsIRequestObserver])</span>
<a href="#l283.121"></a><span id="l283.121">   };</span>
<a href="#l283.122"></a><span id="l283.122">   MailServices.nntp.fetchMessage(folder, 1, null, streamlistener, asyncUrlListener);</span>
<a href="#l283.123"></a><span id="l283.123">   yield false;</span>
<a href="#l283.124"></a><span id="l283.124" class="difflineminus">-  do_check_eq(statuscode, Components.results.NS_OK);</span>
<a href="#l283.125"></a><span id="l283.125" class="difflineplus">+  Assert.equal(statuscode, Components.results.NS_OK);</span>
<a href="#l283.126"></a><span id="l283.126">   yield true;</span>
<a href="#l283.127"></a><span id="l283.127"> }</span>
<a href="#l283.128"></a><span id="l283.128"> </span>
<a href="#l283.129"></a><span id="l283.129"> function run_test() {</span>
<a href="#l283.130"></a><span id="l283.130">   daemon = setupNNTPDaemon();</span>
<a href="#l283.131"></a><span id="l283.131">   server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l283.132"></a><span id="l283.132">   server.start();</span>
<a href="#l283.133"></a><span id="l283.133">   localserver = setupLocalServer(server.port);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l284.1"></a><span id="l284.1" class="difflineminus">--- a/mailnews/news/test/unit/test_newsAutocomplete.js</span>
<a href="#l284.2"></a><span id="l284.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_newsAutocomplete.js</span>
<a href="#l284.3"></a><span id="l284.3" class="difflineat">@@ -47,59 +47,59 @@ function run_test() {</span>
<a href="#l284.4"></a><span id="l284.4">   let paramsMail = JSON.stringify({</span>
<a href="#l284.5"></a><span id="l284.5">     idKey: identity.key,</span>
<a href="#l284.6"></a><span id="l284.6">     accountKey: _account.key,</span>
<a href="#l284.7"></a><span id="l284.7">     type: &quot;addr_to&quot; });</span>
<a href="#l284.8"></a><span id="l284.8"> </span>
<a href="#l284.9"></a><span id="l284.9">   // misc.test is not subscribed</span>
<a href="#l284.10"></a><span id="l284.10">   obs = new acObserver();</span>
<a href="#l284.11"></a><span id="l284.11">   acs.startSearch(&quot;misc&quot;, paramsN, null, obs);</span>
<a href="#l284.12"></a><span id="l284.12" class="difflineminus">-  do_check_true(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.13"></a><span id="l284.13" class="difflineplus">+  Assert.ok(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.14"></a><span id="l284.14"> </span>
<a href="#l284.15"></a><span id="l284.15">   obs = new acObserver();</span>
<a href="#l284.16"></a><span id="l284.16">   acs.startSearch(&quot;misc&quot;, paramsF, null, obs);</span>
<a href="#l284.17"></a><span id="l284.17" class="difflineminus">-  do_check_true(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.18"></a><span id="l284.18" class="difflineplus">+  Assert.ok(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.19"></a><span id="l284.19"> </span>
<a href="#l284.20"></a><span id="l284.20">   obs = new acObserver();</span>
<a href="#l284.21"></a><span id="l284.21">   acs.startSearch(&quot;misc&quot;, paramsMail, null, obs);</span>
<a href="#l284.22"></a><span id="l284.22" class="difflineminus">-  do_check_true(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.23"></a><span id="l284.23" class="difflineplus">+  Assert.ok(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.24"></a><span id="l284.24"> </span>
<a href="#l284.25"></a><span id="l284.25">   // test.filter is subscribed</span>
<a href="#l284.26"></a><span id="l284.26">   obs = new acObserver();</span>
<a href="#l284.27"></a><span id="l284.27">   acs.startSearch(&quot;filter&quot;, paramsN, null, obs);</span>
<a href="#l284.28"></a><span id="l284.28" class="difflineminus">-  do_check_eq(obs._result.matchCount, 1);</span>
<a href="#l284.29"></a><span id="l284.29" class="difflineplus">+  Assert.equal(obs._result.matchCount, 1);</span>
<a href="#l284.30"></a><span id="l284.30"> </span>
<a href="#l284.31"></a><span id="l284.31">   obs = new acObserver();</span>
<a href="#l284.32"></a><span id="l284.32">   acs.startSearch(&quot;filter&quot;, paramsF, null, obs);</span>
<a href="#l284.33"></a><span id="l284.33" class="difflineminus">-  do_check_eq(obs._result.matchCount, 1);</span>
<a href="#l284.34"></a><span id="l284.34" class="difflineplus">+  Assert.equal(obs._result.matchCount, 1);</span>
<a href="#l284.35"></a><span id="l284.35"> </span>
<a href="#l284.36"></a><span id="l284.36">   // ... but no auto-complete should occur for addr_to</span>
<a href="#l284.37"></a><span id="l284.37">   obs = new acObserver();</span>
<a href="#l284.38"></a><span id="l284.38">   acs.startSearch(&quot;filter&quot;, paramsMail, null, obs);</span>
<a href="#l284.39"></a><span id="l284.39" class="difflineminus">-  do_check_true(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.40"></a><span id="l284.40" class="difflineplus">+  Assert.ok(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.41"></a><span id="l284.41"> </span>
<a href="#l284.42"></a><span id="l284.42">   // test.subscribe.empty and test.subscribe.simple are subscribed</span>
<a href="#l284.43"></a><span id="l284.43">   obs = new acObserver();</span>
<a href="#l284.44"></a><span id="l284.44">   acs.startSearch(&quot;subscribe&quot;, paramsN, null, obs);</span>
<a href="#l284.45"></a><span id="l284.45" class="difflineminus">-  do_check_eq(obs._result.matchCount, 2);</span>
<a href="#l284.46"></a><span id="l284.46" class="difflineplus">+  Assert.equal(obs._result.matchCount, 2);</span>
<a href="#l284.47"></a><span id="l284.47"> </span>
<a href="#l284.48"></a><span id="l284.48">   obs = new acObserver();</span>
<a href="#l284.49"></a><span id="l284.49">   acs.startSearch(&quot;subscribe&quot;, paramsF, null, obs);</span>
<a href="#l284.50"></a><span id="l284.50" class="difflineminus">-  do_check_eq(obs._result.matchCount, 2);</span>
<a href="#l284.51"></a><span id="l284.51" class="difflineplus">+  Assert.equal(obs._result.matchCount, 2);</span>
<a href="#l284.52"></a><span id="l284.52"> </span>
<a href="#l284.53"></a><span id="l284.53">   // ... but no auto-complete should occur for addr_to</span>
<a href="#l284.54"></a><span id="l284.54">   obs = new acObserver();</span>
<a href="#l284.55"></a><span id="l284.55">   acs.startSearch(&quot;subscribe&quot;, paramsMail, null, obs);</span>
<a href="#l284.56"></a><span id="l284.56" class="difflineminus">-  do_check_true(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.57"></a><span id="l284.57" class="difflineplus">+  Assert.ok(obs._result == null || obs._result.matchCount == 0);</span>
<a href="#l284.58"></a><span id="l284.58"> </span>
<a href="#l284.59"></a><span id="l284.59">   // test.subscribe.empty is subscribed, test.empty is not</span>
<a href="#l284.60"></a><span id="l284.60">   obs = new acObserver();</span>
<a href="#l284.61"></a><span id="l284.61">   acs.startSearch(&quot;empty&quot;, paramsN, null, obs);</span>
<a href="#l284.62"></a><span id="l284.62" class="difflineminus">-  do_check_eq(obs._result.matchCount, 1);</span>
<a href="#l284.63"></a><span id="l284.63" class="difflineplus">+  Assert.equal(obs._result.matchCount, 1);</span>
<a href="#l284.64"></a><span id="l284.64"> </span>
<a href="#l284.65"></a><span id="l284.65">   obs = new acObserver();</span>
<a href="#l284.66"></a><span id="l284.66">   acs.startSearch(&quot;empty&quot;, paramsF, null, obs);</span>
<a href="#l284.67"></a><span id="l284.67" class="difflineminus">-  do_check_eq(obs._result.matchCount, 1);</span>
<a href="#l284.68"></a><span id="l284.68" class="difflineplus">+  Assert.equal(obs._result.matchCount, 1);</span>
<a href="#l284.69"></a><span id="l284.69"> </span>
<a href="#l284.70"></a><span id="l284.70">   let thread = gThreadManager.currentThread;</span>
<a href="#l284.71"></a><span id="l284.71">   while (thread.hasPendingEvents())</span>
<a href="#l284.72"></a><span id="l284.72">     thread.processNextEvent(true);</span>
<a href="#l284.73"></a><span id="l284.73"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l285.1"></a><span id="l285.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l285.2"></a><span id="l285.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l285.3"></a><span id="l285.3" class="difflineat">@@ -25,18 +25,18 @@ function run_test() {</span>
<a href="#l285.4"></a><span id="l285.4">   try {</span>
<a href="#l285.5"></a><span id="l285.5">     // Get the folder and new mail</span>
<a href="#l285.6"></a><span id="l285.6">     let folder = localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l285.7"></a><span id="l285.7">     folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l285.8"></a><span id="l285.8">     folder.getNewMessages(null, {</span>
<a href="#l285.9"></a><span id="l285.9">       OnStopRunningUrl: function () { localserver.closeCachedConnections(); }});</span>
<a href="#l285.10"></a><span id="l285.10">     server.performTest();</span>
<a href="#l285.11"></a><span id="l285.11"> </span>
<a href="#l285.12"></a><span id="l285.12" class="difflineminus">-    do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l285.13"></a><span id="l285.13" class="difflineminus">-    do_check_true(folder.hasNewMessages);</span>
<a href="#l285.14"></a><span id="l285.14" class="difflineplus">+    Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l285.15"></a><span id="l285.15" class="difflineplus">+    Assert.ok(folder.hasNewMessages);</span>
<a href="#l285.16"></a><span id="l285.16"> </span>
<a href="#l285.17"></a><span id="l285.17">     server.resetTest();</span>
<a href="#l285.18"></a><span id="l285.18"> </span>
<a href="#l285.19"></a><span id="l285.19">     // Get the message URI</span>
<a href="#l285.20"></a><span id="l285.20">     let msgHdr = folder.firstNewMessage;</span>
<a href="#l285.21"></a><span id="l285.21">     let messageUri = folder.getUriForMsg(msgHdr);</span>
<a href="#l285.22"></a><span id="l285.22">     // Convert this to a URI that necko can run</span>
<a href="#l285.23"></a><span id="l285.23">     let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l285.24"></a><span id="l285.24" class="difflineat">@@ -49,28 +49,28 @@ function run_test() {</span>
<a href="#l285.25"></a><span id="l285.25"> </span>
<a href="#l285.26"></a><span id="l285.26">     // Get a channel from this URI, and check its content length</span>
<a href="#l285.27"></a><span id="l285.27">     let channel = Services.io.newChannelFromURI2(urlToRun,</span>
<a href="#l285.28"></a><span id="l285.28">                                                  null,</span>
<a href="#l285.29"></a><span id="l285.29">                                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l285.30"></a><span id="l285.30">                                                  null,</span>
<a href="#l285.31"></a><span id="l285.31">                                                  Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l285.32"></a><span id="l285.32">                                                  Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l285.33"></a><span id="l285.33" class="difflineminus">-    do_check_eq(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l285.34"></a><span id="l285.34" class="difflineplus">+    Assert.equal(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l285.35"></a><span id="l285.35"> </span>
<a href="#l285.36"></a><span id="l285.36">     // Now try an attachment. &amp;part=1.2</span>
<a href="#l285.37"></a><span id="l285.37">     // XXX the message doesn't really have an attachment</span>
<a href="#l285.38"></a><span id="l285.38">     let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;);</span>
<a href="#l285.39"></a><span id="l285.39">     let attachmentChannel = Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l285.40"></a><span id="l285.40">                                                            null,</span>
<a href="#l285.41"></a><span id="l285.41">                                                            Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l285.42"></a><span id="l285.42">                                                            null,</span>
<a href="#l285.43"></a><span id="l285.43">                                                            Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l285.44"></a><span id="l285.44">                                                            Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l285.45"></a><span id="l285.45">     // Currently attachments have their content length set to the length of the</span>
<a href="#l285.46"></a><span id="l285.46">     // entire message</span>
<a href="#l285.47"></a><span id="l285.47" class="difflineminus">-    do_check_eq(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l285.48"></a><span id="l285.48" class="difflineplus">+    Assert.equal(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l285.49"></a><span id="l285.49">   }</span>
<a href="#l285.50"></a><span id="l285.50">   catch (e) {</span>
<a href="#l285.51"></a><span id="l285.51">     server.stop();</span>
<a href="#l285.52"></a><span id="l285.52">     do_throw(e);</span>
<a href="#l285.53"></a><span id="l285.53">   }</span>
<a href="#l285.54"></a><span id="l285.54"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l286.1"></a><span id="l286.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPassword3.js</span>
<a href="#l286.2"></a><span id="l286.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPassword3.js</span>
<a href="#l286.3"></a><span id="l286.3" class="difflineat">@@ -25,24 +25,24 @@ add_task(function *() {</span>
<a href="#l286.4"></a><span id="l286.4">                                                                   kProtocol);</span>
<a href="#l286.5"></a><span id="l286.5"> </span>
<a href="#l286.6"></a><span id="l286.6">   var i;</span>
<a href="#l286.7"></a><span id="l286.7">   var count = {};</span>
<a href="#l286.8"></a><span id="l286.8"> </span>
<a href="#l286.9"></a><span id="l286.9">   // Test - Check there is a password to begin with...</span>
<a href="#l286.10"></a><span id="l286.10">   var logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l286.11"></a><span id="l286.11"> </span>
<a href="#l286.12"></a><span id="l286.12" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l286.13"></a><span id="l286.13" class="difflineminus">-  do_check_eq(logins[0].username, kUsername);</span>
<a href="#l286.14"></a><span id="l286.14" class="difflineminus">-  do_check_eq(logins[0].password, kPassword);</span>
<a href="#l286.15"></a><span id="l286.15" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l286.16"></a><span id="l286.16" class="difflineplus">+  Assert.equal(logins[0].username, kUsername);</span>
<a href="#l286.17"></a><span id="l286.17" class="difflineplus">+  Assert.equal(logins[0].password, kPassword);</span>
<a href="#l286.18"></a><span id="l286.18"> </span>
<a href="#l286.19"></a><span id="l286.19">   // Test - Remove the news password login via the incoming server</span>
<a href="#l286.20"></a><span id="l286.20">   incomingServer.forgetPassword();</span>
<a href="#l286.21"></a><span id="l286.21"> </span>
<a href="#l286.22"></a><span id="l286.22">   logins = Services.logins.findLogins(count, kServerUrl, null, kServerUrl);</span>
<a href="#l286.23"></a><span id="l286.23"> </span>
<a href="#l286.24"></a><span id="l286.24">   // should be no passwords left...</span>
<a href="#l286.25"></a><span id="l286.25" class="difflineminus">-  do_check_eq(count.value, 0);</span>
<a href="#l286.26"></a><span id="l286.26" class="difflineplus">+  Assert.equal(count.value, 0);</span>
<a href="#l286.27"></a><span id="l286.27"> });</span>
<a href="#l286.28"></a><span id="l286.28"> </span>
<a href="#l286.29"></a><span id="l286.29"> function run_test() {</span>
<a href="#l286.30"></a><span id="l286.30">   run_next_test();</span>
<a href="#l286.31"></a><span id="l286.31"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l287.1"></a><span id="l287.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPasswordFailure.js</span>
<a href="#l287.2"></a><span id="l287.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPasswordFailure.js</span>
<a href="#l287.3"></a><span id="l287.3" class="difflineat">@@ -30,17 +30,17 @@ var logins;</span>
<a href="#l287.4"></a><span id="l287.4"> var kUserName = &quot;testnews&quot;;</span>
<a href="#l287.5"></a><span id="l287.5"> var kInvalidPassword = &quot;newstest&quot;;</span>
<a href="#l287.6"></a><span id="l287.6"> var kValidPassword = &quot;notallama&quot;;</span>
<a href="#l287.7"></a><span id="l287.7"> </span>
<a href="#l287.8"></a><span id="l287.8"> function alert(aDialogText, aText)</span>
<a href="#l287.9"></a><span id="l287.9"> {</span>
<a href="#l287.10"></a><span id="l287.10">   // The first few attempts may prompt about the password problem, the last</span>
<a href="#l287.11"></a><span id="l287.11">   // attempt shouldn't.</span>
<a href="#l287.12"></a><span id="l287.12" class="difflineminus">-  do_check_true(attempt &lt; 4);</span>
<a href="#l287.13"></a><span id="l287.13" class="difflineplus">+  Assert.ok(attempt &lt; 4);</span>
<a href="#l287.14"></a><span id="l287.14"> </span>
<a href="#l287.15"></a><span id="l287.15">   // Log the fact we've got an alert, but we don't need to test anything here.</span>
<a href="#l287.16"></a><span id="l287.16">   dump(&quot;Alert Title: &quot; + aDialogText + &quot;\nAlert Text: &quot; + aText + &quot;\n&quot;);</span>
<a href="#l287.17"></a><span id="l287.17"> }</span>
<a href="#l287.18"></a><span id="l287.18"> </span>
<a href="#l287.19"></a><span id="l287.19"> function confirmEx(aDialogTitle, aText, aButtonFlags, aButton0Title,</span>
<a href="#l287.20"></a><span id="l287.20">                    aButton1Title, aButton2Title, aCheckMsg, aCheckState) {</span>
<a href="#l287.21"></a><span id="l287.21">   switch (++attempt) {</span>
<a href="#l287.22"></a><span id="l287.22" class="difflineat">@@ -83,18 +83,18 @@ function getMail() {</span>
<a href="#l287.23"></a><span id="l287.23"> </span>
<a href="#l287.24"></a><span id="l287.24"> var urlListener =</span>
<a href="#l287.25"></a><span id="l287.25"> {</span>
<a href="#l287.26"></a><span id="l287.26">   OnStartRunningUrl: function (url) {</span>
<a href="#l287.27"></a><span id="l287.27">   },</span>
<a href="#l287.28"></a><span id="l287.28">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l287.29"></a><span id="l287.29">     try {</span>
<a href="#l287.30"></a><span id="l287.30">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l287.31"></a><span id="l287.31" class="difflineminus">-      do_check_eq(folder.getTotalMessages(false),</span>
<a href="#l287.32"></a><span id="l287.32" class="difflineminus">-                  attempt == 4 ? 1 : 0);</span>
<a href="#l287.33"></a><span id="l287.33" class="difflineplus">+      Assert.equal(folder.getTotalMessages(false),</span>
<a href="#l287.34"></a><span id="l287.34" class="difflineplus">+                   attempt == 4 ? 1 : 0);</span>
<a href="#l287.35"></a><span id="l287.35"> </span>
<a href="#l287.36"></a><span id="l287.36">       // If we've just cancelled, expect failure rather than success</span>
<a href="#l287.37"></a><span id="l287.37">       // because the server dropped the connection.</span>
<a href="#l287.38"></a><span id="l287.38">       dump(&quot;in onStopRunning, result = &quot; + result + &quot;\n&quot;);</span>
<a href="#l287.39"></a><span id="l287.39">       //do_check_eq(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l287.40"></a><span id="l287.40">       async_driver();</span>
<a href="#l287.41"></a><span id="l287.41">     }</span>
<a href="#l287.42"></a><span id="l287.42">     catch (e) {</span>
<a href="#l287.43"></a><span id="l287.43" class="difflineat">@@ -120,26 +120,26 @@ var tests = [</span>
<a href="#l287.44"></a><span id="l287.44"> function* getMail1() {</span>
<a href="#l287.45"></a><span id="l287.45">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l287.46"></a><span id="l287.46"> </span>
<a href="#l287.47"></a><span id="l287.47">   // Now get mail</span>
<a href="#l287.48"></a><span id="l287.48">   getMail();</span>
<a href="#l287.49"></a><span id="l287.49">   yield false;</span>
<a href="#l287.50"></a><span id="l287.50">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l287.51"></a><span id="l287.51"> </span>
<a href="#l287.52"></a><span id="l287.52" class="difflineminus">-  do_check_eq(attempt, 2);</span>
<a href="#l287.53"></a><span id="l287.53" class="difflineplus">+  Assert.equal(attempt, 2);</span>
<a href="#l287.54"></a><span id="l287.54"> </span>
<a href="#l287.55"></a><span id="l287.55">   // Check that we haven't forgotten the login even though we've retried and</span>
<a href="#l287.56"></a><span id="l287.56">   // canceled.</span>
<a href="#l287.57"></a><span id="l287.57">   logins = Services.logins.findLogins(count, &quot;news://localhost&quot;, null,</span>
<a href="#l287.58"></a><span id="l287.58">                                       &quot;news://localhost&quot;);</span>
<a href="#l287.59"></a><span id="l287.59"> </span>
<a href="#l287.60"></a><span id="l287.60" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l287.61"></a><span id="l287.61" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l287.62"></a><span id="l287.62" class="difflineminus">-  do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l287.63"></a><span id="l287.63" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l287.64"></a><span id="l287.64" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l287.65"></a><span id="l287.65" class="difflineplus">+  Assert.equal(logins[0].password, kInvalidPassword);</span>
<a href="#l287.66"></a><span id="l287.66"> </span>
<a href="#l287.67"></a><span id="l287.67">   server.resetTest();</span>
<a href="#l287.68"></a><span id="l287.68">   yield true;</span>
<a href="#l287.69"></a><span id="l287.69"> }</span>
<a href="#l287.70"></a><span id="l287.70"> </span>
<a href="#l287.71"></a><span id="l287.71"> function* getMail2() {</span>
<a href="#l287.72"></a><span id="l287.72">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l287.73"></a><span id="l287.73"> </span>
<a href="#l287.74"></a><span id="l287.74" class="difflineat">@@ -149,19 +149,19 @@ function* getMail2() {</span>
<a href="#l287.75"></a><span id="l287.75">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l287.76"></a><span id="l287.76"> }</span>
<a href="#l287.77"></a><span id="l287.77"> </span>
<a href="#l287.78"></a><span id="l287.78"> function* endTest() {</span>
<a href="#l287.79"></a><span id="l287.79">   // Now check the new one has been saved.</span>
<a href="#l287.80"></a><span id="l287.80">   logins = Services.logins.findLogins(count, &quot;news://localhost&quot;, null,</span>
<a href="#l287.81"></a><span id="l287.81">                                       &quot;news://localhost&quot;);</span>
<a href="#l287.82"></a><span id="l287.82"> </span>
<a href="#l287.83"></a><span id="l287.83" class="difflineminus">-  do_check_eq(count.value, 1);</span>
<a href="#l287.84"></a><span id="l287.84" class="difflineminus">-  do_check_eq(logins[0].username, kUserName);</span>
<a href="#l287.85"></a><span id="l287.85" class="difflineminus">-  do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l287.86"></a><span id="l287.86" class="difflineplus">+  Assert.equal(count.value, 1);</span>
<a href="#l287.87"></a><span id="l287.87" class="difflineplus">+  Assert.equal(logins[0].username, kUserName);</span>
<a href="#l287.88"></a><span id="l287.88" class="difflineplus">+  Assert.equal(logins[0].password, kValidPassword);</span>
<a href="#l287.89"></a><span id="l287.89">   yield true;</span>
<a href="#l287.90"></a><span id="l287.90"> }</span>
<a href="#l287.91"></a><span id="l287.91"> </span>
<a href="#l287.92"></a><span id="l287.92"> function run_test()</span>
<a href="#l287.93"></a><span id="l287.93"> {</span>
<a href="#l287.94"></a><span id="l287.94">   mailTestUtils.registerUMimTypProvider();</span>
<a href="#l287.95"></a><span id="l287.95"> </span>
<a href="#l287.96"></a><span id="l287.96">   // Disable new mail notifications</span>
<a href="#l287.97"></a><span id="l287.97" class="difflineat">@@ -185,12 +185,12 @@ function run_test()</span>
<a href="#l287.98"></a><span id="l287.98">   }</span>
<a href="#l287.99"></a><span id="l287.99">   server = new nsMailServer(createHandler, daemon);</span>
<a href="#l287.100"></a><span id="l287.100">   server.start();</span>
<a href="#l287.101"></a><span id="l287.101">   incomingServer = setupLocalServer(server.port);</span>
<a href="#l287.102"></a><span id="l287.102">   folder = incomingServer.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l287.103"></a><span id="l287.103"> </span>
<a href="#l287.104"></a><span id="l287.104">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l287.105"></a><span id="l287.105">   // setup issue.</span>
<a href="#l287.106"></a><span id="l287.106" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 0);</span>
<a href="#l287.107"></a><span id="l287.107" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 0);</span>
<a href="#l287.108"></a><span id="l287.108"> </span>
<a href="#l287.109"></a><span id="l287.109">   async_run_tests(tests);</span>
<a href="#l287.110"></a><span id="l287.110"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l288.1"></a><span id="l288.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpProtocols.js</span>
<a href="#l288.2"></a><span id="l288.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpProtocols.js</span>
<a href="#l288.3"></a><span id="l288.3" class="difflineat">@@ -26,25 +26,25 @@ var protocols =</span>
<a href="#l288.4"></a><span id="l288.4"> function run_test() {</span>
<a href="#l288.5"></a><span id="l288.5">   for (var part = 0; part &lt; protocols.length; ++part) {</span>
<a href="#l288.6"></a><span id="l288.6">     print(&quot;protocol: &quot; + protocols[part].protocol);</span>
<a href="#l288.7"></a><span id="l288.7"> </span>
<a href="#l288.8"></a><span id="l288.8">     var pH = Cc[&quot;@mozilla.org/network/protocol;1?name=&quot; +</span>
<a href="#l288.9"></a><span id="l288.9">                 protocols[part].protocol]</span>
<a href="#l288.10"></a><span id="l288.10">                .createInstance(Ci.nsIProtocolHandler);</span>
<a href="#l288.11"></a><span id="l288.11"> </span>
<a href="#l288.12"></a><span id="l288.12" class="difflineminus">-    do_check_eq(pH.scheme, protocols[part].protocol);</span>
<a href="#l288.13"></a><span id="l288.13" class="difflineminus">-    do_check_eq(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l288.14"></a><span id="l288.14" class="difflineminus">-    do_check_eq(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l288.15"></a><span id="l288.15" class="difflineplus">+    Assert.equal(pH.scheme, protocols[part].protocol);</span>
<a href="#l288.16"></a><span id="l288.16" class="difflineplus">+    Assert.equal(pH.defaultPort, protocols[part].defaultPort);</span>
<a href="#l288.17"></a><span id="l288.17" class="difflineplus">+    Assert.equal(pH.protocolFlags, defaultProtocolFlags);</span>
<a href="#l288.18"></a><span id="l288.18"> </span>
<a href="#l288.19"></a><span id="l288.19">     // Whip through some of the ports to check we get the right results.</span>
<a href="#l288.20"></a><span id="l288.20">     // NEWS allows connecting to any port.</span>
<a href="#l288.21"></a><span id="l288.21">     for (let i = 0; i &lt; 1024; ++i)</span>
<a href="#l288.22"></a><span id="l288.22" class="difflineminus">-      do_check_true(pH.allowPort(i, &quot;&quot;));</span>
<a href="#l288.23"></a><span id="l288.23" class="difflineplus">+      Assert.ok(pH.allowPort(i, &quot;&quot;));</span>
<a href="#l288.24"></a><span id="l288.24"> </span>
<a href="#l288.25"></a><span id="l288.25">     // Check we get a URI when we ask for one</span>
<a href="#l288.26"></a><span id="l288.26">     var uri = pH.newURI(protocols[part].urlSpec);</span>
<a href="#l288.27"></a><span id="l288.27"> </span>
<a href="#l288.28"></a><span id="l288.28">     uri.QueryInterface(Ci.nsINntpUrl);</span>
<a href="#l288.29"></a><span id="l288.29"> </span>
<a href="#l288.30"></a><span id="l288.30" class="difflineminus">-    do_check_eq(uri.spec, protocols[part].urlSpec);</span>
<a href="#l288.31"></a><span id="l288.31" class="difflineplus">+    Assert.equal(uri.spec, protocols[part].urlSpec);</span>
<a href="#l288.32"></a><span id="l288.32">   }</span>
<a href="#l288.33"></a><span id="l288.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l289.1"></a><span id="l289.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpUrl.js</span>
<a href="#l289.2"></a><span id="l289.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpUrl.js</span>
<a href="#l289.3"></a><span id="l289.3" class="difflineat">@@ -18,13 +18,13 @@ function getMessageHeaderFromUrl(aUrl) {</span>
<a href="#l289.4"></a><span id="l289.4"> </span>
<a href="#l289.5"></a><span id="l289.5"> function run_test() {</span>
<a href="#l289.6"></a><span id="l289.6"> </span>
<a href="#l289.7"></a><span id="l289.7">   // This is crash test for Bug 392729</span>
<a href="#l289.8"></a><span id="l289.8">   try {</span>
<a href="#l289.9"></a><span id="l289.9">     // msgkey is invalid for news:// protocol</span>
<a href="#l289.10"></a><span id="l289.10">     let hdr = getMessageHeaderFromUrl(&quot;news://localhost:119&quot; +</span>
<a href="#l289.11"></a><span id="l289.11">                                       &quot;/123@example.invalid?group=test.subscribe.simple&amp;key=abcdefghijk&quot;);</span>
<a href="#l289.12"></a><span id="l289.12" class="difflineminus">-    do_check_true(false); </span>
<a href="#l289.13"></a><span id="l289.13" class="difflineplus">+    Assert.ok(false); </span>
<a href="#l289.14"></a><span id="l289.14">   } catch (e) {</span>
<a href="#l289.15"></a><span id="l289.15" class="difflineminus">-    do_check_eq(e.result, Components.results.NS_ERROR_MALFORMED_URI);</span>
<a href="#l289.16"></a><span id="l289.16" class="difflineplus">+    Assert.equal(e.result, Components.results.NS_ERROR_MALFORMED_URI);</span>
<a href="#l289.17"></a><span id="l289.17">   }</span>
<a href="#l289.18"></a><span id="l289.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l290.1"></a><span id="l290.1" class="difflineminus">--- a/mailnews/news/test/unit/test_server.js</span>
<a href="#l290.2"></a><span id="l290.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_server.js</span>
<a href="#l290.3"></a><span id="l290.3" class="difflineat">@@ -101,17 +101,17 @@ function testConnectionLimit() {</span>
<a href="#l290.4"></a><span id="l290.4"> </span>
<a href="#l290.5"></a><span id="l290.5">   // To test make connections limit, we run two URIs simultaneously.</span>
<a href="#l290.6"></a><span id="l290.6">   var url = URLCreator.newURI(prefix+&quot;*&quot;);</span>
<a href="#l290.7"></a><span id="l290.7">   _server.loadNewsUrl(url, null, null);</span>
<a href="#l290.8"></a><span id="l290.8">   setupProtocolTest(NNTP_PORT, prefix+&quot;TSS1@nntp.invalid&quot;);</span>
<a href="#l290.9"></a><span id="l290.9">   server.performTest();</span>
<a href="#l290.10"></a><span id="l290.10">   // We should have length one... which means this must be a transaction object,</span>
<a href="#l290.11"></a><span id="l290.11">   // containing only us and them</span>
<a href="#l290.12"></a><span id="l290.12" class="difflineminus">-  do_check_true('us' in server.playTransaction());</span>
<a href="#l290.13"></a><span id="l290.13" class="difflineplus">+  Assert.ok('us' in server.playTransaction());</span>
<a href="#l290.14"></a><span id="l290.14">   server.stop();</span>
<a href="#l290.15"></a><span id="l290.15"> </span>
<a href="#l290.16"></a><span id="l290.16">   var thread = gThreadManager.currentThread;</span>
<a href="#l290.17"></a><span id="l290.17">   while (thread.hasPendingEvents())</span>
<a href="#l290.18"></a><span id="l290.18">     thread.processNextEvent(true);</span>
<a href="#l290.19"></a><span id="l290.19"> }</span>
<a href="#l290.20"></a><span id="l290.20"> </span>
<a href="#l290.21"></a><span id="l290.21"> function testReentrantClose() {</span>
<a href="#l290.22"></a><span id="l290.22" class="difflineat">@@ -168,17 +168,17 @@ function testManyConnections() {</span>
<a href="#l290.23"></a><span id="l290.23">     groups.getNext().QueryInterface(Ci.nsIMsgFolder).getNewMessages(null,</span>
<a href="#l290.24"></a><span id="l290.24">       listener);</span>
<a href="#l290.25"></a><span id="l290.25">     listener.ran++;</span>
<a href="#l290.26"></a><span id="l290.26">   }</span>
<a href="#l290.27"></a><span id="l290.27">   server.performTest();</span>
<a href="#l290.28"></a><span id="l290.28">   // The last one that is processed is test.filter, so make sure that</span>
<a href="#l290.29"></a><span id="l290.29">   // test.subscribed.simple is not retrieving the data meant for test.filter</span>
<a href="#l290.30"></a><span id="l290.30">   let folder = _server.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;)</span>
<a href="#l290.31"></a><span id="l290.31" class="difflineminus">-  do_check_eq(folder.getTotalMessages(false), 1);</span>
<a href="#l290.32"></a><span id="l290.32" class="difflineplus">+  Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l290.33"></a><span id="l290.33"> }</span>
<a href="#l290.34"></a><span id="l290.34"> </span>
<a href="#l290.35"></a><span id="l290.35"> function run_test() {</span>
<a href="#l290.36"></a><span id="l290.36">   testRFC977();</span>
<a href="#l290.37"></a><span id="l290.37">   testConnectionLimit();</span>
<a href="#l290.38"></a><span id="l290.38">   testReentrantClose();</span>
<a href="#l290.39"></a><span id="l290.39">   testManyConnections();</span>
<a href="#l290.40"></a><span id="l290.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l291.1"></a><span id="l291.1" class="difflineminus">--- a/mailnews/news/test/unit/test_uriParser.js</span>
<a href="#l291.2"></a><span id="l291.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_uriParser.js</span>
<a href="#l291.3"></a><span id="l291.3" class="difflineat">@@ -146,27 +146,27 @@ function run_test() {</span>
<a href="#l291.4"></a><span id="l291.4">   for (let test of tests) {</span>
<a href="#l291.5"></a><span id="l291.5">     dump(&quot;Checking URL &quot; + test.uri + &quot;\n&quot;);</span>
<a href="#l291.6"></a><span id="l291.6">     let url = nntpService.newURI(test.uri);</span>
<a href="#l291.7"></a><span id="l291.7">     url.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l291.8"></a><span id="l291.8">     url.QueryInterface(Ci.nsINntpUrl);</span>
<a href="#l291.9"></a><span id="l291.9">     for (let prop in test) {</span>
<a href="#l291.10"></a><span id="l291.10">       if (prop == &quot;uri&quot;)</span>
<a href="#l291.11"></a><span id="l291.11">         continue;</span>
<a href="#l291.12"></a><span id="l291.12" class="difflineminus">-      do_check_eq(url[prop], test[prop]);</span>
<a href="#l291.13"></a><span id="l291.13" class="difflineplus">+      Assert.equal(url[prop], test[prop]);</span>
<a href="#l291.14"></a><span id="l291.14">     }</span>
<a href="#l291.15"></a><span id="l291.15">   }</span>
<a href="#l291.16"></a><span id="l291.16"> </span>
<a href="#l291.17"></a><span id="l291.17">   for (let fail of invalid_uris) {</span>
<a href="#l291.18"></a><span id="l291.18">     try {</span>
<a href="#l291.19"></a><span id="l291.19">       dump(&quot;Checking URL &quot; + fail + &quot; for failure\n&quot;);</span>
<a href="#l291.20"></a><span id="l291.20">       nntpService.newURI(fail);</span>
<a href="#l291.21"></a><span id="l291.21" class="difflineminus">-      do_check_true(false);</span>
<a href="#l291.22"></a><span id="l291.22" class="difflineplus">+      Assert.ok(false);</span>
<a href="#l291.23"></a><span id="l291.23">     } catch (e) {</span>
<a href="#l291.24"></a><span id="l291.24" class="difflineminus">-      do_check_eq(e.result, Components.results.NS_ERROR_MALFORMED_URI);</span>
<a href="#l291.25"></a><span id="l291.25" class="difflineplus">+      Assert.equal(e.result, Components.results.NS_ERROR_MALFORMED_URI);</span>
<a href="#l291.26"></a><span id="l291.26">     }</span>
<a href="#l291.27"></a><span id="l291.27">   }</span>
<a href="#l291.28"></a><span id="l291.28"> </span>
<a href="#l291.29"></a><span id="l291.29">   // The password migration is async, so trigger an event to prevent the logon</span>
<a href="#l291.30"></a><span id="l291.30">   // manager from trying to migrate after shutdown has started.</span>
<a href="#l291.31"></a><span id="l291.31">   let thread = Services.tm.currentThread;</span>
<a href="#l291.32"></a><span id="l291.32">   while (thread.hasPendingEvents())</span>
<a href="#l291.33"></a><span id="l291.33">     thread.processNextEvent(true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l292.1"></a><span id="l292.1" class="difflineminus">--- a/mailnews/test/resources/POP3pump.js</span>
<a href="#l292.2"></a><span id="l292.2" class="difflineplus">+++ b/mailnews/test/resources/POP3pump.js</span>
<a href="#l292.3"></a><span id="l292.3" class="difflineat">@@ -62,17 +62,17 @@ POP3Pump.prototype.OnStopRunningUrl = fu</span>
<a href="#l292.4"></a><span id="l292.4">   {</span>
<a href="#l292.5"></a><span id="l292.5">     // If we have an error, clean up nicely.</span>
<a href="#l292.6"></a><span id="l292.6">     this._server.stop();</span>
<a href="#l292.7"></a><span id="l292.7"> </span>
<a href="#l292.8"></a><span id="l292.8">     var thread = Services.tm.currentThread;</span>
<a href="#l292.9"></a><span id="l292.9">     while (thread.hasPendingEvents())</span>
<a href="#l292.10"></a><span id="l292.10">       thread.processNextEvent(true);</span>
<a href="#l292.11"></a><span id="l292.11">   }</span>
<a href="#l292.12"></a><span id="l292.12" class="difflineminus">-  do_check_eq(aResult, this._expectedResult);</span>
<a href="#l292.13"></a><span id="l292.13" class="difflineplus">+  Assert.equal(aResult, this._expectedResult);</span>
<a href="#l292.14"></a><span id="l292.14"> </span>
<a href="#l292.15"></a><span id="l292.15">   // Let OnStopRunningUrl return cleanly before doing anything else.</span>
<a href="#l292.16"></a><span id="l292.16">   do_timeout(0, _checkPumpBusy);</span>
<a href="#l292.17"></a><span id="l292.17"> };</span>
<a href="#l292.18"></a><span id="l292.18"> </span>
<a href="#l292.19"></a><span id="l292.19"> // Setup the daemon and server</span>
<a href="#l292.20"></a><span id="l292.20"> // If the debugOption is set, then it will be applied to the server.</span>
<a href="#l292.21"></a><span id="l292.21"> POP3Pump.prototype._setupServerDaemon = function _setupServerDaemon(aDebugOption)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l293.1"></a><span id="l293.1" class="difflineminus">--- a/mailnews/test/resources/msgFolderListenerSetup.js</span>
<a href="#l293.2"></a><span id="l293.2" class="difflineplus">+++ b/mailnews/test/resources/msgFolderListenerSetup.js</span>
<a href="#l293.3"></a><span id="l293.3" class="difflineat">@@ -159,18 +159,18 @@ var gMFListener =</span>
<a href="#l293.4"></a><span id="l293.4">         resetStatusAndProceed();</span>
<a href="#l293.5"></a><span id="l293.5">     }</span>
<a href="#l293.6"></a><span id="l293.6">   },</span>
<a href="#l293.7"></a><span id="l293.7"> </span>
<a href="#l293.8"></a><span id="l293.8">   itemEvent: function(aFolder, aEvent, aBetterBeNull, aBetterBeEmpty)</span>
<a href="#l293.9"></a><span id="l293.9">   {</span>
<a href="#l293.10"></a><span id="l293.10">     // we currently require the third argument to be null, and the fourth to be</span>
<a href="#l293.11"></a><span id="l293.11">     // empty...</span>
<a href="#l293.12"></a><span id="l293.12" class="difflineminus">-    do_check_eq(aBetterBeNull, null);</span>
<a href="#l293.13"></a><span id="l293.13" class="difflineminus">-    do_check_eq(aBetterBeEmpty, &quot;&quot;);</span>
<a href="#l293.14"></a><span id="l293.14" class="difflineplus">+    Assert.equal(aBetterBeNull, null);</span>
<a href="#l293.15"></a><span id="l293.15" class="difflineplus">+    Assert.equal(aBetterBeEmpty, &quot;&quot;);</span>
<a href="#l293.16"></a><span id="l293.16">     verify([gMFNService.itemEvent, aFolder, aEvent]);</span>
<a href="#l293.17"></a><span id="l293.17">     if (gExpectedEvents.length == 0)</span>
<a href="#l293.18"></a><span id="l293.18">     {</span>
<a href="#l293.19"></a><span id="l293.19">       gCurrStatus |= kStatus.notificationsDone;</span>
<a href="#l293.20"></a><span id="l293.20">       if (gCurrStatus == kStatus.everythingDone)</span>
<a href="#l293.21"></a><span id="l293.21">         resetStatusAndProceed();</span>
<a href="#l293.22"></a><span id="l293.22">     }</span>
<a href="#l293.23"></a><span id="l293.23">   }</span>
<a href="#l293.24"></a><span id="l293.24" class="difflineat">@@ -189,17 +189,17 @@ var copyListener =</span>
<a href="#l293.25"></a><span id="l293.25">     gHdrsReceived.push(this.mFolderStoredIn.GetMessageHeader(aKey));</span>
<a href="#l293.26"></a><span id="l293.26">   },</span>
<a href="#l293.27"></a><span id="l293.27">   GetMessageId: function(aMessageId) {</span>
<a href="#l293.28"></a><span id="l293.28">     aMessageId = {value: this.mMessageId};</span>
<a href="#l293.29"></a><span id="l293.29">   },</span>
<a href="#l293.30"></a><span id="l293.30">   OnStopCopy: function(aStatus)</span>
<a href="#l293.31"></a><span id="l293.31">   {</span>
<a href="#l293.32"></a><span id="l293.32">     // Check: message successfully copied.</span>
<a href="#l293.33"></a><span id="l293.33" class="difflineminus">-    do_check_eq(aStatus, 0);</span>
<a href="#l293.34"></a><span id="l293.34" class="difflineplus">+    Assert.equal(aStatus, 0);</span>
<a href="#l293.35"></a><span id="l293.35">     gCurrStatus |= kStatus.onStopCopyDone;</span>
<a href="#l293.36"></a><span id="l293.36">     if (gCurrStatus == kStatus.everythingDone)</span>
<a href="#l293.37"></a><span id="l293.37">       resetStatusAndProceed();</span>
<a href="#l293.38"></a><span id="l293.38">   }</span>
<a href="#l293.39"></a><span id="l293.39"> };</span>
<a href="#l293.40"></a><span id="l293.40"> </span>
<a href="#l293.41"></a><span id="l293.41"> function resetStatusAndProceed()</span>
<a href="#l293.42"></a><span id="l293.42"> {</span>
<a href="#l293.43"></a><span id="l293.43" class="difflineat">@@ -216,72 +216,72 @@ function resetStatusAndProceed()</span>
<a href="#l293.44"></a><span id="l293.44"> function hasExactlyElements(array, elements)</span>
<a href="#l293.45"></a><span id="l293.45"> {</span>
<a href="#l293.46"></a><span id="l293.46">   // If an nsIArray (it could also be a single header or a folder)</span>
<a href="#l293.47"></a><span id="l293.47">   if (elements instanceof nsIArray)</span>
<a href="#l293.48"></a><span id="l293.48">   {</span>
<a href="#l293.49"></a><span id="l293.49">     var count = elements.length;</span>
<a href="#l293.50"></a><span id="l293.50"> </span>
<a href="#l293.51"></a><span id="l293.51">     // Check: array sizes should be equal.</span>
<a href="#l293.52"></a><span id="l293.52" class="difflineminus">-    do_check_eq(count, array.length);</span>
<a href="#l293.53"></a><span id="l293.53" class="difflineplus">+    Assert.equal(count, array.length);</span>
<a href="#l293.54"></a><span id="l293.54"> </span>
<a href="#l293.55"></a><span id="l293.55">     for (var i = 0; i &lt; count; i++)</span>
<a href="#l293.56"></a><span id="l293.56">     {</span>
<a href="#l293.57"></a><span id="l293.57">       // Check: query element, must be a header or folder and present in the array</span>
<a href="#l293.58"></a><span id="l293.58">       var currElement;</span>
<a href="#l293.59"></a><span id="l293.59">       try {</span>
<a href="#l293.60"></a><span id="l293.60">         currElement = elements.queryElementAt(i, nsIMsgDBHdr);</span>
<a href="#l293.61"></a><span id="l293.61">       }</span>
<a href="#l293.62"></a><span id="l293.62">       catch (e) {}</span>
<a href="#l293.63"></a><span id="l293.63">       if (!currElement)</span>
<a href="#l293.64"></a><span id="l293.64">       {</span>
<a href="#l293.65"></a><span id="l293.65">         try {</span>
<a href="#l293.66"></a><span id="l293.66">           currElement = elements.queryElementAt(i, nsIMsgFolder);</span>
<a href="#l293.67"></a><span id="l293.67">         }</span>
<a href="#l293.68"></a><span id="l293.68">         catch (e) {}</span>
<a href="#l293.69"></a><span id="l293.69">       }</span>
<a href="#l293.70"></a><span id="l293.70" class="difflineminus">-      do_check_neq(currElement, undefined);</span>
<a href="#l293.71"></a><span id="l293.71" class="difflineminus">-      do_check_neq(mailTestUtils.non_strict_index_of(array, currElement), -1);</span>
<a href="#l293.72"></a><span id="l293.72" class="difflineplus">+      Assert.notEqual(currElement, undefined);</span>
<a href="#l293.73"></a><span id="l293.73" class="difflineplus">+      Assert.notEqual(mailTestUtils.non_strict_index_of(array, currElement), -1);</span>
<a href="#l293.74"></a><span id="l293.74">     }</span>
<a href="#l293.75"></a><span id="l293.75">   }</span>
<a href="#l293.76"></a><span id="l293.76">   // If a single header or a folder</span>
<a href="#l293.77"></a><span id="l293.77">   else if (elements instanceof nsIMsgDBHdr || elements instanceof nsIMsgFolder)</span>
<a href="#l293.78"></a><span id="l293.78">   {</span>
<a href="#l293.79"></a><span id="l293.79">     // Check: there should be only one element in the array.</span>
<a href="#l293.80"></a><span id="l293.80" class="difflineminus">-    do_check_eq(array.length, 1);</span>
<a href="#l293.81"></a><span id="l293.81" class="difflineplus">+    Assert.equal(array.length, 1);</span>
<a href="#l293.82"></a><span id="l293.82"> </span>
<a href="#l293.83"></a><span id="l293.83">     // Check: the element should be present</span>
<a href="#l293.84"></a><span id="l293.84" class="difflineminus">-    do_check_neq(mailTestUtils.non_strict_index_of(array, elements), -1);</span>
<a href="#l293.85"></a><span id="l293.85" class="difflineplus">+    Assert.notEqual(mailTestUtils.non_strict_index_of(array, elements), -1);</span>
<a href="#l293.86"></a><span id="l293.86">   }</span>
<a href="#l293.87"></a><span id="l293.87">   // This shouldn't happen</span>
<a href="#l293.88"></a><span id="l293.88">   else</span>
<a href="#l293.89"></a><span id="l293.89">     do_throw(&quot;Unrecognized item returned from listener&quot;);</span>
<a href="#l293.90"></a><span id="l293.90"> };</span>
<a href="#l293.91"></a><span id="l293.91"> </span>
<a href="#l293.92"></a><span id="l293.92"> // Verifies an event</span>
<a href="#l293.93"></a><span id="l293.93"> function verify(event)</span>
<a href="#l293.94"></a><span id="l293.94"> {</span>
<a href="#l293.95"></a><span id="l293.95">   // Check: make sure we actually have an item to process</span>
<a href="#l293.96"></a><span id="l293.96" class="difflineminus">-  do_check_true(gExpectedEvents.length &gt;= 1);</span>
<a href="#l293.97"></a><span id="l293.97" class="difflineplus">+  Assert.ok(gExpectedEvents.length &gt;= 1);</span>
<a href="#l293.98"></a><span id="l293.98">   var expected = gExpectedEvents.shift();</span>
<a href="#l293.99"></a><span id="l293.99"> </span>
<a href="#l293.100"></a><span id="l293.100">   // Check: events match.</span>
<a href="#l293.101"></a><span id="l293.101">   var eventType = expected[0];</span>
<a href="#l293.102"></a><span id="l293.102" class="difflineminus">-  do_check_eq(event[0], eventType);</span>
<a href="#l293.103"></a><span id="l293.103" class="difflineplus">+  Assert.equal(event[0], eventType);</span>
<a href="#l293.104"></a><span id="l293.104"> </span>
<a href="#l293.105"></a><span id="l293.105">   dump(&quot;..... Verifying event type &quot; + eventType + &quot;\n&quot;);</span>
<a href="#l293.106"></a><span id="l293.106"> </span>
<a href="#l293.107"></a><span id="l293.107">   switch (eventType)</span>
<a href="#l293.108"></a><span id="l293.108">   {</span>
<a href="#l293.109"></a><span id="l293.109">   case gMFNService.msgAdded:</span>
<a href="#l293.110"></a><span id="l293.110">     // So for IMAP right now, we aren't able to get the actual nsIMsgDBHdr.</span>
<a href="#l293.111"></a><span id="l293.111">     // Instead, we'll match up message ids as a (poor?) substitute.</span>
<a href="#l293.112"></a><span id="l293.112">     if (expected[1].expectedMessageId)</span>
<a href="#l293.113"></a><span id="l293.113">     {</span>
<a href="#l293.114"></a><span id="l293.114" class="difflineminus">-      do_check_eq(event[1].messageId, expected[1].expectedMessageId);</span>
<a href="#l293.115"></a><span id="l293.115" class="difflineplus">+      Assert.equal(event[1].messageId, expected[1].expectedMessageId);</span>
<a href="#l293.116"></a><span id="l293.116">       break;</span>
<a href="#l293.117"></a><span id="l293.117">     }</span>
<a href="#l293.118"></a><span id="l293.118">     // If we do have a header, fall through to the case below</span>
<a href="#l293.119"></a><span id="l293.119">   case gMFNService.msgsDeleted:</span>
<a href="#l293.120"></a><span id="l293.120">   case gMFNService.folderDeleted:</span>
<a href="#l293.121"></a><span id="l293.121">     // Check: headers match/folder matches.</span>
<a href="#l293.122"></a><span id="l293.122">     hasExactlyElements(expected[1], event[1]);</span>
<a href="#l293.123"></a><span id="l293.123">     break;</span>
<a href="#l293.124"></a><span id="l293.124" class="difflineat">@@ -296,74 +296,74 @@ function verify(event)</span>
<a href="#l293.125"></a><span id="l293.125">       // event is telling us about at least the N expected events and that</span>
<a href="#l293.126"></a><span id="l293.126">       // the last N of these events match</span>
<a href="#l293.127"></a><span id="l293.127">       if (event[1].length &lt; expected[1].length)</span>
<a href="#l293.128"></a><span id="l293.128">         do_throw(&quot;Not enough reported classified messages.&quot;);</span>
<a href="#l293.129"></a><span id="l293.129">       let ignoreCount = event[1].length - expected[1].length;</span>
<a href="#l293.130"></a><span id="l293.130">       for (let i = 0; i &lt; expected[1].length; i++) {</span>
<a href="#l293.131"></a><span id="l293.131">         let eventHeader = event[1].queryElementAt(i + ignoreCount,</span>
<a href="#l293.132"></a><span id="l293.132">                                                   nsIMsgDBHdr);</span>
<a href="#l293.133"></a><span id="l293.133" class="difflineminus">-        do_check_eq(expected[1][i], eventHeader.messageId);</span>
<a href="#l293.134"></a><span id="l293.134" class="difflineplus">+        Assert.equal(expected[1][i], eventHeader.messageId);</span>
<a href="#l293.135"></a><span id="l293.135">       }</span>
<a href="#l293.136"></a><span id="l293.136">     }</span>
<a href="#l293.137"></a><span id="l293.137">     else { // actual headers</span>
<a href="#l293.138"></a><span id="l293.138">       hasExactlyElements(expected[1], event[1]);</span>
<a href="#l293.139"></a><span id="l293.139">     }</span>
<a href="#l293.140"></a><span id="l293.140">     // aJunkProcessed: was the message processed for junk?</span>
<a href="#l293.141"></a><span id="l293.141" class="difflineminus">-    do_check_eq(expected[2], event[2]);</span>
<a href="#l293.142"></a><span id="l293.142" class="difflineplus">+    Assert.equal(expected[2], event[2]);</span>
<a href="#l293.143"></a><span id="l293.143">     // aTraitProcessed: was the message processed for traits?</span>
<a href="#l293.144"></a><span id="l293.144" class="difflineminus">-    do_check_eq(expected[3], event[3]);</span>
<a href="#l293.145"></a><span id="l293.145" class="difflineplus">+    Assert.equal(expected[3], event[3]);</span>
<a href="#l293.146"></a><span id="l293.146">     break;</span>
<a href="#l293.147"></a><span id="l293.147">   case gMFNService.msgKeyChanged:</span>
<a href="#l293.148"></a><span id="l293.148" class="difflineminus">-    do_check_eq(expected[1].messageId, event[2].expectedMessageId);</span>
<a href="#l293.149"></a><span id="l293.149" class="difflineplus">+    Assert.equal(expected[1].messageId, event[2].expectedMessageId);</span>
<a href="#l293.150"></a><span id="l293.150">     break;</span>
<a href="#l293.151"></a><span id="l293.151">   case gMFNService.msgsMoveCopyCompleted:</span>
<a href="#l293.152"></a><span id="l293.152">   case gMFNService.folderMoveCopyCompleted:</span>
<a href="#l293.153"></a><span id="l293.153">     // Check: Move or copy as expected.</span>
<a href="#l293.154"></a><span id="l293.154" class="difflineminus">-    do_check_eq(expected[1], event[1]);</span>
<a href="#l293.155"></a><span id="l293.155" class="difflineplus">+    Assert.equal(expected[1], event[1]);</span>
<a href="#l293.156"></a><span id="l293.156"> </span>
<a href="#l293.157"></a><span id="l293.157">     // Check: headers match/folder matches.</span>
<a href="#l293.158"></a><span id="l293.158">     hasExactlyElements(expected[2], event[2]);</span>
<a href="#l293.159"></a><span id="l293.159"> </span>
<a href="#l293.160"></a><span id="l293.160">     // Check: destination folder matches.</span>
<a href="#l293.161"></a><span id="l293.161" class="difflineminus">-    do_check_eq(expected[3], event[3]);</span>
<a href="#l293.162"></a><span id="l293.162" class="difflineplus">+    Assert.equal(expected[3], event[3]);</span>
<a href="#l293.163"></a><span id="l293.163"> </span>
<a href="#l293.164"></a><span id="l293.164">     if (eventType == gMFNService.folderMoveCopyCompleted)</span>
<a href="#l293.165"></a><span id="l293.165">       break;</span>
<a href="#l293.166"></a><span id="l293.166"> </span>
<a href="#l293.167"></a><span id="l293.167">     // Check: destination headers.  We expect these for local and imap folders,</span>
<a href="#l293.168"></a><span id="l293.168">     //  but we will not have heard about the headers ahead of time,</span>
<a href="#l293.169"></a><span id="l293.169">     //  so the best we can do is make sure they match up.  To this end,</span>
<a href="#l293.170"></a><span id="l293.170">     //  we check that the message-id header values match up.</span>
<a href="#l293.171"></a><span id="l293.171">     for (let iMsg = 0; iMsg &lt; event[2].length; iMsg++)</span>
<a href="#l293.172"></a><span id="l293.172">     {</span>
<a href="#l293.173"></a><span id="l293.173">       let srcHdr = event[2].queryElementAt(iMsg, nsIMsgDBHdr);</span>
<a href="#l293.174"></a><span id="l293.174">       let destHdr = event[4].queryElementAt(iMsg, nsIMsgDBHdr);</span>
<a href="#l293.175"></a><span id="l293.175" class="difflineminus">-      do_check_eq(srcHdr.messageId, destHdr.messageId);</span>
<a href="#l293.176"></a><span id="l293.176" class="difflineplus">+      Assert.equal(srcHdr.messageId, destHdr.messageId);</span>
<a href="#l293.177"></a><span id="l293.177">     }</span>
<a href="#l293.178"></a><span id="l293.178">     break;</span>
<a href="#l293.179"></a><span id="l293.179">   case gMFNService.folderAdded:</span>
<a href="#l293.180"></a><span id="l293.180">     // Check: parent folder matches</span>
<a href="#l293.181"></a><span id="l293.181" class="difflineminus">-    do_check_eq(event[1].parent, expected[1]);</span>
<a href="#l293.182"></a><span id="l293.182" class="difflineplus">+    Assert.equal(event[1].parent, expected[1]);</span>
<a href="#l293.183"></a><span id="l293.183"> </span>
<a href="#l293.184"></a><span id="l293.184">     // Check: folder name matches</span>
<a href="#l293.185"></a><span id="l293.185" class="difflineminus">-    do_check_eq(event[1].prettyName, expected[2]);</span>
<a href="#l293.186"></a><span id="l293.186" class="difflineminus">-    do_check_eq(event[1].name, expected[2]);</span>
<a href="#l293.187"></a><span id="l293.187" class="difflineplus">+    Assert.equal(event[1].prettyName, expected[2]);</span>
<a href="#l293.188"></a><span id="l293.188" class="difflineplus">+    Assert.equal(event[1].name, expected[2]);</span>
<a href="#l293.189"></a><span id="l293.189"> </span>
<a href="#l293.190"></a><span id="l293.190">     // Not a check, but if we have to store this folder somewhere, do it</span>
<a href="#l293.191"></a><span id="l293.191">     if (expected[3])</span>
<a href="#l293.192"></a><span id="l293.192">       eval(expected[3] + &quot;= event[1]&quot;);</span>
<a href="#l293.193"></a><span id="l293.193">     break;</span>
<a href="#l293.194"></a><span id="l293.194">   case gMFNService.folderRenamed:</span>
<a href="#l293.195"></a><span id="l293.195">     // Check: source folder matches</span>
<a href="#l293.196"></a><span id="l293.196">     hasExactlyElements(expected[1], event[1]);</span>
<a href="#l293.197"></a><span id="l293.197"> </span>
<a href="#l293.198"></a><span id="l293.198">     // Check: destination folder name matches</span>
<a href="#l293.199"></a><span id="l293.199" class="difflineminus">-    do_check_eq(expected[2], event[2].prettyName);</span>
<a href="#l293.200"></a><span id="l293.200" class="difflineplus">+    Assert.equal(expected[2], event[2].prettyName);</span>
<a href="#l293.201"></a><span id="l293.201">     break;</span>
<a href="#l293.202"></a><span id="l293.202">   case gMFNService.itemEvent:</span>
<a href="#l293.203"></a><span id="l293.203">     // the event string should match</span>
<a href="#l293.204"></a><span id="l293.204" class="difflineminus">-    do_check_eq(expected[2], event[2]);</span>
<a href="#l293.205"></a><span id="l293.205" class="difflineplus">+    Assert.equal(expected[2], event[2]);</span>
<a href="#l293.206"></a><span id="l293.206">     // and so should the folder we are talking about</span>
<a href="#l293.207"></a><span id="l293.207" class="difflineminus">-    do_check_eq(expected[1], event[1]);</span>
<a href="#l293.208"></a><span id="l293.208" class="difflineplus">+    Assert.equal(expected[1], event[1]);</span>
<a href="#l293.209"></a><span id="l293.209">     break;</span>
<a href="#l293.210"></a><span id="l293.210">   }</span>
<a href="#l293.211"></a><span id="l293.211"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l294.1"></a><span id="l294.1" class="difflineminus">--- a/mailnews/test/resources/searchTestUtils.js</span>
<a href="#l294.2"></a><span id="l294.2" class="difflineplus">+++ b/mailnews/test/resources/searchTestUtils.js</span>
<a href="#l294.3"></a><span id="l294.3" class="difflineat">@@ -29,17 +29,17 @@ function TestSearch(aFolder, aValue, aAt</span>
<a href="#l294.4"></a><span id="l294.4"> {</span>
<a href="#l294.5"></a><span id="l294.5">   var searchListener =</span>
<a href="#l294.6"></a><span id="l294.6">   { </span>
<a href="#l294.7"></a><span id="l294.7">     onSearchHit: function(dbHdr, folder) { hitCount++; },</span>
<a href="#l294.8"></a><span id="l294.8">     onSearchDone: function(status)</span>
<a href="#l294.9"></a><span id="l294.9">     { </span>
<a href="#l294.10"></a><span id="l294.10">       print(&quot;Finished search does &quot; + aHitCount + &quot; equal &quot; + hitCount + &quot;?&quot;);</span>
<a href="#l294.11"></a><span id="l294.11">       searchSession = null;</span>
<a href="#l294.12"></a><span id="l294.12" class="difflineminus">-      do_check_eq(aHitCount, hitCount);</span>
<a href="#l294.13"></a><span id="l294.13" class="difflineplus">+      Assert.equal(aHitCount, hitCount);</span>
<a href="#l294.14"></a><span id="l294.14">       if (onDone)</span>
<a href="#l294.15"></a><span id="l294.15">         onDone();</span>
<a href="#l294.16"></a><span id="l294.16">     },</span>
<a href="#l294.17"></a><span id="l294.17">     onNewSearch: function() {hitCount = 0;}</span>
<a href="#l294.18"></a><span id="l294.18">   };</span>
<a href="#l294.19"></a><span id="l294.19"> </span>
<a href="#l294.20"></a><span id="l294.20">   // define and initiate the search session</span>
<a href="#l294.21"></a><span id="l294.21">   </span>
<a href="#l294.22"></a><span id="l294.22" class="difflineat">@@ -108,17 +108,17 @@ function TestSearch(aFolder, aValue, aAt</span>
<a href="#l294.23"></a><span id="l294.23"> </span>
<a href="#l294.24"></a><span id="l294.24"> function testValidityTable(aScope, aOp, aAttrib, aValue)</span>
<a href="#l294.25"></a><span id="l294.25"> {</span>
<a href="#l294.26"></a><span id="l294.26">   var validityTable = gValidityManager.getTable(aScope);</span>
<a href="#l294.27"></a><span id="l294.27">   var isAvailable = validityTable.getAvailable(aAttrib, aOp);</span>
<a href="#l294.28"></a><span id="l294.28">   var isEnabled = validityTable.getEnabled(aAttrib, aOp);</span>
<a href="#l294.29"></a><span id="l294.29">   if (aValue)</span>
<a href="#l294.30"></a><span id="l294.30">   {</span>
<a href="#l294.31"></a><span id="l294.31" class="difflineminus">-    do_check_true(isAvailable);</span>
<a href="#l294.32"></a><span id="l294.32" class="difflineminus">-    do_check_true(isEnabled);</span>
<a href="#l294.33"></a><span id="l294.33" class="difflineplus">+    Assert.ok(isAvailable);</span>
<a href="#l294.34"></a><span id="l294.34" class="difflineplus">+    Assert.ok(isEnabled);</span>
<a href="#l294.35"></a><span id="l294.35">   }</span>
<a href="#l294.36"></a><span id="l294.36">   else</span>
<a href="#l294.37"></a><span id="l294.37">   {</span>
<a href="#l294.38"></a><span id="l294.38" class="difflineminus">-    do_check_false(isAvailable);</span>
<a href="#l294.39"></a><span id="l294.39" class="difflineminus">-    do_check_false(isEnabled);</span>
<a href="#l294.40"></a><span id="l294.40" class="difflineplus">+    Assert.ok(!isAvailable);</span>
<a href="#l294.41"></a><span id="l294.41" class="difflineplus">+    Assert.ok(!isEnabled);</span>
<a href="#l294.42"></a><span id="l294.42">   }</span>
<a href="#l294.43"></a><span id="l294.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l295.1"></a><span id="l295.1" class="difflineminus">--- a/suite/common/places/tests/autocomplete/head_autocomplete.js</span>
<a href="#l295.2"></a><span id="l295.2" class="difflineplus">+++ b/suite/common/places/tests/autocomplete/head_autocomplete.js</span>
<a href="#l295.3"></a><span id="l295.3" class="difflineat">@@ -75,21 +75,21 @@ function ensure_results(aSearch, aExpect</span>
<a href="#l295.4"></a><span id="l295.4">   controller.input = input;</span>
<a href="#l295.5"></a><span id="l295.5"> </span>
<a href="#l295.6"></a><span id="l295.6">   if (typeof kSearchParam == &quot;string&quot;)</span>
<a href="#l295.7"></a><span id="l295.7">     input.searchParam = kSearchParam;</span>
<a href="#l295.8"></a><span id="l295.8"> </span>
<a href="#l295.9"></a><span id="l295.9">   let numSearchesStarted = 0;</span>
<a href="#l295.10"></a><span id="l295.10">   input.onSearchBegin = function() {</span>
<a href="#l295.11"></a><span id="l295.11">     numSearchesStarted++;</span>
<a href="#l295.12"></a><span id="l295.12" class="difflineminus">-    do_check_eq(numSearchesStarted, 1);</span>
<a href="#l295.13"></a><span id="l295.13" class="difflineplus">+    Assert.equal(numSearchesStarted, 1);</span>
<a href="#l295.14"></a><span id="l295.14">   };</span>
<a href="#l295.15"></a><span id="l295.15"> </span>
<a href="#l295.16"></a><span id="l295.16">   input.onSearchComplete = function() {</span>
<a href="#l295.17"></a><span id="l295.17" class="difflineminus">-    do_check_eq(numSearchesStarted, 1);</span>
<a href="#l295.18"></a><span id="l295.18" class="difflineplus">+    Assert.equal(numSearchesStarted, 1);</span>
<a href="#l295.19"></a><span id="l295.19">     aExpected = aExpected.slice();</span>
<a href="#l295.20"></a><span id="l295.20"> </span>
<a href="#l295.21"></a><span id="l295.21">     // Check to see the expected uris and titles match up (in any order)</span>
<a href="#l295.22"></a><span id="l295.22">     for (let i = 0; i &lt; controller.matchCount; i++) {</span>
<a href="#l295.23"></a><span id="l295.23">       let value = controller.getValueAt(i);</span>
<a href="#l295.24"></a><span id="l295.24">       let comment = controller.getCommentAt(i);</span>
<a href="#l295.25"></a><span id="l295.25"> </span>
<a href="#l295.26"></a><span id="l295.26">       print(&quot;Looking for '&quot; + value + &quot;', '&quot; + comment + &quot;' in expected results...&quot;);</span>
<a href="#l295.27"></a><span id="l295.27" class="difflineat">@@ -120,22 +120,22 @@ function ensure_results(aSearch, aExpect</span>
<a href="#l295.28"></a><span id="l295.28">       // We didn't hit the break, so we must have not found it</span>
<a href="#l295.29"></a><span id="l295.29">       if (j == aExpected.length)</span>
<a href="#l295.30"></a><span id="l295.30">         do_throw(&quot;Didn't find the current result ('&quot; + value + &quot;', '&quot; + comment + &quot;') in expected: &quot; + aExpected);</span>
<a href="#l295.31"></a><span id="l295.31">     }</span>
<a href="#l295.32"></a><span id="l295.32"> </span>
<a href="#l295.33"></a><span id="l295.33">     // Make sure we have the right number of results</span>
<a href="#l295.34"></a><span id="l295.34">     print(&quot;Expecting &quot; + aExpected.length + &quot; results; got &quot; +</span>
<a href="#l295.35"></a><span id="l295.35">           controller.matchCount + &quot; results&quot;);</span>
<a href="#l295.36"></a><span id="l295.36" class="difflineminus">-    do_check_eq(controller.matchCount, aExpected.length);</span>
<a href="#l295.37"></a><span id="l295.37" class="difflineplus">+    Assert.equal(controller.matchCount, aExpected.length);</span>
<a href="#l295.38"></a><span id="l295.38"> </span>
<a href="#l295.39"></a><span id="l295.39">     // If we expect results, make sure we got matches</span>
<a href="#l295.40"></a><span id="l295.40" class="difflineminus">-    do_check_eq(controller.searchStatus, aExpected.length ?</span>
<a href="#l295.41"></a><span id="l295.41" class="difflineminus">-                Ci.nsIAutoCompleteController.STATUS_COMPLETE_MATCH :</span>
<a href="#l295.42"></a><span id="l295.42" class="difflineminus">-                Ci.nsIAutoCompleteController.STATUS_COMPLETE_NO_MATCH);</span>
<a href="#l295.43"></a><span id="l295.43" class="difflineplus">+    Assert.equal(controller.searchStatus, aExpected.length ?</span>
<a href="#l295.44"></a><span id="l295.44" class="difflineplus">+                 Ci.nsIAutoCompleteController.STATUS_COMPLETE_MATCH :</span>
<a href="#l295.45"></a><span id="l295.45" class="difflineplus">+                 Ci.nsIAutoCompleteController.STATUS_COMPLETE_NO_MATCH);</span>
<a href="#l295.46"></a><span id="l295.46"> </span>
<a href="#l295.47"></a><span id="l295.47">     // Fetch the next test if we have more</span>
<a href="#l295.48"></a><span id="l295.48">     if (++current_test &lt; gTests.length)</span>
<a href="#l295.49"></a><span id="l295.49">       run_test();</span>
<a href="#l295.50"></a><span id="l295.50"> </span>
<a href="#l295.51"></a><span id="l295.51">     do_test_finished();</span>
<a href="#l295.52"></a><span id="l295.52">   };</span>
<a href="#l295.53"></a><span id="l295.53"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l296.1"></a><span id="l296.1" class="difflineminus">--- a/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js</span>
<a href="#l296.2"></a><span id="l296.2" class="difflineplus">+++ b/suite/common/places/tests/autocomplete/test_autocomplete_on_value_removed_479089.js</span>
<a href="#l296.3"></a><span id="l296.3" class="difflineat">@@ -39,16 +39,16 @@ add_task(async function test_autocomplet</span>
<a href="#l296.4"></a><span id="l296.4">   // look for this uri only</span>
<a href="#l296.5"></a><span id="l296.5">   query.uri = testUri;</span>
<a href="#l296.6"></a><span id="l296.6">   // execute</span>
<a href="#l296.7"></a><span id="l296.7">   var queryRes = histsvc.executeQuery(query, options);</span>
<a href="#l296.8"></a><span id="l296.8">   // open the result container</span>
<a href="#l296.9"></a><span id="l296.9">   queryRes.root.containerOpen = true;</span>
<a href="#l296.10"></a><span id="l296.10">   // debug queries</span>
<a href="#l296.11"></a><span id="l296.11">   // dump_table(&quot;moz_places&quot;);</span>
<a href="#l296.12"></a><span id="l296.12" class="difflineminus">-  do_check_eq(queryRes.root.childCount, 1);</span>
<a href="#l296.13"></a><span id="l296.13" class="difflineplus">+  Assert.equal(queryRes.root.childCount, 1);</span>
<a href="#l296.14"></a><span id="l296.14">   // call the untested code path</span>
<a href="#l296.15"></a><span id="l296.15">   listener.onValueRemoved(null, testUri.spec, true);</span>
<a href="#l296.16"></a><span id="l296.16">   // make sure it is GONE from the DB</span>
<a href="#l296.17"></a><span id="l296.17" class="difflineminus">-  do_check_eq(queryRes.root.childCount, 0);</span>
<a href="#l296.18"></a><span id="l296.18" class="difflineplus">+  Assert.equal(queryRes.root.childCount, 0);</span>
<a href="#l296.19"></a><span id="l296.19">   // close the container</span>
<a href="#l296.20"></a><span id="l296.20">   queryRes.root.containerOpen = false;</span>
<a href="#l296.21"></a><span id="l296.21"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l297.1"></a><span id="l297.1" class="difflineminus">--- a/suite/common/places/tests/head_common.js</span>
<a href="#l297.2"></a><span id="l297.2" class="difflineplus">+++ b/suite/common/places/tests/head_common.js</span>
<a href="#l297.3"></a><span id="l297.3" class="difflineat">@@ -169,17 +169,17 @@ function readFileData(aFile) {</span>
<a href="#l297.4"></a><span id="l297.4">  *        This file should be located in the same folder as the test.</span>
<a href="#l297.5"></a><span id="l297.5">  * @param aExpectedLength</span>
<a href="#l297.6"></a><span id="l297.6">  *        Expected length of the file.</span>
<a href="#l297.7"></a><span id="l297.7">  *</span>
<a href="#l297.8"></a><span id="l297.8">  * @return The array of bytes read from the file.</span>
<a href="#l297.9"></a><span id="l297.9">  */</span>
<a href="#l297.10"></a><span id="l297.10"> function readFileOfLength(aFileName, aExpectedLength) {</span>
<a href="#l297.11"></a><span id="l297.11">   let data = readFileData(do_get_file(aFileName));</span>
<a href="#l297.12"></a><span id="l297.12" class="difflineminus">-  do_check_eq(data.length, aExpectedLength);</span>
<a href="#l297.13"></a><span id="l297.13" class="difflineplus">+  Assert.equal(data.length, aExpectedLength);</span>
<a href="#l297.14"></a><span id="l297.14">   return data;</span>
<a href="#l297.15"></a><span id="l297.15"> }</span>
<a href="#l297.16"></a><span id="l297.16"> </span>
<a href="#l297.17"></a><span id="l297.17"> </span>
<a href="#l297.18"></a><span id="l297.18"> /**</span>
<a href="#l297.19"></a><span id="l297.19">  * Returns the base64-encoded version of the given string.  This function is</span>
<a href="#l297.20"></a><span id="l297.20">  * similar to window.btoa, but is available to xpcshell tests also.</span>
<a href="#l297.21"></a><span id="l297.21">  *</span>
<a href="#l297.22"></a><span id="l297.22" class="difflineat">@@ -407,47 +407,47 @@ const FILENAME_BOOKMARKS_JSON = &quot;bookmar</span>
<a href="#l297.23"></a><span id="l297.23">  * @return nsIFile object for the file.</span>
<a href="#l297.24"></a><span id="l297.24">  */</span>
<a href="#l297.25"></a><span id="l297.25"> function create_bookmarks_html(aFilename) {</span>
<a href="#l297.26"></a><span id="l297.26">   if (!aFilename)</span>
<a href="#l297.27"></a><span id="l297.27">     do_throw(&quot;you must pass a filename to create_bookmarks_html function&quot;);</span>
<a href="#l297.28"></a><span id="l297.28">   remove_bookmarks_html();</span>
<a href="#l297.29"></a><span id="l297.29">   let bookmarksHTMLFile = gTestDir.clone();</span>
<a href="#l297.30"></a><span id="l297.30">   bookmarksHTMLFile.append(aFilename);</span>
<a href="#l297.31"></a><span id="l297.31" class="difflineminus">-  do_check_true(bookmarksHTMLFile.exists());</span>
<a href="#l297.32"></a><span id="l297.32" class="difflineplus">+  Assert.ok(bookmarksHTMLFile.exists());</span>
<a href="#l297.33"></a><span id="l297.33">   bookmarksHTMLFile.copyTo(gProfD, FILENAME_BOOKMARKS_HTML);</span>
<a href="#l297.34"></a><span id="l297.34">   let profileBookmarksHTMLFile = gProfD.clone();</span>
<a href="#l297.35"></a><span id="l297.35">   profileBookmarksHTMLFile.append(FILENAME_BOOKMARKS_HTML);</span>
<a href="#l297.36"></a><span id="l297.36" class="difflineminus">-  do_check_true(profileBookmarksHTMLFile.exists());</span>
<a href="#l297.37"></a><span id="l297.37" class="difflineplus">+  Assert.ok(profileBookmarksHTMLFile.exists());</span>
<a href="#l297.38"></a><span id="l297.38">   return profileBookmarksHTMLFile;</span>
<a href="#l297.39"></a><span id="l297.39"> }</span>
<a href="#l297.40"></a><span id="l297.40"> </span>
<a href="#l297.41"></a><span id="l297.41"> </span>
<a href="#l297.42"></a><span id="l297.42"> /**</span>
<a href="#l297.43"></a><span id="l297.43">  * Remove bookmarks.html file from the profile folder.</span>
<a href="#l297.44"></a><span id="l297.44">  */</span>
<a href="#l297.45"></a><span id="l297.45"> function remove_bookmarks_html() {</span>
<a href="#l297.46"></a><span id="l297.46">   let profileBookmarksHTMLFile = gProfD.clone();</span>
<a href="#l297.47"></a><span id="l297.47">   profileBookmarksHTMLFile.append(FILENAME_BOOKMARKS_HTML);</span>
<a href="#l297.48"></a><span id="l297.48">   if (profileBookmarksHTMLFile.exists()) {</span>
<a href="#l297.49"></a><span id="l297.49">     profileBookmarksHTMLFile.remove(false);</span>
<a href="#l297.50"></a><span id="l297.50" class="difflineminus">-    do_check_false(profileBookmarksHTMLFile.exists());</span>
<a href="#l297.51"></a><span id="l297.51" class="difflineplus">+    Assert.ok(!profileBookmarksHTMLFile.exists());</span>
<a href="#l297.52"></a><span id="l297.52">   }</span>
<a href="#l297.53"></a><span id="l297.53"> }</span>
<a href="#l297.54"></a><span id="l297.54"> </span>
<a href="#l297.55"></a><span id="l297.55"> </span>
<a href="#l297.56"></a><span id="l297.56"> /**</span>
<a href="#l297.57"></a><span id="l297.57">  * Check bookmarks.html file exists in the profile folder.</span>
<a href="#l297.58"></a><span id="l297.58">  *</span>
<a href="#l297.59"></a><span id="l297.59">  * @return nsIFile object for the file.</span>
<a href="#l297.60"></a><span id="l297.60">  */</span>
<a href="#l297.61"></a><span id="l297.61"> function check_bookmarks_html() {</span>
<a href="#l297.62"></a><span id="l297.62">   let profileBookmarksHTMLFile = gProfD.clone();</span>
<a href="#l297.63"></a><span id="l297.63">   profileBookmarksHTMLFile.append(FILENAME_BOOKMARKS_HTML);</span>
<a href="#l297.64"></a><span id="l297.64" class="difflineminus">-  do_check_true(profileBookmarksHTMLFile.exists());</span>
<a href="#l297.65"></a><span id="l297.65" class="difflineplus">+  Assert.ok(profileBookmarksHTMLFile.exists());</span>
<a href="#l297.66"></a><span id="l297.66">   return profileBookmarksHTMLFile;</span>
<a href="#l297.67"></a><span id="l297.67"> }</span>
<a href="#l297.68"></a><span id="l297.68"> </span>
<a href="#l297.69"></a><span id="l297.69"> </span>
<a href="#l297.70"></a><span id="l297.70"> /**</span>
<a href="#l297.71"></a><span id="l297.71">  * Creates a JSON backup in the profile folder folder from a given source file.</span>
<a href="#l297.72"></a><span id="l297.72">  *</span>
<a href="#l297.73"></a><span id="l297.73">  * @param aFilename</span>
<a href="#l297.74"></a><span id="l297.74" class="difflineat">@@ -458,43 +458,43 @@ function check_bookmarks_html() {</span>
<a href="#l297.75"></a><span id="l297.75">  */</span>
<a href="#l297.76"></a><span id="l297.76"> function create_JSON_backup(aFilename) {</span>
<a href="#l297.77"></a><span id="l297.77">   if (!aFilename)</span>
<a href="#l297.78"></a><span id="l297.78">     do_throw(&quot;you must pass a filename to create_JSON_backup function&quot;);</span>
<a href="#l297.79"></a><span id="l297.79">   let bookmarksBackupDir = gProfD.clone();</span>
<a href="#l297.80"></a><span id="l297.80">   bookmarksBackupDir.append(&quot;bookmarkbackups&quot;);</span>
<a href="#l297.81"></a><span id="l297.81">   if (!bookmarksBackupDir.exists()) {</span>
<a href="#l297.82"></a><span id="l297.82">     bookmarksBackupDir.create(Ci.nsIFile.DIRECTORY_TYPE, parseInt(&quot;0755&quot;, 8));</span>
<a href="#l297.83"></a><span id="l297.83" class="difflineminus">-    do_check_true(bookmarksBackupDir.exists());</span>
<a href="#l297.84"></a><span id="l297.84" class="difflineplus">+    Assert.ok(bookmarksBackupDir.exists());</span>
<a href="#l297.85"></a><span id="l297.85">   }</span>
<a href="#l297.86"></a><span id="l297.86">   let profileBookmarksJSONFile = bookmarksBackupDir.clone();</span>
<a href="#l297.87"></a><span id="l297.87">   profileBookmarksJSONFile.append(FILENAME_BOOKMARKS_JSON);</span>
<a href="#l297.88"></a><span id="l297.88">   if (profileBookmarksJSONFile.exists()) {</span>
<a href="#l297.89"></a><span id="l297.89">     profileBookmarksJSONFile.remove();</span>
<a href="#l297.90"></a><span id="l297.90">   }</span>
<a href="#l297.91"></a><span id="l297.91">   let bookmarksJSONFile = gTestDir.clone();</span>
<a href="#l297.92"></a><span id="l297.92">   bookmarksJSONFile.append(aFilename);</span>
<a href="#l297.93"></a><span id="l297.93" class="difflineminus">-  do_check_true(bookmarksJSONFile.exists());</span>
<a href="#l297.94"></a><span id="l297.94" class="difflineplus">+  Assert.ok(bookmarksJSONFile.exists());</span>
<a href="#l297.95"></a><span id="l297.95">   bookmarksJSONFile.copyTo(bookmarksBackupDir, FILENAME_BOOKMARKS_JSON);</span>
<a href="#l297.96"></a><span id="l297.96">   profileBookmarksJSONFile = bookmarksBackupDir.clone();</span>
<a href="#l297.97"></a><span id="l297.97">   profileBookmarksJSONFile.append(FILENAME_BOOKMARKS_JSON);</span>
<a href="#l297.98"></a><span id="l297.98" class="difflineminus">-  do_check_true(profileBookmarksJSONFile.exists());</span>
<a href="#l297.99"></a><span id="l297.99" class="difflineplus">+  Assert.ok(profileBookmarksJSONFile.exists());</span>
<a href="#l297.100"></a><span id="l297.100">   return profileBookmarksJSONFile;</span>
<a href="#l297.101"></a><span id="l297.101"> }</span>
<a href="#l297.102"></a><span id="l297.102"> </span>
<a href="#l297.103"></a><span id="l297.103"> </span>
<a href="#l297.104"></a><span id="l297.104"> /**</span>
<a href="#l297.105"></a><span id="l297.105">  * Remove bookmarksbackup dir and all backups from the profile folder.</span>
<a href="#l297.106"></a><span id="l297.106">  */</span>
<a href="#l297.107"></a><span id="l297.107"> function remove_all_JSON_backups() {</span>
<a href="#l297.108"></a><span id="l297.108">   let bookmarksBackupDir = gProfD.clone();</span>
<a href="#l297.109"></a><span id="l297.109">   bookmarksBackupDir.append(&quot;bookmarkbackups&quot;);</span>
<a href="#l297.110"></a><span id="l297.110">   if (bookmarksBackupDir.exists()) {</span>
<a href="#l297.111"></a><span id="l297.111">     bookmarksBackupDir.remove(true);</span>
<a href="#l297.112"></a><span id="l297.112" class="difflineminus">-    do_check_false(bookmarksBackupDir.exists());</span>
<a href="#l297.113"></a><span id="l297.113" class="difflineplus">+    Assert.ok(!bookmarksBackupDir.exists());</span>
<a href="#l297.114"></a><span id="l297.114">   }</span>
<a href="#l297.115"></a><span id="l297.115"> }</span>
<a href="#l297.116"></a><span id="l297.116"> </span>
<a href="#l297.117"></a><span id="l297.117"> </span>
<a href="#l297.118"></a><span id="l297.118"> /**</span>
<a href="#l297.119"></a><span id="l297.119">  * Check a JSON backup file for today exists in the profile folder.</span>
<a href="#l297.120"></a><span id="l297.120">  *</span>
<a href="#l297.121"></a><span id="l297.121">  * @param aIsAutomaticBackup The boolean indicates whether it's an automatic</span>
<a href="#l297.122"></a><span id="l297.122" class="difflineat">@@ -515,17 +515,17 @@ function check_JSON_backup(aIsAutomaticB</span>
<a href="#l297.123"></a><span id="l297.123">         break;</span>
<a href="#l297.124"></a><span id="l297.124">       }</span>
<a href="#l297.125"></a><span id="l297.125">     }</span>
<a href="#l297.126"></a><span id="l297.126">   } else {</span>
<a href="#l297.127"></a><span id="l297.127">     profileBookmarksJSONFile = gProfD.clone();</span>
<a href="#l297.128"></a><span id="l297.128">     profileBookmarksJSONFile.append(&quot;bookmarkbackups&quot;);</span>
<a href="#l297.129"></a><span id="l297.129">     profileBookmarksJSONFile.append(FILENAME_BOOKMARKS_JSON);</span>
<a href="#l297.130"></a><span id="l297.130">   }</span>
<a href="#l297.131"></a><span id="l297.131" class="difflineminus">-  do_check_true(profileBookmarksJSONFile.exists());</span>
<a href="#l297.132"></a><span id="l297.132" class="difflineplus">+  Assert.ok(profileBookmarksJSONFile.exists());</span>
<a href="#l297.133"></a><span id="l297.133">   return profileBookmarksJSONFile;</span>
<a href="#l297.134"></a><span id="l297.134"> }</span>
<a href="#l297.135"></a><span id="l297.135"> </span>
<a href="#l297.136"></a><span id="l297.136"> /**</span>
<a href="#l297.137"></a><span id="l297.137">  * Returns the frecency of a url.</span>
<a href="#l297.138"></a><span id="l297.138">  *</span>
<a href="#l297.139"></a><span id="l297.139">  * @param aURI</span>
<a href="#l297.140"></a><span id="l297.140">  *        The URI or spec to get frecency for.</span>
<a href="#l297.141"></a><span id="l297.141" class="difflineat">@@ -615,17 +615,17 @@ function waitForConnectionClosed(aCallba</span>
<a href="#l297.142"></a><span id="l297.142">  *        The stack frame used to report the error.</span>
<a href="#l297.143"></a><span id="l297.143">  */</span>
<a href="#l297.144"></a><span id="l297.144"> function do_check_valid_places_guid(aGuid,</span>
<a href="#l297.145"></a><span id="l297.145">                                     aStack)</span>
<a href="#l297.146"></a><span id="l297.146"> {</span>
<a href="#l297.147"></a><span id="l297.147">   if (!aStack) {</span>
<a href="#l297.148"></a><span id="l297.148">     aStack = Components.stack.caller;</span>
<a href="#l297.149"></a><span id="l297.149">   }</span>
<a href="#l297.150"></a><span id="l297.150" class="difflineminus">-  do_check_true(/^[a-zA-Z0-9\-_]{12}$/.test(aGuid), aStack);</span>
<a href="#l297.151"></a><span id="l297.151" class="difflineplus">+  Assert.ok(/^[a-zA-Z0-9\-_]{12}$/.test(aGuid), aStack);</span>
<a href="#l297.152"></a><span id="l297.152"> }</span>
<a href="#l297.153"></a><span id="l297.153"> </span>
<a href="#l297.154"></a><span id="l297.154"> /**</span>
<a href="#l297.155"></a><span id="l297.155">  * Retrieves the guid for a given uri.</span>
<a href="#l297.156"></a><span id="l297.156">  *</span>
<a href="#l297.157"></a><span id="l297.157">  * @param aURI</span>
<a href="#l297.158"></a><span id="l297.158">  *        The uri to check.</span>
<a href="#l297.159"></a><span id="l297.159">  * @param [optional] aStack</span>
<a href="#l297.160"></a><span id="l297.160" class="difflineat">@@ -639,17 +639,17 @@ function do_get_guid_for_uri(aURI,</span>
<a href="#l297.161"></a><span id="l297.161">     aStack = Components.stack.caller;</span>
<a href="#l297.162"></a><span id="l297.162">   }</span>
<a href="#l297.163"></a><span id="l297.163">   let stmt = DBConn().createStatement(</span>
<a href="#l297.164"></a><span id="l297.164">     `SELECT guid</span>
<a href="#l297.165"></a><span id="l297.165">      FROM moz_places</span>
<a href="#l297.166"></a><span id="l297.166">      WHERE url_hash = hash(:url) AND url = :url`</span>
<a href="#l297.167"></a><span id="l297.167">   );</span>
<a href="#l297.168"></a><span id="l297.168">   stmt.params.url = aURI.spec;</span>
<a href="#l297.169"></a><span id="l297.169" class="difflineminus">-  do_check_true(stmt.executeStep(), aStack);</span>
<a href="#l297.170"></a><span id="l297.170" class="difflineplus">+  Assert.ok(stmt.executeStep(), aStack);</span>
<a href="#l297.171"></a><span id="l297.171">   let guid = stmt.row.guid;</span>
<a href="#l297.172"></a><span id="l297.172">   stmt.finalize();</span>
<a href="#l297.173"></a><span id="l297.173">   do_check_valid_places_guid(guid, aStack);</span>
<a href="#l297.174"></a><span id="l297.174">   return guid;</span>
<a href="#l297.175"></a><span id="l297.175"> }</span>
<a href="#l297.176"></a><span id="l297.176"> </span>
<a href="#l297.177"></a><span id="l297.177"> /**</span>
<a href="#l297.178"></a><span id="l297.178">  * Tests that a guid was set in moz_places for a given uri.</span>
<a href="#l297.179"></a><span id="l297.179" class="difflineat">@@ -661,17 +661,17 @@ function do_get_guid_for_uri(aURI,</span>
<a href="#l297.180"></a><span id="l297.180">  */</span>
<a href="#l297.181"></a><span id="l297.181"> function do_check_guid_for_uri(aURI,</span>
<a href="#l297.182"></a><span id="l297.182">                                aGUID)</span>
<a href="#l297.183"></a><span id="l297.183"> {</span>
<a href="#l297.184"></a><span id="l297.184">   let caller = Components.stack.caller;</span>
<a href="#l297.185"></a><span id="l297.185">   let guid = do_get_guid_for_uri(aURI, caller);</span>
<a href="#l297.186"></a><span id="l297.186">   if (aGUID) {</span>
<a href="#l297.187"></a><span id="l297.187">     do_check_valid_places_guid(aGUID, caller);</span>
<a href="#l297.188"></a><span id="l297.188" class="difflineminus">-    do_check_eq(guid, aGUID, caller);</span>
<a href="#l297.189"></a><span id="l297.189" class="difflineplus">+    Assert.equal(guid, aGUID, caller);</span>
<a href="#l297.190"></a><span id="l297.190">   }</span>
<a href="#l297.191"></a><span id="l297.191"> }</span>
<a href="#l297.192"></a><span id="l297.192"> </span>
<a href="#l297.193"></a><span id="l297.193"> /**</span>
<a href="#l297.194"></a><span id="l297.194">  * Retrieves the guid for a given bookmark.</span>
<a href="#l297.195"></a><span id="l297.195">  *</span>
<a href="#l297.196"></a><span id="l297.196">  * @param aId</span>
<a href="#l297.197"></a><span id="l297.197">  *        The bookmark id to check.</span>
<a href="#l297.198"></a><span id="l297.198" class="difflineat">@@ -686,17 +686,17 @@ function do_get_guid_for_bookmark(aId,</span>
<a href="#l297.199"></a><span id="l297.199">     aStack = Components.stack.caller;</span>
<a href="#l297.200"></a><span id="l297.200">   }</span>
<a href="#l297.201"></a><span id="l297.201">   let stmt = DBConn().createStatement(</span>
<a href="#l297.202"></a><span id="l297.202">     `SELECT guid</span>
<a href="#l297.203"></a><span id="l297.203">      FROM moz_bookmarks</span>
<a href="#l297.204"></a><span id="l297.204">      WHERE id = :item_id`</span>
<a href="#l297.205"></a><span id="l297.205">   );</span>
<a href="#l297.206"></a><span id="l297.206">   stmt.params.item_id = aId;</span>
<a href="#l297.207"></a><span id="l297.207" class="difflineminus">-  do_check_true(stmt.executeStep(), aStack);</span>
<a href="#l297.208"></a><span id="l297.208" class="difflineplus">+  Assert.ok(stmt.executeStep(), aStack);</span>
<a href="#l297.209"></a><span id="l297.209">   let guid = stmt.row.guid;</span>
<a href="#l297.210"></a><span id="l297.210">   stmt.finalize();</span>
<a href="#l297.211"></a><span id="l297.211">   do_check_valid_places_guid(guid, aStack);</span>
<a href="#l297.212"></a><span id="l297.212">   return guid;</span>
<a href="#l297.213"></a><span id="l297.213"> }</span>
<a href="#l297.214"></a><span id="l297.214"> </span>
<a href="#l297.215"></a><span id="l297.215"> /**</span>
<a href="#l297.216"></a><span id="l297.216">  * Tests that a guid was set in moz_places for a given bookmark.</span>
<a href="#l297.217"></a><span id="l297.217" class="difflineat">@@ -708,17 +708,17 @@ function do_get_guid_for_bookmark(aId,</span>
<a href="#l297.218"></a><span id="l297.218">  */</span>
<a href="#l297.219"></a><span id="l297.219"> function do_check_guid_for_bookmark(aId,</span>
<a href="#l297.220"></a><span id="l297.220">                                     aGUID)</span>
<a href="#l297.221"></a><span id="l297.221"> {</span>
<a href="#l297.222"></a><span id="l297.222">   let caller = Components.stack.caller;</span>
<a href="#l297.223"></a><span id="l297.223">   let guid = do_get_guid_for_bookmark(aId, caller);</span>
<a href="#l297.224"></a><span id="l297.224">   if (aGUID) {</span>
<a href="#l297.225"></a><span id="l297.225">     do_check_valid_places_guid(aGUID, caller);</span>
<a href="#l297.226"></a><span id="l297.226" class="difflineminus">-    do_check_eq(guid, aGUID, caller);</span>
<a href="#l297.227"></a><span id="l297.227" class="difflineplus">+    Assert.equal(guid, aGUID, caller);</span>
<a href="#l297.228"></a><span id="l297.228">   }</span>
<a href="#l297.229"></a><span id="l297.229"> }</span>
<a href="#l297.230"></a><span id="l297.230"> </span>
<a href="#l297.231"></a><span id="l297.231"> /**</span>
<a href="#l297.232"></a><span id="l297.232">  * Compares 2 arrays returning whether they contains the same elements.</span>
<a href="#l297.233"></a><span id="l297.233">  *</span>
<a href="#l297.234"></a><span id="l297.234">  * @param a1</span>
<a href="#l297.235"></a><span id="l297.235">  *        First array to compare.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l298.1"></a><span id="l298.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_421483.js</span>
<a href="#l298.2"></a><span id="l298.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_421483.js</span>
<a href="#l298.3"></a><span id="l298.3" class="difflineat">@@ -34,51 +34,51 @@ const SMART_BOOKMARKS_ANNO = &quot;Places/Sma</span>
<a href="#l298.4"></a><span id="l298.4"> const SMART_BOOKMARKS_PREF = &quot;browser.places.smartBookmarksVersion&quot;;</span>
<a href="#l298.5"></a><span id="l298.5"> </span>
<a href="#l298.6"></a><span id="l298.6"> // main</span>
<a href="#l298.7"></a><span id="l298.7"> function run_test() {</span>
<a href="#l298.8"></a><span id="l298.8">   // TEST 1: smart bookmarks disabled</span>
<a href="#l298.9"></a><span id="l298.9">   Services.prefs.setIntPref(&quot;browser.places.smartBookmarksVersion&quot;, -1);</span>
<a href="#l298.10"></a><span id="l298.10">   gluesvc.ensurePlacesDefaultQueriesInitialized();</span>
<a href="#l298.11"></a><span id="l298.11">   var smartBookmarkItemIds = annosvc.getItemsWithAnnotation(SMART_BOOKMARKS_ANNO);</span>
<a href="#l298.12"></a><span id="l298.12" class="difflineminus">-  do_check_eq(smartBookmarkItemIds.length, 0);</span>
<a href="#l298.13"></a><span id="l298.13" class="difflineplus">+  Assert.equal(smartBookmarkItemIds.length, 0);</span>
<a href="#l298.14"></a><span id="l298.14">   // check that pref has not been bumped up</span>
<a href="#l298.15"></a><span id="l298.15" class="difflineminus">-  do_check_eq(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;), -1);</span>
<a href="#l298.16"></a><span id="l298.16" class="difflineplus">+  Assert.equal(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;), -1);</span>
<a href="#l298.17"></a><span id="l298.17"> </span>
<a href="#l298.18"></a><span id="l298.18">   // TEST 2: create smart bookmarks</span>
<a href="#l298.19"></a><span id="l298.19">   Services.prefs.setIntPref(&quot;browser.places.smartBookmarksVersion&quot;, 0);</span>
<a href="#l298.20"></a><span id="l298.20">   gluesvc.ensurePlacesDefaultQueriesInitialized();</span>
<a href="#l298.21"></a><span id="l298.21">   smartBookmarkItemIds = annosvc.getItemsWithAnnotation(SMART_BOOKMARKS_ANNO);</span>
<a href="#l298.22"></a><span id="l298.22" class="difflineminus">-  do_check_neq(smartBookmarkItemIds.length, 0);</span>
<a href="#l298.23"></a><span id="l298.23" class="difflineplus">+  Assert.notEqual(smartBookmarkItemIds.length, 0);</span>
<a href="#l298.24"></a><span id="l298.24">   // check that pref has been bumped up</span>
<a href="#l298.25"></a><span id="l298.25" class="difflineminus">-  do_check_true(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;) &gt; 0);</span>
<a href="#l298.26"></a><span id="l298.26" class="difflineplus">+  Assert.ok(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;) &gt; 0);</span>
<a href="#l298.27"></a><span id="l298.27"> </span>
<a href="#l298.28"></a><span id="l298.28">   var smartBookmarksCount = smartBookmarkItemIds.length;</span>
<a href="#l298.29"></a><span id="l298.29"> </span>
<a href="#l298.30"></a><span id="l298.30">   // TEST 3: smart bookmarks restore</span>
<a href="#l298.31"></a><span id="l298.31">   // remove one smart bookmark and restore</span>
<a href="#l298.32"></a><span id="l298.32">   bmsvc.removeItem(smartBookmarkItemIds[0]);</span>
<a href="#l298.33"></a><span id="l298.33">   Services.prefs.setIntPref(&quot;browser.places.smartBookmarksVersion&quot;, 0);</span>
<a href="#l298.34"></a><span id="l298.34">   gluesvc.ensurePlacesDefaultQueriesInitialized();</span>
<a href="#l298.35"></a><span id="l298.35">   smartBookmarkItemIds = annosvc.getItemsWithAnnotation(SMART_BOOKMARKS_ANNO);</span>
<a href="#l298.36"></a><span id="l298.36" class="difflineminus">-  do_check_eq(smartBookmarkItemIds.length, smartBookmarksCount);</span>
<a href="#l298.37"></a><span id="l298.37" class="difflineplus">+  Assert.equal(smartBookmarkItemIds.length, smartBookmarksCount);</span>
<a href="#l298.38"></a><span id="l298.38">   // check that pref has been bumped up</span>
<a href="#l298.39"></a><span id="l298.39" class="difflineminus">-  do_check_true(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;) &gt; 0);</span>
<a href="#l298.40"></a><span id="l298.40" class="difflineplus">+  Assert.ok(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;) &gt; 0);</span>
<a href="#l298.41"></a><span id="l298.41"> </span>
<a href="#l298.42"></a><span id="l298.42">   // TEST 4: move a smart bookmark, change its title, then restore</span>
<a href="#l298.43"></a><span id="l298.43">   // smart bookmark should be restored in place</span>
<a href="#l298.44"></a><span id="l298.44">   var parent = bmsvc.getFolderIdForItem(smartBookmarkItemIds[0]);</span>
<a href="#l298.45"></a><span id="l298.45">   var oldTitle = bmsvc.getItemTitle(smartBookmarkItemIds[0]);</span>
<a href="#l298.46"></a><span id="l298.46">   // create a subfolder and move inside it</span>
<a href="#l298.47"></a><span id="l298.47">   var newParent = bmsvc.createFolder(parent, &quot;test&quot;, bmsvc.DEFAULT_INDEX);</span>
<a href="#l298.48"></a><span id="l298.48">   bmsvc.moveItem(smartBookmarkItemIds[0], newParent, bmsvc.DEFAULT_INDEX);</span>
<a href="#l298.49"></a><span id="l298.49">   // change title</span>
<a href="#l298.50"></a><span id="l298.50">   bmsvc.setItemTitle(smartBookmarkItemIds[0], &quot;new title&quot;);</span>
<a href="#l298.51"></a><span id="l298.51">   // restore</span>
<a href="#l298.52"></a><span id="l298.52">   Services.prefs.setIntPref(&quot;browser.places.smartBookmarksVersion&quot;, 0);</span>
<a href="#l298.53"></a><span id="l298.53">   gluesvc.ensurePlacesDefaultQueriesInitialized();</span>
<a href="#l298.54"></a><span id="l298.54">   smartBookmarkItemIds = annosvc.getItemsWithAnnotation(SMART_BOOKMARKS_ANNO);</span>
<a href="#l298.55"></a><span id="l298.55" class="difflineminus">-  do_check_eq(smartBookmarkItemIds.length, smartBookmarksCount);</span>
<a href="#l298.56"></a><span id="l298.56" class="difflineminus">-  do_check_eq(bmsvc.getFolderIdForItem(smartBookmarkItemIds[0]), newParent);</span>
<a href="#l298.57"></a><span id="l298.57" class="difflineminus">-  do_check_eq(bmsvc.getItemTitle(smartBookmarkItemIds[0]), oldTitle);</span>
<a href="#l298.58"></a><span id="l298.58" class="difflineplus">+  Assert.equal(smartBookmarkItemIds.length, smartBookmarksCount);</span>
<a href="#l298.59"></a><span id="l298.59" class="difflineplus">+  Assert.equal(bmsvc.getFolderIdForItem(smartBookmarkItemIds[0]), newParent);</span>
<a href="#l298.60"></a><span id="l298.60" class="difflineplus">+  Assert.equal(bmsvc.getItemTitle(smartBookmarkItemIds[0]), oldTitle);</span>
<a href="#l298.61"></a><span id="l298.61">   // check that pref has been bumped up</span>
<a href="#l298.62"></a><span id="l298.62" class="difflineminus">-  do_check_true(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;) &gt; 0);</span>
<a href="#l298.63"></a><span id="l298.63" class="difflineplus">+  Assert.ok(Services.prefs.getIntPref(&quot;browser.places.smartBookmarksVersion&quot;) &gt; 0);</span>
<a href="#l298.64"></a><span id="l298.64"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l299.1"></a><span id="l299.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_PUIU_makeTransaction.js</span>
<a href="#l299.2"></a><span id="l299.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_PUIU_makeTransaction.js</span>
<a href="#l299.3"></a><span id="l299.3" class="difflineat">@@ -89,20 +89,20 @@ function wrapNodeByIdAndParent(aItemId, </span>
<a href="#l299.4"></a><span id="l299.4"> </span>
<a href="#l299.5"></a><span id="l299.5"> add_test(function test_text_paste()</span>
<a href="#l299.6"></a><span id="l299.6"> {</span>
<a href="#l299.7"></a><span id="l299.7">   const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l299.8"></a><span id="l299.8">   const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l299.9"></a><span id="l299.9"> </span>
<a href="#l299.10"></a><span id="l299.10">   waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l299.11"></a><span id="l299.11">   {</span>
<a href="#l299.12"></a><span id="l299.12" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.13"></a><span id="l299.13" class="difflineminus">-    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l299.14"></a><span id="l299.14" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.15"></a><span id="l299.15" class="difflineminus">-    do_check_eq(aData.index, 0);</span>
<a href="#l299.16"></a><span id="l299.16" class="difflineplus">+    Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.17"></a><span id="l299.17" class="difflineplus">+    Assert.equal(aData.url, TEST_URL);</span>
<a href="#l299.18"></a><span id="l299.18" class="difflineplus">+    Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.19"></a><span id="l299.19" class="difflineplus">+    Assert.equal(aData.index, 0);</span>
<a href="#l299.20"></a><span id="l299.20">     run_next_test();</span>
<a href="#l299.21"></a><span id="l299.21">   });</span>
<a href="#l299.22"></a><span id="l299.22"> </span>
<a href="#l299.23"></a><span id="l299.23">   let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l299.24"></a><span id="l299.24">     { title: TEST_TITLE, uri: TEST_URL },</span>
<a href="#l299.25"></a><span id="l299.25">     PlacesUtils.TYPE_X_MOZ_URL,</span>
<a href="#l299.26"></a><span id="l299.26">     PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l299.27"></a><span id="l299.27">     PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l299.28"></a><span id="l299.28" class="difflineat">@@ -112,32 +112,32 @@ add_test(function test_text_paste()</span>
<a href="#l299.29"></a><span id="l299.29"> });</span>
<a href="#l299.30"></a><span id="l299.30"> </span>
<a href="#l299.31"></a><span id="l299.31"> add_test(function test_container()</span>
<a href="#l299.32"></a><span id="l299.32"> {</span>
<a href="#l299.33"></a><span id="l299.33">   const TEST_TITLE = &quot;Places folder&quot;</span>
<a href="#l299.34"></a><span id="l299.34"> </span>
<a href="#l299.35"></a><span id="l299.35">   waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l299.36"></a><span id="l299.36">   {</span>
<a href="#l299.37"></a><span id="l299.37" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.38"></a><span id="l299.38" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l299.39"></a><span id="l299.39" class="difflineminus">-    do_check_eq(aData.index, 1);</span>
<a href="#l299.40"></a><span id="l299.40" class="difflineplus">+    Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.41"></a><span id="l299.41" class="difflineplus">+    Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l299.42"></a><span id="l299.42" class="difflineplus">+    Assert.equal(aData.index, 1);</span>
<a href="#l299.43"></a><span id="l299.43"> </span>
<a href="#l299.44"></a><span id="l299.44">     waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l299.45"></a><span id="l299.45">     {</span>
<a href="#l299.46"></a><span id="l299.46" class="difflineminus">-      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.47"></a><span id="l299.47" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l299.48"></a><span id="l299.48" class="difflineminus">-      do_check_eq(aData.index, 2);</span>
<a href="#l299.49"></a><span id="l299.49" class="difflineplus">+      Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.50"></a><span id="l299.50" class="difflineplus">+      Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l299.51"></a><span id="l299.51" class="difflineplus">+      Assert.equal(aData.index, 2);</span>
<a href="#l299.52"></a><span id="l299.52">       let id = aData.id;</span>
<a href="#l299.53"></a><span id="l299.53"> </span>
<a href="#l299.54"></a><span id="l299.54">       waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l299.55"></a><span id="l299.55">       {</span>
<a href="#l299.56"></a><span id="l299.56" class="difflineminus">-        do_check_eq(aData.id, id);</span>
<a href="#l299.57"></a><span id="l299.57" class="difflineminus">-        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l299.58"></a><span id="l299.58" class="difflineminus">-        do_check_eq(aData.index, 1);</span>
<a href="#l299.59"></a><span id="l299.59" class="difflineplus">+        Assert.equal(aData.id, id);</span>
<a href="#l299.60"></a><span id="l299.60" class="difflineplus">+        Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l299.61"></a><span id="l299.61" class="difflineplus">+        Assert.equal(aData.index, 1);</span>
<a href="#l299.62"></a><span id="l299.62"> </span>
<a href="#l299.63"></a><span id="l299.63">         run_next_test();</span>
<a href="#l299.64"></a><span id="l299.64">       });</span>
<a href="#l299.65"></a><span id="l299.65"> </span>
<a href="#l299.66"></a><span id="l299.66">       let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l299.67"></a><span id="l299.67">         wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l299.68"></a><span id="l299.68">         0, // Unused for real nodes.</span>
<a href="#l299.69"></a><span id="l299.69">         PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l299.70"></a><span id="l299.70" class="difflineat">@@ -172,30 +172,30 @@ add_test(function test_container()</span>
<a href="#l299.71"></a><span id="l299.71">                                             PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l299.72"></a><span id="l299.72"> });</span>
<a href="#l299.73"></a><span id="l299.73"> </span>
<a href="#l299.74"></a><span id="l299.74"> </span>
<a href="#l299.75"></a><span id="l299.75"> add_test(function test_separator()</span>
<a href="#l299.76"></a><span id="l299.76"> {</span>
<a href="#l299.77"></a><span id="l299.77">   waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l299.78"></a><span id="l299.78">   {</span>
<a href="#l299.79"></a><span id="l299.79" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l299.80"></a><span id="l299.80" class="difflineminus">-    do_check_eq(aData.index, 3);</span>
<a href="#l299.81"></a><span id="l299.81" class="difflineplus">+    Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l299.82"></a><span id="l299.82" class="difflineplus">+    Assert.equal(aData.index, 3);</span>
<a href="#l299.83"></a><span id="l299.83"> </span>
<a href="#l299.84"></a><span id="l299.84">     waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l299.85"></a><span id="l299.85">     {</span>
<a href="#l299.86"></a><span id="l299.86" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l299.87"></a><span id="l299.87" class="difflineminus">-      do_check_eq(aData.index, 4);</span>
<a href="#l299.88"></a><span id="l299.88" class="difflineplus">+      Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l299.89"></a><span id="l299.89" class="difflineplus">+      Assert.equal(aData.index, 4);</span>
<a href="#l299.90"></a><span id="l299.90">       let id = aData.id;</span>
<a href="#l299.91"></a><span id="l299.91"> </span>
<a href="#l299.92"></a><span id="l299.92">       waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l299.93"></a><span id="l299.93">       {</span>
<a href="#l299.94"></a><span id="l299.94" class="difflineminus">-        do_check_eq(aData.id, id);</span>
<a href="#l299.95"></a><span id="l299.95" class="difflineminus">-        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l299.96"></a><span id="l299.96" class="difflineminus">-        do_check_eq(aData.index, 1);</span>
<a href="#l299.97"></a><span id="l299.97" class="difflineplus">+        Assert.equal(aData.id, id);</span>
<a href="#l299.98"></a><span id="l299.98" class="difflineplus">+        Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l299.99"></a><span id="l299.99" class="difflineplus">+        Assert.equal(aData.index, 1);</span>
<a href="#l299.100"></a><span id="l299.100"> </span>
<a href="#l299.101"></a><span id="l299.101">         run_next_test();</span>
<a href="#l299.102"></a><span id="l299.102">       });</span>
<a href="#l299.103"></a><span id="l299.103"> </span>
<a href="#l299.104"></a><span id="l299.104">       let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l299.105"></a><span id="l299.105">         wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l299.106"></a><span id="l299.106">         0, // Unused for real nodes.</span>
<a href="#l299.107"></a><span id="l299.107">         PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l299.108"></a><span id="l299.108" class="difflineat">@@ -228,34 +228,34 @@ add_test(function test_separator()</span>
<a href="#l299.109"></a><span id="l299.109"> </span>
<a href="#l299.110"></a><span id="l299.110"> add_test(function test_bookmark()</span>
<a href="#l299.111"></a><span id="l299.111"> {</span>
<a href="#l299.112"></a><span id="l299.112">   const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l299.113"></a><span id="l299.113">   const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l299.114"></a><span id="l299.114"> </span>
<a href="#l299.115"></a><span id="l299.115">   waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l299.116"></a><span id="l299.116">   {</span>
<a href="#l299.117"></a><span id="l299.117" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.118"></a><span id="l299.118" class="difflineminus">-    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l299.119"></a><span id="l299.119" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.120"></a><span id="l299.120" class="difflineminus">-    do_check_eq(aData.index, 5);</span>
<a href="#l299.121"></a><span id="l299.121" class="difflineplus">+    Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.122"></a><span id="l299.122" class="difflineplus">+    Assert.equal(aData.url, TEST_URL);</span>
<a href="#l299.123"></a><span id="l299.123" class="difflineplus">+    Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.124"></a><span id="l299.124" class="difflineplus">+    Assert.equal(aData.index, 5);</span>
<a href="#l299.125"></a><span id="l299.125"> </span>
<a href="#l299.126"></a><span id="l299.126">     waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l299.127"></a><span id="l299.127">     {</span>
<a href="#l299.128"></a><span id="l299.128" class="difflineminus">-      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.129"></a><span id="l299.129" class="difflineminus">-      do_check_eq(aData.url, TEST_URL);</span>
<a href="#l299.130"></a><span id="l299.130" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.131"></a><span id="l299.131" class="difflineminus">-      do_check_eq(aData.index, 6);</span>
<a href="#l299.132"></a><span id="l299.132" class="difflineplus">+      Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.133"></a><span id="l299.133" class="difflineplus">+      Assert.equal(aData.url, TEST_URL);</span>
<a href="#l299.134"></a><span id="l299.134" class="difflineplus">+      Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.135"></a><span id="l299.135" class="difflineplus">+      Assert.equal(aData.index, 6);</span>
<a href="#l299.136"></a><span id="l299.136">       let id = aData.id;</span>
<a href="#l299.137"></a><span id="l299.137"> </span>
<a href="#l299.138"></a><span id="l299.138">       waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l299.139"></a><span id="l299.139">       {</span>
<a href="#l299.140"></a><span id="l299.140" class="difflineminus">-        do_check_eq(aData.id, id);</span>
<a href="#l299.141"></a><span id="l299.141" class="difflineminus">-        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.142"></a><span id="l299.142" class="difflineminus">-        do_check_eq(aData.index, 1);</span>
<a href="#l299.143"></a><span id="l299.143" class="difflineplus">+        Assert.equal(aData.id, id);</span>
<a href="#l299.144"></a><span id="l299.144" class="difflineplus">+        Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.145"></a><span id="l299.145" class="difflineplus">+        Assert.equal(aData.index, 1);</span>
<a href="#l299.146"></a><span id="l299.146"> </span>
<a href="#l299.147"></a><span id="l299.147">         run_next_test();</span>
<a href="#l299.148"></a><span id="l299.148">       });</span>
<a href="#l299.149"></a><span id="l299.149"> </span>
<a href="#l299.150"></a><span id="l299.150">       let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l299.151"></a><span id="l299.151">         wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l299.152"></a><span id="l299.152">         0, // Unused for real nodes.</span>
<a href="#l299.153"></a><span id="l299.153">         PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l299.154"></a><span id="l299.154" class="difflineat">@@ -293,27 +293,27 @@ add_test(function test_bookmark()</span>
<a href="#l299.155"></a><span id="l299.155"> </span>
<a href="#l299.156"></a><span id="l299.156"> add_test(function test_visit()</span>
<a href="#l299.157"></a><span id="l299.157"> {</span>
<a href="#l299.158"></a><span id="l299.158">   const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l299.159"></a><span id="l299.159">   const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l299.160"></a><span id="l299.160"> </span>
<a href="#l299.161"></a><span id="l299.161">   waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l299.162"></a><span id="l299.162">   {</span>
<a href="#l299.163"></a><span id="l299.163" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.164"></a><span id="l299.164" class="difflineminus">-    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l299.165"></a><span id="l299.165" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.166"></a><span id="l299.166" class="difflineminus">-    do_check_eq(aData.index, 7);</span>
<a href="#l299.167"></a><span id="l299.167" class="difflineplus">+    Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.168"></a><span id="l299.168" class="difflineplus">+    Assert.equal(aData.url, TEST_URL);</span>
<a href="#l299.169"></a><span id="l299.169" class="difflineplus">+    Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.170"></a><span id="l299.170" class="difflineplus">+    Assert.equal(aData.index, 7);</span>
<a href="#l299.171"></a><span id="l299.171"> </span>
<a href="#l299.172"></a><span id="l299.172">     waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l299.173"></a><span id="l299.173">     {</span>
<a href="#l299.174"></a><span id="l299.174" class="difflineminus">-      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l299.175"></a><span id="l299.175" class="difflineminus">-      do_check_eq(aData.url, TEST_URL);</span>
<a href="#l299.176"></a><span id="l299.176" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.177"></a><span id="l299.177" class="difflineminus">-      do_check_eq(aData.index, 8);</span>
<a href="#l299.178"></a><span id="l299.178" class="difflineplus">+      Assert.equal(aData.title, TEST_TITLE);</span>
<a href="#l299.179"></a><span id="l299.179" class="difflineplus">+      Assert.equal(aData.url, TEST_URL);</span>
<a href="#l299.180"></a><span id="l299.180" class="difflineplus">+      Assert.equal(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l299.181"></a><span id="l299.181" class="difflineplus">+      Assert.equal(aData.index, 8);</span>
<a href="#l299.182"></a><span id="l299.182">       run_next_test();</span>
<a href="#l299.183"></a><span id="l299.183">     });</span>
<a href="#l299.184"></a><span id="l299.184"> </span>
<a href="#l299.185"></a><span id="l299.185">     try {</span>
<a href="#l299.186"></a><span id="l299.186">     let node = wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId);</span>
<a href="#l299.187"></a><span id="l299.187">     // Simulate a not-bookmarked node, will copy it to a new bookmark.</span>
<a href="#l299.188"></a><span id="l299.188">     node.id = -1;</span>
<a href="#l299.189"></a><span id="l299.189">     let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l299.190"></a><span id="l299.190" class="difflineat">@@ -336,20 +336,20 @@ add_test(function test_visit()</span>
<a href="#l299.191"></a><span id="l299.191"> });</span>
<a href="#l299.192"></a><span id="l299.192"> </span>
<a href="#l299.193"></a><span id="l299.193"> add_test(function check_annotations() {</span>
<a href="#l299.194"></a><span id="l299.194">   // As last step check how many items for each annotation exist.</span>
<a href="#l299.195"></a><span id="l299.195"> </span>
<a href="#l299.196"></a><span id="l299.196">   // Copies should retain the description annotation.</span>
<a href="#l299.197"></a><span id="l299.197">   let descriptions =</span>
<a href="#l299.198"></a><span id="l299.198">     PlacesUtils.annotations.getItemsWithAnnotation(PlacesUIUtils.DESCRIPTION_ANNO, {});</span>
<a href="#l299.199"></a><span id="l299.199" class="difflineminus">-  do_check_eq(descriptions.length, 4);</span>
<a href="#l299.200"></a><span id="l299.200" class="difflineplus">+  Assert.equal(descriptions.length, 4);</span>
<a href="#l299.201"></a><span id="l299.201"> </span>
<a href="#l299.202"></a><span id="l299.202">   // Only the original bookmarks should have this annotation.</span>
<a href="#l299.203"></a><span id="l299.203">   let others = PlacesUtils.annotations.getItemsWithAnnotation(&quot;random-anno&quot;, {});</span>
<a href="#l299.204"></a><span id="l299.204" class="difflineminus">-  do_check_eq(others.length, 3);</span>
<a href="#l299.205"></a><span id="l299.205" class="difflineplus">+  Assert.equal(others.length, 3);</span>
<a href="#l299.206"></a><span id="l299.206">   run_next_test();</span>
<a href="#l299.207"></a><span id="l299.207"> });</span>
<a href="#l299.208"></a><span id="l299.208"> </span>
<a href="#l299.209"></a><span id="l299.209"> function run_test()</span>
<a href="#l299.210"></a><span id="l299.210"> {</span>
<a href="#l299.211"></a><span id="l299.211">   run_next_test();</span>
<a href="#l299.212"></a><span id="l299.212"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l300.1"></a><span id="l300.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_corrupt.js</span>
<a href="#l300.2"></a><span id="l300.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_corrupt.js</span>
<a href="#l300.3"></a><span id="l300.3" class="difflineat">@@ -17,17 +17,17 @@ XPCOMUtils.defineLazyServiceGetter(this,</span>
<a href="#l300.4"></a><span id="l300.4"> XPCOMUtils.defineLazyServiceGetter(this, &quot;anno&quot;,</span>
<a href="#l300.5"></a><span id="l300.5">                                    &quot;@mozilla.org/browser/annotation-service;1&quot;,</span>
<a href="#l300.6"></a><span id="l300.6">                                    &quot;nsIAnnotationService&quot;);</span>
<a href="#l300.7"></a><span id="l300.7"> </span>
<a href="#l300.8"></a><span id="l300.8"> var bookmarksObserver = {</span>
<a href="#l300.9"></a><span id="l300.9">   onBeginUpdateBatch: function() {},</span>
<a href="#l300.10"></a><span id="l300.10">   onEndUpdateBatch: function() {</span>
<a href="#l300.11"></a><span id="l300.11">     let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l300.12"></a><span id="l300.12" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l300.13"></a><span id="l300.13" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l300.14"></a><span id="l300.14">     if (anno.itemHasAnnotation(itemId, &quot;Places/SmartBookmark&quot;))</span>
<a href="#l300.15"></a><span id="l300.15">       continue_test();</span>
<a href="#l300.16"></a><span id="l300.16">   },</span>
<a href="#l300.17"></a><span id="l300.17">   onItemAdded: function() {},</span>
<a href="#l300.18"></a><span id="l300.18">   onItemRemoved: function(id, folder, index, itemType) {},</span>
<a href="#l300.19"></a><span id="l300.19">   onItemChanged: function() {},</span>
<a href="#l300.20"></a><span id="l300.20">   onItemVisited: function(id, visitID, time) {},</span>
<a href="#l300.21"></a><span id="l300.21">   onItemMoved: function() {},</span>
<a href="#l300.22"></a><span id="l300.22" class="difflineat">@@ -44,42 +44,42 @@ function run_test() {</span>
<a href="#l300.23"></a><span id="l300.23">   // Create our JSON backup copying bookmarks.glue.json to the profile folder.</span>
<a href="#l300.24"></a><span id="l300.24">   create_JSON_backup(&quot;bookmarks.glue.json&quot;);</span>
<a href="#l300.25"></a><span id="l300.25"> </span>
<a href="#l300.26"></a><span id="l300.26">   // Remove current database file.</span>
<a href="#l300.27"></a><span id="l300.27">   let db = gProfD.clone();</span>
<a href="#l300.28"></a><span id="l300.28">   db.append(&quot;places.sqlite&quot;);</span>
<a href="#l300.29"></a><span id="l300.29">   if (db.exists()) {</span>
<a href="#l300.30"></a><span id="l300.30">     db.remove(false);</span>
<a href="#l300.31"></a><span id="l300.31" class="difflineminus">-    do_check_false(db.exists());</span>
<a href="#l300.32"></a><span id="l300.32" class="difflineplus">+    Assert.ok(!db.exists());</span>
<a href="#l300.33"></a><span id="l300.33">   }</span>
<a href="#l300.34"></a><span id="l300.34">   // Create a corrupt database.</span>
<a href="#l300.35"></a><span id="l300.35">   let corruptDB = gTestDir.clone();</span>
<a href="#l300.36"></a><span id="l300.36">   corruptDB.append(&quot;corruptDB.sqlite&quot;);</span>
<a href="#l300.37"></a><span id="l300.37">   corruptDB.copyTo(gProfD, &quot;places.sqlite&quot;);</span>
<a href="#l300.38"></a><span id="l300.38" class="difflineminus">-  do_check_true(db.exists());</span>
<a href="#l300.39"></a><span id="l300.39" class="difflineplus">+  Assert.ok(db.exists());</span>
<a href="#l300.40"></a><span id="l300.40"> </span>
<a href="#l300.41"></a><span id="l300.41">   // Initialize nsSuiteGlue before Places.</span>
<a href="#l300.42"></a><span id="l300.42">   Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].getService(Ci.nsISuiteGlue);</span>
<a href="#l300.43"></a><span id="l300.43"> </span>
<a href="#l300.44"></a><span id="l300.44">   // Initialize Places through the History Service.</span>
<a href="#l300.45"></a><span id="l300.45">   let hs = Cc[&quot;@mozilla.org/browser/nav-history-service;1&quot;].</span>
<a href="#l300.46"></a><span id="l300.46">            getService(Ci.nsINavHistoryService);</span>
<a href="#l300.47"></a><span id="l300.47">   // Check the database was corrupt.</span>
<a href="#l300.48"></a><span id="l300.48">   // nsSuiteGlue uses databaseStatus to manage initialization.</span>
<a href="#l300.49"></a><span id="l300.49" class="difflineminus">-  do_check_eq(hs.databaseStatus, hs.DATABASE_STATUS_CORRUPT);</span>
<a href="#l300.50"></a><span id="l300.50" class="difflineplus">+  Assert.equal(hs.databaseStatus, hs.DATABASE_STATUS_CORRUPT);</span>
<a href="#l300.51"></a><span id="l300.51"> </span>
<a href="#l300.52"></a><span id="l300.52">   // The test will continue once restore has finished and smart bookmarks</span>
<a href="#l300.53"></a><span id="l300.53">   // have been created.</span>
<a href="#l300.54"></a><span id="l300.54">   bs.addObserver(bookmarksObserver);</span>
<a href="#l300.55"></a><span id="l300.55"> }</span>
<a href="#l300.56"></a><span id="l300.56"> </span>
<a href="#l300.57"></a><span id="l300.57"> function continue_test() {</span>
<a href="#l300.58"></a><span id="l300.58">   // Check that JSON backup has been restored.</span>
<a href="#l300.59"></a><span id="l300.59">   // Notice restore from JSON notification is fired before smart bookmarks creation.</span>
<a href="#l300.60"></a><span id="l300.60">   let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l300.61"></a><span id="l300.61" class="difflineminus">-  do_check_eq(bs.getItemTitle(itemId), &quot;examplejson&quot;);</span>
<a href="#l300.62"></a><span id="l300.62" class="difflineplus">+  Assert.equal(bs.getItemTitle(itemId), &quot;examplejson&quot;);</span>
<a href="#l300.63"></a><span id="l300.63"> </span>
<a href="#l300.64"></a><span id="l300.64">   remove_bookmarks_html();</span>
<a href="#l300.65"></a><span id="l300.65">   remove_all_JSON_backups();</span>
<a href="#l300.66"></a><span id="l300.66"> </span>
<a href="#l300.67"></a><span id="l300.67">   do_test_finished();</span>
<a href="#l300.68"></a><span id="l300.68"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l301.1"></a><span id="l301.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js</span>
<a href="#l301.2"></a><span id="l301.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup.js</span>
<a href="#l301.3"></a><span id="l301.3" class="difflineat">@@ -17,17 +17,17 @@ XPCOMUtils.defineLazyServiceGetter(this,</span>
<a href="#l301.4"></a><span id="l301.4"> XPCOMUtils.defineLazyServiceGetter(this, &quot;anno&quot;,</span>
<a href="#l301.5"></a><span id="l301.5">                                    &quot;@mozilla.org/browser/annotation-service;1&quot;,</span>
<a href="#l301.6"></a><span id="l301.6">                                    &quot;nsIAnnotationService&quot;);</span>
<a href="#l301.7"></a><span id="l301.7"> </span>
<a href="#l301.8"></a><span id="l301.8"> var bookmarksObserver = {</span>
<a href="#l301.9"></a><span id="l301.9">   onBeginUpdateBatch: function() {},</span>
<a href="#l301.10"></a><span id="l301.10">   onEndUpdateBatch: function() {</span>
<a href="#l301.11"></a><span id="l301.11">     let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l301.12"></a><span id="l301.12" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l301.13"></a><span id="l301.13" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l301.14"></a><span id="l301.14">     if (anno.itemHasAnnotation(itemId, &quot;Places/SmartBookmark&quot;))</span>
<a href="#l301.15"></a><span id="l301.15">       continue_test();</span>
<a href="#l301.16"></a><span id="l301.16">   },</span>
<a href="#l301.17"></a><span id="l301.17">   onItemAdded: function() {},</span>
<a href="#l301.18"></a><span id="l301.18">   onItemRemoved: function(id, folder, index, itemType) {},</span>
<a href="#l301.19"></a><span id="l301.19">   onItemChanged: function() {},</span>
<a href="#l301.20"></a><span id="l301.20">   onItemVisited: function(id, visitID, time) {},</span>
<a href="#l301.21"></a><span id="l301.21">   onItemMoved: function() {},</span>
<a href="#l301.22"></a><span id="l301.22" class="difflineat">@@ -42,40 +42,40 @@ function run_test() {</span>
<a href="#l301.23"></a><span id="l301.23">   // Remove JSON backup from profile.</span>
<a href="#l301.24"></a><span id="l301.24">   remove_all_JSON_backups();</span>
<a href="#l301.25"></a><span id="l301.25"> </span>
<a href="#l301.26"></a><span id="l301.26">   // Remove current database file.</span>
<a href="#l301.27"></a><span id="l301.27">   let db = gProfD.clone();</span>
<a href="#l301.28"></a><span id="l301.28">   db.append(&quot;places.sqlite&quot;);</span>
<a href="#l301.29"></a><span id="l301.29">   if (db.exists()) {</span>
<a href="#l301.30"></a><span id="l301.30">     db.remove(false);</span>
<a href="#l301.31"></a><span id="l301.31" class="difflineminus">-    do_check_false(db.exists());</span>
<a href="#l301.32"></a><span id="l301.32" class="difflineplus">+    Assert.ok(!db.exists());</span>
<a href="#l301.33"></a><span id="l301.33">   }</span>
<a href="#l301.34"></a><span id="l301.34">   // Create a corrupt database.</span>
<a href="#l301.35"></a><span id="l301.35">   let corruptDB = gTestDir.clone();</span>
<a href="#l301.36"></a><span id="l301.36">   corruptDB.append(&quot;corruptDB.sqlite&quot;);</span>
<a href="#l301.37"></a><span id="l301.37">   corruptDB.copyTo(gProfD, &quot;places.sqlite&quot;);</span>
<a href="#l301.38"></a><span id="l301.38" class="difflineminus">-  do_check_true(db.exists());</span>
<a href="#l301.39"></a><span id="l301.39" class="difflineplus">+  Assert.ok(db.exists());</span>
<a href="#l301.40"></a><span id="l301.40"> </span>
<a href="#l301.41"></a><span id="l301.41">   // Initialize nsSuiteGlue before Places.</span>
<a href="#l301.42"></a><span id="l301.42">   Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].getService(Ci.nsISuiteGlue);</span>
<a href="#l301.43"></a><span id="l301.43"> </span>
<a href="#l301.44"></a><span id="l301.44">   // Initialize Places through the History Service.</span>
<a href="#l301.45"></a><span id="l301.45">   let hs = Cc[&quot;@mozilla.org/browser/nav-history-service;1&quot;].</span>
<a href="#l301.46"></a><span id="l301.46">            getService(Ci.nsINavHistoryService);</span>
<a href="#l301.47"></a><span id="l301.47">   // Check the database was corrupt.</span>
<a href="#l301.48"></a><span id="l301.48">   // nsSuiteGlue uses databaseStatus to manage initialization.</span>
<a href="#l301.49"></a><span id="l301.49" class="difflineminus">-  do_check_eq(hs.databaseStatus, hs.DATABASE_STATUS_CORRUPT);</span>
<a href="#l301.50"></a><span id="l301.50" class="difflineplus">+  Assert.equal(hs.databaseStatus, hs.DATABASE_STATUS_CORRUPT);</span>
<a href="#l301.51"></a><span id="l301.51"> </span>
<a href="#l301.52"></a><span id="l301.52">   // The test will continue once import has finished and smart bookmarks</span>
<a href="#l301.53"></a><span id="l301.53">   // have been created.</span>
<a href="#l301.54"></a><span id="l301.54">   bs.addObserver(bookmarksObserver);</span>
<a href="#l301.55"></a><span id="l301.55"> }</span>
<a href="#l301.56"></a><span id="l301.56"> </span>
<a href="#l301.57"></a><span id="l301.57"> function continue_test() {</span>
<a href="#l301.58"></a><span id="l301.58">   // Check that bookmarks html has been restored.</span>
<a href="#l301.59"></a><span id="l301.59">   let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l301.60"></a><span id="l301.60" class="difflineminus">-  do_check_eq(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l301.61"></a><span id="l301.61" class="difflineplus">+  Assert.equal(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l301.62"></a><span id="l301.62"> </span>
<a href="#l301.63"></a><span id="l301.63">   remove_bookmarks_html();</span>
<a href="#l301.64"></a><span id="l301.64"> </span>
<a href="#l301.65"></a><span id="l301.65">   do_test_finished();</span>
<a href="#l301.66"></a><span id="l301.66"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l302.1"></a><span id="l302.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js</span>
<a href="#l302.2"></a><span id="l302.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_corrupt_nobackup_default.js</span>
<a href="#l302.3"></a><span id="l302.3" class="difflineat">@@ -17,17 +17,17 @@ XPCOMUtils.defineLazyServiceGetter(this,</span>
<a href="#l302.4"></a><span id="l302.4"> XPCOMUtils.defineLazyServiceGetter(this, &quot;anno&quot;,</span>
<a href="#l302.5"></a><span id="l302.5">                                    &quot;@mozilla.org/browser/annotation-service;1&quot;,</span>
<a href="#l302.6"></a><span id="l302.6">                                    &quot;nsIAnnotationService&quot;);</span>
<a href="#l302.7"></a><span id="l302.7"> </span>
<a href="#l302.8"></a><span id="l302.8"> var bookmarksObserver = {</span>
<a href="#l302.9"></a><span id="l302.9">   onBeginUpdateBatch: function() {},</span>
<a href="#l302.10"></a><span id="l302.10">   onEndUpdateBatch: function() {</span>
<a href="#l302.11"></a><span id="l302.11">     let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l302.12"></a><span id="l302.12" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l302.13"></a><span id="l302.13" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l302.14"></a><span id="l302.14">     if (anno.itemHasAnnotation(itemId, &quot;Places/SmartBookmark&quot;))</span>
<a href="#l302.15"></a><span id="l302.15">       continue_test();</span>
<a href="#l302.16"></a><span id="l302.16">   },</span>
<a href="#l302.17"></a><span id="l302.17">   onItemAdded: function() {},</span>
<a href="#l302.18"></a><span id="l302.18">   onItemRemoved: function(id, folder, index, itemType) {},</span>
<a href="#l302.19"></a><span id="l302.19">   onItemChanged: function() {},</span>
<a href="#l302.20"></a><span id="l302.20">   onItemVisited: function(id, visitID, time) {},</span>
<a href="#l302.21"></a><span id="l302.21">   onItemMoved: function() {},</span>
<a href="#l302.22"></a><span id="l302.22" class="difflineat">@@ -42,39 +42,39 @@ function run_test() {</span>
<a href="#l302.23"></a><span id="l302.23">   // Remove JSON backup from profile.</span>
<a href="#l302.24"></a><span id="l302.24">   remove_all_JSON_backups();</span>
<a href="#l302.25"></a><span id="l302.25"> </span>
<a href="#l302.26"></a><span id="l302.26">   // Remove current database file.</span>
<a href="#l302.27"></a><span id="l302.27">   let db = gProfD.clone();</span>
<a href="#l302.28"></a><span id="l302.28">   db.append(&quot;places.sqlite&quot;);</span>
<a href="#l302.29"></a><span id="l302.29">   if (db.exists()) {</span>
<a href="#l302.30"></a><span id="l302.30">     db.remove(false);</span>
<a href="#l302.31"></a><span id="l302.31" class="difflineminus">-    do_check_false(db.exists());</span>
<a href="#l302.32"></a><span id="l302.32" class="difflineplus">+    Assert.ok(!db.exists());</span>
<a href="#l302.33"></a><span id="l302.33">   }</span>
<a href="#l302.34"></a><span id="l302.34">   // Create a corrupt database.</span>
<a href="#l302.35"></a><span id="l302.35">   let corruptDB = gTestDir.clone();</span>
<a href="#l302.36"></a><span id="l302.36">   corruptDB.append(&quot;corruptDB.sqlite&quot;);</span>
<a href="#l302.37"></a><span id="l302.37">   corruptDB.copyTo(gProfD, &quot;places.sqlite&quot;);</span>
<a href="#l302.38"></a><span id="l302.38" class="difflineminus">-  do_check_true(db.exists());</span>
<a href="#l302.39"></a><span id="l302.39" class="difflineplus">+  Assert.ok(db.exists());</span>
<a href="#l302.40"></a><span id="l302.40"> </span>
<a href="#l302.41"></a><span id="l302.41">   // Initialize nsSuiteGlue before Places.</span>
<a href="#l302.42"></a><span id="l302.42">   Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].getService(Ci.nsISuiteGlue);</span>
<a href="#l302.43"></a><span id="l302.43"> </span>
<a href="#l302.44"></a><span id="l302.44">   // Initialize Places through the History Service.</span>
<a href="#l302.45"></a><span id="l302.45">   let hs = Cc[&quot;@mozilla.org/browser/nav-history-service;1&quot;].</span>
<a href="#l302.46"></a><span id="l302.46">            getService(Ci.nsINavHistoryService);</span>
<a href="#l302.47"></a><span id="l302.47">   // Check the database was corrupt.</span>
<a href="#l302.48"></a><span id="l302.48">   // nsSuiteGlue uses databaseStatus to manage initialization.</span>
<a href="#l302.49"></a><span id="l302.49" class="difflineminus">-  do_check_eq(hs.databaseStatus, hs.DATABASE_STATUS_CORRUPT);</span>
<a href="#l302.50"></a><span id="l302.50" class="difflineplus">+  Assert.equal(hs.databaseStatus, hs.DATABASE_STATUS_CORRUPT);</span>
<a href="#l302.51"></a><span id="l302.51"> </span>
<a href="#l302.52"></a><span id="l302.52">   // The test will continue once import has finished and smart bookmarks</span>
<a href="#l302.53"></a><span id="l302.53">   // have been created.</span>
<a href="#l302.54"></a><span id="l302.54">   bs.addObserver(bookmarksObserver);</span>
<a href="#l302.55"></a><span id="l302.55"> }</span>
<a href="#l302.56"></a><span id="l302.56"> </span>
<a href="#l302.57"></a><span id="l302.57"> function continue_test() {</span>
<a href="#l302.58"></a><span id="l302.58">   // Check that default bookmarks have been restored.</span>
<a href="#l302.59"></a><span id="l302.59">   let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l302.60"></a><span id="l302.60" class="difflineminus">-  do_check_true(itemId &gt; 0);</span>
<a href="#l302.61"></a><span id="l302.61" class="difflineminus">-  do_check_eq(bs.getItemTitle(itemId), &quot;SeaMonkey&quot;);</span>
<a href="#l302.62"></a><span id="l302.62" class="difflineplus">+  Assert.ok(itemId &gt; 0);</span>
<a href="#l302.63"></a><span id="l302.63" class="difflineplus">+  Assert.equal(bs.getItemTitle(itemId), &quot;SeaMonkey&quot;);</span>
<a href="#l302.64"></a><span id="l302.64"> </span>
<a href="#l302.65"></a><span id="l302.65">   do_test_finished();</span>
<a href="#l302.66"></a><span id="l302.66"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l303.1"></a><span id="l303.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_migrate.js</span>
<a href="#l303.2"></a><span id="l303.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_migrate.js</span>
<a href="#l303.3"></a><span id="l303.3" class="difflineat">@@ -18,17 +18,17 @@ XPCOMUtils.defineLazyServiceGetter(this,</span>
<a href="#l303.4"></a><span id="l303.4"> XPCOMUtils.defineLazyServiceGetter(this, &quot;anno&quot;,</span>
<a href="#l303.5"></a><span id="l303.5">                                    &quot;@mozilla.org/browser/annotation-service;1&quot;,</span>
<a href="#l303.6"></a><span id="l303.6">                                    &quot;nsIAnnotationService&quot;);</span>
<a href="#l303.7"></a><span id="l303.7"> </span>
<a href="#l303.8"></a><span id="l303.8"> var bookmarksObserver = {</span>
<a href="#l303.9"></a><span id="l303.9">   onBeginUpdateBatch: function() {},</span>
<a href="#l303.10"></a><span id="l303.10">   onEndUpdateBatch: function() {</span>
<a href="#l303.11"></a><span id="l303.11">     let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l303.12"></a><span id="l303.12" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l303.13"></a><span id="l303.13" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l303.14"></a><span id="l303.14">     if (anno.itemHasAnnotation(itemId, &quot;Places/SmartBookmark&quot;))</span>
<a href="#l303.15"></a><span id="l303.15">       continue_test();</span>
<a href="#l303.16"></a><span id="l303.16">   },</span>
<a href="#l303.17"></a><span id="l303.17">   onItemAdded: function() {},</span>
<a href="#l303.18"></a><span id="l303.18">   onItemRemoved: function(id, folder, index, itemType) {},</span>
<a href="#l303.19"></a><span id="l303.19">   onItemChanged: function() {},</span>
<a href="#l303.20"></a><span id="l303.20">   onItemVisited: function(id, visitID, time) {},</span>
<a href="#l303.21"></a><span id="l303.21">   onItemMoved: function() {},</span>
<a href="#l303.22"></a><span id="l303.22" class="difflineat">@@ -44,25 +44,25 @@ function run_test() {</span>
<a href="#l303.23"></a><span id="l303.23">   // folder.  It will be ignored.</span>
<a href="#l303.24"></a><span id="l303.24">   create_bookmarks_html(&quot;bookmarks.glue.html&quot;);</span>
<a href="#l303.25"></a><span id="l303.25"> </span>
<a href="#l303.26"></a><span id="l303.26">   // Remove current database file.</span>
<a href="#l303.27"></a><span id="l303.27">   let db = gProfD.clone();</span>
<a href="#l303.28"></a><span id="l303.28">   db.append(&quot;places.sqlite&quot;);</span>
<a href="#l303.29"></a><span id="l303.29">   if (db.exists()) {</span>
<a href="#l303.30"></a><span id="l303.30">     db.remove(false);</span>
<a href="#l303.31"></a><span id="l303.31" class="difflineminus">-    do_check_false(db.exists());</span>
<a href="#l303.32"></a><span id="l303.32" class="difflineplus">+    Assert.ok(!db.exists());</span>
<a href="#l303.33"></a><span id="l303.33">   }</span>
<a href="#l303.34"></a><span id="l303.34"> </span>
<a href="#l303.35"></a><span id="l303.35">   // Initialize Places through the History Service.</span>
<a href="#l303.36"></a><span id="l303.36">   let hs = Cc[&quot;@mozilla.org/browser/nav-history-service;1&quot;].</span>
<a href="#l303.37"></a><span id="l303.37">            getService(Ci.nsINavHistoryService);</span>
<a href="#l303.38"></a><span id="l303.38">   // Check a new database has been created.</span>
<a href="#l303.39"></a><span id="l303.39">   // nsSuiteGlue uses databaseStatus to manage initialization.</span>
<a href="#l303.40"></a><span id="l303.40" class="difflineminus">-  do_check_eq(hs.databaseStatus, hs.DATABASE_STATUS_CREATE);</span>
<a href="#l303.41"></a><span id="l303.41" class="difflineplus">+  Assert.equal(hs.databaseStatus, hs.DATABASE_STATUS_CREATE);</span>
<a href="#l303.42"></a><span id="l303.42"> </span>
<a href="#l303.43"></a><span id="l303.43">   // A migrator would run before nsSuiteGlue Places initialization, so mimic</span>
<a href="#l303.44"></a><span id="l303.44">   // that behavior adding a bookmark and notifying the migration.</span>
<a href="#l303.45"></a><span id="l303.45">   bs.insertBookmark(bs.bookmarksMenuFolder, uri(&quot;http://mozilla.org/&quot;),</span>
<a href="#l303.46"></a><span id="l303.46">                     bs.DEFAULT_INDEX, &quot;migrated&quot;);</span>
<a href="#l303.47"></a><span id="l303.47"> </span>
<a href="#l303.48"></a><span id="l303.48">   // Initialize nsSuiteGlue.</span>
<a href="#l303.49"></a><span id="l303.49">   let bg = Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].</span>
<a href="#l303.50"></a><span id="l303.50" class="difflineat">@@ -72,18 +72,18 @@ function run_test() {</span>
<a href="#l303.51"></a><span id="l303.51">   // The test will continue once import has finished and smart bookmarks</span>
<a href="#l303.52"></a><span id="l303.52">   // have been created.</span>
<a href="#l303.53"></a><span id="l303.53">   bs.addObserver(bookmarksObserver);</span>
<a href="#l303.54"></a><span id="l303.54"> }</span>
<a href="#l303.55"></a><span id="l303.55"> </span>
<a href="#l303.56"></a><span id="l303.56"> function continue_test() {</span>
<a href="#l303.57"></a><span id="l303.57">   // Check the created bookmarks still exist.</span>
<a href="#l303.58"></a><span id="l303.58">   let itemId = bs.getIdForItemAt(bs.bookmarksMenuFolder, SMART_BOOKMARKS_ON_MENU);</span>
<a href="#l303.59"></a><span id="l303.59" class="difflineminus">-  do_check_eq(bs.getItemTitle(itemId), &quot;migrated&quot;);</span>
<a href="#l303.60"></a><span id="l303.60" class="difflineplus">+  Assert.equal(bs.getItemTitle(itemId), &quot;migrated&quot;);</span>
<a href="#l303.61"></a><span id="l303.61"> </span>
<a href="#l303.62"></a><span id="l303.62">   // Check that we have not imported any new bookmark.</span>
<a href="#l303.63"></a><span id="l303.63" class="difflineminus">-  do_check_eq(bs.getIdForItemAt(bs.bookmarksMenuFolder, SMART_BOOKMARKS_ON_MENU + 1), -1);</span>
<a href="#l303.64"></a><span id="l303.64" class="difflineminus">-  do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_MENU), -1);</span>
<a href="#l303.65"></a><span id="l303.65" class="difflineplus">+  Assert.equal(bs.getIdForItemAt(bs.bookmarksMenuFolder, SMART_BOOKMARKS_ON_MENU + 1), -1);</span>
<a href="#l303.66"></a><span id="l303.66" class="difflineplus">+  Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_MENU), -1);</span>
<a href="#l303.67"></a><span id="l303.67"> </span>
<a href="#l303.68"></a><span id="l303.68">   remove_bookmarks_html();</span>
<a href="#l303.69"></a><span id="l303.69"> </span>
<a href="#l303.70"></a><span id="l303.70">   do_test_finished();</span>
<a href="#l303.71"></a><span id="l303.71"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l304.1"></a><span id="l304.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_prefs.js</span>
<a href="#l304.2"></a><span id="l304.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_prefs.js</span>
<a href="#l304.3"></a><span id="l304.3" class="difflineat">@@ -42,29 +42,29 @@ function waitForImportAndSmartBookmarks(</span>
<a href="#l304.4"></a><span id="l304.4"> </span>
<a href="#l304.5"></a><span id="l304.5"> var tests = [];</span>
<a href="#l304.6"></a><span id="l304.6"> //------------------------------------------------------------------------------</span>
<a href="#l304.7"></a><span id="l304.7"> </span>
<a href="#l304.8"></a><span id="l304.8"> tests.push({</span>
<a href="#l304.9"></a><span id="l304.9">   description: &quot;Import from bookmarks.html if importBookmarksHTML is true.&quot;,</span>
<a href="#l304.10"></a><span id="l304.10">   exec: function() {</span>
<a href="#l304.11"></a><span id="l304.11">     // Sanity check: we should not have any bookmark on the toolbar.</span>
<a href="#l304.12"></a><span id="l304.12" class="difflineminus">-    do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.13"></a><span id="l304.13" class="difflineplus">+    Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.14"></a><span id="l304.14"> </span>
<a href="#l304.15"></a><span id="l304.15">     // Set preferences.</span>
<a href="#l304.16"></a><span id="l304.16">     Services.prefs.setBoolPref(PREF_IMPORT_BOOKMARKS_HTML, true);</span>
<a href="#l304.17"></a><span id="l304.17"> </span>
<a href="#l304.18"></a><span id="l304.18">     waitForImportAndSmartBookmarks(function () {</span>
<a href="#l304.19"></a><span id="l304.19">       // Check bookmarks.html has been imported, and a smart bookmark has been</span>
<a href="#l304.20"></a><span id="l304.20">       // created.</span>
<a href="#l304.21"></a><span id="l304.21">       let itemId = bs.getIdForItemAt(bs.toolbarFolder,</span>
<a href="#l304.22"></a><span id="l304.22">                                      SMART_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l304.23"></a><span id="l304.23" class="difflineminus">-      do_check_eq(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.24"></a><span id="l304.24" class="difflineplus">+      Assert.equal(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.25"></a><span id="l304.25">       // Check preferences have been reverted.</span>
<a href="#l304.26"></a><span id="l304.26" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.27"></a><span id="l304.27" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.28"></a><span id="l304.28"> </span>
<a href="#l304.29"></a><span id="l304.29">       next_test();</span>
<a href="#l304.30"></a><span id="l304.30">     });</span>
<a href="#l304.31"></a><span id="l304.31">     // Force nsSuiteGlue::_initPlaces().</span>
<a href="#l304.32"></a><span id="l304.32">     do_log_info(&quot;Simulate Places init&quot;);</span>
<a href="#l304.33"></a><span id="l304.33">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l304.34"></a><span id="l304.34">                                               PlacesUtils.TOPIC_INIT_COMPLETE,</span>
<a href="#l304.35"></a><span id="l304.35">                                               null);</span>
<a href="#l304.36"></a><span id="l304.36" class="difflineat">@@ -72,29 +72,29 @@ tests.push({</span>
<a href="#l304.37"></a><span id="l304.37"> });</span>
<a href="#l304.38"></a><span id="l304.38"> </span>
<a href="#l304.39"></a><span id="l304.39"> //------------------------------------------------------------------------------</span>
<a href="#l304.40"></a><span id="l304.40"> </span>
<a href="#l304.41"></a><span id="l304.41"> tests.push({</span>
<a href="#l304.42"></a><span id="l304.42">   description: &quot;import from bookmarks.html, but don't create smart bookmarks if they are disabled&quot;,</span>
<a href="#l304.43"></a><span id="l304.43">   exec: function() {</span>
<a href="#l304.44"></a><span id="l304.44">     // Sanity check: we should not have any bookmark on the toolbar.</span>
<a href="#l304.45"></a><span id="l304.45" class="difflineminus">-    do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.46"></a><span id="l304.46" class="difflineplus">+    Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.47"></a><span id="l304.47"> </span>
<a href="#l304.48"></a><span id="l304.48">     // Set preferences.</span>
<a href="#l304.49"></a><span id="l304.49">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, -1);</span>
<a href="#l304.50"></a><span id="l304.50">     Services.prefs.setBoolPref(PREF_IMPORT_BOOKMARKS_HTML, true);</span>
<a href="#l304.51"></a><span id="l304.51"> </span>
<a href="#l304.52"></a><span id="l304.52">     waitForImportAndSmartBookmarks(function () {</span>
<a href="#l304.53"></a><span id="l304.53">       // Check bookmarks.html has been imported, but smart bookmarks have not</span>
<a href="#l304.54"></a><span id="l304.54">       // been created.</span>
<a href="#l304.55"></a><span id="l304.55">       let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l304.56"></a><span id="l304.56" class="difflineminus">-      do_check_eq(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.57"></a><span id="l304.57" class="difflineplus">+      Assert.equal(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.58"></a><span id="l304.58">       // Check preferences have been reverted.</span>
<a href="#l304.59"></a><span id="l304.59" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.60"></a><span id="l304.60" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.61"></a><span id="l304.61"> </span>
<a href="#l304.62"></a><span id="l304.62">       next_test();</span>
<a href="#l304.63"></a><span id="l304.63">     });</span>
<a href="#l304.64"></a><span id="l304.64">     // Force nsSuiteGlue::_initPlaces().</span>
<a href="#l304.65"></a><span id="l304.65">     do_log_info(&quot;Simulate Places init&quot;);</span>
<a href="#l304.66"></a><span id="l304.66">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l304.67"></a><span id="l304.67">                                               PlacesUtils.TOPIC_INIT_COMPLETE,</span>
<a href="#l304.68"></a><span id="l304.68">                                               null);</span>
<a href="#l304.69"></a><span id="l304.69" class="difflineat">@@ -102,28 +102,28 @@ tests.push({</span>
<a href="#l304.70"></a><span id="l304.70"> });</span>
<a href="#l304.71"></a><span id="l304.71"> </span>
<a href="#l304.72"></a><span id="l304.72"> //------------------------------------------------------------------------------</span>
<a href="#l304.73"></a><span id="l304.73"> </span>
<a href="#l304.74"></a><span id="l304.74"> tests.push({</span>
<a href="#l304.75"></a><span id="l304.75">   description: &quot;Import from bookmarks.html, but don't create smart bookmarks if autoExportHTML is true and they are at latest version&quot;,</span>
<a href="#l304.76"></a><span id="l304.76">   exec: function() {</span>
<a href="#l304.77"></a><span id="l304.77">     // Sanity check: we should not have any bookmark on the toolbar.</span>
<a href="#l304.78"></a><span id="l304.78" class="difflineminus">-    do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.79"></a><span id="l304.79" class="difflineplus">+    Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.80"></a><span id="l304.80">     // Set preferences.</span>
<a href="#l304.81"></a><span id="l304.81">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 999);</span>
<a href="#l304.82"></a><span id="l304.82">     Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, true);</span>
<a href="#l304.83"></a><span id="l304.83">     Services.prefs.setBoolPref(PREF_IMPORT_BOOKMARKS_HTML, true);</span>
<a href="#l304.84"></a><span id="l304.84"> </span>
<a href="#l304.85"></a><span id="l304.85">     waitForImportAndSmartBookmarks(function () {</span>
<a href="#l304.86"></a><span id="l304.86">       // Check bookmarks.html has been imported, but smart bookmarks have not</span>
<a href="#l304.87"></a><span id="l304.87">       // been created.</span>
<a href="#l304.88"></a><span id="l304.88">       let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l304.89"></a><span id="l304.89" class="difflineminus">-      do_check_eq(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.90"></a><span id="l304.90" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.91"></a><span id="l304.91" class="difflineplus">+      Assert.equal(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.92"></a><span id="l304.92" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.93"></a><span id="l304.93">       // Check preferences have been reverted.</span>
<a href="#l304.94"></a><span id="l304.94">       Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, false);</span>
<a href="#l304.95"></a><span id="l304.95"> </span>
<a href="#l304.96"></a><span id="l304.96">       next_test();</span>
<a href="#l304.97"></a><span id="l304.97">     });</span>
<a href="#l304.98"></a><span id="l304.98">     // Force nsSuiteGlue::_initPlaces()</span>
<a href="#l304.99"></a><span id="l304.99">     do_log_info(&quot;Simulate Places init&quot;);</span>
<a href="#l304.100"></a><span id="l304.100">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l304.101"></a><span id="l304.101" class="difflineat">@@ -133,28 +133,28 @@ tests.push({</span>
<a href="#l304.102"></a><span id="l304.102"> });</span>
<a href="#l304.103"></a><span id="l304.103"> </span>
<a href="#l304.104"></a><span id="l304.104"> //------------------------------------------------------------------------------</span>
<a href="#l304.105"></a><span id="l304.105"> </span>
<a href="#l304.106"></a><span id="l304.106"> tests.push({</span>
<a href="#l304.107"></a><span id="l304.107">   description: &quot;Import from bookmarks.html, and create smart bookmarks if autoExportHTML is true and they are not at latest version.&quot;,</span>
<a href="#l304.108"></a><span id="l304.108">   exec: function() {</span>
<a href="#l304.109"></a><span id="l304.109">     // Sanity check: we should not have any bookmark on the toolbar.</span>
<a href="#l304.110"></a><span id="l304.110" class="difflineminus">-    do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.111"></a><span id="l304.111" class="difflineplus">+    Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.112"></a><span id="l304.112">     // Set preferences.</span>
<a href="#l304.113"></a><span id="l304.113">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 0);</span>
<a href="#l304.114"></a><span id="l304.114">     Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, true);</span>
<a href="#l304.115"></a><span id="l304.115">     Services.prefs.setBoolPref(PREF_IMPORT_BOOKMARKS_HTML, true);</span>
<a href="#l304.116"></a><span id="l304.116"> </span>
<a href="#l304.117"></a><span id="l304.117">     waitForImportAndSmartBookmarks(function () {</span>
<a href="#l304.118"></a><span id="l304.118">       // Check bookmarks.html has been imported, but smart bookmarks have not</span>
<a href="#l304.119"></a><span id="l304.119">       // been created.</span>
<a href="#l304.120"></a><span id="l304.120">       let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l304.121"></a><span id="l304.121" class="difflineminus">-      do_check_eq(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.122"></a><span id="l304.122" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.123"></a><span id="l304.123" class="difflineplus">+      Assert.equal(bs.getItemTitle(itemId), &quot;example&quot;);</span>
<a href="#l304.124"></a><span id="l304.124" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.125"></a><span id="l304.125">       // Check preferences have been reverted.</span>
<a href="#l304.126"></a><span id="l304.126">       Services.prefs.setBoolPref(PREF_AUTO_EXPORT_HTML, false);</span>
<a href="#l304.127"></a><span id="l304.127"> </span>
<a href="#l304.128"></a><span id="l304.128">       next_test();</span>
<a href="#l304.129"></a><span id="l304.129">     });</span>
<a href="#l304.130"></a><span id="l304.130">     // Force nsSuiteGlue::_initPlaces()</span>
<a href="#l304.131"></a><span id="l304.131">     do_log_info(&quot;Simulate Places init&quot;);</span>
<a href="#l304.132"></a><span id="l304.132">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l304.133"></a><span id="l304.133" class="difflineat">@@ -163,26 +163,26 @@ tests.push({</span>
<a href="#l304.134"></a><span id="l304.134">   }</span>
<a href="#l304.135"></a><span id="l304.135"> });</span>
<a href="#l304.136"></a><span id="l304.136"> </span>
<a href="#l304.137"></a><span id="l304.137"> //------------------------------------------------------------------------------</span>
<a href="#l304.138"></a><span id="l304.138"> tests.push({</span>
<a href="#l304.139"></a><span id="l304.139">   description: &quot;restore from default bookmarks.html if restore_default_bookmarks is true.&quot;,</span>
<a href="#l304.140"></a><span id="l304.140">   exec: function() {</span>
<a href="#l304.141"></a><span id="l304.141">     // Sanity check: we should not have any bookmark on the toolbar.</span>
<a href="#l304.142"></a><span id="l304.142" class="difflineminus">-    do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.143"></a><span id="l304.143" class="difflineplus">+    Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.144"></a><span id="l304.144">     // Set preferences.</span>
<a href="#l304.145"></a><span id="l304.145">     Services.prefs.setBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS, true);</span>
<a href="#l304.146"></a><span id="l304.146"> </span>
<a href="#l304.147"></a><span id="l304.147">     waitForImportAndSmartBookmarks(function () {</span>
<a href="#l304.148"></a><span id="l304.148">       // Check bookmarks.html has been restored.</span>
<a href="#l304.149"></a><span id="l304.149">       let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR + 1);</span>
<a href="#l304.150"></a><span id="l304.150" class="difflineminus">-      do_check_true(itemId &gt; 0);</span>
<a href="#l304.151"></a><span id="l304.151" class="difflineplus">+      Assert.ok(itemId &gt; 0);</span>
<a href="#l304.152"></a><span id="l304.152">       // Check preferences have been reverted.</span>
<a href="#l304.153"></a><span id="l304.153" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l304.154"></a><span id="l304.154" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l304.155"></a><span id="l304.155"> </span>
<a href="#l304.156"></a><span id="l304.156">       next_test();</span>
<a href="#l304.157"></a><span id="l304.157">     });</span>
<a href="#l304.158"></a><span id="l304.158">     // Force nsSuiteGlue::_initPlaces()</span>
<a href="#l304.159"></a><span id="l304.159">     do_log_info(&quot;Simulate Places init&quot;);</span>
<a href="#l304.160"></a><span id="l304.160">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l304.161"></a><span id="l304.161">                                               PlacesUtils.TOPIC_INIT_COMPLETE,</span>
<a href="#l304.162"></a><span id="l304.162">                                               null);</span>
<a href="#l304.163"></a><span id="l304.163" class="difflineat">@@ -190,28 +190,28 @@ tests.push({</span>
<a href="#l304.164"></a><span id="l304.164"> });</span>
<a href="#l304.165"></a><span id="l304.165"> </span>
<a href="#l304.166"></a><span id="l304.166"> //------------------------------------------------------------------------------</span>
<a href="#l304.167"></a><span id="l304.167"> </span>
<a href="#l304.168"></a><span id="l304.168"> tests.push({</span>
<a href="#l304.169"></a><span id="l304.169">   description: &quot;setting both importBookmarksHTML and restore_default_bookmarks should restore defaults.&quot;,</span>
<a href="#l304.170"></a><span id="l304.170">   exec: function() {</span>
<a href="#l304.171"></a><span id="l304.171">     // Sanity check: we should not have any bookmark on the toolbar.</span>
<a href="#l304.172"></a><span id="l304.172" class="difflineminus">-    do_check_eq(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.173"></a><span id="l304.173" class="difflineplus">+    Assert.equal(bs.getIdForItemAt(bs.toolbarFolder, 0), -1);</span>
<a href="#l304.174"></a><span id="l304.174">     // Set preferences.</span>
<a href="#l304.175"></a><span id="l304.175">     Services.prefs.setBoolPref(PREF_IMPORT_BOOKMARKS_HTML, true);</span>
<a href="#l304.176"></a><span id="l304.176">     Services.prefs.setBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS, true);</span>
<a href="#l304.177"></a><span id="l304.177"> </span>
<a href="#l304.178"></a><span id="l304.178">     waitForImportAndSmartBookmarks(function () {</span>
<a href="#l304.179"></a><span id="l304.179">       // Check bookmarks.html has been restored.</span>
<a href="#l304.180"></a><span id="l304.180">       let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR + 1);</span>
<a href="#l304.181"></a><span id="l304.181" class="difflineminus">-      do_check_true(itemId &gt; 0);</span>
<a href="#l304.182"></a><span id="l304.182" class="difflineplus">+      Assert.ok(itemId &gt; 0);</span>
<a href="#l304.183"></a><span id="l304.183">       // Check preferences have been reverted.</span>
<a href="#l304.184"></a><span id="l304.184" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l304.185"></a><span id="l304.185" class="difflineminus">-      do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.186"></a><span id="l304.186" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l304.187"></a><span id="l304.187" class="difflineplus">+      Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.188"></a><span id="l304.188"> </span>
<a href="#l304.189"></a><span id="l304.189">       do_test_finished();</span>
<a href="#l304.190"></a><span id="l304.190">     });</span>
<a href="#l304.191"></a><span id="l304.191">     // Force nsSuiteGlue::_initPlaces()</span>
<a href="#l304.192"></a><span id="l304.192">     do_log_info(&quot;Simulate Places init&quot;);</span>
<a href="#l304.193"></a><span id="l304.193">     bg.QueryInterface(Ci.nsIObserver).observe(null,</span>
<a href="#l304.194"></a><span id="l304.194">                                               PlacesUtils.TOPIC_INIT_COMPLETE,</span>
<a href="#l304.195"></a><span id="l304.195">                                               null);</span>
<a href="#l304.196"></a><span id="l304.196" class="difflineat">@@ -253,23 +253,23 @@ function run_test() {</span>
<a href="#l304.197"></a><span id="l304.197">   do_timeout(0, start_tests);</span>
<a href="#l304.198"></a><span id="l304.198"> }</span>
<a href="#l304.199"></a><span id="l304.199"> </span>
<a href="#l304.200"></a><span id="l304.200"> function start_tests() {</span>
<a href="#l304.201"></a><span id="l304.201">   // Clean up database from all bookmarks.</span>
<a href="#l304.202"></a><span id="l304.202">   remove_all_bookmarks();</span>
<a href="#l304.203"></a><span id="l304.203"> </span>
<a href="#l304.204"></a><span id="l304.204">   // Ensure preferences status.</span>
<a href="#l304.205"></a><span id="l304.205" class="difflineminus">-  do_check_false(Services.prefs.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l304.206"></a><span id="l304.206" class="difflineplus">+  Assert.ok(!Services.prefs.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l304.207"></a><span id="l304.207">   try {</span>
<a href="#l304.208"></a><span id="l304.208" class="difflineminus">-    do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.209"></a><span id="l304.209" class="difflineplus">+    Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l304.210"></a><span id="l304.210">     do_throw(&quot;importBookmarksHTML pref should not exist&quot;);</span>
<a href="#l304.211"></a><span id="l304.211">   }</span>
<a href="#l304.212"></a><span id="l304.212">   catch(ex) {}</span>
<a href="#l304.213"></a><span id="l304.213" class="difflineminus">-  do_check_false(Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l304.214"></a><span id="l304.214" class="difflineplus">+  Assert.ok(!Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l304.215"></a><span id="l304.215"> </span>
<a href="#l304.216"></a><span id="l304.216">   // Create our bookmarks.html from bookmarks.glue.html.</span>
<a href="#l304.217"></a><span id="l304.217">   create_bookmarks_html(&quot;bookmarks.glue.html&quot;);</span>
<a href="#l304.218"></a><span id="l304.218">   // Create our JSON backup from bookmarks.glue.json.</span>
<a href="#l304.219"></a><span id="l304.219">   create_JSON_backup(&quot;bookmarks.glue.json&quot;);</span>
<a href="#l304.220"></a><span id="l304.220">   // Kick-off tests.</span>
<a href="#l304.221"></a><span id="l304.221">   next_test();</span>
<a href="#l304.222"></a><span id="l304.222"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l305.1"></a><span id="l305.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_restore.js</span>
<a href="#l305.2"></a><span id="l305.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_restore.js</span>
<a href="#l305.3"></a><span id="l305.3" class="difflineat">@@ -17,17 +17,17 @@ XPCOMUtils.defineLazyServiceGetter(this,</span>
<a href="#l305.4"></a><span id="l305.4"> XPCOMUtils.defineLazyServiceGetter(this, &quot;anno&quot;,</span>
<a href="#l305.5"></a><span id="l305.5">                                    &quot;@mozilla.org/browser/annotation-service;1&quot;,</span>
<a href="#l305.6"></a><span id="l305.6">                                    &quot;nsIAnnotationService&quot;);</span>
<a href="#l305.7"></a><span id="l305.7"> </span>
<a href="#l305.8"></a><span id="l305.8"> var bookmarksObserver = {</span>
<a href="#l305.9"></a><span id="l305.9">   onBeginUpdateBatch: function() {},</span>
<a href="#l305.10"></a><span id="l305.10">   onEndUpdateBatch: function() {</span>
<a href="#l305.11"></a><span id="l305.11">     let itemId = bs.getIdForItemAt(bs.toolbarFolder, 0);</span>
<a href="#l305.12"></a><span id="l305.12" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l305.13"></a><span id="l305.13" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l305.14"></a><span id="l305.14">     if (anno.itemHasAnnotation(itemId, &quot;Places/SmartBookmark&quot;))</span>
<a href="#l305.15"></a><span id="l305.15">       continue_test();</span>
<a href="#l305.16"></a><span id="l305.16">   },</span>
<a href="#l305.17"></a><span id="l305.17">   onItemAdded: function() {},</span>
<a href="#l305.18"></a><span id="l305.18">   onItemRemoved: function(id, folder, index, itemType) {},</span>
<a href="#l305.19"></a><span id="l305.19">   onItemChanged: function() {},</span>
<a href="#l305.20"></a><span id="l305.20">   onItemVisited: function(id, visitID, time) {},</span>
<a href="#l305.21"></a><span id="l305.21">   onItemMoved: function() {},</span>
<a href="#l305.22"></a><span id="l305.22" class="difflineat">@@ -45,37 +45,37 @@ function run_test() {</span>
<a href="#l305.23"></a><span id="l305.23">   // folder.  It will be ignored.</span>
<a href="#l305.24"></a><span id="l305.24">   create_JSON_backup(&quot;bookmarks.glue.json&quot;);</span>
<a href="#l305.25"></a><span id="l305.25"> </span>
<a href="#l305.26"></a><span id="l305.26">   // Remove current database file.</span>
<a href="#l305.27"></a><span id="l305.27">   let db = gProfD.clone();</span>
<a href="#l305.28"></a><span id="l305.28">   db.append(&quot;places.sqlite&quot;);</span>
<a href="#l305.29"></a><span id="l305.29">   if (db.exists()) {</span>
<a href="#l305.30"></a><span id="l305.30">     db.remove(false);</span>
<a href="#l305.31"></a><span id="l305.31" class="difflineminus">-    do_check_false(db.exists());</span>
<a href="#l305.32"></a><span id="l305.32" class="difflineplus">+    Assert.ok(!db.exists());</span>
<a href="#l305.33"></a><span id="l305.33">   }</span>
<a href="#l305.34"></a><span id="l305.34"> </span>
<a href="#l305.35"></a><span id="l305.35">   // Initialize nsSuiteGlue before Places.</span>
<a href="#l305.36"></a><span id="l305.36">   Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].getService(Ci.nsISuiteGlue);</span>
<a href="#l305.37"></a><span id="l305.37"> </span>
<a href="#l305.38"></a><span id="l305.38">   // Initialize Places through the History Service.</span>
<a href="#l305.39"></a><span id="l305.39">   let hs = Cc[&quot;@mozilla.org/browser/nav-history-service;1&quot;].</span>
<a href="#l305.40"></a><span id="l305.40">            getService(Ci.nsINavHistoryService);</span>
<a href="#l305.41"></a><span id="l305.41">   // Check a new database has been created.</span>
<a href="#l305.42"></a><span id="l305.42">   // nsSuiteGlue uses databaseStatus to manage initialization.</span>
<a href="#l305.43"></a><span id="l305.43" class="difflineminus">-  do_check_eq(hs.databaseStatus, hs.DATABASE_STATUS_CREATE);</span>
<a href="#l305.44"></a><span id="l305.44" class="difflineplus">+  Assert.equal(hs.databaseStatus, hs.DATABASE_STATUS_CREATE);</span>
<a href="#l305.45"></a><span id="l305.45"> </span>
<a href="#l305.46"></a><span id="l305.46">   // The test will continue once restore has finished and smart bookmarks</span>
<a href="#l305.47"></a><span id="l305.47">   // have been created.</span>
<a href="#l305.48"></a><span id="l305.48">   bs.addObserver(bookmarksObserver);</span>
<a href="#l305.49"></a><span id="l305.49"> }</span>
<a href="#l305.50"></a><span id="l305.50"> </span>
<a href="#l305.51"></a><span id="l305.51"> function continue_test() {</span>
<a href="#l305.52"></a><span id="l305.52">   // Check that JSON backup has been restored.</span>
<a href="#l305.53"></a><span id="l305.53">   // Notice restore from JSON notification is fired before smart bookmarks creation.</span>
<a href="#l305.54"></a><span id="l305.54">   let itemId = bs.getIdForItemAt(bs.toolbarFolder, SMART_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l305.55"></a><span id="l305.55" class="difflineminus">-  do_check_eq(bs.getItemTitle(itemId), &quot;examplejson&quot;);</span>
<a href="#l305.56"></a><span id="l305.56" class="difflineplus">+  Assert.equal(bs.getItemTitle(itemId), &quot;examplejson&quot;);</span>
<a href="#l305.57"></a><span id="l305.57"> </span>
<a href="#l305.58"></a><span id="l305.58">   remove_bookmarks_html();</span>
<a href="#l305.59"></a><span id="l305.59">   remove_all_JSON_backups();</span>
<a href="#l305.60"></a><span id="l305.60"> </span>
<a href="#l305.61"></a><span id="l305.61">   do_test_finished();</span>
<a href="#l305.62"></a><span id="l305.62"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l306.1"></a><span id="l306.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js</span>
<a href="#l306.2"></a><span id="l306.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js</span>
<a href="#l306.3"></a><span id="l306.3" class="difflineat">@@ -40,247 +40,247 @@ function rebuildSmartBookmarks() {</span>
<a href="#l306.4"></a><span id="l306.4"> </span>
<a href="#l306.5"></a><span id="l306.5"> var tests = [];</span>
<a href="#l306.6"></a><span id="l306.6"> //------------------------------------------------------------------------------</span>
<a href="#l306.7"></a><span id="l306.7"> </span>
<a href="#l306.8"></a><span id="l306.8"> tests.push({</span>
<a href="#l306.9"></a><span id="l306.9">   description: &quot;All smart bookmarks are created if smart bookmarks version is 0.&quot;,</span>
<a href="#l306.10"></a><span id="l306.10">   exec: function() {</span>
<a href="#l306.11"></a><span id="l306.11">     // Sanity check: we should have default bookmark.</span>
<a href="#l306.12"></a><span id="l306.12" class="difflineminus">-    do_check_neq(PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.toolbarFolderId, 0), -1);</span>
<a href="#l306.13"></a><span id="l306.13" class="difflineminus">-    do_check_neq(PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 0), -1);</span>
<a href="#l306.14"></a><span id="l306.14" class="difflineplus">+    Assert.notEqual(PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.toolbarFolderId, 0), -1);</span>
<a href="#l306.15"></a><span id="l306.15" class="difflineplus">+    Assert.notEqual(PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 0), -1);</span>
<a href="#l306.16"></a><span id="l306.16"> </span>
<a href="#l306.17"></a><span id="l306.17">     // Set preferences.</span>
<a href="#l306.18"></a><span id="l306.18">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 0);</span>
<a href="#l306.19"></a><span id="l306.19"> </span>
<a href="#l306.20"></a><span id="l306.20">     rebuildSmartBookmarks();</span>
<a href="#l306.21"></a><span id="l306.21"> </span>
<a href="#l306.22"></a><span id="l306.22">     // Count items.</span>
<a href="#l306.23"></a><span id="l306.23" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.24"></a><span id="l306.24" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.25"></a><span id="l306.25" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.26"></a><span id="l306.26" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.27"></a><span id="l306.27" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.28"></a><span id="l306.28" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.29"></a><span id="l306.29" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.30"></a><span id="l306.30" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.31"></a><span id="l306.31"> </span>
<a href="#l306.32"></a><span id="l306.32">     // Check version has been updated.</span>
<a href="#l306.33"></a><span id="l306.33" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.34"></a><span id="l306.34" class="difflineminus">-                SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.35"></a><span id="l306.35" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.36"></a><span id="l306.36" class="difflineplus">+                 SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.37"></a><span id="l306.37"> </span>
<a href="#l306.38"></a><span id="l306.38">     next_test();</span>
<a href="#l306.39"></a><span id="l306.39">   }</span>
<a href="#l306.40"></a><span id="l306.40"> });</span>
<a href="#l306.41"></a><span id="l306.41"> </span>
<a href="#l306.42"></a><span id="l306.42"> //------------------------------------------------------------------------------</span>
<a href="#l306.43"></a><span id="l306.43"> </span>
<a href="#l306.44"></a><span id="l306.44"> tests.push({</span>
<a href="#l306.45"></a><span id="l306.45">   description: &quot;An existing smart bookmark is replaced when version changes.&quot;,</span>
<a href="#l306.46"></a><span id="l306.46">   exec: function() {</span>
<a href="#l306.47"></a><span id="l306.47">     // Sanity check: we have a smart bookmark on the toolbar.</span>
<a href="#l306.48"></a><span id="l306.48">     let itemId = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.toolbarFolderId, 0);</span>
<a href="#l306.49"></a><span id="l306.49" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l306.50"></a><span id="l306.50" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.51"></a><span id="l306.51" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l306.52"></a><span id="l306.52" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.53"></a><span id="l306.53">     // Change its title.</span>
<a href="#l306.54"></a><span id="l306.54">     PlacesUtils.bookmarks.setItemTitle(itemId, &quot;new title&quot;);</span>
<a href="#l306.55"></a><span id="l306.55" class="difflineminus">-    do_check_eq(PlacesUtils.bookmarks.getItemTitle(itemId), &quot;new title&quot;);</span>
<a href="#l306.56"></a><span id="l306.56" class="difflineplus">+    Assert.equal(PlacesUtils.bookmarks.getItemTitle(itemId), &quot;new title&quot;);</span>
<a href="#l306.57"></a><span id="l306.57"> </span>
<a href="#l306.58"></a><span id="l306.58">     // Sanity check items.</span>
<a href="#l306.59"></a><span id="l306.59" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.60"></a><span id="l306.60" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.61"></a><span id="l306.61" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.62"></a><span id="l306.62" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.63"></a><span id="l306.63" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.64"></a><span id="l306.64" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.65"></a><span id="l306.65" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.66"></a><span id="l306.66" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.67"></a><span id="l306.67"> </span>
<a href="#l306.68"></a><span id="l306.68">     // Set preferences.</span>
<a href="#l306.69"></a><span id="l306.69">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 1);</span>
<a href="#l306.70"></a><span id="l306.70"> </span>
<a href="#l306.71"></a><span id="l306.71">     rebuildSmartBookmarks();</span>
<a href="#l306.72"></a><span id="l306.72"> </span>
<a href="#l306.73"></a><span id="l306.73">     // Count items.</span>
<a href="#l306.74"></a><span id="l306.74" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.75"></a><span id="l306.75" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.76"></a><span id="l306.76" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.77"></a><span id="l306.77" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.78"></a><span id="l306.78" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.79"></a><span id="l306.79" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.80"></a><span id="l306.80" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.81"></a><span id="l306.81" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.82"></a><span id="l306.82"> </span>
<a href="#l306.83"></a><span id="l306.83">     // Check smart bookmark has been replaced, itemId has changed.</span>
<a href="#l306.84"></a><span id="l306.84">     itemId = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.toolbarFolderId, 0);</span>
<a href="#l306.85"></a><span id="l306.85" class="difflineminus">-    do_check_neq(itemId, -1);</span>
<a href="#l306.86"></a><span id="l306.86" class="difflineminus">-    do_check_neq(PlacesUtils.bookmarks.getItemTitle(itemId), &quot;new title&quot;);</span>
<a href="#l306.87"></a><span id="l306.87" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.88"></a><span id="l306.88" class="difflineplus">+    Assert.notEqual(itemId, -1);</span>
<a href="#l306.89"></a><span id="l306.89" class="difflineplus">+    Assert.notEqual(PlacesUtils.bookmarks.getItemTitle(itemId), &quot;new title&quot;);</span>
<a href="#l306.90"></a><span id="l306.90" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.91"></a><span id="l306.91"> </span>
<a href="#l306.92"></a><span id="l306.92">     // Check version has been updated.</span>
<a href="#l306.93"></a><span id="l306.93" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.94"></a><span id="l306.94" class="difflineminus">-                SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.95"></a><span id="l306.95" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.96"></a><span id="l306.96" class="difflineplus">+                 SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.97"></a><span id="l306.97"> </span>
<a href="#l306.98"></a><span id="l306.98">     next_test();</span>
<a href="#l306.99"></a><span id="l306.99">   }</span>
<a href="#l306.100"></a><span id="l306.100"> });</span>
<a href="#l306.101"></a><span id="l306.101"> </span>
<a href="#l306.102"></a><span id="l306.102"> //------------------------------------------------------------------------------</span>
<a href="#l306.103"></a><span id="l306.103"> </span>
<a href="#l306.104"></a><span id="l306.104"> tests.push({</span>
<a href="#l306.105"></a><span id="l306.105">   description: &quot;bookmarks position is retained when version changes.&quot;,</span>
<a href="#l306.106"></a><span id="l306.106">   exec: function() {</span>
<a href="#l306.107"></a><span id="l306.107">     // Sanity check items.</span>
<a href="#l306.108"></a><span id="l306.108" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.109"></a><span id="l306.109" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.110"></a><span id="l306.110" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.111"></a><span id="l306.111" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.112"></a><span id="l306.112" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.113"></a><span id="l306.113" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.114"></a><span id="l306.114" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.115"></a><span id="l306.115" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.116"></a><span id="l306.116"> </span>
<a href="#l306.117"></a><span id="l306.117">     let itemId = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 0);</span>
<a href="#l306.118"></a><span id="l306.118" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.119"></a><span id="l306.119" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.120"></a><span id="l306.120">     let firstItemTitle = PlacesUtils.bookmarks.getItemTitle(itemId);</span>
<a href="#l306.121"></a><span id="l306.121"> </span>
<a href="#l306.122"></a><span id="l306.122">     itemId = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 1);</span>
<a href="#l306.123"></a><span id="l306.123" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.124"></a><span id="l306.124" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.125"></a><span id="l306.125">     let secondItemTitle = PlacesUtils.bookmarks.getItemTitle(itemId);</span>
<a href="#l306.126"></a><span id="l306.126"> </span>
<a href="#l306.127"></a><span id="l306.127">     // Set preferences.</span>
<a href="#l306.128"></a><span id="l306.128">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 1);</span>
<a href="#l306.129"></a><span id="l306.129"> </span>
<a href="#l306.130"></a><span id="l306.130">     rebuildSmartBookmarks();</span>
<a href="#l306.131"></a><span id="l306.131"> </span>
<a href="#l306.132"></a><span id="l306.132">     // Count items.</span>
<a href="#l306.133"></a><span id="l306.133" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.134"></a><span id="l306.134" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.135"></a><span id="l306.135" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.136"></a><span id="l306.136" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.137"></a><span id="l306.137" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.138"></a><span id="l306.138" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.139"></a><span id="l306.139" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.140"></a><span id="l306.140" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.141"></a><span id="l306.141"> </span>
<a href="#l306.142"></a><span id="l306.142">     // Check smart bookmarks are still in correct position.</span>
<a href="#l306.143"></a><span id="l306.143">     itemId = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 0);</span>
<a href="#l306.144"></a><span id="l306.144" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.145"></a><span id="l306.145" class="difflineminus">-    do_check_eq(PlacesUtils.bookmarks.getItemTitle(itemId), firstItemTitle);</span>
<a href="#l306.146"></a><span id="l306.146" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.147"></a><span id="l306.147" class="difflineplus">+    Assert.equal(PlacesUtils.bookmarks.getItemTitle(itemId), firstItemTitle);</span>
<a href="#l306.148"></a><span id="l306.148"> </span>
<a href="#l306.149"></a><span id="l306.149">     itemId = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 1);</span>
<a href="#l306.150"></a><span id="l306.150" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.151"></a><span id="l306.151" class="difflineminus">-    do_check_eq(PlacesUtils.bookmarks.getItemTitle(itemId), secondItemTitle);</span>
<a href="#l306.152"></a><span id="l306.152" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.153"></a><span id="l306.153" class="difflineplus">+    Assert.equal(PlacesUtils.bookmarks.getItemTitle(itemId), secondItemTitle);</span>
<a href="#l306.154"></a><span id="l306.154"> </span>
<a href="#l306.155"></a><span id="l306.155">     // Check version has been updated.</span>
<a href="#l306.156"></a><span id="l306.156" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.157"></a><span id="l306.157" class="difflineminus">-                SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.158"></a><span id="l306.158" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.159"></a><span id="l306.159" class="difflineplus">+                 SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.160"></a><span id="l306.160"> </span>
<a href="#l306.161"></a><span id="l306.161">     next_test();</span>
<a href="#l306.162"></a><span id="l306.162">   }</span>
<a href="#l306.163"></a><span id="l306.163"> });</span>
<a href="#l306.164"></a><span id="l306.164"> </span>
<a href="#l306.165"></a><span id="l306.165"> //------------------------------------------------------------------------------</span>
<a href="#l306.166"></a><span id="l306.166"> </span>
<a href="#l306.167"></a><span id="l306.167"> tests.push({</span>
<a href="#l306.168"></a><span id="l306.168">   description: &quot;moved bookmarks position is retained when version changes.&quot;,</span>
<a href="#l306.169"></a><span id="l306.169">   exec: function() {</span>
<a href="#l306.170"></a><span id="l306.170">     // Sanity check items.</span>
<a href="#l306.171"></a><span id="l306.171" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.172"></a><span id="l306.172" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.173"></a><span id="l306.173" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.174"></a><span id="l306.174" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.175"></a><span id="l306.175" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.176"></a><span id="l306.176" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.177"></a><span id="l306.177" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.178"></a><span id="l306.178" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.179"></a><span id="l306.179"> </span>
<a href="#l306.180"></a><span id="l306.180">     let itemId1 = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 0);</span>
<a href="#l306.181"></a><span id="l306.181" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId1, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.182"></a><span id="l306.182" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId1, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.183"></a><span id="l306.183">     let firstItemTitle = PlacesUtils.bookmarks.getItemTitle(itemId1);</span>
<a href="#l306.184"></a><span id="l306.184"> </span>
<a href="#l306.185"></a><span id="l306.185">     let itemId2 = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 1);</span>
<a href="#l306.186"></a><span id="l306.186" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId2, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.187"></a><span id="l306.187" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId2, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.188"></a><span id="l306.188">     let secondItemTitle = PlacesUtils.bookmarks.getItemTitle(itemId2);</span>
<a href="#l306.189"></a><span id="l306.189"> </span>
<a href="#l306.190"></a><span id="l306.190">     // Move the first smart bookmark to the end of the menu.</span>
<a href="#l306.191"></a><span id="l306.191">     PlacesUtils.bookmarks.moveItem(itemId1, PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l306.192"></a><span id="l306.192">                                    PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l306.193"></a><span id="l306.193"> </span>
<a href="#l306.194"></a><span id="l306.194" class="difflineminus">-    do_check_eq(itemId1, PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l306.195"></a><span id="l306.195" class="difflineminus">-                                                   PlacesUtils.bookmarks.DEFAULT_INDEX));</span>
<a href="#l306.196"></a><span id="l306.196" class="difflineplus">+    Assert.equal(itemId1, PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l306.197"></a><span id="l306.197" class="difflineplus">+                                                    PlacesUtils.bookmarks.DEFAULT_INDEX));</span>
<a href="#l306.198"></a><span id="l306.198"> </span>
<a href="#l306.199"></a><span id="l306.199">     // Set preferences.</span>
<a href="#l306.200"></a><span id="l306.200">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 1);</span>
<a href="#l306.201"></a><span id="l306.201"> </span>
<a href="#l306.202"></a><span id="l306.202">     rebuildSmartBookmarks();</span>
<a href="#l306.203"></a><span id="l306.203"> </span>
<a href="#l306.204"></a><span id="l306.204">     // Count items.</span>
<a href="#l306.205"></a><span id="l306.205" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.206"></a><span id="l306.206" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.207"></a><span id="l306.207" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.208"></a><span id="l306.208" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.209"></a><span id="l306.209" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.210"></a><span id="l306.210" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.211"></a><span id="l306.211" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.212"></a><span id="l306.212" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.213"></a><span id="l306.213"> </span>
<a href="#l306.214"></a><span id="l306.214">     // Check smart bookmarks are still in correct position.</span>
<a href="#l306.215"></a><span id="l306.215">     itemId2 = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId, 0);</span>
<a href="#l306.216"></a><span id="l306.216" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId2, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.217"></a><span id="l306.217" class="difflineminus">-    do_check_eq(PlacesUtils.bookmarks.getItemTitle(itemId2), secondItemTitle);</span>
<a href="#l306.218"></a><span id="l306.218" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId2, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.219"></a><span id="l306.219" class="difflineplus">+    Assert.equal(PlacesUtils.bookmarks.getItemTitle(itemId2), secondItemTitle);</span>
<a href="#l306.220"></a><span id="l306.220"> </span>
<a href="#l306.221"></a><span id="l306.221">     itemId1 = PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l306.222"></a><span id="l306.222">                                                    PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l306.223"></a><span id="l306.223" class="difflineminus">-    do_check_true(PlacesUtils.annotations.itemHasAnnotation(itemId1, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.224"></a><span id="l306.224" class="difflineminus">-    do_check_eq(PlacesUtils.bookmarks.getItemTitle(itemId1), firstItemTitle);</span>
<a href="#l306.225"></a><span id="l306.225" class="difflineplus">+    Assert.ok(PlacesUtils.annotations.itemHasAnnotation(itemId1, SMART_BOOKMARKS_ANNO));</span>
<a href="#l306.226"></a><span id="l306.226" class="difflineplus">+    Assert.equal(PlacesUtils.bookmarks.getItemTitle(itemId1), firstItemTitle);</span>
<a href="#l306.227"></a><span id="l306.227"> </span>
<a href="#l306.228"></a><span id="l306.228">     // Move back the smart bookmark to the original position.</span>
<a href="#l306.229"></a><span id="l306.229">     PlacesUtils.bookmarks.moveItem(itemId1, PlacesUtils.bookmarksMenuFolderId, 1);</span>
<a href="#l306.230"></a><span id="l306.230"> </span>
<a href="#l306.231"></a><span id="l306.231">     // Check version has been updated.</span>
<a href="#l306.232"></a><span id="l306.232" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.233"></a><span id="l306.233" class="difflineminus">-                SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.234"></a><span id="l306.234" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.235"></a><span id="l306.235" class="difflineplus">+                 SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.236"></a><span id="l306.236"> </span>
<a href="#l306.237"></a><span id="l306.237">     next_test();</span>
<a href="#l306.238"></a><span id="l306.238">   }</span>
<a href="#l306.239"></a><span id="l306.239"> });</span>
<a href="#l306.240"></a><span id="l306.240"> </span>
<a href="#l306.241"></a><span id="l306.241"> //------------------------------------------------------------------------------</span>
<a href="#l306.242"></a><span id="l306.242"> </span>
<a href="#l306.243"></a><span id="l306.243"> tests.push({</span>
<a href="#l306.244"></a><span id="l306.244">   description: &quot;An explicitly removed smart bookmark should not be recreated.&quot;,</span>
<a href="#l306.245"></a><span id="l306.245">   exec: function() {</span>
<a href="#l306.246"></a><span id="l306.246">     // Remove toolbar's smart bookmarks</span>
<a href="#l306.247"></a><span id="l306.247">     PlacesUtils.bookmarks.removeItem(PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.toolbarFolderId, 0));</span>
<a href="#l306.248"></a><span id="l306.248"> </span>
<a href="#l306.249"></a><span id="l306.249">     // Sanity check items.</span>
<a href="#l306.250"></a><span id="l306.250" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.251"></a><span id="l306.251" class="difflineminus">-                DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.252"></a><span id="l306.252" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.253"></a><span id="l306.253" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.254"></a><span id="l306.254" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.255"></a><span id="l306.255" class="difflineplus">+                 DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.256"></a><span id="l306.256" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.257"></a><span id="l306.257" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.258"></a><span id="l306.258"> </span>
<a href="#l306.259"></a><span id="l306.259">     // Set preferences.</span>
<a href="#l306.260"></a><span id="l306.260">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 1);</span>
<a href="#l306.261"></a><span id="l306.261"> </span>
<a href="#l306.262"></a><span id="l306.262">     rebuildSmartBookmarks();</span>
<a href="#l306.263"></a><span id="l306.263"> </span>
<a href="#l306.264"></a><span id="l306.264">     // Count items.</span>
<a href="#l306.265"></a><span id="l306.265">     // We should not have recreated the smart bookmark on toolbar.</span>
<a href="#l306.266"></a><span id="l306.266" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.267"></a><span id="l306.267" class="difflineminus">-                DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.268"></a><span id="l306.268" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.269"></a><span id="l306.269" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.270"></a><span id="l306.270" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.271"></a><span id="l306.271" class="difflineplus">+                 DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.272"></a><span id="l306.272" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.273"></a><span id="l306.273" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.274"></a><span id="l306.274"> </span>
<a href="#l306.275"></a><span id="l306.275">     // Check version has been updated.</span>
<a href="#l306.276"></a><span id="l306.276" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.277"></a><span id="l306.277" class="difflineminus">-                SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.278"></a><span id="l306.278" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.279"></a><span id="l306.279" class="difflineplus">+                 SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.280"></a><span id="l306.280"> </span>
<a href="#l306.281"></a><span id="l306.281">     next_test();</span>
<a href="#l306.282"></a><span id="l306.282">   }</span>
<a href="#l306.283"></a><span id="l306.283"> });</span>
<a href="#l306.284"></a><span id="l306.284"> </span>
<a href="#l306.285"></a><span id="l306.285"> //------------------------------------------------------------------------------</span>
<a href="#l306.286"></a><span id="l306.286"> </span>
<a href="#l306.287"></a><span id="l306.287"> tests.push({</span>
<a href="#l306.288"></a><span id="l306.288">   description: &quot;Even if a smart bookmark has been removed recreate it if version is 0.&quot;,</span>
<a href="#l306.289"></a><span id="l306.289">   exec: function() {</span>
<a href="#l306.290"></a><span id="l306.290">     // Sanity check items.</span>
<a href="#l306.291"></a><span id="l306.291" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.292"></a><span id="l306.292" class="difflineminus">-                DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.293"></a><span id="l306.293" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.294"></a><span id="l306.294" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.295"></a><span id="l306.295" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.296"></a><span id="l306.296" class="difflineplus">+                 DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.297"></a><span id="l306.297" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.298"></a><span id="l306.298" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.299"></a><span id="l306.299"> </span>
<a href="#l306.300"></a><span id="l306.300">     // Set preferences.</span>
<a href="#l306.301"></a><span id="l306.301">     Services.prefs.setIntPref(PREF_SMART_BOOKMARKS_VERSION, 0);</span>
<a href="#l306.302"></a><span id="l306.302"> </span>
<a href="#l306.303"></a><span id="l306.303">     rebuildSmartBookmarks();</span>
<a href="#l306.304"></a><span id="l306.304"> </span>
<a href="#l306.305"></a><span id="l306.305">     // Count items.</span>
<a href="#l306.306"></a><span id="l306.306">     // We should not have recreated the smart bookmark on toolbar.</span>
<a href="#l306.307"></a><span id="l306.307" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.308"></a><span id="l306.308" class="difflineminus">-                SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.309"></a><span id="l306.309" class="difflineminus">-    do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.310"></a><span id="l306.310" class="difflineminus">-                SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.311"></a><span id="l306.311" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l306.312"></a><span id="l306.312" class="difflineplus">+                 SMART_BOOKMARKS_ON_TOOLBAR + DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l306.313"></a><span id="l306.313" class="difflineplus">+    Assert.equal(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l306.314"></a><span id="l306.314" class="difflineplus">+                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span>
<a href="#l306.315"></a><span id="l306.315"> </span>
<a href="#l306.316"></a><span id="l306.316">     // Check version has been updated.</span>
<a href="#l306.317"></a><span id="l306.317" class="difflineminus">-    do_check_eq(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.318"></a><span id="l306.318" class="difflineminus">-                SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.319"></a><span id="l306.319" class="difflineplus">+    Assert.equal(Services.prefs.getIntPref(PREF_SMART_BOOKMARKS_VERSION),</span>
<a href="#l306.320"></a><span id="l306.320" class="difflineplus">+                 SMART_BOOKMARKS_VERSION);</span>
<a href="#l306.321"></a><span id="l306.321"> </span>
<a href="#l306.322"></a><span id="l306.322">     next_test();</span>
<a href="#l306.323"></a><span id="l306.323">   }</span>
<a href="#l306.324"></a><span id="l306.324"> });</span>
<a href="#l306.325"></a><span id="l306.325"> //------------------------------------------------------------------------------</span>
<a href="#l306.326"></a><span id="l306.326"> </span>
<a href="#l306.327"></a><span id="l306.327"> function countFolderChildren(aFolderItemId) {</span>
<a href="#l306.328"></a><span id="l306.328">   let rootNode = PlacesUtils.getFolderContents(aFolderItemId).root;</span>
<a href="#l306.329"></a><span id="l306.329" class="difflineat">@@ -319,25 +319,25 @@ function run_test() {</span>
<a href="#l306.330"></a><span id="l306.330">   let bg = Cc[&quot;@mozilla.org/suite/suiteglue;1&quot;].getService(Ci.nsIObserver);</span>
<a href="#l306.331"></a><span id="l306.331">   // Initialize Places.</span>
<a href="#l306.332"></a><span id="l306.332">   PlacesUtils.history;</span>
<a href="#l306.333"></a><span id="l306.333">   // Usually places init would async notify to glue, but we want to avoid</span>
<a href="#l306.334"></a><span id="l306.334">   // randomness here, thus we fire the notification synchronously.</span>
<a href="#l306.335"></a><span id="l306.335">   bg.observe(null, &quot;places-init-complete&quot;, null);</span>
<a href="#l306.336"></a><span id="l306.336"> </span>
<a href="#l306.337"></a><span id="l306.337">   // Ensure preferences status.</span>
<a href="#l306.338"></a><span id="l306.338" class="difflineminus">-  do_check_false(Services.prefs.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l306.339"></a><span id="l306.339" class="difflineplus">+  Assert.ok(!Services.prefs.getBoolPref(PREF_AUTO_EXPORT_HTML));</span>
<a href="#l306.340"></a><span id="l306.340">   // XXXkairo: might get set due to the different logic of SeaMonkey imports</span>
<a href="#l306.341"></a><span id="l306.341">   //           but there could be some real bug so import is set and restore not</span>
<a href="#l306.342"></a><span id="l306.342">   try {</span>
<a href="#l306.343"></a><span id="l306.343" class="difflineminus">-    do_check_false(Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l306.344"></a><span id="l306.344" class="difflineplus">+    Assert.ok(!Services.prefs.getBoolPref(PREF_RESTORE_DEFAULT_BOOKMARKS));</span>
<a href="#l306.345"></a><span id="l306.345">   }</span>
<a href="#l306.346"></a><span id="l306.346">   catch(ex) {}</span>
<a href="#l306.347"></a><span id="l306.347">   try {</span>
<a href="#l306.348"></a><span id="l306.348" class="difflineminus">-    do_check_false(Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l306.349"></a><span id="l306.349" class="difflineplus">+    Assert.ok(!Services.prefs.getBoolPref(PREF_IMPORT_BOOKMARKS_HTML));</span>
<a href="#l306.350"></a><span id="l306.350">     // do_throw(&quot;importBookmarksHTML pref should not exist&quot;);</span>
<a href="#l306.351"></a><span id="l306.351">   }</span>
<a href="#l306.352"></a><span id="l306.352">   catch(ex) {}</span>
<a href="#l306.353"></a><span id="l306.353"> </span>
<a href="#l306.354"></a><span id="l306.354">   waitForImportAndSmartBookmarks(next_test);</span>
<a href="#l306.355"></a><span id="l306.355"> }</span>
<a href="#l306.356"></a><span id="l306.356"> </span>
<a href="#l306.357"></a><span id="l306.357"> function waitForImportAndSmartBookmarks(aCallback) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l307.1"></a><span id="l307.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_clearHistory_shutdown.js</span>
<a href="#l307.2"></a><span id="l307.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_clearHistory_shutdown.js</span>
<a href="#l307.3"></a><span id="l307.3" class="difflineat">@@ -35,17 +35,17 @@ var notificationIndex = 0;</span>
<a href="#l307.4"></a><span id="l307.4"> var notificationsObserver = {</span>
<a href="#l307.5"></a><span id="l307.5">   observe: function observe(aSubject, aTopic, aData) {</span>
<a href="#l307.6"></a><span id="l307.6">     print(&quot;Received notification: &quot; + aTopic);</span>
<a href="#l307.7"></a><span id="l307.7"> </span>
<a href="#l307.8"></a><span id="l307.8">     // Note that some of these notifications could arrive multiple times, for</span>
<a href="#l307.9"></a><span id="l307.9">     // example in case of sync, we allow that.</span>
<a href="#l307.10"></a><span id="l307.10">     if (EXPECTED_NOTIFICATIONS[notificationIndex] != aTopic)</span>
<a href="#l307.11"></a><span id="l307.11">       notificationIndex++;</span>
<a href="#l307.12"></a><span id="l307.12" class="difflineminus">-    do_check_eq(EXPECTED_NOTIFICATIONS[notificationIndex], aTopic);</span>
<a href="#l307.13"></a><span id="l307.13" class="difflineplus">+    Assert.equal(EXPECTED_NOTIFICATIONS[notificationIndex], aTopic);</span>
<a href="#l307.14"></a><span id="l307.14"> </span>
<a href="#l307.15"></a><span id="l307.15">     if (aTopic != TOPIC_CONNECTION_CLOSED)</span>
<a href="#l307.16"></a><span id="l307.16">       return;</span>
<a href="#l307.17"></a><span id="l307.17"> </span>
<a href="#l307.18"></a><span id="l307.18">     getDistinctNotifications().forEach(</span>
<a href="#l307.19"></a><span id="l307.19">       topic =&gt; Services.obs.removeObserver(notificationsObserver, topic)</span>
<a href="#l307.20"></a><span id="l307.20">     );</span>
<a href="#l307.21"></a><span id="l307.21"> </span>
<a href="#l307.22"></a><span id="l307.22" class="difflineat">@@ -53,17 +53,17 @@ var notificationsObserver = {</span>
<a href="#l307.23"></a><span id="l307.23"> </span>
<a href="#l307.24"></a><span id="l307.24">     let stmt = DBConn().createStatement(</span>
<a href="#l307.25"></a><span id="l307.25">       &quot;SELECT id FROM moz_places WHERE url = :page_url &quot;</span>
<a href="#l307.26"></a><span id="l307.26">     );</span>
<a href="#l307.27"></a><span id="l307.27"> </span>
<a href="#l307.28"></a><span id="l307.28">     try {</span>
<a href="#l307.29"></a><span id="l307.29">       URIS.forEach(function(aUrl) {</span>
<a href="#l307.30"></a><span id="l307.30">         stmt.params.page_url = aUrl;</span>
<a href="#l307.31"></a><span id="l307.31" class="difflineminus">-        do_check_false(stmt.executeStep());</span>
<a href="#l307.32"></a><span id="l307.32" class="difflineplus">+        Assert.ok(!stmt.executeStep());</span>
<a href="#l307.33"></a><span id="l307.33">         stmt.reset();</span>
<a href="#l307.34"></a><span id="l307.34">       });</span>
<a href="#l307.35"></a><span id="l307.35">     } finally {</span>
<a href="#l307.36"></a><span id="l307.36">       stmt.finalize();</span>
<a href="#l307.37"></a><span id="l307.37">     }</span>
<a href="#l307.38"></a><span id="l307.38"> </span>
<a href="#l307.39"></a><span id="l307.39">     // Check cache.</span>
<a href="#l307.40"></a><span id="l307.40">     checkCache(URL);</span>
<a href="#l307.41"></a><span id="l307.41" class="difflineat">@@ -135,17 +135,17 @@ function storeCache(aURL, aContent) {</span>
<a href="#l307.42"></a><span id="l307.42">   let cache = Cc[&quot;@mozilla.org/network/cache-service;1&quot;].</span>
<a href="#l307.43"></a><span id="l307.43">               getService(Ci.nsICacheService);</span>
<a href="#l307.44"></a><span id="l307.44">   let session = cache.createSession(&quot;FTP&quot;, Ci.nsICache.STORE_ANYWHERE,</span>
<a href="#l307.45"></a><span id="l307.45">                                     Ci.nsICache.STREAM_BASED);</span>
<a href="#l307.46"></a><span id="l307.46"> </span>
<a href="#l307.47"></a><span id="l307.47"> </span>
<a href="#l307.48"></a><span id="l307.48">   var storeCacheListener = {</span>
<a href="#l307.49"></a><span id="l307.49">     onCacheEntryAvailable: function (entry, access, status) {</span>
<a href="#l307.50"></a><span id="l307.50" class="difflineminus">-      do_check_eq(status, Cr.NS_OK);</span>
<a href="#l307.51"></a><span id="l307.51" class="difflineplus">+      Assert.equal(status, Cr.NS_OK);</span>
<a href="#l307.52"></a><span id="l307.52"> </span>
<a href="#l307.53"></a><span id="l307.53">       entry.setMetaDataElement(&quot;servertype&quot;, &quot;0&quot;);</span>
<a href="#l307.54"></a><span id="l307.54">       var os = entry.openOutputStream(0);</span>
<a href="#l307.55"></a><span id="l307.55"> </span>
<a href="#l307.56"></a><span id="l307.56">       var written = os.write(aContent, aContent.length);</span>
<a href="#l307.57"></a><span id="l307.57">       if (written != aContent.length) {</span>
<a href="#l307.58"></a><span id="l307.58">         do_throw(&quot;os.write has not written all data!\n&quot; +</span>
<a href="#l307.59"></a><span id="l307.59">                  &quot;  Expected: &quot; + written  + &quot;\n&quot; +</span>
<a href="#l307.60"></a><span id="l307.60" class="difflineat">@@ -165,17 +165,17 @@ function storeCache(aURL, aContent) {</span>
<a href="#l307.61"></a><span id="l307.61"> function checkCache(aURL) {</span>
<a href="#l307.62"></a><span id="l307.62">   let cache = Cc[&quot;@mozilla.org/network/cache-service;1&quot;].</span>
<a href="#l307.63"></a><span id="l307.63">               getService(Ci.nsICacheService);</span>
<a href="#l307.64"></a><span id="l307.64">   let session = cache.createSession(&quot;FTP&quot;, Ci.nsICache.STORE_ANYWHERE,</span>
<a href="#l307.65"></a><span id="l307.65">                                     Ci.nsICache.STREAM_BASED);</span>
<a href="#l307.66"></a><span id="l307.66"> </span>
<a href="#l307.67"></a><span id="l307.67">   var checkCacheListener = {</span>
<a href="#l307.68"></a><span id="l307.68">     onCacheEntryAvailable: function (entry, access, status) {</span>
<a href="#l307.69"></a><span id="l307.69" class="difflineminus">-      do_check_eq(status, Cr.NS_ERROR_CACHE_KEY_NOT_FOUND);</span>
<a href="#l307.70"></a><span id="l307.70" class="difflineplus">+      Assert.equal(status, Cr.NS_ERROR_CACHE_KEY_NOT_FOUND);</span>
<a href="#l307.71"></a><span id="l307.71">       do_test_finished();</span>
<a href="#l307.72"></a><span id="l307.72">     }</span>
<a href="#l307.73"></a><span id="l307.73">   };</span>
<a href="#l307.74"></a><span id="l307.74"> </span>
<a href="#l307.75"></a><span id="l307.75">   session.asyncOpenCacheEntry(aURL,</span>
<a href="#l307.76"></a><span id="l307.76">                               Ci.nsICache.ACCESS_READ,</span>
<a href="#l307.77"></a><span id="l307.77">                               checkCacheListener);</span>
<a href="#l307.78"></a><span id="l307.78"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l308.1"></a><span id="l308.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_leftpane_corruption_handling.js</span>
<a href="#l308.2"></a><span id="l308.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_leftpane_corruption_handling.js</span>
<a href="#l308.3"></a><span id="l308.3" class="difflineat">@@ -80,23 +80,23 @@ var gTests = [</span>
<a href="#l308.4"></a><span id="l308.4"> </span>
<a href="#l308.5"></a><span id="l308.5"> ];</span>
<a href="#l308.6"></a><span id="l308.6"> </span>
<a href="#l308.7"></a><span id="l308.7"> function run_test() {</span>
<a href="#l308.8"></a><span id="l308.8">   // We want empty roots.</span>
<a href="#l308.9"></a><span id="l308.9">   remove_all_bookmarks();</span>
<a href="#l308.10"></a><span id="l308.10"> </span>
<a href="#l308.11"></a><span id="l308.11">   // Sanity check.</span>
<a href="#l308.12"></a><span id="l308.12" class="difflineminus">-  do_check_true(!!PlacesUIUtils);</span>
<a href="#l308.13"></a><span id="l308.13" class="difflineplus">+  Assert.ok(!!PlacesUIUtils);</span>
<a href="#l308.14"></a><span id="l308.14"> </span>
<a href="#l308.15"></a><span id="l308.15">   // Check getters.</span>
<a href="#l308.16"></a><span id="l308.16">   gLeftPaneFolderIdGetter = PlacesUIUtils.__lookupGetter__(&quot;leftPaneFolderId&quot;);</span>
<a href="#l308.17"></a><span id="l308.17" class="difflineminus">-  do_check_eq(typeof(gLeftPaneFolderIdGetter), &quot;function&quot;);</span>
<a href="#l308.18"></a><span id="l308.18" class="difflineplus">+  Assert.equal(typeof(gLeftPaneFolderIdGetter), &quot;function&quot;);</span>
<a href="#l308.19"></a><span id="l308.19">   gAllBookmarksFolderIdGetter = PlacesUIUtils.__lookupGetter__(&quot;allBookmarksFolderId&quot;);</span>
<a href="#l308.20"></a><span id="l308.20" class="difflineminus">-  do_check_eq(typeof(gAllBookmarksFolderIdGetter), &quot;function&quot;);</span>
<a href="#l308.21"></a><span id="l308.21" class="difflineplus">+  Assert.equal(typeof(gAllBookmarksFolderIdGetter), &quot;function&quot;);</span>
<a href="#l308.22"></a><span id="l308.22"> </span>
<a href="#l308.23"></a><span id="l308.23">   // Add a third party bogus annotated item.  Should not be removed.</span>
<a href="#l308.24"></a><span id="l308.24">   gFolderId = PlacesUtils.bookmarks.createFolder(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l308.25"></a><span id="l308.25">                                                  &quot;test&quot;,</span>
<a href="#l308.26"></a><span id="l308.26">                                                  PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l308.27"></a><span id="l308.27">   PlacesUtils.annotations.setItemAnnotation(gFolderId, ORGANIZER_QUERY_ANNO,</span>
<a href="#l308.28"></a><span id="l308.28">                                             &quot;test&quot;, 0,</span>
<a href="#l308.29"></a><span id="l308.29">                                             PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l308.30"></a><span id="l308.30" class="difflineat">@@ -117,18 +117,18 @@ function run_next_test() {</span>
<a href="#l308.31"></a><span id="l308.31">     let test = gTests.shift();</span>
<a href="#l308.32"></a><span id="l308.32">     test();</span>
<a href="#l308.33"></a><span id="l308.33">     // Regenerate getters.</span>
<a href="#l308.34"></a><span id="l308.34">     PlacesUIUtils.__defineGetter__(&quot;leftPaneFolderId&quot;, gLeftPaneFolderIdGetter);</span>
<a href="#l308.35"></a><span id="l308.35">     gLeftPaneFolderId = PlacesUIUtils.leftPaneFolderId;</span>
<a href="#l308.36"></a><span id="l308.36">     PlacesUIUtils.__defineGetter__(&quot;allBookmarksFolderId&quot;, gAllBookmarksFolderIdGetter);</span>
<a href="#l308.37"></a><span id="l308.37">     // Check the new left pane folder.</span>
<a href="#l308.38"></a><span id="l308.38">     let leftPaneJSON = folderToJSON(gLeftPaneFolderId);</span>
<a href="#l308.39"></a><span id="l308.39" class="difflineminus">-    do_check_true(compareJSON(gReferenceJSON, leftPaneJSON));</span>
<a href="#l308.40"></a><span id="l308.40" class="difflineminus">-    do_check_eq(PlacesUtils.bookmarks.getItemTitle(gFolderId), &quot;test&quot;);</span>
<a href="#l308.41"></a><span id="l308.41" class="difflineplus">+    Assert.ok(compareJSON(gReferenceJSON, leftPaneJSON));</span>
<a href="#l308.42"></a><span id="l308.42" class="difflineplus">+    Assert.equal(PlacesUtils.bookmarks.getItemTitle(gFolderId), &quot;test&quot;);</span>
<a href="#l308.43"></a><span id="l308.43">     // Go to next test.</span>
<a href="#l308.44"></a><span id="l308.44">     do_timeout(0, run_next_test);</span>
<a href="#l308.45"></a><span id="l308.45">   }</span>
<a href="#l308.46"></a><span id="l308.46">   else {</span>
<a href="#l308.47"></a><span id="l308.47">     // All tests finished.</span>
<a href="#l308.48"></a><span id="l308.48">     remove_all_bookmarks();</span>
<a href="#l308.49"></a><span id="l308.49">     do_test_finished();</span>
<a href="#l308.50"></a><span id="l308.50">   }</span>
<a href="#l308.51"></a><span id="l308.51" class="difflineat">@@ -145,34 +145,34 @@ function folderToJSON(aItemId) {</span>
<a href="#l308.52"></a><span id="l308.52">   let root = PlacesUtils.history.executeQuery(query, options).root;</span>
<a href="#l308.53"></a><span id="l308.53">   let writer = {</span>
<a href="#l308.54"></a><span id="l308.54">     value: &quot;&quot;,</span>
<a href="#l308.55"></a><span id="l308.55">     write: function PU_wrapNode__write(aStr, aLen) {</span>
<a href="#l308.56"></a><span id="l308.56">       this.value += aStr;</span>
<a href="#l308.57"></a><span id="l308.57">     }</span>
<a href="#l308.58"></a><span id="l308.58">   };</span>
<a href="#l308.59"></a><span id="l308.59">   PlacesUtils.serializeNodeAsJSONToOutputStream(root, writer, false, false);</span>
<a href="#l308.60"></a><span id="l308.60" class="difflineminus">-  do_check_true(writer.value.length &gt; 0);</span>
<a href="#l308.61"></a><span id="l308.61" class="difflineplus">+  Assert.ok(writer.value.length &gt; 0);</span>
<a href="#l308.62"></a><span id="l308.62">   return writer.value;</span>
<a href="#l308.63"></a><span id="l308.63"> }</span>
<a href="#l308.64"></a><span id="l308.64"> </span>
<a href="#l308.65"></a><span id="l308.65"> /**</span>
<a href="#l308.66"></a><span id="l308.66">  * Compare the JSON representation of 2 nodes, skipping everchanging properties</span>
<a href="#l308.67"></a><span id="l308.67">  * like dates.</span>
<a href="#l308.68"></a><span id="l308.68">  */</span>
<a href="#l308.69"></a><span id="l308.69"> function compareJSON(aNodeJSON_1, aNodeJSON_2) {</span>
<a href="#l308.70"></a><span id="l308.70">   let node1 = JSON.parse(aNodeJSON_1);</span>
<a href="#l308.71"></a><span id="l308.71">   let node2 = JSON.parse(aNodeJSON_2);</span>
<a href="#l308.72"></a><span id="l308.72"> </span>
<a href="#l308.73"></a><span id="l308.73">   // List of properties we should not compare (expected to be different).</span>
<a href="#l308.74"></a><span id="l308.74">   const SKIP_PROPS = [&quot;dateAdded&quot;, &quot;lastModified&quot;, &quot;id&quot;];</span>
<a href="#l308.75"></a><span id="l308.75"> </span>
<a href="#l308.76"></a><span id="l308.76">   function compareObjects(obj1, obj2) {</span>
<a href="#l308.77"></a><span id="l308.77">     function count(o) { var n = 0; for (let p in o) n++; return n; }</span>
<a href="#l308.78"></a><span id="l308.78" class="difflineminus">-    do_check_eq(count(obj1), count(obj2));</span>
<a href="#l308.79"></a><span id="l308.79" class="difflineplus">+    Assert.equal(count(obj1), count(obj2));</span>
<a href="#l308.80"></a><span id="l308.80">     for (let prop in obj1) {</span>
<a href="#l308.81"></a><span id="l308.81">       // Skip everchanging values.</span>
<a href="#l308.82"></a><span id="l308.82">       if (SKIP_PROPS.indexOf(prop) != -1)</span>
<a href="#l308.83"></a><span id="l308.83">         continue;</span>
<a href="#l308.84"></a><span id="l308.84">       // Skip undefined objects, otherwise we hang on them.</span>
<a href="#l308.85"></a><span id="l308.85">       if (!obj1[prop])</span>
<a href="#l308.86"></a><span id="l308.86">         continue;</span>
<a href="#l308.87"></a><span id="l308.87">       if (typeof(obj1[prop]) == &quot;object&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l309.1"></a><span id="l309.1" class="difflineminus">--- a/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l309.2"></a><span id="l309.2" class="difflineplus">+++ b/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l309.3"></a><span id="l309.3" class="difflineat">@@ -18,17 +18,17 @@ var sanTests = {</span>
<a href="#l309.4"></a><span id="l309.4">     async check(aShouldBeCleared) {</span>
<a href="#l309.5"></a><span id="l309.5">       let entry = null;</span>
<a href="#l309.6"></a><span id="l309.6">       entry = await promiseOpenCacheEntry(&quot;http://santizer.test&quot;, Components.interfaces.nsICache.ACCESS_READ, this.cs);</span>
<a href="#l309.7"></a><span id="l309.7"> </span>
<a href="#l309.8"></a><span id="l309.8">       if (entry) {</span>
<a href="#l309.9"></a><span id="l309.9">         entry.close();</span>
<a href="#l309.10"></a><span id="l309.10">       }</span>
<a href="#l309.11"></a><span id="l309.11"> </span>
<a href="#l309.12"></a><span id="l309.12" class="difflineminus">-      do_check_eq(!entry, aShouldBeCleared);</span>
<a href="#l309.13"></a><span id="l309.13" class="difflineplus">+      Assert.equal(!entry, aShouldBeCleared);</span>
<a href="#l309.14"></a><span id="l309.14">     }</span>
<a href="#l309.15"></a><span id="l309.15">   },</span>
<a href="#l309.16"></a><span id="l309.16"> </span>
<a href="#l309.17"></a><span id="l309.17">   offlineApps: {</span>
<a href="#l309.18"></a><span id="l309.18">     desc: &quot;Offline app cache&quot;,</span>
<a href="#l309.19"></a><span id="l309.19">     async setup() {</span>
<a href="#l309.20"></a><span id="l309.20">       //XXX test offline DOMStorage</span>
<a href="#l309.21"></a><span id="l309.21">       var entry = null;</span>
<a href="#l309.22"></a><span id="l309.22" class="difflineat">@@ -41,17 +41,17 @@ var sanTests = {</span>
<a href="#l309.23"></a><span id="l309.23"> </span>
<a href="#l309.24"></a><span id="l309.24">     async check(aShouldBeCleared) {</span>
<a href="#l309.25"></a><span id="l309.25">       var entry = null;</span>
<a href="#l309.26"></a><span id="l309.26">       entry = await promiseOpenCacheEntry(&quot;http://santizer.test&quot;, Components.interfaces.nsICache.ACCESS_READ, this.cs);</span>
<a href="#l309.27"></a><span id="l309.27">       if (entry) {</span>
<a href="#l309.28"></a><span id="l309.28">         entry.close();</span>
<a href="#l309.29"></a><span id="l309.29">       }</span>
<a href="#l309.30"></a><span id="l309.30"> </span>
<a href="#l309.31"></a><span id="l309.31" class="difflineminus">-      do_check_eq(!entry, aShouldBeCleared);</span>
<a href="#l309.32"></a><span id="l309.32" class="difflineplus">+      Assert.equal(!entry, aShouldBeCleared);</span>
<a href="#l309.33"></a><span id="l309.33">     }</span>
<a href="#l309.34"></a><span id="l309.34">   },</span>
<a href="#l309.35"></a><span id="l309.35"> </span>
<a href="#l309.36"></a><span id="l309.36">   cookies: {</span>
<a href="#l309.37"></a><span id="l309.37">     desc: &quot;Cookie&quot;,</span>
<a href="#l309.38"></a><span id="l309.38">     setup: function() {</span>
<a href="#l309.39"></a><span id="l309.39">       Services.prefs.setIntPref(&quot;network.cookie.cookieBehavior&quot;, 0);</span>
<a href="#l309.40"></a><span id="l309.40">       var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l309.41"></a><span id="l309.41" class="difflineat">@@ -59,19 +59,19 @@ var sanTests = {</span>
<a href="#l309.42"></a><span id="l309.42">       this.uri = ios.newURI(&quot;http://sanitizer.test/&quot;);</span>
<a href="#l309.43"></a><span id="l309.43">       this.cs = Components.classes[&quot;@mozilla.org/cookieService;1&quot;]</span>
<a href="#l309.44"></a><span id="l309.44">                           .getService(Components.interfaces.nsICookieService);</span>
<a href="#l309.45"></a><span id="l309.45">       this.cs.setCookieString(this.uri, null, &quot;Sanitizer!&quot;, null);</span>
<a href="#l309.46"></a><span id="l309.46">     },</span>
<a href="#l309.47"></a><span id="l309.47"> </span>
<a href="#l309.48"></a><span id="l309.48">     check: function(aShouldBeCleared) {</span>
<a href="#l309.49"></a><span id="l309.49">       if (aShouldBeCleared)</span>
<a href="#l309.50"></a><span id="l309.50" class="difflineminus">-        do_check_neq(this.cs.getCookieString(this.uri, null), &quot;Sanitizer!&quot;);</span>
<a href="#l309.51"></a><span id="l309.51" class="difflineplus">+        Assert.notEqual(this.cs.getCookieString(this.uri, null), &quot;Sanitizer!&quot;);</span>
<a href="#l309.52"></a><span id="l309.52">       else</span>
<a href="#l309.53"></a><span id="l309.53" class="difflineminus">-        do_check_eq(this.cs.getCookieString(this.uri, null), &quot;Sanitizer!&quot;);</span>
<a href="#l309.54"></a><span id="l309.54" class="difflineplus">+        Assert.equal(this.cs.getCookieString(this.uri, null), &quot;Sanitizer!&quot;);</span>
<a href="#l309.55"></a><span id="l309.55">     }</span>
<a href="#l309.56"></a><span id="l309.56">   },</span>
<a href="#l309.57"></a><span id="l309.57"> </span>
<a href="#l309.58"></a><span id="l309.58">   history: {</span>
<a href="#l309.59"></a><span id="l309.59">     desc: &quot;History&quot;,</span>
<a href="#l309.60"></a><span id="l309.60">     async setup() {</span>
<a href="#l309.61"></a><span id="l309.61">       var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l309.62"></a><span id="l309.62">                           .getService(Components.interfaces.nsIIOService);</span>
<a href="#l309.63"></a><span id="l309.63" class="difflineat">@@ -96,17 +96,17 @@ var sanTests = {</span>
<a href="#l309.64"></a><span id="l309.64">           rv = true;</span>
<a href="#l309.65"></a><span id="l309.65">           break;</span>
<a href="#l309.66"></a><span id="l309.66">         }</span>
<a href="#l309.67"></a><span id="l309.67">       }</span>
<a href="#l309.68"></a><span id="l309.68"> </span>
<a href="#l309.69"></a><span id="l309.69">       // Close container after reading from it</span>
<a href="#l309.70"></a><span id="l309.70">       results.containerOpen = false;</span>
<a href="#l309.71"></a><span id="l309.71"> </span>
<a href="#l309.72"></a><span id="l309.72" class="difflineminus">-      do_check_eq(rv, !aShouldBeCleared);</span>
<a href="#l309.73"></a><span id="l309.73" class="difflineplus">+      Assert.equal(rv, !aShouldBeCleared);</span>
<a href="#l309.74"></a><span id="l309.74">     }</span>
<a href="#l309.75"></a><span id="l309.75">   },</span>
<a href="#l309.76"></a><span id="l309.76"> </span>
<a href="#l309.77"></a><span id="l309.77">   urlbar: {</span>
<a href="#l309.78"></a><span id="l309.78">     desc: &quot;Location bar history&quot;,</span>
<a href="#l309.79"></a><span id="l309.79">     setup: function() {</span>
<a href="#l309.80"></a><span id="l309.80">       // Create urlbarhistory file first otherwise tests will fail.</span>
<a href="#l309.81"></a><span id="l309.81">       var file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l309.82"></a><span id="l309.82" class="difflineat">@@ -128,17 +128,17 @@ var sanTests = {</span>
<a href="#l309.83"></a><span id="l309.83">     },</span>
<a href="#l309.84"></a><span id="l309.84"> </span>
<a href="#l309.85"></a><span id="l309.85">     check: function(aShouldBeCleared) {</span>
<a href="#l309.86"></a><span id="l309.86">       let locData;</span>
<a href="#l309.87"></a><span id="l309.87">       try {</span>
<a href="#l309.88"></a><span id="l309.88">         locData = Services.prefs.getStringPref(&quot;general.open_location.last_url&quot;);</span>
<a href="#l309.89"></a><span id="l309.89">       } catch(ex) {}</span>
<a href="#l309.90"></a><span id="l309.90"> </span>
<a href="#l309.91"></a><span id="l309.91" class="difflineminus">-      do_check_eq(locData == &quot;Sanitizer!&quot;, !aShouldBeCleared);</span>
<a href="#l309.92"></a><span id="l309.92" class="difflineplus">+      Assert.equal(locData == &quot;Sanitizer!&quot;, !aShouldBeCleared);</span>
<a href="#l309.93"></a><span id="l309.93"> </span>
<a href="#l309.94"></a><span id="l309.94">       var file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l309.95"></a><span id="l309.95">                            .getService(Components.interfaces.nsIProperties)</span>
<a href="#l309.96"></a><span id="l309.96">                            .get(&quot;ProfD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l309.97"></a><span id="l309.97">       file.append(&quot;urlbarhistory.sqlite&quot;);</span>
<a href="#l309.98"></a><span id="l309.98"> </span>
<a href="#l309.99"></a><span id="l309.99">       var connection = Components.classes[&quot;@mozilla.org/storage/service;1&quot;]</span>
<a href="#l309.100"></a><span id="l309.100">                                  .getService(Components.interfaces.mozIStorageService)</span>
<a href="#l309.101"></a><span id="l309.101" class="difflineat">@@ -149,17 +149,17 @@ var sanTests = {</span>
<a href="#l309.102"></a><span id="l309.102">           &quot;SELECT url FROM urlbarhistory&quot;);</span>
<a href="#l309.103"></a><span id="l309.103">         if (handle.executeStep())</span>
<a href="#l309.104"></a><span id="l309.104">           urlbar = (handle.getString(0) == &quot;Sanitizer&quot;);</span>
<a href="#l309.105"></a><span id="l309.105">         handle.reset();</span>
<a href="#l309.106"></a><span id="l309.106">         handle.finalize();</span>
<a href="#l309.107"></a><span id="l309.107">       }</span>
<a href="#l309.108"></a><span id="l309.108">       connection.close();</span>
<a href="#l309.109"></a><span id="l309.109"> </span>
<a href="#l309.110"></a><span id="l309.110" class="difflineminus">-      do_check_eq(urlbar, !aShouldBeCleared);</span>
<a href="#l309.111"></a><span id="l309.111" class="difflineplus">+      Assert.equal(urlbar, !aShouldBeCleared);</span>
<a href="#l309.112"></a><span id="l309.112">     }</span>
<a href="#l309.113"></a><span id="l309.113">   },</span>
<a href="#l309.114"></a><span id="l309.114"> </span>
<a href="#l309.115"></a><span id="l309.115">   formdata: {</span>
<a href="#l309.116"></a><span id="l309.116">     desc: &quot;Form history&quot;,</span>
<a href="#l309.117"></a><span id="l309.117">     async setup() {</span>
<a href="#l309.118"></a><span id="l309.118">       // Adds a form entry to history.</span>
<a href="#l309.119"></a><span id="l309.119">       function promiseAddFormEntry(aName, aValue) {</span>
<a href="#l309.120"></a><span id="l309.120" class="difflineat">@@ -194,17 +194,17 @@ var sanTests = {</span>
<a href="#l309.121"></a><span id="l309.121">                                 }</span>
<a href="#l309.122"></a><span id="l309.122">                               }</span>
<a href="#l309.123"></a><span id="l309.123">                             });</span>
<a href="#l309.124"></a><span id="l309.124">         });</span>
<a href="#l309.125"></a><span id="l309.125">       }</span>
<a href="#l309.126"></a><span id="l309.126"> </span>
<a href="#l309.127"></a><span id="l309.127">       // Checking for Sanitizer form history entry creation.</span>
<a href="#l309.128"></a><span id="l309.128">       let exists = await formNameExists(&quot;Sanitizer&quot;);</span>
<a href="#l309.129"></a><span id="l309.129" class="difflineminus">-      do_check_eq(exists, !aShouldBeCleared);</span>
<a href="#l309.130"></a><span id="l309.130" class="difflineplus">+      Assert.equal(exists, !aShouldBeCleared);</span>
<a href="#l309.131"></a><span id="l309.131">     }</span>
<a href="#l309.132"></a><span id="l309.132">   },</span>
<a href="#l309.133"></a><span id="l309.133"> </span>
<a href="#l309.134"></a><span id="l309.134">   downloads: {</span>
<a href="#l309.135"></a><span id="l309.135">     desc: &quot;Download&quot;,</span>
<a href="#l309.136"></a><span id="l309.136">     setup: function() {</span>
<a href="#l309.137"></a><span id="l309.137">       var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l309.138"></a><span id="l309.138">                           .getService(Components.interfaces.nsIIOService);</span>
<a href="#l309.139"></a><span id="l309.139" class="difflineat">@@ -237,19 +237,19 @@ var sanTests = {</span>
<a href="#l309.140"></a><span id="l309.140"> </span>
<a href="#l309.141"></a><span id="l309.141">     check: function(aShouldBeCleared) {</span>
<a href="#l309.142"></a><span id="l309.142">       var dl = null;</span>
<a href="#l309.143"></a><span id="l309.143">       try {</span>
<a href="#l309.144"></a><span id="l309.144">         dl = this.dm.getDownload(this.dl.id);</span>
<a href="#l309.145"></a><span id="l309.145">       } catch(ex) {}</span>
<a href="#l309.146"></a><span id="l309.146"> </span>
<a href="#l309.147"></a><span id="l309.147">       if (aShouldBeCleared)</span>
<a href="#l309.148"></a><span id="l309.148" class="difflineminus">-        do_check_eq(!dl, aShouldBeCleared)</span>
<a href="#l309.149"></a><span id="l309.149" class="difflineplus">+        Assert.equal(!dl, aShouldBeCleared)</span>
<a href="#l309.150"></a><span id="l309.150">       else</span>
<a href="#l309.151"></a><span id="l309.151" class="difflineminus">-        do_check_eq(dl.displayName, &quot;Sanitizer!&quot;);</span>
<a href="#l309.152"></a><span id="l309.152" class="difflineplus">+        Assert.equal(dl.displayName, &quot;Sanitizer!&quot;);</span>
<a href="#l309.153"></a><span id="l309.153">     }</span>
<a href="#l309.154"></a><span id="l309.154">   },</span>
<a href="#l309.155"></a><span id="l309.155"> </span>
<a href="#l309.156"></a><span id="l309.156">   passwords: {</span>
<a href="#l309.157"></a><span id="l309.157">     desc: &quot;Login manager&quot;,</span>
<a href="#l309.158"></a><span id="l309.158">     setup: function() {</span>
<a href="#l309.159"></a><span id="l309.159">       this.pm = Components.classes[&quot;@mozilla.org/login-manager;1&quot;]</span>
<a href="#l309.160"></a><span id="l309.160">                           .getService(Components.interfaces.nsILoginManager);</span>
<a href="#l309.161"></a><span id="l309.161" class="difflineat">@@ -265,17 +265,17 @@ var sanTests = {</span>
<a href="#l309.162"></a><span id="l309.162">       let logins = this.pm.findLogins({}, &quot;http://sanitizer.test&quot;, null, &quot;Rick Astley Fan Club&quot;);</span>
<a href="#l309.163"></a><span id="l309.163">       for (var i = 0; i &lt; logins.length; i++) {</span>
<a href="#l309.164"></a><span id="l309.164">         if (logins[i].username == &quot;dolske&quot;) {</span>
<a href="#l309.165"></a><span id="l309.165">           rv = true;</span>
<a href="#l309.166"></a><span id="l309.166">           break;</span>
<a href="#l309.167"></a><span id="l309.167">         }</span>
<a href="#l309.168"></a><span id="l309.168">       }</span>
<a href="#l309.169"></a><span id="l309.169"> </span>
<a href="#l309.170"></a><span id="l309.170" class="difflineminus">-      do_check_eq(rv, !aShouldBeCleared);</span>
<a href="#l309.171"></a><span id="l309.171" class="difflineplus">+      Assert.equal(rv, !aShouldBeCleared);</span>
<a href="#l309.172"></a><span id="l309.172">     }</span>
<a href="#l309.173"></a><span id="l309.173">   },</span>
<a href="#l309.174"></a><span id="l309.174"> </span>
<a href="#l309.175"></a><span id="l309.175">   sessions: {</span>
<a href="#l309.176"></a><span id="l309.176">     desc: &quot;HTTP auth session&quot;,</span>
<a href="#l309.177"></a><span id="l309.177">     setup: function() {</span>
<a href="#l309.178"></a><span id="l309.178">       this.authMgr = Components.classes[&quot;@mozilla.org/network/http-auth-manager;1&quot;]</span>
<a href="#l309.179"></a><span id="l309.179">                                .getService(Components.interfaces.nsIHttpAuthManager);</span>
<a href="#l309.180"></a><span id="l309.180" class="difflineat">@@ -289,17 +289,17 @@ var sanTests = {</span>
<a href="#l309.181"></a><span id="l309.181">       var user = {};</span>
<a href="#l309.182"></a><span id="l309.182">       var password = {};</span>
<a href="#l309.183"></a><span id="l309.183"> </span>
<a href="#l309.184"></a><span id="l309.184">       try {</span>
<a href="#l309.185"></a><span id="l309.185">         this.authMgr.getAuthIdentity(&quot;http&quot;, &quot;sanitizer.test&quot;, 80, &quot;basic&quot;, &quot;Sanitizer&quot;,</span>
<a href="#l309.186"></a><span id="l309.186">                                      &quot;&quot;, domain, user, password);</span>
<a href="#l309.187"></a><span id="l309.187">       } catch(ex) {}</span>
<a href="#l309.188"></a><span id="l309.188"> </span>
<a href="#l309.189"></a><span id="l309.189" class="difflineminus">-      do_check_eq(domain.value == &quot;Foo&quot;, !aShouldBeCleared);</span>
<a href="#l309.190"></a><span id="l309.190" class="difflineplus">+      Assert.equal(domain.value == &quot;Foo&quot;, !aShouldBeCleared);</span>
<a href="#l309.191"></a><span id="l309.191">     }</span>
<a href="#l309.192"></a><span id="l309.192">   }</span>
<a href="#l309.193"></a><span id="l309.193"> }</span>
<a href="#l309.194"></a><span id="l309.194"> </span>
<a href="#l309.195"></a><span id="l309.195"> async function fullSanitize() {</span>
<a href="#l309.196"></a><span id="l309.196">   do_print(&quot;Now doing a full sanitize run&quot;);</span>
<a href="#l309.197"></a><span id="l309.197">   var prefs = Services.prefs.getBranch(&quot;privacy.item.&quot;);</span>
<a href="#l309.198"></a><span id="l309.198"> </span>
<a href="#l309.199"></a><span id="l309.199" class="difflineat">@@ -335,17 +335,17 @@ function run_test()</span>
<a href="#l309.200"></a><span id="l309.200"> add_task(async function test_browser_sanitizer()</span>
<a href="#l309.201"></a><span id="l309.201"> {</span>
<a href="#l309.202"></a><span id="l309.202">   for (var testName in sanTests) {</span>
<a href="#l309.203"></a><span id="l309.203">     let test = sanTests[testName];</span>
<a href="#l309.204"></a><span id="l309.204">     dump(&quot;\nExecuting test: &quot; + testName + &quot;\n&quot; + &quot;*** &quot; + test.desc + &quot;\n&quot;);</span>
<a href="#l309.205"></a><span id="l309.205">     await test.setup();</span>
<a href="#l309.206"></a><span id="l309.206">     await test.check(false);</span>
<a href="#l309.207"></a><span id="l309.207"> </span>
<a href="#l309.208"></a><span id="l309.208" class="difflineminus">-    do_check_true(Sanitizer.items[testName].canClear);</span>
<a href="#l309.209"></a><span id="l309.209" class="difflineplus">+    Assert.ok(Sanitizer.items[testName].canClear);</span>
<a href="#l309.210"></a><span id="l309.210">     Sanitizer.items[testName].clear();</span>
<a href="#l309.211"></a><span id="l309.211">     do_print(test.desc + &quot; data cleared&quot;);</span>
<a href="#l309.212"></a><span id="l309.212"> </span>
<a href="#l309.213"></a><span id="l309.213">     await test.check(true);</span>
<a href="#l309.214"></a><span id="l309.214">   }</span>
<a href="#l309.215"></a><span id="l309.215"> });</span>
<a href="#l309.216"></a><span id="l309.216"> </span>
<a href="#l309.217"></a><span id="l309.217"> add_task(fullSanitize);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

