<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27961:ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285" />
<meta property="og:url" content="/comm-central/rev/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285" />
<meta property="og:description" content="Bug 1588876 - Part 3: Use Services.dirsvc whenever possible in SeaMonkey. r=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">shortlog</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">files</a> |
changeset |
<a href="/comm-central/raw-rev/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">raw</a>  | <a href="/comm-central/archive/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588876">Bug 1588876</a> - Part 3: Use Services.dirsvc whenever possible in SeaMonkey. r=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#45;&#82;&#97;&#105;&#110;&#101;&#114;&#32;&#71;&#114;&#97;&#104;&#108;&#32;&#60;&#102;&#114;&#103;&#114;&#97;&#104;&#108;&#64;&#103;&#109;&#120;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 20 Oct 2019 17:40:58 +0200</td></tr>

<tr>
 <td>changeset 27961</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285</a></td>
</tr>



<tr>
<td>parent 27960</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b7054ece21742ae4ae0f6e85aff2ff7eb02c5b4f">b7054ece21742ae4ae0f6e85aff2ff7eb02c5b4f</a>
</td>
</tr>

<tr>
<td>child 27962</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b3f6a6cb079ea44716e6c8e69524b595c651d5c3">b3f6a6cb079ea44716e6c8e69524b595c651d5c3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285">16580</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 20 Oct 2019 15:42:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6bd51ba5b088 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd51ba5b088386e8b2b02cf7246949e47d017a2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588876">1588876</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588876">Bug 1588876</a> - Part 3: Use Services.dirsvc whenever possible in SeaMonkey. r=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/base/content/safeMode.js">suite/base/content/safeMode.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/base/content/safeMode.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/base/content/safeMode.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/base/content/safeMode.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/base/content/safeMode.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/base/content/safeMode.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/browser/nsBrowserContentHandler.js">suite/browser/nsBrowserContentHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/browser/nsBrowserContentHandler.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/browser/nsBrowserContentHandler.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/browser/nsBrowserContentHandler.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/browser/nsBrowserContentHandler.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/browser/nsBrowserContentHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/dataman/content/dataman.js">suite/components/dataman/content/dataman.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/dataman/content/dataman.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/dataman/content/dataman.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/dataman/content/dataman.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/dataman/content/dataman.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/dataman/content/dataman.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul">suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_basic_functionality.xul">suite/components/downloads/tests/chrome/test_basic_functionality.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_basic_functionality.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_basic_functionality.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_basic_functionality.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_basic_functionality.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_basic_functionality.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_cleanup_search.xul">suite/components/downloads/tests/chrome/test_cleanup_search.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_cleanup_search.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_cleanup_search.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_cleanup_search.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_cleanup_search.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_cleanup_search.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul">suite/components/downloads/tests/chrome/test_clear_button_disabled.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">suite/components/downloads/tests/chrome/test_delete_key_cancels.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">suite/components/downloads/tests/chrome/test_delete_key_removes.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_delete_key_removes.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_drag.xul">suite/components/downloads/tests/chrome/test_drag.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_drag.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_drag.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_drag.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_drag.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_drag.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul">suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multi_select.xul">suite/components/downloads/tests/chrome/test_multi_select.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multi_select.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multi_select.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multi_select.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multi_select.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multi_select.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multiword_search.xul">suite/components/downloads/tests/chrome/test_multiword_search.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multiword_search.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multiword_search.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multiword_search.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multiword_search.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_multiword_search.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_open_properties.xul">suite/components/downloads/tests/chrome/test_open_properties.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_open_properties.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_open_properties.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_open_properties.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_open_properties.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_open_properties.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_search_clearlist.xul">suite/components/downloads/tests/chrome/test_search_clearlist.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_search_clearlist.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_search_clearlist.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_search_clearlist.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_search_clearlist.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_search_clearlist.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_select_all.xul">suite/components/downloads/tests/chrome/test_select_all.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_select_all.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_select_all.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_select_all.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_select_all.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_select_all.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_retries.xul">suite/components/downloads/tests/chrome/test_space_key_retries.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_retries.xul">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_retries.xul">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_retries.xul">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_retries.xul">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/downloads/tests/chrome/test_space_key_retries.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/profile/content/profileSelection.js">suite/components/profile/content/profileSelection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/profile/content/profileSelection.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/profile/content/profileSelection.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/profile/content/profileSelection.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/profile/content/profileSelection.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/profile/content/profileSelection.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_346337.js">suite/components/tests/browser/browser_346337.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_346337.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_346337.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_346337.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_346337.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_346337.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_466937.js">suite/components/tests/browser/browser_466937.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_466937.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_466937.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_466937.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_466937.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/components/tests/browser/browser_466937.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/Sanitizer.jsm">suite/modules/Sanitizer.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/Sanitizer.jsm">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/Sanitizer.jsm">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/Sanitizer.jsm">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/Sanitizer.jsm">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/Sanitizer.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/test/unit/test_browser_sanitizer.js">suite/modules/test/unit/test_browser_sanitizer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/test/unit/test_browser_sanitizer.js">file</a> |
<a href="/comm-central/annotate/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/test/unit/test_browser_sanitizer.js">annotate</a> |
<a href="/comm-central/diff/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/test/unit/test_browser_sanitizer.js">diff</a> |
<a href="/comm-central/comparison/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/test/unit/test_browser_sanitizer.js">comparison</a> |
<a href="/comm-central/log/ad3a7eb5e8744f8b8b6db5bc69edf5ab53848285/suite/modules/test/unit/test_browser_sanitizer.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/base/content/safeMode.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/base/content/safeMode.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -11,21 +11,17 @@ function restartApp() {</span>
<a href="#l1.4"></a><span id="l1.4">   appStartup.quit(appStartup.eForceQuit | appStartup.eRestart);</span>
<a href="#l1.5"></a><span id="l1.5"> }</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> function clearAllPrefs() {</span>
<a href="#l1.8"></a><span id="l1.8">   Services.prefs.resetUserPrefs();</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">   // Remove the pref-overrides dir, if it exists.</span>
<a href="#l1.11"></a><span id="l1.11">   try {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    var fileLocator = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                        .getService(Ci.nsIProperties);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    const NS_APP_PREFS_OVERRIDE_DIR = &quot;PrefDOverride&quot;;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-    var prefOverridesDir = fileLocator.get(NS_APP_PREFS_OVERRIDE_DIR,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-                                           Ci.nsIFile);</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    var prefOverridesDir = Services.dirsvc.get(&quot;PrefDOverride&quot;, Ci.nsIFile);</span>
<a href="#l1.18"></a><span id="l1.18">     prefOverridesDir.remove(true);</span>
<a href="#l1.19"></a><span id="l1.19">   } catch (ex) {</span>
<a href="#l1.20"></a><span id="l1.20">     Cu.reportError(ex);</span>
<a href="#l1.21"></a><span id="l1.21">   }</span>
<a href="#l1.22"></a><span id="l1.22"> }</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> function restoreDefaultBookmarks() {</span>
<a href="#l1.25"></a><span id="l1.25">   Services.prefs.setBoolPref(&quot;browser.bookmarks.restore_default_bookmarks&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/nsBrowserContentHandler.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/nsBrowserContentHandler.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -349,19 +349,17 @@ var nsBrowserContentHandler = {</span>
<a href="#l2.4"></a><span id="l2.4">     // If we don't have a profile selected yet (e.g. the Profile Manager is</span>
<a href="#l2.5"></a><span id="l2.5">     // displayed) we will crash if we open an url and then select a profile. To</span>
<a href="#l2.6"></a><span id="l2.6">     // prevent this handle all url command line flag and set the command line's</span>
<a href="#l2.7"></a><span id="l2.7">     // preventDefault to true to prevent the display of the ui. The initial</span>
<a href="#l2.8"></a><span id="l2.8">     // command line will be retained when nsAppRunner calls LaunchChild though</span>
<a href="#l2.9"></a><span id="l2.9">     // urls launched after the initial launch will be lost.</span>
<a href="#l2.10"></a><span id="l2.10">     try {</span>
<a href="#l2.11"></a><span id="l2.11">       // This will throw when a profile has not been selected.</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      var fl = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                 .getService(Ci.nsIProperties);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-      fl.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+      Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l2.16"></a><span id="l2.16">     } catch (e) {</span>
<a href="#l2.17"></a><span id="l2.17">       cmdLine.preventDefault = true;</span>
<a href="#l2.18"></a><span id="l2.18">       throw Cr.NS_ERROR_ABORT;</span>
<a href="#l2.19"></a><span id="l2.19">     }</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">     try {</span>
<a href="#l2.22"></a><span id="l2.22">       var urlParam = cmdLine.handleFlagWithParam(&quot;url&quot;, false);</span>
<a href="#l2.23"></a><span id="l2.23">       if (urlParam) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/components/dataman/content/dataman.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/components/dataman/content/dataman.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -2455,19 +2455,17 @@ var gStorage = {</span>
<a href="#l3.4"></a><span id="l3.4">                           type: &quot;appCache&quot;,</span>
<a href="#l3.5"></a><span id="l3.5">                           size: cache.usage,</span>
<a href="#l3.6"></a><span id="l3.6">                           groupID: lGroup});</span>
<a href="#l3.7"></a><span id="l3.7">     }</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">     // Load DOM storage entries, unfortunately need to go to the DB. :(</span>
<a href="#l3.10"></a><span id="l3.10">     // Bug 343163 would make this easier and clean.</span>
<a href="#l3.11"></a><span id="l3.11">     let domstorelist = [];</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    let file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                 .getService(Ci.nsIProperties)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                 .get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    let file = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l3.16"></a><span id="l3.16">     file.append(&quot;webappsstore.sqlite&quot;);</span>
<a href="#l3.17"></a><span id="l3.17">     if (file.exists()) {</span>
<a href="#l3.18"></a><span id="l3.18">       var connection = Cc[&quot;@mozilla.org/storage/service;1&quot;]</span>
<a href="#l3.19"></a><span id="l3.19">                          .getService(Ci.mozIStorageService)</span>
<a href="#l3.20"></a><span id="l3.20">                          .openDatabase(file);</span>
<a href="#l3.21"></a><span id="l3.21">       try {</span>
<a href="#l3.22"></a><span id="l3.22">         if (connection.tableExists(&quot;webappsstore2&quot;)) {</span>
<a href="#l3.23"></a><span id="l3.23">           var statement =</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineat">@@ -2525,19 +2523,17 @@ var gStorage = {</span>
<a href="#l3.25"></a><span id="l3.25">                               origHost: origHost,</span>
<a href="#l3.26"></a><span id="l3.26">                               keys: [domstorelist[i].key]});</span>
<a href="#l3.27"></a><span id="l3.27">         }</span>
<a href="#l3.28"></a><span id="l3.28">       }</span>
<a href="#l3.29"></a><span id="l3.29">     }</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31">     // Load indexedDB entries, unfortunately need to read directory for now. :(</span>
<a href="#l3.32"></a><span id="l3.32">     // Bug 630858 would make this easier and clean.</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-    let dir = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-                .getService(Ci.nsIProperties)</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-                .get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+    let dir = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l3.37"></a><span id="l3.37">     dir.append(&quot;indexedDB&quot;);</span>
<a href="#l3.38"></a><span id="l3.38">     if (dir.exists() &amp;&amp; dir.isDirectory()) {</span>
<a href="#l3.39"></a><span id="l3.39">       // Enumerate subdir entries, names are like &quot;http+++davidflanagan.com&quot; or</span>
<a href="#l3.40"></a><span id="l3.40">       // &quot;https+++mochi.test+8888&quot;, and filter out the domain name and protocol</span>
<a href="#l3.41"></a><span id="l3.41">       // from that.</span>
<a href="#l3.42"></a><span id="l3.42">       // gLocSvc.idxdbmgr is usable as soon as we have a URI.</span>
<a href="#l3.43"></a><span id="l3.43">       let files = dir.directoryEntries</span>
<a href="#l3.44"></a><span id="l3.44">                      .QueryInterface(Ci.nsIDirectoryEnumerator);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_action_keys_respect_focus.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -183,19 +183,17 @@ function test()</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     const nsIWBP = Ci.nsIWebBrowserPersist;</span>
<a href="#l4.6"></a><span id="l4.6">     var persist = Cc[&quot;@mozilla.org/embedding/browser/nsWebBrowserPersist;1&quot;]</span>
<a href="#l4.7"></a><span id="l4.7">                     .createInstance(nsIWBP);</span>
<a href="#l4.8"></a><span id="l4.8">     persist.persistFlags = nsIWBP.PERSIST_FLAGS_REPLACE_EXISTING_FILES |</span>
<a href="#l4.9"></a><span id="l4.9">                            nsIWBP.PERSIST_FLAGS_BYPASS_CACHE |</span>
<a href="#l4.10"></a><span id="l4.10">                            nsIWBP.PERSIST_FLAGS_AUTODETECT_APPLY_CONVERSION;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                   .getService(Ci.nsIProperties);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-    var destFile = dirSvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+    var destFile = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l4.16"></a><span id="l4.16">     // The &quot;paused&quot; part of this filename will be searched for later.</span>
<a href="#l4.17"></a><span id="l4.17">     destFile.append(&quot;download.paused&quot;);</span>
<a href="#l4.18"></a><span id="l4.18">     if (destFile.exists())</span>
<a href="#l4.19"></a><span id="l4.19">       destFile.remove(false);</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">     var dl = dm.addDownload(Ci.nsIDownloadManager.DOWNLOAD_TYPE_DOWNLOAD,</span>
<a href="#l4.22"></a><span id="l4.22">                             createURI(&quot;http://example.com/httpd.js&quot;),</span>
<a href="#l4.23"></a><span id="l4.23">                             createURI(destFile), null, null,</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -206,19 +204,17 @@ function test()</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">     return dl;</span>
<a href="#l4.27"></a><span id="l4.27">   }</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">   // Empty any old downloads</span>
<a href="#l4.30"></a><span id="l4.30">   dm.DBConnection.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">   // Make a file name for the downloads</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l4.37"></a><span id="l4.37">   file.append(&quot;cleanUp&quot;);</span>
<a href="#l4.38"></a><span id="l4.38">   var filePath = Services.io.newFileURI(file).spec;</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">   var stmt = dm.DBConnection.createStatement(</span>
<a href="#l4.41"></a><span id="l4.41">     &quot;INSERT INTO moz_downloads (name, target, source, state) &quot; +</span>
<a href="#l4.42"></a><span id="l4.42">     &quot;VALUES (?1, ?2, ?3, ?4)&quot;);</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44">   try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_basic_functionality.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_basic_functionality.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -51,19 +51,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l5.5"></a><span id="l5.5">           src=&quot;chrome://mochikit/content/MochiKit/packed.js&quot;/&gt;</span>
<a href="#l5.6"></a><span id="l5.6">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l5.7"></a><span id="l5.7">           src=&quot;chrome://mochikit/content/tests/SimpleTest/SimpleTest.js&quot;/&gt;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10">   &lt;![CDATA[</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-var dmFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+var dmFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l5.16"></a><span id="l5.16"> dmFile.append(&quot;dm-ui-test.file&quot;);</span>
<a href="#l5.17"></a><span id="l5.17"> dmFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l5.18"></a><span id="l5.18"> var gTestPath = Services.io.newFileURI(dmFile).spec;</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> // Downloads are sorted by endTime, so make sure the end times are distinct</span>
<a href="#l5.21"></a><span id="l5.21"> const DownloadData = [</span>
<a href="#l5.22"></a><span id="l5.22">   /* Active states first */</span>
<a href="#l5.23"></a><span id="l5.23">   { name: &quot;381603.patch&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_cleanup_search.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_cleanup_search.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -62,19 +62,17 @@ function test()</span>
<a href="#l6.4"></a><span id="l6.4">   var dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l6.5"></a><span id="l6.5">              .getService(Ci.nsIDownloadManager);</span>
<a href="#l6.6"></a><span id="l6.6">   var db = dm.DBConnection;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   // Empty any old downloads</span>
<a href="#l6.9"></a><span id="l6.9">   db.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">   // Make a file name for the downloads</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l6.16"></a><span id="l6.16">   file.append(&quot;cleanUp&quot;);</span>
<a href="#l6.17"></a><span id="l6.17">   var filePath = Services.io.newFileURI(file).spec;</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">   var stmt = db.createStatement(</span>
<a href="#l6.20"></a><span id="l6.20">     &quot;INSERT INTO moz_downloads (name, target, source, state) &quot; +</span>
<a href="#l6.21"></a><span id="l6.21">     &quot;VALUES (?1, ?2, ?3, ?4)&quot;);</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">   try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_clear_button_disabled.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -56,19 +56,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l7.5"></a><span id="l7.5">           src=&quot;chrome://mochikit/content/tests/SimpleTest/SimpleTest.js&quot;/&gt;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   &lt;![CDATA[</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> const nsIDownloadManager = Ci.nsIDownloadManager;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-var dmFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+var dmFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l7.16"></a><span id="l7.16"> dmFile.append(&quot;dm-ui-test.file&quot;);</span>
<a href="#l7.17"></a><span id="l7.17"> dmFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l7.18"></a><span id="l7.18"> var gTestPath = Services.io.newFileURI(dmFile).spec;</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> const DoneDownloadData = [</span>
<a href="#l7.21"></a><span id="l7.21">   { name: &quot;Dead&quot;,</span>
<a href="#l7.22"></a><span id="l7.22">     source: &quot;https://bugzilla.mozilla.org/attachment.cgi?id=266520&quot;,</span>
<a href="#l7.23"></a><span id="l7.23">     target: gTestPath,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_delete_key_cancels.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -130,19 +130,17 @@ function test()</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">     const nsIWBP = Ci.nsIWebBrowserPersist;</span>
<a href="#l8.6"></a><span id="l8.6">     var persist = Cc[&quot;@mozilla.org/embedding/browser/nsWebBrowserPersist;1&quot;]</span>
<a href="#l8.7"></a><span id="l8.7">                     .createInstance(nsIWBP);</span>
<a href="#l8.8"></a><span id="l8.8">     persist.persistFlags = nsIWBP.PERSIST_FLAGS_REPLACE_EXISTING_FILES |</span>
<a href="#l8.9"></a><span id="l8.9">                            nsIWBP.PERSIST_FLAGS_BYPASS_CACHE |</span>
<a href="#l8.10"></a><span id="l8.10">                            nsIWBP.PERSIST_FLAGS_AUTODETECT_APPLY_CONVERSION;</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-                   .getService(Ci.nsIProperties);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-    var destFile = dirSvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    var destFile = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l8.16"></a><span id="l8.16">     destFile.append(&quot;download.result&quot;);</span>
<a href="#l8.17"></a><span id="l8.17">     if (destFile.exists())</span>
<a href="#l8.18"></a><span id="l8.18">       destFile.remove(false);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     var dl = dm.addDownload(Ci.nsIDownloadManager.DOWNLOAD_TYPE_DOWNLOAD,</span>
<a href="#l8.21"></a><span id="l8.21">                             createURI(&quot;http://example.com/httpd.js&quot;),</span>
<a href="#l8.22"></a><span id="l8.22">                             createURI(destFile), null, null,</span>
<a href="#l8.23"></a><span id="l8.23">                             Math.round(Date.now() * 1000), null, persist, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_delete_key_removes.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_delete_key_removes.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -52,19 +52,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l9.5"></a><span id="l9.5">           src=&quot;chrome://mochikit/content/tests/SimpleTest/SimpleTest.js&quot;/&gt;</span>
<a href="#l9.6"></a><span id="l9.6">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l9.7"></a><span id="l9.7">           src=&quot;chrome://mochikit/content/tests/SimpleTest/EventUtils.js&quot;/&gt;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">   &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10">   &lt;![CDATA[</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-var dmFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+var dmFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l9.16"></a><span id="l9.16"> dmFile.append(&quot;dm-ui-test.file&quot;);</span>
<a href="#l9.17"></a><span id="l9.17"> dmFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l9.18"></a><span id="l9.18"> var gTestPath = Services.io.newFileURI(dmFile).spec;</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> // Downloads are sorted by endTime, so make sure the end times are distinct</span>
<a href="#l9.21"></a><span id="l9.21"> const DownloadData = [</span>
<a href="#l9.22"></a><span id="l9.22">   { name: &quot;381603.patch&quot;,</span>
<a href="#l9.23"></a><span id="l9.23">     source: &quot;https://bugzilla.mozilla.org/attachment.cgi?id=266520&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_drag.xul</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_drag.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -66,22 +66,18 @@ close window</span>
<a href="#l10.4"></a><span id="l10.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l10.5"></a><span id="l10.5">           src=&quot;chrome://mochikit/content/tests/SimpleTest/ChromeUtils.js&quot;&gt;&lt;/script&gt;</span>
<a href="#l10.6"></a><span id="l10.6">   &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l10.7"></a><span id="l10.7">   &lt;![CDATA[</span>
<a href="#l10.8"></a><span id="l10.8"> var missingFileElid;</span>
<a href="#l10.9"></a><span id="l10.9"> var realFileElid;</span>
<a href="#l10.10"></a><span id="l10.10"> const kFiller = &quot;notApplicable&quot;;</span>
<a href="#l10.11"></a><span id="l10.11"> const kFillerURL = &quot;https://bugzilla.mozilla.org/show_bug.cgi?id=462172&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var realFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                 .getService(Ci.nsIProperties)</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                 .get(&quot;CurWorkD&quot;, Ci.nsIFile);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-var missingFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-                    .getService(Ci.nsIProperties)</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-                    .get(&quot;CurWorkD&quot;, Ci.nsIFile);</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+var realFile = Services.dirsvc.get(&quot;CurWorkD&quot;, Ci.nsIFile);</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+var missingFile = Services.dirsvc.get(&quot;CurWorkD&quot;, Ci.nsIFile);</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> realFile.append(kFiller);</span>
<a href="#l10.22"></a><span id="l10.22"> realFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l10.23"></a><span id="l10.23"> var realFilePath = Services.io.newFileURI(realFile).spec;</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25"> missingFile.append(kFiller);</span>
<a href="#l10.26"></a><span id="l10.26"> missingFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l10.27"></a><span id="l10.27"> var missingFilePath = Services.io.newFileURI(missingFile).spec;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_enter_dblclick_opens.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -150,19 +150,17 @@ function test()</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">     const nsIWBP = Ci.nsIWebBrowserPersist;</span>
<a href="#l11.6"></a><span id="l11.6">     var persist = Cc[&quot;@mozilla.org/embedding/browser/nsWebBrowserPersist;1&quot;]</span>
<a href="#l11.7"></a><span id="l11.7">                     .createInstance(nsIWBP);</span>
<a href="#l11.8"></a><span id="l11.8">     persist.persistFlags = nsIWBP.PERSIST_FLAGS_REPLACE_EXISTING_FILES |</span>
<a href="#l11.9"></a><span id="l11.9">                            nsIWBP.PERSIST_FLAGS_BYPASS_CACHE |</span>
<a href="#l11.10"></a><span id="l11.10">                            nsIWBP.PERSIST_FLAGS_AUTODETECT_APPLY_CONVERSION;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                   .getService(Ci.nsIProperties);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-    var destFile = dirSvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    var destFile = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l11.16"></a><span id="l11.16">     destFile.append(&quot;download.result&quot;);</span>
<a href="#l11.17"></a><span id="l11.17">     if (destFile.exists())</span>
<a href="#l11.18"></a><span id="l11.18">       destFile.remove(false);</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">     var dl = dm.addDownload(Ci.nsIDownloadManager.DOWNLOAD_TYPE_DOWNLOAD,</span>
<a href="#l11.21"></a><span id="l11.21">                             createURI(&quot;http://example.com/httpd.js&quot;),</span>
<a href="#l11.22"></a><span id="l11.22">                             createURI(destFile), null, null,</span>
<a href="#l11.23"></a><span id="l11.23">                             Math.round(Date.now() * 1000), null, persist, false);</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -179,19 +177,17 @@ function test()</span>
<a href="#l11.25"></a><span id="l11.25">   db.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">   var stmt = db.createStatement(</span>
<a href="#l11.28"></a><span id="l11.28">     &quot;INSERT INTO moz_downloads (source, state, target, referrer) &quot; +</span>
<a href="#l11.29"></a><span id="l11.29">     &quot;VALUES (?1, ?2, ?3, ?4)&quot;);</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31">   // add first download: PAUSED state</span>
<a href="#l11.32"></a><span id="l11.32">   try {</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-    var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-                 .getService(Ci.nsIProperties)</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-                 .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+    var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l11.37"></a><span id="l11.37">     file.append(&quot;dltest-paused&quot;);</span>
<a href="#l11.38"></a><span id="l11.38">     var fileSpec = Services.io.newFileURI(file).spec;</span>
<a href="#l11.39"></a><span id="l11.39">     stmt.bindByIndex(0, &quot;http://example.com/file&quot;);</span>
<a href="#l11.40"></a><span id="l11.40">     stmt.bindByIndex(1, dm.DOWNLOAD_PAUSED);</span>
<a href="#l11.41"></a><span id="l11.41">     stmt.bindByIndex(2, fileSpec);</span>
<a href="#l11.42"></a><span id="l11.42">     stmt.bindByIndex(3, &quot;http://referrer/&quot;);</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">     // Add it!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_multi_select.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_multi_select.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -32,19 +32,17 @@ function test()</span>
<a href="#l12.4"></a><span id="l12.4">   db.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   var stmt = db.createStatement(</span>
<a href="#l12.7"></a><span id="l12.7">     &quot;INSERT INTO moz_downloads (source, state, target, referrer) &quot; +</span>
<a href="#l12.8"></a><span id="l12.8">     &quot;VALUES (?1, ?2, ?3, ?4)&quot;);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">   try {</span>
<a href="#l12.11"></a><span id="l12.11">     for (let site of [&quot;ed.agadak.net&quot;, &quot;mozilla.org&quot;, &quot;mozilla.com&quot;, &quot;mozilla.net&quot;]) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      let file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                  .getService(Ci.nsIProperties)</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-                  .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+      let file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l12.16"></a><span id="l12.16">       file.append(site);</span>
<a href="#l12.17"></a><span id="l12.17">       let fileSpec = Services.io.newFileURI(file).spec;</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">       stmt.bindByIndex(0, &quot;http://&quot; + site + &quot;/file&quot;);</span>
<a href="#l12.20"></a><span id="l12.20">       stmt.bindByIndex(1, dm.DOWNLOAD_FINISHED);</span>
<a href="#l12.21"></a><span id="l12.21">       stmt.bindByIndex(2, fileSpec);</span>
<a href="#l12.22"></a><span id="l12.22">       stmt.bindByIndex(3, &quot;http://referrer/&quot;);</span>
<a href="#l12.23"></a><span id="l12.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_multiword_search.xul</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_multiword_search.xul</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -60,19 +60,17 @@ function test()</span>
<a href="#l13.4"></a><span id="l13.4">   var dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l13.5"></a><span id="l13.5">              .getService(Ci.nsIDownloadManager);</span>
<a href="#l13.6"></a><span id="l13.6">   var db = dm.DBConnection;</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">   // Empty any old downloads</span>
<a href="#l13.9"></a><span id="l13.9">   db.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">   // Make a file name for the downloads</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l13.16"></a><span id="l13.16">   file.append(&quot;multiWord&quot;);</span>
<a href="#l13.17"></a><span id="l13.17">   var filePath = Services.io.newFileURI(file).spec;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">   var stmt = db.createStatement(</span>
<a href="#l13.20"></a><span id="l13.20">     &quot;INSERT INTO moz_downloads (name, target, source, state, endTime, maxBytes) &quot; +</span>
<a href="#l13.21"></a><span id="l13.21">     &quot;VALUES (?1, ?2, ?3, ?4, ?5, ?6)&quot;);</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">   try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_open_properties.xul</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_open_properties.xul</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -54,19 +54,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l14.5"></a><span id="l14.5">           src=&quot;chrome://mochikit/content/tests/SimpleTest/SimpleTest.js&quot;/&gt;</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">   &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">   &lt;![CDATA[</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> const nsIDownloadManager = Ci.nsIDownloadManager;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-var dmFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+var dmFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l14.16"></a><span id="l14.16"> dmFile.append(&quot;dm-ui-test.file&quot;);</span>
<a href="#l14.17"></a><span id="l14.17"> dmFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l14.18"></a><span id="l14.18"> var gTestPath = Services.io.newFileURI(dmFile).spec;</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20"> const DoneDownloadData = [</span>
<a href="#l14.21"></a><span id="l14.21">   { name: &quot;Dead&quot;,</span>
<a href="#l14.22"></a><span id="l14.22">     source: &quot;https://bugzilla.mozilla.org/attachment.cgi?id=266520&quot;,</span>
<a href="#l14.23"></a><span id="l14.23">     target: gTestPath,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_removeDownload_updates_ui.xul</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -49,19 +49,17 @@</span>
<a href="#l15.4"></a><span id="l15.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l15.5"></a><span id="l15.5">           src=&quot;chrome://mochikit/content/MochiKit/packed.js&quot;/&gt;</span>
<a href="#l15.6"></a><span id="l15.6">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l15.7"></a><span id="l15.7">           src=&quot;chrome://mochikit/content/tests/SimpleTest/SimpleTest.js&quot;/&gt;</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">   &lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l15.10"></a><span id="l15.10">   &lt;![CDATA[</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-var dmFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+var dmFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l15.16"></a><span id="l15.16"> dmFile.append(&quot;dm-ui-test.file&quot;);</span>
<a href="#l15.17"></a><span id="l15.17"> dmFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, 0666);</span>
<a href="#l15.18"></a><span id="l15.18"> var gTestPath = Services.io.newFileURI(dmFile).spec;</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20"> const DownloadData = [</span>
<a href="#l15.21"></a><span id="l15.21">   { name: &quot;381603.patch&quot;,</span>
<a href="#l15.22"></a><span id="l15.22">     source: &quot;https://bugzilla.mozilla.org/attachment.cgi?id=266520&quot;,</span>
<a href="#l15.23"></a><span id="l15.23">     target: gTestPath,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_search_clearlist.xul</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_search_clearlist.xul</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -59,19 +59,17 @@ function test()</span>
<a href="#l16.4"></a><span id="l16.4">   var dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l16.5"></a><span id="l16.5">              .getService(Ci.nsIDownloadManager);</span>
<a href="#l16.6"></a><span id="l16.6">   var db = dm.DBConnection;</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">   // Empty any old downloads</span>
<a href="#l16.9"></a><span id="l16.9">   db.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">   // Make a file name for the downloads</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l16.16"></a><span id="l16.16">   file.append(&quot;cleanUp&quot;);</span>
<a href="#l16.17"></a><span id="l16.17">   var filePath = Services.io.newFileURI(file).spec;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   var stmt = db.createStatement(</span>
<a href="#l16.20"></a><span id="l16.20">     &quot;INSERT INTO moz_downloads (target, source, state, endTime) &quot; +</span>
<a href="#l16.21"></a><span id="l16.21">     &quot;VALUES (?1, ?2, ?3, ?4)&quot;);</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23">   // Add a bunch of downloads that don't match the search</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_select_all.xul</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_select_all.xul</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -61,19 +61,17 @@ function test()</span>
<a href="#l17.4"></a><span id="l17.4">   var dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l17.5"></a><span id="l17.5">              .getService(Ci.nsIDownloadManager);</span>
<a href="#l17.6"></a><span id="l17.6">   var db = dm.DBConnection;</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">   // Empty any old downloads</span>
<a href="#l17.9"></a><span id="l17.9">   db.executeSimpleSQL(&quot;DELETE FROM moz_downloads&quot;);</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   // Make a file name for the downloads</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l17.16"></a><span id="l17.16">   file.append(&quot;selectAll&quot;);</span>
<a href="#l17.17"></a><span id="l17.17">   var filePath = Services.io.newFileURI(file).spec;</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19">   var stmt = db.createStatement(</span>
<a href="#l17.20"></a><span id="l17.20">     &quot;INSERT INTO moz_downloads (target, source, state) &quot; +</span>
<a href="#l17.21"></a><span id="l17.21">     &quot;VALUES (?1, ?2, ?3)&quot;);</span>
<a href="#l17.22"></a><span id="l17.22"> </span>
<a href="#l17.23"></a><span id="l17.23">   var sites = [&quot;mozilla.org&quot;, &quot;mozilla.com&quot;, &quot;select.all&quot;];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_space_key_pauses_resumes.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -150,19 +150,17 @@ function test()</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">     const nsIWBP = Ci.nsIWebBrowserPersist;</span>
<a href="#l18.6"></a><span id="l18.6">     var persist = Cc[&quot;@mozilla.org/embedding/browser/nsWebBrowserPersist;1&quot;]</span>
<a href="#l18.7"></a><span id="l18.7">                     .createInstance(nsIWBP);</span>
<a href="#l18.8"></a><span id="l18.8">     persist.persistFlags = nsIWBP.PERSIST_FLAGS_REPLACE_EXISTING_FILES |</span>
<a href="#l18.9"></a><span id="l18.9">                            nsIWBP.PERSIST_FLAGS_BYPASS_CACHE |</span>
<a href="#l18.10"></a><span id="l18.10">                            nsIWBP.PERSIST_FLAGS_AUTODETECT_APPLY_CONVERSION;</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                   .getService(Ci.nsIProperties);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-    var destFile = dirSvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+    var destFile = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l18.16"></a><span id="l18.16">     destFile.append(&quot;download.result&quot;);</span>
<a href="#l18.17"></a><span id="l18.17">     if (destFile.exists())</span>
<a href="#l18.18"></a><span id="l18.18">       destFile.remove(false);</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20">     // SeaMonkey: Use a bigger file than &quot;http://example.com/httpd.js&quot;. (Bug 595685)</span>
<a href="#l18.21"></a><span id="l18.21">     var dl = dm.addDownload(Ci.nsIDownloadManager.DOWNLOAD_TYPE_DOWNLOAD,</span>
<a href="#l18.22"></a><span id="l18.22">                             createURI(&quot;http://example.com/tests/fonts/mplus/mplus-1p-regular.ttf&quot;),</span>
<a href="#l18.23"></a><span id="l18.23">                             createURI(destFile), null, null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/components/downloads/tests/chrome/test_space_key_retries.xul</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/components/downloads/tests/chrome/test_space_key_retries.xul</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -128,19 +128,17 @@ function test()</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">     const nsIWBP = Ci.nsIWebBrowserPersist;</span>
<a href="#l19.6"></a><span id="l19.6">     var persist = Cc[&quot;@mozilla.org/embedding/browser/nsWebBrowserPersist;1&quot;]</span>
<a href="#l19.7"></a><span id="l19.7">                     .createInstance(nsIWBP);</span>
<a href="#l19.8"></a><span id="l19.8">     persist.persistFlags = nsIWBP.PERSIST_FLAGS_REPLACE_EXISTING_FILES |</span>
<a href="#l19.9"></a><span id="l19.9">                            nsIWBP.PERSIST_FLAGS_BYPASS_CACHE |</span>
<a href="#l19.10"></a><span id="l19.10">                            nsIWBP.PERSIST_FLAGS_AUTODETECT_APPLY_CONVERSION;</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                   .getService(Ci.nsIProperties);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-    var destFile = dirSvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+    var destFile = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l19.16"></a><span id="l19.16">     destFile.append(&quot;download.result&quot;);</span>
<a href="#l19.17"></a><span id="l19.17">     if (destFile.exists())</span>
<a href="#l19.18"></a><span id="l19.18">       destFile.remove(false);</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">     var dl = dm.addDownload(Ci.nsIDownloadManager.DOWNLOAD_TYPE_DOWNLOAD,</span>
<a href="#l19.21"></a><span id="l19.21">                             createURI(&quot;http://example.com/httpd.js&quot;),</span>
<a href="#l19.22"></a><span id="l19.22">                             createURI(destFile), null, null,</span>
<a href="#l19.23"></a><span id="l19.23">                             Math.round(Date.now() * 1000), null, persist, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/components/profile/content/profileSelection.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/components/profile/content/profileSelection.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -87,20 +87,18 @@ function AcceptDialog()</span>
<a href="#l20.4"></a><span id="l20.4">     gProfileService.startWithLastProfile = autoSelect.checked;</span>
<a href="#l20.5"></a><span id="l20.5">     gProfileService.flush();</span>
<a href="#l20.6"></a><span id="l20.6">   }</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">   var profileTree = document.getElementById(&quot;profiles&quot;);</span>
<a href="#l20.9"></a><span id="l20.9">   var selected = profileTree.view.getItemAtIndex(profileTree.currentIndex);</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   if (!gDialogParams.objects) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    var dirServ = Cc['@mozilla.org/file/directory_service;1']</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                    .getService(Ci.nsIProperties);</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-    var profD = dirServ.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-    var profLD = dirServ.get(&quot;ProfLD&quot;, Ci.nsIFile);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+    var profD = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+    var profLD = Services.dirsvc.get(&quot;ProfLD&quot;, Ci.nsIFile);</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19">     if (selected.profile.rootDir.equals(profD) &amp;&amp;</span>
<a href="#l20.20"></a><span id="l20.20">         selected.profile.localDir.equals(profLD))</span>
<a href="#l20.21"></a><span id="l20.21">       return true;</span>
<a href="#l20.22"></a><span id="l20.22">   }</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">   try {</span>
<a href="#l20.25"></a><span id="l20.25">     var profileLock = selected.profile.lock({});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/components/tests/browser/browser_346337.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/components/tests/browser/browser_346337.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,23 +1,19 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.5"></a><span id="l21.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.6"></a><span id="l21.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> function test() {</span>
<a href="#l21.9"></a><span id="l21.9">   /** Test for Bug 346337 **/</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-               .getService(Ci.nsIProperties)</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-               .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l21.15"></a><span id="l21.15">   file.append(&quot;346337_test1.file&quot;);</span>
<a href="#l21.16"></a><span id="l21.16">   let filePath1 = file.path;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-  file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">-             .getService(Ci.nsIProperties)</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-             .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+  file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l21.21"></a><span id="l21.21">   file.append(&quot;346337_test2.file&quot;);</span>
<a href="#l21.22"></a><span id="l21.22">   let filePath2 = file.path;</span>
<a href="#l21.23"></a><span id="l21.23"> </span>
<a href="#l21.24"></a><span id="l21.24">   let fieldList = {</span>
<a href="#l21.25"></a><span id="l21.25">     &quot;//input[@name='input']&quot;:     Date.now().toString(),</span>
<a href="#l21.26"></a><span id="l21.26">     &quot;//input[@name='spaced 1']&quot;:  Math.random().toString(),</span>
<a href="#l21.27"></a><span id="l21.27">     &quot;//input[3]&quot;:                 &quot;three&quot;,</span>
<a href="#l21.28"></a><span id="l21.28">     &quot;//input[@type='checkbox']&quot;:  true,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/components/tests/browser/browser_466937.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/components/tests/browser/browser_466937.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -2,19 +2,17 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.5"></a><span id="l22.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> function test() {</span>
<a href="#l22.8"></a><span id="l22.8">   /** Test for Bug 466937 **/</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">   waitForExplicitFinish();</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-             .getService(Ci.nsIProperties)</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-             .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+  var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l22.16"></a><span id="l22.16">   file.append(&quot;466937_test.file&quot;);</span>
<a href="#l22.17"></a><span id="l22.17">   let testPath = file.path;</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l22.20"></a><span id="l22.20">     &quot;suite/common/tests/browser/browser_466937_sample.html&quot;;</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l22.23"></a><span id="l22.23">   let window = tab.ownerDocument.defaultView;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/modules/Sanitizer.jsm</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/modules/Sanitizer.jsm</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -206,32 +206,28 @@ var Sanitizer = {</span>
<a href="#l23.4"></a><span id="l23.4">     urlbar: {</span>
<a href="#l23.5"></a><span id="l23.5">       clear: function() {</span>
<a href="#l23.6"></a><span id="l23.6">         // Clear last URL of the Open Web Location dialog</span>
<a href="#l23.7"></a><span id="l23.7">         try {</span>
<a href="#l23.8"></a><span id="l23.8">           Services.prefs.clearUserPref(&quot;general.open_location.last_url&quot;);</span>
<a href="#l23.9"></a><span id="l23.9">         } catch(ex) {}</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">         // Clear URLbar history (see also pref-history.js)</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-                     .getService(Ci.nsIProperties)</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-                     .get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+        var file = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l23.16"></a><span id="l23.16">         file.append(&quot;urlbarhistory.sqlite&quot;);</span>
<a href="#l23.17"></a><span id="l23.17">         if (file.exists())</span>
<a href="#l23.18"></a><span id="l23.18">           file.remove(false);</span>
<a href="#l23.19"></a><span id="l23.19">       },</span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">       get canClear() {</span>
<a href="#l23.22"></a><span id="l23.22">         if (!Services.prefs.prefIsLocked(&quot;general.open_location.last_url&quot;) &amp;&amp;</span>
<a href="#l23.23"></a><span id="l23.23">             Services.prefs.prefHasUserValue(&quot;general.open_location.last_url&quot;))</span>
<a href="#l23.24"></a><span id="l23.24">           return true;</span>
<a href="#l23.25"></a><span id="l23.25"> </span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">-        var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-                     .getService(Ci.nsIProperties)</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">-                     .get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineplus">+        var file = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l23.30"></a><span id="l23.30">         file.append(&quot;urlbarhistory.sqlite&quot;);</span>
<a href="#l23.31"></a><span id="l23.31">         return file.exists();</span>
<a href="#l23.32"></a><span id="l23.32">       }</span>
<a href="#l23.33"></a><span id="l23.33">     },</span>
<a href="#l23.34"></a><span id="l23.34"> </span>
<a href="#l23.35"></a><span id="l23.35">     formdata: {</span>
<a href="#l23.36"></a><span id="l23.36">       clear: function() {</span>
<a href="#l23.37"></a><span id="l23.37">         // Clear undo history of all search and find bars.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -99,19 +99,17 @@ var sanTests = {</span>
<a href="#l24.4"></a><span id="l24.4">       Assert.equal(rv, !aShouldBeCleared);</span>
<a href="#l24.5"></a><span id="l24.5">     }</span>
<a href="#l24.6"></a><span id="l24.6">   },</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">   urlbar: {</span>
<a href="#l24.9"></a><span id="l24.9">     desc: &quot;Location bar history&quot;,</span>
<a href="#l24.10"></a><span id="l24.10">     setup: function() {</span>
<a href="#l24.11"></a><span id="l24.11">       // Create urlbarhistory file first otherwise tests will fail.</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-      var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-                   .getService(Ci.nsIProperties)</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-                   .get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+      var file = Services.dirsvc.get(&quot;ProfD&quot;, Ci.nsIFile);</span>
<a href="#l24.16"></a><span id="l24.16">       file.append(&quot;urlbarhistory.sqlite&quot;);</span>
<a href="#l24.17"></a><span id="l24.17">       if (!file.exists()) {</span>
<a href="#l24.18"></a><span id="l24.18">         var connection = Cc[&quot;@mozilla.org/storage/service;1&quot;]</span>
<a href="#l24.19"></a><span id="l24.19">                            .getService(Ci.mozIStorageService)</span>
<a href="#l24.20"></a><span id="l24.20">                            .openDatabase(file);</span>
<a href="#l24.21"></a><span id="l24.21">         connection.createTable(&quot;urlbarhistory&quot;, &quot;url TEXT&quot;);</span>
<a href="#l24.22"></a><span id="l24.22">         connection.executeSimpleSQL(</span>
<a href="#l24.23"></a><span id="l24.23">           &quot;INSERT INTO urlbarhistory (url) VALUES ('Sanitizer')&quot;);</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineat">@@ -197,19 +195,17 @@ var sanTests = {</span>
<a href="#l24.25"></a><span id="l24.25">       Assert.equal(exists, !aShouldBeCleared);</span>
<a href="#l24.26"></a><span id="l24.26">     }</span>
<a href="#l24.27"></a><span id="l24.27">   },</span>
<a href="#l24.28"></a><span id="l24.28"> </span>
<a href="#l24.29"></a><span id="l24.29">   downloads: {</span>
<a href="#l24.30"></a><span id="l24.30">     desc: &quot;Download&quot;,</span>
<a href="#l24.31"></a><span id="l24.31">     setup: function() {</span>
<a href="#l24.32"></a><span id="l24.32">       var uri = Services.io.newURI(&quot;http://sanitizer.test/&quot;);</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-      var file = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-                   .getService(Ci.nsIProperties)</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-                   .get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+      var file = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l24.37"></a><span id="l24.37">       file.append(&quot;sanitizer.file&quot;);</span>
<a href="#l24.38"></a><span id="l24.38">       file.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, parseInt(&quot;0666&quot;, 8));</span>
<a href="#l24.39"></a><span id="l24.39">       var dest = Services.io.newFileURI(file);</span>
<a href="#l24.40"></a><span id="l24.40"> </span>
<a href="#l24.41"></a><span id="l24.41">       this.dm = Cc[&quot;@mozilla.org/download-manager;1&quot;]</span>
<a href="#l24.42"></a><span id="l24.42">                   .getService(Ci.nsIDownloadManager);</span>
<a href="#l24.43"></a><span id="l24.43"> </span>
<a href="#l24.44"></a><span id="l24.44">       const nsIWBP = Ci.nsIWebBrowserPersist;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

