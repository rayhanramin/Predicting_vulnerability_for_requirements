<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18632:8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927" />
<meta property="og:url" content="/comm-central/rev/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927" />
<meta property="og:description" content="Replace nsBaseHashtable::EnumerateRead() calls in comm-central with iterators. r=rkent." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">shortlog</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">files</a> |
changeset |
<a href="/comm-central/raw-rev/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">raw</a>  | <a href="/comm-central/archive/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Replace nsBaseHashtable::EnumerateRead() calls in comm-central with iterators. r=rkent.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#105;&#99;&#104;&#111;&#108;&#97;&#115;&#32;&#78;&#101;&#116;&#104;&#101;&#114;&#99;&#111;&#116;&#101;&#32;&#60;&#110;&#110;&#101;&#116;&#104;&#101;&#114;&#99;&#111;&#116;&#101;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 22 Nov 2015 18:50:41 -0800</td></tr>

<tr>
 <td>changeset 18632</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927</a></td>
</tr>



<tr>
<td>parent 18631</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/faf62f115efece7154a7af6db6e89c8b6fa269ec">faf62f115efece7154a7af6db6e89c8b6fa269ec</a>
</td>
</tr>

<tr>
<td>child 18633</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/09d33aaa187b782d1a4324b349c782e31762b7b3">09d33aaa187b782d1a4324b349c782e31762b7b3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">11409</a></td></tr>
<tr><td>push user</td><td>kent@caspia.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 23 Nov 2015 21:44:43 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8c3a5eafd96c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&newProject=comm-central&newRevision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&newProject=comm-central&newRevision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&newProject=comm-central&newRevision=8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28rkent%29&revcount=50">rkent</a></td></tr>





</table></div>

<div class="page_body description">Replace nsBaseHashtable::EnumerateRead() calls in comm-central with iterators. r=rkent.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbBSDirectory.cpp">mailnews/addrbook/src/nsAbBSDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbBSDirectory.cpp">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbBSDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbBSDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbBSDirectory.cpp">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbBSDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.cpp">mailnews/base/src/nsMsgGroupView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.cpp">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.cpp">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.cpp">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.cpp">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.h">mailnews/base/src/nsMsgGroupView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.h">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.h">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.h">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.h">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgGroupView.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/util/nsMsgTxn.cpp">mailnews/base/util/nsMsgTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/util/nsMsgTxn.cpp">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/util/nsMsgTxn.cpp">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/util/nsMsgTxn.cpp">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/util/nsMsgTxn.cpp">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/base/util/nsMsgTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/8c3a5eafd96c23413e05c16fa83ff3c2fa4c1927/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbBSDirectory.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbBSDirectory.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -222,53 +222,43 @@ NS_IMETHODIMP nsAbBSDirectory::CreateDir</span>
<a href="#l1.4"></a><span id="l1.4">                              PABDirectory, EmptyCString(), &amp;server);</span>
<a href="#l1.5"></a><span id="l1.5">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">   rv = CreateDirectoriesFromFactory(aURI, server, true /* notify */);</span>
<a href="#l1.8"></a><span id="l1.8">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l1.9"></a><span id="l1.9"> 	return rv;</span>
<a href="#l1.10"></a><span id="l1.10"> }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-struct GetDirectories</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-{</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-  GetDirectories(DIR_Server* aServer) : mServer(aServer) { }</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-  nsCOMArray&lt;nsIAbDirectory&gt; directories;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-  DIR_Server* mServer;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-};</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-static PLDHashOperator</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-GetDirectories_getDirectory(nsISupports *aKey, DIR_Server* aData, void* aClosure)</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-{</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-  GetDirectories* getDirectories = (GetDirectories*)aClosure;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-  if (aData == getDirectories-&gt;mServer) {</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-    nsCOMPtr&lt;nsIAbDirectory&gt; abDir = do_QueryInterface(aKey);</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-    getDirectories-&gt;directories.AppendObject(abDir);</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-  }</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-}</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-</span>
<a href="#l1.33"></a><span id="l1.33"> NS_IMETHODIMP nsAbBSDirectory::DeleteDirectory(nsIAbDirectory *directory)</span>
<a href="#l1.34"></a><span id="l1.34"> {</span>
<a href="#l1.35"></a><span id="l1.35">   NS_ENSURE_ARG_POINTER(directory);</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37">   nsresult rv = EnsureInitialized();</span>
<a href="#l1.38"></a><span id="l1.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.39"></a><span id="l1.39"> </span>
<a href="#l1.40"></a><span id="l1.40">   DIR_Server *server = nullptr;</span>
<a href="#l1.41"></a><span id="l1.41">   mServers.Get(directory, &amp;server);</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43">   if (!server)</span>
<a href="#l1.44"></a><span id="l1.44">     return NS_ERROR_FAILURE;</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+  struct GetDirectories</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+  {</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+    GetDirectories(DIR_Server* aServer) : mServer(aServer) { }</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+    nsCOMArray&lt;nsIAbDirectory&gt; directories;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+    DIR_Server* mServer;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  };</span>
<a href="#l1.53"></a><span id="l1.53">   GetDirectories getDirectories(server);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-  mServers.EnumerateRead(GetDirectories_getDirectory,</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-                         (void*)&amp;getDirectories);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+  for (auto iter = mServers.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+    if (iter.UserData() == getDirectories.mServer) {</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+      nsCOMPtr&lt;nsIAbDirectory&gt; abDir = do_QueryInterface(iter.Key());</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+      getDirectories.directories.AppendObject(abDir);</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+    }</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+  }</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63">   DIR_DeleteServerFromList(server);</span>
<a href="#l1.64"></a><span id="l1.64"> </span>
<a href="#l1.65"></a><span id="l1.65">   nsCOMPtr&lt;nsIAbDirFactoryService&gt; dirFactoryService = </span>
<a href="#l1.66"></a><span id="l1.66">     do_GetService(NS_ABDIRFACTORYSERVICE_CONTRACTID,&amp;rv);</span>
<a href="#l1.67"></a><span id="l1.67">   NS_ENSURE_SUCCESS (rv, rv);</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69">   uint32_t count = getDirectories.directories.Count();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -227,28 +227,23 @@ nsAbSimpleProperty::GetName(nsAString&amp; a</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> NS_IMETHODIMP</span>
<a href="#l2.6"></a><span id="l2.6"> nsAbSimpleProperty::GetValue(nsIVariant* *aValue)</span>
<a href="#l2.7"></a><span id="l2.7"> {</span>
<a href="#l2.8"></a><span id="l2.8">     NS_IF_ADDREF(*aValue = mValue);</span>
<a href="#l2.9"></a><span id="l2.9">     return NS_OK;</span>
<a href="#l2.10"></a><span id="l2.10"> }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-static PLDHashOperator</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-PropertyHashToArrayFunc (const nsACString &amp;aKey, nsIVariant* aData, void *userArg)</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-{</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-  nsCOMArray&lt;nsIProperty&gt;* propertyArray = static_cast&lt;nsCOMArray&lt;nsIProperty&gt; *&gt;(userArg);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-  propertyArray-&gt;AppendObject(new nsAbSimpleProperty(aKey, aData));</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-}</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-</span>
<a href="#l2.20"></a><span id="l2.20"> NS_IMETHODIMP nsAbCardProperty::GetProperties(nsISimpleEnumerator **props)</span>
<a href="#l2.21"></a><span id="l2.21"> {</span>
<a href="#l2.22"></a><span id="l2.22">   nsCOMArray&lt;nsIProperty&gt; propertyArray(m_properties.Count());</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-  m_properties.EnumerateRead(PropertyHashToArrayFunc, &amp;propertyArray);</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+  for (auto iter = m_properties.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+    propertyArray.AppendObject(new nsAbSimpleProperty(iter.Key(),</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+                                                      iter.UserData()));</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+  }</span>
<a href="#l2.28"></a><span id="l2.28">   return NS_NewArrayEnumerator(props, propertyArray);</span>
<a href="#l2.29"></a><span id="l2.29"> }</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31"> NS_IMETHODIMP nsAbCardProperty::GetProperty(const nsACString &amp;name,</span>
<a href="#l2.32"></a><span id="l2.32">                                             nsIVariant *defaultValue,</span>
<a href="#l2.33"></a><span id="l2.33">                                             nsIVariant **value)</span>
<a href="#l2.34"></a><span id="l2.34"> {</span>
<a href="#l2.35"></a><span id="l2.35">   if (!m_properties.Get(name, value))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -466,35 +466,29 @@ NS_IMETHODIMP nsMsgGroupView::OpenWithHd</span>
<a href="#l3.4"></a><span id="l3.4"> // Or, we could get rid of the nsMsgThreadedDBView impl of this method.</span>
<a href="#l3.5"></a><span id="l3.5"> NS_IMETHODIMP nsMsgGroupView::GetViewType(nsMsgViewTypeValue *aViewType)</span>
<a href="#l3.6"></a><span id="l3.6"> {</span>
<a href="#l3.7"></a><span id="l3.7">     NS_ENSURE_ARG_POINTER(aViewType);</span>
<a href="#l3.8"></a><span id="l3.8">     *aViewType = nsMsgViewType::eShowAllThreads; </span>
<a href="#l3.9"></a><span id="l3.9">     return NS_OK;</span>
<a href="#l3.10"></a><span id="l3.10"> }</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-PLDHashOperator</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-nsMsgGroupView::GroupTableCloner(const nsAString &amp;aKey, nsIMsgThread* aGroupThread, void* aArg)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-{</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  nsMsgGroupView* view = static_cast&lt;nsMsgGroupView*&gt;(aArg);</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-  view-&gt;m_groupsTable.Put(aKey, aGroupThread);</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-}</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-</span>
<a href="#l3.21"></a><span id="l3.21"> NS_IMETHODIMP</span>
<a href="#l3.22"></a><span id="l3.22"> nsMsgGroupView::CopyDBView(nsMsgDBView *aNewMsgDBView, nsIMessenger *aMessengerInstance, </span>
<a href="#l3.23"></a><span id="l3.23">                                        nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater)</span>
<a href="#l3.24"></a><span id="l3.24"> {</span>
<a href="#l3.25"></a><span id="l3.25">   nsMsgDBView::CopyDBView(aNewMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l3.26"></a><span id="l3.26">   nsMsgGroupView* newMsgDBView = (nsMsgGroupView *) aNewMsgDBView;</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">   // If grouped, we need to clone the group thread hash table.</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-  if (m_viewFlags &amp; nsMsgViewFlagsType::kGroupBySort)</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-    m_groupsTable.EnumerateRead(GroupTableCloner, newMsgDBView);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  if (m_viewFlags &amp; nsMsgViewFlagsType::kGroupBySort) {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    for (auto iter = m_groupsTable.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+      newMsgDBView-&gt;m_groupsTable.Put(iter.Key(), iter.UserData());</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    }</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+  }</span>
<a href="#l3.36"></a><span id="l3.36">   return NS_OK;</span>
<a href="#l3.37"></a><span id="l3.37"> }</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39"> // E.g., if the day has changed, we need to close and re-open the view.</span>
<a href="#l3.40"></a><span id="l3.40"> // Or, if we're switching between grouping and threading in a cross-folder</span>
<a href="#l3.41"></a><span id="l3.41"> // saved search. In that case, we needed to build an enumerator based on the</span>
<a href="#l3.42"></a><span id="l3.42"> // old view type, and internally close the view based on its old type, but</span>
<a href="#l3.43"></a><span id="l3.43"> // rebuild the new view based on the new view type. So we pass the new</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -54,19 +54,16 @@ protected:</span>
<a href="#l4.4"></a><span id="l4.4">                                   nsMsgViewIndex msgIndex = nsMsgViewIndex_None,</span>
<a href="#l4.5"></a><span id="l4.5">                                   int32_t *pThreadCount = NULL,</span>
<a href="#l4.6"></a><span id="l4.6">                                   uint32_t *pFlags = NULL) override;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   // Returns true if we are grouped by a sort attribute that uses a dummy row.</span>
<a href="#l4.9"></a><span id="l4.9">   bool GroupViewUsesDummyRow();</span>
<a href="#l4.10"></a><span id="l4.10">   nsresult RebuildView(nsMsgViewFlagsTypeValue viewFlags);</span>
<a href="#l4.11"></a><span id="l4.11">   virtual nsMsgGroupThread *CreateGroupThread(nsIMsgDatabase *db);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  PR_STATIC_CALLBACK(PLDHashOperator) GroupTableCloner(const nsAString &amp;aKey,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                                                       nsIMsgThread* aGroupThread,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                                                       void* aArg);</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">   nsInterfaceHashtable &lt;nsStringHashKey, nsIMsgThread&gt; m_groupsTable;</span>
<a href="#l4.17"></a><span id="l4.17">   PRExplodedTime m_lastCurExplodedTime;</span>
<a href="#l4.18"></a><span id="l4.18">   bool m_dayChanged;</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> private:</span>
<a href="#l4.21"></a><span id="l4.21">   nsString m_kTodayString;</span>
<a href="#l4.22"></a><span id="l4.22">   nsString m_kYesterdayString;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -70,33 +70,16 @@ NS_IMETHODIMP nsMsgSearchDBView::Open(ns</span>
<a href="#l5.4"></a><span id="l5.4">   m_sortValid = true;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">     if (pCount)</span>
<a href="#l5.7"></a><span id="l5.7">       *pCount = 0;</span>
<a href="#l5.8"></a><span id="l5.8">     m_folder = nullptr;</span>
<a href="#l5.9"></a><span id="l5.9">     return rv;</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-PLDHashOperator</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-nsMsgSearchDBView::ThreadTableCloner(const nsACString &amp;aKey, nsIMsgThread* aThread, void* aArg)</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-{</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  nsMsgSearchDBView* view = static_cast&lt;nsMsgSearchDBView*&gt;(aArg);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-  view-&gt;m_threadsTable.Put(aKey, aThread);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-}</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-PLDHashOperator</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-nsMsgSearchDBView::MsgHdrTableCloner(const nsACString &amp;aKey, nsIMsgDBHdr* aMsgHdr, void* aArg)</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-{</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-  nsMsgSearchDBView* view = static_cast&lt;nsMsgSearchDBView*&gt;(aArg);</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-  view-&gt;m_hdrsTable.Put(aKey, aMsgHdr);</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-}</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-</span>
<a href="#l5.29"></a><span id="l5.29"> NS_IMETHODIMP</span>
<a href="#l5.30"></a><span id="l5.30"> nsMsgSearchDBView::CloneDBView(nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater, nsIMsgDBView **_retval)</span>
<a href="#l5.31"></a><span id="l5.31"> {</span>
<a href="#l5.32"></a><span id="l5.32">   nsMsgSearchDBView* newMsgDBView = new nsMsgSearchDBView();</span>
<a href="#l5.33"></a><span id="l5.33"> </span>
<a href="#l5.34"></a><span id="l5.34">   if (!newMsgDBView)</span>
<a href="#l5.35"></a><span id="l5.35">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37" class="difflineat">@@ -129,18 +112,22 @@ nsMsgSearchDBView::CopyDBView(nsMsgDBVie</span>
<a href="#l5.38"></a><span id="l5.38">   {</span>
<a href="#l5.39"></a><span id="l5.39">     newMsgDBView-&gt;m_dbToUseList.AppendObject(m_dbToUseList[i]);</span>
<a href="#l5.40"></a><span id="l5.40">     // register the new view with the database so it gets notifications</span>
<a href="#l5.41"></a><span id="l5.41">     m_dbToUseList[i]-&gt;AddListener(newMsgDBView);</span>
<a href="#l5.42"></a><span id="l5.42">   }</span>
<a href="#l5.43"></a><span id="l5.43">   if (m_viewFlags &amp; nsMsgViewFlagsType::kThreadedDisplay)</span>
<a href="#l5.44"></a><span id="l5.44">   {</span>
<a href="#l5.45"></a><span id="l5.45">     // We need to clone the thread and msg hdr hash tables.</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-    m_threadsTable.EnumerateRead(ThreadTableCloner, newMsgDBView);</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-    m_hdrsTable.EnumerateRead(MsgHdrTableCloner, newMsgDBView);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+    for (auto iter = m_threadsTable.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+      newMsgDBView-&gt;m_threadsTable.Put(iter.Key(), iter.UserData());</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+    }</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+    for (auto iter = m_hdrsTable.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+      newMsgDBView-&gt;m_hdrsTable.Put(iter.Key(), iter.UserData());</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+    }</span>
<a href="#l5.54"></a><span id="l5.54">   }</span>
<a href="#l5.55"></a><span id="l5.55">   return NS_OK;</span>
<a href="#l5.56"></a><span id="l5.56"> }</span>
<a href="#l5.57"></a><span id="l5.57"> </span>
<a href="#l5.58"></a><span id="l5.58"> NS_IMETHODIMP nsMsgSearchDBView::Close()</span>
<a href="#l5.59"></a><span id="l5.59"> {</span>
<a href="#l5.60"></a><span id="l5.60">   int32_t count = m_dbToUseList.Count();</span>
<a href="#l5.61"></a><span id="l5.61">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/util/nsMsgTxn.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgTxn.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -105,32 +105,24 @@ NS_IMETHODIMP nsMailSimpleProperty::GetN</span>
<a href="#l6.4"></a><span id="l6.4"> NS_IMETHODIMP nsMailSimpleProperty::GetValue(nsIVariant* *aValue)</span>
<a href="#l6.5"></a><span id="l6.5"> {</span>
<a href="#l6.6"></a><span id="l6.6">   NS_IF_ADDREF(*aValue = mValue);</span>
<a href="#l6.7"></a><span id="l6.7">   return NS_OK;</span>
<a href="#l6.8"></a><span id="l6.8"> }</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> // end nsMailSimpleProperty</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-static PLDHashOperator</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-PropertyHashToArrayFunc (const nsAString &amp;aKey,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                         nsIVariant* aData,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                         void *userArg)</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-{</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-  nsCOMArray&lt;nsIProperty&gt; *propertyArray =</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-      static_cast&lt;nsCOMArray&lt;nsIProperty&gt; *&gt;(userArg);</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-  nsMailSimpleProperty *sprop = new nsMailSimpleProperty(aKey, aData);</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-  propertyArray-&gt;AppendObject(sprop);</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-}</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-</span>
<a href="#l6.24"></a><span id="l6.24"> NS_IMETHODIMP nsMsgTxn::GetEnumerator(nsISimpleEnumerator* *_retval)</span>
<a href="#l6.25"></a><span id="l6.25"> {</span>
<a href="#l6.26"></a><span id="l6.26">   nsCOMArray&lt;nsIProperty&gt; propertyArray;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-  mPropertyHash.EnumerateRead(PropertyHashToArrayFunc, &amp;propertyArray);</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  for (auto iter = mPropertyHash.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+    nsMailSimpleProperty *sprop = new nsMailSimpleProperty(iter.Key(),</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+                                                           iter.Data());</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+    propertyArray.AppendObject(sprop);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  }</span>
<a href="#l6.33"></a><span id="l6.33">   return NS_NewArrayEnumerator(_retval, propertyArray);</span>
<a href="#l6.34"></a><span id="l6.34"> }</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36"> #define IMPL_GETSETPROPERTY_AS(Name, Type) \</span>
<a href="#l6.37"></a><span id="l6.37"> NS_IMETHODIMP \</span>
<a href="#l6.38"></a><span id="l6.38"> nsMsgTxn::GetPropertyAs ## Name (const nsAString &amp; prop, Type *_retval) \</span>
<a href="#l6.39"></a><span id="l6.39"> { \</span>
<a href="#l6.40"></a><span id="l6.40">     nsIVariant* v = mPropertyHash.GetWeak(prop); \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -6329,24 +6329,16 @@ bool nsMsgIMAPFolderACL::SetFolderRights</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">   if (myUserName.Equals(ourUserName) || ourUserName.EqualsLiteral(IMAP_ACL_ANYONE_STRING))</span>
<a href="#l7.6"></a><span id="l7.6">     // if this is setting an ACL for me, cache it in the folder pref flags</span>
<a href="#l7.7"></a><span id="l7.7">     UpdateACLCache();</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   return true;</span>
<a href="#l7.10"></a><span id="l7.10"> }</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-static PLDHashOperator fillArrayWithKeys(const nsACString&amp; key,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-        const nsCString data, void* userArg)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-{</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  nsTArray&lt;nsCString&gt;* array = static_cast&lt;nsTArray&lt;nsCString&gt;*&gt;(userArg);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-  array-&gt;AppendElement(key);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  return PL_DHASH_NEXT;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-}</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-</span>
<a href="#l7.20"></a><span id="l7.20"> NS_IMETHODIMP nsImapMailFolder::GetOtherUsersWithAccess(</span>
<a href="#l7.21"></a><span id="l7.21">         nsIUTF8StringEnumerator** aResult)</span>
<a href="#l7.22"></a><span id="l7.22"> {</span>
<a href="#l7.23"></a><span id="l7.23">   return GetFolderACL()-&gt;GetOtherUsers(aResult);</span>
<a href="#l7.24"></a><span id="l7.24"> }</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26"> class AdoptUTF8StringEnumerator final : public nsIUTF8StringEnumerator</span>
<a href="#l7.27"></a><span id="l7.27"> {</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineat">@@ -6385,18 +6377,19 @@ AdoptUTF8StringEnumerator::GetNext(nsACS</span>
<a href="#l7.29"></a><span id="l7.29">   aResult.Assign((*mStrings)[mIndex]);</span>
<a href="#l7.30"></a><span id="l7.30">   ++mIndex;</span>
<a href="#l7.31"></a><span id="l7.31">   return NS_OK;</span>
<a href="#l7.32"></a><span id="l7.32"> }</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34"> nsresult nsMsgIMAPFolderACL::GetOtherUsers(nsIUTF8StringEnumerator** aResult)</span>
<a href="#l7.35"></a><span id="l7.35"> {</span>
<a href="#l7.36"></a><span id="l7.36">   nsTArray&lt;nsCString&gt;* resultArray = new nsTArray&lt;nsCString&gt;;</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-  // Note: make cast in fillArrayWithKeys() match</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-  m_rightsHash.EnumerateRead(fillArrayWithKeys, resultArray);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+  for (auto iter = m_rightsHash.Iter(); !iter.Done(); iter.Next()) {</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+    resultArray-&gt;AppendElement(iter.Key());</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+  }</span>
<a href="#l7.42"></a><span id="l7.42"> </span>
<a href="#l7.43"></a><span id="l7.43">   // enumerator will free resultArray</span>
<a href="#l7.44"></a><span id="l7.44">   *aResult = new AdoptUTF8StringEnumerator(resultArray);</span>
<a href="#l7.45"></a><span id="l7.45">   return NS_OK;</span>
<a href="#l7.46"></a><span id="l7.46"> }</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48"> nsresult nsImapMailFolder::GetPermissionsForUser(const nsACString&amp; otherUser,</span>
<a href="#l7.49"></a><span id="l7.49">         nsACString&amp; aResult)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

