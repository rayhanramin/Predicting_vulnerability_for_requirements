<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4872:7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e" />
<meta property="og:url" content="/comm-central/rev/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e" />
<meta property="og:description" content="fix bug 246415 and bug 244741, main body part of imap message not downloaded when view attachments inline is off, and folder not configured for offline use, and mime structure is complicated, r/sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">shortlog</a> |
<a href="/comm-central/log/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">files</a> |
changeset |
<a href="/comm-central/raw-rev/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">raw</a>  | <a href="/comm-central/archive/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=246415">bug 246415</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=244741">bug 244741</a>, main body part of imap message not downloaded when view attachments inline is off, and folder not configured for offline use, and mime structure is complicated, r/sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#32;&#76;&#97;&#99;&#121;&#32;&#60;&#112;&#104;&#105;&#108;&#98;&#97;&#115;&#101;&#108;&#101;&#115;&#115;&#45;&#102;&#105;&#114;&#101;&#102;&#111;&#120;&#64;&#121;&#97;&#104;&#111;&#111;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 10 Feb 2010 06:52:42 -0800</td></tr>

<tr>
 <td>changeset 4872</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e</a></td>
</tr>



<tr>
<td>parent 4871</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5551d73aeb0ec05fede386c2557f5355ab7010b3">5551d73aeb0ec05fede386c2557f5355ab7010b3</a>
</td>
</tr>

<tr>
<td>child 4873</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8b048e37dc5795af7a09fe44ebe3dad27a724eb7">8b048e37dc5795af7a09fe44ebe3dad27a724eb7</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">3803</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 10 Feb 2010 14:52:33 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@7e42eca3bfaf [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&newProject=comm-central&newRevision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&newProject=comm-central&newRevision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&newProject=comm-central&newRevision=7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=246415">246415</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=244741">244741</a></td></tr>




</table></div>

<div class="page_body description">fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=246415">bug 246415</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=244741">bug 244741</a>, main body part of imap message not downloaded when view attachments inline is off, and folder not configured for offline use, and mime structure is complicated, r/sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e/mailnews/imap/src/nsIMAPBodyShell.cpp">mailnews/imap/src/nsIMAPBodyShell.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e/mailnews/imap/src/nsIMAPBodyShell.cpp">file</a> |
<a href="/comm-central/annotate/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e/mailnews/imap/src/nsIMAPBodyShell.cpp">annotate</a> |
<a href="/comm-central/diff/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e/mailnews/imap/src/nsIMAPBodyShell.cpp">diff</a> |
<a href="/comm-central/comparison/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e/mailnews/imap/src/nsIMAPBodyShell.cpp">comparison</a> |
<a href="/comm-central/log/7e42eca3bfaf0bd97ade0a9df3c4d31d0b51ea3e/mailnews/imap/src/nsIMAPBodyShell.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -674,17 +674,18 @@ PRBool nsIMAPBodypartLeaf::ShouldFetchIn</span>
<a href="#l1.4"></a><span id="l1.4">       </span>
<a href="#l1.5"></a><span id="l1.5">       // The parent of this part is a multipart</span>
<a href="#l1.6"></a><span id="l1.6">       if (m_parentPart-&gt;GetType() == IMAP_BODY_MULTIPART)</span>
<a href="#l1.7"></a><span id="l1.7">       {</span>
<a href="#l1.8"></a><span id="l1.8">         // This is the first text part of a forwarded message</span>
<a href="#l1.9"></a><span id="l1.9">         // with a multipart body, and that message is being generated,</span>
<a href="#l1.10"></a><span id="l1.10">         // then generate this part.</span>
<a href="#l1.11"></a><span id="l1.11">         nsIMAPBodypart *grandParent = m_parentPart-&gt;GetParentPart();</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        NS_ASSERTION(grandParent, &quot;grandparent doesn't exist for multi-part alt&quot;);		// grandParent must exist, since multiparts need parents</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        // grandParent must exist, since multiparts need parents</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+        NS_ASSERTION(grandParent, &quot;grandparent doesn't exist for multi-part alt&quot;);</span>
<a href="#l1.15"></a><span id="l1.15">         if (grandParent &amp;&amp; </span>
<a href="#l1.16"></a><span id="l1.16">           (grandParent-&gt;GetType() == IMAP_BODY_MESSAGE_RFC822) &amp;&amp;</span>
<a href="#l1.17"></a><span id="l1.17">           (!PL_strcmp(grandParent-&gt;GetPartNumberString(), generatingPart)) &amp;&amp;</span>
<a href="#l1.18"></a><span id="l1.18">           (m_partNumberString[PL_strlen(m_partNumberString)-1] == '1') &amp;&amp;</span>
<a href="#l1.19"></a><span id="l1.19">           !PL_strcasecmp(m_bodyType, &quot;text&quot;))</span>
<a href="#l1.20"></a><span id="l1.20">           return PR_TRUE;	// we're downloading it inline</span>
<a href="#l1.21"></a><span id="l1.21">         </span>
<a href="#l1.22"></a><span id="l1.22">         </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

