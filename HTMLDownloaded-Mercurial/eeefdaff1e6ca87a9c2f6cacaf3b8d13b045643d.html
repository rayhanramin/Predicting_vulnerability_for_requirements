<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17731:eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d" />
<meta property="og:url" content="/comm-central/rev/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d" />
<meta property="og:description" content="Bug 1151474 - Part 2: Remove use of expression closure from im/contents/. r=florian" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">shortlog</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">files</a> |
changeset |
<a href="/comm-central/raw-rev/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">raw</a>  | <a href="/comm-central/archive/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1151474">Bug 1151474</a> - Part 2: Remove use of expression closure from im/contents/. r=florian
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#84;&#111;&#111;&#114;&#117;&#32;&#70;&#117;&#106;&#105;&#115;&#97;&#119;&#97;&#32;&#60;&#97;&#114;&#97;&#105;&#95;&#97;&#64;&#109;&#97;&#99;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 10 Apr 2015 00:14:22 +0900</td></tr>

<tr>
 <td>changeset 17731</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d</a></td>
</tr>



<tr>
<td>parent 17730</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6cb35f7f558e89c45977cb9e0d2adf08edaf47e8">6cb35f7f558e89c45977cb9e0d2adf08edaf47e8</a>
</td>
</tr>

<tr>
<td>child 17732</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/00a06f6524151eda384f97b68e899b89eded5e8e">00a06f6524151eda384f97b68e899b89eded5e8e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d">10923</a></td></tr>
<tr><td>push user</td><td>arai_a@mac.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 09 Apr 2015 15:29:32 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a0cba0d60fcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a0cba0d60fcd758e279fcf405c32497f6913ea8d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a0cba0d60fcd758e279fcf405c32497f6913ea8d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a0cba0d60fcd758e279fcf405c32497f6913ea8d&newProject=comm-central&newRevision=6cb35f7f558e89c45977cb9e0d2adf08edaf47e8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a0cba0d60fcd758e279fcf405c32497f6913ea8d&newProject=comm-central&newRevision=6cb35f7f558e89c45977cb9e0d2adf08edaf47e8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a0cba0d60fcd758e279fcf405c32497f6913ea8d&newProject=comm-central&newRevision=6cb35f7f558e89c45977cb9e0d2adf08edaf47e8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28florian%29&revcount=50">florian</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1151474">1151474</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1151474">Bug 1151474</a> - Part 2: Remove use of expression closure from im/contents/. r=florian</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/accountWizard.js">im/content/accountWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/accountWizard.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/accountWizard.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/accountWizard.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/accountWizard.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/accountWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/addbuddy.js">im/content/addbuddy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/addbuddy.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/addbuddy.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/addbuddy.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/addbuddy.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/addbuddy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/blist.js">im/content/blist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/blist.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/blist.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/blist.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/blist.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/blist.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/contact.xml">im/content/contact.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/contact.xml">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/contact.xml">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/contact.xml">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/contact.xml">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/contact.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/conversation.xml">im/content/conversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/conversation.xml">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/conversation.xml">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/conversation.xml">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/conversation.xml">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/conversation.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/debug.js">im/content/debug/debug.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/debug.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/debug.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/debug.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/debug.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/debug.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/fake/fake.js">im/content/debug/fake/fake.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/fake/fake.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/fake/fake.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/fake/fake.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/fake/fake.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/debug/fake/fake.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/group.xml">im/content/group.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/group.xml">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/group.xml">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/group.xml">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/group.xml">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/group.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/instantbird.js">im/content/instantbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/instantbird.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/instantbird.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/instantbird.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/instantbird.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/instantbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/macgestures.js">im/content/macgestures.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/macgestures.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/macgestures.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/macgestures.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/macgestures.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/macgestures.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/menus.js">im/content/menus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/menus.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/menus.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/menus.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/menus.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/menus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/nsContextMenu.js">im/content/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/applications.js">im/content/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/messagestyle.js">im/content/preferences/messagestyle.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/messagestyle.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/messagestyle.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/messagestyle.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/messagestyle.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/messagestyle.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/themes.js">im/content/preferences/themes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/themes.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/themes.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/themes.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/themes.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/preferences/themes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/tabbrowser.xml">im/content/tabbrowser.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/tabbrowser.xml">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/tabbrowser.xml">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/tabbrowser.xml">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/tabbrowser.xml">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/tabbrowser.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/viewlog.js">im/content/viewlog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/viewlog.js">file</a> |
<a href="/comm-central/annotate/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/viewlog.js">annotate</a> |
<a href="/comm-central/diff/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/viewlog.js">diff</a> |
<a href="/comm-central/comparison/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/viewlog.js">comparison</a> |
<a href="/comm-central/log/eeefdaff1e6ca87a9c2f6cacaf3b8d13b045643d/im/content/viewlog.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/content/accountWizard.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/content/accountWizard.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -45,17 +45,17 @@ var accountWizard = {</span>
<a href="#l1.4"></a><span id="l1.4">   },</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   getUsername: function aw_getUsername() {</span>
<a href="#l1.7"></a><span id="l1.7">     // If the first username textbox is empty, make sure we return an empty</span>
<a href="#l1.8"></a><span id="l1.8">     // string so that it blocks the 'next' button of the wizard.</span>
<a href="#l1.9"></a><span id="l1.9">     if (!this.userNameBoxes[0].value)</span>
<a href="#l1.10"></a><span id="l1.10">       return &quot;&quot;;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    return this.userNameBoxes.reduce(function(prev, elt) prev + elt.value, &quot;&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    return this.userNameBoxes.reduce((prev, elt) =&gt; prev + elt.value, &quot;&quot;);</span>
<a href="#l1.14"></a><span id="l1.14">   },</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">   checkUsername: function aw_checkUsername() {</span>
<a href="#l1.17"></a><span id="l1.17">     let wizard = document.getElementById(&quot;accountWizard&quot;);</span>
<a href="#l1.18"></a><span id="l1.18">     let name = accountWizard.getUsername();</span>
<a href="#l1.19"></a><span id="l1.19">     let duplicateWarning = document.getElementById(&quot;duplicateAccount&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">     if (!name) {</span>
<a href="#l1.21"></a><span id="l1.21">       wizard.canAdvance = false;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -473,22 +473,25 @@ var accountWizard = {</span>
<a href="#l1.23"></a><span id="l1.23">     // has a special handling of the undefined value for this case.</span>
<a href="#l1.24"></a><span id="l1.24">     return undefined;</span>
<a href="#l1.25"></a><span id="l1.25">   },</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   getIter: function(aEnumerator) {</span>
<a href="#l1.28"></a><span id="l1.28">     while (aEnumerator.hasMoreElements())</span>
<a href="#l1.29"></a><span id="l1.29">       yield aEnumerator.getNext();</span>
<a href="#l1.30"></a><span id="l1.30">   },</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  getProtocols: function aw_getProtocols()</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    this.getIter(Services.core.getProtocols()),</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  getProtoOptions: function aw_getProtoOptions()</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-    this.getIter(this.proto.getOptions()),</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-  getProtoUserSplits: function aw_getProtoUserSplits()</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-    this.getIter(this.proto.getUsernameSplit()),</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+  getProtocols: function aw_getProtocols() {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+    return this.getIter(Services.core.getProtocols());</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+  },</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+  getProtoOptions: function aw_getProtoOptions() {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+    return this.getIter(this.proto.getOptions());</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+  },</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+  getProtoUserSplits: function aw_getProtoUserSplits() {</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+    return this.getIter(this.proto.getUsernameSplit());</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+  },</span>
<a href="#l1.46"></a><span id="l1.46"> </span>
<a href="#l1.47"></a><span id="l1.47">   onGroupboxKeypress: function aw_onGroupboxKeypress(aEvent) {</span>
<a href="#l1.48"></a><span id="l1.48">     let target = aEvent.target;</span>
<a href="#l1.49"></a><span id="l1.49">     let code = aEvent.charCode || aEvent.keyCode;</span>
<a href="#l1.50"></a><span id="l1.50">     if (code == KeyEvent.DOM_VK_SPACE ||</span>
<a href="#l1.51"></a><span id="l1.51">         (code == KeyEvent.DOM_VK_LEFT &amp;&amp; !target.hasAttribute(&quot;closed&quot;)) ||</span>
<a href="#l1.52"></a><span id="l1.52">         (code == KeyEvent.DOM_VK_RIGHT &amp;&amp; target.hasAttribute(&quot;closed&quot;)))</span>
<a href="#l1.53"></a><span id="l1.53">         this.toggleGroupbox(target.id);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineat">@@ -567,17 +570,17 @@ var accountWizard = {</span>
<a href="#l1.55"></a><span id="l1.55">     let protoList = document.getElementById(&quot;protolist&quot;);</span>
<a href="#l1.56"></a><span id="l1.56">     if (protoList.itemCount &gt; 0)</span>
<a href="#l1.57"></a><span id="l1.57">       return;</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59">     accountWizard.setGetMoreProtocols();</span>
<a href="#l1.60"></a><span id="l1.60">     let protos = [];</span>
<a href="#l1.61"></a><span id="l1.61">     for (let proto in accountWizard.getProtocols())</span>
<a href="#l1.62"></a><span id="l1.62">       protos.push(proto);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-    protos.sort(function(a, b) a.name &lt; b.name ? -1 : a.name &gt; b.name ? 1 : 0);</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+    protos.sort((a, b) =&gt; a.name &lt; b.name ? -1 : a.name &gt; b.name ? 1 : 0);</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66">     protos.forEach(function(proto) {</span>
<a href="#l1.67"></a><span id="l1.67">       let item = protoList.appendItem(proto.name, proto.id);</span>
<a href="#l1.68"></a><span id="l1.68">       item.setAttribute(&quot;image&quot;, proto.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l1.69"></a><span id="l1.69">       item.setAttribute(&quot;class&quot;, &quot;listitem-iconic&quot;);</span>
<a href="#l1.70"></a><span id="l1.70">     });</span>
<a href="#l1.71"></a><span id="l1.71"> </span>
<a href="#l1.72"></a><span id="l1.72">     protoList.selectedIndex = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/content/addbuddy.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/content/addbuddy.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -34,17 +34,17 @@ var addBuddy = {</span>
<a href="#l2.4"></a><span id="l2.4">     tagList.selectedIndex = 0;</span>
<a href="#l2.5"></a><span id="l2.5">   },</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">   oninput: function ab_oninput() {</span>
<a href="#l2.8"></a><span id="l2.8">     document.documentElement.getButton(&quot;accept&quot;).disabled =</span>
<a href="#l2.9"></a><span id="l2.9">       !addBuddy.getValue(&quot;name&quot;);</span>
<a href="#l2.10"></a><span id="l2.10">   },</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  getValue: function ab_getValue(aId) document.getElementById(aId).value,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  getValue: function ab_getValue(aId) { return document.getElementById(aId).value; },</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">   create: function ab_create() {</span>
<a href="#l2.16"></a><span id="l2.16">     var account = Services.accounts.getAccountById(this.getValue(&quot;accountlist&quot;));</span>
<a href="#l2.17"></a><span id="l2.17">     var name = this.getValue(&quot;name&quot;);</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">     var tag;</span>
<a href="#l2.20"></a><span id="l2.20">     var taglist = document.getElementById(&quot;taglist&quot;);</span>
<a href="#l2.21"></a><span id="l2.21">     var items = taglist.getElementsByAttribute(&quot;label&quot;, taglist.label);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/content/blist.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/content/blist.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -160,17 +160,17 @@ buddyListContextMenu.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">     this.target.delete();</span>
<a href="#l3.5"></a><span id="l3.5">   },</span>
<a href="#l3.6"></a><span id="l3.6">   addTag: function blcm_addTag(aTag) {</span>
<a href="#l3.7"></a><span id="l3.7">     // If the contact already has the tag, addTag will return early.</span>
<a href="#l3.8"></a><span id="l3.8">     this.tagMenu.target.contact.addTag(aTag);</span>
<a href="#l3.9"></a><span id="l3.9">   },</span>
<a href="#l3.10"></a><span id="l3.10">   toggleTag: function blcm_toggleTag(aTag) {</span>
<a href="#l3.11"></a><span id="l3.11">     let contact = this.tagMenu.target.contact;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    if (contact.getTags().some(function(t) t.id == aTag.id))</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    if (contact.getTags().some(t =&gt; t.id == aTag.id))</span>
<a href="#l3.14"></a><span id="l3.14">       contact.removeTag(aTag);</span>
<a href="#l3.15"></a><span id="l3.15">     else</span>
<a href="#l3.16"></a><span id="l3.16">       contact.addTag(aTag);</span>
<a href="#l3.17"></a><span id="l3.17">   },</span>
<a href="#l3.18"></a><span id="l3.18">   _getLogs: function blcm_getLogs() {</span>
<a href="#l3.19"></a><span id="l3.19">     if (this.onContact)</span>
<a href="#l3.20"></a><span id="l3.20">       return Services.logs.getLogsForContact(this.target.contact, true);</span>
<a href="#l3.21"></a><span id="l3.21">     if (this.onBuddy)</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -849,17 +849,17 @@ var buddyList = {</span>
<a href="#l3.23"></a><span id="l3.23">     buddyList.convBox._updateListConvCount = function() {</span>
<a href="#l3.24"></a><span id="l3.24">       let count = Object.keys(this.listedConvs).length;</span>
<a href="#l3.25"></a><span id="l3.25">       this.parentNode.setAttribute(&quot;listedConvCount&quot;, count);</span>
<a href="#l3.26"></a><span id="l3.26">     }.bind(buddyList.convBox);</span>
<a href="#l3.27"></a><span id="l3.27">     let convs = Services.conversations.getUIConversations();</span>
<a href="#l3.28"></a><span id="l3.28">     if (convs.length != 0) {</span>
<a href="#l3.29"></a><span id="l3.29">       if (!(&quot;Conversations&quot; in window))</span>
<a href="#l3.30"></a><span id="l3.30">         Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-      convs.sort(function(a, b)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+      convs.sort((a, b) =&gt;</span>
<a href="#l3.33"></a><span id="l3.33">         a.title.toLowerCase().localeCompare(b.title.toLowerCase()));</span>
<a href="#l3.34"></a><span id="l3.34">       for each (let conv in convs) {</span>
<a href="#l3.35"></a><span id="l3.35">         if (!Conversations.isUIConversationDisplayed(conv)) {</span>
<a href="#l3.36"></a><span id="l3.36">           let convElt = document.createElement(&quot;conv&quot;);</span>
<a href="#l3.37"></a><span id="l3.37">           buddyList.convBox.appendChild(convElt);</span>
<a href="#l3.38"></a><span id="l3.38">           convElt.build(conv);</span>
<a href="#l3.39"></a><span id="l3.39">         }</span>
<a href="#l3.40"></a><span id="l3.40">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/im/content/contact.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/im/content/contact.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -167,17 +167,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">              aTopic == &quot;contact-display-name-changed&quot; ||</span>
<a href="#l4.5"></a><span id="l4.5">              aTopic == &quot;contact-status-changed&quot;)</span>
<a href="#l4.6"></a><span id="l4.6">            this.update();</span>
<a href="#l4.7"></a><span id="l4.7">          else if (aTopic == &quot;contact-signed-on&quot;) {</span>
<a href="#l4.8"></a><span id="l4.8">            if (this.state == &quot;fading&quot;) {</span>
<a href="#l4.9"></a><span id="l4.9">              // If the contact is fading out because it's no longer in this group,</span>
<a href="#l4.10"></a><span id="l4.10">              // ignore the signed-on notification; otherwise cancel the animation.</span>
<a href="#l4.11"></a><span id="l4.11">              let groupId = this.group.tag.id;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-             if (this.contact.getTags().some(function(t) t.id == groupId))</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+             if (this.contact.getTags().some(t =&gt; t.id == groupId))</span>
<a href="#l4.14"></a><span id="l4.14">                this.state = &quot;visible&quot;;</span>
<a href="#l4.15"></a><span id="l4.15">            }</span>
<a href="#l4.16"></a><span id="l4.16">          }</span>
<a href="#l4.17"></a><span id="l4.17">          else if (aTopic == &quot;contact-removed&quot; ||</span>
<a href="#l4.18"></a><span id="l4.18">                   (aTopic == &quot;contact-moved-out&quot; &amp;&amp; aSubject.id == this.group.tag.id) ||</span>
<a href="#l4.19"></a><span id="l4.19">                   (aTopic == &quot;contact-signed-off&quot; &amp;&amp; !this.group.showOffline))</span>
<a href="#l4.20"></a><span id="l4.20">            this.removeNode();</span>
<a href="#l4.21"></a><span id="l4.21">          else if (aTopic == &quot;buddy-moved-out-of-contact&quot; &amp;&amp; this.hasAttribute(&quot;open&quot;) &amp;&amp;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -560,17 +560,17 @@</span>
<a href="#l4.23"></a><span id="l4.23">     &lt;implementation&gt;</span>
<a href="#l4.24"></a><span id="l4.24">      &lt;!-- Textual representation of the contact and its status (and grouped</span>
<a href="#l4.25"></a><span id="l4.25">           buddies if applicable) for accessibility tools --&gt;</span>
<a href="#l4.26"></a><span id="l4.26">      &lt;property name=&quot;label&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l4.27"></a><span id="l4.27">        &lt;getter&gt;</span>
<a href="#l4.28"></a><span id="l4.28">        &lt;![CDATA[</span>
<a href="#l4.29"></a><span id="l4.29">          let propertyName = &quot;contact.collapsed&quot;;</span>
<a href="#l4.30"></a><span id="l4.30">          let params = [this.contact.displayName, this.getAttribute(&quot;statusText&quot;)];</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-         let buddies = this.contact.getBuddies().map(function(b) b.displayName);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+         let buddies = this.contact.getBuddies().map(b =&gt; b.displayName);</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">          // Add the list of buddies only if there's more than one to avoid un-</span>
<a href="#l4.35"></a><span id="l4.35">          // necessary duplication of the same name.</span>
<a href="#l4.36"></a><span id="l4.36">          if (buddies.length &gt; 1) {</span>
<a href="#l4.37"></a><span id="l4.37">            propertyName = &quot;contact.expanded&quot;;</span>
<a href="#l4.38"></a><span id="l4.38">            params.push(buddies.join(this.bundle.GetStringFromName(&quot;contact.buddySeparator&quot;)));</span>
<a href="#l4.39"></a><span id="l4.39">          }</span>
<a href="#l4.40"></a><span id="l4.40">          return this.bundle.formatStringFromName(propertyName, params, params.length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/content/conversation.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/content/conversation.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -561,25 +561,25 @@</span>
<a href="#l5.4"></a><span id="l5.4">               //   &quot;nick1: &quot; -&gt; &quot;nick1&quot;</span>
<a href="#l5.5"></a><span id="l5.5">               let pos = inputBox.selectionStart;</span>
<a href="#l5.6"></a><span id="l5.6">               const suffix = &quot;: &quot;;</span>
<a href="#l5.7"></a><span id="l5.7">               if (pos &gt; suffix.length &amp;&amp;</span>
<a href="#l5.8"></a><span id="l5.8">                   text.substring(pos - suffix.length, pos) == suffix) {</span>
<a href="#l5.9"></a><span id="l5.9">                 let completions = [b for (b of this.buddies.keys())];</span>
<a href="#l5.10"></a><span id="l5.10">                 // Check if the preceding words are a sequence of nick completions.</span>
<a href="#l5.11"></a><span id="l5.11">                 let preceding = text.substring(0, pos - suffix.length).split(&quot;, &quot;);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                if (preceding.every(function(n) completions.indexOf(n) != -1)) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                if (preceding.every(n =&gt; completions.indexOf(n) != -1)) {</span>
<a href="#l5.14"></a><span id="l5.14">                   let s = preceding.pop();</span>
<a href="#l5.15"></a><span id="l5.15">                   if (preceding.length)</span>
<a href="#l5.16"></a><span id="l5.16">                     s = suffix + s;</span>
<a href="#l5.17"></a><span id="l5.17">                   inputBox.selectionStart -= s.length + suffix.length;</span>
<a href="#l5.18"></a><span id="l5.18">                   this.addString(s);</span>
<a href="#l5.19"></a><span id="l5.19">                   if (this._completions[0].slice(-suffix.length) == suffix) {</span>
<a href="#l5.20"></a><span id="l5.20">                     this._completions =</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-                      this._completions.map(function(c) c.slice(0, -suffix.length));</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+                      this._completions.map(c =&gt; c.slice(0, -suffix.length));</span>
<a href="#l5.23"></a><span id="l5.23">                   }</span>
<a href="#l5.24"></a><span id="l5.24">                   if (this._completions.length == 1 &amp;&amp;</span>
<a href="#l5.25"></a><span id="l5.25">                       inputBox.value == this._beforeTabComplete) {</span>
<a href="#l5.26"></a><span id="l5.26">                     // Nothing left to undo or to cycle through.</span>
<a href="#l5.27"></a><span id="l5.27">                     delete this._completions;</span>
<a href="#l5.28"></a><span id="l5.28">                   }</span>
<a href="#l5.29"></a><span id="l5.29">                   return;</span>
<a href="#l5.30"></a><span id="l5.30">                 }</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineat">@@ -662,29 +662,29 @@</span>
<a href="#l5.32"></a><span id="l5.32">               while (j &gt;= 0 &amp;&amp;</span>
<a href="#l5.33"></a><span id="l5.33">                      this.partedBuddies[partedNicks[j]].partTime &gt; cutoffTime)</span>
<a href="#l5.34"></a><span id="l5.34">                 --j;</span>
<a href="#l5.35"></a><span id="l5.35">               ++j; // Index of the first nick we want to keep.</span>
<a href="#l5.36"></a><span id="l5.36">               if (partedNicks.length &gt; j)</span>
<a href="#l5.37"></a><span id="l5.37">                 completions = completions.concat(partedNicks.slice(j));</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">               let outgoingNick = this._conv.nick;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-              completions = completions.filter(function(c) c != outgoingNick);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+              completions = completions.filter(c =&gt; c != outgoingNick);</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43">               // Check if the preceding words are a sequence of nick completions.</span>
<a href="#l5.44"></a><span id="l5.44">               let wordStart = inputBox.selectionStart - word.length;</span>
<a href="#l5.45"></a><span id="l5.45">               if (wordStart &gt; 2) {</span>
<a href="#l5.46"></a><span id="l5.46">                 let separator = text.substring(wordStart - 2, wordStart);</span>
<a href="#l5.47"></a><span id="l5.47">                 if (separator == &quot;: &quot; || separator == &quot;, &quot;) {</span>
<a href="#l5.48"></a><span id="l5.48">                   let preceding = text.substring(0, wordStart - 2).split(&quot;, &quot;);</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-                  if (preceding.every(function(n) completions.indexOf(n) != -1)) {</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+                  if (preceding.every(n =&gt; completions.indexOf(n) != -1)) {</span>
<a href="#l5.51"></a><span id="l5.51">                     secondNick = true;</span>
<a href="#l5.52"></a><span id="l5.52">                     isFirstWord = true;</span>
<a href="#l5.53"></a><span id="l5.53">                     // Remove preceding completions from possible completions.</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-                    completions = completions.filter(function(c)</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+                    completions = completions.filter(c =&gt;</span>
<a href="#l5.56"></a><span id="l5.56">                       preceding.indexOf(c) == -1);</span>
<a href="#l5.57"></a><span id="l5.57">                   }</span>
<a href="#l5.58"></a><span id="l5.58">                 }</span>
<a href="#l5.59"></a><span id="l5.59">               }</span>
<a href="#l5.60"></a><span id="l5.60">             }</span>
<a href="#l5.61"></a><span id="l5.61"> </span>
<a href="#l5.62"></a><span id="l5.62">             // Keep only the completions that share |word| as a prefix.</span>
<a href="#l5.63"></a><span id="l5.63">             // Be case insensitive only if |word| is entirely lower case.</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineat">@@ -731,19 +731,19 @@</span>
<a href="#l5.65"></a><span id="l5.65">             // actually exposed to the user, as if there are active nicks</span>
<a href="#l5.66"></a><span id="l5.66">             // they will be moved to the beginning of the list.</span>
<a href="#l5.67"></a><span id="l5.67">             let firstCompletion = this._completions[0];</span>
<a href="#l5.68"></a><span id="l5.68">             let lastCompletion = this._completions.slice(-1)[0];</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70">             let preferredNick = false;</span>
<a href="#l5.71"></a><span id="l5.71">             if (this._conv.isChat &amp;&amp; !completingCommand) {</span>
<a href="#l5.72"></a><span id="l5.72">               // If there are active nicks, prefer those.</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-              let activeCompletions = this._completions.filter(function(c)</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+              let activeCompletions = this._completions.filter(c =&gt;</span>
<a href="#l5.75"></a><span id="l5.75">                 this.buddies.has(c) &amp;&amp;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-                !this.buddies.get(c).hasAttribute(&quot;inactive&quot;), this);</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+                !this.buddies.get(c).hasAttribute(&quot;inactive&quot;));</span>
<a href="#l5.78"></a><span id="l5.78">               if (activeCompletions.length == 1)</span>
<a href="#l5.79"></a><span id="l5.79">                 preferredNick = true;</span>
<a href="#l5.80"></a><span id="l5.80">               if (activeCompletions.length) {</span>
<a href="#l5.81"></a><span id="l5.81">                 // Move active nicks to the front of the queue.</span>
<a href="#l5.82"></a><span id="l5.82">                 activeCompletions.reverse();</span>
<a href="#l5.83"></a><span id="l5.83">                 activeCompletions.forEach(function(c) {</span>
<a href="#l5.84"></a><span id="l5.84">                   this._completions.splice(this._completions.indexOf(c), 1);</span>
<a href="#l5.85"></a><span id="l5.85">                   this._completions.unshift(c);</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineat">@@ -770,17 +770,17 @@</span>
<a href="#l5.87"></a><span id="l5.87">                 // completions on the next &lt;tab&gt; press.</span>
<a href="#l5.88"></a><span id="l5.88">                 this._shouldListCompletionsLater = completionsList;</span>
<a href="#l5.89"></a><span id="l5.89">               }</span>
<a href="#l5.90"></a><span id="l5.90">               else</span>
<a href="#l5.91"></a><span id="l5.91">                 this._conv.systemMessage(completionsList);</span>
<a href="#l5.92"></a><span id="l5.92">             }</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94">             let suffix = (isFirstWord ? firstWordSuffix : &quot;&quot;);</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-            this._completions = this._completions.map(function(c) c + suffix);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+            this._completions = this._completions.map(c =&gt; c + suffix);</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98">             let completion;</span>
<a href="#l5.99"></a><span id="l5.99">             if (this._completions.length == 1 || preferredNick) {</span>
<a href="#l5.100"></a><span id="l5.100">               // Only one possible completion? Apply it! :-)</span>
<a href="#l5.101"></a><span id="l5.101">               completion = this._completions[this._completionsIndex++];</span>
<a href="#l5.102"></a><span id="l5.102">               this._completionsIndex %= this._completions.length;</span>
<a href="#l5.103"></a><span id="l5.103">             }</span>
<a href="#l5.104"></a><span id="l5.104">             else {</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineat">@@ -1073,17 +1073,17 @@</span>
<a href="#l5.106"></a><span id="l5.106">               if (text.indexOf(msg.who) != -1)</span>
<a href="#l5.107"></a><span id="l5.107">                 return;</span>
<a href="#l5.108"></a><span id="l5.108">               let secondNick = false;</span>
<a href="#l5.109"></a><span id="l5.109">               let pos = text.indexOf(&quot;:&quot;);</span>
<a href="#l5.110"></a><span id="l5.110">               if (pos != -1) {</span>
<a href="#l5.111"></a><span id="l5.111">                 let completions = [b for (b of this.buddies.keys())];</span>
<a href="#l5.112"></a><span id="l5.112">                 // Check if the preceding words are a sequence of nicks.</span>
<a href="#l5.113"></a><span id="l5.113">                 let preceding = text.substring(0, pos).split(&quot;, &quot;);</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-                if (preceding.every(function(n) completions.indexOf(n) != -1))</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+                if (preceding.every(n =&gt; completions.indexOf(n) != -1))</span>
<a href="#l5.116"></a><span id="l5.116">                   secondNick = true;</span>
<a href="#l5.117"></a><span id="l5.117">               }</span>
<a href="#l5.118"></a><span id="l5.118">               this.addPrompt(msg.who + (secondNick ? &quot;, &quot; : &quot;: &quot;));</span>
<a href="#l5.119"></a><span id="l5.119">               if (this._completions)</span>
<a href="#l5.120"></a><span id="l5.120">                 delete this._completions;</span>
<a href="#l5.121"></a><span id="l5.121">               return;</span>
<a href="#l5.122"></a><span id="l5.122">             }</span>
<a href="#l5.123"></a><span id="l5.123">           }</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineat">@@ -1415,17 +1415,17 @@</span>
<a href="#l5.125"></a><span id="l5.125">                 // We use \W to match for word-boundaries, as \b will not match the</span>
<a href="#l5.126"></a><span id="l5.126">                 // nick if it starts/ends with \W characters.</span>
<a href="#l5.127"></a><span id="l5.127">                 // XXX Ideally we would use unicode word boundaries:</span>
<a href="#l5.128"></a><span id="l5.128">                 // http://www.unicode.org/reports/tr29/#Word_Boundaries</span>
<a href="#l5.129"></a><span id="l5.129">                 this._showNickRegExp = new RegExp(&quot;\\W(?:&quot; + nicks + &quot;)\\W&quot;);</span>
<a href="#l5.130"></a><span id="l5.130">               }</span>
<a href="#l5.131"></a><span id="l5.131">               else {</span>
<a href="#l5.132"></a><span id="l5.132">                 // nobody, disable...</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-                this._showNickRegExp = {exec: function() null};</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+                this._showNickRegExp = {exec: () =&gt; null};</span>
<a href="#l5.135"></a><span id="l5.135">                 return 0;</span>
<a href="#l5.136"></a><span id="l5.136">               }</span>
<a href="#l5.137"></a><span id="l5.137">             }</span>
<a href="#l5.138"></a><span id="l5.138">             let exp = this._showNickRegExp;</span>
<a href="#l5.139"></a><span id="l5.139">             let result = 0;</span>
<a href="#l5.140"></a><span id="l5.140">             let match;</span>
<a href="#l5.141"></a><span id="l5.141">             // Add leading/trailing spaces to match at beginning and end of</span>
<a href="#l5.142"></a><span id="l5.142">             // the string as well. (If we used regex ^ and $, match.index would</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineat">@@ -1583,17 +1583,17 @@</span>
<a href="#l5.144"></a><span id="l5.144">               menu.actionOnShowing = function() {</span>
<a href="#l5.145"></a><span id="l5.145">                 Components.utils.import(&quot;resource:///modules/ibTagMenu.jsm&quot;);</span>
<a href="#l5.146"></a><span id="l5.146">                 menu.tagMenu =</span>
<a href="#l5.147"></a><span id="l5.147">                   new TagMenu(menu, window, id, addContact, addContact);</span>
<a href="#l5.148"></a><span id="l5.148">               };</span>
<a href="#l5.149"></a><span id="l5.149">               items.push(menu);</span>
<a href="#l5.150"></a><span id="l5.150">             }</span>
<a href="#l5.151"></a><span id="l5.151"> </span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-            let showLogsItem = createMenuItem(&quot;contextShowLogs&quot;, function() conv.showLogs());</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+            let showLogsItem = createMenuItem(&quot;contextShowLogs&quot;, () =&gt; conv.showLogs());</span>
<a href="#l5.154"></a><span id="l5.154">             // Start disabled, then enable if we have logs.</span>
<a href="#l5.155"></a><span id="l5.155">             showLogsItem.setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l5.156"></a><span id="l5.156">             this.hasLogs().then(aHasLogs =&gt; showLogsItem.setAttribute(&quot;disabled&quot;, !aHasLogs));</span>
<a href="#l5.157"></a><span id="l5.157">             items.push(showLogsItem);</span>
<a href="#l5.158"></a><span id="l5.158"> </span>
<a href="#l5.159"></a><span id="l5.159">             let hideConvItem = createMenuItem(&quot;contextHideConv&quot;, function() {</span>
<a href="#l5.160"></a><span id="l5.160">               conv.hide();</span>
<a href="#l5.161"></a><span id="l5.161">               document.getBindingParent(conv).removeTab(conv.tab);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineat">@@ -1809,18 +1809,18 @@</span>
<a href="#l5.163"></a><span id="l5.163">             this._nicks = [];</span>
<a href="#l5.164"></a><span id="l5.164">             this.nicklistElt = this.getElt(&quot;nicklist&quot;);</span>
<a href="#l5.165"></a><span id="l5.165">             let enumerator = this.conv.getParticipants();</span>
<a href="#l5.166"></a><span id="l5.166">             let chatBuddies = [];</span>
<a href="#l5.167"></a><span id="l5.167">             while (enumerator.hasMoreElements()) {</span>
<a href="#l5.168"></a><span id="l5.168">               let buddy = enumerator.getNext();</span>
<a href="#l5.169"></a><span id="l5.169">               chatBuddies.push({name: buddy.name.toLowerCase(), buddy: buddy});</span>
<a href="#l5.170"></a><span id="l5.170">             }</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-            chatBuddies.sort(function(a, b) a.name &lt; b.name ? -1 : 1)</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-                       .forEach(function(a) this.addBuddy(a.buddy, true), this);</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+            chatBuddies.sort((a, b) =&gt; a.name &lt; b.name ? -1 : 1)</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+                       .forEach(a =&gt; this.addBuddy(a.buddy, true));</span>
<a href="#l5.175"></a><span id="l5.175">             this.updateParticipantCount();</span>
<a href="#l5.176"></a><span id="l5.176">             if (Services.prefs.getBoolPref(&quot;messenger.conversations.showNicks&quot;))</span>
<a href="#l5.177"></a><span id="l5.177">               this.browser.addTextModifier(this.getShowNickModifier());</span>
<a href="#l5.178"></a><span id="l5.178">           }</span>
<a href="#l5.179"></a><span id="l5.179">           else if (this._conv.contact &amp;&amp; this._conv.contact.getBuddies().length &gt; 1)</span>
<a href="#l5.180"></a><span id="l5.180">             this.getElt(&quot;conv-top-info&quot;).allowTargetChange();</span>
<a href="#l5.181"></a><span id="l5.181"> </span>
<a href="#l5.182"></a><span id="l5.182">           if (this.tab) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/content/debug/debug.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/content/debug/debug.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -69,18 +69,18 @@ function debug_connectAccount(aProto, aN</span>
<a href="#l6.4"></a><span id="l6.4">   acc.password = aPassword;</span>
<a href="#l6.5"></a><span id="l6.5">   dump(&quot;trying to connect to &quot; + proto.name +</span>
<a href="#l6.6"></a><span id="l6.6">        &quot; (&quot; + proto.id + &quot;) with &quot; + aName + &quot;\n&quot;);</span>
<a href="#l6.7"></a><span id="l6.7">   acc.connect();</span>
<a href="#l6.8"></a><span id="l6.8"> }</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> function debug_dumpBuddyList()</span>
<a href="#l6.11"></a><span id="l6.11"> {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  let formatBuddy = (function(buddy) &quot;  &quot; + buddy.name + &quot;\n   &quot; + buddy.getAccounts().map(function(a) a.name).join(&quot; &quot;));</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  let formatGroup = (function(aGroup) &quot; Group &quot; + aGroup.id + &quot;: &quot; + aGroup.name + &quot;\n&quot; + aGroup.getBuddies().map(formatBuddy).join(&quot;\n&quot;));</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  let formatBuddy = (buddy =&gt; &quot;  &quot; + buddy.name + &quot;\n   &quot; + buddy.getAccounts().map(a =&gt; a.name).join(&quot; &quot;));</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  let formatGroup = (aGroup =&gt; &quot; Group &quot; + aGroup.id + &quot;: &quot; + aGroup.name + &quot;\n&quot; + aGroup.getBuddies().map(formatBuddy).join(&quot;\n&quot;));</span>
<a href="#l6.16"></a><span id="l6.16">   dump(&quot;Buddy list:\n\n&quot; + Services.tags.getTags().map(formatGroup).join(&quot;\n\n&quot;) + &quot;\n\n&quot;);</span>
<a href="#l6.17"></a><span id="l6.17"> }</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19"> function dumpStack(offset, max_depth)</span>
<a href="#l6.20"></a><span id="l6.20"> {</span>
<a href="#l6.21"></a><span id="l6.21">   if (!offset || offset&lt;0) offset = 0;</span>
<a href="#l6.22"></a><span id="l6.22">   if (!max_depth) max_depth = 10;</span>
<a href="#l6.23"></a><span id="l6.23">   var frame = Components.stack;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/im/content/debug/fake/fake.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/im/content/debug/fake/fake.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -219,17 +219,17 @@ var fake = {</span>
<a href="#l7.4"></a><span id="l7.4">                        .getMostRecentWindow(&quot;Messenger:accountWizard&quot;);</span>
<a href="#l7.5"></a><span id="l7.5">     if (win)</span>
<a href="#l7.6"></a><span id="l7.6">       win.close();</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">     this.groups = [</span>
<a href="#l7.9"></a><span id="l7.9">       &quot;Contacts&quot;,</span>
<a href="#l7.10"></a><span id="l7.10">       &quot;Friends&quot;,</span>
<a href="#l7.11"></a><span id="l7.11">       &quot;Colleagues&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    ].map(function(name) Services.tags.createTag(name));</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    ].map(name =&gt; Services.tags.createTag(name));</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">     this.buddies = [</span>
<a href="#l7.16"></a><span id="l7.16">       new AccountBuddy(&quot;Michael&quot;, this.accounts[2], this.groups[0], {_statusType: idle, _statusText: &quot;I'm currently away from the computer.&quot;}),</span>
<a href="#l7.17"></a><span id="l7.17">       new AccountBuddy(&quot;Ethan&quot;, this.accounts[2], this.groups[0]),</span>
<a href="#l7.18"></a><span id="l7.18">       new AccountBuddy(&quot;Daniel&quot;, this.accounts[1], this.groups[0]),</span>
<a href="#l7.19"></a><span id="l7.19">       new AccountBuddy(&quot;Emily&quot;, this.accounts[0], this.groups[1], {_statusType: away, _statusText: &quot;out for lunch&quot;}),</span>
<a href="#l7.20"></a><span id="l7.20">       new AccountBuddy(&quot;Christopher&quot;, this.accounts[0], this.groups[1]),</span>
<a href="#l7.21"></a><span id="l7.21">       new AccountBuddy(&quot;Anthony&quot;, this.accounts[0], this.groups[1], {_statusType: mobile}),</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -335,32 +335,32 @@ function Account(aName, aProto)</span>
<a href="#l7.23"></a><span id="l7.23">   this.protocol = Services.core.getProtocolById(aProto);</span>
<a href="#l7.24"></a><span id="l7.24">   this.id = &quot;account&quot; + (++gLastAccountId);</span>
<a href="#l7.25"></a><span id="l7.25">   this.numericId = gLastAccountId;</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   dump(&quot;account &quot; + aName + &quot; created\n&quot;);</span>
<a href="#l7.28"></a><span id="l7.28"> }</span>
<a href="#l7.29"></a><span id="l7.29"> Account.prototype = {</span>
<a href="#l7.30"></a><span id="l7.30">   __proto__: ClassInfo(&quot;imIAccount&quot;, &quot;generic account object&quot;),</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  get imAccount() this,</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  get imAccount() { return this; },</span>
<a href="#l7.33"></a><span id="l7.33">   protocol: null,</span>
<a href="#l7.34"></a><span id="l7.34">   password: &quot;&quot;,</span>
<a href="#l7.35"></a><span id="l7.35">   autoLogin: true,</span>
<a href="#l7.36"></a><span id="l7.36">   alias: &quot;&quot;,</span>
<a href="#l7.37"></a><span id="l7.37">   proxyInfo: null,</span>
<a href="#l7.38"></a><span id="l7.38">   connectionStageMsg: &quot;&quot;,</span>
<a href="#l7.39"></a><span id="l7.39">   connectionErrorReason: -1,</span>
<a href="#l7.40"></a><span id="l7.40">   timeOfNextReconnect: 0,</span>
<a href="#l7.41"></a><span id="l7.41">   timeOfLastConnect: new Date(),</span>
<a href="#l7.42"></a><span id="l7.42">   connectionErrorMessage: &quot;&quot;,</span>
<a href="#l7.43"></a><span id="l7.43">   disconnecting: false,</span>
<a href="#l7.44"></a><span id="l7.44">   disconnected: false,</span>
<a href="#l7.45"></a><span id="l7.45">   connected: true,</span>
<a href="#l7.46"></a><span id="l7.46">   connecting: false,</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-  normalize: function(aStr) aStr</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  normalize: aStr =&gt; aStr</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50">   //FIXME: PurpleConnectionFlags</span>
<a href="#l7.51"></a><span id="l7.51"> };</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53"> function AccountBuddy(aName, aAccount, aTag, aObject)</span>
<a href="#l7.54"></a><span id="l7.54"> {</span>
<a href="#l7.55"></a><span id="l7.55">   this._init(aAccount, null, aTag, aName);</span>
<a href="#l7.56"></a><span id="l7.56">   if (aObject)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/content/group.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/content/group.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -41,17 +41,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">      &lt;method name=&quot;build&quot;&gt;</span>
<a href="#l8.6"></a><span id="l8.6">       &lt;parameter name=&quot;aGroup&quot;/&gt;</span>
<a href="#l8.7"></a><span id="l8.7">       &lt;body&gt;</span>
<a href="#l8.8"></a><span id="l8.8">       &lt;![CDATA[</span>
<a href="#l8.9"></a><span id="l8.9">         this.tag = aGroup;</span>
<a href="#l8.10"></a><span id="l8.10">         let contacts = this.tag.getContacts();</span>
<a href="#l8.11"></a><span id="l8.11">         if (!this.showOffline)</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          contacts = contacts.filter((function (c) c.online), this);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+          contacts = contacts.filter(c =&gt; c.online);</span>
<a href="#l8.14"></a><span id="l8.14">         if (!contacts.length)</span>
<a href="#l8.15"></a><span id="l8.15">           return false;</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">         this.groupId = aGroup.id;</span>
<a href="#l8.18"></a><span id="l8.18">         this.contacts = [ ];</span>
<a href="#l8.19"></a><span id="l8.19">         this.contactsById = {};</span>
<a href="#l8.20"></a><span id="l8.20">         this.setAttribute(&quot;id&quot;, &quot;group&quot; + this.groupId);</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -83,22 +83,22 @@</span>
<a href="#l8.23"></a><span id="l8.23">          &lt;![CDATA[</span>
<a href="#l8.24"></a><span id="l8.24">            return this._showOffline;</span>
<a href="#l8.25"></a><span id="l8.25">          ]]&gt;</span>
<a href="#l8.26"></a><span id="l8.26">        &lt;/getter&gt;</span>
<a href="#l8.27"></a><span id="l8.27">        &lt;setter&gt;</span>
<a href="#l8.28"></a><span id="l8.28">          &lt;![CDATA[</span>
<a href="#l8.29"></a><span id="l8.29">            this._showOffline = val;</span>
<a href="#l8.30"></a><span id="l8.30">            if (val) {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-             this.tag.getContacts().filter(function (c) !c.online)</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+             this.tag.getContacts().filter(c =&gt; !c.online)</span>
<a href="#l8.33"></a><span id="l8.33">                                    .forEach(this.addContact, this);</span>
<a href="#l8.34"></a><span id="l8.34">              this._updateGroupLabel();</span>
<a href="#l8.35"></a><span id="l8.35">            }</span>
<a href="#l8.36"></a><span id="l8.36">            else {</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-             this.contacts.filter(function (b) !b.contact.online)</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+             this.contacts.filter(b =&gt; !b.contact.online)</span>
<a href="#l8.39"></a><span id="l8.39">                           .forEach(function (b) {</span>
<a href="#l8.40"></a><span id="l8.40">                b.destroy();</span>
<a href="#l8.41"></a><span id="l8.41">                b.remove();</span>
<a href="#l8.42"></a><span id="l8.42">              }, this);</span>
<a href="#l8.43"></a><span id="l8.43">            }</span>
<a href="#l8.44"></a><span id="l8.44">            return val;</span>
<a href="#l8.45"></a><span id="l8.45">          ]]&gt;</span>
<a href="#l8.46"></a><span id="l8.46">        &lt;/setter&gt;</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineat">@@ -267,17 +267,17 @@</span>
<a href="#l8.48"></a><span id="l8.48">       &lt;parameter name=&quot;aContact&quot;/&gt;</span>
<a href="#l8.49"></a><span id="l8.49">       &lt;body&gt;</span>
<a href="#l8.50"></a><span id="l8.50">       &lt;![CDATA[</span>
<a href="#l8.51"></a><span id="l8.51">         var i = this.contacts.indexOf(aContact);</span>
<a href="#l8.52"></a><span id="l8.52">         if (i == -1)</span>
<a href="#l8.53"></a><span id="l8.53">           throw &quot;Removing a contact that doesn't exist?&quot;;</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55">         // create a new array to remove without breaking for each loops.</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-        this.contacts = this.contacts.filter(function(c) c !== aContact);</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+        this.contacts = this.contacts.filter(c =&gt; c !== aContact);</span>
<a href="#l8.58"></a><span id="l8.58">         delete this.contactsById[aContact.contact.id];</span>
<a href="#l8.59"></a><span id="l8.59"> </span>
<a href="#l8.60"></a><span id="l8.60">         // Check if some contacts remain in the group, if empty remove it</span>
<a href="#l8.61"></a><span id="l8.61">         if (!this.contacts.length) {</span>
<a href="#l8.62"></a><span id="l8.62">           this.setAttribute(&quot;collapsing&quot;, &quot;true&quot;);</span>
<a href="#l8.63"></a><span id="l8.63">           this.addEventListener(&quot;transitionend&quot;, this._transitionEnd, true);</span>
<a href="#l8.64"></a><span id="l8.64">         }</span>
<a href="#l8.65"></a><span id="l8.65">         else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/im/content/instantbird.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/im/content/instantbird.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -57,21 +57,21 @@ var convWindow = {</span>
<a href="#l9.4"></a><span id="l9.4">     let panels = getTabBrowser().tabPanels;</span>
<a href="#l9.5"></a><span id="l9.5">     for (let panel of panels) {</span>
<a href="#l9.6"></a><span id="l9.6">       if (&quot;onResize&quot; in panel)</span>
<a href="#l9.7"></a><span id="l9.7">         panel.onResize(aEvent);</span>
<a href="#l9.8"></a><span id="l9.8">     }</span>
<a href="#l9.9"></a><span id="l9.9">   }</span>
<a href="#l9.10"></a><span id="l9.10"> };</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-function getConvWindowURL() &quot;chrome://instantbird/content/instantbird.xul&quot;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+function getConvWindowURL() { return &quot;chrome://instantbird/content/instantbird.xul&quot;; }</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-function getTabBrowser() document.getElementById(&quot;conversations&quot;)</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+function getTabBrowser() { return document.getElementById(&quot;conversations&quot;); }</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-function getBrowser() getTabBrowser().selectedBrowser</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+function getBrowser() { return getTabBrowser().selectedBrowser; }</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21"> // Copied from mozilla/browser/base/content/utilityOverlay.js</span>
<a href="#l9.22"></a><span id="l9.22"> function trimURL(aURL) {</span>
<a href="#l9.23"></a><span id="l9.23">   // This function must not modify the given URL such that calling</span>
<a href="#l9.24"></a><span id="l9.24">   // nsIURIFixup::createFixupURI with the result will produce a different URI.</span>
<a href="#l9.25"></a><span id="l9.25">   return aURL /* remove single trailing slash for http/https/ftp URLs */</span>
<a href="#l9.26"></a><span id="l9.26">              .replace(/^((?:http|https|ftp):\/\/[^/]+)\/$/, &quot;$1&quot;)</span>
<a href="#l9.27"></a><span id="l9.27">               /* remove http:// unless the host starts with &quot;ftp\d*\.&quot; or contains &quot;@&quot; */</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineat">@@ -159,17 +159,17 @@ var XULBrowserWindow = {</span>
<a href="#l9.29"></a><span id="l9.29"> };</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31"> // Copied from mozilla/browser/base/content/browser.js</span>
<a href="#l9.32"></a><span id="l9.32"> var LinkTargetDisplay = {</span>
<a href="#l9.33"></a><span id="l9.33">   DELAY_SHOW: 80, // Services.prefs.getIntPref(&quot;browser.overlink-delay&quot;);</span>
<a href="#l9.34"></a><span id="l9.34">   DELAY_HIDE: 250,</span>
<a href="#l9.35"></a><span id="l9.35">   _timer: 0,</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-  get _isVisible () XULBrowserWindow.statusTextField.label != &quot;&quot;,</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  get _isVisible () { return XULBrowserWindow.statusTextField.label != &quot;&quot;; },</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   update: function () {</span>
<a href="#l9.41"></a><span id="l9.41">     clearTimeout(this._timer);</span>
<a href="#l9.42"></a><span id="l9.42">     window.removeEventListener(&quot;mousemove&quot;, this, true);</span>
<a href="#l9.43"></a><span id="l9.43"> </span>
<a href="#l9.44"></a><span id="l9.44">     if (!XULBrowserWindow.overLink) {</span>
<a href="#l9.45"></a><span id="l9.45">       if (XULBrowserWindow.hideOverLinkImmediately)</span>
<a href="#l9.46"></a><span id="l9.46">         this._hide();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/im/content/macgestures.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/im/content/macgestures.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -50,17 +50,17 @@ let gGestureSupport = {</span>
<a href="#l10.4"></a><span id="l10.4">    *</span>
<a href="#l10.5"></a><span id="l10.5">    * @param aEvent</span>
<a href="#l10.6"></a><span id="l10.6">    *        The gesture event to handle</span>
<a href="#l10.7"></a><span id="l10.7">    */</span>
<a href="#l10.8"></a><span id="l10.8">   handleEvent: function GS_handleEvent(aEvent) {</span>
<a href="#l10.9"></a><span id="l10.9">     aEvent.stopPropagation();</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">     // Create a preference object with some defaults</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    let def = function(aThreshold, aLatched)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    let def = (aThreshold, aLatched) =&gt;</span>
<a href="#l10.14"></a><span id="l10.14">       ({ threshold: aThreshold, latched: !!aLatched });</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16">     switch (aEvent.type) {</span>
<a href="#l10.17"></a><span id="l10.17">       case &quot;MozSwipeGesture&quot;:</span>
<a href="#l10.18"></a><span id="l10.18">         this.onSwipe(aEvent);</span>
<a href="#l10.19"></a><span id="l10.19">         break;</span>
<a href="#l10.20"></a><span id="l10.20">       case &quot;MozMagnifyGestureStart&quot;:</span>
<a href="#l10.21"></a><span id="l10.21">         this._setupGesture(aEvent, &quot;pinch&quot;, def(150, 1), &quot;out&quot;, &quot;in&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/im/content/menus.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/im/content/menus.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -9,17 +9,17 @@ const errorConsoleWindow = &quot;chrome://glo</span>
<a href="#l11.4"></a><span id="l11.4"> const preferencesWindow = &quot;chrome://instantbird/content/preferences/preferences.xul&quot;;</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> if (!(&quot;Services&quot; in window))</span>
<a href="#l11.7"></a><span id="l11.7">   Components.utils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l11.8"></a><span id="l11.8"> if (!(&quot;Core&quot; in window))</span>
<a href="#l11.9"></a><span id="l11.9">   Components.utils.import(&quot;resource:///modules/ibCore.jsm&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> var menus = {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  supportsCommand: function(aCmd)</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  supportsCommand: aCmd =&gt;</span>
<a href="#l11.14"></a><span id="l11.14">     aCmd == &quot;cmd_addbuddy&quot; || aCmd == &quot;cmd_joinchat&quot; || aCmd == &quot;cmd_newtab&quot;,</span>
<a href="#l11.15"></a><span id="l11.15">   isCommandEnabled: function(aCmd) {</span>
<a href="#l11.16"></a><span id="l11.16">     let enumerator = Services.accounts.getAccounts();</span>
<a href="#l11.17"></a><span id="l11.17">     while (enumerator.hasMoreElements()) {</span>
<a href="#l11.18"></a><span id="l11.18">       let acc = enumerator.getNext();</span>
<a href="#l11.19"></a><span id="l11.19">       if (acc.connected &amp;&amp;</span>
<a href="#l11.20"></a><span id="l11.20">           (aCmd == &quot;cmd_addbuddy&quot; || aCmd == &quot;cmd_newtab&quot; || acc.canJoinChat))</span>
<a href="#l11.21"></a><span id="l11.21">         return true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/im/content/nsContextMenu.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/im/content/nsContextMenu.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -64,17 +64,17 @@ nsContextMenu.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">       // Clicked the participant list, but not a listitem.</span>
<a href="#l12.5"></a><span id="l12.5">       this.shouldDisplay = false;</span>
<a href="#l12.6"></a><span id="l12.6">       return;</span>
<a href="#l12.7"></a><span id="l12.7">     }</span>
<a href="#l12.8"></a><span id="l12.8">     this.setTarget(node);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">     let isParticipantList = node.localName == &quot;listitem&quot;;</span>
<a href="#l12.11"></a><span id="l12.11">     let nickActions = this.getNickActions(isParticipantList);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    this.onNick = nickActions.some(function(action) action.visible);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    this.onNick = nickActions.some(action =&gt; action.visible);</span>
<a href="#l12.14"></a><span id="l12.14">     if (isParticipantList &amp;&amp; !this.onNick) {</span>
<a href="#l12.15"></a><span id="l12.15">       // If we're in the participant list, there will be no other entries.</span>
<a href="#l12.16"></a><span id="l12.16">       this.shouldDisplay = false;</span>
<a href="#l12.17"></a><span id="l12.17">       return;</span>
<a href="#l12.18"></a><span id="l12.18">     }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">     let actions = [];</span>
<a href="#l12.21"></a><span id="l12.21">     while (node) {</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -196,18 +196,19 @@ nsContextMenu.prototype = {</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">     return actions;</span>
<a href="#l12.25"></a><span id="l12.25">   },</span>
<a href="#l12.26"></a><span id="l12.26">   nickOpenConv: function() {</span>
<a href="#l12.27"></a><span id="l12.27">     let name = this.conv.target.getNormalizedChatBuddyName(this.nick);</span>
<a href="#l12.28"></a><span id="l12.28">     let newConv = this.conv.account.createConversation(name);</span>
<a href="#l12.29"></a><span id="l12.29">     Conversations.focusConversation(newConv);</span>
<a href="#l12.30"></a><span id="l12.30">   },</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  nickAddContact: function(aTag)</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-    this.conv.account.addBuddy(aTag, this.nick),</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+  nickAddContact: function(aTag) {</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+    return this.conv.account.addBuddy(aTag, this.nick);</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  },</span>
<a href="#l12.36"></a><span id="l12.36">   nickShowLogs: function() {</span>
<a href="#l12.37"></a><span id="l12.37">     let nick = this.nick;</span>
<a href="#l12.38"></a><span id="l12.38">     this.getLogsForNick(nick).then(aLogs =&gt; {</span>
<a href="#l12.39"></a><span id="l12.39">       if (!aLogs || !aLogs.hasMoreElements())</span>
<a href="#l12.40"></a><span id="l12.40">         return;</span>
<a href="#l12.41"></a><span id="l12.41">       window.openDialog(&quot;chrome://instantbird/content/viewlog.xul&quot;,</span>
<a href="#l12.42"></a><span id="l12.42">                         &quot;Logs&quot;, &quot;chrome,resizable&quot;, {logs: aLogs}, nick);</span>
<a href="#l12.43"></a><span id="l12.43">     });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/im/content/preferences/applications.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/im/content/preferences/applications.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -768,17 +768,17 @@ var gApplicationsPane = {</span>
<a href="#l13.4"></a><span id="l13.4">         menu.selectedItem = internalMenuItem;</span>
<a href="#l13.5"></a><span id="l13.5">         break;</span>
<a href="#l13.6"></a><span id="l13.6">       case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l13.7"></a><span id="l13.7">         menu.selectedItem = defaultMenuItem;</span>
<a href="#l13.8"></a><span id="l13.8">         break;</span>
<a href="#l13.9"></a><span id="l13.9">       case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l13.10"></a><span id="l13.10">         if (preferredApp)</span>
<a href="#l13.11"></a><span id="l13.11">           menu.selectedItem = </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            possibleAppMenuItems.filter(function(v) v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l13.14"></a><span id="l13.14">         break;</span>
<a href="#l13.15"></a><span id="l13.15">       case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l13.16"></a><span id="l13.16">         menu.selectedItem = saveMenuItem;</span>
<a href="#l13.17"></a><span id="l13.17">         break;</span>
<a href="#l13.18"></a><span id="l13.18">     }</span>
<a href="#l13.19"></a><span id="l13.19">   },</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/im/content/preferences/messagestyle.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/im/content/preferences/messagestyle.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -19,21 +19,21 @@ Conversation.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">             statusInfo: Services.core.globalUserStatus}</span>
<a href="#l14.5"></a><span id="l14.5"> };</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> function Message(aWho, aMessage, aObject) {</span>
<a href="#l14.8"></a><span id="l14.8">   this._init(aWho, aMessage, aObject);</span>
<a href="#l14.9"></a><span id="l14.9"> }</span>
<a href="#l14.10"></a><span id="l14.10"> Message.prototype = {</span>
<a href="#l14.11"></a><span id="l14.11">   __proto__: jsProtoHelper.GenericMessagePrototype,</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  get displayMessage() this.originalMessage</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  get displayMessage() { return this.originalMessage; }</span>
<a href="#l14.14"></a><span id="l14.14"> };</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> // Message style tooltips use this.</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-function getBrowser() document.getElementById(&quot;previewbrowser&quot;);</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+function getBrowser() { return document.getElementById(&quot;previewbrowser&quot;); }</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20"> var previewObserver = {</span>
<a href="#l14.21"></a><span id="l14.21">   _loaded: false,</span>
<a href="#l14.22"></a><span id="l14.22">   load: function() {</span>
<a href="#l14.23"></a><span id="l14.23">     gThemePane.buildThemeList(&quot;messagestyle&quot;);</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">     let makeDate = function(aDateString) {</span>
<a href="#l14.26"></a><span id="l14.26">       let array = aDateString.split(&quot;:&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/im/content/preferences/themes.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/im/content/preferences/themes.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -51,17 +51,17 @@ var gThemePane = {</span>
<a href="#l15.4"></a><span id="l15.4">   /* Create the drop down list for emoticons and messagestyles;</span>
<a href="#l15.5"></a><span id="l15.5">       this will take care of disabled and incompatible themes and the case</span>
<a href="#l15.6"></a><span id="l15.6">       that there are no custom styles installed.</span>
<a href="#l15.7"></a><span id="l15.7">    */</span>
<a href="#l15.8"></a><span id="l15.8">   buildThemeList: function (aThemeType) {</span>
<a href="#l15.9"></a><span id="l15.9">     let extensionTypeRegExp = new RegExp(&quot;^&quot; + aThemeType + &quot;-&quot;);</span>
<a href="#l15.10"></a><span id="l15.10">     let themeList =</span>
<a href="#l15.11"></a><span id="l15.11">       this.getExtensionList()</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-          .filter(function(item) extensionTypeRegExp.test(item.id))</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+          .filter(item =&gt; extensionTypeRegExp.test(item.id))</span>
<a href="#l15.14"></a><span id="l15.14">           .sort(function(item1, item2) {</span>
<a href="#l15.15"></a><span id="l15.15">             let name1 = item1.name.toLowerCase();</span>
<a href="#l15.16"></a><span id="l15.16">             let name2 = item2.name.toLowerCase();</span>
<a href="#l15.17"></a><span id="l15.17">             return name1 &lt; name2 ? -1 : name1 &gt; name2 ? 1 : 0;</span>
<a href="#l15.18"></a><span id="l15.18">           });</span>
<a href="#l15.19"></a><span id="l15.19">     if (!themeList.length)</span>
<a href="#l15.20"></a><span id="l15.20">       return;</span>
<a href="#l15.21"></a><span id="l15.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/im/content/tabbrowser.xml</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/im/content/tabbrowser.xml</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -933,17 +933,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">       &lt;property name=&quot;selectedPanel&quot;</span>
<a href="#l16.5"></a><span id="l16.5">                 onget=&quot;return this.mCurrentTab.linkedTabPanel || null;&quot;</span>
<a href="#l16.6"></a><span id="l16.6">                 readonly=&quot;true&quot;/&gt;</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">       &lt;property name=&quot;tabPanels&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l16.9"></a><span id="l16.9">        &lt;getter&gt;</span>
<a href="#l16.10"></a><span id="l16.10">           &lt;![CDATA[</span>
<a href="#l16.11"></a><span id="l16.11">             return this._tabPanels ||</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-                   (this._tabPanels = Array.map(this.mTabs, function (tab) tab.linkedTabPanel));</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+                   (this._tabPanels = Array.map(this.mTabs, tab =&gt; tab.linkedTabPanel));</span>
<a href="#l16.14"></a><span id="l16.14">           ]]&gt;</span>
<a href="#l16.15"></a><span id="l16.15">         &lt;/getter&gt;</span>
<a href="#l16.16"></a><span id="l16.16">       &lt;/property&gt;</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">       &lt;property name=&quot;conversations&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l16.19"></a><span id="l16.19">        &lt;getter&gt;</span>
<a href="#l16.20"></a><span id="l16.20">         &lt;![CDATA[</span>
<a href="#l16.21"></a><span id="l16.21">           if (!this._conversations) {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -1713,17 +1713,17 @@</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24">           window.addEventListener(&quot;resize&quot;, this);</span>
<a href="#l16.25"></a><span id="l16.25"> #ifdef XP_MACOSX</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27">           if (!(&quot;WindowDraggingElement&quot; in window))</span>
<a href="#l16.28"></a><span id="l16.28">             Components.utils.import(&quot;resource://gre/modules/WindowDraggingUtils.jsm&quot;);</span>
<a href="#l16.29"></a><span id="l16.29">           let draghandle = new WindowDraggingElement(this.mTabstrip, window);</span>
<a href="#l16.30"></a><span id="l16.30">           draghandle.mouseDownCheck =</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-            function(aEvent) aEvent.originalTarget.localName != &quot;tab&quot;;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+            aEvent =&gt; aEvent.originalTarget.localName != &quot;tab&quot;;</span>
<a href="#l16.33"></a><span id="l16.33"> #endif</span>
<a href="#l16.34"></a><span id="l16.34">         ]]&gt;</span>
<a href="#l16.35"></a><span id="l16.35">       &lt;/constructor&gt;</span>
<a href="#l16.36"></a><span id="l16.36"> </span>
<a href="#l16.37"></a><span id="l16.37">       &lt;destructor&gt;</span>
<a href="#l16.38"></a><span id="l16.38">         &lt;![CDATA[</span>
<a href="#l16.39"></a><span id="l16.39">           Services.prefs.removeObserver(&quot;browser.tabs.closeButtons&quot;,</span>
<a href="#l16.40"></a><span id="l16.40">                                         this._prefObserver);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/im/content/viewlog.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/im/content/viewlog.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -23,17 +23,17 @@ var logWindow = {</span>
<a href="#l17.4"></a><span id="l17.4">       document.title = bundle.getFormattedString(&quot;logs&quot;, [displayname]) +</span>
<a href="#l17.5"></a><span id="l17.5">         document.documentElement.getAttribute(&quot;titlemenuseparator&quot;) +</span>
<a href="#l17.6"></a><span id="l17.6">         document.documentElement.getAttribute(&quot;titlemodifier&quot;);</span>
<a href="#l17.7"></a><span id="l17.7">     }</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">     // Prevent closing the findbar, go back to logTree instead.</span>
<a href="#l17.10"></a><span id="l17.10">     let findbar = document.getElementById(&quot;findbar&quot;);</span>
<a href="#l17.11"></a><span id="l17.11">     let logTree = document.getElementById(&quot;logTree&quot;);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    findbar.close = function() logTree.focus();</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    findbar.close = () =&gt; logTree.focus();</span>
<a href="#l17.14"></a><span id="l17.14">     // Ensure the findbar has something to look at.</span>
<a href="#l17.15"></a><span id="l17.15">     let browser = document.getElementById(&quot;text-browser&quot;);</span>
<a href="#l17.16"></a><span id="l17.16">     findbar.browser = browser;</span>
<a href="#l17.17"></a><span id="l17.17">     findbar.open(); // Requires findbar.browser to be set</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19">     document.getElementById(&quot;text-browser&quot;)</span>
<a href="#l17.20"></a><span id="l17.20">             .addEventListener(&quot;DOMContentLoaded&quot;, logWindow.contentLoaded, true);</span>
<a href="#l17.21"></a><span id="l17.21">     document.getElementById(&quot;conv-browser&quot;).progressBar =</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -136,17 +136,17 @@ var logWindow = {</span>
<a href="#l17.23"></a><span id="l17.23">     let browser = document.getElementById(&quot;conv-browser&quot;);</span>
<a href="#l17.24"></a><span id="l17.24">     if (aTopic != &quot;conversation-loaded&quot; || aSubject != browser)</span>
<a href="#l17.25"></a><span id="l17.25">       return;</span>
<a href="#l17.26"></a><span id="l17.26">     browser._autoScrollEnabled = false;</span>
<a href="#l17.27"></a><span id="l17.27">     browser.contentDocument.getElementById(&quot;ibcontent&quot;).classList.add(&quot;log&quot;);</span>
<a href="#l17.28"></a><span id="l17.28"> </span>
<a href="#l17.29"></a><span id="l17.29">     let count = {};</span>
<a href="#l17.30"></a><span id="l17.30">     let messages = browser._conv.getMessagesEnumerator(count);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-    browser.getPendingMessagesCount = function() count.value;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+    browser.getPendingMessagesCount = () =&gt; count.value;</span>
<a href="#l17.33"></a><span id="l17.33">     browser.getNextPendingMessage = function() {</span>
<a href="#l17.34"></a><span id="l17.34">       if (!messages.hasMoreElements()) {</span>
<a href="#l17.35"></a><span id="l17.35">         delete browser.getNextPendingMessage;</span>
<a href="#l17.36"></a><span id="l17.36">         return null;</span>
<a href="#l17.37"></a><span id="l17.37">       }</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39">       let msg = messages.getNext();</span>
<a href="#l17.40"></a><span id="l17.40">       if (!msg.system &amp;&amp; browser._conv.isChat)</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineat">@@ -184,37 +184,37 @@ var logWindow = {</span>
<a href="#l17.42"></a><span id="l17.42"> function chatLogTreeGroupItem(aTitle, aLogItems) {</span>
<a href="#l17.43"></a><span id="l17.43">   this._title = aTitle;</span>
<a href="#l17.44"></a><span id="l17.44">   this._children = aLogItems;</span>
<a href="#l17.45"></a><span id="l17.45">   for each (let child in this._children)</span>
<a href="#l17.46"></a><span id="l17.46">     child._parent = this;</span>
<a href="#l17.47"></a><span id="l17.47">   this._open = false;</span>
<a href="#l17.48"></a><span id="l17.48"> }</span>
<a href="#l17.49"></a><span id="l17.49"> chatLogTreeGroupItem.prototype = {</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-  getText: function() this._title,</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-  get id() this._title,</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-  get open() this._open,</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-  get level() 0,</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-  get _parent() null,</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-  get children() this._children,</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-  getProperties: function() &quot;&quot;</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+  getText: function() { return this._title; },</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+  get id() { return this._title; },</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  get open() { return this._open; },</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+  get level() { return 0; },</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+  get _parent() { return null; },</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+  get children() { return this._children; },</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+  getProperties: () =&gt; &quot;&quot;</span>
<a href="#l17.64"></a><span id="l17.64"> };</span>
<a href="#l17.65"></a><span id="l17.65"> </span>
<a href="#l17.66"></a><span id="l17.66"> function chatLogTreeLogItem(aLog, aText, aLevel) {</span>
<a href="#l17.67"></a><span id="l17.67">   this.log = aLog;</span>
<a href="#l17.68"></a><span id="l17.68">   this._text = aText;</span>
<a href="#l17.69"></a><span id="l17.69">   this._level = aLevel;</span>
<a href="#l17.70"></a><span id="l17.70"> }</span>
<a href="#l17.71"></a><span id="l17.71"> chatLogTreeLogItem.prototype = {</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-  getText: function() this._text,</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-  get id() this.log.title,</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-  get open() false,</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-  get level() this._level,</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-  get children() [],</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-  getProperties: function() &quot;&quot;</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+  getText: function() { return this._text; },</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+  get id() { return this.log.title; },</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+  get open() { return false; },</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+  get level() { return this._level; },</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+  get children() { return []; },</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+  getProperties: () =&gt; &quot;&quot;</span>
<a href="#l17.84"></a><span id="l17.84"> };</span>
<a href="#l17.85"></a><span id="l17.85"> </span>
<a href="#l17.86"></a><span id="l17.86"> function chatLogTreeView(aTree, aLogs) {</span>
<a href="#l17.87"></a><span id="l17.87">   this._tree = aTree;</span>
<a href="#l17.88"></a><span id="l17.88">   this._logs = aLogs;</span>
<a href="#l17.89"></a><span id="l17.89">   this._tree.view = this;</span>
<a href="#l17.90"></a><span id="l17.90">   this._rebuild();</span>
<a href="#l17.91"></a><span id="l17.91"> }</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineat">@@ -247,19 +247,19 @@ chatLogTreeView.prototype = {</span>
<a href="#l17.93"></a><span id="l17.93">                                 aDate.getMonth() + 1, aDate.getDate(),</span>
<a href="#l17.94"></a><span id="l17.94">                                 aDate.getHours(), aDate.getMinutes(), 0);</span>
<a href="#l17.95"></a><span id="l17.95">     };</span>
<a href="#l17.96"></a><span id="l17.96">     let formatMonthYear = function(aDate) {</span>
<a href="#l17.97"></a><span id="l17.97">       let month = formatMonth(aDate);</span>
<a href="#l17.98"></a><span id="l17.98">       return placesBundle.getFormattedString(&quot;finduri-MonthYear&quot;,</span>
<a href="#l17.99"></a><span id="l17.99">                                              [month, aDate.getFullYear()]);</span>
<a href="#l17.100"></a><span id="l17.100">     };</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-    let formatMonth = function(aDate)</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+    let formatMonth = aDate =&gt;</span>
<a href="#l17.103"></a><span id="l17.103">       dateFormatBundle.getString(&quot;month.&quot; + (aDate.getMonth() + 1) + &quot;.name&quot;);</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-    let formatWeekday = function(aDate)</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+    let formatWeekday = aDate =&gt;</span>
<a href="#l17.106"></a><span id="l17.106">       dateFormatBundle.getString(&quot;day.&quot; + (aDate.getDay() + 1) + &quot;.name&quot;);</span>
<a href="#l17.107"></a><span id="l17.107"> </span>
<a href="#l17.108"></a><span id="l17.108">     let nowDate = new Date();</span>
<a href="#l17.109"></a><span id="l17.109">     let todayDate = new Date(nowDate.getFullYear(), nowDate.getMonth(),</span>
<a href="#l17.110"></a><span id="l17.110">                              nowDate.getDate());</span>
<a href="#l17.111"></a><span id="l17.111"> </span>
<a href="#l17.112"></a><span id="l17.112">     // The keys used in the 'firstgroups' object should match string ids.</span>
<a href="#l17.113"></a><span id="l17.113">     // The order is the reverse of that in which they will appear</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineat">@@ -347,17 +347,17 @@ chatLogTreeView.prototype = {</span>
<a href="#l17.115"></a><span id="l17.115"> </span>
<a href="#l17.116"></a><span id="l17.116">     // Build tree.</span>
<a href="#l17.117"></a><span id="l17.117">     if (today)</span>
<a href="#l17.118"></a><span id="l17.118">       this._rowMap.push(today);</span>
<a href="#l17.119"></a><span id="l17.119">     if (yesterday)</span>
<a href="#l17.120"></a><span id="l17.120">       this._rowMap.push(yesterday);</span>
<a href="#l17.121"></a><span id="l17.121">     groupIDs.forEach(function (aGroupID) {</span>
<a href="#l17.122"></a><span id="l17.122">       let group = groups[aGroupID];</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineminus">-      group.entries.sort(function(l1, l2) l2.log.time - l1.log.time);</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+      group.entries.sort((l1, l2) =&gt; l2.log.time - l1.log.time);</span>
<a href="#l17.125"></a><span id="l17.125">       this._rowMap.push(new chatLogTreeGroupItem(group.name, group.entries));</span>
<a href="#l17.126"></a><span id="l17.126">     }, this);</span>
<a href="#l17.127"></a><span id="l17.127"> </span>
<a href="#l17.128"></a><span id="l17.128">     // Finally, notify the tree.</span>
<a href="#l17.129"></a><span id="l17.129">     if (this._tree)</span>
<a href="#l17.130"></a><span id="l17.130">       this._tree.rowCountChanged(0, this._rowMap.length);</span>
<a href="#l17.131"></a><span id="l17.131">   }</span>
<a href="#l17.132"></a><span id="l17.132"> };</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

