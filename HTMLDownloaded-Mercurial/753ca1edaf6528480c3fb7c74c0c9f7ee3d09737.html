<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25908:753ca1edaf6528480c3fb7c74c0c9f7ee3d09737</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 753ca1edaf6528480c3fb7c74c0c9f7ee3d09737" />
<meta property="og:url" content="/comm-central/rev/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737" />
<meta property="og:description" content="Bug 1524456 - Convert datepicker and timepicker classes to custom elements; r=Fallen" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 753ca1edaf6528480c3fb7c74c0c9f7ee3d09737 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">shortlog</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">files</a> |
changeset |
<a href="/comm-central/raw-rev/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">raw</a>  | <a href="/comm-central/archive/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1524456">Bug 1524456</a> - Convert datepicker and timepicker classes to custom elements; r=Fallen
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 21 Feb 2019 14:15:09 +1300</td></tr>

<tr>
 <td>changeset 25908</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">753ca1edaf6528480c3fb7c74c0c9f7ee3d09737</a></td>
</tr>



<tr>
<td>parent 25907</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ed928f6d6a69bfcc4e3fa28418329cb4995f1ae3">ed928f6d6a69bfcc4e3fa28418329cb4995f1ae3</a>
</td>
</tr>

<tr>
<td>child 25909</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3958330210079f900dc3bda64de3559e9f4ba4c0">3958330210079f900dc3bda64de3559e9f4ba4c0</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=753ca1edaf6528480c3fb7c74c0c9f7ee3d09737">15542</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 21 Feb 2019 01:17:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@395833021007 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3958330210079f900dc3bda64de3559e9f4ba4c0">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3958330210079f900dc3bda64de3559e9f4ba4c0&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3958330210079f900dc3bda64de3559e9f4ba4c0&newProject=comm-central&newRevision=2cad3d30f52cd1e7a952ff51d0c8f80bba59dbb4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3958330210079f900dc3bda64de3559e9f4ba4c0&newProject=comm-central&newRevision=2cad3d30f52cd1e7a952ff51d0c8f80bba59dbb4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3958330210079f900dc3bda64de3559e9f4ba4c0&newProject=comm-central&newRevision=2cad3d30f52cd1e7a952ff51d0c8f80bba59dbb4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1524456">1524456</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1524456">Bug 1524456</a> - Convert datepicker and timepicker classes to custom elements; r=Fallen</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul">calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/calendar-widget-bindings.css">calendar/base/content/widgets/calendar-widget-bindings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/calendar-widget-bindings.css">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/calendar-widget-bindings.css">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/calendar-widget-bindings.css">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/calendar-widget-bindings.css">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/calendar-widget-bindings.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/images/nav-today.svg">calendar/base/themes/common/widgets/images/nav-today.svg</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/images/nav-today.svg">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/images/nav-today.svg">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/images/nav-today.svg">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/images/nav-today.svg">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/images/nav-today.svg">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/minimonth.css">calendar/base/themes/common/widgets/minimonth.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/minimonth.css">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/minimonth.css">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/minimonth.css">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/minimonth.css">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/base/themes/common/widgets/minimonth.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.xul">calendar/lightning/content/lightning-item-iframe.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.xul">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.xul">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.xul">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.xul">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/content/lightning-item-iframe.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/jar.mn">calendar/lightning/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/jar.mn">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/jar.mn">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/jar.mn">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/jar.mn">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/lightning/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/locales/en-US/chrome/calendar/global.dtd">calendar/locales/en-US/chrome/calendar/global.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/locales/en-US/chrome/calendar/global.dtd">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/locales/en-US/chrome/calendar/global.dtd">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/locales/en-US/chrome/calendar/global.dtd">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/locales/en-US/chrome/calendar/global.dtd">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/locales/en-US/chrome/calendar/global.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/providers/gdata/content/gdata-lightning-item-iframe.js">calendar/providers/gdata/content/gdata-lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/providers/gdata/content/gdata-lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/providers/gdata/content/gdata-lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/providers/gdata/content/gdata-lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/providers/gdata/content/gdata-lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/providers/gdata/content/gdata-lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.css">calendar/resources/content/datetimepickers/datetimepickers.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.css">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.css">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.css">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.css">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.js">calendar/resources/content/datetimepickers/datetimepickers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.js">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.js">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.js">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.js">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/skin/datetimepickers.css">calendar/resources/skin/datetimepickers.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/skin/datetimepickers.css">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/skin/datetimepickers.css">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/skin/datetimepickers.css">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/skin/datetimepickers.css">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/resources/skin/datetimepickers.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js">calendar/test/mozmill/shared-modules/test-item-editing-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/base/content/bindings.css">mail/base/content/bindings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/base/content/bindings.css">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/base/content/bindings.css">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/base/content/bindings.css">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/base/content/bindings.css">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/base/content/bindings.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/themes/linux/mail/datetimepicker.css">mail/themes/linux/mail/datetimepicker.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/themes/linux/mail/datetimepicker.css">file</a> |
<a href="/comm-central/annotate/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/themes/linux/mail/datetimepicker.css">annotate</a> |
<a href="/comm-central/diff/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/themes/linux/mail/datetimepicker.css">diff</a> |
<a href="/comm-central/comparison/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/themes/linux/mail/datetimepicker.css">comparison</a> |
<a href="/comm-central/log/753ca1edaf6528480c3fb7c74c0c9f7ee3d09737/mail/themes/linux/mail/datetimepicker.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -813,16 +813,20 @@ function updatePreview() {</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> /**</span>
<a href="#l1.6"></a><span id="l1.6">  * Checks the until date just entered in the datepicker in order to avoid</span>
<a href="#l1.7"></a><span id="l1.7">  * setting a date earlier than the start date.</span>
<a href="#l1.8"></a><span id="l1.8">  * Restores the previous correct date, shows a warning and prevents to close the</span>
<a href="#l1.9"></a><span id="l1.9">  * dialog when the user enters a wrong until date.</span>
<a href="#l1.10"></a><span id="l1.10">  */</span>
<a href="#l1.11"></a><span id="l1.11"> function checkUntilDate() {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    if (!gStartTime) { // This function shouldn't run before onLoad.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        return;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    }</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16">     let untilDate = cal.dtz.jsDateToDateTime(getElementValue(&quot;repeat-until-date&quot;), gStartTime.timezone);</span>
<a href="#l1.17"></a><span id="l1.17">     let startDate = gStartTime.clone();</span>
<a href="#l1.18"></a><span id="l1.18">     startDate.isDate = true;</span>
<a href="#l1.19"></a><span id="l1.19">     if (untilDate.compare(startDate) &lt; 0) {</span>
<a href="#l1.20"></a><span id="l1.20">         let repeatDate = cal.dtz.dateTimeToJsDate((gUntilDate || gStartTime).getInTimezone(cal.dtz.floating));</span>
<a href="#l1.21"></a><span id="l1.21">         setElementValue(&quot;repeat-until-date&quot;, repeatDate);</span>
<a href="#l1.22"></a><span id="l1.22">         checkUntilDate.warning = true;</span>
<a href="#l1.23"></a><span id="l1.23">         let callback = function() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -7,16 +7,18 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/content/bindings.css&quot;?&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/skin/messenger.css&quot;?&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/skin/calendar-daypicker.css&quot;?&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar-common/skin/widgets/minimonth.css&quot;?&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/skin/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l2.9"></a><span id="l2.9"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/widgets/calendar-widget-bindings.css&quot;?&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l2.11"></a><span id="l2.11"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/datetimepickers/datetimepickers.css&quot;?&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+&lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://lightning-common/skin/datetimepickers.css&quot;?&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+&lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/content/menulist.css&quot;?&gt;</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> &lt;!DOCTYPE dialog [</span>
<a href="#l2.16"></a><span id="l2.16">   &lt;!ENTITY % dialogDTD SYSTEM &quot;chrome://calendar/locale/calendar-event-dialog.dtd&quot;&gt;</span>
<a href="#l2.17"></a><span id="l2.17">   %dialogDTD;</span>
<a href="#l2.18"></a><span id="l2.18"> ]&gt;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> &lt;dialog id=&quot;calendar-event-dialog-recurrence&quot;</span>
<a href="#l2.21"></a><span id="l2.21">         title=&quot;&amp;recurrence.title.label;&quot;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -28,16 +30,19 @@</span>
<a href="#l2.23"></a><span id="l2.23">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">   &lt;!-- Javascript includes --&gt;</span>
<a href="#l2.26"></a><span id="l2.26">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-event-dialog-recurrence.js&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-dialog-utils.js&quot;/&gt;</span>
<a href="#l2.28"></a><span id="l2.28">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-ui-utils.js&quot;/&gt;</span>
<a href="#l2.29"></a><span id="l2.29">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/calendar-statusbar.js&quot;/&gt;</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/customElements.js&quot;/&gt;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://calendar/content/datetimepickers/datetimepickers.js&quot;/&gt;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+</span>
<a href="#l2.34"></a><span id="l2.34">   &lt;!-- recurrence pattern --&gt;</span>
<a href="#l2.35"></a><span id="l2.35">   &lt;groupbox id=&quot;recurrence-pattern-groupbox&quot;&gt;</span>
<a href="#l2.36"></a><span id="l2.36">     &lt;label id=&quot;recurrence-pattern-caption&quot; class=&quot;header&quot;&gt;&amp;event.recurrence.pattern.label;&lt;/label&gt;</span>
<a href="#l2.37"></a><span id="l2.37">     &lt;grid id=&quot;recurrence-pattern-grid&quot;&gt;</span>
<a href="#l2.38"></a><span id="l2.38">       &lt;columns id=&quot;recurrence-pattern-columns&quot;&gt;</span>
<a href="#l2.39"></a><span id="l2.39">         &lt;column id=&quot;recurrence-pattern-description-column&quot;/&gt;</span>
<a href="#l2.40"></a><span id="l2.40">         &lt;column id=&quot;recurrence-pattern-controls-column&quot;/&gt;</span>
<a href="#l2.41"></a><span id="l2.41">       &lt;/columns&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widget-bindings.css</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widget-bindings.css</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -21,20 +21,16 @@ toolbarbutton[todaypane=&quot;true&quot;] {</span>
<a href="#l3.4"></a><span id="l3.4">   -moz-binding: url(chrome://calendar/content/widgets/calendar-widgets.xml#todaypane-toolbarbutton);</span>
<a href="#l3.5"></a><span id="l3.5"> }</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> minimonth {</span>
<a href="#l3.8"></a><span id="l3.8">   -moz-binding: url(&quot;chrome://calendar/content/widgets/minimonth.xml#minimonth&quot;);</span>
<a href="#l3.9"></a><span id="l3.9"> }</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> minimonth-header {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  -moz-binding: url(&quot;chrome://calendar/content/widgets/minimonth.xml#active-minimonth-header&quot;);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-}</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-minimonth-header[readonly=&quot;true&quot;] {</span>
<a href="#l3.16"></a><span id="l3.16">   -moz-binding: url(&quot;chrome://calendar/content/widgets/minimonth.xml#minimonth-header&quot;);</span>
<a href="#l3.17"></a><span id="l3.17"> }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> dragndropContainer {</span>
<a href="#l3.20"></a><span id="l3.20">    -moz-binding: url(chrome://calendar/content/widgets/calendar-widgets.xml#dragndropContainer);</span>
<a href="#l3.21"></a><span id="l3.21"> }</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23"> radio[calview] {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -34,321 +34,71 @@</span>
<a href="#l4.4"></a><span id="l4.4"> ]&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> &lt;bindings id=&quot;xulMiniMonth&quot;</span>
<a href="#l4.7"></a><span id="l4.7">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.8"></a><span id="l4.8">           xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l4.9"></a><span id="l4.9">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.10"></a><span id="l4.10">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  &lt;binding id=&quot;minimonth-header&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  &lt;binding id=&quot;minimonth-header&quot;&gt;</span>
<a href="#l4.14"></a><span id="l4.14">     &lt;content class=&quot;minimonth-month-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-      &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot; class=&quot;minimonth-month-name-readonly&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;months-back-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;-1&quot;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+                         tooltiptext=&quot;&amp;onemonthbackward.tooltip;&quot;/&gt;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+      &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot; class=&quot;minimonth-month-name&quot; tabindex=&quot;-1&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20">         &lt;xul:text value=&quot;&amp;month.1.name;&quot;/&gt;</span>
<a href="#l4.21"></a><span id="l4.21">         &lt;xul:text value=&quot;&amp;month.2.name;&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22">         &lt;xul:text value=&quot;&amp;month.3.name;&quot;/&gt;</span>
<a href="#l4.23"></a><span id="l4.23">         &lt;xul:text value=&quot;&amp;month.4.name;&quot;/&gt;</span>
<a href="#l4.24"></a><span id="l4.24">         &lt;xul:text value=&quot;&amp;month.5.name;&quot;/&gt;</span>
<a href="#l4.25"></a><span id="l4.25">         &lt;xul:text value=&quot;&amp;month.6.name;&quot;/&gt;</span>
<a href="#l4.26"></a><span id="l4.26">         &lt;xul:text value=&quot;&amp;month.7.name;&quot;/&gt;</span>
<a href="#l4.27"></a><span id="l4.27">         &lt;xul:text value=&quot;&amp;month.8.name;&quot;/&gt;</span>
<a href="#l4.28"></a><span id="l4.28">         &lt;xul:text value=&quot;&amp;month.9.name;&quot;/&gt;</span>
<a href="#l4.29"></a><span id="l4.29">         &lt;xul:text value=&quot;&amp;month.10.name;&quot;/&gt;</span>
<a href="#l4.30"></a><span id="l4.30">         &lt;xul:text value=&quot;&amp;month.11.name;&quot;/&gt;</span>
<a href="#l4.31"></a><span id="l4.31">         &lt;xul:text value=&quot;&amp;month.12.name;&quot;/&gt;</span>
<a href="#l4.32"></a><span id="l4.32">       &lt;/xul:deck&gt;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-      &lt;xul:text anonid=&quot;yearcell&quot; class=&quot;minimonth-year-name-readonly&quot; xbl:inherits=&quot;value=year&quot;/&gt;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;months-forward-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;1&quot;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+                         tooltiptext=&quot;&amp;onemonthforward.tooltip;&quot;/&gt;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;years-back-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;-1&quot;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.advanceYear(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+                         tooltiptext=&quot;&amp;oneyearbackward.tooltip;&quot;/&gt;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+      &lt;xul:text anonid=&quot;yearcell&quot; class=&quot;minimonth-year-name&quot; xbl:inherits=&quot;value=year&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;years-forward-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;1&quot;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.advanceYear(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+                         tooltiptext=&quot;&amp;oneyearforward.tooltip;&quot;/&gt;</span>
<a href="#l4.44"></a><span id="l4.44">       &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-  &lt;binding id=&quot;active-minimonth-header&quot; extends=&quot;chrome://calendar/content/widgets/minimonth.xml#minimonth-header&quot;&gt;</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-    &lt;content class=&quot;minimonth-month-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-      &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot;&gt;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.1.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.2.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.3.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.4.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.5.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.6.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.7.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.8.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.9.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.10.name;&quot; oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.11.name;&quot; oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;minimonth-month-name&quot; label=&quot;&amp;month.12.name;&quot; oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-      &lt;/xul:deck&gt;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;yearcell&quot;</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-                         class=&quot;minimonth-year-name&quot;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-                         oncommand=&quot;showPopupList(event, 'years-popup')&quot;</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-                         xbl:inherits=&quot;label=year&quot;/&gt;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-      &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;back-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;-1&quot;</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-                         oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-                         tooltiptext=&quot;&amp;onemonthbackward.tooltip;&quot;/&gt;</span>
<a href="#l4.72"></a><span id="l4.72">       &lt;xul:toolbarbutton anonid=&quot;today-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;0&quot;</span>
<a href="#l4.73"></a><span id="l4.73">                          oncommand=&quot;this.kMinimonth.value = new Date();&quot;</span>
<a href="#l4.74"></a><span id="l4.74">                          tooltiptext=&quot;&amp;showToday.tooltip;&quot;/&gt;</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;forward-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;1&quot;</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-                         oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-                         tooltiptext=&quot;&amp;onemonthforward.tooltip;&quot;/&gt;</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-      &lt;xul:popupset anonid=&quot;minmonth-popupset&quot;&gt;</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-        &lt;xul:menupopup anonid=&quot;months-popup&quot; position=&quot;after_start&quot;</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-                       onpopupshowing=&quot;event.stopPropagation();&quot;</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-                       onpopuphidden=&quot;firePopupListHidden();&quot;&gt;</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.1.name;&quot;  index=&quot;0&quot;/&gt;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.2.name;&quot;  index=&quot;1&quot;/&gt;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.3.name;&quot;  index=&quot;2&quot;/&gt;</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.4.name;&quot;  index=&quot;3&quot;/&gt;</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.5.name;&quot;  index=&quot;4&quot;/&gt;</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.6.name;&quot;  index=&quot;5&quot;/&gt;</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.7.name;&quot;  index=&quot;6&quot;/&gt;</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.8.name;&quot;  index=&quot;7&quot;/&gt;</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.9.name;&quot;  index=&quot;8&quot;/&gt;</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.10.name;&quot; index=&quot;9&quot;/&gt;</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.11.name;&quot; index=&quot;10&quot;/&gt;</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onMonthsPopupCommand(this)&quot; label=&quot;&amp;month.12.name;&quot; index=&quot;11&quot;/&gt;</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-        &lt;xul:menupopup anonid=&quot;years-popup&quot; position=&quot;after_start&quot;</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-                       onpopupshowing=&quot;moveYears('reset', 0); event.stopPropagation();&quot;</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-                       onpopuphidden=&quot;firePopupListHidden();&quot;&gt;</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-          &lt;xul:toolbarbutton class=&quot;scrollbutton-up&quot;</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-                             orient=&quot;vertical&quot;</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-                             oncommand=&quot;moveYears('up', 1);&quot;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-                             onmouseenter=&quot;startScroll('up', 1);&quot;</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-                             onmouseout=&quot;stopScroll();&quot;/&gt;</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-          &lt;xul:menuitem class=&quot;minimonth-list&quot; oncommand=&quot;onYearsPopupCommand(this)&quot;/&gt;</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-          &lt;xul:toolbarbutton class=&quot;scrollbutton-down&quot;</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-                             orient=&quot;vertical&quot;</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-                             oncommand=&quot;moveYears('down', 1);&quot;</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-                             onmouseenter=&quot;startScroll('down', 1);&quot;</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-                             onmouseout=&quot;stopScroll();&quot;/&gt;</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-      &lt;/xul:popupset&gt;</span>
<a href="#l4.119"></a><span id="l4.119">     &lt;/content&gt;</span>
<a href="#l4.120"></a><span id="l4.120">     &lt;implementation&gt;</span>
<a href="#l4.121"></a><span id="l4.121">       &lt;field name=&quot;kMinimonth&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-      &lt;field name=&quot;mPopup&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-      &lt;field name=&quot;mScrollYearsHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-      &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.125"></a><span id="l4.125">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.126"></a><span id="l4.126">           const { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l4.127"></a><span id="l4.127"> </span>
<a href="#l4.128"></a><span id="l4.128">           this.kMinimonth = cal.view.getParentNodeOrThis(this, &quot;minimonth&quot;);</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;back-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;months-back-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;months-forward-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-back-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-forward-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.134"></a><span id="l4.134">           document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;today-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;forward-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-          this.mScrollYearsHandler = this.scrollYears.bind(this);</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;)</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-                  .addEventListener(&quot;wheel&quot;, this.mScrollYearsHandler, true);</span>
<a href="#l4.140"></a><span id="l4.140">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;)</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-                  .removeEventListener(&quot;wheel&quot;, this.mScrollYearsHandler, true);</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-          this.mScrollYearsHandler = null;</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-      &lt;method name=&quot;showPopupList&quot;&gt;</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-        &lt;parameter name=&quot;aPopupAnonId&quot;/&gt;</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-            // Close open popups (if any), to prevent linux crashes</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-            if (this.mPopup) {</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-                this.mPopup.hidePopup();</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-            }</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-            this.mPopup = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, aPopupAnonId);</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-            this.mPopup.openPopup(aEvent.target, &quot;after_start&quot;);</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-      &lt;method name=&quot;hidePopupList&quot;&gt;</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-            // Close open popups (if any)</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-            let popup = this.mPopup;</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-            this.mPopup = null;</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-            if (popup) {</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-                popup.hidePopup();</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-            }</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineminus">-      &lt;method name=&quot;firePopupListHidden&quot;&gt;</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-            if (this.mPopup) {</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-                this.mPopup = null;</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-                this.kMinimonth.fireEvent(&quot;popuplisthidden&quot;);</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineminus">-            }</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-      &lt;method name=&quot;onMonthsPopupCommand&quot;&gt;</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-        &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineminus">-            let popup = cal.view.getParentNodeOrThis(aItem, &quot;menupopup&quot;);</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineminus">-            let triggerNode = popup.triggerNode || popup.anchorNode;</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-            let deck = triggerNode.parentNode;</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-            this.hidePopupList();</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-            this.kMinimonth.switchMonth(aItem.getAttribute(&quot;index&quot;));</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineminus">-</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineminus">-            deck.childNodes[deck.selectedIndex].focus();</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineminus">-</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-      &lt;method name=&quot;onYearsPopupCommand&quot;&gt;</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineminus">-        &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-            this.hidePopupList();</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-            let value = aItem.getAttribute(&quot;label&quot;);</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-            if (value) {</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-                this.kMinimonth.switchYear(value);</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-            }</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-      &lt;method name=&quot;updateMonthPopup&quot;&gt;</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-            let months = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;months-popup&quot;).childNodes;</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-            let month = aDate.getMonth();</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-            for (let i = 0; i &lt; months.length; i++) {</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-                months[i].setAttribute(&quot;current&quot;, i == month ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-            }</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineminus">-</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineminus">-      &lt;method name=&quot;updateYearPopup&quot;&gt;</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineminus">-        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineminus">-            let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).childNodes;</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-            let year = new Date(aDate);</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-            let compFullYear = aDate.getFullYear();</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineminus">-            year.setFullYear(Math.max(1, compFullYear - Math.trunc(years.length / 2) + 1));</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineminus">-            for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineminus">-                let curfullYear = year.getFullYear();</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineminus">-                years[i].setAttribute(&quot;label&quot;, curfullYear);</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineminus">-                years[i].setAttribute(&quot;current&quot;, curfullYear == compFullYear ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-                year.setFullYear(curfullYear + 1);</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineminus">-            }</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-      &lt;method name=&quot;scrollYears&quot;&gt;</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-            let yearPopup = cal.view.getParentNodeOrThis(event.target, &quot;menupopup&quot;);</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-            const pixelThreshold = 75;</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-            if (yearPopup) {</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-                let monthList = yearPopup.getElementsByAttribute(&quot;class&quot;, &quot;minimonth-list&quot;);</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-                if (monthList &amp;&amp; monthList.length &gt; 0) {</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-                    if (event.deltaMode == event.DOM_DELTA_PAGE) {</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-                        let dir = event.deltaY &gt; 0 ? &quot;up&quot; : &quot;down&quot;;</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-                        this.moveYears(dir, Math.abs(event.deltaY) * monthList.length);</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineminus">-                    } else if (event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineminus">-                        let dir = event.deltaY &gt; 0 ? &quot;up&quot; : &quot;down&quot;;</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-                        this.moveYears(dir, 1);</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-                    } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineminus">-                        this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-                        if (this.mPixelScrollDelta &gt; pixelThreshold) {</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-                            this.moveYears(&quot;down&quot;, 1);</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-                            this.mPixelScrollDelta = 0;</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-                        } else if (this.mPixelScrollDelta &lt; -pixelThreshold) {</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-                            this.moveYears(&quot;up&quot;, 1);</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-                            this.mPixelScrollDelta = 0;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-                        }</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-                    }</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineminus">-</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-                    event.stopPropagation();</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-                    event.preventDefault();</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-                }</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-            }</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-      &lt;method name=&quot;startScroll&quot;&gt;</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-        &lt;parameter name=&quot;direction&quot;/&gt;</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-        &lt;parameter name=&quot;scrollOffset&quot;/&gt;</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-            this.scrollInterval = setInterval(() =&gt; {</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-                this.moveYears(direction, scrollOffset);</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-            }, 50);</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-      &lt;method name=&quot;stopScroll&quot;&gt;</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-            clearInterval(this.scrollInterval);</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-      &lt;method name=&quot;moveYears&quot;&gt;</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-        &lt;parameter name=&quot;direction&quot;/&gt;</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-        &lt;parameter name=&quot;scrollOffset&quot;/&gt;</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">-            // Update the year popup</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">-            let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).childNodes;</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-            let current = this.getAttribute(&quot;year&quot;);</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-            let offset;</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-            switch (direction) {</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-                case &quot;reset&quot;: {</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-                    let middleyear = years[Math.floor(years.length / 2)].getAttribute(&quot;label&quot;);</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-                    if (current &lt;= (years.length / 2)) {</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-                        offset = 1 - years[1].getAttribute(&quot;label&quot;);</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-                    } else {</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-                        offset = current - middleyear;</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-                    }</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-                    break;</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-                }</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-                case &quot;up&quot;: {</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-                    offset = -Math.abs(scrollOffset) || -1;</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-                    break;</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-                }</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-                case &quot;down&quot;: {</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-                    offset = Math.abs(scrollOffset) || 1;</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-                    break;</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-                }</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-            }</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-            // Disable the up arrow when we get to the year 1.</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-            years[0].disabled = parseInt(years[1].getAttribute(&quot;label&quot;), 10) + offset &lt; 2;</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-            if (!offset) {</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-                // No need to loop through when the offset is zero.</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-                return;</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-            }</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-            // Go through all visible years and set the new value. Be sure to</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-            // skip the scrollbuttons.</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-            for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-                let value = parseInt(years[i].getAttribute(&quot;label&quot;), 10) + offset;</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-                years[i].setAttribute(&quot;label&quot;, value);</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-                years[i].setAttribute(&quot;current&quot;, value == current ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-            }</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.326"></a><span id="l4.326">     &lt;/implementation&gt;</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineminus">-</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-      &lt;handler event=&quot;bindingattached&quot; action=&quot;this.initialize();&quot;/&gt;</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l4.331"></a><span id="l4.331">   &lt;/binding&gt;</span>
<a href="#l4.332"></a><span id="l4.332"> </span>
<a href="#l4.333"></a><span id="l4.333">   &lt;binding id=&quot;minimonth&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l4.334"></a><span id="l4.334">     &lt;content orient=&quot;vertical&quot; xbl:inherits=&quot;onchange,onmonthchange,onpopuplisthidden,readonly&quot; role=&quot;group&quot;&gt;</span>
<a href="#l4.335"></a><span id="l4.335">       &lt;xul:minimonth-header anonid=&quot;minimonth-header&quot; xbl:inherits=&quot;readonly,month,year&quot;/&gt;</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineplus">+      &lt;xul:hbox anonid=&quot;minimonth-readonly-header&quot; class=&quot;minimonth-month-box&quot; align=&quot;center&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+        &lt;xul:text anonid=&quot;minimonth-readonly-header-text&quot;/&gt;</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineplus">+      &lt;/xul:hbox&gt;</span>
<a href="#l4.339"></a><span id="l4.339">       &lt;html:table anonid=&quot;minimonth-calendar&quot; class=&quot;minimonth-cal-box&quot;&gt;</span>
<a href="#l4.340"></a><span id="l4.340">         &lt;html:tr class=&quot;minimonth-row-head&quot; anonid=&quot;minimonth-row-header&quot;&gt;</span>
<a href="#l4.341"></a><span id="l4.341">           &lt;html:th class=&quot;minimonth-row-header-week&quot; scope=&quot;col&quot;/&gt;</span>
<a href="#l4.342"></a><span id="l4.342">           &lt;html:th class=&quot;minimonth-row-header&quot; scope=&quot;col&quot;/&gt;</span>
<a href="#l4.343"></a><span id="l4.343">           &lt;html:th class=&quot;minimonth-row-header&quot; scope=&quot;col&quot;/&gt;</span>
<a href="#l4.344"></a><span id="l4.344">           &lt;html:th class=&quot;minimonth-row-header&quot; scope=&quot;col&quot;/&gt;</span>
<a href="#l4.345"></a><span id="l4.345">           &lt;html:th class=&quot;minimonth-row-header&quot; scope=&quot;col&quot;/&gt;</span>
<a href="#l4.346"></a><span id="l4.346">           &lt;html:th class=&quot;minimonth-row-header&quot; scope=&quot;col&quot;/&gt;</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineat">@@ -440,16 +190,22 @@</span>
<a href="#l4.348"></a><span id="l4.348">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.349"></a><span id="l4.349">             let date = this._getCalBoxNode(6, 7).date;</span>
<a href="#l4.350"></a><span id="l4.350">             let lastDateTime = cal.dtz.jsDateToDateTime(date);</span>
<a href="#l4.351"></a><span id="l4.351">             lastDateTime.day = lastDateTime.day + 1;</span>
<a href="#l4.352"></a><span id="l4.352">             return lastDateTime;</span>
<a href="#l4.353"></a><span id="l4.353">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.354"></a><span id="l4.354">       &lt;/property&gt;</span>
<a href="#l4.355"></a><span id="l4.355"> </span>
<a href="#l4.356"></a><span id="l4.356" class="difflineplus">+      &lt;property name=&quot;mReadOnlyHeaderText&quot;&gt;</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineplus">+            return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-readonly-header-text&quot;);</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineplus">+</span>
<a href="#l4.362"></a><span id="l4.362">       &lt;field name=&quot;mDaymap&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.363"></a><span id="l4.363">       &lt;field name=&quot;mValue&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.364"></a><span id="l4.364">       &lt;field name=&quot;mEditorDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.365"></a><span id="l4.365">       &lt;field name=&quot;mExtraDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.366"></a><span id="l4.366">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.367"></a><span id="l4.367">       &lt;field name=&quot;mIsReadOnly&quot;&gt;false&lt;/field&gt;</span>
<a href="#l4.368"></a><span id="l4.368">       &lt;field name=&quot;mObservesComposite&quot;&gt;false&lt;/field&gt;</span>
<a href="#l4.369"></a><span id="l4.369">       &lt;field name=&quot;mShowWeekNumber&quot;&gt;true&lt;/field&gt;</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineat">@@ -867,22 +623,21 @@</span>
<a href="#l4.371"></a><span id="l4.371">             if (this.mExtra) {</span>
<a href="#l4.372"></a><span id="l4.372">                 this.mExtra.removeAttribute(&quot;extra&quot;);</span>
<a href="#l4.373"></a><span id="l4.373">                 this.mExtra = null;</span>
<a href="#l4.374"></a><span id="l4.374">             }</span>
<a href="#l4.375"></a><span id="l4.375"> </span>
<a href="#l4.376"></a><span id="l4.376">             // Update the month and year title</span>
<a href="#l4.377"></a><span id="l4.377">             this.setAttribute(&quot;month&quot;, aDate.getMonth());</span>
<a href="#l4.378"></a><span id="l4.378">             this.setAttribute(&quot;year&quot;, aDate.getFullYear());</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-            if (!this.mIsReadOnly) {</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-                // Update the month popup</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-                let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-header&quot;);</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-                header.updateYearPopup(aDate);</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineminus">-                header.updateMonthPopup(aDate);</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineminus">-            }</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineplus">+            this.mReadOnlyHeaderText.setAttribute(&quot;value&quot;,</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineplus">+                cal.l10n.getDateFmtString(`month.${aDate.getMonth() + 1}.name`) +</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineplus">+                &quot; &quot; + aDate.getFullYear()</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineplus">+            );</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineplus">+</span>
<a href="#l4.390"></a><span id="l4.390">             // Update the calendar</span>
<a href="#l4.391"></a><span id="l4.391">             let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l4.392"></a><span id="l4.392">             let date = this._getStartDate(aDate);</span>
<a href="#l4.393"></a><span id="l4.393"> </span>
<a href="#l4.394"></a><span id="l4.394">             // get today's date</span>
<a href="#l4.395"></a><span id="l4.395">             let today = new Date();</span>
<a href="#l4.396"></a><span id="l4.396"> </span>
<a href="#l4.397"></a><span id="l4.397">             if (aDate.getFullYear() == (this.mValue || this.mExtraDate).getFullYear()) {</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineat">@@ -1160,25 +915,16 @@</span>
<a href="#l4.399"></a><span id="l4.399">       &lt;method name=&quot;focusDate&quot;&gt;</span>
<a href="#l4.400"></a><span id="l4.400">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l4.401"></a><span id="l4.401">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.402"></a><span id="l4.402">             this.showMonth(aDate);</span>
<a href="#l4.403"></a><span id="l4.403">             this.setFocusedDate(aDate);</span>
<a href="#l4.404"></a><span id="l4.404">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.405"></a><span id="l4.405">       &lt;/method&gt;</span>
<a href="#l4.406"></a><span id="l4.406"> </span>
<a href="#l4.407"></a><span id="l4.407" class="difflineminus">-      &lt;method name=&quot;hidePopupList&quot;&gt;</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineminus">-            if (!this.mIsReadOnly) {</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineminus">-                let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-header&quot;);</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineminus">-                header.hidePopupList();</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineminus">-            }</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.415"></a><span id="l4.415" class="difflineminus">-</span>
<a href="#l4.416"></a><span id="l4.416">       &lt;method name=&quot;switchMonth&quot;&gt;</span>
<a href="#l4.417"></a><span id="l4.417">         &lt;parameter name=&quot;aMonth&quot;/&gt;</span>
<a href="#l4.418"></a><span id="l4.418">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.419"></a><span id="l4.419">             let newMonth = new Date(this.mEditorDate);</span>
<a href="#l4.420"></a><span id="l4.420">             newMonth.setMonth(aMonth);</span>
<a href="#l4.421"></a><span id="l4.421">             this.showMonth(newMonth);</span>
<a href="#l4.422"></a><span id="l4.422">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.423"></a><span id="l4.423">       &lt;/method&gt;</span>
<a href="#l4.424"></a><span id="l4.424" class="difflineat">@@ -1265,16 +1011,26 @@</span>
<a href="#l4.425"></a><span id="l4.425">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.426"></a><span id="l4.426">             let advEditorDate = new Date(this.mEditorDate); // at 1st of month</span>
<a href="#l4.427"></a><span id="l4.427">             let advMonth = this.mEditorDate.getMonth() + aDir;</span>
<a href="#l4.428"></a><span id="l4.428">             advEditorDate.setMonth(advMonth);</span>
<a href="#l4.429"></a><span id="l4.429">             this.showMonth(advEditorDate);</span>
<a href="#l4.430"></a><span id="l4.430">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.431"></a><span id="l4.431">       &lt;/method&gt;</span>
<a href="#l4.432"></a><span id="l4.432"> </span>
<a href="#l4.433"></a><span id="l4.433" class="difflineplus">+      &lt;method name=&quot;advanceYear&quot;&gt;</span>
<a href="#l4.434"></a><span id="l4.434" class="difflineplus">+        &lt;parameter name=&quot;aDir&quot;/&gt;</span>
<a href="#l4.435"></a><span id="l4.435" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.436"></a><span id="l4.436" class="difflineplus">+            let advEditorDate = new Date(this.mEditorDate); // at 1st of month</span>
<a href="#l4.437"></a><span id="l4.437" class="difflineplus">+            let advYear = this.mEditorDate.getFullYear() + aDir;</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineplus">+            advEditorDate.setFullYear(advYear);</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineplus">+            this.showMonth(advEditorDate);</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineplus">+</span>
<a href="#l4.443"></a><span id="l4.443">       &lt;method name=&quot;moveByOffset&quot;&gt;</span>
<a href="#l4.444"></a><span id="l4.444">         &lt;parameter name=&quot;aYears&quot;/&gt;</span>
<a href="#l4.445"></a><span id="l4.445">         &lt;parameter name=&quot;aMonths&quot;/&gt;</span>
<a href="#l4.446"></a><span id="l4.446">         &lt;parameter name=&quot;aDays&quot;/&gt;</span>
<a href="#l4.447"></a><span id="l4.447">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.448"></a><span id="l4.448">             let day = new Date(this.mFocused.date.getFullYear() + aYears,</span>
<a href="#l4.449"></a><span id="l4.449">                                this.mFocused.date.getMonth() + aMonths,</span>
<a href="#l4.450"></a><span id="l4.450">                                this.mFocused.date.getDate() + aDays);</span>
<a href="#l4.451"></a><span id="l4.451" class="difflineat">@@ -1341,17 +1097,28 @@</span>
<a href="#l4.452"></a><span id="l4.452">                   this.mPixelScrollDelta = 0;</span>
<a href="#l4.453"></a><span id="l4.453">               } else if (this.mPixelScrollDelta &lt; -pixelThreshold) {</span>
<a href="#l4.454"></a><span id="l4.454">                   deltaView = -1;</span>
<a href="#l4.455"></a><span id="l4.455">                   this.mPixelScrollDelta = 0;</span>
<a href="#l4.456"></a><span id="l4.456">               }</span>
<a href="#l4.457"></a><span id="l4.457">           }</span>
<a href="#l4.458"></a><span id="l4.458"> </span>
<a href="#l4.459"></a><span id="l4.459">           if (deltaView != 0) {</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-              this.advanceMonth(deltaView);</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineplus">+              switch (event.originalTarget.getAttribute(&quot;anonid&quot;)) {</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineplus">+                  case &quot;today-button&quot;:</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineplus">+                      break;</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineplus">+                  case &quot;years-forward-button&quot;:</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineplus">+                  case &quot;yearcell&quot;:</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineplus">+                  case &quot;years-back-button&quot;:</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineplus">+                      this.advanceYear(deltaView);</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineplus">+                      break;</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineplus">+                  default:</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineplus">+                      this.advanceMonth(deltaView);</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineplus">+                      break;</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineplus">+              }</span>
<a href="#l4.473"></a><span id="l4.473">           }</span>
<a href="#l4.474"></a><span id="l4.474"> </span>
<a href="#l4.475"></a><span id="l4.475">           event.stopPropagation();</span>
<a href="#l4.476"></a><span id="l4.476">           event.preventDefault();</span>
<a href="#l4.477"></a><span id="l4.477">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.478"></a><span id="l4.478">       &lt;!-- day handlers --&gt;</span>
<a href="#l4.479"></a><span id="l4.479">       &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_LEFT&quot; modifiers=&quot;control shift any&quot;</span>
<a href="#l4.480"></a><span id="l4.480">                action=&quot;this.onDayMovement(event, 0, 0, -1);&quot; phase=&quot;target&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/themes/common/widgets/images/nav-today.svg</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/themes/common/widgets/images/nav-today.svg</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,10 +1,7 @@</span>
<a href="#l5.4"></a><span id="l5.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-  width=&quot;11&quot; height=&quot;13&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-  &lt;path</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-    d=&quot;m 9.67,6.5 a 4.17,4.1 0 1 1 -8.34,0 4.17,4.1 0 1 1 8.34,0 z&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    style=&quot;fill:none;stroke:context-fill;stroke-width:2;&quot; /&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;12&quot; height=&quot;12&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  &lt;circle cx=&quot;6&quot; cy=&quot;6&quot; r=&quot;4&quot; style=&quot;fill:none;stroke:context-fill;stroke-width:2.25;&quot; /&gt;</span>
<a href="#l5.15"></a><span id="l5.15"> &lt;/svg&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/themes/common/widgets/minimonth.css</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/themes/common/widgets/minimonth.css</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -42,61 +42,60 @@ minimonth {</span>
<a href="#l6.4"></a><span id="l6.4">   --mmDaySelectedTodayBorderColor: ButtonFace;</span>
<a href="#l6.5"></a><span id="l6.5"> }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> minimonth {</span>
<a href="#l6.8"></a><span id="l6.8">   background-color: var(--mmMainBackground);</span>
<a href="#l6.9"></a><span id="l6.9">   border-width: 0;</span>
<a href="#l6.10"></a><span id="l6.10">   color: var(--mmMainColor);</span>
<a href="#l6.11"></a><span id="l6.11">   padding: 4px;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+  min-width: 175px;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+}</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+minimonth:not([readonly=&quot;true&quot;]) [anonid=&quot;minimonth-readonly-header&quot;],</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+minimonth[readonly=&quot;true&quot;] [anonid=&quot;minimonth-header&quot;] {</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+  display: none;</span>
<a href="#l6.18"></a><span id="l6.18"> }</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> .minimonth-month-box {</span>
<a href="#l6.21"></a><span id="l6.21">   background-color: var(--mmBoxBackground);</span>
<a href="#l6.22"></a><span id="l6.22">   border: 1px dotted var(--mmBoxBorderColor);</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+  font-weight: bold;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+  text-align: center;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+  height: 22px;</span>
<a href="#l6.26"></a><span id="l6.26"> }</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28"> .minimonth-month-name {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+  text-align: center;</span>
<a href="#l6.30"></a><span id="l6.30">   font-weight: bold;</span>
<a href="#l6.31"></a><span id="l6.31">   padding: 0px;</span>
<a href="#l6.32"></a><span id="l6.32">   -moz-user-focus: normal;</span>
<a href="#l6.33"></a><span id="l6.33"> }</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-.minimonth-month-name-readonly {</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-  text-align: right;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-  font-weight: bold;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-}</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-</span>
<a href="#l6.40"></a><span id="l6.40"> .minimonth-year-name {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-  min-width: 4em;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+  width: 5ch;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+  text-align: center;</span>
<a href="#l6.44"></a><span id="l6.44">   font-weight: bold;</span>
<a href="#l6.45"></a><span id="l6.45">   padding: 0px;</span>
<a href="#l6.46"></a><span id="l6.46">   -moz-user-focus: normal;</span>
<a href="#l6.47"></a><span id="l6.47"> }</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-.minimonth-year-name-readonly {</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-  min-width: 4em;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-  font-weight: bold;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-  padding-inline-start: 4px;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+.minimonth-nav-btns {</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+  padding: 4px;</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+  list-style-image: url(&quot;chrome://calendar-common/skin/widgets/nav-arrow.svg&quot;);</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+  -moz-user-focus: normal;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+  fill: currentColor;</span>
<a href="#l6.60"></a><span id="l6.60"> }</span>
<a href="#l6.61"></a><span id="l6.61"> </span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-.minimonth-month-name &gt; .toolbarbutton-icon,</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-.minimonth-year-name &gt; .toolbarbutton-icon {</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-  display: none;</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-}</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-.minimonth-nav-btns &gt; .toolbarbutton-icon {</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-  margin: 1px;</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-}</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-.minimonth-nav-btns {</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-  padding: 0px;</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-  min-width: 19px;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-  list-style-image: url(&quot;chrome://calendar-common/skin/widgets/nav-arrow.svg&quot;);</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-  -moz-user-focus: normal;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+.minimonth-nav-btns:active,</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+.minimonth-nav-btns:focus,</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+.minimonth-nav-btns:hover {</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+  background-color: hsla(0,0%,0%,.1);</span>
<a href="#l6.80"></a><span id="l6.80"> }</span>
<a href="#l6.81"></a><span id="l6.81"> </span>
<a href="#l6.82"></a><span id="l6.82"> .minimonth-nav-btns &gt; .toolbarbutton-text  {</span>
<a href="#l6.83"></a><span id="l6.83">   display: none;</span>
<a href="#l6.84"></a><span id="l6.84"> }</span>
<a href="#l6.85"></a><span id="l6.85"> </span>
<a href="#l6.86"></a><span id="l6.86"> .minimonth-nav-btns[disabled] {</span>
<a href="#l6.87"></a><span id="l6.87">   opacity: .3;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -664,27 +664,27 @@ function loadDialog(aItem) {</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">     // Description</span>
<a href="#l7.6"></a><span id="l7.6">     if (gNewItemUI) {</span>
<a href="#l7.7"></a><span id="l7.7">         itemProps.initialDescription = aItem.getProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l7.8"></a><span id="l7.8">     } else {</span>
<a href="#l7.9"></a><span id="l7.9">         setElementValue(&quot;item-description&quot;, aItem.getProperty(&quot;DESCRIPTION&quot;));</span>
<a href="#l7.10"></a><span id="l7.10">     }</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    // Task completed date</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    if (!gNewItemUI) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-        if (aItem.completedDate) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-            updateToDoStatus(aItem.status, cal.dtz.dateTimeToJsDate(aItem.completedDate));</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-        } else {</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-            updateToDoStatus(aItem.status);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+    if (cal.item.isToDo(aItem)) {</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+        // Task completed date</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+        if (!gNewItemUI) {</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+            if (aItem.completedDate) {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+                updateToDoStatus(aItem.status, cal.dtz.dateTimeToJsDate(aItem.completedDate));</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+            } else {</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+                updateToDoStatus(aItem.status);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+            }</span>
<a href="#l7.26"></a><span id="l7.26">         }</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-    }</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-    // Task percent complete</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-    if (cal.item.isToDo(aItem)) {</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+        // Task percent complete</span>
<a href="#l7.33"></a><span id="l7.33">         let percentCompleteInteger = 0;</span>
<a href="#l7.34"></a><span id="l7.34">         let percentCompleteProperty = aItem.getProperty(&quot;PERCENT-COMPLETE&quot;);</span>
<a href="#l7.35"></a><span id="l7.35">         if (percentCompleteProperty != null) {</span>
<a href="#l7.36"></a><span id="l7.36">             percentCompleteInteger = parseInt(percentCompleteProperty, 10);</span>
<a href="#l7.37"></a><span id="l7.37">         }</span>
<a href="#l7.38"></a><span id="l7.38">         if (percentCompleteInteger &lt; 0) {</span>
<a href="#l7.39"></a><span id="l7.39">             percentCompleteInteger = 0;</span>
<a href="#l7.40"></a><span id="l7.40">         } else if (percentCompleteInteger &gt; 100) {</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -2596,21 +2596,23 @@ function updateCalendar() {</span>
<a href="#l7.42"></a><span id="l7.42">             }</span>
<a href="#l7.43"></a><span id="l7.43">         }</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">         let collapseElements = document.getElementsByAttribute(&quot;collapse-on-readonly&quot;, &quot;true&quot;);</span>
<a href="#l7.46"></a><span id="l7.46">         for (let element of collapseElements) {</span>
<a href="#l7.47"></a><span id="l7.47">             element.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l7.48"></a><span id="l7.48">         }</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-        // Task completed date</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-        if (item.completedDate) {</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-            updateToDoStatus(item.status, cal.dtz.dateTimeToJsDate(item.completedDate));</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-        } else {</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-            updateToDoStatus(item.status);</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+        if (cal.item.isToDo(item)) {</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+            // Task completed date</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+            if (item.completedDate) {</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+                updateToDoStatus(item.status, cal.dtz.dateTimeToJsDate(item.completedDate));</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+            } else {</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+                updateToDoStatus(item.status);</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+            }</span>
<a href="#l7.62"></a><span id="l7.62">         }</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64">         // disable repeat menupopup if this is an occurrence</span>
<a href="#l7.65"></a><span id="l7.65">         item = window.calendarItem;</span>
<a href="#l7.66"></a><span id="l7.66">         if (item.parentItem != item) {</span>
<a href="#l7.67"></a><span id="l7.67">             disableElement(&quot;item-repeat&quot;);</span>
<a href="#l7.68"></a><span id="l7.68">             disableElement(&quot;repeat-until-datepicker&quot;);</span>
<a href="#l7.69"></a><span id="l7.69">             let repeatDetails = document.getElementById(&quot;repeat-details&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -13,17 +13,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/widgets/calendar-widget-bindings.css&quot;?&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/skin/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l8.6"></a><span id="l8.6"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l8.7"></a><span id="l8.7"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar/content/datetimepickers/datetimepickers.css&quot;?&gt;</span>
<a href="#l8.8"></a><span id="l8.8"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://lightning-common/skin/datetimepickers.css&quot;?&gt;</span>
<a href="#l8.9"></a><span id="l8.9"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/skin/primaryToolbar.css&quot;?&gt;</span>
<a href="#l8.10"></a><span id="l8.10"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/skin/messenger.css&quot;?&gt;</span>
<a href="#l8.11"></a><span id="l8.11"> &lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://calendar-common/skin/dialogs/calendar-event-dialog.css&quot;?&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+&lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;chrome://messenger/content/menulist.css&quot;?&gt;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> &lt;!DOCTYPE window [</span>
<a href="#l8.16"></a><span id="l8.16">     &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot;&gt;</span>
<a href="#l8.17"></a><span id="l8.17">     &lt;!ENTITY % globalDTD SYSTEM &quot;chrome://calendar/locale/global.dtd&quot;&gt;</span>
<a href="#l8.18"></a><span id="l8.18">     &lt;!ENTITY % calendarDTD SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot;&gt;</span>
<a href="#l8.19"></a><span id="l8.19">     &lt;!ENTITY % eventDialogDTD SYSTEM &quot;chrome://calendar/locale/calendar-event-dialog.dtd&quot;&gt;</span>
<a href="#l8.20"></a><span id="l8.20">     %brandDTD;</span>
<a href="#l8.21"></a><span id="l8.21">     %globalDTD;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -49,16 +49,20 @@</span>
<a href="#l8.23"></a><span id="l8.23">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.24"></a><span id="l8.24">           src=&quot;chrome://calendar/content/calApplicationUtils.js&quot;/&gt;</span>
<a href="#l8.25"></a><span id="l8.25">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.26"></a><span id="l8.26">           src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l8.27"></a><span id="l8.27">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.28"></a><span id="l8.28">           src=&quot;chrome://global/content/printUtils.js&quot;/&gt;</span>
<a href="#l8.29"></a><span id="l8.29">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.30"></a><span id="l8.30">           src=&quot;chrome://calendar/content/calendar-statusbar.js&quot;/&gt;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+          src=&quot;chrome://messenger/content/customElements.js&quot;/&gt;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+          src=&quot;chrome://calendar/content/datetimepickers/datetimepickers.js&quot;/&gt;</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   &lt;commandset id=&quot;&quot;&gt;</span>
<a href="#l8.37"></a><span id="l8.37">     &lt;command id=&quot;cmd_recurrence&quot;</span>
<a href="#l8.38"></a><span id="l8.38">              oncommand=&quot;editRepeat();&quot;/&gt;</span>
<a href="#l8.39"></a><span id="l8.39">     &lt;command id=&quot;cmd_attendees&quot;</span>
<a href="#l8.40"></a><span id="l8.40">              oncommand=&quot;editAttendees();&quot;/&gt;</span>
<a href="#l8.41"></a><span id="l8.41">     &lt;command id=&quot;cmd_email&quot;</span>
<a href="#l8.42"></a><span id="l8.42">              oncommand=&quot;sendMailToAttendees(window.attendees);&quot;/&gt;</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineat">@@ -421,21 +425,21 @@</span>
<a href="#l8.44"></a><span id="l8.44">             &lt;/menupopup&gt;</span>
<a href="#l8.45"></a><span id="l8.45">           &lt;/menulist&gt;</span>
<a href="#l8.46"></a><span id="l8.46">           &lt;deck id=&quot;repeat-deck&quot; selectedIndex=&quot;-1&quot;&gt;</span>
<a href="#l8.47"></a><span id="l8.47">             &lt;hbox id=&quot;repeat-untilDate&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.48"></a><span id="l8.48">                 &lt;label value=&quot;&amp;event.until.label;&quot;</span>
<a href="#l8.49"></a><span id="l8.49">                        accesskey=&quot;&amp;event.until.accesskey;&quot;</span>
<a href="#l8.50"></a><span id="l8.50">                        control=&quot;repeat-until-datepicker&quot;</span>
<a href="#l8.51"></a><span id="l8.51">                        disable-on-readonly=&quot;true&quot;/&gt;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-                &lt;datepicker-forever id=&quot;repeat-until-datepicker&quot; flex=&quot;1&quot;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-                                    disable-on-readonly=&quot;true&quot;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-                                    onchange=&quot;checkUntilDate();&quot;</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-                                    oncommand=&quot;checkUntilDate();&quot;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-                                    value=&quot;&quot;/&gt;</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+                &lt;datepicker id=&quot;repeat-until-datepicker&quot; flex=&quot;1&quot;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+                            type=&quot;forever&quot;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+                            disable-on-readonly=&quot;true&quot;</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+                            oncommand=&quot;checkUntilDate();&quot;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+                            value=&quot;&quot;/&gt;</span>
<a href="#l8.62"></a><span id="l8.62">             &lt;/hbox&gt;</span>
<a href="#l8.63"></a><span id="l8.63">             &lt;vbox id=&quot;repeat-details&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l8.64"></a><span id="l8.64">                 &lt;label id=&quot;repeat-details-label&quot;</span>
<a href="#l8.65"></a><span id="l8.65">                        class=&quot;text-link&quot;</span>
<a href="#l8.66"></a><span id="l8.66">                        crop=&quot;right&quot;</span>
<a href="#l8.67"></a><span id="l8.67">                        disable-on-readonly=&quot;true&quot;</span>
<a href="#l8.68"></a><span id="l8.68">                        hyperlink=&quot;true&quot;</span>
<a href="#l8.69"></a><span id="l8.69">                        flex=&quot;1&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/lightning/jar.mn</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/lightning/jar.mn</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -102,16 +102,17 @@ lightning.jar:</span>
<a href="#l9.4"></a><span id="l9.4">     ../skin/windows/lightning/lightning.css                   (themes/windows/lightning.css)</span>
<a href="#l9.5"></a><span id="l9.5">     ../skin/windows/lightning/lightning-toolbar.css           (themes/windows/lightning-toolbar.css)</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> calendar.jar:</span>
<a href="#l9.8"></a><span id="l9.8">     content/calendar/calendarCreation.xul                  (../resources/content/calendarCreation.xul)</span>
<a href="#l9.9"></a><span id="l9.9">     content/calendar/calendarCreation.js                   (../resources/content/calendarCreation.js)</span>
<a href="#l9.10"></a><span id="l9.10">     content/calendar/datetimepickers/datetimepickers.css   (../resources/content/datetimepickers/datetimepickers.css)</span>
<a href="#l9.11"></a><span id="l9.11">     content/calendar/datetimepickers/datetimepickers.xml   (../resources/content/datetimepickers/datetimepickers.xml)</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+    content/calendar/datetimepickers/datetimepickers.js    (../resources/content/datetimepickers/datetimepickers.js)</span>
<a href="#l9.13"></a><span id="l9.13">     content/calendar/mouseoverPreviews.js                  (../resources/content/mouseoverPreviews.js)</span>
<a href="#l9.14"></a><span id="l9.14">     content/calendar/publish.js                            (../resources/content/publish.js)</span>
<a href="#l9.15"></a><span id="l9.15">     content/calendar/publishDialog.js                      (../resources/content/publishDialog.js)</span>
<a href="#l9.16"></a><span id="l9.16">     content/calendar/publishDialog.xul                     (../resources/content/publishDialog.xul)</span>
<a href="#l9.17"></a><span id="l9.17">     content/calendar/sound.wav                             (../resources/content/sound.wav)</span>
<a href="#l9.18"></a><span id="l9.18">     ../skin/lightning-common/datetimepickers.css           (../resources/skin/datetimepickers.css)</span>
<a href="#l9.19"></a><span id="l9.19">     ../skin/lightning-common/dialogOverlay.css             (../resources/skin/dialogOverlay.css)</span>
<a href="#l9.20"></a><span id="l9.20">     ../skin/lightning-common/imip.css                      (themes/common/imip.css)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/global.dtd</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/global.dtd</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -41,12 +41,14 @@</span>
<a href="#l10.4"></a><span id="l10.4"> &lt;!ENTITY month.8.name &quot;August&quot; &gt;</span>
<a href="#l10.5"></a><span id="l10.5"> &lt;!ENTITY month.9.name &quot;September&quot; &gt;</span>
<a href="#l10.6"></a><span id="l10.6"> &lt;!ENTITY month.10.name &quot;October&quot; &gt;</span>
<a href="#l10.7"></a><span id="l10.7"> &lt;!ENTITY month.11.name &quot;November&quot; &gt;</span>
<a href="#l10.8"></a><span id="l10.8"> &lt;!ENTITY month.12.name &quot;December&quot; &gt;</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> &lt;!ENTITY onemonthbackward.tooltip &quot;One Month Back&quot; &gt;</span>
<a href="#l10.11"></a><span id="l10.11"> &lt;!ENTITY onemonthforward.tooltip &quot;One Month Forward&quot; &gt;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+&lt;!ENTITY oneyearbackward.tooltip &quot;One Year Back&quot; &gt;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+&lt;!ENTITY oneyearforward.tooltip &quot;One Year Forward&quot; &gt;</span>
<a href="#l10.14"></a><span id="l10.14"> &lt;!ENTITY showToday.tooltip &quot;Go to Today&quot;&gt;</span>
<a href="#l10.15"></a><span id="l10.15"> &lt;!ENTITY onedayforward.tooltip &quot;One Day Forward&quot;&gt;</span>
<a href="#l10.16"></a><span id="l10.16"> &lt;!ENTITY onedaybackward.tooltip &quot;One Day Backward&quot;&gt;</span>
<a href="#l10.17"></a><span id="l10.17"> &lt;!ENTITY showselectedday.tooltip &quot;Show events for selected day&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-lightning-item-iframe.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-lightning-item-iframe.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -45,17 +45,18 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l11.4"></a><span id="l11.4">         for (let id of hideForTaskIds) {</span>
<a href="#l11.5"></a><span id="l11.5">             let node = document.getElementById(id);</span>
<a href="#l11.6"></a><span id="l11.6">             if (node) {</span>
<a href="#l11.7"></a><span id="l11.7">                 node.hidden = isGoogleTask;</span>
<a href="#l11.8"></a><span id="l11.8">             }</span>
<a href="#l11.9"></a><span id="l11.9">         }</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">         let duedate = document.getElementById(&quot;todo-duedate&quot;);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        let duetime = document.getAnonymousElementByAttribute(duedate, &quot;anonid&quot;, &quot;time-picker&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+        let duetime = duedate._timepicker || // From Lightning 6.9 onwards</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+            document.getAnonymousElementByAttribute(duedate, &quot;anonid&quot;, &quot;time-picker&quot;);</span>
<a href="#l11.15"></a><span id="l11.15">         duetime.style.display = isGoogleTask ? &quot;none&quot; : &quot;&quot;;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">         if (gEndTime) {</span>
<a href="#l11.18"></a><span id="l11.18">             if (isGoogleTask) {</span>
<a href="#l11.19"></a><span id="l11.19">                 let floating = cal.dtz.floating;</span>
<a href="#l11.20"></a><span id="l11.20">                 if (gEndTimezone != floating) {</span>
<a href="#l11.21"></a><span id="l11.21">                     gOldEndTimezone = gEndTimezone;</span>
<a href="#l11.22"></a><span id="l11.22">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.css</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.css</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -3,36 +3,20 @@</span>
<a href="#l12.4"></a><span id="l12.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> @import url(&quot;chrome://messenger/content/menulist.css&quot;);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> menulist[type=&quot;panel&quot;] {</span>
<a href="#l12.9"></a><span id="l12.9">   -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#panellist&quot;);</span>
<a href="#l12.10"></a><span id="l12.10"> }</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-datepicker {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datepicker&quot;);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-}</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-datepicker-forever {</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-  -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datepicker-forever&quot;);</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-}</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-datetimepicker {</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-  -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker&quot;);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-}</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-</span>
<a href="#l12.24"></a><span id="l12.24"> datetextpicker {</span>
<a href="#l12.25"></a><span id="l12.25">   -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetextpicker&quot;);</span>
<a href="#l12.26"></a><span id="l12.26"> }</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-timepicker {</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-  -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#timepicker&quot;);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-}</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-</span>
<a href="#l12.32"></a><span id="l12.32"> timepicker-grids {</span>
<a href="#l12.33"></a><span id="l12.33">   -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#timepicker-grids&quot;);</span>
<a href="#l12.34"></a><span id="l12.34"> }</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36"> timepicker-minute {</span>
<a href="#l12.37"></a><span id="l12.37">   -moz-binding: url(&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#timepicker-minute&quot;);</span>
<a href="#l12.38"></a><span id="l12.38"> }</span>
<a href="#l12.39"></a><span id="l12.39"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.js</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,720 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+ * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+customElements.whenDefined(&quot;menulist-editable&quot;).then(() =&gt; {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+    class CalendarDatePicker extends MozXULElement {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        connectedCallback() {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+            if (this.delayConnectedCallback()) {</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+                return;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+            }</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+            this.prepend(CalendarDatePicker.fragment.cloneNode(true));</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+            this._menulist = this.querySelector(&quot;.datepicker-menulist&quot;);</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+            this._inputField = this._menulist._inputField;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+            this._popup = this._menulist.menupopup;</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+            this._minimonth = this.querySelector(&quot;minimonth&quot;);</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+            if (this.getAttribute(&quot;type&quot;) == &quot;forever&quot;) {</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+                this._valueIsForever = false;</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+                this._foreverString =</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+                    cal.l10n.getString(&quot;calendar-event-dialog&quot;, &quot;eventRecurrenceForeverLabel&quot;);</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+                this._foreverItem = document.createElement(&quot;button&quot;);</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+                this._foreverItem.setAttribute(&quot;label&quot;, this._foreverString);</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+                this._popup.appendChild(document.createElement(&quot;menuseparator&quot;));</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+                this._popup.appendChild(this._foreverItem);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+                this._foreverItem.addEventListener(&quot;command&quot;, () =&gt; {</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+                    this._inputBoxValue = &quot;forever&quot;;</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+                    this._valueIsForever = true;</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+                    this._popup.hidePopup();</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+                });</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+            }</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+            this.value = this.getAttribute(&quot;value&quot;) || new Date();</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+            // Other attributes handled in inheritedAttributes.</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+            this._handleMutation = (mutations) =&gt; {</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+                this.value = this.getAttribute(&quot;value&quot;);</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+            };</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+            this._attributeObserver = new MutationObserver(this._handleMutation);</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+            this._attributeObserver.observe(this, {</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+                attributes: true,</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+                attributeFilter: [&quot;value&quot;],</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+            });</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+            this._inputField.addEventListener(&quot;change&quot;, () =&gt; {</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+                let value = parseDateTime(this._inputBoxValue);</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+                if (!value) {</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+                    this._inputBoxValue = this._minimonthValue;</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+                    return;</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+                }</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+                this._inputBoxValue = this._minimonthValue = value;</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+                this._valueIsForever = false;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+                this.dispatchEvent(new CustomEvent(&quot;change&quot;));</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+            });</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+            this._popup.addEventListener(&quot;popupshown&quot;, () =&gt; {</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+                this._minimonth.focusDate(this._minimonthValue);</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+                let calendar = document.getAnonymousElementByAttribute(</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+                    this._minimonth, &quot;anonid&quot;, &quot;minimonth-calendar&quot;</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+                );</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+                calendar.querySelector(&quot;td[selected]&quot;).focus();</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+            });</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+            this._minimonth.addEventListener(&quot;select&quot;, () =&gt; {</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+                this._inputBoxValue = this._minimonthValue;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+                this._valueIsForever = false;</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+                this._popup.hidePopup();</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+                this.dispatchEvent(new CustomEvent(&quot;change&quot;));</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+            });</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+        }</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+        disconnectedCallback() {</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+            super.disconnectedCallback();</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+            this._attributeObserver.disconnect();</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+            if (this._menulist) {</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+                this._menulist.remove();</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+                this._menulist = null;</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+                this._inputField = null;</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+                this._popup = null;</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+                this._minimonth = null;</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+                this._foreverItem = null;</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+            }</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+        }</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+        static get fragment() {</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+            // Accessibility information of these nodes will be</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+            // presented on XULComboboxAccessible generated from &lt;menulist&gt;;</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+            // hide these nodes from the accessibility tree.</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+            let frag = document.importNode(MozXULElement.parseXULToFragment(`</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+                &lt;menulist is=&quot;menulist-editable&quot; class=&quot;datepicker-menulist&quot; editable=&quot;true&quot; sizetopopup=&quot;false&quot;&gt;</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+                    &lt;menupopup ignorekeys=&quot;true&quot; popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;&gt;</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+                        &lt;minimonth tabindex=&quot;0&quot;/&gt;</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+                    &lt;/menupopup&gt;</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+                &lt;/menulist&gt;</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+            `), true);</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+            Object.defineProperty(this, &quot;fragment&quot;, { value: frag });</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+            return frag;</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+        }</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+        static get inheritedAttributes() {</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+            return { &quot;.datepicker-menulist&quot;: &quot;disabled&quot; };</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+        }</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+        set value(val) {</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+            if (this.getAttribute(&quot;type&quot;) == &quot;forever&quot; &amp;&amp; val == &quot;forever&quot;) {</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+                this._valueIsForever = true;</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+            } else if (typeof val == &quot;string&quot;) {</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+                val = parseDateTime(val);</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+            }</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+            this._inputBoxValue = this._minimonthValue = val;</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+        }</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+        get value() {</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineplus">+            if (this._valueIsForever) {</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineplus">+                return &quot;forever&quot;;</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineplus">+            }</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+            return this._minimonth.value;</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+        }</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineplus">+</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+        set _inputBoxValue(val) {</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+            if (val == &quot;forever&quot;) {</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+                this._inputField.value = this._foreverString;</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+                return;</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+            }</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+            this._inputField.value = formatDate(val);</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+        }</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+        get _inputBoxValue() {</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+            return this._inputField.value;</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+        }</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+        set _minimonthValue(val) {</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+            if (val == &quot;forever&quot;) {</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+                return;</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+            }</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+            this._minimonth.value = val;</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+        }</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+        get _minimonthValue() {</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+            return this._minimonth.value;</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+        }</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+    }</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineplus">+    const MozXULMenuElement = MozElementMixin(XULMenuElement);</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineplus">+    const MenuBaseControl = BaseControlMixin(MozXULMenuElement);</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+    MenuBaseControl.implementCustomInterface(CalendarDatePicker, [</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineplus">+        Ci.nsIDOMXULMenuListElement,</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineplus">+        Ci.nsIDOMXULSelectControlElement</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineplus">+    ]);</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+    class CalendarTimePicker extends MozXULElement {</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+        connectedCallback() {</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineplus">+            if (this.delayConnectedCallback()) {</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+                return;</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+            }</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+            this.prepend(CalendarTimePicker.fragment.cloneNode(true));</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+            this._menulist = this.firstElementChild;</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineplus">+            this._inputField = this._menulist._inputField;</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineplus">+            this._popup = this._menulist.menupopup;</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineplus">+            this._grid = this._popup.firstElementChild;</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineplus">+            this.value = this.getAttribute(&quot;value&quot;) || new Date();</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineplus">+</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+            // Other attributes handled in inheritedAttributes.</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineplus">+            this._handleMutation = (mutations) =&gt; {</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineplus">+                this.value = this.getAttribute(&quot;value&quot;);</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+            };</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineplus">+            this._attributeObserver = new MutationObserver(this._handleMutation);</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineplus">+            this._attributeObserver.observe(this, {</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineplus">+                attributes: true,</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+                attributeFilter: [&quot;value&quot;],</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineplus">+            });</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+            this._inputField.addEventListener(&quot;change&quot;, () =&gt; {</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+                let value = parseTime(this._inputBoxValue);</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+                if (!value) {</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+                    this._inputBoxValue = this._gridValue;</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineplus">+                    return;</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineplus">+                }</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+                this._inputBoxValue = this._gridValue = value;</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineplus">+                this.dispatchEvent(new CustomEvent(&quot;change&quot;));</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+            });</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineplus">+            this._menulist.menupopup.addEventListener(&quot;popupshowing&quot;, () =&gt; {</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+                this._grid.onPopupShowing();</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+            });</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineplus">+            this._grid.addEventListener(&quot;select&quot;, (event) =&gt; {</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineplus">+                this._inputBoxValue = this._gridValue;</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+                this._popup.hidePopup();</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+            });</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+        }</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineplus">+</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineplus">+        disconnectedCallback() {</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+            super.disconnectedCallback();</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineplus">+</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineplus">+            this._attributeObserver.disconnect();</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineplus">+            if (this._menulist) {</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineplus">+                this._menulist.remove();</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineplus">+                this._menulist = null;</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineplus">+                this._inputField = null;</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineplus">+                this._popup = null;</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+                this._grid = null;</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineplus">+            }</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineplus">+        }</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineplus">+</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineplus">+        static get fragment() {</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineplus">+            // Accessibility information of these nodes will be</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+            // presented on XULComboboxAccessible generated from &lt;menulist&gt;;</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineplus">+            // hide these nodes from the accessibility tree.</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineplus">+            let frag = document.importNode(MozXULElement.parseXULToFragment(`</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineplus">+                &lt;menulist is=&quot;menulist-editable&quot; class=&quot;timepicker-menulist&quot; editable=&quot;true&quot; sizetopopup=&quot;false&quot;&gt;</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineplus">+                    &lt;menupopup popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;&gt;</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineplus">+                        &lt;timepicker-grids/&gt;</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineplus">+                    &lt;/menupopup&gt;</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineplus">+                &lt;/menulist&gt;</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineplus">+            `), true);</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineplus">+</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineplus">+            Object.defineProperty(this, &quot;fragment&quot;, { value: frag });</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineplus">+            return frag;</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineplus">+        }</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineplus">+</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineplus">+        static get inheritedAttributes() {</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineplus">+            return { &quot;.timepicker-menulist&quot;: &quot;disabled&quot; };</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineplus">+        }</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineplus">+</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineplus">+        set value(val) {</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineplus">+            if (typeof val == &quot;string&quot;) {</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineplus">+                val = parseTime(val);</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineplus">+            } else if (Array.isArray(val)) {</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineplus">+                let [hours, minutes] = val;</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineplus">+                val = new Date();</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineplus">+                val.setHours(hours);</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineplus">+                val.setMinutes(minutes);</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineplus">+            }</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineplus">+            this._inputBoxValue = this._gridValue = val;</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineplus">+        }</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineplus">+</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineplus">+        get value() {</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineplus">+            return this._gridValue;</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineplus">+        }</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineplus">+</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineplus">+        set _inputBoxValue(val) {</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineplus">+            if (typeof val == &quot;string&quot;) {</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineplus">+                val = parseTime(val);</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineplus">+            } else if (Array.isArray(val)) {</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineplus">+                let [hours, minutes] = val;</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineplus">+                val = new Date();</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineplus">+                val.setHours(hours);</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineplus">+                val.setMinutes(minutes);</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineplus">+            }</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineplus">+            this._inputField.value = formatTime(val);</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineplus">+        }</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineplus">+</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineplus">+        get _inputBoxValue() {</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineplus">+            return this._inputField.value;</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+        }</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineplus">+</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineplus">+        set _gridValue(val) {</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineplus">+            this._grid.value = val;</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineplus">+        }</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineplus">+</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineplus">+        get _gridValue() {</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineplus">+            return this._grid.value;</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineplus">+        }</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineplus">+    }</span>
<a href="#l13.279"></a><span id="l13.279" class="difflineplus">+</span>
<a href="#l13.280"></a><span id="l13.280" class="difflineplus">+    MenuBaseControl.implementCustomInterface(CalendarTimePicker, [</span>
<a href="#l13.281"></a><span id="l13.281" class="difflineplus">+        Ci.nsIDOMXULMenuListElement,</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineplus">+        Ci.nsIDOMXULSelectControlElement</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineplus">+    ]);</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineplus">+</span>
<a href="#l13.285"></a><span id="l13.285" class="difflineplus">+    class CalendarDateTimePicker extends MozXULElement {</span>
<a href="#l13.286"></a><span id="l13.286" class="difflineplus">+        connectedCallback() {</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineplus">+            if (this.delayConnectedCallback()) {</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineplus">+                return;</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineplus">+            }</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineplus">+</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineplus">+            this._datepicker = document.createElement(&quot;datepicker&quot;);</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineplus">+            this._datepicker.classList.add(&quot;datetimepicker-datepicker&quot;);</span>
<a href="#l13.293"></a><span id="l13.293" class="difflineplus">+            this._datepicker.setAttribute(&quot;anonid&quot;, &quot;datepicker&quot;);</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineplus">+            this._timepicker = document.createElement(&quot;timepicker&quot;);</span>
<a href="#l13.295"></a><span id="l13.295" class="difflineplus">+            this._timepicker.classList.add(&quot;datetimepicker-timepicker&quot;);</span>
<a href="#l13.296"></a><span id="l13.296" class="difflineplus">+            this._timepicker.setAttribute(&quot;anonid&quot;, &quot;timepicker&quot;);</span>
<a href="#l13.297"></a><span id="l13.297" class="difflineplus">+            this.appendChild(this._datepicker);</span>
<a href="#l13.298"></a><span id="l13.298" class="difflineplus">+            this.appendChild(this._timepicker);</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineplus">+</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineplus">+            if (this.getAttribute(&quot;value&quot;)) {</span>
<a href="#l13.301"></a><span id="l13.301" class="difflineplus">+                this._datepicker.value = this.getAttribute(&quot;value&quot;);</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineplus">+                this._timepicker.value = this.getAttribute(&quot;value&quot;);</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineplus">+            }</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineplus">+</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineplus">+            this._datepicker.addEventListener(&quot;change&quot;, () =&gt; {</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineplus">+                this.dispatchEvent(new CustomEvent(&quot;change&quot;));</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineplus">+            });</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineplus">+        }</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineplus">+</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineplus">+        disconnectedCallback() {</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineplus">+            super.disconnectedCallback();</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineplus">+</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineplus">+            if (this._datepicker) {</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineplus">+                this._datepicker.remove();</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineplus">+            }</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineplus">+            if (this._timepicker) {</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineplus">+                this._timepicker.remove();</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineplus">+            }</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineplus">+        }</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineplus">+</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineplus">+        static get inheritedAttributes() {</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineplus">+            return {</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineplus">+                &quot;.datetimepicker-datepicker&quot;: &quot;value,disabled,disabled=datepickerdisabled&quot;,</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineplus">+                &quot;.datetimepicker-timepicker&quot;: &quot;value,disabled,disabled=timepickerdisabled&quot;,</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineplus">+            };</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineplus">+        }</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineplus">+</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineplus">+        set value(val) {</span>
<a href="#l13.329"></a><span id="l13.329" class="difflineplus">+            this._datepicker.value = this._timepicker.value = val;</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineplus">+        }</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineplus">+</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineplus">+        get value() {</span>
<a href="#l13.333"></a><span id="l13.333" class="difflineplus">+            let dateValue = this._datepicker.value;</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineplus">+            let [hours, minutes] = this._timepicker.value;</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineplus">+            dateValue.setHours(hours);</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineplus">+            dateValue.setMinutes(minutes);</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineplus">+            dateValue.setSeconds(0);</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineplus">+            dateValue.setMilliseconds(0);</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineplus">+            return dateValue;</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineplus">+        }</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineplus">+    }</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineplus">+</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineplus">+    initDateFormat();</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineplus">+    initTimeFormat();</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineplus">+    customElements.define(&quot;datepicker&quot;, CalendarDatePicker);</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineplus">+    customElements.define(&quot;timepicker&quot;, CalendarTimePicker);</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineplus">+    customElements.define(&quot;datetimepicker&quot;, CalendarDateTimePicker);</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineplus">+});</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineplus">+</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineplus">+/**</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineplus">+ * Parameter aValue may be a date or a date time. Dates are</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineplus">+ * read according to locale/OS setting (d-m-y or m-d-y or ...).</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineplus">+ * (see initDateFormat). Uses parseTime() for times.</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineplus">+ */</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineplus">+function parseDateTime(aValue) {</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineplus">+    this.mLastDateParseIncludedTime = false;</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineplus">+    let tempDate = null;</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineplus">+    if (!this.probeSucceeded) {</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineplus">+        return null; // avoid errors accessing uninitialized data.</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineplus">+    }</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineplus">+</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineplus">+    let year = Number.MIN_VALUE;</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineplus">+    let month = -1;</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineplus">+    let day = -1;</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineplus">+    let timeString = null;</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineplus">+</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineplus">+    if (this.alphaMonths == null) {</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineplus">+        // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineplus">+        // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineplus">+        // which do not match \w, esp. in CJK locales.)</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineplus">+        // (.*)? binds to null if no suffix.</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineplus">+        let parseNumShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)(.*)?$/;</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineplus">+        let dateNumbersArray = parseNumShortDateRegex.exec(aValue);</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineplus">+        if (dateNumbersArray != null) {</span>
<a href="#l13.375"></a><span id="l13.375" class="difflineplus">+            year = Number(dateNumbersArray[this.yearIndex]);</span>
<a href="#l13.376"></a><span id="l13.376" class="difflineplus">+            month = Number(dateNumbersArray[this.monthIndex]) - 1; // 0-based</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineplus">+            day = Number(dateNumbersArray[this.dayIndex]);</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineplus">+            timeString = dateNumbersArray[4];</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineplus">+        }</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineplus">+    } else {</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineplus">+        // SHORT DATE WITH ALPHABETIC MONTH, such as &quot;dd MMM yy&quot; or &quot;MMMM dd, yyyy&quot;</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineplus">+        // (\d+|[^\d\W]) is digits or letters, not both together.</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineplus">+        // Allows 31dec1999 (no delimiters between parts) if OS does (w2k does not).</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineplus">+        // Allows Dec 31, 1999 (comma and space between parts)</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineplus">+        // (Only accepts ASCII month names; JavaScript RegExp does not have an</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineplus">+        // easy way to describe unicode letters short of a HUGE character range</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineplus">+        // regexp derived from the Alphabetic ranges in</span>
<a href="#l13.388"></a><span id="l13.388" class="difflineplus">+        // http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt)</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineplus">+        // (.*)? binds to null if no suffix.</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineplus">+        let parseAlphShortDateRegex = /^\s*(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)(.*)?$/;</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineplus">+        let datePartsArray = parseAlphShortDateRegex.exec(aValue);</span>
<a href="#l13.392"></a><span id="l13.392" class="difflineplus">+        if (datePartsArray != null) {</span>
<a href="#l13.393"></a><span id="l13.393" class="difflineplus">+            year = Number(datePartsArray[this.yearIndex]);</span>
<a href="#l13.394"></a><span id="l13.394" class="difflineplus">+            let monthString = datePartsArray[this.monthIndex].toUpperCase();</span>
<a href="#l13.395"></a><span id="l13.395" class="difflineplus">+            for (let monthIdx = 0; monthIdx &lt; this.alphaMonths.length; monthIdx++) {</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineplus">+                if (monthString == this.alphaMonths[monthIdx]) {</span>
<a href="#l13.397"></a><span id="l13.397" class="difflineplus">+                    month = monthIdx;</span>
<a href="#l13.398"></a><span id="l13.398" class="difflineplus">+                    break;</span>
<a href="#l13.399"></a><span id="l13.399" class="difflineplus">+                }</span>
<a href="#l13.400"></a><span id="l13.400" class="difflineplus">+            }</span>
<a href="#l13.401"></a><span id="l13.401" class="difflineplus">+            day = Number(datePartsArray[this.dayIndex]);</span>
<a href="#l13.402"></a><span id="l13.402" class="difflineplus">+            timeString = datePartsArray[4];</span>
<a href="#l13.403"></a><span id="l13.403" class="difflineplus">+        }</span>
<a href="#l13.404"></a><span id="l13.404" class="difflineplus">+    }</span>
<a href="#l13.405"></a><span id="l13.405" class="difflineplus">+    if (year != Number.MIN_VALUE &amp;&amp; month != -1 &amp;&amp; day != -1) {</span>
<a href="#l13.406"></a><span id="l13.406" class="difflineplus">+        // year, month, day successfully parsed</span>
<a href="#l13.407"></a><span id="l13.407" class="difflineplus">+        if (year &gt;= 0 &amp;&amp; year &lt; 100) {</span>
<a href="#l13.408"></a><span id="l13.408" class="difflineplus">+            // If 0 &lt;= year &lt; 100, treat as 2-digit year (like formatDate):</span>
<a href="#l13.409"></a><span id="l13.409" class="difflineplus">+            //   parse year as up to 30 years in future or 69 years in past.</span>
<a href="#l13.410"></a><span id="l13.410" class="difflineplus">+            //   (Covers 30-year mortgage and most working people's birthdate.)</span>
<a href="#l13.411"></a><span id="l13.411" class="difflineplus">+            // otherwise will be treated as four digit year.</span>
<a href="#l13.412"></a><span id="l13.412" class="difflineplus">+            let currentYear = new Date().getFullYear();</span>
<a href="#l13.413"></a><span id="l13.413" class="difflineplus">+            let currentCentury = currentYear - currentYear % 100;</span>
<a href="#l13.414"></a><span id="l13.414" class="difflineplus">+            year = currentCentury + year;</span>
<a href="#l13.415"></a><span id="l13.415" class="difflineplus">+            if (year &lt; currentYear - 69) {</span>
<a href="#l13.416"></a><span id="l13.416" class="difflineplus">+                year += 100;</span>
<a href="#l13.417"></a><span id="l13.417" class="difflineplus">+            }</span>
<a href="#l13.418"></a><span id="l13.418" class="difflineplus">+            if (year &gt; currentYear + 30) {</span>
<a href="#l13.419"></a><span id="l13.419" class="difflineplus">+                year -= 100;</span>
<a href="#l13.420"></a><span id="l13.420" class="difflineplus">+            }</span>
<a href="#l13.421"></a><span id="l13.421" class="difflineplus">+        }</span>
<a href="#l13.422"></a><span id="l13.422" class="difflineplus">+        // if time is also present, parse it</span>
<a href="#l13.423"></a><span id="l13.423" class="difflineplus">+        let hours = 0;</span>
<a href="#l13.424"></a><span id="l13.424" class="difflineplus">+        let minutes = 0;</span>
<a href="#l13.425"></a><span id="l13.425" class="difflineplus">+        let seconds = 0;</span>
<a href="#l13.426"></a><span id="l13.426" class="difflineplus">+        if (timeString != null) {</span>
<a href="#l13.427"></a><span id="l13.427" class="difflineplus">+            let time = this.parseTime(timeString);</span>
<a href="#l13.428"></a><span id="l13.428" class="difflineplus">+            if (time != null) {</span>
<a href="#l13.429"></a><span id="l13.429" class="difflineplus">+                hours = time.getHours();</span>
<a href="#l13.430"></a><span id="l13.430" class="difflineplus">+                minutes = time.getMinutes();</span>
<a href="#l13.431"></a><span id="l13.431" class="difflineplus">+                seconds = time.getSeconds();</span>
<a href="#l13.432"></a><span id="l13.432" class="difflineplus">+                this.mLastDateParseIncludedTime = true;</span>
<a href="#l13.433"></a><span id="l13.433" class="difflineplus">+            }</span>
<a href="#l13.434"></a><span id="l13.434" class="difflineplus">+        }</span>
<a href="#l13.435"></a><span id="l13.435" class="difflineplus">+        tempDate = new Date(year, month, day, hours, minutes, seconds, 0);</span>
<a href="#l13.436"></a><span id="l13.436" class="difflineplus">+    } // else did not match regex, not a valid date</span>
<a href="#l13.437"></a><span id="l13.437" class="difflineplus">+    return tempDate;</span>
<a href="#l13.438"></a><span id="l13.438" class="difflineplus">+}</span>
<a href="#l13.439"></a><span id="l13.439" class="difflineplus">+</span>
<a href="#l13.440"></a><span id="l13.440" class="difflineplus">+/**</span>
<a href="#l13.441"></a><span id="l13.441" class="difflineplus">+ * Parse a variety of time formats so that cut and paste is likely to work.</span>
<a href="#l13.442"></a><span id="l13.442" class="difflineplus">+ * separator:            ':'         '.'        ' '        symbol        none</span>
<a href="#l13.443"></a><span id="l13.443" class="difflineplus">+ *                       &quot;12:34:56&quot;  &quot;12.34.56&quot; &quot;12 34 56&quot; &quot;12h34m56s&quot;   &quot;123456&quot;</span>
<a href="#l13.444"></a><span id="l13.444" class="difflineplus">+ * seconds optional:     &quot;02:34&quot;     &quot;02.34&quot;    &quot;02 34&quot;    &quot;02h34m&quot;      &quot;0234&quot;</span>
<a href="#l13.445"></a><span id="l13.445" class="difflineplus">+ * minutes optional:     &quot;12&quot;        &quot;12&quot;       &quot;12&quot;       &quot;12h&quot;         &quot;12&quot;</span>
<a href="#l13.446"></a><span id="l13.446" class="difflineplus">+ * 1st hr digit optional:&quot;9:34&quot;      &quot; 9.34&quot;     &quot;9 34&quot;     &quot;9H34M&quot;       &quot;934am&quot;</span>
<a href="#l13.447"></a><span id="l13.447" class="difflineplus">+ * skip nondigit prefix  &quot; 12:34&quot;    &quot;t12.34&quot;   &quot; 12 34&quot;   &quot;T12H34M&quot;     &quot;T0234&quot;</span>
<a href="#l13.448"></a><span id="l13.448" class="difflineplus">+ * am/pm optional        &quot;02:34 a.m.&quot;&quot;02.34pm&quot;  &quot;02 34 A M&quot; &quot;02H34M P.M.&quot; &quot;0234pm&quot;</span>
<a href="#l13.449"></a><span id="l13.449" class="difflineplus">+ * am/pm prefix          &quot;a.m. 02:34&quot;&quot;pm02.34&quot;  &quot;A M 02 34&quot; &quot;P.M. 02H34M&quot; &quot;pm0234&quot;</span>
<a href="#l13.450"></a><span id="l13.450" class="difflineplus">+ * am/pm cyrillic        &quot;02:34\u0430.\u043c.&quot;  &quot;02 34 \u0420 \u041c&quot;</span>
<a href="#l13.451"></a><span id="l13.451" class="difflineplus">+ * am/pm arabic          &quot;\u063502:34&quot; (RTL 02:34a) &quot;\u0645 02.34&quot; (RTL 02.34 p)</span>
<a href="#l13.452"></a><span id="l13.452" class="difflineplus">+ * above/below noon      &quot;\u4e0a\u534802:34&quot;    &quot;\u4e0b\u5348 02 34&quot;</span>
<a href="#l13.453"></a><span id="l13.453" class="difflineplus">+ * noon before/after     &quot;\u5348\u524d02:34&quot;    &quot;\u5348\u5f8c 02 34&quot;</span>
<a href="#l13.454"></a><span id="l13.454" class="difflineplus">+ */</span>
<a href="#l13.455"></a><span id="l13.455" class="difflineplus">+function parseTime(aValue) {</span>
<a href="#l13.456"></a><span id="l13.456" class="difflineplus">+    let now = new Date();</span>
<a href="#l13.457"></a><span id="l13.457" class="difflineplus">+</span>
<a href="#l13.458"></a><span id="l13.458" class="difflineplus">+    let noon = cal.l10n.getDateFmtString(&quot;noon&quot;);</span>
<a href="#l13.459"></a><span id="l13.459" class="difflineplus">+    if (aValue.toLowerCase() == noon.toLowerCase()) {</span>
<a href="#l13.460"></a><span id="l13.460" class="difflineplus">+        return new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0, 0, 0);</span>
<a href="#l13.461"></a><span id="l13.461" class="difflineplus">+    }</span>
<a href="#l13.462"></a><span id="l13.462" class="difflineplus">+</span>
<a href="#l13.463"></a><span id="l13.463" class="difflineplus">+    let midnight = cal.l10n.getDateFmtString(&quot;midnight&quot;);</span>
<a href="#l13.464"></a><span id="l13.464" class="difflineplus">+    if (aValue.toLowerCase() == midnight.toLowerCase()) {</span>
<a href="#l13.465"></a><span id="l13.465" class="difflineplus">+        return new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);</span>
<a href="#l13.466"></a><span id="l13.466" class="difflineplus">+    }</span>
<a href="#l13.467"></a><span id="l13.467" class="difflineplus">+</span>
<a href="#l13.468"></a><span id="l13.468" class="difflineplus">+    let time = null;</span>
<a href="#l13.469"></a><span id="l13.469" class="difflineplus">+    let timePartsArray = this.parseTimeRegExp.exec(aValue);</span>
<a href="#l13.470"></a><span id="l13.470" class="difflineplus">+    const PRE_INDEX = 1, HR_INDEX = 2, MIN_INDEX = 4, SEC_INDEX = 6, POST_INDEX = 8;</span>
<a href="#l13.471"></a><span id="l13.471" class="difflineplus">+</span>
<a href="#l13.472"></a><span id="l13.472" class="difflineplus">+    if (timePartsArray != null) {</span>
<a href="#l13.473"></a><span id="l13.473" class="difflineplus">+        let hoursString = timePartsArray[HR_INDEX];</span>
<a href="#l13.474"></a><span id="l13.474" class="difflineplus">+        let hours = Number(hoursString);</span>
<a href="#l13.475"></a><span id="l13.475" class="difflineplus">+        if (!(hours &gt;= 0 &amp;&amp; hours &lt; 24)) {</span>
<a href="#l13.476"></a><span id="l13.476" class="difflineplus">+            return null;</span>
<a href="#l13.477"></a><span id="l13.477" class="difflineplus">+        }</span>
<a href="#l13.478"></a><span id="l13.478" class="difflineplus">+</span>
<a href="#l13.479"></a><span id="l13.479" class="difflineplus">+        let minutesString = timePartsArray[MIN_INDEX];</span>
<a href="#l13.480"></a><span id="l13.480" class="difflineplus">+        let minutes = (minutesString == null ? 0 : Number(minutesString));</span>
<a href="#l13.481"></a><span id="l13.481" class="difflineplus">+        if (!(minutes &gt;= 0 &amp;&amp; minutes &lt; 60)) {</span>
<a href="#l13.482"></a><span id="l13.482" class="difflineplus">+            return null;</span>
<a href="#l13.483"></a><span id="l13.483" class="difflineplus">+        }</span>
<a href="#l13.484"></a><span id="l13.484" class="difflineplus">+</span>
<a href="#l13.485"></a><span id="l13.485" class="difflineplus">+        let secondsString = timePartsArray[SEC_INDEX];</span>
<a href="#l13.486"></a><span id="l13.486" class="difflineplus">+        let seconds = (secondsString == null ? 0 : Number(secondsString));</span>
<a href="#l13.487"></a><span id="l13.487" class="difflineplus">+        if (!(seconds &gt;= 0 &amp;&amp; seconds &lt; 60)) {</span>
<a href="#l13.488"></a><span id="l13.488" class="difflineplus">+            return null;</span>
<a href="#l13.489"></a><span id="l13.489" class="difflineplus">+        }</span>
<a href="#l13.490"></a><span id="l13.490" class="difflineplus">+</span>
<a href="#l13.491"></a><span id="l13.491" class="difflineplus">+        let ampmCode = null;</span>
<a href="#l13.492"></a><span id="l13.492" class="difflineplus">+        if (timePartsArray[PRE_INDEX] || timePartsArray[POST_INDEX]) {</span>
<a href="#l13.493"></a><span id="l13.493" class="difflineplus">+            if (this.ampmIndex &amp;&amp; timePartsArray[this.ampmIndex]) {</span>
<a href="#l13.494"></a><span id="l13.494" class="difflineplus">+                // try current format order first</span>
<a href="#l13.495"></a><span id="l13.495" class="difflineplus">+                let ampmString = timePartsArray[this.ampmIndex];</span>
<a href="#l13.496"></a><span id="l13.496" class="difflineplus">+                if (this.amRegExp.test(ampmString)) {</span>
<a href="#l13.497"></a><span id="l13.497" class="difflineplus">+                    ampmCode = &quot;AM&quot;;</span>
<a href="#l13.498"></a><span id="l13.498" class="difflineplus">+                } else if (this.pmRegExp.test(ampmString)) {</span>
<a href="#l13.499"></a><span id="l13.499" class="difflineplus">+                    ampmCode = &quot;PM&quot;;</span>
<a href="#l13.500"></a><span id="l13.500" class="difflineplus">+                }</span>
<a href="#l13.501"></a><span id="l13.501" class="difflineplus">+            }</span>
<a href="#l13.502"></a><span id="l13.502" class="difflineplus">+            if (ampmCode == null) { // not yet found</span>
<a href="#l13.503"></a><span id="l13.503" class="difflineplus">+                // try any format order</span>
<a href="#l13.504"></a><span id="l13.504" class="difflineplus">+                let preString = timePartsArray[PRE_INDEX];</span>
<a href="#l13.505"></a><span id="l13.505" class="difflineplus">+                let postString = timePartsArray[POST_INDEX];</span>
<a href="#l13.506"></a><span id="l13.506" class="difflineplus">+                if ((preString &amp;&amp; this.amRegExp.test(preString)) ||</span>
<a href="#l13.507"></a><span id="l13.507" class="difflineplus">+                    (postString &amp;&amp; this.amRegExp.test(postString))) {</span>
<a href="#l13.508"></a><span id="l13.508" class="difflineplus">+                    ampmCode = &quot;AM&quot;;</span>
<a href="#l13.509"></a><span id="l13.509" class="difflineplus">+                } else if ((preString &amp;&amp; this.pmRegExp.test(preString)) ||</span>
<a href="#l13.510"></a><span id="l13.510" class="difflineplus">+                           (postString &amp;&amp; this.pmRegExp.test(postString))) {</span>
<a href="#l13.511"></a><span id="l13.511" class="difflineplus">+                    ampmCode = &quot;PM&quot;;</span>
<a href="#l13.512"></a><span id="l13.512" class="difflineplus">+                } // else no match, ignore and treat as 24hour time.</span>
<a href="#l13.513"></a><span id="l13.513" class="difflineplus">+            }</span>
<a href="#l13.514"></a><span id="l13.514" class="difflineplus">+        }</span>
<a href="#l13.515"></a><span id="l13.515" class="difflineplus">+        if (ampmCode == &quot;AM&quot;) {</span>
<a href="#l13.516"></a><span id="l13.516" class="difflineplus">+            if (hours == 12) {</span>
<a href="#l13.517"></a><span id="l13.517" class="difflineplus">+                hours = 0;</span>
<a href="#l13.518"></a><span id="l13.518" class="difflineplus">+            }</span>
<a href="#l13.519"></a><span id="l13.519" class="difflineplus">+        } else if (ampmCode == &quot;PM&quot;) {</span>
<a href="#l13.520"></a><span id="l13.520" class="difflineplus">+            if (hours &lt; 12) {</span>
<a href="#l13.521"></a><span id="l13.521" class="difflineplus">+                hours += 12;</span>
<a href="#l13.522"></a><span id="l13.522" class="difflineplus">+            }</span>
<a href="#l13.523"></a><span id="l13.523" class="difflineplus">+        }</span>
<a href="#l13.524"></a><span id="l13.524" class="difflineplus">+        time = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, seconds, 0);</span>
<a href="#l13.525"></a><span id="l13.525" class="difflineplus">+    }  // else did not match regex, not valid time</span>
<a href="#l13.526"></a><span id="l13.526" class="difflineplus">+    return time;</span>
<a href="#l13.527"></a><span id="l13.527" class="difflineplus">+}</span>
<a href="#l13.528"></a><span id="l13.528" class="difflineplus">+</span>
<a href="#l13.529"></a><span id="l13.529" class="difflineplus">+function initDateFormat() {</span>
<a href="#l13.530"></a><span id="l13.530" class="difflineplus">+    // probe the dateformat</span>
<a href="#l13.531"></a><span id="l13.531" class="difflineplus">+    this.yearIndex = -1;</span>
<a href="#l13.532"></a><span id="l13.532" class="difflineplus">+    this.monthIndex = -1;</span>
<a href="#l13.533"></a><span id="l13.533" class="difflineplus">+    this.dayIndex = -1;</span>
<a href="#l13.534"></a><span id="l13.534" class="difflineplus">+    this.twoDigitYear = false;</span>
<a href="#l13.535"></a><span id="l13.535" class="difflineplus">+    this.alphaMonths = null;</span>
<a href="#l13.536"></a><span id="l13.536" class="difflineplus">+    this.probeSucceeded = false;</span>
<a href="#l13.537"></a><span id="l13.537" class="difflineplus">+    this.mLastDateParseIncludedTime = false;</span>
<a href="#l13.538"></a><span id="l13.538" class="difflineplus">+</span>
<a href="#l13.539"></a><span id="l13.539" class="difflineplus">+    // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l13.540"></a><span id="l13.540" class="difflineplus">+    // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l13.541"></a><span id="l13.541" class="difflineplus">+    // which do not match \w, esp. in CJK locales.)</span>
<a href="#l13.542"></a><span id="l13.542" class="difflineplus">+    this.parseShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)\D?$/;</span>
<a href="#l13.543"></a><span id="l13.543" class="difflineplus">+    // Make sure to use UTC date and timezone here to avoid the pattern</span>
<a href="#l13.544"></a><span id="l13.544" class="difflineplus">+    // detection to fail if the probe date output would have an timezone</span>
<a href="#l13.545"></a><span id="l13.545" class="difflineplus">+    // offset due to our lack of support of historic timezone definitions.</span>
<a href="#l13.546"></a><span id="l13.546" class="difflineplus">+    let probeDate = new Date(Date.UTC(2002, 3, 6)); // month is 0-based</span>
<a href="#l13.547"></a><span id="l13.547" class="difflineplus">+    let probeString = this.formatDate(probeDate, cal.dtz.UTC);</span>
<a href="#l13.548"></a><span id="l13.548" class="difflineplus">+    let probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l13.549"></a><span id="l13.549" class="difflineplus">+    if (probeArray) {</span>
<a href="#l13.550"></a><span id="l13.550" class="difflineplus">+        // Numeric month format</span>
<a href="#l13.551"></a><span id="l13.551" class="difflineplus">+        for (let i = 1; i &lt;= 3; i++) {</span>
<a href="#l13.552"></a><span id="l13.552" class="difflineplus">+            switch (Number(probeArray[i])) {</span>
<a href="#l13.553"></a><span id="l13.553" class="difflineplus">+                case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l13.554"></a><span id="l13.554" class="difflineplus">+                case 2002: this.yearIndex = i; break;</span>
<a href="#l13.555"></a><span id="l13.555" class="difflineplus">+                case 4: this.monthIndex = i; break;</span>
<a href="#l13.556"></a><span id="l13.556" class="difflineplus">+                case 5: // falls through for OS timezones western to GMT</span>
<a href="#l13.557"></a><span id="l13.557" class="difflineplus">+                case 6: this.dayIndex = i; break;</span>
<a href="#l13.558"></a><span id="l13.558" class="difflineplus">+            }</span>
<a href="#l13.559"></a><span id="l13.559" class="difflineplus">+        }</span>
<a href="#l13.560"></a><span id="l13.560" class="difflineplus">+        // All three indexes are set (not -1) at this point.</span>
<a href="#l13.561"></a><span id="l13.561" class="difflineplus">+        this.probeSucceeded = true;</span>
<a href="#l13.562"></a><span id="l13.562" class="difflineplus">+    } else {</span>
<a href="#l13.563"></a><span id="l13.563" class="difflineplus">+        // SHORT DATE WITH ALPHABETIC MONTH, such as &quot;dd MMM yy&quot; or &quot;MMMM dd, yyyy&quot;</span>
<a href="#l13.564"></a><span id="l13.564" class="difflineplus">+        // (\d+|[^\d\W]) is digits or letters, not both together.</span>
<a href="#l13.565"></a><span id="l13.565" class="difflineplus">+        // Allows 31dec1999 (no delimiters between parts) if OS does (w2k does not).</span>
<a href="#l13.566"></a><span id="l13.566" class="difflineplus">+        // Allows Dec 31, 1999 (comma and space between parts)</span>
<a href="#l13.567"></a><span id="l13.567" class="difflineplus">+        // (Only accepts ASCII month names; JavaScript RegExp does not have an</span>
<a href="#l13.568"></a><span id="l13.568" class="difflineplus">+        // easy way to describe unicode letters short of a HUGE character range</span>
<a href="#l13.569"></a><span id="l13.569" class="difflineplus">+        // regexp derived from the Alphabetic ranges in</span>
<a href="#l13.570"></a><span id="l13.570" class="difflineplus">+        // http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt)</span>
<a href="#l13.571"></a><span id="l13.571" class="difflineplus">+        this.parseShortDateRegex = /^\s*(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)\s*$/;</span>
<a href="#l13.572"></a><span id="l13.572" class="difflineplus">+        probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l13.573"></a><span id="l13.573" class="difflineplus">+        if (probeArray != null) {</span>
<a href="#l13.574"></a><span id="l13.574" class="difflineplus">+            for (let j = 1; j &lt;= 3; j++) {</span>
<a href="#l13.575"></a><span id="l13.575" class="difflineplus">+                switch (Number(probeArray[j])) {</span>
<a href="#l13.576"></a><span id="l13.576" class="difflineplus">+                    case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l13.577"></a><span id="l13.577" class="difflineplus">+                    case 2002: this.yearIndex = j; break;</span>
<a href="#l13.578"></a><span id="l13.578" class="difflineplus">+                    case 5: // falls through for OS timezones western to GMT</span>
<a href="#l13.579"></a><span id="l13.579" class="difflineplus">+                    case 6: this.dayIndex = j; break;</span>
<a href="#l13.580"></a><span id="l13.580" class="difflineplus">+                    default: this.monthIndex = j; break;</span>
<a href="#l13.581"></a><span id="l13.581" class="difflineplus">+                }</span>
<a href="#l13.582"></a><span id="l13.582" class="difflineplus">+            }</span>
<a href="#l13.583"></a><span id="l13.583" class="difflineplus">+            if (this.yearIndex != -1 &amp;&amp; this.dayIndex != -1 &amp;&amp; this.monthIndex != -1) {</span>
<a href="#l13.584"></a><span id="l13.584" class="difflineplus">+                this.probeSucceeded = true;</span>
<a href="#l13.585"></a><span id="l13.585" class="difflineplus">+                // Fill this.alphaMonths with month names.</span>
<a href="#l13.586"></a><span id="l13.586" class="difflineplus">+                this.alphaMonths = new Array(12);</span>
<a href="#l13.587"></a><span id="l13.587" class="difflineplus">+                for (let monthIdx = 0; monthIdx &lt; 12; monthIdx++) {</span>
<a href="#l13.588"></a><span id="l13.588" class="difflineplus">+                    probeDate.setMonth(monthIdx);</span>
<a href="#l13.589"></a><span id="l13.589" class="difflineplus">+                    probeString = this.formatDate(probeDate);</span>
<a href="#l13.590"></a><span id="l13.590" class="difflineplus">+                    probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l13.591"></a><span id="l13.591" class="difflineplus">+                    if (probeArray) {</span>
<a href="#l13.592"></a><span id="l13.592" class="difflineplus">+                        this.alphaMonths[monthIdx] = probeArray[this.monthIndex].toUpperCase();</span>
<a href="#l13.593"></a><span id="l13.593" class="difflineplus">+                    } else {</span>
<a href="#l13.594"></a><span id="l13.594" class="difflineplus">+                        this.probeSucceeded = false;</span>
<a href="#l13.595"></a><span id="l13.595" class="difflineplus">+                    }</span>
<a href="#l13.596"></a><span id="l13.596" class="difflineplus">+                }</span>
<a href="#l13.597"></a><span id="l13.597" class="difflineplus">+            }</span>
<a href="#l13.598"></a><span id="l13.598" class="difflineplus">+        }</span>
<a href="#l13.599"></a><span id="l13.599" class="difflineplus">+    }</span>
<a href="#l13.600"></a><span id="l13.600" class="difflineplus">+    if (!this.probeSucceeded) {</span>
<a href="#l13.601"></a><span id="l13.601" class="difflineplus">+        dump(&quot;\nOperating system short date format is not recognized: &quot; + probeString + &quot;\n&quot;);</span>
<a href="#l13.602"></a><span id="l13.602" class="difflineplus">+    }</span>
<a href="#l13.603"></a><span id="l13.603" class="difflineplus">+}</span>
<a href="#l13.604"></a><span id="l13.604" class="difflineplus">+</span>
<a href="#l13.605"></a><span id="l13.605" class="difflineplus">+/**</span>
<a href="#l13.606"></a><span id="l13.606" class="difflineplus">+ * Time format in 24-hour format or 12-hour format with am/pm string.</span>
<a href="#l13.607"></a><span id="l13.607" class="difflineplus">+ * Should match formats</span>
<a href="#l13.608"></a><span id="l13.608" class="difflineplus">+ *      HH:mm,       H:mm,       HH:mm:ss,       H:mm:ss</span>
<a href="#l13.609"></a><span id="l13.609" class="difflineplus">+ *      hh:mm tt,    h:mm tt,    hh:mm:ss tt,    h:mm:ss tt</span>
<a href="#l13.610"></a><span id="l13.610" class="difflineplus">+ *   tt hh:mm,    tt h:mm,    tt hh:mm:ss,    tt h:mm:ss</span>
<a href="#l13.611"></a><span id="l13.611" class="difflineplus">+ * where</span>
<a href="#l13.612"></a><span id="l13.612" class="difflineplus">+ * HH is 24 hour digits, with leading 0.  H is 24 hour digits, no leading 0.</span>
<a href="#l13.613"></a><span id="l13.613" class="difflineplus">+ * hh is 12 hour digits, with leading 0.  h is 12 hour digits, no leading 0.</span>
<a href="#l13.614"></a><span id="l13.614" class="difflineplus">+ * mm and ss are is minutes and seconds digits, with leading 0.</span>
<a href="#l13.615"></a><span id="l13.615" class="difflineplus">+ * tt is localized AM or PM string.</span>
<a href="#l13.616"></a><span id="l13.616" class="difflineplus">+ * ':' may be ':' or a units marker such as 'h', 'm', or 's' in  15h12m00s</span>
<a href="#l13.617"></a><span id="l13.617" class="difflineplus">+ * or may be omitted as in 151200.</span>
<a href="#l13.618"></a><span id="l13.618" class="difflineplus">+ */</span>
<a href="#l13.619"></a><span id="l13.619" class="difflineplus">+function initTimeFormat() {</span>
<a href="#l13.620"></a><span id="l13.620" class="difflineplus">+    // probe the Time format</span>
<a href="#l13.621"></a><span id="l13.621" class="difflineplus">+    this.ampmIndex = null;</span>
<a href="#l13.622"></a><span id="l13.622" class="difflineplus">+    // Digits         HR       sep      MIN     sep      SEC     sep</span>
<a href="#l13.623"></a><span id="l13.623" class="difflineplus">+    //   Index:       2        3        4       5        6       7</span>
<a href="#l13.624"></a><span id="l13.624" class="difflineplus">+    let digitsExpr = &quot;(\\d?\\d)(\\D)?(?:(\\d\\d)(\\D)?(?:(\\d\\d)(\\D)?)?)?&quot;;</span>
<a href="#l13.625"></a><span id="l13.625" class="difflineplus">+    // any letters or '.': non-digit alphanumeric, period (a.m.), or space (P M)</span>
<a href="#l13.626"></a><span id="l13.626" class="difflineplus">+    let anyAmPmExpr = &quot;(?:[^\\d\\W]|[. ])+&quot;;</span>
<a href="#l13.627"></a><span id="l13.627" class="difflineplus">+    // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l13.628"></a><span id="l13.628" class="difflineplus">+    let probeTimeRegExp =</span>
<a href="#l13.629"></a><span id="l13.629" class="difflineplus">+        new RegExp(&quot;^(&quot; + anyAmPmExpr + &quot;)?\\s?&quot; + digitsExpr + &quot;(&quot; + anyAmPmExpr + &quot;)?\\s*$&quot;);</span>
<a href="#l13.630"></a><span id="l13.630" class="difflineplus">+    const PRE_INDEX = 1, HR_INDEX = 2, MIN_INDEX = 4, SEC_INDEX = 6, POST_INDEX = 8; // eslint-disable-line no-unused-vars</span>
<a href="#l13.631"></a><span id="l13.631" class="difflineplus">+    let amProbeTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l13.632"></a><span id="l13.632" class="difflineplus">+    let pmProbeTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l13.633"></a><span id="l13.633" class="difflineplus">+    let formatter = new Services.intl.DateTimeFormat(undefined, { timeStyle: &quot;short&quot; });</span>
<a href="#l13.634"></a><span id="l13.634" class="difflineplus">+    let amProbeString = formatter.format(amProbeTime);</span>
<a href="#l13.635"></a><span id="l13.635" class="difflineplus">+    let pmProbeString = formatter.format(pmProbeTime);</span>
<a href="#l13.636"></a><span id="l13.636" class="difflineplus">+    let amFormatExpr = null, pmFormatExpr = null;</span>
<a href="#l13.637"></a><span id="l13.637" class="difflineplus">+    if (amProbeString != pmProbeString) {</span>
<a href="#l13.638"></a><span id="l13.638" class="difflineplus">+        let amProbeArray = probeTimeRegExp.exec(amProbeString);</span>
<a href="#l13.639"></a><span id="l13.639" class="difflineplus">+        let pmProbeArray = probeTimeRegExp.exec(pmProbeString);</span>
<a href="#l13.640"></a><span id="l13.640" class="difflineplus">+        if (amProbeArray != null &amp;&amp; pmProbeArray != null) {</span>
<a href="#l13.641"></a><span id="l13.641" class="difflineplus">+            if (amProbeArray[PRE_INDEX] &amp;&amp; pmProbeArray[PRE_INDEX] &amp;&amp;</span>
<a href="#l13.642"></a><span id="l13.642" class="difflineplus">+                amProbeArray[PRE_INDEX] != pmProbeArray[PRE_INDEX]) {</span>
<a href="#l13.643"></a><span id="l13.643" class="difflineplus">+                this.ampmIndex = PRE_INDEX;</span>
<a href="#l13.644"></a><span id="l13.644" class="difflineplus">+            } else if (amProbeArray[POST_INDEX] &amp;&amp; pmProbeArray[POST_INDEX]) {</span>
<a href="#l13.645"></a><span id="l13.645" class="difflineplus">+                if (amProbeArray[POST_INDEX] == pmProbeArray[POST_INDEX]) {</span>
<a href="#l13.646"></a><span id="l13.646" class="difflineplus">+                    // check if need to append previous character,</span>
<a href="#l13.647"></a><span id="l13.647" class="difflineplus">+                    // captured by the optional separator pattern after seconds digits,</span>
<a href="#l13.648"></a><span id="l13.648" class="difflineplus">+                    // or after minutes if no seconds, or after hours if no minutes.</span>
<a href="#l13.649"></a><span id="l13.649" class="difflineplus">+                    for (let k = SEC_INDEX; k &gt;= HR_INDEX; k -= 2) {</span>
<a href="#l13.650"></a><span id="l13.650" class="difflineplus">+                        let nextSepI = k + 1;</span>
<a href="#l13.651"></a><span id="l13.651" class="difflineplus">+                        let nextDigitsI = k + 2;</span>
<a href="#l13.652"></a><span id="l13.652" class="difflineplus">+                        if ((k == SEC_INDEX ||</span>
<a href="#l13.653"></a><span id="l13.653" class="difflineplus">+                             (!amProbeArray[nextDigitsI] &amp;&amp; !pmProbeArray[nextDigitsI])) &amp;&amp;</span>
<a href="#l13.654"></a><span id="l13.654" class="difflineplus">+                            amProbeArray[nextSepI] &amp;&amp; pmProbeArray[nextSepI] &amp;&amp;</span>
<a href="#l13.655"></a><span id="l13.655" class="difflineplus">+                            amProbeArray[nextSepI] != pmProbeArray[nextSepI]) {</span>
<a href="#l13.656"></a><span id="l13.656" class="difflineplus">+                            amProbeArray[POST_INDEX] =</span>
<a href="#l13.657"></a><span id="l13.657" class="difflineplus">+                              amProbeArray[nextSepI] + amProbeArray[POST_INDEX];</span>
<a href="#l13.658"></a><span id="l13.658" class="difflineplus">+                            pmProbeArray[POST_INDEX] =</span>
<a href="#l13.659"></a><span id="l13.659" class="difflineplus">+                              pmProbeArray[nextSepI] + pmProbeArray[POST_INDEX];</span>
<a href="#l13.660"></a><span id="l13.660" class="difflineplus">+                            this.ampmIndex = POST_INDEX;</span>
<a href="#l13.661"></a><span id="l13.661" class="difflineplus">+                            break;</span>
<a href="#l13.662"></a><span id="l13.662" class="difflineplus">+                        }</span>
<a href="#l13.663"></a><span id="l13.663" class="difflineplus">+                    }</span>
<a href="#l13.664"></a><span id="l13.664" class="difflineplus">+                } else {</span>
<a href="#l13.665"></a><span id="l13.665" class="difflineplus">+                    this.ampmIndex = POST_INDEX;</span>
<a href="#l13.666"></a><span id="l13.666" class="difflineplus">+                }</span>
<a href="#l13.667"></a><span id="l13.667" class="difflineplus">+            }</span>
<a href="#l13.668"></a><span id="l13.668" class="difflineplus">+            if (this.ampmIndex) {</span>
<a href="#l13.669"></a><span id="l13.669" class="difflineplus">+                let makeFormatRegExp = function(string) {</span>
<a href="#l13.670"></a><span id="l13.670" class="difflineplus">+                    // make expr to accept either as provided, lowercased, or uppercased</span>
<a href="#l13.671"></a><span id="l13.671" class="difflineplus">+                    let regExp = string.replace(/(\W)/g, &quot;[$1]&quot;); // escape punctuation</span>
<a href="#l13.672"></a><span id="l13.672" class="difflineplus">+                    let lowercased = string.toLowerCase();</span>
<a href="#l13.673"></a><span id="l13.673" class="difflineplus">+                    if (string != lowercased) {</span>
<a href="#l13.674"></a><span id="l13.674" class="difflineplus">+                        regExp += &quot;|&quot; + lowercased;</span>
<a href="#l13.675"></a><span id="l13.675" class="difflineplus">+                    }</span>
<a href="#l13.676"></a><span id="l13.676" class="difflineplus">+                    let uppercased = string.toUpperCase();</span>
<a href="#l13.677"></a><span id="l13.677" class="difflineplus">+                    if (string != uppercased) {</span>
<a href="#l13.678"></a><span id="l13.678" class="difflineplus">+                        regExp += &quot;|&quot; + uppercased;</span>
<a href="#l13.679"></a><span id="l13.679" class="difflineplus">+                    }</span>
<a href="#l13.680"></a><span id="l13.680" class="difflineplus">+                    return regExp;</span>
<a href="#l13.681"></a><span id="l13.681" class="difflineplus">+                };</span>
<a href="#l13.682"></a><span id="l13.682" class="difflineplus">+                amFormatExpr = makeFormatRegExp(amProbeArray[this.ampmIndex]);</span>
<a href="#l13.683"></a><span id="l13.683" class="difflineplus">+                pmFormatExpr = makeFormatRegExp(pmProbeArray[this.ampmIndex]);</span>
<a href="#l13.684"></a><span id="l13.684" class="difflineplus">+            }</span>
<a href="#l13.685"></a><span id="l13.685" class="difflineplus">+        }</span>
<a href="#l13.686"></a><span id="l13.686" class="difflineplus">+    }</span>
<a href="#l13.687"></a><span id="l13.687" class="difflineplus">+    // International formats ([roman, cyrillic]|arabic|chinese/kanji characters)</span>
<a href="#l13.688"></a><span id="l13.688" class="difflineplus">+    // covering languages of U.N. (en,fr,sp,ru,ar,zh) and G8 (en,fr,de,it,ru,ja).</span>
<a href="#l13.689"></a><span id="l13.689" class="difflineplus">+    // See examples at parseTimeOfDay.</span>
<a href="#l13.690"></a><span id="l13.690" class="difflineplus">+    let amExpr =</span>
<a href="#l13.691"></a><span id="l13.691" class="difflineplus">+        &quot;[Aa\u0410\u0430][. ]?[Mm\u041c\u043c][. ]?|\u0635|\u4e0a\u5348|\u5348\u524d&quot;;</span>
<a href="#l13.692"></a><span id="l13.692" class="difflineplus">+    let pmExpr =</span>
<a href="#l13.693"></a><span id="l13.693" class="difflineplus">+        &quot;[Pp\u0420\u0440][. ]?[Mm\u041c\u043c][. ]?|\u0645|\u4e0b\u5348|\u5348\u5f8c&quot;;</span>
<a href="#l13.694"></a><span id="l13.694" class="difflineplus">+    if (this.ampmIndex) {</span>
<a href="#l13.695"></a><span id="l13.695" class="difflineplus">+        amExpr = amFormatExpr + &quot;|&quot; + amExpr;</span>
<a href="#l13.696"></a><span id="l13.696" class="difflineplus">+        pmExpr = pmFormatExpr + &quot;|&quot; + pmExpr;</span>
<a href="#l13.697"></a><span id="l13.697" class="difflineplus">+    }</span>
<a href="#l13.698"></a><span id="l13.698" class="difflineplus">+    let ampmExpr = amExpr + &quot;|&quot; + pmExpr;</span>
<a href="#l13.699"></a><span id="l13.699" class="difflineplus">+    // Must build am/pm formats into parse time regexp so that it can</span>
<a href="#l13.700"></a><span id="l13.700" class="difflineplus">+    // match them without mistaking the initial char for an optional divider.</span>
<a href="#l13.701"></a><span id="l13.701" class="difflineplus">+    // (For example, want to be able to parse both &quot;12:34pm&quot; and</span>
<a href="#l13.702"></a><span id="l13.702" class="difflineplus">+    // &quot;12H34M56Spm&quot; for any characters H,M,S and any language's &quot;pm&quot;.</span>
<a href="#l13.703"></a><span id="l13.703" class="difflineplus">+    // The character between the last digit and the &quot;pm&quot; is optional.</span>
<a href="#l13.704"></a><span id="l13.704" class="difflineplus">+    // Must recogize &quot;pm&quot; directly, otherwise in &quot;12:34pm&quot; the &quot;S&quot; pattern</span>
<a href="#l13.705"></a><span id="l13.705" class="difflineplus">+    // matches the &quot;p&quot; character so only &quot;m&quot; is matched as ampm suffix.)</span>
<a href="#l13.706"></a><span id="l13.706" class="difflineplus">+    //</span>
<a href="#l13.707"></a><span id="l13.707" class="difflineplus">+    // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l13.708"></a><span id="l13.708" class="difflineplus">+    this.parseTimeRegExp =</span>
<a href="#l13.709"></a><span id="l13.709" class="difflineplus">+        new RegExp(&quot;(&quot; + ampmExpr + &quot;)?\\s?&quot; + digitsExpr + &quot;(&quot; + ampmExpr + &quot;)?\\s*$&quot;);</span>
<a href="#l13.710"></a><span id="l13.710" class="difflineplus">+    this.amRegExp = new RegExp(&quot;^(?:&quot; + amExpr + &quot;)$&quot;);</span>
<a href="#l13.711"></a><span id="l13.711" class="difflineplus">+    this.pmRegExp = new RegExp(&quot;^(?:&quot; + pmExpr + &quot;)$&quot;);</span>
<a href="#l13.712"></a><span id="l13.712" class="difflineplus">+}</span>
<a href="#l13.713"></a><span id="l13.713" class="difflineplus">+</span>
<a href="#l13.714"></a><span id="l13.714" class="difflineplus">+function formatDate(aDate, aTimezone) {</span>
<a href="#l13.715"></a><span id="l13.715" class="difflineplus">+    // Usually, floating is ok here, so no need to pass aTimezone - we just need to pass</span>
<a href="#l13.716"></a><span id="l13.716" class="difflineplus">+    // it in if we need to make sure formatting happens without a timezone conversion.</span>
<a href="#l13.717"></a><span id="l13.717" class="difflineplus">+    let timezone = aTimezone || cal.dtz.floating;</span>
<a href="#l13.718"></a><span id="l13.718" class="difflineplus">+    return cal.getDateFormatter().formatDateShort(cal.dtz.jsDateToDateTime(aDate, timezone));</span>
<a href="#l13.719"></a><span id="l13.719" class="difflineplus">+}</span>
<a href="#l13.720"></a><span id="l13.720" class="difflineplus">+</span>
<a href="#l13.721"></a><span id="l13.721" class="difflineplus">+function formatTime(aValue) {</span>
<a href="#l13.722"></a><span id="l13.722" class="difflineplus">+    let formatter = new Services.intl.DateTimeFormat(undefined, { timeStyle: &quot;short&quot; });</span>
<a href="#l13.723"></a><span id="l13.723" class="difflineplus">+    return formatter.format(aValue);</span>
<a href="#l13.724"></a><span id="l13.724" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -220,430 +220,16 @@</span>
<a href="#l14.4"></a><span id="l14.4">                 return day;</span>
<a href="#l14.5"></a><span id="l14.5">             }</span>
<a href="#l14.6"></a><span id="l14.6">             return null;</span>
<a href="#l14.7"></a><span id="l14.7">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.8"></a><span id="l14.8">       &lt;/method&gt;</span>
<a href="#l14.9"></a><span id="l14.9">     &lt;/implementation&gt;</span>
<a href="#l14.10"></a><span id="l14.10">   &lt;/binding&gt;</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  &lt;binding id=&quot;datepicker&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;&gt;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    &lt;!-- Desired behavior: when user is done editing the date field</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-         and either leaves the field (onblur) or closes the dialog</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-         (13 is enter/return key), parse the date and redisplay it</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-         in the date field using the current format to verify</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-         whether the date was parsed correctly.</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-         This cannot be done with textbox oninput, so use a workaround.</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-         This was done with textbox onkeypress=&quot;parseTextBoxDate(true)&quot;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-         and onblur=&quot;parseTextBoxDate(true)&quot; which worked in Moz1.6, but</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-         no longer works in Moz1.7.</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-         Therefore constructor stores attribute kDatePicker on the textbox,</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-         and the onblur and onkeypress commands navigate to this kDatePicker.</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-         xul:Textbox contains an xul:hbox which contains html:input.</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-         Onkeypress and onblur are not documented attributes of xul:textbox,</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-         but become attributes of the html:input.</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-         Not clear how to navigate from the textbox to the input, otherwise</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-         could put kDatePicker property on the input element.</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-         [document.getAnonymousNodes(textBox) fails as of Moz1.7b]).</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-         So navigate parents to textbox in order to call parseTextBoxDate.</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-         [this comment is outside the &lt;content&gt; so it won't become a</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-         node that interferes with navigation to interior nodes.] --&gt;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; id=&quot;hbox&quot; class=&quot;datepicker-box-class&quot;&gt;</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-        &lt;xul:xbl-menulist editable=&quot;true&quot; type=&quot;panel&quot; sizetopopup=&quot;false&quot;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-                          class=&quot;datepicker-text-class&quot;</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-                          onchange=&quot;this.kDatePicker.parseTextBoxDate(true, event);&quot;</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-                          onkeypress=&quot;if (event.key == 'Enter') this.kDatePicker.parseTextBoxDate(true);&quot;</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-                          xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-          &lt;xul:panel popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-                     anonid=&quot;datepopup&quot;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-                     onpopupshowing=&quot;this.kDatePicker.onPopup();&quot;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-                     onpopupshown=&quot;this.firstChild.focusCalendar();&quot;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-                     onpopuphiding=&quot;this.firstChild.hidePopupList();&quot;&gt;</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-            &lt;xul:minimonth/&gt;</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-          &lt;/xul:panel&gt;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-        &lt;/xul:xbl-menulist&gt;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-          let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-          this.kTextBox = hbox.firstChild;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-          let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-          if (val) {</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-              this.value = new Date(val); // setting value property calls update</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-          } else {</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-              this.value = new Date();</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-          }</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-          this.kTextBox.kDatePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">-          this.kTextBox.firstChild.kDatePicker = this;</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-          this.kMinimonth = this.kTextBox.firstChild.firstChild;</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-          this.mInPopup = false;</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-          this.kMinimonth.addEventListener(&quot;select&quot;, this.clickDate);</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-          this.kMinimonth.removeEventListener(&quot;select&quot;, this.clickDate);</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-      &lt;!-- This property will be overlayed in some extended binding --&gt;</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-      &lt;property name=&quot;valueValid&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-            return (this.mValue != null);</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-      &lt;property name=&quot;extraDate&quot;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-                onget=&quot;return this.kMinimonth.extra&quot;</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-                onset=&quot;this.kMinimonth.extra = val&quot;/&gt;</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-      &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-        &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-        &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-                // format fails if year &lt;= 1600 on win2k, so try format first.</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-                let formattedValue = null;</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-                try {</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-                    formattedValue = this.formatDate(aValue);</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-                } catch (ex) {</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-                    // formattedValue is checked for a value below</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-                }</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-                if (formattedValue) {</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-                    // format succeeded, safe to set value</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-                    let dateChanged = true;</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-                    if (this.valueValid) {</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-                        dateChanged = this.mValue.getDate() != aValue.getDate() ||</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-                                      this.mValue.getMonth() != aValue.getMonth() ||</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-                                      this.mValue.getFullYear() != aValue.getFullYear();</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-                    }</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-                    this.mValue = aValue;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-                    this.kTextBox.value = formattedValue;</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-                    if (aRefresh &amp;&amp; dateChanged) {</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-                        this.fireEvent(&quot;change&quot;);</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-                    }</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-                }</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-            } else if (this.mValue) {</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-                // invalid date, revert to previous date</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-                // set textBox.value property, not attribute</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-                this.kTextBox.value = this.formatDate(this.mValue);</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-            }</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-      &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-            this.mInPopup = true;</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-            this.kMinimonth.update(this.mValue);</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-            this.mInPopup = false;</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-      &lt;method name=&quot;parseTextBoxDate&quot;&gt;</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-        &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-            // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-            // fired inside the update method.</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-            if (aEvent) {</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-                aEvent.stopPropagation();</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-            }</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineminus">-            this.update(this.parseDateTime(this.kTextBox.value), aRefresh);</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-            this.lastDateParseIncludedTime = false;</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-      &lt;method name=&quot;select&quot;&gt;</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-            // select all in text box</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-            this.kTextBox.select();</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-      &lt;method name=&quot;clickDate&quot;&gt;</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot; /&gt;</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineminus">-            let datepicker = aEvent.target.parentNode.parentNode.kDatePicker;</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-            if (!datepicker.mInPopup) {</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-                // aEvent.target is the minimonth</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-                datepicker.update(new Date(aEvent.target.value), true);</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-                // select changed value so no cursor appears (can't type to it).</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-                datepicker.select();</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-                aEvent.target.parentNode.hidePopup();</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineminus">-            }</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-      &lt;handler event=&quot;blur&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-          this.parseTextBoxDate(true);</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineminus">-</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-  &lt;binding id=&quot;datepicker-forever&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datepicker&quot;&gt;</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; id=&quot;hbox&quot; class=&quot;datepicker-box-class&quot;&gt;</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">-        &lt;xul:xbl-menulist anonid=&quot;foreverMenulist&quot; editable=&quot;true&quot; type=&quot;panel&quot; sizetopopup=&quot;false&quot;</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineminus">-                          class=&quot;datepicker-text-class&quot;</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineminus">-                          onchange=&quot;this.kDatePicker.parseTextBoxDate(true, event);&quot;</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineminus">-                          onkeypress=&quot;if (event.key == 'Enter') this.kDatePicker.parseTextBoxDate(true);&quot;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-                          xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-          &lt;xul:panel popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-                     anonid=&quot;datepopup&quot;</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-                     onpopupshowing=&quot;this.parentNode.kDatePicker.onPopup();&quot;</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineminus">-                     onpopupshown=&quot;this.firstChild.focusCalendar();&quot;</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineminus">-                     onpopuphiding=&quot;this.firstChild.hidePopupList();&quot;&gt;</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineminus">-            &lt;xul:minimonth/&gt;</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-            &lt;xul:menuseparator/&gt;</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-            &lt;xul:button anonid=&quot;menuitemForever&quot;</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-                        class=&quot;datepicker-text-menuItem-class&quot;</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-                        oncommand=&quot;onMenuitemForever(); this.parentNode.hidePopup();&quot;/&gt;</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-          &lt;/xul:panel&gt;</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineminus">-        &lt;/xul:xbl-menulist&gt;</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineminus">-</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">-      &lt;field name=&quot;mForeverStr&quot;&gt;null&lt;/field&gt;</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineminus">-</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-          const { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineminus">-</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-          this.mForeverStr = cal.l10n.getString(&quot;calendar-event-dialog&quot;, &quot;eventRecurrenceForeverLabel&quot;);</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineminus">-          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;menuitemForever&quot;)</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineminus">-                  .setAttribute(&quot;label&quot;, this.mForeverStr);</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineminus">-</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-      &lt;method name=&quot;parseTextBoxDate&quot;&gt;</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-        &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineminus">-            if (this.kTextBox.value.toLowerCase() == this.mForeverStr.toLowerCase()) {</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineminus">-                this.mValue = &quot;forever&quot;;</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineminus">-                this.kTextBox.value = this.mForeverStr;</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineminus">-            } else {</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineminus">-                // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineminus">-                // fired inside the update method.</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineminus">-                if (aEvent) {</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineminus">-                    aEvent.stopPropagation();</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineminus">-                }</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineminus">-                let date = this.parseDateTime(this.kTextBox.value);</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineminus">-                if (date) {</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineminus">-                    this.update(date, aRefresh);</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineminus">-                } else {</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineminus">-                    // Invalid date, revert to previous date.</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineminus">-                    this.kTextBox.value = this.mValue == &quot;forever&quot; ? this.mForeverStr</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineminus">-                                                                   : this.formatDate(this.mValue);</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-                }</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineminus">-                this.lastDateParseIncludedTime = false;</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineminus">-            }</span>
<a href="#l14.228"></a><span id="l14.228" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineminus">-</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineminus">-      &lt;method name=&quot;onMenuitemForever&quot;&gt;</span>
<a href="#l14.232"></a><span id="l14.232" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.233"></a><span id="l14.233" class="difflineminus">-            if (this.kTextBox.value.toLowerCase() == this.mForeverStr.toLowerCase()) {</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineminus">-                this.mValue = &quot;forever&quot;;</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineminus">-            }</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.237"></a><span id="l14.237" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineminus">-</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineminus">-      &lt;property name=&quot;value&quot;&gt;</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineminus">-            return this.mValue;</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineminus">-            if (val == &quot;forever&quot;) {</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineminus">-                document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;foreverMenulist&quot;).selectedIndex = 1;</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineminus">-                this.mValue = &quot;forever&quot;;</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineminus">-                this.kTextBox.value = this.mForeverStr;</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineminus">-            } else {</span>
<a href="#l14.249"></a><span id="l14.249" class="difflineminus">-                this.update(val, false);</span>
<a href="#l14.250"></a><span id="l14.250" class="difflineminus">-            }</span>
<a href="#l14.251"></a><span id="l14.251" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l14.252"></a><span id="l14.252" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l14.253"></a><span id="l14.253" class="difflineminus">-</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineminus">-      &lt;property name=&quot;menuitemForever&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l14.255"></a><span id="l14.255" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.256"></a><span id="l14.256" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;menuitemForever&quot;);</span>
<a href="#l14.257"></a><span id="l14.257" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.258"></a><span id="l14.258" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l14.259"></a><span id="l14.259" class="difflineminus">-</span>
<a href="#l14.260"></a><span id="l14.260" class="difflineminus">-      &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l14.261"></a><span id="l14.261" class="difflineminus">-        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l14.262"></a><span id="l14.262" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineminus">-            // avoid reinitializing during reshow, for bugs 273914 &amp; 278877 workaround</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineminus">-            if (!this.mIsReshowing) {</span>
<a href="#l14.265"></a><span id="l14.265" class="difflineminus">-                this.mInPopup = true;</span>
<a href="#l14.266"></a><span id="l14.266" class="difflineminus">-                if (this.mValue == &quot;forever&quot;) {</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineminus">-                    this.kMinimonth.update(null);</span>
<a href="#l14.268"></a><span id="l14.268" class="difflineminus">-                    this.menuitemForever.setAttribute(&quot;highlight&quot;, &quot;true&quot;);</span>
<a href="#l14.269"></a><span id="l14.269" class="difflineminus">-                } else {</span>
<a href="#l14.270"></a><span id="l14.270" class="difflineminus">-                    this.kMinimonth.update(this.mValue);</span>
<a href="#l14.271"></a><span id="l14.271" class="difflineminus">-                    this.menuitemForever.removeAttribute(&quot;highlight&quot;);</span>
<a href="#l14.272"></a><span id="l14.272" class="difflineminus">-                }</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineminus">-                this.mInPopup = false;</span>
<a href="#l14.274"></a><span id="l14.274" class="difflineminus">-            }</span>
<a href="#l14.275"></a><span id="l14.275" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.277"></a><span id="l14.277" class="difflineminus">-</span>
<a href="#l14.278"></a><span id="l14.278" class="difflineminus">-      &lt;property name=&quot;valueValid&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l14.279"></a><span id="l14.279" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.280"></a><span id="l14.280" class="difflineminus">-            return (this.mValue != null &amp;&amp; this.mValue != &quot;forever&quot;);</span>
<a href="#l14.281"></a><span id="l14.281" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.282"></a><span id="l14.282" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l14.284"></a><span id="l14.284" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l14.285"></a><span id="l14.285" class="difflineminus">-</span>
<a href="#l14.286"></a><span id="l14.286" class="difflineminus">-  &lt;binding id=&quot;timepicker&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;&gt;</span>
<a href="#l14.287"></a><span id="l14.287" class="difflineminus">-    &lt;!-- Desired behavior: when user is done editing the time field</span>
<a href="#l14.288"></a><span id="l14.288" class="difflineminus">-         and either leaves the field (onblur) or closes the dialog</span>
<a href="#l14.289"></a><span id="l14.289" class="difflineminus">-         (13 is enter/return key), parse the time and redisplay it</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineminus">-         in the time field using the current format to verify</span>
<a href="#l14.291"></a><span id="l14.291" class="difflineminus">-         whether the time was parsed correctly.</span>
<a href="#l14.292"></a><span id="l14.292" class="difflineminus">-         This cannot be done with textbox oninput, so use a workaround.</span>
<a href="#l14.293"></a><span id="l14.293" class="difflineminus">-         This was done with textbox onkeypress=&quot;parseTextBoxTime(true)&quot;</span>
<a href="#l14.294"></a><span id="l14.294" class="difflineminus">-         and onblur=&quot;parseTextBoxTime(true)&quot; which worked in Moz1.6, but</span>
<a href="#l14.295"></a><span id="l14.295" class="difflineminus">-         no longer works in Moz1.7.</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineminus">-         Therefore constructor stores attribute kTimePicker on the textbox,</span>
<a href="#l14.297"></a><span id="l14.297" class="difflineminus">-         and the onblur and onkeypress commands navigate to this kTimePicker.</span>
<a href="#l14.298"></a><span id="l14.298" class="difflineminus">-         xul:Textbox contains an xul:hbox which contains html:input.</span>
<a href="#l14.299"></a><span id="l14.299" class="difflineminus">-         Onkeypress and onblur are not documented attributes of xul:textbox,</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineminus">-         but become attributes of the html:input.</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineminus">-         Not clear how to navigate from the textbox to the input, otherwise</span>
<a href="#l14.302"></a><span id="l14.302" class="difflineminus">-         could put kTimePicker property on the input element.</span>
<a href="#l14.303"></a><span id="l14.303" class="difflineminus">-         [document.getAnonymousNodes(textBox) fails as of Moz1.7b]).</span>
<a href="#l14.304"></a><span id="l14.304" class="difflineminus">-         So navigate parents to textbox in order to call parseTextBoxTime.</span>
<a href="#l14.305"></a><span id="l14.305" class="difflineminus">-         [this comment is outside the &lt;content&gt; so it won't become a</span>
<a href="#l14.306"></a><span id="l14.306" class="difflineminus">-         node that interferes with navigation to interior nodes.] --&gt;</span>
<a href="#l14.307"></a><span id="l14.307" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l14.308"></a><span id="l14.308" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; id=&quot;hbox&quot; class=&quot;timepicker-box-class&quot;&gt;</span>
<a href="#l14.309"></a><span id="l14.309" class="difflineminus">-        &lt;xul:xbl-menulist editable=&quot;true&quot; sizetopopup=&quot;false&quot;</span>
<a href="#l14.310"></a><span id="l14.310" class="difflineminus">-                          id=&quot;timepicker-text&quot;</span>
<a href="#l14.311"></a><span id="l14.311" class="difflineminus">-                          class=&quot;timepicker-text-class&quot;</span>
<a href="#l14.312"></a><span id="l14.312" class="difflineminus">-                          onchange=&quot;this.kTimePicker.parseTextBoxTime(true, event);&quot;</span>
<a href="#l14.313"></a><span id="l14.313" class="difflineminus">-                          onkeypress=&quot;if (event.key == 'Enter') this.kTimePicker.parseTextBoxTime(true);&quot;</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineminus">-                          xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l14.315"></a><span id="l14.315" class="difflineminus">-          &lt;xul:menupopup popupalign=&quot;topright&quot; popupanchor=&quot;bottomright&quot;</span>
<a href="#l14.316"></a><span id="l14.316" class="difflineminus">-                         onpopupshowing=&quot;onPopup(this)&quot;</span>
<a href="#l14.317"></a><span id="l14.317" class="difflineminus">-                         onpopuphiding=&quot;onHide(this)&quot;&gt;</span>
<a href="#l14.318"></a><span id="l14.318" class="difflineminus">-            &lt;xul:timepicker-grids anonid=&quot;timepickerGrids&quot;/&gt;</span>
<a href="#l14.319"></a><span id="l14.319" class="difflineminus">-          &lt;/xul:menupopup&gt;</span>
<a href="#l14.320"></a><span id="l14.320" class="difflineminus">-        &lt;/xul:xbl-menulist&gt;</span>
<a href="#l14.321"></a><span id="l14.321" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l14.322"></a><span id="l14.322" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l14.323"></a><span id="l14.323" class="difflineminus">-</span>
<a href="#l14.324"></a><span id="l14.324" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l14.325"></a><span id="l14.325" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.326"></a><span id="l14.326" class="difflineminus">-          const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l14.327"></a><span id="l14.327" class="difflineminus">-</span>
<a href="#l14.328"></a><span id="l14.328" class="difflineminus">-          let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l14.329"></a><span id="l14.329" class="difflineminus">-          this.kTextBox = hbox.childNodes[0];</span>
<a href="#l14.330"></a><span id="l14.330" class="difflineminus">-          this.kTextBox.kTimePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l14.331"></a><span id="l14.331" class="difflineminus">-</span>
<a href="#l14.332"></a><span id="l14.332" class="difflineminus">-          let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l14.333"></a><span id="l14.333" class="difflineminus">-          if (val) {</span>
<a href="#l14.334"></a><span id="l14.334" class="difflineminus">-              this.value = new Date(val);</span>
<a href="#l14.335"></a><span id="l14.335" class="difflineminus">-          } else {</span>
<a href="#l14.336"></a><span id="l14.336" class="difflineminus">-              this.value = new Date();</span>
<a href="#l14.337"></a><span id="l14.337" class="difflineminus">-          }</span>
<a href="#l14.338"></a><span id="l14.338" class="difflineminus">-</span>
<a href="#l14.339"></a><span id="l14.339" class="difflineminus">-          // Change the grids in the timepicker-grids for 12-hours time format.</span>
<a href="#l14.340"></a><span id="l14.340" class="difflineminus">-          if (this.ampmIndex) {</span>
<a href="#l14.341"></a><span id="l14.341" class="difflineminus">-              // Find the locale strings for the AM/PM prefix/suffix.</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineminus">-              let amTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l14.343"></a><span id="l14.343" class="difflineminus">-              let pmTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l14.344"></a><span id="l14.344" class="difflineminus">-              let formatter = new Services.intl.DateTimeFormat(undefined, this.kTimeFormatObject);</span>
<a href="#l14.345"></a><span id="l14.345" class="difflineminus">-              amTime = formatter.format(amTime);</span>
<a href="#l14.346"></a><span id="l14.346" class="difflineminus">-              pmTime = formatter.format(pmTime);</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineminus">-              let amLabel = this.parseTimeRegExp.exec(amTime)[this.ampmIndex] || &quot;AM&quot;;</span>
<a href="#l14.348"></a><span id="l14.348" class="difflineminus">-              let pmLabel = this.parseTimeRegExp.exec(pmTime)[this.ampmIndex] || &quot;PM&quot;;</span>
<a href="#l14.349"></a><span id="l14.349" class="difflineminus">-</span>
<a href="#l14.350"></a><span id="l14.350" class="difflineminus">-              document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timepickerGrids&quot;)</span>
<a href="#l14.351"></a><span id="l14.351" class="difflineminus">-                      .changeTo12HoursFormat(amLabel, pmLabel);</span>
<a href="#l14.352"></a><span id="l14.352" class="difflineminus">-          }</span>
<a href="#l14.353"></a><span id="l14.353" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l14.354"></a><span id="l14.354" class="difflineminus">-</span>
<a href="#l14.355"></a><span id="l14.355" class="difflineminus">-      &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-        &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineminus">-        &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l14.358"></a><span id="l14.358" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.359"></a><span id="l14.359" class="difflineminus">-            let timeChanged = false;</span>
<a href="#l14.360"></a><span id="l14.360" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l14.361"></a><span id="l14.361" class="difflineminus">-                if (this.mValue) {</span>
<a href="#l14.362"></a><span id="l14.362" class="difflineminus">-                    timeChanged = this.mValue.getHours() != aValue.getHours() ||</span>
<a href="#l14.363"></a><span id="l14.363" class="difflineminus">-                                  this.mValue.getMinutes() != aValue.getMinutes();</span>
<a href="#l14.364"></a><span id="l14.364" class="difflineminus">-                }</span>
<a href="#l14.365"></a><span id="l14.365" class="difflineminus">-                this.mValue = aValue;</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineminus">-            }</span>
<a href="#l14.367"></a><span id="l14.367" class="difflineminus">-            // set textBox.value property, not attribute</span>
<a href="#l14.368"></a><span id="l14.368" class="difflineminus">-            this.kTextBox.value = this.formatTime(this.mValue);</span>
<a href="#l14.369"></a><span id="l14.369" class="difflineminus">-</span>
<a href="#l14.370"></a><span id="l14.370" class="difflineminus">-            if (aValue != null &amp;&amp; aRefresh &amp;&amp; timeChanged) {</span>
<a href="#l14.371"></a><span id="l14.371" class="difflineminus">-                let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l14.372"></a><span id="l14.372" class="difflineminus">-                event.initEvent(&quot;change&quot;, true, true);</span>
<a href="#l14.373"></a><span id="l14.373" class="difflineminus">-                this.dispatchEvent(event);</span>
<a href="#l14.374"></a><span id="l14.374" class="difflineminus">-            }</span>
<a href="#l14.375"></a><span id="l14.375" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.376"></a><span id="l14.376" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.377"></a><span id="l14.377" class="difflineminus">-</span>
<a href="#l14.378"></a><span id="l14.378" class="difflineminus">-      &lt;method name=&quot;parseTextBoxTime&quot;&gt;</span>
<a href="#l14.379"></a><span id="l14.379" class="difflineminus">-        &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l14.380"></a><span id="l14.380" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l14.381"></a><span id="l14.381" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.382"></a><span id="l14.382" class="difflineminus">-            // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l14.383"></a><span id="l14.383" class="difflineminus">-            // fired inside the update method.</span>
<a href="#l14.384"></a><span id="l14.384" class="difflineminus">-            if (aEvent) {</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineminus">-                aEvent.stopPropagation();</span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-            }</span>
<a href="#l14.387"></a><span id="l14.387" class="difflineminus">-            let time = this.parseTime(this.kTextBox.value);</span>
<a href="#l14.388"></a><span id="l14.388" class="difflineminus">-            this.update(time, aRefresh);</span>
<a href="#l14.389"></a><span id="l14.389" class="difflineminus">-            return time;</span>
<a href="#l14.390"></a><span id="l14.390" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.391"></a><span id="l14.391" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.392"></a><span id="l14.392" class="difflineminus">-</span>
<a href="#l14.393"></a><span id="l14.393" class="difflineminus">-      &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l14.394"></a><span id="l14.394" class="difflineminus">-        &lt;parameter name=&quot;aPopup&quot; /&gt;</span>
<a href="#l14.395"></a><span id="l14.395" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.396"></a><span id="l14.396" class="difflineminus">-            // select all to remove cursor since can't type while popped-up</span>
<a href="#l14.397"></a><span id="l14.397" class="difflineminus">-            this.select();</span>
<a href="#l14.398"></a><span id="l14.398" class="difflineminus">-            let timePickerGrid = aPopup.childNodes[0];</span>
<a href="#l14.399"></a><span id="l14.399" class="difflineminus">-            timePickerGrid.onPopupShowing(this, aPopup);</span>
<a href="#l14.400"></a><span id="l14.400" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.401"></a><span id="l14.401" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.402"></a><span id="l14.402" class="difflineminus">-</span>
<a href="#l14.403"></a><span id="l14.403" class="difflineminus">-      &lt;method name=&quot;onHide&quot;&gt;</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineminus">-        &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l14.405"></a><span id="l14.405" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.406"></a><span id="l14.406" class="difflineminus">-            // This is the timepicker grid.  Why aren't we using anonid?</span>
<a href="#l14.407"></a><span id="l14.407" class="difflineminus">-            aPopup.childNodes[0].onPopupHiding();</span>
<a href="#l14.408"></a><span id="l14.408" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.409"></a><span id="l14.409" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.410"></a><span id="l14.410" class="difflineminus">-</span>
<a href="#l14.411"></a><span id="l14.411" class="difflineminus">-      &lt;method name=&quot;select&quot;&gt;</span>
<a href="#l14.412"></a><span id="l14.412" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.413"></a><span id="l14.413" class="difflineminus">-            // select all in text box</span>
<a href="#l14.414"></a><span id="l14.414" class="difflineminus">-            this.kTextBox.select();</span>
<a href="#l14.415"></a><span id="l14.415" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.416"></a><span id="l14.416" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.417"></a><span id="l14.417" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l14.418"></a><span id="l14.418" class="difflineminus">-</span>
<a href="#l14.419"></a><span id="l14.419" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l14.420"></a><span id="l14.420" class="difflineminus">-      &lt;handler event=&quot;blur&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l14.421"></a><span id="l14.421" class="difflineminus">-          this.parseTextBoxTime(true);</span>
<a href="#l14.422"></a><span id="l14.422" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l14.423"></a><span id="l14.423" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l14.424"></a><span id="l14.424" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l14.425"></a><span id="l14.425" class="difflineminus">-</span>
<a href="#l14.426"></a><span id="l14.426">   &lt;binding id=&quot;timepicker-hour&quot;&gt;</span>
<a href="#l14.427"></a><span id="l14.427">     &lt;content&gt;</span>
<a href="#l14.428"></a><span id="l14.428">       &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l14.429"></a><span id="l14.429">       &lt;xul:vbox anonid=&quot;hourbox&quot;</span>
<a href="#l14.430"></a><span id="l14.430">                 onclick=&quot;clickHour(this.parentNode, this.parentNode.getAttribute('value'))&quot;</span>
<a href="#l14.431"></a><span id="l14.431">                 ondblclick=&quot;doubleClickHour(this.parentNode, this.parentNode.getAttribute('value'))&quot;&gt;</span>
<a href="#l14.432"></a><span id="l14.432">         &lt;xul:box&gt;</span>
<a href="#l14.433"></a><span id="l14.433">           &lt;xul:label class=&quot;time-picker-hour-label&quot; anonid=&quot;hourlabel&quot; xbl:inherits=&quot;value=label,selected&quot;/&gt;</span>
<a href="#l14.434"></a><span id="l14.434" class="difflineat">@@ -1032,45 +618,50 @@</span>
<a href="#l14.435"></a><span id="l14.435">         &lt;/vbox&gt; &lt;!-- One  Minute Grid Box --&gt;</span>
<a href="#l14.436"></a><span id="l14.436">       &lt;/vbox&gt; &lt;!-- Box to hold time picker internals --&gt;</span>
<a href="#l14.437"></a><span id="l14.437">     &lt;/content&gt;</span>
<a href="#l14.438"></a><span id="l14.438"> </span>
<a href="#l14.439"></a><span id="l14.439">     &lt;implementation&gt;</span>
<a href="#l14.440"></a><span id="l14.440">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.441"></a><span id="l14.441">           // set by onPopupShowing</span>
<a href="#l14.442"></a><span id="l14.442">           this.mPicker = null;</span>
<a href="#l14.443"></a><span id="l14.443" class="difflineminus">-          this.mPopup = null;</span>
<a href="#l14.444"></a><span id="l14.444"> </span>
<a href="#l14.445"></a><span id="l14.445">           // The currently selected time</span>
<a href="#l14.446"></a><span id="l14.446">           this.mSelectedTime = new Date();</span>
<a href="#l14.447"></a><span id="l14.447">           // The selected hour and selected minute items</span>
<a href="#l14.448"></a><span id="l14.448">           this.mSelectedHourItem = null;</span>
<a href="#l14.449"></a><span id="l14.449">           this.mSelectedMinuteItem = null;</span>
<a href="#l14.450"></a><span id="l14.450">           // constants use to specify one and five minute view</span>
<a href="#l14.451"></a><span id="l14.451">           this.kMINUTE_VIEW_FIVE = 5;</span>
<a href="#l14.452"></a><span id="l14.452">           this.kMINUTE_VIEW_ONE = 1;</span>
<a href="#l14.453"></a><span id="l14.453">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l14.454"></a><span id="l14.454"> </span>
<a href="#l14.455"></a><span id="l14.455" class="difflineplus">+      &lt;property name=&quot;value&quot;&gt;</span>
<a href="#l14.456"></a><span id="l14.456" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.457"></a><span id="l14.457" class="difflineplus">+            return [</span>
<a href="#l14.458"></a><span id="l14.458" class="difflineplus">+                this.mSelectedTime.getHours(),</span>
<a href="#l14.459"></a><span id="l14.459" class="difflineplus">+                this.mSelectedTime.getMinutes(),</span>
<a href="#l14.460"></a><span id="l14.460" class="difflineplus">+            ];</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.462"></a><span id="l14.462" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l14.463"></a><span id="l14.463" class="difflineplus">+            if (typeof val == &quot;string&quot;) {</span>
<a href="#l14.464"></a><span id="l14.464" class="difflineplus">+                val = parseTime(val);</span>
<a href="#l14.465"></a><span id="l14.465" class="difflineplus">+            } else if (Array.isArray(val)) {</span>
<a href="#l14.466"></a><span id="l14.466" class="difflineplus">+                let [hours, minutes] = val;</span>
<a href="#l14.467"></a><span id="l14.467" class="difflineplus">+                val = new Date();</span>
<a href="#l14.468"></a><span id="l14.468" class="difflineplus">+                val.setHours(hours);</span>
<a href="#l14.469"></a><span id="l14.469" class="difflineplus">+                val.setMinutes(minutes);</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineplus">+            }</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineplus">+            this.mSelectedTime = val;</span>
<a href="#l14.472"></a><span id="l14.472" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l14.473"></a><span id="l14.473" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l14.474"></a><span id="l14.474" class="difflineplus">+</span>
<a href="#l14.475"></a><span id="l14.475">       &lt;!-- Set up the picker, called when the popup pops --&gt;</span>
<a href="#l14.476"></a><span id="l14.476">       &lt;method name=&quot;onPopupShowing&quot;&gt;</span>
<a href="#l14.477"></a><span id="l14.477" class="difflineminus">-        &lt;parameter name=&quot;aPicker&quot;/&gt;</span>
<a href="#l14.478"></a><span id="l14.478" class="difflineminus">-        &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l14.479"></a><span id="l14.479">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.480"></a><span id="l14.480" class="difflineminus">-            this.mPicker = aPicker;</span>
<a href="#l14.481"></a><span id="l14.481" class="difflineminus">-            this.mPopup = aPopup;</span>
<a href="#l14.482"></a><span id="l14.482" class="difflineminus">-</span>
<a href="#l14.483"></a><span id="l14.483" class="difflineminus">-            // if there is a Date object in the popup item's</span>
<a href="#l14.484"></a><span id="l14.484" class="difflineminus">-            // value attribute, use it, otherwise use Now.</span>
<a href="#l14.485"></a><span id="l14.485" class="difflineminus">-            let inputTime = this.mPicker.value;</span>
<a href="#l14.486"></a><span id="l14.486" class="difflineminus">-            if (inputTime) {</span>
<a href="#l14.487"></a><span id="l14.487" class="difflineminus">-                this.mSelectedTime = new Date(inputTime);</span>
<a href="#l14.488"></a><span id="l14.488" class="difflineminus">-            } else {</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineminus">-                this.mSelectedTime = new Date();</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineminus">-            }</span>
<a href="#l14.491"></a><span id="l14.491" class="difflineminus">-</span>
<a href="#l14.492"></a><span id="l14.492">             // select the hour item</span>
<a href="#l14.493"></a><span id="l14.493">             let hours24 = this.mSelectedTime.getHours();</span>
<a href="#l14.494"></a><span id="l14.494">             let hourItemId = &quot;time-picker-hour-box-&quot; + hours24;</span>
<a href="#l14.495"></a><span id="l14.495">             let hourItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, hourItemId);</span>
<a href="#l14.496"></a><span id="l14.496">             this.selectHourItem(hourItem);</span>
<a href="#l14.497"></a><span id="l14.497"> </span>
<a href="#l14.498"></a><span id="l14.498">             // Show the five minute view if we are an even five minutes,</span>
<a href="#l14.499"></a><span id="l14.499">             // otherwise one minute view</span>
<a href="#l14.500"></a><span id="l14.500" class="difflineat">@@ -1079,24 +670,16 @@</span>
<a href="#l14.501"></a><span id="l14.501">             if (minutesByFive == this.mSelectedTime.getMinutes()) {</span>
<a href="#l14.502"></a><span id="l14.502">                 this.clickLess();</span>
<a href="#l14.503"></a><span id="l14.503">             } else {</span>
<a href="#l14.504"></a><span id="l14.504">                 this.clickMore();</span>
<a href="#l14.505"></a><span id="l14.505">             }</span>
<a href="#l14.506"></a><span id="l14.506">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.507"></a><span id="l14.507">       &lt;/method&gt;</span>
<a href="#l14.508"></a><span id="l14.508"> </span>
<a href="#l14.509"></a><span id="l14.509" class="difflineminus">-      &lt;method name=&quot;onPopupHiding&quot;&gt;</span>
<a href="#l14.510"></a><span id="l14.510" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.511"></a><span id="l14.511" class="difflineminus">-            if (this.hasChanged) {</span>
<a href="#l14.512"></a><span id="l14.512" class="difflineminus">-                this.timeSelected();</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineminus">-            }</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.515"></a><span id="l14.515" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.516"></a><span id="l14.516" class="difflineminus">-</span>
<a href="#l14.517"></a><span id="l14.517">       &lt;!-- Called when the more tab is clicked, and possibly at startup --&gt;</span>
<a href="#l14.518"></a><span id="l14.518">       &lt;method name=&quot;clickMore&quot;&gt;</span>
<a href="#l14.519"></a><span id="l14.519">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.520"></a><span id="l14.520">             // switch to one minute view</span>
<a href="#l14.521"></a><span id="l14.521">             this.switchMinuteView(this.kMINUTE_VIEW_ONE);</span>
<a href="#l14.522"></a><span id="l14.522"> </span>
<a href="#l14.523"></a><span id="l14.523">             // select minute box corresponding to the time</span>
<a href="#l14.524"></a><span id="l14.524">             let minutes = this.mSelectedTime.getMinutes();</span>
<a href="#l14.525"></a><span id="l14.525" class="difflineat">@@ -1142,47 +725,32 @@</span>
<a href="#l14.526"></a><span id="l14.526">            Sets the time to the selected hour, on the hour, and closes the popup --&gt;</span>
<a href="#l14.527"></a><span id="l14.527">       &lt;method name=&quot;doubleClickHour&quot;&gt;</span>
<a href="#l14.528"></a><span id="l14.528">         &lt;parameter name=&quot;hourItem&quot;/&gt;</span>
<a href="#l14.529"></a><span id="l14.529">         &lt;parameter name=&quot;hourNumber&quot;/&gt;</span>
<a href="#l14.530"></a><span id="l14.530">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.531"></a><span id="l14.531">             // set the minutes to :00</span>
<a href="#l14.532"></a><span id="l14.532">             this.mSelectedTime.setMinutes(0);</span>
<a href="#l14.533"></a><span id="l14.533"> </span>
<a href="#l14.534"></a><span id="l14.534" class="difflineminus">-            // remove the popup grid</span>
<a href="#l14.535"></a><span id="l14.535" class="difflineminus">-            this.mPopup.hidePopup();</span>
<a href="#l14.536"></a><span id="l14.536" class="difflineplus">+            this.dispatchEvent(new CustomEvent(&quot;select&quot;));</span>
<a href="#l14.537"></a><span id="l14.537">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.538"></a><span id="l14.538">       &lt;/method&gt;</span>
<a href="#l14.539"></a><span id="l14.539"> </span>
<a href="#l14.540"></a><span id="l14.540">       &lt;!-- Called when one of the minute boxes is clicked,</span>
<a href="#l14.541"></a><span id="l14.541">            Calls the client's onchange and Closes the popup --&gt;</span>
<a href="#l14.542"></a><span id="l14.542">       &lt;method name=&quot;clickMinute&quot;&gt;</span>
<a href="#l14.543"></a><span id="l14.543">         &lt;parameter name=&quot;minuteItem&quot;/&gt;</span>
<a href="#l14.544"></a><span id="l14.544">         &lt;parameter name=&quot;minuteNumber&quot;/&gt;</span>
<a href="#l14.545"></a><span id="l14.545">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.546"></a><span id="l14.546">             // set the minutes in the selected time</span>
<a href="#l14.547"></a><span id="l14.547">             this.mSelectedTime.setMinutes(minuteNumber);</span>
<a href="#l14.548"></a><span id="l14.548">             this.selectMinuteItem(minuteItem);</span>
<a href="#l14.549"></a><span id="l14.549">             this.hasChanged = true;</span>
<a href="#l14.550"></a><span id="l14.550" class="difflineminus">-            // remove the popup grid</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineminus">-            this.mPopup.hidePopup();</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.553"></a><span id="l14.553" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.554"></a><span id="l14.554"> </span>
<a href="#l14.555"></a><span id="l14.555" class="difflineminus">-      &lt;!-- Called by clickMinute when one of the minute boxes is clicked,</span>
<a href="#l14.556"></a><span id="l14.556" class="difflineminus">-           Sets the value property and calls the client's onchange. --&gt;</span>
<a href="#l14.557"></a><span id="l14.557" class="difflineminus">-      &lt;method name=&quot;timeSelected&quot;&gt;</span>
<a href="#l14.558"></a><span id="l14.558" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.559"></a><span id="l14.559" class="difflineminus">-            // Copy picked time to avoid problems changing Date object in place</span>
<a href="#l14.560"></a><span id="l14.560" class="difflineminus">-            let pickedTime = new Date(this.mSelectedTime);</span>
<a href="#l14.561"></a><span id="l14.561" class="difflineminus">-</span>
<a href="#l14.562"></a><span id="l14.562" class="difflineminus">-            // put the picked time in the value property, and update</span>
<a href="#l14.563"></a><span id="l14.563" class="difflineminus">-            this.mPicker.update(pickedTime, true);</span>
<a href="#l14.564"></a><span id="l14.564" class="difflineminus">-            // select changed value so no cursor appears (can't type to it).</span>
<a href="#l14.565"></a><span id="l14.565" class="difflineminus">-            this.mPicker.select();</span>
<a href="#l14.566"></a><span id="l14.566" class="difflineplus">+            this.dispatchEvent(new CustomEvent(&quot;select&quot;));</span>
<a href="#l14.567"></a><span id="l14.567">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.568"></a><span id="l14.568">       &lt;/method&gt;</span>
<a href="#l14.569"></a><span id="l14.569"> </span>
<a href="#l14.570"></a><span id="l14.570">       &lt;!-- Helper function to switch between &quot;one&quot; and &quot;five&quot; minute views --&gt;</span>
<a href="#l14.571"></a><span id="l14.571">       &lt;method name=&quot;switchMinuteView&quot;&gt;</span>
<a href="#l14.572"></a><span id="l14.572">         &lt;parameter name=&quot;view&quot;/&gt;</span>
<a href="#l14.573"></a><span id="l14.573">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.574"></a><span id="l14.574">             let fiveMinuteBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-five-minute-grid-box&quot;);</span>
<a href="#l14.575"></a><span id="l14.575" class="difflineat">@@ -1332,109 +900,16 @@</span>
<a href="#l14.576"></a><span id="l14.576">             }</span>
<a href="#l14.577"></a><span id="l14.577">             document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-hour-grid&quot;)</span>
<a href="#l14.578"></a><span id="l14.578">                     .setAttribute(&quot;format12hours&quot;, &quot;true&quot;);</span>
<a href="#l14.579"></a><span id="l14.579">         ]]&gt;&lt;/body&gt;</span>
<a href="#l14.580"></a><span id="l14.580">       &lt;/method&gt;</span>
<a href="#l14.581"></a><span id="l14.581">     &lt;/implementation&gt;</span>
<a href="#l14.582"></a><span id="l14.582">   &lt;/binding&gt;</span>
<a href="#l14.583"></a><span id="l14.583"> </span>
<a href="#l14.584"></a><span id="l14.584" class="difflineminus">-  &lt;binding id=&quot;datetimepicker&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;</span>
<a href="#l14.585"></a><span id="l14.585" class="difflineminus">-           inherits=&quot;value,onchange,disabled,datepickerdisabled,timepickerdisabled&quot;&gt;</span>
<a href="#l14.586"></a><span id="l14.586" class="difflineminus">-    &lt;!-- onchange was simply &quot;onDatePick()&quot; in Moz1.6, but stopped working in Moz1.7</span>
<a href="#l14.587"></a><span id="l14.587" class="difflineminus">-         so had to add navigation by parents. --&gt;</span>
<a href="#l14.588"></a><span id="l14.588" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l14.589"></a><span id="l14.589" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; anonid=&quot;hbox&quot;&gt;</span>
<a href="#l14.590"></a><span id="l14.590" class="difflineminus">-        &lt;xul:datepicker anonid=&quot;date-picker&quot;</span>
<a href="#l14.591"></a><span id="l14.591" class="difflineminus">-                        onchange=&quot;this.parentNode.parentNode.onDatePick();&quot;</span>
<a href="#l14.592"></a><span id="l14.592" class="difflineminus">-                        xbl:inherits=&quot;value,disabled,disabled=datepickerdisabled&quot;/&gt;</span>
<a href="#l14.593"></a><span id="l14.593" class="difflineminus">-        &lt;xul:timepicker anonid=&quot;time-picker&quot;</span>
<a href="#l14.594"></a><span id="l14.594" class="difflineminus">-                        onchange=&quot;this.parentNode.parentNode.onTimePick();&quot;</span>
<a href="#l14.595"></a><span id="l14.595" class="difflineminus">-                        xbl:inherits=&quot;value,disabled,disabled=timepickerdisabled&quot;/&gt;</span>
<a href="#l14.596"></a><span id="l14.596" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l14.597"></a><span id="l14.597" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l14.598"></a><span id="l14.598" class="difflineminus">-</span>
<a href="#l14.599"></a><span id="l14.599" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l14.600"></a><span id="l14.600" class="difflineminus">-      &lt;property name=&quot;datepickerdisabled&quot;</span>
<a href="#l14.601"></a><span id="l14.601" class="difflineminus">-                onset=&quot;if (val) this.kDatePicker.setAttribute('disabled', 'true');</span>
<a href="#l14.602"></a><span id="l14.602" class="difflineminus">-                       else this.kDatePicker.removeAttribute('disabled');&quot;</span>
<a href="#l14.603"></a><span id="l14.603" class="difflineminus">-                onget=&quot;return this.kDatePicker.getAttribute('disabled')=='true';&quot;/&gt;</span>
<a href="#l14.604"></a><span id="l14.604" class="difflineminus">-</span>
<a href="#l14.605"></a><span id="l14.605" class="difflineminus">-      &lt;!-- timepicker may be disabled alone for all day events --&gt;</span>
<a href="#l14.606"></a><span id="l14.606" class="difflineminus">-      &lt;property name=&quot;timepickerdisabled&quot;</span>
<a href="#l14.607"></a><span id="l14.607" class="difflineminus">-                onset=&quot;if (val) this.kTimePicker.setAttribute('disabled', 'true');</span>
<a href="#l14.608"></a><span id="l14.608" class="difflineminus">-                       else this.kTimePicker.removeAttribute('disabled');&quot;</span>
<a href="#l14.609"></a><span id="l14.609" class="difflineminus">-                onget=&quot;return this.kTimePicker.getAttribute('disabled')=='true';&quot;/&gt;</span>
<a href="#l14.610"></a><span id="l14.610" class="difflineminus">-</span>
<a href="#l14.611"></a><span id="l14.611" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.612"></a><span id="l14.612" class="difflineminus">-          this.kDatePicker =</span>
<a href="#l14.613"></a><span id="l14.613" class="difflineminus">-              document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-picker&quot;);</span>
<a href="#l14.614"></a><span id="l14.614" class="difflineminus">-          this.kTimePicker =</span>
<a href="#l14.615"></a><span id="l14.615" class="difflineminus">-              document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker&quot;);</span>
<a href="#l14.616"></a><span id="l14.616" class="difflineminus">-</span>
<a href="#l14.617"></a><span id="l14.617" class="difflineminus">-          let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l14.618"></a><span id="l14.618" class="difflineminus">-          this.mValue = (val ? new Date(val)</span>
<a href="#l14.619"></a><span id="l14.619" class="difflineminus">-                             : new Date());</span>
<a href="#l14.620"></a><span id="l14.620" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l14.621"></a><span id="l14.621" class="difflineminus">-</span>
<a href="#l14.622"></a><span id="l14.622" class="difflineminus">-      &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l14.623"></a><span id="l14.623" class="difflineminus">-        &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l14.624"></a><span id="l14.624" class="difflineminus">-        &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l14.625"></a><span id="l14.625" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.626"></a><span id="l14.626" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l14.627"></a><span id="l14.627" class="difflineminus">-                this.mValue = aValue;</span>
<a href="#l14.628"></a><span id="l14.628" class="difflineminus">-            }</span>
<a href="#l14.629"></a><span id="l14.629" class="difflineminus">-            // set textBox.value property, not attribute</span>
<a href="#l14.630"></a><span id="l14.630" class="difflineminus">-            this.kDatePicker.update(this.mValue, aRefresh);</span>
<a href="#l14.631"></a><span id="l14.631" class="difflineminus">-            this.kTimePicker.update(this.mValue, aRefresh);</span>
<a href="#l14.632"></a><span id="l14.632" class="difflineminus">-            if (aRefresh) {</span>
<a href="#l14.633"></a><span id="l14.633" class="difflineminus">-                this.fireEvent(&quot;change&quot;);</span>
<a href="#l14.634"></a><span id="l14.634" class="difflineminus">-            }</span>
<a href="#l14.635"></a><span id="l14.635" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.636"></a><span id="l14.636" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.637"></a><span id="l14.637" class="difflineminus">-</span>
<a href="#l14.638"></a><span id="l14.638" class="difflineminus">-      &lt;!-- Date was changed by gui: update value. --&gt;</span>
<a href="#l14.639"></a><span id="l14.639" class="difflineminus">-      &lt;method name=&quot;onDatePick&quot;&gt;</span>
<a href="#l14.640"></a><span id="l14.640" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.641"></a><span id="l14.641" class="difflineminus">-            let tempTime;</span>
<a href="#l14.642"></a><span id="l14.642" class="difflineminus">-            if (this.kDatePicker.lastDateParseIncludedTime) {</span>
<a href="#l14.643"></a><span id="l14.643" class="difflineminus">-                tempTime = new Date(this.kDatePicker.value);</span>
<a href="#l14.644"></a><span id="l14.644" class="difflineminus">-            } else {</span>
<a href="#l14.645"></a><span id="l14.645" class="difflineminus">-                tempTime = new Date(this.mValue);</span>
<a href="#l14.646"></a><span id="l14.646" class="difflineminus">-            }</span>
<a href="#l14.647"></a><span id="l14.647" class="difflineminus">-            let newDate = new Date(this.kDatePicker.value);</span>
<a href="#l14.648"></a><span id="l14.648" class="difflineminus">-            // Note: create new date because setting month and date of month in</span>
<a href="#l14.649"></a><span id="l14.649" class="difflineminus">-            // either order can lead to unexpected results (month may be advanced</span>
<a href="#l14.650"></a><span id="l14.650" class="difflineminus">-            // automatically if day of month is temporarily out of range).</span>
<a href="#l14.651"></a><span id="l14.651" class="difflineminus">-            let dateTime = new Date(newDate.getFullYear(),</span>
<a href="#l14.652"></a><span id="l14.652" class="difflineminus">-                                    newDate.getMonth(),</span>
<a href="#l14.653"></a><span id="l14.653" class="difflineminus">-                                    newDate.getDate(),</span>
<a href="#l14.654"></a><span id="l14.654" class="difflineminus">-                                    tempTime.getHours(),</span>
<a href="#l14.655"></a><span id="l14.655" class="difflineminus">-                                    tempTime.getMinutes(),</span>
<a href="#l14.656"></a><span id="l14.656" class="difflineminus">-                                    tempTime.getSeconds());</span>
<a href="#l14.657"></a><span id="l14.657" class="difflineminus">-            this.mValue = dateTime;</span>
<a href="#l14.658"></a><span id="l14.658" class="difflineminus">-            this.kTimePicker.update(dateTime, false);</span>
<a href="#l14.659"></a><span id="l14.659" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.660"></a><span id="l14.660" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.661"></a><span id="l14.661" class="difflineminus">-</span>
<a href="#l14.662"></a><span id="l14.662" class="difflineminus">-      &lt;!-- Time was changed by gui: update value --&gt;</span>
<a href="#l14.663"></a><span id="l14.663" class="difflineminus">-      &lt;method name=&quot;onTimePick&quot;&gt;</span>
<a href="#l14.664"></a><span id="l14.664" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.665"></a><span id="l14.665" class="difflineminus">-            let dateTime = new Date(this.mValue);</span>
<a href="#l14.666"></a><span id="l14.666" class="difflineminus">-            let newTime = this.kTimePicker.value;</span>
<a href="#l14.667"></a><span id="l14.667" class="difflineminus">-            dateTime.setHours(newTime.getHours());</span>
<a href="#l14.668"></a><span id="l14.668" class="difflineminus">-            dateTime.setMinutes(newTime.getMinutes());</span>
<a href="#l14.669"></a><span id="l14.669" class="difflineminus">-            dateTime.setSeconds(newTime.getSeconds());</span>
<a href="#l14.670"></a><span id="l14.670" class="difflineminus">-            this.mValue = dateTime;</span>
<a href="#l14.671"></a><span id="l14.671" class="difflineminus">-            this.kDatePicker.update(dateTime, false);</span>
<a href="#l14.672"></a><span id="l14.672" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l14.673"></a><span id="l14.673" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l14.674"></a><span id="l14.674" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l14.675"></a><span id="l14.675" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l14.676"></a><span id="l14.676" class="difflineminus">-</span>
<a href="#l14.677"></a><span id="l14.677">   &lt;binding id=&quot;datetimepicker-base&quot; extends=&quot;chrome://global/content/bindings/general.xml#basecontrol&quot;</span>
<a href="#l14.678"></a><span id="l14.678">            inherits=&quot;value,onchange&quot;&gt;</span>
<a href="#l14.679"></a><span id="l14.679">     &lt;implementation&gt;</span>
<a href="#l14.680"></a><span id="l14.680">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.681"></a><span id="l14.681">           this.kTimeFormatObject = { timeStyle: &quot;short&quot; };</span>
<a href="#l14.682"></a><span id="l14.682">           this.initDateFormat();</span>
<a href="#l14.683"></a><span id="l14.683">           this.initTimeFormat();</span>
<a href="#l14.684"></a><span id="l14.684">       ]]&gt;&lt;/constructor&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/resources/skin/datetimepickers.css</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/resources/skin/datetimepickers.css</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,29 +1,21 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.5"></a><span id="l15.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.6"></a><span id="l15.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> /*--------------------------------------------------------------------</span>
<a href="#l15.9"></a><span id="l15.9">  *   Datepicker (text field with minimonth popup)</span>
<a href="#l15.10"></a><span id="l15.10">  *-------------------------------------------------------------------*/</span>
<a href="#l15.11"></a><span id="l15.11">  </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-/* flex box around menulist */</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-.datepicker-box-class {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-}</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">- </span>
<a href="#l15.16"></a><span id="l15.16"> /* menulist */</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-.datepicker-text-class {</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+datepicker &gt; menulist {</span>
<a href="#l15.19"></a><span id="l15.19">   width: 11em;</span>
<a href="#l15.20"></a><span id="l15.20"> }</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-/* text input field */</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-.datepicker-text-class input {</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-}</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-</span>
<a href="#l15.26"></a><span id="l15.26"> /*--------------------------------------------------------------------</span>
<a href="#l15.27"></a><span id="l15.27">  *   Datepicker-forever (style for the &quot;forever&quot; option)</span>
<a href="#l15.28"></a><span id="l15.28">  *-------------------------------------------------------------------*/</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30"> .datepicker-text-menuItem-class {</span>
<a href="#l15.31"></a><span id="l15.31">   margin: 2px 4px 4px;</span>
<a href="#l15.32"></a><span id="l15.32">   color: #2E4E73;</span>
<a href="#l15.33"></a><span id="l15.33">   background-color: transparent;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineat">@@ -51,20 +43,17 @@</span>
<a href="#l15.35"></a><span id="l15.35">   color: HighlightText;</span>
<a href="#l15.36"></a><span id="l15.36">   background-color: Highlight;</span>
<a href="#l15.37"></a><span id="l15.37"> }</span>
<a href="#l15.38"></a><span id="l15.38"> </span>
<a href="#l15.39"></a><span id="l15.39"> /*-------------------------------------------------------------------</span>
<a href="#l15.40"></a><span id="l15.40">  *   Timepicker (text menulist with popup)</span>
<a href="#l15.41"></a><span id="l15.41">  *-------------------------------------------------------------------*/</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-.timepicker-box-class {</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-}</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-.timepicker-text-class {</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+timepicker &gt; menulist {</span>
<a href="#l15.48"></a><span id="l15.48">   width: 8em;</span>
<a href="#l15.49"></a><span id="l15.49"> }</span>
<a href="#l15.50"></a><span id="l15.50"> </span>
<a href="#l15.51"></a><span id="l15.51"> /*-------------------------------------------------------------------</span>
<a href="#l15.52"></a><span id="l15.52">  *   popup (from timepicker/timepicker.css)</span>
<a href="#l15.53"></a><span id="l15.53">  *-------------------------------------------------------------------*/</span>
<a href="#l15.54"></a><span id="l15.54"> </span>
<a href="#l15.55"></a><span id="l15.55"> /* Box that occupies whole window */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -7,17 +7,16 @@ var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l16.4"></a><span id="l16.4"> var MODULE_REQUIRES = [&quot;window-helpers&quot;, &quot;folder-display-helpers&quot;, &quot;pref-window-helpers&quot;];</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l16.7"></a><span id="l16.7"> var utils = ChromeUtils.import(&quot;chrome://mozmill/content/modules/utils.jsm&quot;);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> var SHORT_SLEEP = 100;</span>
<a href="#l16.10"></a><span id="l16.10"> var MID_SLEEP = 500;</span>
<a href="#l16.11"></a><span id="l16.11"> var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-var TIMEOUT_MONTHCHANGE = 10000;</span>
<a href="#l16.13"></a><span id="l16.13"> var CALENDARNAME = &quot;Mozmill&quot;;</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15"> // These are used in EventBox lookup.</span>
<a href="#l16.16"></a><span id="l16.16"> var EVENT_BOX = 0; // Use when you need an event box.</span>
<a href="#l16.17"></a><span id="l16.17"> var CANVAS_BOX = 1; // Use when you need a calendar canvas box.</span>
<a href="#l16.18"></a><span id="l16.18"> var ALLDAY = 2; // Use when you need an allday canvas or event box.</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> // Lookup paths and path-snippets.</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -221,75 +220,57 @@ function switchToView(controller, view) </span>
<a href="#l16.22"></a><span id="l16.22">  * Go to a specific date using minimonth.</span>
<a href="#l16.23"></a><span id="l16.23">  *</span>
<a href="#l16.24"></a><span id="l16.24">  * @param controller    Main window controller</span>
<a href="#l16.25"></a><span id="l16.25">  * @param year          Four-digit year</span>
<a href="#l16.26"></a><span id="l16.26">  * @param month         1-based index of a month</span>
<a href="#l16.27"></a><span id="l16.27">  * @param day           1-based index of a day</span>
<a href="#l16.28"></a><span id="l16.28">  */</span>
<a href="#l16.29"></a><span id="l16.29"> function goToDate(controller, year, month, day) {</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-    let { eid, lookup } = helpersForController(controller);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+    let { lookup } = helpersForController(controller);</span>
<a href="#l16.32"></a><span id="l16.32"> </span>
<a href="#l16.33"></a><span id="l16.33">     let activeYear = lookup(`</span>
<a href="#l16.34"></a><span id="l16.34">         ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-    `).getNode().getAttribute(&quot;label&quot;);</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+    `).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38">     let activeMonth = lookup(`</span>
<a href="#l16.39"></a><span id="l16.39">         ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l16.40"></a><span id="l16.40">     `).getNode().getAttribute(&quot;selectedIndex&quot;);</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42">     let yearDifference = activeYear - year;</span>
<a href="#l16.43"></a><span id="l16.43">     let monthDifference = activeMonth - (month - 1);</span>
<a href="#l16.44"></a><span id="l16.44"> </span>
<a href="#l16.45"></a><span id="l16.45">     if (yearDifference != 0) {</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-        let direction = yearDifference &gt; 0 ? &quot;up&quot; : &quot;down&quot;;</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-        let scrollArrow = lookup(`</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-            ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;years-popup&quot;})/{&quot;class&quot;:&quot;scrollbutton-${direction}&quot;}`);</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-        // Pick year.</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-        controller.click(lookup(`</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-            ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-        `));</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-        let getYearListitem = function(aYear) {</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-            return lookup(`</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-                ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-                anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-                {&quot;label&quot;:&quot;${aYear}&quot;}</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-            `);</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-        };</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+        let scrollArrow = (yearDifference &gt; 0) ? &quot;years-back-button&quot; : &quot;years-forward-button&quot;;</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+        scrollArrow = lookup(</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+            `${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;${scrollArrow}&quot;})`</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+        );</span>
<a href="#l16.67"></a><span id="l16.67"> </span>
<a href="#l16.68"></a><span id="l16.68">         controller.waitForElement(scrollArrow);</span>
<a href="#l16.69"></a><span id="l16.69">         scrollArrow = scrollArrow.getNode();</span>
<a href="#l16.70"></a><span id="l16.70"> </span>
<a href="#l16.71"></a><span id="l16.71">         for (let i = 0; i &lt; Math.abs(yearDifference); i++) {</span>
<a href="#l16.72"></a><span id="l16.72">             scrollArrow.doCommand();</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-            controller.waitForElement(getYearListitem(</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineminus">-                activeYear - ((i+1)*(yearDifference/Math.abs(yearDifference)))</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">-            ));</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+            controller.sleep(10);</span>
<a href="#l16.77"></a><span id="l16.77">         }</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineminus">-</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineminus">-        controller.waitForEvents.init(eid(&quot;calMinimonth&quot;), [&quot;monthchange&quot;]);</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-        controller.click(getYearListitem(year));</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-        controller.waitForEvents.wait(TIMEOUT_MONTHCHANGE);</span>
<a href="#l16.82"></a><span id="l16.82">     }</span>
<a href="#l16.83"></a><span id="l16.83"> </span>
<a href="#l16.84"></a><span id="l16.84">     if (monthDifference != 0) {</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineminus">-        controller.waitForEvents.init(eid(&quot;calMinimonth&quot;), [&quot;monthchange&quot;]);</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineminus">-        // Pick month.</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-        controller.click(lookup(`</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-            ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})/</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-            [${activeMonth}]</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineminus">-        `));</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineminus">-        controller.waitThenClick(lookup(`</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-            ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineminus">-            anon({&quot;anonid&quot;:&quot;months-popup&quot;})/{&quot;index&quot;:&quot;${month - 1}&quot;}</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineminus">-        `));</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineminus">-        controller.waitForEvents.wait(TIMEOUT_MONTHCHANGE);</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+        let scrollArrow = (monthDifference &gt; 0) ? &quot;months-back-button&quot; : &quot;months-forward-button&quot;;</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+        scrollArrow = lookup(</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+            `${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;${scrollArrow}&quot;})`</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+        );</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+        controller.waitForElement(scrollArrow);</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+        scrollArrow = scrollArrow.getNode();</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+        for (let i = 0; i &lt; Math.abs(monthDifference); i++) {</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+            scrollArrow.doCommand();</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+            controller.sleep(25);</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+        }</span>
<a href="#l16.108"></a><span id="l16.108">     }</span>
<a href="#l16.109"></a><span id="l16.109"> </span>
<a href="#l16.110"></a><span id="l16.110">     let lastDayInFirstRow = lookup(`</span>
<a href="#l16.111"></a><span id="l16.111">         ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[3]/[15]</span>
<a href="#l16.112"></a><span id="l16.112">     `).getNode().innerHTML;</span>
<a href="#l16.113"></a><span id="l16.113"> </span>
<a href="#l16.114"></a><span id="l16.114">     let positionOfFirst = 7 - lastDayInFirstRow;</span>
<a href="#l16.115"></a><span id="l16.115">     let dateColumn = (positionOfFirst + day - 1) % 7;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-item-editing-helpers.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -50,39 +50,36 @@ var ATTENDEES_ROW = `</span>
<a href="#l17.4"></a><span id="l17.4"> var PERCENT_COMPLETE_INPUT = `</span>
<a href="#l17.5"></a><span id="l17.5">     id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/</span>
<a href="#l17.6"></a><span id="l17.6">     id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l17.7"></a><span id="l17.7">     anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l17.8"></a><span id="l17.8"> `;</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> // To be appended to the path for a date- or timepicker.</span>
<a href="#l17.11"></a><span id="l17.11"> var DATE_INPUT = `</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    anon({&quot;class&quot;:&quot;menulist-editable-box moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    anon({&quot;class&quot;:&quot;datepicker-menulist&quot;})/anon({&quot;class&quot;:&quot;menulist-input&quot;})</span>
<a href="#l17.15"></a><span id="l17.15"> `;</span>
<a href="#l17.16"></a><span id="l17.16"> var TIME_INPUT = `</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-    anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-    anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+    anon({&quot;class&quot;:&quot;timepicker-menulist&quot;})/anon({&quot;class&quot;:&quot;menulist-input&quot;})</span>
<a href="#l17.20"></a><span id="l17.20"> `;</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22"> // The following can be used as is.</span>
<a href="#l17.23"></a><span id="l17.23"> var REC_DLG_ACCEPT = `</span>
<a href="#l17.24"></a><span id="l17.24">     /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l17.25"></a><span id="l17.25"> `;</span>
<a href="#l17.26"></a><span id="l17.26"> var REC_DLG_DAYS = `</span>
<a href="#l17.27"></a><span id="l17.27">     /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l17.28"></a><span id="l17.28">     id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/</span>
<a href="#l17.29"></a><span id="l17.29">     id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l17.30"></a><span id="l17.30">     anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l17.31"></a><span id="l17.31"> `;</span>
<a href="#l17.32"></a><span id="l17.32"> var REC_DLG_UNTIL_INPUT = `</span>
<a href="#l17.33"></a><span id="l17.33">     /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l17.34"></a><span id="l17.34">     id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-    anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-    anon({&quot;class&quot;:&quot;menulist-editable-box moz-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+    anon({&quot;class&quot;:&quot;datepicker-menulist&quot;})/{&quot;class&quot;:&quot;menulist-input&quot;}</span>
<a href="#l17.38"></a><span id="l17.38"> `;</span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40"> </span>
<a href="#l17.41"></a><span id="l17.41"> function installInto(module) {</span>
<a href="#l17.42"></a><span id="l17.42">     // Copy constants into module.</span>
<a href="#l17.43"></a><span id="l17.43">     module.CATEGORY_LIST = CATEGORY_LIST;</span>
<a href="#l17.44"></a><span id="l17.44">     module.REPEAT_DETAILS = REPEAT_DETAILS;</span>
<a href="#l17.45"></a><span id="l17.45">     module.EVENT_TABPANELS = EVENT_TABPANELS;</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineat">@@ -122,37 +119,35 @@ function helpersForEditUI(controller) {</span>
<a href="#l17.47"></a><span id="l17.47">         getDateTimePicker: (id) =&gt; {</span>
<a href="#l17.48"></a><span id="l17.48">             let startId = isEvent ? &quot;event-starttime&quot; : &quot;todo-entrydate&quot;;</span>
<a href="#l17.49"></a><span id="l17.49">             let endId = isEvent ? &quot;event-endtime&quot; : &quot;todo-duedate&quot;;</span>
<a href="#l17.50"></a><span id="l17.50">             let path;</span>
<a href="#l17.51"></a><span id="l17.51">             switch (id) {</span>
<a href="#l17.52"></a><span id="l17.52">                 case &quot;STARTDATE&quot;:</span>
<a href="#l17.53"></a><span id="l17.53">                     path = `</span>
<a href="#l17.54"></a><span id="l17.54">                         id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-                        id(&quot;${startId}&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-                        ${DATE_INPUT}</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+                        id(&quot;${startId}&quot;)/anon({&quot;anonid&quot;:&quot;datepicker&quot;})/${DATE_INPUT}</span>
<a href="#l17.58"></a><span id="l17.58">                     `;</span>
<a href="#l17.59"></a><span id="l17.59">                     break;</span>
<a href="#l17.60"></a><span id="l17.60">                 case &quot;ENDDATE&quot;:</span>
<a href="#l17.61"></a><span id="l17.61">                     path = `</span>
<a href="#l17.62"></a><span id="l17.62">                         id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-                        id(&quot;${endId}&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-                        ${DATE_INPUT}</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+                        id(&quot;${endId}&quot;)/anon({&quot;anonid&quot;:&quot;datepicker&quot;})/${DATE_INPUT}</span>
<a href="#l17.66"></a><span id="l17.66">                     `;</span>
<a href="#l17.67"></a><span id="l17.67">                     break;</span>
<a href="#l17.68"></a><span id="l17.68">                 case &quot;STARTTIME&quot;:</span>
<a href="#l17.69"></a><span id="l17.69">                     path = `</span>
<a href="#l17.70"></a><span id="l17.70">                         id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-                        id(&quot;${startId}&quot;)/${TIME_INPUT}</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+                        id(&quot;${startId}&quot;)/anon({&quot;anonid&quot;:&quot;timepicker&quot;})/${TIME_INPUT}</span>
<a href="#l17.73"></a><span id="l17.73">                     `;</span>
<a href="#l17.74"></a><span id="l17.74">                     break;</span>
<a href="#l17.75"></a><span id="l17.75">                 case &quot;ENDTIME&quot;:</span>
<a href="#l17.76"></a><span id="l17.76">                     path = `</span>
<a href="#l17.77"></a><span id="l17.77">                         id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-                        id(&quot;${endId}&quot;)/${TIME_INPUT}</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+                        id(&quot;${endId}&quot;)/anon({&quot;anonid&quot;:&quot;timepicker&quot;})/${TIME_INPUT}</span>
<a href="#l17.80"></a><span id="l17.80">                     `;</span>
<a href="#l17.81"></a><span id="l17.81">                     break;</span>
<a href="#l17.82"></a><span id="l17.82">                 case &quot;UNTILDATE&quot;:</span>
<a href="#l17.83"></a><span id="l17.83">                     path = `</span>
<a href="#l17.84"></a><span id="l17.84">                         id(&quot;event-grid-recurrence-row&quot;)/id(&quot;event-grid-recurrence-picker-box&quot;)/</span>
<a href="#l17.85"></a><span id="l17.85">                         id(&quot;repeat-deck&quot;)/id(&quot;repeat-untilDate&quot;)/id(&quot;repeat-until-datepicker&quot;)/</span>
<a href="#l17.86"></a><span id="l17.86">                         ${DATE_INPUT}</span>
<a href="#l17.87"></a><span id="l17.87">                     `;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/base/content/bindings.css</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/base/content/bindings.css</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -61,20 +61,16 @@ menulist[type=&quot;description&quot;] &gt; menupopup</span>
<a href="#l18.4"></a><span id="l18.4"> datepicker[type=&quot;popup&quot;] {</span>
<a href="#l18.5"></a><span id="l18.5">   -moz-binding: url('chrome://messenger/content/datetimepicker.xml#datepicker-popup');</span>
<a href="#l18.6"></a><span id="l18.6"> }</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> datepicker[type=&quot;grid&quot;] {</span>
<a href="#l18.9"></a><span id="l18.9">   -moz-binding: url('chrome://messenger/content/datetimepicker.xml#datepicker-grid');</span>
<a href="#l18.10"></a><span id="l18.10"> }</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-timepicker {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-  -moz-binding: url('chrome://messenger/content/datetimepicker.xml#timepicker');</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-}</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-</span>
<a href="#l18.16"></a><span id="l18.16"> textbox[type=&quot;number&quot;] {</span>
<a href="#l18.17"></a><span id="l18.17">   -moz-binding: url('chrome://messenger/content/numberbox.xml#numberbox');</span>
<a href="#l18.18"></a><span id="l18.18"> }</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> spinbuttons {</span>
<a href="#l18.21"></a><span id="l18.21">   -moz-binding: url(&quot;chrome://messenger/content/spinbuttons.xml#spinbuttons&quot;);</span>
<a href="#l18.22"></a><span id="l18.22"> }</span>
<a href="#l18.23"></a><span id="l18.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/themes/linux/mail/datetimepicker.css</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/themes/linux/mail/datetimepicker.css</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -5,17 +5,16 @@</span>
<a href="#l19.4"></a><span id="l19.4"> /* ===== datetimepicker.css =============================================</span>
<a href="#l19.5"></a><span id="l19.5">   == Styles used by the XUL datepicker and timepicker elements.</span>
<a href="#l19.6"></a><span id="l19.6">   ======================================================================= */</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l19.9"></a><span id="l19.9"> @namespace html url(&quot;http://www.w3.org/1999/xhtml&quot;);</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11"> datepicker, timepicker {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  margin: 2px 4px;</span>
<a href="#l19.13"></a><span id="l19.13">   padding: 0;</span>
<a href="#l19.14"></a><span id="l19.14">   border: none;</span>
<a href="#l19.15"></a><span id="l19.15">   background: none;</span>
<a href="#l19.16"></a><span id="l19.16">   cursor: default;</span>
<a href="#l19.17"></a><span id="l19.17"> }</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19"> panel &gt; datepicker {</span>
<a href="#l19.20"></a><span id="l19.20">   margin: 0;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

