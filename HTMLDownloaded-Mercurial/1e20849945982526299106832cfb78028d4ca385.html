<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9589:1e20849945982526299106832cfb78028d4ca385</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1e20849945982526299106832cfb78028d4ca385" />
<meta property="og:url" content="/comm-central/rev/1e20849945982526299106832cfb78028d4ca385" />
<meta property="og:description" content="Bug 732372 - review action item: only force gloda's compaction test to mbox. r=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1e20849945982526299106832cfb78028d4ca385 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1e20849945982526299106832cfb78028d4ca385">shortlog</a> |
<a href="/comm-central/log/1e20849945982526299106832cfb78028d4ca385">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1e20849945982526299106832cfb78028d4ca385">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1e20849945982526299106832cfb78028d4ca385">files</a> |
changeset |
<a href="/comm-central/raw-rev/1e20849945982526299106832cfb78028d4ca385">raw</a>  | <a href="/comm-central/archive/1e20849945982526299106832cfb78028d4ca385.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=732372">Bug 732372</a> - review action item: only force gloda's compaction test to mbox. r=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#110;&#100;&#114;&#101;&#119;&#32;&#83;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#32;&#60;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#64;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 08 Mar 2012 14:19:28 -0800</td></tr>

<tr>
 <td>changeset 9589</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1e20849945982526299106832cfb78028d4ca385">1e20849945982526299106832cfb78028d4ca385</a></td>
</tr>



<tr>
<td>parent 9588</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c7d25333f38abfa18461811caf23f3cf3f8143fe">c7d25333f38abfa18461811caf23f3cf3f8143fe</a>
</td>
</tr>

<tr>
<td>child 9590</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4c3e576941e834028da42718e6b69193fb553716">4c3e576941e834028da42718e6b69193fb553716</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1e20849945982526299106832cfb78028d4ca385">7321</a></td></tr>
<tr><td>push user</td><td>bugmail@asutherland.org</td></tr>
<tr><td>push date</td><td class="date age">Thu, 08 Mar 2012 22:19:42 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1e2084994598 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1e20849945982526299106832cfb78028d4ca385">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1e20849945982526299106832cfb78028d4ca385&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1e20849945982526299106832cfb78028d4ca385&newProject=comm-central&newRevision=1e20849945982526299106832cfb78028d4ca385&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1e20849945982526299106832cfb78028d4ca385&newProject=comm-central&newRevision=1e20849945982526299106832cfb78028d4ca385&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1e20849945982526299106832cfb78028d4ca385&newProject=comm-central&newRevision=1e20849945982526299106832cfb78028d4ca385&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=732372">732372</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=732372">Bug 732372</a> - review action item: only force gloda's compaction test to mbox. r=bienvenu

I had changed it to force all of gloda's test to mbox, but that makes it
harder to run gloda tests with maildir.  Bienvenu raised the issue, but the
patch landed before I could address it.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">mailnews/db/gloda/test/unit/resources/glodaTestHelper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">file</a> |
<a href="/comm-central/annotate/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">annotate</a> |
<a href="/comm-central/diff/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">diff</a> |
<a href="/comm-central/comparison/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">comparison</a> |
<a href="/comm-central/log/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/test_index_compaction.js">mailnews/db/gloda/test/unit/test_index_compaction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/test_index_compaction.js">file</a> |
<a href="/comm-central/annotate/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/test_index_compaction.js">annotate</a> |
<a href="/comm-central/diff/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/test_index_compaction.js">diff</a> |
<a href="/comm-central/comparison/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/test_index_compaction.js">comparison</a> |
<a href="/comm-central/log/1e20849945982526299106832cfb78028d4ca385/mailnews/db/gloda/test/unit/test_index_compaction.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -53,19 +53,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">  *  perform a mozmill wait without first telling us to expect the messages.</span>
<a href="#l1.5"></a><span id="l1.5">  */</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> // Services</span>
<a href="#l1.8"></a><span id="l1.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.9"></a><span id="l1.9"> // MailServices</span>
<a href="#l1.10"></a><span id="l1.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;,</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                           &quot;@mozilla.org/msgstore/berkeleystore;1&quot;);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-</span>
<a href="#l1.15"></a><span id="l1.15"> // Import the main scripts that mailnews tests need to set up and tear down</span>
<a href="#l1.16"></a><span id="l1.16"> load(&quot;../../../../resources/mailDirService.js&quot;);</span>
<a href="#l1.17"></a><span id="l1.17"> load(&quot;../../../../resources/mailTestUtils.js&quot;);</span>
<a href="#l1.18"></a><span id="l1.18"> load(&quot;../../../../resources/abSetup.js&quot;);</span>
<a href="#l1.19"></a><span id="l1.19"> load(&quot;../../../../resources/logHelper.js&quot;);</span>
<a href="#l1.20"></a><span id="l1.20"> load(&quot;../../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22"> load(&quot;../../../../resources/messageGenerator.js&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_compaction.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_compaction.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -57,16 +57,26 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * There is also a less interesting case:</span>
<a href="#l2.5"></a><span id="l2.5">  *</span>
<a href="#l2.6"></a><span id="l2.6">  * - Make sure that the indexer does not try and start indexing a folder that is</span>
<a href="#l2.7"></a><span id="l2.7">  *    in the process of being compacted.</span>
<a href="#l2.8"></a><span id="l2.8">  */</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> load(&quot;resources/glodaTestHelper.js&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+/*</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+ * All the rest of the gloda tests (should) work with maildir, but this test</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+ * only works/makes sense with mbox, so force it to always use mbox.  This</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+ * allows developers to manually change the default to maildir and have the</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+ * gloda tests run with that.</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+ */</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+                           &quot;@mozilla.org/msgstore/berkeleystore;1&quot;);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22"> /**</span>
<a href="#l2.23"></a><span id="l2.23">  * Verify that the message keys match between the message headers and the</span>
<a href="#l2.24"></a><span id="l2.24">  *  (augmented on) gloda messages that correspond to the headers.</span>
<a href="#l2.25"></a><span id="l2.25">  */</span>
<a href="#l2.26"></a><span id="l2.26"> function verify_message_keys(aSynSet) {</span>
<a href="#l2.27"></a><span id="l2.27">   let iMsg = 0;</span>
<a href="#l2.28"></a><span id="l2.28">   for each (let msgHdr in aSynSet.msgHdrs) {</span>
<a href="#l2.29"></a><span id="l2.29">     let glodaMsg = aSynSet.glodaMessages[iMsg++];</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

