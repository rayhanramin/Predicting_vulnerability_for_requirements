<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4643:1edab1b761dd012a0314df6bab586929b700af16</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1edab1b761dd012a0314df6bab586929b700af16" />
<meta property="og:url" content="/comm-central/rev/1edab1b761dd012a0314df6bab586929b700af16" />
<meta property="og:description" content="Backed out changeset 6ae827020830 / Bug 533865 due to unit test failues." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1edab1b761dd012a0314df6bab586929b700af16 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1edab1b761dd012a0314df6bab586929b700af16">shortlog</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1edab1b761dd012a0314df6bab586929b700af16">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16">files</a> |
changeset |
<a href="/comm-central/raw-rev/1edab1b761dd012a0314df6bab586929b700af16">raw</a>  | <a href="/comm-central/archive/1edab1b761dd012a0314df6bab586929b700af16.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Backed out changeset 6ae827020830 / <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=533865">Bug 533865</a> due to unit test failues.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 07 Jan 2010 08:40:02 +0000</td></tr>

<tr>
 <td>changeset 4643</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1edab1b761dd012a0314df6bab586929b700af16">1edab1b761dd012a0314df6bab586929b700af16</a></td>
</tr>



<tr>
<td>parent 4642</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6ae827020830a846b010f4debebab902f56e257a">6ae827020830a846b010f4debebab902f56e257a</a>
</td>
</tr>

<tr>
<td>child 4644</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c16c021726cf4e353646c85f8995257133b08540">c16c021726cf4e353646c85f8995257133b08540</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1edab1b761dd012a0314df6bab586929b700af16">3628</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 07 Jan 2010 08:40:20 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1edab1b761dd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1edab1b761dd012a0314df6bab586929b700af16">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1edab1b761dd012a0314df6bab586929b700af16&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1edab1b761dd012a0314df6bab586929b700af16&newProject=comm-central&newRevision=1edab1b761dd012a0314df6bab586929b700af16&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1edab1b761dd012a0314df6bab586929b700af16&newProject=comm-central&newRevision=1edab1b761dd012a0314df6bab586929b700af16&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1edab1b761dd012a0314df6bab586929b700af16&newProject=comm-central&newRevision=1edab1b761dd012a0314df6bab586929b700af16&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=533865">533865</a></td></tr>

<tr><td>backs out</td><td><a style="font-family: monospace" href="/comm-central/rev/6ae827020830a846b010f4debebab902f56e257a">6ae827020830a846b010f4debebab902f56e257a</a></td></tr>


</table></div>

<div class="page_body description">Backed out changeset 6ae827020830 / <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=533865">Bug 533865</a> due to unit test failues.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/build/nsMsgFactory.cpp">mailnews/base/build/nsMsgFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/build/nsMsgFactory.cpp">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/build/nsMsgFactory.cpp">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/build/nsMsgFactory.cpp">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/build/nsMsgFactory.cpp">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/build/nsMsgFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/search/src/nsMsgFilter.cpp">mailnews/base/search/src/nsMsgFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/search/src/nsMsgFilter.cpp">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/search/src/nsMsgFilter.cpp">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/search/src/nsMsgFilter.cpp">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/search/src/nsMsgFilter.cpp">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/search/src/nsMsgFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.h">mailnews/base/src/nsMsgXFVirtualFolderDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.h">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.h">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.h">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.h">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/src/nsMsgXFVirtualFolderDBView.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1edab1b761dd012a0314df6bab586929b700af16/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/1edab1b761dd012a0314df6bab586929b700af16/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/1edab1b761dd012a0314df6bab586929b700af16/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/1edab1b761dd012a0314df6bab586929b700af16/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/1edab1b761dd012a0314df6bab586929b700af16/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/build/nsMsgFactory.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/build/nsMsgFactory.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -339,16 +339,20 @@ static const nsModuleComponentInfo gComp</span>
<a href="#l1.4"></a><span id="l1.4">     { &quot;Message Search Term&quot;, NS_MSGSEARCHTERM_CID,</span>
<a href="#l1.5"></a><span id="l1.5">       NS_MSGSEARCHTERM_CONTRACTID,</span>
<a href="#l1.6"></a><span id="l1.6">       nsMsgSearchTermConstructor</span>
<a href="#l1.7"></a><span id="l1.7">     },</span>
<a href="#l1.8"></a><span id="l1.8">     { &quot;Message Search Validity Manager&quot;, NS_MSGSEARCHVALIDITYMANAGER_CID,</span>
<a href="#l1.9"></a><span id="l1.9">         NS_MSGSEARCHVALIDITYMANAGER_CONTRACTID,</span>
<a href="#l1.10"></a><span id="l1.10">         nsMsgSearchValidityManagerConstructor,</span>
<a href="#l1.11"></a><span id="l1.11">     },</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    { &quot;Message Filter Service&quot;, NS_MSGFILTERSERVICE_CID,</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      NS_MSGFILTERSERVICE_CONTRACTID,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      nsMsgFilterServiceConstructor,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    },</span>
<a href="#l1.16"></a><span id="l1.16">     { &quot;Messenger Biff Manager&quot;, NS_MSGBIFFMANAGER_CID,</span>
<a href="#l1.17"></a><span id="l1.17">       NS_MSGBIFFMANAGER_CONTRACTID,</span>
<a href="#l1.18"></a><span id="l1.18">       nsMsgBiffManagerConstructor,</span>
<a href="#l1.19"></a><span id="l1.19">     },</span>
<a href="#l1.20"></a><span id="l1.20">     { &quot;Messenger Purge Service&quot;, NS_MSGPURGESERVICE_CID,</span>
<a href="#l1.21"></a><span id="l1.21">       NS_MSGPURGESERVICE_CONTRACTID,</span>
<a href="#l1.22"></a><span id="l1.22">       nsMsgPurgeServiceConstructor,</span>
<a href="#l1.23"></a><span id="l1.23">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -874,18 +874,58 @@ nsresult nsMsgFilter::SaveRule(nsIOutput</span>
<a href="#l2.4"></a><span id="l2.4">       }</span>
<a href="#l2.5"></a><span id="l2.5">       break;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">       default:</span>
<a href="#l2.8"></a><span id="l2.8">         break;</span>
<a href="#l2.9"></a><span id="l2.9">     }</span>
<a href="#l2.10"></a><span id="l2.10">   }</span>
<a href="#l2.11"></a><span id="l2.11">   // and here the fun begins - file out term list...</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  PRUint32 searchIndex;</span>
<a href="#l2.13"></a><span id="l2.13">   nsCAutoString  condition;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-  err = MsgTermListToString(m_termList, condition);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  PRUint32 count;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  m_termList-&gt;Count(&amp;count);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  for (searchIndex = 0; searchIndex &lt; count &amp;&amp; NS_SUCCEEDED(err);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+        searchIndex++)</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  {</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    nsCAutoString  stream;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+    nsCOMPtr&lt;nsIMsgSearchTerm&gt; term;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+    m_termList-&gt;QueryElementAt(searchIndex, NS_GET_IID(nsIMsgSearchTerm),</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+      (void **)getter_AddRefs(term));</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+    if (!term)</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+      continue;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    if (condition.Length() &gt; 1)</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+      condition += ' ';</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+    PRBool booleanAnd;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    PRBool matchAll;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    term-&gt;GetBooleanAnd(&amp;booleanAnd);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    term-&gt;GetMatchAll(&amp;matchAll);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    if (matchAll)</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+    {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+      condition += &quot;ALL&quot;;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+      break;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+    }</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+    else if (booleanAnd)</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+      condition += &quot;AND (&quot;;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+    else</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+      condition += &quot;OR (&quot;;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+    nsresult searchError = term-&gt;GetTermAsString(stream);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+    if (NS_FAILED(searchError))</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+    {</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+      err = searchError;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+      break;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+    }</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    condition += stream;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+    condition += ')';</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  }</span>
<a href="#l2.55"></a><span id="l2.55">   if (NS_SUCCEEDED(err))</span>
<a href="#l2.56"></a><span id="l2.56">     err = filterList-&gt;WriteStrAttr(nsIMsgFilterList::attribCondition, condition.get(), aStream);</span>
<a href="#l2.57"></a><span id="l2.57">   return err;</span>
<a href="#l2.58"></a><span id="l2.58"> }</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60"> // for each action, this table encodes the filterTypes that support the action.</span>
<a href="#l2.61"></a><span id="l2.61"> struct RuleActionsTableEntry</span>
<a href="#l2.62"></a><span id="l2.62"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -50,17 +50,16 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> nsMsgXFVirtualFolderDBView::nsMsgXFVirtualFolderDBView()</span>
<a href="#l3.9"></a><span id="l3.9"> {</span>
<a href="#l3.10"></a><span id="l3.10">   mSuppressMsgDisplay = PR_FALSE;</span>
<a href="#l3.11"></a><span id="l3.11">   m_doingSearch = PR_FALSE;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  m_doingQuickSearch = PR_FALSE;</span>
<a href="#l3.13"></a><span id="l3.13"> }</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> nsMsgXFVirtualFolderDBView::~nsMsgXFVirtualFolderDBView()</span>
<a href="#l3.16"></a><span id="l3.16"> {</span>
<a href="#l3.17"></a><span id="l3.17"> }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> NS_IMETHODIMP nsMsgXFVirtualFolderDBView::Open(nsIMsgFolder *folder, </span>
<a href="#l3.20"></a><span id="l3.20">                                                nsMsgViewSortTypeValue sortType, </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -280,34 +279,31 @@ nsMsgXFVirtualFolderDBView::OnSearchHit(</span>
<a href="#l3.22"></a><span id="l3.22"> {</span>
<a href="#l3.23"></a><span id="l3.23">   NS_ENSURE_ARG(aMsgHdr);</span>
<a href="#l3.24"></a><span id="l3.24">   NS_ENSURE_ARG(aFolder);</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">   nsCOMPtr&lt;nsIMsgDatabase&gt; dbToUse;</span>
<a href="#l3.27"></a><span id="l3.27">   nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l3.28"></a><span id="l3.28">   aFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(folderInfo), getter_AddRefs(dbToUse));</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-  if (m_curFolderGettingHits != aFolder &amp;&amp; m_doingSearch &amp;&amp; !m_doingQuickSearch)</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  if (m_curFolderGettingHits != aFolder &amp;&amp; m_doingSearch)</span>
<a href="#l3.32"></a><span id="l3.32">   {</span>
<a href="#l3.33"></a><span id="l3.33">     m_curFolderHasCachedHits = PR_FALSE;</span>
<a href="#l3.34"></a><span id="l3.34">     // since we've gotten a hit for a new folder, the searches for</span>
<a href="#l3.35"></a><span id="l3.35">     // any previous folders are done, so deal with stale cached hits</span>
<a href="#l3.36"></a><span id="l3.36">     // for those folders now.</span>
<a href="#l3.37"></a><span id="l3.37">     UpdateCacheAndViewForPrevSearchedFolders(aFolder);</span>
<a href="#l3.38"></a><span id="l3.38">     m_curFolderGettingHits = aFolder;</span>
<a href="#l3.39"></a><span id="l3.39">     m_hdrHits.Clear();</span>
<a href="#l3.40"></a><span id="l3.40">     m_curFolderStartKeyIndex = m_keys.Length();</span>
<a href="#l3.41"></a><span id="l3.41">   }</span>
<a href="#l3.42"></a><span id="l3.42">   PRBool hdrInCache = PR_FALSE;</span>
<a href="#l3.43"></a><span id="l3.43">   nsCString searchUri;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-  if (!m_doingQuickSearch)</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-  {</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-    m_viewFolder-&gt;GetURI(searchUri);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-    dbToUse-&gt;HdrIsInCache(searchUri.get(), aMsgHdr, &amp;hdrInCache);    </span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-  }</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+  m_viewFolder-&gt;GetURI(searchUri);</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+  dbToUse-&gt;HdrIsInCache(searchUri.get(), aMsgHdr, &amp;hdrInCache);</span>
<a href="#l3.51"></a><span id="l3.51">   if (!m_doingSearch || !m_curFolderHasCachedHits || !hdrInCache)</span>
<a href="#l3.52"></a><span id="l3.52">   {</span>
<a href="#l3.53"></a><span id="l3.53">     if (m_viewFlags &amp; nsMsgViewFlagsType::kGroupBySort)</span>
<a href="#l3.54"></a><span id="l3.54">       nsMsgGroupView::OnNewHeader(aMsgHdr, nsMsgKey_None, PR_TRUE);</span>
<a href="#l3.55"></a><span id="l3.55">     else if (m_sortValid)</span>
<a href="#l3.56"></a><span id="l3.56">       InsertHdrFromFolder(aMsgHdr, aFolder);</span>
<a href="#l3.57"></a><span id="l3.57">     else</span>
<a href="#l3.58"></a><span id="l3.58">       AddHdrFromFolder(aMsgHdr, aFolder);</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineat">@@ -316,30 +312,30 @@ nsMsgXFVirtualFolderDBView::OnSearchHit(</span>
<a href="#l3.60"></a><span id="l3.60"> </span>
<a href="#l3.61"></a><span id="l3.61">   return NS_OK;</span>
<a href="#l3.62"></a><span id="l3.62"> }</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64"> NS_IMETHODIMP</span>
<a href="#l3.65"></a><span id="l3.65"> nsMsgXFVirtualFolderDBView::OnSearchDone(nsresult status)</span>
<a href="#l3.66"></a><span id="l3.66"> {</span>
<a href="#l3.67"></a><span id="l3.67">   // handle any non verified hits we haven't handled yet.</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-  if (NS_SUCCEEDED(status) &amp;&amp; !m_doingQuickSearch &amp;&amp; status != NS_MSG_SEARCH_INTERRUPTED)</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+  if (NS_SUCCEEDED(status) &amp;&amp; status != NS_MSG_SEARCH_INTERRUPTED)</span>
<a href="#l3.70"></a><span id="l3.70">     UpdateCacheAndViewForPrevSearchedFolders(nsnull);</span>
<a href="#l3.71"></a><span id="l3.71"> </span>
<a href="#l3.72"></a><span id="l3.72">   m_doingSearch = PR_FALSE;</span>
<a href="#l3.73"></a><span id="l3.73">   //we want to set imap delete model once the search is over because setting next</span>
<a href="#l3.74"></a><span id="l3.74">   //message after deletion will happen before deleting the message and search scope</span>
<a href="#l3.75"></a><span id="l3.75">   //can change with every search.</span>
<a href="#l3.76"></a><span id="l3.76">   mDeleteModel = nsMsgImapDeleteModels::MoveToTrash;  //set to default in case it is non-imap folder</span>
<a href="#l3.77"></a><span id="l3.77">   nsIMsgFolder *curFolder = m_folders.SafeObjectAt(0);</span>
<a href="#l3.78"></a><span id="l3.78">   if (curFolder)</span>
<a href="#l3.79"></a><span id="l3.79">     GetImapDeleteModel(curFolder);</span>
<a href="#l3.80"></a><span id="l3.80"> </span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-  nsCOMPtr&lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-  nsCOMPtr&lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+  nsCOMPtr &lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+  nsCOMPtr &lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l3.85"></a><span id="l3.85">   nsresult rv = m_viewFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo), getter_AddRefs(virtDatabase));</span>
<a href="#l3.86"></a><span id="l3.86">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.87"></a><span id="l3.87">   // count up the number of unread and total messages from the view, and set those in the</span>
<a href="#l3.88"></a><span id="l3.88">   // folder - easier than trying to keep the count up to date in the face of</span>
<a href="#l3.89"></a><span id="l3.89">   // search hits coming in while the user is reading/deleting messages.</span>
<a href="#l3.90"></a><span id="l3.90">   PRUint32 numUnread = 0;</span>
<a href="#l3.91"></a><span id="l3.91">   PRUint32 numTotal = 0;</span>
<a href="#l3.92"></a><span id="l3.92">   for (PRUint32 i = 0; i &lt; m_flags.Length(); i++)</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineat">@@ -379,17 +375,19 @@ nsMsgXFVirtualFolderDBView::OnSearchDone</span>
<a href="#l3.94"></a><span id="l3.94"> </span>
<a href="#l3.95"></a><span id="l3.95"> </span>
<a href="#l3.96"></a><span id="l3.96"> NS_IMETHODIMP</span>
<a href="#l3.97"></a><span id="l3.97"> nsMsgXFVirtualFolderDBView::OnNewSearch()</span>
<a href="#l3.98"></a><span id="l3.98"> {</span>
<a href="#l3.99"></a><span id="l3.99">   PRInt32 oldSize = GetSize();</span>
<a href="#l3.100"></a><span id="l3.100"> </span>
<a href="#l3.101"></a><span id="l3.101">   RemovePendingDBListeners();</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+</span>
<a href="#l3.103"></a><span id="l3.103">   m_doingSearch = PR_TRUE;</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+</span>
<a href="#l3.105"></a><span id="l3.105">   m_folders.Clear();</span>
<a href="#l3.106"></a><span id="l3.106">   m_keys.Clear();</span>
<a href="#l3.107"></a><span id="l3.107">   m_levels.Clear();</span>
<a href="#l3.108"></a><span id="l3.108">   m_flags.Clear();</span>
<a href="#l3.109"></a><span id="l3.109"> </span>
<a href="#l3.110"></a><span id="l3.110">   // needs to happen after we remove the keys, since RowCountChanged() will call our GetRowCount()</span>
<a href="#l3.111"></a><span id="l3.111">   if (mTree)</span>
<a href="#l3.112"></a><span id="l3.112">     mTree-&gt;RowCountChanged(0, -oldSize);</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineat">@@ -398,114 +396,85 @@ nsMsgXFVirtualFolderDBView::OnNewSearch(</span>
<a href="#l3.114"></a><span id="l3.114">   // search session, calling getNthSearchScope for i = 0; i &lt; searchSession.countSearchScopes; i++</span>
<a href="#l3.115"></a><span id="l3.115">   // and for each folder, then open the db and pull out the cached hits, add them to the view.</span>
<a href="#l3.116"></a><span id="l3.116">   // For each hit in a new folder, we'll then clean up the stale hits from the previous folder(s).</span>
<a href="#l3.117"></a><span id="l3.117"> </span>
<a href="#l3.118"></a><span id="l3.118">   PRInt32 scopeCount;</span>
<a href="#l3.119"></a><span id="l3.119">   nsCOMPtr &lt;nsIMsgSearchSession&gt; searchSession = do_QueryReferent(m_searchSession);</span>
<a href="#l3.120"></a><span id="l3.120">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService = do_GetService(NS_MSGDB_SERVICE_CONTRACTID);</span>
<a href="#l3.121"></a><span id="l3.121">   searchSession-&gt;CountSearchScopes(&amp;scopeCount);</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-  </span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-  // Figure out how many search terms the virtual folder has.</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-  nsCOMPtr&lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-  nsCOMPtr&lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-  nsresult rv = m_viewFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(dbFolderInfo), getter_AddRefs(virtDatabase));</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-  </span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-  nsCString terms;</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-  dbFolderInfo-&gt;GetCharProperty(&quot;searchStr&quot;, terms);</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; searchTerms;</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-  rv = searchSession-&gt;GetSearchTerms(getter_AddRefs(searchTerms));</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-  nsCString curSearchAsString;</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineminus">-  </span>
<a href="#l3.136"></a><span id="l3.136" class="difflineminus">-  rv = MsgTermListToString(searchTerms, curSearchAsString);</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-  // Trim off the initial AND/OR, which is irrelevant and inconsistent between</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-  // what searchSpec.js generates, and what's in virtualFolders.dat.</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-  curSearchAsString.Cut(0, StringBeginsWith(curSearchAsString, NS_LITERAL_CSTRING(&quot;AND&quot;)) ? 3 : 2);</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-  terms.Cut(0, StringBeginsWith(terms, NS_LITERAL_CSTRING(&quot;AND&quot;)) ? 3 : 2);</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-    </span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-  // If the search session search string doesn't match the vf search str, then we're doing</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-  // quick search, which means we don't want to invalidate cached results, or</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-  // used cached results.</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-  m_doingQuickSearch = !curSearchAsString.Equals(terms);</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-  </span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-  if (!m_doingQuickSearch)</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-  {                                              </span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-    if (mTree)</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-      mTree-&gt;BeginUpdateBatch();</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-    for (PRInt32 i = 0; i &lt; scopeCount; i++)</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+  if (mTree)</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+    mTree-&gt;BeginUpdateBatch();</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+  for (PRInt32 i = 0; i &lt; scopeCount; i++)</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+  {</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+    nsMsgSearchScopeValue scopeId;</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+    nsCOMPtr&lt;nsIMsgFolder&gt; searchFolder;</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+    searchSession-&gt;GetNthSearchScope(i, &amp;scopeId, getter_AddRefs(searchFolder));</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+    if (searchFolder)</span>
<a href="#l3.162"></a><span id="l3.162">     {</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineminus">-      nsMsgSearchScopeValue scopeId;</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; searchFolder;</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineminus">-      searchSession-&gt;GetNthSearchScope(i, &amp;scopeId, getter_AddRefs(searchFolder));</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineminus">-      if (searchFolder)</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+      nsCOMPtr&lt;nsISimpleEnumerator&gt; cachedHits;</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+      nsCOMPtr&lt;nsIMsgDatabase&gt; searchDB;</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+      nsCString searchUri;</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+      m_viewFolder-&gt;GetURI(searchUri);</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+      nsresult rv = searchFolder-&gt;GetMsgDatabase(getter_AddRefs(searchDB));</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+      if (NS_SUCCEEDED(rv) &amp;&amp; searchDB)</span>
<a href="#l3.173"></a><span id="l3.173">       {</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-        nsCOMPtr&lt;nsISimpleEnumerator&gt; cachedHits;</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineminus">-        nsCOMPtr&lt;nsIMsgDatabase&gt; searchDB;</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineminus">-        nsCString searchUri;</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-        m_viewFolder-&gt;GetURI(searchUri);</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-        nsresult rv = searchFolder-&gt;GetMsgDatabase(getter_AddRefs(searchDB));</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineminus">-        if (NS_SUCCEEDED(rv) &amp;&amp; searchDB)</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+        if (msgDBService)</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+          msgDBService-&gt;RegisterPendingListener(searchFolder, this);</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+        m_foldersSearchingOver.AppendObject(searchFolder);</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+        searchDB-&gt;GetCachedHits(searchUri.get(), getter_AddRefs(cachedHits));</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+        PRBool hasMore;</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+        if (cachedHits)</span>
<a href="#l3.187"></a><span id="l3.187">         {</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-          if (msgDBService)</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineminus">-            msgDBService-&gt;RegisterPendingListener(searchFolder, this);</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineminus">-</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-          m_foldersSearchingOver.AppendObject(searchFolder);</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineminus">-          searchDB-&gt;GetCachedHits(searchUri.get(), getter_AddRefs(cachedHits));</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-          PRBool hasMore;</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-          if (cachedHits)</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+          cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+          if (hasMore)</span>
<a href="#l3.197"></a><span id="l3.197">           {</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineminus">-            cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-            if (hasMore)</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+             nsMsgKey prevKey = nsMsgKey_None;</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+            while (hasMore)</span>
<a href="#l3.202"></a><span id="l3.202">             {</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineminus">-              nsMsgKey prevKey = nsMsgKey_None;</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineminus">-              while (hasMore)</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+              nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+              nsresult rv = cachedHits-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineplus">+              NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineplus">+              if (pHeader &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l3.209"></a><span id="l3.209">               {</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineminus">-                nsCOMPtr &lt;nsIMsgDBHdr&gt; pHeader;</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-                nsresult rv = cachedHits-&gt;GetNext(getter_AddRefs(pHeader));</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-                NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-                if (pHeader &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineminus">-                {</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-                  nsMsgKey msgKey;</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineminus">-                  pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineminus">-                  NS_ASSERTION(prevKey == nsMsgKey_None || msgKey &gt; prevKey, &quot;cached Hits not sorted&quot;);</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineminus">-                  prevKey = msgKey;</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-                  AddHdrFromFolder(pHeader, searchFolder);</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-                }</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-                else</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-                  break;</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-                cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+                nsMsgKey msgKey;</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineplus">+                pHeader-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+                NS_ASSERTION(prevKey == nsMsgKey_None || msgKey &gt; prevKey, &quot;cached Hits not sorted&quot;);</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+                prevKey = msgKey;</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+                AddHdrFromFolder(pHeader, searchFolder);</span>
<a href="#l3.229"></a><span id="l3.229">               }</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+              else</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineplus">+                break;</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineplus">+              cachedHits-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l3.233"></a><span id="l3.233">             }</span>
<a href="#l3.234"></a><span id="l3.234">           }</span>
<a href="#l3.235"></a><span id="l3.235">         }</span>
<a href="#l3.236"></a><span id="l3.236">       }</span>
<a href="#l3.237"></a><span id="l3.237">     }</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineminus">-    if (mTree)</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineminus">-      mTree-&gt;EndUpdateBatch();</span>
<a href="#l3.240"></a><span id="l3.240">   }</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+  if (mTree)</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+    mTree-&gt;EndUpdateBatch();</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineplus">+</span>
<a href="#l3.244"></a><span id="l3.244">   m_curFolderStartKeyIndex = 0;</span>
<a href="#l3.245"></a><span id="l3.245">   m_curFolderGettingHits = nsnull;</span>
<a href="#l3.246"></a><span id="l3.246">   m_curFolderHasCachedHits = PR_FALSE;</span>
<a href="#l3.247"></a><span id="l3.247"> </span>
<a href="#l3.248"></a><span id="l3.248">   // if we have cached hits, sort them.</span>
<a href="#l3.249"></a><span id="l3.249">   if (GetSize() &gt; 0)</span>
<a href="#l3.250"></a><span id="l3.250">   {</span>
<a href="#l3.251"></a><span id="l3.251">     // currently, we keep threaded views sorted while we build them.</span>
<a href="#l3.252"></a><span id="l3.252">     if (m_sortType != nsMsgViewSortType::byThread &amp;&amp;</span>
<a href="#l3.253"></a><span id="l3.253">       !(m_viewFlags &amp; nsMsgViewFlagsType::kThreadedDisplay))</span>
<a href="#l3.254"></a><span id="l3.254">     {</span>
<a href="#l3.255"></a><span id="l3.255">       m_sortValid = PR_FALSE;       //sort the results</span>
<a href="#l3.256"></a><span id="l3.256">       Sort(m_sortType, m_sortOrder);</span>
<a href="#l3.257"></a><span id="l3.257">     }</span>
<a href="#l3.258"></a><span id="l3.258">   }</span>
<a href="#l3.259"></a><span id="l3.259" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineplus">+    return NS_OK;</span>
<a href="#l3.261"></a><span id="l3.261"> }</span>
<a href="#l3.262"></a><span id="l3.262"> </span>
<a href="#l3.263"></a><span id="l3.263"> </span>
<a href="#l3.264"></a><span id="l3.264"> NS_IMETHODIMP nsMsgXFVirtualFolderDBView::DoCommand(nsMsgViewCommandTypeValue command)</span>
<a href="#l3.265"></a><span id="l3.265"> {</span>
<a href="#l3.266"></a><span id="l3.266">     return nsMsgSearchDBView::DoCommand(command);</span>
<a href="#l3.267"></a><span id="l3.267"> }</span>
<a href="#l3.268"></a><span id="l3.268"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -81,13 +81,11 @@ protected:</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   PRUint32 m_cachedFolderArrayIndex; // array index of next folder with cached hits to deal with.</span>
<a href="#l4.6"></a><span id="l4.6">   nsCOMArray&lt;nsIMsgFolder&gt; m_foldersSearchingOver;</span>
<a href="#l4.7"></a><span id="l4.7">   nsCOMArray&lt;nsIMsgDBHdr&gt; m_hdrHits;</span>
<a href="#l4.8"></a><span id="l4.8">   nsCOMPtr &lt;nsIMsgFolder&gt; m_curFolderGettingHits;</span>
<a href="#l4.9"></a><span id="l4.9">   PRUint32 m_curFolderStartKeyIndex; // keeps track of the index of the first hit from the cur folder</span>
<a href="#l4.10"></a><span id="l4.10">   PRBool m_curFolderHasCachedHits;</span>
<a href="#l4.11"></a><span id="l4.11">   PRBool m_doingSearch;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  // Are we doing a quick search on top of the virtual folder search?</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  PRBool m_doingQuickSearch;</span>
<a href="#l4.14"></a><span id="l4.14"> };</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -83,18 +83,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-#include &quot;nsIMsgSearchTerm.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> static NS_DEFINE_CID(kImapUrlCID, NS_IMAPURL_CID);</span>
<a href="#l5.16"></a><span id="l5.16"> static NS_DEFINE_CID(kCMailboxUrl, NS_MAILBOXURL_CID);</span>
<a href="#l5.17"></a><span id="l5.17"> static NS_DEFINE_CID(kCNntpUrlCID, NS_NNTPURL_CID);</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> #define ILLEGAL_FOLDER_CHARS &quot;;#&quot;</span>
<a href="#l5.20"></a><span id="l5.20"> #define ILLEGAL_FOLDER_CHARS_AS_FIRST_LETTER &quot;.&quot;</span>
<a href="#l5.21"></a><span id="l5.21"> #define ILLEGAL_FOLDER_CHARS_AS_LAST_LETTER  &quot;.~ &quot;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -1954,50 +1952,8 @@ NS_MSG_BASE PRTime MsgConvertAgeInDaysTo</span>
<a href="#l5.23"></a><span id="l5.23">   PRInt64 secondsInDays, microSecondsInDay;</span>
<a href="#l5.24"></a><span id="l5.24">   PRTime now = PR_Now();</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">   secondsInDays = 60 * 60 * 24 * ageInDays;</span>
<a href="#l5.27"></a><span id="l5.27">   microSecondsInDay = secondsInDays * PR_USEC_PER_SEC;</span>
<a href="#l5.28"></a><span id="l5.28">   return now - microSecondsInDay;</span>
<a href="#l5.29"></a><span id="l5.29"> }</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-NS_MSG_BASE nsresult MsgTermListToString(nsISupportsArray *aTermList, nsCString &amp;aOutString)</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-{</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-  PRUint32 count;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-  aTermList-&gt;Count(&amp;count);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-  for (PRUint32 searchIndex = 0; searchIndex &lt; count;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-       searchIndex++)</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-  {</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-    nsCAutoString stream;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-    nsCOMPtr&lt;nsIMsgSearchTerm&gt; term;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-    aTermList-&gt;QueryElementAt(searchIndex, NS_GET_IID(nsIMsgSearchTerm),</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-                               (void **)getter_AddRefs(term));</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-    if (!term)</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-      continue;</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-    if (aOutString.Length() &gt; 1)</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-      aOutString += ' ';</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-    PRBool booleanAnd;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-    PRBool matchAll;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-    term-&gt;GetBooleanAnd(&amp;booleanAnd);</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-    term-&gt;GetMatchAll(&amp;matchAll);</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-    if (matchAll)</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-    {</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-      aOutString += &quot;ALL&quot;;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-      continue;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-    }</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-    else if (booleanAnd)</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-      aOutString += &quot;AND (&quot;;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-    else</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-      aOutString += &quot;OR (&quot;;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-    rv = term-&gt;GetTermAsString(stream);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-    </span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-    aOutString += stream;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-    aOutString += ')';</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-  }</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-  return rv;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -52,17 +52,16 @@ class nsIMsgFolder;</span>
<a href="#l6.4"></a><span id="l6.4"> class nsIMsgMessageService;</span>
<a href="#l6.5"></a><span id="l6.5"> class nsIUrlListener;</span>
<a href="#l6.6"></a><span id="l6.6"> class nsIOutputStream;</span>
<a href="#l6.7"></a><span id="l6.7"> class nsIInputStream;</span>
<a href="#l6.8"></a><span id="l6.8"> class nsIMsgDatabase;</span>
<a href="#l6.9"></a><span id="l6.9"> class nsIMutableArray;</span>
<a href="#l6.10"></a><span id="l6.10"> class nsIProxyInfo;</span>
<a href="#l6.11"></a><span id="l6.11"> class nsIMsgWindow;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-class nsISupportsArray;</span>
<a href="#l6.13"></a><span id="l6.13"> </span>
<a href="#l6.14"></a><span id="l6.14"> //These are utility functions that can used throughout the mailnews code</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16"> NS_MSG_BASE nsresult GetMessageServiceContractIDForURI(const char *uri, nsCString &amp;contractID);</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> NS_MSG_BASE nsresult GetMessageServiceFromURI(const nsACString&amp; uri, nsIMsgMessageService **aMessageService);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> NS_MSG_BASE nsresult GetMsgDBHdrFromURI(const char *uri, nsIMsgDBHdr **msgHdr);</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -264,18 +263,9 @@ NS_MSG_BASE nsresult MsgPromptLoginFaile</span>
<a href="#l6.22"></a><span id="l6.22">                                           PRInt32 *aResult);</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24"> /**</span>
<a href="#l6.25"></a><span id="l6.25">  * Calculate a PRTime value used to determine if a date is XX</span>
<a href="#l6.26"></a><span id="l6.26">  * days ago. This is used by various retention setting algorithms.</span>
<a href="#l6.27"></a><span id="l6.27">  */</span>
<a href="#l6.28"></a><span id="l6.28"> NS_MSG_BASE PRTime MsgConvertAgeInDaysToCutoffDate(PRInt32 ageInDays);</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-/**</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">- * Converts the passed in term list to its string representation.</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">- *</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">- * @param      aTermList    Array of nsIMsgSearchTerms</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">- * @param[out] aOutString   result representation of search terms.</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">- *</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">- */</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-NS_MSG_BASE nsresult MsgTermListToString(nsISupportsArray *aTermList, nsCString &amp;aOutString);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-</span>
<a href="#l6.39"></a><span id="l6.39"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -768,16 +768,20 @@ static const nsModuleComponentInfo gComp</span>
<a href="#l7.4"></a><span id="l7.4">     { &quot;Message Search Term&quot;, NS_MSGSEARCHTERM_CID,</span>
<a href="#l7.5"></a><span id="l7.5">       NS_MSGSEARCHTERM_CONTRACTID,</span>
<a href="#l7.6"></a><span id="l7.6">       nsMsgSearchTermConstructor</span>
<a href="#l7.7"></a><span id="l7.7">     },</span>
<a href="#l7.8"></a><span id="l7.8">     { &quot;Message Search Validity Manager&quot;, NS_MSGSEARCHVALIDITYMANAGER_CID,</span>
<a href="#l7.9"></a><span id="l7.9">         NS_MSGSEARCHVALIDITYMANAGER_CONTRACTID,</span>
<a href="#l7.10"></a><span id="l7.10">         nsMsgSearchValidityManagerConstructor,</span>
<a href="#l7.11"></a><span id="l7.11">     },</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+    { &quot;Message Filter Service&quot;, NS_MSGFILTERSERVICE_CID,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      NS_MSGFILTERSERVICE_CONTRACTID,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+      nsMsgFilterServiceConstructor,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    },</span>
<a href="#l7.16"></a><span id="l7.16">     { &quot;Messenger Biff Manager&quot;, NS_MSGBIFFMANAGER_CID,</span>
<a href="#l7.17"></a><span id="l7.17">       NS_MSGBIFFMANAGER_CONTRACTID,</span>
<a href="#l7.18"></a><span id="l7.18">       nsMsgBiffManagerConstructor,</span>
<a href="#l7.19"></a><span id="l7.19">     },</span>
<a href="#l7.20"></a><span id="l7.20">     { &quot;Messenger Purge Service&quot;, NS_MSGPURGESERVICE_CID,</span>
<a href="#l7.21"></a><span id="l7.21">       NS_MSGPURGESERVICE_CONTRACTID,</span>
<a href="#l7.22"></a><span id="l7.22">       nsMsgPurgeServiceConstructor,</span>
<a href="#l7.23"></a><span id="l7.23">     },</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

