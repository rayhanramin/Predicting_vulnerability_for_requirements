<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 14534:83dee3f7b2707e96551ff4a0d560f777a29fd181</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 83dee3f7b2707e96551ff4a0d560f777a29fd181" />
<meta property="og:url" content="/comm-central/rev/83dee3f7b2707e96551ff4a0d560f777a29fd181" />
<meta property="og:description" content="Bug 953777 - Give the user a way to set a buddy icon and a display name." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 83dee3f7b2707e96551ff4a0d560f777a29fd181 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/83dee3f7b2707e96551ff4a0d560f777a29fd181">shortlog</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/83dee3f7b2707e96551ff4a0d560f777a29fd181">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181">files</a> |
changeset |
<a href="/comm-central/raw-rev/83dee3f7b2707e96551ff4a0d560f777a29fd181">raw</a>  | <a href="/comm-central/archive/83dee3f7b2707e96551ff4a0d560f777a29fd181.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=953777">Bug 953777</a> - Give the user a way to set a buddy icon and a display name.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#232;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#105;&#110;&#115;&#116;&#97;&#110;&#116;&#98;&#105;&#114;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 12 May 2011 19:20:33 +0200</td></tr>

<tr>
 <td>changeset 14534</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/83dee3f7b2707e96551ff4a0d560f777a29fd181">83dee3f7b2707e96551ff4a0d560f777a29fd181</a></td>
</tr>



<tr>
<td>parent 14533</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/80dd062f8c7a695c5311b43ad6270545e7e92e76">80dd062f8c7a695c5311b43ad6270545e7e92e76</a>
</td>
</tr>

<tr>
<td>child 14535</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5ad73d7c4d14ed1bf5e578686ddb85256e59ef5e">5ad73d7c4d14ed1bf5e578686ddb85256e59ef5e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=83dee3f7b2707e96551ff4a0d560f777a29fd181">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=953777">953777</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=953777">Bug 953777</a> - Give the user a way to set a buddy icon and a display name.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/app/profile/all-instantbird.js">im/app/profile/all-instantbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/app/profile/all-instantbird.js">file</a> |
<a href="/comm-central/annotate/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/app/profile/all-instantbird.js">annotate</a> |
<a href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/app/profile/all-instantbird.js">diff</a> |
<a href="/comm-central/comparison/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/app/profile/all-instantbird.js">comparison</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/app/profile/all-instantbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.css">im/content/blist.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.css">file</a> |
<a href="/comm-central/annotate/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.css">annotate</a> |
<a href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.css">diff</a> |
<a href="/comm-central/comparison/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.css">comparison</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.js">im/content/blist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.js">file</a> |
<a href="/comm-central/annotate/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.js">annotate</a> |
<a href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.js">diff</a> |
<a href="/comm-central/comparison/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.js">comparison</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.xul">im/content/blist.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.xul">file</a> |
<a href="/comm-central/annotate/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.xul">annotate</a> |
<a href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.xul">diff</a> |
<a href="/comm-central/comparison/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.xul">comparison</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/content/blist.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/locales/en-US/chrome/instantbird/instantbird.properties">im/locales/en-US/chrome/instantbird/instantbird.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/locales/en-US/chrome/instantbird/instantbird.properties">file</a> |
<a href="/comm-central/annotate/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/locales/en-US/chrome/instantbird/instantbird.properties">annotate</a> |
<a href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/locales/en-US/chrome/instantbird/instantbird.properties">diff</a> |
<a href="/comm-central/comparison/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/locales/en-US/chrome/instantbird/instantbird.properties">comparison</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/locales/en-US/chrome/instantbird/instantbird.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/themes/blist.css">im/themes/blist.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/themes/blist.css">file</a> |
<a href="/comm-central/annotate/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/themes/blist.css">annotate</a> |
<a href="/comm-central/diff/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/themes/blist.css">diff</a> |
<a href="/comm-central/comparison/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/themes/blist.css">comparison</a> |
<a href="/comm-central/log/83dee3f7b2707e96551ff4a0d560f777a29fd181/im/themes/blist.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/app/profile/all-instantbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/app/profile/all-instantbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -94,16 +94,18 @@ pref(&quot;messenger.options.messagesStyle.co</span>
<a href="#l1.4"></a><span id="l1.4"> // if the time interval in seconds between two messages is longer than</span>
<a href="#l1.5"></a><span id="l1.5"> // this value, the messages will not be combined</span>
<a href="#l1.6"></a><span id="l1.6"> pref(&quot;messenger.options.messagesStyle.combineConsecutiveInterval&quot;, 300); // 5 minutes</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> pref(&quot;messenger.status.reportIdle&quot;, true);</span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;messenger.status.timeBeforeIdle&quot;, 300); // 5 minutes</span>
<a href="#l1.10"></a><span id="l1.10"> pref(&quot;messenger.status.awayWhenIdle&quot;, true);</span>
<a href="#l1.11"></a><span id="l1.11"> pref(&quot;messenger.status.defaultIdleAwayMessage&quot;, &quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+pref(&quot;messenger.status.userIconFileName&quot;, &quot;&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+pref(&quot;messenger.status.userDisplayName&quot;, &quot;&quot;);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15"> pref(&quot;messenger.proxies&quot;, &quot;&quot;);</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;messenger.globalProxy&quot;, &quot;none&quot;);</span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;messenger.warnOnQuit&quot;, true);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> #ifdef XP_WIN</span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;browser.preferences.instantApply&quot;, false);</span>
<a href="#l1.21"></a><span id="l1.21"> #else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/content/blist.css</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/content/blist.css</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -110,20 +110,22 @@ group[collapsing=&quot;true&quot;] * {</span>
<a href="#l2.4"></a><span id="l2.4"> tooltip[type=&quot;buddy&quot;] {</span>
<a href="#l2.5"></a><span id="l2.5">   -moz-binding: url(&quot;chrome://instantbird/content/buddytooltip.xml#tooltip&quot;);</span>
<a href="#l2.6"></a><span id="l2.6"> }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> #statusTypeIcon {</span>
<a href="#l2.9"></a><span id="l2.9">   cursor: pointer;</span>
<a href="#l2.10"></a><span id="l2.10"> }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#displayName,</span>
<a href="#l2.13"></a><span id="l2.13"> #statusMessage:not([statusType=&quot;offline&quot;]) {</span>
<a href="#l2.14"></a><span id="l2.14">   cursor: text;</span>
<a href="#l2.15"></a><span id="l2.15"> }</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+#displayName[editing],</span>
<a href="#l2.18"></a><span id="l2.18"> #statusMessage[editing] {</span>
<a href="#l2.19"></a><span id="l2.19">   -moz-appearance: textfield;</span>
<a href="#l2.20"></a><span id="l2.20">   -moz-binding: url('chrome://global/content/bindings/textbox.xml#textbox');</span>
<a href="#l2.21"></a><span id="l2.21"> }</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> .hideGroupButton,</span>
<a href="#l2.24"></a><span id="l2.24"> .startChatBubble,</span>
<a href="#l2.25"></a><span id="l2.25"> .expander-up,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/content/blist.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/content/blist.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -38,16 +38,18 @@</span>
<a href="#l3.4"></a><span id="l3.4"> Components.utils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;);</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> const events = [&quot;contact-availability-changed&quot;,</span>
<a href="#l3.7"></a><span id="l3.7">                 &quot;contact-added&quot;,</span>
<a href="#l3.8"></a><span id="l3.8">                 &quot;contact-moved&quot;,</span>
<a href="#l3.9"></a><span id="l3.9">                 &quot;status-changed&quot;,</span>
<a href="#l3.10"></a><span id="l3.10">                 &quot;tag-hidden&quot;,</span>
<a href="#l3.11"></a><span id="l3.11">                 &quot;tag-shown&quot;,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+                &quot;user-display-name-changed&quot;,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                &quot;user-icon-changed&quot;,</span>
<a href="#l3.14"></a><span id="l3.14">                 &quot;purple-quit&quot;];</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> const showOfflineBuddiesPref = &quot;messenger.buddies.showOffline&quot;;</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> var gBuddyListContextMenu = null;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> function buddyListContextMenu(aXulMenu) {</span>
<a href="#l3.21"></a><span id="l3.21">   this.target  = document.popupNode;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -119,18 +121,17 @@ buddyListContextMenu.prototype = {</span>
<a href="#l3.23"></a><span id="l3.23">     let buddy;</span>
<a href="#l3.24"></a><span id="l3.24">     if (this.onContact)</span>
<a href="#l3.25"></a><span id="l3.25">       buddy = this.target.contact.preferredBuddy;</span>
<a href="#l3.26"></a><span id="l3.26">     else if (this.onBuddy)</span>
<a href="#l3.27"></a><span id="l3.27">       buddy = this.target.buddy;</span>
<a href="#l3.28"></a><span id="l3.28">     else</span>
<a href="#l3.29"></a><span id="l3.29">       return;</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    let bundle =</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-      Services.strings.createBundle(&quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+    let bundle = document.getElementById(&quot;instantbirdBundle&quot;).stringBundle;</span>
<a href="#l3.34"></a><span id="l3.34">     let displayName = this.target.displayName;</span>
<a href="#l3.35"></a><span id="l3.35">     let promptTitle = bundle.formatStringFromName(&quot;buddy.deletePrompt.title&quot;,</span>
<a href="#l3.36"></a><span id="l3.36">                                                   [displayName], 1);</span>
<a href="#l3.37"></a><span id="l3.37">     let userName = buddy.userName;</span>
<a href="#l3.38"></a><span id="l3.38">     if (displayName != userName)</span>
<a href="#l3.39"></a><span id="l3.39">       displayName += &quot; (&quot; + userName + &quot;)&quot;;</span>
<a href="#l3.40"></a><span id="l3.40">     let proto = buddy.protocol.name; // FIXME build a list</span>
<a href="#l3.41"></a><span id="l3.41">     let promptMessage = bundle.formatStringFromName(&quot;buddy.deletePrompt.message&quot;,</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineat">@@ -175,18 +176,17 @@ buddyListContextMenu.prototype = {</span>
<a href="#l3.43"></a><span id="l3.43">     });</span>
<a href="#l3.44"></a><span id="l3.44">   },</span>
<a href="#l3.45"></a><span id="l3.45">   moveTo: function blcm_moveTo(aEvent) {</span>
<a href="#l3.46"></a><span id="l3.46">     let item = aEvent.originalTarget;</span>
<a href="#l3.47"></a><span id="l3.47">     if (item.groupId)</span>
<a href="#l3.48"></a><span id="l3.48">       this.target.moveTo(item.groupId);</span>
<a href="#l3.49"></a><span id="l3.49">   },</span>
<a href="#l3.50"></a><span id="l3.50">   moveToNewTag: function blcm_moveToNewTag() {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-    let bundle =</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-      Services.strings.createBundle(&quot;chrome://instantbird/locale/instantbird.properties&quot;);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+    let bundle = document.getElementById(&quot;instantbirdBundle&quot;).stringBundle;</span>
<a href="#l3.54"></a><span id="l3.54">     let title = bundle.GetStringFromName(&quot;newGroupPromptTitle&quot;);</span>
<a href="#l3.55"></a><span id="l3.55">     let message = bundle.GetStringFromName(&quot;newGroupPromptMessage&quot;);</span>
<a href="#l3.56"></a><span id="l3.56">     let name = {};</span>
<a href="#l3.57"></a><span id="l3.57">     if (!Services.prompt.prompt(window, title, message, name, null,</span>
<a href="#l3.58"></a><span id="l3.58">                                 {value: false}) || !name.value)</span>
<a href="#l3.59"></a><span id="l3.59">       return; // the user canceled</span>
<a href="#l3.60"></a><span id="l3.60"> </span>
<a href="#l3.61"></a><span id="l3.61">     // If the tag already exists, createTag will return it.</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineat">@@ -316,27 +316,55 @@ var buddyList = {</span>
<a href="#l3.63"></a><span id="l3.63">     }</span>
<a href="#l3.64"></a><span id="l3.64"> </span>
<a href="#l3.65"></a><span id="l3.65">     if (aTopic == &quot;tag-shown&quot;) {</span>
<a href="#l3.66"></a><span id="l3.66">       if (!document.getElementById(&quot;group&quot; + aSubject.id))</span>
<a href="#l3.67"></a><span id="l3.67">         this.displayGroup(aSubject);</span>
<a href="#l3.68"></a><span id="l3.68">       return;</span>
<a href="#l3.69"></a><span id="l3.69">     }</span>
<a href="#l3.70"></a><span id="l3.70"> </span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+    if (aTopic == &quot;user-icon-changed&quot;) {</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+      this.displayUserIcon();</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+      return;</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+    }</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+    if (aTopic == &quot;user-display-name-changed&quot;) {</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+      this.displayUserDisplayName();</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+      return;</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    }</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+</span>
<a href="#l3.81"></a><span id="l3.81">     // aSubject is an imIContact</span>
<a href="#l3.82"></a><span id="l3.82">     if (aSubject.online || this._showOffline) {</span>
<a href="#l3.83"></a><span id="l3.83">       aSubject.getTags().forEach(function (aTag) {</span>
<a href="#l3.84"></a><span id="l3.84">         if (Services.tags.isTagHidden(aTag))</span>
<a href="#l3.85"></a><span id="l3.85">           this.showOtherContacts();</span>
<a href="#l3.86"></a><span id="l3.86">         else if (!document.getElementById(&quot;group&quot; + aTag.id))</span>
<a href="#l3.87"></a><span id="l3.87">           this.displayGroup(aTag);</span>
<a href="#l3.88"></a><span id="l3.88">       }, this);</span>
<a href="#l3.89"></a><span id="l3.89">     }</span>
<a href="#l3.90"></a><span id="l3.90">   },</span>
<a href="#l3.91"></a><span id="l3.91"> </span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+  displayUserIcon: function bl_displayUserIcon() {</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+    let icon = Services.core.getUserIcon();</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+    document.getElementById(&quot;userIcon&quot;).src = icon ? icon.spec : &quot;&quot;;</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+  },</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+  displayUserDisplayName: function bl_displayUserDisplayName() {</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+    let displayName = Services.core.userDisplayName;</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+    let elt = document.getElementById(&quot;displayName&quot;);</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+    if (displayName)</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+      elt.removeAttribute(&quot;usingDefault&quot;);</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+    else {</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+      let bundle = document.getElementById(&quot;instantbirdBundle&quot;);</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+      displayName = bundle.getString(&quot;displayNameEmptyText&quot;);</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+      elt.setAttribute(&quot;usingDefault&quot;, displayName);</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+    }</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+    elt.setAttribute(&quot;value&quot;, displayName);</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+  },</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+</span>
<a href="#l3.110"></a><span id="l3.110">   displayStatusType: function bl_displayStatusType(aStatusType) {</span>
<a href="#l3.111"></a><span id="l3.111">     document.getElementById(&quot;statusMessage&quot;)</span>
<a href="#l3.112"></a><span id="l3.112">             .setAttribute(&quot;statusType&quot;, aStatusType);</span>
<a href="#l3.113"></a><span id="l3.113">     let statusString = Status.toLabel(aStatusType);</span>
<a href="#l3.114"></a><span id="l3.114">     let statusTypeIcon = document.getElementById(&quot;statusTypeIcon&quot;);</span>
<a href="#l3.115"></a><span id="l3.115">     statusTypeIcon.setAttribute(&quot;status&quot;, aStatusType);</span>
<a href="#l3.116"></a><span id="l3.116">     statusTypeIcon.setAttribute(&quot;tooltiptext&quot;, statusString);</span>
<a href="#l3.117"></a><span id="l3.117">     return statusString;</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineat">@@ -464,16 +492,88 @@ var buddyList = {</span>
<a href="#l3.119"></a><span id="l3.119">     if (elt.hasAttribute(&quot;usingDefault&quot;))</span>
<a href="#l3.120"></a><span id="l3.120">       elt.setAttribute(&quot;value&quot;, elt.getAttribute(&quot;usingDefault&quot;));</span>
<a href="#l3.121"></a><span id="l3.121">     TextboxSpellChecker.unregisterTextbox(elt);</span>
<a href="#l3.122"></a><span id="l3.122">     elt.removeAttribute(&quot;editing&quot;);</span>
<a href="#l3.123"></a><span id="l3.123">     elt.removeEventListener(&quot;keypress&quot;, this.statusMessageKeyPress, false);</span>
<a href="#l3.124"></a><span id="l3.124">     elt.removeEventListener(&quot;blur&quot;, this.statusMessageBlur, false);</span>
<a href="#l3.125"></a><span id="l3.125">   },</span>
<a href="#l3.126"></a><span id="l3.126"> </span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+  userIconClick: function bl_userIconClick() {</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+    const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+    let fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+                       .createInstance(nsIFilePicker);</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+    let bundle = document.getElementById(&quot;instantbirdBundle&quot;);</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+    fp.init(window, bundle.getString(&quot;userIconFilePickerTitle&quot;),</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+            nsIFilePicker.modeOpen);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+    fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+    if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+      Services.core.setUserIcon(fp.file);</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+  },</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+  displayNameClick: function bl_displayNameClick() {</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+    let elt = document.getElementById(&quot;displayName&quot;);</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+    if (!elt.hasAttribute(&quot;editing&quot;)) {</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+      elt.setAttribute(&quot;editing&quot;, &quot;true&quot;);</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+      if (elt.hasAttribute(&quot;usingDefault&quot;))</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+        elt.removeAttribute(&quot;value&quot;);</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+      elt.addEventListener(&quot;keypress&quot;, this.displayNameKeyPress, false);</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+      elt.addEventListener(&quot;blur&quot;, this.displayNameBlur, false);</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+      // force binding attachmant by forcing layout</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+      elt.getBoundingClientRect();</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+      elt.select();</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+    }</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+    this.displayNameRefreshTimer();</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+  },</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+  displayNameRefreshTimer: function bl_displayNameRefreshTimer() {</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+    const timeBeforeAutoValidate = 20 * 1000;</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+    clearTimeout(this._stopEditDisplayNameTimeout);</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+    this._stopEditDisplayNameTimeout =</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+      setTimeout(this.finishEditDisplayName, timeBeforeAutoValidate, true);</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+  },</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+  displayNameBlur: function bl_displayNameBlur(aEvent) {</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+    if (aEvent.originalTarget == document.getElementById(&quot;displayName&quot;).inputField)</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+      buddyList.finishEditDisplayName(true);</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+  },</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+  displayNameKeyPress: function bl_displayNameKeyPress(aEvent) {</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+    switch (aEvent.keyCode) {</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+      case aEvent.DOM_VK_RETURN:</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+      case aEvent.DOM_VK_ENTER:</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+        buddyList.finishEditDisplayName(true);</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+        break;</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+      case aEvent.DOM_VK_ESCAPE:</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+        buddyList.finishEditDisplayName(false);</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+        break;</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+      default:</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+        buddyList.displayNameRefreshTimer();</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+    }</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+  },</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+  finishEditDisplayName: function bl_finishEditDisplayName(aSave) {</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+    clearTimeout(this._stopEditDisplayNameTimeout);</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+    let elt = document.getElementById(&quot;displayName&quot;);</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+    if (aSave) {</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+      // apply the new display name only if it is different from the current one</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+      if (elt.value != elt.getAttribute(&quot;value&quot;))</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+        Services.core.userDisplayName = elt.value;</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+    }</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+    else if (elt.hasAttribute(&quot;usingDefault&quot;))</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+      elt.setAttribute(&quot;value&quot;, elt.getAttribute(&quot;usingDefault&quot;));</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineplus">+</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+    elt.removeAttribute(&quot;editing&quot;);</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+    elt.removeEventListener(&quot;keypress&quot;, this.displayNameKeyPress, false);</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+    elt.removeEventListener(&quot;blur&quot;, this.displayNameBlur, false);</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+  },</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+</span>
<a href="#l3.199"></a><span id="l3.199">   load: function bl_load() {</span>
<a href="#l3.200"></a><span id="l3.200">     var blistWindows = Services.wm.getEnumerator(&quot;Messenger:blist&quot;);</span>
<a href="#l3.201"></a><span id="l3.201">     while (blistWindows.hasMoreElements()) {</span>
<a href="#l3.202"></a><span id="l3.202">       var win = blistWindows.getNext();</span>
<a href="#l3.203"></a><span id="l3.203">       if (win != window) {</span>
<a href="#l3.204"></a><span id="l3.204">         win.QueryInterface(Ci.nsIDOMWindowInternal).focus();</span>
<a href="#l3.205"></a><span id="l3.205">         window.close();</span>
<a href="#l3.206"></a><span id="l3.206">         return;</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineat">@@ -481,16 +581,18 @@ var buddyList = {</span>
<a href="#l3.208"></a><span id="l3.208">     }</span>
<a href="#l3.209"></a><span id="l3.209"> </span>
<a href="#l3.210"></a><span id="l3.210">     // TODO remove this once we cleanup the way the menus are inserted</span>
<a href="#l3.211"></a><span id="l3.211">     let menubar = document.getElementById(&quot;blistMenubar&quot;);</span>
<a href="#l3.212"></a><span id="l3.212">     let statusArea = document.getElementById(&quot;statusArea&quot;);</span>
<a href="#l3.213"></a><span id="l3.213">     statusArea.parentNode.insertBefore(menubar, statusArea);</span>
<a href="#l3.214"></a><span id="l3.214"> </span>
<a href="#l3.215"></a><span id="l3.215">     buddyList.displayCurrentStatus();</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+    buddyList.displayUserDisplayName();</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+    buddyList.displayUserIcon();</span>
<a href="#l3.218"></a><span id="l3.218"> </span>
<a href="#l3.219"></a><span id="l3.219">     let prefBranch = Services.prefs;</span>
<a href="#l3.220"></a><span id="l3.220">     buddyList._showOffline = prefBranch.getBoolPref(showOfflineBuddiesPref);</span>
<a href="#l3.221"></a><span id="l3.221">     if (buddyList._showOffline) {</span>
<a href="#l3.222"></a><span id="l3.222">       document.getElementById(&quot;context-show-offline-buddies&quot;)</span>
<a href="#l3.223"></a><span id="l3.223">               .setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l3.224"></a><span id="l3.224">     }</span>
<a href="#l3.225"></a><span id="l3.225"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/im/content/blist.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/im/content/blist.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -59,16 +59,18 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #ifndef XP_MACOSX</span>
<a href="#l4.5"></a><span id="l4.5">   onclose= &quot;event.preventDefault(); goQuitApplication();&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #endif</span>
<a href="#l4.7"></a><span id="l4.7">   xmlns  = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/utilities.js&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/blist.js&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/sound.js&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  &lt;stringbundle id=&quot;instantbirdBundle&quot; src=&quot;chrome://instantbird/locale/instantbird.properties&quot;/&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14"> #include menus.xul.inc</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> #ifdef XP_MACOSX</span>
<a href="#l4.17"></a><span id="l4.17">   &lt;commandset id=&quot;blistCommands&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18">     &lt;command id=&quot;cmd_close&quot; oncommand=&quot;window.close();&quot;/&gt;</span>
<a href="#l4.19"></a><span id="l4.19">   &lt;/commandset&gt;</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">   &lt;keyset id=&quot;blistKeys&quot;&gt;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -138,30 +140,38 @@</span>
<a href="#l4.23"></a><span id="l4.23">                 accesskey=&quot;&amp;showOfflineBuddiesCmd.accesskey;&quot;</span>
<a href="#l4.24"></a><span id="l4.24">                 type=&quot;checkbox&quot;</span>
<a href="#l4.25"></a><span id="l4.25">                 oncommand=&quot;gBuddyListContextMenu.toggleShowOfflineBuddies();&quot;/&gt;</span>
<a href="#l4.26"></a><span id="l4.26">     &lt;/menupopup&gt;</span>
<a href="#l4.27"></a><span id="l4.27">   &lt;/popupset&gt;</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">   &lt;toolbox id=&quot;mainToolbox&quot;&gt;</span>
<a href="#l4.30"></a><span id="l4.30">     &lt;toolbar id=&quot;statusArea&quot;&gt;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-      &lt;button type=&quot;menu&quot; id=&quot;statusTypeIcon&quot; status=&quot;available&quot;&gt;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-        &lt;menupopup id=&quot;setStatusTypeMenupopup&quot;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-                   oncommand=&quot;buddyList.editStatus(event);&quot;&gt;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-          &lt;menuitem id=&quot;statusTypeAvailable&quot; label=&quot;&amp;available;&quot;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-                    status=&quot;available&quot; class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-          &lt;menuitem id=&quot;statusTypeUnavailable&quot; label=&quot;&amp;unavailable;&quot;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-                    status=&quot;unavailable&quot; class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-          &lt;menuseparator id=&quot;statusTypeOfflineSeparator&quot;/&gt;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-          &lt;menuitem id=&quot;statusTypeOffline&quot; label=&quot;&amp;offline;&quot;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-                    status=&quot;offline&quot; class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-      &lt;/button&gt;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-      &lt;label id=&quot;statusMessage&quot; flex=&quot;1&quot; crop=&quot;end&quot; value=&quot;&quot;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-             onclick=&quot;buddyList.statusMessageClick();&quot;/&gt;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+      &lt;stack id=&quot;statusImageStack&quot;&gt;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+        &lt;image id=&quot;userIcon&quot; onclick=&quot;buddyList.userIconClick();&quot;/&gt;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+        &lt;button type=&quot;menu&quot; id=&quot;statusTypeIcon&quot; status=&quot;available&quot;&gt;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+          &lt;menupopup id=&quot;setStatusTypeMenupopup&quot;</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+                     oncommand=&quot;buddyList.editStatus(event);&quot;&gt;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+            &lt;menuitem id=&quot;statusTypeAvailable&quot; label=&quot;&amp;available;&quot;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+                      status=&quot;available&quot; class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+            &lt;menuitem id=&quot;statusTypeUnavailable&quot; label=&quot;&amp;unavailable;&quot;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+                      status=&quot;unavailable&quot; class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+            &lt;menuseparator id=&quot;statusTypeOfflineSeparator&quot;/&gt;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+            &lt;menuitem id=&quot;statusTypeOffline&quot; label=&quot;&amp;offline;&quot;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+                      status=&quot;offline&quot; class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+        &lt;/button&gt;</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+      &lt;/stack&gt;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+      &lt;stack id=&quot;displayNameAndstatusMessageStack&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+        &lt;vbox flex=&quot;1&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+          &lt;label id=&quot;displayName&quot; onclick=&quot;buddyList.displayNameClick();&quot;/&gt;</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+        &lt;label id=&quot;statusMessage&quot; crop=&quot;end&quot; value=&quot;&quot;</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+               onclick=&quot;buddyList.statusMessageClick();&quot;/&gt;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+      &lt;/stack&gt;</span>
<a href="#l4.67"></a><span id="l4.67">     &lt;/toolbar&gt;</span>
<a href="#l4.68"></a><span id="l4.68">   &lt;/toolbox&gt;</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70">   &lt;notificationbox id=&quot;buddyListMsg&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l4.71"></a><span id="l4.71">     &lt;richlistbox id=&quot;buddylistbox&quot; flex=&quot;1&quot;</span>
<a href="#l4.72"></a><span id="l4.72">                  onkeypress=&quot;buddyList.keyPress(event);&quot;</span>
<a href="#l4.73"></a><span id="l4.73">                  context=&quot;buddyListContextMenu&quot;</span>
<a href="#l4.74"></a><span id="l4.74">                  tooltip=&quot;buddyTooltip&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/locales/en-US/chrome/instantbird/instantbird.properties</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/locales/en-US/chrome/instantbird/instantbird.properties</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -47,16 +47,19 @@ group.hidePrompt.message=The tag '%S' will no longer be visible. Use the 'Visible Tags…' context menu item to show it again.\n\nContacts that have no visible tag will be displayed in the 'Other Contacts' special group at the bottom of the list.</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> #LOCALIZATION NOTE</span>
<a href="#l5.6"></a><span id="l5.6"> # the &amp; symbol indicates the position of the character that should be</span>
<a href="#l5.7"></a><span id="l5.7"> # used as the accesskey for this button.</span>
<a href="#l5.8"></a><span id="l5.8"> group.hidePrompt.button=&amp;Hide</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> group.hidePrompt.checkbox=Show next time</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+displayNameEmptyText=Display Name</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+userIconFilePickerTitle=Select the new icon…</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+</span>
<a href="#l5.15"></a><span id="l5.15"> isTyping=%S is typing.</span>
<a href="#l5.16"></a><span id="l5.16"> hasStoppedTyping=%S has stopped typing.</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> #LOCALIZATION NOTE</span>
<a href="#l5.19"></a><span id="l5.19"> # this will be the away message put automatically when the user is idle</span>
<a href="#l5.20"></a><span id="l5.20"> messenger.status.defaultIdleAwayMessage=I am currently away from the computer.</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> #LOCALIZATION NOTE</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/themes/blist.css</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/themes/blist.css</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -256,28 +256,63 @@ group[closed] .twisty {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> #updatesMenuItem[loading=&quot;true&quot;] {</span>
<a href="#l6.6"></a><span id="l6.6">   list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;);</span>
<a href="#l6.7"></a><span id="l6.7"> }</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> #statusArea {</span>
<a href="#l6.10"></a><span id="l6.10">   margin: 0 0;</span>
<a href="#l6.11"></a><span id="l6.11">   padding: 0 0;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  -moz-box-align: center;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+}</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+#displayName {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+  font-size: large;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+  border-bottom: 1px solid rgba(0,0,0,0.25);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+  margin: 0 0 16px;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+}</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+#displayName[usingDefault]:not([editing]) {</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+  color: GrayText;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+}</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+#userIcon {</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+  border: 2px solid rgba(0,0,0,0.15);</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+  -moz-border-radius: 5px;</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  max-width: 48px;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+  max-height: 48px;</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+  width: 48px;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+  height: 48px;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+}</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+#userIcon[src=&quot;&quot;] {</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+  background-image: url(&quot;chrome://branding/content/icon64.png&quot;);</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+  background-size: contain;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+  background-repeat: no-repeat;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+}</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+#userIcon:hover {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+  border-color: rgba(0,0,0,0.35);</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+  background-color: rgba(0,0,0,0.35);</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+  opacity: .4;</span>
<a href="#l6.44"></a><span id="l6.44"> }</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46"> #statusTypeIcon {</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+  margin: 32px 0 0 32px;</span>
<a href="#l6.48"></a><span id="l6.48">   width: 16px;</span>
<a href="#l6.49"></a><span id="l6.49">   height: 16px;</span>
<a href="#l6.50"></a><span id="l6.50">   min-height: 16px;</span>
<a href="#l6.51"></a><span id="l6.51">   min-width: 16px;</span>
<a href="#l6.52"></a><span id="l6.52">   -moz-appearance: none;</span>
<a href="#l6.53"></a><span id="l6.53">   background-color: transparent;</span>
<a href="#l6.54"></a><span id="l6.54">   border: none;</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-  margin: 3px 5px;</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+}</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+#statusImageStack,</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+#displayNameAndstatusMessageStack {</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+  margin: 3px 2px;</span>
<a href="#l6.61"></a><span id="l6.61"> }</span>
<a href="#l6.62"></a><span id="l6.62"> </span>
<a href="#l6.63"></a><span id="l6.63"> #statusTypeIcon dropmarker {</span>
<a href="#l6.64"></a><span id="l6.64">   display: none;</span>
<a href="#l6.65"></a><span id="l6.65"> }</span>
<a href="#l6.66"></a><span id="l6.66"> </span>
<a href="#l6.67"></a><span id="l6.67"> %ifdef XP_WIN</span>
<a href="#l6.68"></a><span id="l6.68"> #statusTypeIcon .button-box {</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineat">@@ -304,27 +339,42 @@ group[closed] .twisty {</span>
<a href="#l6.70"></a><span id="l6.70"> }</span>
<a href="#l6.71"></a><span id="l6.71"> </span>
<a href="#l6.72"></a><span id="l6.72"> #statusTypeIcon[status=&quot;idle&quot;] {</span>
<a href="#l6.73"></a><span id="l6.73">   list-style-image: url('chrome://instantbird/skin/idle-16.png');</span>
<a href="#l6.74"></a><span id="l6.74"> }</span>
<a href="#l6.75"></a><span id="l6.75"> </span>
<a href="#l6.76"></a><span id="l6.76"> %ifdef XP_MACOSX</span>
<a href="#l6.77"></a><span id="l6.77"> #statusMessage {</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-  margin: 0 0;</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+  margin: 32px 0 0;</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+  min-height: 16px;</span>
<a href="#l6.81"></a><span id="l6.81"> }</span>
<a href="#l6.82"></a><span id="l6.82"> </span>
<a href="#l6.83"></a><span id="l6.83"> #statusMessage[editing] {</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-  margin: 0 2px 0 -4px;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+  margin: 29px 2px 0 -4px;</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+}</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+#displayName[editing] {</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+  margin-left: -4px;</span>
<a href="#l6.90"></a><span id="l6.90"> }</span>
<a href="#l6.91"></a><span id="l6.91"> %else</span>
<a href="#l6.92"></a><span id="l6.92"> #statusMessage {</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-  margin: 3px 0;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+  margin: 32px 0 0;</span>
<a href="#l6.95"></a><span id="l6.95"> }</span>
<a href="#l6.96"></a><span id="l6.96"> </span>
<a href="#l6.97"></a><span id="l6.97"> #statusMessage[editing] {</span>
<a href="#l6.98"></a><span id="l6.98"> %ifdef XP_WIN</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-  margin: 0 1px 0 -2px;</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+  margin: 30px 0 1px -2px;</span>
<a href="#l6.101"></a><span id="l6.101"> %else</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-  margin: 0 0 0 -4px;</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+  margin: 30px -2px -2px -4px;</span>
<a href="#l6.104"></a><span id="l6.104"> %endif</span>
<a href="#l6.105"></a><span id="l6.105"> }</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+#displayName[editing] {</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+%ifdef XP_WIN</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+  margin-left: -2px;</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+%else</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+  margin-left: -4px;</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+  margin-right: -2px;</span>
<a href="#l6.113"></a><span id="l6.113"> %endif</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+  margin-bottom: 18px;</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+}</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+%endif</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

