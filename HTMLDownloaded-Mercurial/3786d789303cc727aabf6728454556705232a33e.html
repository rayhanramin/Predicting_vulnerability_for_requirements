<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3705:3786d789303cc727aabf6728454556705232a33e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 3786d789303cc727aabf6728454556705232a33e" />
<meta property="og:url" content="/comm-central/rev/3786d789303cc727aabf6728454556705232a33e" />
<meta property="og:description" content="merge of default" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 3786d789303cc727aabf6728454556705232a33e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/3786d789303cc727aabf6728454556705232a33e">shortlog</a> |
<a href="/comm-central/log/3786d789303cc727aabf6728454556705232a33e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/3786d789303cc727aabf6728454556705232a33e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/3786d789303cc727aabf6728454556705232a33e">files</a> |
changeset |
<a href="/comm-central/raw-rev/3786d789303cc727aabf6728454556705232a33e">raw</a>  | <a href="/comm-central/archive/3786d789303cc727aabf6728454556705232a33e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
merge of default
<span class="logtags"><span class="inbranchtag" title="add-protovis">add-protovis</span> </span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#110;&#100;&#114;&#101;&#119;&#32;&#83;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#32;&#60;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#64;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 07 Sep 2009 14:34:47 -0700</td></tr>
<tr><td>branch</td><td>add-protovis</td></tr>
<tr>
 <td>changeset 3705</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/3786d789303cc727aabf6728454556705232a33e">3786d789303cc727aabf6728454556705232a33e</a></td>
</tr>



<tr>
<td>parent 3698</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c6a1b52b3e3f7bfb72984e227c821aff3d1c59d5">c6a1b52b3e3f7bfb72984e227c821aff3d1c59d5</a> (current diff)
</td>
</tr>
<tr>
<td>parent 3573</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/23f393649289dd4774ddd1d231b01e1de8a75cfe">23f393649289dd4774ddd1d231b01e1de8a75cfe</a> (<a href="/comm-central/rev/23f393649289dd4774ddd1d231b01e1de8a75cfe:3786d789303c">diff</a>)
</td>
</tr>

<tr>
<td>child 3706</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/45fbab07d8b3e6cf7fb227e5783b1a5dcdc141d5">45fbab07d8b3e6cf7fb227e5783b1a5dcdc141d5</a>
</td>
</tr>
<tr>
<td>child 3710</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/668c342deb663372479da9e47656295941ae6815">668c342deb663372479da9e47656295941ae6815</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=3786d789303cc727aabf6728454556705232a33e">2927</a></td></tr>
<tr><td>push user</td><td>bugmail@asutherland.org</td></tr>
<tr><td>push date</td><td class="date age">Thu, 10 Sep 2009 01:15:56 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0b161ed73eb6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&newProject=comm-central&newRevision=b5e0aff84bf4077a47919481912ad0bd11c6a8d8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&newProject=comm-central&newRevision=b5e0aff84bf4077a47919481912ad0bd11c6a8d8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&newProject=comm-central&newRevision=b5e0aff84bf4077a47919481912ad0bd11c6a8d8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">merge of default</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/.hgpatchinfo/add-protovis.dep">.hgpatchinfo/add-protovis.dep</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3786d789303cc727aabf6728454556705232a33e/.hgpatchinfo/add-protovis.dep">file</a> |
<a href="/comm-central/annotate/3786d789303cc727aabf6728454556705232a33e/.hgpatchinfo/add-protovis.dep">annotate</a> |
<a href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/.hgpatchinfo/add-protovis.dep">diff</a> |
<a href="/comm-central/comparison/3786d789303cc727aabf6728454556705232a33e/.hgpatchinfo/add-protovis.dep">comparison</a> |
<a href="/comm-central/log/3786d789303cc727aabf6728454556705232a33e/.hgpatchinfo/add-protovis.dep">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/mail/themes/gnomestripe/mail/tabmailBindings.xml">mail/themes/gnomestripe/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/mail/themes/gnomestripe/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/3786d789303cc727aabf6728454556705232a33e/mail/themes/gnomestripe/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/3786d789303cc727aabf6728454556705232a33e/mail/themes/gnomestripe/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/mail/themes/pinstripe/mail/tabmailBindings.xml">mail/themes/pinstripe/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/mail/themes/pinstripe/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/3786d789303cc727aabf6728454556705232a33e/mail/themes/pinstripe/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/3786d789303cc727aabf6728454556705232a33e/mail/themes/pinstripe/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/mail/themes/qute/mail/tabmailBindings.xml">mail/themes/qute/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/3786d789303cc727aabf6728454556705232a33e/mail/themes/qute/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/3786d789303cc727aabf6728454556705232a33e/mail/themes/qute/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/3786d789303cc727aabf6728454556705232a33e/mail/themes/qute/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.hgpatchinfo/add-protovis.dep</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.hgpatchinfo/add-protovis.dep</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,1 +1,1 @@</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineminus">-b11a45aa831d50594e7f23968bda9bc010103ef1</span>
<a href="#l1.5"></a><span id="l1.5">\ No newline at end of file</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+23f393649289dd4774ddd1d231b01e1de8a75cfe</span>
<a href="#l1.7"></a><span id="l1.7">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -78,19 +78,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">                              class=&quot;calendar-month-day-box-item-label&quot;</span>
<a href="#l2.5"></a><span id="l2.5">                              xbl:inherits=&quot;context&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">                   &lt;xul:vbox align=&quot;left&quot;</span>
<a href="#l2.7"></a><span id="l2.7">                             flex=&quot;1&quot;</span>
<a href="#l2.8"></a><span id="l2.8">                             xbl:inherits=&quot;context&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9">                     &lt;xul:label anonid=&quot;event-name&quot;</span>
<a href="#l2.10"></a><span id="l2.10">                                crop=&quot;end&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                                flex=&quot;1&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                               style=&quot;margin: 0;&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                        &lt;html:div anonid=&quot;event-name-div&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                    &lt;/xul:label&gt;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+                               style=&quot;margin: 0;&quot;/&gt;</span>
<a href="#l2.16"></a><span id="l2.16">                     &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l2.17"></a><span id="l2.17">                                  class=&quot;plain calendar-event-name-textbox&quot;</span>
<a href="#l2.18"></a><span id="l2.18">                                  crop=&quot;end&quot;</span>
<a href="#l2.19"></a><span id="l2.19">                                  hidden=&quot;true&quot;</span>
<a href="#l2.20"></a><span id="l2.20">                                  wrap=&quot;true&quot;/&gt;</span>
<a href="#l2.21"></a><span id="l2.21">                     &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.22"></a><span id="l2.22">                   &lt;/xul:vbox&gt;</span>
<a href="#l2.23"></a><span id="l2.23">                   &lt;xul:stack&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1908,20 +1908,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">             &lt;xul:box class=&quot;calendar-event-selection&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l3.5"></a><span id="l3.5">               &lt;xul:stack anonid=&quot;eventbox&quot;</span>
<a href="#l3.6"></a><span id="l3.6">                          align=&quot;stretch&quot;</span>
<a href="#l3.7"></a><span id="l3.7">                          class=&quot;calendar-event-box-container&quot;</span>
<a href="#l3.8"></a><span id="l3.8">                          flex=&quot;1&quot;</span>
<a href="#l3.9"></a><span id="l3.9">                          xbl:inherits=&quot;context,parentorient=orient,readonly,flashing,alarm,allday,priority,progress,status,calendar,categories&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10">                 &lt;xul:image flex=&quot;1&quot; class=&quot;calendar-event-box-gradient&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11">                 &lt;xul:vbox class=&quot;calendar-event-details&quot; anonid=&quot;calendar-event-details&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                  &lt;xul:description anonid=&quot;event-name&quot; class=&quot;calendar-event-details-core&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                    &lt;html:div anonid=&quot;event-name-div&quot;/&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                  &lt;/xul:description&gt;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+                  &lt;xul:description anonid=&quot;event-name&quot; class=&quot;calendar-event-details-core&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">                   &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l3.18"></a><span id="l3.18">                                class=&quot;plain calendar-event-details-core calendar-event-name-textbox&quot;</span>
<a href="#l3.19"></a><span id="l3.19">                                flex=&quot;1&quot;</span>
<a href="#l3.20"></a><span id="l3.20">                                hidden=&quot;true&quot;</span>
<a href="#l3.21"></a><span id="l3.21">                                wrap=&quot;true&quot;/&gt;</span>
<a href="#l3.22"></a><span id="l3.22">                 &lt;/xul:vbox&gt;</span>
<a href="#l3.23"></a><span id="l3.23">                 &lt;xul:stack mousethrough=&quot;always&quot;&gt;</span>
<a href="#l3.24"></a><span id="l3.24">                   &lt;xul:calendar-category-box anonid=&quot;category-box&quot; xbl:inherits=&quot;categories&quot; pack=&quot;end&quot; /&gt;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineat">@@ -2028,34 +2025,29 @@</span>
<a href="#l3.26"></a><span id="l3.26">                 return 0;</span>
<a href="#l3.27"></a><span id="l3.27">             var endDate = this.mOccurrence.endDate || this.mOccurrence.dueDate;</span>
<a href="#l3.28"></a><span id="l3.28">             return endDate.hour * 60 + endDate.minute;</span>
<a href="#l3.29"></a><span id="l3.29">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l3.30"></a><span id="l3.30">       &lt;/property&gt;</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">       &lt;method name=&quot;setEditableLabel&quot;&gt;</span>
<a href="#l3.33"></a><span id="l3.33">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-          let evldiv = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;event-name-div&quot;);</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-          let item = this.mOccurrence;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+          var evl = this.eventNameLabel;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+          var item = this.mOccurrence;</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">           if (item.title &amp;&amp; item.title != &quot;&quot;) {</span>
<a href="#l3.40"></a><span id="l3.40">             // Use &lt;description&gt; textContent so it can wrap.</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-            evldiv.textContent = item.title;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+            evl.textContent = item.title;</span>
<a href="#l3.43"></a><span id="l3.43">           } else {</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-            evldiv.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+            evl.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l3.46"></a><span id="l3.46">           }</span>
<a href="#l3.47"></a><span id="l3.47"> </span>
<a href="#l3.48"></a><span id="l3.48">           var gripbar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar1&quot;).boxObject.height;</span>
<a href="#l3.49"></a><span id="l3.49">           var height = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;eventbox&quot;).boxObject.height;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-          </span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-          if(this.orient == &quot;vertical&quot;) {</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-            evldiv.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + Math.max(0, height-gripbar*2) + &quot;px&quot;);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-          } else {</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-            evldiv.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + height + &quot;px&quot;);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-          }</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+          evl.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + Math.max(0, height-gripbar*2) + &quot;px&quot;);</span>
<a href="#l3.57"></a><span id="l3.57">         ]]&gt;&lt;/body&gt;</span>
<a href="#l3.58"></a><span id="l3.58">       &lt;/method&gt;</span>
<a href="#l3.59"></a><span id="l3.59">     &lt;/implementation&gt;</span>
<a href="#l3.60"></a><span id="l3.60"> </span>
<a href="#l3.61"></a><span id="l3.61">     &lt;handlers&gt;</span>
<a href="#l3.62"></a><span id="l3.62">       &lt;handler event=&quot;mousedown&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.63"></a><span id="l3.63">         event.stopPropagation();</span>
<a href="#l3.64"></a><span id="l3.64"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -63,19 +63,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">                          xbl:inherits=&quot;readonly,flashing,alarm,allday,priority,progress,status,calendar,categories&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5">                 &lt;xul:hbox class=&quot;calendar-event-details&quot;&gt;</span>
<a href="#l4.6"></a><span id="l4.6">                   &lt;xul:vbox align=&quot;left&quot;</span>
<a href="#l4.7"></a><span id="l4.7">                             flex=&quot;1&quot;</span>
<a href="#l4.8"></a><span id="l4.8">                             xbl:inherits=&quot;context&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9">                     &lt;xul:label anonid=&quot;event-name&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                                crop=&quot;end&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                                flex=&quot;1&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                               style=&quot;margin: 0;&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                      &lt;html:div anonid=&quot;event-name-div&quot;/&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                    &lt;/xul:label&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+                               style=&quot;margin: 0;&quot;/&gt;</span>
<a href="#l4.16"></a><span id="l4.16">                     &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l4.17"></a><span id="l4.17">                                  class=&quot;plain&quot;</span>
<a href="#l4.18"></a><span id="l4.18">                                  crop=&quot;end&quot;</span>
<a href="#l4.19"></a><span id="l4.19">                                  hidden=&quot;true&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                                  style=&quot;background: transparent !important;&quot;</span>
<a href="#l4.21"></a><span id="l4.21">                                  wrap=&quot;true&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22">                     &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l4.23"></a><span id="l4.23">                   &lt;/xul:vbox&gt;</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -173,23 +171,23 @@</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">       &lt;property name=&quot;eventNameLabel&quot; readonly=&quot;true&quot;</span>
<a href="#l4.27"></a><span id="l4.27">         onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'event-name');&quot;/&gt;</span>
<a href="#l4.28"></a><span id="l4.28">       &lt;property name=&quot;eventNameTextbox&quot; readonly=&quot;true&quot;</span>
<a href="#l4.29"></a><span id="l4.29">         onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'event-name-textbox');&quot;/&gt;</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31">       &lt;method name=&quot;setEditableLabel&quot;&gt;</span>
<a href="#l4.32"></a><span id="l4.32">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-          let evldiv = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;event-name-div&quot;);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-          let item = this.mOccurrence;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+          var evl = this.eventNameLabel;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+          var item = this.mOccurrence;</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38">           if (item.title &amp;&amp; item.title != &quot;&quot;) {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-            evldiv.textContent = item.title;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+            evl.value = item.title;</span>
<a href="#l4.41"></a><span id="l4.41">           } else {</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-            evldiv.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+            evl.value = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;)</span>
<a href="#l4.44"></a><span id="l4.44">           }</span>
<a href="#l4.45"></a><span id="l4.45">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.46"></a><span id="l4.46">       &lt;/method&gt;</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48">       &lt;method name=&quot;setCSSClasses&quot;&gt;</span>
<a href="#l4.49"></a><span id="l4.49">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.50"></a><span id="l4.50">           var item = this.mOccurrence;          </span>
<a href="#l4.51"></a><span id="l4.51">           this.setAttribute(&quot;calendar-uri&quot;, item.calendar.uri.spec);</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineat">@@ -239,17 +237,17 @@</span>
<a href="#l4.53"></a><span id="l4.53">           if (item.priority &gt; 0 &amp;&amp; item.priority &lt; 5) {</span>
<a href="#l4.54"></a><span id="l4.54">               this.setAttribute(&quot;priority&quot;, &quot;high&quot;);</span>
<a href="#l4.55"></a><span id="l4.55">           } else if (item.priority &gt; 5 &amp;&amp; item.priority &lt; 10) {</span>
<a href="#l4.56"></a><span id="l4.56">               this.setAttribute(&quot;priority&quot;, &quot;low&quot;);</span>
<a href="#l4.57"></a><span id="l4.57">           }</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59">           // status attribute</span>
<a href="#l4.60"></a><span id="l4.60">           if (item.status) {</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-              this.setAttribute(&quot;status&quot;, item.status.toUpperCase());</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+              this.setAttribute(&quot;status&quot;, item.status.toLowerCase());</span>
<a href="#l4.63"></a><span id="l4.63">           }</span>
<a href="#l4.64"></a><span id="l4.64"> </span>
<a href="#l4.65"></a><span id="l4.65">           // calendar name</span>
<a href="#l4.66"></a><span id="l4.66">           this.setAttribute(&quot;calendar&quot;, item.calendar.name.toLowerCase());</span>
<a href="#l4.67"></a><span id="l4.67"> </span>
<a href="#l4.68"></a><span id="l4.68">           // Invitation</span>
<a href="#l4.69"></a><span id="l4.69">           if (item.calendar instanceof Components.interfaces.calISchedulingSupport &amp;&amp;</span>
<a href="#l4.70"></a><span id="l4.70">               item.calendar.isInvitation(item)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -413,16 +413,49 @@ cal.toRFC3339 = function toRFC3339(aDate</span>
<a href="#l5.4"></a><span id="l5.4">             // ZULU Time, according to ISO8601's timezone-offset</span>
<a href="#l5.5"></a><span id="l5.5">             str += &quot;Z&quot;;</span>
<a href="#l5.6"></a><span id="l5.6">         }</span>
<a href="#l5.7"></a><span id="l5.7">     }</span>
<a href="#l5.8"></a><span id="l5.8">     return str;</span>
<a href="#l5.9"></a><span id="l5.9"> };</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> /**</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+ * Observer bag implementation taking care to replay open batch notifications.</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+ */</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+cal.observerBag = function calObserverBag(iid) {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+    this.init(iid);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+};</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+cal.observerBag.prototype = {</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    __proto__: cal.calListenerBag.prototype,</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+    mBatchCount: 0,</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+    notify: function calObserverBag_notify(func, args) {</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+        switch (func) {</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+            case &quot;onStartBatch&quot;:</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+                 ++this.mBatchCount;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+                 break;</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+            case &quot;onEndBatch&quot;:</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+                 --this.mBatchCount;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+                 break;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+        }</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+        return this.__proto__.__proto__.notify.apply(this, arguments);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+    },</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+    add: function calObserverBag_add(iface) {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+        if (this.__proto__.__proto__.add.apply(this, arguments) &amp;&amp; (this.mBatchCount &gt; 0)) {</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+            // Replay batch notifications, because the onEndBatch notifications are yet to come.</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+            // We may think about doing the reverse on remove, though I currently see no need:</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+            for (var i = this.mBatchCount; i--;) {</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+                iface.onStartBatch();</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+            }</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+        }</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+    }</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+};</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+/**</span>
<a href="#l5.45"></a><span id="l5.45">  * Base prototype to be used implementing a provider.</span>
<a href="#l5.46"></a><span id="l5.46">  *</span>
<a href="#l5.47"></a><span id="l5.47">  * @see e.g. providers/gdata</span>
<a href="#l5.48"></a><span id="l5.48">  */</span>
<a href="#l5.49"></a><span id="l5.49"> cal.ProviderBase = function calProviderBase() {</span>
<a href="#l5.50"></a><span id="l5.50">     cal.ASSERT(&quot;This prototype should only be inherited!&quot;);</span>
<a href="#l5.51"></a><span id="l5.51"> };</span>
<a href="#l5.52"></a><span id="l5.52"> cal.ProviderBase.mTransientProperties = {</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineat">@@ -445,17 +478,17 @@ cal.ProviderBase.prototype = {</span>
<a href="#l5.54"></a><span id="l5.54"> </span>
<a href="#l5.55"></a><span id="l5.55">     mID: null,</span>
<a href="#l5.56"></a><span id="l5.56">     mUri: null,</span>
<a href="#l5.57"></a><span id="l5.57">     mObservers: null,</span>
<a href="#l5.58"></a><span id="l5.58">     mProperties: null,</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60">     initProviderBase: function cPB_initProviderBase() {</span>
<a href="#l5.61"></a><span id="l5.61">         this.wrappedJSObject = this;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-        this.mObservers = new cal.calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+        this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l5.64"></a><span id="l5.64">         this.mProperties = {};</span>
<a href="#l5.65"></a><span id="l5.65">         this.mProperties.currentStatus = Components.results.NS_OK;</span>
<a href="#l5.66"></a><span id="l5.66">     },</span>
<a href="#l5.67"></a><span id="l5.67"> </span>
<a href="#l5.68"></a><span id="l5.68">     get observers cPB_observers_get() {</span>
<a href="#l5.69"></a><span id="l5.69">         return this.mObservers;</span>
<a href="#l5.70"></a><span id="l5.70">     },</span>
<a href="#l5.71"></a><span id="l5.71"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -603,16 +603,18 @@ calAlarm.prototype = {</span>
<a href="#l6.4"></a><span id="l6.4">             let formatDate = this.mAbsoluteDate.getInTimezone(cal.calendarDefaultTimezone());</span>
<a href="#l6.5"></a><span id="l6.5">             return formatter.formatDateTime(formatDate);</span>
<a href="#l6.6"></a><span id="l6.6">         } else if (this.related != ALARM_RELATED_ABSOLUTE &amp;&amp; this.mOffset) {</span>
<a href="#l6.7"></a><span id="l6.7">             function getItemBundleStringName(aPrefix) {</span>
<a href="#l6.8"></a><span id="l6.8">                 if (!aItem || isEvent(aItem)) {</span>
<a href="#l6.9"></a><span id="l6.9">                     return aPrefix + &quot;Event&quot;;</span>
<a href="#l6.10"></a><span id="l6.10">                 } else if (isToDo(aItem)) {</span>
<a href="#l6.11"></a><span id="l6.11">                     return aPrefix + &quot;Task&quot;;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+                } else {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                    return aPrefix;</span>
<a href="#l6.14"></a><span id="l6.14">                 }</span>
<a href="#l6.15"></a><span id="l6.15">             }</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">             // Relative alarm length</span>
<a href="#l6.18"></a><span id="l6.18">             let alarmlen = Math.abs(this.mOffset.inSeconds / 60);</span>
<a href="#l6.19"></a><span id="l6.19">             if (alarmlen == 0) {</span>
<a href="#l6.20"></a><span id="l6.20">                 // No need to get the other information if the alarm is at the start</span>
<a href="#l6.21"></a><span id="l6.21">                 // of the event/task.</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -658,11 +660,15 @@ calAlarm.prototype = {</span>
<a href="#l6.23"></a><span id="l6.23">             }</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25">             let originString = calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l6.26"></a><span id="l6.26">                                             getItemBundleStringName(originStringName));</span>
<a href="#l6.27"></a><span id="l6.27">             return calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l6.28"></a><span id="l6.28">                                 &quot;reminderCustomTitle&quot;,</span>
<a href="#l6.29"></a><span id="l6.29">                                 [unitString, originString]);</span>
<a href="#l6.30"></a><span id="l6.30">                                 </span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+        } else {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+            // This is an incomplete alarm, but then again we should never reach</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+            // this state.</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+            return &quot;[Incomplete calIAlarm]&quot;;</span>
<a href="#l6.35"></a><span id="l6.35">         }</span>
<a href="#l6.36"></a><span id="l6.36">     }</span>
<a href="#l6.37"></a><span id="l6.37"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -30,16 +30,18 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.5"></a><span id="l7.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l7.6"></a><span id="l7.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.7"></a><span id="l7.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.8"></a><span id="l7.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.9"></a><span id="l7.9">  *</span>
<a href="#l7.10"></a><span id="l7.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14"> function calCachedCalendarObserverHelper(home, isCachedObserver) {</span>
<a href="#l7.15"></a><span id="l7.15">     this.home = home;</span>
<a href="#l7.16"></a><span id="l7.16">     this.isCachedObserver = isCachedObserver;</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> calCachedCalendarObserverHelper.prototype = {</span>
<a href="#l7.19"></a><span id="l7.19">     isCachedObserver: false,</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">     onStartBatch: function() {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -99,17 +101,17 @@ calCachedCalendarObserverHelper.prototyp</span>
<a href="#l7.23"></a><span id="l7.23">             this.home.mObservers.notify(&quot;onPropertyDeleting&quot;, [this.home, aName]);</span>
<a href="#l7.24"></a><span id="l7.24">         }</span>
<a href="#l7.25"></a><span id="l7.25">     }</span>
<a href="#l7.26"></a><span id="l7.26"> };</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> function calCachedCalendar(uncachedCalendar) {</span>
<a href="#l7.29"></a><span id="l7.29">     this.wrappedJSObject = this;</span>
<a href="#l7.30"></a><span id="l7.30">     this.mSyncQueue = [];</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    this.mObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+    this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l7.33"></a><span id="l7.33">     uncachedCalendar.superCalendar = this;</span>
<a href="#l7.34"></a><span id="l7.34">     uncachedCalendar.addObserver(new calCachedCalendarObserverHelper(this, false));</span>
<a href="#l7.35"></a><span id="l7.35">     this.mUncachedCalendar = uncachedCalendar;</span>
<a href="#l7.36"></a><span id="l7.36">     this.setupCachedCalendar();</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">     if (this.supportsChangeLog) {</span>
<a href="#l7.39"></a><span id="l7.39">         var updateTimer = this.getProperty(&quot;cache.updateTimer&quot;);</span>
<a href="#l7.40"></a><span id="l7.40">         if (updateTimer === null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1185,18 +1185,20 @@ calInterfaceBag.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4">     add: function calInterfaceBag_add(iface) {</span>
<a href="#l8.5"></a><span id="l8.5">         if (iface) {</span>
<a href="#l8.6"></a><span id="l8.6">             var iid = this.mIid;</span>
<a href="#l8.7"></a><span id="l8.7">             function eq(obj) {</span>
<a href="#l8.8"></a><span id="l8.8">                 return compareObjects(obj, iface, iid);</span>
<a href="#l8.9"></a><span id="l8.9">             }</span>
<a href="#l8.10"></a><span id="l8.10">             if (!this.mInterfaces.some(eq)) {</span>
<a href="#l8.11"></a><span id="l8.11">                 this.mInterfaces.push(iface);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+                return true;</span>
<a href="#l8.13"></a><span id="l8.13">             }</span>
<a href="#l8.14"></a><span id="l8.14">         }</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+        return false;</span>
<a href="#l8.16"></a><span id="l8.16">     },</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">     remove: function calInterfaceBag_remove(iface) {</span>
<a href="#l8.19"></a><span id="l8.19">         if (iface) {</span>
<a href="#l8.20"></a><span id="l8.20">             var iid = this.mIid;</span>
<a href="#l8.21"></a><span id="l8.21">             function neq(obj) {</span>
<a href="#l8.22"></a><span id="l8.22">                 return !compareObjects(obj, iface, iid);</span>
<a href="#l8.23"></a><span id="l8.23">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/themes/pinstripe/calendar-views.css</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/themes/pinstripe/calendar-views.css</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -415,20 +415,16 @@ calendar-month-day-box-item[selected=&quot;tr</span>
<a href="#l9.4"></a><span id="l9.4">     background-color: #ffdb67 !important;</span>
<a href="#l9.5"></a><span id="l9.5"> }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> .calendar-color-box {</span>
<a href="#l9.8"></a><span id="l9.8">     /* This rule should be adopted if the alarm image size is changed */</span>
<a href="#l9.9"></a><span id="l9.9">     min-height: 13px;</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-calendar-month-day-box-item[selected=&quot;true&quot;] .calendar-color-box {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-    color: #000000;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-}</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-</span>
<a href="#l9.16"></a><span id="l9.16"> .calendar-month-day-box-item-label {</span>
<a href="#l9.17"></a><span id="l9.17">     padding: 0px;</span>
<a href="#l9.18"></a><span id="l9.18">     margin: 0px;</span>
<a href="#l9.19"></a><span id="l9.19"> }</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21"> .calendar-month-day-box-item-label[time=&quot;true&quot;] {</span>
<a href="#l9.22"></a><span id="l9.22">     -moz-margin-end: 4px;</span>
<a href="#l9.23"></a><span id="l9.23"> }</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineat">@@ -589,34 +585,24 @@ calendar-event-box[invitation-status=&quot;NE</span>
<a href="#l9.25"></a><span id="l9.25"> calendar-editable-item[invitation-status=&quot;NEEDS-ACTION&quot;],</span>
<a href="#l9.26"></a><span id="l9.26"> calendar-month-day-box-item[invitation-status=&quot;NEEDS-ACTION&quot;] {</span>
<a href="#l9.27"></a><span id="l9.27">     border: 2px dotted black;</span>
<a href="#l9.28"></a><span id="l9.28">     opacity: 0.5;</span>
<a href="#l9.29"></a><span id="l9.29"> }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31"> calendar-event-box[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l9.32"></a><span id="l9.32"> calendar-editable-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-calendar-event-box[status=&quot;TENTATIVE&quot;],</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-calendar-editable-item[status=&quot;TENTATIVE&quot;],</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-calendar-month-day-box-item[status=&quot;TENTATIVE&quot;] {</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;] {</span>
<a href="#l9.38"></a><span id="l9.38">     opacity: 0.5;</span>
<a href="#l9.39"></a><span id="l9.39"> }</span>
<a href="#l9.40"></a><span id="l9.40"> </span>
<a href="#l9.41"></a><span id="l9.41"> calendar-event-box[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l9.42"></a><span id="l9.42"> calendar-editable-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-calendar-event-box[status=&quot;CANCELLED&quot;],</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-calendar-editable-item[status=&quot;CANCELLED&quot;],</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-calendar-month-day-box-item[status=&quot;CANCELLED&quot;] {</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-    opacity: 0.5;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">- }</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-.calendar-event-box-container[status=&quot;CANCELLED&quot;] div {</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-    text-decoration: line-through;</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;] {</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+    opacity: 0.3;</span>
<a href="#l9.54"></a><span id="l9.54"> }</span>
<a href="#l9.55"></a><span id="l9.55"> </span>
<a href="#l9.56"></a><span id="l9.56"> /* Navigation controls for the views */</span>
<a href="#l9.57"></a><span id="l9.57"> #calendar-nav-control {</span>
<a href="#l9.58"></a><span id="l9.58">     background-color: white;</span>
<a href="#l9.59"></a><span id="l9.59">     border: solid ThreeDShadow;</span>
<a href="#l9.60"></a><span id="l9.60">     border-width: 1px 0 0 1px;</span>
<a href="#l9.61"></a><span id="l9.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/themes/winstripe/calendar-views.css</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/themes/winstripe/calendar-views.css</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -415,20 +415,16 @@ calendar-month-day-box-item[selected=&quot;tr</span>
<a href="#l10.4"></a><span id="l10.4">     background-color: #ffdb67 !important;</span>
<a href="#l10.5"></a><span id="l10.5"> }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> .calendar-color-box {</span>
<a href="#l10.8"></a><span id="l10.8">     /* This rule should be adopted if the alarm image size is changed */</span>
<a href="#l10.9"></a><span id="l10.9">     min-height: 13px;</span>
<a href="#l10.10"></a><span id="l10.10"> }</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-calendar-month-day-box-item[selected=&quot;true&quot;] .calendar-color-box {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    color: #000000;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-}</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-</span>
<a href="#l10.16"></a><span id="l10.16"> .calendar-month-day-box-item-label {</span>
<a href="#l10.17"></a><span id="l10.17">     padding: 0px;</span>
<a href="#l10.18"></a><span id="l10.18">     margin: 0px;</span>
<a href="#l10.19"></a><span id="l10.19"> }</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> .calendar-month-day-box-item-label[time=&quot;true&quot;] {</span>
<a href="#l10.22"></a><span id="l10.22">     -moz-margin-end: 4px;</span>
<a href="#l10.23"></a><span id="l10.23"> }</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -589,34 +585,24 @@ calendar-event-box[invitation-status=&quot;NE</span>
<a href="#l10.25"></a><span id="l10.25"> calendar-editable-item[invitation-status=&quot;NEEDS-ACTION&quot;],</span>
<a href="#l10.26"></a><span id="l10.26"> calendar-month-day-box-item[invitation-status=&quot;NEEDS-ACTION&quot;] {</span>
<a href="#l10.27"></a><span id="l10.27">     border: 2px dotted black;</span>
<a href="#l10.28"></a><span id="l10.28">     opacity: 0.6;</span>
<a href="#l10.29"></a><span id="l10.29"> }</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31"> calendar-event-box[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l10.32"></a><span id="l10.32"> calendar-editable-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-calendar-event-box[status=&quot;TENTATIVE&quot;],</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-calendar-editable-item[status=&quot;TENTATIVE&quot;],</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-calendar-month-day-box-item[status=&quot;TENTATIVE&quot;] {</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;] {</span>
<a href="#l10.38"></a><span id="l10.38">     opacity: 0.6;</span>
<a href="#l10.39"></a><span id="l10.39"> }</span>
<a href="#l10.40"></a><span id="l10.40"> </span>
<a href="#l10.41"></a><span id="l10.41"> calendar-event-box[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l10.42"></a><span id="l10.42"> calendar-editable-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-calendar-event-box[status=&quot;CANCELLED&quot;],</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-calendar-editable-item[status=&quot;CANCELLED&quot;],</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-calendar-month-day-box-item[status=&quot;CANCELLED&quot;] {</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-    opacity: 0.5;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">- }</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-.calendar-event-box-container[status=&quot;CANCELLED&quot;] div {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-    text-decoration: line-through;</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;] {</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+    opacity: 0.3;</span>
<a href="#l10.54"></a><span id="l10.54"> }</span>
<a href="#l10.55"></a><span id="l10.55"> </span>
<a href="#l10.56"></a><span id="l10.56"> /* Navigation controls for the views */</span>
<a href="#l10.57"></a><span id="l10.57"> #calendar-nav-control {</span>
<a href="#l10.58"></a><span id="l10.58">     background-color: white;</span>
<a href="#l10.59"></a><span id="l10.59">     border: solid ThreeDShadow;</span>
<a href="#l10.60"></a><span id="l10.60">     border-width: 1px 0 0 1px;</span>
<a href="#l10.61"></a><span id="l10.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -99,18 +99,18 @@ calCompositeCalendarObserverHelper.proto</span>
<a href="#l11.4"></a><span id="l11.4">     }</span>
<a href="#l11.5"></a><span id="l11.5"> };</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> function calCompositeCalendar () {</span>
<a href="#l11.8"></a><span id="l11.8">     this.mObserverHelper = new calCompositeCalendarObserverHelper(this);</span>
<a href="#l11.9"></a><span id="l11.9">     this.wrappedJSObject = this;</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">     this.mCalendars = new Array();</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    this.mCompositeObservers = new calListenerBag(Components.interfaces.calICompositeObserver);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    this.mObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+    this.mCompositeObservers = new cal.observerBag(Components.interfaces.calICompositeObserver);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l11.16"></a><span id="l11.16">     this.mDefaultCalendar = null;</span>
<a href="#l11.17"></a><span id="l11.17">     this.mStatusObserver = null;</span>
<a href="#l11.18"></a><span id="l11.18"> }</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20"> calCompositeCalendar.prototype = {</span>
<a href="#l11.21"></a><span id="l11.21">     //</span>
<a href="#l11.22"></a><span id="l11.22">     // private members</span>
<a href="#l11.23"></a><span id="l11.23">     //</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -599,16 +599,17 @@ var calCompositeCalendarModule = {</span>
<a href="#l11.25"></a><span id="l11.25">     mContractID: &quot;@mozilla.org/calendar/calendar;1?type=composite&quot;,</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">     mUtilsLoaded: false,</span>
<a href="#l11.28"></a><span id="l11.28">     loadUtils: function compositeLoadUtils() {</span>
<a href="#l11.29"></a><span id="l11.29">         if (this.mUtilsLoaded)</span>
<a href="#l11.30"></a><span id="l11.30">             return;</span>
<a href="#l11.31"></a><span id="l11.31"> </span>
<a href="#l11.32"></a><span id="l11.32">         Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l11.34"></a><span id="l11.34">         cal.loadScripts([&quot;calUtils.js&quot;], this.__parent__);</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">         this.mUtilsLoaded = true;</span>
<a href="#l11.37"></a><span id="l11.37">     },</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">     registerSelf: function (compMgr, fileSpec, location, type) {</span>
<a href="#l11.40"></a><span id="l11.40">         compMgr = compMgr.QueryInterface(Components.interfaces.nsIComponentRegistrar);</span>
<a href="#l11.41"></a><span id="l11.41">         compMgr.registerFactoryLocation(this.mCID,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -627,17 +627,17 @@ calICSCalendar.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">             filteredFiles.sort(</span>
<a href="#l12.5"></a><span id="l12.5">                 function s(a,b) {</span>
<a href="#l12.6"></a><span id="l12.6">                     return (a.lastmodified - b.lastmodified);</span>
<a href="#l12.7"></a><span id="l12.7">                 });</span>
<a href="#l12.8"></a><span id="l12.8">             // And delete the oldest files, and keep the desired number of</span>
<a href="#l12.9"></a><span id="l12.9">             // old backups</span>
<a href="#l12.10"></a><span id="l12.10">             var i;</span>
<a href="#l12.11"></a><span id="l12.11">             for (i = 0; i &lt; filteredFiles.length - numBackupFiles; ++i) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                file = backupDir.clone();</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                let file = backupDir.clone();</span>
<a href="#l12.14"></a><span id="l12.14">                 file.append(filteredFiles[i].name);</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16">                 // This can fail because of some crappy code in nsILocalFile.</span>
<a href="#l12.17"></a><span id="l12.17">                 // That's not the end of the world.  We can try to remove the</span>
<a href="#l12.18"></a><span id="l12.18">                 // file the next time around.</span>
<a href="#l12.19"></a><span id="l12.19">                 try {</span>
<a href="#l12.20"></a><span id="l12.20">                     file.remove(false);</span>
<a href="#l12.21"></a><span id="l12.21">                 } catch(ex) {}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -59,17 +59,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4">     // </span>
<a href="#l13.5"></a><span id="l13.5">     QueryInterface: function (aIID) {</span>
<a href="#l13.6"></a><span id="l13.6">         return doQueryInterface(this, calMemoryCalendar.prototype, aIID,</span>
<a href="#l13.7"></a><span id="l13.7">                                 [Components.interfaces.calISyncWriteCalendar,</span>
<a href="#l13.8"></a><span id="l13.8">                                  Components.interfaces.calICalendarProvider]);</span>
<a href="#l13.9"></a><span id="l13.9">     },</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">     initMemoryCalendar: function() {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-        this.mObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l13.14"></a><span id="l13.14">         this.mItems = {};</span>
<a href="#l13.15"></a><span id="l13.15">         this.mMetaData = new calPropertyBag();</span>
<a href="#l13.16"></a><span id="l13.16">     },</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">     //</span>
<a href="#l13.19"></a><span id="l13.19">     // calICalendarProvider interface</span>
<a href="#l13.20"></a><span id="l13.20">     //</span>
<a href="#l13.21"></a><span id="l13.21">     get prefChromeOverlay() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -298,17 +298,17 @@ function run_test() {</span>
<a href="#l14.4"></a><span id="l14.4">         var filter = Ci.calICalendar.ITEM_FILTER_TYPE_ALL | </span>
<a href="#l14.5"></a><span id="l14.5">                      Ci.calICalendar.ITEM_FILTER_CLASS_OCCURRENCES |</span>
<a href="#l14.6"></a><span id="l14.6">                      Ci.calICalendar.ITEM_FILTER_COMPLETED_ALL;</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8">         // get calendars</span>
<a href="#l14.9"></a><span id="l14.9">         var calArray = [];</span>
<a href="#l14.10"></a><span id="l14.10">         calArray.push(getStorageCal());</span>
<a href="#l14.11"></a><span id="l14.11">         calArray.push(getMemoryCal());</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        for each (cal in calArray) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        for each (let calendar in calArray) {</span>
<a href="#l14.14"></a><span id="l14.14">             // implement listener</span>
<a href="#l14.15"></a><span id="l14.15">             var count = 0;</span>
<a href="#l14.16"></a><span id="l14.16">             var listener = {</span>
<a href="#l14.17"></a><span id="l14.17">                 onOperationComplete: function(aCalendar,</span>
<a href="#l14.18"></a><span id="l14.18">                                               aStatus,</span>
<a href="#l14.19"></a><span id="l14.19">                                               aOperationType,</span>
<a href="#l14.20"></a><span id="l14.20">                                               aId,</span>
<a href="#l14.21"></a><span id="l14.21">                                               aDetail) {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -330,32 +330,32 @@ function run_test() {</span>
<a href="#l14.23"></a><span id="l14.23">                         count += aCount;</span>
<a href="#l14.24"></a><span id="l14.24">                         for (var i = 0; i &lt; aCount; i++) {</span>
<a href="#l14.25"></a><span id="l14.25">                             compareItemsSpecific(aItems[i].parentItem, aItem);</span>
<a href="#l14.26"></a><span id="l14.26">                         }</span>
<a href="#l14.27"></a><span id="l14.27">                     }</span>
<a href="#l14.28"></a><span id="l14.28">                 }</span>
<a href="#l14.29"></a><span id="l14.29">             };</span>
<a href="#l14.30"></a><span id="l14.30">             // add item to calendar</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-            cal.addItem(aItem, listener);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+            calendar.addItem(aItem, listener);</span>
<a href="#l14.33"></a><span id="l14.33">         }</span>
<a href="#l14.34"></a><span id="l14.34">     }</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">    /**</span>
<a href="#l14.37"></a><span id="l14.37">     * (1) Add aItem to a calendar.</span>
<a href="#l14.38"></a><span id="l14.38">     * The properties of the added item are compared with the passed item.</span>
<a href="#l14.39"></a><span id="l14.39">     * (2) Perform a getItem() call.</span>
<a href="#l14.40"></a><span id="l14.40">     * The properties of the returned item are compared with the passed item.</span>
<a href="#l14.41"></a><span id="l14.41">     */</span>
<a href="#l14.42"></a><span id="l14.42">     function testGetItem(aItem) {</span>
<a href="#l14.43"></a><span id="l14.43">         // get calendars</span>
<a href="#l14.44"></a><span id="l14.44">         var calArray = [];</span>
<a href="#l14.45"></a><span id="l14.45">         calArray.push(getStorageCal());</span>
<a href="#l14.46"></a><span id="l14.46">         calArray.push(getMemoryCal());</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-        for each (cal in calArray) {</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+        for each (let calendar in calArray) {</span>
<a href="#l14.49"></a><span id="l14.49">             // implement listener</span>
<a href="#l14.50"></a><span id="l14.50">             var count = 0;</span>
<a href="#l14.51"></a><span id="l14.51">             var returnedItem = null;</span>
<a href="#l14.52"></a><span id="l14.52">             var listener = {</span>
<a href="#l14.53"></a><span id="l14.53">                 onOperationComplete: function(aCalendar,</span>
<a href="#l14.54"></a><span id="l14.54">                                               aStatus,</span>
<a href="#l14.55"></a><span id="l14.55">                                               aOperationType,</span>
<a href="#l14.56"></a><span id="l14.56">                                               aId,</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineat">@@ -378,17 +378,17 @@ function run_test() {</span>
<a href="#l14.58"></a><span id="l14.58">                                       aItems) {</span>
<a href="#l14.59"></a><span id="l14.59">                     if (aCount) {</span>
<a href="#l14.60"></a><span id="l14.60">                         count += aCount;</span>
<a href="#l14.61"></a><span id="l14.61">                         returnedItem = aItems[0];</span>
<a href="#l14.62"></a><span id="l14.62">                     }</span>
<a href="#l14.63"></a><span id="l14.63">                 }</span>
<a href="#l14.64"></a><span id="l14.64">             };</span>
<a href="#l14.65"></a><span id="l14.65">             // add item to calendar</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-            cal.addItem(aItem, listener);</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+            calendar.addItem(aItem, listener);</span>
<a href="#l14.68"></a><span id="l14.68">         }</span>
<a href="#l14.69"></a><span id="l14.69">     }</span>
<a href="#l14.70"></a><span id="l14.70"> </span>
<a href="#l14.71"></a><span id="l14.71">     testMetaData();</span>
<a href="#l14.72"></a><span id="l14.72"> }</span>
<a href="#l14.73"></a><span id="l14.73"> </span>
<a href="#l14.74"></a><span id="l14.74"> function testMetaData() {</span>
<a href="#l14.75"></a><span id="l14.75">     function testMetaData_(cal) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -272,17 +272,16 @@ function test_interface() {</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5">     // deleteRecurrenceItem</span>
<a href="#l15.6"></a><span id="l15.6">     rinfo.deleteRecurrenceItem(ritems[0]);</span>
<a href="#l15.7"></a><span id="l15.7">     do_check_true(item.icalString.indexOf(RRULE) &lt; 0);</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">     // deleteRecurrenceItemAt</span>
<a href="#l15.10"></a><span id="l15.10">     rinfo.deleteRecurrenceItemAt(1);</span>
<a href="#l15.11"></a><span id="l15.11">     itemString = item.icalString;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    dump(itemString);</span>
<a href="#l15.13"></a><span id="l15.13">     do_check_true(itemString.indexOf(EXDATE) &lt; 0);</span>
<a href="#l15.14"></a><span id="l15.14">     do_check_false(itemString.indexOf(RDATE) &lt; 0);</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16">     // isFinite</span>
<a href="#l15.17"></a><span id="l15.17">     do_check_true(rinfo.isFinite);</span>
<a href="#l15.18"></a><span id="l15.18">     rinfo.appendRecurrenceItem(ritems[0]);</span>
<a href="#l15.19"></a><span id="l15.19">     do_check_true(rinfo.isFinite);</span>
<a href="#l15.20"></a><span id="l15.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/unit/test_relation.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/unit/test_relation.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -7,114 +7,103 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * http://www.mozilla.org/MPL/</span>
<a href="#l16.5"></a><span id="l16.5">  *</span>
<a href="#l16.6"></a><span id="l16.6">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.7"></a><span id="l16.7">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l16.8"></a><span id="l16.8">  * for the specific language governing rights and limitations under the</span>
<a href="#l16.9"></a><span id="l16.9">  * License.</span>
<a href="#l16.10"></a><span id="l16.10">  *</span>
<a href="#l16.11"></a><span id="l16.11">  * The Original Code is Mozilla Calendar code.</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">- * </span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+ *</span>
<a href="#l16.14"></a><span id="l16.14">  * The Initial Developer of the Original Code is</span>
<a href="#l16.15"></a><span id="l16.15">  *   Fred Jendrzejewski &lt;fred.jen@web.de&gt;</span>
<a href="#l16.16"></a><span id="l16.16">  * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l16.17"></a><span id="l16.17">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l16.18"></a><span id="l16.18">  *</span>
<a href="#l16.19"></a><span id="l16.19">  * Contributor(s):</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+ *   Philipp Kewisch &lt;mozilla@kewis.ch&gt;</span>
<a href="#l16.21"></a><span id="l16.21">  *</span>
<a href="#l16.22"></a><span id="l16.22">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l16.23"></a><span id="l16.23">  * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l16.24"></a><span id="l16.24">  * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l16.25"></a><span id="l16.25">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l16.26"></a><span id="l16.26">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l16.27"></a><span id="l16.27">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l16.28"></a><span id="l16.28">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.29"></a><span id="l16.29">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.30"></a><span id="l16.30">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.31"></a><span id="l16.31">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.32"></a><span id="l16.32">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.33"></a><span id="l16.33">  *</span>
<a href="#l16.34"></a><span id="l16.34">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36"> function run_test() {</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-    var eventClass = Cc[&quot;@mozilla.org/calendar/event;1&quot;];</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-    var eventIID = Ci.calIEvent;</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">-</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineminus">-    var relationClass = Cc[&quot;@mozilla.org/calendar/relation;1&quot;];</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-    var relationIID = Ci.calIRelation;</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-</span>
<a href="#l16.43"></a><span id="l16.43">     // Create Relation</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-    var r1 = createRelation();</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+    let r1 = cal.createRelation();</span>
<a href="#l16.46"></a><span id="l16.46"> </span>
<a href="#l16.47"></a><span id="l16.47">     // Create Items</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-    var e1 = eventClass.createInstance(eventIID);</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-    var e2 = eventClass.createInstance(eventIID);</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+    let e1 = cal.createEvent();</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+    let e2 = cal.createEvent();</span>
<a href="#l16.52"></a><span id="l16.52"> </span>
<a href="#l16.53"></a><span id="l16.53">     // Testing relation set/get.</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-    var properties = [&quot;item&quot;, &quot;relType&quot;, &quot;relId&quot;];</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-    var values = [e1, &quot;PARENT&quot;, e2.id];</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+    let properties = {</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+        relType: &quot;PARENT&quot;,</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+        relId: e2.id</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+    }</span>
<a href="#l16.60"></a><span id="l16.60"> </span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-    // Make sure test is valid</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-    do_check_eq(properties.length, values.length);</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-    for (var i = 0; i &lt; properties.length; i++) {</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-        r1[properties[i]] = values[i];</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-        do_check_eq(r1[properties[i]], values[i]);</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+    for (let [property, value] in Iterator(properties)) {</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+        r1[property] = value;</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+        do_check_eq(r1[property], value);</span>
<a href="#l16.70"></a><span id="l16.70">     }</span>
<a href="#l16.71"></a><span id="l16.71"> </span>
<a href="#l16.72"></a><span id="l16.72">     // Add relation to event</span>
<a href="#l16.73"></a><span id="l16.73">     e1.addRelation(r1);</span>
<a href="#l16.74"></a><span id="l16.74"> </span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">-    // Add 2nd attendee to event.</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-    var r2 = relationClass.createInstance(relationIID);</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+    // Add 2nd relation to event.</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+    let r2 = cal.createRelation();</span>
<a href="#l16.79"></a><span id="l16.79">     r2.relId = &quot;myid2&quot;;</span>
<a href="#l16.80"></a><span id="l16.80">     e1.addRelation(r2);</span>
<a href="#l16.81"></a><span id="l16.81"> </span>
<a href="#l16.82"></a><span id="l16.82">     // Check the item functions</span>
<a href="#l16.83"></a><span id="l16.83">     checkRelations(e1, [r1, r2]);</span>
<a href="#l16.84"></a><span id="l16.84"> </span>
<a href="#l16.85"></a><span id="l16.85">     // modify the Relations</span>
<a href="#l16.86"></a><span id="l16.86">     modifyRelations(e1, [r1, r2]);</span>
<a href="#l16.87"></a><span id="l16.87"> </span>
<a href="#l16.88"></a><span id="l16.88">     // test icalproperty</span>
<a href="#l16.89"></a><span id="l16.89">     r2.icalProperty;</span>
<a href="#l16.90"></a><span id="l16.90"> }</span>
<a href="#l16.91"></a><span id="l16.91"> </span>
<a href="#l16.92"></a><span id="l16.92"> function checkRelations(event, expRel) {</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineminus">-    var countObj = {}</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineminus">-    var allRel = event.getRelations(countObj);</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+    let countObj = {};</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+    let allRel = event.getRelations(countObj);</span>
<a href="#l16.97"></a><span id="l16.97">     do_check_eq(countObj.value, allRel.length);</span>
<a href="#l16.98"></a><span id="l16.98">     do_check_eq(allRel.length, expRel.length);</span>
<a href="#l16.99"></a><span id="l16.99"> </span>
<a href="#l16.100"></a><span id="l16.100">     // check if all expacted relations are found</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineminus">-    for (var i = 0; i &lt; expRel.length; i++) {</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+    for (let i = 0; i &lt; expRel.length; i++) {</span>
<a href="#l16.103"></a><span id="l16.103">         do_check_neq(allRel.indexOf(expRel[i]), -1);</span>
<a href="#l16.104"></a><span id="l16.104">     }</span>
<a href="#l16.105"></a><span id="l16.105"> </span>
<a href="#l16.106"></a><span id="l16.106">     // Check if all found relations are expected</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-    for (var i = 0; i &lt; allRel.length; i++) {</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+    for (let i = 0; i &lt; allRel.length; i++) {</span>
<a href="#l16.109"></a><span id="l16.109">         do_check_neq(expRel.indexOf(allRel[i]), -1);</span>
<a href="#l16.110"></a><span id="l16.110">     }</span>
<a href="#l16.111"></a><span id="l16.111"> }</span>
<a href="#l16.112"></a><span id="l16.112"> </span>
<a href="#l16.113"></a><span id="l16.113"> function modifyRelations(event, oldRel) {</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-    var allRel = event.getRelations({});</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-    var rel = allRel[0];</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+    let allRel = event.getRelations({});</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+    let rel = allRel[0];</span>
<a href="#l16.118"></a><span id="l16.118"> </span>
<a href="#l16.119"></a><span id="l16.119">     // modify the properties</span>
<a href="#l16.120"></a><span id="l16.120">     rel.relType = &quot;SIBLING&quot;;</span>
<a href="#l16.121"></a><span id="l16.121">     do_check_eq(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l16.122"></a><span id="l16.122">     do_check_eq(rel.relType, allRel[0].relType);</span>
<a href="#l16.123"></a><span id="l16.123"> </span>
<a href="#l16.124"></a><span id="l16.124">     // remove one relation</span>
<a href="#l16.125"></a><span id="l16.125">     event.removeRelation(rel);</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineminus">-</span>
<a href="#l16.127"></a><span id="l16.127">     do_check_eq(event.getRelations({}).length, oldRel.length - 1);</span>
<a href="#l16.128"></a><span id="l16.128"> </span>
<a href="#l16.129"></a><span id="l16.129">     // add one relation and remove all relations</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-</span>
<a href="#l16.131"></a><span id="l16.131">     event.addRelation(oldRel[0]);</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineminus">-</span>
<a href="#l16.133"></a><span id="l16.133">     event.removeAllRelations();</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineminus">-</span>
<a href="#l16.135"></a><span id="l16.135">     do_check_eq(event.getRelations({}), 0);</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-</span>
<a href="#l16.137"></a><span id="l16.137"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/timezones/config/version.txt</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/timezones/config/version.txt</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,1 +1,1 @@</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineminus">-1.2009f</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+1.2009l</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">index d8a050d13b39cbf13e664136b783d18eeb3beaf7..521e863ef04cae0aee87b35a633d3bc0607389c0</span>
<a href="#l18.2"></a><span id="l18.2">GIT binary patch
literal 160768
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/config/autoconf.mk.in</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/config/autoconf.mk.in</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -462,19 +462,16 @@ DLL_SUFFIX              = @DLL_SUFFIX@</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> NO_LD_ARCHIVE_FLAGS     = @NO_LD_ARCHIVE_FLAGS@</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> GTK_CONFIG	= @GTK_CONFIG@</span>
<a href="#l19.8"></a><span id="l19.8"> QT_CONFIG	= @QT_CONFIG@</span>
<a href="#l19.9"></a><span id="l19.9"> TK_CFLAGS	= @TK_CFLAGS@</span>
<a href="#l19.10"></a><span id="l19.10"> TK_LIBS		= @TK_LIBS@</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-CAIRO_FT_CFLAGS		= @CAIRO_FT_CFLAGS@</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-MOZ_TREE_FREETYPE		= @MOZ_TREE_FREETYPE@</span>
<a href="#l19.15"></a><span id="l19.15"> MOZ_ENABLE_GTK2		= @MOZ_ENABLE_GTK2@</span>
<a href="#l19.16"></a><span id="l19.16"> MOZ_ENABLE_QT		= @MOZ_ENABLE_QT@</span>
<a href="#l19.17"></a><span id="l19.17"> MOZ_ENABLE_PHOTON	= @MOZ_ENABLE_PHOTON@</span>
<a href="#l19.18"></a><span id="l19.18"> MOZ_ENABLE_XREMOTE	= @MOZ_ENABLE_XREMOTE@</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20"> MOZ_GTK2_CFLAGS		= @MOZ_GTK2_CFLAGS@</span>
<a href="#l19.21"></a><span id="l19.21"> MOZ_GTK2_LIBS		= @MOZ_GTK2_LIBS@</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23" class="difflineat">@@ -483,19 +480,16 @@ MOZ_QT_LIBS		= @MOZ_QT_LIBS@</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25"> MOZ_DBUS_GLIB_CFLAGS    = @MOZ_DBUS_GLIB_CFLAGS@</span>
<a href="#l19.26"></a><span id="l19.26"> MOZ_DBUS_GLIB_LIBS      = @MOZ_DBUS_GLIB_LIBS@</span>
<a href="#l19.27"></a><span id="l19.27"> MOZ_ENABLE_DBUS         = @MOZ_ENABLE_DBUS@</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29"> MOZ_GTHREAD_CFLAGS      = @MOZ_GTHREAD_CFLAGS@</span>
<a href="#l19.30"></a><span id="l19.30"> MOZ_GTHREAD_LIBS        = @MOZ_GTHREAD_LIBS@</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-FT2_CFLAGS             = @FT2_CFLAGS@</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-FT2_LIBS               = @FT2_LIBS@</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-</span>
<a href="#l19.35"></a><span id="l19.35"> MOZ_PANGO_LIBS          = @MOZ_PANGO_LIBS@</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37"> MOZ_XIE_LIBS		= @MOZ_XIE_LIBS@</span>
<a href="#l19.38"></a><span id="l19.38"> XT_LIBS			= @XT_LIBS@</span>
<a href="#l19.39"></a><span id="l19.39"> </span>
<a href="#l19.40"></a><span id="l19.40"> MOZ_ALSA_LIBS           = @MOZ_ALSA_LIBS@</span>
<a href="#l19.41"></a><span id="l19.41"> </span>
<a href="#l19.42"></a><span id="l19.42"> GLIB_CFLAGS	= @GLIB_CFLAGS@</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/configure.in</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/configure.in</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -124,16 +124,17 @@ MOZZLIB=0x1230</span>
<a href="#l20.4"></a><span id="l20.4"> NSPR_VERSION=4</span>
<a href="#l20.5"></a><span id="l20.5"> NSS_VERSION=3</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> dnl Set the minimum version of toolkit libs used by mozilla</span>
<a href="#l20.8"></a><span id="l20.8"> dnl ========================================================</span>
<a href="#l20.9"></a><span id="l20.9"> GLIB_VERSION=1.2.0</span>
<a href="#l20.10"></a><span id="l20.10"> LIBIDL_VERSION=0.6.3</span>
<a href="#l20.11"></a><span id="l20.11"> PERL_VERSION=5.006</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+CAIRO_VERSION=1.6.0</span>
<a href="#l20.13"></a><span id="l20.13"> PANGO_VERSION=1.14.0</span>
<a href="#l20.14"></a><span id="l20.14"> GTK2_VERSION=2.10.0</span>
<a href="#l20.15"></a><span id="l20.15"> MAKE_VERSION=3.78</span>
<a href="#l20.16"></a><span id="l20.16"> WINDRES_VERSION=2.14.90</span>
<a href="#l20.17"></a><span id="l20.17"> W32API_VERSION=3.8</span>
<a href="#l20.18"></a><span id="l20.18"> GNOMEVFS_VERSION=2.0</span>
<a href="#l20.19"></a><span id="l20.19"> GNOMEUI_VERSION=2.2.0</span>
<a href="#l20.20"></a><span id="l20.20"> GCONF_VERSION=1.2.1</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -5080,20 +5081,16 @@ then</span>
<a href="#l20.22"></a><span id="l20.22">     if test &quot;$MOZ_PANGO&quot;</span>
<a href="#l20.23"></a><span id="l20.23">     then</span>
<a href="#l20.24"></a><span id="l20.24">         PKG_CHECK_MODULES(MOZ_PANGO, pango &gt;= $PANGO_VERSION pangoft2 &gt;= $PANGO_VERSION)</span>
<a href="#l20.25"></a><span id="l20.25">         AC_SUBST(MOZ_PANGO_LIBS)</span>
<a href="#l20.26"></a><span id="l20.26">         AC_DEFINE(MOZ_PANGO)</span>
<a href="#l20.27"></a><span id="l20.27">     else</span>
<a href="#l20.28"></a><span id="l20.28">         PKG_CHECK_MODULES(MOZ_PANGO, pango &gt;= $PANGO_VERSION pangoft2 &gt;= $PANGO_VERSION)</span>
<a href="#l20.29"></a><span id="l20.29">         AC_SUBST(MOZ_PANGO_LIBS)</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-        PKG_CHECK_MODULES(FT2, freetype2 &gt; 6.1.0 fontconfig)</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-        AC_SUBST(FT2_CFLAGS)</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-        AC_SUBST(FT2_LIBS)</span>
<a href="#l20.34"></a><span id="l20.34">     fi</span>
<a href="#l20.35"></a><span id="l20.35"> fi</span>
<a href="#l20.36"></a><span id="l20.36"> </span>
<a href="#l20.37"></a><span id="l20.37"> dnl ========================================================</span>
<a href="#l20.38"></a><span id="l20.38"> dnl = PostScript print module</span>
<a href="#l20.39"></a><span id="l20.39"> dnl ========================================================</span>
<a href="#l20.40"></a><span id="l20.40"> MOZ_ARG_DISABLE_BOOL(postscript,</span>
<a href="#l20.41"></a><span id="l20.41"> [  --disable-postscript    Disable PostScript printing support ],</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineat">@@ -5525,23 +5522,17 @@ MOZ_ARG_DISABLE_BOOL(universalchardet,</span>
<a href="#l20.43"></a><span id="l20.43"> dnl ========================================================</span>
<a href="#l20.44"></a><span id="l20.44"> dnl Build Freetype in the tree</span>
<a href="#l20.45"></a><span id="l20.45"> dnl ========================================================</span>
<a href="#l20.46"></a><span id="l20.46"> MOZ_ARG_ENABLE_BOOL(tree-freetype,</span>
<a href="#l20.47"></a><span id="l20.47"> [  --enable-tree-freetype         Enable Tree FreeType],</span>
<a href="#l20.48"></a><span id="l20.48">     MOZ_TREE_FREETYPE=1,</span>
<a href="#l20.49"></a><span id="l20.49">     MOZ_TREE_FREETYPE= )</span>
<a href="#l20.50"></a><span id="l20.50"> if test -n &quot;$MOZ_TREE_FREETYPE&quot;; then</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-   AC_DEFINE(MOZ_TREE_FREETYPE)</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-   AC_SUBST(MOZ_TREE_FREETYPE)</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-   FT2_CFLAGS=&quot;-I${MOZILLA_SRCDIR}/modules/freetype2/include&quot;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-   CAIRO_FT_CFLAGS=&quot;-I${MOZILLA_SRCDIR}/modules/freetype2/include&quot;</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-   FT2_LIBS=&quot;${LIBXUL_DIST}/lib/freetype2.lib&quot;</span>
<a href="#l20.56"></a><span id="l20.56">    CAIRO_FT_LIBS = &quot;${LIBXUL_DIST}/lib/freetype2.lib&quot;</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-   AC_SUBST(CAIRO_FT_CFLAGS)</span>
<a href="#l20.58"></a><span id="l20.58"> fi</span>
<a href="#l20.59"></a><span id="l20.59"> </span>
<a href="#l20.60"></a><span id="l20.60"> dnl ========================================================</span>
<a href="#l20.61"></a><span id="l20.61"> dnl experimental ldap features</span>
<a href="#l20.62"></a><span id="l20.62"> dnl ========================================================</span>
<a href="#l20.63"></a><span id="l20.63"> MOZ_ARG_ENABLE_BOOL(ldap-experimental,</span>
<a href="#l20.64"></a><span id="l20.64"> [  --enable-ldap-experimental</span>
<a href="#l20.65"></a><span id="l20.65">                           Enable LDAP experimental features],</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineat">@@ -7173,37 +7164,37 @@ MOZ_TREE_CAIRO=,</span>
<a href="#l20.67"></a><span id="l20.67"> MOZ_TREE_CAIRO=1 )</span>
<a href="#l20.68"></a><span id="l20.68"> </span>
<a href="#l20.69"></a><span id="l20.69"> # Check for headers defining standard int types.</span>
<a href="#l20.70"></a><span id="l20.70"> AC_CHECK_HEADERS(stdint.h inttypes.h sys/int_types.h)</span>
<a href="#l20.71"></a><span id="l20.71"> </span>
<a href="#l20.72"></a><span id="l20.72"> if test &quot;$MOZ_TREE_CAIRO&quot;; then</span>
<a href="#l20.73"></a><span id="l20.73">     AC_DEFINE(MOZ_TREE_CAIRO)</span>
<a href="#l20.74"></a><span id="l20.74"> </span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-    if test &quot;$MOZ_X11&quot;; then</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-        CAIRO_FT_CFLAGS=&quot;$FT2_CFLAGS&quot;</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-    fi</span>
<a href="#l20.78"></a><span id="l20.78">     if test &quot;$MOZ_WIDGET_TOOLKIT&quot; = &quot;os2&quot;; then</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-        CAIRO_FT_CFLAGS=&quot;-I${MZFTCFGFT2}/include&quot;</span>
<a href="#l20.80"></a><span id="l20.80">         CAIRO_FT_LIBS=&quot;-L${MZFTCFGFT2}/lib -lmozft -lmzfntcfg&quot;</span>
<a href="#l20.81"></a><span id="l20.81">     fi</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineminus">-    AC_SUBST(CAIRO_FT_CFLAGS)</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineplus">+    if test &quot;$MOZ_WIDGET_TOOLKIT&quot; = &quot;beos&quot;; then</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineplus">+        PKG_CHECK_MODULES(CAIRO_FT, fontconfig freetype2)</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineplus">+    fi</span>
<a href="#l20.86"></a><span id="l20.86"> </span>
<a href="#l20.87"></a><span id="l20.87">     if test &quot;$_WIN32_MSVC&quot;; then</span>
<a href="#l20.88"></a><span id="l20.88">         MOZ_CAIRO_LIBS='$(DEPTH)/mozilla/gfx/cairo/cairo/src/mozcairo.lib $(DEPTH)/mozilla/gfx/cairo/libpixman/src/mozlibpixman.lib'</span>
<a href="#l20.89"></a><span id="l20.89">     else</span>
<a href="#l20.90"></a><span id="l20.90">         MOZ_CAIRO_LIBS='$(DEPTH)/mozilla/gfx/cairo/cairo/src/$(LIB_PREFIX)mozcairo.$(LIB_SUFFIX) $(DEPTH)/mozilla/gfx/cairo/libpixman/src/$(LIB_PREFIX)mozlibpixman.$(LIB_SUFFIX)'&quot; $CAIRO_FT_LIBS&quot;</span>
<a href="#l20.91"></a><span id="l20.91"> </span>
<a href="#l20.92"></a><span id="l20.92">         if test &quot;$MOZ_X11&quot;; then</span>
<a href="#l20.93"></a><span id="l20.93">             MOZ_CAIRO_LIBS=&quot;$MOZ_CAIRO_LIBS $XLDFLAGS -lXrender -lfreetype -lfontconfig&quot;</span>
<a href="#l20.94"></a><span id="l20.94">         fi</span>
<a href="#l20.95"></a><span id="l20.95">     fi</span>
<a href="#l20.96"></a><span id="l20.96"> else</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineplus">+   PKG_CHECK_MODULES(CAIRO, cairo &gt;= $CAIRO_VERSION freetype2 fontconfig)</span>
<a href="#l20.98"></a><span id="l20.98">    MOZ_CAIRO_LIBS=$CAIRO_LIBS</span>
<a href="#l20.99"></a><span id="l20.99">    if test &quot;$MOZ_X11&quot;; then</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineplus">+        PKG_CHECK_MODULES(CAIRO_XRENDER, cairo-xlib-xrender &gt;= $CAIRO_VERSION)</span>
<a href="#l20.101"></a><span id="l20.101">         MOZ_CAIRO_LIBS=&quot;$MOZ_CAIRO_LIBS $XLDFLAGS $CAIRO_XRENDER_LIBS&quot;</span>
<a href="#l20.102"></a><span id="l20.102">    fi</span>
<a href="#l20.103"></a><span id="l20.103"> fi</span>
<a href="#l20.104"></a><span id="l20.104"> </span>
<a href="#l20.105"></a><span id="l20.105"> AC_SUBST(MOZ_TREE_CAIRO)</span>
<a href="#l20.106"></a><span id="l20.106"> AC_SUBST(MOZ_CAIRO_LIBS)</span>
<a href="#l20.107"></a><span id="l20.107"> </span>
<a href="#l20.108"></a><span id="l20.108"> dnl qcms</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/base/content/SearchDialog.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -55,16 +55,19 @@ var gSearchBundle;</span>
<a href="#l21.4"></a><span id="l21.4"> </span>
<a href="#l21.5"></a><span id="l21.5"> // Datasource search listener -- made global as it has to be registered</span>
<a href="#l21.6"></a><span id="l21.6"> // and unregistered in different functions.</span>
<a href="#l21.7"></a><span id="l21.7"> var gDataSourceSearchListener;</span>
<a href="#l21.8"></a><span id="l21.8"> var gViewSearchListener;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> var gSearchStopButton;</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+// Should we try to search online?</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+var gSearchOnline = false;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+</span>
<a href="#l21.15"></a><span id="l21.15"> // Controller object for search results thread pane</span>
<a href="#l21.16"></a><span id="l21.16"> var nsSearchResultsController =</span>
<a href="#l21.17"></a><span id="l21.17"> {</span>
<a href="#l21.18"></a><span id="l21.18">     supportsCommand: function(command)</span>
<a href="#l21.19"></a><span id="l21.19">     {</span>
<a href="#l21.20"></a><span id="l21.20">         switch(command) {</span>
<a href="#l21.21"></a><span id="l21.21">         case &quot;cmd_delete&quot;:</span>
<a href="#l21.22"></a><span id="l21.22">         case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineat">@@ -343,19 +346,36 @@ function selectFolder(folder)</span>
<a href="#l21.24"></a><span id="l21.24"> </span>
<a href="#l21.25"></a><span id="l21.25"> function updateSearchFolderPicker(folderURI)</span>
<a href="#l21.26"></a><span id="l21.26"> {</span>
<a href="#l21.27"></a><span id="l21.27">     SetFolderPicker(folderURI, gFolderPicker.id);</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29">     // use the URI to get the real folder</span>
<a href="#l21.30"></a><span id="l21.30">     gCurrentFolder = GetMsgFolderFromUri(folderURI);</span>
<a href="#l21.31"></a><span id="l21.31"> </span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-    var searchLocalSystem = document.getElementById(&quot;checkSearchLocalSystem&quot;);</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-    if (searchLocalSystem)</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-        searchLocalSystem.disabled = gCurrentFolder.server.searchScope == nsMsgSearchScope.offlineMail;</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+    var searchOnline = document.getElementById(&quot;checkSearchOnline&quot;);</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+    if (searchOnline)</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+    {</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+      // We will clear and disable the search online checkbox if we are offline, or</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+      // if the folder does not support online search.</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+      // Anything greater than 0 is an online server like IMAP or news.</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+      if (gCurrentFolder.server.offlineSupportLevel &amp;&amp;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+          !Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+                             .offline)</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+      {</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+        searchOnline.disabled = false;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+      }</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+      else</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+      {</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+        searchOnline.checked = false;</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+        searchOnline.disabled = true;</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+      }</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+    }</span>
<a href="#l21.55"></a><span id="l21.55">     setSearchScope(GetScopeForFolder(gCurrentFolder));</span>
<a href="#l21.56"></a><span id="l21.56"> }</span>
<a href="#l21.57"></a><span id="l21.57"> </span>
<a href="#l21.58"></a><span id="l21.58"> function updateSearchLocalSystem()</span>
<a href="#l21.59"></a><span id="l21.59"> {</span>
<a href="#l21.60"></a><span id="l21.60">   setSearchScope(GetScopeForFolder(gCurrentFolder));</span>
<a href="#l21.61"></a><span id="l21.61"> }</span>
<a href="#l21.62"></a><span id="l21.62"> </span>
<a href="#l21.63"></a><span id="l21.63" class="difflineat">@@ -387,16 +407,17 @@ function onEnterInSearchTerm()</span>
<a href="#l21.64"></a><span id="l21.64"> </span>
<a href="#l21.65"></a><span id="l21.65"> function onSearch()</span>
<a href="#l21.66"></a><span id="l21.66"> {</span>
<a href="#l21.67"></a><span id="l21.67">   let viewWrapper = gFolderDisplay.view;</span>
<a href="#l21.68"></a><span id="l21.68">   let searchTerms = getSearchTerms();</span>
<a href="#l21.69"></a><span id="l21.69"> </span>
<a href="#l21.70"></a><span id="l21.70">   viewWrapper.beginViewUpdate();</span>
<a href="#l21.71"></a><span id="l21.71">   viewWrapper.search.userTerms = searchTerms.length ? searchTerms : null;</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+  viewWrapper.search.onlineSearch = gSearchOnline;</span>
<a href="#l21.73"></a><span id="l21.73">   viewWrapper.searchFolders = getSearchFolders();</span>
<a href="#l21.74"></a><span id="l21.74">   viewWrapper.endViewUpdate();</span>
<a href="#l21.75"></a><span id="l21.75"> }</span>
<a href="#l21.76"></a><span id="l21.76"> </span>
<a href="#l21.77"></a><span id="l21.77"> /**</span>
<a href="#l21.78"></a><span id="l21.78">  * Get the current set of search terms, returning them as a list.  We filter out</span>
<a href="#l21.79"></a><span id="l21.79">  *  dangerous and insane predicates.</span>
<a href="#l21.80"></a><span id="l21.80">  */</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineat">@@ -481,21 +502,79 @@ function AddSubFoldersToURI(folder)</span>
<a href="#l21.82"></a><span id="l21.82">           returnString += '|';</span>
<a href="#l21.83"></a><span id="l21.83">         returnString += subFoldersString;</span>
<a href="#l21.84"></a><span id="l21.84">       }</span>
<a href="#l21.85"></a><span id="l21.85">     }</span>
<a href="#l21.86"></a><span id="l21.86">   }</span>
<a href="#l21.87"></a><span id="l21.87">   return returnString;</span>
<a href="#l21.88"></a><span id="l21.88"> }</span>
<a href="#l21.89"></a><span id="l21.89"> </span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+/**</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+ * Determine the proper search scope to use for a folder, so that the user is</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+ *  presented with a correct list of search capabilities. The user may manually</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+ *  request on online search for certain server types. To determine if the</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+ *  folder body may be searched, we ignore whether autosync is enabled,</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+ *  figuring that after the user manually syncs, they would still expect that</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+ *  body searches would work.</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineplus">+ *  </span>
<a href="#l21.99"></a><span id="l21.99" class="difflineplus">+ * The available search capabilities also depend on whether the user is</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+ *  currently online or offline. Although that is also checked by the server,</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineplus">+ *  we do it ourselves because we have a more complex response to offline</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineplus">+ *  than the server's searchScope attribute provides.</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineplus">+ *</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineplus">+ * This method only works for real folders.</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineplus">+ */</span>
<a href="#l21.106"></a><span id="l21.106"> function GetScopeForFolder(folder)</span>
<a href="#l21.107"></a><span id="l21.107"> {</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-  var searchLocalSystem = document.getElementById(&quot;checkSearchLocalSystem&quot;);</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-  return searchLocalSystem &amp;&amp; searchLocalSystem.checked ? nsMsgSearchScope.offlineMail : folder.server.searchScope;</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineplus">+  let searchOnline = document.getElementById(&quot;checkSearchOnline&quot;);</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineplus">+  if (searchOnline &amp;&amp; searchOnline.checked)</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineplus">+  {</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineplus">+    gSearchOnline = true;</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineplus">+    return folder.server.searchScope;</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineplus">+  }</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineplus">+  gSearchOnline = false;</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineplus">+  // We are going to search offline. The proper search scope may depend on</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineplus">+  // whether we have the body and/or junk available or not.</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineplus">+  let localType;</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineplus">+  try</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineplus">+  {</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineplus">+    localType = folder.server.localStoreType;</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+  }</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+  catch (e) {} // On error, we'll just assume the default mailbox type</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineplus">+</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineplus">+  let hasBody = folder.getFlag(Components.interfaces.nsMsgFolderFlags.Offline);</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineplus">+  let nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineplus">+  switch (localType)</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineplus">+  {</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineplus">+    case &quot;news&quot;:</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineplus">+      // News has four offline scopes, depending on whether junk and body</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineplus">+      // are available.</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineplus">+      let hasJunk = </span>
<a href="#l21.135"></a><span id="l21.135" class="difflineplus">+        folder.getInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;)</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineplus">+               == &quot;true&quot;;</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineplus">+      if (hasJunk &amp;&amp; hasBody)</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineplus">+        return nsMsgSearchScope.localNewsJunkBody;</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineplus">+      if (hasJunk) // and no body</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineplus">+        return nsMsgSearchScope.localNewsJunk;</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineplus">+      if (hasBody) // and no junk</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineplus">+        return nsMsgSearchScope.localNewsBody;</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineplus">+      // We don't have offline message bodies or junk processing.</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineplus">+      return nsMsgSearchScope.localNews;</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineplus">+</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineplus">+    case &quot;imap&quot;:</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineplus">+      // Junk is always enabled for imap, so the offline scope only depends on</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineplus">+      // whether the body is available.</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineplus">+      if (!hasBody)</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineplus">+        return nsMsgSearchScope.onlineManual;</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineplus">+        // fall through to default</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineplus">+    default:</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineplus">+      return nsMsgSearchScope.offlineMail;</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineplus">+  }</span>
<a href="#l21.155"></a><span id="l21.155" class="difflineplus">+</span>
<a href="#l21.156"></a><span id="l21.156"> }</span>
<a href="#l21.157"></a><span id="l21.157"> </span>
<a href="#l21.158"></a><span id="l21.158"> var nsMsgViewSortType = Components.interfaces.nsMsgViewSortType;</span>
<a href="#l21.159"></a><span id="l21.159"> var nsMsgViewSortOrder = Components.interfaces.nsMsgViewSortOrder;</span>
<a href="#l21.160"></a><span id="l21.160"> var nsMsgViewFlagsType = Components.interfaces.nsMsgViewFlagsType;</span>
<a href="#l21.161"></a><span id="l21.161"> var nsMsgViewCommandType = Components.interfaces.nsMsgViewCommandType;</span>
<a href="#l21.162"></a><span id="l21.162"> </span>
<a href="#l21.163"></a><span id="l21.163"> function goUpdateSearchItems(commandset)</span>
<a href="#l21.164"></a><span id="l21.164" class="difflineat">@@ -583,11 +662,12 @@ function saveAsVirtualFolder()</span>
<a href="#l21.165"></a><span id="l21.165">       searchFolderURIs += '|' + subFolderURIs;</span>
<a href="#l21.166"></a><span id="l21.166">   }</span>
<a href="#l21.167"></a><span id="l21.167"> </span>
<a href="#l21.168"></a><span id="l21.168">   var dialog = window.openDialog(&quot;chrome://messenger/content/virtualFolderProperties.xul&quot;, &quot;&quot;,</span>
<a href="#l21.169"></a><span id="l21.169">                                  &quot;chrome,titlebar,modal,centerscreen&quot;,</span>
<a href="#l21.170"></a><span id="l21.170">                                  {folder: window.arguments[0].folder,</span>
<a href="#l21.171"></a><span id="l21.171">                                   searchTerms: toXPCOMArray(getSearchTerms(),</span>
<a href="#l21.172"></a><span id="l21.172">                                                             Components.interfaces.nsISupportsArray),</span>
<a href="#l21.173"></a><span id="l21.173" class="difflineminus">-                                  searchFolderURIs: searchFolderURIs});</span>
<a href="#l21.174"></a><span id="l21.174" class="difflineplus">+                                  searchFolderURIs: searchFolderURIs,</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineplus">+                                  searchOnline: document.getElementById(&quot;checkSearchOnline&quot;).checked});</span>
<a href="#l21.176"></a><span id="l21.176"> }</span>
<a href="#l21.177"></a><span id="l21.177"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/base/content/SearchDialog.xul</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.xul</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -118,16 +118,22 @@</span>
<a href="#l22.4"></a><span id="l22.4">          &lt;button id=&quot;search-button&quot; oncommand=&quot;onSearchButton(event);&quot; default=&quot;true&quot;/&gt;</span>
<a href="#l22.5"></a><span id="l22.5">         &lt;/hbox&gt;</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l22.8"></a><span id="l22.8">            &lt;checkbox id=&quot;checkSearchSubFolders&quot; label=&quot;&amp;searchSubfolders.label;&quot; checked=&quot;true&quot; accesskey=&quot;&amp;searchSubfolders.accesskey;&quot;/&gt;</span>
<a href="#l22.9"></a><span id="l22.9">            &lt;spacer flex=&quot;10&quot;/&gt;</span>
<a href="#l22.10"></a><span id="l22.10">            &lt;button label=&quot;&amp;resetButton.label;&quot; oncommand=&quot;onResetSearch(event);&quot; accesskey=&quot;&amp;resetButton.accesskey;&quot;/&gt;</span>
<a href="#l22.11"></a><span id="l22.11">          &lt;/hbox&gt;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+           &lt;checkbox id=&quot;checkSearchOnline&quot;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+                     label=&quot;&amp;searchOnline.label;&quot;</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+                     accesskey=&quot;&amp;searchOnline.accesskey;&quot;</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+                     oncommand=&quot;updateSearchLocalSystem();&quot;/&gt;</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+         &lt;/hbox&gt;</span>
<a href="#l22.18"></a><span id="l22.18">       &lt;/vbox&gt;</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">       &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l22.21"></a><span id="l22.21">         &lt;vbox id=&quot;searchTermListBox&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l22.22"></a><span id="l22.22">       &lt;/hbox&gt;</span>
<a href="#l22.23"></a><span id="l22.23">     &lt;/vbox&gt;</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25">     &lt;splitter id=&quot;gray_horizontal_splitter&quot; collapse=&quot;after&quot; persist=&quot;state&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -202,18 +202,17 @@ let gFolderTreeView = {</span>
<a href="#l23.4"></a><span id="l23.4">   },</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">   /**</span>
<a href="#l23.7"></a><span id="l23.7">    * If the hidden pref is set, then double-clicking on a folder should open it</span>
<a href="#l23.8"></a><span id="l23.8">    *</span>
<a href="#l23.9"></a><span id="l23.9">    * @param event  the double-click event</span>
<a href="#l23.10"></a><span id="l23.10">    */</span>
<a href="#l23.11"></a><span id="l23.11">   onDoubleClick: function ftv_onDoubleClick(aEvent) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    if (pref.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;) ||</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-        aEvent.button != 0 || aEvent.originalTarget.localName == &quot;twisty&quot; ||</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+    if (aEvent.button != 0 || aEvent.originalTarget.localName == &quot;twisty&quot; ||</span>
<a href="#l23.15"></a><span id="l23.15">         aEvent.originalTarget.localName == &quot;slider&quot; ||</span>
<a href="#l23.16"></a><span id="l23.16">         aEvent.originalTarget.localName == &quot;scrollbarbutton&quot;)</span>
<a href="#l23.17"></a><span id="l23.17">       return;</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">     let row = gFolderTreeView._treeElement.treeBoxObject.getRowAt(aEvent.clientX,</span>
<a href="#l23.20"></a><span id="l23.20">                                                                   aEvent.clientY);</span>
<a href="#l23.21"></a><span id="l23.21">     let folderItem = gFolderTreeView._rowMap[row];</span>
<a href="#l23.22"></a><span id="l23.22">     if (folderItem)</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineat">@@ -1406,17 +1405,20 @@ ftvItem.prototype = {</span>
<a href="#l23.24"></a><span id="l23.24">   },</span>
<a href="#l23.25"></a><span id="l23.25"> </span>
<a href="#l23.26"></a><span id="l23.26">   getProperties: function ftvItem_getProperties(aProps) {</span>
<a href="#l23.27"></a><span id="l23.27">     // From folderUtils.jsm</span>
<a href="#l23.28"></a><span id="l23.28">     setPropertyAtoms(this._folder, aProps);</span>
<a href="#l23.29"></a><span id="l23.29">   },</span>
<a href="#l23.30"></a><span id="l23.30"> </span>
<a href="#l23.31"></a><span id="l23.31">   command: function fti_command() {</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-    MsgOpenNewWindowForFolder(this._folder.URI, -1 /* key */);</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+    let pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+    if (!pref.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;))</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+      MsgOpenNewWindowForFolder(this._folder.URI, -1 /* key */);</span>
<a href="#l23.37"></a><span id="l23.37">   },</span>
<a href="#l23.38"></a><span id="l23.38"> </span>
<a href="#l23.39"></a><span id="l23.39">   _children: null,</span>
<a href="#l23.40"></a><span id="l23.40">   get children() {</span>
<a href="#l23.41"></a><span id="l23.41">     const Ci = Components.interfaces;</span>
<a href="#l23.42"></a><span id="l23.42">     // We're caching our child list to save perf.</span>
<a href="#l23.43"></a><span id="l23.43">     if (!this._children) {</span>
<a href="#l23.44"></a><span id="l23.44">       let iter = fixIterator(this._folder.subFolders, Ci.nsIMsgFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -228,16 +228,18 @@ var DefaultController =</span>
<a href="#l24.4"></a><span id="l24.4">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l24.5"></a><span id="l24.5">       case &quot;cmd_selectThread&quot;:</span>
<a href="#l24.6"></a><span id="l24.6">       case &quot;cmd_moveToFolderAgain&quot;:</span>
<a href="#l24.7"></a><span id="l24.7">       case &quot;cmd_selectFlagged&quot;:</span>
<a href="#l24.8"></a><span id="l24.8">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l24.9"></a><span id="l24.9">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l24.10"></a><span id="l24.10">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l24.11"></a><span id="l24.11">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l24.14"></a><span id="l24.14">         return true;</span>
<a href="#l24.15"></a><span id="l24.15">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l24.16"></a><span id="l24.16">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l24.17"></a><span id="l24.17">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l24.18"></a><span id="l24.18">         return MailOfflineMgr.isOnline();</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l24.21"></a><span id="l24.21">       case &quot;cmd_killThread&quot;:</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -342,34 +344,38 @@ var DefaultController =</span>
<a href="#l24.23"></a><span id="l24.23">           return true;</span>
<a href="#l24.24"></a><span id="l24.24">         }</span>
<a href="#l24.25"></a><span id="l24.25">         return false;</span>
<a href="#l24.26"></a><span id="l24.26">       case &quot;cmd_printpreview&quot;:</span>
<a href="#l24.27"></a><span id="l24.27">         if (GetNumSelectedMessages() == 1)</span>
<a href="#l24.28"></a><span id="l24.28">           return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody);</span>
<a href="#l24.29"></a><span id="l24.29">         return false;</span>
<a href="#l24.30"></a><span id="l24.30">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l24.33"></a><span id="l24.33">         return true;</span>
<a href="#l24.34"></a><span id="l24.34">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l24.35"></a><span id="l24.35">       case &quot;button_file&quot;:</span>
<a href="#l24.36"></a><span id="l24.36">       case &quot;cmd_file&quot;:</span>
<a href="#l24.37"></a><span id="l24.37">       case &quot;cmd_archive&quot;:</span>
<a href="#l24.38"></a><span id="l24.38">         return (gFolderDisplay.selectedCount &gt; 0 );</span>
<a href="#l24.39"></a><span id="l24.39">       case &quot;button_archive&quot;:</span>
<a href="#l24.40"></a><span id="l24.40">         return gFolderDisplay.selectedCount &gt; 0 &amp;&amp; gFolderDisplay.displayedFolder &amp;&amp;</span>
<a href="#l24.41"></a><span id="l24.41">           !gFolderDisplay.displayedFolder.isSpecialFolder(</span>
<a href="#l24.42"></a><span id="l24.42">              Components.interfaces.nsMsgFolderFlags.Archive, true);</span>
<a href="#l24.43"></a><span id="l24.43">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l24.44"></a><span id="l24.44">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-        // can't do news on junk yet.</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-        return (GetNumSelectedMessages() &gt; 0 &amp;&amp; !gFolderDisplay.selectedMessageIsNews);</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l24.48"></a><span id="l24.48">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-        if (GetNumSelectedMessages() &gt; 0)</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-          return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-        return false;</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+        // We're going to take a conservative position here, because we really</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+        // don't want people running junk controls on folders that are not</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+        // enabled for junk. The junk type picks up possible dummy message headers,</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+        // while the runJunkControls will prevent running on XF virtual folders.</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk) &amp;&amp;</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+               gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l24.58"></a><span id="l24.58">       case &quot;cmd_displayMsgFilters&quot;:</span>
<a href="#l24.59"></a><span id="l24.59">         let mgr = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l24.60"></a><span id="l24.60">                             .getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l24.61"></a><span id="l24.61">         return mgr.accounts.Count() &gt; 0;</span>
<a href="#l24.62"></a><span id="l24.62">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l24.63"></a><span id="l24.63">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.applyFilters);</span>
<a href="#l24.64"></a><span id="l24.64">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l24.65"></a><span id="l24.65">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineat">@@ -739,16 +745,22 @@ var DefaultController =</span>
<a href="#l24.67"></a><span id="l24.67">         MsgJunk();</span>
<a href="#l24.68"></a><span id="l24.68">         return;</span>
<a href="#l24.69"></a><span id="l24.69">       case &quot;cmd_stop&quot;:</span>
<a href="#l24.70"></a><span id="l24.70">         msgWindow.StopUrls();</span>
<a href="#l24.71"></a><span id="l24.71">         return;</span>
<a href="#l24.72"></a><span id="l24.72">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l24.73"></a><span id="l24.73">         MsgMarkAsFlagged();</span>
<a href="#l24.74"></a><span id="l24.74">         return;</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineplus">+        MsgViewAllHeaders();</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineplus">+        return;</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineplus">+        MsgViewNormalHeaders();</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineplus">+        return;</span>
<a href="#l24.81"></a><span id="l24.81">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l24.82"></a><span id="l24.82">         JunkSelectedMessages(true);</span>
<a href="#l24.83"></a><span id="l24.83">         return;</span>
<a href="#l24.84"></a><span id="l24.84">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l24.85"></a><span id="l24.85">         JunkSelectedMessages(false);</span>
<a href="#l24.86"></a><span id="l24.86">         return;</span>
<a href="#l24.87"></a><span id="l24.87">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l24.88"></a><span id="l24.88">         analyzeMessagesForJunk();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -388,16 +388,21 @@</span>
<a href="#l25.4"></a><span id="l25.4">               aNumAddressesToShow = numAddresses;</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">             // before we try to create email address nodes, try to leverage any cached nodes...</span>
<a href="#l25.7"></a><span id="l25.7">             var remainder = this.fillCachedAddresses(aAddressesNode, aNumAddressesToShow);</span>
<a href="#l25.8"></a><span id="l25.8">             var index = numAddresses - remainder;</span>
<a href="#l25.9"></a><span id="l25.9">             while (index &lt; numAddresses &amp;&amp; index &lt; aNumAddressesToShow)</span>
<a href="#l25.10"></a><span id="l25.10">             {</span>
<a href="#l25.11"></a><span id="l25.11">               var newAddressNode = document.createElement(&quot;mail-emailaddress&quot;);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+              // Stash the headerName somewhere that AddExtraAddressProcessing</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+              // will be able to find it.</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+              newAddressNode.setAttribute(&quot;headerName&quot;, this.headerName);</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+</span>
<a href="#l25.17"></a><span id="l25.17">               if (index)</span>
<a href="#l25.18"></a><span id="l25.18">               {</span>
<a href="#l25.19"></a><span id="l25.19">                 var textNode = document.createElement(&quot;text&quot;);</span>
<a href="#l25.20"></a><span id="l25.20">                 textNode.setAttribute(&quot;value&quot;, &quot;,&quot;);</span>
<a href="#l25.21"></a><span id="l25.21">                 textNode.setAttribute(&quot;class&quot;, &quot;emailSeparator&quot;);</span>
<a href="#l25.22"></a><span id="l25.22">                 aAddressesNode.appendChild(textNode);</span>
<a href="#l25.23"></a><span id="l25.23">               }</span>
<a href="#l25.24"></a><span id="l25.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -401,41 +401,23 @@ function initMoveToFolderAgainMenu(aMenu</span>
<a href="#l26.4"></a><span id="l26.4">       &quot;moveToFolderAgain&quot; : &quot;copyToFolderAgain&quot;, [destMsgFolder.prettyName], 1);</span>
<a href="#l26.5"></a><span id="l26.5">     aMenuItem.accesskey = gMessengerBundle.getString(isMove ?</span>
<a href="#l26.6"></a><span id="l26.6">       &quot;moveToFolderAgainAccessKey&quot; : &quot;copyToFolderAgainAccessKey&quot;);</span>
<a href="#l26.7"></a><span id="l26.7">   }</span>
<a href="#l26.8"></a><span id="l26.8"> }</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10"> function InitViewHeadersMenu()</span>
<a href="#l26.11"></a><span id="l26.11"> {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  var headerchoice = 1;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  try</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-  {</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-    headerchoice = pref.getIntPref(&quot;mail.show_headers&quot;);</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-  }</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-  catch (ex)</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-  {</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-    dump(&quot;failed to get the header pref\n&quot;);</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-  }</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-  var id = null;</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">-  switch (headerchoice)</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">-  {</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineminus">-    case 2:</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-      id = &quot;viewallheaders&quot;;</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-      break;</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-    case 1:</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-    default:</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-      id = &quot;viewnormalheaders&quot;;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-      break;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-  }</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-  var menuitem = document.getElementById(id);</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-  if (menuitem)</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-    menuitem.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+  const nsMimeHeaderDisplayTypes = Components.interfaces.nsMimeHeaderDisplayTypes;</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+  var headerchoice = pref.getIntPref(&quot;mail.show_headers&quot;);</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+  document.getElementById(&quot;cmd_viewAllHeader&quot;)</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+          .setAttribute(&quot;checked&quot;, headerchoice == nsMimeHeaderDisplayTypes.AllHeaders);</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+  document.getElementById(&quot;cmd_viewNormalHeader&quot;)</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+          .setAttribute(&quot;checked&quot;, headerchoice == nsMimeHeaderDisplayTypes.NormalHeaders);</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+  document.commandDispatcher.updateCommands(&quot;create-menu-mark&quot;);</span>
<a href="#l26.44"></a><span id="l26.44"> }</span>
<a href="#l26.45"></a><span id="l26.45"> </span>
<a href="#l26.46"></a><span id="l26.46"> function InitViewBodyMenu()</span>
<a href="#l26.47"></a><span id="l26.47"> {</span>
<a href="#l26.48"></a><span id="l26.48">   var html_as = 0;</span>
<a href="#l26.49"></a><span id="l26.49">   var prefer_plaintext = false;</span>
<a href="#l26.50"></a><span id="l26.50">   var disallow_classes = 0;</span>
<a href="#l26.51"></a><span id="l26.51">   var isFeed = gFolderDisplay.selectedMessageIsFeed;</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineat">@@ -2458,17 +2440,17 @@ function UpdateJunkButton()</span>
<a href="#l26.53"></a><span id="l26.53">   // The junk message should slave off the selected message, as the preview pane</span>
<a href="#l26.54"></a><span id="l26.54">   //  may not be visible</span>
<a href="#l26.55"></a><span id="l26.55">   let hdr = gFolderDisplay.selectedMessage;</span>
<a href="#l26.56"></a><span id="l26.56">   // But only the message display knows if we are dealing with a dummy.</span>
<a href="#l26.57"></a><span id="l26.57">   if (!hdr || gMessageDisplay.isDummy) // .eml file</span>
<a href="#l26.58"></a><span id="l26.58">     return;</span>
<a href="#l26.59"></a><span id="l26.59">   let junkScore = hdr.getStringProperty(&quot;junkscore&quot;);</span>
<a href="#l26.60"></a><span id="l26.60">   let hideJunk = (junkScore == Components.interfaces.nsIJunkMailPlugin.IS_SPAM_SCORE);</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-  if (gFolderDisplay.selectedMessageIsNews)</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+  if (!gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk))</span>
<a href="#l26.63"></a><span id="l26.63">     hideJunk = true;</span>
<a href="#l26.64"></a><span id="l26.64"> </span>
<a href="#l26.65"></a><span id="l26.65">   getCurrentMsgHdrButtonBox().getButton('hdrJunkButton').disabled = hideJunk;</span>
<a href="#l26.66"></a><span id="l26.66"> }</span>
<a href="#l26.67"></a><span id="l26.67"> </span>
<a href="#l26.68"></a><span id="l26.68"> function MsgMarkMsgAsRead()</span>
<a href="#l26.69"></a><span id="l26.69"> {</span>
<a href="#l26.70"></a><span id="l26.70">   MarkSelectedMessagesRead(!SelectedMessagesAreRead());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -297,16 +297,18 @@</span>
<a href="#l27.4"></a><span id="l27.4">     &lt;command id=&quot;cmd_markAsRead&quot; oncommand=&quot;goDoCommand('cmd_markAsRead'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.5"></a><span id="l27.5">     &lt;command id=&quot;cmd_markAllRead&quot; oncommand=&quot;goDoCommand('cmd_markAllRead'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.6"></a><span id="l27.6">     &lt;command id=&quot;cmd_markThreadAsRead&quot; oncommand=&quot;goDoCommand('cmd_markThreadAsRead'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.7"></a><span id="l27.7">     &lt;command id=&quot;cmd_markReadByDate&quot; oncommand=&quot;goDoCommand('cmd_markReadByDate');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.8"></a><span id="l27.8">     &lt;command id=&quot;cmd_markAsFlagged&quot; oncommand=&quot;goDoCommand('cmd_markAsFlagged'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.9"></a><span id="l27.9">     &lt;command id=&quot;cmd_markAsJunk&quot; oncommand=&quot;goDoCommand('cmd_markAsJunk'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.10"></a><span id="l27.10">     &lt;command id=&quot;cmd_markAsNotJunk&quot; oncommand=&quot;goDoCommand('cmd_markAsNotJunk'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.11"></a><span id="l27.11">     &lt;command id=&quot;cmd_recalculateJunkScore&quot; oncommand=&quot;goDoCommand('cmd_recalculateJunkScore');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+    &lt;command id=&quot;cmd_viewAllHeader&quot; oncommand=&quot;goDoCommand('cmd_viewAllHeader');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    &lt;command id=&quot;cmd_viewNormalHeader&quot; oncommand=&quot;goDoCommand('cmd_viewNormalHeader');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.14"></a><span id="l27.14"> &lt;/commandset&gt;</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> &lt;commandset id=&quot;mailToolsMenuItems&quot;</span>
<a href="#l27.17"></a><span id="l27.17">               commandupdater=&quot;true&quot;</span>
<a href="#l27.18"></a><span id="l27.18">               events=&quot;create-menu-tasks&quot;</span>
<a href="#l27.19"></a><span id="l27.19">               oncommandupdate=&quot;goUpdateMailMenuItems(this)&quot;&gt;</span>
<a href="#l27.20"></a><span id="l27.20">   &lt;command id=&quot;cmd_displayMsgFilters&quot;</span>
<a href="#l27.21"></a><span id="l27.21">            oncommand=&quot;goDoCommand('cmd_displayMsgFilters');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -1114,23 +1116,23 @@</span>
<a href="#l27.23"></a><span id="l27.23">           &lt;menuseparator id=&quot;viewAfterThreadsSeparator&quot;/&gt;</span>
<a href="#l27.24"></a><span id="l27.24">           &lt;menu id=&quot;viewheadersmenu&quot; label=&quot;&amp;headersMenu.label;&quot; accesskey=&quot;&amp;headersMenu.accesskey;&quot;&gt;</span>
<a href="#l27.25"></a><span id="l27.25">             &lt;menupopup id=&quot;menu_HeadersPopup&quot; onpopupshowing=&quot;InitViewHeadersMenu();&quot;&gt;</span>
<a href="#l27.26"></a><span id="l27.26">               &lt;menuitem id=&quot;viewallheaders&quot;</span>
<a href="#l27.27"></a><span id="l27.27">                type=&quot;radio&quot;</span>
<a href="#l27.28"></a><span id="l27.28">                name=&quot;viewheadergroup&quot;</span>
<a href="#l27.29"></a><span id="l27.29">                label=&quot;&amp;headersAllCmd.label;&quot;</span>
<a href="#l27.30"></a><span id="l27.30">                accesskey=&quot;&amp;headersAllCmd.accesskey;&quot;</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-               oncommand=&quot;MsgViewAllHeaders();&quot;/&gt;</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+               command=&quot;cmd_viewAllHeader&quot;/&gt;</span>
<a href="#l27.33"></a><span id="l27.33">               &lt;menuitem id=&quot;viewnormalheaders&quot;</span>
<a href="#l27.34"></a><span id="l27.34">                type=&quot;radio&quot;</span>
<a href="#l27.35"></a><span id="l27.35">                name=&quot;viewheadergroup&quot;</span>
<a href="#l27.36"></a><span id="l27.36">                label=&quot;&amp;headersNormalCmd.label;&quot;</span>
<a href="#l27.37"></a><span id="l27.37">                accesskey=&quot;&amp;headersNormalCmd.accesskey;&quot;</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">-               oncommand=&quot;MsgViewNormalHeaders();&quot;/&gt;</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineplus">+               command=&quot;cmd_viewNormalHeader&quot;/&gt;</span>
<a href="#l27.40"></a><span id="l27.40">             &lt;/menupopup&gt;</span>
<a href="#l27.41"></a><span id="l27.41">           &lt;/menu&gt;</span>
<a href="#l27.42"></a><span id="l27.42">           &lt;menu id=&quot;viewBodyMenu&quot; accesskey=&quot;&amp;bodyMenu.accesskey;&quot; label=&quot;&amp;bodyMenu.label;&quot;&gt;</span>
<a href="#l27.43"></a><span id="l27.43">             &lt;menupopup id=&quot;viewBodyPopMenu&quot; onpopupshowing=&quot;InitViewBodyMenu()&quot;&gt;</span>
<a href="#l27.44"></a><span id="l27.44">               &lt;menuitem id=&quot;bodyAllowHTML&quot; type=&quot;radio&quot; name=&quot;bodyPlaintextVsHTMLPref&quot; label=&quot;&amp;bodyAllowHTML.label;&quot;</span>
<a href="#l27.45"></a><span id="l27.45">                         accesskey=&quot;&amp;bodyAllowHTML.accesskey;&quot; oncommand=&quot;MsgBodyAllowHTML()&quot;/&gt;</span>
<a href="#l27.46"></a><span id="l27.46">               &lt;menuitem id=&quot;bodySanitized&quot; type=&quot;radio&quot; name=&quot;bodyPlaintextVsHTMLPref&quot; label=&quot;&amp;bodySanitized.label;&quot;</span>
<a href="#l27.47"></a><span id="l27.47">                         accesskey=&quot;&amp;bodySanitized.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/base/content/messageDisplay.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/base/content/messageDisplay.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -203,18 +203,18 @@ MessageDisplayWidget.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">     if (!this.active)</span>
<a href="#l28.5"></a><span id="l28.5">       return true;</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7">     ClearPendingReadTimer();</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">     let selectedCount = this.folderDisplay.selectedCount;</span>
<a href="#l28.10"></a><span id="l28.10"> </span>
<a href="#l28.11"></a><span id="l28.11">     if (selectedCount == 0) {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-      // davida, put your folder summary stuff here.</span>
<a href="#l28.13"></a><span id="l28.13">       this.clearDisplay();</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+      loadStartPage();</span>
<a href="#l28.15"></a><span id="l28.15">       this.singleMessageDisplay = true;</span>
<a href="#l28.16"></a><span id="l28.16">       return true;</span>
<a href="#l28.17"></a><span id="l28.17">     }</span>
<a href="#l28.18"></a><span id="l28.18">     else if (selectedCount == 1) {</span>
<a href="#l28.19"></a><span id="l28.19">       // the display of the message is happening without us</span>
<a href="#l28.20"></a><span id="l28.20">       this.singleMessageDisplay = true;</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22">       // This is the only case we don't handle and want the nsMsgDBView to</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/base/content/messageWindow.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/base/content/messageWindow.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -758,16 +758,18 @@ var MessageWindowController =</span>
<a href="#l29.4"></a><span id="l29.4">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l29.5"></a><span id="l29.5">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l29.6"></a><span id="l29.6">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l29.7"></a><span id="l29.7">       case &quot;cmd_moveToFolderAgain&quot;:</span>
<a href="#l29.8"></a><span id="l29.8">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l29.9"></a><span id="l29.9">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l29.10"></a><span id="l29.10">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l29.11"></a><span id="l29.11">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l29.14"></a><span id="l29.14">         return true;</span>
<a href="#l29.15"></a><span id="l29.15">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l29.16"></a><span id="l29.16">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l29.17"></a><span id="l29.17">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l29.18"></a><span id="l29.18">         return MailOfflineMgr.isOnline();</span>
<a href="#l29.19"></a><span id="l29.19">       default:</span>
<a href="#l29.20"></a><span id="l29.20">         return false;</span>
<a href="#l29.21"></a><span id="l29.21">     }</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -794,19 +796,20 @@ var MessageWindowController =</span>
<a href="#l29.23"></a><span id="l29.23">                gFolderDisplay.displayedFolder &amp;&amp;</span>
<a href="#l29.24"></a><span id="l29.24">                (gFolderDisplay.displayedFolder.canDeleteMessages ||</span>
<a href="#l29.25"></a><span id="l29.25">                 gFolderDisplay.view.isNewsFolder);</span>
<a href="#l29.26"></a><span id="l29.26">       case &quot;button_junk&quot;:</span>
<a href="#l29.27"></a><span id="l29.27">         UpdateJunkToolbarButton();</span>
<a href="#l29.28"></a><span id="l29.28">         // fall through</span>
<a href="#l29.29"></a><span id="l29.29">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l29.30"></a><span id="l29.30">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l29.32"></a><span id="l29.32">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">-        // can't do junk on news yet</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineminus">-        return (!gFolderDisplay.view.isNewsFolder);</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineplus">+        return gFolderDisplay.selectedMessage &amp;&amp;</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineplus">+               gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l29.37"></a><span id="l29.37">       case &quot;button_archive&quot;:</span>
<a href="#l29.38"></a><span id="l29.38">         var folder = gFolderDisplay.displayedFolder;</span>
<a href="#l29.39"></a><span id="l29.39">         return folder &amp;&amp;</span>
<a href="#l29.40"></a><span id="l29.40">           !folder.isSpecialFolder(Components.interfaces.nsMsgFolderFlags.Archive,</span>
<a href="#l29.41"></a><span id="l29.41">                                   true);</span>
<a href="#l29.42"></a><span id="l29.42">       case &quot;cmd_reply&quot;:</span>
<a href="#l29.43"></a><span id="l29.43">       case &quot;button_reply&quot;:</span>
<a href="#l29.44"></a><span id="l29.44">       case &quot;cmd_replyall&quot;:</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineat">@@ -832,16 +835,18 @@ var MessageWindowController =</span>
<a href="#l29.46"></a><span id="l29.46">       case &quot;cmd_reload&quot;:</span>
<a href="#l29.47"></a><span id="l29.47">       case &quot;cmd_find&quot;:</span>
<a href="#l29.48"></a><span id="l29.48">       case &quot;cmd_tag&quot;:</span>
<a href="#l29.49"></a><span id="l29.49">       case &quot;button_mark&quot;:</span>
<a href="#l29.50"></a><span id="l29.50">       case &quot;cmd_markAsRead&quot;:</span>
<a href="#l29.51"></a><span id="l29.51">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l29.52"></a><span id="l29.52">       case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l29.53"></a><span id="l29.53">       case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l29.56"></a><span id="l29.56">         return(true);</span>
<a href="#l29.57"></a><span id="l29.57">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l29.58"></a><span id="l29.58">       case &quot;button_file&quot;:</span>
<a href="#l29.59"></a><span id="l29.59">       case &quot;cmd_file&quot;:</span>
<a href="#l29.60"></a><span id="l29.60">         return ( gFolderDisplay.selectedMessage != null);</span>
<a href="#l29.61"></a><span id="l29.61">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l29.62"></a><span id="l29.62">         return true;</span>
<a href="#l29.63"></a><span id="l29.63">       case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineat">@@ -1027,16 +1032,22 @@ var MessageWindowController =</span>
<a href="#l29.65"></a><span id="l29.65">         gFolderDisplay.doCommand(nsMsgViewCommandType.markThreadRead);</span>
<a href="#l29.66"></a><span id="l29.66">         return;</span>
<a href="#l29.67"></a><span id="l29.67">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l29.68"></a><span id="l29.68">         MsgMarkAllRead();</span>
<a href="#l29.69"></a><span id="l29.69">         return;</span>
<a href="#l29.70"></a><span id="l29.70">       case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l29.71"></a><span id="l29.71">         MsgMarkReadByDate();</span>
<a href="#l29.72"></a><span id="l29.72">         return;</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+        MsgViewAllHeaders();</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineplus">+        return;</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineplus">+        MsgViewNormalHeaders();</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineplus">+        return;</span>
<a href="#l29.79"></a><span id="l29.79">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l29.80"></a><span id="l29.80">         MsgMarkAsFlagged();</span>
<a href="#l29.81"></a><span id="l29.81">         return;</span>
<a href="#l29.82"></a><span id="l29.82">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l29.83"></a><span id="l29.83">         JunkSelectedMessages(true);</span>
<a href="#l29.84"></a><span id="l29.84">         return;</span>
<a href="#l29.85"></a><span id="l29.85">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l29.86"></a><span id="l29.86">         JunkSelectedMessages(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -178,16 +178,22 @@ function createHeaderEntry(prefix, heade</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">   if (this.textNode)</span>
<a href="#l30.6"></a><span id="l30.6">     this.textNode.useShortView = useShortView;</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">   if (&quot;outputFunction&quot; in headerListInfo)</span>
<a href="#l30.9"></a><span id="l30.9">     this.outputFunction = headerListInfo.outputFunction;</span>
<a href="#l30.10"></a><span id="l30.10">   else</span>
<a href="#l30.11"></a><span id="l30.11">     this.outputFunction = updateHeaderValue;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  // stash this so that the &lt;mail-multi-emailheaderfield/&gt; binding can</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  // later attach it to any &lt;mail-emailaddress&gt; tags it creates for later</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+  // extraction and use by AddExtraAddressProcessing.</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+  this.enclosingBox.headerName = headerListInfo.name;</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+</span>
<a href="#l30.18"></a><span id="l30.18"> }</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20"> function initializeHeaderViewTables()</span>
<a href="#l30.21"></a><span id="l30.21"> {</span>
<a href="#l30.22"></a><span id="l30.22">   var prefBranch = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l30.23"></a><span id="l30.23">                              .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l30.24"></a><span id="l30.24">   // iterate over each header in our header list arrays and create header entries</span>
<a href="#l30.25"></a><span id="l30.25">   // for each one. These header entries are then stored in the appropriate header table</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineat">@@ -1018,20 +1024,31 @@ function AddExtraAddressProcessing(email</span>
<a href="#l30.27"></a><span id="l30.27">     documentNode.setAttribute(&quot;hascard&quot;, &quot;true&quot;);</span>
<a href="#l30.28"></a><span id="l30.28">     documentNode.setAttribute(&quot;tooltipstar&quot;,</span>
<a href="#l30.29"></a><span id="l30.29">       document.getElementById(&quot;editContactItem&quot;).label);</span>
<a href="#l30.30"></a><span id="l30.30">   }</span>
<a href="#l30.31"></a><span id="l30.31"> </span>
<a href="#l30.32"></a><span id="l30.32">   if (!gShowCondensedEmailAddresses)</span>
<a href="#l30.33"></a><span id="l30.33">     return;</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+  // If this address is one of the user's identities...</span>
<a href="#l30.36"></a><span id="l30.36">   var displayName;</span>
<a href="#l30.37"></a><span id="l30.37">   var identity = getBestIdentity(accountManager.allIdentities);</span>
<a href="#l30.38"></a><span id="l30.38">   if (emailAddress == identity.email) {</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineminus">-    displayName = gMessengerBundle.getString(&quot;headerFieldYou&quot;);</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+    // ...pick a localized version of the word &quot;You&quot; appropriate to this</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+    // specific header; fall back to the version used by the &quot;to&quot; header</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+    // if nothing else is available.</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+    let headerName = documentNode.getAttribute(&quot;headerName&quot;);</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+    try {</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+      displayName = gMessengerBundle.getString(&quot;header&quot; + headerName +</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineplus">+                                               &quot;FieldYou&quot;);</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineplus">+    } catch (ex) {</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineplus">+      displayName = gMessengerBundle.getString(&quot;headertoFieldYou&quot;);</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineplus">+    }</span>
<a href="#l30.51"></a><span id="l30.51">   }</span>
<a href="#l30.52"></a><span id="l30.52">   else</span>
<a href="#l30.53"></a><span id="l30.53">   {</span>
<a href="#l30.54"></a><span id="l30.54">     if (!cardDetails.card)</span>
<a href="#l30.55"></a><span id="l30.55">       return;</span>
<a href="#l30.56"></a><span id="l30.56">     displayName = cardDetails.card.displayName;</span>
<a href="#l30.57"></a><span id="l30.57">   }</span>
<a href="#l30.58"></a><span id="l30.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/base/content/tabmail.css</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/base/content/tabmail.css</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -31,21 +31,21 @@</span>
<a href="#l31.4"></a><span id="l31.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l31.5"></a><span id="l31.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.6"></a><span id="l31.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.7"></a><span id="l31.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.8"></a><span id="l31.8">  *</span>
<a href="#l31.9"></a><span id="l31.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11"> .tabmail-tabs {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tabs&quot;);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;);</span>
<a href="#l31.14"></a><span id="l31.14"> }</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16"> .tabmail-tab {</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tab&quot;);</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;);</span>
<a href="#l31.19"></a><span id="l31.19"> }</span>
<a href="#l31.20"></a><span id="l31.20"> </span>
<a href="#l31.21"></a><span id="l31.21"> .tabmail-arrowscrollbox {</span>
<a href="#l31.22"></a><span id="l31.22">   -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-arrowscrollbox&quot;);</span>
<a href="#l31.23"></a><span id="l31.23"> }</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25"> .tabs-alltabs-popup {</span>
<a href="#l31.26"></a><span id="l31.26">   -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-alltabs-popup&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l32.4"></a><span id="l32.4">   - The Initial Developer of the Original Code is</span>
<a href="#l32.5"></a><span id="l32.5">   -   David Bienvenu &lt;bienvenu@nventure.com&gt;.</span>
<a href="#l32.6"></a><span id="l32.6">   - Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l32.7"></a><span id="l32.7">   - the Initial Developer. All Rights Reserved.</span>
<a href="#l32.8"></a><span id="l32.8">   -</span>
<a href="#l32.9"></a><span id="l32.9">   - Contributor(s):</span>
<a href="#l32.10"></a><span id="l32.10">   -  Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l32.11"></a><span id="l32.11">   -  Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+  -  Magnus Melin &lt;mkmelin+mozilla@iki.fi&gt;</span>
<a href="#l32.13"></a><span id="l32.13">   -</span>
<a href="#l32.14"></a><span id="l32.14">   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l32.15"></a><span id="l32.15">   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l32.16"></a><span id="l32.16">   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l32.17"></a><span id="l32.17">   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l32.18"></a><span id="l32.18">   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l32.19"></a><span id="l32.19">   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l32.20"></a><span id="l32.20">   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineat">@@ -1057,26 +1058,31 @@</span>
<a href="#l32.22"></a><span id="l32.22">                                   .getAttribute(&quot;titlemodifier&quot;);</span>
<a href="#l32.23"></a><span id="l32.23"> </span>
<a href="#l32.24"></a><span id="l32.24">             document.title = docTitle;</span>
<a href="#l32.25"></a><span id="l32.25">           ]]&gt;</span>
<a href="#l32.26"></a><span id="l32.26">         &lt;/body&gt;</span>
<a href="#l32.27"></a><span id="l32.27">       &lt;/method&gt;</span>
<a href="#l32.28"></a><span id="l32.28">     &lt;/implementation&gt;</span>
<a href="#l32.29"></a><span id="l32.29">   &lt;/binding&gt;</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-  </span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">- &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+  &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l32.34"></a><span id="l32.34">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tab&quot;&gt;</span>
<a href="#l32.35"></a><span id="l32.35">     &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l32.36"></a><span id="l32.36">              closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-middle box-inherit&quot; xbl:inherits=&quot;align,dir,pack,orient,selected&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-        &lt;xul:image class=&quot;tab-icon&quot; xbl:inherits=&quot;validate,src=image&quot;/&gt;</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-        &lt;xul:label class=&quot;tab-text&quot; xbl:inherits=&quot;value=label,accesskey,crop,disabled&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-image-middle box-inherit&quot; align=&quot;center&quot;</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+                xbl:inherits=&quot;dir,pack,orient,selected&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+        &lt;xul:image class=&quot;tab-icon-image&quot; xbl:inherits=&quot;validate,src=image&quot;/&gt;</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+        &lt;xul:label class=&quot;tab-text&quot;</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+                  xbl:inherits=&quot;value=label,accesskey,crop,disabled&quot;</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+                  crop=&quot;right&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l32.47"></a><span id="l32.47">       &lt;/xul:hbox&gt;</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; tabindex=&quot;-1&quot; class=&quot;tab-close-button&quot;/&gt;</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l32.51"></a><span id="l32.51">     &lt;/content&gt;</span>
<a href="#l32.52"></a><span id="l32.52"> </span>
<a href="#l32.53"></a><span id="l32.53">     &lt;implementation&gt;</span>
<a href="#l32.54"></a><span id="l32.54">       &lt;field name=&quot;mOverCloseButton&quot;&gt;false&lt;/field&gt;</span>
<a href="#l32.55"></a><span id="l32.55">       &lt;field name=&quot;mCorrespondingMenuitem&quot;&gt;null&lt;/field&gt;</span>
<a href="#l32.56"></a><span id="l32.56">     &lt;/implementation&gt;</span>
<a href="#l32.57"></a><span id="l32.57"> </span>
<a href="#l32.58"></a><span id="l32.58">     &lt;handlers&gt;</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineat">@@ -1180,37 +1186,59 @@</span>
<a href="#l32.60"></a><span id="l32.60">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l32.61"></a><span id="l32.61"> </span>
<a href="#l32.62"></a><span id="l32.62">     &lt;/handlers&gt;</span>
<a href="#l32.63"></a><span id="l32.63">   &lt;/binding&gt;</span>
<a href="#l32.64"></a><span id="l32.64"> </span>
<a href="#l32.65"></a><span id="l32.65">   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l32.66"></a><span id="l32.66">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tabs&quot;&gt;</span>
<a href="#l32.67"></a><span id="l32.67">     &lt;content&gt;</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineminus">-      &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; class=&quot;tabmail-arrowscrollbox&quot; flex=&quot;1&quot;</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-                          xbl:inherits=&quot;smoothscroll&quot; orient=&quot;horizontal&quot; style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineminus">-        &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineminus">-      &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineminus">-      &lt;children/&gt;</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineminus">-      &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; class=&quot;tabs-alltabs-stack&quot;&gt;</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l32.76"></a><span id="l32.76" class="difflineminus">-                  anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l32.77"></a><span id="l32.77" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineminus">-                           anonid=&quot;alltabs-button&quot;</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineminus">-                           tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineminus">-          &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineminus">-                         anonid=&quot;alltabs-popup&quot; </span>
<a href="#l32.82"></a><span id="l32.82" class="difflineminus">-                         position=&quot;after_end&quot;/&gt;</span>
<a href="#l32.83"></a><span id="l32.83" class="difflineminus">-        &lt;/xul:toolbarbutton&gt;</span>
<a href="#l32.84"></a><span id="l32.84" class="difflineplus">+      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l32.85"></a><span id="l32.85" class="difflineplus">+        &lt;xul:vbox&gt;</span>
<a href="#l32.86"></a><span id="l32.86" class="difflineplus">+          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l32.87"></a><span id="l32.87" class="difflineplus">+          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineplus">+        &lt;xul:vbox&gt;</span>
<a href="#l32.90"></a><span id="l32.90" class="difflineplus">+          &lt;xul:hbox&gt;</span>
<a href="#l32.91"></a><span id="l32.91" class="difflineplus">+            &lt;xul:stack&gt;</span>
<a href="#l32.92"></a><span id="l32.92" class="difflineplus">+              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l32.93"></a><span id="l32.93" class="difflineplus">+            &lt;/xul:stack&gt;</span>
<a href="#l32.94"></a><span id="l32.94" class="difflineplus">+            &lt;xul:arrowscrollbox class=&quot;tabmail-arrowscrollbox&quot;</span>
<a href="#l32.95"></a><span id="l32.95" class="difflineplus">+                                anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l32.96"></a><span id="l32.96" class="difflineplus">+                                orient=&quot;horizontal&quot;</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineplus">+                                flex=&quot;1&quot;</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineplus">+                                style=&quot;min-width: 1px;&quot;</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineplus">+                                chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineplus">+              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineplus">+            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l32.102"></a><span id="l32.102" class="difflineplus">+            &lt;children/&gt;</span>
<a href="#l32.103"></a><span id="l32.103" class="difflineplus">+            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l32.104"></a><span id="l32.104" class="difflineplus">+              &lt;xul:hbox class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l32.105"></a><span id="l32.105" class="difflineplus">+              &lt;xul:hbox class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineplus">+                        anonid=&quot;alltabs-box-animate&quot;</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineplus">+                        flex=&quot;1&quot;/&gt;</span>
<a href="#l32.108"></a><span id="l32.108" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot;</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineplus">+                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineplus">+                                 type=&quot;menu&quot;</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineplus">+                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l32.112"></a><span id="l32.112" class="difflineplus">+                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l32.113"></a><span id="l32.113" class="difflineplus">+                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l32.114"></a><span id="l32.114" class="difflineplus">+              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineplus">+            &lt;/xul:stack&gt;</span>
<a href="#l32.116"></a><span id="l32.116" class="difflineplus">+            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot;</span>
<a href="#l32.117"></a><span id="l32.117" class="difflineplus">+                      anonid=&quot;tabstrip-closebutton&quot;</span>
<a href="#l32.118"></a><span id="l32.118" class="difflineplus">+                      align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l32.119"></a><span id="l32.119" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l32.120"></a><span id="l32.120" class="difflineplus">+            &lt;/xul:hbox&gt;</span>
<a href="#l32.121"></a><span id="l32.121" class="difflineplus">+          &lt;/xul:hbox&gt;</span>
<a href="#l32.122"></a><span id="l32.122" class="difflineplus">+          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l32.123"></a><span id="l32.123" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l32.124"></a><span id="l32.124">       &lt;/xul:stack&gt;</span>
<a href="#l32.125"></a><span id="l32.125" class="difflineminus">-      &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l32.126"></a><span id="l32.126" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l32.127"></a><span id="l32.127" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l32.128"></a><span id="l32.128">     &lt;/content&gt;</span>
<a href="#l32.129"></a><span id="l32.129" class="difflineplus">+</span>
<a href="#l32.130"></a><span id="l32.130">     &lt;implementation implements=&quot;nsITimerCallback, nsIDOMEventListener&quot;&gt;</span>
<a href="#l32.131"></a><span id="l32.131">       &lt;constructor&gt;</span>
<a href="#l32.132"></a><span id="l32.132">         &lt;![CDATA[</span>
<a href="#l32.133"></a><span id="l32.133">           var pb2 =</span>
<a href="#l32.134"></a><span id="l32.134">               Components.classes['@mozilla.org/preferences-service;1'].</span>
<a href="#l32.135"></a><span id="l32.135">               getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l32.136"></a><span id="l32.136"> </span>
<a href="#l32.137"></a><span id="l32.137">           try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -88,17 +88,17 @@ const kVcardFields =</span>
<a href="#l33.4"></a><span id="l33.4">           // Other &gt; Notes</span>
<a href="#l33.5"></a><span id="l33.5">          [&quot;Notes&quot;, &quot;Notes&quot;]];</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7"> const kDefaultYear = 2000;</span>
<a href="#l33.8"></a><span id="l33.8"> var gEditCard;</span>
<a href="#l33.9"></a><span id="l33.9"> var gOnSaveListeners = new Array();</span>
<a href="#l33.10"></a><span id="l33.10"> var gOkCallback = null;</span>
<a href="#l33.11"></a><span id="l33.11"> var gHideABPicker = false;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-var originalPhotoURI = &quot;&quot;;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+var gOriginalPhotoURI = &quot;&quot;;</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15"> function OnLoadNewCard()</span>
<a href="#l33.16"></a><span id="l33.16"> {</span>
<a href="#l33.17"></a><span id="l33.17">   InitEditCard();</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19">   gEditCard.card =</span>
<a href="#l33.20"></a><span id="l33.20">     ((&quot;arguments&quot; in window) &amp;&amp; (window.arguments.length &gt; 0) &amp;&amp;</span>
<a href="#l33.21"></a><span id="l33.21">      (window.arguments[0] instanceof Components.interfaces.nsIAbCard))</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -274,34 +274,33 @@ function OnLoadEditCard()</span>
<a href="#l33.23"></a><span id="l33.23">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0])</span>
<a href="#l33.24"></a><span id="l33.24">   {</span>
<a href="#l33.25"></a><span id="l33.25">     if (&quot;abURI&quot; in window.arguments[0]) {</span>
<a href="#l33.26"></a><span id="l33.26">       var abURI = window.arguments[0].abURI;</span>
<a href="#l33.27"></a><span id="l33.27">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l33.28"></a><span id="l33.28"> </span>
<a href="#l33.29"></a><span id="l33.29">       if (directory.readOnly) </span>
<a href="#l33.30"></a><span id="l33.30">       {</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-        // Disable the photo field and buttons</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineminus">-        document.getElementById(&quot;generic&quot;).disabled          = true;</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineminus">-        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineminus">-        document.getElementById(&quot;file&quot;).disabled             = true;</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineminus">-        document.getElementById(&quot;web&quot;).disabled              = true;</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).readOnly         = true;</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineminus">-        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineminus">-        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l33.40"></a><span id="l33.40">         // Set all the editable vcard fields to read only</span>
<a href="#l33.41"></a><span id="l33.41">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l33.42"></a><span id="l33.42">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l33.43"></a><span id="l33.43"> </span>
<a href="#l33.44"></a><span id="l33.44">         // the birthday fields</span>
<a href="#l33.45"></a><span id="l33.45">         document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l33.46"></a><span id="l33.46">         document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l33.47"></a><span id="l33.47">         document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l33.48"></a><span id="l33.48"> </span>
<a href="#l33.49"></a><span id="l33.49" class="difflineplus">+        // the photo field and buttons</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+        document.getElementById(&quot;PhotoType&quot;).disabled        = true;</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).disabled         = true;</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineplus">+        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineplus">+</span>
<a href="#l33.57"></a><span id="l33.57">         // And the phonetic fields</span>
<a href="#l33.58"></a><span id="l33.58">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l33.59"></a><span id="l33.59">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l33.60"></a><span id="l33.60"> </span>
<a href="#l33.61"></a><span id="l33.61">         // Also disable the mail format popup and allow remote content items.</span>
<a href="#l33.62"></a><span id="l33.62">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l33.63"></a><span id="l33.63">         document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l33.64"></a><span id="l33.64"> </span>
<a href="#l33.65"></a><span id="l33.65" class="difflineat">@@ -482,44 +481,42 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l33.66"></a><span id="l33.66">     doc.getElementById(&quot;PhoneticFirstName&quot;).value = cardproperty.getProperty(&quot;PhoneticFirstName&quot;, &quot;&quot;);</span>
<a href="#l33.67"></a><span id="l33.67">     doc.getElementById(&quot;PhoneticLastName&quot;).value = cardproperty.getProperty(&quot;PhoneticLastName&quot;, &quot;&quot;);</span>
<a href="#l33.68"></a><span id="l33.68">   }</span>
<a href="#l33.69"></a><span id="l33.69">   catch (ex) {}</span>
<a href="#l33.70"></a><span id="l33.70"> </span>
<a href="#l33.71"></a><span id="l33.71">   // Store the original photo URI and update the photo</span>
<a href="#l33.72"></a><span id="l33.72">   // Select the type if there is a valid value stored for that type, otherwise</span>
<a href="#l33.73"></a><span id="l33.73">   // select the generic photo</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineminus">-  var type = cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;);</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineminus">-  document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l33.76"></a><span id="l33.76" class="difflineminus">-    document.getElementById(type ? type : &quot;generic&quot;);</span>
<a href="#l33.77"></a><span id="l33.77" class="difflineminus">-  if (type == &quot;file&quot;) {</span>
<a href="#l33.78"></a><span id="l33.78" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineminus">-    var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineminus">-                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l33.81"></a><span id="l33.81" class="difflineminus">-                         .newURI(originalPhotoURI, null, null)</span>
<a href="#l33.82"></a><span id="l33.82" class="difflineminus">-                         .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l33.83"></a><span id="l33.83" class="difflineminus">-                         .file;</span>
<a href="#l33.84"></a><span id="l33.84" class="difflineminus">-    if (file) {</span>
<a href="#l33.85"></a><span id="l33.85" class="difflineminus">-      document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l33.86"></a><span id="l33.86" class="difflineminus">-      updatePhoto(&quot;file&quot;);</span>
<a href="#l33.87"></a><span id="l33.87" class="difflineminus">-    }</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineminus">-    else</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineplus">+  gOriginalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l33.90"></a><span id="l33.90" class="difflineplus">+  switch (cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;)) {</span>
<a href="#l33.91"></a><span id="l33.91" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l33.92"></a><span id="l33.92" class="difflineplus">+      try {</span>
<a href="#l33.93"></a><span id="l33.93" class="difflineplus">+        var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l33.94"></a><span id="l33.94" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l33.95"></a><span id="l33.95" class="difflineplus">+                             .newURI(gOriginalPhotoURI, null, null)</span>
<a href="#l33.96"></a><span id="l33.96" class="difflineplus">+                             .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l33.97"></a><span id="l33.97" class="difflineplus">+                             .file;</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineplus">+      } catch (e) {}</span>
<a href="#l33.99"></a><span id="l33.99" class="difflineplus">+      if (file) {</span>
<a href="#l33.100"></a><span id="l33.100" class="difflineplus">+        document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l33.101"></a><span id="l33.101" class="difflineplus">+        updatePhoto(&quot;file&quot;);</span>
<a href="#l33.102"></a><span id="l33.102" class="difflineplus">+      }</span>
<a href="#l33.103"></a><span id="l33.103" class="difflineplus">+      else</span>
<a href="#l33.104"></a><span id="l33.104" class="difflineplus">+        updatePhoto(&quot;generic&quot;);</span>
<a href="#l33.105"></a><span id="l33.105" class="difflineplus">+      break;</span>
<a href="#l33.106"></a><span id="l33.106" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineplus">+      document.getElementById(&quot;PhotoURI&quot;).value = gOriginalPhotoURI;</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineplus">+      updatePhoto(&quot;web&quot;);</span>
<a href="#l33.109"></a><span id="l33.109" class="difflineplus">+      break;</span>
<a href="#l33.110"></a><span id="l33.110" class="difflineplus">+    default:</span>
<a href="#l33.111"></a><span id="l33.111" class="difflineplus">+      if (gOriginalPhotoURI)</span>
<a href="#l33.112"></a><span id="l33.112" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).value = gOriginalPhotoURI;</span>
<a href="#l33.113"></a><span id="l33.113">       updatePhoto(&quot;generic&quot;);</span>
<a href="#l33.114"></a><span id="l33.114">   }</span>
<a href="#l33.115"></a><span id="l33.115" class="difflineminus">-  else if (type == &quot;web&quot;) {</span>
<a href="#l33.116"></a><span id="l33.116" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineminus">-    document.getElementById(&quot;PhotoURI&quot;).value = originalPhotoURI;</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineminus">-    updatePhoto(&quot;web&quot;);</span>
<a href="#l33.119"></a><span id="l33.119" class="difflineminus">-  }</span>
<a href="#l33.120"></a><span id="l33.120" class="difflineminus">-  else {</span>
<a href="#l33.121"></a><span id="l33.121" class="difflineminus">-    originalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l33.122"></a><span id="l33.122" class="difflineminus">-    if (originalPhotoURI)</span>
<a href="#l33.123"></a><span id="l33.123" class="difflineminus">-      document.getElementById(&quot;GenericPhotoList&quot;).value = originalPhotoURI;</span>
<a href="#l33.124"></a><span id="l33.124" class="difflineminus">-    updatePhoto(&quot;generic&quot;);</span>
<a href="#l33.125"></a><span id="l33.125" class="difflineminus">-  }</span>
<a href="#l33.126"></a><span id="l33.126"> }</span>
<a href="#l33.127"></a><span id="l33.127"> </span>
<a href="#l33.128"></a><span id="l33.128"> // when the ab card dialog is being loaded to show a vCard,</span>
<a href="#l33.129"></a><span id="l33.129"> // hide the fields which aren't supported</span>
<a href="#l33.130"></a><span id="l33.130"> // by vCard so the user does not try to edit them.</span>
<a href="#l33.131"></a><span id="l33.131"> function HideNonVcardFields()</span>
<a href="#l33.132"></a><span id="l33.132"> {</span>
<a href="#l33.133"></a><span id="l33.133">   document.getElementById(&quot;homeTabButton&quot;).hidden = true;</span>
<a href="#l33.134"></a><span id="l33.134" class="difflineat">@@ -567,41 +564,46 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l33.135"></a><span id="l33.135"> </span>
<a href="#l33.136"></a><span id="l33.136">   // set phonetic fields if exist</span>
<a href="#l33.137"></a><span id="l33.137">   try {</span>
<a href="#l33.138"></a><span id="l33.138">     cardproperty.setProperty(&quot;PhoneticFirstName&quot;, doc.getElementById(&quot;PhoneticFirstName&quot;).value);</span>
<a href="#l33.139"></a><span id="l33.139">     cardproperty.setProperty(&quot;PhoneticLastName&quot;, doc.getElementById(&quot;PhoneticLastName&quot;).value);</span>
<a href="#l33.140"></a><span id="l33.140">   }</span>
<a href="#l33.141"></a><span id="l33.141">   catch (ex) {}</span>
<a href="#l33.142"></a><span id="l33.142"> </span>
<a href="#l33.143"></a><span id="l33.143" class="difflineminus">-  var type = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l33.144"></a><span id="l33.144" class="difflineminus">-  var photoURI = originalPhotoURI;</span>
<a href="#l33.145"></a><span id="l33.145" class="difflineplus">+  var type = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l33.146"></a><span id="l33.146" class="difflineplus">+  var photoURI = gOriginalPhotoURI;</span>
<a href="#l33.147"></a><span id="l33.147">   if (type == &quot;file&quot; &amp;&amp; document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l33.148"></a><span id="l33.148" class="difflineminus">-    photoURI = &quot;file://&quot; + document.getElementById(&quot;PhotoFile&quot;).file.path;</span>
<a href="#l33.149"></a><span id="l33.149" class="difflineplus">+    photoURI = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l33.150"></a><span id="l33.150" class="difflineplus">+                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l33.151"></a><span id="l33.151" class="difflineplus">+                         .newFileURI(document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l33.152"></a><span id="l33.152" class="difflineplus">+                         .spec;</span>
<a href="#l33.153"></a><span id="l33.153">   else if (type == &quot;web&quot; &amp;&amp; document.getElementById(&quot;PhotoURI&quot;).value)</span>
<a href="#l33.154"></a><span id="l33.154">     photoURI = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l33.155"></a><span id="l33.155">   else {</span>
<a href="#l33.156"></a><span id="l33.156">     type = &quot;generic&quot;;</span>
<a href="#l33.157"></a><span id="l33.157">     photoURI = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l33.158"></a><span id="l33.158">   }</span>
<a href="#l33.159"></a><span id="l33.159" class="difflineminus">-  if (photoURI != originalPhotoURI) {</span>
<a href="#l33.160"></a><span id="l33.160" class="difflineplus">+  cardproperty.setProperty(&quot;PhotoType&quot;, type);</span>
<a href="#l33.161"></a><span id="l33.161" class="difflineplus">+  if (photoURI != gOriginalPhotoURI) {</span>
<a href="#l33.162"></a><span id="l33.162">     // Store the original URI</span>
<a href="#l33.163"></a><span id="l33.163">     cardproperty.setProperty(&quot;PhotoURI&quot;, photoURI);</span>
<a href="#l33.164"></a><span id="l33.164" class="difflineminus">-    // Remove the original, if any</span>
<a href="#l33.165"></a><span id="l33.165" class="difflineminus">-    removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l33.166"></a><span id="l33.166">     // Save the photo if it isn't one of the generic photos</span>
<a href="#l33.167"></a><span id="l33.167" class="difflineminus">-    if (type != &quot;generic&quot;) {</span>
<a href="#l33.168"></a><span id="l33.168" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;file&quot;);</span>
<a href="#l33.169"></a><span id="l33.169" class="difflineplus">+    if (type == &quot;generic&quot;) {</span>
<a href="#l33.170"></a><span id="l33.170" class="difflineplus">+      // Remove the original, if any</span>
<a href="#l33.171"></a><span id="l33.171" class="difflineplus">+      removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l33.172"></a><span id="l33.172" class="difflineplus">+    } else {</span>
<a href="#l33.173"></a><span id="l33.173">       // Save the new file and store its URI as PhotoName </span>
<a href="#l33.174"></a><span id="l33.174">       var file = savePhoto(photoURI);</span>
<a href="#l33.175"></a><span id="l33.175" class="difflineminus">-      if (file)</span>
<a href="#l33.176"></a><span id="l33.176" class="difflineplus">+      if (file) {</span>
<a href="#l33.177"></a><span id="l33.177" class="difflineplus">+        // Remove the original, if any</span>
<a href="#l33.178"></a><span id="l33.178" class="difflineplus">+        removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l33.179"></a><span id="l33.179">         cardproperty.setProperty(&quot;PhotoName&quot;, file.leafName);</span>
<a href="#l33.180"></a><span id="l33.180" class="difflineplus">+      }</span>
<a href="#l33.181"></a><span id="l33.181">     }</span>
<a href="#l33.182"></a><span id="l33.182" class="difflineminus">-    else</span>
<a href="#l33.183"></a><span id="l33.183" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;generic&quot;);</span>
<a href="#l33.184"></a><span id="l33.184">   }</span>
<a href="#l33.185"></a><span id="l33.185">   return true;</span>
<a href="#l33.186"></a><span id="l33.186"> }</span>
<a href="#l33.187"></a><span id="l33.187"> </span>
<a href="#l33.188"></a><span id="l33.188"> function CleanUpWebPage(webPage)</span>
<a href="#l33.189"></a><span id="l33.189"> {</span>
<a href="#l33.190"></a><span id="l33.190">   // no :// yet so we should add something</span>
<a href="#l33.191"></a><span id="l33.191">   if ( webPage.length &amp;&amp; webPage.search(&quot;://&quot;) == -1 )</span>
<a href="#l33.192"></a><span id="l33.192" class="difflineat">@@ -900,35 +902,38 @@ function modifyDatepicker(aDatepicker) {</span>
<a href="#l33.193"></a><span id="l33.193">  * Updates the photo by setting the src attribute of the photo element.</span>
<a href="#l33.194"></a><span id="l33.194">  *</span>
<a href="#l33.195"></a><span id="l33.195">  * @param aType Optional. The type of photo (web, file, or generic).</span>
<a href="#l33.196"></a><span id="l33.196">  *              If supplied the corresponding radio button will be selected.</span>
<a href="#l33.197"></a><span id="l33.197">  *              If not supplied the type will be determined by the currently</span>
<a href="#l33.198"></a><span id="l33.198">  *              selected type.</span>
<a href="#l33.199"></a><span id="l33.199">  */</span>
<a href="#l33.200"></a><span id="l33.200"> function updatePhoto(aType) {</span>
<a href="#l33.201"></a><span id="l33.201" class="difflineminus">-  if (aType) {</span>
<a href="#l33.202"></a><span id="l33.202" class="difflineplus">+  if (aType)</span>
<a href="#l33.203"></a><span id="l33.203">     // Select the type's radio button</span>
<a href="#l33.204"></a><span id="l33.204" class="difflineminus">-    document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l33.205"></a><span id="l33.205" class="difflineminus">-      document.getElementById(aType);</span>
<a href="#l33.206"></a><span id="l33.206" class="difflineminus">-  }</span>
<a href="#l33.207"></a><span id="l33.207" class="difflineplus">+    document.getElementById(&quot;PhotoType&quot;).value = aType;</span>
<a href="#l33.208"></a><span id="l33.208">   else</span>
<a href="#l33.209"></a><span id="l33.209" class="difflineminus">-    aType = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l33.210"></a><span id="l33.210" class="difflineplus">+    aType = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l33.211"></a><span id="l33.211"> </span>
<a href="#l33.212"></a><span id="l33.212">   var value;</span>
<a href="#l33.213"></a><span id="l33.213" class="difflineminus">-  if (aType == &quot;file&quot;) {</span>
<a href="#l33.214"></a><span id="l33.214" class="difflineminus">-    var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l33.215"></a><span id="l33.215" class="difflineminus">-    value = file ? &quot;file://&quot; + file.path : &quot;&quot;;</span>
<a href="#l33.216"></a><span id="l33.216" class="difflineplus">+  switch (aType) {</span>
<a href="#l33.217"></a><span id="l33.217" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l33.218"></a><span id="l33.218" class="difflineplus">+      var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l33.219"></a><span id="l33.219" class="difflineplus">+      value = file ? Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l33.220"></a><span id="l33.220" class="difflineplus">+                               .getService(Components.interfaces.nsIIOService)</span>
<a href="#l33.221"></a><span id="l33.221" class="difflineplus">+                               .newFileURI(file)</span>
<a href="#l33.222"></a><span id="l33.222" class="difflineplus">+                               .spec : &quot;&quot;;</span>
<a href="#l33.223"></a><span id="l33.223" class="difflineplus">+      break;</span>
<a href="#l33.224"></a><span id="l33.224" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l33.225"></a><span id="l33.225" class="difflineplus">+      value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l33.226"></a><span id="l33.226" class="difflineplus">+      break;</span>
<a href="#l33.227"></a><span id="l33.227" class="difflineplus">+    default:</span>
<a href="#l33.228"></a><span id="l33.228" class="difflineplus">+      value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l33.229"></a><span id="l33.229">   }</span>
<a href="#l33.230"></a><span id="l33.230" class="difflineminus">-  else if (aType == &quot;web&quot;)</span>
<a href="#l33.231"></a><span id="l33.231" class="difflineminus">-    value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l33.232"></a><span id="l33.232" class="difflineminus">-  else</span>
<a href="#l33.233"></a><span id="l33.233" class="difflineminus">-    value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l33.234"></a><span id="l33.234" class="difflineminus">-  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value ? value</span>
<a href="#l33.235"></a><span id="l33.235" class="difflineminus">-                                                             : defaultPhotoURI);</span>
<a href="#l33.236"></a><span id="l33.236" class="difflineplus">+  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value || defaultPhotoURI);</span>
<a href="#l33.237"></a><span id="l33.237"> }</span>
<a href="#l33.238"></a><span id="l33.238"> </span>
<a href="#l33.239"></a><span id="l33.239"> /**</span>
<a href="#l33.240"></a><span id="l33.240">  * Removes the photo file at the given path, if present.</span>
<a href="#l33.241"></a><span id="l33.241">  *</span>
<a href="#l33.242"></a><span id="l33.242">  * @param aName The name of the photo to remove from the Photos directory.</span>
<a href="#l33.243"></a><span id="l33.243">  *</span>
<a href="#l33.244"></a><span id="l33.244">  * @return true if the file was deleted.</span>
<a href="#l33.245"></a><span id="l33.245" class="difflineat">@@ -936,27 +941,20 @@ function updatePhoto(aType) {</span>
<a href="#l33.246"></a><span id="l33.246"> function removePhoto(aName) {</span>
<a href="#l33.247"></a><span id="l33.247">   if (!aName)</span>
<a href="#l33.248"></a><span id="l33.248">     return false;</span>
<a href="#l33.249"></a><span id="l33.249">   // Get the directory with all the photos</span>
<a href="#l33.250"></a><span id="l33.250">   var file = getPhotosDir();</span>
<a href="#l33.251"></a><span id="l33.251">   // Get the photo (throws an exception for invalid names)</span>
<a href="#l33.252"></a><span id="l33.252">   try {</span>
<a href="#l33.253"></a><span id="l33.253">     file.append(aName);</span>
<a href="#l33.254"></a><span id="l33.254" class="difflineminus">-  }</span>
<a href="#l33.255"></a><span id="l33.255" class="difflineminus">-  catch (e) {</span>
<a href="#l33.256"></a><span id="l33.256" class="difflineminus">-    return false;</span>
<a href="#l33.257"></a><span id="l33.257" class="difflineplus">+    file.remove(false);</span>
<a href="#l33.258"></a><span id="l33.258" class="difflineplus">+    return true;</span>
<a href="#l33.259"></a><span id="l33.259">   }</span>
<a href="#l33.260"></a><span id="l33.260" class="difflineminus">-  if (file.exists()) {</span>
<a href="#l33.261"></a><span id="l33.261" class="difflineminus">-    try {</span>
<a href="#l33.262"></a><span id="l33.262" class="difflineminus">-      file.remove(false);</span>
<a href="#l33.263"></a><span id="l33.263" class="difflineminus">-      return true;</span>
<a href="#l33.264"></a><span id="l33.264" class="difflineminus">-    }</span>
<a href="#l33.265"></a><span id="l33.265" class="difflineminus">-    catch (e) {}</span>
<a href="#l33.266"></a><span id="l33.266" class="difflineminus">-  }</span>
<a href="#l33.267"></a><span id="l33.267" class="difflineplus">+  catch (e) {}</span>
<a href="#l33.268"></a><span id="l33.268">   return false;</span>
<a href="#l33.269"></a><span id="l33.269"> }</span>
<a href="#l33.270"></a><span id="l33.270"> </span>
<a href="#l33.271"></a><span id="l33.271"> /**</span>
<a href="#l33.272"></a><span id="l33.272">  * Opens a file picker with image filters to look for a contact photo.</span>
<a href="#l33.273"></a><span id="l33.273">  * If the user selects a file and clicks OK then the PhotoURI textbox is set</span>
<a href="#l33.274"></a><span id="l33.274">  * with a file URI pointing to that file and updatePhoto is called.</span>
<a href="#l33.275"></a><span id="l33.275">  *</span>
<a href="#l33.276"></a><span id="l33.276" class="difflineat">@@ -964,18 +962,18 @@ function removePhoto(aName) {</span>
<a href="#l33.277"></a><span id="l33.277">  */</span>
<a href="#l33.278"></a><span id="l33.278"> function browsePhoto() {</span>
<a href="#l33.279"></a><span id="l33.279">   var nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l33.280"></a><span id="l33.280">   var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l33.281"></a><span id="l33.281">                      .createInstance(nsIFilePicker);</span>
<a href="#l33.282"></a><span id="l33.282">   fp.init(window, gAddressBookBundle.getString(&quot;browsePhoto&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l33.283"></a><span id="l33.283">   </span>
<a href="#l33.284"></a><span id="l33.284">   // Add All Files &amp; Image Files filters and select the latter</span>
<a href="#l33.285"></a><span id="l33.285" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterAll | nsIFilePicker.filterImages);</span>
<a href="#l33.286"></a><span id="l33.286" class="difflineminus">-  fp.filterIndex = 1;</span>
<a href="#l33.287"></a><span id="l33.287" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l33.288"></a><span id="l33.288" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l33.289"></a><span id="l33.289"> </span>
<a href="#l33.290"></a><span id="l33.290">   if (fp.show() == nsIFilePicker.returnOK) {</span>
<a href="#l33.291"></a><span id="l33.291">     document.getElementById(&quot;PhotoFile&quot;).file = fp.file;</span>
<a href="#l33.292"></a><span id="l33.292">     updatePhoto(&quot;file&quot;);</span>
<a href="#l33.293"></a><span id="l33.293">     return true;</span>
<a href="#l33.294"></a><span id="l33.294">   }</span>
<a href="#l33.295"></a><span id="l33.295">   return false;</span>
<a href="#l33.296"></a><span id="l33.296"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/components/addrbook/content/abCommon.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCommon.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1019,68 +1019,56 @@ function savePhoto(aUri) {</span>
<a href="#l34.4"></a><span id="l34.4"> </span>
<a href="#l34.5"></a><span id="l34.5">   // Create a channel from the URI and open it as an input stream</span>
<a href="#l34.6"></a><span id="l34.6">   var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l34.7"></a><span id="l34.7">                       .getService(Components.interfaces.nsIIOService);</span>
<a href="#l34.8"></a><span id="l34.8">   var channel = ios.newChannelFromURI(ios.newURI(aUri, null, null));</span>
<a href="#l34.9"></a><span id="l34.9">   var istream = channel.open();</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11">   // Get the photo file</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  file.append(makePhotoFilename(file.path, findPhotoExt(aUri, channel)));</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  file = makePhotoFile(file, findPhotoExt(channel));</span>
<a href="#l34.14"></a><span id="l34.14"> </span>
<a href="#l34.15"></a><span id="l34.15">   return saveStreamToFile(istream, file);</span>
<a href="#l34.16"></a><span id="l34.16"> }</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18"> /**</span>
<a href="#l34.19"></a><span id="l34.19">  * Finds the file extension of the photo identified by the URI, if possible.</span>
<a href="#l34.20"></a><span id="l34.20">  * This function can be overridden (with a copy of the original) for URIs that</span>
<a href="#l34.21"></a><span id="l34.21">  * do not identify the extension or when the Content-Type response header is</span>
<a href="#l34.22"></a><span id="l34.22">  * either not set or isn't 'image/png', 'image/jpeg', or 'image/gif'.</span>
<a href="#l34.23"></a><span id="l34.23">  * The original function can be called if the URI does not match.</span>
<a href="#l34.24"></a><span id="l34.24">  *</span>
<a href="#l34.25"></a><span id="l34.25">  * @param aUri The URI of the photo.</span>
<a href="#l34.26"></a><span id="l34.26">  * @param aChannel The opened channel for the URI.</span>
<a href="#l34.27"></a><span id="l34.27">  *</span>
<a href="#l34.28"></a><span id="l34.28">  * @return The extension of the file, if any, including the period.</span>
<a href="#l34.29"></a><span id="l34.29">  */</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-function findPhotoExt(aUri, aChannel) {</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-  if (aChannel) {</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineminus">-    try {</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineminus">-      aChannel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineminus">-      var header = aChannel.getResponseHeader(&quot;Content-Type&quot;);</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-      var type   = header ? header.split(&quot;;&quot;)[0] : &quot;&quot;;</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-      switch (type.toLowerCase()) {</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-        case &quot;image/png&quot;:</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-          return &quot;.png&quot;;</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineminus">-        case &quot;image/jpeg&quot;:</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineminus">-          return &quot;.jpg&quot;;</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineminus">-        case &quot;image/gif&quot;:</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineminus">-          return &quot;.gif&quot;;</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineminus">-      }</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineminus">-    } catch (e) {}</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-  }</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineminus">-  var index = aUri ? aUri.lastIndexOf(&quot;.&quot;) : -1;</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-  if (index == -1)</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-   return aUri.substring(index);</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineplus">+function findPhotoExt(aChannel) {</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineplus">+  var mimeSvc = Components.classes[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+                          .getService(Components.interfaces.nsIMIMEService);</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineplus">+  var ext = &quot;&quot;;</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineplus">+  var uri = aChannel.URI;</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineplus">+  if (uri instanceof Components.interfaces.nsIURL)</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineplus">+    ext = uri.fileExtension;</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineplus">+  try {</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineplus">+    return mimeSvc.getPrimaryExtension(aChannel.contentType, ext);</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineplus">+  } catch (e) {}</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineplus">+  return ext;</span>
<a href="#l34.62"></a><span id="l34.62"> }</span>
<a href="#l34.63"></a><span id="l34.63"> </span>
<a href="#l34.64"></a><span id="l34.64"> /**</span>
<a href="#l34.65"></a><span id="l34.65">  * Generates a unique filename to be used for a local copy of a contact's photo.</span>
<a href="#l34.66"></a><span id="l34.66">  *</span>
<a href="#l34.67"></a><span id="l34.67">  * @param aPath      The path to the folder in which the photo will be saved.</span>
<a href="#l34.68"></a><span id="l34.68">  * @param aExtension The file extension of the photo.</span>
<a href="#l34.69"></a><span id="l34.69">  *</span>
<a href="#l34.70"></a><span id="l34.70">  * @return A unique filename in the given path.</span>
<a href="#l34.71"></a><span id="l34.71">  */</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-function makePhotoFilename(aPath, aExtension) {</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineplus">+function makePhotoFile(aDir, aExtension) {</span>
<a href="#l34.74"></a><span id="l34.74">   var filename, newFile;</span>
<a href="#l34.75"></a><span id="l34.75">   // Find a random filename for the photo that doesn't exist yet</span>
<a href="#l34.76"></a><span id="l34.76">   do {</span>
<a href="#l34.77"></a><span id="l34.77" class="difflineminus">-    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + aExtension;</span>
<a href="#l34.78"></a><span id="l34.78" class="difflineminus">-    newFile = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l34.79"></a><span id="l34.79" class="difflineminus">-                        .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l34.80"></a><span id="l34.80" class="difflineminus">-    newFile.initWithPath(aPath);</span>
<a href="#l34.81"></a><span id="l34.81" class="difflineplus">+    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + &quot;.&quot; + aExtension;</span>
<a href="#l34.82"></a><span id="l34.82" class="difflineplus">+    newFile = aDir.clone();</span>
<a href="#l34.83"></a><span id="l34.83">     newFile.append(filename);</span>
<a href="#l34.84"></a><span id="l34.84">   } while (newFile.exists());</span>
<a href="#l34.85"></a><span id="l34.85" class="difflineminus">-  return filename;</span>
<a href="#l34.86"></a><span id="l34.86" class="difflineplus">+  return newFile;</span>
<a href="#l34.87"></a><span id="l34.87"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/components/migration/src/nsDogbertProfileMigrator.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/components/migration/src/nsDogbertProfileMigrator.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1002,17 +1002,17 @@ nsDogbertProfileMigrator::ProcessPrefsCa</span>
<a href="#l35.4"></a><span id="l35.4">     if (!exists)  {</span>
<a href="#l35.5"></a><span id="l35.5">       rv = newMOVEMAILMailPath-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l35.6"></a><span id="l35.6">       if (NS_FAILED(rv)) return rv;</span>
<a href="#l35.7"></a><span id="l35.7">     }</span>
<a href="#l35.8"></a><span id="l35.8">     rv = NS_OK;</span>
<a href="#l35.9"></a><span id="l35.9">   }</span>
<a href="#l35.10"></a><span id="l35.10"> #endif /* HAVE_MOVEMAIL */</span>
<a href="#l35.11"></a><span id="l35.11">   else {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    NS_ASSERTION(0,&quot;failure, didn't recognize your mail server type.\n&quot;);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    NS_ERROR(&quot;failure, didn't recognize your mail server type.&quot;);</span>
<a href="#l35.14"></a><span id="l35.14">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l35.15"></a><span id="l35.15">   }</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17">   ////////////////////////////////////////////////////////////////////////////</span>
<a href="#l35.18"></a><span id="l35.18">   // Set all the appropriate NEWS prefs.</span>
<a href="#l35.19"></a><span id="l35.19">   ////////////////////////////////////////////////////////////////////////////</span>
<a href="#l35.20"></a><span id="l35.20"> </span>
<a href="#l35.21"></a><span id="l35.21">   rv = newNewsPath-&gt;Exists(&amp;exists);</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -1129,17 +1129,17 @@ nsDogbertProfileMigrator::ProcessPrefsCa</span>
<a href="#l35.23"></a><span id="l35.23">     // we'll move and rename them</span>
<a href="#l35.24"></a><span id="l35.24">     rv = DoTheCopy(oldProfilePath, newProfilePath, POP_MAIL_FILTER_FILE_NAME_IN_4x);</span>
<a href="#l35.25"></a><span id="l35.25">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27">     rv = DoTheCopy(oldMOVEMAILMailPath, newMOVEMAILMailPath, PR_TRUE);</span>
<a href="#l35.28"></a><span id="l35.28">   }</span>
<a href="#l35.29"></a><span id="l35.29"> #endif /* HAVE_MOVEMAIL */</span>
<a href="#l35.30"></a><span id="l35.30">   else {</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-    NS_ASSERTION(0, &quot;unknown mail server type!&quot;);</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+    NS_ERROR(&quot;unknown mail server type!&quot;);</span>
<a href="#l35.33"></a><span id="l35.33">     return NS_ERROR_FAILURE;</span>
<a href="#l35.34"></a><span id="l35.34">   }</span>
<a href="#l35.35"></a><span id="l35.35"> </span>
<a href="#l35.36"></a><span id="l35.36">   // Don't inherit the 4.x cache file location for mozilla!</span>
<a href="#l35.37"></a><span id="l35.37">   // The cache pref later gets set with a default in nsAppRunner::InitCachePrefs().</span>
<a href="#l35.38"></a><span id="l35.38">   mPrefs-&gt;ClearUserPref(PREF_BROWSER_CACHE_DIRECTORY);</span>
<a href="#l35.39"></a><span id="l35.39"> </span>
<a href="#l35.40"></a><span id="l35.40">   rv = DoSpecialUpdates(newProfilePath);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/SearchDialog.dtd</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/SearchDialog.dtd</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l36.4"></a><span id="l36.4"> &lt;!-- for SearchDialog.xul --&gt;</span>
<a href="#l36.5"></a><span id="l36.5"> &lt;!ENTITY searchHeading.label         &quot;Search for messages in:&quot;&gt;</span>
<a href="#l36.6"></a><span id="l36.6"> &lt;!ENTITY searchHeading.accesskey     &quot;h&quot;&gt;</span>
<a href="#l36.7"></a><span id="l36.7"> &lt;!ENTITY searchSubfolders.label      &quot;Search subfolders&quot;&gt;</span>
<a href="#l36.8"></a><span id="l36.8"> &lt;!ENTITY searchSubfolders.accesskey  &quot;e&quot;&gt;</span>
<a href="#l36.9"></a><span id="l36.9" class="difflineplus">+&lt;!ENTITY searchOnline.label          &quot;Search online&quot;&gt;</span>
<a href="#l36.10"></a><span id="l36.10" class="difflineplus">+&lt;!ENTITY searchOnline.accesskey      &quot;l&quot;&gt;</span>
<a href="#l36.11"></a><span id="l36.11"> &lt;!ENTITY resetButton.label           &quot;Clear&quot;&gt;</span>
<a href="#l36.12"></a><span id="l36.12"> &lt;!ENTITY resetButton.accesskey       &quot;C&quot;&gt;</span>
<a href="#l36.13"></a><span id="l36.13"> &lt;!ENTITY openButton.label            &quot;Open&quot;&gt;</span>
<a href="#l36.14"></a><span id="l36.14"> &lt;!ENTITY openButton.accesskey        &quot;n&quot;&gt;</span>
<a href="#l36.15"></a><span id="l36.15"> &lt;!ENTITY deleteButton.label          &quot;Delete&quot;&gt;</span>
<a href="#l36.16"></a><span id="l36.16"> &lt;!ENTITY deleteButton.accesskey      &quot;D&quot;&gt;</span>
<a href="#l36.17"></a><span id="l36.17"> &lt;!ENTITY searchDialogTitle.label     &quot;Search Messages&quot;&gt;</span>
<a href="#l36.18"></a><span id="l36.18"> &lt;!ENTITY results.label               &quot;Results&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1,6 +1,7 @@</span>
<a href="#l37.4"></a><span id="l37.4" class="difflineplus">+&lt;!ENTITY identityDialog.style &quot;width: 67ch;&quot;&gt;</span>
<a href="#l37.5"></a><span id="l37.5"> &lt;!ENTITY identityTitle.label &quot;Identity Settings&quot;&gt;</span>
<a href="#l37.6"></a><span id="l37.6"> &lt;!ENTITY identityListDesc.label &quot;Configure the settings for this identity:&quot;&gt;</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8"> &lt;!ENTITY settingsTab.label       &quot;Settings&quot;&gt;</span>
<a href="#l37.9"></a><span id="l37.9"> &lt;!ENTITY copiesFoldersTab.label &quot;Copies &amp;amp; Folders&quot;&gt;</span>
<a href="#l37.10"></a><span id="l37.10"> &lt;!ENTITY addressingTab.label    &quot;Composition &amp;amp; Addressing&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -481,19 +481,37 @@ processingJunkMessages=Processing Junk M</span>
<a href="#l38.4"></a><span id="l38.4"> fileNotFoundTitle = File Not Found</span>
<a href="#l38.5"></a><span id="l38.5"> #LOCALIZATION NOTE(fileNotFoundMsg): %S is the filename</span>
<a href="#l38.6"></a><span id="l38.6"> fileNotFoundMsg = The file %S does not exist.</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> fileEmptyTitle = File Empty</span>
<a href="#l38.9"></a><span id="l38.9"> #LOCALIZATION NOTE(fileEmptyMsg): %S is the filename</span>
<a href="#l38.10"></a><span id="l38.10"> fileEmptyMsg = The file %S is empty.</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-# second person direct object pronoun; used in the collapsed header view if</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-# the user is in the To or Cc field of a message</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineminus">-headerFieldYou=You</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+# LOCALIZATION NOTE (headertoFieldYou): second person prepositional object</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+# pronoun used in the &quot;to&quot; header of the message header pane.  This is also</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineplus">+# used for the fallback case if a header-specific localization is not</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineplus">+# available.</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineplus">+headertoFieldYou=You</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineplus">+</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineplus">+# LOCALIZATION NOTE (headerfromFieldYou): second person prepositional object</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineplus">+# pronoun used in the &quot;from&quot; header of the message header pane.</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineplus">+headerfromFieldYou=You</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineplus">+</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineplus">+# LOCALIZATION NOTE (headerreply-toFieldYou): second person prepositional</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineplus">+# object pronoun used in the &quot;reply-to&quot; header of the message header pane.</span>
<a href="#l38.27"></a><span id="l38.27" class="difflineplus">+headerreply-toFieldYou=You</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineplus">+</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+# LOCALIZATION NOTE (headerccFieldYou): second person prepositional object</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineplus">+# pronoun used in the &quot;cc&quot; header of the message header pane.</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+headerccFieldYou=You</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+# LOCALIZATION NOTE (headerbccFieldYou): second person prepositional object</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+# pronoun used in the &quot;bcc&quot; header of the message header pane.</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineplus">+headerbccFieldYou=You</span>
<a href="#l38.36"></a><span id="l38.36"> </span>
<a href="#l38.37"></a><span id="l38.37"> # Shown when content tabs are being loaded.</span>
<a href="#l38.38"></a><span id="l38.38"> loadingTab=Loading</span>
<a href="#l38.39"></a><span id="l38.39"> </span>
<a href="#l38.40"></a><span id="l38.40"> applyToCollapsedMsgsTitle=Confirm Delete of Messages in Collapsed Thread(s)</span>
<a href="#l38.41"></a><span id="l38.41"> applyToCollapsedMsgs=Warning - this will delete messages in collapsed thread(s)</span>
<a href="#l38.42"></a><span id="l38.42"> applyToCollapsedAlwaysAskCheckbox=Always ask me before deleting messages in collapsed threads</span>
<a href="#l38.43"></a><span id="l38.43"> applyNowButton=Apply</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1,11 +1,11 @@</span>
<a href="#l39.4"></a><span id="l39.4"> &lt;!ENTITY  prefWindow.titleWin     &quot;Options&quot;&gt;</span>
<a href="#l39.5"></a><span id="l39.5"> &lt;!ENTITY  prefWindow.titleGNOME   &quot;&amp;brandShortName; Preferences&quot;&gt;</span>
<a href="#l39.6"></a><span id="l39.6" class="difflineminus">-&lt;!ENTITY  prefWindow.styleWindows &quot;width: 44em; min-height: 38.5em;&quot;&gt;</span>
<a href="#l39.7"></a><span id="l39.7" class="difflineplus">+&lt;!ENTITY  prefWindow.styleWindows &quot;width: 48em; min-height: 38.5em;&quot;&gt;</span>
<a href="#l39.8"></a><span id="l39.8"> &lt;!ENTITY  prefWindow.styleMac     &quot;width: 47em;&quot;&gt;</span>
<a href="#l39.9"></a><span id="l39.9"> &lt;!ENTITY  prefWindow.styleGNOME   &quot;width: 47em; min-height: 38em;&quot;&gt;</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11"> &lt;!ENTITY paneGeneral.title        &quot;General&quot;&gt;</span>
<a href="#l39.12"></a><span id="l39.12"> &lt;!ENTITY paneDisplay.title        &quot;Display&quot;&gt;</span>
<a href="#l39.13"></a><span id="l39.13"> &lt;!ENTITY paneComposition.title    &quot;Composition&quot;&gt;</span>
<a href="#l39.14"></a><span id="l39.14"> &lt;!ENTITY paneAttachments.title    &quot;Attachments&quot;&gt;</span>
<a href="#l39.15"></a><span id="l39.15"> &lt;!ENTITY paneSecurity.title       &quot;Security&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1">new file mode 100644</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineminus">--- /dev/null</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineplus">+++ b/mail/test/mozmill/cookies/html/cookietest1.html</span>
<a href="#l40.4"></a><span id="l40.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l40.5"></a><span id="l40.5" class="difflineplus">+&lt;html&gt;</span>
<a href="#l40.6"></a><span id="l40.6" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l40.7"></a><span id="l40.7" class="difflineplus">+    &lt;title&gt;Cookie Test&lt;/title&gt; </span>
<a href="#l40.8"></a><span id="l40.8" class="difflineplus">+    &lt;script type=&quot;text/javascript&quot;&gt;</span>
<a href="#l40.9"></a><span id="l40.9" class="difflineplus">+      document.cookie = &quot;name=CookieTest&quot;;</span>
<a href="#l40.10"></a><span id="l40.10" class="difflineplus">+    &lt;/script&gt;</span>
<a href="#l40.11"></a><span id="l40.11" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+  &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+    &lt;div align=&quot;center&quot;&gt;</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+      &lt;h1&gt;Cookie Test&lt;/h1&gt;</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1">new file mode 100644</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineminus">--- /dev/null</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineplus">+++ b/mail/test/mozmill/cookies/html/cookietest2.html</span>
<a href="#l41.4"></a><span id="l41.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l41.5"></a><span id="l41.5" class="difflineplus">+&lt;html&gt;</span>
<a href="#l41.6"></a><span id="l41.6" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l41.7"></a><span id="l41.7" class="difflineplus">+    &lt;title&gt;Cookie Test 2&lt;/title&gt; </span>
<a href="#l41.8"></a><span id="l41.8" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l41.9"></a><span id="l41.9" class="difflineplus">+  &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l41.10"></a><span id="l41.10" class="difflineplus">+    &lt;script type=&quot;text/javascript&quot;&gt;</span>
<a href="#l41.11"></a><span id="l41.11" class="difflineplus">+      var theCookie = document.cookie;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+    &lt;/script&gt;</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    &lt;div align=&quot;center&quot;&gt;</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+      &lt;h1&gt;Cookie Test Result&lt;/h1&gt;</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1">new file mode 100644</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineminus">--- /dev/null</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineplus">+++ b/mail/test/mozmill/cookies/test-cookies.js</span>
<a href="#l42.4"></a><span id="l42.4" class="difflineat">@@ -0,0 +1,114 @@</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l42.6"></a><span id="l42.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l42.7"></a><span id="l42.7" class="difflineplus">+ *</span>
<a href="#l42.8"></a><span id="l42.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l42.9"></a><span id="l42.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l42.10"></a><span id="l42.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineplus">+ *</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+ * License.</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+ *</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+ * The Original Code is Thunderbird Mail Client.</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+ *</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineplus">+ * Mozilla Messaging, Inc.</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l42.23"></a><span id="l42.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l42.24"></a><span id="l42.24" class="difflineplus">+ *</span>
<a href="#l42.25"></a><span id="l42.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l42.26"></a><span id="l42.26" class="difflineplus">+ *   Mark Banner &lt;bugzilla@standard8.pus.com&gt;</span>
<a href="#l42.27"></a><span id="l42.27" class="difflineplus">+ *</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l42.29"></a><span id="l42.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineplus">+ *</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineplus">+</span>
<a href="#l42.42"></a><span id="l42.42" class="difflineplus">+/**</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineplus">+ * Test file to check that cookies are correctly enabled in Thunderbird.</span>
<a href="#l42.44"></a><span id="l42.44" class="difflineplus">+ *</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineplus">+ * XXX: Still need to check remote content in messages.</span>
<a href="#l42.46"></a><span id="l42.46" class="difflineplus">+ * XXX: Swap cookie checks when bug 501925 lands.</span>
<a href="#l42.47"></a><span id="l42.47" class="difflineplus">+ */</span>
<a href="#l42.48"></a><span id="l42.48" class="difflineplus">+</span>
<a href="#l42.49"></a><span id="l42.49" class="difflineplus">+var MODULE_NAME = 'test-cookies';</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineplus">+</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l42.52"></a><span id="l42.52" class="difflineplus">+var MODULE_REQUIRES = ['window-helpers'];</span>
<a href="#l42.53"></a><span id="l42.53" class="difflineplus">+</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineplus">+var controller = {};</span>
<a href="#l42.55"></a><span id="l42.55" class="difflineplus">+Components.utils.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l42.56"></a><span id="l42.56" class="difflineplus">+var mozmill = {}; Components.utils.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l42.57"></a><span id="l42.57" class="difflineplus">+var elementslib = {}; Components.utils.import('resource://mozmill/modules/elementslib.js', elementslib);</span>
<a href="#l42.58"></a><span id="l42.58" class="difflineplus">+</span>
<a href="#l42.59"></a><span id="l42.59" class="difflineplus">+// The main controller and an easy alias.</span>
<a href="#l42.60"></a><span id="l42.60" class="difflineplus">+var mainController = null;</span>
<a href="#l42.61"></a><span id="l42.61" class="difflineplus">+var mc;</span>
<a href="#l42.62"></a><span id="l42.62" class="difflineplus">+</span>
<a href="#l42.63"></a><span id="l42.63" class="difflineplus">+// The windowHelper module.</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineplus">+var windowHelper;</span>
<a href="#l42.65"></a><span id="l42.65" class="difflineplus">+</span>
<a href="#l42.66"></a><span id="l42.66" class="difflineplus">+var newTab = null;</span>
<a href="#l42.67"></a><span id="l42.67" class="difflineplus">+</span>
<a href="#l42.68"></a><span id="l42.68" class="difflineplus">+// RELATIVE_ROOT messes with the collector, so we have to bring the path back</span>
<a href="#l42.69"></a><span id="l42.69" class="difflineplus">+// so we get the right path for the resources.</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineplus">+var url = collector.addHttpResource('../cookies/html', 'cookies');</span>
<a href="#l42.71"></a><span id="l42.71" class="difflineplus">+</span>
<a href="#l42.72"></a><span id="l42.72" class="difflineplus">+function setupModule(module) {</span>
<a href="#l42.73"></a><span id="l42.73" class="difflineplus">+  windowHelper = collector.getModule('window-helpers');</span>
<a href="#l42.74"></a><span id="l42.74" class="difflineplus">+  mc = mainController = windowHelper.wait_for_existing_window(&quot;mail:3pane&quot;);</span>
<a href="#l42.75"></a><span id="l42.75" class="difflineplus">+  windowHelper.augment_controller(mc);</span>
<a href="#l42.76"></a><span id="l42.76" class="difflineplus">+}</span>
<a href="#l42.77"></a><span id="l42.77" class="difflineplus">+</span>
<a href="#l42.78"></a><span id="l42.78" class="difflineplus">+/**</span>
<a href="#l42.79"></a><span id="l42.79" class="difflineplus">+ * Test deleting junk messages with no messages marked as junk.</span>
<a href="#l42.80"></a><span id="l42.80" class="difflineplus">+ */</span>
<a href="#l42.81"></a><span id="l42.81" class="difflineplus">+function test_load_cookie_page() {</span>
<a href="#l42.82"></a><span id="l42.82" class="difflineplus">+  newTab = mc.tabmail.openTab(&quot;contentTab&quot;,</span>
<a href="#l42.83"></a><span id="l42.83" class="difflineplus">+                              {contentPage: url + &quot;cookietest1.html&quot;});</span>
<a href="#l42.84"></a><span id="l42.84" class="difflineplus">+</span>
<a href="#l42.85"></a><span id="l42.85" class="difflineplus">+  if (!newTab)</span>
<a href="#l42.86"></a><span id="l42.86" class="difflineplus">+    throw new Error(&quot;Expected new tab info to be returned from openTab&quot;);</span>
<a href="#l42.87"></a><span id="l42.87" class="difflineplus">+</span>
<a href="#l42.88"></a><span id="l42.88" class="difflineplus">+  // XXX When bug 508999 is fixed, remove the sleep and use the waitForEval</span>
<a href="#l42.89"></a><span id="l42.89" class="difflineplus">+  // instead.</span>
<a href="#l42.90"></a><span id="l42.90" class="difflineplus">+  // controller.waitForEval(&quot;subject.busy == false&quot;, 1000, 100, newTab);</span>
<a href="#l42.91"></a><span id="l42.91" class="difflineplus">+  controller.sleep(1000);</span>
<a href="#l42.92"></a><span id="l42.92" class="difflineplus">+}</span>
<a href="#l42.93"></a><span id="l42.93" class="difflineplus">+</span>
<a href="#l42.94"></a><span id="l42.94" class="difflineplus">+function test_load_cookie_result_page() {</span>
<a href="#l42.95"></a><span id="l42.95" class="difflineplus">+  newTab = mc.tabmail.openTab(&quot;contentTab&quot;,</span>
<a href="#l42.96"></a><span id="l42.96" class="difflineplus">+                              {contentPage: url + &quot;cookietest2.html&quot;});</span>
<a href="#l42.97"></a><span id="l42.97" class="difflineplus">+</span>
<a href="#l42.98"></a><span id="l42.98" class="difflineplus">+  if (!newTab)</span>
<a href="#l42.99"></a><span id="l42.99" class="difflineplus">+    throw new Error(&quot;Expected new tab info to be returned from openTab&quot;);</span>
<a href="#l42.100"></a><span id="l42.100" class="difflineplus">+</span>
<a href="#l42.101"></a><span id="l42.101" class="difflineplus">+  // XXX When bug 508999 is fixed, remove the sleep and use the waitForEval</span>
<a href="#l42.102"></a><span id="l42.102" class="difflineplus">+  // instead.</span>
<a href="#l42.103"></a><span id="l42.103" class="difflineplus">+  // controller.waitForEval(&quot;subject.busy == false&quot;, 1000, 100, newTab);</span>
<a href="#l42.104"></a><span id="l42.104" class="difflineplus">+  controller.sleep(1000);</span>
<a href="#l42.105"></a><span id="l42.105" class="difflineplus">+</span>
<a href="#l42.106"></a><span id="l42.106" class="difflineplus">+  if (mc.window.content.document.title != &quot;Cookie Test 2&quot;)</span>
<a href="#l42.107"></a><span id="l42.107" class="difflineplus">+    throw new Error(&quot;The cookie test 2 page is not the selected tab or not content-primary&quot;);</span>
<a href="#l42.108"></a><span id="l42.108" class="difflineplus">+</span>
<a href="#l42.109"></a><span id="l42.109" class="difflineplus">+  let cookie = mc.window.content.wrappedJSObject.theCookie;</span>
<a href="#l42.110"></a><span id="l42.110" class="difflineplus">+</span>
<a href="#l42.111"></a><span id="l42.111" class="difflineplus">+  dump(&quot;Cookie is: &quot; + cookie + &quot;\n&quot;);</span>
<a href="#l42.112"></a><span id="l42.112" class="difflineplus">+</span>
<a href="#l42.113"></a><span id="l42.113" class="difflineplus">+  if (!cookie)</span>
<a href="#l42.114"></a><span id="l42.114" class="difflineplus">+    throw new Error(&quot;Document has no cookie :-(&quot;);</span>
<a href="#l42.115"></a><span id="l42.115" class="difflineplus">+</span>
<a href="#l42.116"></a><span id="l42.116" class="difflineplus">+  if (cookie != &quot;name=CookieTest&quot;)</span>
<a href="#l42.117"></a><span id="l42.117" class="difflineplus">+    throw new Error(&quot;Cookie set incorrectly, expected: name=CookieTest, got: &quot; +cookie + &quot;\n&quot;);</span>
<a href="#l42.118"></a><span id="l42.118" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1">new file mode 100644</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineminus">--- /dev/null</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-quick-search.js</span>
<a href="#l43.4"></a><span id="l43.4" class="difflineat">@@ -0,0 +1,126 @@</span>
<a href="#l43.5"></a><span id="l43.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l43.6"></a><span id="l43.6" class="difflineplus">+ *   Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l43.7"></a><span id="l43.7" class="difflineplus">+ *</span>
<a href="#l43.8"></a><span id="l43.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l43.10"></a><span id="l43.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l43.11"></a><span id="l43.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineplus">+ *</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineplus">+ * License.</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineplus">+ *</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+ * The Original Code is Thunderbird Mail Client.</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+ *</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineplus">+ * Mozilla Messaging, Inc.</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l43.23"></a><span id="l43.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l43.24"></a><span id="l43.24" class="difflineplus">+ *</span>
<a href="#l43.25"></a><span id="l43.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineplus">+ *   Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineplus">+ *</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l43.29"></a><span id="l43.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l43.34"></a><span id="l43.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l43.35"></a><span id="l43.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l43.37"></a><span id="l43.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l43.38"></a><span id="l43.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l43.39"></a><span id="l43.39" class="difflineplus">+ *</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineplus">+</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineplus">+var MODULE_NAME = 'test-quick-search';</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineplus">+</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineplus">+var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineplus">+var MODULE_REQUIRES = ['folder-display-helpers', 'window-helpers'];</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineplus">+</span>
<a href="#l43.47"></a><span id="l43.47" class="difflineplus">+var folder;</span>
<a href="#l43.48"></a><span id="l43.48" class="difflineplus">+var setFoo, setBar;</span>
<a href="#l43.49"></a><span id="l43.49" class="difflineplus">+</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineplus">+function setupModule(module) {</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineplus">+  let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l43.52"></a><span id="l43.52" class="difflineplus">+  fdh.installInto(module);</span>
<a href="#l43.53"></a><span id="l43.53" class="difflineplus">+  let wh = collector.getModule('window-helpers');</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineplus">+  wh.installInto(module);</span>
<a href="#l43.55"></a><span id="l43.55" class="difflineplus">+</span>
<a href="#l43.56"></a><span id="l43.56" class="difflineplus">+  folder = create_folder(&quot;QuickSearch&quot;);</span>
<a href="#l43.57"></a><span id="l43.57" class="difflineplus">+  [setFoo, setBar] =</span>
<a href="#l43.58"></a><span id="l43.58" class="difflineplus">+    make_new_sets_in_folder(folder, [{subject: &quot;foo&quot;, count: 1},</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineplus">+                                     {subject: &quot;bar&quot;, count: 1}]);</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineplus">+}</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineplus">+</span>
<a href="#l43.62"></a><span id="l43.62" class="difflineplus">+/**</span>
<a href="#l43.63"></a><span id="l43.63" class="difflineplus">+ *</span>
<a href="#l43.64"></a><span id="l43.64" class="difflineplus">+ */</span>
<a href="#l43.65"></a><span id="l43.65" class="difflineplus">+function test_save_quick_search() {</span>
<a href="#l43.66"></a><span id="l43.66" class="difflineplus">+  be_in_folder(folder);</span>
<a href="#l43.67"></a><span id="l43.67" class="difflineplus">+</span>
<a href="#l43.68"></a><span id="l43.68" class="difflineplus">+  // - Type something in the quick search box.</span>
<a href="#l43.69"></a><span id="l43.69" class="difflineplus">+  mc.type(mc.eid(&quot;searchInput&quot;), &quot;foo&quot;);</span>
<a href="#l43.70"></a><span id="l43.70" class="difflineplus">+  mc.keypress(mc.eid(&quot;searchInput&quot;), &quot;VK_RETURN&quot;, {});</span>
<a href="#l43.71"></a><span id="l43.71" class="difflineplus">+  wait_for_all_messages_to_load();</span>
<a href="#l43.72"></a><span id="l43.72" class="difflineplus">+</span>
<a href="#l43.73"></a><span id="l43.73" class="difflineplus">+  // - Click the &quot;Save Search as a Folder&quot; button</span>
<a href="#l43.74"></a><span id="l43.74" class="difflineplus">+  // This will create a virtual folder properties dialog...</span>
<a href="#l43.75"></a><span id="l43.75" class="difflineplus">+  // (label: &quot;New Saved Search Folder&quot;, source: virtualFolderProperties.xul</span>
<a href="#l43.76"></a><span id="l43.76" class="difflineplus">+  //  no windowtype, id: &quot;virtualFolderPropertiesDialog&quot;)</span>
<a href="#l43.77"></a><span id="l43.77" class="difflineplus">+  plan_for_modal_dialog(&quot;mailnews:virtualFolderProperties&quot;,</span>
<a href="#l43.78"></a><span id="l43.78" class="difflineplus">+                        subtest_save_search);</span>
<a href="#l43.79"></a><span id="l43.79" class="difflineplus">+  mc.click(mc.eid(&quot;quickSearchSaveAsVirtualFolder&quot;));</span>
<a href="#l43.80"></a><span id="l43.80" class="difflineplus">+  wait_for_modal_dialog(&quot;mailnews:virtualFolderProperties&quot;);</span>
<a href="#l43.81"></a><span id="l43.81" class="difflineplus">+}</span>
<a href="#l43.82"></a><span id="l43.82" class="difflineplus">+</span>
<a href="#l43.83"></a><span id="l43.83" class="difflineplus">+/**</span>
<a href="#l43.84"></a><span id="l43.84" class="difflineplus">+ * Save the search, making sure that the &quot;subject OR from&quot; constraints are</span>
<a href="#l43.85"></a><span id="l43.85" class="difflineplus">+ *  there.</span>
<a href="#l43.86"></a><span id="l43.86" class="difflineplus">+ */</span>
<a href="#l43.87"></a><span id="l43.87" class="difflineplus">+function subtest_save_search(savc) {</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineplus">+  // - make sure our constraint propagated</span>
<a href="#l43.89"></a><span id="l43.89" class="difflineplus">+  // this should be an &quot;OR&quot; constraint</span>
<a href="#l43.90"></a><span id="l43.90" class="difflineplus">+  savc.assertValue(savc.eid(&quot;booleanAndGroup&quot;), &quot;or&quot;);</span>
<a href="#l43.91"></a><span id="l43.91" class="difflineplus">+</span>
<a href="#l43.92"></a><span id="l43.92" class="difflineplus">+  // first constraint is on &quot;Subject&quot;=0 and should be &quot;foo&quot;</span>
<a href="#l43.93"></a><span id="l43.93" class="difflineplus">+  let searchAttr0 = savc.eid(&quot;searchAttr0&quot;);</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineplus">+  savc.assertNode(searchAttr0);</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineplus">+  savc.assertValue(searchAttr0, &quot;0&quot;);</span>
<a href="#l43.96"></a><span id="l43.96" class="difflineplus">+</span>
<a href="#l43.97"></a><span id="l43.97" class="difflineplus">+  let searchVal0 = savc.aid(&quot;searchVal0&quot;, {crazyDeck: 0});</span>
<a href="#l43.98"></a><span id="l43.98" class="difflineplus">+  savc.assertNode(searchVal0);</span>
<a href="#l43.99"></a><span id="l43.99" class="difflineplus">+  savc.assertValue(searchVal0, &quot;foo&quot;);</span>
<a href="#l43.100"></a><span id="l43.100" class="difflineplus">+</span>
<a href="#l43.101"></a><span id="l43.101" class="difflineplus">+  // second constraint is on &quot;From&quot;=1 and should be &quot;foo&quot; as well</span>
<a href="#l43.102"></a><span id="l43.102" class="difflineplus">+  let searchAttr1 = savc.eid(&quot;searchAttr1&quot;);</span>
<a href="#l43.103"></a><span id="l43.103" class="difflineplus">+  savc.assertNode(searchAttr1);</span>
<a href="#l43.104"></a><span id="l43.104" class="difflineplus">+  savc.assertValue(searchAttr1, &quot;1&quot;);</span>
<a href="#l43.105"></a><span id="l43.105" class="difflineplus">+</span>
<a href="#l43.106"></a><span id="l43.106" class="difflineplus">+  let searchVal1 = savc.aid(&quot;searchVal1&quot;, {crazyDeck: 0});</span>
<a href="#l43.107"></a><span id="l43.107" class="difflineplus">+  savc.assertNode(searchVal1);</span>
<a href="#l43.108"></a><span id="l43.108" class="difflineplus">+  savc.assertValue(searchVal1, &quot;foo&quot;);</span>
<a href="#l43.109"></a><span id="l43.109" class="difflineplus">+</span>
<a href="#l43.110"></a><span id="l43.110" class="difflineplus">+  // - Make sure the name mangling is as expected</span>
<a href="#l43.111"></a><span id="l43.111" class="difflineplus">+  savc.assertValue(savc.eid(&quot;name&quot;), &quot;QuickSearch-foo&quot;);</span>
<a href="#l43.112"></a><span id="l43.112" class="difflineplus">+</span>
<a href="#l43.113"></a><span id="l43.113" class="difflineplus">+  // - save it!</span>
<a href="#l43.114"></a><span id="l43.114" class="difflineplus">+  // this will close the dialog, which wait_for_modal_dialog is making sure</span>
<a href="#l43.115"></a><span id="l43.115" class="difflineplus">+  //  happens.</span>
<a href="#l43.116"></a><span id="l43.116" class="difflineplus">+  savc.window.onOK();</span>
<a href="#l43.117"></a><span id="l43.117" class="difflineplus">+}</span>
<a href="#l43.118"></a><span id="l43.118" class="difflineplus">+</span>
<a href="#l43.119"></a><span id="l43.119" class="difflineplus">+/**</span>
<a href="#l43.120"></a><span id="l43.120" class="difflineplus">+ * Make sure the folder showed up with the right name, and that displaying it</span>
<a href="#l43.121"></a><span id="l43.121" class="difflineplus">+ *  has the right contents.</span>
<a href="#l43.122"></a><span id="l43.122" class="difflineplus">+ */</span>
<a href="#l43.123"></a><span id="l43.123" class="difflineplus">+function test_verify_saved_search() {</span>
<a href="#l43.124"></a><span id="l43.124" class="difflineplus">+  let savedFolder = folder.findSubFolder(&quot;QuickSearch-foo&quot;);</span>
<a href="#l43.125"></a><span id="l43.125" class="difflineplus">+  if (savedFolder == null)</span>
<a href="#l43.126"></a><span id="l43.126" class="difflineplus">+    throw new Error(&quot;Saved folder did not show up.&quot;);</span>
<a href="#l43.127"></a><span id="l43.127" class="difflineplus">+</span>
<a href="#l43.128"></a><span id="l43.128" class="difflineplus">+  be_in_folder(savedFolder);</span>
<a href="#l43.129"></a><span id="l43.129" class="difflineplus">+  assert_messages_in_view(setFoo);</span>
<a href="#l43.130"></a><span id="l43.130" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mail/test/mozmill/mozmilltests.list</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mail/test/mozmill/mozmilltests.list</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1,5 +1,6 @@</span>
<a href="#l44.4"></a><span id="l44.4"> folder-display</span>
<a href="#l44.5"></a><span id="l44.5"> junk-commands</span>
<a href="#l44.6"></a><span id="l44.6"> search-window</span>
<a href="#l44.7"></a><span id="l44.7" class="difflineplus">+cookies</span>
<a href="#l44.8"></a><span id="l44.8"> content-policy</span>
<a href="#l44.9"></a><span id="l44.9"> content-tabs</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mail/test/mozmill/runtest.py</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mail/test/mozmill/runtest.py</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -125,17 +125,20 @@ class ThunderTestProfile(mozrunner.Thund</span>
<a href="#l45.4"></a><span id="l45.4">         'mail.server.server2.name' :  &quot;tinderbox@invalid.com&quot;,</span>
<a href="#l45.5"></a><span id="l45.5">         'mail.server.server2.type' :  &quot;pop3&quot;,</span>
<a href="#l45.6"></a><span id="l45.6">         'mail.server.server2.userName' :  &quot;tinderbox&quot;,</span>
<a href="#l45.7"></a><span id="l45.7">         'mail.smtp.defaultserver' :  &quot;smtp1&quot;,</span>
<a href="#l45.8"></a><span id="l45.8">         'mail.smtpserver.smtp1.hostname' :  &quot;tinderbox&quot;,</span>
<a href="#l45.9"></a><span id="l45.9">         'mail.smtpserver.smtp1.username' :  &quot;tinderbox&quot;,</span>
<a href="#l45.10"></a><span id="l45.10">         'mail.smtpservers' :  &quot;smtp1&quot;,</span>
<a href="#l45.11"></a><span id="l45.11">         'mail.startup.enabledMailCheckOnce' :  True,</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineplus">+        # Don't load what's new or the remote start page - keep everything local</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+        # under our control.</span>
<a href="#l45.14"></a><span id="l45.14">         'mailnews.start_page_override.mstone' :  &quot;ignore&quot;,</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineplus">+        'mailnews.start_page.url': &quot;about:blank&quot;,</span>
<a href="#l45.16"></a><span id="l45.16">         }</span>
<a href="#l45.17"></a><span id="l45.17"> </span>
<a href="#l45.18"></a><span id="l45.18">     def __init__(self, default_profile=None, profile=None, create_new=True,</span>
<a href="#l45.19"></a><span id="l45.19">                  plugins=[], preferences={}):</span>
<a href="#l45.20"></a><span id="l45.20">         self.init_env()</span>
<a href="#l45.21"></a><span id="l45.21">         self.profile_dir = os.path.join(SCRIPT_DIRECTORY, 'mozmillprofile')</span>
<a href="#l45.22"></a><span id="l45.22"> </span>
<a href="#l45.23"></a><span id="l45.23">         mozrunner.Profile.__init__(self, default_profile, profile, create_new, plugins, preferences)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mail/themes/gnomestripe/jar.mn</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mail/themes/gnomestripe/jar.mn</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -22,17 +22,16 @@ classic.jar:</span>
<a href="#l46.4"></a><span id="l46.4">   skin/classic/messenger/subscribe.css                        (mail/subscribe.css)</span>
<a href="#l46.5"></a><span id="l46.5">   skin/classic/messenger/virtualFolderListDialog.css          (mail/virtualFolderListDialog.css)</span>
<a href="#l46.6"></a><span id="l46.6">   skin/classic/messenger/searchDialog.css                     (mail/searchDialog.css)</span>
<a href="#l46.7"></a><span id="l46.7">   skin/classic/messenger/msgSelectOffline.css                 (mail/msgSelectOffline.css)</span>
<a href="#l46.8"></a><span id="l46.8">   skin/classic/messenger/filterDialog.css                     (mail/filterDialog.css)</span>
<a href="#l46.9"></a><span id="l46.9">   skin/classic/messenger/multimessageview.css                 (mail/multimessageview.css)</span>
<a href="#l46.10"></a><span id="l46.10">   skin/classic/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l46.11"></a><span id="l46.11">   skin/classic/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-* skin/classic/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l46.13"></a><span id="l46.13">   skin/classic/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l46.14"></a><span id="l46.14">   skin/classic/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l46.15"></a><span id="l46.15">   skin/classic/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l46.16"></a><span id="l46.16">   skin/classic/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l46.17"></a><span id="l46.17">   skin/classic/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l46.18"></a><span id="l46.18">   skin/classic/messenger/activity/activity.css                (mail/activity/activity.css)</span>
<a href="#l46.19"></a><span id="l46.19">   skin/classic/messenger/activity/buttons.png                 (mail/activity/buttons.png)</span>
<a href="#l46.20"></a><span id="l46.20">   skin/classic/messenger/activity/defaultProcessIcon.png      (mail/activity/defaultProcessIcon.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/dialogs.css</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/dialogs.css</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -62,32 +62,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l47.4"></a><span id="l47.4">   -moz-padding-end: 1px;</span>
<a href="#l47.5"></a><span id="l47.5"> }</span>
<a href="#l47.6"></a><span id="l47.6"> </span>
<a href="#l47.7"></a><span id="l47.7"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l47.8"></a><span id="l47.8"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l47.9"></a><span id="l47.9"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l47.10"></a><span id="l47.10">   color: GrayText;</span>
<a href="#l47.11"></a><span id="l47.11"> }</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">-</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineminus">-  width: 40em;</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineminus">-}</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineminus">-</span>
<a href="#l47.19"></a><span id="l47.19" class="difflineminus">-#askImageBox {</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineminus">-}</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineminus">-</span>
<a href="#l47.23"></a><span id="l47.23" class="difflineminus">-#convertYes,</span>
<a href="#l47.24"></a><span id="l47.24" class="difflineminus">-#convertAltering {</span>
<a href="#l47.25"></a><span id="l47.25" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l47.26"></a><span id="l47.26" class="difflineminus">-}</span>
<a href="#l47.27"></a><span id="l47.27" class="difflineminus">-</span>
<a href="#l47.28"></a><span id="l47.28" class="difflineminus">-#convertNo {</span>
<a href="#l47.29"></a><span id="l47.29" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Warning.png&quot;);</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">-}</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">-#convertDefault {</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/folderPane.css</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/folderPane.css</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -1,11 +1,11 @@</span>
<a href="#l48.4"></a><span id="l48.4"> /* ::::: Folder Pane ::::: */</span>
<a href="#l48.5"></a><span id="l48.5"> </span>
<a href="#l48.6"></a><span id="l48.6" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.7"></a><span id="l48.7" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.8"></a><span id="l48.8"> treechildren::-moz-tree-image(folderNameCol) {</span>
<a href="#l48.9"></a><span id="l48.9">   background-position: center center;</span>
<a href="#l48.10"></a><span id="l48.10">   background-repeat: no-repeat;</span>
<a href="#l48.11"></a><span id="l48.11">   background-color: transparent;</span>
<a href="#l48.12"></a><span id="l48.12">   background-attachment: scroll;</span>
<a href="#l48.13"></a><span id="l48.13">   -moz-background-clip: border;</span>
<a href="#l48.14"></a><span id="l48.14">   -moz-background-inline-policy: continuous;</span>
<a href="#l48.15"></a><span id="l48.15">   -moz-background-origin: border;</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineat">@@ -24,181 +24,181 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l48.17"></a><span id="l48.17"> </span>
<a href="#l48.18"></a><span id="l48.18"> treechildren::-moz-tree-image(folderNameCol, selected, open, newMessages-true) {</span>
<a href="#l48.19"></a><span id="l48.19">   background-image: url(&quot;moz-icon://stock/gtk-directory?size=menu&quot;);</span>
<a href="#l48.20"></a><span id="l48.20">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new-star.png&quot;);</span>
<a href="#l48.21"></a><span id="l48.21"> }</span>
<a href="#l48.22"></a><span id="l48.22"> </span>
<a href="#l48.23"></a><span id="l48.23"> /* ..... Newsgroup ..... */</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.26"></a><span id="l48.26" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.27"></a><span id="l48.27"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp) {</span>
<a href="#l48.28"></a><span id="l48.28">   background-image: none;</span>
<a href="#l48.29"></a><span id="l48.29">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder.png&quot;);</span>
<a href="#l48.30"></a><span id="l48.30">   -moz-image-region: rect(0 160px 16px 144px);</span>
<a href="#l48.31"></a><span id="l48.31"> }</span>
<a href="#l48.32"></a><span id="l48.32"> </span>
<a href="#l48.33"></a><span id="l48.33"> /* ..... Feed ..... */</span>
<a href="#l48.34"></a><span id="l48.34"> </span>
<a href="#l48.35"></a><span id="l48.35" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.36"></a><span id="l48.36" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.37"></a><span id="l48.37"> treechildren::-moz-tree-image(folderNameCol, serverType-rss) {</span>
<a href="#l48.38"></a><span id="l48.38">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.39"></a><span id="l48.39">   background-position: left -112px;</span>
<a href="#l48.40"></a><span id="l48.40">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.41"></a><span id="l48.41"> }</span>
<a href="#l48.42"></a><span id="l48.42"> </span>
<a href="#l48.43"></a><span id="l48.43"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, newMessages-true) {</span>
<a href="#l48.44"></a><span id="l48.44">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.45"></a><span id="l48.45">   background-position: left -112px;</span>
<a href="#l48.46"></a><span id="l48.46">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new-star.png&quot;);</span>
<a href="#l48.47"></a><span id="l48.47"> }</span>
<a href="#l48.48"></a><span id="l48.48"> </span>
<a href="#l48.49"></a><span id="l48.49"> /* Resets list-style-image for Feed Trash and Virtual folders */</span>
<a href="#l48.50"></a><span id="l48.50"> </span>
<a href="#l48.51"></a><span id="l48.51" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.52"></a><span id="l48.52" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.53"></a><span id="l48.53" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.54"></a><span id="l48.54" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.55"></a><span id="l48.55"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, specialFolder-Trash),</span>
<a href="#l48.56"></a><span id="l48.56"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, specialFolder-Virtual) {</span>
<a href="#l48.57"></a><span id="l48.57">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.58"></a><span id="l48.58">   background-position: left -176px;</span>
<a href="#l48.59"></a><span id="l48.59">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.60"></a><span id="l48.60"> }</span>
<a href="#l48.61"></a><span id="l48.61"> </span>
<a href="#l48.62"></a><span id="l48.62"> /* ..... Inbox ..... */</span>
<a href="#l48.63"></a><span id="l48.63"> </span>
<a href="#l48.64"></a><span id="l48.64" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.65"></a><span id="l48.65" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.66"></a><span id="l48.66"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox) {</span>
<a href="#l48.67"></a><span id="l48.67">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.68"></a><span id="l48.68">   background-position: left -64px;</span>
<a href="#l48.69"></a><span id="l48.69">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.70"></a><span id="l48.70"> }</span>
<a href="#l48.71"></a><span id="l48.71"> </span>
<a href="#l48.72"></a><span id="l48.72"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l48.73"></a><span id="l48.73">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.74"></a><span id="l48.74">   background-position: left -64px;</span>
<a href="#l48.75"></a><span id="l48.75">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new-star.png&quot;);</span>
<a href="#l48.76"></a><span id="l48.76"> }</span>
<a href="#l48.77"></a><span id="l48.77"> </span>
<a href="#l48.78"></a><span id="l48.78"> /* ..... Sent ..... */</span>
<a href="#l48.79"></a><span id="l48.79"> </span>
<a href="#l48.80"></a><span id="l48.80" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Sent&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.81"></a><span id="l48.81" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Sent&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.82"></a><span id="l48.82"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Sent) {</span>
<a href="#l48.83"></a><span id="l48.83">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.84"></a><span id="l48.84">   background-position: left -144px;</span>
<a href="#l48.85"></a><span id="l48.85">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.86"></a><span id="l48.86"> }</span>
<a href="#l48.87"></a><span id="l48.87"> </span>
<a href="#l48.88"></a><span id="l48.88"> /* ..... Outbox ..... */</span>
<a href="#l48.89"></a><span id="l48.89"> </span>
<a href="#l48.90"></a><span id="l48.90" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Outbox&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.91"></a><span id="l48.91" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Outbox&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.92"></a><span id="l48.92"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Outbox) {</span>
<a href="#l48.93"></a><span id="l48.93">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.94"></a><span id="l48.94">   background-position: left -96px;</span>
<a href="#l48.95"></a><span id="l48.95">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.96"></a><span id="l48.96"> }</span>
<a href="#l48.97"></a><span id="l48.97"> </span>
<a href="#l48.98"></a><span id="l48.98"> /* ..... Drafts ..... */</span>
<a href="#l48.99"></a><span id="l48.99"> </span>
<a href="#l48.100"></a><span id="l48.100" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Drafts&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.101"></a><span id="l48.101" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Drafts&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.102"></a><span id="l48.102"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Drafts) {</span>
<a href="#l48.103"></a><span id="l48.103">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.104"></a><span id="l48.104">   background-position: left -48px;</span>
<a href="#l48.105"></a><span id="l48.105">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.106"></a><span id="l48.106"> }</span>
<a href="#l48.107"></a><span id="l48.107"> </span>
<a href="#l48.108"></a><span id="l48.108"> /* ..... Templates ..... */</span>
<a href="#l48.109"></a><span id="l48.109"> </span>
<a href="#l48.110"></a><span id="l48.110" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Templates&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.111"></a><span id="l48.111" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Templates&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.112"></a><span id="l48.112"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Templates) {</span>
<a href="#l48.113"></a><span id="l48.113">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.114"></a><span id="l48.114">   background-position: left -160px;</span>
<a href="#l48.115"></a><span id="l48.115">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.116"></a><span id="l48.116"> }</span>
<a href="#l48.117"></a><span id="l48.117"> </span>
<a href="#l48.118"></a><span id="l48.118"> /* ..... Junk ..... */</span>
<a href="#l48.119"></a><span id="l48.119"> </span>
<a href="#l48.120"></a><span id="l48.120" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Junk&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.121"></a><span id="l48.121" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Junk&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.122"></a><span id="l48.122"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Junk) {</span>
<a href="#l48.123"></a><span id="l48.123">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.124"></a><span id="l48.124">   background-position: left -80px;</span>
<a href="#l48.125"></a><span id="l48.125">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.126"></a><span id="l48.126"> }</span>
<a href="#l48.127"></a><span id="l48.127"> </span>
<a href="#l48.128"></a><span id="l48.128"> /* ..... Trash ..... */</span>
<a href="#l48.129"></a><span id="l48.129"> </span>
<a href="#l48.130"></a><span id="l48.130" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.131"></a><span id="l48.131" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.132"></a><span id="l48.132"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Trash) {</span>
<a href="#l48.133"></a><span id="l48.133">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.134"></a><span id="l48.134">   background-position: left -176px;</span>
<a href="#l48.135"></a><span id="l48.135">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.136"></a><span id="l48.136"> }</span>
<a href="#l48.137"></a><span id="l48.137"> </span>
<a href="#l48.138"></a><span id="l48.138"> /* ..... Archives ..... */</span>
<a href="#l48.139"></a><span id="l48.139"> </span>
<a href="#l48.140"></a><span id="l48.140" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Archive&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.141"></a><span id="l48.141" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Archive&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.142"></a><span id="l48.142"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Archive) {</span>
<a href="#l48.143"></a><span id="l48.143">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.144"></a><span id="l48.144">   background-position: left -192px;</span>
<a href="#l48.145"></a><span id="l48.145">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.146"></a><span id="l48.146"> }</span>
<a href="#l48.147"></a><span id="l48.147"> </span>
<a href="#l48.148"></a><span id="l48.148"> /* ..... Shared folders .....</span>
<a href="#l48.149"></a><span id="l48.149"> </span>
<a href="#l48.150"></a><span id="l48.150"> treechildren::-moz-tree-image(folderNameCol, imapShared-true) {</span>
<a href="#l48.151"></a><span id="l48.151">   -moz-image-region: rect(0 192px 16px 176px);</span>
<a href="#l48.152"></a><span id="l48.152"> }</span>
<a href="#l48.153"></a><span id="l48.153"> </span>
<a href="#l48.154"></a><span id="l48.154"> */ </span>
<a href="#l48.155"></a><span id="l48.155"> </span>
<a href="#l48.156"></a><span id="l48.156"> /* ..... Saved Search Folder ..... */</span>
<a href="#l48.157"></a><span id="l48.157"> </span>
<a href="#l48.158"></a><span id="l48.158" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.159"></a><span id="l48.159" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.160"></a><span id="l48.160"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Virtual) {</span>
<a href="#l48.161"></a><span id="l48.161">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.162"></a><span id="l48.162">   background-position: left -128px;</span>
<a href="#l48.163"></a><span id="l48.163">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.164"></a><span id="l48.164"> }</span>
<a href="#l48.165"></a><span id="l48.165"> </span>
<a href="#l48.166"></a><span id="l48.166"> /* .....  Newsgroup .....  */</span>
<a href="#l48.167"></a><span id="l48.167" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l48.168"></a><span id="l48.168" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l48.169"></a><span id="l48.169">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.170"></a><span id="l48.170">   background-position: left -208px;</span>
<a href="#l48.171"></a><span id="l48.171">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.172"></a><span id="l48.172"> }</span>
<a href="#l48.173"></a><span id="l48.173"> </span>
<a href="#l48.174"></a><span id="l48.174"> /* ..... Account nodes ..... */</span>
<a href="#l48.175"></a><span id="l48.175" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l48.176"></a><span id="l48.176" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l48.177"></a><span id="l48.177">   -moz-margin-start: 0px;</span>
<a href="#l48.178"></a><span id="l48.178">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l48.179"></a><span id="l48.179">   background-position: left -16px;</span>
<a href="#l48.180"></a><span id="l48.180">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.181"></a><span id="l48.181"> }</span>
<a href="#l48.182"></a><span id="l48.182"> </span>
<a href="#l48.183"></a><span id="l48.183"> /* ..... Secure IMAP/POP account nodes ..... */</span>
<a href="#l48.184"></a><span id="l48.184" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.185"></a><span id="l48.185" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;pop3&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l48.186"></a><span id="l48.186" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.187"></a><span id="l48.187" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;pop3&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l48.188"></a><span id="l48.188">   background-position: left -16px;</span>
<a href="#l48.189"></a><span id="l48.189">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.190"></a><span id="l48.190"> }</span>
<a href="#l48.191"></a><span id="l48.191"> </span>
<a href="#l48.192"></a><span id="l48.192"> /* ..... Local folders ..... */</span>
<a href="#l48.193"></a><span id="l48.193" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;none&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l48.194"></a><span id="l48.194" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;none&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l48.195"></a><span id="l48.195">   background-position: left 0px;</span>
<a href="#l48.196"></a><span id="l48.196">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.197"></a><span id="l48.197"> }</span>
<a href="#l48.198"></a><span id="l48.198"> </span>
<a href="#l48.199"></a><span id="l48.199"> /* ..... News server ..... */</span>
<a href="#l48.200"></a><span id="l48.200" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l48.201"></a><span id="l48.201" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l48.202"></a><span id="l48.202">   background-image: none;</span>
<a href="#l48.203"></a><span id="l48.203">   list-style-image: url(&quot;chrome://messenger/skin/icons/server.png&quot;);</span>
<a href="#l48.204"></a><span id="l48.204">   -moz-image-region: rect(0 64px 16px 48px);</span>
<a href="#l48.205"></a><span id="l48.205"> }</span>
<a href="#l48.206"></a><span id="l48.206"> </span>
<a href="#l48.207"></a><span id="l48.207"> /* ..... Secure news server ..... */</span>
<a href="#l48.208"></a><span id="l48.208" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l48.209"></a><span id="l48.209" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l48.210"></a><span id="l48.210">   background-image: none;</span>
<a href="#l48.211"></a><span id="l48.211">   list-style-image: url(&quot;chrome://messenger/skin/icons/server.png&quot;);</span>
<a href="#l48.212"></a><span id="l48.212">   -moz-image-region: rect(0 80px 16px 64px);</span>
<a href="#l48.213"></a><span id="l48.213"> }</span>
<a href="#l48.214"></a><span id="l48.214"> </span>
<a href="#l48.215"></a><span id="l48.215"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Virtual, newMessages-true) {</span>
<a href="#l48.216"></a><span id="l48.216">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder.png&quot;);</span>
<a href="#l48.217"></a><span id="l48.217">   -moz-image-region: rect(16px 176px 32px 160px);</span>
<a href="#l48.218"></a><span id="l48.218" class="difflineat">@@ -258,17 +258,17 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l48.219"></a><span id="l48.219"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-nntp, isSecure-true) {</span>
<a href="#l48.220"></a><span id="l48.220">   background-image: none;</span>
<a href="#l48.221"></a><span id="l48.221">   list-style-image: url(&quot;chrome://messenger/skin/icons/server.png&quot;);</span>
<a href="#l48.222"></a><span id="l48.222">   -moz-image-region: rect(0 80px 16px 64px) !important;</span>
<a href="#l48.223"></a><span id="l48.223"> }</span>
<a href="#l48.224"></a><span id="l48.224"> </span>
<a href="#l48.225"></a><span id="l48.225"> /* ..... Feed server ..... */</span>
<a href="#l48.226"></a><span id="l48.226"> </span>
<a href="#l48.227"></a><span id="l48.227" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l48.228"></a><span id="l48.228" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l48.229"></a><span id="l48.229"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-rss) {</span>
<a href="#l48.230"></a><span id="l48.230">   background-position: left -32px;</span>
<a href="#l48.231"></a><span id="l48.231">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l48.232"></a><span id="l48.232"> }</span>
<a href="#l48.233"></a><span id="l48.233"> </span>
<a href="#l48.234"></a><span id="l48.234"> /* ::::: All Servers ::::: */</span>
<a href="#l48.235"></a><span id="l48.235"> </span>
<a href="#l48.236"></a><span id="l48.236"> treechildren::-moz-tree-cell-text(closed, subfoldersHaveUnreadMessages-true) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1">index e2fcc69546524ca030c27d8752f06c5356c8876b..c416de2d99e9331d089bfde232eaf481256e10a2</span>
<a href="#l49.2"></a><span id="l49.2">GIT binary patch
literal 4248
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/tabmail.css</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/tabmail.css</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -77,25 +77,25 @@ tabpanels {</span>
<a href="#l50.4"></a><span id="l50.4">   width: 16px;</span>
<a href="#l50.5"></a><span id="l50.5">   height: 16px;</span>
<a href="#l50.6"></a><span id="l50.6">   -moz-margin-start: 4px;</span>
<a href="#l50.7"></a><span id="l50.7">   -moz-margin-end: 3px;</span>
<a href="#l50.8"></a><span id="l50.8">   list-style-image: url(&quot;chrome://global/skin/icons/folder-item.png&quot;);</span>
<a href="#l50.9"></a><span id="l50.9">   -moz-image-region: rect(0px, 16px, 16px, 0px);</span>
<a href="#l50.10"></a><span id="l50.10"> }</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-.tabmail-tab[busy] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+.tabmail-tab[busy] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.14"></a><span id="l50.14">   list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l50.15"></a><span id="l50.15"> }</span>
<a href="#l50.16"></a><span id="l50.16"> </span>
<a href="#l50.17"></a><span id="l50.17" class="difflineminus">-.tabmail-tab[thinking] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.18"></a><span id="l50.18" class="difflineplus">+.tabmail-tab[thinking] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.19"></a><span id="l50.19">   list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l50.20"></a><span id="l50.20"> }</span>
<a href="#l50.21"></a><span id="l50.21"> </span>
<a href="#l50.22"></a><span id="l50.22" class="difflineminus">-.tabmail-tab[type=&quot;glodaSearch&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.23"></a><span id="l50.23" class="difflineplus">+.tabmail-tab[type=&quot;glodaSearch&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.24"></a><span id="l50.24">   list-style-image: url(&quot;chrome://global/skin/icons/Search-glass.png&quot;);</span>
<a href="#l50.25"></a><span id="l50.25"> }</span>
<a href="#l50.26"></a><span id="l50.26"> </span>
<a href="#l50.27"></a><span id="l50.27"> .tabs-bottom {</span>
<a href="#l50.28"></a><span id="l50.28">   border-bottom: 1px solid threedshadow;</span>
<a href="#l50.29"></a><span id="l50.29"> }</span>
<a href="#l50.30"></a><span id="l50.30"> </span>
<a href="#l50.31"></a><span id="l50.31"> .tabmail-tab &gt; .tab-text {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1">deleted file mode 100644</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineminus">--- a/mail/themes/gnomestripe/mail/tabmailBindings.xml</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineplus">+++ /dev/null</span>
<a href="#l51.4"></a><span id="l51.4" class="difflineat">@@ -1,110 +0,0 @@</span>
<a href="#l51.5"></a><span id="l51.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l51.6"></a><span id="l51.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l51.7"></a><span id="l51.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l51.8"></a><span id="l51.8" class="difflineminus">-#</span>
<a href="#l51.9"></a><span id="l51.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l51.10"></a><span id="l51.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l51.11"></a><span id="l51.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-#</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineminus">-# License.</span>
<a href="#l51.18"></a><span id="l51.18" class="difflineminus">-#</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineminus">-# The Original Code is tab mail</span>
<a href="#l51.20"></a><span id="l51.20" class="difflineminus">-#</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineminus">-#   Scott MacGregor &lt;mscott@mozilla.org&gt;.</span>
<a href="#l51.23"></a><span id="l51.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l51.25"></a><span id="l51.25" class="difflineminus">-#</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineminus">-#</span>
<a href="#l51.28"></a><span id="l51.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l51.29"></a><span id="l51.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l51.30"></a><span id="l51.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l51.33"></a><span id="l51.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l51.34"></a><span id="l51.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l51.35"></a><span id="l51.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l51.37"></a><span id="l51.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineminus">-#</span>
<a href="#l51.40"></a><span id="l51.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l51.41"></a><span id="l51.41" class="difflineminus">-</span>
<a href="#l51.42"></a><span id="l51.42" class="difflineminus">-&lt;!DOCTYPE bindings [</span>
<a href="#l51.43"></a><span id="l51.43" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l51.44"></a><span id="l51.44" class="difflineminus">-%tabMailDTD;</span>
<a href="#l51.45"></a><span id="l51.45" class="difflineminus">-&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l51.46"></a><span id="l51.46" class="difflineminus">-%globalDTD;</span>
<a href="#l51.47"></a><span id="l51.47" class="difflineminus">-]&gt;</span>
<a href="#l51.48"></a><span id="l51.48" class="difflineminus">-</span>
<a href="#l51.49"></a><span id="l51.49" class="difflineminus">-&lt;bindings id=&quot;globalBindings&quot;</span>
<a href="#l51.50"></a><span id="l51.50" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l51.51"></a><span id="l51.51" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l51.52"></a><span id="l51.52" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l51.53"></a><span id="l51.53" class="difflineminus">-</span>
<a href="#l51.54"></a><span id="l51.54" class="difflineminus">-  &lt;binding id=&quot;tabmail-tab&quot; extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;&gt;</span>
<a href="#l51.55"></a><span id="l51.55" class="difflineminus">-    &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l51.56"></a><span id="l51.56" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l51.57"></a><span id="l51.57" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l51.58"></a><span id="l51.58" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;tab-image-middle&quot; align=&quot;center&quot; xbl:inherits=&quot;selected&quot;&gt;</span>
<a href="#l51.59"></a><span id="l51.59" class="difflineminus">-        &lt;xul:stack class=&quot;tab-icon&quot;&gt;</span>
<a href="#l51.60"></a><span id="l51.60" class="difflineminus">-          &lt;xul:image xbl:inherits=&quot;validate,src=image&quot; class=&quot;tab-icon-image&quot;/&gt;</span>
<a href="#l51.61"></a><span id="l51.61" class="difflineminus">-          &lt;xul:image class=&quot;tab-extra-status&quot;/&gt;</span>
<a href="#l51.62"></a><span id="l51.62" class="difflineminus">-        &lt;/xul:stack&gt;</span>
<a href="#l51.63"></a><span id="l51.63" class="difflineminus">-        &lt;xul:label flex=&quot;1&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; class=&quot;tab-text&quot;/&gt;</span>
<a href="#l51.64"></a><span id="l51.64" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l51.65"></a><span id="l51.65" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l51.66"></a><span id="l51.66" class="difflineminus">-        &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l51.67"></a><span id="l51.67" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l51.68"></a><span id="l51.68" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l51.69"></a><span id="l51.69" class="difflineminus">-</span>
<a href="#l51.70"></a><span id="l51.70" class="difflineminus">-   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l51.71"></a><span id="l51.71" class="difflineminus">-            extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;&gt;</span>
<a href="#l51.72"></a><span id="l51.72" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l51.73"></a><span id="l51.73" class="difflineminus">-      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l51.74"></a><span id="l51.74" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l51.75"></a><span id="l51.75" class="difflineminus">-          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l51.76"></a><span id="l51.76" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l51.77"></a><span id="l51.77" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l51.78"></a><span id="l51.78" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l51.79"></a><span id="l51.79" class="difflineminus">-          &lt;xul:hbox&gt;</span>
<a href="#l51.80"></a><span id="l51.80" class="difflineminus">-            &lt;xul:stack&gt;</span>
<a href="#l51.81"></a><span id="l51.81" class="difflineminus">-              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l51.82"></a><span id="l51.82" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l51.83"></a><span id="l51.83" class="difflineminus">-            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l51.84"></a><span id="l51.84" class="difflineminus">-                                orient=&quot;horizontal&quot;</span>
<a href="#l51.85"></a><span id="l51.85" class="difflineminus">-                                flex=&quot;1&quot;</span>
<a href="#l51.86"></a><span id="l51.86" class="difflineminus">-                                style=&quot;min-width: 1px;&quot;</span>
<a href="#l51.87"></a><span id="l51.87" class="difflineminus">-                                chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l51.88"></a><span id="l51.88" class="difflineminus">-                                class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l51.89"></a><span id="l51.89" class="difflineminus">-              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l51.90"></a><span id="l51.90" class="difflineminus">-            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l51.91"></a><span id="l51.91" class="difflineminus">-            &lt;children/&gt;</span>
<a href="#l51.92"></a><span id="l51.92" class="difflineminus">-            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l51.93"></a><span id="l51.93" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l51.94"></a><span id="l51.94" class="difflineminus">-                        class=&quot;tabs-alltabs-box&quot;</span>
<a href="#l51.95"></a><span id="l51.95" class="difflineminus">-                        anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l51.96"></a><span id="l51.96" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l51.97"></a><span id="l51.97" class="difflineminus">-                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l51.98"></a><span id="l51.98" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l51.99"></a><span id="l51.99" class="difflineminus">-                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l51.100"></a><span id="l51.100" class="difflineminus">-                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l51.101"></a><span id="l51.101" class="difflineminus">-                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l51.102"></a><span id="l51.102" class="difflineminus">-                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l51.103"></a><span id="l51.103" class="difflineminus">-              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l51.104"></a><span id="l51.104" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l51.105"></a><span id="l51.105" class="difflineminus">-            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l51.106"></a><span id="l51.106" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l51.107"></a><span id="l51.107" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l51.108"></a><span id="l51.108" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l51.109"></a><span id="l51.109" class="difflineminus">-          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l51.110"></a><span id="l51.110" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l51.111"></a><span id="l51.111" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l51.112"></a><span id="l51.112" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l51.113"></a><span id="l51.113" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l51.114"></a><span id="l51.114" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mail/themes/pinstripe/jar.mn</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mail/themes/pinstripe/jar.mn</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -19,17 +19,16 @@ classic.jar:</span>
<a href="#l52.4"></a><span id="l52.4">   skin/classic/messenger/tagColors.css                           (mail/tagColors.css)</span>
<a href="#l52.5"></a><span id="l52.5">   skin/classic/messenger/junkMail.css                            (mail/junkMail.css)</span>
<a href="#l52.6"></a><span id="l52.6">   skin/classic/messenger/folderMenus.css                         (mail/folderMenus.css)</span>
<a href="#l52.7"></a><span id="l52.7">   skin/classic/messenger/folderPane.css                          (mail/folderPane.css)</span>
<a href="#l52.8"></a><span id="l52.8">   skin/classic/messenger/subscribe.css                           (mail/subscribe.css)</span>
<a href="#l52.9"></a><span id="l52.9">   skin/classic/messenger/virtualFolderListDialog.css             (mail/virtualFolderListDialog.css)</span>
<a href="#l52.10"></a><span id="l52.10">   skin/classic/messenger/searchDialog.css                        (mail/searchDialog.css)</span>
<a href="#l52.11"></a><span id="l52.11">   skin/classic/messenger/filterDialog.css                        (mail/filterDialog.css)</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-* skin/classic/messenger/tabmailBindings.xml                     (mail/tabmailBindings.xml)</span>
<a href="#l52.13"></a><span id="l52.13">   skin/classic/messenger/tabmail.css                             (mail/tabmail.css)</span>
<a href="#l52.14"></a><span id="l52.14">   skin/classic/messenger/editContactOverlay.css                  (mail/editContactOverlay.css)</span>
<a href="#l52.15"></a><span id="l52.15">   skin/classic/messenger/starred48.png                           (mail/starred48.png)</span>
<a href="#l52.16"></a><span id="l52.16">   skin/classic/messenger/starIcons.png                           (mail/starIcons.png)</span>
<a href="#l52.17"></a><span id="l52.17">   skin/classic/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l52.18"></a><span id="l52.18">   skin/classic/messenger/activity/buttons.png                    (mail/activity/buttons.png)  </span>
<a href="#l52.19"></a><span id="l52.19">   skin/classic/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon.png)</span>
<a href="#l52.20"></a><span id="l52.20">   skin/classic/messenger/activity/defaultEventIcon.png           (mail/activity/defaultEventIcon.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/dialogs.css</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/dialogs.css</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -62,38 +62,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l53.4"></a><span id="l53.4">   -moz-padding-end: 1px;</span>
<a href="#l53.5"></a><span id="l53.5"> }</span>
<a href="#l53.6"></a><span id="l53.6"> </span>
<a href="#l53.7"></a><span id="l53.7"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l53.8"></a><span id="l53.8"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l53.9"></a><span id="l53.9"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l53.10"></a><span id="l53.10">   color: GrayText;</span>
<a href="#l53.11"></a><span id="l53.11"> }</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineminus">-</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l53.16"></a><span id="l53.16" class="difflineminus">-  width: 40em;</span>
<a href="#l53.17"></a><span id="l53.17" class="difflineminus">-}</span>
<a href="#l53.18"></a><span id="l53.18" class="difflineminus">-</span>
<a href="#l53.19"></a><span id="l53.19" class="difflineminus">-#askImageBox {</span>
<a href="#l53.20"></a><span id="l53.20" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l53.21"></a><span id="l53.21" class="difflineminus">-}</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineminus">-</span>
<a href="#l53.23"></a><span id="l53.23" class="difflineminus">-#convertYes {</span>
<a href="#l53.24"></a><span id="l53.24" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/question-icon.png&quot;);</span>
<a href="#l53.25"></a><span id="l53.25" class="difflineminus">-}</span>
<a href="#l53.26"></a><span id="l53.26" class="difflineminus">-</span>
<a href="#l53.27"></a><span id="l53.27" class="difflineminus">-#convertAltering {</span>
<a href="#l53.28"></a><span id="l53.28" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/question-icon.png&quot;);</span>
<a href="#l53.29"></a><span id="l53.29" class="difflineminus">-}</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-#convertNo {</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/alert-icon.png&quot;);</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-}</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineminus">-#convertDefault {</span>
<a href="#l53.37"></a><span id="l53.37" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/question-icon.png&quot;);</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-}</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineminus">-</span>
<a href="#l53.40"></a><span id="l53.40" class="difflineminus">-</span>
<a href="#l53.41"></a><span id="l53.41" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/tabmail.css</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/tabmail.css</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -30,26 +30,16 @@</span>
<a href="#l54.4"></a><span id="l54.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l54.5"></a><span id="l54.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l54.6"></a><span id="l54.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l54.7"></a><span id="l54.7">  *</span>
<a href="#l54.8"></a><span id="l54.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l54.9"></a><span id="l54.9"> </span>
<a href="#l54.10"></a><span id="l54.10"> /* ::::: tabmail ::::: */</span>
<a href="#l54.11"></a><span id="l54.11"> </span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-/* bring in the proper bindings on OS X */</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-.tabmail-tab {</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tab&quot;) !important;</span>
<a href="#l54.16"></a><span id="l54.16" class="difflineminus">-}</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineminus">-</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineminus">-.tabmail-tabs {</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tabs&quot;) !important;</span>
<a href="#l54.20"></a><span id="l54.20" class="difflineminus">-}</span>
<a href="#l54.21"></a><span id="l54.21" class="difflineminus">-</span>
<a href="#l54.22"></a><span id="l54.22"> .tabmail-tabs &gt; .tabmail-tab:first-child &gt; .tab-close-button {</span>
<a href="#l54.23"></a><span id="l54.23">   visibility: collapse;</span>
<a href="#l54.24"></a><span id="l54.24"> }</span>
<a href="#l54.25"></a><span id="l54.25"> </span>
<a href="#l54.26"></a><span id="l54.26"> #messengerWindow:not([active=&quot;true&quot;]) .tabmail-strip {</span>
<a href="#l54.27"></a><span id="l54.27">   background-color: #e2e2e2;</span>
<a href="#l54.28"></a><span id="l54.28"> }</span>
<a href="#l54.29"></a><span id="l54.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1">deleted file mode 100644</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineminus">--- a/mail/themes/pinstripe/mail/tabmailBindings.xml</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineplus">+++ /dev/null</span>
<a href="#l55.4"></a><span id="l55.4" class="difflineat">@@ -1,102 +0,0 @@</span>
<a href="#l55.5"></a><span id="l55.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l55.6"></a><span id="l55.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l55.7"></a><span id="l55.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l55.8"></a><span id="l55.8" class="difflineminus">-#</span>
<a href="#l55.9"></a><span id="l55.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l55.10"></a><span id="l55.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l55.11"></a><span id="l55.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineminus">-#</span>
<a href="#l55.14"></a><span id="l55.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l55.15"></a><span id="l55.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l55.17"></a><span id="l55.17" class="difflineminus">-# License.</span>
<a href="#l55.18"></a><span id="l55.18" class="difflineminus">-#</span>
<a href="#l55.19"></a><span id="l55.19" class="difflineminus">-# The Original Code is tab mail</span>
<a href="#l55.20"></a><span id="l55.20" class="difflineminus">-#</span>
<a href="#l55.21"></a><span id="l55.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l55.22"></a><span id="l55.22" class="difflineminus">-#   Scott MacGregor &lt;mscott@mozilla.org&gt;.</span>
<a href="#l55.23"></a><span id="l55.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l55.24"></a><span id="l55.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l55.25"></a><span id="l55.25" class="difflineminus">-#</span>
<a href="#l55.26"></a><span id="l55.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l55.27"></a><span id="l55.27" class="difflineminus">-#</span>
<a href="#l55.28"></a><span id="l55.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l55.29"></a><span id="l55.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l55.30"></a><span id="l55.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l55.33"></a><span id="l55.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l55.34"></a><span id="l55.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l55.35"></a><span id="l55.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l55.36"></a><span id="l55.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l55.37"></a><span id="l55.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l55.38"></a><span id="l55.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l55.39"></a><span id="l55.39" class="difflineminus">-#</span>
<a href="#l55.40"></a><span id="l55.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l55.41"></a><span id="l55.41" class="difflineminus">-</span>
<a href="#l55.42"></a><span id="l55.42" class="difflineminus">-&lt;!DOCTYPE bindings [</span>
<a href="#l55.43"></a><span id="l55.43" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l55.44"></a><span id="l55.44" class="difflineminus">-%tabMailDTD;</span>
<a href="#l55.45"></a><span id="l55.45" class="difflineminus">-&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l55.46"></a><span id="l55.46" class="difflineminus">-%globalDTD;</span>
<a href="#l55.47"></a><span id="l55.47" class="difflineminus">-]&gt;</span>
<a href="#l55.48"></a><span id="l55.48" class="difflineminus">-</span>
<a href="#l55.49"></a><span id="l55.49" class="difflineminus">-&lt;bindings id=&quot;globalBindings&quot;</span>
<a href="#l55.50"></a><span id="l55.50" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l55.51"></a><span id="l55.51" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l55.52"></a><span id="l55.52" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l55.53"></a><span id="l55.53" class="difflineminus">-</span>
<a href="#l55.54"></a><span id="l55.54" class="difflineminus">-  &lt;binding id=&quot;tabmail-tab&quot; extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;&gt;</span>
<a href="#l55.55"></a><span id="l55.55" class="difflineminus">-    &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l55.56"></a><span id="l55.56" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l55.57"></a><span id="l55.57" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l55.58"></a><span id="l55.58" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;tab-image-middle&quot; align=&quot;center&quot; xbl:inherits=&quot;selected&quot;&gt;</span>
<a href="#l55.59"></a><span id="l55.59" class="difflineminus">-        &lt;xul:image xbl:inherits=&quot;validate,src=image,selected&quot; class=&quot;tab-icon-image&quot;/&gt;</span>
<a href="#l55.60"></a><span id="l55.60" class="difflineminus">-        &lt;xul:label flex=&quot;1&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; class=&quot;tab-text&quot;/&gt;</span>
<a href="#l55.61"></a><span id="l55.61" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l55.62"></a><span id="l55.62" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l55.63"></a><span id="l55.63" class="difflineminus">-        &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l55.64"></a><span id="l55.64" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l55.65"></a><span id="l55.65" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l55.66"></a><span id="l55.66" class="difflineminus">-</span>
<a href="#l55.67"></a><span id="l55.67" class="difflineminus">-   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l55.68"></a><span id="l55.68" class="difflineminus">-            extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;&gt;</span>
<a href="#l55.69"></a><span id="l55.69" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l55.70"></a><span id="l55.70" class="difflineminus">-      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l55.71"></a><span id="l55.71" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l55.72"></a><span id="l55.72" class="difflineminus">-          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l55.73"></a><span id="l55.73" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l55.74"></a><span id="l55.74" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l55.75"></a><span id="l55.75" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l55.76"></a><span id="l55.76" class="difflineminus">-          &lt;xul:hbox&gt;</span>
<a href="#l55.77"></a><span id="l55.77" class="difflineminus">-            &lt;xul:stack&gt;</span>
<a href="#l55.78"></a><span id="l55.78" class="difflineminus">-              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l55.79"></a><span id="l55.79" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l55.80"></a><span id="l55.80" class="difflineminus">-            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot; style=&quot;min-width: 1px;&quot; class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l55.81"></a><span id="l55.81" class="difflineminus">-              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l55.82"></a><span id="l55.82" class="difflineminus">-            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l55.83"></a><span id="l55.83" class="difflineminus">-            &lt;children/&gt;</span>
<a href="#l55.84"></a><span id="l55.84" class="difflineminus">-            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l55.85"></a><span id="l55.85" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; </span>
<a href="#l55.86"></a><span id="l55.86" class="difflineminus">-                        anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l55.87"></a><span id="l55.87" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l55.88"></a><span id="l55.88" class="difflineminus">-                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l55.89"></a><span id="l55.89" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot;</span>
<a href="#l55.90"></a><span id="l55.90" class="difflineminus">-                                 type=&quot;menu&quot;</span>
<a href="#l55.91"></a><span id="l55.91" class="difflineminus">-                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l55.92"></a><span id="l55.92" class="difflineminus">-                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l55.93"></a><span id="l55.93" class="difflineminus">-                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l55.94"></a><span id="l55.94" class="difflineminus">-                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l55.95"></a><span id="l55.95" class="difflineminus">-              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l55.96"></a><span id="l55.96" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l55.97"></a><span id="l55.97" class="difflineminus">-            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l55.98"></a><span id="l55.98" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l55.99"></a><span id="l55.99" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l55.100"></a><span id="l55.100" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l55.101"></a><span id="l55.101" class="difflineminus">-          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l55.102"></a><span id="l55.102" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l55.103"></a><span id="l55.103" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l55.104"></a><span id="l55.104" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l55.105"></a><span id="l55.105" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l55.106"></a><span id="l55.106" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mail/themes/qute/jar.mn</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mail/themes/qute/jar.mn</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -61,17 +61,16 @@ classic.jar:</span>
<a href="#l56.4"></a><span id="l56.4">   skin/classic/messenger/subscribe.css                        (mail/subscribe.css)</span>
<a href="#l56.5"></a><span id="l56.5">   skin/classic/messenger/virtualFolderListDialog.css          (mail/virtualFolderListDialog.css)</span>
<a href="#l56.6"></a><span id="l56.6">   skin/classic/messenger/searchDialog.css                     (mail/searchDialog.css)</span>
<a href="#l56.7"></a><span id="l56.7">   skin/classic/messenger/msgSelectOffline.css                 (mail/msgSelectOffline.css)</span>
<a href="#l56.8"></a><span id="l56.8">   skin/classic/messenger/filterDialog.css                     (mail/filterDialog.css)</span>
<a href="#l56.9"></a><span id="l56.9">   skin/classic/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l56.10"></a><span id="l56.10">   skin/classic/messenger/multimessageview.css                 (mail/multimessageview.css)</span>
<a href="#l56.11"></a><span id="l56.11">   skin/classic/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-* skin/classic/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l56.13"></a><span id="l56.13">   skin/classic/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l56.14"></a><span id="l56.14">   skin/classic/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l56.15"></a><span id="l56.15">   skin/classic/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l56.16"></a><span id="l56.16">   skin/classic/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l56.17"></a><span id="l56.17">   skin/classic/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l56.18"></a><span id="l56.18">   skin/classic/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l56.19"></a><span id="l56.19">   skin/classic/messenger/activity/buttons.png                    (mail/activity/buttons.png)</span>
<a href="#l56.20"></a><span id="l56.20">   skin/classic/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon.png)</span>
<a href="#l56.21"></a><span id="l56.21" class="difflineat">@@ -252,17 +251,16 @@ classic.jar:</span>
<a href="#l56.22"></a><span id="l56.22">   skin/classic/aero/messenger/subscribe.css                        (mail/subscribe.css)</span>
<a href="#l56.23"></a><span id="l56.23">   skin/classic/aero/messenger/virtualFolderListDialog.css          (mail/virtualFolderListDialog.css)</span>
<a href="#l56.24"></a><span id="l56.24">   skin/classic/aero/messenger/searchDialog.css                     (mail/searchDialog.css)</span>
<a href="#l56.25"></a><span id="l56.25">   skin/classic/aero/messenger/msgSelectOffline.css                 (mail/msgSelectOffline.css)</span>
<a href="#l56.26"></a><span id="l56.26">   skin/classic/aero/messenger/filterDialog.css                     (mail/filterDialog.css)</span>
<a href="#l56.27"></a><span id="l56.27">   skin/classic/aero/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l56.28"></a><span id="l56.28">   skin/classic/aero/messenger/multimessageview.css                 (mail/multimessageview.css)</span>
<a href="#l56.29"></a><span id="l56.29">   skin/classic/aero/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l56.30"></a><span id="l56.30" class="difflineminus">-* skin/classic/aero/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l56.31"></a><span id="l56.31">   skin/classic/aero/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l56.32"></a><span id="l56.32">   skin/classic/aero/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l56.33"></a><span id="l56.33">   skin/classic/aero/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l56.34"></a><span id="l56.34">   skin/classic/aero/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l56.35"></a><span id="l56.35">   skin/classic/aero/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l56.36"></a><span id="l56.36">   skin/classic/aero/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l56.37"></a><span id="l56.37">   skin/classic/aero/messenger/activity/buttons.png                    (mail/activity/buttons.png)</span>
<a href="#l56.38"></a><span id="l56.38">   skin/classic/aero/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon-aero.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mail/themes/qute/mail/dialogs.css</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mail/themes/qute/mail/dialogs.css</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -62,32 +62,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l57.4"></a><span id="l57.4">   -moz-padding-end: 1px;</span>
<a href="#l57.5"></a><span id="l57.5"> }</span>
<a href="#l57.6"></a><span id="l57.6"> </span>
<a href="#l57.7"></a><span id="l57.7"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l57.8"></a><span id="l57.8"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l57.9"></a><span id="l57.9"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l57.10"></a><span id="l57.10">   color: GrayText;</span>
<a href="#l57.11"></a><span id="l57.11"> }</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineminus">-  width: 40em;</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineminus">-}</span>
<a href="#l57.18"></a><span id="l57.18" class="difflineminus">-</span>
<a href="#l57.19"></a><span id="l57.19" class="difflineminus">-#askImageBox {</span>
<a href="#l57.20"></a><span id="l57.20" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l57.21"></a><span id="l57.21" class="difflineminus">-}</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineminus">-</span>
<a href="#l57.23"></a><span id="l57.23" class="difflineminus">-#convertYes,</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineminus">-#convertAltering {</span>
<a href="#l57.25"></a><span id="l57.25" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l57.26"></a><span id="l57.26" class="difflineminus">-}</span>
<a href="#l57.27"></a><span id="l57.27" class="difflineminus">-</span>
<a href="#l57.28"></a><span id="l57.28" class="difflineminus">-#convertNo {</span>
<a href="#l57.29"></a><span id="l57.29" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Warning.png&quot;);</span>
<a href="#l57.30"></a><span id="l57.30" class="difflineminus">-}</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineminus">-#convertDefault {</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l57.35"></a><span id="l57.35" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mail/themes/qute/mail/tabmail.css</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mail/themes/qute/mail/tabmail.css</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -33,17 +33,16 @@</span>
<a href="#l58.4"></a><span id="l58.4">  *</span>
<a href="#l58.5"></a><span id="l58.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l58.6"></a><span id="l58.6"> </span>
<a href="#l58.7"></a><span id="l58.7"> /**</span>
<a href="#l58.8"></a><span id="l58.8">  * Tabmail Tabs</span>
<a href="#l58.9"></a><span id="l58.9">  */</span>
<a href="#l58.10"></a><span id="l58.10"> </span>
<a href="#l58.11"></a><span id="l58.11"> .tabmail-tabs {</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tabs&quot;) !important;</span>
<a href="#l58.13"></a><span id="l58.13">   padding-top: 0px;</span>
<a href="#l58.14"></a><span id="l58.14">   background: -moz-dialog url(&quot;chrome://messenger/skin/tabmail-tabs-bkgnd.png&quot;) !important;</span>
<a href="#l58.15"></a><span id="l58.15">   -moz-padding-start: 0px;</span>
<a href="#l58.16"></a><span id="l58.16"> }</span>
<a href="#l58.17"></a><span id="l58.17"> </span>
<a href="#l58.18"></a><span id="l58.18"> .tabmail-tabs[overflow=&quot;true&quot;] {</span>
<a href="#l58.19"></a><span id="l58.19">   -moz-padding-start: 0px;</span>
<a href="#l58.20"></a><span id="l58.20"> }</span>
<a href="#l58.21"></a><span id="l58.21" class="difflineat">@@ -53,17 +52,16 @@</span>
<a href="#l58.22"></a><span id="l58.22"> }</span>
<a href="#l58.23"></a><span id="l58.23"> </span>
<a href="#l58.24"></a><span id="l58.24"> /**</span>
<a href="#l58.25"></a><span id="l58.25">  * Tab</span>
<a href="#l58.26"></a><span id="l58.26">  */</span>
<a href="#l58.27"></a><span id="l58.27"> </span>
<a href="#l58.28"></a><span id="l58.28"> .tabmail-tab {</span>
<a href="#l58.29"></a><span id="l58.29">   -moz-appearance: none !important;</span>
<a href="#l58.30"></a><span id="l58.30" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tab&quot;) !important;</span>
<a href="#l58.31"></a><span id="l58.31">   background: transparent !important;</span>
<a href="#l58.32"></a><span id="l58.32">   margin: 0px 0px 1px !important;</span>
<a href="#l58.33"></a><span id="l58.33">   padding: 0px !important;</span>
<a href="#l58.34"></a><span id="l58.34">   border: none !important;</span>
<a href="#l58.35"></a><span id="l58.35">   height: 22px !important;</span>
<a href="#l58.36"></a><span id="l58.36"> }</span>
<a href="#l58.37"></a><span id="l58.37"> </span>
<a href="#l58.38"></a><span id="l58.38"> .tabmail-tab &gt; .tab-image-middle {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1">deleted file mode 100644</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineminus">--- a/mail/themes/qute/mail/tabmailBindings.xml</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineplus">+++ /dev/null</span>
<a href="#l59.4"></a><span id="l59.4" class="difflineat">@@ -1,107 +0,0 @@</span>
<a href="#l59.5"></a><span id="l59.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l59.6"></a><span id="l59.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l59.7"></a><span id="l59.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l59.8"></a><span id="l59.8" class="difflineminus">-#</span>
<a href="#l59.9"></a><span id="l59.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l59.10"></a><span id="l59.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l59.11"></a><span id="l59.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineminus">-#</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l59.15"></a><span id="l59.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l59.16"></a><span id="l59.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l59.17"></a><span id="l59.17" class="difflineminus">-# License.</span>
<a href="#l59.18"></a><span id="l59.18" class="difflineminus">-#</span>
<a href="#l59.19"></a><span id="l59.19" class="difflineminus">-# The Original Code is tab mail</span>
<a href="#l59.20"></a><span id="l59.20" class="difflineminus">-#</span>
<a href="#l59.21"></a><span id="l59.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l59.22"></a><span id="l59.22" class="difflineminus">-#   Scott MacGregor &lt;mscott@mozilla.org&gt;.</span>
<a href="#l59.23"></a><span id="l59.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l59.24"></a><span id="l59.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l59.25"></a><span id="l59.25" class="difflineminus">-#</span>
<a href="#l59.26"></a><span id="l59.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l59.27"></a><span id="l59.27" class="difflineminus">-#</span>
<a href="#l59.28"></a><span id="l59.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l59.29"></a><span id="l59.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l59.30"></a><span id="l59.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l59.35"></a><span id="l59.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l59.36"></a><span id="l59.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l59.37"></a><span id="l59.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l59.38"></a><span id="l59.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l59.39"></a><span id="l59.39" class="difflineminus">-#</span>
<a href="#l59.40"></a><span id="l59.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l59.41"></a><span id="l59.41" class="difflineminus">-</span>
<a href="#l59.42"></a><span id="l59.42" class="difflineminus">-&lt;!DOCTYPE bindings [</span>
<a href="#l59.43"></a><span id="l59.43" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l59.44"></a><span id="l59.44" class="difflineminus">-%tabMailDTD;</span>
<a href="#l59.45"></a><span id="l59.45" class="difflineminus">-&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l59.46"></a><span id="l59.46" class="difflineminus">-%globalDTD;</span>
<a href="#l59.47"></a><span id="l59.47" class="difflineminus">-]&gt;</span>
<a href="#l59.48"></a><span id="l59.48" class="difflineminus">-</span>
<a href="#l59.49"></a><span id="l59.49" class="difflineminus">-&lt;bindings id=&quot;globalBindings&quot;</span>
<a href="#l59.50"></a><span id="l59.50" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l59.51"></a><span id="l59.51" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l59.52"></a><span id="l59.52" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l59.53"></a><span id="l59.53" class="difflineminus">-</span>
<a href="#l59.54"></a><span id="l59.54" class="difflineminus">-  &lt;binding id=&quot;tabmail-tab&quot; extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;&gt;</span>
<a href="#l59.55"></a><span id="l59.55" class="difflineminus">-    &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l59.56"></a><span id="l59.56" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l59.57"></a><span id="l59.57" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l59.58"></a><span id="l59.58" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;tab-image-middle&quot; align=&quot;center&quot; xbl:inherits=&quot;selected&quot;&gt;</span>
<a href="#l59.59"></a><span id="l59.59" class="difflineminus">-        &lt;xul:image xbl:inherits=&quot;validate,src=image&quot; class=&quot;tab-icon-image&quot;/&gt;</span>
<a href="#l59.60"></a><span id="l59.60" class="difflineminus">-        &lt;xul:label flex=&quot;1&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; class=&quot;tab-text&quot;/&gt;</span>
<a href="#l59.61"></a><span id="l59.61" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l59.62"></a><span id="l59.62" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l59.63"></a><span id="l59.63" class="difflineminus">-        &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l59.64"></a><span id="l59.64" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l59.65"></a><span id="l59.65" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l59.66"></a><span id="l59.66" class="difflineminus">-</span>
<a href="#l59.67"></a><span id="l59.67" class="difflineminus">-   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l59.68"></a><span id="l59.68" class="difflineminus">-            extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;&gt;</span>
<a href="#l59.69"></a><span id="l59.69" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l59.70"></a><span id="l59.70" class="difflineminus">-      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l59.71"></a><span id="l59.71" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l59.72"></a><span id="l59.72" class="difflineminus">-          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l59.73"></a><span id="l59.73" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l59.74"></a><span id="l59.74" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l59.75"></a><span id="l59.75" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l59.76"></a><span id="l59.76" class="difflineminus">-          &lt;xul:hbox&gt;</span>
<a href="#l59.77"></a><span id="l59.77" class="difflineminus">-            &lt;xul:stack&gt;</span>
<a href="#l59.78"></a><span id="l59.78" class="difflineminus">-              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l59.79"></a><span id="l59.79" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l59.80"></a><span id="l59.80" class="difflineminus">-            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l59.81"></a><span id="l59.81" class="difflineminus">-                                orient=&quot;horizontal&quot;</span>
<a href="#l59.82"></a><span id="l59.82" class="difflineminus">-                                flex=&quot;1&quot;</span>
<a href="#l59.83"></a><span id="l59.83" class="difflineminus">-                                style=&quot;min-width: 1px;&quot;</span>
<a href="#l59.84"></a><span id="l59.84" class="difflineminus">-                                chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l59.85"></a><span id="l59.85" class="difflineminus">-                                class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l59.86"></a><span id="l59.86" class="difflineminus">-              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l59.87"></a><span id="l59.87" class="difflineminus">-            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l59.88"></a><span id="l59.88" class="difflineminus">-            &lt;children/&gt;</span>
<a href="#l59.89"></a><span id="l59.89" class="difflineminus">-            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l59.90"></a><span id="l59.90" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l59.91"></a><span id="l59.91" class="difflineminus">-                        class=&quot;tabs-alltabs-box&quot;</span>
<a href="#l59.92"></a><span id="l59.92" class="difflineminus">-                        anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l59.93"></a><span id="l59.93" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l59.94"></a><span id="l59.94" class="difflineminus">-                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l59.95"></a><span id="l59.95" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l59.96"></a><span id="l59.96" class="difflineminus">-                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l59.97"></a><span id="l59.97" class="difflineminus">-                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l59.98"></a><span id="l59.98" class="difflineminus">-                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l59.99"></a><span id="l59.99" class="difflineminus">-                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l59.100"></a><span id="l59.100" class="difflineminus">-              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l59.101"></a><span id="l59.101" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l59.102"></a><span id="l59.102" class="difflineminus">-            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l59.103"></a><span id="l59.103" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l59.104"></a><span id="l59.104" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l59.105"></a><span id="l59.105" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l59.106"></a><span id="l59.106" class="difflineminus">-          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l59.107"></a><span id="l59.107" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l59.108"></a><span id="l59.108" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l59.109"></a><span id="l59.109" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l59.110"></a><span id="l59.110" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l59.111"></a><span id="l59.111" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/addrbook/content/abCardOverlay.xul</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/addrbook/content/abCardOverlay.xul</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -388,72 +388,49 @@</span>
<a href="#l60.4"></a><span id="l60.4">           &lt;/hbox&gt;</span>
<a href="#l60.5"></a><span id="l60.5">         &lt;/vbox&gt;</span>
<a href="#l60.6"></a><span id="l60.6">         &lt;label control=&quot;Notes&quot; value=&quot;&amp;Notes.label;&quot;</span>
<a href="#l60.7"></a><span id="l60.7">                accesskey=&quot;&amp;Notes.accesskey;&quot;/&gt;</span>
<a href="#l60.8"></a><span id="l60.8">         &lt;textbox id=&quot;Notes&quot; multiline=&quot;true&quot; wrap=&quot;virtual&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l60.9"></a><span id="l60.9">       &lt;/vbox&gt;</span>
<a href="#l60.10"></a><span id="l60.10"> </span>
<a href="#l60.11"></a><span id="l60.11">       &lt;!-- ** Photo Tab ** --&gt;</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-      &lt;vbox id=&quot;abPhotoTab&quot; &gt;</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-        &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-          &lt;vbox align=&quot;left&quot;&gt;</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l60.16"></a><span id="l60.16" class="difflineminus">-            &lt;hbox id=&quot;photoBox&quot; style=&quot;min-width: 25ch; max-width: 25ch;&quot;&gt;</span>
<a href="#l60.17"></a><span id="l60.17" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l60.18"></a><span id="l60.18" class="difflineminus">-              &lt;html:img align=&quot;center&quot; src=&quot;&quot; id=&quot;photo&quot;</span>
<a href="#l60.19"></a><span id="l60.19" class="difflineminus">-                        style=&quot;max-width: 25ch; max-height: 25ch; min-width: 1ch;&quot;/&gt;</span>
<a href="#l60.20"></a><span id="l60.20" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l60.21"></a><span id="l60.21" class="difflineplus">+      &lt;hbox id=&quot;abPhotoTab&quot; align=&quot;center&quot;&gt;</span>
<a href="#l60.22"></a><span id="l60.22" class="difflineplus">+        &lt;description style=&quot;min-width: 25ch; max-width: 25ch; text-align: center&quot;&gt;</span>
<a href="#l60.23"></a><span id="l60.23" class="difflineplus">+          &lt;html:img id=&quot;photo&quot; style=&quot;max-width: 25ch; max-height: 25ch;&quot;/&gt;</span>
<a href="#l60.24"></a><span id="l60.24" class="difflineplus">+        &lt;/description&gt;</span>
<a href="#l60.25"></a><span id="l60.25" class="difflineplus">+        &lt;groupbox flex=&quot;1&quot;&gt;</span>
<a href="#l60.26"></a><span id="l60.26" class="difflineplus">+          &lt;caption label=&quot;&amp;PhotoDesc.label;&quot;/&gt;</span>
<a href="#l60.27"></a><span id="l60.27" class="difflineplus">+          &lt;radiogroup id=&quot;PhotoType&quot; onselect=&quot;updatePhoto();&quot;&gt;</span>
<a href="#l60.28"></a><span id="l60.28" class="difflineplus">+            &lt;radio value=&quot;generic&quot; label=&quot;&amp;GenericPhoto.label;&quot;</span>
<a href="#l60.29"></a><span id="l60.29" class="difflineplus">+                   accesskey=&quot;&amp;GenericPhoto.accesskey;&quot;/&gt;</span>
<a href="#l60.30"></a><span id="l60.30" class="difflineplus">+            &lt;menulist id=&quot;GenericPhotoList&quot; class=&quot;indent&quot; flex=&quot;1&quot;</span>
<a href="#l60.31"></a><span id="l60.31" class="difflineplus">+                      oncommand=&quot;updatePhoto('generic');&quot;&gt;</span>
<a href="#l60.32"></a><span id="l60.32" class="difflineplus">+              &lt;menupopup&gt;</span>
<a href="#l60.33"></a><span id="l60.33" class="difflineplus">+                &lt;menuitem label=&quot;&amp;DefaultPhoto.label;&quot; selected=&quot;true&quot;</span>
<a href="#l60.34"></a><span id="l60.34" class="difflineplus">+                          value=&quot;chrome://messenger/skin/addressbook/icons/contact-generic.png&quot;</span>
<a href="#l60.35"></a><span id="l60.35" class="difflineplus">+                          image=&quot;chrome://messenger/skin/addressbook/icons/contact-generic-tiny.png&quot;/&gt;</span>
<a href="#l60.36"></a><span id="l60.36" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l60.37"></a><span id="l60.37" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l60.38"></a><span id="l60.38" class="difflineplus">+            &lt;radio value=&quot;file&quot; label=&quot;&amp;PhotoFile.label;&quot;</span>
<a href="#l60.39"></a><span id="l60.39" class="difflineplus">+                   accesskey=&quot;&amp;PhotoFile.accesskey;&quot;/&gt;</span>
<a href="#l60.40"></a><span id="l60.40" class="difflineplus">+            &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l60.41"></a><span id="l60.41" class="difflineplus">+              &lt;filefield id=&quot;PhotoFile&quot; maxlength=&quot;255&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l60.42"></a><span id="l60.42" class="difflineplus">+              &lt;button oncommand=&quot;browsePhoto();&quot; id=&quot;BrowsePhoto&quot;</span>
<a href="#l60.43"></a><span id="l60.43" class="difflineplus">+                      label=&quot;&amp;BrowsePhoto.label;&quot;</span>
<a href="#l60.44"></a><span id="l60.44" class="difflineplus">+                      accesskey=&quot;&amp;BrowsePhoto.accesskey;&quot;/&gt;</span>
<a href="#l60.45"></a><span id="l60.45">             &lt;/hbox&gt;</span>
<a href="#l60.46"></a><span id="l60.46" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l60.47"></a><span id="l60.47" class="difflineminus">-          &lt;/vbox&gt;</span>
<a href="#l60.48"></a><span id="l60.48" class="difflineminus">-          &lt;vbox&gt;</span>
<a href="#l60.49"></a><span id="l60.49" class="difflineminus">-            &lt;command id=&quot;PhotoCmd&quot; oncommand=&quot;updatePhoto();&quot;/&gt;</span>
<a href="#l60.50"></a><span id="l60.50" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l60.51"></a><span id="l60.51" class="difflineminus">-            &lt;groupbox flex=&quot;1&quot;&gt;</span>
<a href="#l60.52"></a><span id="l60.52" class="difflineminus">-              &lt;caption label=&quot;&amp;PhotoDesc.label;&quot;/&gt;</span>
<a href="#l60.53"></a><span id="l60.53" class="difflineminus">-              &lt;radiogroup id=&quot;PhotoType&quot;&gt;</span>
<a href="#l60.54"></a><span id="l60.54" class="difflineminus">-                &lt;radio id=&quot;generic&quot; label=&quot;&amp;GenericPhoto.label;&quot;</span>
<a href="#l60.55"></a><span id="l60.55" class="difflineminus">-                       command=&quot;PhotoCmd&quot;</span>
<a href="#l60.56"></a><span id="l60.56" class="difflineminus">-                       accesskey=&quot;&amp;GenericPhoto.accesskey;&quot;</span>
<a href="#l60.57"></a><span id="l60.57" class="difflineminus">-                       selected=&quot;true&quot;/&gt;</span>
<a href="#l60.58"></a><span id="l60.58" class="difflineminus">-                &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l60.59"></a><span id="l60.59" class="difflineminus">-                  &lt;menulist id=&quot;GenericPhotoList&quot;</span>
<a href="#l60.60"></a><span id="l60.60" class="difflineminus">-                            oncommand=&quot;updatePhoto('generic');&quot;&gt;</span>
<a href="#l60.61"></a><span id="l60.61" class="difflineminus">-                    &lt;menupopup&gt;</span>
<a href="#l60.62"></a><span id="l60.62" class="difflineminus">-                      &lt;menuitem label=&quot;&amp;DefaultPhoto.label;&quot; selected=&quot;true&quot;</span>
<a href="#l60.63"></a><span id="l60.63" class="difflineminus">-                                value=&quot;chrome://messenger/skin/addressbook/icons/contact-generic.png&quot;</span>
<a href="#l60.64"></a><span id="l60.64" class="difflineminus">-                                image=&quot;chrome://messenger/skin/addressbook/icons/contact-generic-tiny.png&quot;/&gt;</span>
<a href="#l60.65"></a><span id="l60.65" class="difflineminus">-                    &lt;/menupopup&gt;</span>
<a href="#l60.66"></a><span id="l60.66" class="difflineminus">-                  &lt;/menulist&gt;</span>
<a href="#l60.67"></a><span id="l60.67" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l60.68"></a><span id="l60.68" class="difflineminus">-                &lt;radio id=&quot;file&quot; label=&quot;&amp;PhotoFile.label;&quot;</span>
<a href="#l60.69"></a><span id="l60.69" class="difflineminus">-                       command=&quot;PhotoCmd&quot;</span>
<a href="#l60.70"></a><span id="l60.70" class="difflineminus">-                       accesskey=&quot;&amp;PhotoFile.accesskey;&quot;/&gt;</span>
<a href="#l60.71"></a><span id="l60.71" class="difflineminus">-                &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l60.72"></a><span id="l60.72" class="difflineminus">-                  &lt;filefield id=&quot;PhotoFile&quot; maxlength=&quot;255&quot; flex=&quot;1&quot;</span>
<a href="#l60.73"></a><span id="l60.73" class="difflineminus">-                             disabled=&quot;true&quot;</span>
<a href="#l60.74"></a><span id="l60.74" class="difflineminus">-                             style=&quot;-moz-margin-start:2px;&quot;/&gt;</span>
<a href="#l60.75"></a><span id="l60.75" class="difflineminus">-                  &lt;button oncommand=&quot;browsePhoto();&quot; id=&quot;BrowsePhoto&quot;</span>
<a href="#l60.76"></a><span id="l60.76" class="difflineminus">-                          label=&quot;&amp;BrowsePhoto.label;&quot;</span>
<a href="#l60.77"></a><span id="l60.77" class="difflineminus">-                          accesskey=&quot;&amp;BrowsePhoto.accesskey;&quot;/&gt;</span>
<a href="#l60.78"></a><span id="l60.78" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l60.79"></a><span id="l60.79" class="difflineminus">-                &lt;radio id=&quot;web&quot; label=&quot;&amp;PhotoURL.label;&quot;</span>
<a href="#l60.80"></a><span id="l60.80" class="difflineminus">-                       command=&quot;PhotoCmd&quot;</span>
<a href="#l60.81"></a><span id="l60.81" class="difflineminus">-                       accesskey=&quot;&amp;PhotoURL.accesskey;&quot;/&gt;</span>
<a href="#l60.82"></a><span id="l60.82" class="difflineminus">-                &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l60.83"></a><span id="l60.83" class="difflineminus">-                  &lt;textbox id=&quot;PhotoURI&quot; maxlength=&quot;255&quot; style=&quot;width: 45ch;&quot;</span>
<a href="#l60.84"></a><span id="l60.84" class="difflineminus">-                           emptytext=&quot;&amp;PhotoURL.emptytext;&quot;</span>
<a href="#l60.85"></a><span id="l60.85" class="difflineminus">-                           class=&quot;AddressCardEditWidth&quot;/&gt;</span>
<a href="#l60.86"></a><span id="l60.86" class="difflineminus">-                  &lt;button oncommand=&quot;updatePhoto('web');&quot; id=&quot;UpdatePhoto&quot;</span>
<a href="#l60.87"></a><span id="l60.87" class="difflineminus">-                          label=&quot;&amp;UpdatePhoto.label;&quot;</span>
<a href="#l60.88"></a><span id="l60.88" class="difflineminus">-                          accesskey=&quot;&amp;UpdatePhoto.accesskey;&quot;/&gt;</span>
<a href="#l60.89"></a><span id="l60.89" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l60.90"></a><span id="l60.90" class="difflineminus">-              &lt;/radiogroup&gt;</span>
<a href="#l60.91"></a><span id="l60.91" class="difflineminus">-            &lt;/groupbox&gt;</span>
<a href="#l60.92"></a><span id="l60.92" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l60.93"></a><span id="l60.93" class="difflineminus">-          &lt;/vbox&gt;</span>
<a href="#l60.94"></a><span id="l60.94" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l60.95"></a><span id="l60.95" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l60.96"></a><span id="l60.96" class="difflineplus">+            &lt;radio value=&quot;web&quot; label=&quot;&amp;PhotoURL.label;&quot;</span>
<a href="#l60.97"></a><span id="l60.97" class="difflineplus">+                   accesskey=&quot;&amp;PhotoURL.accesskey;&quot;/&gt;</span>
<a href="#l60.98"></a><span id="l60.98" class="difflineplus">+            &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l60.99"></a><span id="l60.99" class="difflineplus">+              &lt;textbox id=&quot;PhotoURI&quot; maxlength=&quot;255&quot; flex=&quot;1&quot;</span>
<a href="#l60.100"></a><span id="l60.100" class="difflineplus">+                       emptytext=&quot;&amp;PhotoURL.emptytext;&quot;/&gt;</span>
<a href="#l60.101"></a><span id="l60.101" class="difflineplus">+              &lt;button oncommand=&quot;updatePhoto('web');&quot; id=&quot;UpdatePhoto&quot;</span>
<a href="#l60.102"></a><span id="l60.102" class="difflineplus">+                      label=&quot;&amp;UpdatePhoto.label;&quot;</span>
<a href="#l60.103"></a><span id="l60.103" class="difflineplus">+                      accesskey=&quot;&amp;UpdatePhoto.accesskey;&quot;/&gt;</span>
<a href="#l60.104"></a><span id="l60.104" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l60.105"></a><span id="l60.105" class="difflineplus">+          &lt;/radiogroup&gt;</span>
<a href="#l60.106"></a><span id="l60.106" class="difflineplus">+        &lt;/groupbox&gt;</span>
<a href="#l60.107"></a><span id="l60.107" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l60.108"></a><span id="l60.108">     &lt;/tabpanels&gt;</span>
<a href="#l60.109"></a><span id="l60.109">   &lt;/tabbox&gt;</span>
<a href="#l60.110"></a><span id="l60.110"> &lt;/vbox&gt;</span>
<a href="#l60.111"></a><span id="l60.111"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -725,17 +725,17 @@ nsAbManager::ExportDirectoryToDelimitedT</span>
<a href="#l61.4"></a><span id="l61.4">                 newValue.AppendLiteral(&quot;\&quot;&quot;);</span>
<a href="#l61.5"></a><span id="l61.5">               }</span>
<a href="#l61.6"></a><span id="l61.6"> </span>
<a href="#l61.7"></a><span id="l61.7">               rv = nsMsgI18NConvertFromUnicode(nsMsgI18NFileSystemCharset(),</span>
<a href="#l61.8"></a><span id="l61.8">                                                newValue, valueCStr);</span>
<a href="#l61.9"></a><span id="l61.9">               NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11">               if (NS_FAILED(rv)) {</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-                NS_ASSERTION(0, &quot;failed to convert string to system charset.  use LDIF&quot;);</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+                NS_ERROR(&quot;failed to convert string to system charset.  use LDIF&quot;);</span>
<a href="#l61.14"></a><span id="l61.14">                 valueCStr = &quot;?&quot;;</span>
<a href="#l61.15"></a><span id="l61.15">               }</span>
<a href="#l61.16"></a><span id="l61.16"> </span>
<a href="#l61.17"></a><span id="l61.17">               length = valueCStr.Length();</span>
<a href="#l61.18"></a><span id="l61.18">               if (length) {</span>
<a href="#l61.19"></a><span id="l61.19">                 rv = outputStream-&gt;Write(valueCStr.get(), length, &amp;writeCount);</span>
<a href="#l61.20"></a><span id="l61.20">                 NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l61.21"></a><span id="l61.21">                 if (length != writeCount)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/base/content/junkCommands.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/base/content/junkCommands.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -39,17 +39,21 @@</span>
<a href="#l62.4"></a><span id="l62.4">  /* functions use for junk processing commands</span>
<a href="#l62.5"></a><span id="l62.5">   *</span>
<a href="#l62.6"></a><span id="l62.6">   * TODO: These functions make the false assumption that a view only contains</span>
<a href="#l62.7"></a><span id="l62.7">   *       a single folder. This is not true for XF saved searches.</span>
<a href="#l62.8"></a><span id="l62.8">   *</span>
<a href="#l62.9"></a><span id="l62.9">   * globals prerequisites used:</span>
<a href="#l62.10"></a><span id="l62.10">   *</span>
<a href="#l62.11"></a><span id="l62.11">   *   window.MsgStatusFeedback</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  *   GetSelectedIndices(view)</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+  *</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineplus">+  *   One of:</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineplus">+  *     GetSelectedIndices(view) (in suite)</span>
<a href="#l62.16"></a><span id="l62.16" class="difflineplus">+  *     gFolderDisplay (in mail)</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineplus">+  *</span>
<a href="#l62.18"></a><span id="l62.18">   *   messenger</span>
<a href="#l62.19"></a><span id="l62.19">   *   gMessengerBundle</span>
<a href="#l62.20"></a><span id="l62.20">   *   gDBView</span>
<a href="#l62.21"></a><span id="l62.21">   *   either gMsgFolderSelected or gFolderDisplay</span>
<a href="#l62.22"></a><span id="l62.22">   *   MsgJunkMailInfo(aCheckFirstUse)</span>
<a href="#l62.23"></a><span id="l62.23">   *   SetNextMessageAfterDelete()</span>
<a href="#l62.24"></a><span id="l62.24">   *   pref</span>
<a href="#l62.25"></a><span id="l62.25">   *   msgWindow</span>
<a href="#l62.26"></a><span id="l62.26" class="difflineat">@@ -231,16 +235,18 @@ MessageClassifier.prototype =</span>
<a href="#l62.27"></a><span id="l62.27">    *        URI of classified message</span>
<a href="#l62.28"></a><span id="l62.28">    * @param aClassification</span>
<a href="#l62.29"></a><span id="l62.29">    *        Junk classification (0: UNCLASSIFIED, 1: GOOD, 2: JUNK)</span>
<a href="#l62.30"></a><span id="l62.30">    * @param aJunkPercent</span>
<a href="#l62.31"></a><span id="l62.31">    *        0 - 100 indicator of junk likelihood, with 100 meaning probably junk</span>
<a href="#l62.32"></a><span id="l62.32">    */</span>
<a href="#l62.33"></a><span id="l62.33">   onMessageClassified: function(aClassifiedMsgURI, aClassification, aJunkPercent)</span>
<a href="#l62.34"></a><span id="l62.34">   {</span>
<a href="#l62.35"></a><span id="l62.35" class="difflineplus">+    if (!aClassifiedMsgURI)</span>
<a href="#l62.36"></a><span id="l62.36" class="difflineplus">+      return; // ignore end of batch</span>
<a href="#l62.37"></a><span id="l62.37">     var nsIJunkMailPlugin = Components.interfaces.nsIJunkMailPlugin;</span>
<a href="#l62.38"></a><span id="l62.38">     var score = (aClassification == nsIJunkMailPlugin.JUNK) ?</span>
<a href="#l62.39"></a><span id="l62.39">       nsIJunkMailPlugin.IS_SPAM_SCORE : nsIJunkMailPlugin.IS_HAM_SCORE;</span>
<a href="#l62.40"></a><span id="l62.40">     const statusDisplayInterval = 1000; // milliseconds between status updates</span>
<a href="#l62.41"></a><span id="l62.41"> </span>
<a href="#l62.42"></a><span id="l62.42">     // set these props via the db (instead of the message header</span>
<a href="#l62.43"></a><span id="l62.43">     // directly) so that the nsMsgDBView knows to update the UI</span>
<a href="#l62.44"></a><span id="l62.44">     //</span>
<a href="#l62.45"></a><span id="l62.45" class="difflineat">@@ -316,17 +322,20 @@ function processFolderForJunk(aAll)</span>
<a href="#l62.46"></a><span id="l62.46">     gDBView.doCommand(nsMsgViewCommandType.expandAll);</span>
<a href="#l62.47"></a><span id="l62.47">     var treeView = gDBView.QueryInterface(Components.interfaces.nsITreeView);</span>
<a href="#l62.48"></a><span id="l62.48">     var count = treeView.rowCount;</span>
<a href="#l62.49"></a><span id="l62.49">     if (!count)</span>
<a href="#l62.50"></a><span id="l62.50">       return;</span>
<a href="#l62.51"></a><span id="l62.51">   }</span>
<a href="#l62.52"></a><span id="l62.52">   else</span>
<a href="#l62.53"></a><span id="l62.53">   {</span>
<a href="#l62.54"></a><span id="l62.54" class="difflineminus">-    var indices = GetSelectedIndices(gDBView);</span>
<a href="#l62.55"></a><span id="l62.55" class="difflineplus">+    // suite uses GetSelectedIndices, mail uses gFolderDisplay.selectedMessages</span>
<a href="#l62.56"></a><span id="l62.56" class="difflineplus">+    var indices = typeof GetSelectedIndices != &quot;undefined&quot; ?</span>
<a href="#l62.57"></a><span id="l62.57" class="difflineplus">+                    GetSelectedIndices(gDBView) :</span>
<a href="#l62.58"></a><span id="l62.58" class="difflineplus">+                    gFolderDisplay.selectedIndices;</span>
<a href="#l62.59"></a><span id="l62.59">     if (!indices || !indices.length)</span>
<a href="#l62.60"></a><span id="l62.60">       return;</span>
<a href="#l62.61"></a><span id="l62.61">   }</span>
<a href="#l62.62"></a><span id="l62.62">   var totalMessages = aAll ? count : indices.length;</span>
<a href="#l62.63"></a><span id="l62.63"> </span>
<a href="#l62.64"></a><span id="l62.64">   // retrieve server and its spam settings via the header of an arbitrary message</span>
<a href="#l62.65"></a><span id="l62.65">   for (var i = 0; i &lt; totalMessages; i++)</span>
<a href="#l62.66"></a><span id="l62.66">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/base/content/virtualFolderProperties.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/base/content/virtualFolderProperties.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -93,16 +93,18 @@ function onLoad()</span>
<a href="#l63.4"></a><span id="l63.4">       document.getElementById(&quot;name&quot;).value = arguments.newFolderName;</span>
<a href="#l63.5"></a><span id="l63.5">     if (arguments.searchFolderURIs)</span>
<a href="#l63.6"></a><span id="l63.6">       gSearchFolderURIs = arguments.searchFolderURIs;</span>
<a href="#l63.7"></a><span id="l63.7"> </span>
<a href="#l63.8"></a><span id="l63.8">     setupSearchRows(gSearchTermSession.searchTerms);</span>
<a href="#l63.9"></a><span id="l63.9">     doEnabling(); // we only need to disable/enable the OK button for new virtual folders</span>
<a href="#l63.10"></a><span id="l63.10">   }</span>
<a href="#l63.11"></a><span id="l63.11"> </span>
<a href="#l63.12"></a><span id="l63.12" class="difflineplus">+  if (typeof arguments.searchOnline != &quot;undefined&quot;)</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+    document.getElementById('searchOnline').checked = arguments.searchOnline;</span>
<a href="#l63.14"></a><span id="l63.14">   updateOnlineSearchState();</span>
<a href="#l63.15"></a><span id="l63.15">   doSetOKCancel(onOK, onCancel);</span>
<a href="#l63.16"></a><span id="l63.16"> }</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18"> function setupSearchRows(aSearchTerms)</span>
<a href="#l63.19"></a><span id="l63.19"> {</span>
<a href="#l63.20"></a><span id="l63.20">   if (aSearchTerms &amp;&amp; aSearchTerms.Count() &gt; 0)</span>
<a href="#l63.21"></a><span id="l63.21">     initializeSearchRows(nsMsgSearchScope.offlineMail, aSearchTerms); // load the search terms for the folder</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identities-list.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identities-list.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -90,17 +90,17 @@ function refreshIdentityList()</span>
<a href="#l64.4"></a><span id="l64.4"> </span>
<a href="#l64.5"></a><span id="l64.5"> // opens the identity editor dialog</span>
<a href="#l64.6"></a><span id="l64.6"> // identity: pass in the identity (if any) to load in the dialog</span>
<a href="#l64.7"></a><span id="l64.7"> function openIdentityEditor(identity)</span>
<a href="#l64.8"></a><span id="l64.8"> {</span>
<a href="#l64.9"></a><span id="l64.9">   var result = false; </span>
<a href="#l64.10"></a><span id="l64.10">   var args = { identity: identity, account: gAccount, result: result };</span>
<a href="#l64.11"></a><span id="l64.11"> </span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  window.openDialog('am-identity-edit.xul', '', 'modal,titlebar,chrome', args);</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  window.openDialog(&quot;am-identity-edit.xul&quot;, &quot;&quot;, &quot;chrome,modal,resizable=no,centerscreen&quot;, args);</span>
<a href="#l64.14"></a><span id="l64.14"> </span>
<a href="#l64.15"></a><span id="l64.15">   var selectedItemIndex = gIdentityListBox.selectedIndex;</span>
<a href="#l64.16"></a><span id="l64.16"> </span>
<a href="#l64.17"></a><span id="l64.17">   if (args.result)</span>
<a href="#l64.18"></a><span id="l64.18">   {</span>
<a href="#l64.19"></a><span id="l64.19">     refreshIdentityList();   </span>
<a href="#l64.20"></a><span id="l64.20">     gIdentityListBox.selectedIndex = selectedItemIndex;</span>
<a href="#l64.21"></a><span id="l64.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -1,13 +1,9 @@</span>
<a href="#l65.4"></a><span id="l65.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l65.5"></a><span id="l65.5" class="difflineminus">-</span>
<a href="#l65.6"></a><span id="l65.6" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l65.7"></a><span id="l65.7" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l65.8"></a><span id="l65.8" class="difflineminus">-</span>
<a href="#l65.9"></a><span id="l65.9"> &lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l65.10"></a><span id="l65.10">  Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l65.11"></a><span id="l65.11"> </span>
<a href="#l65.12"></a><span id="l65.12">  The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l65.13"></a><span id="l65.13">  1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l65.14"></a><span id="l65.14">  the License. You may obtain a copy of the License at</span>
<a href="#l65.15"></a><span id="l65.15">  http://www.mozilla.org/MPL/</span>
<a href="#l65.16"></a><span id="l65.16"> </span>
<a href="#l65.17"></a><span id="l65.17" class="difflineat">@@ -17,17 +13,17 @@</span>
<a href="#l65.18"></a><span id="l65.18">  License.</span>
<a href="#l65.19"></a><span id="l65.19"> </span>
<a href="#l65.20"></a><span id="l65.20">  The Original Code is Mozilla Mail Code.</span>
<a href="#l65.21"></a><span id="l65.21"> </span>
<a href="#l65.22"></a><span id="l65.22">  The Initial Developer of the Original Code is</span>
<a href="#l65.23"></a><span id="l65.23">  David Bienvenu.</span>
<a href="#l65.24"></a><span id="l65.24">  Portions created by the Initial Developer are Copyright (C) 2004</span>
<a href="#l65.25"></a><span id="l65.25">  the Initial Developer. All Rights Reserved.</span>
<a href="#l65.26"></a><span id="l65.26" class="difflineminus">- </span>
<a href="#l65.27"></a><span id="l65.27" class="difflineplus">+</span>
<a href="#l65.28"></a><span id="l65.28">  Contributor(s):</span>
<a href="#l65.29"></a><span id="l65.29">    Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l65.30"></a><span id="l65.30"> </span>
<a href="#l65.31"></a><span id="l65.31">  Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l65.32"></a><span id="l65.32">  either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l65.33"></a><span id="l65.33">  or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l65.34"></a><span id="l65.34">  in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l65.35"></a><span id="l65.35">  of those above. If you wish to allow use of your version of this file only</span>
<a href="#l65.36"></a><span id="l65.36" class="difflineat">@@ -35,32 +31,35 @@</span>
<a href="#l65.37"></a><span id="l65.37">  use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l65.38"></a><span id="l65.38">  decision by deleting the provisions above and replace them with the notice</span>
<a href="#l65.39"></a><span id="l65.39">  and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l65.40"></a><span id="l65.40">  the provisions above, a recipient may use your version of this file under</span>
<a href="#l65.41"></a><span id="l65.41">  the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l65.42"></a><span id="l65.42"> </span>
<a href="#l65.43"></a><span id="l65.43">  ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l65.44"></a><span id="l65.44"> </span>
<a href="#l65.45"></a><span id="l65.45" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l65.46"></a><span id="l65.46" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l65.47"></a><span id="l65.47" class="difflineplus">+</span>
<a href="#l65.48"></a><span id="l65.48"> &lt;?xul-overlay href=&quot;chrome://messenger/content/am-copiesOverlay.xul&quot;?&gt;</span>
<a href="#l65.49"></a><span id="l65.49"> &lt;?xul-overlay href=&quot;chrome://messenger/content/am-addressingOverlay.xul&quot;?&gt;</span>
<a href="#l65.50"></a><span id="l65.50"> </span>
<a href="#l65.51"></a><span id="l65.51"> &lt;!DOCTYPE dialog [</span>
<a href="#l65.52"></a><span id="l65.52"> &lt;!ENTITY % identityEditDTD SYSTEM &quot;chrome://messenger/locale/am-identity-edit.dtd&quot; &gt;</span>
<a href="#l65.53"></a><span id="l65.53"> %identityEditDTD;</span>
<a href="#l65.54"></a><span id="l65.54"> &lt;!ENTITY % identityDTD SYSTEM &quot;chrome://messenger/locale/am-main.dtd&quot; &gt;</span>
<a href="#l65.55"></a><span id="l65.55"> %identityDTD;</span>
<a href="#l65.56"></a><span id="l65.56" class="difflineminus">-]&gt;  </span>
<a href="#l65.57"></a><span id="l65.57" class="difflineplus">+]&gt;</span>
<a href="#l65.58"></a><span id="l65.58"> </span>
<a href="#l65.59"></a><span id="l65.59"> &lt;dialog title=&quot;&amp;identityTitle.label;&quot;</span>
<a href="#l65.60"></a><span id="l65.60" class="difflineminus">-  xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l65.61"></a><span id="l65.61" class="difflineminus">-  xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l65.62"></a><span id="l65.62" class="difflineminus">-  onload=&quot;onLoadIdentityProperties();&quot;</span>
<a href="#l65.63"></a><span id="l65.63" class="difflineminus">-  ondialogaccept=&quot;return onOk();&quot;</span>
<a href="#l65.64"></a><span id="l65.64" class="difflineminus">-  style=&quot;width: 35em;&quot;&gt;</span>
<a href="#l65.65"></a><span id="l65.65" class="difflineplus">+        xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l65.66"></a><span id="l65.66" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l65.67"></a><span id="l65.67" class="difflineplus">+        onload=&quot;onLoadIdentityProperties();&quot;</span>
<a href="#l65.68"></a><span id="l65.68" class="difflineplus">+        ondialogaccept=&quot;return onOk();&quot;</span>
<a href="#l65.69"></a><span id="l65.69" class="difflineplus">+        style=&quot;&amp;identityDialog.style;&quot;&gt;</span>
<a href="#l65.70"></a><span id="l65.70"> </span>
<a href="#l65.71"></a><span id="l65.71">   &lt;stringbundle id=&quot;bundle_prefs&quot; src=&quot;chrome://messenger/locale/prefs.properties&quot;/&gt;</span>
<a href="#l65.72"></a><span id="l65.72">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l65.73"></a><span id="l65.73"> </span>
<a href="#l65.74"></a><span id="l65.74">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/am-prefs.js&quot;/&gt;</span>
<a href="#l65.75"></a><span id="l65.75">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;am-identity-edit.js&quot;/&gt;</span>
<a href="#l65.76"></a><span id="l65.76">   &lt;script type=&quot;application/x-javascript&quot;&gt;</span>
<a href="#l65.77"></a><span id="l65.77">   &lt;![CDATA[</span>
<a href="#l65.78"></a><span id="l65.78" class="difflineat">@@ -154,17 +153,17 @@</span>
<a href="#l65.79"></a><span id="l65.79">             &lt;menupopup id=&quot;smtpPopup&quot;&gt;</span>
<a href="#l65.80"></a><span id="l65.80">               &lt;menuitem value=&quot;&quot; label=&quot;&amp;smtpDefaultServer.label;&quot; id=&quot;useDefaultItem&quot;/&gt;</span>
<a href="#l65.81"></a><span id="l65.81">               &lt;menuseparator/&gt;</span>
<a href="#l65.82"></a><span id="l65.82">               &lt;!-- list will be inserted here --&gt;</span>
<a href="#l65.83"></a><span id="l65.83">             &lt;/menupopup&gt;</span>
<a href="#l65.84"></a><span id="l65.84">           &lt;/menulist&gt;</span>
<a href="#l65.85"></a><span id="l65.85">         &lt;/hbox&gt;</span>
<a href="#l65.86"></a><span id="l65.86">       &lt;/vbox&gt;</span>
<a href="#l65.87"></a><span id="l65.87" class="difflineminus">-      </span>
<a href="#l65.88"></a><span id="l65.88" class="difflineplus">+</span>
<a href="#l65.89"></a><span id="l65.89">       &lt;!-- Copies &amp; Folders Tab --&gt; </span>
<a href="#l65.90"></a><span id="l65.90">       &lt;vbox flex=&quot;1&quot; name=&quot;copiesAndFolders&quot; id=&quot;copiesAndFolders&quot;/&gt;</span>
<a href="#l65.91"></a><span id="l65.91"> </span>
<a href="#l65.92"></a><span id="l65.92">       &lt;!-- Composition &amp; Addressing Tab --&gt; </span>
<a href="#l65.93"></a><span id="l65.93">       &lt;vbox flex=&quot;1&quot; name=&quot;composeAddressing&quot; id=&quot;compositionAndAddressing&quot;/&gt;</span>
<a href="#l65.94"></a><span id="l65.94"> </span>
<a href="#l65.95"></a><span id="l65.95">     &lt;/tabpanels&gt; </span>
<a href="#l65.96"></a><span id="l65.96">   &lt;/tabbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-main.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-main.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -73,16 +73,16 @@ function manageIdentities()</span>
<a href="#l66.4"></a><span id="l66.4"> </span>
<a href="#l66.5"></a><span id="l66.5">   var args = { account: account, accountName: accountName, result: false };</span>
<a href="#l66.6"></a><span id="l66.6"> </span>
<a href="#l66.7"></a><span id="l66.7">   // save the current identity settings so they show up correctly</span>
<a href="#l66.8"></a><span id="l66.8">   // if the user just changed them in the manage identities dialog</span>
<a href="#l66.9"></a><span id="l66.9">   var identity = account.defaultIdentity;</span>
<a href="#l66.10"></a><span id="l66.10">   saveIdentitySettings(identity);</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-  window.openDialog('am-identities-list.xul', 'identity', 'modal,titlebar,chrome', args);</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+  window.openDialog(&quot;am-identities-list.xul&quot;, &quot;&quot;, &quot;chrome,modal,resizable=no,centerscreen&quot;, args);</span>
<a href="#l66.14"></a><span id="l66.14"> </span>
<a href="#l66.15"></a><span id="l66.15">   if (args.result) {</span>
<a href="#l66.16"></a><span id="l66.16">     // now re-initialize the default identity settings in case they changed</span>
<a href="#l66.17"></a><span id="l66.17">     identity = account.defaultIdentity; // refetch the default identity in case it changed</span>
<a href="#l66.18"></a><span id="l66.18">     initIdentityValues(identity);</span>
<a href="#l66.19"></a><span id="l66.19">   }</span>
<a href="#l66.20"></a><span id="l66.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -54,17 +54,17 @@ interface nsILocalFile;</span>
<a href="#l67.4"></a><span id="l67.4"> interface nsIURI;</span>
<a href="#l67.5"></a><span id="l67.5"> </span>
<a href="#l67.6"></a><span id="l67.6"> /*</span>
<a href="#l67.7"></a><span id="l67.7">  * Interface for incoming mail/news host</span>
<a href="#l67.8"></a><span id="l67.8">  * this is the base interface for all mail server types (imap, pop, nntp, etc)</span>
<a href="#l67.9"></a><span id="l67.9">  * often you will want to add extra interfaces that give you server-specific</span>
<a href="#l67.10"></a><span id="l67.10">  * attributes and methods.</span>
<a href="#l67.11"></a><span id="l67.11">  */</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-[scriptable, uuid(20B4A762-10F5-4ce7-99CC-F07C10236E20)]</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+[scriptable, uuid(cca9b826-24d8-4b76-b229-b8b12f1ecbd5)]</span>
<a href="#l67.14"></a><span id="l67.14"> interface nsIMsgIncomingServer : nsISupports {</span>
<a href="#l67.15"></a><span id="l67.15"> </span>
<a href="#l67.16"></a><span id="l67.16">   /**</span>
<a href="#l67.17"></a><span id="l67.17">    * internal pref key - guaranteed to be unique across all servers</span>
<a href="#l67.18"></a><span id="l67.18">    */</span>
<a href="#l67.19"></a><span id="l67.19">   attribute ACString key;</span>
<a href="#l67.20"></a><span id="l67.20"> </span>
<a href="#l67.21"></a><span id="l67.21">   /**</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineat">@@ -118,18 +118,34 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l67.23"></a><span id="l67.23">   readonly attribute ACString localStoreType;</span>
<a href="#l67.24"></a><span id="l67.24"> </span>
<a href="#l67.25"></a><span id="l67.25">   // Perform specific tasks (reset flags, remove files, etc) for account user/server name changes.</span>
<a href="#l67.26"></a><span id="l67.26">   void onUserOrHostNameChanged(in ACString oldName, in ACString newName);</span>
<a href="#l67.27"></a><span id="l67.27">   </span>
<a href="#l67.28"></a><span id="l67.28">   /* cleartext version of the password */</span>
<a href="#l67.29"></a><span id="l67.29">   attribute ACString password;</span>
<a href="#l67.30"></a><span id="l67.30"> </span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-  /* prompt the user for a password */</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineminus">-  ACString getPasswordWithUI(in AString aPromptString, in AString aPromptTitle, in nsIMsgWindow aMsgWindow, out boolean okayValue);</span>
<a href="#l67.33"></a><span id="l67.33" class="difflineplus">+  /**</span>
<a href="#l67.34"></a><span id="l67.34" class="difflineplus">+   * Attempts to get the password first from the password manager, if that</span>
<a href="#l67.35"></a><span id="l67.35" class="difflineplus">+   * fails it will attempt to get it from the user if aMsgWindow is supplied.</span>
<a href="#l67.36"></a><span id="l67.36" class="difflineplus">+   *</span>
<a href="#l67.37"></a><span id="l67.37" class="difflineplus">+   * @param aPromptString  The text of the prompt if the user is prompted for</span>
<a href="#l67.38"></a><span id="l67.38" class="difflineplus">+   *                       password.</span>
<a href="#l67.39"></a><span id="l67.39" class="difflineplus">+   * @param aPromptTitle   The title of the prompt if the user is prompted.</span>
<a href="#l67.40"></a><span id="l67.40" class="difflineplus">+   * @param aMsgWindow     A message window to associate the prompt with.</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineplus">+   * @return               The obtained password. Could be an empty password.</span>
<a href="#l67.42"></a><span id="l67.42" class="difflineplus">+   *</span>
<a href="#l67.43"></a><span id="l67.43" class="difflineplus">+   * @exception NS_ERROR_FAILURE  The password could not be obtained.</span>
<a href="#l67.44"></a><span id="l67.44" class="difflineplus">+   *</span>
<a href="#l67.45"></a><span id="l67.45" class="difflineplus">+   * @note NS_MSG_PASSWORD_PROMPT_CANCELLED is a success code that is returned</span>
<a href="#l67.46"></a><span id="l67.46" class="difflineplus">+   *       if the prompt was presented to the user but the user cancelled the</span>
<a href="#l67.47"></a><span id="l67.47" class="difflineplus">+   *       prompt.</span>
<a href="#l67.48"></a><span id="l67.48" class="difflineplus">+   */</span>
<a href="#l67.49"></a><span id="l67.49" class="difflineplus">+  ACString getPasswordWithUI(in AString aPromptString, in AString aPromptTitle,</span>
<a href="#l67.50"></a><span id="l67.50" class="difflineplus">+                             in nsIMsgWindow aMsgWindow);</span>
<a href="#l67.51"></a><span id="l67.51"> </span>
<a href="#l67.52"></a><span id="l67.52">   /* forget the password in memory and in single signon database */</span>
<a href="#l67.53"></a><span id="l67.53">   void forgetPassword();</span>
<a href="#l67.54"></a><span id="l67.54"> </span>
<a href="#l67.55"></a><span id="l67.55">   /* forget the password in memory which is cached for the session */</span>
<a href="#l67.56"></a><span id="l67.56">   void forgetSessionPassword();</span>
<a href="#l67.57"></a><span id="l67.57"> </span>
<a href="#l67.58"></a><span id="l67.58">   /* should we download whole messages when biff goes off? */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -197,33 +197,41 @@ protected:</span>
<a href="#l68.4"></a><span id="l68.4">   // object makes cleanup of these tables (at shutdown-time) automagic.</span>
<a href="#l68.5"></a><span id="l68.5"> </span>
<a href="#l68.6"></a><span id="l68.6">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_offlineMailTable;</span>
<a href="#l68.7"></a><span id="l68.7">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_offlineMailFilterTable;</span>
<a href="#l68.8"></a><span id="l68.8">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_onlineMailTable;</span>
<a href="#l68.9"></a><span id="l68.9">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_onlineMailFilterTable;</span>
<a href="#l68.10"></a><span id="l68.10">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_onlineManualFilterTable;</span>
<a href="#l68.11"></a><span id="l68.11"> </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_newsTable;</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineminus">-  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsTable; // used for local news searching or offline news searching...</span>
<a href="#l68.14"></a><span id="l68.14" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_newsTable;      // online news</span>
<a href="#l68.15"></a><span id="l68.15" class="difflineplus">+</span>
<a href="#l68.16"></a><span id="l68.16" class="difflineplus">+  // Local news tables, used for local news searching or offline.</span>
<a href="#l68.17"></a><span id="l68.17" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsTable;         // base table</span>
<a href="#l68.18"></a><span id="l68.18" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsJunkTable;     // base + junk</span>
<a href="#l68.19"></a><span id="l68.19" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsBodyTable;     // base + body</span>
<a href="#l68.20"></a><span id="l68.20" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsJunkBodyTable; // base + junk + body</span>
<a href="#l68.21"></a><span id="l68.21">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_ldapTable;</span>
<a href="#l68.22"></a><span id="l68.22">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_ldapAndTable;</span>
<a href="#l68.23"></a><span id="l68.23">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localABTable;</span>
<a href="#l68.24"></a><span id="l68.24">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localABAndTable;</span>
<a href="#l68.25"></a><span id="l68.25">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_newsFilterTable;</span>
<a href="#l68.26"></a><span id="l68.26"> </span>
<a href="#l68.27"></a><span id="l68.27">   nsresult NewTable (nsIMsgSearchValidityTable **);</span>
<a href="#l68.28"></a><span id="l68.28"> </span>
<a href="#l68.29"></a><span id="l68.29">   nsresult InitOfflineMailTable();</span>
<a href="#l68.30"></a><span id="l68.30">   nsresult InitOfflineMailFilterTable();</span>
<a href="#l68.31"></a><span id="l68.31">   nsresult InitOnlineMailTable();</span>
<a href="#l68.32"></a><span id="l68.32">   nsresult InitOnlineMailFilterTable();</span>
<a href="#l68.33"></a><span id="l68.33">   nsresult InitOnlineManualFilterTable();</span>
<a href="#l68.34"></a><span id="l68.34">   nsresult InitNewsTable();</span>
<a href="#l68.35"></a><span id="l68.35">   nsresult InitLocalNewsTable();</span>
<a href="#l68.36"></a><span id="l68.36" class="difflineplus">+  nsresult InitLocalNewsJunkTable();</span>
<a href="#l68.37"></a><span id="l68.37" class="difflineplus">+  nsresult InitLocalNewsBodyTable();</span>
<a href="#l68.38"></a><span id="l68.38" class="difflineplus">+  nsresult InitLocalNewsJunkBodyTable();</span>
<a href="#l68.39"></a><span id="l68.39">   nsresult InitNewsFilterTable();</span>
<a href="#l68.40"></a><span id="l68.40"> </span>
<a href="#l68.41"></a><span id="l68.41">   //set the custom headers in the table, changes whenever &quot;mailnews.customHeaders&quot; pref changes.</span>
<a href="#l68.42"></a><span id="l68.42">   nsresult SetOtherHeadersInTable(nsIMsgSearchValidityTable *table, const char *customHeaders);</span>
<a href="#l68.43"></a><span id="l68.43"> </span>
<a href="#l68.44"></a><span id="l68.44">   nsresult InitLdapTable();</span>
<a href="#l68.45"></a><span id="l68.45">   nsresult InitLdapAndTable();</span>
<a href="#l68.46"></a><span id="l68.46">   nsresult InitLocalABTable();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -48,27 +48,34 @@ interface nsIMsgDBHdr;</span>
<a href="#l69.4"></a><span id="l69.4"> </span>
<a href="#l69.5"></a><span id="l69.5"> [scriptable, uuid(5fe70a74-304e-11d3-9be1-00a0c900d445)]</span>
<a href="#l69.6"></a><span id="l69.6"> </span>
<a href="#l69.7"></a><span id="l69.7"> interface nsMsgSearchScope {</span>
<a href="#l69.8"></a><span id="l69.8">   const nsMsgSearchScopeValue offlineMail = 0;</span>
<a href="#l69.9"></a><span id="l69.9">   const nsMsgSearchScopeValue offlineMailFilter = 1;</span>
<a href="#l69.10"></a><span id="l69.10">   const nsMsgSearchScopeValue onlineMail = 2;</span>
<a href="#l69.11"></a><span id="l69.11">   const nsMsgSearchScopeValue onlineMailFilter = 3;</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineplus">+  /// offline news, base table, no body or junk</span>
<a href="#l69.13"></a><span id="l69.13">   const nsMsgSearchScopeValue localNews = 4;</span>
<a href="#l69.14"></a><span id="l69.14">   const nsMsgSearchScopeValue news = 5;</span>
<a href="#l69.15"></a><span id="l69.15">   const nsMsgSearchScopeValue newsEx = 6;</span>
<a href="#l69.16"></a><span id="l69.16">   const nsMsgSearchScopeValue LDAP = 7;</span>
<a href="#l69.17"></a><span id="l69.17">   const nsMsgSearchScopeValue LocalAB = 8;</span>
<a href="#l69.18"></a><span id="l69.18">   const nsMsgSearchScopeValue allSearchableGroups = 9;</span>
<a href="#l69.19"></a><span id="l69.19">   const nsMsgSearchScopeValue newsFilter = 10;</span>
<a href="#l69.20"></a><span id="l69.20">   const nsMsgSearchScopeValue LocalABAnd = 11;</span>
<a href="#l69.21"></a><span id="l69.21">   const nsMsgSearchScopeValue LDAPAnd = 12;</span>
<a href="#l69.22"></a><span id="l69.22">   // IMAP and NEWS, searched using local headers</span>
<a href="#l69.23"></a><span id="l69.23">   const nsMsgSearchScopeValue onlineManual = 13;</span>
<a href="#l69.24"></a><span id="l69.24" class="difflineplus">+  /// local news + junk</span>
<a href="#l69.25"></a><span id="l69.25" class="difflineplus">+  const nsMsgSearchScopeValue localNewsJunk = 14;</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineplus">+  /// local news + body</span>
<a href="#l69.27"></a><span id="l69.27" class="difflineplus">+  const nsMsgSearchScopeValue localNewsBody = 15;</span>
<a href="#l69.28"></a><span id="l69.28" class="difflineplus">+  /// local news + junk + body</span>
<a href="#l69.29"></a><span id="l69.29" class="difflineplus">+  const nsMsgSearchScopeValue localNewsJunkBody = 16;</span>
<a href="#l69.30"></a><span id="l69.30"> };</span>
<a href="#l69.31"></a><span id="l69.31"> </span>
<a href="#l69.32"></a><span id="l69.32"> typedef long nsMsgSearchAttribValue;</span>
<a href="#l69.33"></a><span id="l69.33"> </span>
<a href="#l69.34"></a><span id="l69.34"> /**</span>
<a href="#l69.35"></a><span id="l69.35">  * Definitions of search attribute types. The numerical order</span>
<a href="#l69.36"></a><span id="l69.36">  * from here will also be used to determine the order that the</span>
<a href="#l69.37"></a><span id="l69.37">  * attributes display in the filter editor.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -873,81 +873,173 @@ nsresult nsMsgSearchOfflineNews::OpenSum</span>
<a href="#l70.4"></a><span id="l70.4">   return err;</span>
<a href="#l70.5"></a><span id="l70.5"> }</span>
<a href="#l70.6"></a><span id="l70.6"> </span>
<a href="#l70.7"></a><span id="l70.7"> nsresult nsMsgSearchOfflineNews::ValidateTerms ()</span>
<a href="#l70.8"></a><span id="l70.8"> {</span>
<a href="#l70.9"></a><span id="l70.9">   return nsMsgSearchOfflineMail::ValidateTerms ();</span>
<a href="#l70.10"></a><span id="l70.10"> }</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineplus">+// local helper functions to set subsets of the validity table</span>
<a href="#l70.13"></a><span id="l70.13"> </span>
<a href="#l70.14"></a><span id="l70.14" class="difflineminus">-//-----------------------------------------------------------------------------</span>
<a href="#l70.15"></a><span id="l70.15" class="difflineplus">+nsresult SetJunk(nsIMsgSearchValidityTable* aTable)</span>
<a href="#l70.16"></a><span id="l70.16" class="difflineplus">+{</span>
<a href="#l70.17"></a><span id="l70.17" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aTable);</span>
<a href="#l70.18"></a><span id="l70.18" class="difflineplus">+</span>
<a href="#l70.19"></a><span id="l70.19" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.20"></a><span id="l70.20" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.21"></a><span id="l70.21" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.22"></a><span id="l70.22" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.23"></a><span id="l70.23" class="difflineplus">+</span>
<a href="#l70.24"></a><span id="l70.24" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l70.25"></a><span id="l70.25" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l70.26"></a><span id="l70.26" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l70.27"></a><span id="l70.27" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l70.28"></a><span id="l70.28" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.29"></a><span id="l70.29" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.30"></a><span id="l70.30" class="difflineplus">+</span>
<a href="#l70.31"></a><span id="l70.31" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.32"></a><span id="l70.32" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.33"></a><span id="l70.33" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.34"></a><span id="l70.34" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.35"></a><span id="l70.35" class="difflineplus">+</span>
<a href="#l70.36"></a><span id="l70.36" class="difflineplus">+  return NS_OK;</span>
<a href="#l70.37"></a><span id="l70.37" class="difflineplus">+}</span>
<a href="#l70.38"></a><span id="l70.38" class="difflineplus">+</span>
<a href="#l70.39"></a><span id="l70.39" class="difflineplus">+nsresult SetBody(nsIMsgSearchValidityTable* aTable)</span>
<a href="#l70.40"></a><span id="l70.40" class="difflineplus">+{</span>
<a href="#l70.41"></a><span id="l70.41" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aTable);</span>
<a href="#l70.42"></a><span id="l70.42" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.43"></a><span id="l70.43" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.44"></a><span id="l70.44" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.45"></a><span id="l70.45" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.46"></a><span id="l70.46" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.47"></a><span id="l70.47" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.48"></a><span id="l70.48" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.49"></a><span id="l70.49" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.50"></a><span id="l70.50" class="difflineplus">+</span>
<a href="#l70.51"></a><span id="l70.51" class="difflineplus">+  return NS_OK;</span>
<a href="#l70.52"></a><span id="l70.52" class="difflineplus">+}</span>
<a href="#l70.53"></a><span id="l70.53" class="difflineplus">+</span>
<a href="#l70.54"></a><span id="l70.54" class="difflineplus">+// set the base validity table values for local news</span>
<a href="#l70.55"></a><span id="l70.55" class="difflineplus">+nsresult SetLocalNews(nsIMsgSearchValidityTable* aTable)</span>
<a href="#l70.56"></a><span id="l70.56" class="difflineplus">+{</span>
<a href="#l70.57"></a><span id="l70.57" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aTable);</span>
<a href="#l70.58"></a><span id="l70.58" class="difflineplus">+</span>
<a href="#l70.59"></a><span id="l70.59" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.60"></a><span id="l70.60" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.61"></a><span id="l70.61" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.62"></a><span id="l70.62" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.63"></a><span id="l70.63" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.64"></a><span id="l70.64" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.65"></a><span id="l70.65" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.66"></a><span id="l70.66" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.67"></a><span id="l70.67" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.68"></a><span id="l70.68" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.69"></a><span id="l70.69" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.70"></a><span id="l70.70" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.71"></a><span id="l70.71" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l70.72"></a><span id="l70.72" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l70.73"></a><span id="l70.73" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l70.74"></a><span id="l70.74" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l70.75"></a><span id="l70.75" class="difflineplus">+</span>
<a href="#l70.76"></a><span id="l70.76" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.77"></a><span id="l70.77" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.78"></a><span id="l70.78" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.79"></a><span id="l70.79" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.80"></a><span id="l70.80" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.81"></a><span id="l70.81" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.82"></a><span id="l70.82" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.83"></a><span id="l70.83" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.84"></a><span id="l70.84" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.85"></a><span id="l70.85" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.86"></a><span id="l70.86" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.87"></a><span id="l70.87" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.88"></a><span id="l70.88" class="difflineplus">+</span>
<a href="#l70.89"></a><span id="l70.89" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l70.90"></a><span id="l70.90" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l70.91"></a><span id="l70.91" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l70.92"></a><span id="l70.92" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l70.93"></a><span id="l70.93" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.94"></a><span id="l70.94" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.95"></a><span id="l70.95" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.96"></a><span id="l70.96" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.97"></a><span id="l70.97" class="difflineplus">+</span>
<a href="#l70.98"></a><span id="l70.98" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l70.99"></a><span id="l70.99" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l70.100"></a><span id="l70.100" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l70.101"></a><span id="l70.101" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l70.102"></a><span id="l70.102" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is,  1);</span>
<a href="#l70.103"></a><span id="l70.103" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.104"></a><span id="l70.104" class="difflineplus">+</span>
<a href="#l70.105"></a><span id="l70.105" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.106"></a><span id="l70.106" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.107"></a><span id="l70.107" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.108"></a><span id="l70.108" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.109"></a><span id="l70.109" class="difflineplus">+</span>
<a href="#l70.110"></a><span id="l70.110" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.111"></a><span id="l70.111" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.112"></a><span id="l70.112" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.113"></a><span id="l70.113" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.114"></a><span id="l70.114" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.115"></a><span id="l70.115" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.116"></a><span id="l70.116" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.117"></a><span id="l70.117" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.118"></a><span id="l70.118" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l70.119"></a><span id="l70.119" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l70.120"></a><span id="l70.120" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l70.121"></a><span id="l70.121" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l70.122"></a><span id="l70.122" class="difflineplus">+</span>
<a href="#l70.123"></a><span id="l70.123" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.124"></a><span id="l70.124" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.125"></a><span id="l70.125" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.126"></a><span id="l70.126" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.127"></a><span id="l70.127" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.128"></a><span id="l70.128" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.129"></a><span id="l70.129" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.130"></a><span id="l70.130" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.131"></a><span id="l70.131" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.132"></a><span id="l70.132" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.133"></a><span id="l70.133" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.134"></a><span id="l70.134" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.135"></a><span id="l70.135" class="difflineplus">+  return NS_OK;</span>
<a href="#l70.136"></a><span id="l70.136" class="difflineplus">+</span>
<a href="#l70.137"></a><span id="l70.137" class="difflineplus">+}</span>
<a href="#l70.138"></a><span id="l70.138" class="difflineplus">+</span>
<a href="#l70.139"></a><span id="l70.139"> nsresult nsMsgSearchValidityManager::InitLocalNewsTable()</span>
<a href="#l70.140"></a><span id="l70.140"> {</span>
<a href="#l70.141"></a><span id="l70.141" class="difflineminus">-  NS_ASSERTION (nsnull == m_localNewsTable, &quot;already have local news validty table&quot;);</span>
<a href="#l70.142"></a><span id="l70.142" class="difflineminus">-  nsresult err = NewTable (getter_AddRefs(m_localNewsTable));</span>
<a href="#l70.143"></a><span id="l70.143" class="difflineminus">-</span>
<a href="#l70.144"></a><span id="l70.144" class="difflineminus">-  if (NS_SUCCEEDED(err))</span>
<a href="#l70.145"></a><span id="l70.145" class="difflineminus">-  {</span>
<a href="#l70.146"></a><span id="l70.146" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.147"></a><span id="l70.147" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.148"></a><span id="l70.148" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.149"></a><span id="l70.149" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.150"></a><span id="l70.150" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.151"></a><span id="l70.151" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.152"></a><span id="l70.152" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.153"></a><span id="l70.153" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.154"></a><span id="l70.154" class="difflineminus">-</span>
<a href="#l70.155"></a><span id="l70.155" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.156"></a><span id="l70.156" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.157"></a><span id="l70.157" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.158"></a><span id="l70.158" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.159"></a><span id="l70.159" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.160"></a><span id="l70.160" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.161"></a><span id="l70.161" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.162"></a><span id="l70.162" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.163"></a><span id="l70.163" class="difflineminus">-</span>
<a href="#l70.164"></a><span id="l70.164" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.165"></a><span id="l70.165" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.166"></a><span id="l70.166" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.167"></a><span id="l70.167" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l70.168"></a><span id="l70.168" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.169"></a><span id="l70.169" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.170"></a><span id="l70.170" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.171"></a><span id="l70.171" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.172"></a><span id="l70.172" class="difflineminus">-</span>
<a href="#l70.173"></a><span id="l70.173" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsTable, &quot;already have local news validity table&quot;);</span>
<a href="#l70.174"></a><span id="l70.174" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsTable));</span>
<a href="#l70.175"></a><span id="l70.175" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.176"></a><span id="l70.176" class="difflineplus">+  return SetLocalNews(m_localNewsTable);</span>
<a href="#l70.177"></a><span id="l70.177" class="difflineplus">+}</span>
<a href="#l70.178"></a><span id="l70.178"> </span>
<a href="#l70.179"></a><span id="l70.179" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l70.180"></a><span id="l70.180" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l70.181"></a><span id="l70.181" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l70.182"></a><span id="l70.182" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.183"></a><span id="l70.183" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.184"></a><span id="l70.184" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.185"></a><span id="l70.185" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.186"></a><span id="l70.186" class="difflineminus">-</span>
<a href="#l70.187"></a><span id="l70.187" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l70.188"></a><span id="l70.188" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l70.189"></a><span id="l70.189" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l70.190"></a><span id="l70.190" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l70.191"></a><span id="l70.191" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is,  1);</span>
<a href="#l70.192"></a><span id="l70.192" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.193"></a><span id="l70.193" class="difflineminus">-</span>
<a href="#l70.194"></a><span id="l70.194" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.195"></a><span id="l70.195" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.196"></a><span id="l70.196" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.197"></a><span id="l70.197" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l70.198"></a><span id="l70.198" class="difflineminus">-</span>
<a href="#l70.199"></a><span id="l70.199" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.200"></a><span id="l70.200" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l70.201"></a><span id="l70.201" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.202"></a><span id="l70.202" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l70.203"></a><span id="l70.203" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.204"></a><span id="l70.204" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l70.205"></a><span id="l70.205" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.206"></a><span id="l70.206" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l70.207"></a><span id="l70.207" class="difflineminus">-</span>
<a href="#l70.208"></a><span id="l70.208" class="difflineminus">-</span>
<a href="#l70.209"></a><span id="l70.209" class="difflineminus">-  }</span>
<a href="#l70.210"></a><span id="l70.210" class="difflineminus">-</span>
<a href="#l70.211"></a><span id="l70.211" class="difflineminus">-  return err;</span>
<a href="#l70.212"></a><span id="l70.212" class="difflineplus">+nsresult nsMsgSearchValidityManager::InitLocalNewsBodyTable()</span>
<a href="#l70.213"></a><span id="l70.213" class="difflineplus">+{</span>
<a href="#l70.214"></a><span id="l70.214" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsBodyTable, &quot;already have local news+body validity table&quot;);</span>
<a href="#l70.215"></a><span id="l70.215" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsBodyTable));</span>
<a href="#l70.216"></a><span id="l70.216" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.217"></a><span id="l70.217" class="difflineplus">+  rv = SetLocalNews(m_localNewsBodyTable);</span>
<a href="#l70.218"></a><span id="l70.218" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.219"></a><span id="l70.219" class="difflineplus">+  return SetBody(m_localNewsBodyTable);</span>
<a href="#l70.220"></a><span id="l70.220"> }</span>
<a href="#l70.221"></a><span id="l70.221"> </span>
<a href="#l70.222"></a><span id="l70.222" class="difflineplus">+nsresult nsMsgSearchValidityManager::InitLocalNewsJunkTable()</span>
<a href="#l70.223"></a><span id="l70.223" class="difflineplus">+{</span>
<a href="#l70.224"></a><span id="l70.224" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsJunkTable, &quot;already have local news+junk validity table&quot;);</span>
<a href="#l70.225"></a><span id="l70.225" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsJunkTable));</span>
<a href="#l70.226"></a><span id="l70.226" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.227"></a><span id="l70.227" class="difflineplus">+  rv = SetLocalNews(m_localNewsJunkTable);</span>
<a href="#l70.228"></a><span id="l70.228" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.229"></a><span id="l70.229" class="difflineplus">+  return SetJunk(m_localNewsJunkTable);</span>
<a href="#l70.230"></a><span id="l70.230" class="difflineplus">+}</span>
<a href="#l70.231"></a><span id="l70.231"> </span>
<a href="#l70.232"></a><span id="l70.232" class="difflineplus">+nsresult nsMsgSearchValidityManager::InitLocalNewsJunkBodyTable()</span>
<a href="#l70.233"></a><span id="l70.233" class="difflineplus">+{</span>
<a href="#l70.234"></a><span id="l70.234" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsJunkBodyTable, &quot;already have local news+junk+body validity table&quot;);</span>
<a href="#l70.235"></a><span id="l70.235" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsJunkBodyTable));</span>
<a href="#l70.236"></a><span id="l70.236" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.237"></a><span id="l70.237" class="difflineplus">+  rv = SetLocalNews(m_localNewsJunkBodyTable);</span>
<a href="#l70.238"></a><span id="l70.238" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.239"></a><span id="l70.239" class="difflineplus">+  rv = SetJunk(m_localNewsJunkBodyTable);</span>
<a href="#l70.240"></a><span id="l70.240" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l70.241"></a><span id="l70.241" class="difflineplus">+  return SetBody(m_localNewsJunkBodyTable);</span>
<a href="#l70.242"></a><span id="l70.242" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -1044,16 +1044,38 @@ NS_IMETHODIMP nsMsgSearchValidityManager</span>
<a href="#l71.4"></a><span id="l71.4">     break;</span>
<a href="#l71.5"></a><span id="l71.5">   case nsMsgSearchScope::localNews:</span>
<a href="#l71.6"></a><span id="l71.6">     if (!m_localNewsTable)</span>
<a href="#l71.7"></a><span id="l71.7">       rv = InitLocalNewsTable();</span>
<a href="#l71.8"></a><span id="l71.8">     if (m_localNewsTable)</span>
<a href="#l71.9"></a><span id="l71.9">       rv = SetOtherHeadersInTable(m_localNewsTable, customHeaders.get());</span>
<a href="#l71.10"></a><span id="l71.10">     *ppOutTable = m_localNewsTable;</span>
<a href="#l71.11"></a><span id="l71.11">     break;</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineplus">+  case nsMsgSearchScope::localNewsJunk:</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+    if (!m_localNewsJunkTable)</span>
<a href="#l71.14"></a><span id="l71.14" class="difflineplus">+      rv = InitLocalNewsJunkTable();</span>
<a href="#l71.15"></a><span id="l71.15" class="difflineplus">+    if (m_localNewsJunkTable)</span>
<a href="#l71.16"></a><span id="l71.16" class="difflineplus">+      rv = SetOtherHeadersInTable(m_localNewsJunkTable, customHeaders.get());</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineplus">+    *ppOutTable = m_localNewsJunkTable;</span>
<a href="#l71.18"></a><span id="l71.18" class="difflineplus">+    break;</span>
<a href="#l71.19"></a><span id="l71.19" class="difflineplus">+  case nsMsgSearchScope::localNewsBody:</span>
<a href="#l71.20"></a><span id="l71.20" class="difflineplus">+    if (!m_localNewsBodyTable)</span>
<a href="#l71.21"></a><span id="l71.21" class="difflineplus">+      rv = InitLocalNewsBodyTable();</span>
<a href="#l71.22"></a><span id="l71.22" class="difflineplus">+    if (m_localNewsBodyTable)</span>
<a href="#l71.23"></a><span id="l71.23" class="difflineplus">+      rv = SetOtherHeadersInTable(m_localNewsBodyTable, customHeaders.get());</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineplus">+    *ppOutTable = m_localNewsBodyTable;</span>
<a href="#l71.25"></a><span id="l71.25" class="difflineplus">+    break;</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineplus">+  case nsMsgSearchScope::localNewsJunkBody:</span>
<a href="#l71.27"></a><span id="l71.27" class="difflineplus">+    if (!m_localNewsJunkBodyTable)</span>
<a href="#l71.28"></a><span id="l71.28" class="difflineplus">+      rv = InitLocalNewsJunkBodyTable();</span>
<a href="#l71.29"></a><span id="l71.29" class="difflineplus">+    if (m_localNewsJunkBodyTable)</span>
<a href="#l71.30"></a><span id="l71.30" class="difflineplus">+      rv = SetOtherHeadersInTable(m_localNewsJunkBodyTable, customHeaders.get());</span>
<a href="#l71.31"></a><span id="l71.31" class="difflineplus">+    *ppOutTable = m_localNewsJunkBodyTable;</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineplus">+    break;</span>
<a href="#l71.33"></a><span id="l71.33" class="difflineplus">+</span>
<a href="#l71.34"></a><span id="l71.34">   case nsMsgSearchScope::onlineManual:</span>
<a href="#l71.35"></a><span id="l71.35">     if (!m_onlineManualFilterTable)</span>
<a href="#l71.36"></a><span id="l71.36">       rv = InitOnlineManualFilterTable();</span>
<a href="#l71.37"></a><span id="l71.37">     if (m_onlineManualFilterTable)</span>
<a href="#l71.38"></a><span id="l71.38">       rv = SetOtherHeadersInTable(m_onlineManualFilterTable, customHeaders.get());</span>
<a href="#l71.39"></a><span id="l71.39">     *ppOutTable = m_onlineManualFilterTable;</span>
<a href="#l71.40"></a><span id="l71.40">     break;</span>
<a href="#l71.41"></a><span id="l71.41">   case nsMsgSearchScope::LDAP:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -1941,31 +1941,35 @@ nsresult nsMsgSearchScopeTerm::Initializ</span>
<a href="#l72.4"></a><span id="l72.4">   nsresult err = NS_OK;</span>
<a href="#l72.5"></a><span id="l72.5"> </span>
<a href="#l72.6"></a><span id="l72.6">   switch (m_attribute)</span>
<a href="#l72.7"></a><span id="l72.7">   {</span>
<a href="#l72.8"></a><span id="l72.8">     case nsMsgSearchScope::onlineMail:</span>
<a href="#l72.9"></a><span id="l72.9">         m_adapter = new nsMsgSearchOnlineMail (this, termList);</span>
<a href="#l72.10"></a><span id="l72.10">       break;</span>
<a href="#l72.11"></a><span id="l72.11">     case nsMsgSearchScope::offlineMail:</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineplus">+    case nsMsgSearchScope::onlineManual:</span>
<a href="#l72.13"></a><span id="l72.13">         m_adapter = new nsMsgSearchOfflineMail (this, termList);</span>
<a href="#l72.14"></a><span id="l72.14">       break;</span>
<a href="#l72.15"></a><span id="l72.15">     case nsMsgSearchScope::newsEx:</span>
<a href="#l72.16"></a><span id="l72.16">       NS_ASSERTION(PR_FALSE, &quot;not supporting newsEx yet&quot;);</span>
<a href="#l72.17"></a><span id="l72.17">       break;</span>
<a href="#l72.18"></a><span id="l72.18">     case nsMsgSearchScope::news:</span>
<a href="#l72.19"></a><span id="l72.19">           m_adapter = new nsMsgSearchNews (this, termList);</span>
<a href="#l72.20"></a><span id="l72.20">         break;</span>
<a href="#l72.21"></a><span id="l72.21">     case nsMsgSearchScope::allSearchableGroups:</span>
<a href="#l72.22"></a><span id="l72.22">       NS_ASSERTION(PR_FALSE, &quot;not supporting allSearchableGroups yet&quot;);</span>
<a href="#l72.23"></a><span id="l72.23">       break;</span>
<a href="#l72.24"></a><span id="l72.24">     case nsMsgSearchScope::LDAP:</span>
<a href="#l72.25"></a><span id="l72.25">       NS_ASSERTION(PR_FALSE, &quot;not supporting LDAP yet&quot;);</span>
<a href="#l72.26"></a><span id="l72.26">       break;</span>
<a href="#l72.27"></a><span id="l72.27">     case nsMsgSearchScope::localNews:</span>
<a href="#l72.28"></a><span id="l72.28" class="difflineplus">+    case nsMsgSearchScope::localNewsJunk:</span>
<a href="#l72.29"></a><span id="l72.29" class="difflineplus">+    case nsMsgSearchScope::localNewsBody:</span>
<a href="#l72.30"></a><span id="l72.30" class="difflineplus">+    case nsMsgSearchScope::localNewsJunkBody:</span>
<a href="#l72.31"></a><span id="l72.31">       m_adapter = new nsMsgSearchOfflineNews (this, termList);</span>
<a href="#l72.32"></a><span id="l72.32">       break;</span>
<a href="#l72.33"></a><span id="l72.33">     default:</span>
<a href="#l72.34"></a><span id="l72.34">       NS_ASSERTION(PR_FALSE, &quot;invalid scope&quot;);</span>
<a href="#l72.35"></a><span id="l72.35">       err = NS_ERROR_FAILURE;</span>
<a href="#l72.36"></a><span id="l72.36">   }</span>
<a href="#l72.37"></a><span id="l72.37"> </span>
<a href="#l72.38"></a><span id="l72.38">   if (m_adapter)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchValue.cpp</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchValue.cpp</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -133,15 +133,15 @@ nsMsgSearchValueImpl::ToString(nsAString</span>
<a href="#l73.4"></a><span id="l73.4">       nsAutoString tempInt;</span>
<a href="#l73.5"></a><span id="l73.5">       tempInt.AppendInt(mValue.attribute);</span>
<a href="#l73.6"></a><span id="l73.6">       </span>
<a href="#l73.7"></a><span id="l73.7">         aResult.AppendLiteral(&quot;type=&quot;);</span>
<a href="#l73.8"></a><span id="l73.8">         aResult.Append(tempInt);</span>
<a href="#l73.9"></a><span id="l73.9">     }</span>
<a href="#l73.10"></a><span id="l73.10">         break;</span>
<a href="#l73.11"></a><span id="l73.11">     default:</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-        NS_ASSERTION(0, &quot;Unknown search value type&quot;);</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+        NS_ERROR(&quot;Unknown search value type&quot;);</span>
<a href="#l73.14"></a><span id="l73.14">     }        </span>
<a href="#l73.15"></a><span id="l73.15"> </span>
<a href="#l73.16"></a><span id="l73.16">     aResult.AppendLiteral(&quot;]&quot;);</span>
<a href="#l73.17"></a><span id="l73.17"> </span>
<a href="#l73.18"></a><span id="l73.18">     return NS_OK;</span>
<a href="#l73.19"></a><span id="l73.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -164,16 +164,18 @@ nsMsgDBView::nsMsgDBView()</span>
<a href="#l74.4"></a><span id="l74.4">   mSuppressCommandUpdating = PR_FALSE;</span>
<a href="#l74.5"></a><span id="l74.5">   mSuppressChangeNotification = PR_FALSE;</span>
<a href="#l74.6"></a><span id="l74.6">   mSummarizeFailed = PR_FALSE;</span>
<a href="#l74.7"></a><span id="l74.7">   mSelectionSummarized = PR_FALSE;</span>
<a href="#l74.8"></a><span id="l74.8">   mGoForwardEnabled = PR_FALSE;</span>
<a href="#l74.9"></a><span id="l74.9">   mGoBackEnabled = PR_FALSE;</span>
<a href="#l74.10"></a><span id="l74.10"> </span>
<a href="#l74.11"></a><span id="l74.11">   mIsNews = PR_FALSE;</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineplus">+  mIsRss = PR_FALSE;</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+  mIsXFVirtual = PR_FALSE;</span>
<a href="#l74.14"></a><span id="l74.14">   mDeleteModel = nsMsgImapDeleteModels::MoveToTrash;</span>
<a href="#l74.15"></a><span id="l74.15">   m_deletingRows = PR_FALSE;</span>
<a href="#l74.16"></a><span id="l74.16">   mNumMessagesRemainingInBatch = 0;</span>
<a href="#l74.17"></a><span id="l74.17">   mShowSizeInLines = PR_FALSE;</span>
<a href="#l74.18"></a><span id="l74.18"> </span>
<a href="#l74.19"></a><span id="l74.19">   /* mCommandsNeedDisablingBecauseOfSelection - A boolean that tell us if we needed to disable commands because of what's selected.</span>
<a href="#l74.20"></a><span id="l74.20">     If we're offline w/o a downloaded msg selected, or a dummy message was selected.</span>
<a href="#l74.21"></a><span id="l74.21">   */</span>
<a href="#l74.22"></a><span id="l74.22" class="difflineat">@@ -1607,17 +1609,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellValue(</span>
<a href="#l74.23"></a><span id="l74.23">       if (flags &amp; nsMsgMessageFlags::Attachment)</span>
<a href="#l74.24"></a><span id="l74.24">         aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasAttachment&quot;).get()));</span>
<a href="#l74.25"></a><span id="l74.25">       break;</span>
<a href="#l74.26"></a><span id="l74.26">     case 'f': // flagged (starred) column</span>
<a href="#l74.27"></a><span id="l74.27">       if (flags &amp; nsMsgMessageFlags::Marked)</span>
<a href="#l74.28"></a><span id="l74.28">         aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasFlag&quot;).get()));</span>
<a href="#l74.29"></a><span id="l74.29">       break;</span>
<a href="#l74.30"></a><span id="l74.30">     case 'j': // junk column</span>
<a href="#l74.31"></a><span id="l74.31" class="difflineminus">-      if (!mIsNews)</span>
<a href="#l74.32"></a><span id="l74.32" class="difflineplus">+      if (JunkControlsEnabled(aRow))</span>
<a href="#l74.33"></a><span id="l74.33">       {</span>
<a href="#l74.34"></a><span id="l74.34">         nsCString junkScoreStr;</span>
<a href="#l74.35"></a><span id="l74.35">         msgHdr-&gt;GetStringProperty(&quot;junkscore&quot;, getter_Copies(junkScoreStr));</span>
<a href="#l74.36"></a><span id="l74.36">         // Only need to assing a real value for junk, it's empty already</span>
<a href="#l74.37"></a><span id="l74.37">         // as it should be for non-junk.</span>
<a href="#l74.38"></a><span id="l74.38">         if (!junkScoreStr.IsEmpty() &amp;&amp;</span>
<a href="#l74.39"></a><span id="l74.39">             (junkScoreStr.ToInteger((PRInt32*)&amp;rv) == nsIJunkMailPlugin::IS_SPAM_SCORE))</span>
<a href="#l74.40"></a><span id="l74.40">           aValue.AssignLiteral(&quot;messageJunk&quot;);</span>
<a href="#l74.41"></a><span id="l74.41" class="difflineat">@@ -1981,17 +1983,17 @@ NS_IMETHODIMP nsMsgDBView::CycleCell(PRI</span>
<a href="#l74.42"></a><span id="l74.42">     // toggle the flagged status of the element at row.</span>
<a href="#l74.43"></a><span id="l74.43">     if (m_flags[row] &amp; nsMsgMessageFlags::Marked)</span>
<a href="#l74.44"></a><span id="l74.44">       ApplyCommandToIndices(nsMsgViewCommandType::unflagMessages, (nsMsgViewIndex *) &amp;row, 1);</span>
<a href="#l74.45"></a><span id="l74.45">     else</span>
<a href="#l74.46"></a><span id="l74.46">       ApplyCommandToIndices(nsMsgViewCommandType::flagMessages, (nsMsgViewIndex *) &amp;row, 1);</span>
<a href="#l74.47"></a><span id="l74.47">     break;</span>
<a href="#l74.48"></a><span id="l74.48">   case 'j': // junkStatus column</span>
<a href="#l74.49"></a><span id="l74.49">     {</span>
<a href="#l74.50"></a><span id="l74.50" class="difflineminus">-      if (mIsNews) // junk not supported for news yet.</span>
<a href="#l74.51"></a><span id="l74.51" class="difflineplus">+      if (!JunkControlsEnabled(row))</span>
<a href="#l74.52"></a><span id="l74.52">         return NS_OK;</span>
<a href="#l74.53"></a><span id="l74.53"> </span>
<a href="#l74.54"></a><span id="l74.54">       nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l74.55"></a><span id="l74.55"> </span>
<a href="#l74.56"></a><span id="l74.56">       nsresult rv = GetMsgHdrForViewIndex(row, getter_AddRefs(msgHdr));</span>
<a href="#l74.57"></a><span id="l74.57">       if (NS_SUCCEEDED(rv) &amp;&amp; msgHdr)</span>
<a href="#l74.58"></a><span id="l74.58">       {</span>
<a href="#l74.59"></a><span id="l74.59">         nsCString junkScoreStr;</span>
<a href="#l74.60"></a><span id="l74.60" class="difflineat">@@ -2068,18 +2070,30 @@ NS_IMETHODIMP nsMsgDBView::Open(nsIMsgFo</span>
<a href="#l74.61"></a><span id="l74.61">     // if yes, we'll show lines instead of size, and special icons in the thread pane</span>
<a href="#l74.62"></a><span id="l74.62">     nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l74.63"></a><span id="l74.63">     rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l74.64"></a><span id="l74.64">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.65"></a><span id="l74.65">     nsCString type;</span>
<a href="#l74.66"></a><span id="l74.66">     rv = server-&gt;GetType(type);</span>
<a href="#l74.67"></a><span id="l74.67">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.68"></a><span id="l74.68"> </span>
<a href="#l74.69"></a><span id="l74.69" class="difflineplus">+    // I'm not sure this is correct, because XF virtual folders with mixed news</span>
<a href="#l74.70"></a><span id="l74.70" class="difflineplus">+    // and mail can have this set.</span>
<a href="#l74.71"></a><span id="l74.71">     mIsNews = type.LowerCaseEqualsLiteral(&quot;nntp&quot;);</span>
<a href="#l74.72"></a><span id="l74.72"> </span>
<a href="#l74.73"></a><span id="l74.73" class="difflineplus">+    // Default to a virtual folder if folder not set, since synthetic search</span>
<a href="#l74.74"></a><span id="l74.74" class="difflineplus">+    // views may not have a folder.</span>
<a href="#l74.75"></a><span id="l74.75" class="difflineplus">+    PRUint32 folderFlags = nsMsgFolderFlags::Virtual;</span>
<a href="#l74.76"></a><span id="l74.76" class="difflineplus">+    if (folder)</span>
<a href="#l74.77"></a><span id="l74.77" class="difflineplus">+      folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l74.78"></a><span id="l74.78" class="difflineplus">+    mIsXFVirtual = folderFlags &amp; nsMsgFolderFlags::Virtual;</span>
<a href="#l74.79"></a><span id="l74.79" class="difflineplus">+</span>
<a href="#l74.80"></a><span id="l74.80" class="difflineplus">+    if (!mIsXFVirtual &amp;&amp; type.LowerCaseEqualsLiteral(&quot;rss&quot;))</span>
<a href="#l74.81"></a><span id="l74.81" class="difflineplus">+      mIsRss = PR_TRUE;</span>
<a href="#l74.82"></a><span id="l74.82" class="difflineplus">+</span>
<a href="#l74.83"></a><span id="l74.83">     if (type.IsEmpty())</span>
<a href="#l74.84"></a><span id="l74.84">       mMessageTypeAtom = nsnull;</span>
<a href="#l74.85"></a><span id="l74.85">     else  // special case nntp --&gt; news since we'll break themes if we try to be consistent</span>
<a href="#l74.86"></a><span id="l74.86">       mMessageTypeAtom = do_GetAtom(mIsNews ? &quot;news&quot; : type.get());</span>
<a href="#l74.87"></a><span id="l74.87"> </span>
<a href="#l74.88"></a><span id="l74.88">     GetImapDeleteModel(nsnull);</span>
<a href="#l74.89"></a><span id="l74.89"> </span>
<a href="#l74.90"></a><span id="l74.90">     if (mIsNews)</span>
<a href="#l74.91"></a><span id="l74.91" class="difflineat">@@ -2452,17 +2466,18 @@ NS_IMETHODIMP nsMsgDBView::GetCommandSta</span>
<a href="#l74.92"></a><span id="l74.92">   nsMsgViewIndexArray selection;</span>
<a href="#l74.93"></a><span id="l74.93">   GetSelectedIndices(selection);</span>
<a href="#l74.94"></a><span id="l74.94">   PRInt32 numIndices = selection.Length();</span>
<a href="#l74.95"></a><span id="l74.95">   nsMsgViewIndex *indices = selection.Elements();</span>
<a href="#l74.96"></a><span id="l74.96">   // if range count is non-zero, we have at least one item selected, so we have a selection</span>
<a href="#l74.97"></a><span id="l74.97">   if (mTreeSelection &amp;&amp; NS_SUCCEEDED(mTreeSelection-&gt;GetRangeCount(&amp;rangeCount)) &amp;&amp; rangeCount &gt; 0)</span>
<a href="#l74.98"></a><span id="l74.98">     haveSelection = NonDummyMsgSelected(indices, numIndices);</span>
<a href="#l74.99"></a><span id="l74.99">   else</span>
<a href="#l74.100"></a><span id="l74.100" class="difflineminus">-    haveSelection = PR_FALSE;</span>
<a href="#l74.101"></a><span id="l74.101" class="difflineplus">+  // If we don't have a tree selection we must be in stand alone mode.</span>
<a href="#l74.102"></a><span id="l74.102" class="difflineplus">+    haveSelection = m_currentlyDisplayedViewIndex != nsMsgViewIndex_None;</span>
<a href="#l74.103"></a><span id="l74.103"> </span>
<a href="#l74.104"></a><span id="l74.104">   switch (command)</span>
<a href="#l74.105"></a><span id="l74.105">   {</span>
<a href="#l74.106"></a><span id="l74.106">   case nsMsgViewCommandType::deleteMsg:</span>
<a href="#l74.107"></a><span id="l74.107">   case nsMsgViewCommandType::deleteNoTrash:</span>
<a href="#l74.108"></a><span id="l74.108">     {</span>
<a href="#l74.109"></a><span id="l74.109">       PRBool canDelete;</span>
<a href="#l74.110"></a><span id="l74.110">       // news folders can't delete (or move messages)</span>
<a href="#l74.111"></a><span id="l74.111" class="difflineat">@@ -2477,19 +2492,18 @@ NS_IMETHODIMP nsMsgDBView::GetCommandSta</span>
<a href="#l74.112"></a><span id="l74.112">     // disable if no messages</span>
<a href="#l74.113"></a><span id="l74.113">     // XXX todo, check that we have filters, and at least one is enabled</span>
<a href="#l74.114"></a><span id="l74.114">     *selectable_p = GetSize();</span>
<a href="#l74.115"></a><span id="l74.115">     if (*selectable_p)</span>
<a href="#l74.116"></a><span id="l74.116">       *selectable_p = ServerSupportsFilterAfterTheFact();</span>
<a href="#l74.117"></a><span id="l74.117">     break;</span>
<a href="#l74.118"></a><span id="l74.118">   case nsMsgViewCommandType::runJunkControls:</span>
<a href="#l74.119"></a><span id="l74.119">     // disable if no messages</span>
<a href="#l74.120"></a><span id="l74.120" class="difflineminus">-    // no JMC on news yet</span>
<a href="#l74.121"></a><span id="l74.121">     // XXX todo, check that we have JMC enabled?</span>
<a href="#l74.122"></a><span id="l74.122" class="difflineminus">-    *selectable_p = GetSize() &amp;&amp; !mIsNews;</span>
<a href="#l74.123"></a><span id="l74.123" class="difflineplus">+    *selectable_p = GetSize() &amp;&amp; JunkControlsEnabled(nsMsgViewIndex_None);</span>
<a href="#l74.124"></a><span id="l74.124">     break;</span>
<a href="#l74.125"></a><span id="l74.125">   case nsMsgViewCommandType::deleteJunk:</span>
<a href="#l74.126"></a><span id="l74.126">     {</span>
<a href="#l74.127"></a><span id="l74.127">       // disable if no messages, or if we can't delete (like news and certain imap folders)</span>
<a href="#l74.128"></a><span id="l74.128">       PRBool canDelete;</span>
<a href="#l74.129"></a><span id="l74.129">       *selectable_p = GetSize() &amp;&amp; (m_folder &amp;&amp; NS_SUCCEEDED(m_folder-&gt;GetCanDeleteMessages(&amp;canDelete)) &amp;&amp; canDelete);</span>
<a href="#l74.130"></a><span id="l74.130">     }</span>
<a href="#l74.131"></a><span id="l74.131">     break;</span>
<a href="#l74.132"></a><span id="l74.132" class="difflineat">@@ -2500,17 +2514,17 @@ NS_IMETHODIMP nsMsgDBView::GetCommandSta</span>
<a href="#l74.133"></a><span id="l74.133">   case nsMsgViewCommandType::unflagMessages:</span>
<a href="#l74.134"></a><span id="l74.134">   case nsMsgViewCommandType::toggleThreadWatched:</span>
<a href="#l74.135"></a><span id="l74.135">   case nsMsgViewCommandType::markThreadRead:</span>
<a href="#l74.136"></a><span id="l74.136">   case nsMsgViewCommandType::downloadSelectedForOffline:</span>
<a href="#l74.137"></a><span id="l74.137">     *selectable_p = haveSelection;</span>
<a href="#l74.138"></a><span id="l74.138">     break;</span>
<a href="#l74.139"></a><span id="l74.139">   case nsMsgViewCommandType::junk:</span>
<a href="#l74.140"></a><span id="l74.140">   case nsMsgViewCommandType::unjunk:</span>
<a href="#l74.141"></a><span id="l74.141" class="difflineminus">-    *selectable_p = haveSelection &amp;&amp; !mIsNews;  // no junk for news yet</span>
<a href="#l74.142"></a><span id="l74.142" class="difflineplus">+    *selectable_p = haveSelection &amp;&amp; JunkControlsEnabled(selection[0]);</span>
<a href="#l74.143"></a><span id="l74.143">     break;</span>
<a href="#l74.144"></a><span id="l74.144">   case nsMsgViewCommandType::cmdRequiringMsgBody:</span>
<a href="#l74.145"></a><span id="l74.145">     *selectable_p = haveSelection &amp;&amp; (!WeAreOffline() || OfflineMsgSelected(indices, numIndices));</span>
<a href="#l74.146"></a><span id="l74.146">     break;</span>
<a href="#l74.147"></a><span id="l74.147">   case nsMsgViewCommandType::downloadFlaggedForOffline:</span>
<a href="#l74.148"></a><span id="l74.148">   case nsMsgViewCommandType::markAllRead:</span>
<a href="#l74.149"></a><span id="l74.149">     *selectable_p = PR_TRUE;</span>
<a href="#l74.150"></a><span id="l74.150">     break;</span>
<a href="#l74.151"></a><span id="l74.151" class="difflineat">@@ -3759,17 +3773,17 @@ nsresult nsMsgDBView::GetLongField(nsIMs</span>
<a href="#l74.152"></a><span id="l74.152">       {</span>
<a href="#l74.153"></a><span id="l74.153">         NS_ASSERTION(PR_FALSE, &quot;should not be here (Sort Type: byCustom (Long), but no custom handler)&quot;);</span>
<a href="#l74.154"></a><span id="l74.154">         rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l74.155"></a><span id="l74.155">       }</span>
<a href="#l74.156"></a><span id="l74.156">       break;</span>
<a href="#l74.157"></a><span id="l74.157">     case nsMsgViewSortType::byId:</span>
<a href="#l74.158"></a><span id="l74.158">         // handled by caller, since caller knows the key</span>
<a href="#l74.159"></a><span id="l74.159">     default:</span>
<a href="#l74.160"></a><span id="l74.160" class="difflineminus">-        NS_ASSERTION(0,&quot;should not be here&quot;);</span>
<a href="#l74.161"></a><span id="l74.161" class="difflineplus">+        NS_ERROR(&quot;should not be here&quot;);</span>
<a href="#l74.162"></a><span id="l74.162">         rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l74.163"></a><span id="l74.163">         break;</span>
<a href="#l74.164"></a><span id="l74.164">     }</span>
<a href="#l74.165"></a><span id="l74.165"> </span>
<a href="#l74.166"></a><span id="l74.166">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.167"></a><span id="l74.167">     return NS_OK;</span>
<a href="#l74.168"></a><span id="l74.168"> }</span>
<a href="#l74.169"></a><span id="l74.169"> </span>
<a href="#l74.170"></a><span id="l74.170" class="difflineat">@@ -4237,17 +4251,17 @@ NS_IMETHODIMP nsMsgDBView::Sort(nsMsgVie</span>
<a href="#l74.171"></a><span id="l74.171">     {</span>
<a href="#l74.172"></a><span id="l74.172">       case kCollationKey:</span>
<a href="#l74.173"></a><span id="l74.173">         NS_QuickSort(pPtrBase, numSoFar, sizeof(IdKey*), FnSortIdKey, &amp;qsPrivateData);</span>
<a href="#l74.174"></a><span id="l74.174">         break;</span>
<a href="#l74.175"></a><span id="l74.175">       case kU32:</span>
<a href="#l74.176"></a><span id="l74.176">         NS_QuickSort(pPtrBase, numSoFar, sizeof(IdKey*), FnSortIdUint32, &amp;qsPrivateData);</span>
<a href="#l74.177"></a><span id="l74.177">         break;</span>
<a href="#l74.178"></a><span id="l74.178">       default:</span>
<a href="#l74.179"></a><span id="l74.179" class="difflineminus">-        NS_ASSERTION(0, &quot;not supposed to get here&quot;);</span>
<a href="#l74.180"></a><span id="l74.180" class="difflineplus">+        NS_ERROR(&quot;not supposed to get here&quot;);</span>
<a href="#l74.181"></a><span id="l74.181">         break;</span>
<a href="#l74.182"></a><span id="l74.182">     }</span>
<a href="#l74.183"></a><span id="l74.183">   }</span>
<a href="#l74.184"></a><span id="l74.184"> </span>
<a href="#l74.185"></a><span id="l74.185">   // now put the IDs into the array in proper order</span>
<a href="#l74.186"></a><span id="l74.186">   for (PRUint32 i = 0; i &lt; numSoFar; i++)</span>
<a href="#l74.187"></a><span id="l74.187">   {</span>
<a href="#l74.188"></a><span id="l74.188">     m_keys[i] = pPtrBase[i]-&gt;id;</span>
<a href="#l74.189"></a><span id="l74.189" class="difflineat">@@ -5767,17 +5781,17 @@ NS_IMETHODIMP nsMsgDBView::SetSortType(n</span>
<a href="#l74.190"></a><span id="l74.190"> {</span>
<a href="#l74.191"></a><span id="l74.191">     m_sortType = aSortType;</span>
<a href="#l74.192"></a><span id="l74.192">     return NS_OK;</span>
<a href="#l74.193"></a><span id="l74.193"> }</span>
<a href="#l74.194"></a><span id="l74.194"> </span>
<a href="#l74.195"></a><span id="l74.195"> </span>
<a href="#l74.196"></a><span id="l74.196"> NS_IMETHODIMP nsMsgDBView::GetViewType(nsMsgViewTypeValue *aViewType)</span>
<a href="#l74.197"></a><span id="l74.197"> {</span>
<a href="#l74.198"></a><span id="l74.198" class="difflineminus">-    NS_ASSERTION(0,&quot;you should be overriding this\n&quot;);</span>
<a href="#l74.199"></a><span id="l74.199" class="difflineplus">+    NS_ERROR(&quot;you should be overriding this&quot;);</span>
<a href="#l74.200"></a><span id="l74.200">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l74.201"></a><span id="l74.201"> }</span>
<a href="#l74.202"></a><span id="l74.202"> </span>
<a href="#l74.203"></a><span id="l74.203"> NS_IMETHODIMP nsMsgDBView::GetSecondarySortOrder(nsMsgViewSortOrderValue *aSortOrder)</span>
<a href="#l74.204"></a><span id="l74.204"> {</span>
<a href="#l74.205"></a><span id="l74.205">     NS_ENSURE_ARG_POINTER(aSortOrder);</span>
<a href="#l74.206"></a><span id="l74.206">     *aSortOrder = m_secondarySortOrder;</span>
<a href="#l74.207"></a><span id="l74.207">     return NS_OK;</span>
<a href="#l74.208"></a><span id="l74.208" class="difflineat">@@ -6178,17 +6192,17 @@ nsresult nsMsgDBView::NavigateFromPos(ns</span>
<a href="#l74.209"></a><span id="l74.209">             }</span>
<a href="#l74.210"></a><span id="l74.210">           }</span>
<a href="#l74.211"></a><span id="l74.211">           *pResultIndex = nsMsgViewIndex_None;</span>
<a href="#l74.212"></a><span id="l74.212">           *pResultKey = nsMsgKey_None;</span>
<a href="#l74.213"></a><span id="l74.213">           break;</span>
<a href="#l74.214"></a><span id="l74.214"> </span>
<a href="#l74.215"></a><span id="l74.215">         }</span>
<a href="#l74.216"></a><span id="l74.216">         default:</span>
<a href="#l74.217"></a><span id="l74.217" class="difflineminus">-            NS_ASSERTION(0, &quot;unsupported motion&quot;);</span>
<a href="#l74.218"></a><span id="l74.218" class="difflineplus">+            NS_ERROR(&quot;unsupported motion&quot;);</span>
<a href="#l74.219"></a><span id="l74.219">             break;</span>
<a href="#l74.220"></a><span id="l74.220">     }</span>
<a href="#l74.221"></a><span id="l74.221">     return NS_OK;</span>
<a href="#l74.222"></a><span id="l74.222"> }</span>
<a href="#l74.223"></a><span id="l74.223"> </span>
<a href="#l74.224"></a><span id="l74.224"> NS_IMETHODIMP nsMsgDBView::NavigateStatus(nsMsgNavigationTypeValue motion, PRBool *_retval)</span>
<a href="#l74.225"></a><span id="l74.225"> {</span>
<a href="#l74.226"></a><span id="l74.226">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l74.227"></a><span id="l74.227" class="difflineat">@@ -6269,17 +6283,17 @@ NS_IMETHODIMP nsMsgDBView::NavigateStatu</span>
<a href="#l74.228"></a><span id="l74.228">             else</span>
<a href="#l74.229"></a><span id="l74.229">               desiredPos--; //? operator code didn't work for me</span>
<a href="#l74.230"></a><span id="l74.230">             enable = (desiredPos &gt;= 0 &amp;&amp; desiredPos &lt; (PRInt32) historyCount / 2);</span>
<a href="#l74.231"></a><span id="l74.231">           }</span>
<a href="#l74.232"></a><span id="l74.232">         }</span>
<a href="#l74.233"></a><span id="l74.233">           break;</span>
<a href="#l74.234"></a><span id="l74.234"> </span>
<a href="#l74.235"></a><span id="l74.235">         default:</span>
<a href="#l74.236"></a><span id="l74.236" class="difflineminus">-            NS_ASSERTION(0,&quot;unexpected&quot;);</span>
<a href="#l74.237"></a><span id="l74.237" class="difflineplus">+            NS_ERROR(&quot;unexpected&quot;);</span>
<a href="#l74.238"></a><span id="l74.238">             break;</span>
<a href="#l74.239"></a><span id="l74.239">     }</span>
<a href="#l74.240"></a><span id="l74.240"> </span>
<a href="#l74.241"></a><span id="l74.241">     *_retval = enable;</span>
<a href="#l74.242"></a><span id="l74.242">     return NS_OK;</span>
<a href="#l74.243"></a><span id="l74.243"> }</span>
<a href="#l74.244"></a><span id="l74.244"> </span>
<a href="#l74.245"></a><span id="l74.245"> // Note that these routines do NOT expand collapsed threads! This mimics the old behaviour,</span>
<a href="#l74.246"></a><span id="l74.246" class="difflineat">@@ -6338,17 +6352,17 @@ nsresult nsMsgDBView::FindPrevUnread(nsM</span>
<a href="#l74.247"></a><span id="l74.247">         *resultThreadId = nsMsgKey_None;</span>
<a href="#l74.248"></a><span id="l74.248"> </span>
<a href="#l74.249"></a><span id="l74.249">     for (; (int) curIndex &gt;= 0 &amp;&amp; (*pResultKey == nsMsgKey_None); curIndex--)</span>
<a href="#l74.250"></a><span id="l74.250">     {</span>
<a href="#l74.251"></a><span id="l74.251">         PRUint32 flags = m_flags[curIndex];</span>
<a href="#l74.252"></a><span id="l74.252"> </span>
<a href="#l74.253"></a><span id="l74.253">         if (curIndex != startIndex &amp;&amp; flags &amp; MSG_VIEW_FLAG_ISTHREAD &amp;&amp; flags &amp; nsMsgMessageFlags::Elided)</span>
<a href="#l74.254"></a><span id="l74.254">         {</span>
<a href="#l74.255"></a><span id="l74.255" class="difflineminus">-            NS_ASSERTION(0,&quot;fix this&quot;);</span>
<a href="#l74.256"></a><span id="l74.256" class="difflineplus">+            NS_ERROR(&quot;fix this&quot;);</span>
<a href="#l74.257"></a><span id="l74.257">             //nsMsgKey threadId = m_keys[curIndex];</span>
<a href="#l74.258"></a><span id="l74.258">             //rv = m_db-&gt;GetUnreadKeyInThread(threadId, pResultKey, resultThreadId);</span>
<a href="#l74.259"></a><span id="l74.259">             if (NS_SUCCEEDED(rv) &amp;&amp; (*pResultKey != nsMsgKey_None))</span>
<a href="#l74.260"></a><span id="l74.260">                 break;</span>
<a href="#l74.261"></a><span id="l74.261">         }</span>
<a href="#l74.262"></a><span id="l74.262">         if (!(flags &amp; (nsMsgMessageFlags::Read | MSG_VIEW_FLAG_DUMMY)) &amp;&amp; (curIndex != startIndex))</span>
<a href="#l74.263"></a><span id="l74.263">         {</span>
<a href="#l74.264"></a><span id="l74.264">             *pResultKey = m_keys[curIndex];</span>
<a href="#l74.265"></a><span id="l74.265" class="difflineat">@@ -7130,16 +7144,18 @@ nsresult nsMsgDBView::CopyDBView(nsMsgDB</span>
<a href="#l74.266"></a><span id="l74.266">   aNewMsgDBView-&gt;m_viewFlags = m_viewFlags;</span>
<a href="#l74.267"></a><span id="l74.267">   aNewMsgDBView-&gt;m_sortOrder = m_sortOrder;</span>
<a href="#l74.268"></a><span id="l74.268">   aNewMsgDBView-&gt;m_sortType = m_sortType;</span>
<a href="#l74.269"></a><span id="l74.269">   aNewMsgDBView-&gt;m_db = m_db;</span>
<a href="#l74.270"></a><span id="l74.270">   aNewMsgDBView-&gt;mDateFormatter = mDateFormatter;</span>
<a href="#l74.271"></a><span id="l74.271">   if (m_db)</span>
<a href="#l74.272"></a><span id="l74.272">     aNewMsgDBView-&gt;m_db-&gt;AddListener(aNewMsgDBView);</span>
<a href="#l74.273"></a><span id="l74.273">   aNewMsgDBView-&gt;mIsNews = mIsNews;</span>
<a href="#l74.274"></a><span id="l74.274" class="difflineplus">+  aNewMsgDBView-&gt;mIsRss = mIsRss;</span>
<a href="#l74.275"></a><span id="l74.275" class="difflineplus">+  aNewMsgDBView-&gt;mIsXFVirtual = mIsXFVirtual;</span>
<a href="#l74.276"></a><span id="l74.276">   aNewMsgDBView-&gt;mShowSizeInLines = mShowSizeInLines;</span>
<a href="#l74.277"></a><span id="l74.277">   aNewMsgDBView-&gt;mHeaderParser = mHeaderParser;</span>
<a href="#l74.278"></a><span id="l74.278">   aNewMsgDBView-&gt;mDeleteModel = mDeleteModel;</span>
<a href="#l74.279"></a><span id="l74.279">   aNewMsgDBView-&gt;m_flags = m_flags;</span>
<a href="#l74.280"></a><span id="l74.280">   aNewMsgDBView-&gt;m_levels = m_levels;</span>
<a href="#l74.281"></a><span id="l74.281">   aNewMsgDBView-&gt;m_keys = m_keys;</span>
<a href="#l74.282"></a><span id="l74.282"> </span>
<a href="#l74.283"></a><span id="l74.283">   aNewMsgDBView-&gt;m_customColumnHandlerIDs = m_customColumnHandlerIDs;</span>
<a href="#l74.284"></a><span id="l74.284" class="difflineat">@@ -7292,8 +7308,51 @@ NS_IMETHODIMP nsMsgDBView::nsMsgViewHdrE</span>
<a href="#l74.285"></a><span id="l74.285">   return NS_OK;</span>
<a href="#l74.286"></a><span id="l74.286"> }</span>
<a href="#l74.287"></a><span id="l74.287"> </span>
<a href="#l74.288"></a><span id="l74.288"> nsresult nsMsgDBView::GetViewEnumerator(nsISimpleEnumerator **enumerator)</span>
<a href="#l74.289"></a><span id="l74.289"> {</span>
<a href="#l74.290"></a><span id="l74.290">   NS_IF_ADDREF(*enumerator = new nsMsgViewHdrEnumerator(this));</span>
<a href="#l74.291"></a><span id="l74.291">   return (*enumerator) ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l74.292"></a><span id="l74.292"> }</span>
<a href="#l74.293"></a><span id="l74.293" class="difflineplus">+</span>
<a href="#l74.294"></a><span id="l74.294" class="difflineplus">+/**</span>
<a href="#l74.295"></a><span id="l74.295" class="difflineplus">+ * Determine whether junk commands should be enabled on this view.</span>
<a href="#l74.296"></a><span id="l74.296" class="difflineplus">+ * Junk commands are always enabled for mail. For nntp and rss, they</span>
<a href="#l74.297"></a><span id="l74.297" class="difflineplus">+ * may be selectively enabled using an inherited folder property.</span>
<a href="#l74.298"></a><span id="l74.298" class="difflineplus">+ *</span>
<a href="#l74.299"></a><span id="l74.299" class="difflineplus">+ * @param  aViewIndex  view index of the message to check</span>
<a href="#l74.300"></a><span id="l74.300" class="difflineplus">+ * @return             PR_TRUE if junk controls should be enabled</span>
<a href="#l74.301"></a><span id="l74.301" class="difflineplus">+ */</span>
<a href="#l74.302"></a><span id="l74.302" class="difflineplus">+PRBool nsMsgDBView::JunkControlsEnabled(nsMsgViewIndex aViewIndex)</span>
<a href="#l74.303"></a><span id="l74.303" class="difflineplus">+{</span>
<a href="#l74.304"></a><span id="l74.304" class="difflineplus">+  // For normal mail, junk commands are always enabled.</span>
<a href="#l74.305"></a><span id="l74.305" class="difflineplus">+  if (!(mIsNews || mIsRss || mIsXFVirtual))</span>
<a href="#l74.306"></a><span id="l74.306" class="difflineplus">+    return PR_TRUE;</span>
<a href="#l74.307"></a><span id="l74.307" class="difflineplus">+</span>
<a href="#l74.308"></a><span id="l74.308" class="difflineplus">+  // we need to check per message or folder</span>
<a href="#l74.309"></a><span id="l74.309" class="difflineplus">+  nsCOMPtr &lt;nsIMsgFolder&gt; folder = m_folder;</span>
<a href="#l74.310"></a><span id="l74.310" class="difflineplus">+  if (!folder &amp;&amp; aViewIndex != nsMsgViewIndex_None)</span>
<a href="#l74.311"></a><span id="l74.311" class="difflineplus">+    GetFolderForViewIndex(aViewIndex, getter_AddRefs(folder));</span>
<a href="#l74.312"></a><span id="l74.312" class="difflineplus">+  if (folder)</span>
<a href="#l74.313"></a><span id="l74.313" class="difflineplus">+  {</span>
<a href="#l74.314"></a><span id="l74.314" class="difflineplus">+    // Check if this is a mail message in search folders.</span>
<a href="#l74.315"></a><span id="l74.315" class="difflineplus">+    if (mIsXFVirtual)</span>
<a href="#l74.316"></a><span id="l74.316" class="difflineplus">+    {</span>
<a href="#l74.317"></a><span id="l74.317" class="difflineplus">+      nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l74.318"></a><span id="l74.318" class="difflineplus">+      folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l74.319"></a><span id="l74.319" class="difflineplus">+      nsCAutoString type;</span>
<a href="#l74.320"></a><span id="l74.320" class="difflineplus">+      if (server)</span>
<a href="#l74.321"></a><span id="l74.321" class="difflineplus">+        server-&gt;GetType(type);</span>
<a href="#l74.322"></a><span id="l74.322" class="difflineplus">+      if (!(type.LowerCaseEqualsLiteral(&quot;nntp&quot;) || type.LowerCaseEqualsLiteral(&quot;rss&quot;)))</span>
<a href="#l74.323"></a><span id="l74.323" class="difflineplus">+        return PR_TRUE;</span>
<a href="#l74.324"></a><span id="l74.324" class="difflineplus">+    }</span>
<a href="#l74.325"></a><span id="l74.325" class="difflineplus">+</span>
<a href="#l74.326"></a><span id="l74.326" class="difflineplus">+    // For rss and news, check the inherited folder property.</span>
<a href="#l74.327"></a><span id="l74.327" class="difflineplus">+    nsCAutoString junkEnableOverride;</span>
<a href="#l74.328"></a><span id="l74.328" class="difflineplus">+    folder-&gt;GetInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;,</span>
<a href="#l74.329"></a><span id="l74.329" class="difflineplus">+                                       junkEnableOverride);</span>
<a href="#l74.330"></a><span id="l74.330" class="difflineplus">+    if (junkEnableOverride.EqualsLiteral(&quot;true&quot;))</span>
<a href="#l74.331"></a><span id="l74.331" class="difflineplus">+      return PR_TRUE;</span>
<a href="#l74.332"></a><span id="l74.332" class="difflineplus">+  }</span>
<a href="#l74.333"></a><span id="l74.333" class="difflineplus">+</span>
<a href="#l74.334"></a><span id="l74.334" class="difflineplus">+  return PR_FALSE;</span>
<a href="#l74.335"></a><span id="l74.335" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -374,16 +374,18 @@ protected:</span>
<a href="#l75.4"></a><span id="l75.4">   virtual void OnHeaderAddedOrDeleted() {}	</span>
<a href="#l75.5"></a><span id="l75.5">   nsresult ToggleWatched( nsMsgViewIndex* indices,	PRInt32 numIndices);</span>
<a href="#l75.6"></a><span id="l75.6">   nsresult SetThreadWatched(nsIMsgThread *thread, nsMsgViewIndex index, PRBool watched);</span>
<a href="#l75.7"></a><span id="l75.7">   nsresult SetThreadIgnored(nsIMsgThread *thread, nsMsgViewIndex threadIndex, PRBool ignored);</span>
<a href="#l75.8"></a><span id="l75.8">   nsresult SetSubthreadKilled(nsIMsgDBHdr *header, nsMsgViewIndex msgIndex, PRBool ignored);</span>
<a href="#l75.9"></a><span id="l75.9">   nsresult DownloadForOffline(nsIMsgWindow *window, nsMsgViewIndex *indices, PRInt32 numIndices);</span>
<a href="#l75.10"></a><span id="l75.10">   nsresult DownloadFlaggedForOffline(nsIMsgWindow *window);</span>
<a href="#l75.11"></a><span id="l75.11">   nsMsgViewIndex	GetThreadFromMsgIndex(nsMsgViewIndex index, nsIMsgThread **threadHdr);</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineplus">+  /// Should junk commands be enabled for the current message in the view?</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+  PRBool JunkControlsEnabled(nsMsgViewIndex aViewIndex);</span>
<a href="#l75.14"></a><span id="l75.14"> </span>
<a href="#l75.15"></a><span id="l75.15">   // for sorting</span>
<a href="#l75.16"></a><span id="l75.16">   nsresult GetFieldTypeAndLenForSort(nsMsgViewSortTypeValue sortType, PRUint16 *pMaxLen, eFieldType *pFieldType);</span>
<a href="#l75.17"></a><span id="l75.17">   nsresult GetCollationKey(nsIMsgDBHdr *msgHdr, nsMsgViewSortTypeValue sortType, PRUint8 **result, </span>
<a href="#l75.18"></a><span id="l75.18">                           PRUint32 *len, nsIMsgCustomColumnHandler* colHandler = nsnull);</span>
<a href="#l75.19"></a><span id="l75.19">   nsresult GetLongField(nsIMsgDBHdr *msgHdr, nsMsgViewSortTypeValue sortType, PRUint32 *result, </span>
<a href="#l75.20"></a><span id="l75.20">                           nsIMsgCustomColumnHandler* colHandler = nsnull);</span>
<a href="#l75.21"></a><span id="l75.21">   static int FnSortIdKey(const void *pItem1, const void *pItem2, void *privateData);</span>
<a href="#l75.22"></a><span id="l75.22" class="difflineat">@@ -440,17 +442,22 @@ protected:</span>
<a href="#l75.23"></a><span id="l75.23">   nsMsgViewIndex          m_currentlyDisplayedViewIndex;</span>
<a href="#l75.24"></a><span id="l75.24">   // if we're deleting messages, we want to hold off loading messages on selection changed until the delete is done</span>
<a href="#l75.25"></a><span id="l75.25">   // and we want to batch notifications.</span>
<a href="#l75.26"></a><span id="l75.26">   PRPackedBool m_deletingRows;</span>
<a href="#l75.27"></a><span id="l75.27">   // for certain special folders </span>
<a href="#l75.28"></a><span id="l75.28">   // and decendents of those folders</span>
<a href="#l75.29"></a><span id="l75.29">   // (like the &quot;Sent&quot; folder, &quot;Sent/Old Sent&quot;)</span>
<a href="#l75.30"></a><span id="l75.30">   // the Sender column really shows recipients.</span>
<a href="#l75.31"></a><span id="l75.31" class="difflineplus">+</span>
<a href="#l75.32"></a><span id="l75.32" class="difflineplus">+  // Server types for this view's folder</span>
<a href="#l75.33"></a><span id="l75.33">   PRPackedBool mIsNews;             // we have special icons for news</span>
<a href="#l75.34"></a><span id="l75.34" class="difflineplus">+  PRPackedBool mIsRss;              // rss affects enabling of junk commands</span>
<a href="#l75.35"></a><span id="l75.35" class="difflineplus">+  PRPackedBool mIsXFVirtual;        // a virtual folder with multiple folders</span>
<a href="#l75.36"></a><span id="l75.36" class="difflineplus">+</span>
<a href="#l75.37"></a><span id="l75.37">   PRPackedBool mShowSizeInLines;    // for news we show lines instead of size when true</span>
<a href="#l75.38"></a><span id="l75.38">   PRPackedBool m_sortValid;</span>
<a href="#l75.39"></a><span id="l75.39">   PRPackedBool mSelectionSummarized;</span>
<a href="#l75.40"></a><span id="l75.40">   // we asked the front end to summarize the selection and it did not.</span>
<a href="#l75.41"></a><span id="l75.41">   PRPackedBool mSummarizeFailed;</span>
<a href="#l75.42"></a><span id="l75.42">   PRUint8      m_saveRestoreSelectionDepth;</span>
<a href="#l75.43"></a><span id="l75.43"> </span>
<a href="#l75.44"></a><span id="l75.44">   nsCOMPtr &lt;nsIMsgDatabase&gt; m_db;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -391,18 +391,19 @@ NS_IMETHODIMP nsMsgMailSession::AddMsgWi</span>
<a href="#l76.4"></a><span id="l76.4">   return NS_OK;</span>
<a href="#l76.5"></a><span id="l76.5"> }</span>
<a href="#l76.6"></a><span id="l76.6"> </span>
<a href="#l76.7"></a><span id="l76.7"> NS_IMETHODIMP nsMsgMailSession::RemoveMsgWindow(nsIMsgWindow *msgWindow)</span>
<a href="#l76.8"></a><span id="l76.8"> {</span>
<a href="#l76.9"></a><span id="l76.9">   mWindows.RemoveObject(msgWindow);</span>
<a href="#l76.10"></a><span id="l76.10">   // Mac keeps a hidden window open so the app doesn't shut down when</span>
<a href="#l76.11"></a><span id="l76.11">   // the last window is closed. So don't shutdown the account manager in that</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  // case.</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineminus">-#ifndef XP_MACOSX</span>
<a href="#l76.14"></a><span id="l76.14" class="difflineplus">+  // case. Similarly, for suite, we don't want to disable mailnews when the</span>
<a href="#l76.15"></a><span id="l76.15" class="difflineplus">+  // last mail window is closed.</span>
<a href="#l76.16"></a><span id="l76.16" class="difflineplus">+#if !defined(XP_MACOSX) &amp;&amp; !defined(MOZ_SUITE)</span>
<a href="#l76.17"></a><span id="l76.17">   if (!mWindows.Count())</span>
<a href="#l76.18"></a><span id="l76.18">   {</span>
<a href="#l76.19"></a><span id="l76.19">     nsresult rv;</span>
<a href="#l76.20"></a><span id="l76.20">     nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = </span>
<a href="#l76.21"></a><span id="l76.21">       do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l76.22"></a><span id="l76.22">     if (NS_FAILED(rv))</span>
<a href="#l76.23"></a><span id="l76.23">       return rv;</span>
<a href="#l76.24"></a><span id="l76.24">     accountManager-&gt;CleanupOnExit();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/base/src/searchSpec.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/base/src/searchSpec.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -375,52 +375,64 @@ SearchSpec.prototype = {</span>
<a href="#l77.4"></a><span id="l77.4">     //  MatchHdr.</span>
<a href="#l77.5"></a><span id="l77.5">     if (this.owner.isSynthetic) {</span>
<a href="#l77.6"></a><span id="l77.6">       // We don't want to pass in a folder, and we don't want to use the</span>
<a href="#l77.7"></a><span id="l77.7">       //  allSearchableGroups scope, so we cheat and use AddDirectoryScopeTerm.</span>
<a href="#l77.8"></a><span id="l77.8">       session.addDirectoryScopeTerm(nsMsgSearchScope.offlineMail);</span>
<a href="#l77.9"></a><span id="l77.9">       return;</span>
<a href="#l77.10"></a><span id="l77.10">     }</span>
<a href="#l77.11"></a><span id="l77.11"> </span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-    // We are filtering if we have mail view terms or user terms.  When</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineminus">-    //  filtering, we bias towards offline search.  The only time we would use</span>
<a href="#l77.14"></a><span id="l77.14" class="difflineminus">-    //  an online search when filtering is if one of the constraints uses the</span>
<a href="#l77.15"></a><span id="l77.15" class="difflineminus">-    //  body attribute and the folder is not marked for offline access.</span>
<a href="#l77.16"></a><span id="l77.16" class="difflineminus">-    // We are not filtering if we only have virtual folder terms, in which case</span>
<a href="#l77.17"></a><span id="l77.17" class="difflineminus">-    //  we honor the onlineSearch attribute.  This means that we use the</span>
<a href="#l77.18"></a><span id="l77.18" class="difflineminus">-    //  folder's server's searchScope if the folder is not explicitly marked</span>
<a href="#l77.19"></a><span id="l77.19" class="difflineminus">-    //  offline.</span>
<a href="#l77.20"></a><span id="l77.20" class="difflineminus">-    // For further discussion on this choice of logic, please read from:</span>
<a href="#l77.21"></a><span id="l77.21" class="difflineminus">-    //  https://bugzilla.mozilla.org/show_bug.cgi?id=474701#c73</span>
<a href="#l77.22"></a><span id="l77.22" class="difflineminus">-    let filtering = this._virtualFolderTerms == null &amp;&amp;</span>
<a href="#l77.23"></a><span id="l77.23" class="difflineminus">-                    this._viewTerms == null;</span>
<a href="#l77.24"></a><span id="l77.24" class="difflineminus">-</span>
<a href="#l77.25"></a><span id="l77.25">     let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l77.26"></a><span id="l77.26">                       .getService(Ci.nsIIOService);</span>
<a href="#l77.27"></a><span id="l77.27" class="difflineplus">+    let validityManager = Cc['@mozilla.org/mail/search/validityManager;1']</span>
<a href="#l77.28"></a><span id="l77.28" class="difflineplus">+                            .getService(Ci.nsIMsgSearchValidityManager);</span>
<a href="#l77.29"></a><span id="l77.29">     for each (let [, folder] in Iterator(this.owner._underlyingFolders)) {</span>
<a href="#l77.30"></a><span id="l77.30">       // we do not need to check isServer here because _underlyingFolders</span>
<a href="#l77.31"></a><span id="l77.31">       //  filtered it out when it was initialized.</span>
<a href="#l77.32"></a><span id="l77.32"> </span>
<a href="#l77.33"></a><span id="l77.33">       let scope;</span>
<a href="#l77.34"></a><span id="l77.34" class="difflineminus">-      let folderIsOffline = (folder instanceof nsIMsgLocalMailFolder) ||</span>
<a href="#l77.35"></a><span id="l77.35" class="difflineminus">-                            (folder.flags &amp; nsMsgFolderFlags.Offline) ||</span>
<a href="#l77.36"></a><span id="l77.36" class="difflineminus">-                            ioService.offline;</span>
<a href="#l77.37"></a><span id="l77.37" class="difflineminus">-      // To restate the above logic into simpler rules, the scope is definitely</span>
<a href="#l77.38"></a><span id="l77.38" class="difflineminus">-      //  offline if:</span>
<a href="#l77.39"></a><span id="l77.39" class="difflineminus">-      // - Folders available offline always use offline search.</span>
<a href="#l77.40"></a><span id="l77.40" class="difflineminus">-      // - If we are filtering and don't have a body term, use offline search.</span>
<a href="#l77.41"></a><span id="l77.41" class="difflineminus">-      // - If we are not filtering and our virtual folder is not marked for</span>
<a href="#l77.42"></a><span id="l77.42" class="difflineminus">-      //   onlineSearch.</span>
<a href="#l77.43"></a><span id="l77.43" class="difflineminus">-      if (folderIsOffline ||</span>
<a href="#l77.44"></a><span id="l77.44" class="difflineminus">-          (filtering &amp;&amp; !haveBodyTerm) ||</span>
<a href="#l77.45"></a><span id="l77.45" class="difflineminus">-          (!filtering &amp;&amp; !this.onlineSearch))</span>
<a href="#l77.46"></a><span id="l77.46" class="difflineminus">-        scope = nsMsgSearchScope.offlineMail;</span>
<a href="#l77.47"></a><span id="l77.47" class="difflineminus">-      // Otherwise, it's up to the folder's sever's searchScope.</span>
<a href="#l77.48"></a><span id="l77.48" class="difflineminus">-      else</span>
<a href="#l77.49"></a><span id="l77.49" class="difflineminus">-        scope = folder.server.searchScope;</span>
<a href="#l77.50"></a><span id="l77.50" class="difflineplus">+      let serverScope = folder.server.searchScope;</span>
<a href="#l77.51"></a><span id="l77.51" class="difflineplus">+      // If we're offline, or this is a local folder, or there's no separate</span>
<a href="#l77.52"></a><span id="l77.52" class="difflineplus">+      //  online scope, use server scope.</span>
<a href="#l77.53"></a><span id="l77.53" class="difflineplus">+      if (ioService.offline || (serverScope == nsMsgSearchScope.offlineMail) ||</span>
<a href="#l77.54"></a><span id="l77.54" class="difflineplus">+                               (folder instanceof nsIMsgLocalMailFolder))</span>
<a href="#l77.55"></a><span id="l77.55" class="difflineplus">+        scope = serverScope;</span>
<a href="#l77.56"></a><span id="l77.56" class="difflineplus">+      else {</span>
<a href="#l77.57"></a><span id="l77.57" class="difflineplus">+        // we need to test the validity in online and offline tables</span>
<a href="#l77.58"></a><span id="l77.58" class="difflineplus">+        let onlineValidityTable = validityManager.getTable(serverScope);</span>
<a href="#l77.59"></a><span id="l77.59" class="difflineplus">+</span>
<a href="#l77.60"></a><span id="l77.60" class="difflineplus">+        let offlineScope;</span>
<a href="#l77.61"></a><span id="l77.61" class="difflineplus">+        if (folder.flags &amp; nsMsgFolderFlags.Offline)</span>
<a href="#l77.62"></a><span id="l77.62" class="difflineplus">+          offlineScope = nsMsgSearchScope.offlineMail;</span>
<a href="#l77.63"></a><span id="l77.63" class="difflineplus">+        else</span>
<a href="#l77.64"></a><span id="l77.64" class="difflineplus">+          // The onlineManual table is used for local search when there is no</span>
<a href="#l77.65"></a><span id="l77.65" class="difflineplus">+          //  body available.</span>
<a href="#l77.66"></a><span id="l77.66" class="difflineplus">+          offlineScope = nsMsgSearchScope.onlineManual;</span>
<a href="#l77.67"></a><span id="l77.67" class="difflineplus">+</span>
<a href="#l77.68"></a><span id="l77.68" class="difflineplus">+        let offlineValidityTable = validityManager.getTable(offlineScope);</span>
<a href="#l77.69"></a><span id="l77.69" class="difflineplus">+        let offlineAvailable = true;</span>
<a href="#l77.70"></a><span id="l77.70" class="difflineplus">+        let onlineAvailable = true;</span>
<a href="#l77.71"></a><span id="l77.71" class="difflineplus">+        for each (let term in fixIterator(session.searchTerms,</span>
<a href="#l77.72"></a><span id="l77.72" class="difflineplus">+                                          nsIMsgSearchTerm)) {</span>
<a href="#l77.73"></a><span id="l77.73" class="difflineplus">+          if (!term.matchAll) {</span>
<a href="#l77.74"></a><span id="l77.74" class="difflineplus">+            if (!offlineValidityTable.getAvailable(term.attrib, term.op))</span>
<a href="#l77.75"></a><span id="l77.75" class="difflineplus">+              offlineAvailable = false;</span>
<a href="#l77.76"></a><span id="l77.76" class="difflineplus">+            if (!onlineValidityTable.getAvailable(term.attrib, term.op))</span>
<a href="#l77.77"></a><span id="l77.77" class="difflineplus">+              onlineAvailable = false;</span>
<a href="#l77.78"></a><span id="l77.78" class="difflineplus">+          }</span>
<a href="#l77.79"></a><span id="l77.79" class="difflineplus">+        }</span>
<a href="#l77.80"></a><span id="l77.80" class="difflineplus">+        // If both scopes work, honor the onlineSearch request</span>
<a href="#l77.81"></a><span id="l77.81" class="difflineplus">+        if (onlineAvailable &amp;&amp; offlineAvailable)</span>
<a href="#l77.82"></a><span id="l77.82" class="difflineplus">+          scope = this.onlineSearch ? serverScope : offlineScope;</span>
<a href="#l77.83"></a><span id="l77.83" class="difflineplus">+        // If only one works, use it. Otherwise, default to offline</span>
<a href="#l77.84"></a><span id="l77.84" class="difflineplus">+        else if (onlineAvailable)</span>
<a href="#l77.85"></a><span id="l77.85" class="difflineplus">+          scope = serverScope;</span>
<a href="#l77.86"></a><span id="l77.86" class="difflineplus">+        else</span>
<a href="#l77.87"></a><span id="l77.87" class="difflineplus">+          scope = offlineScope;</span>
<a href="#l77.88"></a><span id="l77.88" class="difflineplus">+      }</span>
<a href="#l77.89"></a><span id="l77.89">       session.addScopeTerm(scope, folder);</span>
<a href="#l77.90"></a><span id="l77.90">     }</span>
<a href="#l77.91"></a><span id="l77.91">   },</span>
<a href="#l77.92"></a><span id="l77.92"> </span>
<a href="#l77.93"></a><span id="l77.93">   prettyStringOfSearchTerms: function(aSearchTerms) {</span>
<a href="#l77.94"></a><span id="l77.94">     if (aSearchTerms == null)</span>
<a href="#l77.95"></a><span id="l77.95">       return '      (none)\n';</span>
<a href="#l77.96"></a><span id="l77.96"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -335,17 +335,17 @@ nsMsgI18NParseMetaCharset(nsILocalFile* </span>
<a href="#l78.4"></a><span id="l78.4"> { </span>
<a href="#l78.5"></a><span id="l78.5">   static char charset[nsIMimeConverter::MAX_CHARSET_NAME_LENGTH+1];</span>
<a href="#l78.6"></a><span id="l78.6"> </span>
<a href="#l78.7"></a><span id="l78.7">   *charset = '\0'; </span>
<a href="#l78.8"></a><span id="l78.8"> </span>
<a href="#l78.9"></a><span id="l78.9">   PRBool isDirectory = PR_FALSE;</span>
<a href="#l78.10"></a><span id="l78.10">   file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l78.11"></a><span id="l78.11">   if (isDirectory) {</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-    NS_ASSERTION(0,&quot;file is a directory&quot;);</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+    NS_ERROR(&quot;file is a directory&quot;);</span>
<a href="#l78.14"></a><span id="l78.14">     return charset; </span>
<a href="#l78.15"></a><span id="l78.15">   }</span>
<a href="#l78.16"></a><span id="l78.16"> </span>
<a href="#l78.17"></a><span id="l78.17">   nsresult rv;</span>
<a href="#l78.18"></a><span id="l78.18">   nsCOMPtr &lt;nsIFileInputStream&gt; fileStream = do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l78.19"></a><span id="l78.19">   NS_ENSURE_SUCCESS(rv, charset);</span>
<a href="#l78.20"></a><span id="l78.20">   </span>
<a href="#l78.21"></a><span id="l78.21">   rv = fileStream-&gt;Init(file, PR_RDONLY, 0664, PR_FALSE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -756,21 +756,19 @@ void nsMsgIncomingServer::GetPasswordWit</span>
<a href="#l79.4"></a><span id="l79.4">     NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numLogins, logins);</span>
<a href="#l79.5"></a><span id="l79.5">   }</span>
<a href="#l79.6"></a><span id="l79.6"> }</span>
<a href="#l79.7"></a><span id="l79.7"> </span>
<a href="#l79.8"></a><span id="l79.8"> NS_IMETHODIMP</span>
<a href="#l79.9"></a><span id="l79.9"> nsMsgIncomingServer::GetPasswordWithUI(const nsAString&amp; aPromptMessage, const</span>
<a href="#l79.10"></a><span id="l79.10">                                        nsAString&amp; aPromptTitle,</span>
<a href="#l79.11"></a><span id="l79.11">                                        nsIMsgWindow* aMsgWindow,</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-                                       PRBool *okayValue,</span>
<a href="#l79.13"></a><span id="l79.13">                                        nsACString&amp; aPassword)</span>
<a href="#l79.14"></a><span id="l79.14"> {</span>
<a href="#l79.15"></a><span id="l79.15">   nsresult rv = NS_OK;</span>
<a href="#l79.16"></a><span id="l79.16" class="difflineminus">-  NS_ENSURE_ARG_POINTER(okayValue);</span>
<a href="#l79.17"></a><span id="l79.17"> </span>
<a href="#l79.18"></a><span id="l79.18">   if (m_password.IsEmpty())</span>
<a href="#l79.19"></a><span id="l79.19">   {</span>
<a href="#l79.20"></a><span id="l79.20">     // let's see if we have the password in the password manager and</span>
<a href="#l79.21"></a><span id="l79.21">     // can avoid this prompting thing. This makes it easier to get embedders</span>
<a href="#l79.22"></a><span id="l79.22">     // to get up and running w/o a password prompting UI.</span>
<a href="#l79.23"></a><span id="l79.23">     GetPasswordWithoutUI();</span>
<a href="#l79.24"></a><span id="l79.24">   }</span>
<a href="#l79.25"></a><span id="l79.25" class="difflineat">@@ -813,26 +811,27 @@ nsMsgIncomingServer::GetPasswordWithUI(c</span>
<a href="#l79.26"></a><span id="l79.26"> </span>
<a href="#l79.27"></a><span id="l79.27">       // we pass in the previously used password, if any, into PromptPassword</span>
<a href="#l79.28"></a><span id="l79.28">       // so that it will appear as ******. This means we can't use an nsString</span>
<a href="#l79.29"></a><span id="l79.29">       // and getter_Copies.</span>
<a href="#l79.30"></a><span id="l79.30">       PRUnichar *uniPassword = nsnull;</span>
<a href="#l79.31"></a><span id="l79.31">       if (!aPassword.IsEmpty())</span>
<a href="#l79.32"></a><span id="l79.32">         uniPassword = ToNewUnicode(NS_ConvertASCIItoUTF16(aPassword));</span>
<a href="#l79.33"></a><span id="l79.33"> </span>
<a href="#l79.34"></a><span id="l79.34" class="difflineplus">+      PRBool okayValue = PR_TRUE;</span>
<a href="#l79.35"></a><span id="l79.35">       rv = dialog-&gt;PromptPassword(PromiseFlatString(aPromptTitle).get(),</span>
<a href="#l79.36"></a><span id="l79.36">                                   PromiseFlatString(aPromptMessage).get(),</span>
<a href="#l79.37"></a><span id="l79.37">                                   NS_ConvertASCIItoUTF16(serverUri).get(),</span>
<a href="#l79.38"></a><span id="l79.38">                                   nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l79.39"></a><span id="l79.39" class="difflineminus">-                                  &amp;uniPassword, okayValue);</span>
<a href="#l79.40"></a><span id="l79.40" class="difflineplus">+                                  &amp;uniPassword, &amp;okayValue);</span>
<a href="#l79.41"></a><span id="l79.41">       nsAutoString uniPasswordAdopted;</span>
<a href="#l79.42"></a><span id="l79.42">       uniPasswordAdopted.Adopt(uniPassword);</span>
<a href="#l79.43"></a><span id="l79.43">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.44"></a><span id="l79.44"> </span>
<a href="#l79.45"></a><span id="l79.45" class="difflineminus">-      if (!*okayValue) // if the user pressed cancel, just return an empty string;</span>
<a href="#l79.46"></a><span id="l79.46" class="difflineplus">+      if (!okayValue) // if the user pressed cancel, just return an empty string;</span>
<a href="#l79.47"></a><span id="l79.47">       {</span>
<a href="#l79.48"></a><span id="l79.48">         aPassword.Truncate();</span>
<a href="#l79.49"></a><span id="l79.49">         return NS_MSG_PASSWORD_PROMPT_CANCELLED;</span>
<a href="#l79.50"></a><span id="l79.50">       }</span>
<a href="#l79.51"></a><span id="l79.51"> </span>
<a href="#l79.52"></a><span id="l79.52">       // we got a password back...so remember it</span>
<a href="#l79.53"></a><span id="l79.53">       rv = SetPassword(NS_LossyConvertUTF16toASCII(uniPasswordAdopted));</span>
<a href="#l79.54"></a><span id="l79.54">       NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/compose/content/askSendFormat.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/compose/content/askSendFormat.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -18,173 +18,78 @@</span>
<a href="#l80.4"></a><span id="l80.4">  * Portions created by the Initial Developer are Copyright (C) 2000</span>
<a href="#l80.5"></a><span id="l80.5">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l80.6"></a><span id="l80.6">  *</span>
<a href="#l80.7"></a><span id="l80.7">  * Contributor(s):</span>
<a href="#l80.8"></a><span id="l80.8">  *   Jean-Francois Ducarroz &lt;ducarroz@netscape.com&gt;</span>
<a href="#l80.9"></a><span id="l80.9">  *   Ben Bucksch &lt;mozilla.BenB@bucksch.org&gt;</span>
<a href="#l80.10"></a><span id="l80.10">  *   Ian Neal &lt;bugzilla@arlen.demon.co.uk&gt;</span>
<a href="#l80.11"></a><span id="l80.11">  *   iga Sancin &lt;bisi@pikslar.com&gt;</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineplus">+ *   Magnus Melin &lt;mkmelin+mozilla@iki.fi&gt;</span>
<a href="#l80.13"></a><span id="l80.13">  *</span>
<a href="#l80.14"></a><span id="l80.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l80.15"></a><span id="l80.15">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l80.16"></a><span id="l80.16">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l80.17"></a><span id="l80.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l80.18"></a><span id="l80.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l80.19"></a><span id="l80.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l80.20"></a><span id="l80.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l80.21"></a><span id="l80.21">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l80.22"></a><span id="l80.22">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l80.23"></a><span id="l80.23">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l80.24"></a><span id="l80.24">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l80.25"></a><span id="l80.25">  *</span>
<a href="#l80.26"></a><span id="l80.26">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l80.27"></a><span id="l80.27"> </span>
<a href="#l80.28"></a><span id="l80.28" class="difflineminus">-var msgCompSendFormat = Components.interfaces.nsIMsgCompSendFormat;</span>
<a href="#l80.29"></a><span id="l80.29" class="difflineminus">-var msgCompConvertible = Components.interfaces.nsIMsgCompConvertible;</span>
<a href="#l80.30"></a><span id="l80.30" class="difflineminus">-var param = null;</span>
<a href="#l80.31"></a><span id="l80.31" class="difflineminus">-</span>
<a href="#l80.32"></a><span id="l80.32" class="difflineminus">-/* There are 3 preferences that let you customize the behavior of this dialog</span>
<a href="#l80.33"></a><span id="l80.33" class="difflineminus">-</span>
<a href="#l80.34"></a><span id="l80.34" class="difflineminus">-1. pref(&quot;mail.asksendformat.default&quot;, 1); //1=plaintext, 2=html, 3=both</span>
<a href="#l80.35"></a><span id="l80.35" class="difflineminus">-   This defines the default action selected when the dialog opens. It can be overwritten by the preference</span>
<a href="#l80.36"></a><span id="l80.36" class="difflineminus">-   mail.asksendformat.recommended_as_default</span>
<a href="#l80.37"></a><span id="l80.37" class="difflineminus">-</span>
<a href="#l80.38"></a><span id="l80.38" class="difflineminus">-</span>
<a href="#l80.39"></a><span id="l80.39" class="difflineminus">-2. pref(&quot;mail.asksendformat.recommended_as_default&quot;, true);</span>
<a href="#l80.40"></a><span id="l80.40" class="difflineminus">-   If you set this preference to true and we have a recommended action, this action will be selected by default.</span>
<a href="#l80.41"></a><span id="l80.41" class="difflineminus">-   In this case, we ignore the preference mail.asksendformat.default</span>
<a href="#l80.42"></a><span id="l80.42" class="difflineminus">-</span>
<a href="#l80.43"></a><span id="l80.43" class="difflineminus">-</span>
<a href="#l80.44"></a><span id="l80.44" class="difflineminus">-3. pref(&quot;mail.asksendformat.display_recommendation&quot;, true);</span>
<a href="#l80.45"></a><span id="l80.45" class="difflineminus">-   When this preference is set to false, the recommended action label will not be displayed next to the action</span>
<a href="#l80.46"></a><span id="l80.46" class="difflineminus">-   radio button. However, the default action might change to the recommended one if the preference</span>
<a href="#l80.47"></a><span id="l80.47" class="difflineminus">-   mail.asksendformat.recommended_as_default is set.</span>
<a href="#l80.48"></a><span id="l80.48" class="difflineminus">-*/</span>
<a href="#l80.49"></a><span id="l80.49" class="difflineminus">-</span>
<a href="#l80.50"></a><span id="l80.50" class="difflineminus">-var defaultAction = msgCompSendFormat.PlainText;</span>
<a href="#l80.51"></a><span id="l80.51" class="difflineminus">-var recommended_as_default = true;</span>
<a href="#l80.52"></a><span id="l80.52" class="difflineminus">-var display_recommendation = true;</span>
<a href="#l80.53"></a><span id="l80.53" class="difflineminus">-var useDefault = false;</span>
<a href="#l80.54"></a><span id="l80.54" class="difflineplus">+var gParam = null;</span>
<a href="#l80.55"></a><span id="l80.55"> </span>
<a href="#l80.56"></a><span id="l80.56" class="difflineminus">-var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService();</span>
<a href="#l80.57"></a><span id="l80.57" class="difflineminus">-if (prefs)</span>
<a href="#l80.58"></a><span id="l80.58" class="difflineminus">-{</span>
<a href="#l80.59"></a><span id="l80.59" class="difflineminus">-  prefs = prefs.QueryInterface(Components.interfaces.nsIPrefBranch);</span>
<a href="#l80.60"></a><span id="l80.60" class="difflineminus">-  if (prefs)</span>
<a href="#l80.61"></a><span id="l80.61" class="difflineminus">-  {</span>
<a href="#l80.62"></a><span id="l80.62" class="difflineminus">-    try</span>
<a href="#l80.63"></a><span id="l80.63" class="difflineminus">-    {</span>
<a href="#l80.64"></a><span id="l80.64" class="difflineminus">-      defaultAction = prefs.getIntPref(&quot;mail.asksendformat.default&quot;);</span>
<a href="#l80.65"></a><span id="l80.65" class="difflineminus">-      useDefault = true;</span>
<a href="#l80.66"></a><span id="l80.66" class="difflineminus">-    }</span>
<a href="#l80.67"></a><span id="l80.67" class="difflineminus">-    catch (ex) {}</span>
<a href="#l80.68"></a><span id="l80.68" class="difflineminus">-</span>
<a href="#l80.69"></a><span id="l80.69" class="difflineminus">-    try</span>
<a href="#l80.70"></a><span id="l80.70" class="difflineminus">-    {</span>
<a href="#l80.71"></a><span id="l80.71" class="difflineminus">-      recommended_as_default = prefs.getBoolPref(&quot;mail.asksendformat.recommended_as_default&quot;);</span>
<a href="#l80.72"></a><span id="l80.72" class="difflineminus">-    }</span>
<a href="#l80.73"></a><span id="l80.73" class="difflineminus">-    catch (ex) {}</span>
<a href="#l80.74"></a><span id="l80.74" class="difflineminus">-</span>
<a href="#l80.75"></a><span id="l80.75" class="difflineminus">-    try</span>
<a href="#l80.76"></a><span id="l80.76" class="difflineminus">-    {</span>
<a href="#l80.77"></a><span id="l80.77" class="difflineminus">-      display_recommendation = prefs.getBoolPref(&quot;mail.asksendformat.display_recommendation&quot;);</span>
<a href="#l80.78"></a><span id="l80.78" class="difflineminus">-    }</span>
<a href="#l80.79"></a><span id="l80.79" class="difflineminus">-    catch (ex) {}</span>
<a href="#l80.80"></a><span id="l80.80" class="difflineminus">-  }</span>
<a href="#l80.81"></a><span id="l80.81" class="difflineminus">-}</span>
<a href="#l80.82"></a><span id="l80.82" class="difflineminus">-</span>
<a href="#l80.83"></a><span id="l80.83" class="difflineplus">+/**</span>
<a href="#l80.84"></a><span id="l80.84" class="difflineplus">+ * This dialog should be opened with arguments like e.g.</span>
<a href="#l80.85"></a><span id="l80.85" class="difflineplus">+ * {action: nsIMsgCompSendFormat.AskUser, convertible: nsIMsgCompConvertible.Yes}</span>
<a href="#l80.86"></a><span id="l80.86" class="difflineplus">+ */</span>
<a href="#l80.87"></a><span id="l80.87"> function Startup()</span>
<a href="#l80.88"></a><span id="l80.88"> {</span>
<a href="#l80.89"></a><span id="l80.89" class="difflineminus">-  if (window.arguments &amp;&amp; window.arguments[0])</span>
<a href="#l80.90"></a><span id="l80.90" class="difflineminus">-  {</span>
<a href="#l80.91"></a><span id="l80.91" class="difflineminus">-    var askSendFormatStringBundle = document.getElementById(&quot;askSendFormatStringBundle&quot;);</span>
<a href="#l80.92"></a><span id="l80.92" class="difflineminus">-    param = window.arguments[0];</span>
<a href="#l80.93"></a><span id="l80.93" class="difflineminus">-    // If the user hits the close box, we will abort.</span>
<a href="#l80.94"></a><span id="l80.94" class="difflineminus">-    param.abort = true;</span>
<a href="#l80.95"></a><span id="l80.95" class="difflineminus">-    if (param.action)</span>
<a href="#l80.96"></a><span id="l80.96" class="difflineminus">-    {</span>
<a href="#l80.97"></a><span id="l80.97" class="difflineminus">-      // Set the question label</span>
<a href="#l80.98"></a><span id="l80.98" class="difflineminus">-      var mailSendFormatExplanation = document.getElementById(&quot;mailSendFormatExplanation&quot;);</span>
<a href="#l80.99"></a><span id="l80.99" class="difflineminus">-      var icon = document.getElementById(&quot;convertDefault&quot;);</span>
<a href="#l80.100"></a><span id="l80.100" class="difflineminus">-      switch (param.convertible)</span>
<a href="#l80.101"></a><span id="l80.101" class="difflineminus">-      {</span>
<a href="#l80.102"></a><span id="l80.102" class="difflineminus">-        case msgCompConvertible.Plain:</span>
<a href="#l80.103"></a><span id="l80.103" class="difflineminus">-          // We shouldn't be here at all</span>
<a href="#l80.104"></a><span id="l80.104" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleYes&quot;);</span>
<a href="#l80.105"></a><span id="l80.105" class="difflineminus">-          // No icon</span>
<a href="#l80.106"></a><span id="l80.106" class="difflineminus">-          break;</span>
<a href="#l80.107"></a><span id="l80.107" class="difflineminus">-        case msgCompConvertible.Yes:</span>
<a href="#l80.108"></a><span id="l80.108" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleYes&quot;);</span>
<a href="#l80.109"></a><span id="l80.109" class="difflineminus">-          icon.setAttribute(&quot;id&quot;, &quot;convertYes&quot;);</span>
<a href="#l80.110"></a><span id="l80.110" class="difflineminus">-          break;</span>
<a href="#l80.111"></a><span id="l80.111" class="difflineminus">-        case msgCompConvertible.Altering:</span>
<a href="#l80.112"></a><span id="l80.112" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleAltering&quot;);</span>
<a href="#l80.113"></a><span id="l80.113" class="difflineminus">-          icon.setAttribute(&quot;id&quot;, &quot;convertAltering&quot;);</span>
<a href="#l80.114"></a><span id="l80.114" class="difflineminus">-          break;</span>
<a href="#l80.115"></a><span id="l80.115" class="difflineminus">-        case msgCompConvertible.No:</span>
<a href="#l80.116"></a><span id="l80.116" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleNo&quot;);</span>
<a href="#l80.117"></a><span id="l80.117" class="difflineminus">-          icon.setAttribute(&quot;id&quot;, &quot;convertNo&quot;);</span>
<a href="#l80.118"></a><span id="l80.118" class="difflineminus">-          break;</span>
<a href="#l80.119"></a><span id="l80.119" class="difflineminus">-      }</span>
<a href="#l80.120"></a><span id="l80.120" class="difflineplus">+  gParam = window.arguments[0];</span>
<a href="#l80.121"></a><span id="l80.121" class="difflineplus">+</span>
<a href="#l80.122"></a><span id="l80.122" class="difflineplus">+  const msgCompSendFormat = Components.interfaces.nsIMsgCompSendFormat;</span>
<a href="#l80.123"></a><span id="l80.123" class="difflineplus">+  const msgCompConvertible = Components.interfaces.nsIMsgCompConvertible;</span>
<a href="#l80.124"></a><span id="l80.124" class="difflineplus">+</span>
<a href="#l80.125"></a><span id="l80.125" class="difflineplus">+  var bundle = document.getElementById(&quot;askSendFormatStringBundle&quot;);</span>
<a href="#l80.126"></a><span id="l80.126" class="difflineplus">+</span>
<a href="#l80.127"></a><span id="l80.127" class="difflineplus">+  // If the user hits the close box, we will abort.</span>
<a href="#l80.128"></a><span id="l80.128" class="difflineplus">+  gParam.abort = true;</span>
<a href="#l80.129"></a><span id="l80.129" class="difflineplus">+</span>
<a href="#l80.130"></a><span id="l80.130" class="difflineplus">+  // Set the question label</span>
<a href="#l80.131"></a><span id="l80.131" class="difflineplus">+  var mailSendFormatExplanation = document.getElementById(&quot;mailSendFormatExplanation&quot;);</span>
<a href="#l80.132"></a><span id="l80.132" class="difflineplus">+  var icon = document.getElementById(&quot;convertDefault&quot;);</span>
<a href="#l80.133"></a><span id="l80.133"> </span>
<a href="#l80.134"></a><span id="l80.134" class="difflineminus">-      // Set the default radio array value and recommendation</span>
<a href="#l80.135"></a><span id="l80.135" class="difflineminus">-      var group = document.getElementById(&quot;mailDefaultHTMLAction&quot;);</span>
<a href="#l80.136"></a><span id="l80.136" class="difflineminus">-      var radio;</span>
<a href="#l80.137"></a><span id="l80.137" class="difflineminus">-      var radioButtons = group.getElementsByTagName(&quot;radio&quot;);</span>
<a href="#l80.138"></a><span id="l80.138" class="difflineminus">-      var haveRecommendation = false;</span>
<a href="#l80.139"></a><span id="l80.139" class="difflineminus">-      var format = (useDefault) ? defaultAction : param.action;</span>
<a href="#l80.140"></a><span id="l80.140" class="difflineplus">+  switch (gParam.convertible)</span>
<a href="#l80.141"></a><span id="l80.141" class="difflineplus">+  {</span>
<a href="#l80.142"></a><span id="l80.142" class="difflineplus">+    case msgCompConvertible.Altering:</span>
<a href="#l80.143"></a><span id="l80.143" class="difflineplus">+      mailSendFormatExplanation.textContent = bundle.getString(&quot;convertibleAltering&quot;);</span>
<a href="#l80.144"></a><span id="l80.144" class="difflineplus">+      icon.className = &quot;question-icon&quot;;</span>
<a href="#l80.145"></a><span id="l80.145" class="difflineplus">+      break;</span>
<a href="#l80.146"></a><span id="l80.146" class="difflineplus">+    case msgCompConvertible.No:</span>
<a href="#l80.147"></a><span id="l80.147" class="difflineplus">+      mailSendFormatExplanation.textContent = bundle.getString(&quot;convertibleNo&quot;);</span>
<a href="#l80.148"></a><span id="l80.148" class="difflineplus">+      icon.className = &quot;alert-icon&quot;;</span>
<a href="#l80.149"></a><span id="l80.149" class="difflineplus">+      break;</span>
<a href="#l80.150"></a><span id="l80.150" class="difflineplus">+    default: // msgCompConvertible.Yes</span>
<a href="#l80.151"></a><span id="l80.151" class="difflineplus">+      mailSendFormatExplanation.textContent = bundle.getString(&quot;convertibleYes&quot;);</span>
<a href="#l80.152"></a><span id="l80.152" class="difflineplus">+      // XXX change this to use class message-icon once bug 512173 is fixed</span>
<a href="#l80.153"></a><span id="l80.153" class="difflineplus">+      icon.className = &quot;question-icon&quot;;</span>
<a href="#l80.154"></a><span id="l80.154" class="difflineplus">+      break;</span>
<a href="#l80.155"></a><span id="l80.155" class="difflineplus">+  }</span>
<a href="#l80.156"></a><span id="l80.156"> </span>
<a href="#l80.157"></a><span id="l80.157" class="difflineminus">-      switch (format)</span>
<a href="#l80.158"></a><span id="l80.158" class="difflineminus">-      {</span>
<a href="#l80.159"></a><span id="l80.159" class="difflineminus">-        case msgCompSendFormat.AskUser:</span>
<a href="#l80.160"></a><span id="l80.160" class="difflineminus">-          // haveRecommendation = false;</span>
<a href="#l80.161"></a><span id="l80.161" class="difflineminus">-          break;</span>
<a href="#l80.162"></a><span id="l80.162" class="difflineminus">-        case msgCompSendFormat.PlainText:</span>
<a href="#l80.163"></a><span id="l80.163" class="difflineminus">-          radio = radioButtons[1];</span>
<a href="#l80.164"></a><span id="l80.164" class="difflineminus">-          haveRecommendation = true;</span>
<a href="#l80.165"></a><span id="l80.165" class="difflineminus">-          break;</span>
<a href="#l80.166"></a><span id="l80.166" class="difflineminus">-        case msgCompSendFormat.Both:</span>
<a href="#l80.167"></a><span id="l80.167" class="difflineminus">-          radio = radioButtons[0];</span>
<a href="#l80.168"></a><span id="l80.168" class="difflineminus">-          haveRecommendation = true;</span>
<a href="#l80.169"></a><span id="l80.169" class="difflineminus">-          break;</span>
<a href="#l80.170"></a><span id="l80.170" class="difflineminus">-        case msgCompSendFormat.HTML:</span>
<a href="#l80.171"></a><span id="l80.171" class="difflineminus">-          radio = radioButtons[2];</span>
<a href="#l80.172"></a><span id="l80.172" class="difflineminus">-          haveRecommendation = true;</span>
<a href="#l80.173"></a><span id="l80.173" class="difflineminus">-          break;</span>
<a href="#l80.174"></a><span id="l80.174" class="difflineminus">-      }</span>
<a href="#l80.175"></a><span id="l80.175" class="difflineminus">-</span>
<a href="#l80.176"></a><span id="l80.176" class="difflineminus">-      if (haveRecommendation)</span>
<a href="#l80.177"></a><span id="l80.177" class="difflineminus">-      {</span>
<a href="#l80.178"></a><span id="l80.178" class="difflineminus">-        if (display_recommendation)</span>
<a href="#l80.179"></a><span id="l80.179" class="difflineminus">-          radio.label += &quot; &quot; + askSendFormatStringBundle.getString(&quot;recommended&quot;);</span>
<a href="#l80.180"></a><span id="l80.180" class="difflineminus">-</span>
<a href="#l80.181"></a><span id="l80.181" class="difflineminus">-        if (recommended_as_default)</span>
<a href="#l80.182"></a><span id="l80.182" class="difflineminus">-          group.value = format;</span>
<a href="#l80.183"></a><span id="l80.183" class="difflineminus">-      }</span>
<a href="#l80.184"></a><span id="l80.184" class="difflineminus">-</span>
<a href="#l80.185"></a><span id="l80.185" class="difflineminus">-      if (!haveRecommendation || !recommended_as_default)</span>
<a href="#l80.186"></a><span id="l80.186" class="difflineminus">-        group.value = defaultAction;</span>
<a href="#l80.187"></a><span id="l80.187" class="difflineminus">-    }</span>
<a href="#l80.188"></a><span id="l80.188" class="difflineminus">-  }</span>
<a href="#l80.189"></a><span id="l80.189" class="difflineminus">-  else </span>
<a href="#l80.190"></a><span id="l80.190" class="difflineplus">+  // Set the default radio array value and recommendation.</span>
<a href="#l80.191"></a><span id="l80.191" class="difflineplus">+  var group = document.getElementById(&quot;mailDefaultHTMLAction&quot;);</span>
<a href="#l80.192"></a><span id="l80.192" class="difflineplus">+  if (gParam.action != msgCompSendFormat.AskUser)</span>
<a href="#l80.193"></a><span id="l80.193">   {</span>
<a href="#l80.194"></a><span id="l80.194" class="difflineminus">-    dump(&quot;error, no return object registered\n&quot;);</span>
<a href="#l80.195"></a><span id="l80.195" class="difflineplus">+    group.value = gParam.action;</span>
<a href="#l80.196"></a><span id="l80.196" class="difflineplus">+    group.selectedItem.label += &quot; &quot; + bundle.getString(&quot;recommended&quot;);</span>
<a href="#l80.197"></a><span id="l80.197">   }</span>
<a href="#l80.198"></a><span id="l80.198"> }</span>
<a href="#l80.199"></a><span id="l80.199"> </span>
<a href="#l80.200"></a><span id="l80.200"> function Send()</span>
<a href="#l80.201"></a><span id="l80.201"> {</span>
<a href="#l80.202"></a><span id="l80.202" class="difflineminus">-  if (param)</span>
<a href="#l80.203"></a><span id="l80.203" class="difflineminus">-  {</span>
<a href="#l80.204"></a><span id="l80.204" class="difflineminus">-    // param.action should be an integer for when it is returned to MsgComposeCommands.js</span>
<a href="#l80.205"></a><span id="l80.205" class="difflineminus">-    param.action = parseInt(document.getElementById(&quot;mailDefaultHTMLAction&quot;).value);</span>
<a href="#l80.206"></a><span id="l80.206" class="difflineminus">-    param.abort = false;</span>
<a href="#l80.207"></a><span id="l80.207" class="difflineminus">-  }</span>
<a href="#l80.208"></a><span id="l80.208" class="difflineminus">-  return true;</span>
<a href="#l80.209"></a><span id="l80.209" class="difflineplus">+  // gParam.action should be an integer for when it is returned to MsgComposeCommands.js</span>
<a href="#l80.210"></a><span id="l80.210" class="difflineplus">+  gParam.action = parseInt(document.getElementById(&quot;mailDefaultHTMLAction&quot;).value);</span>
<a href="#l80.211"></a><span id="l80.211" class="difflineplus">+  gParam.abort = false;</span>
<a href="#l80.212"></a><span id="l80.212"> }</span>
<a href="#l80.213"></a><span id="l80.213" class="difflineminus">-</span>
<a href="#l80.214"></a><span id="l80.214" class="difflineminus">-function Cancel()</span>
<a href="#l80.215"></a><span id="l80.215" class="difflineminus">-{</span>
<a href="#l80.216"></a><span id="l80.216" class="difflineminus">-  if (param)</span>
<a href="#l80.217"></a><span id="l80.217" class="difflineminus">-    param.abort = true;</span>
<a href="#l80.218"></a><span id="l80.218" class="difflineminus">-  return true;</span>
<a href="#l80.219"></a><span id="l80.219" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/compose/content/askSendFormat.xul</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/compose/content/askSendFormat.xul</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -34,29 +34,29 @@</span>
<a href="#l81.4"></a><span id="l81.4">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l81.5"></a><span id="l81.5">    - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l81.6"></a><span id="l81.6">    - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l81.7"></a><span id="l81.7">    - the provisions above, a recipient may use your version of this file under</span>
<a href="#l81.8"></a><span id="l81.8">    - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l81.9"></a><span id="l81.9">    -</span>
<a href="#l81.10"></a><span id="l81.10">    - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l81.11"></a><span id="l81.11"> </span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/dialogs.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/global.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l81.14"></a><span id="l81.14"> </span>
<a href="#l81.15"></a><span id="l81.15"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/messengercompose/askSendFormat.dtd&quot;&gt;</span>
<a href="#l81.16"></a><span id="l81.16"> </span>
<a href="#l81.17"></a><span id="l81.17"> &lt;dialog id=&quot;askSendFormat&quot;</span>
<a href="#l81.18"></a><span id="l81.18">         title=&quot;&amp;windowTitle.label;&quot;</span>
<a href="#l81.19"></a><span id="l81.19">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l81.20"></a><span id="l81.20">         buttonpack=&quot;center&quot;</span>
<a href="#l81.21"></a><span id="l81.21">         onload=&quot;Startup();&quot;</span>
<a href="#l81.22"></a><span id="l81.22" class="difflineminus">-        ondialogaccept=&quot;return Send();&quot;</span>
<a href="#l81.23"></a><span id="l81.23" class="difflineminus">-        ondialogcancel=&quot;return Cancel();&quot;</span>
<a href="#l81.24"></a><span id="l81.24" class="difflineplus">+        ondialogaccept=&quot;Send();&quot;</span>
<a href="#l81.25"></a><span id="l81.25">         buttonlabelaccept=&quot;&amp;send.label;&quot;</span>
<a href="#l81.26"></a><span id="l81.26" class="difflineminus">-        buttonaccesskeyaccept=&quot;&amp;send.accesskey;&quot;&gt;</span>
<a href="#l81.27"></a><span id="l81.27" class="difflineplus">+        buttonaccesskeyaccept=&quot;&amp;send.accesskey;&quot;</span>
<a href="#l81.28"></a><span id="l81.28" class="difflineplus">+        style=&quot;width: 75ch;&quot;&gt;</span>
<a href="#l81.29"></a><span id="l81.29"> </span>
<a href="#l81.30"></a><span id="l81.30">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l81.31"></a><span id="l81.31">           src=&quot;chrome://messenger/content/messengercompose/askSendFormat.js&quot;/&gt;</span>
<a href="#l81.32"></a><span id="l81.32"> </span>
<a href="#l81.33"></a><span id="l81.33">   &lt;stringbundle id=&quot;askSendFormatStringBundle&quot;</span>
<a href="#l81.34"></a><span id="l81.34">                 src=&quot;chrome://messenger/locale/messengercompose/askSendFormat.properties&quot;/&gt;</span>
<a href="#l81.35"></a><span id="l81.35"> </span>
<a href="#l81.36"></a><span id="l81.36">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l81.37"></a><span id="l81.37" class="difflineat">@@ -68,14 +68,15 @@</span>
<a href="#l81.38"></a><span id="l81.38">       &lt;separator orient=&quot;vertical&quot;/&gt;</span>
<a href="#l81.39"></a><span id="l81.39">       &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l81.40"></a><span id="l81.40">         &lt;description&gt;&amp;recipient.label;&lt;/description&gt;</span>
<a href="#l81.41"></a><span id="l81.41">         &lt;description id=&quot;mailSendFormatExplanation&quot;/&gt;</span>
<a href="#l81.42"></a><span id="l81.42">         &lt;description&gt;&amp;question.label;&lt;/description&gt;</span>
<a href="#l81.43"></a><span id="l81.43">         &lt;separator/&gt;</span>
<a href="#l81.44"></a><span id="l81.44">         &lt;radiogroup id=&quot;mailDefaultHTMLAction&quot;&gt;</span>
<a href="#l81.45"></a><span id="l81.45">           &lt;radio value=&quot;3&quot; label=&quot;&amp;plainTextAndHtml.label;&quot; accesskey=&quot;&amp;plainTextAndHtml.accesskey;&quot;/&gt;</span>
<a href="#l81.46"></a><span id="l81.46" class="difflineminus">-          &lt;radio value=&quot;1&quot; label=&quot;&amp;plainTextOnly.label;&quot; accesskey=&quot;&amp;plainTextOnly.accesskey;&quot;/&gt;</span>
<a href="#l81.47"></a><span id="l81.47" class="difflineplus">+          &lt;radio value=&quot;1&quot; selected=&quot;true&quot;</span>
<a href="#l81.48"></a><span id="l81.48" class="difflineplus">+                 label=&quot;&amp;plainTextOnly.label;&quot; accesskey=&quot;&amp;plainTextOnly.accesskey;&quot;/&gt;</span>
<a href="#l81.49"></a><span id="l81.49">           &lt;radio value=&quot;2&quot; label=&quot;&amp;htmlOnly.label;&quot; accesskey=&quot;&amp;htmlOnly.accesskey;&quot;/&gt;</span>
<a href="#l81.50"></a><span id="l81.50">         &lt;/radiogroup&gt;</span>
<a href="#l81.51"></a><span id="l81.51">       &lt;/vbox&gt;</span>
<a href="#l81.52"></a><span id="l81.52">     &lt;/hbox&gt;</span>
<a href="#l81.53"></a><span id="l81.53"> &lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -243,17 +243,17 @@ NS_IMETHODIMP nsMsgCompFields::SetSubjec</span>
<a href="#l82.4"></a><span id="l82.4"> </span>
<a href="#l82.5"></a><span id="l82.5"> NS_IMETHODIMP nsMsgCompFields::GetSubject(nsAString &amp;_retval)</span>
<a href="#l82.6"></a><span id="l82.6"> {</span>
<a href="#l82.7"></a><span id="l82.7">   return GetUnicodeHeader(MSG_SUBJECT_HEADER_ID, _retval);</span>
<a href="#l82.8"></a><span id="l82.8"> }</span>
<a href="#l82.9"></a><span id="l82.9"> </span>
<a href="#l82.10"></a><span id="l82.10"> NS_IMETHODIMP nsMsgCompFields::SetTemporaryFiles(const char *value)</span>
<a href="#l82.11"></a><span id="l82.11"> {</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-  NS_ASSERTION(0, &quot;nsMsgCompFields::SetTemporaryFiles is not supported anymore, please use nsMsgCompFields::AddAttachment&quot;);</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+  NS_ERROR(&quot;nsMsgCompFields::SetTemporaryFiles is not supported anymore, please use nsMsgCompFields::AddAttachment&quot;);</span>
<a href="#l82.14"></a><span id="l82.14">   return SetAsciiHeader(MSG_TEMPORARY_FILES_HEADER_ID, value);</span>
<a href="#l82.15"></a><span id="l82.15"> }</span>
<a href="#l82.16"></a><span id="l82.16"> </span>
<a href="#l82.17"></a><span id="l82.17"> NS_IMETHODIMP nsMsgCompFields::GetTemporaryFiles(char **_retval)</span>
<a href="#l82.18"></a><span id="l82.18"> {</span>
<a href="#l82.19"></a><span id="l82.19">   *_retval = strdup(GetAsciiHeader(MSG_TEMPORARY_FILES_HEADER_ID));</span>
<a href="#l82.20"></a><span id="l82.20">   return *_retval ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l82.21"></a><span id="l82.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.h</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.h</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -146,22 +146,22 @@ public:</span>
<a href="#l83.4"></a><span id="l83.4"> </span>
<a href="#l83.5"></a><span id="l83.5">   nsresult SetFollowupTo(const char *aValue) {return SetAsciiHeader(MSG_FOLLOWUP_TO_HEADER_ID, aValue);}</span>
<a href="#l83.6"></a><span id="l83.6">   const char* GetFollowupTo() {return GetAsciiHeader(MSG_FOLLOWUP_TO_HEADER_ID);}</span>
<a href="#l83.7"></a><span id="l83.7"> </span>
<a href="#l83.8"></a><span id="l83.8">   nsresult SetSubject(const char *value) {return SetAsciiHeader(MSG_SUBJECT_HEADER_ID, value);}</span>
<a href="#l83.9"></a><span id="l83.9">   const char* GetSubject() {return GetAsciiHeader(MSG_SUBJECT_HEADER_ID);}</span>
<a href="#l83.10"></a><span id="l83.10"> </span>
<a href="#l83.11"></a><span id="l83.11">   const char* GetAttachments() {</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-    NS_ASSERTION(0, &quot;nsMsgCompFields::GetAttachments is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+    NS_ERROR(&quot;nsMsgCompFields::GetAttachments is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l83.14"></a><span id="l83.14">     return GetAsciiHeader(MSG_ATTACHMENTS_HEADER_ID);</span>
<a href="#l83.15"></a><span id="l83.15">     }</span>
<a href="#l83.16"></a><span id="l83.16"> </span>
<a href="#l83.17"></a><span id="l83.17">   const char* GetTemporaryFiles() {</span>
<a href="#l83.18"></a><span id="l83.18" class="difflineminus">-    NS_ASSERTION(0, &quot;nsMsgCompFields::GetTemporaryFiles is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l83.19"></a><span id="l83.19" class="difflineplus">+    NS_ERROR(&quot;nsMsgCompFields::GetTemporaryFiles is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l83.20"></a><span id="l83.20">     return GetAsciiHeader(MSG_TEMPORARY_FILES_HEADER_ID);</span>
<a href="#l83.21"></a><span id="l83.21">     }</span>
<a href="#l83.22"></a><span id="l83.22"> </span>
<a href="#l83.23"></a><span id="l83.23">   nsresult SetOrganization(const char *value) {return SetAsciiHeader(MSG_ORGANIZATION_HEADER_ID, value);}</span>
<a href="#l83.24"></a><span id="l83.24">   const char* GetOrganization() {return GetAsciiHeader(MSG_ORGANIZATION_HEADER_ID);}</span>
<a href="#l83.25"></a><span id="l83.25"> </span>
<a href="#l83.26"></a><span id="l83.26">   const char* GetReferences() {return GetAsciiHeader(MSG_REFERENCES_HEADER_ID);}</span>
<a href="#l83.27"></a><span id="l83.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -3832,17 +3832,17 @@ nsMsgCompose::LoadDataFromFile(nsILocalF</span>
<a href="#l84.4"></a><span id="l84.4">   PRInt32       readSize;</span>
<a href="#l84.5"></a><span id="l84.5">   PRUint32       nGot;</span>
<a href="#l84.6"></a><span id="l84.6">   char          *readBuf;</span>
<a href="#l84.7"></a><span id="l84.7">   char          *ptr;</span>
<a href="#l84.8"></a><span id="l84.8"> </span>
<a href="#l84.9"></a><span id="l84.9">   PRBool isDirectory = PR_FALSE;</span>
<a href="#l84.10"></a><span id="l84.10">   file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l84.11"></a><span id="l84.11">   if (isDirectory) {</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-    NS_ASSERTION(0,&quot;file is a directory&quot;);</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+    NS_ERROR(&quot;file is a directory&quot;);</span>
<a href="#l84.14"></a><span id="l84.14">     return NS_MSG_ERROR_READING_FILE;</span>
<a href="#l84.15"></a><span id="l84.15">   }</span>
<a href="#l84.16"></a><span id="l84.16"> </span>
<a href="#l84.17"></a><span id="l84.17"> </span>
<a href="#l84.18"></a><span id="l84.18">   nsCOMPtr &lt;nsIInputStream&gt; inputFile;</span>
<a href="#l84.19"></a><span id="l84.19">   nsresult rv = NS_NewLocalFileInputStream(getter_AddRefs(inputFile), file);</span>
<a href="#l84.20"></a><span id="l84.20">   if (NS_FAILED(rv))</span>
<a href="#l84.21"></a><span id="l84.21">     return NS_MSG_ERROR_READING_FILE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -3657,17 +3657,17 @@ nsMsgComposeAndSend::DeliverFileAsMail()</span>
<a href="#l85.4"></a><span id="l85.4">     // &quot;prefers&quot; attribute in the ab.</span>
<a href="#l85.5"></a><span id="l85.5">     // see bug #245520 for more details</span>
<a href="#l85.6"></a><span id="l85.6">     // sendFormat = nsIAbPreferMailFormat::plaintext;</span>
<a href="#l85.7"></a><span id="l85.7">     sendFormat = nsIAbPreferMailFormat::unknown;</span>
<a href="#l85.8"></a><span id="l85.8">   }</span>
<a href="#l85.9"></a><span id="l85.9">   else if (!forcePlainText)</span>
<a href="#l85.10"></a><span id="l85.10">     sendFormat = nsIAbPreferMailFormat::html;</span>
<a href="#l85.11"></a><span id="l85.11">   else</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-    NS_ASSERTION(0,&quot;unknown send format, should not happen&quot;);</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+    NS_ERROR(&quot;unknown send format, should not happen&quot;);</span>
<a href="#l85.14"></a><span id="l85.14"> #endif</span>
<a href="#l85.15"></a><span id="l85.15"> </span>
<a href="#l85.16"></a><span id="l85.16">   PL_strcpy (buf, &quot;&quot;);</span>
<a href="#l85.17"></a><span id="l85.17">   buf2 = buf + PL_strlen (buf);</span>
<a href="#l85.18"></a><span id="l85.18">   if (mCompFields-&gt;GetTo() &amp;&amp; *mCompFields-&gt;GetTo())</span>
<a href="#l85.19"></a><span id="l85.19">   {</span>
<a href="#l85.20"></a><span id="l85.20">     PL_strcat (buf2, mCompFields-&gt;GetTo());</span>
<a href="#l85.21"></a><span id="l85.21">     if (addressCollector)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -131,17 +131,17 @@ NS_IMETHODIMP nsImapMailDatabase::ForceC</span>
<a href="#l86.4"></a><span id="l86.4"> </span>
<a href="#l86.5"></a><span id="l86.5"> NS_IMETHODIMP nsImapMailDatabase::GetFolderStream(nsIOutputStream **aFileStream)</span>
<a href="#l86.6"></a><span id="l86.6"> {</span>
<a href="#l86.7"></a><span id="l86.7">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l86.8"></a><span id="l86.8"> }</span>
<a href="#l86.9"></a><span id="l86.9"> </span>
<a href="#l86.10"></a><span id="l86.10"> NS_IMETHODIMP nsImapMailDatabase::SetFolderStream(nsIOutputStream *aFileStream)</span>
<a href="#l86.11"></a><span id="l86.11"> {</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-  NS_ASSERTION(0, &quot;Trying to set folderStream, not implemented&quot;);</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+  NS_ERROR(&quot;Trying to set folderStream, not implemented&quot;);</span>
<a href="#l86.14"></a><span id="l86.14">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l86.15"></a><span id="l86.15"> }</span>
<a href="#l86.16"></a><span id="l86.16"> </span>
<a href="#l86.17"></a><span id="l86.17"> nsresult nsImapMailDatabase::GetAllPendingHdrsTable()</span>
<a href="#l86.18"></a><span id="l86.18"> {</span>
<a href="#l86.19"></a><span id="l86.19">   nsresult rv = NS_OK;</span>
<a href="#l86.20"></a><span id="l86.20">   if (!m_mdbAllPendingHdrsTable)</span>
<a href="#l86.21"></a><span id="l86.21">     rv = GetTableCreateIfMissing(kPendingHdrsScope, kPendingHdrsTableKind, getter_AddRefs(m_mdbAllPendingHdrsTable),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -5343,17 +5343,17 @@ NS_IMETHODIMP nsMsgDatabase::ResetHdrCac</span>
<a href="#l87.4"></a><span id="l87.4"> </span>
<a href="#l87.5"></a><span id="l87.5"> NS_IMETHODIMP nsMsgDatabase::GetFolderStream(nsIOutputStream **aFileStream)</span>
<a href="#l87.6"></a><span id="l87.6"> {</span>
<a href="#l87.7"></a><span id="l87.7">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l87.8"></a><span id="l87.8"> }</span>
<a href="#l87.9"></a><span id="l87.9"> </span>
<a href="#l87.10"></a><span id="l87.10"> NS_IMETHODIMP nsMsgDatabase::SetFolderStream(nsIOutputStream *aFileStream)</span>
<a href="#l87.11"></a><span id="l87.11"> {</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-  NS_ASSERTION(0, &quot;Trying to set the folderStream, not implemented&quot;);</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+  NS_ERROR(&quot;Trying to set the folderStream, not implemented&quot;);</span>
<a href="#l87.14"></a><span id="l87.14">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l87.15"></a><span id="l87.15"> }</span>
<a href="#l87.16"></a><span id="l87.16"> </span>
<a href="#l87.17"></a><span id="l87.17"> /**</span>
<a href="#l87.18"></a><span id="l87.18">   void getNewList(out unsigned long count, [array, size_is(count)] out long newKeys);</span>
<a href="#l87.19"></a><span id="l87.19">  */</span>
<a href="#l87.20"></a><span id="l87.20"> NS_IMETHODIMP</span>
<a href="#l87.21"></a><span id="l87.21"> nsMsgDatabase::GetNewList(PRUint32 *aCount, PRUint32 **aNewKeys)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgCompSMIMEOverlay.js</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgCompSMIMEOverlay.js</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -42,42 +42,32 @@ const gSMimeCompFieldsContractID = &quot;@moz</span>
<a href="#l88.4"></a><span id="l88.4"> const gSMimeContractID = &quot;@mozilla.org/messenger-smime/smimejshelper;1&quot;;</span>
<a href="#l88.5"></a><span id="l88.5"> const gISMimeJSHelper = Components.interfaces.nsISMimeJSHelper;</span>
<a href="#l88.6"></a><span id="l88.6"> var gNextSecurityButtonCommand = &quot;&quot;;</span>
<a href="#l88.7"></a><span id="l88.7"> var gBundle;</span>
<a href="#l88.8"></a><span id="l88.8"> var gBrandBundle;</span>
<a href="#l88.9"></a><span id="l88.9"> var gSMFields;</span>
<a href="#l88.10"></a><span id="l88.10"> var gEncryptedURIService = null;</span>
<a href="#l88.11"></a><span id="l88.11"> </span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-</span>
<a href="#l88.13"></a><span id="l88.13"> function onComposerClose()</span>
<a href="#l88.14"></a><span id="l88.14"> {</span>
<a href="#l88.15"></a><span id="l88.15">   gSMFields = null;</span>
<a href="#l88.16"></a><span id="l88.16">   setNoEncryptionUI();</span>
<a href="#l88.17"></a><span id="l88.17">   setNoSignatureUI();</span>
<a href="#l88.18"></a><span id="l88.18"> </span>
<a href="#l88.19"></a><span id="l88.19" class="difflineminus">-  if (!gMsgCompose)</span>
<a href="#l88.20"></a><span id="l88.20" class="difflineminus">-    return;</span>
<a href="#l88.21"></a><span id="l88.21" class="difflineminus">-</span>
<a href="#l88.22"></a><span id="l88.22" class="difflineminus">-  if (!gMsgCompose.compFields)</span>
<a href="#l88.23"></a><span id="l88.23" class="difflineplus">+  if (!gMsgCompose || !gMsgCompose.compFields)</span>
<a href="#l88.24"></a><span id="l88.24">     return;</span>
<a href="#l88.25"></a><span id="l88.25"> </span>
<a href="#l88.26"></a><span id="l88.26">   gMsgCompose.compFields.securityInfo = null;</span>
<a href="#l88.27"></a><span id="l88.27"> }</span>
<a href="#l88.28"></a><span id="l88.28"> </span>
<a href="#l88.29"></a><span id="l88.29"> function onComposerReOpen()</span>
<a href="#l88.30"></a><span id="l88.30"> {</span>
<a href="#l88.31"></a><span id="l88.31" class="difflineminus">-  // are we already set up?</span>
<a href="#l88.32"></a><span id="l88.32" class="difflineminus">-  if (gSMFields)</span>
<a href="#l88.33"></a><span id="l88.33" class="difflineminus">-    return;</span>
<a href="#l88.34"></a><span id="l88.34" class="difflineminus">-</span>
<a href="#l88.35"></a><span id="l88.35" class="difflineminus">-  if (!gMsgCompose)</span>
<a href="#l88.36"></a><span id="l88.36" class="difflineminus">-    return;</span>
<a href="#l88.37"></a><span id="l88.37" class="difflineminus">-</span>
<a href="#l88.38"></a><span id="l88.38" class="difflineminus">-  if (!gMsgCompose.compFields)</span>
<a href="#l88.39"></a><span id="l88.39" class="difflineplus">+  // Are we already set up ? Or are the required fields missing ?</span>
<a href="#l88.40"></a><span id="l88.40" class="difflineplus">+  if (gSMFields || !gMsgCompose || !gMsgCompose.compFields)</span>
<a href="#l88.41"></a><span id="l88.41">     return;</span>
<a href="#l88.42"></a><span id="l88.42"> </span>
<a href="#l88.43"></a><span id="l88.43">   gMsgCompose.compFields.securityInfo = null;</span>
<a href="#l88.44"></a><span id="l88.44"> </span>
<a href="#l88.45"></a><span id="l88.45">   gSMFields = Components.classes[gSMimeCompFieldsContractID].createInstance(gISMimeCompFields);</span>
<a href="#l88.46"></a><span id="l88.46">   if (gSMFields)</span>
<a href="#l88.47"></a><span id="l88.47">   {</span>
<a href="#l88.48"></a><span id="l88.48">     gMsgCompose.compFields.securityInfo = gSMFields;</span>
<a href="#l88.49"></a><span id="l88.49" class="difflineat">@@ -93,67 +83,79 @@ function onComposerReOpen()</span>
<a href="#l88.50"></a><span id="l88.50">       if (gEncryptedURIService.isEncrypted(gMsgCompose.originalMsgURI))</span>
<a href="#l88.51"></a><span id="l88.51">       {</span>
<a href="#l88.52"></a><span id="l88.52">         // Override encryption setting if original is known as encrypted.</span>
<a href="#l88.53"></a><span id="l88.53">         gSMFields.requireEncryptMessage = true;</span>
<a href="#l88.54"></a><span id="l88.54">       }</span>
<a href="#l88.55"></a><span id="l88.55">     }</span>
<a href="#l88.56"></a><span id="l88.56"> </span>
<a href="#l88.57"></a><span id="l88.57">     if (gSMFields.requireEncryptMessage)</span>
<a href="#l88.58"></a><span id="l88.58" class="difflineminus">-    {</span>
<a href="#l88.59"></a><span id="l88.59">       setEncryptionUI();</span>
<a href="#l88.60"></a><span id="l88.60" class="difflineminus">-    }</span>
<a href="#l88.61"></a><span id="l88.61">     else</span>
<a href="#l88.62"></a><span id="l88.62" class="difflineminus">-    {</span>
<a href="#l88.63"></a><span id="l88.63">       setNoEncryptionUI();</span>
<a href="#l88.64"></a><span id="l88.64" class="difflineminus">-    }</span>
<a href="#l88.65"></a><span id="l88.65"> </span>
<a href="#l88.66"></a><span id="l88.66">     if (gSMFields.signMessage)</span>
<a href="#l88.67"></a><span id="l88.67" class="difflineminus">-    {</span>
<a href="#l88.68"></a><span id="l88.68">       setSignatureUI();</span>
<a href="#l88.69"></a><span id="l88.69" class="difflineminus">-    }</span>
<a href="#l88.70"></a><span id="l88.70">     else</span>
<a href="#l88.71"></a><span id="l88.71" class="difflineminus">-    {</span>
<a href="#l88.72"></a><span id="l88.72">       setNoSignatureUI();</span>
<a href="#l88.73"></a><span id="l88.73" class="difflineminus">-    }</span>
<a href="#l88.74"></a><span id="l88.74">   }</span>
<a href="#l88.75"></a><span id="l88.75"> }</span>
<a href="#l88.76"></a><span id="l88.76"> </span>
<a href="#l88.77"></a><span id="l88.77" class="difflineplus">+addEventListener(&quot;load&quot;, smimeComposeOnLoad, false);</span>
<a href="#l88.78"></a><span id="l88.78"> </span>
<a href="#l88.79"></a><span id="l88.79"> // this function gets called multiple times,</span>
<a href="#l88.80"></a><span id="l88.80"> // but only on first open, not on composer recycling</span>
<a href="#l88.81"></a><span id="l88.81"> function smimeComposeOnLoad()</span>
<a href="#l88.82"></a><span id="l88.82"> {</span>
<a href="#l88.83"></a><span id="l88.83" class="difflineplus">+  removeEventListener(&quot;load&quot;, smimeComposeOnLoad, false);</span>
<a href="#l88.84"></a><span id="l88.84" class="difflineplus">+</span>
<a href="#l88.85"></a><span id="l88.85">   if (!gEncryptedURIService)</span>
<a href="#l88.86"></a><span id="l88.86" class="difflineminus">-  {</span>
<a href="#l88.87"></a><span id="l88.87">     gEncryptedURIService = </span>
<a href="#l88.88"></a><span id="l88.88">       Components.classes[&quot;@mozilla.org/messenger-smime/smime-encrypted-uris-service;1&quot;]</span>
<a href="#l88.89"></a><span id="l88.89">       .getService(Components.interfaces.nsIEncryptedSMIMEURIsService);</span>
<a href="#l88.90"></a><span id="l88.90" class="difflineminus">-  }</span>
<a href="#l88.91"></a><span id="l88.91"> </span>
<a href="#l88.92"></a><span id="l88.92">   onComposerReOpen();</span>
<a href="#l88.93"></a><span id="l88.93" class="difflineplus">+</span>
<a href="#l88.94"></a><span id="l88.94" class="difflineplus">+  top.controllers.appendController(SecurityController);</span>
<a href="#l88.95"></a><span id="l88.95" class="difflineplus">+</span>
<a href="#l88.96"></a><span id="l88.96" class="difflineplus">+  addEventListener(&quot;compose-from-changed&quot;, onComposerFromChanged, true);</span>
<a href="#l88.97"></a><span id="l88.97" class="difflineplus">+  addEventListener(&quot;compose-send-message&quot;, onComposerSendMessage, true);</span>
<a href="#l88.98"></a><span id="l88.98" class="difflineplus">+  addEventListener(&quot;compose-window-close&quot;, onComposerClose, true);</span>
<a href="#l88.99"></a><span id="l88.99" class="difflineplus">+  addEventListener(&quot;compose-window-reopen&quot;, onComposerReOpen, true);</span>
<a href="#l88.100"></a><span id="l88.100" class="difflineplus">+</span>
<a href="#l88.101"></a><span id="l88.101" class="difflineplus">+  addEventListener(&quot;unload&quot;, smimeComposeOnUnload, false);</span>
<a href="#l88.102"></a><span id="l88.102" class="difflineplus">+}</span>
<a href="#l88.103"></a><span id="l88.103" class="difflineplus">+</span>
<a href="#l88.104"></a><span id="l88.104" class="difflineplus">+function smimeComposeOnUnload()</span>
<a href="#l88.105"></a><span id="l88.105" class="difflineplus">+{</span>
<a href="#l88.106"></a><span id="l88.106" class="difflineplus">+  removeEventListener(&quot;unload&quot;, smimeComposeOnUnload, false);</span>
<a href="#l88.107"></a><span id="l88.107" class="difflineplus">+</span>
<a href="#l88.108"></a><span id="l88.108" class="difflineplus">+  removeEventListener(&quot;compose-from-changed&quot;, onComposerFromChanged, true);</span>
<a href="#l88.109"></a><span id="l88.109" class="difflineplus">+  removeEventListener(&quot;compose-send-message&quot;, onComposerSendMessage, true);</span>
<a href="#l88.110"></a><span id="l88.110" class="difflineplus">+  removeEventListener(&quot;compose-window-close&quot;, onComposerClose, true);</span>
<a href="#l88.111"></a><span id="l88.111" class="difflineplus">+  removeEventListener(&quot;compose-window-reopen&quot;, onComposerReOpen, true);</span>
<a href="#l88.112"></a><span id="l88.112" class="difflineplus">+</span>
<a href="#l88.113"></a><span id="l88.113" class="difflineplus">+  top.controllers.removeController(SecurityController);</span>
<a href="#l88.114"></a><span id="l88.114"> }</span>
<a href="#l88.115"></a><span id="l88.115"> </span>
<a href="#l88.116"></a><span id="l88.116"> function setupBundles()</span>
<a href="#l88.117"></a><span id="l88.117"> {</span>
<a href="#l88.118"></a><span id="l88.118" class="difflineminus">-  if (gBundle &amp;&amp; gBrandBundle)</span>
<a href="#l88.119"></a><span id="l88.119" class="difflineplus">+  if (gBundle)</span>
<a href="#l88.120"></a><span id="l88.120">     return;</span>
<a href="#l88.121"></a><span id="l88.121" class="difflineminus">-  </span>
<a href="#l88.122"></a><span id="l88.122" class="difflineminus">-  if (!gBundle) {</span>
<a href="#l88.123"></a><span id="l88.123" class="difflineminus">-    gBundle = document.getElementById(&quot;bundle_comp_smime&quot;);</span>
<a href="#l88.124"></a><span id="l88.124" class="difflineminus">-    gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l88.125"></a><span id="l88.125" class="difflineminus">-  }</span>
<a href="#l88.126"></a><span id="l88.126" class="difflineplus">+</span>
<a href="#l88.127"></a><span id="l88.127" class="difflineplus">+  gBundle = document.getElementById(&quot;bundle_comp_smime&quot;);</span>
<a href="#l88.128"></a><span id="l88.128" class="difflineplus">+  gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l88.129"></a><span id="l88.129"> }</span>
<a href="#l88.130"></a><span id="l88.130"> </span>
<a href="#l88.131"></a><span id="l88.131"> function showNeedSetupInfo()</span>
<a href="#l88.132"></a><span id="l88.132"> {</span>
<a href="#l88.133"></a><span id="l88.133">   var ifps = Components.interfaces.nsIPromptService;</span>
<a href="#l88.134"></a><span id="l88.134"> </span>
<a href="#l88.135"></a><span id="l88.135" class="difflineminus">-  var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService();</span>
<a href="#l88.136"></a><span id="l88.136" class="difflineminus">-  promptService = promptService.QueryInterface(ifps);</span>
<a href="#l88.137"></a><span id="l88.137" class="difflineplus">+  let promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l88.138"></a><span id="l88.138" class="difflineplus">+                                .getService(ifps);</span>
<a href="#l88.139"></a><span id="l88.139">   setupBundles();</span>
<a href="#l88.140"></a><span id="l88.140"> </span>
<a href="#l88.141"></a><span id="l88.141">   if (promptService &amp;&amp; gBundle &amp;&amp; gBrandBundle) {</span>
<a href="#l88.142"></a><span id="l88.142">     var dummy = new Object;</span>
<a href="#l88.143"></a><span id="l88.143">     var buttonPressed =</span>
<a href="#l88.144"></a><span id="l88.144">     promptService.confirmEx(window,</span>
<a href="#l88.145"></a><span id="l88.145">       gBrandBundle.getString(&quot;brandShortName&quot;),</span>
<a href="#l88.146"></a><span id="l88.146">       gBundle.getString(&quot;NeedSetup&quot;), </span>
<a href="#l88.147"></a><span id="l88.147" class="difflineat">@@ -255,17 +257,16 @@ function doSecurityButton()</span>
<a href="#l88.148"></a><span id="l88.148">     </span>
<a href="#l88.149"></a><span id="l88.149">     case &quot;signMessage&quot;:</span>
<a href="#l88.150"></a><span id="l88.150">       signMessage();</span>
<a href="#l88.151"></a><span id="l88.151">       break;</span>
<a href="#l88.152"></a><span id="l88.152">     </span>
<a href="#l88.153"></a><span id="l88.153">     case &quot;show&quot;:</span>
<a href="#l88.154"></a><span id="l88.154">     default:</span>
<a href="#l88.155"></a><span id="l88.155">       showMessageComposeSecurityStatus();</span>
<a href="#l88.156"></a><span id="l88.156" class="difflineminus">-      break;</span>
<a href="#l88.157"></a><span id="l88.157">   }</span>
<a href="#l88.158"></a><span id="l88.158"> }</span>
<a href="#l88.159"></a><span id="l88.159"> </span>
<a href="#l88.160"></a><span id="l88.160"> function setNoSignatureUI()</span>
<a href="#l88.161"></a><span id="l88.161"> {</span>
<a href="#l88.162"></a><span id="l88.162">   top.document.getElementById(&quot;securityStatus&quot;).removeAttribute(&quot;signing&quot;);</span>
<a href="#l88.163"></a><span id="l88.163">   top.document.getElementById(&quot;signing-status&quot;).collapsed = true;</span>
<a href="#l88.164"></a><span id="l88.164"> }</span>
<a href="#l88.165"></a><span id="l88.165" class="difflineat">@@ -315,47 +316,43 @@ var SecurityController =</span>
<a href="#l88.166"></a><span id="l88.166">   {</span>
<a href="#l88.167"></a><span id="l88.167">     switch ( command )</span>
<a href="#l88.168"></a><span id="l88.168">     {</span>
<a href="#l88.169"></a><span id="l88.169">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l88.170"></a><span id="l88.170">         return true;</span>
<a href="#l88.171"></a><span id="l88.171">       </span>
<a href="#l88.172"></a><span id="l88.172">       default:</span>
<a href="#l88.173"></a><span id="l88.173">         return false;</span>
<a href="#l88.174"></a><span id="l88.174" class="difflineminus">-     }</span>
<a href="#l88.175"></a><span id="l88.175" class="difflineplus">+    }</span>
<a href="#l88.176"></a><span id="l88.176">   },</span>
<a href="#l88.177"></a><span id="l88.177"> </span>
<a href="#l88.178"></a><span id="l88.178">   isCommandEnabled: function(command)</span>
<a href="#l88.179"></a><span id="l88.179">   {</span>
<a href="#l88.180"></a><span id="l88.180">     switch ( command )</span>
<a href="#l88.181"></a><span id="l88.181">     {</span>
<a href="#l88.182"></a><span id="l88.182">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l88.183"></a><span id="l88.183" class="difflineminus">-      {</span>
<a href="#l88.184"></a><span id="l88.184">         return true;</span>
<a href="#l88.185"></a><span id="l88.185" class="difflineminus">-      }</span>
<a href="#l88.186"></a><span id="l88.186"> </span>
<a href="#l88.187"></a><span id="l88.187">       default:</span>
<a href="#l88.188"></a><span id="l88.188">         return false;</span>
<a href="#l88.189"></a><span id="l88.189">     }</span>
<a href="#l88.190"></a><span id="l88.190" class="difflineminus">-    return false;</span>
<a href="#l88.191"></a><span id="l88.191">   }</span>
<a href="#l88.192"></a><span id="l88.192"> };</span>
<a href="#l88.193"></a><span id="l88.193"> </span>
<a href="#l88.194"></a><span id="l88.194"> function onComposerSendMessage()</span>
<a href="#l88.195"></a><span id="l88.195"> {</span>
<a href="#l88.196"></a><span id="l88.196" class="difflineplus">+  let missingCount = new Object();</span>
<a href="#l88.197"></a><span id="l88.197" class="difflineplus">+  let emailAddresses = new Object();</span>
<a href="#l88.198"></a><span id="l88.198" class="difflineplus">+</span>
<a href="#l88.199"></a><span id="l88.199">   try {</span>
<a href="#l88.200"></a><span id="l88.200">     if (!gMsgCompose.compFields.securityInfo.requireEncryptMessage) {</span>
<a href="#l88.201"></a><span id="l88.201">       return;</span>
<a href="#l88.202"></a><span id="l88.202">     }</span>
<a href="#l88.203"></a><span id="l88.203"> </span>
<a href="#l88.204"></a><span id="l88.204">     var helper = Components.classes[gSMimeContractID].createInstance(gISMimeJSHelper);</span>
<a href="#l88.205"></a><span id="l88.205" class="difflineminus">-</span>
<a href="#l88.206"></a><span id="l88.206" class="difflineminus">-    var emailAddresses = new Object();</span>
<a href="#l88.207"></a><span id="l88.207" class="difflineminus">-    var missingCount = new Object();</span>
<a href="#l88.208"></a><span id="l88.208" class="difflineminus">-</span>
<a href="#l88.209"></a><span id="l88.209">     helper.getNoCertAddresses(</span>
<a href="#l88.210"></a><span id="l88.210">       gMsgCompose.compFields,</span>
<a href="#l88.211"></a><span id="l88.211">       missingCount,</span>
<a href="#l88.212"></a><span id="l88.212">       emailAddresses);</span>
<a href="#l88.213"></a><span id="l88.213">   }</span>
<a href="#l88.214"></a><span id="l88.214">   catch (e)</span>
<a href="#l88.215"></a><span id="l88.215">   {</span>
<a href="#l88.216"></a><span id="l88.216">     return;</span>
<a href="#l88.217"></a><span id="l88.217" class="difflineat">@@ -371,30 +368,27 @@ function onComposerSendMessage()</span>
<a href="#l88.218"></a><span id="l88.218">     // Does the current identity override the global preference?</span>
<a href="#l88.219"></a><span id="l88.219">     if (gCurrentIdentity.overrideGlobalPref)</span>
<a href="#l88.220"></a><span id="l88.220">       autocompleteDirectory = gCurrentIdentity.directoryServer;</span>
<a href="#l88.221"></a><span id="l88.221">     else</span>
<a href="#l88.222"></a><span id="l88.222">     {</span>
<a href="#l88.223"></a><span id="l88.223">       // Try the global one</span>
<a href="#l88.224"></a><span id="l88.224">       var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l88.225"></a><span id="l88.225">                             .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l88.226"></a><span id="l88.226" class="difflineminus">-</span>
<a href="#l88.227"></a><span id="l88.227">       if (prefs.getBoolPref(&quot;ldap_2.autoComplete.useDirectory&quot;))</span>
<a href="#l88.228"></a><span id="l88.228">         autocompleteDirectory =</span>
<a href="#l88.229"></a><span id="l88.229">           prefs.getCharPref(&quot;ldap_2.autoComplete.directoryServer&quot;);</span>
<a href="#l88.230"></a><span id="l88.230">     }</span>
<a href="#l88.231"></a><span id="l88.231"> </span>
<a href="#l88.232"></a><span id="l88.232">     if (autocompleteDirectory)</span>
<a href="#l88.233"></a><span id="l88.233" class="difflineminus">-    {</span>
<a href="#l88.234"></a><span id="l88.234">       window.openDialog('chrome://messenger-smime/content/certFetchingStatus.xul',</span>
<a href="#l88.235"></a><span id="l88.235">                         '',</span>
<a href="#l88.236"></a><span id="l88.236">                         'chrome,resizable=1,modal=1,dialog=1', </span>
<a href="#l88.237"></a><span id="l88.237">                         autocompleteDirectory,</span>
<a href="#l88.238"></a><span id="l88.238">                         emailAddresses.value);</span>
<a href="#l88.239"></a><span id="l88.239" class="difflineminus">-    }</span>
<a href="#l88.240"></a><span id="l88.240">   }</span>
<a href="#l88.241"></a><span id="l88.241"> }</span>
<a href="#l88.242"></a><span id="l88.242"> </span>
<a href="#l88.243"></a><span id="l88.243"> function onComposerFromChanged()</span>
<a href="#l88.244"></a><span id="l88.244"> {</span>
<a href="#l88.245"></a><span id="l88.245">   if (!gSMFields)</span>
<a href="#l88.246"></a><span id="l88.246">     return;</span>
<a href="#l88.247"></a><span id="l88.247"> </span>
<a href="#l88.248"></a><span id="l88.248" class="difflineat">@@ -422,14 +416,8 @@ function onComposerFromChanged()</span>
<a href="#l88.249"></a><span id="l88.249">     </span>
<a href="#l88.250"></a><span id="l88.250">     if (!signMessage)</span>
<a href="#l88.251"></a><span id="l88.251">     {</span>
<a href="#l88.252"></a><span id="l88.252">       gSMFields.signMessage = false;</span>
<a href="#l88.253"></a><span id="l88.253">       setNoSignatureUI();</span>
<a href="#l88.254"></a><span id="l88.254">     }</span>
<a href="#l88.255"></a><span id="l88.255">   }</span>
<a href="#l88.256"></a><span id="l88.256"> }</span>
<a href="#l88.257"></a><span id="l88.257" class="difflineminus">-</span>
<a href="#l88.258"></a><span id="l88.258" class="difflineminus">-top.controllers.appendController(SecurityController);</span>
<a href="#l88.259"></a><span id="l88.259" class="difflineminus">-addEventListener('compose-window-close', onComposerClose, true);</span>
<a href="#l88.260"></a><span id="l88.260" class="difflineminus">-addEventListener('compose-window-reopen', onComposerReOpen, true);</span>
<a href="#l88.261"></a><span id="l88.261" class="difflineminus">-addEventListener('compose-send-message', onComposerSendMessage, true);</span>
<a href="#l88.262"></a><span id="l88.262" class="difflineminus">-addEventListener('compose-from-changed', onComposerFromChanged, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgCompSMIMEOverlay.xul</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgCompSMIMEOverlay.xul</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -40,20 +40,17 @@</span>
<a href="#l89.4"></a><span id="l89.4"> </span>
<a href="#l89.5"></a><span id="l89.5"> </span>
<a href="#l89.6"></a><span id="l89.6"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/smime/msgCompSMIMEOverlay.css&quot; type=&quot;text/css&quot;?&gt; </span>
<a href="#l89.7"></a><span id="l89.7"> </span>
<a href="#l89.8"></a><span id="l89.8"> &lt;!DOCTYPE overlay SYSTEM &quot;chrome://messenger-smime/locale/msgCompSMIMEOverlay.dtd&quot;&gt;</span>
<a href="#l89.9"></a><span id="l89.9"> </span>
<a href="#l89.10"></a><span id="l89.10"> &lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l89.11"></a><span id="l89.11"> </span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger-smime/content/msgCompSMIMEOverlay.js&quot;/&gt;</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot;&gt;&lt;![CDATA[</span>
<a href="#l89.14"></a><span id="l89.14" class="difflineminus">-    window.addEventListener(&quot;load&quot;, smimeComposeOnLoad, true);</span>
<a href="#l89.15"></a><span id="l89.15" class="difflineminus">-  ]]&gt;&lt;/script&gt;</span>
<a href="#l89.16"></a><span id="l89.16" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger-smime/content/msgCompSMIMEOverlay.js&quot;/&gt;</span>
<a href="#l89.17"></a><span id="l89.17"> </span>
<a href="#l89.18"></a><span id="l89.18">   &lt;window id=&quot;msgcomposeWindow&quot;&gt;</span>
<a href="#l89.19"></a><span id="l89.19">     &lt;broadcaster id=&quot;securityStatus&quot; crypto=&quot;&quot; signing=&quot;&quot;/&gt;</span>
<a href="#l89.20"></a><span id="l89.20">     &lt;observes element=&quot;securityStatus&quot; attribute=&quot;crypto&quot; /&gt;</span>
<a href="#l89.21"></a><span id="l89.21">     &lt;observes element=&quot;securityStatus&quot; attribute=&quot;signing&quot; /&gt;</span>
<a href="#l89.22"></a><span id="l89.22">     &lt;stringbundle id=&quot;bundle_comp_smime&quot; src=&quot;chrome://messenger-smime/locale/msgCompSMIMEOverlay.properties&quot;/&gt;</span>
<a href="#l89.23"></a><span id="l89.23">     &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l89.24"></a><span id="l89.24">   &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -40,33 +40,47 @@ var gSignatureStatus = -1;</span>
<a href="#l90.4"></a><span id="l90.4"> var gSignerCert = null;</span>
<a href="#l90.5"></a><span id="l90.5"> var gEncryptionCert = null;</span>
<a href="#l90.6"></a><span id="l90.6"> var gBundle;</span>
<a href="#l90.7"></a><span id="l90.7"> var gBrandBundle;</span>
<a href="#l90.8"></a><span id="l90.8"> </span>
<a href="#l90.9"></a><span id="l90.9"> const nsPKIParamBlock    = &quot;@mozilla.org/security/pkiparamblock;1&quot;;</span>
<a href="#l90.10"></a><span id="l90.10"> const nsIPKIParamBlock    = Components.interfaces.nsIPKIParamBlock;</span>
<a href="#l90.11"></a><span id="l90.11"> </span>
<a href="#l90.12"></a><span id="l90.12" class="difflineplus">+addEventListener(&quot;load&quot;, smimeReadOnLoad, false);</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineplus">+</span>
<a href="#l90.14"></a><span id="l90.14" class="difflineplus">+function smimeReadOnLoad()</span>
<a href="#l90.15"></a><span id="l90.15" class="difflineplus">+{</span>
<a href="#l90.16"></a><span id="l90.16" class="difflineplus">+  removeEventListener(&quot;load&quot;, smimeReadOnLoad, false);</span>
<a href="#l90.17"></a><span id="l90.17" class="difflineplus">+</span>
<a href="#l90.18"></a><span id="l90.18" class="difflineplus">+  top.controllers.appendController(SecurityController);</span>
<a href="#l90.19"></a><span id="l90.19" class="difflineplus">+</span>
<a href="#l90.20"></a><span id="l90.20" class="difflineplus">+  addEventListener(&quot;unload&quot;, smimeReadOnUnload, false);</span>
<a href="#l90.21"></a><span id="l90.21" class="difflineplus">+}</span>
<a href="#l90.22"></a><span id="l90.22" class="difflineplus">+</span>
<a href="#l90.23"></a><span id="l90.23" class="difflineplus">+function smimeReadOnUnload()</span>
<a href="#l90.24"></a><span id="l90.24" class="difflineplus">+{</span>
<a href="#l90.25"></a><span id="l90.25" class="difflineplus">+  removeEventListener(&quot;unload&quot;, smimeReadOnUnload, false);</span>
<a href="#l90.26"></a><span id="l90.26" class="difflineplus">+</span>
<a href="#l90.27"></a><span id="l90.27" class="difflineplus">+  top.controllers.removeController(SecurityController);</span>
<a href="#l90.28"></a><span id="l90.28" class="difflineplus">+}</span>
<a href="#l90.29"></a><span id="l90.29" class="difflineplus">+</span>
<a href="#l90.30"></a><span id="l90.30"> function setupBundles()</span>
<a href="#l90.31"></a><span id="l90.31"> {</span>
<a href="#l90.32"></a><span id="l90.32" class="difflineminus">-  if (gBundle &amp;&amp; gBrandBundle)</span>
<a href="#l90.33"></a><span id="l90.33" class="difflineplus">+  if (gBundle)</span>
<a href="#l90.34"></a><span id="l90.34">     return;</span>
<a href="#l90.35"></a><span id="l90.35"> </span>
<a href="#l90.36"></a><span id="l90.36" class="difflineminus">-  if (!gBundle) {</span>
<a href="#l90.37"></a><span id="l90.37" class="difflineminus">-    gBundle = document.getElementById(&quot;bundle_read_smime&quot;);</span>
<a href="#l90.38"></a><span id="l90.38" class="difflineminus">-    gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l90.39"></a><span id="l90.39" class="difflineminus">-  }</span>
<a href="#l90.40"></a><span id="l90.40" class="difflineplus">+  gBundle = document.getElementById(&quot;bundle_read_smime&quot;);</span>
<a href="#l90.41"></a><span id="l90.41" class="difflineplus">+  gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l90.42"></a><span id="l90.42"> }</span>
<a href="#l90.43"></a><span id="l90.43"> </span>
<a href="#l90.44"></a><span id="l90.44"> function showImapSignatureUnknown()</span>
<a href="#l90.45"></a><span id="l90.45"> {</span>
<a href="#l90.46"></a><span id="l90.46" class="difflineminus">-  var ifps = Components.interfaces.nsIPromptService;</span>
<a href="#l90.47"></a><span id="l90.47" class="difflineminus">-</span>
<a href="#l90.48"></a><span id="l90.48" class="difflineminus">-  var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService();</span>
<a href="#l90.49"></a><span id="l90.49" class="difflineminus">-  promptService = promptService.QueryInterface(ifps);</span>
<a href="#l90.50"></a><span id="l90.50" class="difflineplus">+  let promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l90.51"></a><span id="l90.51" class="difflineplus">+                                .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l90.52"></a><span id="l90.52">   setupBundles();</span>
<a href="#l90.53"></a><span id="l90.53"> </span>
<a href="#l90.54"></a><span id="l90.54">   if (promptService &amp;&amp; gBundle &amp;&amp; gBrandBundle) {</span>
<a href="#l90.55"></a><span id="l90.55">     if (promptService.confirm(window,</span>
<a href="#l90.56"></a><span id="l90.56">           gBrandBundle.getString(&quot;brandShortName&quot;),</span>
<a href="#l90.57"></a><span id="l90.57">           gBundle.getString(&quot;ImapOnDemand&quot;))) {</span>
<a href="#l90.58"></a><span id="l90.58">       gDBView.reloadMessageWithAllParts();</span>
<a href="#l90.59"></a><span id="l90.59">     }</span>
<a href="#l90.60"></a><span id="l90.60" class="difflineat">@@ -105,43 +119,38 @@ var SecurityController =</span>
<a href="#l90.61"></a><span id="l90.61">   {</span>
<a href="#l90.62"></a><span id="l90.62">     switch ( command )</span>
<a href="#l90.63"></a><span id="l90.63">     {</span>
<a href="#l90.64"></a><span id="l90.64">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l90.65"></a><span id="l90.65">         return true;</span>
<a href="#l90.66"></a><span id="l90.66"> </span>
<a href="#l90.67"></a><span id="l90.67">       default:</span>
<a href="#l90.68"></a><span id="l90.68">         return false;</span>
<a href="#l90.69"></a><span id="l90.69" class="difflineminus">-     }</span>
<a href="#l90.70"></a><span id="l90.70" class="difflineplus">+    }</span>
<a href="#l90.71"></a><span id="l90.71">   },</span>
<a href="#l90.72"></a><span id="l90.72"> </span>
<a href="#l90.73"></a><span id="l90.73">   isCommandEnabled: function(command)</span>
<a href="#l90.74"></a><span id="l90.74">   {</span>
<a href="#l90.75"></a><span id="l90.75">     switch ( command )</span>
<a href="#l90.76"></a><span id="l90.76">     {</span>
<a href="#l90.77"></a><span id="l90.77">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l90.78"></a><span id="l90.78" class="difflineminus">-      {</span>
<a href="#l90.79"></a><span id="l90.79">         if (document.documentElement.getAttribute('windowtype') == &quot;mail:messageWindow&quot;)</span>
<a href="#l90.80"></a><span id="l90.80">         {</span>
<a href="#l90.81"></a><span id="l90.81">           return (GetNumSelectedMessages() &gt; 0);</span>
<a href="#l90.82"></a><span id="l90.82">         }</span>
<a href="#l90.83"></a><span id="l90.83">         else</span>
<a href="#l90.84"></a><span id="l90.84">         {</span>
<a href="#l90.85"></a><span id="l90.85">           if (GetNumSelectedMessages() &gt; 0 &amp;&amp; gDBView)</span>
<a href="#l90.86"></a><span id="l90.86">           {</span>
<a href="#l90.87"></a><span id="l90.87">             var enabled = new Object();</span>
<a href="#l90.88"></a><span id="l90.88">             enabled.value = false;</span>
<a href="#l90.89"></a><span id="l90.89">             var checkStatus = new Object();</span>
<a href="#l90.90"></a><span id="l90.90">             gDBView.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody, enabled, checkStatus);</span>
<a href="#l90.91"></a><span id="l90.91">             return enabled.value;</span>
<a href="#l90.92"></a><span id="l90.92">           }</span>
<a href="#l90.93"></a><span id="l90.93">         }</span>
<a href="#l90.94"></a><span id="l90.94" class="difflineminus">-        return false;</span>
<a href="#l90.95"></a><span id="l90.95" class="difflineminus">-      }</span>
<a href="#l90.96"></a><span id="l90.96" class="difflineplus">+        // else: fall through.</span>
<a href="#l90.97"></a><span id="l90.97"> </span>
<a href="#l90.98"></a><span id="l90.98">       default:</span>
<a href="#l90.99"></a><span id="l90.99">         return false;</span>
<a href="#l90.100"></a><span id="l90.100">     }</span>
<a href="#l90.101"></a><span id="l90.101" class="difflineminus">-    return false;</span>
<a href="#l90.102"></a><span id="l90.102">   }</span>
<a href="#l90.103"></a><span id="l90.103"> };</span>
<a href="#l90.104"></a><span id="l90.104" class="difflineminus">-</span>
<a href="#l90.105"></a><span id="l90.105" class="difflineminus">-top.controllers.appendController(SecurityController);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -2141,32 +2141,29 @@ NS_IMETHODIMP nsImapIncomingServer::Forg</span>
<a href="#l91.4"></a><span id="l91.4"> </span>
<a href="#l91.5"></a><span id="l91.5"> </span>
<a href="#l91.6"></a><span id="l91.6"> NS_IMETHODIMP nsImapIncomingServer::PromptForPassword(nsACString&amp; aPassword,</span>
<a href="#l91.7"></a><span id="l91.7">                                                       nsIMsgWindow * aMsgWindow)</span>
<a href="#l91.8"></a><span id="l91.8"> {</span>
<a href="#l91.9"></a><span id="l91.9">   nsString passwordTitle;</span>
<a href="#l91.10"></a><span id="l91.10">   IMAPGetStringByID(IMAP_ENTER_PASSWORD_PROMPT_TITLE, getter_Copies(passwordTitle));</span>
<a href="#l91.11"></a><span id="l91.11">   nsCString promptValue;</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  PRBool okayValue;</span>
<a href="#l91.13"></a><span id="l91.13">   GetRealUsername(promptValue);</span>
<a href="#l91.14"></a><span id="l91.14"> </span>
<a href="#l91.15"></a><span id="l91.15">   nsCString hostName;</span>
<a href="#l91.16"></a><span id="l91.16">   GetRealHostName(hostName);</span>
<a href="#l91.17"></a><span id="l91.17">   promptValue.Append('@');</span>
<a href="#l91.18"></a><span id="l91.18">   promptValue.Append(hostName);</span>
<a href="#l91.19"></a><span id="l91.19"> </span>
<a href="#l91.20"></a><span id="l91.20">   nsString passwordText;</span>
<a href="#l91.21"></a><span id="l91.21">   nsresult rv = GetFormattedStringFromID(NS_ConvertASCIItoUTF16(promptValue),</span>
<a href="#l91.22"></a><span id="l91.22">                                          IMAP_ENTER_PASSWORD_PROMPT,</span>
<a href="#l91.23"></a><span id="l91.23">                                          passwordText);</span>
<a href="#l91.24"></a><span id="l91.24">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l91.25"></a><span id="l91.25" class="difflineminus">-  rv =  GetPasswordWithUI(passwordText, passwordTitle, aMsgWindow,</span>
<a href="#l91.26"></a><span id="l91.26" class="difflineminus">-                          &amp;okayValue, aPassword);</span>
<a href="#l91.27"></a><span id="l91.27" class="difflineminus">-  return (okayValue) ? rv : NS_MSG_PASSWORD_PROMPT_CANCELLED;</span>
<a href="#l91.28"></a><span id="l91.28" class="difflineplus">+  return GetPasswordWithUI(passwordText, passwordTitle, aMsgWindow, aPassword);</span>
<a href="#l91.29"></a><span id="l91.29"> }</span>
<a href="#l91.30"></a><span id="l91.30"> </span>
<a href="#l91.31"></a><span id="l91.31"> // for the nsIImapServerSink interface</span>
<a href="#l91.32"></a><span id="l91.32"> NS_IMETHODIMP  nsImapIncomingServer::SetCapability(PRUint32 capability)</span>
<a href="#l91.33"></a><span id="l91.33"> {</span>
<a href="#l91.34"></a><span id="l91.34">   m_capability = capability;</span>
<a href="#l91.35"></a><span id="l91.35">   SetCapabilityPref(capability);</span>
<a href="#l91.36"></a><span id="l91.36">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -1758,17 +1758,17 @@ NS_IMETHODIMP nsImapMailFolder::RenameLo</span>
<a href="#l92.4"></a><span id="l92.4">       return dirFile-&gt;MoveToNative(nsnull, newNameStr);      // in case of rename operation leaf names will differ</span>
<a href="#l92.5"></a><span id="l92.5"> </span>
<a href="#l92.6"></a><span id="l92.6">     parentPathFile-&gt;AppendNative(newNameStr);    //only for move we need to progress further in case the parent differs</span>
<a href="#l92.7"></a><span id="l92.7">     PRBool isDirectory = PR_FALSE;</span>
<a href="#l92.8"></a><span id="l92.8">     parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l92.9"></a><span id="l92.9">     if (!isDirectory)</span>
<a href="#l92.10"></a><span id="l92.10">       parentPathFile-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l92.11"></a><span id="l92.11">     else</span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-      NS_ASSERTION(0,&quot;Directory already exists.&quot;);</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineplus">+      NS_ERROR(&quot;Directory already exists.&quot;);</span>
<a href="#l92.14"></a><span id="l92.14">     rv = RecursiveCopy(dirFile, parentPathFile);</span>
<a href="#l92.15"></a><span id="l92.15">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l92.16"></a><span id="l92.16">     dirFile-&gt;Remove(PR_TRUE);                         // moving folders</span>
<a href="#l92.17"></a><span id="l92.17">   }</span>
<a href="#l92.18"></a><span id="l92.18">   return rv;</span>
<a href="#l92.19"></a><span id="l92.19"> }</span>
<a href="#l92.20"></a><span id="l92.20"> </span>
<a href="#l92.21"></a><span id="l92.21"> NS_IMETHODIMP nsImapMailFolder::GetPrettyName(nsAString&amp; prettyName)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -6968,19 +6968,25 @@ void nsImapProtocol::DiscoverMailboxList</span>
<a href="#l93.4"></a><span id="l93.4">   PRBool usingSubscription = PR_FALSE;</span>
<a href="#l93.5"></a><span id="l93.5"> </span>
<a href="#l93.6"></a><span id="l93.6">   m_hostSessionList-&gt;GetHostIsUsingSubscription(GetImapServerKey(), usingSubscription);</span>
<a href="#l93.7"></a><span id="l93.7">   // should we check a pref here, to be able to turn off XList?</span>
<a href="#l93.8"></a><span id="l93.8">   PRBool hasXLIST = GetServerStateParser().GetCapabilityFlag() &amp; kHasXListCapability;</span>
<a href="#l93.9"></a><span id="l93.9">   if (hasXLIST &amp;&amp; usingSubscription)</span>
<a href="#l93.10"></a><span id="l93.10">   {</span>
<a href="#l93.11"></a><span id="l93.11">     m_hierarchyNameState = kXListing;</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-    // We use &quot;%.%&quot; since gmail special folders are unlikely</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+    nsCAutoString pattern(&quot;%&quot;);</span>
<a href="#l93.14"></a><span id="l93.14" class="difflineplus">+    List(&quot;%&quot;, PR_TRUE, PR_TRUE);</span>
<a href="#l93.15"></a><span id="l93.15" class="difflineplus">+    // We list the first and second levels since special folders are unlikely</span>
<a href="#l93.16"></a><span id="l93.16">     // to be more than 2 levels deep.</span>
<a href="#l93.17"></a><span id="l93.17" class="difflineminus">-    List(&quot;%.%&quot;, PR_TRUE, PR_TRUE);</span>
<a href="#l93.18"></a><span id="l93.18" class="difflineplus">+    char separator = 0;</span>
<a href="#l93.19"></a><span id="l93.19" class="difflineplus">+    m_runningUrl-&gt;GetOnlineSubDirSeparator(&amp;separator);</span>
<a href="#l93.20"></a><span id="l93.20" class="difflineplus">+    pattern.Append(separator);</span>
<a href="#l93.21"></a><span id="l93.21" class="difflineplus">+    pattern += '%';</span>
<a href="#l93.22"></a><span id="l93.22" class="difflineplus">+    List(pattern.get(), PR_TRUE, PR_TRUE);</span>
<a href="#l93.23"></a><span id="l93.23">   }</span>
<a href="#l93.24"></a><span id="l93.24"> </span>
<a href="#l93.25"></a><span id="l93.25">   SetMailboxDiscoveryStatus(eContinue);</span>
<a href="#l93.26"></a><span id="l93.26">   if (GetServerStateParser().ServerHasACLCapability())</span>
<a href="#l93.27"></a><span id="l93.27">     m_hierarchyNameState = kListingForInfoAndDiscovery;</span>
<a href="#l93.28"></a><span id="l93.28">   else</span>
<a href="#l93.29"></a><span id="l93.29">     m_hierarchyNameState = kNoOperationInProgress;</span>
<a href="#l93.30"></a><span id="l93.30"> </span>
<a href="#l93.31"></a><span id="l93.31" class="difflineat">@@ -7927,18 +7933,20 @@ nsresult nsImapProtocol::GetPassword(nsC</span>
<a href="#l93.32"></a><span id="l93.32">   {</span>
<a href="#l93.33"></a><span id="l93.33">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l93.34"></a><span id="l93.34"> </span>
<a href="#l93.35"></a><span id="l93.35">     GetMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l93.36"></a><span id="l93.36">     // need to copy password, because in the case of Cancel,</span>
<a href="#l93.37"></a><span id="l93.37">     // GetPasswordWithUI will truncate the password.</span>
<a href="#l93.38"></a><span id="l93.38">     nsCString pwd = m_lastPasswordSent;</span>
<a href="#l93.39"></a><span id="l93.39">     nsresult rv = m_imapServerSink-&gt;PromptForPassword(pwd, msgWindow);</span>
<a href="#l93.40"></a><span id="l93.40" class="difflineminus">-    if (rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l93.41"></a><span id="l93.41" class="difflineplus">+</span>
<a href="#l93.42"></a><span id="l93.42" class="difflineplus">+    if (NS_FAILED(rv) || rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l93.43"></a><span id="l93.43">       return NS_ERROR_ABORT;</span>
<a href="#l93.44"></a><span id="l93.44" class="difflineplus">+</span>
<a href="#l93.45"></a><span id="l93.45">     password.Assign(pwd);</span>
<a href="#l93.46"></a><span id="l93.46">   }</span>
<a href="#l93.47"></a><span id="l93.47">   m_lastPasswordSent = password;</span>
<a href="#l93.48"></a><span id="l93.48">   return NS_OK;</span>
<a href="#l93.49"></a><span id="l93.49"> }</span>
<a href="#l93.50"></a><span id="l93.50"> </span>
<a href="#l93.51"></a><span id="l93.51"> PRBool nsImapProtocol::TryToLogon()</span>
<a href="#l93.52"></a><span id="l93.52"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -693,17 +693,17 @@ nsresult nsImapService::FetchMimePart(ns</span>
<a href="#l94.4"></a><span id="l94.4">         rv = aChannel-&gt;AsyncOpen(aStreamListener, aCtxt);</span>
<a href="#l94.5"></a><span id="l94.5">       }</span>
<a href="#l94.6"></a><span id="l94.6">       else // do what we used to do before</span>
<a href="#l94.7"></a><span id="l94.7">       {</span>
<a href="#l94.8"></a><span id="l94.8">         // I'd like to get rid of this code as I believe that we always get a docshell</span>
<a href="#l94.9"></a><span id="l94.9">         // or stream listener passed into us in this method but i'm not sure yet...</span>
<a href="#l94.10"></a><span id="l94.10">         // I'm going to use an assert for now to figure out if this is ever getting called</span>
<a href="#l94.11"></a><span id="l94.11"> #if defined(DEBUG_mscott) || defined(DEBUG_bienvenu)</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-        NS_ASSERTION(0, &quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+        NS_ERROR(&quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l94.14"></a><span id="l94.14"> #endif</span>
<a href="#l94.15"></a><span id="l94.15">         rv = GetImapConnectionAndLoadUrl(NS_GetCurrentThread(), aImapUrl,</span>
<a href="#l94.16"></a><span id="l94.16">                                          aDisplayConsumer, aURL);</span>
<a href="#l94.17"></a><span id="l94.17">       }</span>
<a href="#l94.18"></a><span id="l94.18">     }</span>
<a href="#l94.19"></a><span id="l94.19">   }</span>
<a href="#l94.20"></a><span id="l94.20">   return rv;</span>
<a href="#l94.21"></a><span id="l94.21"> }</span>
<a href="#l94.22"></a><span id="l94.22" class="difflineat">@@ -1132,17 +1132,17 @@ nsresult nsImapService::GetMessageFromUr</span>
<a href="#l94.23"></a><span id="l94.23">       rv = channel-&gt;AsyncOpen(streamListener, aCtxt);</span>
<a href="#l94.24"></a><span id="l94.24">     }</span>
<a href="#l94.25"></a><span id="l94.25">     else // do what we used to do before</span>
<a href="#l94.26"></a><span id="l94.26">     {</span>
<a href="#l94.27"></a><span id="l94.27">       // I'd like to get rid of this code as I believe that we always get a docshell</span>
<a href="#l94.28"></a><span id="l94.28">       // or stream listener passed into us in this method but i'm not sure yet...</span>
<a href="#l94.29"></a><span id="l94.29">       // I'm going to use an assert for now to figure out if this is ever getting called</span>
<a href="#l94.30"></a><span id="l94.30"> #if defined(DEBUG_mscott) || defined(DEBUG_bienvenu)</span>
<a href="#l94.31"></a><span id="l94.31" class="difflineminus">-      NS_ASSERTION(0, &quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l94.32"></a><span id="l94.32" class="difflineplus">+      NS_ERROR(&quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l94.33"></a><span id="l94.33"> #endif</span>
<a href="#l94.34"></a><span id="l94.34">       rv = GetImapConnectionAndLoadUrl(NS_GetCurrentThread(), aImapUrl,</span>
<a href="#l94.35"></a><span id="l94.35">                                        aDisplayConsumer, aURL);</span>
<a href="#l94.36"></a><span id="l94.36">     }</span>
<a href="#l94.37"></a><span id="l94.37">   }</span>
<a href="#l94.38"></a><span id="l94.38">   return rv;</span>
<a href="#l94.39"></a><span id="l94.39"> }</span>
<a href="#l94.40"></a><span id="l94.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -1653,17 +1653,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l95.4"></a><span id="l95.4">                                    nsIMsgCopyServiceListener* listener,</span>
<a href="#l95.5"></a><span id="l95.5">                                    PRBool isFolder, PRBool allowUndo)</span>
<a href="#l95.6"></a><span id="l95.6"> {</span>
<a href="#l95.7"></a><span id="l95.7">   nsCOMPtr&lt;nsISupports&gt; srcSupport = do_QueryInterface(srcFolder);</span>
<a href="#l95.8"></a><span id="l95.8">   PRBool isServer;</span>
<a href="#l95.9"></a><span id="l95.9">   nsresult rv = GetIsServer(&amp;isServer);</span>
<a href="#l95.10"></a><span id="l95.10">   if (NS_SUCCEEDED(rv) &amp;&amp; isServer)</span>
<a href="#l95.11"></a><span id="l95.11">   {</span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-    NS_ASSERTION(0, &quot;Destination is the root folder. Cannot move/copy here&quot;);</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+    NS_ERROR(&quot;Destination is the root folder. Cannot move/copy here&quot;);</span>
<a href="#l95.14"></a><span id="l95.14">     if (isMove)</span>
<a href="#l95.15"></a><span id="l95.15">       srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l95.16"></a><span id="l95.16">     return OnCopyCompleted(srcSupport, PR_FALSE);</span>
<a href="#l95.17"></a><span id="l95.17">   }</span>
<a href="#l95.18"></a><span id="l95.18"> </span>
<a href="#l95.19"></a><span id="l95.19">   if (!(mFlags &amp; (nsMsgFolderFlags::Trash|nsMsgFolderFlags::Junk)))</span>
<a href="#l95.20"></a><span id="l95.20">     SetMRUTime();</span>
<a href="#l95.21"></a><span id="l95.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -658,17 +658,17 @@ void nsPop3Protocol::UpdateProgressPerce</span>
<a href="#l96.4"></a><span id="l96.4"> // do not pass in an escaped string</span>
<a href="#l96.5"></a><span id="l96.5"> void nsPop3Protocol::SetUsername(const char* name)</span>
<a href="#l96.6"></a><span id="l96.6"> {</span>
<a href="#l96.7"></a><span id="l96.7">   NS_ASSERTION(name, &quot;no name specified!&quot;);</span>
<a href="#l96.8"></a><span id="l96.8">     if (name)</span>
<a href="#l96.9"></a><span id="l96.9">       m_username = name;</span>
<a href="#l96.10"></a><span id="l96.10"> }</span>
<a href="#l96.11"></a><span id="l96.11"> </span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-nsresult nsPop3Protocol::GetPassword(nsCString&amp; aPassword, PRBool *okayValue)</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+nsresult nsPop3Protocol::GetPassword(nsCString&amp; aPassword)</span>
<a href="#l96.14"></a><span id="l96.14"> {</span>
<a href="#l96.15"></a><span id="l96.15">   nsresult rv = NS_OK;</span>
<a href="#l96.16"></a><span id="l96.16">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l96.17"></a><span id="l96.17"> </span>
<a href="#l96.18"></a><span id="l96.18">   if (server)</span>
<a href="#l96.19"></a><span id="l96.19">   {</span>
<a href="#l96.20"></a><span id="l96.20">     PRBool isAuthenticated;</span>
<a href="#l96.21"></a><span id="l96.21">     m_nsIPop3Sink-&gt;GetUserAuthenticated(&amp;isAuthenticated);</span>
<a href="#l96.22"></a><span id="l96.22" class="difflineat">@@ -758,17 +758,17 @@ nsresult nsPop3Protocol::GetPassword(nsC</span>
<a href="#l96.23"></a><span id="l96.23">     nsString passwordTitle;</span>
<a href="#l96.24"></a><span id="l96.24">     mLocalBundle-&gt;GetStringFromName(</span>
<a href="#l96.25"></a><span id="l96.25">       NS_LITERAL_STRING(&quot;pop3EnterPasswordPromptTitle&quot;).get(),</span>
<a href="#l96.26"></a><span id="l96.26">       getter_Copies(passwordTitle));</span>
<a href="#l96.27"></a><span id="l96.27"> </span>
<a href="#l96.28"></a><span id="l96.28">     // Now go and get the password.</span>
<a href="#l96.29"></a><span id="l96.29">     if (!passwordPrompt.IsEmpty() &amp;&amp; !passwordTitle.IsEmpty())</span>
<a href="#l96.30"></a><span id="l96.30">       rv = server-&gt;GetPasswordWithUI(passwordPrompt, passwordTitle,</span>
<a href="#l96.31"></a><span id="l96.31" class="difflineminus">-                                     msgWindow, okayValue, aPassword);</span>
<a href="#l96.32"></a><span id="l96.32" class="difflineplus">+                                     msgWindow, aPassword);</span>
<a href="#l96.33"></a><span id="l96.33">     ClearFlag(POP3_PASSWORD_FAILED|POP3_AUTH_FAILURE);</span>
<a href="#l96.34"></a><span id="l96.34"> </span>
<a href="#l96.35"></a><span id="l96.35">     // If it failed, then user pressed the cancel button (or some other</span>
<a href="#l96.36"></a><span id="l96.36">     // failure).</span>
<a href="#l96.37"></a><span id="l96.37">     if (NS_FAILED(rv))</span>
<a href="#l96.38"></a><span id="l96.38">       m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l96.39"></a><span id="l96.39">   }</span>
<a href="#l96.40"></a><span id="l96.40">   else</span>
<a href="#l96.41"></a><span id="l96.41" class="difflineat">@@ -1755,19 +1755,18 @@ PRInt32 nsPop3Protocol::AuthGSSAPIRespon</span>
<a href="#l96.42"></a><span id="l96.42"> }</span>
<a href="#l96.43"></a><span id="l96.43"> </span>
<a href="#l96.44"></a><span id="l96.44"> PRInt32 nsPop3Protocol::SendUsername()</span>
<a href="#l96.45"></a><span id="l96.45"> {</span>
<a href="#l96.46"></a><span id="l96.46">     if(m_username.IsEmpty())</span>
<a href="#l96.47"></a><span id="l96.47">       return(Error(POP3_USERNAME_UNDEFINED));</span>
<a href="#l96.48"></a><span id="l96.48"> </span>
<a href="#l96.49"></a><span id="l96.49">     nsCString password;</span>
<a href="#l96.50"></a><span id="l96.50" class="difflineminus">-    PRBool okayValue = PR_TRUE;</span>
<a href="#l96.51"></a><span id="l96.51" class="difflineminus">-    nsresult rv = GetPassword(password, &amp;okayValue);</span>
<a href="#l96.52"></a><span id="l96.52" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; !okayValue)</span>
<a href="#l96.53"></a><span id="l96.53" class="difflineplus">+    nsresult rv = GetPassword(password);</span>
<a href="#l96.54"></a><span id="l96.54" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l96.55"></a><span id="l96.55">     {</span>
<a href="#l96.56"></a><span id="l96.56">       // user has canceled the password prompt</span>
<a href="#l96.57"></a><span id="l96.57">       m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l96.58"></a><span id="l96.58">       return NS_ERROR_ABORT;</span>
<a href="#l96.59"></a><span id="l96.59">     }</span>
<a href="#l96.60"></a><span id="l96.60">     else if (NS_FAILED(rv) || password.IsEmpty())</span>
<a href="#l96.61"></a><span id="l96.61">       return Error(POP3_PASSWORD_UNDEFINED);</span>
<a href="#l96.62"></a><span id="l96.62"> </span>
<a href="#l96.63"></a><span id="l96.63" class="difflineat">@@ -1806,19 +1805,18 @@ PRInt32 nsPop3Protocol::SendUsername()</span>
<a href="#l96.64"></a><span id="l96.64"> }</span>
<a href="#l96.65"></a><span id="l96.65"> </span>
<a href="#l96.66"></a><span id="l96.66"> PRInt32 nsPop3Protocol::SendPassword()</span>
<a href="#l96.67"></a><span id="l96.67"> {</span>
<a href="#l96.68"></a><span id="l96.68">     if (m_username.IsEmpty())</span>
<a href="#l96.69"></a><span id="l96.69">         return(Error(POP3_USERNAME_UNDEFINED));</span>
<a href="#l96.70"></a><span id="l96.70"> </span>
<a href="#l96.71"></a><span id="l96.71">     nsCString password;</span>
<a href="#l96.72"></a><span id="l96.72" class="difflineminus">-    PRBool okayValue = PR_TRUE;</span>
<a href="#l96.73"></a><span id="l96.73" class="difflineminus">-    nsresult rv = GetPassword(password, &amp;okayValue);</span>
<a href="#l96.74"></a><span id="l96.74" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; !okayValue)</span>
<a href="#l96.75"></a><span id="l96.75" class="difflineplus">+    nsresult rv = GetPassword(password);</span>
<a href="#l96.76"></a><span id="l96.76" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l96.77"></a><span id="l96.77">     {</span>
<a href="#l96.78"></a><span id="l96.78">         // user has canceled the password prompt</span>
<a href="#l96.79"></a><span id="l96.79">         m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l96.80"></a><span id="l96.80">         return NS_ERROR_ABORT;</span>
<a href="#l96.81"></a><span id="l96.81">     }</span>
<a href="#l96.82"></a><span id="l96.82">     else if (NS_FAILED(rv) || password.IsEmpty())</span>
<a href="#l96.83"></a><span id="l96.83">     {</span>
<a href="#l96.84"></a><span id="l96.84">       return Error(POP3_PASSWORD_UNDEFINED);</span>
<a href="#l96.85"></a><span id="l96.85" class="difflineat">@@ -3438,18 +3436,17 @@ nsresult nsPop3Protocol::ProcessProtocol</span>
<a href="#l96.86"></a><span id="l96.86">     a connection to the pop server open; this saves us from</span>
<a href="#l96.87"></a><span id="l96.87">     having to worry about the server timing out on us while</span>
<a href="#l96.88"></a><span id="l96.88">       we wait for user input. */</span>
<a href="#l96.89"></a><span id="l96.89">       {</span>
<a href="#l96.90"></a><span id="l96.90">       /* If we're just checking for new mail (biff) then don't</span>
<a href="#l96.91"></a><span id="l96.91">       prompt the user for a password; just tell him we don't</span>
<a href="#l96.92"></a><span id="l96.92">         know whether he has new mail. */</span>
<a href="#l96.93"></a><span id="l96.93">         nsCString password;</span>
<a href="#l96.94"></a><span id="l96.94" class="difflineminus">-        PRBool okayValue;</span>
<a href="#l96.95"></a><span id="l96.95" class="difflineminus">-        GetPassword(password, &amp;okayValue);</span>
<a href="#l96.96"></a><span id="l96.96" class="difflineplus">+        GetPassword(password);</span>
<a href="#l96.97"></a><span id="l96.97">         const char * pwd = password.get();</span>
<a href="#l96.98"></a><span id="l96.98">         if (password.IsEmpty() || m_username.IsEmpty())</span>
<a href="#l96.99"></a><span id="l96.99">         {</span>
<a href="#l96.100"></a><span id="l96.100">           status = MK_POP3_PASSWORD_UNDEFINED;</span>
<a href="#l96.101"></a><span id="l96.101">           m_pop3ConData-&gt;biffstate = nsIMsgFolder::nsMsgBiffState_Unknown;</span>
<a href="#l96.102"></a><span id="l96.102">           m_nsIPop3Sink-&gt;SetBiffStateAndUpdateFE(m_pop3ConData-&gt;biffstate, 0, PR_FALSE);</span>
<a href="#l96.103"></a><span id="l96.103"> </span>
<a href="#l96.104"></a><span id="l96.104">           /* update old style biff */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -276,17 +276,17 @@ public:</span>
<a href="#l97.4"></a><span id="l97.4">   NS_DECL_NSIPOP3PROTOCOL</span>
<a href="#l97.5"></a><span id="l97.5"> </span>
<a href="#l97.6"></a><span id="l97.6">   nsresult Initialize(nsIURI * aURL);</span>
<a href="#l97.7"></a><span id="l97.7">   virtual nsresult LoadUrl(nsIURI *aURL, nsISupports * aConsumer = nsnull);</span>
<a href="#l97.8"></a><span id="l97.8"> </span>
<a href="#l97.9"></a><span id="l97.9">   const char* GetUsername() { return m_username.get(); }</span>
<a href="#l97.10"></a><span id="l97.10">   void SetUsername(const char* name);</span>
<a href="#l97.11"></a><span id="l97.11"> </span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-  nsresult GetPassword(nsCString&amp; aPassword, PRBool *okayValue);</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineplus">+  nsresult GetPassword(nsCString&amp; aPassword);</span>
<a href="#l97.14"></a><span id="l97.14"> </span>
<a href="#l97.15"></a><span id="l97.15">   NS_IMETHOD OnTransportStatus(nsITransport *transport, nsresult status, PRUint64 progress, PRUint64 progressMax);</span>
<a href="#l97.16"></a><span id="l97.16">   NS_IMETHOD OnStopRequest(nsIRequest *request, nsISupports * aContext, nsresult aStatus);</span>
<a href="#l97.17"></a><span id="l97.17">   NS_IMETHOD Cancel(nsresult status);</span>
<a href="#l97.18"></a><span id="l97.18"> </span>
<a href="#l97.19"></a><span id="l97.19">   static void MarkMsgInHashTable(PLHashTable *hashTable, const Pop3UidlEntry *uidl,</span>
<a href="#l97.20"></a><span id="l97.20">                                   PRBool *changed);</span>
<a href="#l97.21"></a><span id="l97.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/local/src/nsRssService.cpp</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/local/src/nsRssService.cpp</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -73,35 +73,31 @@ NS_IMETHODIMP nsRssService::GetDefaultLo</span>
<a href="#l98.4"></a><span id="l98.4">    </span>
<a href="#l98.5"></a><span id="l98.5">     NS_IF_ADDREF(*aDefaultLocalPath = localFile);</span>
<a href="#l98.6"></a><span id="l98.6">     return NS_OK;</span>
<a href="#l98.7"></a><span id="l98.7"> </span>
<a href="#l98.8"></a><span id="l98.8"> }</span>
<a href="#l98.9"></a><span id="l98.9"> </span>
<a href="#l98.10"></a><span id="l98.10"> NS_IMETHODIMP nsRssService::SetDefaultLocalPath(nsILocalFile * aDefaultLocalPath)</span>
<a href="#l98.11"></a><span id="l98.11"> {</span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l98.13"></a><span id="l98.13">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l98.14"></a><span id="l98.14"> }</span>
<a href="#l98.15"></a><span id="l98.15"> </span>
<a href="#l98.16"></a><span id="l98.16"> NS_IMETHODIMP nsRssService::GetServerIID(nsIID * *aServerIID)</span>
<a href="#l98.17"></a><span id="l98.17"> {</span>
<a href="#l98.18"></a><span id="l98.18" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l98.19"></a><span id="l98.19">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l98.20"></a><span id="l98.20"> }</span>
<a href="#l98.21"></a><span id="l98.21"> </span>
<a href="#l98.22"></a><span id="l98.22"> NS_IMETHODIMP nsRssService::GetRequiresUsername(PRBool *aRequiresUsername)</span>
<a href="#l98.23"></a><span id="l98.23"> {</span>
<a href="#l98.24"></a><span id="l98.24" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l98.25"></a><span id="l98.25">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l98.26"></a><span id="l98.26"> }</span>
<a href="#l98.27"></a><span id="l98.27"> </span>
<a href="#l98.28"></a><span id="l98.28"> NS_IMETHODIMP nsRssService::GetPreflightPrettyNameWithEmailAddress(PRBool *aPreflightPrettyNameWithEmailAddress)</span>
<a href="#l98.29"></a><span id="l98.29"> {</span>
<a href="#l98.30"></a><span id="l98.30" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l98.31"></a><span id="l98.31">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l98.32"></a><span id="l98.32"> }</span>
<a href="#l98.33"></a><span id="l98.33"> </span>
<a href="#l98.34"></a><span id="l98.34"> NS_IMETHODIMP nsRssService::GetCanDelete(PRBool *aCanDelete)</span>
<a href="#l98.35"></a><span id="l98.35"> {</span>
<a href="#l98.36"></a><span id="l98.36">     NS_ENSURE_ARG_POINTER(aCanDelete);</span>
<a href="#l98.37"></a><span id="l98.37">     *aCanDelete = PR_TRUE;</span>
<a href="#l98.38"></a><span id="l98.38">     return NS_OK;</span>
<a href="#l98.39"></a><span id="l98.39" class="difflineat">@@ -153,11 +149,10 @@ NS_IMETHODIMP nsRssService::GetShowCompo</span>
<a href="#l98.40"></a><span id="l98.40"> {</span>
<a href="#l98.41"></a><span id="l98.41">     NS_ENSURE_ARG_POINTER(aShowComposeMsgLink);</span>
<a href="#l98.42"></a><span id="l98.42">     *aShowComposeMsgLink = PR_FALSE;    </span>
<a href="#l98.43"></a><span id="l98.43">     return NS_OK;</span>
<a href="#l98.44"></a><span id="l98.44"> }</span>
<a href="#l98.45"></a><span id="l98.45"> </span>
<a href="#l98.46"></a><span id="l98.46"> NS_IMETHODIMP nsRssService::GetSpecialFoldersDeletionAllowed(PRBool *aSpecialFoldersDeletionAllowed)</span>
<a href="#l98.47"></a><span id="l98.47"> {</span>
<a href="#l98.48"></a><span id="l98.48" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l98.49"></a><span id="l98.49">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l98.50"></a><span id="l98.50"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/mime/src/mimecryp.cpp</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/mime/src/mimecryp.cpp</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -173,18 +173,17 @@ MimeEncrypted_parse_buffer (const char *</span>
<a href="#l99.4"></a><span id="l99.4">                                    size,</span>
<a href="#l99.5"></a><span id="l99.5">                                    obj);</span>
<a href="#l99.6"></a><span id="l99.6"> }</span>
<a href="#l99.7"></a><span id="l99.7"> </span>
<a href="#l99.8"></a><span id="l99.8"> </span>
<a href="#l99.9"></a><span id="l99.9"> static int</span>
<a href="#l99.10"></a><span id="l99.10"> MimeEncrypted_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l99.11"></a><span id="l99.11"> {</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-  NS_ASSERTION(0, &quot;1.2 &lt;mscott@netscape.com&gt; 01 Nov 2001 17:59&quot;);</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineminus">-  /* This method shouldn't ever be called. */</span>
<a href="#l99.14"></a><span id="l99.14" class="difflineplus">+  NS_ERROR(&quot;This method shouldn't ever be called.&quot;);</span>
<a href="#l99.15"></a><span id="l99.15">   return -1;</span>
<a href="#l99.16"></a><span id="l99.16"> }</span>
<a href="#l99.17"></a><span id="l99.17"> </span>
<a href="#l99.18"></a><span id="l99.18"> static int</span>
<a href="#l99.19"></a><span id="l99.19"> MimeEncrypted_parse_decoded_buffer (const char *buffer, PRInt32 size, MimeObject *obj)</span>
<a href="#l99.20"></a><span id="l99.20"> {</span>
<a href="#l99.21"></a><span id="l99.21">   MimeEncrypted *enc = (MimeEncrypted *) obj;</span>
<a href="#l99.22"></a><span id="l99.22">   return</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/mime/src/mimeenc.cpp</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/mime/src/mimeenc.cpp</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -216,33 +216,35 @@ mime_decode_base64_token (const char *in</span>
<a href="#l100.4"></a><span id="l100.4">     unsigned char c = 0;</span>
<a href="#l100.5"></a><span id="l100.5">     if (in[j] &gt;= 'A' &amp;&amp; in[j] &lt;= 'Z')     c = in[j] - 'A';</span>
<a href="#l100.6"></a><span id="l100.6">     else if (in[j] &gt;= 'a' &amp;&amp; in[j] &lt;= 'z') c = in[j] - ('a' - 26);</span>
<a href="#l100.7"></a><span id="l100.7">     else if (in[j] &gt;= '0' &amp;&amp; in[j] &lt;= '9') c = in[j] - ('0' - 52);</span>
<a href="#l100.8"></a><span id="l100.8">     else if (in[j] == '+')         c = 62;</span>
<a href="#l100.9"></a><span id="l100.9">     else if (in[j] == '/')         c = 63;</span>
<a href="#l100.10"></a><span id="l100.10">     else if (in[j] == '=')         c = 0, eq_count++;</span>
<a href="#l100.11"></a><span id="l100.11">     else</span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineplus">+    NS_ERROR(&quot;Invalid character&quot;);</span>
<a href="#l100.14"></a><span id="l100.14">     num = (num &lt;&lt; 6) | c;</span>
<a href="#l100.15"></a><span id="l100.15">   }</span>
<a href="#l100.16"></a><span id="l100.16"> </span>
<a href="#l100.17"></a><span id="l100.17">   *out++ = (char) (num &gt;&gt; 16);</span>
<a href="#l100.18"></a><span id="l100.18">   *out++ = (char) ((num &gt;&gt; 8) &amp; 0xFF);</span>
<a href="#l100.19"></a><span id="l100.19">   *out++ = (char) (num &amp; 0xFF);</span>
<a href="#l100.20"></a><span id="l100.20"> </span>
<a href="#l100.21"></a><span id="l100.21">   if (eq_count == 0)</span>
<a href="#l100.22"></a><span id="l100.22">   return 3;        /* No &quot;=&quot; padding means 4 bytes mapped to 3. */</span>
<a href="#l100.23"></a><span id="l100.23">   else if (eq_count == 1)</span>
<a href="#l100.24"></a><span id="l100.24">   return 2;        /* &quot;xxx=&quot; means 3 bytes mapped to 2. */</span>
<a href="#l100.25"></a><span id="l100.25">   else if (eq_count == 2)</span>
<a href="#l100.26"></a><span id="l100.26">   return 1;        /* &quot;xx==&quot; means 2 bytes mapped to 1. */</span>
<a href="#l100.27"></a><span id="l100.27">   else</span>
<a href="#l100.28"></a><span id="l100.28" class="difflineminus">-  {            /* &quot;x===&quot; can't happen, because &quot;x&quot; would then */</span>
<a href="#l100.29"></a><span id="l100.29" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);      /* be encoding only 6 bits, not the min of 8. */</span>
<a href="#l100.30"></a><span id="l100.30" class="difflineplus">+  {</span>
<a href="#l100.31"></a><span id="l100.31" class="difflineplus">+    // &quot;x===&quot; can't happen, because &quot;x&quot; would then be encoding only</span>
<a href="#l100.32"></a><span id="l100.32" class="difflineplus">+    // 6 bits, not the min of 8.</span>
<a href="#l100.33"></a><span id="l100.33" class="difflineplus">+    NS_ERROR(&quot;Count is 6 bits, should be at least 8&quot;);</span>
<a href="#l100.34"></a><span id="l100.34">     return 1;</span>
<a href="#l100.35"></a><span id="l100.35">   }</span>
<a href="#l100.36"></a><span id="l100.36"> }</span>
<a href="#l100.37"></a><span id="l100.37"> </span>
<a href="#l100.38"></a><span id="l100.38"> </span>
<a href="#l100.39"></a><span id="l100.39"> static int</span>
<a href="#l100.40"></a><span id="l100.40"> mime_decode_base64_buffer (MimeDecoderData *data,</span>
<a href="#l100.41"></a><span id="l100.41">                const char *buffer, PRInt32 length)</span>
<a href="#l100.42"></a><span id="l100.42" class="difflineat">@@ -836,17 +838,17 @@ MimeDecoderWrite (MimeDecoderData *data,</span>
<a href="#l100.43"></a><span id="l100.43">     return mime_decode_base64_buffer (data, buffer, size);</span>
<a href="#l100.44"></a><span id="l100.44">   case mime_QuotedPrintable:</span>
<a href="#l100.45"></a><span id="l100.45">     return mime_decode_qp_buffer (data, buffer, size);</span>
<a href="#l100.46"></a><span id="l100.46">   case mime_uuencode:</span>
<a href="#l100.47"></a><span id="l100.47">     return mime_decode_uue_buffer (data, buffer, size);</span>
<a href="#l100.48"></a><span id="l100.48">   case mime_yencode:</span>
<a href="#l100.49"></a><span id="l100.49">     return mime_decode_yenc_buffer (data, buffer, size);</span>
<a href="#l100.50"></a><span id="l100.50">   default:</span>
<a href="#l100.51"></a><span id="l100.51" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l100.52"></a><span id="l100.52" class="difflineplus">+    NS_ERROR(&quot;Invalid decoding&quot;);</span>
<a href="#l100.53"></a><span id="l100.53">     return -1;</span>
<a href="#l100.54"></a><span id="l100.54">   }</span>
<a href="#l100.55"></a><span id="l100.55"> }</span>
<a href="#l100.56"></a><span id="l100.56"> </span>
<a href="#l100.57"></a><span id="l100.57"> </span>
<a href="#l100.58"></a><span id="l100.58"> </span>
<a href="#l100.59"></a><span id="l100.59"> /* ================== Encoders.</span>
<a href="#l100.60"></a><span id="l100.60">  */</span>
<a href="#l100.61"></a><span id="l100.61" class="difflineat">@@ -883,17 +885,17 @@ mime_encode_base64_buffer (MimeEncoderDa</span>
<a href="#l100.62"></a><span id="l100.62">   char *out = out_buffer;</span>
<a href="#l100.63"></a><span id="l100.63">   PRUint32 i = 0, n = 0;</span>
<a href="#l100.64"></a><span id="l100.64">   PRUint32 off;</span>
<a href="#l100.65"></a><span id="l100.65"> </span>
<a href="#l100.66"></a><span id="l100.66">   if (size == 0)</span>
<a href="#l100.67"></a><span id="l100.67">   return 0;</span>
<a href="#l100.68"></a><span id="l100.68">   else if (size &lt; 0)</span>
<a href="#l100.69"></a><span id="l100.69">   {</span>
<a href="#l100.70"></a><span id="l100.70" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l100.71"></a><span id="l100.71" class="difflineplus">+    NS_ERROR(&quot;Size is less than 0&quot;);</span>
<a href="#l100.72"></a><span id="l100.72">     return -1;</span>
<a href="#l100.73"></a><span id="l100.73">   }</span>
<a href="#l100.74"></a><span id="l100.74"> </span>
<a href="#l100.75"></a><span id="l100.75"> </span>
<a href="#l100.76"></a><span id="l100.76">   /* If this input buffer is too small, wait until next time. */</span>
<a href="#l100.77"></a><span id="l100.77">   if (size &lt; (3 - data-&gt;in_buffer_count))</span>
<a href="#l100.78"></a><span id="l100.78">   {</span>
<a href="#l100.79"></a><span id="l100.79">     NS_ASSERTION(size &lt; 3 &amp;&amp; size &gt; 0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l100.80"></a><span id="l100.80" class="difflineat">@@ -1221,12 +1223,12 @@ MimeEncoderWrite (MimeEncoderData *data,</span>
<a href="#l100.81"></a><span id="l100.81">   if (!data) return -1;</span>
<a href="#l100.82"></a><span id="l100.82">   switch(data-&gt;encoding)</span>
<a href="#l100.83"></a><span id="l100.83">   {</span>
<a href="#l100.84"></a><span id="l100.84">   case mime_Base64:</span>
<a href="#l100.85"></a><span id="l100.85">     return mime_encode_base64_buffer (data, buffer, size);</span>
<a href="#l100.86"></a><span id="l100.86">   case mime_QuotedPrintable:</span>
<a href="#l100.87"></a><span id="l100.87">     return mime_encode_qp_buffer (data, buffer, size);</span>
<a href="#l100.88"></a><span id="l100.88">   default:</span>
<a href="#l100.89"></a><span id="l100.89" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l100.90"></a><span id="l100.90" class="difflineplus">+    NS_ERROR(&quot;Invalid encoding&quot;);</span>
<a href="#l100.91"></a><span id="l100.91">     return -1;</span>
<a href="#l100.92"></a><span id="l100.92">   }</span>
<a href="#l100.93"></a><span id="l100.93"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/mime/src/mimeeobj.cpp</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/mime/src/mimeeobj.cpp</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -245,30 +245,28 @@ MimeExternalObject_parse_decoded_buffer </span>
<a href="#l101.4"></a><span id="l101.4">    because, unlike most children of MimeLeaf, we do not want to line-</span>
<a href="#l101.5"></a><span id="l101.5">    buffer the decoded data -- we want to simply pass it along to the</span>
<a href="#l101.6"></a><span id="l101.6">    backend, without going through our `parse_line' method.</span>
<a href="#l101.7"></a><span id="l101.7">    */</span>
<a href="#l101.8"></a><span id="l101.8">   if (!obj-&gt;output_p ||</span>
<a href="#l101.9"></a><span id="l101.9">     !obj-&gt;options ||</span>
<a href="#l101.10"></a><span id="l101.10">     obj-&gt;options-&gt;write_html_p)</span>
<a href="#l101.11"></a><span id="l101.11">   {</span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineplus">+    NS_ERROR(&quot;MimeObject is missing some data&quot;);</span>
<a href="#l101.14"></a><span id="l101.14">     return -1;</span>
<a href="#l101.15"></a><span id="l101.15">   }</span>
<a href="#l101.16"></a><span id="l101.16"> </span>
<a href="#l101.17"></a><span id="l101.17">   return MimeObject_write(obj, buf, size, PR_TRUE);</span>
<a href="#l101.18"></a><span id="l101.18"> }</span>
<a href="#l101.19"></a><span id="l101.19"> </span>
<a href="#l101.20"></a><span id="l101.20"> </span>
<a href="#l101.21"></a><span id="l101.21"> static int</span>
<a href="#l101.22"></a><span id="l101.22"> MimeExternalObject_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l101.23"></a><span id="l101.23"> {</span>
<a href="#l101.24"></a><span id="l101.24" class="difflineminus">-  /* This method should never be called (externals do no line buffering).</span>
<a href="#l101.25"></a><span id="l101.25" class="difflineminus">-   */</span>
<a href="#l101.26"></a><span id="l101.26" class="difflineminus">-  NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l101.27"></a><span id="l101.27" class="difflineplus">+  NS_ERROR(&quot;This method should never be called (externals do no line buffering).&quot;);</span>
<a href="#l101.28"></a><span id="l101.28">   return -1;</span>
<a href="#l101.29"></a><span id="l101.29"> }</span>
<a href="#l101.30"></a><span id="l101.30"> </span>
<a href="#l101.31"></a><span id="l101.31"> static PRBool</span>
<a href="#l101.32"></a><span id="l101.32"> MimeExternalObject_displayable_inline_p (MimeObjectClass *clazz,</span>
<a href="#l101.33"></a><span id="l101.33">                      MimeHeaders *hdrs)</span>
<a href="#l101.34"></a><span id="l101.34"> {</span>
<a href="#l101.35"></a><span id="l101.35">   return PR_FALSE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/mime/src/mimei.cpp</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/mime/src/mimei.cpp</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -1107,17 +1107,17 @@ mime_part_address(MimeObject *obj)</span>
<a href="#l102.4"></a><span id="l102.4">     for (i = 0; i &lt; cont-&gt;nchildren; i++)</span>
<a href="#l102.5"></a><span id="l102.5">     if (cont-&gt;children[i] == obj)</span>
<a href="#l102.6"></a><span id="l102.6">       {</span>
<a href="#l102.7"></a><span id="l102.7">       j = i+1;</span>
<a href="#l102.8"></a><span id="l102.8">       break;</span>
<a href="#l102.9"></a><span id="l102.9">       }</span>
<a href="#l102.10"></a><span id="l102.10">     if (j == -1)</span>
<a href="#l102.11"></a><span id="l102.11">     {</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-      NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineplus">+      NS_ERROR(&quot;No children under MeimContainer&quot;);</span>
<a href="#l102.14"></a><span id="l102.14">       return 0;</span>
<a href="#l102.15"></a><span id="l102.15">     }</span>
<a href="#l102.16"></a><span id="l102.16"> </span>
<a href="#l102.17"></a><span id="l102.17">     PR_snprintf(buf, sizeof(buf), &quot;%ld&quot;, j);</span>
<a href="#l102.18"></a><span id="l102.18">     if (obj-&gt;parent-&gt;parent)</span>
<a href="#l102.19"></a><span id="l102.19">     {</span>
<a href="#l102.20"></a><span id="l102.20">       higher = mime_part_address(obj-&gt;parent);</span>
<a href="#l102.21"></a><span id="l102.21">       if (!higher) return 0;  /* MIME_OUT_OF_MEMORY */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/mime/src/mimeiimg.cpp</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/mime/src/mimeiimg.cpp</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -267,13 +267,11 @@ MimeInlineImage_parse_decoded_buffer (co</span>
<a href="#l103.4"></a><span id="l103.4"> </span>
<a href="#l103.5"></a><span id="l103.5">   return status;</span>
<a href="#l103.6"></a><span id="l103.6"> }</span>
<a href="#l103.7"></a><span id="l103.7"> </span>
<a href="#l103.8"></a><span id="l103.8"> </span>
<a href="#l103.9"></a><span id="l103.9"> static int</span>
<a href="#l103.10"></a><span id="l103.10"> MimeInlineImage_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l103.11"></a><span id="l103.11"> {</span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-  /* This method should never be called (inline images do no line buffering).</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineminus">-   */</span>
<a href="#l103.14"></a><span id="l103.14" class="difflineminus">-  NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l103.15"></a><span id="l103.15" class="difflineplus">+  NS_ERROR(&quot;This method should never be called (inline images do no line buffering).&quot;);</span>
<a href="#l103.16"></a><span id="l103.16">   return -1;</span>
<a href="#l103.17"></a><span id="l103.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/mime/src/mimeleaf.cpp</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/mime/src/mimeleaf.cpp</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -175,18 +175,17 @@ MimeLeaf_parse_buffer (const char *buffe</span>
<a href="#l104.4"></a><span id="l104.4">   else</span>
<a href="#l104.5"></a><span id="l104.5">   return ((MimeLeafClass *)obj-&gt;clazz)-&gt;parse_decoded_buffer (buffer, size,</span>
<a href="#l104.6"></a><span id="l104.6">                                 obj);</span>
<a href="#l104.7"></a><span id="l104.7"> }</span>
<a href="#l104.8"></a><span id="l104.8"> </span>
<a href="#l104.9"></a><span id="l104.9"> static int</span>
<a href="#l104.10"></a><span id="l104.10"> MimeLeaf_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l104.11"></a><span id="l104.11"> {</span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-  NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineminus">-  /* This method shouldn't ever be called. */</span>
<a href="#l104.14"></a><span id="l104.14" class="difflineplus">+  NS_ERROR(&quot;MimeLeaf_parse_line shouldn't ever be called.&quot;);</span>
<a href="#l104.15"></a><span id="l104.15">   return -1;</span>
<a href="#l104.16"></a><span id="l104.16"> }</span>
<a href="#l104.17"></a><span id="l104.17"> </span>
<a href="#l104.18"></a><span id="l104.18"> </span>
<a href="#l104.19"></a><span id="l104.19"> static int</span>
<a href="#l104.20"></a><span id="l104.20"> MimeLeaf_close_decoder (MimeObject *obj)</span>
<a href="#l104.21"></a><span id="l104.21"> {</span>
<a href="#l104.22"></a><span id="l104.22">   MimeLeaf *leaf = (MimeLeaf *) obj;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -273,18 +273,17 @@ MimeObject_parse_buffer (const char *buf</span>
<a href="#l105.4"></a><span id="l105.4">               /* This cast is to turn void into MimeObject */</span>
<a href="#l105.5"></a><span id="l105.5">               obj-&gt;clazz-&gt;parse_line),</span>
<a href="#l105.6"></a><span id="l105.6">              obj);</span>
<a href="#l105.7"></a><span id="l105.7"> }</span>
<a href="#l105.8"></a><span id="l105.8"> </span>
<a href="#l105.9"></a><span id="l105.9"> static int</span>
<a href="#l105.10"></a><span id="l105.10"> MimeObject_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l105.11"></a><span id="l105.11"> {</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-  /* This method should never be called. */</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineminus">-  NS_ASSERTION(0, &quot;shouldn't call this method&quot;);</span>
<a href="#l105.14"></a><span id="l105.14" class="difflineplus">+  NS_ERROR(&quot;shouldn't call this method&quot;);</span>
<a href="#l105.15"></a><span id="l105.15">   return -1;</span>
<a href="#l105.16"></a><span id="l105.16"> }</span>
<a href="#l105.17"></a><span id="l105.17"> </span>
<a href="#l105.18"></a><span id="l105.18"> static int</span>
<a href="#l105.19"></a><span id="l105.19"> MimeObject_parse_eof (MimeObject *obj, PRBool abort_p)</span>
<a href="#l105.20"></a><span id="l105.20"> {</span>
<a href="#l105.21"></a><span id="l105.21">   if (obj-&gt;closed_p) return 0;</span>
<a href="#l105.22"></a><span id="l105.22">   NS_ASSERTION(!obj-&gt;parsed_p, &quot;obj already parsed&quot;);</span>
<a href="#l105.23"></a><span id="l105.23" class="difflineat">@@ -329,17 +328,17 @@ MimeObject_parse_end (MimeObject *obj, P</span>
<a href="#l105.24"></a><span id="l105.24"> </span>
<a href="#l105.25"></a><span id="l105.25">   obj-&gt;parsed_p = PR_TRUE;</span>
<a href="#l105.26"></a><span id="l105.26">   return 0;</span>
<a href="#l105.27"></a><span id="l105.27"> }</span>
<a href="#l105.28"></a><span id="l105.28"> </span>
<a href="#l105.29"></a><span id="l105.29"> static PRBool</span>
<a href="#l105.30"></a><span id="l105.30"> MimeObject_displayable_inline_p (MimeObjectClass *clazz, MimeHeaders *hdrs)</span>
<a href="#l105.31"></a><span id="l105.31"> {</span>
<a href="#l105.32"></a><span id="l105.32" class="difflineminus">-  NS_ASSERTION(0, &quot;shouldn't call this method&quot;);  /* This method should never be called. */</span>
<a href="#l105.33"></a><span id="l105.33" class="difflineplus">+  NS_ERROR(&quot;shouldn't call this method&quot;);</span>
<a href="#l105.34"></a><span id="l105.34">   return PR_FALSE;</span>
<a href="#l105.35"></a><span id="l105.35"> }</span>
<a href="#l105.36"></a><span id="l105.36"> </span>
<a href="#l105.37"></a><span id="l105.37"> #if defined(DEBUG) &amp;&amp; defined(XP_UNIX)</span>
<a href="#l105.38"></a><span id="l105.38"> static int</span>
<a href="#l105.39"></a><span id="l105.39"> MimeObject_debug_print (MimeObject *obj, PRFileDesc *stream, PRInt32 depth)</span>
<a href="#l105.40"></a><span id="l105.40"> {</span>
<a href="#l105.41"></a><span id="l105.41">   int i;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -613,17 +613,17 @@ NS_IMETHODIMP nsStreamConverter::Init(ns</span>
<a href="#l106.4"></a><span id="l106.4">       mOutputFormat = &quot;text/html&quot;;</span>
<a href="#l106.5"></a><span id="l106.5">       break;</span>
<a href="#l106.6"></a><span id="l106.6"> </span>
<a href="#l106.7"></a><span id="l106.7">     case nsMimeOutput::nsMimeMessageFilterSniffer: // output all displayable part as raw</span>
<a href="#l106.8"></a><span id="l106.8">       mOutputFormat = &quot;text/html&quot;;</span>
<a href="#l106.9"></a><span id="l106.9">       break;</span>
<a href="#l106.10"></a><span id="l106.10"> </span>
<a href="#l106.11"></a><span id="l106.11">     default:</span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-      NS_ASSERTION(0, &quot;this means I made a mistake in my assumptions&quot;);</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineplus">+      NS_ERROR(&quot;this means I made a mistake in my assumptions&quot;);</span>
<a href="#l106.14"></a><span id="l106.14">   }</span>
<a href="#l106.15"></a><span id="l106.15"> </span>
<a href="#l106.16"></a><span id="l106.16"> </span>
<a href="#l106.17"></a><span id="l106.17">   // the following output channel stream is used to fake the content type for people who later</span>
<a href="#l106.18"></a><span id="l106.18">   // call into us..</span>
<a href="#l106.19"></a><span id="l106.19">   nsCString contentTypeToUse;</span>
<a href="#l106.20"></a><span id="l106.20">   GetContentType(getter_Copies(contentTypeToUse));</span>
<a href="#l106.21"></a><span id="l106.21">   // mscott --&gt; my theory is that we don't need this fake outgoing channel. Let's use the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -758,17 +758,17 @@ NS_IMETHODIMP nsNNTPNewsgroupList::Apply</span>
<a href="#l107.4"></a><span id="l107.4">         messageArray-&gt;AppendElement(m_newMsgHdr, PR_FALSE);</span>
<a href="#l107.5"></a><span id="l107.5"> </span>
<a href="#l107.6"></a><span id="l107.6">         customAction-&gt;Apply(messageArray, value, nsnull,</span>
<a href="#l107.7"></a><span id="l107.7">                             nsMsgFilterType::NewsRule, aMsgWindow);</span>
<a href="#l107.8"></a><span id="l107.8">       }</span>
<a href="#l107.9"></a><span id="l107.9">       break;</span>
<a href="#l107.10"></a><span id="l107.10"> </span>
<a href="#l107.11"></a><span id="l107.11">       default:</span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-        NS_ASSERTION(0, &quot;unexpected action&quot;);</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineplus">+        NS_ERROR(&quot;unexpected action&quot;);</span>
<a href="#l107.14"></a><span id="l107.14">         break;</span>
<a href="#l107.15"></a><span id="l107.15">       }</span>
<a href="#l107.16"></a><span id="l107.16"> </span>
<a href="#l107.17"></a><span id="l107.17">       if (loggingEnabled)</span>
<a href="#l107.18"></a><span id="l107.18">         (void) aFilter-&gt;LogRuleHit(filterAction, m_newMsgHdr);</span>
<a href="#l107.19"></a><span id="l107.19">     }</span>
<a href="#l107.20"></a><span id="l107.20">   }</span>
<a href="#l107.21"></a><span id="l107.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -1971,17 +1971,17 @@ PRInt32 nsNNTPProtocol::SendListSubscrip</span>
<a href="#l108.4"></a><span id="l108.4">     SetFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l108.5"></a><span id="l108.5">     return 0;</span>
<a href="#l108.6"></a><span id="l108.6">   }</span>
<a href="#l108.7"></a><span id="l108.7">   if (!line)</span>
<a href="#l108.8"></a><span id="l108.8">     return status;  /* no line yet */</span>
<a href="#l108.9"></a><span id="l108.9"> </span>
<a href="#l108.10"></a><span id="l108.10">   if ('.' != line[0])</span>
<a href="#l108.11"></a><span id="l108.11">   {</span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-        NS_ASSERTION(0,&quot;fix me&quot;);</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+        NS_ERROR(&quot;fix me&quot;);</span>
<a href="#l108.14"></a><span id="l108.14"> #if 0</span>
<a href="#l108.15"></a><span id="l108.15">     char *url = PR_smprintf (&quot;%s//%s/%s&quot;, NEWS_SCHEME, m_hostName, line);</span>
<a href="#l108.16"></a><span id="l108.16">     if (url)</span>
<a href="#l108.17"></a><span id="l108.17">       MSG_AddSubscribedNewsgroup (cd-&gt;pane, url);</span>
<a href="#l108.18"></a><span id="l108.18"> #endif</span>
<a href="#l108.19"></a><span id="l108.19">   }</span>
<a href="#l108.20"></a><span id="l108.20">   else</span>
<a href="#l108.21"></a><span id="l108.21">   {</span>
<a href="#l108.22"></a><span id="l108.22" class="difflineat">@@ -2853,17 +2853,17 @@ PRInt32 nsNNTPProtocol::AuthorizationRes</span>
<a href="#l108.23"></a><span id="l108.23">   }</span>
<a href="#l108.24"></a><span id="l108.24">   else</span>
<a href="#l108.25"></a><span id="l108.25">   {</span>
<a href="#l108.26"></a><span id="l108.26">     /* login failed */</span>
<a href="#l108.27"></a><span id="l108.27">     HandleAuthenticationFailure();</span>
<a href="#l108.28"></a><span id="l108.28">     return(MK_NNTP_AUTH_FAILED);</span>
<a href="#l108.29"></a><span id="l108.29">   }</span>
<a href="#l108.30"></a><span id="l108.30"> </span>
<a href="#l108.31"></a><span id="l108.31" class="difflineminus">-  NS_ASSERTION(0,&quot;should never get here&quot;);</span>
<a href="#l108.32"></a><span id="l108.32" class="difflineplus">+  NS_ERROR(&quot;should never get here&quot;);</span>
<a href="#l108.33"></a><span id="l108.33">   return(-1);</span>
<a href="#l108.34"></a><span id="l108.34"> </span>
<a href="#l108.35"></a><span id="l108.35"> }</span>
<a href="#l108.36"></a><span id="l108.36"> </span>
<a href="#l108.37"></a><span id="l108.37"> PRInt32 nsNNTPProtocol::PasswordResponse()</span>
<a href="#l108.38"></a><span id="l108.38"> {</span>
<a href="#l108.39"></a><span id="l108.39">   if (MK_NNTP_RESPONSE_AUTHINFO_OK == m_responseCode ||</span>
<a href="#l108.40"></a><span id="l108.40">     MK_NNTP_RESPONSE_AUTHINFO_SIMPLE_OK == m_responseCode)</span>
<a href="#l108.41"></a><span id="l108.41" class="difflineat">@@ -2896,17 +2896,17 @@ PRInt32 nsNNTPProtocol::PasswordResponse</span>
<a href="#l108.42"></a><span id="l108.42">     return(0);</span>
<a href="#l108.43"></a><span id="l108.43">   }</span>
<a href="#l108.44"></a><span id="l108.44">   else</span>
<a href="#l108.45"></a><span id="l108.45">   {</span>
<a href="#l108.46"></a><span id="l108.46">     HandleAuthenticationFailure();</span>
<a href="#l108.47"></a><span id="l108.47">     return(MK_NNTP_AUTH_FAILED);</span>
<a href="#l108.48"></a><span id="l108.48">   }</span>
<a href="#l108.49"></a><span id="l108.49"> </span>
<a href="#l108.50"></a><span id="l108.50" class="difflineminus">-  NS_ASSERTION(0,&quot;should never get here&quot;);</span>
<a href="#l108.51"></a><span id="l108.51" class="difflineplus">+  NS_ERROR(&quot;should never get here&quot;);</span>
<a href="#l108.52"></a><span id="l108.52">   return(-1);</span>
<a href="#l108.53"></a><span id="l108.53"> }</span>
<a href="#l108.54"></a><span id="l108.54"> </span>
<a href="#l108.55"></a><span id="l108.55"> PRInt32 nsNNTPProtocol::DisplayNewsgroups()</span>
<a href="#l108.56"></a><span id="l108.56"> {</span>
<a href="#l108.57"></a><span id="l108.57">   m_nextState = NEWS_DONE;</span>
<a href="#l108.58"></a><span id="l108.58">   ClearFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l108.59"></a><span id="l108.59"> </span>
<a href="#l108.60"></a><span id="l108.60" class="difflineat">@@ -4857,17 +4857,17 @@ PRInt32 nsNNTPProtocol::SendListGroupRes</span>
<a href="#l108.61"></a><span id="l108.61">   }</span>
<a href="#l108.62"></a><span id="l108.62">   PR_FREEIF(line);</span>
<a href="#l108.63"></a><span id="l108.63">   return 0;</span>
<a href="#l108.64"></a><span id="l108.64"> }</span>
<a href="#l108.65"></a><span id="l108.65"> </span>
<a href="#l108.66"></a><span id="l108.66"> </span>
<a href="#l108.67"></a><span id="l108.67"> PRInt32 nsNNTPProtocol::Search()</span>
<a href="#l108.68"></a><span id="l108.68"> {</span>
<a href="#l108.69"></a><span id="l108.69" class="difflineminus">-  NS_ASSERTION(0,&quot;Search not implemented&quot;);</span>
<a href="#l108.70"></a><span id="l108.70" class="difflineplus">+  NS_ERROR(&quot;Search not implemented&quot;);</span>
<a href="#l108.71"></a><span id="l108.71">   return 0;</span>
<a href="#l108.72"></a><span id="l108.72"> }</span>
<a href="#l108.73"></a><span id="l108.73"> </span>
<a href="#l108.74"></a><span id="l108.74"> PRInt32 nsNNTPProtocol::SearchResponse()</span>
<a href="#l108.75"></a><span id="l108.75"> {</span>
<a href="#l108.76"></a><span id="l108.76">   if (MK_NNTP_RESPONSE_TYPE(m_responseCode) == MK_NNTP_RESPONSE_TYPE_OK)</span>
<a href="#l108.77"></a><span id="l108.77">     m_nextState = NNTP_SEARCH_RESULTS;</span>
<a href="#l108.78"></a><span id="l108.78">   else</span>
<a href="#l108.79"></a><span id="l108.79" class="difflineat">@@ -4941,17 +4941,17 @@ PRInt32 nsNNTPProtocol::SetupForTransfer</span>
<a href="#l108.80"></a><span id="l108.80">     if (PL_strstr(ce-&gt;URL_s-&gt;address, &quot;PROFILE NEW&quot;))</span>
<a href="#l108.81"></a><span id="l108.81">       m_nextState = NNTP_PROFILE_ADD;</span>
<a href="#l108.82"></a><span id="l108.82">     else</span>
<a href="#l108.83"></a><span id="l108.83">       m_nextState = NNTP_PROFILE_DELETE;</span>
<a href="#l108.84"></a><span id="l108.84">   }</span>
<a href="#l108.85"></a><span id="l108.85"> #endif</span>
<a href="#l108.86"></a><span id="l108.86">   else</span>
<a href="#l108.87"></a><span id="l108.87">   {</span>
<a href="#l108.88"></a><span id="l108.88" class="difflineminus">-    NS_ASSERTION(0, &quot;unexpected&quot;);</span>
<a href="#l108.89"></a><span id="l108.89" class="difflineplus">+    NS_ERROR(&quot;unexpected&quot;);</span>
<a href="#l108.90"></a><span id="l108.90">     return -1;</span>
<a href="#l108.91"></a><span id="l108.91">   }</span>
<a href="#l108.92"></a><span id="l108.92"> </span>
<a href="#l108.93"></a><span id="l108.93">   return(0); /* good */</span>
<a href="#l108.94"></a><span id="l108.94"> }</span>
<a href="#l108.95"></a><span id="l108.95"> </span>
<a href="#l108.96"></a><span id="l108.96"> /////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l108.97"></a><span id="l108.97"> // The following method is used for processing the news state machine.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -241,17 +241,16 @@ nsMsgNewsFolder::AddNewsgroup(const nsAC</span>
<a href="#l109.4"></a><span id="l109.4">   mSubFolders.AppendObject(folder);</span>
<a href="#l109.5"></a><span id="l109.5">   folder-&gt;SetParent(this);</span>
<a href="#l109.6"></a><span id="l109.6">   folder.swap(*child);</span>
<a href="#l109.7"></a><span id="l109.7">   return rv;</span>
<a href="#l109.8"></a><span id="l109.8"> }</span>
<a href="#l109.9"></a><span id="l109.9"> </span>
<a href="#l109.10"></a><span id="l109.10"> nsresult nsMsgNewsFolder::ParseFolder(nsILocalFile *path)</span>
<a href="#l109.11"></a><span id="l109.11"> {</span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-  NS_ASSERTION(0,&quot;ParseFolder not implemented&quot;);</span>
<a href="#l109.13"></a><span id="l109.13">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l109.14"></a><span id="l109.14"> }</span>
<a href="#l109.15"></a><span id="l109.15"> </span>
<a href="#l109.16"></a><span id="l109.16"> nsresult</span>
<a href="#l109.17"></a><span id="l109.17"> nsMsgNewsFolder::AddDirectorySeparator(nsILocalFile *path)</span>
<a href="#l109.18"></a><span id="l109.18"> {</span>
<a href="#l109.19"></a><span id="l109.19">   // don't concat the full separator with .sbd</span>
<a href="#l109.20"></a><span id="l109.20">   return (mURI.Equals(kNewsRootURI)) ?</span>
<a href="#l109.21"></a><span id="l109.21" class="difflineat">@@ -565,17 +564,16 @@ NS_IMETHODIMP nsMsgNewsFolder::Delete()</span>
<a href="#l109.22"></a><span id="l109.22">   rv = nntpServer-&gt;RemoveNewsgroup(name);</span>
<a href="#l109.23"></a><span id="l109.23">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l109.24"></a><span id="l109.24"> </span>
<a href="#l109.25"></a><span id="l109.25">   return SetNewsrcHasChanged(PR_TRUE);</span>
<a href="#l109.26"></a><span id="l109.26"> }</span>
<a href="#l109.27"></a><span id="l109.27"> </span>
<a href="#l109.28"></a><span id="l109.28"> NS_IMETHODIMP nsMsgNewsFolder::Rename(const nsAString&amp; newName, nsIMsgWindow *msgWindow)</span>
<a href="#l109.29"></a><span id="l109.29"> {</span>
<a href="#l109.30"></a><span id="l109.30" class="difflineminus">-  NS_ASSERTION(0,&quot;Rename not implemented&quot;);</span>
<a href="#l109.31"></a><span id="l109.31">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l109.32"></a><span id="l109.32"> }</span>
<a href="#l109.33"></a><span id="l109.33"> </span>
<a href="#l109.34"></a><span id="l109.34"> NS_IMETHODIMP nsMsgNewsFolder::GetAbbreviatedName(nsAString&amp; aAbbreviatedName)</span>
<a href="#l109.35"></a><span id="l109.35"> {</span>
<a href="#l109.36"></a><span id="l109.36">   nsresult rv;</span>
<a href="#l109.37"></a><span id="l109.37"> </span>
<a href="#l109.38"></a><span id="l109.38">   rv = nsMsgDBFolder::GetPrettyName(aAbbreviatedName);</span>
<a href="#l109.39"></a><span id="l109.39" class="difflineat">@@ -756,29 +754,26 @@ NS_IMETHODIMP nsMsgNewsFolder::GetExpung</span>
<a href="#l109.40"></a><span id="l109.40"> {</span>
<a href="#l109.41"></a><span id="l109.41">   NS_ENSURE_ARG_POINTER(count);</span>
<a href="#l109.42"></a><span id="l109.42">   *count = mExpungedBytes;</span>
<a href="#l109.43"></a><span id="l109.43">   return NS_OK;</span>
<a href="#l109.44"></a><span id="l109.44"> }</span>
<a href="#l109.45"></a><span id="l109.45"> </span>
<a href="#l109.46"></a><span id="l109.46"> NS_IMETHODIMP nsMsgNewsFolder::GetDeletable(PRBool *deletable)</span>
<a href="#l109.47"></a><span id="l109.47"> {</span>
<a href="#l109.48"></a><span id="l109.48" class="difflineminus">-  //  NS_ASSERTION(0,&quot;GetDeletable() not implemented&quot;);</span>
<a href="#l109.49"></a><span id="l109.49">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l109.50"></a><span id="l109.50"> }</span>
<a href="#l109.51"></a><span id="l109.51"> </span>
<a href="#l109.52"></a><span id="l109.52"> NS_IMETHODIMP nsMsgNewsFolder::GetRequiresCleanup(PRBool *requiresCleanup)</span>
<a href="#l109.53"></a><span id="l109.53"> {</span>
<a href="#l109.54"></a><span id="l109.54" class="difflineminus">-  //  NS_ASSERTION(0,&quot;GetRequiresCleanup not implemented&quot;);</span>
<a href="#l109.55"></a><span id="l109.55">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l109.56"></a><span id="l109.56"> }</span>
<a href="#l109.57"></a><span id="l109.57"> </span>
<a href="#l109.58"></a><span id="l109.58"> NS_IMETHODIMP nsMsgNewsFolder::GetSizeOnDisk(PRUint32 *size)</span>
<a href="#l109.59"></a><span id="l109.59"> {</span>
<a href="#l109.60"></a><span id="l109.60" class="difflineminus">-  //  NS_ASSERTION(0, &quot;GetSizeOnDisk not implemented&quot;);</span>
<a href="#l109.61"></a><span id="l109.61">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l109.62"></a><span id="l109.62"> }</span>
<a href="#l109.63"></a><span id="l109.63"> </span>
<a href="#l109.64"></a><span id="l109.64"> /* this is news, so remember that DeleteMessage is really CANCEL. */</span>
<a href="#l109.65"></a><span id="l109.65"> NS_IMETHODIMP</span>
<a href="#l109.66"></a><span id="l109.66"> nsMsgNewsFolder::DeleteMessages(nsIArray *messages, nsIMsgWindow *aMsgWindow,</span>
<a href="#l109.67"></a><span id="l109.67">                                 PRBool deleteStorage, PRBool isMove,</span>
<a href="#l109.68"></a><span id="l109.68">                                 nsIMsgCopyServiceListener* listener, PRBool allowUndo)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -1496,31 +1496,28 @@ nsNntpIncomingServer::ForgetPassword()</span>
<a href="#l110.4"></a><span id="l110.4">     }</span>
<a href="#l110.5"></a><span id="l110.5"> </span>
<a href="#l110.6"></a><span id="l110.6">     return return_rv;</span>
<a href="#l110.7"></a><span id="l110.7"> }</span>
<a href="#l110.8"></a><span id="l110.8"> </span>
<a href="#l110.9"></a><span id="l110.9"> NS_IMETHODIMP</span>
<a href="#l110.10"></a><span id="l110.10"> nsNntpIncomingServer::GetSupportsExtensions(PRBool *aSupportsExtensions)</span>
<a href="#l110.11"></a><span id="l110.11"> {</span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.13"></a><span id="l110.13">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.14"></a><span id="l110.14"> }</span>
<a href="#l110.15"></a><span id="l110.15"> </span>
<a href="#l110.16"></a><span id="l110.16"> NS_IMETHODIMP</span>
<a href="#l110.17"></a><span id="l110.17"> nsNntpIncomingServer::SetSupportsExtensions(PRBool aSupportsExtensions)</span>
<a href="#l110.18"></a><span id="l110.18"> {</span>
<a href="#l110.19"></a><span id="l110.19" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.20"></a><span id="l110.20">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.21"></a><span id="l110.21"> }</span>
<a href="#l110.22"></a><span id="l110.22"> </span>
<a href="#l110.23"></a><span id="l110.23"> NS_IMETHODIMP</span>
<a href="#l110.24"></a><span id="l110.24"> nsNntpIncomingServer::AddExtension(const char *extension)</span>
<a href="#l110.25"></a><span id="l110.25"> {</span>
<a href="#l110.26"></a><span id="l110.26" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.27"></a><span id="l110.27">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.28"></a><span id="l110.28"> }</span>
<a href="#l110.29"></a><span id="l110.29"> </span>
<a href="#l110.30"></a><span id="l110.30"> NS_IMETHODIMP</span>
<a href="#l110.31"></a><span id="l110.31"> nsNntpIncomingServer::QueryExtension(const char *extension, PRBool *result)</span>
<a href="#l110.32"></a><span id="l110.32"> {</span>
<a href="#l110.33"></a><span id="l110.33"> #ifdef DEBUG_seth</span>
<a href="#l110.34"></a><span id="l110.34">   printf(&quot;no extension support yet\n&quot;);</span>
<a href="#l110.35"></a><span id="l110.35" class="difflineat">@@ -1548,59 +1545,52 @@ nsNntpIncomingServer::GetLastUpdatedTime</span>
<a href="#l110.36"></a><span id="l110.36"> {</span>
<a href="#l110.37"></a><span id="l110.37">   *aLastUpdatedTime = mLastUpdatedTime;</span>
<a href="#l110.38"></a><span id="l110.38">   return NS_OK;</span>
<a href="#l110.39"></a><span id="l110.39"> }</span>
<a href="#l110.40"></a><span id="l110.40"> </span>
<a href="#l110.41"></a><span id="l110.41"> NS_IMETHODIMP</span>
<a href="#l110.42"></a><span id="l110.42"> nsNntpIncomingServer::SetLastUpdatedTime(PRUint32 aLastUpdatedTime)</span>
<a href="#l110.43"></a><span id="l110.43"> {</span>
<a href="#l110.44"></a><span id="l110.44" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.45"></a><span id="l110.45">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.46"></a><span id="l110.46"> }</span>
<a href="#l110.47"></a><span id="l110.47"> </span>
<a href="#l110.48"></a><span id="l110.48"> NS_IMETHODIMP</span>
<a href="#l110.49"></a><span id="l110.49"> nsNntpIncomingServer::AddPropertyForGet(const char *name, const char *value)</span>
<a href="#l110.50"></a><span id="l110.50"> {</span>
<a href="#l110.51"></a><span id="l110.51" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.52"></a><span id="l110.52">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.53"></a><span id="l110.53"> }</span>
<a href="#l110.54"></a><span id="l110.54"> </span>
<a href="#l110.55"></a><span id="l110.55"> NS_IMETHODIMP</span>
<a href="#l110.56"></a><span id="l110.56"> nsNntpIncomingServer::QueryPropertyForGet(const char *name, char **value)</span>
<a href="#l110.57"></a><span id="l110.57"> {</span>
<a href="#l110.58"></a><span id="l110.58" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.59"></a><span id="l110.59">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.60"></a><span id="l110.60"> }</span>
<a href="#l110.61"></a><span id="l110.61"> </span>
<a href="#l110.62"></a><span id="l110.62"> NS_IMETHODIMP</span>
<a href="#l110.63"></a><span id="l110.63"> nsNntpIncomingServer::AddSearchableGroup(const nsAString &amp;name)</span>
<a href="#l110.64"></a><span id="l110.64"> {</span>
<a href="#l110.65"></a><span id="l110.65" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.66"></a><span id="l110.66">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.67"></a><span id="l110.67"> }</span>
<a href="#l110.68"></a><span id="l110.68"> </span>
<a href="#l110.69"></a><span id="l110.69"> NS_IMETHODIMP</span>
<a href="#l110.70"></a><span id="l110.70"> nsNntpIncomingServer::QuerySearchableGroup(const nsAString &amp;name, PRBool *result)</span>
<a href="#l110.71"></a><span id="l110.71"> {</span>
<a href="#l110.72"></a><span id="l110.72" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.73"></a><span id="l110.73">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.74"></a><span id="l110.74"> }</span>
<a href="#l110.75"></a><span id="l110.75"> </span>
<a href="#l110.76"></a><span id="l110.76"> NS_IMETHODIMP</span>
<a href="#l110.77"></a><span id="l110.77"> nsNntpIncomingServer::AddSearchableHeader(const char *name)</span>
<a href="#l110.78"></a><span id="l110.78"> {</span>
<a href="#l110.79"></a><span id="l110.79" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.80"></a><span id="l110.80">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.81"></a><span id="l110.81"> }</span>
<a href="#l110.82"></a><span id="l110.82"> </span>
<a href="#l110.83"></a><span id="l110.83"> NS_IMETHODIMP</span>
<a href="#l110.84"></a><span id="l110.84"> nsNntpIncomingServer::QuerySearchableHeader(const char *name, PRBool *result)</span>
<a href="#l110.85"></a><span id="l110.85"> {</span>
<a href="#l110.86"></a><span id="l110.86" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.87"></a><span id="l110.87">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.88"></a><span id="l110.88"> }</span>
<a href="#l110.89"></a><span id="l110.89"> </span>
<a href="#l110.90"></a><span id="l110.90"> NS_IMETHODIMP</span>
<a href="#l110.91"></a><span id="l110.91"> nsNntpIncomingServer::FindGroup(const nsACString &amp;name, nsIMsgNewsFolder **result)</span>
<a href="#l110.92"></a><span id="l110.92"> {</span>
<a href="#l110.93"></a><span id="l110.93">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l110.94"></a><span id="l110.94"> </span>
<a href="#l110.95"></a><span id="l110.95" class="difflineat">@@ -1620,25 +1610,23 @@ nsNntpIncomingServer::FindGroup(const ns</span>
<a href="#l110.96"></a><span id="l110.96">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l110.97"></a><span id="l110.97">   if (!*result) return NS_ERROR_FAILURE;</span>
<a href="#l110.98"></a><span id="l110.98">   return NS_OK;</span>
<a href="#l110.99"></a><span id="l110.99"> }</span>
<a href="#l110.100"></a><span id="l110.100"> </span>
<a href="#l110.101"></a><span id="l110.101"> NS_IMETHODIMP</span>
<a href="#l110.102"></a><span id="l110.102"> nsNntpIncomingServer::GetFirstGroupNeedingExtraInfo(nsACString &amp;result)</span>
<a href="#l110.103"></a><span id="l110.103"> {</span>
<a href="#l110.104"></a><span id="l110.104" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.105"></a><span id="l110.105">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.106"></a><span id="l110.106"> }</span>
<a href="#l110.107"></a><span id="l110.107"> </span>
<a href="#l110.108"></a><span id="l110.108"> NS_IMETHODIMP</span>
<a href="#l110.109"></a><span id="l110.109"> nsNntpIncomingServer::SetGroupNeedsExtraInfo(const nsACString &amp;name,</span>
<a href="#l110.110"></a><span id="l110.110">                                              PRBool needsExtraInfo)</span>
<a href="#l110.111"></a><span id="l110.111"> {</span>
<a href="#l110.112"></a><span id="l110.112" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.113"></a><span id="l110.113">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.114"></a><span id="l110.114"> }</span>
<a href="#l110.115"></a><span id="l110.115"> </span>
<a href="#l110.116"></a><span id="l110.116"> </span>
<a href="#l110.117"></a><span id="l110.117"> NS_IMETHODIMP</span>
<a href="#l110.118"></a><span id="l110.118"> nsNntpIncomingServer::GroupNotFound(nsIMsgWindow *aMsgWindow,</span>
<a href="#l110.119"></a><span id="l110.119">                                     const nsAString &amp;aName, PRBool aOpening)</span>
<a href="#l110.120"></a><span id="l110.120"> {</span>
<a href="#l110.121"></a><span id="l110.121" class="difflineat">@@ -1689,17 +1677,16 @@ nsNntpIncomingServer::GroupNotFound(nsIM</span>
<a href="#l110.122"></a><span id="l110.122"> </span>
<a href="#l110.123"></a><span id="l110.123">   return rv;</span>
<a href="#l110.124"></a><span id="l110.124"> }</span>
<a href="#l110.125"></a><span id="l110.125"> </span>
<a href="#l110.126"></a><span id="l110.126"> NS_IMETHODIMP</span>
<a href="#l110.127"></a><span id="l110.127"> nsNntpIncomingServer::SetPrettyNameForGroup(const nsAString &amp;name,</span>
<a href="#l110.128"></a><span id="l110.128">                                             const nsAString &amp;prettyName)</span>
<a href="#l110.129"></a><span id="l110.129"> {</span>
<a href="#l110.130"></a><span id="l110.130" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l110.131"></a><span id="l110.131">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l110.132"></a><span id="l110.132"> }</span>
<a href="#l110.133"></a><span id="l110.133"> </span>
<a href="#l110.134"></a><span id="l110.134"> NS_IMETHODIMP</span>
<a href="#l110.135"></a><span id="l110.135"> nsNntpIncomingServer::GetCanSearchMessages(PRBool *canSearchMessages)</span>
<a href="#l110.136"></a><span id="l110.136"> {</span>
<a href="#l110.137"></a><span id="l110.137">     NS_ENSURE_ARG_POINTER(canSearchMessages);</span>
<a href="#l110.138"></a><span id="l110.138">     *canSearchMessages = PR_TRUE;</span>
<a href="#l110.139"></a><span id="l110.139" class="difflineat">@@ -2125,17 +2112,19 @@ nsNntpIncomingServer::GetFilterScope(nsM</span>
<a href="#l110.140"></a><span id="l110.140"> }</span>
<a href="#l110.141"></a><span id="l110.141"> </span>
<a href="#l110.142"></a><span id="l110.142"> NS_IMETHODIMP</span>
<a href="#l110.143"></a><span id="l110.143"> nsNntpIncomingServer::GetSearchScope(nsMsgSearchScopeValue *searchScope)</span>
<a href="#l110.144"></a><span id="l110.144"> {</span>
<a href="#l110.145"></a><span id="l110.145">    NS_ENSURE_ARG_POINTER(searchScope);</span>
<a href="#l110.146"></a><span id="l110.146"> </span>
<a href="#l110.147"></a><span id="l110.147">    if (WeAreOffline()) {</span>
<a href="#l110.148"></a><span id="l110.148" class="difflineminus">-     *searchScope = nsMsgSearchScope::localNews;</span>
<a href="#l110.149"></a><span id="l110.149" class="difflineplus">+     // This value is set to the localNewsBody scope to be compatible with</span>
<a href="#l110.150"></a><span id="l110.150" class="difflineplus">+     // the legacy default value.</span>
<a href="#l110.151"></a><span id="l110.151" class="difflineplus">+     *searchScope = nsMsgSearchScope::localNewsBody;</span>
<a href="#l110.152"></a><span id="l110.152">    }</span>
<a href="#l110.153"></a><span id="l110.153">    else {</span>
<a href="#l110.154"></a><span id="l110.154">      *searchScope = nsMsgSearchScope::news;</span>
<a href="#l110.155"></a><span id="l110.155">    }</span>
<a href="#l110.156"></a><span id="l110.156">    return NS_OK;</span>
<a href="#l110.157"></a><span id="l110.157"> }</span>
<a href="#l110.158"></a><span id="l110.158"> </span>
<a href="#l110.159"></a><span id="l110.159"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -1297,17 +1297,17 @@ NS_IMETHODIMP nsNntpService::GetNewNews(</span>
<a href="#l111.4"></a><span id="l111.4"> </span>
<a href="#l111.5"></a><span id="l111.5">     rv = RunNewsUrl(aUrl, aMsgWindow, nsnull);</span>
<a href="#l111.6"></a><span id="l111.6"> </span>
<a href="#l111.7"></a><span id="l111.7">     if (_retval)</span>
<a href="#l111.8"></a><span id="l111.8">       NS_IF_ADDREF(*_retval = aUrl);</span>
<a href="#l111.9"></a><span id="l111.9">   }</span>
<a href="#l111.10"></a><span id="l111.10">   else</span>
<a href="#l111.11"></a><span id="l111.11">   {</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-    NS_ASSERTION(0,&quot;not a news:/ url&quot;);</span>
<a href="#l111.13"></a><span id="l111.13" class="difflineplus">+    NS_ERROR(&quot;not a news:/ url&quot;);</span>
<a href="#l111.14"></a><span id="l111.14">     rv = NS_ERROR_FAILURE;</span>
<a href="#l111.15"></a><span id="l111.15">   }</span>
<a href="#l111.16"></a><span id="l111.16"> </span>
<a href="#l111.17"></a><span id="l111.17"> </span>
<a href="#l111.18"></a><span id="l111.18">   NS_UNLOCK_INSTANCE();</span>
<a href="#l111.19"></a><span id="l111.19">   return rv;</span>
<a href="#l111.20"></a><span id="l111.20"> }</span>
<a href="#l111.21"></a><span id="l111.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/suite/common/bookmarks/bookmarks.js</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/suite/common/bookmarks/bookmarks.js</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -1232,17 +1232,17 @@ var BookmarksUtils = {</span>
<a href="#l112.4"></a><span id="l112.4">       return isValid;</span>
<a href="#l112.5"></a><span id="l112.5">     }</span>
<a href="#l112.6"></a><span id="l112.6">     return aSelection.isValid;</span>
<a href="#l112.7"></a><span id="l112.7">   },</span>
<a href="#l112.8"></a><span id="l112.8"> </span>
<a href="#l112.9"></a><span id="l112.9">   isSelectionValidForDeletion: function (aSelection)</span>
<a href="#l112.10"></a><span id="l112.10">   {</span>
<a href="#l112.11"></a><span id="l112.11">     var isValid = new Array(aSelection.length);</span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-    for (i=0; i&lt;aSelection.length; ++i) {</span>
<a href="#l112.13"></a><span id="l112.13" class="difflineplus">+    for (var i=0; i&lt;aSelection.length; ++i) {</span>
<a href="#l112.14"></a><span id="l112.14">       if (!aSelection.isValid[i] || aSelection.isImmutable[i] || </span>
<a href="#l112.15"></a><span id="l112.15">           !aSelection.parent [i])</span>
<a href="#l112.16"></a><span id="l112.16">         isValid[i] = false;</span>
<a href="#l112.17"></a><span id="l112.17">       else</span>
<a href="#l112.18"></a><span id="l112.18">         isValid[i] = true;</span>
<a href="#l112.19"></a><span id="l112.19">     }</span>
<a href="#l112.20"></a><span id="l112.20">     return isValid;</span>
<a href="#l112.21"></a><span id="l112.21">   },</span>
<a href="#l112.22"></a><span id="l112.22" class="difflineat">@@ -1374,31 +1374,34 @@ var BookmarksUtils = {</span>
<a href="#l112.23"></a><span id="l112.23">     txmgr.endBatch();</span>
<a href="#l112.24"></a><span id="l112.24">     BookmarksUtils.notifyBookmarksChanged();</span>
<a href="#l112.25"></a><span id="l112.25">     BookmarksUtils.flushDataSource();</span>
<a href="#l112.26"></a><span id="l112.26">     return true;</span>
<a href="#l112.27"></a><span id="l112.27">   },</span>
<a href="#l112.28"></a><span id="l112.28"> </span>
<a href="#l112.29"></a><span id="l112.29">   moveSelection: function (aAction, aSelection, aTarget)</span>
<a href="#l112.30"></a><span id="l112.30">   {</span>
<a href="#l112.31"></a><span id="l112.31" class="difflineplus">+    var canDelete = BookmarksUtils.isSelectionValidForDeletion(aSelection);</span>
<a href="#l112.32"></a><span id="l112.32">     var isValid = BookmarksUtils.isSelectionValidForInsertion(aSelection, aTarget, aAction);</span>
<a href="#l112.33"></a><span id="l112.33">     if (SOUND &amp;&amp; !BookmarksUtils.all(isValid))</span>
<a href="#l112.34"></a><span id="l112.34">       SOUND.beep();</span>
<a href="#l112.35"></a><span id="l112.35">     if (!BookmarksUtils.any(isValid))</span>
<a href="#l112.36"></a><span id="l112.36">       return false;</span>
<a href="#l112.37"></a><span id="l112.37"> </span>
<a href="#l112.38"></a><span id="l112.38">     var txmgr = BMSVC.transactionManager;</span>
<a href="#l112.39"></a><span id="l112.39">     txmgr.beginBatch();</span>
<a href="#l112.40"></a><span id="l112.40">     var index = aTarget.index;</span>
<a href="#l112.41"></a><span id="l112.41">     for (var i = 0; i &lt; aSelection.length; ++i) {</span>
<a href="#l112.42"></a><span id="l112.42" class="difflineminus">-      if (isValid[i]) {</span>
<a href="#l112.43"></a><span id="l112.43" class="difflineplus">+      if (canDelete[i]) {</span>
<a href="#l112.44"></a><span id="l112.44">         RDFC.Init(BMDS, aSelection.parent[i]);</span>
<a href="#l112.45"></a><span id="l112.45">         var deleteIndex = RDFC.IndexOf(aSelection.item[i]);</span>
<a href="#l112.46"></a><span id="l112.46">         var deleteTxn = BMSVC.createTransaction(aSelection.parent[i], aSelection.item[i], deleteIndex, true);</span>
<a href="#l112.47"></a><span id="l112.47">         txmgr.doTransaction(deleteTxn);</span>
<a href="#l112.48"></a><span id="l112.48" class="difflineplus">+      }</span>
<a href="#l112.49"></a><span id="l112.49" class="difflineplus">+      if (isValid[i]) {</span>
<a href="#l112.50"></a><span id="l112.50">         var insertTxn = BMSVC.createTransaction(aTarget.parent, aSelection.item[i], index++, false);</span>
<a href="#l112.51"></a><span id="l112.51">         txmgr.doTransaction(insertTxn);</span>
<a href="#l112.52"></a><span id="l112.52">       }</span>
<a href="#l112.53"></a><span id="l112.53">     }</span>
<a href="#l112.54"></a><span id="l112.54">     txmgr.endBatch();</span>
<a href="#l112.55"></a><span id="l112.55">     BookmarksUtils.flushDataSource();</span>
<a href="#l112.56"></a><span id="l112.56">     return true;</span>
<a href="#l112.57"></a><span id="l112.57">   }, </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/suite/common/pref/pref-applications.js</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/suite/common/pref/pref-applications.js</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -1765,21 +1765,23 @@ var gApplicationsPane = {</span>
<a href="#l113.4"></a><span id="l113.4">     // value, then fall back to the generic application icon.</span>
<a href="#l113.5"></a><span id="l113.5">     return null;</span>
<a href="#l113.6"></a><span id="l113.6">   },</span>
<a href="#l113.7"></a><span id="l113.7"> </span>
<a href="#l113.8"></a><span id="l113.8">   _getIconURLForHandlerApp: function(aHandlerApp) {</span>
<a href="#l113.9"></a><span id="l113.9">     if (aHandlerApp instanceof nsILocalHandlerApp)</span>
<a href="#l113.10"></a><span id="l113.10">       return this._getIconURLForFile(aHandlerApp.executable);</span>
<a href="#l113.11"></a><span id="l113.11"> </span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-    if (aHandlerApp instanceof nsIWebHandlerApp)</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l113.14"></a><span id="l113.14" class="difflineplus">+    if (prefSvc.getBoolPref(&quot;browser.chrome.favicons&quot;)) { // q.v. Bug 514671</span>
<a href="#l113.15"></a><span id="l113.15" class="difflineplus">+      if (aHandlerApp instanceof nsIWebHandlerApp)</span>
<a href="#l113.16"></a><span id="l113.16" class="difflineplus">+        return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l113.17"></a><span id="l113.17"> </span>
<a href="#l113.18"></a><span id="l113.18" class="difflineminus">-    if (aHandlerApp instanceof nsIWebContentHandlerInfo)</span>
<a href="#l113.19"></a><span id="l113.19" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uri)</span>
<a href="#l113.20"></a><span id="l113.20" class="difflineplus">+      if (aHandlerApp instanceof nsIWebContentHandlerInfo)</span>
<a href="#l113.21"></a><span id="l113.21" class="difflineplus">+        return this._getIconURLForWebApp(aHandlerApp.uri)</span>
<a href="#l113.22"></a><span id="l113.22" class="difflineplus">+    }</span>
<a href="#l113.23"></a><span id="l113.23"> </span>
<a href="#l113.24"></a><span id="l113.24">     // We know nothing about other kinds of handler apps.</span>
<a href="#l113.25"></a><span id="l113.25">     return &quot;&quot;;</span>
<a href="#l113.26"></a><span id="l113.26">   },</span>
<a href="#l113.27"></a><span id="l113.27"> </span>
<a href="#l113.28"></a><span id="l113.28">   _getIconURLForFile: function(aFile) {</span>
<a href="#l113.29"></a><span id="l113.29">     var fph = ioSvc.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l113.30"></a><span id="l113.30">                    .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/suite/common/pref/pref-scripts.js</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/suite/common/pref/pref-scripts.js</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -17,17 +17,17 @@</span>
<a href="#l114.4"></a><span id="l114.4">  * The Original Code is Mozilla.org Code.</span>
<a href="#l114.5"></a><span id="l114.5">  *</span>
<a href="#l114.6"></a><span id="l114.6">  * The Initial Developer of the Original Code is</span>
<a href="#l114.7"></a><span id="l114.7">  * Doron Rosenberg.</span>
<a href="#l114.8"></a><span id="l114.8">  * Portions created by the Initial Developer are Copyright (C) 2001</span>
<a href="#l114.9"></a><span id="l114.9">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l114.10"></a><span id="l114.10">  *</span>
<a href="#l114.11"></a><span id="l114.11">  * Contributor(s):</span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">- *   Jonas Jrgensen &lt;jonasj@jonasj.dk&gt;</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineplus">+ *   Jonas Jrgensen &lt;jonasj@jonasj.dk&gt;</span>
<a href="#l114.14"></a><span id="l114.14">  *</span>
<a href="#l114.15"></a><span id="l114.15">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l114.16"></a><span id="l114.16">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l114.17"></a><span id="l114.17">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l114.18"></a><span id="l114.18">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l114.19"></a><span id="l114.19">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l114.20"></a><span id="l114.20">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l114.21"></a><span id="l114.21">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l114.22"></a><span id="l114.22" class="difflineat">@@ -51,23 +51,15 @@ function changeDisabledState(state) {</span>
<a href="#l114.23"></a><span id="l114.23">   setDisableState(&quot;allowImageSrcChange&quot;, state);</span>
<a href="#l114.24"></a><span id="l114.24">   setDisableState(&quot;allowWindowStatusChange&quot;, state);</span>
<a href="#l114.25"></a><span id="l114.25">   setDisableState(&quot;allowWindowFlip&quot;, state);</span>
<a href="#l114.26"></a><span id="l114.26">   setDisableState(&quot;allowHideStatusBar&quot;, state);</span>
<a href="#l114.27"></a><span id="l114.27">   setDisableState(&quot;allowContextmenuDisable&quot;, state);</span>
<a href="#l114.28"></a><span id="l114.28"> }</span>
<a href="#l114.29"></a><span id="l114.29"> </span>
<a href="#l114.30"></a><span id="l114.30"> function javascriptEnabledChange() {</span>
<a href="#l114.31"></a><span id="l114.31" class="difflineminus">-  // If javascript.allow.mailnews is overlayed (mailnews is installed),</span>
<a href="#l114.32"></a><span id="l114.32" class="difflineminus">-  // then if javascript.allow.mailnews and javascript.enabled are false,</span>
<a href="#l114.33"></a><span id="l114.33" class="difflineminus">-  // we disable the tree items. If javascript.allow.mailnews is not</span>
<a href="#l114.34"></a><span id="l114.34" class="difflineminus">-  // available, we only take javascript.enabled in consideration.</span>
<a href="#l114.35"></a><span id="l114.35" class="difflineminus">-</span>
<a href="#l114.36"></a><span id="l114.36">   var javascriptDisabled = !document.getElementById('javascript.enabled').value;</span>
<a href="#l114.37"></a><span id="l114.37" class="difflineminus">-  var javascriptAllowMailNews = document.getElementById('javascript.allow.mailnews');</span>
<a href="#l114.38"></a><span id="l114.38" class="difflineminus">-  if (javascriptDisabled &amp;&amp; javascriptAllowMailNews)</span>
<a href="#l114.39"></a><span id="l114.39" class="difflineminus">-    javascriptDisabled = !javascriptAllowMailNews.value;</span>
<a href="#l114.40"></a><span id="l114.40">   changeDisabledState(javascriptDisabled);</span>
<a href="#l114.41"></a><span id="l114.41"> }</span>
<a href="#l114.42"></a><span id="l114.42"> </span>
<a href="#l114.43"></a><span id="l114.43"> function Startup() {</span>
<a href="#l114.44"></a><span id="l114.44">   javascriptEnabledChange();</span>
<a href="#l114.45"></a><span id="l114.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/suite/common/src/nsSuiteGlue.js</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/suite/common/src/nsSuiteGlue.js</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -191,17 +191,17 @@ SuiteGlue.prototype = {</span>
<a href="#l115.4"></a><span id="l115.4">       else</span>
<a href="#l115.5"></a><span id="l115.5">         showPrompt = prefBranch.getBoolPref(&quot;browser.tabs.warnOnClose&quot;);</span>
<a href="#l115.6"></a><span id="l115.6">     } catch (ex) {}</span>
<a href="#l115.7"></a><span id="l115.7"> </span>
<a href="#l115.8"></a><span id="l115.8">     var buttonChoice = 0;</span>
<a href="#l115.9"></a><span id="l115.9">     if (showPrompt) {</span>
<a href="#l115.10"></a><span id="l115.10">       var bundleService = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;].</span>
<a href="#l115.11"></a><span id="l115.11">                           getService(Components.interfaces.nsIStringBundleService);</span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-      var quitBundle = bundleService.createBundle(&quot;chrome://browser/locale/quitDialog.properties&quot;);</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineplus">+      var quitBundle = bundleService.createBundle(&quot;chrome://communicator/locale/quitDialog.properties&quot;);</span>
<a href="#l115.14"></a><span id="l115.14">       var brandBundle = bundleService.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l115.15"></a><span id="l115.15"> </span>
<a href="#l115.16"></a><span id="l115.16">       var appName = brandBundle.GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l115.17"></a><span id="l115.17">       var quitDialogTitle = quitBundle.formatStringFromName(aQuitType + &quot;DialogTitle&quot;,</span>
<a href="#l115.18"></a><span id="l115.18">                                                               [appName], 1);</span>
<a href="#l115.19"></a><span id="l115.19"> </span>
<a href="#l115.20"></a><span id="l115.20">       var message;</span>
<a href="#l115.21"></a><span id="l115.21">       if (aQuitType == &quot;restart&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1">new file mode 100644</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineminus">--- /dev/null</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/quitDialog.properties</span>
<a href="#l116.4"></a><span id="l116.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l116.5"></a><span id="l116.5" class="difflineplus">+quitDialogTitle=Quit %S</span>
<a href="#l116.6"></a><span id="l116.6" class="difflineplus">+restartDialogTitle=Restart %S</span>
<a href="#l116.7"></a><span id="l116.7" class="difflineplus">+</span>
<a href="#l116.8"></a><span id="l116.8" class="difflineplus">+quitTitle=&amp;Quit</span>
<a href="#l116.9"></a><span id="l116.9" class="difflineplus">+restartTitle=&amp;Restart</span>
<a href="#l116.10"></a><span id="l116.10" class="difflineplus">+cancelTitle=&amp;Cancel</span>
<a href="#l116.11"></a><span id="l116.11" class="difflineplus">+saveTitle=&amp;Save and Quit</span>
<a href="#l116.12"></a><span id="l116.12" class="difflineplus">+neverAsk=Do not ask next time</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineplus">+message=Do you want %S to save your tabs and windows for the next time it starts?</span>
<a href="#l116.14"></a><span id="l116.14" class="difflineplus">+messageNoWindows=Do you want %S to save your tabs for the next time it starts?</span>
<a href="#l116.15"></a><span id="l116.15" class="difflineplus">+messageRestart=%S will try to restore your tabs and windows when it restarts.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -1,6 +1,7 @@</span>
<a href="#l117.4"></a><span id="l117.4" class="difflineplus">+&lt;!ENTITY identityDialog.style &quot;width: 67ch;&quot;&gt;</span>
<a href="#l117.5"></a><span id="l117.5"> &lt;!ENTITY identityTitle.label &quot;Identity Settings&quot;&gt;</span>
<a href="#l117.6"></a><span id="l117.6"> &lt;!ENTITY identityListDesc.label &quot;Configure the settings for this identity:&quot;&gt;</span>
<a href="#l117.7"></a><span id="l117.7"> </span>
<a href="#l117.8"></a><span id="l117.8"> &lt;!ENTITY settingsTab.label       &quot;Settings&quot;&gt;</span>
<a href="#l117.9"></a><span id="l117.9"> &lt;!ENTITY copiesFoldersTab.label &quot;Copies &amp;amp; Folders&quot;&gt;</span>
<a href="#l117.10"></a><span id="l117.10"> &lt;!ENTITY addressingTab.label    &quot;Composition &amp;amp; Addressing&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/mailPrefsOverlay.dtd</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/mailPrefsOverlay.dtd</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineat">@@ -1,11 +1,9 @@</span>
<a href="#l118.4"></a><span id="l118.4"> &lt;!-- These are added to the Advanced - Scripts &amp; Plugins panel --&gt;</span>
<a href="#l118.5"></a><span id="l118.5" class="difflineminus">-&lt;!ENTITY enbJsCheckMailNews.label         &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l118.6"></a><span id="l118.6" class="difflineminus">-&lt;!ENTITY enbJsCheckMailNews.accesskey     &quot;M&quot;&gt;</span>
<a href="#l118.7"></a><span id="l118.7"> &lt;!ENTITY enbPluginCheckMailNews.label     &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l118.8"></a><span id="l118.8"> &lt;!ENTITY enbPluginCheckMailNews.accesskey &quot;a&quot;&gt;</span>
<a href="#l118.9"></a><span id="l118.9"> </span>
<a href="#l118.10"></a><span id="l118.10"> &lt;!-- These are added to the Window menu --&gt;</span>
<a href="#l118.11"></a><span id="l118.11"> &lt;!ENTITY mail.label                       &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l118.12"></a><span id="l118.12"> &lt;!ENTITY mail.accesskey                   &quot;M&quot;&gt;</span>
<a href="#l118.13"></a><span id="l118.13"> &lt;!ENTITY addressbook.label                &quot;Address Book&quot;&gt;</span>
<a href="#l118.14"></a><span id="l118.14"> &lt;!ENTITY addressbook.accesskey            &quot;A&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -26,16 +26,17 @@</span>
<a href="#l119.4"></a><span id="l119.4">   locale/@AB_CD@/communicator/defaultClientDialog.dtd                       (%chrome/common/defaultClientDialog.dtd)</span>
<a href="#l119.5"></a><span id="l119.5">   locale/@AB_CD@/communicator/feeds/subscribe.dtd                           (%chrome/common/feeds/subscribe.dtd)</span>
<a href="#l119.6"></a><span id="l119.6">   locale/@AB_CD@/communicator/feeds/subscribe.properties                    (%chrome/common/feeds/subscribe.properties)</span>
<a href="#l119.7"></a><span id="l119.7">   locale/@AB_CD@/communicator/notification.properties                       (%chrome/common/notification.properties)</span>
<a href="#l119.8"></a><span id="l119.8">   locale/@AB_CD@/communicator/openLocation.dtd                              (%chrome/common/openLocation.dtd)</span>
<a href="#l119.9"></a><span id="l119.9">   locale/@AB_CD@/communicator/openLocation.properties                       (%chrome/common/openLocation.properties)</span>
<a href="#l119.10"></a><span id="l119.10">   locale/@AB_CD@/communicator/passwordManager.dtd                           (%chrome/common/passwordManager.dtd)</span>
<a href="#l119.11"></a><span id="l119.11">   locale/@AB_CD@/communicator/printPreview.dtd                              (%chrome/common/printPreview.dtd)</span>
<a href="#l119.12"></a><span id="l119.12" class="difflineplus">+  locale/@AB_CD@/communicator/quitDialog.properties                         (%chrome/common/quitDialog.properties)</span>
<a href="#l119.13"></a><span id="l119.13">   locale/@AB_CD@/communicator/shellservice.properties                       (%chrome/common/shellservice.properties)</span>
<a href="#l119.14"></a><span id="l119.14">   locale/@AB_CD@/communicator/sanitize.dtd                                  (%chrome/common/sanitize.dtd)</span>
<a href="#l119.15"></a><span id="l119.15">   locale/@AB_CD@/communicator/tasksOverlay.dtd                              (%chrome/common/tasksOverlay.dtd)</span>
<a href="#l119.16"></a><span id="l119.16">   locale/@AB_CD@/communicator/typeaheadfind.properties                      (%chrome/common/typeaheadfind.properties)</span>
<a href="#l119.17"></a><span id="l119.17">   locale/@AB_CD@/communicator/utilityOverlay.dtd                            (%chrome/common/utilityOverlay.dtd)</span>
<a href="#l119.18"></a><span id="l119.18">   locale/@AB_CD@/communicator/utilityOverlay.properties                     (%chrome/common/utilityOverlay.properties)</span>
<a href="#l119.19"></a><span id="l119.19">   locale/@AB_CD@/communicator/viewZoomOverlay.dtd                           (%chrome/common/viewZoomOverlay.dtd)</span>
<a href="#l119.20"></a><span id="l119.20">   locale/@AB_CD@/communicator/viewZoomOverlay.properties                    (%chrome/common/viewZoomOverlay.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -88,17 +88,17 @@ const kVcardFields =</span>
<a href="#l120.4"></a><span id="l120.4">           // Other &gt; Notes</span>
<a href="#l120.5"></a><span id="l120.5">          [&quot;Notes&quot;, &quot;Notes&quot;]];</span>
<a href="#l120.6"></a><span id="l120.6"> </span>
<a href="#l120.7"></a><span id="l120.7"> const kDefaultYear = 2000;</span>
<a href="#l120.8"></a><span id="l120.8"> var gEditCard;</span>
<a href="#l120.9"></a><span id="l120.9"> var gOnSaveListeners = new Array();</span>
<a href="#l120.10"></a><span id="l120.10"> var gOkCallback = null;</span>
<a href="#l120.11"></a><span id="l120.11"> var gHideABPicker = false;</span>
<a href="#l120.12"></a><span id="l120.12" class="difflineminus">-var originalPhotoURI = &quot;&quot;;</span>
<a href="#l120.13"></a><span id="l120.13" class="difflineplus">+var gOriginalPhotoURI = &quot;&quot;;</span>
<a href="#l120.14"></a><span id="l120.14"> </span>
<a href="#l120.15"></a><span id="l120.15"> function OnLoadNewCard()</span>
<a href="#l120.16"></a><span id="l120.16"> {</span>
<a href="#l120.17"></a><span id="l120.17">   InitEditCard();</span>
<a href="#l120.18"></a><span id="l120.18"> </span>
<a href="#l120.19"></a><span id="l120.19">   gEditCard.card =</span>
<a href="#l120.20"></a><span id="l120.20">     ((&quot;arguments&quot; in window) &amp;&amp; (window.arguments.length &gt; 0) &amp;&amp;</span>
<a href="#l120.21"></a><span id="l120.21">      (window.arguments[0] instanceof Components.interfaces.nsIAbCard))</span>
<a href="#l120.22"></a><span id="l120.22" class="difflineat">@@ -274,34 +274,33 @@ function OnLoadEditCard()</span>
<a href="#l120.23"></a><span id="l120.23">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0])</span>
<a href="#l120.24"></a><span id="l120.24">   {</span>
<a href="#l120.25"></a><span id="l120.25">     if (&quot;abURI&quot; in window.arguments[0]) {</span>
<a href="#l120.26"></a><span id="l120.26">       var abURI = window.arguments[0].abURI;</span>
<a href="#l120.27"></a><span id="l120.27">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l120.28"></a><span id="l120.28"> </span>
<a href="#l120.29"></a><span id="l120.29">       if (directory.readOnly) </span>
<a href="#l120.30"></a><span id="l120.30">       {</span>
<a href="#l120.31"></a><span id="l120.31" class="difflineminus">-        // Disable the photo field and buttons</span>
<a href="#l120.32"></a><span id="l120.32" class="difflineminus">-        document.getElementById(&quot;generic&quot;).disabled          = true;</span>
<a href="#l120.33"></a><span id="l120.33" class="difflineminus">-        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l120.34"></a><span id="l120.34" class="difflineminus">-        document.getElementById(&quot;file&quot;).disabled             = true;</span>
<a href="#l120.35"></a><span id="l120.35" class="difflineminus">-        document.getElementById(&quot;web&quot;).disabled              = true;</span>
<a href="#l120.36"></a><span id="l120.36" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).readOnly         = true;</span>
<a href="#l120.37"></a><span id="l120.37" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l120.38"></a><span id="l120.38" class="difflineminus">-        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l120.39"></a><span id="l120.39" class="difflineminus">-        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l120.40"></a><span id="l120.40">         // Set all the editable vcard fields to read only</span>
<a href="#l120.41"></a><span id="l120.41">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l120.42"></a><span id="l120.42">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l120.43"></a><span id="l120.43"> </span>
<a href="#l120.44"></a><span id="l120.44">         // the birthday fields</span>
<a href="#l120.45"></a><span id="l120.45">         document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l120.46"></a><span id="l120.46">         document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l120.47"></a><span id="l120.47">         document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l120.48"></a><span id="l120.48"> </span>
<a href="#l120.49"></a><span id="l120.49" class="difflineplus">+        // the photo field and buttons</span>
<a href="#l120.50"></a><span id="l120.50" class="difflineplus">+        document.getElementById(&quot;PhotoType&quot;).disabled        = true;</span>
<a href="#l120.51"></a><span id="l120.51" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l120.52"></a><span id="l120.52" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).disabled         = true;</span>
<a href="#l120.53"></a><span id="l120.53" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l120.54"></a><span id="l120.54" class="difflineplus">+        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l120.55"></a><span id="l120.55" class="difflineplus">+        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l120.56"></a><span id="l120.56" class="difflineplus">+</span>
<a href="#l120.57"></a><span id="l120.57">         // And the phonetic fields</span>
<a href="#l120.58"></a><span id="l120.58">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l120.59"></a><span id="l120.59">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l120.60"></a><span id="l120.60"> </span>
<a href="#l120.61"></a><span id="l120.61">         // Also disable the mail format popup and allow remote content items.</span>
<a href="#l120.62"></a><span id="l120.62">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l120.63"></a><span id="l120.63">         document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l120.64"></a><span id="l120.64"> </span>
<a href="#l120.65"></a><span id="l120.65" class="difflineat">@@ -479,44 +478,42 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l120.66"></a><span id="l120.66">     doc.getElementById(&quot;PhoneticFirstName&quot;).value = cardproperty.getProperty(&quot;PhoneticFirstName&quot;, &quot;&quot;);</span>
<a href="#l120.67"></a><span id="l120.67">     doc.getElementById(&quot;PhoneticLastName&quot;).value = cardproperty.getProperty(&quot;PhoneticLastName&quot;, &quot;&quot;);</span>
<a href="#l120.68"></a><span id="l120.68">   }</span>
<a href="#l120.69"></a><span id="l120.69">   catch (ex) {}</span>
<a href="#l120.70"></a><span id="l120.70"> </span>
<a href="#l120.71"></a><span id="l120.71">   // Store the original photo URI and update the photo</span>
<a href="#l120.72"></a><span id="l120.72">   // Select the type if there is a valid value stored for that type, otherwise</span>
<a href="#l120.73"></a><span id="l120.73">   // select the generic photo</span>
<a href="#l120.74"></a><span id="l120.74" class="difflineminus">-  var type = cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;);</span>
<a href="#l120.75"></a><span id="l120.75" class="difflineminus">-  document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l120.76"></a><span id="l120.76" class="difflineminus">-    document.getElementById(type ? type : &quot;generic&quot;);</span>
<a href="#l120.77"></a><span id="l120.77" class="difflineminus">-  if (type == &quot;file&quot;) {</span>
<a href="#l120.78"></a><span id="l120.78" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l120.79"></a><span id="l120.79" class="difflineminus">-    var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l120.80"></a><span id="l120.80" class="difflineminus">-                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l120.81"></a><span id="l120.81" class="difflineminus">-                         .newURI(originalPhotoURI, null, null)</span>
<a href="#l120.82"></a><span id="l120.82" class="difflineminus">-                         .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l120.83"></a><span id="l120.83" class="difflineminus">-                         .file;</span>
<a href="#l120.84"></a><span id="l120.84" class="difflineminus">-    if (file) {</span>
<a href="#l120.85"></a><span id="l120.85" class="difflineminus">-      document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l120.86"></a><span id="l120.86" class="difflineminus">-      updatePhoto(&quot;file&quot;);</span>
<a href="#l120.87"></a><span id="l120.87" class="difflineminus">-    }</span>
<a href="#l120.88"></a><span id="l120.88" class="difflineminus">-    else</span>
<a href="#l120.89"></a><span id="l120.89" class="difflineplus">+  gOriginalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l120.90"></a><span id="l120.90" class="difflineplus">+  switch (cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;)) {</span>
<a href="#l120.91"></a><span id="l120.91" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l120.92"></a><span id="l120.92" class="difflineplus">+      try {</span>
<a href="#l120.93"></a><span id="l120.93" class="difflineplus">+        var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l120.94"></a><span id="l120.94" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l120.95"></a><span id="l120.95" class="difflineplus">+                             .newURI(gOriginalPhotoURI, null, null)</span>
<a href="#l120.96"></a><span id="l120.96" class="difflineplus">+                             .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l120.97"></a><span id="l120.97" class="difflineplus">+                             .file;</span>
<a href="#l120.98"></a><span id="l120.98" class="difflineplus">+      } catch (e) {}</span>
<a href="#l120.99"></a><span id="l120.99" class="difflineplus">+      if (file) {</span>
<a href="#l120.100"></a><span id="l120.100" class="difflineplus">+        document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l120.101"></a><span id="l120.101" class="difflineplus">+        updatePhoto(&quot;file&quot;);</span>
<a href="#l120.102"></a><span id="l120.102" class="difflineplus">+      }</span>
<a href="#l120.103"></a><span id="l120.103" class="difflineplus">+      else</span>
<a href="#l120.104"></a><span id="l120.104" class="difflineplus">+        updatePhoto(&quot;generic&quot;);</span>
<a href="#l120.105"></a><span id="l120.105" class="difflineplus">+      break;</span>
<a href="#l120.106"></a><span id="l120.106" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l120.107"></a><span id="l120.107" class="difflineplus">+      document.getElementById(&quot;PhotoURI&quot;).value = gOriginalPhotoURI;</span>
<a href="#l120.108"></a><span id="l120.108" class="difflineplus">+      updatePhoto(&quot;web&quot;);</span>
<a href="#l120.109"></a><span id="l120.109" class="difflineplus">+      break;</span>
<a href="#l120.110"></a><span id="l120.110" class="difflineplus">+    default:</span>
<a href="#l120.111"></a><span id="l120.111" class="difflineplus">+      if (gOriginalPhotoURI)</span>
<a href="#l120.112"></a><span id="l120.112" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).value = gOriginalPhotoURI;</span>
<a href="#l120.113"></a><span id="l120.113">       updatePhoto(&quot;generic&quot;);</span>
<a href="#l120.114"></a><span id="l120.114">   }</span>
<a href="#l120.115"></a><span id="l120.115" class="difflineminus">-  else if (type == &quot;web&quot;) {</span>
<a href="#l120.116"></a><span id="l120.116" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l120.117"></a><span id="l120.117" class="difflineminus">-    document.getElementById(&quot;PhotoURI&quot;).value = originalPhotoURI;</span>
<a href="#l120.118"></a><span id="l120.118" class="difflineminus">-    updatePhoto(&quot;web&quot;);</span>
<a href="#l120.119"></a><span id="l120.119" class="difflineminus">-  }</span>
<a href="#l120.120"></a><span id="l120.120" class="difflineminus">-  else {</span>
<a href="#l120.121"></a><span id="l120.121" class="difflineminus">-    originalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l120.122"></a><span id="l120.122" class="difflineminus">-    if (originalPhotoURI)</span>
<a href="#l120.123"></a><span id="l120.123" class="difflineminus">-      document.getElementById(&quot;GenericPhotoList&quot;).value = originalPhotoURI;</span>
<a href="#l120.124"></a><span id="l120.124" class="difflineminus">-    updatePhoto(&quot;generic&quot;);</span>
<a href="#l120.125"></a><span id="l120.125" class="difflineminus">-  }</span>
<a href="#l120.126"></a><span id="l120.126"> }</span>
<a href="#l120.127"></a><span id="l120.127"> </span>
<a href="#l120.128"></a><span id="l120.128"> // when the ab card dialog is being loaded to show a vCard,</span>
<a href="#l120.129"></a><span id="l120.129"> // hide the fields which aren't supported</span>
<a href="#l120.130"></a><span id="l120.130"> // by vCard so the user does not try to edit them.</span>
<a href="#l120.131"></a><span id="l120.131"> function HideNonVcardFields()</span>
<a href="#l120.132"></a><span id="l120.132"> {</span>
<a href="#l120.133"></a><span id="l120.133">   document.getElementById(&quot;homeTabButton&quot;).hidden = true;</span>
<a href="#l120.134"></a><span id="l120.134" class="difflineat">@@ -564,41 +561,46 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l120.135"></a><span id="l120.135"> </span>
<a href="#l120.136"></a><span id="l120.136">   // set phonetic fields if exist</span>
<a href="#l120.137"></a><span id="l120.137">   try {</span>
<a href="#l120.138"></a><span id="l120.138">     cardproperty.setProperty(&quot;PhoneticFirstName&quot;, doc.getElementById(&quot;PhoneticFirstName&quot;).value);</span>
<a href="#l120.139"></a><span id="l120.139">     cardproperty.setProperty(&quot;PhoneticLastName&quot;, doc.getElementById(&quot;PhoneticLastName&quot;).value);</span>
<a href="#l120.140"></a><span id="l120.140">   }</span>
<a href="#l120.141"></a><span id="l120.141">   catch (ex) {}</span>
<a href="#l120.142"></a><span id="l120.142"> </span>
<a href="#l120.143"></a><span id="l120.143" class="difflineminus">-  var type = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l120.144"></a><span id="l120.144" class="difflineminus">-  var photoURI = originalPhotoURI;</span>
<a href="#l120.145"></a><span id="l120.145" class="difflineplus">+  var type = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l120.146"></a><span id="l120.146" class="difflineplus">+  var photoURI = gOriginalPhotoURI;</span>
<a href="#l120.147"></a><span id="l120.147">   if (type == &quot;file&quot; &amp;&amp; document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l120.148"></a><span id="l120.148" class="difflineminus">-    photoURI = &quot;file://&quot; + document.getElementById(&quot;PhotoFile&quot;).file.path;</span>
<a href="#l120.149"></a><span id="l120.149" class="difflineplus">+    photoURI = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l120.150"></a><span id="l120.150" class="difflineplus">+                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l120.151"></a><span id="l120.151" class="difflineplus">+                         .newFileURI(document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l120.152"></a><span id="l120.152" class="difflineplus">+                         .spec;</span>
<a href="#l120.153"></a><span id="l120.153">   else if (type == &quot;web&quot; &amp;&amp; document.getElementById(&quot;PhotoURI&quot;).value)</span>
<a href="#l120.154"></a><span id="l120.154">     photoURI = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l120.155"></a><span id="l120.155">   else {</span>
<a href="#l120.156"></a><span id="l120.156">     type = &quot;generic&quot;;</span>
<a href="#l120.157"></a><span id="l120.157">     photoURI = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l120.158"></a><span id="l120.158">   }</span>
<a href="#l120.159"></a><span id="l120.159" class="difflineminus">-  if (photoURI != originalPhotoURI) {</span>
<a href="#l120.160"></a><span id="l120.160" class="difflineplus">+  cardproperty.setProperty(&quot;PhotoType&quot;, type);</span>
<a href="#l120.161"></a><span id="l120.161" class="difflineplus">+  if (photoURI != gOriginalPhotoURI) {</span>
<a href="#l120.162"></a><span id="l120.162">     // Store the original URI</span>
<a href="#l120.163"></a><span id="l120.163">     cardproperty.setProperty(&quot;PhotoURI&quot;, photoURI);</span>
<a href="#l120.164"></a><span id="l120.164" class="difflineminus">-    // Remove the original, if any</span>
<a href="#l120.165"></a><span id="l120.165" class="difflineminus">-    removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l120.166"></a><span id="l120.166">     // Save the photo if it isn't one of the generic photos</span>
<a href="#l120.167"></a><span id="l120.167" class="difflineminus">-    if (type != &quot;generic&quot;) {</span>
<a href="#l120.168"></a><span id="l120.168" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;file&quot;);</span>
<a href="#l120.169"></a><span id="l120.169" class="difflineplus">+    if (type == &quot;generic&quot;) {</span>
<a href="#l120.170"></a><span id="l120.170" class="difflineplus">+      // Remove the original, if any</span>
<a href="#l120.171"></a><span id="l120.171" class="difflineplus">+      removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l120.172"></a><span id="l120.172" class="difflineplus">+    } else {</span>
<a href="#l120.173"></a><span id="l120.173">       // Save the new file and store its URI as PhotoName </span>
<a href="#l120.174"></a><span id="l120.174">       var file = savePhoto(photoURI);</span>
<a href="#l120.175"></a><span id="l120.175" class="difflineminus">-      if (file)</span>
<a href="#l120.176"></a><span id="l120.176" class="difflineplus">+      if (file) {</span>
<a href="#l120.177"></a><span id="l120.177" class="difflineplus">+        // Remove the original, if any</span>
<a href="#l120.178"></a><span id="l120.178" class="difflineplus">+        removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l120.179"></a><span id="l120.179">         cardproperty.setProperty(&quot;PhotoName&quot;, file.leafName);</span>
<a href="#l120.180"></a><span id="l120.180" class="difflineplus">+      }</span>
<a href="#l120.181"></a><span id="l120.181">     }</span>
<a href="#l120.182"></a><span id="l120.182" class="difflineminus">-    else</span>
<a href="#l120.183"></a><span id="l120.183" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;generic&quot;);</span>
<a href="#l120.184"></a><span id="l120.184">   }</span>
<a href="#l120.185"></a><span id="l120.185"> </span>
<a href="#l120.186"></a><span id="l120.186">   return true;</span>
<a href="#l120.187"></a><span id="l120.187"> }</span>
<a href="#l120.188"></a><span id="l120.188"> </span>
<a href="#l120.189"></a><span id="l120.189"> function CleanUpWebPage(webPage)</span>
<a href="#l120.190"></a><span id="l120.190"> {</span>
<a href="#l120.191"></a><span id="l120.191">   // no :// yet so we should add something</span>
<a href="#l120.192"></a><span id="l120.192" class="difflineat">@@ -898,35 +900,38 @@ function modifyDatepicker(aDatepicker) {</span>
<a href="#l120.193"></a><span id="l120.193">  * Updates the photo by setting the src attribute of the photo element.</span>
<a href="#l120.194"></a><span id="l120.194">  *</span>
<a href="#l120.195"></a><span id="l120.195">  * @param aType Optional. The type of photo (web, file, or generic).</span>
<a href="#l120.196"></a><span id="l120.196">  *              If supplied the corresponding radio button will be selected.</span>
<a href="#l120.197"></a><span id="l120.197">  *              If not supplied the type will be determined by the currently</span>
<a href="#l120.198"></a><span id="l120.198">  *              selected type.</span>
<a href="#l120.199"></a><span id="l120.199">  */</span>
<a href="#l120.200"></a><span id="l120.200"> function updatePhoto(aType) {</span>
<a href="#l120.201"></a><span id="l120.201" class="difflineminus">-  if (aType) {</span>
<a href="#l120.202"></a><span id="l120.202" class="difflineplus">+  if (aType)</span>
<a href="#l120.203"></a><span id="l120.203">     // Select the type's radio button</span>
<a href="#l120.204"></a><span id="l120.204" class="difflineminus">-    document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l120.205"></a><span id="l120.205" class="difflineminus">-      document.getElementById(aType);</span>
<a href="#l120.206"></a><span id="l120.206" class="difflineminus">-  }</span>
<a href="#l120.207"></a><span id="l120.207" class="difflineplus">+    document.getElementById(&quot;PhotoType&quot;).value = aType;</span>
<a href="#l120.208"></a><span id="l120.208">   else</span>
<a href="#l120.209"></a><span id="l120.209" class="difflineminus">-    aType = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l120.210"></a><span id="l120.210" class="difflineplus">+    aType = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l120.211"></a><span id="l120.211"> </span>
<a href="#l120.212"></a><span id="l120.212">   var value;</span>
<a href="#l120.213"></a><span id="l120.213" class="difflineminus">-  if (aType == &quot;file&quot;) {</span>
<a href="#l120.214"></a><span id="l120.214" class="difflineminus">-    var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l120.215"></a><span id="l120.215" class="difflineminus">-    value = file ? &quot;file://&quot; + file.path : &quot;&quot;;</span>
<a href="#l120.216"></a><span id="l120.216" class="difflineplus">+  switch (aType) {</span>
<a href="#l120.217"></a><span id="l120.217" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l120.218"></a><span id="l120.218" class="difflineplus">+      var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l120.219"></a><span id="l120.219" class="difflineplus">+      value = file ? Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l120.220"></a><span id="l120.220" class="difflineplus">+                               .getService(Components.interfaces.nsIIOService)</span>
<a href="#l120.221"></a><span id="l120.221" class="difflineplus">+                               .newFileURI(file)</span>
<a href="#l120.222"></a><span id="l120.222" class="difflineplus">+                               .spec : &quot;&quot;;</span>
<a href="#l120.223"></a><span id="l120.223" class="difflineplus">+      break;</span>
<a href="#l120.224"></a><span id="l120.224" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l120.225"></a><span id="l120.225" class="difflineplus">+      value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l120.226"></a><span id="l120.226" class="difflineplus">+      break;</span>
<a href="#l120.227"></a><span id="l120.227" class="difflineplus">+    default:</span>
<a href="#l120.228"></a><span id="l120.228" class="difflineplus">+      value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l120.229"></a><span id="l120.229">   }</span>
<a href="#l120.230"></a><span id="l120.230" class="difflineminus">-  else if (aType == &quot;web&quot;)</span>
<a href="#l120.231"></a><span id="l120.231" class="difflineminus">-    value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l120.232"></a><span id="l120.232" class="difflineminus">-  else</span>
<a href="#l120.233"></a><span id="l120.233" class="difflineminus">-    value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l120.234"></a><span id="l120.234" class="difflineminus">-  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value ? value</span>
<a href="#l120.235"></a><span id="l120.235" class="difflineminus">-                                                             : defaultPhotoURI);</span>
<a href="#l120.236"></a><span id="l120.236" class="difflineplus">+  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value || defaultPhotoURI);</span>
<a href="#l120.237"></a><span id="l120.237"> }</span>
<a href="#l120.238"></a><span id="l120.238"> </span>
<a href="#l120.239"></a><span id="l120.239"> /**</span>
<a href="#l120.240"></a><span id="l120.240">  * Removes the photo file at the given path, if present.</span>
<a href="#l120.241"></a><span id="l120.241">  *</span>
<a href="#l120.242"></a><span id="l120.242">  * @param aName The name of the photo to remove from the Photos directory.</span>
<a href="#l120.243"></a><span id="l120.243">  *</span>
<a href="#l120.244"></a><span id="l120.244">  * @return true if the file was deleted.</span>
<a href="#l120.245"></a><span id="l120.245" class="difflineat">@@ -934,27 +939,20 @@ function updatePhoto(aType) {</span>
<a href="#l120.246"></a><span id="l120.246"> function removePhoto(aName) {</span>
<a href="#l120.247"></a><span id="l120.247">   if (!aName)</span>
<a href="#l120.248"></a><span id="l120.248">     return false;</span>
<a href="#l120.249"></a><span id="l120.249">   // Get the directory with all the photos</span>
<a href="#l120.250"></a><span id="l120.250">   var file = getPhotosDir();</span>
<a href="#l120.251"></a><span id="l120.251">   // Get the photo (throws an exception for invalid names)</span>
<a href="#l120.252"></a><span id="l120.252">   try {</span>
<a href="#l120.253"></a><span id="l120.253">     file.append(aName);</span>
<a href="#l120.254"></a><span id="l120.254" class="difflineminus">-  }</span>
<a href="#l120.255"></a><span id="l120.255" class="difflineminus">-  catch (e) {</span>
<a href="#l120.256"></a><span id="l120.256" class="difflineminus">-    return false;</span>
<a href="#l120.257"></a><span id="l120.257" class="difflineplus">+    file.remove(false);</span>
<a href="#l120.258"></a><span id="l120.258" class="difflineplus">+    return true;</span>
<a href="#l120.259"></a><span id="l120.259">   }</span>
<a href="#l120.260"></a><span id="l120.260" class="difflineminus">-  if (file.exists()) {</span>
<a href="#l120.261"></a><span id="l120.261" class="difflineminus">-    try {</span>
<a href="#l120.262"></a><span id="l120.262" class="difflineminus">-      file.remove(false);</span>
<a href="#l120.263"></a><span id="l120.263" class="difflineminus">-      return true;</span>
<a href="#l120.264"></a><span id="l120.264" class="difflineminus">-    }</span>
<a href="#l120.265"></a><span id="l120.265" class="difflineminus">-    catch (e) {}</span>
<a href="#l120.266"></a><span id="l120.266" class="difflineminus">-  }</span>
<a href="#l120.267"></a><span id="l120.267" class="difflineplus">+  catch (e) {}</span>
<a href="#l120.268"></a><span id="l120.268">   return false;</span>
<a href="#l120.269"></a><span id="l120.269"> }</span>
<a href="#l120.270"></a><span id="l120.270"> </span>
<a href="#l120.271"></a><span id="l120.271"> /**</span>
<a href="#l120.272"></a><span id="l120.272">  * Opens a file picker with image filters to look for a contact photo.</span>
<a href="#l120.273"></a><span id="l120.273">  * If the user selects a file and clicks OK then the PhotoURI textbox is set</span>
<a href="#l120.274"></a><span id="l120.274">  * with a file URI pointing to that file and updatePhoto is called.</span>
<a href="#l120.275"></a><span id="l120.275">  *</span>
<a href="#l120.276"></a><span id="l120.276" class="difflineat">@@ -962,18 +960,18 @@ function removePhoto(aName) {</span>
<a href="#l120.277"></a><span id="l120.277">  */</span>
<a href="#l120.278"></a><span id="l120.278"> function browsePhoto() {</span>
<a href="#l120.279"></a><span id="l120.279">   var nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l120.280"></a><span id="l120.280">   var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l120.281"></a><span id="l120.281"> 	                   .createInstance(nsIFilePicker);</span>
<a href="#l120.282"></a><span id="l120.282">   fp.init(window, gAddressBookBundle.getString(&quot;browsePhoto&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l120.283"></a><span id="l120.283">   </span>
<a href="#l120.284"></a><span id="l120.284">   // Add All Files &amp; Image Files filters and select the latter</span>
<a href="#l120.285"></a><span id="l120.285" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterAll | nsIFilePicker.filterImages);</span>
<a href="#l120.286"></a><span id="l120.286" class="difflineminus">-  fp.filterIndex = 1;</span>
<a href="#l120.287"></a><span id="l120.287" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l120.288"></a><span id="l120.288" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l120.289"></a><span id="l120.289"> </span>
<a href="#l120.290"></a><span id="l120.290">   if (fp.show() == nsIFilePicker.returnOK) {</span>
<a href="#l120.291"></a><span id="l120.291">     document.getElementById(&quot;PhotoFile&quot;).file = fp.file;</span>
<a href="#l120.292"></a><span id="l120.292">     updatePhoto(&quot;file&quot;);</span>
<a href="#l120.293"></a><span id="l120.293">     return true;</span>
<a href="#l120.294"></a><span id="l120.294">   }</span>
<a href="#l120.295"></a><span id="l120.295">   return false;</span>
<a href="#l120.296"></a><span id="l120.296"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCommon.js</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCommon.js</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -729,68 +729,56 @@ function savePhoto(aUri) {</span>
<a href="#l121.4"></a><span id="l121.4"> </span>
<a href="#l121.5"></a><span id="l121.5">   // Create a channel from the URI and open it as an input stream</span>
<a href="#l121.6"></a><span id="l121.6">   var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l121.7"></a><span id="l121.7">                       .getService(Components.interfaces.nsIIOService);</span>
<a href="#l121.8"></a><span id="l121.8">   var channel = ios.newChannelFromURI(ios.newURI(aUri, null, null));</span>
<a href="#l121.9"></a><span id="l121.9">   var istream = channel.open();</span>
<a href="#l121.10"></a><span id="l121.10"> </span>
<a href="#l121.11"></a><span id="l121.11">   // Get the photo file</span>
<a href="#l121.12"></a><span id="l121.12" class="difflineminus">-  file.append(makePhotoFilename(file.path, findPhotoExt(aUri, channel)));</span>
<a href="#l121.13"></a><span id="l121.13" class="difflineplus">+  file = makePhotoFile(file, findPhotoExt(channel));</span>
<a href="#l121.14"></a><span id="l121.14"> </span>
<a href="#l121.15"></a><span id="l121.15">   return saveStreamToFile(istream, file);</span>
<a href="#l121.16"></a><span id="l121.16"> }</span>
<a href="#l121.17"></a><span id="l121.17"> </span>
<a href="#l121.18"></a><span id="l121.18"> /**</span>
<a href="#l121.19"></a><span id="l121.19">  * Finds the file extension of the photo identified by the URI, if possible.</span>
<a href="#l121.20"></a><span id="l121.20">  * This function can be overridden (with a copy of the original) for URIs that</span>
<a href="#l121.21"></a><span id="l121.21">  * do not identify the extension or when the Content-Type response header is</span>
<a href="#l121.22"></a><span id="l121.22">  * either not set or isn't 'image/png', 'image/jpeg', or 'image/gif'.</span>
<a href="#l121.23"></a><span id="l121.23">  * The original function can be called if the URI does not match.</span>
<a href="#l121.24"></a><span id="l121.24">  *</span>
<a href="#l121.25"></a><span id="l121.25">  * @param aUri The URI of the photo.</span>
<a href="#l121.26"></a><span id="l121.26">  * @param aChannel The opened channel for the URI.</span>
<a href="#l121.27"></a><span id="l121.27">  *</span>
<a href="#l121.28"></a><span id="l121.28">  * @return The extension of the file, if any, including the period.</span>
<a href="#l121.29"></a><span id="l121.29">  */</span>
<a href="#l121.30"></a><span id="l121.30" class="difflineminus">-function findPhotoExt(aUri, aChannel) {</span>
<a href="#l121.31"></a><span id="l121.31" class="difflineminus">-  if (aChannel) {</span>
<a href="#l121.32"></a><span id="l121.32" class="difflineminus">-    try {</span>
<a href="#l121.33"></a><span id="l121.33" class="difflineminus">-      aChannel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l121.34"></a><span id="l121.34" class="difflineminus">-      var header = aChannel.getResponseHeader(&quot;Content-Type&quot;);</span>
<a href="#l121.35"></a><span id="l121.35" class="difflineminus">-      var type   = header ? header.split(&quot;;&quot;)[0] : &quot;&quot;;</span>
<a href="#l121.36"></a><span id="l121.36" class="difflineminus">-      switch (type.toLowerCase()) {</span>
<a href="#l121.37"></a><span id="l121.37" class="difflineminus">-        case &quot;image/png&quot;:</span>
<a href="#l121.38"></a><span id="l121.38" class="difflineminus">-          return &quot;.png&quot;;</span>
<a href="#l121.39"></a><span id="l121.39" class="difflineminus">-        case &quot;image/jpeg&quot;:</span>
<a href="#l121.40"></a><span id="l121.40" class="difflineminus">-          return &quot;.jpg&quot;;</span>
<a href="#l121.41"></a><span id="l121.41" class="difflineminus">-        case &quot;image/gif&quot;:</span>
<a href="#l121.42"></a><span id="l121.42" class="difflineminus">-          return &quot;.gif&quot;;</span>
<a href="#l121.43"></a><span id="l121.43" class="difflineminus">-      }</span>
<a href="#l121.44"></a><span id="l121.44" class="difflineminus">-    } catch (e) {}</span>
<a href="#l121.45"></a><span id="l121.45" class="difflineminus">-  }</span>
<a href="#l121.46"></a><span id="l121.46" class="difflineminus">-</span>
<a href="#l121.47"></a><span id="l121.47" class="difflineminus">-  var index = aUri ? aUri.lastIndexOf(&quot;.&quot;) : -1;</span>
<a href="#l121.48"></a><span id="l121.48" class="difflineminus">-  if (index == -1)</span>
<a href="#l121.49"></a><span id="l121.49" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l121.50"></a><span id="l121.50" class="difflineminus">-   return aUri.substring(index);</span>
<a href="#l121.51"></a><span id="l121.51" class="difflineplus">+function findPhotoExt(aChannel) {</span>
<a href="#l121.52"></a><span id="l121.52" class="difflineplus">+  var mimeSvc = Components.classes[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l121.53"></a><span id="l121.53" class="difflineplus">+                          .getService(Components.interfaces.nsIMIMEService);</span>
<a href="#l121.54"></a><span id="l121.54" class="difflineplus">+  var ext = &quot;&quot;;</span>
<a href="#l121.55"></a><span id="l121.55" class="difflineplus">+  var uri = aChannel.URI;</span>
<a href="#l121.56"></a><span id="l121.56" class="difflineplus">+  if (uri instanceof Components.interfaces.nsIURL)</span>
<a href="#l121.57"></a><span id="l121.57" class="difflineplus">+    ext = uri.fileExtension;</span>
<a href="#l121.58"></a><span id="l121.58" class="difflineplus">+  try {</span>
<a href="#l121.59"></a><span id="l121.59" class="difflineplus">+    return mimeSvc.getPrimaryExtension(aChannel.contentType, ext);</span>
<a href="#l121.60"></a><span id="l121.60" class="difflineplus">+  } catch (e) {}</span>
<a href="#l121.61"></a><span id="l121.61" class="difflineplus">+  return ext;</span>
<a href="#l121.62"></a><span id="l121.62"> }</span>
<a href="#l121.63"></a><span id="l121.63"> </span>
<a href="#l121.64"></a><span id="l121.64"> /**</span>
<a href="#l121.65"></a><span id="l121.65">  * Generates a unique filename to be used for a local copy of a contact's photo.</span>
<a href="#l121.66"></a><span id="l121.66">  *</span>
<a href="#l121.67"></a><span id="l121.67">  * @param aPath      The path to the folder in which the photo will be saved.</span>
<a href="#l121.68"></a><span id="l121.68">  * @param aExtension The file extension of the photo.</span>
<a href="#l121.69"></a><span id="l121.69">  *</span>
<a href="#l121.70"></a><span id="l121.70">  * @return A unique filename in the given path.</span>
<a href="#l121.71"></a><span id="l121.71">  */</span>
<a href="#l121.72"></a><span id="l121.72" class="difflineminus">-function makePhotoFilename(aPath, aExtension) {</span>
<a href="#l121.73"></a><span id="l121.73" class="difflineplus">+function makePhotoFile(aDir, aExtension) {</span>
<a href="#l121.74"></a><span id="l121.74">   var filename, newFile;</span>
<a href="#l121.75"></a><span id="l121.75">   // Find a random filename for the photo that doesn't exist yet</span>
<a href="#l121.76"></a><span id="l121.76">   do {</span>
<a href="#l121.77"></a><span id="l121.77" class="difflineminus">-    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + aExtension;</span>
<a href="#l121.78"></a><span id="l121.78" class="difflineminus">-    newFile = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l121.79"></a><span id="l121.79" class="difflineminus">-                        .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l121.80"></a><span id="l121.80" class="difflineminus">-    newFile.initWithPath(aPath);</span>
<a href="#l121.81"></a><span id="l121.81" class="difflineplus">+    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + &quot;.&quot; + aExtension;</span>
<a href="#l121.82"></a><span id="l121.82" class="difflineplus">+    newFile = aDir.clone();</span>
<a href="#l121.83"></a><span id="l121.83">     newFile.append(filename);</span>
<a href="#l121.84"></a><span id="l121.84">   } while (newFile.exists());</span>
<a href="#l121.85"></a><span id="l121.85" class="difflineminus">-  return filename;</span>
<a href="#l121.86"></a><span id="l121.86" class="difflineplus">+  return newFile;</span>
<a href="#l121.87"></a><span id="l121.87"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -180,16 +180,17 @@ var DefaultController =</span>
<a href="#l122.4"></a><span id="l122.4">       case &quot;button_goForward&quot;:</span>
<a href="#l122.5"></a><span id="l122.5">       case &quot;cmd_goForward&quot;:</span>
<a href="#l122.6"></a><span id="l122.6">       case &quot;cmd_goStartPage&quot;:</span>
<a href="#l122.7"></a><span id="l122.7"> 			case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l122.8"></a><span id="l122.8"> 			case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l122.9"></a><span id="l122.9">       case &quot;cmd_viewThreadsWithUnread&quot;:</span>
<a href="#l122.10"></a><span id="l122.10">       case &quot;cmd_viewWatchedThreadsWithUnread&quot;:</span>
<a href="#l122.11"></a><span id="l122.11">       case &quot;cmd_viewIgnoredThreads&quot;:</span>
<a href="#l122.12"></a><span id="l122.12" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l122.13"></a><span id="l122.13">       case &quot;cmd_undo&quot;:</span>
<a href="#l122.14"></a><span id="l122.14">       case &quot;cmd_redo&quot;:</span>
<a href="#l122.15"></a><span id="l122.15"> 			case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l122.16"></a><span id="l122.16"> 			case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l122.17"></a><span id="l122.17"> 			case &quot;cmd_renameFolder&quot;:</span>
<a href="#l122.18"></a><span id="l122.18"> 			case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l122.19"></a><span id="l122.19"> 			case &quot;cmd_openMessage&quot;:</span>
<a href="#l122.20"></a><span id="l122.20">       case &quot;button_print&quot;:</span>
<a href="#l122.21"></a><span id="l122.21" class="difflineat">@@ -341,21 +342,30 @@ var DefaultController =</span>
<a href="#l122.22"></a><span id="l122.22">         return true;</span>
<a href="#l122.23"></a><span id="l122.23">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l122.24"></a><span id="l122.24">       case &quot;button_file&quot;:</span>
<a href="#l122.25"></a><span id="l122.25">       case &quot;cmd_file&quot;:</span>
<a href="#l122.26"></a><span id="l122.26">       case &quot;cmd_archive&quot;:</span>
<a href="#l122.27"></a><span id="l122.27">         return (GetNumSelectedMessages() &gt; 0);</span>
<a href="#l122.28"></a><span id="l122.28">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l122.29"></a><span id="l122.29">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l122.30"></a><span id="l122.30" class="difflineminus">-        // can't do news on junk yet.</span>
<a href="#l122.31"></a><span id="l122.31" class="difflineminus">-        return (GetNumSelectedMessages() &gt; 0 &amp;&amp; !isNewsURI(GetFirstSelectedMessage()));</span>
<a href="#l122.32"></a><span id="l122.32" class="difflineplus">+        if (gDBView)</span>
<a href="#l122.33"></a><span id="l122.33" class="difflineplus">+          gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l122.34"></a><span id="l122.34" class="difflineplus">+        return enabled.value;</span>
<a href="#l122.35"></a><span id="l122.35">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l122.36"></a><span id="l122.36" class="difflineminus">-        if (GetNumSelectedMessages() &gt; 0)</span>
<a href="#l122.37"></a><span id="l122.37" class="difflineplus">+        // We're going to take a conservative position here, because we really</span>
<a href="#l122.38"></a><span id="l122.38" class="difflineplus">+        // don't want people running junk controls on folders that are not</span>
<a href="#l122.39"></a><span id="l122.39" class="difflineplus">+        // enabled for junk. The junk type picks up possible dummy message headers,</span>
<a href="#l122.40"></a><span id="l122.40" class="difflineplus">+        // while the runJunkControls will prevent running on XF virtual folders.</span>
<a href="#l122.41"></a><span id="l122.41" class="difflineplus">+        if (gDBView)</span>
<a href="#l122.42"></a><span id="l122.42" class="difflineplus">+        {</span>
<a href="#l122.43"></a><span id="l122.43">           gDBView.getCommandStatus(nsMsgViewCommandType.runJunkControls, enabled, checkStatus);</span>
<a href="#l122.44"></a><span id="l122.44" class="difflineplus">+          if (enabled.value)</span>
<a href="#l122.45"></a><span id="l122.45" class="difflineplus">+            gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l122.46"></a><span id="l122.46" class="difflineplus">+        }</span>
<a href="#l122.47"></a><span id="l122.47">         return enabled.value;</span>
<a href="#l122.48"></a><span id="l122.48">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l122.49"></a><span id="l122.49">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;remoteContentPolicy&quot;, kAllowRemoteContent));</span>
<a href="#l122.50"></a><span id="l122.50">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l122.51"></a><span id="l122.51">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;notAPhishMessage&quot;, kNotAPhishMessage));</span>
<a href="#l122.52"></a><span id="l122.52">       case &quot;cmd_displayMsgFilters&quot;:</span>
<a href="#l122.53"></a><span id="l122.53">         let mgr = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l122.54"></a><span id="l122.54">                             .getService(Components.interfaces.nsIMsgAccountManager);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/suite/mailnews/messageWindow.js</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/suite/mailnews/messageWindow.js</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -296,16 +296,47 @@ function OnLoadMessageWindow()</span>
<a href="#l123.4"></a><span id="l123.4">   var mailToolbox = getMailToolbox();</span>
<a href="#l123.5"></a><span id="l123.5">   mailToolbox.customizeInit = MailToolboxCustomizeInit;</span>
<a href="#l123.6"></a><span id="l123.6">   mailToolbox.customizeDone = MailToolboxCustomizeDone;</span>
<a href="#l123.7"></a><span id="l123.7">   mailToolbox.customizeChange = MailToolboxCustomizeChange;</span>
<a href="#l123.8"></a><span id="l123.8"> </span>
<a href="#l123.9"></a><span id="l123.9">   setTimeout(OnLoadMessageWindowDelayed, 0, loadCustomMessage);</span>
<a href="#l123.10"></a><span id="l123.10"> </span>
<a href="#l123.11"></a><span id="l123.11">   SetupCommandUpdateHandlers();</span>
<a href="#l123.12"></a><span id="l123.12" class="difflineplus">+</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineplus">+  window.addEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l123.14"></a><span id="l123.14" class="difflineplus">+}</span>
<a href="#l123.15"></a><span id="l123.15" class="difflineplus">+</span>
<a href="#l123.16"></a><span id="l123.16" class="difflineplus">+function HandleAppCommandEvent(evt)</span>
<a href="#l123.17"></a><span id="l123.17" class="difflineplus">+{</span>
<a href="#l123.18"></a><span id="l123.18" class="difflineplus">+  evt.stopPropagation();</span>
<a href="#l123.19"></a><span id="l123.19" class="difflineplus">+  switch (evt.command)</span>
<a href="#l123.20"></a><span id="l123.20" class="difflineplus">+  {</span>
<a href="#l123.21"></a><span id="l123.21" class="difflineplus">+    case &quot;Back&quot;:</span>
<a href="#l123.22"></a><span id="l123.22" class="difflineplus">+      goDoCommand('cmd_goBack');</span>
<a href="#l123.23"></a><span id="l123.23" class="difflineplus">+      break;</span>
<a href="#l123.24"></a><span id="l123.24" class="difflineplus">+    case &quot;Forward&quot;:</span>
<a href="#l123.25"></a><span id="l123.25" class="difflineplus">+      goDoCommand('cmd_goForward');</span>
<a href="#l123.26"></a><span id="l123.26" class="difflineplus">+      break;</span>
<a href="#l123.27"></a><span id="l123.27" class="difflineplus">+    case &quot;Stop&quot;:</span>
<a href="#l123.28"></a><span id="l123.28" class="difflineplus">+      goDoCommand('cmd_stop');</span>
<a href="#l123.29"></a><span id="l123.29" class="difflineplus">+      break;</span>
<a href="#l123.30"></a><span id="l123.30" class="difflineplus">+    case &quot;Search&quot;:</span>
<a href="#l123.31"></a><span id="l123.31" class="difflineplus">+      goDoCommand('cmd_search');</span>
<a href="#l123.32"></a><span id="l123.32" class="difflineplus">+      break;</span>
<a href="#l123.33"></a><span id="l123.33" class="difflineplus">+    case &quot;Bookmarks&quot;:</span>
<a href="#l123.34"></a><span id="l123.34" class="difflineplus">+      toAddressBook();</span>
<a href="#l123.35"></a><span id="l123.35" class="difflineplus">+      break;</span>
<a href="#l123.36"></a><span id="l123.36" class="difflineplus">+    case &quot;Reload&quot;:</span>
<a href="#l123.37"></a><span id="l123.37" class="difflineplus">+      goDoCommand('cmd_reload');</span>
<a href="#l123.38"></a><span id="l123.38" class="difflineplus">+      break;</span>
<a href="#l123.39"></a><span id="l123.39" class="difflineplus">+    case &quot;Home&quot;:</span>
<a href="#l123.40"></a><span id="l123.40" class="difflineplus">+    default:</span>
<a href="#l123.41"></a><span id="l123.41" class="difflineplus">+      break;</span>
<a href="#l123.42"></a><span id="l123.42" class="difflineplus">+  }</span>
<a href="#l123.43"></a><span id="l123.43"> }</span>
<a href="#l123.44"></a><span id="l123.44"> </span>
<a href="#l123.45"></a><span id="l123.45"> function OnLoadMessageWindowDelayed(loadCustomMessage)</span>
<a href="#l123.46"></a><span id="l123.46"> {</span>
<a href="#l123.47"></a><span id="l123.47">   gDBView.suppressMsgDisplay = false;</span>
<a href="#l123.48"></a><span id="l123.48">   if (loadCustomMessage)</span>
<a href="#l123.49"></a><span id="l123.49">     gDBView.loadMessageByUrl(gCurrentMessageUri);</span>
<a href="#l123.50"></a><span id="l123.50">   else</span>
<a href="#l123.51"></a><span id="l123.51" class="difflineat">@@ -391,16 +422,18 @@ function extractMsgKeyFromURI()</span>
<a href="#l123.52"></a><span id="l123.52">   var msgHdr = messenger.msgHdrFromURI(gCurrentMessageUri);</span>
<a href="#l123.53"></a><span id="l123.53">   if (msgHdr)</span>
<a href="#l123.54"></a><span id="l123.54">     msgKey = msgHdr.messageKey;</span>
<a href="#l123.55"></a><span id="l123.55">   return msgKey;</span>
<a href="#l123.56"></a><span id="l123.56"> }</span>
<a href="#l123.57"></a><span id="l123.57"> </span>
<a href="#l123.58"></a><span id="l123.58"> function OnUnloadMessageWindow()</span>
<a href="#l123.59"></a><span id="l123.59"> {</span>
<a href="#l123.60"></a><span id="l123.60" class="difflineplus">+  window.removeEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l123.61"></a><span id="l123.61" class="difflineplus">+</span>
<a href="#l123.62"></a><span id="l123.62">   UnloadCommandUpdateHandlers();</span>
<a href="#l123.63"></a><span id="l123.63"> </span>
<a href="#l123.64"></a><span id="l123.64">   // FIX ME - later we will be able to use onunload from the overlay</span>
<a href="#l123.65"></a><span id="l123.65">   OnUnloadMsgHeaderPane();</span>
<a href="#l123.66"></a><span id="l123.66"> </span>
<a href="#l123.67"></a><span id="l123.67">   OnMailWindowUnload();</span>
<a href="#l123.68"></a><span id="l123.68"> }</span>
<a href="#l123.69"></a><span id="l123.69"> </span>
<a href="#l123.70"></a><span id="l123.70" class="difflineat">@@ -556,16 +589,17 @@ function ReloadMessage()</span>
<a href="#l123.71"></a><span id="l123.71"> // MessageWindowController object (handles commands when one of the trees does not have focus)</span>
<a href="#l123.72"></a><span id="l123.72"> var MessageWindowController =</span>
<a href="#l123.73"></a><span id="l123.73"> {</span>
<a href="#l123.74"></a><span id="l123.74">   supportsCommand: function(command)</span>
<a href="#l123.75"></a><span id="l123.75">   {</span>
<a href="#l123.76"></a><span id="l123.76">     switch (command)</span>
<a href="#l123.77"></a><span id="l123.77">     {</span>
<a href="#l123.78"></a><span id="l123.78">       case &quot;cmd_delete&quot;:</span>
<a href="#l123.79"></a><span id="l123.79" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l123.80"></a><span id="l123.80">       case &quot;cmd_undo&quot;:</span>
<a href="#l123.81"></a><span id="l123.81">       case &quot;cmd_redo&quot;:</span>
<a href="#l123.82"></a><span id="l123.82">       case &quot;cmd_killThread&quot;:</span>
<a href="#l123.83"></a><span id="l123.83">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l123.84"></a><span id="l123.84">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l123.85"></a><span id="l123.85">       case &quot;button_delete&quot;:</span>
<a href="#l123.86"></a><span id="l123.86">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l123.87"></a><span id="l123.87">       case &quot;button_junk&quot;:</span>
<a href="#l123.88"></a><span id="l123.88" class="difflineat">@@ -641,16 +675,19 @@ var MessageWindowController =</span>
<a href="#l123.89"></a><span id="l123.89">       default:</span>
<a href="#l123.90"></a><span id="l123.90">         return false;</span>
<a href="#l123.91"></a><span id="l123.91">     }</span>
<a href="#l123.92"></a><span id="l123.92">   },</span>
<a href="#l123.93"></a><span id="l123.93"> </span>
<a href="#l123.94"></a><span id="l123.94"> 	isCommandEnabled: function(command)</span>
<a href="#l123.95"></a><span id="l123.95"> 	{</span>
<a href="#l123.96"></a><span id="l123.96">     var loadedFolder;</span>
<a href="#l123.97"></a><span id="l123.97" class="difflineplus">+    var enabled = new Object();</span>
<a href="#l123.98"></a><span id="l123.98" class="difflineplus">+    enabled.value = false;</span>
<a href="#l123.99"></a><span id="l123.99" class="difflineplus">+    var checkStatus = new Object();</span>
<a href="#l123.100"></a><span id="l123.100"> </span>
<a href="#l123.101"></a><span id="l123.101"> 		switch (command)</span>
<a href="#l123.102"></a><span id="l123.102"> 		{</span>
<a href="#l123.103"></a><span id="l123.103">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l123.104"></a><span id="l123.104">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l123.105"></a><span id="l123.105">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l123.106"></a><span id="l123.106">         return (loadedFolder &amp;&amp; loadedFolder.server.canHaveFilters);</span>
<a href="#l123.107"></a><span id="l123.107">       case &quot;cmd_delete&quot;:</span>
<a href="#l123.108"></a><span id="l123.108" class="difflineat">@@ -664,19 +701,23 @@ var MessageWindowController =</span>
<a href="#l123.109"></a><span id="l123.109">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l123.110"></a><span id="l123.110">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l123.111"></a><span id="l123.111">         return gCurrentMessageUri &amp;&amp; loadedFolder &amp;&amp; (loadedFolder.canDeleteMessages || isNewsURI(gCurrentFolderUri));</span>
<a href="#l123.112"></a><span id="l123.112">       case &quot;button_junk&quot;:</span>
<a href="#l123.113"></a><span id="l123.113">         UpdateJunkToolbarButton();</span>
<a href="#l123.114"></a><span id="l123.114">         // fall through</span>
<a href="#l123.115"></a><span id="l123.115">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l123.116"></a><span id="l123.116"> 			case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l123.117"></a><span id="l123.117" class="difflineplus">+        if (gDBView)</span>
<a href="#l123.118"></a><span id="l123.118" class="difflineplus">+          gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l123.119"></a><span id="l123.119" class="difflineplus">+        return enabled.value;</span>
<a href="#l123.120"></a><span id="l123.120">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l123.121"></a><span id="l123.121" class="difflineminus">-        // can't do junk on news yet</span>
<a href="#l123.122"></a><span id="l123.122" class="difflineminus">-        return (!isNewsURI(gCurrentFolderUri));</span>
<a href="#l123.123"></a><span id="l123.123" class="difflineplus">+        if (GetNumSelectedMessages() &gt; 0 &amp;&amp; gDBView)</span>
<a href="#l123.124"></a><span id="l123.124" class="difflineplus">+          gDBView.getCommandStatus(nsMsgViewCommandType.runJunkControls, enabled, checkStatus);</span>
<a href="#l123.125"></a><span id="l123.125" class="difflineplus">+        return enabled.value;</span>
<a href="#l123.126"></a><span id="l123.126"> 			case &quot;cmd_reply&quot;:</span>
<a href="#l123.127"></a><span id="l123.127"> 			case &quot;button_reply&quot;:</span>
<a href="#l123.128"></a><span id="l123.128"> 			case &quot;cmd_replySender&quot;:</span>
<a href="#l123.129"></a><span id="l123.129"> 			case &quot;cmd_replyGroup&quot;:</span>
<a href="#l123.130"></a><span id="l123.130"> 			case &quot;cmd_replyall&quot;:</span>
<a href="#l123.131"></a><span id="l123.131"> 			case &quot;button_replyall&quot;:</span>
<a href="#l123.132"></a><span id="l123.132">       case &quot;cmd_replySenderAndGroup&quot;:</span>
<a href="#l123.133"></a><span id="l123.133">       case &quot;cmd_replyAllRecipients&quot;:</span>
<a href="#l123.134"></a><span id="l123.134" class="difflineat">@@ -739,16 +780,18 @@ var MessageWindowController =</span>
<a href="#l123.135"></a><span id="l123.135">       case &quot;button_goBack&quot;:</span>
<a href="#l123.136"></a><span id="l123.136">         return gDBView &amp;&amp; gDBView.navigateStatus(nsMsgNavigationType.back);</span>
<a href="#l123.137"></a><span id="l123.137">       case &quot;cmd_goForward&quot;:</span>
<a href="#l123.138"></a><span id="l123.138">       case &quot;button_goForward&quot;:</span>
<a href="#l123.139"></a><span id="l123.139">         return gDBView &amp;&amp; gDBView.navigateStatus(nsMsgNavigationType.forward);</span>
<a href="#l123.140"></a><span id="l123.140">       case &quot;cmd_search&quot;:</span>
<a href="#l123.141"></a><span id="l123.141">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l123.142"></a><span id="l123.142">         return (loadedFolder &amp;&amp; loadedFolder.server.canSearchMessages);</span>
<a href="#l123.143"></a><span id="l123.143" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l123.144"></a><span id="l123.144" class="difflineplus">+        return true;</span>
<a href="#l123.145"></a><span id="l123.145">       case &quot;cmd_undo&quot;:</span>
<a href="#l123.146"></a><span id="l123.146">       case &quot;cmd_redo&quot;:</span>
<a href="#l123.147"></a><span id="l123.147">         return SetupUndoRedoCommand(command);</span>
<a href="#l123.148"></a><span id="l123.148">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l123.149"></a><span id="l123.149">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l123.150"></a><span id="l123.150">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l123.151"></a><span id="l123.151">         return false;</span>
<a href="#l123.152"></a><span id="l123.152"> 			default:</span>
<a href="#l123.153"></a><span id="l123.153" class="difflineat">@@ -827,16 +870,19 @@ var MessageWindowController =</span>
<a href="#l123.154"></a><span id="l123.154">         break;</span>
<a href="#l123.155"></a><span id="l123.155">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l123.156"></a><span id="l123.156">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l123.157"></a><span id="l123.157">         MsgDeleteMessage(true);</span>
<a href="#l123.158"></a><span id="l123.158">         break;</span>
<a href="#l123.159"></a><span id="l123.159">       case &quot;button_junk&quot;:</span>
<a href="#l123.160"></a><span id="l123.160">         MsgJunk();</span>
<a href="#l123.161"></a><span id="l123.161">         break;</span>
<a href="#l123.162"></a><span id="l123.162" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l123.163"></a><span id="l123.163" class="difflineplus">+        MsgStop();</span>
<a href="#l123.164"></a><span id="l123.164" class="difflineplus">+        break;</span>
<a href="#l123.165"></a><span id="l123.165">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l123.166"></a><span id="l123.166">         PrintUtils.showPageSetup();</span>
<a href="#l123.167"></a><span id="l123.167">         break;</span>
<a href="#l123.168"></a><span id="l123.168"> 			case &quot;cmd_print&quot;:</span>
<a href="#l123.169"></a><span id="l123.169"> 				PrintEnginePrint();</span>
<a href="#l123.170"></a><span id="l123.170"> 				break;</span>
<a href="#l123.171"></a><span id="l123.171"> 			case &quot;cmd_printpreview&quot;:</span>
<a href="#l123.172"></a><span id="l123.172"> 				PrintEnginePrintPreview();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -764,21 +764,55 @@ function OnLoadMessenger()</span>
<a href="#l124.4"></a><span id="l124.4">   //Set focus to the Thread Pane the first time the window is opened.</span>
<a href="#l124.5"></a><span id="l124.5">   SetFocusThreadPane();</span>
<a href="#l124.6"></a><span id="l124.6"> </span>
<a href="#l124.7"></a><span id="l124.7">   // Before and after callbacks for the customizeToolbar code</span>
<a href="#l124.8"></a><span id="l124.8">   var mailToolbox = getMailToolbox();</span>
<a href="#l124.9"></a><span id="l124.9">   mailToolbox.customizeInit = MailToolboxCustomizeInit;</span>
<a href="#l124.10"></a><span id="l124.10">   mailToolbox.customizeDone = MailToolboxCustomizeDone;</span>
<a href="#l124.11"></a><span id="l124.11">   mailToolbox.customizeChange = MailToolboxCustomizeChange;</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineplus">+</span>
<a href="#l124.13"></a><span id="l124.13" class="difflineplus">+  window.addEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l124.14"></a><span id="l124.14" class="difflineplus">+}</span>
<a href="#l124.15"></a><span id="l124.15" class="difflineplus">+</span>
<a href="#l124.16"></a><span id="l124.16" class="difflineplus">+function HandleAppCommandEvent(evt)</span>
<a href="#l124.17"></a><span id="l124.17" class="difflineplus">+{</span>
<a href="#l124.18"></a><span id="l124.18" class="difflineplus">+  evt.stopPropagation();</span>
<a href="#l124.19"></a><span id="l124.19" class="difflineplus">+  switch (evt.command)</span>
<a href="#l124.20"></a><span id="l124.20" class="difflineplus">+  {</span>
<a href="#l124.21"></a><span id="l124.21" class="difflineplus">+    case &quot;Back&quot;:</span>
<a href="#l124.22"></a><span id="l124.22" class="difflineplus">+      goDoCommand('cmd_goBack');</span>
<a href="#l124.23"></a><span id="l124.23" class="difflineplus">+      break;</span>
<a href="#l124.24"></a><span id="l124.24" class="difflineplus">+    case &quot;Forward&quot;:</span>
<a href="#l124.25"></a><span id="l124.25" class="difflineplus">+      goDoCommand('cmd_goForward');</span>
<a href="#l124.26"></a><span id="l124.26" class="difflineplus">+      break;</span>
<a href="#l124.27"></a><span id="l124.27" class="difflineplus">+    case &quot;Stop&quot;:</span>
<a href="#l124.28"></a><span id="l124.28" class="difflineplus">+      goDoCommand('cmd_stop');</span>
<a href="#l124.29"></a><span id="l124.29" class="difflineplus">+      break;</span>
<a href="#l124.30"></a><span id="l124.30" class="difflineplus">+    case &quot;Search&quot;:</span>
<a href="#l124.31"></a><span id="l124.31" class="difflineplus">+      goDoCommand('cmd_search');</span>
<a href="#l124.32"></a><span id="l124.32" class="difflineplus">+      break;</span>
<a href="#l124.33"></a><span id="l124.33" class="difflineplus">+    case &quot;Bookmarks&quot;:</span>
<a href="#l124.34"></a><span id="l124.34" class="difflineplus">+      toAddressBook();</span>
<a href="#l124.35"></a><span id="l124.35" class="difflineplus">+      break;</span>
<a href="#l124.36"></a><span id="l124.36" class="difflineplus">+    case &quot;Reload&quot;:</span>
<a href="#l124.37"></a><span id="l124.37" class="difflineplus">+      goDoCommand('cmd_reload');</span>
<a href="#l124.38"></a><span id="l124.38" class="difflineplus">+      break;</span>
<a href="#l124.39"></a><span id="l124.39" class="difflineplus">+    case &quot;Home&quot;:</span>
<a href="#l124.40"></a><span id="l124.40" class="difflineplus">+      goDoCommand('cmd_goStartPage');</span>
<a href="#l124.41"></a><span id="l124.41" class="difflineplus">+      break;</span>
<a href="#l124.42"></a><span id="l124.42" class="difflineplus">+    default:</span>
<a href="#l124.43"></a><span id="l124.43" class="difflineplus">+      break;</span>
<a href="#l124.44"></a><span id="l124.44" class="difflineplus">+  }</span>
<a href="#l124.45"></a><span id="l124.45"> }</span>
<a href="#l124.46"></a><span id="l124.46"> </span>
<a href="#l124.47"></a><span id="l124.47"> function OnUnloadMessenger()</span>
<a href="#l124.48"></a><span id="l124.48"> {</span>
<a href="#l124.49"></a><span id="l124.49">   pref.removeObserver(&quot;mail.pane_config.dynamic&quot;, MailPaneConfigObserver, false);</span>
<a href="#l124.50"></a><span id="l124.50" class="difflineplus">+  window.removeEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l124.51"></a><span id="l124.51"> </span>
<a href="#l124.52"></a><span id="l124.52">   OnLeavingFolder(gMsgFolderSelected);  // mark all read in current folder</span>
<a href="#l124.53"></a><span id="l124.53">   accountManager.removeIncomingServerListener(gThreePaneIncomingServerListener);</span>
<a href="#l124.54"></a><span id="l124.54">   GetTabMail().closeTabs();</span>
<a href="#l124.55"></a><span id="l124.55"> </span>
<a href="#l124.56"></a><span id="l124.56">   // FIX ME - later we will be able to use onload from the overlay</span>
<a href="#l124.57"></a><span id="l124.57">   OnUnloadMsgHeaderPane();</span>
<a href="#l124.58"></a><span id="l124.58">   UnloadPanes();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/suite/mailnews/prefs/mailPrefsOverlay.xul</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/suite/mailnews/prefs/mailPrefsOverlay.xul</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -12,32 +12,20 @@</span>
<a href="#l125.4"></a><span id="l125.4">     &lt;preference id=&quot;general.startup.mail&quot;</span>
<a href="#l125.5"></a><span id="l125.5">                 name=&quot;general.startup.mail&quot;</span>
<a href="#l125.6"></a><span id="l125.6">                 type=&quot;bool&quot;/&gt;</span>
<a href="#l125.7"></a><span id="l125.7">     &lt;preference id=&quot;general.startup.addressbook&quot;</span>
<a href="#l125.8"></a><span id="l125.8">                 name=&quot;general.startup.addressbook&quot;</span>
<a href="#l125.9"></a><span id="l125.9">                 type=&quot;bool&quot;/&gt;</span>
<a href="#l125.10"></a><span id="l125.10">   &lt;/preferences&gt;</span>
<a href="#l125.11"></a><span id="l125.11">   &lt;preferences id=&quot;scripts_preferences&quot;&gt;</span>
<a href="#l125.12"></a><span id="l125.12" class="difflineminus">-    &lt;preference id=&quot;javascript.allow.mailnews&quot;</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineminus">-                name=&quot;javascript.allow.mailnews&quot;</span>
<a href="#l125.14"></a><span id="l125.14" class="difflineminus">-                type=&quot;bool&quot;</span>
<a href="#l125.15"></a><span id="l125.15" class="difflineminus">-                onchange=&quot;javascriptEnabledChange();&quot;/&gt;</span>
<a href="#l125.16"></a><span id="l125.16">     &lt;preference id=&quot;mailnews.message_display.allow.plugins&quot;</span>
<a href="#l125.17"></a><span id="l125.17">                 name=&quot;mailnews.message_display.allow.plugins&quot;</span>
<a href="#l125.18"></a><span id="l125.18">                 type=&quot;bool&quot;/&gt;</span>
<a href="#l125.19"></a><span id="l125.19">   &lt;/preferences&gt;</span>
<a href="#l125.20"></a><span id="l125.20" class="difflineminus">-  &lt;!-- javascript toggle for mail/news --&gt;</span>
<a href="#l125.21"></a><span id="l125.21" class="difflineminus">-  &lt;groupbox id=&quot;javascriptPreferences&quot;&gt;</span>
<a href="#l125.22"></a><span id="l125.22" class="difflineminus">-    &lt;checkbox id=&quot;javascriptAllowMailNews&quot;</span>
<a href="#l125.23"></a><span id="l125.23" class="difflineminus">-              insertafter=&quot;javascriptAllowNavigator&quot;</span>
<a href="#l125.24"></a><span id="l125.24" class="difflineminus">-              label=&quot;&amp;enbJsCheckMailNews.label;&quot;</span>
<a href="#l125.25"></a><span id="l125.25" class="difflineminus">-              accesskey=&quot;&amp;enbJsCheckMailNews.accesskey;&quot;</span>
<a href="#l125.26"></a><span id="l125.26" class="difflineminus">-              preference=&quot;javascript.allow.mailnews&quot;/&gt;</span>
<a href="#l125.27"></a><span id="l125.27" class="difflineminus">-  &lt;/groupbox&gt;</span>
<a href="#l125.28"></a><span id="l125.28">   &lt;!-- plugin toggle for mail/news --&gt;</span>
<a href="#l125.29"></a><span id="l125.29">   &lt;groupbox id=&quot;pluginPreferences&quot; hidden=&quot;false&quot;&gt;</span>
<a href="#l125.30"></a><span id="l125.30">     &lt;checkbox id=&quot;pluginAllowMailNews&quot;</span>
<a href="#l125.31"></a><span id="l125.31">               label=&quot;&amp;enbPluginCheckMailNews.label;&quot;</span>
<a href="#l125.32"></a><span id="l125.32">               accesskey=&quot;&amp;enbPluginCheckMailNews.accesskey;&quot;</span>
<a href="#l125.33"></a><span id="l125.33">               preference=&quot;mailnews.message_display.allow.plugins&quot;/&gt;</span>
<a href="#l125.34"></a><span id="l125.34">   &lt;/groupbox&gt;</span>
<a href="#l125.35"></a><span id="l125.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -334,17 +334,16 @@ nsSeamonkeyProfileMigrator::PrefTransfor</span>
<a href="#l126.4"></a><span id="l126.4"> </span>
<a href="#l126.5"></a><span id="l126.5">   MAKESAMETYPEPREFTRANSFORM(&quot;image.animation_mode&quot;,                    String),</span>
<a href="#l126.6"></a><span id="l126.6"> </span>
<a href="#l126.7"></a><span id="l126.7">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_charsets&quot;,                    String),</span>
<a href="#l126.8"></a><span id="l126.8">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_languages&quot;,                   String),</span>
<a href="#l126.9"></a><span id="l126.9">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.charset.default&quot;,                    String),</span>
<a href="#l126.10"></a><span id="l126.10">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.charsetmenu.browser.static&quot;,         String),</span>
<a href="#l126.11"></a><span id="l126.11"> </span>
<a href="#l126.12"></a><span id="l126.12" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;javascript.allow.mailnews&quot;,               Bool),</span>
<a href="#l126.13"></a><span id="l126.13">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.enabled&quot;,                      Bool),</span>
<a href="#l126.14"></a><span id="l126.14">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.relimit&quot;,              Bool),</span>
<a href="#l126.15"></a><span id="l126.15">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.showInConsole&quot;,        Bool),</span>
<a href="#l126.16"></a><span id="l126.16">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.strict&quot;,               Bool),</span>
<a href="#l126.17"></a><span id="l126.17"> </span>
<a href="#l126.18"></a><span id="l126.18">   MAKESAMETYPEPREFTRANSFORM(&quot;keyword.URL&quot;,                             String),</span>
<a href="#l126.19"></a><span id="l126.19">   MAKESAMETYPEPREFTRANSFORM(&quot;keyword.enabled&quot;,                         Bool),</span>
<a href="#l126.20"></a><span id="l126.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -311,17 +311,16 @@ nsThunderbirdProfileMigrator::PrefTransf</span>
<a href="#l127.4"></a><span id="l127.4">   MAKESAMETYPEPREFTRANSFORM(&quot;extensions.spellcheck.inline.max-misspellings&quot;,Int),</span>
<a href="#l127.5"></a><span id="l127.5"> </span>
<a href="#l127.6"></a><span id="l127.6">   MAKESAMETYPEPREFTRANSFORM(&quot;general.warnOnAboutConfig&quot;,               Bool),</span>
<a href="#l127.7"></a><span id="l127.7"> </span>
<a href="#l127.8"></a><span id="l127.8">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_charsets&quot;,                    String),</span>
<a href="#l127.9"></a><span id="l127.9">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_languages&quot;,                   String),</span>
<a href="#l127.10"></a><span id="l127.10">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.charset.default&quot;,                    String),</span>
<a href="#l127.11"></a><span id="l127.11"> </span>
<a href="#l127.12"></a><span id="l127.12" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;javascript.allow.mailnews&quot;,               Bool),</span>
<a href="#l127.13"></a><span id="l127.13">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.enabled&quot;,                      Bool),</span>
<a href="#l127.14"></a><span id="l127.14">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.relimit&quot;,              Bool),</span>
<a href="#l127.15"></a><span id="l127.15">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.showInConsole&quot;,        Bool),</span>
<a href="#l127.16"></a><span id="l127.16">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.strict&quot;,               Bool),</span>
<a href="#l127.17"></a><span id="l127.17"> </span>
<a href="#l127.18"></a><span id="l127.18">   MAKESAMETYPEPREFTRANSFORM(&quot;layout.spellcheckDefault&quot;,                Int),</span>
<a href="#l127.19"></a><span id="l127.19"> </span>
<a href="#l127.20"></a><span id="l127.20">   MAKESAMETYPEPREFTRANSFORM(&quot;mail.accountmanager.accounts&quot;,            String),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/suite/themes/classic/messenger/dialogs.css</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/suite/themes/classic/messenger/dialogs.css</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -63,31 +63,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l128.4"></a><span id="l128.4"> }</span>
<a href="#l128.5"></a><span id="l128.5"> </span>
<a href="#l128.6"></a><span id="l128.6"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l128.7"></a><span id="l128.7"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l128.8"></a><span id="l128.8"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l128.9"></a><span id="l128.9">   color: GrayText;</span>
<a href="#l128.10"></a><span id="l128.10"> }</span>
<a href="#l128.11"></a><span id="l128.11"> </span>
<a href="#l128.12"></a><span id="l128.12" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l128.13"></a><span id="l128.13" class="difflineminus">-</span>
<a href="#l128.14"></a><span id="l128.14" class="difflineminus">-#askSendFormat {</span>
<a href="#l128.15"></a><span id="l128.15" class="difflineminus">-  width: 40em;</span>
<a href="#l128.16"></a><span id="l128.16" class="difflineminus">-}</span>
<a href="#l128.17"></a><span id="l128.17" class="difflineminus">-</span>
<a href="#l128.18"></a><span id="l128.18" class="difflineminus">-#askImageBox {</span>
<a href="#l128.19"></a><span id="l128.19" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l128.20"></a><span id="l128.20" class="difflineminus">-}</span>
<a href="#l128.21"></a><span id="l128.21" class="difflineminus">-</span>
<a href="#l128.22"></a><span id="l128.22" class="difflineminus">-#convertYes,</span>
<a href="#l128.23"></a><span id="l128.23" class="difflineminus">-#convertAltering {</span>
<a href="#l128.24"></a><span id="l128.24" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l128.25"></a><span id="l128.25" class="difflineminus">-}</span>
<a href="#l128.26"></a><span id="l128.26" class="difflineminus">-</span>
<a href="#l128.27"></a><span id="l128.27" class="difflineminus">-#convertNo {</span>
<a href="#l128.28"></a><span id="l128.28" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/alert-exclam.gif&quot;);</span>
<a href="#l128.29"></a><span id="l128.29" class="difflineminus">-}</span>
<a href="#l128.30"></a><span id="l128.30" class="difflineminus">-</span>
<a href="#l128.31"></a><span id="l128.31" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l128.32"></a><span id="l128.32" class="difflineminus">-#convertDefault {</span>
<a href="#l128.33"></a><span id="l128.33" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l128.34"></a><span id="l128.34" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/suite/themes/classic/messenger/primaryToolbar.css</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/suite/themes/classic/messenger/primaryToolbar.css</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -284,102 +284,108 @@ toolbarpaletteitem &gt; #button-delete {</span>
<a href="#l129.4"></a><span id="l129.4"> }</span>
<a href="#l129.5"></a><span id="l129.5"> </span>
<a href="#l129.6"></a><span id="l129.6"> #button-stop[disabled=&quot;true&quot;] {</span>
<a href="#l129.7"></a><span id="l129.7">   -moz-image-region: rect(30px 119px 59px 90px) !important;</span>
<a href="#l129.8"></a><span id="l129.8"> }</span>
<a href="#l129.9"></a><span id="l129.9"> </span>
<a href="#l129.10"></a><span id="l129.10"> /* ::::: small primary toolbar buttons ::::: */</span>
<a href="#l129.11"></a><span id="l129.11"> </span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg {</span>
<a href="#l129.13"></a><span id="l129.13" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg,</span>
<a href="#l129.14"></a><span id="l129.14" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-getmsg {</span>
<a href="#l129.15"></a><span id="l129.15">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.16"></a><span id="l129.16">   -moz-image-region: rect(60px 19px 79px 0);</span>
<a href="#l129.17"></a><span id="l129.17"> }</span>
<a href="#l129.18"></a><span id="l129.18"> </span>
<a href="#l129.19"></a><span id="l129.19"> toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg:hover {</span>
<a href="#l129.20"></a><span id="l129.20">   -moz-image-region: rect(60px 39px 79px 20px);</span>
<a href="#l129.21"></a><span id="l129.21"> }</span>
<a href="#l129.22"></a><span id="l129.22"> </span>
<a href="#l129.23"></a><span id="l129.23"> toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg:hover:active {</span>
<a href="#l129.24"></a><span id="l129.24">   -moz-image-region: rect(60px 59px 79px 40px);</span>
<a href="#l129.25"></a><span id="l129.25"> }</span>
<a href="#l129.26"></a><span id="l129.26"> </span>
<a href="#l129.27"></a><span id="l129.27"> toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg[disabled] {</span>
<a href="#l129.28"></a><span id="l129.28">   -moz-image-region: rect(60px 79px 79px 60px) !important;</span>
<a href="#l129.29"></a><span id="l129.29"> }</span>
<a href="#l129.30"></a><span id="l129.30"> </span>
<a href="#l129.31"></a><span id="l129.31" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg {</span>
<a href="#l129.32"></a><span id="l129.32" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg,</span>
<a href="#l129.33"></a><span id="l129.33" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-newmsg {</span>
<a href="#l129.34"></a><span id="l129.34">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.35"></a><span id="l129.35">   -moz-image-region: rect(100px 19px 119px 0);</span>
<a href="#l129.36"></a><span id="l129.36"> }</span>
<a href="#l129.37"></a><span id="l129.37"> </span>
<a href="#l129.38"></a><span id="l129.38"> toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg:hover {</span>
<a href="#l129.39"></a><span id="l129.39">   -moz-image-region: rect(100px 39px 119px 20px);</span>
<a href="#l129.40"></a><span id="l129.40"> }</span>
<a href="#l129.41"></a><span id="l129.41"> </span>
<a href="#l129.42"></a><span id="l129.42"> toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg:hover:active {</span>
<a href="#l129.43"></a><span id="l129.43">   -moz-image-region: rect(100px 59px 119px 40px);</span>
<a href="#l129.44"></a><span id="l129.44"> }</span>
<a href="#l129.45"></a><span id="l129.45"> </span>
<a href="#l129.46"></a><span id="l129.46"> toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg[disabled] {</span>
<a href="#l129.47"></a><span id="l129.47">   -moz-image-region: rect(100px 79px 119px 60px) !important;</span>
<a href="#l129.48"></a><span id="l129.48"> }</span>
<a href="#l129.49"></a><span id="l129.49"> </span>
<a href="#l129.50"></a><span id="l129.50" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-reply {</span>
<a href="#l129.51"></a><span id="l129.51" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-reply,</span>
<a href="#l129.52"></a><span id="l129.52" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-reply {</span>
<a href="#l129.53"></a><span id="l129.53">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.54"></a><span id="l129.54">   -moz-image-region: rect(140px 19px 159px 0);</span>
<a href="#l129.55"></a><span id="l129.55"> }</span>
<a href="#l129.56"></a><span id="l129.56"> </span>
<a href="#l129.57"></a><span id="l129.57"> toolbar[iconsize=&quot;small&quot;] &gt; #button-reply:hover {</span>
<a href="#l129.58"></a><span id="l129.58">   -moz-image-region: rect(140px 39px 159px 20px);</span>
<a href="#l129.59"></a><span id="l129.59"> }</span>
<a href="#l129.60"></a><span id="l129.60"> </span>
<a href="#l129.61"></a><span id="l129.61"> toolbar[iconsize=&quot;small&quot;] &gt; #button-reply:hover:active {</span>
<a href="#l129.62"></a><span id="l129.62">   -moz-image-region: rect(140px 59px 159px 40px);</span>
<a href="#l129.63"></a><span id="l129.63"> }</span>
<a href="#l129.64"></a><span id="l129.64"> </span>
<a href="#l129.65"></a><span id="l129.65"> toolbar[iconsize=&quot;small&quot;] &gt; #button-reply[disabled] {</span>
<a href="#l129.66"></a><span id="l129.66">   -moz-image-region: rect(140px 79px 159px 60px) !important;</span>
<a href="#l129.67"></a><span id="l129.67"> }</span>
<a href="#l129.68"></a><span id="l129.68"> </span>
<a href="#l129.69"></a><span id="l129.69" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall {</span>
<a href="#l129.70"></a><span id="l129.70" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall,</span>
<a href="#l129.71"></a><span id="l129.71" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-replyall {</span>
<a href="#l129.72"></a><span id="l129.72">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.73"></a><span id="l129.73">   -moz-image-region: rect(160px 19px 179px 0);</span>
<a href="#l129.74"></a><span id="l129.74"> }</span>
<a href="#l129.75"></a><span id="l129.75"> </span>
<a href="#l129.76"></a><span id="l129.76"> toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall:hover {</span>
<a href="#l129.77"></a><span id="l129.77">   -moz-image-region: rect(160px 39px 179px 20px);</span>
<a href="#l129.78"></a><span id="l129.78"> }</span>
<a href="#l129.79"></a><span id="l129.79"> </span>
<a href="#l129.80"></a><span id="l129.80"> toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall:hover:active {</span>
<a href="#l129.81"></a><span id="l129.81">   -moz-image-region: rect(160px 59px 179px 40px);</span>
<a href="#l129.82"></a><span id="l129.82"> }</span>
<a href="#l129.83"></a><span id="l129.83"> </span>
<a href="#l129.84"></a><span id="l129.84"> toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall[disabled] {</span>
<a href="#l129.85"></a><span id="l129.85">   -moz-image-region: rect(160px 79px 179px 60px) !important;</span>
<a href="#l129.86"></a><span id="l129.86"> }</span>
<a href="#l129.87"></a><span id="l129.87"> </span>
<a href="#l129.88"></a><span id="l129.88" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-forward {</span>
<a href="#l129.89"></a><span id="l129.89" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-forward,</span>
<a href="#l129.90"></a><span id="l129.90" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-forward {</span>
<a href="#l129.91"></a><span id="l129.91">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.92"></a><span id="l129.92">   -moz-image-region: rect(40px 19px 59px 0);</span>
<a href="#l129.93"></a><span id="l129.93"> }</span>
<a href="#l129.94"></a><span id="l129.94"> </span>
<a href="#l129.95"></a><span id="l129.95"> toolbar[iconsize=&quot;small&quot;] &gt; #button-forward:hover {</span>
<a href="#l129.96"></a><span id="l129.96">   -moz-image-region: rect(40px 39px 59px 20px);</span>
<a href="#l129.97"></a><span id="l129.97"> }</span>
<a href="#l129.98"></a><span id="l129.98"> </span>
<a href="#l129.99"></a><span id="l129.99"> toolbar[iconsize=&quot;small&quot;] &gt; #button-forward:hover:active {</span>
<a href="#l129.100"></a><span id="l129.100">   -moz-image-region: rect(40px 59px 59px 40px);</span>
<a href="#l129.101"></a><span id="l129.101"> }</span>
<a href="#l129.102"></a><span id="l129.102"> </span>
<a href="#l129.103"></a><span id="l129.103"> toolbar[iconsize=&quot;small&quot;] &gt; #button-forward[disabled] {</span>
<a href="#l129.104"></a><span id="l129.104">   -moz-image-region: rect(40px 79px 59px 60px) !important;</span>
<a href="#l129.105"></a><span id="l129.105"> }</span>
<a href="#l129.106"></a><span id="l129.106"> </span>
<a href="#l129.107"></a><span id="l129.107" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-file {</span>
<a href="#l129.108"></a><span id="l129.108" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-file,</span>
<a href="#l129.109"></a><span id="l129.109" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-file {</span>
<a href="#l129.110"></a><span id="l129.110">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.111"></a><span id="l129.111">   -moz-image-region: rect(20px 19px 39px 0);</span>
<a href="#l129.112"></a><span id="l129.112"> }</span>
<a href="#l129.113"></a><span id="l129.113"> </span>
<a href="#l129.114"></a><span id="l129.114"> toolbar[iconsize=&quot;small&quot;] &gt; #button-file:hover {</span>
<a href="#l129.115"></a><span id="l129.115">   -moz-image-region: rect(20px 39px 39px 20px);</span>
<a href="#l129.116"></a><span id="l129.116"> }</span>
<a href="#l129.117"></a><span id="l129.117"> </span>
<a href="#l129.118"></a><span id="l129.118" class="difflineat">@@ -387,136 +393,146 @@ toolbar[iconsize=&quot;small&quot;] &gt; #button-file</span>
<a href="#l129.119"></a><span id="l129.119"> toolbar[iconsize=&quot;small&quot;] &gt; #button-file[open] {</span>
<a href="#l129.120"></a><span id="l129.120">   -moz-image-region: rect(20px 59px 39px 40px);</span>
<a href="#l129.121"></a><span id="l129.121"> } </span>
<a href="#l129.122"></a><span id="l129.122"> </span>
<a href="#l129.123"></a><span id="l129.123"> toolbar[iconsize=&quot;small&quot;] &gt; #button-file[disabled] {</span>
<a href="#l129.124"></a><span id="l129.124">   -moz-image-region: rect(20px 79px 39px 60px) !important;</span>
<a href="#l129.125"></a><span id="l129.125"> }</span>
<a href="#l129.126"></a><span id="l129.126"> </span>
<a href="#l129.127"></a><span id="l129.127" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-goback {</span>
<a href="#l129.128"></a><span id="l129.128" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-goback,</span>
<a href="#l129.129"></a><span id="l129.129" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-goback {</span>
<a href="#l129.130"></a><span id="l129.130">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l129.131"></a><span id="l129.131">   -moz-image-region: rect(40px 19px 59px 0);</span>
<a href="#l129.132"></a><span id="l129.132"> }</span>
<a href="#l129.133"></a><span id="l129.133"> </span>
<a href="#l129.134"></a><span id="l129.134"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goback:hover {</span>
<a href="#l129.135"></a><span id="l129.135">   -moz-image-region: rect(40px 39px 59px 20px);</span>
<a href="#l129.136"></a><span id="l129.136"> }</span>
<a href="#l129.137"></a><span id="l129.137"> </span>
<a href="#l129.138"></a><span id="l129.138"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goback:hover:active {</span>
<a href="#l129.139"></a><span id="l129.139">   -moz-image-region: rect(40px 59px 59px 40px);</span>
<a href="#l129.140"></a><span id="l129.140"> }</span>
<a href="#l129.141"></a><span id="l129.141"> </span>
<a href="#l129.142"></a><span id="l129.142"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goback[disabled=&quot;true&quot;] {</span>
<a href="#l129.143"></a><span id="l129.143">   -moz-image-region: rect(40px 79px 59px 60px) !important;</span>
<a href="#l129.144"></a><span id="l129.144"> }</span>
<a href="#l129.145"></a><span id="l129.145"> </span>
<a href="#l129.146"></a><span id="l129.146" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward {</span>
<a href="#l129.147"></a><span id="l129.147" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward,</span>
<a href="#l129.148"></a><span id="l129.148" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-goforward {</span>
<a href="#l129.149"></a><span id="l129.149">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l129.150"></a><span id="l129.150">   -moz-image-region: rect(60px 19px 79px 0);</span>
<a href="#l129.151"></a><span id="l129.151"> }</span>
<a href="#l129.152"></a><span id="l129.152"> </span>
<a href="#l129.153"></a><span id="l129.153"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward:hover {</span>
<a href="#l129.154"></a><span id="l129.154">   -moz-image-region: rect(60px 39px 79px 20px);</span>
<a href="#l129.155"></a><span id="l129.155"> }</span>
<a href="#l129.156"></a><span id="l129.156"> </span>
<a href="#l129.157"></a><span id="l129.157"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward:hover:active {</span>
<a href="#l129.158"></a><span id="l129.158">   -moz-image-region: rect(60px 59px 79px 40px);</span>
<a href="#l129.159"></a><span id="l129.159"> }</span>
<a href="#l129.160"></a><span id="l129.160"> </span>
<a href="#l129.161"></a><span id="l129.161"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward[disabled=&quot;true&quot;] {</span>
<a href="#l129.162"></a><span id="l129.162">   -moz-image-region: rect(60px 79px 79px 60px) !important;</span>
<a href="#l129.163"></a><span id="l129.163"> }</span>
<a href="#l129.164"></a><span id="l129.164"> </span>
<a href="#l129.165"></a><span id="l129.165" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-next {</span>
<a href="#l129.166"></a><span id="l129.166" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-next,</span>
<a href="#l129.167"></a><span id="l129.167" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-next {</span>
<a href="#l129.168"></a><span id="l129.168">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.169"></a><span id="l129.169">   -moz-image-region: rect(120px 19px 139px 0);</span>
<a href="#l129.170"></a><span id="l129.170"> }</span>
<a href="#l129.171"></a><span id="l129.171"> </span>
<a href="#l129.172"></a><span id="l129.172"> toolbar[iconsize=&quot;small&quot;] &gt; #button-next:hover {</span>
<a href="#l129.173"></a><span id="l129.173">   -moz-image-region: rect(120px 39px 139px 20px);</span>
<a href="#l129.174"></a><span id="l129.174"> }</span>
<a href="#l129.175"></a><span id="l129.175"> </span>
<a href="#l129.176"></a><span id="l129.176"> toolbar[iconsize=&quot;small&quot;] &gt; #button-next:hover:active {</span>
<a href="#l129.177"></a><span id="l129.177">   -moz-image-region: rect(120px 59px 139px 40px);</span>
<a href="#l129.178"></a><span id="l129.178"> }</span>
<a href="#l129.179"></a><span id="l129.179"> </span>
<a href="#l129.180"></a><span id="l129.180"> toolbar[iconsize=&quot;small&quot;] &gt; #button-next[disabled] {</span>
<a href="#l129.181"></a><span id="l129.181">   -moz-image-region: rect(120px 79px 139px 60px) !important;</span>
<a href="#l129.182"></a><span id="l129.182"> }</span>
<a href="#l129.183"></a><span id="l129.183"> </span>
<a href="#l129.184"></a><span id="l129.184" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-delete {</span>
<a href="#l129.185"></a><span id="l129.185" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-delete,</span>
<a href="#l129.186"></a><span id="l129.186" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-delete {</span>
<a href="#l129.187"></a><span id="l129.187">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.188"></a><span id="l129.188">   -moz-image-region: rect(0 19px 19px 0);</span>
<a href="#l129.189"></a><span id="l129.189"> }</span>
<a href="#l129.190"></a><span id="l129.190"> </span>
<a href="#l129.191"></a><span id="l129.191"> toolbar[iconsize=&quot;small&quot;] &gt; #button-delete:hover {</span>
<a href="#l129.192"></a><span id="l129.192">   -moz-image-region: rect(0 39px 19px 20px);</span>
<a href="#l129.193"></a><span id="l129.193"> }</span>
<a href="#l129.194"></a><span id="l129.194"> </span>
<a href="#l129.195"></a><span id="l129.195"> toolbar[iconsize=&quot;small&quot;] &gt; #button-delete:hover:active {</span>
<a href="#l129.196"></a><span id="l129.196">   -moz-image-region: rect(0 59px 19px 40px);</span>
<a href="#l129.197"></a><span id="l129.197"> }</span>
<a href="#l129.198"></a><span id="l129.198"> </span>
<a href="#l129.199"></a><span id="l129.199" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-delete[disabled] {</span>
<a href="#l129.200"></a><span id="l129.200" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-delete[disabled],</span>
<a href="#l129.201"></a><span id="l129.201" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-delete[disabled] {</span>
<a href="#l129.202"></a><span id="l129.202">   -moz-image-region: rect(0 79px 19px 60px) !important;</span>
<a href="#l129.203"></a><span id="l129.203"> }</span>
<a href="#l129.204"></a><span id="l129.204"> </span>
<a href="#l129.205"></a><span id="l129.205" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-mark {</span>
<a href="#l129.206"></a><span id="l129.206" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-mark,</span>
<a href="#l129.207"></a><span id="l129.207" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-mark {</span>
<a href="#l129.208"></a><span id="l129.208">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.209"></a><span id="l129.209">   -moz-image-region: rect(80px 19px 99px 0);</span>
<a href="#l129.210"></a><span id="l129.210"> }</span>
<a href="#l129.211"></a><span id="l129.211"> </span>
<a href="#l129.212"></a><span id="l129.212"> toolbar[iconsize=&quot;small&quot;] &gt; #button-mark:hover {</span>
<a href="#l129.213"></a><span id="l129.213">   -moz-image-region: rect(80px 39px 99px 20px);</span>
<a href="#l129.214"></a><span id="l129.214"> }</span>
<a href="#l129.215"></a><span id="l129.215"> </span>
<a href="#l129.216"></a><span id="l129.216"> toolbar[iconsize=&quot;small&quot;] &gt; #button-mark:hover:active {</span>
<a href="#l129.217"></a><span id="l129.217">   -moz-image-region: rect(80px 59px 99px 40px);</span>
<a href="#l129.218"></a><span id="l129.218"> }</span>
<a href="#l129.219"></a><span id="l129.219"> </span>
<a href="#l129.220"></a><span id="l129.220"> toolbar[iconsize=&quot;small&quot;] &gt; #button-mark[disabled] {</span>
<a href="#l129.221"></a><span id="l129.221">   -moz-image-region: rect(80px 79px 99px 60px) !important;</span>
<a href="#l129.222"></a><span id="l129.222"> }</span>
<a href="#l129.223"></a><span id="l129.223"> </span>
<a href="#l129.224"></a><span id="l129.224" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-junk {</span>
<a href="#l129.225"></a><span id="l129.225" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-junk,</span>
<a href="#l129.226"></a><span id="l129.226" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-junk {</span>
<a href="#l129.227"></a><span id="l129.227">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l129.228"></a><span id="l129.228">   -moz-image-region: rect(240px 19px 259px 0);</span>
<a href="#l129.229"></a><span id="l129.229"> }</span>
<a href="#l129.230"></a><span id="l129.230"> </span>
<a href="#l129.231"></a><span id="l129.231"> toolbar[iconsize=&quot;small&quot;] &gt; #button-junk:hover {</span>
<a href="#l129.232"></a><span id="l129.232">   -moz-image-region: rect(240px 39px 259px 20px);</span>
<a href="#l129.233"></a><span id="l129.233"> }</span>
<a href="#l129.234"></a><span id="l129.234"> </span>
<a href="#l129.235"></a><span id="l129.235"> toolbar[iconsize=&quot;small&quot;] &gt; #button-junk:hover:active {</span>
<a href="#l129.236"></a><span id="l129.236">   -moz-image-region: rect(240px 59px 259px 40px);</span>
<a href="#l129.237"></a><span id="l129.237"> }</span>
<a href="#l129.238"></a><span id="l129.238"> </span>
<a href="#l129.239"></a><span id="l129.239" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-junk[disabled=&quot;true&quot;] {</span>
<a href="#l129.240"></a><span id="l129.240" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-junk[disabled],</span>
<a href="#l129.241"></a><span id="l129.241" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-junk[disabled] {</span>
<a href="#l129.242"></a><span id="l129.242">   -moz-image-region: rect(240px 79px 259px 60px) !important;</span>
<a href="#l129.243"></a><span id="l129.243"> }</span>
<a href="#l129.244"></a><span id="l129.244"> </span>
<a href="#l129.245"></a><span id="l129.245" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-print {</span>
<a href="#l129.246"></a><span id="l129.246" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-print,</span>
<a href="#l129.247"></a><span id="l129.247" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-print {</span>
<a href="#l129.248"></a><span id="l129.248">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l129.249"></a><span id="l129.249">   -moz-image-region: rect(0 19px 19px 0);</span>
<a href="#l129.250"></a><span id="l129.250"> }</span>
<a href="#l129.251"></a><span id="l129.251"> </span>
<a href="#l129.252"></a><span id="l129.252"> toolbar[iconsize=&quot;small&quot;] &gt; #button-print:hover {</span>
<a href="#l129.253"></a><span id="l129.253">   -moz-image-region: rect(0 39px 19px 20px);</span>
<a href="#l129.254"></a><span id="l129.254"> }</span>
<a href="#l129.255"></a><span id="l129.255"> </span>
<a href="#l129.256"></a><span id="l129.256"> toolbar[iconsize=&quot;small&quot;] &gt; #button-print:hover:active {</span>
<a href="#l129.257"></a><span id="l129.257">   -moz-image-region: rect(0 59px 19px 40px);</span>
<a href="#l129.258"></a><span id="l129.258"> }</span>
<a href="#l129.259"></a><span id="l129.259"> </span>
<a href="#l129.260"></a><span id="l129.260"> toolbar[iconsize=&quot;small&quot;] &gt; #button-print[disabled] {</span>
<a href="#l129.261"></a><span id="l129.261">   -moz-image-region: rect(0 79px 19px 60px) !important;</span>
<a href="#l129.262"></a><span id="l129.262"> }</span>
<a href="#l129.263"></a><span id="l129.263"> </span>
<a href="#l129.264"></a><span id="l129.264" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-stop {</span>
<a href="#l129.265"></a><span id="l129.265" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-stop,</span>
<a href="#l129.266"></a><span id="l129.266" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-stop {</span>
<a href="#l129.267"></a><span id="l129.267">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l129.268"></a><span id="l129.268">   -moz-image-region: rect(20px 19px 39px 0);</span>
<a href="#l129.269"></a><span id="l129.269"> }</span>
<a href="#l129.270"></a><span id="l129.270"> </span>
<a href="#l129.271"></a><span id="l129.271"> toolbar[iconsize=&quot;small&quot;] &gt; #button-stop:hover {</span>
<a href="#l129.272"></a><span id="l129.272">   -moz-image-region: rect(20px 39px 39px 20px);</span>
<a href="#l129.273"></a><span id="l129.273"> }</span>
<a href="#l129.274"></a><span id="l129.274"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l130.1"></a><span id="l130.1" class="difflineminus">--- a/suite/themes/modern/messenger/dialogs.css</span>
<a href="#l130.2"></a><span id="l130.2" class="difflineplus">+++ b/suite/themes/modern/messenger/dialogs.css</span>
<a href="#l130.3"></a><span id="l130.3" class="difflineat">@@ -90,33 +90,8 @@ treecell.importsampledata {</span>
<a href="#l130.4"></a><span id="l130.4"> </span>
<a href="#l130.5"></a><span id="l130.5"> #progressMeter {</span>
<a href="#l130.6"></a><span id="l130.6">   margin-top: 1em;</span>
<a href="#l130.7"></a><span id="l130.7">   margin-bottom: 2em;</span>
<a href="#l130.8"></a><span id="l130.8">   -moz-margin-start: 1em;</span>
<a href="#l130.9"></a><span id="l130.9">   -moz-margin-end: 2em;</span>
<a href="#l130.10"></a><span id="l130.10">   width: 26em;</span>
<a href="#l130.11"></a><span id="l130.11"> }</span>
<a href="#l130.12"></a><span id="l130.12" class="difflineminus">-</span>
<a href="#l130.13"></a><span id="l130.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l130.14"></a><span id="l130.14" class="difflineminus">-</span>
<a href="#l130.15"></a><span id="l130.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l130.16"></a><span id="l130.16" class="difflineminus">-  width: 40em;</span>
<a href="#l130.17"></a><span id="l130.17" class="difflineminus">-}</span>
<a href="#l130.18"></a><span id="l130.18" class="difflineminus">-</span>
<a href="#l130.19"></a><span id="l130.19" class="difflineminus">-#askImageBox {</span>
<a href="#l130.20"></a><span id="l130.20" class="difflineminus">-  -moz-box-align: start;</span>
<a href="#l130.21"></a><span id="l130.21" class="difflineminus">-}</span>
<a href="#l130.22"></a><span id="l130.22" class="difflineminus">-</span>
<a href="#l130.23"></a><span id="l130.23" class="difflineminus">-#convertYes,</span>
<a href="#l130.24"></a><span id="l130.24" class="difflineminus">-#convertAltering {</span>
<a href="#l130.25"></a><span id="l130.25" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l130.26"></a><span id="l130.26" class="difflineminus">-}</span>
<a href="#l130.27"></a><span id="l130.27" class="difflineminus">-</span>
<a href="#l130.28"></a><span id="l130.28" class="difflineminus">-#convertNo {</span>
<a href="#l130.29"></a><span id="l130.29" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/alert-exclam.gif&quot;);</span>
<a href="#l130.30"></a><span id="l130.30" class="difflineminus">-}</span>
<a href="#l130.31"></a><span id="l130.31" class="difflineminus">-</span>
<a href="#l130.32"></a><span id="l130.32" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l130.33"></a><span id="l130.33" class="difflineminus">-#convertDefault {</span>
<a href="#l130.34"></a><span id="l130.34" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l130.35"></a><span id="l130.35" class="difflineminus">-}</span>
<a href="#l130.36"></a><span id="l130.36" class="difflineminus">-</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

