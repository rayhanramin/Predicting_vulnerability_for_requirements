<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20018:236b9899c452443b01830bc85071c5a14c0f0ae4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 236b9899c452443b01830bc85071c5a14c0f0ae4" />
<meta property="og:url" content="/comm-central/rev/236b9899c452443b01830bc85071c5a14c0f0ae4" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable block-scoped-var rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 236b9899c452443b01830bc85071c5a14c0f0ae4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/236b9899c452443b01830bc85071c5a14c0f0ae4">shortlog</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/236b9899c452443b01830bc85071c5a14c0f0ae4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4">files</a> |
changeset |
<a href="/comm-central/raw-rev/236b9899c452443b01830bc85071c5a14c0f0ae4">raw</a>  | <a href="/comm-central/archive/236b9899c452443b01830bc85071c5a14c0f0ae4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable block-scoped-var rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 11:16:05 +0200</td></tr>

<tr>
 <td>changeset 20018</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/236b9899c452443b01830bc85071c5a14c0f0ae4">236b9899c452443b01830bc85071c5a14c0f0ae4</a></td>
</tr>



<tr>
<td>parent 20017</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a</a>
</td>
</tr>

<tr>
<td>child 20019</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d56d639677139ede62ac3c3736e23c7a05aeee42">d56d639677139ede62ac3c3736e23c7a05aeee42</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=236b9899c452443b01830bc85071c5a14c0f0ae4">12288</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Thu, 15 Sep 2016 22:48:47 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d56d63967713 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d56d639677139ede62ac3c3736e23c7a05aeee42">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d56d639677139ede62ac3c3736e23c7a05aeee42&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d56d639677139ede62ac3c3736e23c7a05aeee42&newProject=comm-central&newRevision=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d56d639677139ede62ac3c3736e23c7a05aeee42&newProject=comm-central&newRevision=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d56d639677139ede62ac3c3736e23c7a05aeee42&newProject=comm-central&newRevision=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable block-scoped-var rule. r=MakeMyDay

MozReview-Commit-ID: AIa07arBwRk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-daypicker.xml">calendar/base/content/calendar-daypicker.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-daypicker.xml">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-daypicker.xml">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-daypicker.xml">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-daypicker.xml">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-daypicker.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/test_attendee.js">calendar/test/unit/test_attendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/test_attendee.js">file</a> |
<a href="/comm-central/annotate/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/test_attendee.js">annotate</a> |
<a href="/comm-central/diff/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/test_attendee.js">diff</a> |
<a href="/comm-central/comparison/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/test_attendee.js">comparison</a> |
<a href="/comm-central/log/236b9899c452443b01830bc85071c5a14c0f0ae4/calendar/test/unit/test_attendee.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,16 +1,19 @@</span>
<a href="#l1.4"></a><span id="l1.4"> {</span>
<a href="#l1.5"></a><span id="l1.5">   &quot;extends&quot;: [</span>
<a href="#l1.6"></a><span id="l1.6">     &quot;../mozilla/toolkit/.eslintrc&quot;</span>
<a href="#l1.7"></a><span id="l1.7">   ],</span>
<a href="#l1.8"></a><span id="l1.8">   &quot;rules&quot;: {</span>
<a href="#l1.9"></a><span id="l1.9">     // Enforce newline at the end of file, with no multiple empty lines.</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;eol-last&quot;: 2,</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Disallow using variables outside the blocks they are defined</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;block-scoped-var&quot;: 2,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // Enforce the spacing around the * in generator functions.</span>
<a href="#l1.16"></a><span id="l1.16">     &quot;generator-star-spacing&quot;: [2, &quot;after&quot;],</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18">     // Disallow deletion of variables (deleting properties is fine).</span>
<a href="#l1.19"></a><span id="l1.19">     &quot;no-delete-var&quot;: 2,</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">     // Disallow duplicate arguments in functions.</span>
<a href="#l1.22"></a><span id="l1.22">     &quot;no-dupe-args&quot;: 2,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -127,18 +127,19 @@ function onCheckboxChange(event) {</span>
<a href="#l2.4"></a><span id="l2.4">     // as the agenda-checkboxes are only transient we have to set the &quot;checked&quot;</span>
<a href="#l2.5"></a><span id="l2.5">     // attribute at their hidden origins to make that attribute persistent.</span>
<a href="#l2.6"></a><span id="l2.6">     document.getElementById(listItem.id + &quot;-hidden&quot;).setAttribute(&quot;checked&quot;,</span>
<a href="#l2.7"></a><span id="l2.7">                             periodCheckbox.getAttribute(&quot;checked&quot;));</span>
<a href="#l2.8"></a><span id="l2.8">     if (lopen) {</span>
<a href="#l2.9"></a><span id="l2.9">         agendaListbox.refreshCalendarQuery(period.start, period.end);</span>
<a href="#l2.10"></a><span id="l2.10">     } else {</span>
<a href="#l2.11"></a><span id="l2.11">         listItem = listItem.nextSibling;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+        let leaveloop;</span>
<a href="#l2.13"></a><span id="l2.13">         do {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-            var leaveloop = (listItem == null);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+            leaveloop = (listItem == null);</span>
<a href="#l2.16"></a><span id="l2.16">             if (!leaveloop) {</span>
<a href="#l2.17"></a><span id="l2.17">                 var nextItemSibling = listItem.nextSibling;</span>
<a href="#l2.18"></a><span id="l2.18">                 leaveloop = (!agendaListbox.isEventListItem(listItem));</span>
<a href="#l2.19"></a><span id="l2.19">                 if (!leaveloop) {</span>
<a href="#l2.20"></a><span id="l2.20">                     listItem.remove();</span>
<a href="#l2.21"></a><span id="l2.21">                     listItem = nextItemSibling;</span>
<a href="#l2.22"></a><span id="l2.22">                 }</span>
<a href="#l2.23"></a><span id="l2.23">             }</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineat">@@ -461,19 +462,20 @@ function getListItems(aItem, aPeriod) {</span>
<a href="#l2.25"></a><span id="l2.25">     var periods = [aPeriod];</span>
<a href="#l2.26"></a><span id="l2.26">     if (!aPeriod) {</span>
<a href="#l2.27"></a><span id="l2.27">         periods = this.findPeriodsForItem(aItem);</span>
<a href="#l2.28"></a><span id="l2.28">     }</span>
<a href="#l2.29"></a><span id="l2.29">     if (periods.length &gt; 0) {</span>
<a href="#l2.30"></a><span id="l2.30">         for (var i = 0; i &lt; periods.length; i++) {</span>
<a href="#l2.31"></a><span id="l2.31">             let period = periods[i];</span>
<a href="#l2.32"></a><span id="l2.32">             let complistItem = period.listItem;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+            let leaveloop;</span>
<a href="#l2.34"></a><span id="l2.34">             do {</span>
<a href="#l2.35"></a><span id="l2.35">                 complistItem = complistItem.nextSibling;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-                var leaveloop = (!this.isEventListItem(complistItem));</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+                leaveloop = (!this.isEventListItem(complistItem));</span>
<a href="#l2.38"></a><span id="l2.38">                 if (!leaveloop) {</span>
<a href="#l2.39"></a><span id="l2.39">                     if (this.isSameEvent(aItem, complistItem.occurrence)){</span>
<a href="#l2.40"></a><span id="l2.40">                         retlistItems.push(complistItem);</span>
<a href="#l2.41"></a><span id="l2.41">                         break;</span>
<a href="#l2.42"></a><span id="l2.42">                     }</span>
<a href="#l2.43"></a><span id="l2.43">                 }</span>
<a href="#l2.44"></a><span id="l2.44">             } while (!leaveloop)</span>
<a href="#l2.45"></a><span id="l2.45">         }</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineat">@@ -1055,62 +1057,66 @@ function updateSoonSection() {</span>
<a href="#l2.47"></a><span id="l2.47"> /**</span>
<a href="#l2.48"></a><span id="l2.48">  * Updates the event considered &quot;current&quot;. This goes through all &quot;today&quot; items</span>
<a href="#l2.49"></a><span id="l2.49">  * and sets the &quot;current&quot; attribute on all list items that are currently</span>
<a href="#l2.50"></a><span id="l2.50">  * occurring.</span>
<a href="#l2.51"></a><span id="l2.51">  *</span>
<a href="#l2.52"></a><span id="l2.52">  * @see scheduleNextCurrentEventUpdate</span>
<a href="#l2.53"></a><span id="l2.53">  */</span>
<a href="#l2.54"></a><span id="l2.54"> function setCurrentEvent() {</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-    if (agendaListbox.showsToday() &amp;&amp; agendaListbox.today.open) {</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+    if (!agendaListbox.showsToday() || !agendaListbox.today.open) {</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+        return;</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+    }</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-        var msScheduleTime = -1;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-        var complistItem = agendaListbox.tomorrow.listItem.previousSibling;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-        var removelist = [];</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-        var anow = now();</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-        var msuntillend = 0;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-        var msuntillstart = 0;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-        do {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-            var leaveloop = (!agendaListbox.isEventListItem(complistItem));</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-            if (!leaveloop) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-                msuntillstart =  complistItem.occurrence.startDate</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-                                             .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-                                             .subtractDate(anow).inSeconds;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-                if (msuntillstart &lt;= 0) {</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-                    msuntillend = complistItem.occurrence.endDate</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-                                              .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-                                              .subtractDate(anow).inSeconds;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-                    if (msuntillend &gt; 0) {</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-                        complistItem.setAttribute(&quot;current&quot;, &quot;true&quot;);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-                        if ((msuntillend &lt; msScheduleTime)  || (msScheduleTime == -1)){</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-                            msScheduleTime = msuntillend;</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-                        }</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-                    } else {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-                         removelist.push(complistItem);</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    let msScheduleTime = -1;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+    let complistItem = agendaListbox.tomorrow.listItem.previousSibling;</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+    let removelist = [];</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+    let anow = now();</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+    let msuntillend = 0;</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+    let msuntillstart = 0;</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+    let leaveloop;</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+    do {</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+        leaveloop = (!agendaListbox.isEventListItem(complistItem));</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+        if (!leaveloop) {</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+            msuntillstart = complistItem.occurrence.startDate</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+                                        .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+                                        .subtractDate(anow).inSeconds;</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+            if (msuntillstart &lt;= 0) {</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+                msuntillend = complistItem.occurrence.endDate</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+                                          .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+                                          .subtractDate(anow).inSeconds;</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+                if (msuntillend &gt; 0) {</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+                    complistItem.setAttribute(&quot;current&quot;, &quot;true&quot;);</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+                    if (msuntillend &lt; msScheduleTime || msScheduleTime == -1) {</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+                        msScheduleTime = msuntillend;</span>
<a href="#l2.104"></a><span id="l2.104">                     }</span>
<a href="#l2.105"></a><span id="l2.105">                 } else {</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-                    complistItem.removeAttribute(&quot;current&quot;);</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+                     removelist.push(complistItem);</span>
<a href="#l2.108"></a><span id="l2.108">                 }</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-                if ((msScheduleTime == -1) || (msuntillstart &lt; msScheduleTime)) {</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-                    if (msuntillstart &gt; 0) {</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-                        msScheduleTime = msuntillstart;</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-                    }</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+            } else {</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+                complistItem.removeAttribute(&quot;current&quot;);</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+            }</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+            if (msScheduleTime == -1 || msuntillstart &lt; msScheduleTime) {</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+                if (msuntillstart &gt; 0) {</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+                    msScheduleTime = msuntillstart;</span>
<a href="#l2.119"></a><span id="l2.119">                 }</span>
<a href="#l2.120"></a><span id="l2.120">             }</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-            if (!leaveloop) {</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-                complistItem = complistItem.previousSibling;</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-            }</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-        } while (!leaveloop)</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-        if (msScheduleTime &gt; -1) {</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-            scheduleNextCurrentEventUpdate(setCurrentEvent, msScheduleTime * 1000);</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+        }</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+        if (!leaveloop) {</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+            complistItem = complistItem.previousSibling;</span>
<a href="#l2.130"></a><span id="l2.130">         }</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+    } while (!leaveloop);</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+    if (msScheduleTime &gt; -1) {</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+        scheduleNextCurrentEventUpdate(setCurrentEvent, msScheduleTime * 1000);</span>
<a href="#l2.135"></a><span id="l2.135">     }</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+</span>
<a href="#l2.137"></a><span id="l2.137">     if (removelist) {</span>
<a href="#l2.138"></a><span id="l2.138">       if (removelist.length &gt; 0) {</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-          for (var i = 0;i &lt; removelist.length; i++) {</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+          for (let i = 0;i &lt; removelist.length; i++) {</span>
<a href="#l2.141"></a><span id="l2.141">               removelist[i].remove();</span>
<a href="#l2.142"></a><span id="l2.142">           }</span>
<a href="#l2.143"></a><span id="l2.143">       }</span>
<a href="#l2.144"></a><span id="l2.144">     }</span>
<a href="#l2.145"></a><span id="l2.145"> }</span>
<a href="#l2.146"></a><span id="l2.146"> </span>
<a href="#l2.147"></a><span id="l2.147"> var gEventTimer;</span>
<a href="#l2.148"></a><span id="l2.148"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -80,21 +80,21 @@</span>
<a href="#l3.4"></a><span id="l3.4">       day of the week, starting with SUNDAY=1.</span>
<a href="#l3.5"></a><span id="l3.5">       --&gt;</span>
<a href="#l3.6"></a><span id="l3.6">       &lt;property name=&quot;days&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l3.8"></a><span id="l3.8">           var mainbox =</span>
<a href="#l3.9"></a><span id="l3.9">               document.getAnonymousElementByAttribute(</span>
<a href="#l3.10"></a><span id="l3.10">                   this, &quot;anonid&quot;, &quot;mainbox&quot;);</span>
<a href="#l3.11"></a><span id="l3.11">           var numChilds = mainbox.childNodes.length;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-          for (var i = 0; i &lt; numChilds; i++) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+          for (let i = 0; i &lt; numChilds; i++) {</span>
<a href="#l3.14"></a><span id="l3.14">               var child = mainbox.childNodes[i];</span>
<a href="#l3.15"></a><span id="l3.15">               child.removeAttribute(&quot;checked&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">           }</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-          for (i = 0; i &lt; val.length; i++) {</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+          for (let i = 0; i &lt; val.length; i++) {</span>
<a href="#l3.19"></a><span id="l3.19">               var index = val[i] - 1 - this.weekStartOffset;</span>
<a href="#l3.20"></a><span id="l3.20">               if (index &lt; 0) {</span>
<a href="#l3.21"></a><span id="l3.21">                   index += 7;</span>
<a href="#l3.22"></a><span id="l3.22">               }</span>
<a href="#l3.23"></a><span id="l3.23">               mainbox.childNodes[index].setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l3.24"></a><span id="l3.24">           }</span>
<a href="#l3.25"></a><span id="l3.25">           return val;</span>
<a href="#l3.26"></a><span id="l3.26">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineat">@@ -203,31 +203,31 @@</span>
<a href="#l3.28"></a><span id="l3.28">               &lt;daypicker bottom=&quot;true&quot; label=&quot;31&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l3.29"></a><span id="l3.29">               &lt;daypicker bottom=&quot;true&quot; right=&quot;true&quot; label=&quot;&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l3.30"></a><span id="l3.30">             &lt;/xul:hbox&gt;</span>
<a href="#l3.31"></a><span id="l3.31">           &lt;/xul:vbox&gt;</span>
<a href="#l3.32"></a><span id="l3.32">         &lt;/content&gt;</span>
<a href="#l3.33"></a><span id="l3.33">     &lt;implementation&gt;</span>
<a href="#l3.34"></a><span id="l3.34">       &lt;property name=&quot;days&quot;&gt;</span>
<a href="#l3.35"></a><span id="l3.35">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-          var mainbox =</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+          let mainbox =</span>
<a href="#l3.38"></a><span id="l3.38">               document.getAnonymousElementByAttribute(</span>
<a href="#l3.39"></a><span id="l3.39">                   this, &quot;anonid&quot;, &quot;mainbox&quot;);</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-          var numRows = mainbox.childNodes.length;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-          var days = [];</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-          for (var i = 0; i &lt; numRows; i++) {</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-              var row = mainbox.childNodes[i];</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-              var numChilds = row.childNodes.length;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-              for (var j = 0; j &lt; numChilds; j++) {</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-                  var child = row.childNodes[j];</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+          let numRows = mainbox.childNodes.length;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+          let days = [];</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+          for (let i = 0; i &lt; numRows; i++) {</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+              let row = mainbox.childNodes[i];</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+              let numChilds = row.childNodes.length;</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+              for (let j = 0; j &lt; numChilds; j++) {</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+                  let child = row.childNodes[j];</span>
<a href="#l3.54"></a><span id="l3.54">                   child.removeAttribute(&quot;checked&quot;);</span>
<a href="#l3.55"></a><span id="l3.55">                   days.push(child);</span>
<a href="#l3.56"></a><span id="l3.56">               }</span>
<a href="#l3.57"></a><span id="l3.57">           }</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-          for (i = 0; i &lt; val.length; i++) {</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+          for (let i = 0; i &lt; val.length; i++) {</span>
<a href="#l3.60"></a><span id="l3.60">               let lastDayOffset = val[i] == -1 ? 0 : -1;</span>
<a href="#l3.61"></a><span id="l3.61">               let index = (val[i] &lt; 0 ? val[i] + days.length + lastDayOffset</span>
<a href="#l3.62"></a><span id="l3.62">                                       : val[i] - 1);</span>
<a href="#l3.63"></a><span id="l3.63">               days[index].setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l3.64"></a><span id="l3.64">           }</span>
<a href="#l3.65"></a><span id="l3.65">           return val;</span>
<a href="#l3.66"></a><span id="l3.66">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l3.67"></a><span id="l3.67">         &lt;getter&gt;&lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -747,18 +747,19 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">                   innerColumn.style.minWidth = &quot;1px&quot;;</span>
<a href="#l4.6"></a><span id="l4.6">                   innerColumn.style.minHeight = &quot;1px&quot;;</span>
<a href="#l4.7"></a><span id="l4.7">                   innerColumn.style.width = colFlex + &quot;px&quot;;</span>
<a href="#l4.8"></a><span id="l4.8">                   innerColumn.style.height = colFlex + &quot;px&quot;;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">                   xulColumn.appendChild(innerColumn);</span>
<a href="#l4.11"></a><span id="l4.11">                   let curTime = 0;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+                  let duration;</span>
<a href="#l4.13"></a><span id="l4.13">                   for (let chunk of column) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                      var duration = chunk.duration;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+                      duration = chunk.duration;</span>
<a href="#l4.16"></a><span id="l4.16">                       if (!duration) {</span>
<a href="#l4.17"></a><span id="l4.17">                           continue;</span>
<a href="#l4.18"></a><span id="l4.18">                       }</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">                       if (chunk.event) {</span>
<a href="#l4.21"></a><span id="l4.21">                           let chunkBox = createXULElement(&quot;calendar-event-box&quot;);</span>
<a href="#l4.22"></a><span id="l4.22">                           let durMinutes = duration.inSeconds / 60;</span>
<a href="#l4.23"></a><span id="l4.23">                           let size = Math.max(durMinutes * this.mPixPerMin, minSize);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -312,28 +312,28 @@ function appendCalendarItems(aItem, aCal</span>
<a href="#l5.4"></a><span id="l5.4">  *</span>
<a href="#l5.5"></a><span id="l5.5">  * @param aParent     The XUL node to add the menuitem to.</span>
<a href="#l5.6"></a><span id="l5.6">  * @param aLabel      The label string of the menuitem.</span>
<a href="#l5.7"></a><span id="l5.7">  * @param aValue      The value attribute of the menuitem.</span>
<a href="#l5.8"></a><span id="l5.8">  * @param aCommand    The oncommand attribute of the menuitem.</span>
<a href="#l5.9"></a><span id="l5.9">  * @return            The newly created menuitem</span>
<a href="#l5.10"></a><span id="l5.10">  */</span>
<a href="#l5.11"></a><span id="l5.11"> function addMenuItem(aParent, aLabel, aValue, aCommand) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    let item = null;</span>
<a href="#l5.13"></a><span id="l5.13">     if (aParent.localName == &quot;menupopup&quot;) {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-        var item = createXULElement(&quot;menuitem&quot;);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        item = createXULElement(&quot;menuitem&quot;);</span>
<a href="#l5.16"></a><span id="l5.16">         item.setAttribute(&quot;label&quot;, aLabel);</span>
<a href="#l5.17"></a><span id="l5.17">         if (aValue) {</span>
<a href="#l5.18"></a><span id="l5.18">             item.setAttribute(&quot;value&quot;, aValue);</span>
<a href="#l5.19"></a><span id="l5.19">         }</span>
<a href="#l5.20"></a><span id="l5.20">         if (aCommand) {</span>
<a href="#l5.21"></a><span id="l5.21">             item.command = aCommand;</span>
<a href="#l5.22"></a><span id="l5.22">         }</span>
<a href="#l5.23"></a><span id="l5.23">         aParent.appendChild(item);</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-    }</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-    else if (aParent.localName == &quot;menulist&quot;) {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+    } else if (aParent.localName == &quot;menulist&quot;) {</span>
<a href="#l5.27"></a><span id="l5.27">         item = aParent.appendItem(aLabel, aValue);</span>
<a href="#l5.28"></a><span id="l5.28">     }</span>
<a href="#l5.29"></a><span id="l5.29">     return item;</span>
<a href="#l5.30"></a><span id="l5.30"> }</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32"> /**</span>
<a href="#l5.33"></a><span id="l5.33">  * Sets a given attribute value on the children of a passed node</span>
<a href="#l5.34"></a><span id="l5.34">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -575,19 +575,19 @@ function guessSystemTimezone() {</span>
<a href="#l6.4"></a><span id="l6.4">     // will use first of probable timezone(s) with highest score.</span>
<a href="#l6.5"></a><span id="l6.5">     var probableTZId = &quot;floating&quot;; // default fallback tz if no tz matches.</span>
<a href="#l6.6"></a><span id="l6.6">     var probableTZScore = 0;</span>
<a href="#l6.7"></a><span id="l6.7">     var probableTZSource = null;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">     const calProperties = Services.strings.createBundle(&quot;chrome://calendar/locale/calendar.properties&quot;);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     // First, try to detect operating system timezone.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+    let zoneInfoIdFromOSUserTimeZone = null;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    let osUserTimeZone = null;</span>
<a href="#l6.14"></a><span id="l6.14">     try {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-        var osUserTimeZone = null;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-        var zoneInfoIdFromOSUserTimeZone = null;</span>
<a href="#l6.17"></a><span id="l6.17">         var handler = Components.classes[&quot;@mozilla.org/network/protocol;1?name=http&quot;]</span>
<a href="#l6.18"></a><span id="l6.18">                                 .getService(Components.interfaces.nsIHttpProtocolHandler);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">         if (handler.oscpu.match(/^Windows/)) {</span>
<a href="#l6.21"></a><span id="l6.21">             var wrk = (Components</span>
<a href="#l6.22"></a><span id="l6.22">                        .classes[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l6.23"></a><span id="l6.23">                        .createInstance(Components.interfaces.nsIWindowsRegKey));</span>
<a href="#l6.24"></a><span id="l6.24">             wrk.open(wrk.ROOT_KEY_LOCAL_MACHINE,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -660,31 +660,29 @@ function categoriesArrayToString(aSorted</span>
<a href="#l7.4"></a><span id="l7.4">  * Gets the value of a string in a .properties file from the calendar bundle</span>
<a href="#l7.5"></a><span id="l7.5">  *</span>
<a href="#l7.6"></a><span id="l7.6">  * @param aBundleName  the name of the properties file.  It is assumed that the</span>
<a href="#l7.7"></a><span id="l7.7">  *                     file lives in chrome://calendar/locale/</span>
<a href="#l7.8"></a><span id="l7.8">  * @param aStringName  the name of the string within the properties file</span>
<a href="#l7.9"></a><span id="l7.9">  * @param aParams      optional array of parameters to format the string</span>
<a href="#l7.10"></a><span id="l7.10">  * @param aComponent   optional stringbundle component name</span>
<a href="#l7.11"></a><span id="l7.11">  */</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-function calGetString(aBundleName, aStringName, aParams, aComponent) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+function calGetString(aBundleName, aStringName, aParams, aComponent=&quot;calendar&quot;) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+    let propName = &quot;chrome://&quot; + aComponent + &quot;/locale/&quot; + aBundleName + &quot;.properties&quot;;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+</span>
<a href="#l7.16"></a><span id="l7.16">     try {</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-        if (!aComponent) {</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-            aComponent = &quot;calendar&quot;;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-        }</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-        var propName = &quot;chrome://&quot; + aComponent + &quot;/locale/&quot; + aBundleName + &quot;.properties&quot;;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-        var props = Services.strings.createBundle(propName);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+        let props = Services.strings.createBundle(propName);</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24">         if (aParams &amp;&amp; aParams.length) {</span>
<a href="#l7.25"></a><span id="l7.25">             return props.formatStringFromName(aStringName, aParams, aParams.length);</span>
<a href="#l7.26"></a><span id="l7.26">         } else {</span>
<a href="#l7.27"></a><span id="l7.27">             return props.GetStringFromName(aStringName);</span>
<a href="#l7.28"></a><span id="l7.28">         }</span>
<a href="#l7.29"></a><span id="l7.29">     } catch (ex) {</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-        var s = (&quot;Failed to read '&quot; + aStringName + &quot;' from &quot; + propName + &quot;.&quot;);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+        let s = (&quot;Failed to read '&quot; + aStringName + &quot;' from &quot; + propName + &quot;.&quot;);</span>
<a href="#l7.32"></a><span id="l7.32">         Components.utils.reportError(s + &quot; Error: &quot; + ex);</span>
<a href="#l7.33"></a><span id="l7.33">         return s;</span>
<a href="#l7.34"></a><span id="l7.34">     }</span>
<a href="#l7.35"></a><span id="l7.35"> }</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37"> /**</span>
<a href="#l7.38"></a><span id="l7.38">  * Make a UUID using the UUIDGenerator service available, we'll use that.</span>
<a href="#l7.39"></a><span id="l7.39">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -865,21 +865,21 @@ function saveCategories(aItem) {</span>
<a href="#l8.4"></a><span id="l8.4"> }</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> /**</span>
<a href="#l8.7"></a><span id="l8.7">  * Sets up all date related controls from the passed item</span>
<a href="#l8.8"></a><span id="l8.8">  *</span>
<a href="#l8.9"></a><span id="l8.9">  * @param item      The item to parse information out of.</span>
<a href="#l8.10"></a><span id="l8.10">  */</span>
<a href="#l8.11"></a><span id="l8.11"> function loadDateTime(item) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    let kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l8.14"></a><span id="l8.14">     if (isEvent(item)) {</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-        var startTime = item.startDate;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-        var endTime = item.endDate;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-        var duration = endTime.subtractDate(startTime);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+        let startTime = item.startDate;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+        let endTime = item.endDate;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+        let duration = endTime.subtractDate(startTime);</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22">         // Check if an all-day event has been passed in (to adapt endDate).</span>
<a href="#l8.23"></a><span id="l8.23">         if (startTime.isDate) {</span>
<a href="#l8.24"></a><span id="l8.24">             startTime = startTime.clone();</span>
<a href="#l8.25"></a><span id="l8.25">             endTime = endTime.clone();</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">             endTime.day--;</span>
<a href="#l8.28"></a><span id="l8.28">             duration.days--;</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineat">@@ -891,29 +891,29 @@ function loadDateTime(item) {</span>
<a href="#l8.30"></a><span id="l8.30">         gStartTimezone = startTime.timezone;</span>
<a href="#l8.31"></a><span id="l8.31">         gEndTimezone = endTime.timezone;</span>
<a href="#l8.32"></a><span id="l8.32">         gStartTime = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.33"></a><span id="l8.33">         gEndTime = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.34"></a><span id="l8.34">         gItemDuration = duration;</span>
<a href="#l8.35"></a><span id="l8.35">     }</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">     if (isToDo(item)) {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-        var startTime = null;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-        var endTime = null;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-        var duration = null;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-        var hasEntryDate = (item.entryDate != null);</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+        let startTime = null;</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+        let endTime = null;</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+        let duration = null;</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+        let hasEntryDate = (item.entryDate != null);</span>
<a href="#l8.48"></a><span id="l8.48">         if (hasEntryDate) {</span>
<a href="#l8.49"></a><span id="l8.49">             startTime = item.entryDate;</span>
<a href="#l8.50"></a><span id="l8.50">             gStartTimezone = startTime.timezone;</span>
<a href="#l8.51"></a><span id="l8.51">             startTime = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.52"></a><span id="l8.52">         } else {</span>
<a href="#l8.53"></a><span id="l8.53">             gStartTimezone = kDefaultTimezone;</span>
<a href="#l8.54"></a><span id="l8.54">         }</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-        var hasDueDate = (item.dueDate != null);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+        let hasDueDate = (item.dueDate != null);</span>
<a href="#l8.57"></a><span id="l8.57">         if (hasDueDate) {</span>
<a href="#l8.58"></a><span id="l8.58">             endTime = item.dueDate;</span>
<a href="#l8.59"></a><span id="l8.59">             gEndTimezone = endTime.timezone;</span>
<a href="#l8.60"></a><span id="l8.60">             endTime = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.61"></a><span id="l8.61">         } else {</span>
<a href="#l8.62"></a><span id="l8.62">             gEndTimezone = kDefaultTimezone;</span>
<a href="#l8.63"></a><span id="l8.63">         }</span>
<a href="#l8.64"></a><span id="l8.64">         if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineat">@@ -1245,26 +1245,26 @@ function getRepeatTypeAndUntilDate(aItem</span>
<a href="#l8.66"></a><span id="l8.66">                                                         &quot;BYYEARDAY&quot;,</span>
<a href="#l8.67"></a><span id="l8.67">                                                         &quot;BYWEEKNO&quot;,</span>
<a href="#l8.68"></a><span id="l8.68">                                                         &quot;BYMONTH&quot;,</span>
<a href="#l8.69"></a><span id="l8.69">                                                         &quot;BYSETPOS&quot;])) {</span>
<a href="#l8.70"></a><span id="l8.70">                             let ruleComp = rule.getComponent(&quot;BYDAY&quot;, {});</span>
<a href="#l8.71"></a><span id="l8.71">                             if (rule.interval == 1) {</span>
<a href="#l8.72"></a><span id="l8.72">                                 if (ruleComp.length &gt; 0) {</span>
<a href="#l8.73"></a><span id="l8.73">                                     if (ruleComp.length == 5) {</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-                                        for (var i = 0; i &lt; 5; i++) {</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+                                        let found = false;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+                                        for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l8.77"></a><span id="l8.77">                                             if (ruleComp[i] != i + 2) {</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+                                                found = true;</span>
<a href="#l8.79"></a><span id="l8.79">                                                 break;</span>
<a href="#l8.80"></a><span id="l8.80">                                             }</span>
<a href="#l8.81"></a><span id="l8.81">                                         }</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-                                        if (i==5) {</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-                                            if (!rule.isFinite || !rule.isByCount) {</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-                                                repeatType = &quot;every.weekday&quot;;</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-                                                updateUntilDate(rule);</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-                                            }</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+                                        if (!found &amp;&amp; (!rule.isFinite || !rule.isByCount)) {</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+                                            repeatType = &quot;every.weekday&quot;;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+                                            updateUntilDate(rule);</span>
<a href="#l8.90"></a><span id="l8.90">                                         }</span>
<a href="#l8.91"></a><span id="l8.91">                                     }</span>
<a href="#l8.92"></a><span id="l8.92">                                 } else {</span>
<a href="#l8.93"></a><span id="l8.93">                                     if (!rule.isFinite || !rule.isByCount) {</span>
<a href="#l8.94"></a><span id="l8.94">                                         repeatType = &quot;daily&quot;;</span>
<a href="#l8.95"></a><span id="l8.95">                                         updateUntilDate(rule);</span>
<a href="#l8.96"></a><span id="l8.96">                                     }</span>
<a href="#l8.97"></a><span id="l8.97">                                 }</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineat">@@ -1461,37 +1461,37 @@ function saveDialog(item) {</span>
<a href="#l8.99"></a><span id="l8.99">  */</span>
<a href="#l8.100"></a><span id="l8.100"> function saveDateTime(item) {</span>
<a href="#l8.101"></a><span id="l8.101">     var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l8.102"></a><span id="l8.102"> </span>
<a href="#l8.103"></a><span id="l8.103">     // Changes to the start date don't have to change the until date.</span>
<a href="#l8.104"></a><span id="l8.104">     untilDateCompensation(item);</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106">     if (isEvent(item)) {</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-        var startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-        var endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-        var isAllDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+        let startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+        let endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+        let isAllDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l8.113"></a><span id="l8.113">         if (isAllDay) {</span>
<a href="#l8.114"></a><span id="l8.114">             startTime = startTime.clone();</span>
<a href="#l8.115"></a><span id="l8.115">             endTime = endTime.clone();</span>
<a href="#l8.116"></a><span id="l8.116">             startTime.isDate = true;</span>
<a href="#l8.117"></a><span id="l8.117">             endTime.isDate = true;</span>
<a href="#l8.118"></a><span id="l8.118">             endTime.day += 1;</span>
<a href="#l8.119"></a><span id="l8.119">         } else {</span>
<a href="#l8.120"></a><span id="l8.120">             startTime = startTime.clone();</span>
<a href="#l8.121"></a><span id="l8.121">             startTime.isDate = false;</span>
<a href="#l8.122"></a><span id="l8.122">             endTime = endTime.clone();</span>
<a href="#l8.123"></a><span id="l8.123">             endTime.isDate = false;</span>
<a href="#l8.124"></a><span id="l8.124">         }</span>
<a href="#l8.125"></a><span id="l8.125">         setItemProperty(item, &quot;startDate&quot;, startTime);</span>
<a href="#l8.126"></a><span id="l8.126">         setItemProperty(item, &quot;endDate&quot;, endTime);</span>
<a href="#l8.127"></a><span id="l8.127">     }</span>
<a href="#l8.128"></a><span id="l8.128">     if (isToDo(item)) {</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-        var startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineminus">-        var endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+        let startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineplus">+        let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.133"></a><span id="l8.133">         setItemProperty(item, &quot;entryDate&quot;, startTime);</span>
<a href="#l8.134"></a><span id="l8.134">         setItemProperty(item, &quot;dueDate&quot;, endTime);</span>
<a href="#l8.135"></a><span id="l8.135">     }</span>
<a href="#l8.136"></a><span id="l8.136"> }</span>
<a href="#l8.137"></a><span id="l8.137"> </span>
<a href="#l8.138"></a><span id="l8.138"> /**</span>
<a href="#l8.139"></a><span id="l8.139">  * Changes the until date in the rule in order to compensate the automatic</span>
<a href="#l8.140"></a><span id="l8.140">  * correction caused by the function onStartDateChange() when saving the</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineat">@@ -2566,35 +2566,35 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l8.142"></a><span id="l8.142"> </span>
<a href="#l8.143"></a><span id="l8.143">     let repeatMenu = document.getElementById(&quot;item-repeat&quot;);</span>
<a href="#l8.144"></a><span id="l8.144">     let repeatValue = repeatMenu.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l8.145"></a><span id="l8.145">     let repeatDeck = document.getElementById(&quot;repeat-deck&quot;);</span>
<a href="#l8.146"></a><span id="l8.146"> </span>
<a href="#l8.147"></a><span id="l8.147">     if (repeatValue == 'none') {</span>
<a href="#l8.148"></a><span id="l8.148">         repeatDeck.selectedIndex = -1;</span>
<a href="#l8.149"></a><span id="l8.149">         window.recurrenceInfo = null;</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineminus">-        var item = window.calendarItem;</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+        let item = window.calendarItem;</span>
<a href="#l8.152"></a><span id="l8.152">         if (isToDo(item)) {</span>
<a href="#l8.153"></a><span id="l8.153">             enableElementWithLock(&quot;todo-has-entrydate&quot;, &quot;repeat-lock&quot;);</span>
<a href="#l8.154"></a><span id="l8.154">         }</span>
<a href="#l8.155"></a><span id="l8.155">     } else if (repeatValue == 'custom') {</span>
<a href="#l8.156"></a><span id="l8.156">         let lastRepeatDeck = repeatDeck.selectedIndex;</span>
<a href="#l8.157"></a><span id="l8.157">         repeatDeck.selectedIndex = 1;</span>
<a href="#l8.158"></a><span id="l8.158">         // the user selected custom repeat pattern. we now need to bring</span>
<a href="#l8.159"></a><span id="l8.159">         // up the appropriate dialog in order to let the user specify the</span>
<a href="#l8.160"></a><span id="l8.160">         // new rule. First of all, retrieve the item we want to specify</span>
<a href="#l8.161"></a><span id="l8.161">         // the custom repeat pattern for.</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineminus">-        var item = window.calendarItem;</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineplus">+        let item = window.calendarItem;</span>
<a href="#l8.164"></a><span id="l8.164"> </span>
<a href="#l8.165"></a><span id="l8.165">         setUpEntrydateForTask(item);</span>
<a href="#l8.166"></a><span id="l8.166"> </span>
<a href="#l8.167"></a><span id="l8.167">         // retrieve the current recurrence info, we need this</span>
<a href="#l8.168"></a><span id="l8.168">         // to find out whether or not the user really created</span>
<a href="#l8.169"></a><span id="l8.169">         // a new repeat pattern.</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineminus">-        var recurrenceInfo = window.recurrenceInfo;</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineplus">+        let recurrenceInfo = window.recurrenceInfo;</span>
<a href="#l8.172"></a><span id="l8.172"> </span>
<a href="#l8.173"></a><span id="l8.173">         // now bring up the recurrence dialog.</span>
<a href="#l8.174"></a><span id="l8.174">         // don't pop up the dialog if aSuppressDialogs was specified or if</span>
<a href="#l8.175"></a><span id="l8.175">         // called during initialization of the dialog.</span>
<a href="#l8.176"></a><span id="l8.176">         if (!aSuppressDialogs &amp;&amp; repeatMenu.hasAttribute(&quot;last-value&quot;)) {</span>
<a href="#l8.177"></a><span id="l8.177">             editRepeat();</span>
<a href="#l8.178"></a><span id="l8.178">         }</span>
<a href="#l8.179"></a><span id="l8.179"> </span>
<a href="#l8.180"></a><span id="l8.180" class="difflineat">@@ -3250,18 +3250,18 @@ function updateDateTime() {</span>
<a href="#l8.181"></a><span id="l8.181">     gIgnoreUpdate = true;</span>
<a href="#l8.182"></a><span id="l8.182"> </span>
<a href="#l8.183"></a><span id="l8.183">     let item = window.calendarItem;</span>
<a href="#l8.184"></a><span id="l8.184">     // Convert to default timezone if the timezone option</span>
<a href="#l8.185"></a><span id="l8.185">     // is *not* checked, otherwise keep the specific timezone</span>
<a href="#l8.186"></a><span id="l8.186">     // and display the labels in order to modify the timezone.</span>
<a href="#l8.187"></a><span id="l8.187">     if (gTimezonesEnabled) {</span>
<a href="#l8.188"></a><span id="l8.188">         if (isEvent(item)) {</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineminus">-          var startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-          var endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+          let startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+          let endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.193"></a><span id="l8.193"> </span>
<a href="#l8.194"></a><span id="l8.194">           setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l8.195"></a><span id="l8.195"> </span>
<a href="#l8.196"></a><span id="l8.196">           // In the case where the timezones are different but</span>
<a href="#l8.197"></a><span id="l8.197">           // the timezone of the endtime is &quot;UTC&quot;, we convert</span>
<a href="#l8.198"></a><span id="l8.198">           // the endtime into the timezone of the starttime.</span>
<a href="#l8.199"></a><span id="l8.199">           if (startTime &amp;&amp; endTime) {</span>
<a href="#l8.200"></a><span id="l8.200">             if (!compareObjects(startTime.timezone, endTime.timezone)) {</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineat">@@ -3277,20 +3277,20 @@ function updateDateTime() {</span>
<a href="#l8.202"></a><span id="l8.202">           startTime.timezone = floating();</span>
<a href="#l8.203"></a><span id="l8.203">           endTime.timezone = floating();</span>
<a href="#l8.204"></a><span id="l8.204"> </span>
<a href="#l8.205"></a><span id="l8.205">           setElementValue(&quot;event-starttime&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l8.206"></a><span id="l8.206">           setElementValue(&quot;event-endtime&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l8.207"></a><span id="l8.207">         }</span>
<a href="#l8.208"></a><span id="l8.208"> </span>
<a href="#l8.209"></a><span id="l8.209">         if (isToDo(item)) {</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineminus">-          var startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineminus">-          var endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineminus">-          var hasEntryDate = (startTime != null);</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineminus">-          var hasDueDate = (endTime != null);</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineplus">+          let startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineplus">+          let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineplus">+          let hasEntryDate = (startTime != null);</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+          let hasDueDate = (endTime != null);</span>
<a href="#l8.218"></a><span id="l8.218"> </span>
<a href="#l8.219"></a><span id="l8.219">           if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l8.220"></a><span id="l8.220">               setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l8.221"></a><span id="l8.221">               startTime.timezone = floating();</span>
<a href="#l8.222"></a><span id="l8.222">               setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l8.223"></a><span id="l8.223"> </span>
<a href="#l8.224"></a><span id="l8.224">               setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l8.225"></a><span id="l8.225">               endTime.timezone = floating();</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineat">@@ -3314,38 +3314,38 @@ function updateDateTime() {</span>
<a href="#l8.227"></a><span id="l8.227">               startTime.timezone = floating();</span>
<a href="#l8.228"></a><span id="l8.228">               endTime = startTime.clone();</span>
<a href="#l8.229"></a><span id="l8.229"> </span>
<a href="#l8.230"></a><span id="l8.230">               setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l8.231"></a><span id="l8.231">               setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l8.232"></a><span id="l8.232">           }</span>
<a href="#l8.233"></a><span id="l8.233">         }</span>
<a href="#l8.234"></a><span id="l8.234">     } else {</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineminus">-        var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineplus">+        let kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l8.237"></a><span id="l8.237"> </span>
<a href="#l8.238"></a><span id="l8.238">         if (isEvent(item)) {</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineminus">-            var startTime = gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineminus">-            var endTime = gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineplus">+            let startTime = gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.242"></a><span id="l8.242" class="difflineplus">+            let endTime = gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.243"></a><span id="l8.243">             setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l8.244"></a><span id="l8.244"> </span>
<a href="#l8.245"></a><span id="l8.245">             // before feeding the date/time value into the control we need</span>
<a href="#l8.246"></a><span id="l8.246">             // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l8.247"></a><span id="l8.247">             // automatic conversion back into the OS timezone.</span>
<a href="#l8.248"></a><span id="l8.248">             startTime.timezone = floating();</span>
<a href="#l8.249"></a><span id="l8.249">             endTime.timezone = floating();</span>
<a href="#l8.250"></a><span id="l8.250">             setElementValue(&quot;event-starttime&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l8.251"></a><span id="l8.251">             setElementValue(&quot;event-endtime&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l8.252"></a><span id="l8.252">         }</span>
<a href="#l8.253"></a><span id="l8.253"> </span>
<a href="#l8.254"></a><span id="l8.254">         if (isToDo(item)) {</span>
<a href="#l8.255"></a><span id="l8.255" class="difflineminus">-            var startTime = gStartTime &amp;&amp;</span>
<a href="#l8.256"></a><span id="l8.256" class="difflineplus">+            let startTime = gStartTime &amp;&amp;</span>
<a href="#l8.257"></a><span id="l8.257">                             gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineminus">-            var endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineminus">-            var hasEntryDate = (startTime != null);</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineminus">-            var hasDueDate = (endTime != null);</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineplus">+            let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineplus">+            let hasEntryDate = (startTime != null);</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineplus">+            let hasDueDate = (endTime != null);</span>
<a href="#l8.264"></a><span id="l8.264"> </span>
<a href="#l8.265"></a><span id="l8.265">             if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l8.266"></a><span id="l8.266">                 setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l8.267"></a><span id="l8.267">                 startTime.timezone = floating();</span>
<a href="#l8.268"></a><span id="l8.268">                 setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l8.269"></a><span id="l8.269"> </span>
<a href="#l8.270"></a><span id="l8.270">                 setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l8.271"></a><span id="l8.271">                 endTime.timezone = floating();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -650,18 +650,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">         let thisCalendar = this;</span>
<a href="#l9.6"></a><span id="l9.6">         let serializedItem = this.getSerializedItem(aItem);</span>
<a href="#l9.7"></a><span id="l9.7">         let addListener = {</span>
<a href="#l9.8"></a><span id="l9.8">             onStreamComplete: function onPutComplete(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l9.9"></a><span id="l9.9">                 let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l9.10"></a><span id="l9.10">                 let listenerStatus = Components.results.NS_OK;</span>
<a href="#l9.11"></a><span id="l9.11">                 let listenerDetail = parentItem;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+                let responseStatus;</span>
<a href="#l9.13"></a><span id="l9.13">                 try {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                    var responseStatus = request.responseStatus;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+                    responseStatus = request.responseStatus;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">                     if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.18"></a><span id="l9.18">                         let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l9.19"></a><span id="l9.19">                         cal.LOG(&quot;CalDAV: recv: &quot; + (str || &quot;&quot;));</span>
<a href="#l9.20"></a><span id="l9.20">                     }</span>
<a href="#l9.21"></a><span id="l9.21">                 } catch (ex) {</span>
<a href="#l9.22"></a><span id="l9.22">                     listenerStatus = ex.result</span>
<a href="#l9.23"></a><span id="l9.23">                     listenerDetail = &quot;Request Failed: &quot; + ex.message;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineat">@@ -771,18 +772,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.25"></a><span id="l9.25">         var modifiedItemICS = this.getSerializedItem(aNewItem);</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">         let modListener = {</span>
<a href="#l9.28"></a><span id="l9.28">             onStreamComplete: function caldav_mod_onStreamComplete(aLoader, aContext, aStatus,</span>
<a href="#l9.29"></a><span id="l9.29">                                                                    aResultLength, aResult) {</span>
<a href="#l9.30"></a><span id="l9.30">                 let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l9.31"></a><span id="l9.31">                 let listenerStatus = Components.results.NS_OK;</span>
<a href="#l9.32"></a><span id="l9.32">                 let listenerDetail = aNewItem;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+                let responseStatus;</span>
<a href="#l9.34"></a><span id="l9.34">                 try {</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-                    var responseStatus = request.responseStatus;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+                    responseStatus = request.responseStatus;</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38">                     if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.39"></a><span id="l9.39">                        let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l9.40"></a><span id="l9.40">                        cal.LOG(&quot;CalDAV: recv: &quot; + (str || &quot;&quot;));</span>
<a href="#l9.41"></a><span id="l9.41">                     }</span>
<a href="#l9.42"></a><span id="l9.42">                 } catch (ex) {</span>
<a href="#l9.43"></a><span id="l9.43">                     listenerStatus = ex.result</span>
<a href="#l9.44"></a><span id="l9.44">                     listenerDetail = &quot;Request Failed: &quot; + ex.message;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineat">@@ -898,18 +900,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.46"></a><span id="l9.46"> </span>
<a href="#l9.47"></a><span id="l9.47">         var thisCalendar = this;</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49">         let delListener = {</span>
<a href="#l9.50"></a><span id="l9.50">             onStreamComplete: function caldav_dDI_del_onStreamComplete(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l9.51"></a><span id="l9.51">                 let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l9.52"></a><span id="l9.52">                 let listenerStatus = Components.results.NS_OK;</span>
<a href="#l9.53"></a><span id="l9.53">                 let listenerDetail = aItem;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+                let responseStatus;</span>
<a href="#l9.55"></a><span id="l9.55">                 try {</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-                    var responseStatus = request.responseStatus;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+                    responseStatus = request.responseStatus;</span>
<a href="#l9.58"></a><span id="l9.58"> </span>
<a href="#l9.59"></a><span id="l9.59">                     if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.60"></a><span id="l9.60">                         let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l9.61"></a><span id="l9.61">                         cal.LOG(&quot;CalDAV: recv: &quot; + (str || &quot;&quot;));</span>
<a href="#l9.62"></a><span id="l9.62">                     }</span>
<a href="#l9.63"></a><span id="l9.63">                 } catch (ex) {</span>
<a href="#l9.64"></a><span id="l9.64">                     listenerStatus = ex.result</span>
<a href="#l9.65"></a><span id="l9.65">                     listenerDetail = &quot;Request Failed: &quot; + ex.message;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineat">@@ -967,18 +970,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.67"></a><span id="l9.67">             }</span>
<a href="#l9.68"></a><span id="l9.68">         };</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70">         let delListener2 = {</span>
<a href="#l9.71"></a><span id="l9.71">             onStreamComplete: function caldav_dDI_del2_onStreamComplete(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l9.72"></a><span id="l9.72">                 let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l9.73"></a><span id="l9.73">                 let listenerStatus = Components.results.NS_OK;</span>
<a href="#l9.74"></a><span id="l9.74">                 let listenerDetail = aItem;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+                let responseStatus;</span>
<a href="#l9.76"></a><span id="l9.76">                 try {</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-                    var responseStatus = request.responseStatus;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+                    responseStatus = request.responseStatus;</span>
<a href="#l9.79"></a><span id="l9.79"> </span>
<a href="#l9.80"></a><span id="l9.80">                     if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.81"></a><span id="l9.81">                         let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l9.82"></a><span id="l9.82">                         cal.LOG(&quot;CalDAV: recv: &quot; + (str || &quot;&quot;));</span>
<a href="#l9.83"></a><span id="l9.83">                     }</span>
<a href="#l9.84"></a><span id="l9.84">                 } catch (ex) {</span>
<a href="#l9.85"></a><span id="l9.85">                     listenerStatus = ex.result</span>
<a href="#l9.86"></a><span id="l9.86">                     listenerDetail = &quot;Request Failed: &quot; + ex.message;</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineat">@@ -1421,18 +1425,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.88"></a><span id="l9.88">             let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l9.89"></a><span id="l9.89">             if (!str) {</span>
<a href="#l9.90"></a><span id="l9.90">                 cal.LOG(&quot;CalDAV: Failed to get ctag from server for calendar &quot; +</span>
<a href="#l9.91"></a><span id="l9.91">                         thisCalendar.name);</span>
<a href="#l9.92"></a><span id="l9.92">             } else if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.93"></a><span id="l9.93">                 cal.LOG(&quot;CalDAV: recv: &quot; + str);</span>
<a href="#l9.94"></a><span id="l9.94">             }</span>
<a href="#l9.95"></a><span id="l9.95"> </span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+            let multistatus;</span>
<a href="#l9.97"></a><span id="l9.97">             try {</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineminus">-                var multistatus = cal.xml.parseString(str);</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+                multistatus = cal.xml.parseString(str);</span>
<a href="#l9.100"></a><span id="l9.100">             } catch (ex) {</span>
<a href="#l9.101"></a><span id="l9.101">                 cal.LOG(&quot;CalDAV: Failed to get ctag from server for calendar &quot; +</span>
<a href="#l9.102"></a><span id="l9.102">                         thisCalendar.name);</span>
<a href="#l9.103"></a><span id="l9.103">                 notifyListener(Components.results.NS_OK);</span>
<a href="#l9.104"></a><span id="l9.104">                 return;</span>
<a href="#l9.105"></a><span id="l9.105">             }</span>
<a href="#l9.106"></a><span id="l9.106"> </span>
<a href="#l9.107"></a><span id="l9.107">             let ctag = caldavXPathFirst(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/CS:getctag/text()&quot;);</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineat">@@ -1802,18 +1807,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.109"></a><span id="l9.109">                         thisCalendar.name);</span>
<a href="#l9.110"></a><span id="l9.110">                 thisCalendar.completeCheckServerInfo(aChangeLogListener,</span>
<a href="#l9.111"></a><span id="l9.111">                                                      Components.interfaces.calIErrors.DAV_NOT_DAV);</span>
<a href="#l9.112"></a><span id="l9.112">                 return;</span>
<a href="#l9.113"></a><span id="l9.113">             } else if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.114"></a><span id="l9.114">                 cal.LOG(&quot;CalDAV: recv: &quot; + str);</span>
<a href="#l9.115"></a><span id="l9.115">             }</span>
<a href="#l9.116"></a><span id="l9.116"> </span>
<a href="#l9.117"></a><span id="l9.117" class="difflineplus">+            let multistatus;</span>
<a href="#l9.118"></a><span id="l9.118">             try {</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-                var multistatus = cal.xml.parseString(str);</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+                multistatus = cal.xml.parseString(str);</span>
<a href="#l9.121"></a><span id="l9.121">             } catch (ex) {</span>
<a href="#l9.122"></a><span id="l9.122">                 cal.LOG(&quot;CalDAV: Failed to determine resource type for&quot; +</span>
<a href="#l9.123"></a><span id="l9.123">                         thisCalendar.name + &quot;: &quot; + ex);</span>
<a href="#l9.124"></a><span id="l9.124">                 thisCalendar.completeCheckServerInfo(aChangeLogListener,</span>
<a href="#l9.125"></a><span id="l9.125">                                                      Components.interfaces.calIErrors.DAV_NOT_DAV);</span>
<a href="#l9.126"></a><span id="l9.126">                 return;</span>
<a href="#l9.127"></a><span id="l9.127">             }</span>
<a href="#l9.128"></a><span id="l9.128"> </span>
<a href="#l9.129"></a><span id="l9.129" class="difflineat">@@ -2069,18 +2075,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.130"></a><span id="l9.130">                 cal.LOG(&quot;CalDAV: Failed to propstat principal namespace for &quot; + thisCalendar.name);</span>
<a href="#l9.131"></a><span id="l9.131">                 thisCalendar.completeCheckServerInfo(aChangeLogListener,</span>
<a href="#l9.132"></a><span id="l9.132">                                                      Components.results.NS_ERROR_FAILURE);</span>
<a href="#l9.133"></a><span id="l9.133">                 return;</span>
<a href="#l9.134"></a><span id="l9.134">             } else if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.135"></a><span id="l9.135">                 cal.LOG(&quot;CalDAV: recv: &quot; + str);</span>
<a href="#l9.136"></a><span id="l9.136">             }</span>
<a href="#l9.137"></a><span id="l9.137"> </span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+            let multistatus;</span>
<a href="#l9.139"></a><span id="l9.139">             try {</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-                var multistatus = cal.xml.parseString(str);</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+                multistatus = cal.xml.parseString(str);</span>
<a href="#l9.142"></a><span id="l9.142">             } catch (ex) {</span>
<a href="#l9.143"></a><span id="l9.143">                 cal.LOG(&quot;CalDAV: Failed to propstat principal namespace for &quot; + thisCalendar.name);</span>
<a href="#l9.144"></a><span id="l9.144">                 thisCalendar.completeCheckServerInfo(aChangeLogListener,</span>
<a href="#l9.145"></a><span id="l9.145">                                                      Components.results.NS_ERROR_FAILURE);</span>
<a href="#l9.146"></a><span id="l9.146">                 return;</span>
<a href="#l9.147"></a><span id="l9.147">             }</span>
<a href="#l9.148"></a><span id="l9.148"> </span>
<a href="#l9.149"></a><span id="l9.149">             let pcs = caldavXPath(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/D:principal-collection-set/D:href/text()&quot;);</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineat">@@ -2193,18 +2200,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.151"></a><span id="l9.151"> </span>
<a href="#l9.152"></a><span id="l9.152">             if (request.responseStatus != 207) {</span>
<a href="#l9.153"></a><span id="l9.153">                 cal.LOG(&quot;CalDAV: Bad response to in/outbox query, status &quot; +</span>
<a href="#l9.154"></a><span id="l9.154">                     request.responseStatus);</span>
<a href="#l9.155"></a><span id="l9.155">                 doesntSupportScheduling();</span>
<a href="#l9.156"></a><span id="l9.156">                 return;</span>
<a href="#l9.157"></a><span id="l9.157">             }</span>
<a href="#l9.158"></a><span id="l9.158"> </span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+            let multistatus;</span>
<a href="#l9.160"></a><span id="l9.160">             try {</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-                var multistatus = cal.xml.parseString(str);</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+                multistatus = cal.xml.parseString(str);</span>
<a href="#l9.163"></a><span id="l9.163">             } catch (ex) {</span>
<a href="#l9.164"></a><span id="l9.164">                 cal.LOG(&quot;CalDAV: Could not parse multistatus response: &quot; + ex + &quot;\n&quot; + str);</span>
<a href="#l9.165"></a><span id="l9.165">                 doesntSupportScheduling();</span>
<a href="#l9.166"></a><span id="l9.166">                 return;</span>
<a href="#l9.167"></a><span id="l9.167">             }</span>
<a href="#l9.168"></a><span id="l9.168"> </span>
<a href="#l9.169"></a><span id="l9.169">             let homeSets = caldavXPath(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/C:calendar-home-set/D:href/text()&quot;);</span>
<a href="#l9.170"></a><span id="l9.170">             function homeSetMatches(homeSet) {</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineat">@@ -2466,18 +2474,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.172"></a><span id="l9.172">             if (request.responseStatus == 200) {</span>
<a href="#l9.173"></a><span id="l9.173">                 var periodsToReturn = [];</span>
<a href="#l9.174"></a><span id="l9.174">                 var fbTypeMap = {};</span>
<a href="#l9.175"></a><span id="l9.175">                 fbTypeMap[&quot;FREE&quot;] = calIFreeBusyInterval.FREE;</span>
<a href="#l9.176"></a><span id="l9.176">                 fbTypeMap[&quot;BUSY&quot;] = calIFreeBusyInterval.BUSY;</span>
<a href="#l9.177"></a><span id="l9.177">                 fbTypeMap[&quot;BUSY-UNAVAILABLE&quot;] = calIFreeBusyInterval.BUSY_UNAVAILABLE;</span>
<a href="#l9.178"></a><span id="l9.178">                 fbTypeMap[&quot;BUSY-TENTATIVE&quot;] = calIFreeBusyInterval.BUSY_TENTATIVE;</span>
<a href="#l9.179"></a><span id="l9.179"> </span>
<a href="#l9.180"></a><span id="l9.180" class="difflineplus">+                let fbResult;</span>
<a href="#l9.181"></a><span id="l9.181">                 try {</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-                    var fbResult = cal.xml.parseString(str);</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineplus">+                    fbResult = cal.xml.parseString(str);</span>
<a href="#l9.184"></a><span id="l9.184">                 } catch (ex) {</span>
<a href="#l9.185"></a><span id="l9.185">                     cal.LOG(&quot;CalDAV: Could not parse freebusy response &quot; + ex);</span>
<a href="#l9.186"></a><span id="l9.186">                     aListener.onResult(null, null);</span>
<a href="#l9.187"></a><span id="l9.187">                     return;</span>
<a href="#l9.188"></a><span id="l9.188">                 }</span>
<a href="#l9.189"></a><span id="l9.189"> </span>
<a href="#l9.190"></a><span id="l9.190">                 let status = caldavXPathFirst(fbResult, &quot;/C:schedule-response/C:response/C:request-status/text()&quot;);</span>
<a href="#l9.191"></a><span id="l9.191">                 if (!status || status.substr(0,1) != &quot;2&quot;) {</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineat">@@ -2796,18 +2805,19 @@ calDavCalendar.prototype = {</span>
<a href="#l9.193"></a><span id="l9.193">                         if (thisCalendar.verboseLogging()) {</span>
<a href="#l9.194"></a><span id="l9.194">                             cal.LOG(&quot;CalDAV: recv: &quot; + str);</span>
<a href="#l9.195"></a><span id="l9.195">                         }</span>
<a href="#l9.196"></a><span id="l9.196">                     } else {</span>
<a href="#l9.197"></a><span id="l9.197">                         cal.LOG(&quot;CalDAV: Failed to parse iTIP response for&quot; +</span>
<a href="#l9.198"></a><span id="l9.198">                                 thisCalendar.name);</span>
<a href="#l9.199"></a><span id="l9.199">                     }</span>
<a href="#l9.200"></a><span id="l9.200"> </span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+                    let responseXML;</span>
<a href="#l9.202"></a><span id="l9.202">                     try {</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineminus">-                        var responseXML = cal.xml.parseString(str);</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+                        responseXML = cal.xml.parseString(str);</span>
<a href="#l9.205"></a><span id="l9.205">                     } catch (ex) {</span>
<a href="#l9.206"></a><span id="l9.206">                         cal.LOG(&quot;CalDAV: Could not parse multistatus response: &quot; + ex + &quot;\n&quot; + str);</span>
<a href="#l9.207"></a><span id="l9.207">                         return;</span>
<a href="#l9.208"></a><span id="l9.208">                     }</span>
<a href="#l9.209"></a><span id="l9.209"> </span>
<a href="#l9.210"></a><span id="l9.210">                     var remainingAttendees = [];</span>
<a href="#l9.211"></a><span id="l9.211">                     // TODO The following XPath expressions are currently</span>
<a href="#l9.212"></a><span id="l9.212">                     // untested code, as I don't have a caldav-sched server</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -722,32 +722,34 @@ calICSCalendar.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">                 // Error in making a daily/initial backup.</span>
<a href="#l10.5"></a><span id="l10.5">                 // not fatal, so just continue</span>
<a href="#l10.6"></a><span id="l10.6">             }</span>
<a href="#l10.7"></a><span id="l10.7">         }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">         var backupDays = Preferences.get(&quot;calendar.backup.days&quot;, 1);</span>
<a href="#l10.10"></a><span id="l10.10">         var numBackupFiles = Preferences.get(&quot;calendar.backup.filenum&quot;, 3);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+        let backupDir;</span>
<a href="#l10.13"></a><span id="l10.13">         try {</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-            var backupDir = cal.getCalendarDirectory();</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+            backupDir = cal.getCalendarDirectory();</span>
<a href="#l10.16"></a><span id="l10.16">             backupDir.append(&quot;backup&quot;);</span>
<a href="#l10.17"></a><span id="l10.17">             if (!backupDir.exists()) {</span>
<a href="#l10.18"></a><span id="l10.18">                 backupDir.create(CI.nsIFile.DIRECTORY_TYPE, parseInt(&quot;0755&quot;, 8));</span>
<a href="#l10.19"></a><span id="l10.19">             }</span>
<a href="#l10.20"></a><span id="l10.20">         } catch(e) {</span>
<a href="#l10.21"></a><span id="l10.21">             // Backup dir wasn't found. Likely because we are running in</span>
<a href="#l10.22"></a><span id="l10.22">             // xpcshell. Don't die, but continue the upload.</span>
<a href="#l10.23"></a><span id="l10.23">             cal.ERROR(&quot;[calICSCalendar] Backup failed, no backupdir:&quot; + e);</span>
<a href="#l10.24"></a><span id="l10.24">             aCallback.call(this);</span>
<a href="#l10.25"></a><span id="l10.25">             return;</span>
<a href="#l10.26"></a><span id="l10.26">         }</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+        let pseudoID;</span>
<a href="#l10.29"></a><span id="l10.29">         try {</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-            var pseudoID = this.getProperty(&quot;uniquenum2&quot;);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+            pseudoID = this.getProperty(&quot;uniquenum2&quot;);</span>
<a href="#l10.32"></a><span id="l10.32">             if (!pseudoID) {</span>
<a href="#l10.33"></a><span id="l10.33">                 pseudoID = new Date().getTime();</span>
<a href="#l10.34"></a><span id="l10.34">                 this.setProperty(&quot;uniquenum2&quot;, pseudoID);</span>
<a href="#l10.35"></a><span id="l10.35">             }</span>
<a href="#l10.36"></a><span id="l10.36">         } catch(e) {</span>
<a href="#l10.37"></a><span id="l10.37">             // calendarmgr not found. Likely because we are running in</span>
<a href="#l10.38"></a><span id="l10.38">             // xpcshell. Don't die, but continue the upload.</span>
<a href="#l10.39"></a><span id="l10.39">             cal.ERROR(&quot;[calICSCalendar] Backup failed, no calendarmanager:&quot; + e);</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineat">@@ -1009,19 +1011,20 @@ httpHooks.prototype = {</span>
<a href="#l10.41"></a><span id="l10.41">             etagListener.onStreamComplete =</span>
<a href="#l10.42"></a><span id="l10.42">                 function ics_etLoSC(aLoader, aContext, aStatus, aResultLength,</span>
<a href="#l10.43"></a><span id="l10.43">                                     aResult) {</span>
<a href="#l10.44"></a><span id="l10.44">                 var resultConverter = Components.classes[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]</span>
<a href="#l10.45"></a><span id="l10.45">                                                 .createInstance(Components</span>
<a href="#l10.46"></a><span id="l10.46">                                                 .interfaces.nsIScriptableUnicodeConverter);</span>
<a href="#l10.47"></a><span id="l10.47">                 resultConverter.charset = &quot;UTF-8&quot;;</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+                let multistatus;</span>
<a href="#l10.50"></a><span id="l10.50">                 try {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-                    var str = resultConverter.convertFromByteArray(aResult, aResultLength);</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-                    var multistatus = cal.xml.parseString(str);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+                    let str = resultConverter.convertFromByteArray(aResult, aResultLength);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+                    multistatus = cal.xml.parseString(str);</span>
<a href="#l10.55"></a><span id="l10.55">                 } catch (e) {</span>
<a href="#l10.56"></a><span id="l10.56">                     cal.LOG(&quot;[calICSCalendar] Failed to fetch channel etag&quot;);</span>
<a href="#l10.57"></a><span id="l10.57">                 }</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59">                 thisHook.mEtag = icsXPathFirst(multistatus, &quot;/D:propfind/D:response/D:propstat/D:prop/D:getetag&quot;);</span>
<a href="#l10.60"></a><span id="l10.60">                 aRespFunc();</span>
<a href="#l10.61"></a><span id="l10.61">             }</span>
<a href="#l10.62"></a><span id="l10.62">             let queryXml =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -91,19 +91,19 @@</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">       &lt;method name=&quot;fireGoEvent&quot;&gt;</span>
<a href="#l11.6"></a><span id="l11.6">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.7"></a><span id="l11.7">           var text = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-textbox&quot;);</span>
<a href="#l11.8"></a><span id="l11.8">           var date = this.parseLanguageDate(text.value);</span>
<a href="#l11.9"></a><span id="l11.9">           if (!date) {</span>
<a href="#l11.10"></a><span id="l11.10">             date = this.parseDateTime(text.value);</span>
<a href="#l11.11"></a><span id="l11.11">           }</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+          let prettyDate;</span>
<a href="#l11.13"></a><span id="l11.13">           if (date) {</span>
<a href="#l11.14"></a><span id="l11.14">             // format fails if year &lt;= 1600 on win2k, so try format first.</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-            var prettyDate;</span>
<a href="#l11.16"></a><span id="l11.16">             try {</span>
<a href="#l11.17"></a><span id="l11.17">               prettyDate = this.formatDate(date);</span>
<a href="#l11.18"></a><span id="l11.18">             } catch (ex) {} // fall thru</span>
<a href="#l11.19"></a><span id="l11.19">           }</span>
<a href="#l11.20"></a><span id="l11.20">           if (date &amp;&amp; prettyDate) {</span>
<a href="#l11.21"></a><span id="l11.21">             this.mValue = date;</span>
<a href="#l11.22"></a><span id="l11.22">             text.value = prettyDate;</span>
<a href="#l11.23"></a><span id="l11.23">             this.fireEvent(&quot;command&quot;, date);</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -139,17 +139,17 @@</span>
<a href="#l11.25"></a><span id="l11.25">            // corresponding to the nearest day in the future that is</span>
<a href="#l11.26"></a><span id="l11.26">            // that day of the week</span>
<a href="#l11.27"></a><span id="l11.27">            function getDateForDay(aWord) {</span>
<a href="#l11.28"></a><span id="l11.28">              for (var i in parser.mDayNames) {</span>
<a href="#l11.29"></a><span id="l11.29">                if (aWord != parser.mDayNames[i]) {</span>
<a href="#l11.30"></a><span id="l11.30">                  continue;</span>
<a href="#l11.31"></a><span id="l11.31">                }</span>
<a href="#l11.32"></a><span id="l11.32">                // Figure out what day of the week today is.</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-               var today = now();</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+               var today = cal.now();</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">                // i-weekday gets the offset. Add 7 to ensure that the %</span>
<a href="#l11.37"></a><span id="l11.37">                // operation stays positive.</span>
<a href="#l11.38"></a><span id="l11.38">                var offset = (i - today.weekday + 7) % 7;</span>
<a href="#l11.39"></a><span id="l11.39">                today.day = today.day + offset;</span>
<a href="#l11.40"></a><span id="l11.40">                return cal.dateTimeToJsDate(today);</span>
<a href="#l11.41"></a><span id="l11.41">              }</span>
<a href="#l11.42"></a><span id="l11.42">              return null;</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineat">@@ -1582,17 +1582,17 @@</span>
<a href="#l11.44"></a><span id="l11.44">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l11.45"></a><span id="l11.45">         &lt;body&gt;</span>
<a href="#l11.46"></a><span id="l11.46">           &lt;![CDATA[</span>
<a href="#l11.47"></a><span id="l11.47">             this.mLastDateParseIncludedTime = false;</span>
<a href="#l11.48"></a><span id="l11.48">             var tempDate = null;</span>
<a href="#l11.49"></a><span id="l11.49">             if (!this.probeSucceeded)</span>
<a href="#l11.50"></a><span id="l11.50">               return null; // avoid errors accessing uninitialized data.</span>
<a href="#l11.51"></a><span id="l11.51"> </span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-            var year = Number.MIN_VALUE; var month = -1; var day = -1; var timeString = null;</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+            var year = Number.MIN_VALUE; var month = -1; var day = -1; let timeString = null;</span>
<a href="#l11.54"></a><span id="l11.54">             if (this.alphaMonths == null) {</span>
<a href="#l11.55"></a><span id="l11.55">               // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l11.56"></a><span id="l11.56">               // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l11.57"></a><span id="l11.57">               // which do not match \w, esp. in CJK locales.)</span>
<a href="#l11.58"></a><span id="l11.58">               // (.*)? binds to null if no suffix.</span>
<a href="#l11.59"></a><span id="l11.59">               var parseNumShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)(.*)?$/;</span>
<a href="#l11.60"></a><span id="l11.60">               var dateNumbersArray = parseNumShortDateRegex.exec(aValue);</span>
<a href="#l11.61"></a><span id="l11.61">               if (dateNumbersArray != null) {</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineat">@@ -1639,17 +1639,17 @@</span>
<a href="#l11.63"></a><span id="l11.63">                 if (year &lt; currentYear - 69)</span>
<a href="#l11.64"></a><span id="l11.64">                   year += 100;</span>
<a href="#l11.65"></a><span id="l11.65">                 if (year &gt; currentYear + 30)</span>
<a href="#l11.66"></a><span id="l11.66">                   year -= 100;</span>
<a href="#l11.67"></a><span id="l11.67">               }</span>
<a href="#l11.68"></a><span id="l11.68">               // if time is also present, parse it</span>
<a href="#l11.69"></a><span id="l11.69">               var hours = 0; var minutes = 0; var seconds = 0;</span>
<a href="#l11.70"></a><span id="l11.70">               if (timeString != null) {</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-                var time = this.parseTime(dateNumbersArray[4]);</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+                var time = this.parseTime(timeString);</span>
<a href="#l11.73"></a><span id="l11.73">                 if (time != null) {</span>
<a href="#l11.74"></a><span id="l11.74">                   hours = time.getHours();</span>
<a href="#l11.75"></a><span id="l11.75">                   minutes = time.getMinutes();</span>
<a href="#l11.76"></a><span id="l11.76">                   seconds = time.getSeconds();</span>
<a href="#l11.77"></a><span id="l11.77">                   this.mLastDateParseIncludedTime = true;</span>
<a href="#l11.78"></a><span id="l11.78">                 }</span>
<a href="#l11.79"></a><span id="l11.79">               }</span>
<a href="#l11.80"></a><span id="l11.80">               tempDate = new Date(year, month, day, hours, minutes, seconds, 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -48,18 +48,18 @@ function createEventFromIcalString(icalS</span>
<a href="#l12.4"></a><span id="l12.4">                                .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l12.5"></a><span id="l12.5">         parser.parseString(icalString);</span>
<a href="#l12.6"></a><span id="l12.6">         var items = parser.getItems({});</span>
<a href="#l12.7"></a><span id="l12.7">         ASSERT(items.length == 1);</span>
<a href="#l12.8"></a><span id="l12.8">         return items[0];</span>
<a href="#l12.9"></a><span id="l12.9">     } else {</span>
<a href="#l12.10"></a><span id="l12.10">         var event = Cc[&quot;@mozilla.org/calendar/event;1&quot;].createInstance(Ci.calIEvent);</span>
<a href="#l12.11"></a><span id="l12.11">         event.icalString = icalString;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+        return event;</span>
<a href="#l12.13"></a><span id="l12.13">     }</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-    return event;</span>
<a href="#l12.15"></a><span id="l12.15"> }</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> function createTodoFromIcalString(icalString) {</span>
<a href="#l12.18"></a><span id="l12.18">     var todo = Cc[&quot;@mozilla.org/calendar/todo;1&quot;]</span>
<a href="#l12.19"></a><span id="l12.19">                .createInstance(Ci.calITodo);</span>
<a href="#l12.20"></a><span id="l12.20">     todo.icalString = icalString;</span>
<a href="#l12.21"></a><span id="l12.21">     return todo;</span>
<a href="#l12.22"></a><span id="l12.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/unit/test_attendee.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/unit/test_attendee.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -88,17 +88,17 @@ function test_values() {</span>
<a href="#l13.4"></a><span id="l13.4">     testImmutability(a2, properties);</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">     // Testing cloning</span>
<a href="#l13.7"></a><span id="l13.7">     var ec = event.clone();</span>
<a href="#l13.8"></a><span id="l13.8">     var clonedatts = ec.getAttendees({});</span>
<a href="#l13.9"></a><span id="l13.9">     var atts = event.getAttendees({});</span>
<a href="#l13.10"></a><span id="l13.10">     equal(atts.length, clonedatts.length)</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    for (i = 0; i &lt; clonedatts.length; i++) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    for (let i = 0; i &lt; clonedatts.length; i++) {</span>
<a href="#l13.14"></a><span id="l13.14">         // The attributes should not be equal</span>
<a href="#l13.15"></a><span id="l13.15">         notEqual(atts[i], clonedatts[i]);</span>
<a href="#l13.16"></a><span id="l13.16">         // But the ids should</span>
<a href="#l13.17"></a><span id="l13.17">         equal(atts[i].id, clonedatts[i].id)</span>
<a href="#l13.18"></a><span id="l13.18">     }</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">     // Make sure organizers are also cloned correctly</span>
<a href="#l13.21"></a><span id="l13.21">     let a3 = cal.createAttendee();</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

