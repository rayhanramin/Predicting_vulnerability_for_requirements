<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11005:ff603e79f92ad7b5668d0ad865987b470c2e6749</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ff603e79f92ad7b5668d0ad865987b470c2e6749" />
<meta property="og:url" content="/comm-central/rev/ff603e79f92ad7b5668d0ad865987b470c2e6749" />
<meta property="og:description" content="Bug 773151: Convert nsCAutoString-&gt;nsAutoCString (comm-central) CLOSED TREE r=bsmedberg" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ff603e79f92ad7b5668d0ad865987b470c2e6749 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ff603e79f92ad7b5668d0ad865987b470c2e6749">shortlog</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ff603e79f92ad7b5668d0ad865987b470c2e6749">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749">files</a> |
changeset |
<a href="/comm-central/raw-rev/ff603e79f92ad7b5668d0ad865987b470c2e6749">raw</a>  | <a href="/comm-central/archive/ff603e79f92ad7b5668d0ad865987b470c2e6749.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=773151">Bug 773151</a>: Convert nsCAutoString-&gt;nsAutoCString (comm-central) CLOSED TREE r=bsmedberg
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#97;&#110;&#100;&#101;&#108;&#108;&#32;&#74;&#101;&#115;&#117;&#112;&#32;&#60;&#114;&#106;&#101;&#115;&#117;&#112;&#64;&#106;&#101;&#115;&#117;&#112;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 01 Sep 2012 22:37:39 -0400</td></tr>

<tr>
 <td>changeset 11005</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ff603e79f92ad7b5668d0ad865987b470c2e6749">ff603e79f92ad7b5668d0ad865987b470c2e6749</a></td>
</tr>



<tr>
<td>parent 11004</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/25cd109a6a33231f5edd66b640ef3eba234e1a75">25cd109a6a33231f5edd66b640ef3eba234e1a75</a>
</td>
</tr>

<tr>
<td>child 11006</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8cd81ff229ebfb46b6e8f25490afd3af09672ad5">8cd81ff229ebfb46b6e8f25490afd3af09672ad5</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ff603e79f92ad7b5668d0ad865987b470c2e6749">8255</a></td></tr>
<tr><td>push user</td><td>rjesup@wgate.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 02 Sep 2012 02:40:02 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ff603e79f92a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ff603e79f92ad7b5668d0ad865987b470c2e6749">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ff603e79f92ad7b5668d0ad865987b470c2e6749&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff603e79f92ad7b5668d0ad865987b470c2e6749&newProject=comm-central&newRevision=ff603e79f92ad7b5668d0ad865987b470c2e6749&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff603e79f92ad7b5668d0ad865987b470c2e6749&newProject=comm-central&newRevision=ff603e79f92ad7b5668d0ad865987b470c2e6749&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff603e79f92ad7b5668d0ad865987b470c2e6749&newProject=comm-central&newRevision=ff603e79f92ad7b5668d0ad865987b470c2e6749&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bsmedberg%29&revcount=50">bsmedberg</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=773151">773151</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=773151">Bug 773151</a>: Convert nsCAutoString-&gt;nsAutoCString (comm-central) CLOSED TREE r=bsmedberg</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calDateTime.cpp">calendar/base/src/calDateTime.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calDateTime.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calDateTime.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calDateTime.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calDateTime.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calDateTime.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calICSService.cpp">calendar/base/src/calICSService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calICSService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calICSService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calICSService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calICSService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calICSService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceDate.cpp">calendar/base/src/calRecurrenceDate.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceDate.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceDate.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceDate.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceDate.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceDate.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceRule.cpp">calendar/base/src/calRecurrenceRule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceRule.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceRule.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceRule.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceRule.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/calendar/base/src/calRecurrenceRule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPConnection.cpp">ldap/xpcom/src/nsLDAPConnection.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPConnection.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPConnection.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPConnection.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPConnection.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPConnection.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPOperation.cpp">ldap/xpcom/src/nsLDAPOperation.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPOperation.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPOperation.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPOperation.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPOperation.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPOperation.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPService.cpp">ldap/xpcom/src/nsLDAPService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPSyncQuery.cpp">ldap/xpcom/src/nsLDAPSyncQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPSyncQuery.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPSyncQuery.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPSyncQuery.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPSyncQuery.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPSyncQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPURL.cpp">ldap/xpcom/src/nsLDAPURL.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPURL.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPURL.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPURL.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPURL.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/ldap/xpcom/src/nsLDAPURL.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">mail/components/migration/src/nsMailProfileMigratorUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsProfileMigrator.cpp">mail/components/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/shell/nsMailGNOMEIntegration.cpp">mail/components/shell/nsMailGNOMEIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/shell/nsMailGNOMEIntegration.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/shell/nsMailGNOMEIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/shell/nsMailGNOMEIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/shell/nsMailGNOMEIntegration.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mail/components/shell/nsMailGNOMEIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBSDirectory.cpp">mailnews/addrbook/src/nsAbBSDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBSDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBSDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBSDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBSDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBSDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbContentHandler.cpp">mailnews/addrbook/src/nsAbContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbDirFactoryService.cpp">mailnews/addrbook/src/nsAbDirFactoryService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbDirFactoryService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbDirFactoryService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbDirFactoryService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbDirFactoryService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbDirFactoryService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPCard.cpp">mailnews/addrbook/src/nsAbLDAPCard.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPCard.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPCard.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPCard.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPCard.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPCard.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp">mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp">mailnews/addrbook/src/nsAbLDAPDirFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp">mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp">mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp">mailnews/addrbook/src/nsAbLDAPReplicationData.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp">mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDIFService.cpp">mailnews/addrbook/src/nsAbLDIFService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDIFService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDIFService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDIFService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDIFService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbLDIFService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">mailnews/addrbook/src/nsAbMDBDirFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOSXDirectory.mm">mailnews/addrbook/src/nsAbOSXDirectory.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOSXDirectory.mm">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOSXDirectory.mm">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOSXDirectory.mm">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOSXDirectory.mm">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOSXDirectory.mm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp">mailnews/addrbook/src/nsAbOutlookDirFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">mailnews/addrbook/src/nsAbOutlookDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp">mailnews/addrbook/src/nsAbQueryStringToExpression.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbWinHelper.cpp">mailnews/addrbook/src/nsAbWinHelper.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbWinHelper.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbWinHelper.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbWinHelper.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbWinHelper.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAbWinHelper.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookUrl.cpp">mailnews/addrbook/src/nsAddbookUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookUrl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookUrl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookUrl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookUrl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddbookUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsDirPrefs.cpp">mailnews/addrbook/src/nsDirPrefs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsDirPrefs.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsDirPrefs.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsDirPrefs.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsDirPrefs.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsDirPrefs.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp">mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsVCardObj.cpp">mailnews/addrbook/src/nsVCardObj.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsVCardObj.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsVCardObj.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsVCardObj.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsVCardObj.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/addrbook/src/nsVCardObj.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgBodyHandler.cpp">mailnews/base/search/src/nsMsgBodyHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgBodyHandler.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgBodyHandler.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgBodyHandler.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgBodyHandler.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgBodyHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilter.cpp">mailnews/base/search/src/nsMsgFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchNews.cpp">mailnews/base/search/src/nsMsgSearchNews.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchNews.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchNews.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchNews.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchNews.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchNews.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/MailNewsDLF.cpp">mailnews/base/src/MailNewsDLF.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/MailNewsDLF.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/MailNewsDLF.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/MailNewsDLF.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/MailNewsDLF.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/MailNewsDLF.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerBootstrap.cpp">mailnews/base/src/nsMessengerBootstrap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerBootstrap.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerBootstrap.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerBootstrap.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerBootstrap.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerBootstrap.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerContentHandler.cpp">mailnews/base/src/nsMessengerContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMessengerContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccount.cpp">mailnews/base/src/nsMsgAccount.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccount.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccount.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccount.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccount.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccount.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCache.cpp">mailnews/base/src/nsMsgFolderCache.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCache.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCache.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCache.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCache.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCache.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCacheElement.cpp">mailnews/base/src/nsMsgFolderCacheElement.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCacheElement.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCacheElement.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCacheElement.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCacheElement.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCacheElement.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.h">mailnews/base/src/nsMsgFolderDataSource.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.h">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.h">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.h">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.h">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgFolderDataSource.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPurgeService.cpp">mailnews/base/src/nsMsgPurgeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPurgeService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPurgeService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPurgeService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPurgeService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgPurgeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgServiceProvider.cpp">mailnews/base/src/nsMsgServiceProvider.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgServiceProvider.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgServiceProvider.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgServiceProvider.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgServiceProvider.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgServiceProvider.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgTagService.cpp">mailnews/base/src/nsMsgTagService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgTagService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgTagService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgTagService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgTagService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgTagService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgXFViewThread.cpp">mailnews/base/src/nsMsgXFViewThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgXFViewThread.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgXFViewThread.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgXFViewThread.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgXFViewThread.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsMsgXFViewThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSubscribableServer.cpp">mailnews/base/src/nsSubscribableServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSubscribableServer.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSubscribableServer.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSubscribableServer.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSubscribableServer.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/src/nsSubscribableServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIdentity.cpp">mailnews/base/util/nsMsgIdentity.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIdentity.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIdentity.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIdentity.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIdentity.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIdentity.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">mailnews/compose/src/nsMsgAppleDoubleEncode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleEncode.cpp">mailnews/compose/src/nsMsgAppleEncode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleEncode.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleEncode.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleEncode.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleEncode.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAppleEncode.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachment.cpp">mailnews/compose/src/nsMsgAttachment.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachment.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachment.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachment.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachment.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachment.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompFields.cpp">mailnews/compose/src/nsMsgCompFields.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompFields.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompFields.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompFields.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompFields.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompFields.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgQuote.cpp">mailnews/compose/src/nsMsgQuote.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgQuote.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgQuote.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgQuote.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgQuote.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgQuote.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpUrl.cpp">mailnews/compose/src/nsSmtpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpUrl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpUrl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsSmtpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsURLFetcher.cpp">mailnews/compose/src/nsURLFetcher.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsURLFetcher.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsURLFetcher.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsURLFetcher.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsURLFetcher.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/compose/src/nsURLFetcher.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/public/nsMsgHdr.h">mailnews/db/msgdb/public/nsMsgHdr.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/public/nsMsgHdr.h">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/public/nsMsgHdr.h">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/public/nsMsgHdr.h">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/public/nsMsgHdr.h">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/public/nsMsgHdr.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgHdr.cpp">mailnews/db/msgdb/src/nsMsgHdr.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgHdr.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgHdr.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgHdr.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgHdr.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgHdr.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp">mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsAutoSyncState.cpp">mailnews/imap/src/nsAutoSyncState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsAutoSyncState.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsAutoSyncState.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsAutoSyncState.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsAutoSyncState.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsAutoSyncState.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.h">mailnews/imap/src/nsImapIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.h">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.h">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapOfflineSync.cpp">mailnews/imap/src/nsImapOfflineSync.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapOfflineSync.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapOfflineSync.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapOfflineSync.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapOfflineSync.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapOfflineSync.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.cpp">mailnews/imap/src/nsImapServerResponseParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.h">mailnews/imap/src/nsImapServerResponseParser.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.h">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.h">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.h">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.h">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapServerResponseParser.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUndoTxn.cpp">mailnews/imap/src/nsImapUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUrl.cpp">mailnews/imap/src/nsImapUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUrl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUrl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUrl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUrl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUtils.cpp">mailnews/imap/src/nsImapUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/imap/src/nsImapUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">mailnews/import/applemail/src/nsEmlxHelperUtils.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraAddress.cpp">mailnews/import/eudora/src/nsEudoraAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraAddress.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraAddress.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraAddress.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraAddress.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraFilters.cpp">mailnews/import/eudora/src/nsEudoraFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraFilters.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraFilters.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraFilters.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraFilters.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.cpp">mailnews/import/eudora/src/nsEudoraMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.h">mailnews/import/eudora/src/nsEudoraMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.h">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.h">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.h">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.h">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraWin32.cpp">mailnews/import/eudora/src/nsEudoraWin32.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraWin32.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraWin32.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraWin32.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraWin32.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/eudora/src/nsEudoraWin32.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOE5File.cpp">mailnews/import/oexpress/nsOE5File.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOE5File.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOE5File.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOE5File.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOE5File.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOE5File.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOEScanBoxes.cpp">mailnews/import/oexpress/nsOEScanBoxes.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOEScanBoxes.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOEScanBoxes.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOEScanBoxes.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOEScanBoxes.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOEScanBoxes.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOESettings.cpp">mailnews/import/oexpress/nsOESettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOESettings.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOESettings.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOESettings.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOESettings.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/oexpress/nsOESettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookMail.cpp">mailnews/import/outlook/src/nsOutlookMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookMail.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookMail.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookMail.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookMail.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookSettings.cpp">mailnews/import/outlook/src/nsOutlookSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookSettings.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookSettings.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookSettings.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookSettings.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/outlook/src/nsOutlookSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/src/nsImportAddressBooks.cpp">mailnews/import/src/nsImportAddressBooks.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/src/nsImportAddressBooks.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/src/nsImportAddressBooks.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/src/nsImportAddressBooks.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/src/nsImportAddressBooks.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/src/nsImportAddressBooks.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/text/src/nsTextAddress.cpp">mailnews/import/text/src/nsTextAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/text/src/nsTextAddress.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/text/src/nsTextAddress.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/text/src/nsTextAddress.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/text/src/nsTextAddress.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/text/src/nsTextAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/winlivemail/nsWMSettings.cpp">mailnews/import/winlivemail/nsWMSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/winlivemail/nsWMSettings.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/winlivemail/nsWMSettings.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/winlivemail/nsWMSettings.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/winlivemail/nsWMSettings.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/import/winlivemail/nsWMSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalUtils.cpp">mailnews/local/src/nsLocalUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsLocalUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxProtocol.cpp">mailnews/local/src/nsMailboxProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxService.cpp">mailnews/local/src/nsMailboxService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxUrl.cpp">mailnews/local/src/nsMailboxUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxUrl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxUrl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxUrl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxUrl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMailboxUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgBrkMBoxStore.cpp">mailnews/local/src/nsMsgBrkMBoxStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgBrkMBoxStore.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgBrkMBoxStore.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgBrkMBoxStore.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgBrkMBoxStore.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgBrkMBoxStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgLocalStoreUtils.cpp">mailnews/local/src/nsMsgLocalStoreUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgLocalStoreUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgLocalStoreUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgLocalStoreUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgLocalStoreUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgLocalStoreUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgMaildirStore.cpp">mailnews/local/src/nsMsgMaildirStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgMaildirStore.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgMaildirStore.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgMaildirStore.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgMaildirStore.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsMsgMaildirStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/Registry.cpp">mailnews/mapi/mapihook/src/Registry.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/Registry.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/Registry.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/Registry.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/Registry.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/Registry.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiHook.cpp">mailnews/mapi/mapihook/src/msgMapiHook.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiHook.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiHook.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiHook.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiHook.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiHook.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiImp.cpp">mailnews/mapi/mapihook/src/msgMapiImp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiImp.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiImp.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiImp.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiImp.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mapi/mapihook/src/msgMapiImp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">mailnews/mime/cthandlers/vcard/mimevcrd.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/cthandlers/vcard/mimevcrd.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/comi18n.cpp">mailnews/mime/src/comi18n.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/comi18n.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/comi18n.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/comi18n.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/comi18n.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/comi18n.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimecms.cpp">mailnews/mime/src/mimecms.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimecms.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimecms.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimecms.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimecms.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimecms.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimedrft.cpp">mailnews/mime/src/mimedrft.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimedrft.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimedrft.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimedrft.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimedrft.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimedrft.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimehdrs.cpp">mailnews/mime/src/mimehdrs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimehdrs.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimehdrs.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimehdrs.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimehdrs.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimehdrs.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimei.cpp">mailnews/mime/src/mimei.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimei.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimei.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimei.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimei.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimei.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeiimg.cpp">mailnews/mime/src/mimeiimg.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeiimg.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeiimg.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeiimg.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeiimg.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeiimg.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemcms.cpp">mailnews/mime/src/mimemcms.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemcms.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemcms.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemcms.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemcms.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemcms.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemrel.cpp">mailnews/mime/src/mimemrel.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemrel.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemrel.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemrel.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemrel.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemrel.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemsg.cpp">mailnews/mime/src/mimemsg.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemsg.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemsg.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemsg.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemsg.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemsg.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemult.cpp">mailnews/mime/src/mimemult.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemult.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemult.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemult.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemult.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimemult.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeobj.cpp">mailnews/mime/src/mimeobj.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeobj.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeobj.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeobj.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeobj.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimeobj.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethsa.cpp">mailnews/mime/src/mimethsa.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethsa.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethsa.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethsa.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethsa.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethsa.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethtm.cpp">mailnews/mime/src/mimethtm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethtm.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethtm.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethtm.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethtm.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimethtm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpfl.cpp">mailnews/mime/src/mimetpfl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpfl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpfl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpfl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpfl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpfl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpla.cpp">mailnews/mime/src/mimetpla.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpla.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpla.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpla.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpla.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/mimetpla.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/nsStreamConverter.cpp">mailnews/mime/src/nsStreamConverter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/nsStreamConverter.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/nsStreamConverter.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/nsStreamConverter.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/nsStreamConverter.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/mime/src/nsStreamConverter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsUtils.cpp">mailnews/news/src/nsNewsUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNewsUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpUrl.cpp">mailnews/news/src/nsNntpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpUrl.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpUrl.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/mailnews/news/src/nsNntpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/feeds/src/nsFeedSniffer.cpp">suite/feeds/src/nsFeedSniffer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/feeds/src/nsFeedSniffer.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/feeds/src/nsFeedSniffer.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/feeds/src/nsFeedSniffer.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/feeds/src/nsFeedSniffer.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/feeds/src/nsFeedSniffer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsProfileMigrator.cpp">suite/profile/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">file</a> |
<a href="/comm-central/annotate/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">annotate</a> |
<a href="/comm-central/diff/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">diff</a> |
<a href="/comm-central/comparison/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">comparison</a> |
<a href="/comm-central/log/ff603e79f92ad7b5668d0ad865987b470c2e6749/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/src/calDateTime.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/src/calDateTime.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -197,17 +197,17 @@ calDateTime::SubtractDate(calIDateTime *</span>
<a href="#l1.4"></a><span id="l1.4">     CAL_ENSURE_MEMORY(dur);</span>
<a href="#l1.5"></a><span id="l1.5">     NS_ADDREF(*aDuration = dur);</span>
<a href="#l1.6"></a><span id="l1.6">     return NS_OK;</span>
<a href="#l1.7"></a><span id="l1.7"> }</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> NS_IMETHODIMP</span>
<a href="#l1.10"></a><span id="l1.10"> calDateTime::ToString(nsACString &amp; aResult)</span>
<a href="#l1.11"></a><span id="l1.11"> {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    nsCAutoString tzid;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    nsAutoCString tzid;</span>
<a href="#l1.14"></a><span id="l1.14">     char buffer[256];</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">     ensureTimezone();</span>
<a href="#l1.17"></a><span id="l1.17">     mTimezone-&gt;GetTzid(tzid);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">     uint32_t const length = PR_snprintf(</span>
<a href="#l1.20"></a><span id="l1.20">         buffer, sizeof(buffer), &quot;%04hd/%02hd/%02hd %02hd:%02hd:%02hd %s isDate=%01hd nativeTime=%lld&quot;,</span>
<a href="#l1.21"></a><span id="l1.21">         mYear, mMonth + 1, mDay, mHour, mMinute, mSecond,</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -476,23 +476,23 @@ void calDateTime::FromIcalTime(icaltimet</span>
<a href="#l1.23"></a><span id="l1.23">     } else {</span>
<a href="#l1.24"></a><span id="l1.24">         mTimezone = cal::detectTimezone(t, nullptr);</span>
<a href="#l1.25"></a><span id="l1.25">     }</span>
<a href="#l1.26"></a><span id="l1.26"> #if defined(DEBUG)</span>
<a href="#l1.27"></a><span id="l1.27">     if (mTimezone) {</span>
<a href="#l1.28"></a><span id="l1.28">         if (t.is_utc) {</span>
<a href="#l1.29"></a><span id="l1.29">             NS_ASSERTION(SameCOMIdentity(mTimezone, cal::UTC()), &quot;UTC mismatch!&quot;);</span>
<a href="#l1.30"></a><span id="l1.30">         } else if (!t.zone) {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-            nsCAutoString tzid;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+            nsAutoCString tzid;</span>
<a href="#l1.33"></a><span id="l1.33">             mTimezone-&gt;GetTzid(tzid);</span>
<a href="#l1.34"></a><span id="l1.34">             if (tzid.EqualsLiteral(&quot;floating&quot;)) {</span>
<a href="#l1.35"></a><span id="l1.35">                 NS_ASSERTION(SameCOMIdentity(mTimezone, cal::floating()), &quot;floating mismatch!&quot;);</span>
<a href="#l1.36"></a><span id="l1.36">             }</span>
<a href="#l1.37"></a><span id="l1.37">         } else {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-            nsCAutoString tzid;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+            nsAutoCString tzid;</span>
<a href="#l1.40"></a><span id="l1.40">             mTimezone-&gt;GetTzid(tzid);</span>
<a href="#l1.41"></a><span id="l1.41">             NS_ASSERTION(tzid.Equals(icaltimezone_get_tzid(const_cast&lt;icaltimezone *&gt;(t.zone))),</span>
<a href="#l1.42"></a><span id="l1.42">                          &quot;tzid mismatch!&quot;);</span>
<a href="#l1.43"></a><span id="l1.43">         }</span>
<a href="#l1.44"></a><span id="l1.44">     }</span>
<a href="#l1.45"></a><span id="l1.45"> #endif</span>
<a href="#l1.46"></a><span id="l1.46"> </span>
<a href="#l1.47"></a><span id="l1.47">     mWeekday = static_cast&lt;int16_t&gt;(icaltime_day_of_week(t) - 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/src/calICSService.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/src/calICSService.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -468,17 +468,17 @@ calIcalComponent::~calIcalComponent()</span>
<a href="#l2.4"></a><span id="l2.4">         }</span>
<a href="#l2.5"></a><span id="l2.5">     }</span>
<a href="#l2.6"></a><span id="l2.6"> }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> NS_IMETHODIMP</span>
<a href="#l2.9"></a><span id="l2.9"> calIcalComponent::AddTimezoneReference(calITimezone *aTimezone)</span>
<a href="#l2.10"></a><span id="l2.10"> {</span>
<a href="#l2.11"></a><span id="l2.11">     NS_ENSURE_ARG_POINTER(aTimezone);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    nsCAutoString tzid;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    nsAutoCString tzid;</span>
<a href="#l2.14"></a><span id="l2.14">     nsresult rv = aTimezone-&gt;GetTzid(tzid);</span>
<a href="#l2.15"></a><span id="l2.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.16"></a><span id="l2.16">     mReferencedTimezones.Put(tzid, aTimezone);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">     return NS_OK;</span>
<a href="#l2.19"></a><span id="l2.19"> }</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> static PLDHashOperator</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -743,17 +743,17 @@ nsresult calIcalProperty::setDatetime_(c</span>
<a href="#l2.23"></a><span id="l2.23">                 NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.24"></a><span id="l2.24">                 icalparameter * const param = icalparameter_new_from_value_string(</span>
<a href="#l2.25"></a><span id="l2.25">                     ICAL_TZID_PARAMETER, icaltimezone_get_tzid(const_cast&lt;icaltimezone *&gt;(itt.zone)));</span>
<a href="#l2.26"></a><span id="l2.26">                 icalproperty_set_parameter(prop, param);</span>
<a href="#l2.27"></a><span id="l2.27">             } else { // either floating or phantom:</span>
<a href="#l2.28"></a><span id="l2.28">                 bool b = false;</span>
<a href="#l2.29"></a><span id="l2.29">                 if (NS_FAILED(tz-&gt;GetIsFloating(&amp;b)) || !b) {</span>
<a href="#l2.30"></a><span id="l2.30">                     // restore the same phantom TZID:</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-                    nsCAutoString tzid;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+                    nsAutoCString tzid;</span>
<a href="#l2.33"></a><span id="l2.33">                     rv = tz-&gt;GetTzid(tzid);</span>
<a href="#l2.34"></a><span id="l2.34">                     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.35"></a><span id="l2.35">                     icalparameter * const param = icalparameter_new_from_value_string(ICAL_TZID_PARAMETER,</span>
<a href="#l2.36"></a><span id="l2.36">                                                                                       tzid.get());</span>
<a href="#l2.37"></a><span id="l2.37">                     icalproperty_set_parameter(prop, param);</span>
<a href="#l2.38"></a><span id="l2.38">                 }</span>
<a href="#l2.39"></a><span id="l2.39">             }</span>
<a href="#l2.40"></a><span id="l2.40">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceDate.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceDate.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -181,17 +181,17 @@ calRecurrenceDate::GetIcalProperty(calII</span>
<a href="#l3.4"></a><span id="l3.4">     return (*aProp)-&gt;SetValueAsDatetime(mDate);</span>
<a href="#l3.5"></a><span id="l3.5"> }</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> NS_IMETHODIMP</span>
<a href="#l3.8"></a><span id="l3.8"> calRecurrenceDate::SetIcalProperty(calIIcalProperty *aProp)</span>
<a href="#l3.9"></a><span id="l3.9"> {</span>
<a href="#l3.10"></a><span id="l3.10">     NS_ENSURE_ARG_POINTER(aProp);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    nsCAutoString name;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    nsAutoCString name;</span>
<a href="#l3.14"></a><span id="l3.14">     nsresult rc = aProp-&gt;GetPropertyName(name);</span>
<a href="#l3.15"></a><span id="l3.15">     if (NS_FAILED(rc))</span>
<a href="#l3.16"></a><span id="l3.16">         return rc;</span>
<a href="#l3.17"></a><span id="l3.17">     if (name.EqualsLiteral(&quot;RDATE&quot;)) {</span>
<a href="#l3.18"></a><span id="l3.18">         mIsNegative = false;</span>
<a href="#l3.19"></a><span id="l3.19">         icalvalue * const value = icalproperty_get_value(aProp-&gt;GetIcalProperty());</span>
<a href="#l3.20"></a><span id="l3.20">         if (icalvalue_isa(value) == ICAL_PERIOD_VALUE) {</span>
<a href="#l3.21"></a><span id="l3.21">             icalperiodtype const period = icalvalue_get_period(value);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceRule.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceRule.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -398,17 +398,17 @@ calRecurrenceRule::GetOccurrences(calIDa</span>
<a href="#l4.4"></a><span id="l4.4">     if (!aMaxCount &amp;&amp; !aRangeEnd &amp;&amp; mIcalRecur.count == 0 &amp;&amp; icaltime_is_null_time(mIcalRecur.until))</span>
<a href="#l4.5"></a><span id="l4.5">         return NS_ERROR_INVALID_ARG;</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">     nsCOMArray&lt;calIDateTime&gt; dates;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> #ifdef DEBUG_dbo</span>
<a href="#l4.10"></a><span id="l4.10">     {</span>
<a href="#l4.11"></a><span id="l4.11">         char const * const ss = icalrecurrencetype_as_string(&amp;mIcalRecur);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-        nsCAutoString tst, tend;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+        nsAutoCString tst, tend;</span>
<a href="#l4.14"></a><span id="l4.14">         aRangeStart-&gt;ToString(tst);</span>
<a href="#l4.15"></a><span id="l4.15">         aRangeEnd-&gt;ToString(tend);</span>
<a href="#l4.16"></a><span id="l4.16">         printf(&quot;RULE: [%s -&gt; %s, %d]: %s\n&quot;, tst.get(), tend.get(), mIcalRecur.count, ss);</span>
<a href="#l4.17"></a><span id="l4.17">     }</span>
<a href="#l4.18"></a><span id="l4.18"> #endif</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">     struct icaltimetype rangestart, dtstart, dtend;</span>
<a href="#l4.21"></a><span id="l4.21">     aRangeStart-&gt;ToIcalTime(&amp;rangestart);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -455,17 +455,17 @@ calRecurrenceRule::GetOccurrences(calIDa</span>
<a href="#l4.23"></a><span id="l4.23">         if (!cdt) {</span>
<a href="#l4.24"></a><span id="l4.24">             icalrecur_iterator_free(recur_iter);</span>
<a href="#l4.25"></a><span id="l4.25">             return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l4.26"></a><span id="l4.26">         }</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">         dates.AppendObject(cdt);</span>
<a href="#l4.29"></a><span id="l4.29"> #ifdef DEBUG_dbo</span>
<a href="#l4.30"></a><span id="l4.30">         {</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-            nsCAutoString str;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+            nsAutoCString str;</span>
<a href="#l4.33"></a><span id="l4.33">             cdt-&gt;ToString(str);</span>
<a href="#l4.34"></a><span id="l4.34">             printf(&quot;  occ: %s\n&quot;, str.get());</span>
<a href="#l4.35"></a><span id="l4.35">         }</span>
<a href="#l4.36"></a><span id="l4.36"> #endif</span>
<a href="#l4.37"></a><span id="l4.37">         count++;</span>
<a href="#l4.38"></a><span id="l4.38">         if (aMaxCount &amp;&amp; aMaxCount &lt;= count)</span>
<a href="#l4.39"></a><span id="l4.39">             break;</span>
<a href="#l4.40"></a><span id="l4.40">     }</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -510,17 +510,17 @@ calRecurrenceRule::GetIcalProperty(calII</span>
<a href="#l4.42"></a><span id="l4.42"> NS_IMETHODIMP</span>
<a href="#l4.43"></a><span id="l4.43"> calRecurrenceRule::SetIcalProperty(calIIcalProperty *aProp)</span>
<a href="#l4.44"></a><span id="l4.44"> {</span>
<a href="#l4.45"></a><span id="l4.45">     NS_ENSURE_ARG_POINTER(aProp);</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">     if (mImmutable)</span>
<a href="#l4.48"></a><span id="l4.48">         return NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-    nsCAutoString propname;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+    nsAutoCString propname;</span>
<a href="#l4.52"></a><span id="l4.52">     nsresult rv = aProp-&gt;GetPropertyName(propname);</span>
<a href="#l4.53"></a><span id="l4.53">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.54"></a><span id="l4.54">     if (propname.EqualsLiteral(&quot;RRULE&quot;))</span>
<a href="#l4.55"></a><span id="l4.55">         mIsNegative = false;</span>
<a href="#l4.56"></a><span id="l4.56">     else if (propname.EqualsLiteral(&quot;EXRULE&quot;))</span>
<a href="#l4.57"></a><span id="l4.57">         mIsNegative = true;</span>
<a href="#l4.58"></a><span id="l4.58">     else</span>
<a href="#l4.59"></a><span id="l4.59">         return NS_ERROR_INVALID_ARG;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -682,17 +682,17 @@ NS_IMETHODIMP nsLDAPConnectionRunnable::</span>
<a href="#l5.4"></a><span id="l5.4">           int32_t errorCode;</span>
<a href="#l5.5"></a><span id="l5.5">           msg-&gt;GetErrorCode(&amp;errorCode);</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">           // maybe a version error, e.g., using v3 on a v2 server.</span>
<a href="#l5.8"></a><span id="l5.8">           // if we're using v3, try v2.</span>
<a href="#l5.9"></a><span id="l5.9">           if (errorCode == LDAP_PROTOCOL_ERROR &amp;&amp;</span>
<a href="#l5.10"></a><span id="l5.10">               mConnection-&gt;mVersion == nsILDAPConnection::VERSION3)</span>
<a href="#l5.11"></a><span id="l5.11">           {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-            nsCAutoString password;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+            nsAutoCString password;</span>
<a href="#l5.14"></a><span id="l5.14">             mConnection-&gt;mVersion = nsILDAPConnection::VERSION2;</span>
<a href="#l5.15"></a><span id="l5.15">             ldap_set_option(mConnection-&gt;mConnectionHandle,</span>
<a href="#l5.16"></a><span id="l5.16">                             LDAP_OPT_PROTOCOL_VERSION, &amp;mConnection-&gt;mVersion);</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">             if (NS_SUCCEEDED(rv))</span>
<a href="#l5.19"></a><span id="l5.19">             {</span>
<a href="#l5.20"></a><span id="l5.20">               // We don't want to notify callers that we are done, so</span>
<a href="#l5.21"></a><span id="l5.21">               // redispatch the runnable.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPOperation.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPOperation.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -164,17 +164,17 @@ nsLDAPOperation::GetMessageListener(nsIL</span>
<a href="#l6.4"></a><span id="l6.4"> }</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> NS_IMETHODIMP</span>
<a href="#l6.7"></a><span id="l6.7"> nsLDAPOperation::SaslBind(const nsACString &amp;service,</span>
<a href="#l6.8"></a><span id="l6.8">                           const nsACString &amp;mechanism,</span>
<a href="#l6.9"></a><span id="l6.9">                           nsIAuthModule *authModule)</span>
<a href="#l6.10"></a><span id="l6.10"> {</span>
<a href="#l6.11"></a><span id="l6.11">   nsresult rv;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  nsCAutoString bindName;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  nsAutoCString bindName;</span>
<a href="#l6.14"></a><span id="l6.14">   struct berval creds;</span>
<a href="#l6.15"></a><span id="l6.15">   unsigned int credlen;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">   mAuthModule = authModule;</span>
<a href="#l6.18"></a><span id="l6.18">   mMechanism.Assign(mechanism);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">   rv = mConnection-&gt;GetBindName(bindName);</span>
<a href="#l6.21"></a><span id="l6.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -207,17 +207,17 @@ nsLDAPOperation::SaslBind(const nsACStri</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">   return rv;</span>
<a href="#l6.25"></a><span id="l6.25"> }</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27"> NS_IMETHODIMP</span>
<a href="#l6.28"></a><span id="l6.28"> nsLDAPOperation::SaslStep(const char *token, uint32_t tokenLen)</span>
<a href="#l6.29"></a><span id="l6.29"> {</span>
<a href="#l6.30"></a><span id="l6.30">   nsresult rv;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  nsCAutoString bindName;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  nsAutoCString bindName;</span>
<a href="#l6.33"></a><span id="l6.33">   struct berval clientCreds;</span>
<a href="#l6.34"></a><span id="l6.34">   struct berval serverCreds;</span>
<a href="#l6.35"></a><span id="l6.35">   unsigned int credlen;</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37">   rv = mConnection-&gt;RemovePendingOperation(mMsgID);</span>
<a href="#l6.38"></a><span id="l6.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">   serverCreds.bv_val = (char *) token;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -256,17 +256,17 @@ nsLDAPOperation::SaslStep(const char *to</span>
<a href="#l6.42"></a><span id="l6.42"> NS_IMETHODIMP</span>
<a href="#l6.43"></a><span id="l6.43"> nsLDAPOperation::SimpleBind(const nsACString&amp; passwd)</span>
<a href="#l6.44"></a><span id="l6.44"> {</span>
<a href="#l6.45"></a><span id="l6.45">     nsRefPtr&lt;nsLDAPConnection&gt; connection = mConnection;</span>
<a href="#l6.46"></a><span id="l6.46">     // There is a possibilty that mConnection can be cleared by another</span>
<a href="#l6.47"></a><span id="l6.47">     // thread. Grabbing a local reference to mConnection may avoid this.</span>
<a href="#l6.48"></a><span id="l6.48">     // See https://bugzilla.mozilla.org/show_bug.cgi?id=557928#c1</span>
<a href="#l6.49"></a><span id="l6.49">     nsresult rv;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-    nsCAutoString bindName;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+    nsAutoCString bindName;</span>
<a href="#l6.52"></a><span id="l6.52">     int32_t originalMsgID = mMsgID;</span>
<a href="#l6.53"></a><span id="l6.53">     // Ugly hack alert:</span>
<a href="#l6.54"></a><span id="l6.54">     // the first time we get called with a passwd, remember it.</span>
<a href="#l6.55"></a><span id="l6.55">     // Then, if we get called again w/o a password, use the</span>
<a href="#l6.56"></a><span id="l6.56">     // saved one. Getting called again means we're trying to</span>
<a href="#l6.57"></a><span id="l6.57">     // fall back to VERSION2.</span>
<a href="#l6.58"></a><span id="l6.58">     // Since LDAP operations are thrown away when done, it won't stay</span>
<a href="#l6.59"></a><span id="l6.59">     // around in memory.</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineat">@@ -605,17 +605,17 @@ nsLDAPOperation::AddExt(const char *base</span>
<a href="#l6.61"></a><span id="l6.61">   if (mods &amp;&amp; modCount) {</span>
<a href="#l6.62"></a><span id="l6.62">     attrs = static_cast&lt;LDAPMod **&gt;(nsMemory::Alloc((modCount + 1) *</span>
<a href="#l6.63"></a><span id="l6.63">                                                        sizeof(LDAPMod *)));</span>
<a href="#l6.64"></a><span id="l6.64">     if (!attrs) {</span>
<a href="#l6.65"></a><span id="l6.65">       NS_ERROR(&quot;nsLDAPOperation::AddExt: out of memory &quot;);</span>
<a href="#l6.66"></a><span id="l6.66">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l6.67"></a><span id="l6.67">     }</span>
<a href="#l6.68"></a><span id="l6.68"> </span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-    nsCAutoString type;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+    nsAutoCString type;</span>
<a href="#l6.71"></a><span id="l6.71">     uint32_t index;</span>
<a href="#l6.72"></a><span id="l6.72">     for (index = 0; index &lt; modCount &amp;&amp; NS_SUCCEEDED(rv); ++index) {</span>
<a href="#l6.73"></a><span id="l6.73">       attrs[index] = new LDAPMod();</span>
<a href="#l6.74"></a><span id="l6.74"> </span>
<a href="#l6.75"></a><span id="l6.75">       if (!attrs[index])</span>
<a href="#l6.76"></a><span id="l6.76">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l6.77"></a><span id="l6.77"> </span>
<a href="#l6.78"></a><span id="l6.78">       nsCOMPtr&lt;nsILDAPModification&gt; modif(do_QueryElementAt(mods, index, &amp;rv));</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineat">@@ -769,17 +769,17 @@ nsLDAPOperation::ModifyExt(const char *b</span>
<a href="#l6.80"></a><span id="l6.80">   if (modCount &amp;&amp; mods) {</span>
<a href="#l6.81"></a><span id="l6.81">     attrs = static_cast&lt;LDAPMod **&gt;(nsMemory::Alloc((modCount + 1) *</span>
<a href="#l6.82"></a><span id="l6.82">                                                        sizeof(LDAPMod *)));</span>
<a href="#l6.83"></a><span id="l6.83">     if (!attrs) {</span>
<a href="#l6.84"></a><span id="l6.84">       NS_ERROR(&quot;nsLDAPOperation::ModifyExt: out of memory &quot;);</span>
<a href="#l6.85"></a><span id="l6.85">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l6.86"></a><span id="l6.86">     }</span>
<a href="#l6.87"></a><span id="l6.87"> </span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-    nsCAutoString type;</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+    nsAutoCString type;</span>
<a href="#l6.90"></a><span id="l6.90">     uint32_t index;</span>
<a href="#l6.91"></a><span id="l6.91">     for (index = 0; index &lt; modCount &amp;&amp; NS_SUCCEEDED(rv); ++index) {</span>
<a href="#l6.92"></a><span id="l6.92">       attrs[index] = new LDAPMod();</span>
<a href="#l6.93"></a><span id="l6.93">       if (!attrs[index])</span>
<a href="#l6.94"></a><span id="l6.94">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l6.95"></a><span id="l6.95"> </span>
<a href="#l6.96"></a><span id="l6.96">       nsCOMPtr&lt;nsILDAPModification&gt; modif(do_QueryElementAt(mods, index, &amp;rv));</span>
<a href="#l6.97"></a><span id="l6.97">       if (NS_FAILED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -611,18 +611,18 @@ nsresult</span>
<a href="#l7.4"></a><span id="l7.4"> nsLDAPService::EstablishConnection(nsLDAPServiceEntry *aEntry,</span>
<a href="#l7.5"></a><span id="l7.5">                                    nsILDAPMessageListener *aListener)</span>
<a href="#l7.6"></a><span id="l7.6"> {</span>
<a href="#l7.7"></a><span id="l7.7">     nsCOMPtr&lt;nsILDAPOperation&gt; operation;</span>
<a href="#l7.8"></a><span id="l7.8">     nsCOMPtr&lt;nsILDAPServer&gt; server;</span>
<a href="#l7.9"></a><span id="l7.9">     nsCOMPtr&lt;nsILDAPURL&gt; url;</span>
<a href="#l7.10"></a><span id="l7.10">     nsCOMPtr&lt;nsILDAPConnection&gt; conn, conn2;</span>
<a href="#l7.11"></a><span id="l7.11">     nsCOMPtr&lt;nsILDAPMessage&gt; message;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    nsCAutoString binddn;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    nsCAutoString password;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+    nsAutoCString binddn;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    nsAutoCString password;</span>
<a href="#l7.16"></a><span id="l7.16">     uint32_t protocolVersion;</span>
<a href="#l7.17"></a><span id="l7.17">     nsresult rv;</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">     server = aEntry-&gt;GetServer();</span>
<a href="#l7.20"></a><span id="l7.20">     if (!server) {</span>
<a href="#l7.21"></a><span id="l7.21">         return NS_ERROR_FAILURE;</span>
<a href="#l7.22"></a><span id="l7.22">     }</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -863,17 +863,17 @@ NS_IMETHODIMP nsLDAPService::ParseDn(con</span>
<a href="#l7.25"></a><span id="l7.25">     // count DN components</span>
<a href="#l7.26"></a><span id="l7.26">     if (!*dnComponents || !*(dnComponents + 1)) {</span>
<a href="#l7.27"></a><span id="l7.27">         NS_ERROR(&quot;nsLDAPService::ParseDn: DN has too few components&quot;);</span>
<a href="#l7.28"></a><span id="l7.28">         ldap_value_free(dnComponents);</span>
<a href="#l7.29"></a><span id="l7.29">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l7.30"></a><span id="l7.30">     }</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32">     // get the base DN</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-    nsCAutoString baseDn(nsDependentCString(*(dnComponents + 1)));</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+    nsAutoCString baseDn(nsDependentCString(*(dnComponents + 1)));</span>
<a href="#l7.35"></a><span id="l7.35">     for (char **component = dnComponents + 2; *component; ++component) {</span>
<a href="#l7.36"></a><span id="l7.36">         baseDn.AppendLiteral(&quot;,&quot;);</span>
<a href="#l7.37"></a><span id="l7.37">         baseDn.Append(nsDependentCString(*component));</span>
<a href="#l7.38"></a><span id="l7.38">     }</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">     // explode the RDN</span>
<a href="#l7.41"></a><span id="l7.41">     char **rdnComponents = ldap_explode_rdn(*dnComponents, 0);</span>
<a href="#l7.42"></a><span id="l7.42">     if (!rdnComponents) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPSyncQuery.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPSyncQuery.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -235,42 +235,42 @@ nsLDAPSyncQuery::StartLDAPSearch()</span>
<a href="#l8.4"></a><span id="l8.4">         NS_ERROR(&quot;nsLDAPSyncQuery::StartLDAPSearch(): couldn't &quot;</span>
<a href="#l8.5"></a><span id="l8.5">                  &quot;initialize LDAP operation&quot;);</span>
<a href="#l8.6"></a><span id="l8.6">         FinishLDAPQuery();</span>
<a href="#l8.7"></a><span id="l8.7">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l8.8"></a><span id="l8.8">     }</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">     // get the search filter associated with the directory server url; </span>
<a href="#l8.11"></a><span id="l8.11">     //</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    nsCAutoString urlFilter;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    nsAutoCString urlFilter;</span>
<a href="#l8.14"></a><span id="l8.14">     rv = mServerURL-&gt;GetFilter(urlFilter);</span>
<a href="#l8.15"></a><span id="l8.15">     if (NS_FAILED(rv)) {</span>
<a href="#l8.16"></a><span id="l8.16">         FinishLDAPQuery();</span>
<a href="#l8.17"></a><span id="l8.17">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l8.18"></a><span id="l8.18">     }</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     // get the base dn to search</span>
<a href="#l8.21"></a><span id="l8.21">     //</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-    nsCAutoString dn;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+    nsAutoCString dn;</span>
<a href="#l8.24"></a><span id="l8.24">     rv = mServerURL-&gt;GetDn(dn);</span>
<a href="#l8.25"></a><span id="l8.25">     if (NS_FAILED(rv)) {</span>
<a href="#l8.26"></a><span id="l8.26">         FinishLDAPQuery();</span>
<a href="#l8.27"></a><span id="l8.27">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l8.28"></a><span id="l8.28">     }</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">     // and the scope</span>
<a href="#l8.31"></a><span id="l8.31">     //</span>
<a href="#l8.32"></a><span id="l8.32">     int32_t scope;</span>
<a href="#l8.33"></a><span id="l8.33">     rv = mServerURL-&gt;GetScope(&amp;scope);</span>
<a href="#l8.34"></a><span id="l8.34">     if (NS_FAILED(rv)) {</span>
<a href="#l8.35"></a><span id="l8.35">         FinishLDAPQuery();</span>
<a href="#l8.36"></a><span id="l8.36">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l8.37"></a><span id="l8.37">     }</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-    nsCAutoString attributes;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+    nsAutoCString attributes;</span>
<a href="#l8.41"></a><span id="l8.41">     rv = mServerURL-&gt;GetAttributes(attributes);</span>
<a href="#l8.42"></a><span id="l8.42">     if (NS_FAILED(rv)) {</span>
<a href="#l8.43"></a><span id="l8.43">         FinishLDAPQuery();</span>
<a href="#l8.44"></a><span id="l8.44">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l8.45"></a><span id="l8.45">     }</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47">     // time to kick off the search.</span>
<a href="#l8.48"></a><span id="l8.48">     rv = mOperation-&gt;SearchExt(dn, scope, urlFilter, attributes, 0, 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPURL.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPURL.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -345,17 +345,17 @@ NS_IMETHODIMP nsLDAPURL::Equals(nsIURI *</span>
<a href="#l9.4"></a><span id="l9.4"> {</span>
<a href="#l9.5"></a><span id="l9.5">   *_retval = false;</span>
<a href="#l9.6"></a><span id="l9.6">   if (other)</span>
<a href="#l9.7"></a><span id="l9.7">   {</span>
<a href="#l9.8"></a><span id="l9.8">     nsresult rv;</span>
<a href="#l9.9"></a><span id="l9.9">     nsCOMPtr&lt;nsILDAPURL&gt; otherURL(do_QueryInterface(other, &amp;rv));</span>
<a href="#l9.10"></a><span id="l9.10">     if (NS_SUCCEEDED(rv))</span>
<a href="#l9.11"></a><span id="l9.11">     {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-      nsCAutoString thisSpec, otherSpec;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+      nsAutoCString thisSpec, otherSpec;</span>
<a href="#l9.14"></a><span id="l9.14">       uint32_t otherOptions;</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">       rv = GetSpec(thisSpec);</span>
<a href="#l9.17"></a><span id="l9.17">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19">       rv = otherURL-&gt;GetSpec(otherSpec);</span>
<a href="#l9.20"></a><span id="l9.20">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -509,17 +509,17 @@ NS_IMETHODIMP nsLDAPURL::AddAttribute(co</span>
<a href="#l9.23"></a><span id="l9.23">   {</span>
<a href="#l9.24"></a><span id="l9.24">     mAttributes = ',';</span>
<a href="#l9.25"></a><span id="l9.25">     mAttributes.Append(aAttribute);</span>
<a href="#l9.26"></a><span id="l9.26">     mAttributes.Append(',');</span>
<a href="#l9.27"></a><span id="l9.27">   }</span>
<a href="#l9.28"></a><span id="l9.28">   else</span>
<a href="#l9.29"></a><span id="l9.29">   {</span>
<a href="#l9.30"></a><span id="l9.30">     // Wrap the attribute in commas, so that we can do an exact match.</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    nsCAutoString findAttribute(&quot;,&quot;);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    nsAutoCString findAttribute(&quot;,&quot;);</span>
<a href="#l9.33"></a><span id="l9.33">     findAttribute.Append(aAttribute);</span>
<a href="#l9.34"></a><span id="l9.34">     findAttribute.Append(',');</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36">     // Check to see if the attribute is already stored. If it is, then also</span>
<a href="#l9.37"></a><span id="l9.37">     // check to see if it is the last attribute in the string, or if the next</span>
<a href="#l9.38"></a><span id="l9.38">     // character is a comma, this means we won't match substrings.</span>
<a href="#l9.39"></a><span id="l9.39">     int32_t pos = mAttributes.Find(findAttribute, CaseInsensitiveCompare);</span>
<a href="#l9.40"></a><span id="l9.40">     if (pos != -1)</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -539,17 +539,17 @@ NS_IMETHODIMP nsLDAPURL::AddAttribute(co</span>
<a href="#l9.42"></a><span id="l9.42"> NS_IMETHODIMP nsLDAPURL::RemoveAttribute(const nsACString &amp;aAttribute)</span>
<a href="#l9.43"></a><span id="l9.43"> {</span>
<a href="#l9.44"></a><span id="l9.44">   if (!mBaseURL)</span>
<a href="#l9.45"></a><span id="l9.45">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l9.46"></a><span id="l9.46"> </span>
<a href="#l9.47"></a><span id="l9.47">   if (mAttributes.IsEmpty())</span>
<a href="#l9.48"></a><span id="l9.48">     return NS_OK;</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-  nsCAutoString findAttribute(&quot;,&quot;);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+  nsAutoCString findAttribute(&quot;,&quot;);</span>
<a href="#l9.52"></a><span id="l9.52">   findAttribute.Append(aAttribute);</span>
<a href="#l9.53"></a><span id="l9.53">   findAttribute.Append(',');</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55">   if (mAttributes.Equals(findAttribute, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l9.56"></a><span id="l9.56">     mAttributes.Truncate();</span>
<a href="#l9.57"></a><span id="l9.57">   else</span>
<a href="#l9.58"></a><span id="l9.58">   {</span>
<a href="#l9.59"></a><span id="l9.59">     int32_t pos = mAttributes.Find(findAttribute, CaseInsensitiveCompare);</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineat">@@ -567,17 +567,17 @@ NS_IMETHODIMP nsLDAPURL::RemoveAttribute</span>
<a href="#l9.61"></a><span id="l9.61">   return mBaseURL-&gt;SetPath(newPath);</span>
<a href="#l9.62"></a><span id="l9.62"> }</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64"> NS_IMETHODIMP nsLDAPURL::HasAttribute(const nsACString &amp;aAttribute,</span>
<a href="#l9.65"></a><span id="l9.65">                                       bool *_retval)</span>
<a href="#l9.66"></a><span id="l9.66"> {</span>
<a href="#l9.67"></a><span id="l9.67">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-  nsCAutoString findAttribute(&quot;,&quot;);</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+  nsAutoCString findAttribute(&quot;,&quot;);</span>
<a href="#l9.71"></a><span id="l9.71">   findAttribute.Append(aAttribute);</span>
<a href="#l9.72"></a><span id="l9.72">   findAttribute.Append(',');</span>
<a href="#l9.73"></a><span id="l9.73"> </span>
<a href="#l9.74"></a><span id="l9.74">   *_retval = mAttributes.Find(findAttribute, CaseInsensitiveCompare) != -1;</span>
<a href="#l9.75"></a><span id="l9.75">   return NS_OK;</span>
<a href="#l9.76"></a><span id="l9.76"> }</span>
<a href="#l9.77"></a><span id="l9.77"> </span>
<a href="#l9.78"></a><span id="l9.78"> NS_IMETHODIMP nsLDAPURL::GetScope(int32_t *_retval)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/migration/src/nsMailProfileMigratorUtils.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/migration/src/nsMailProfileMigratorUtils.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -10,21 +10,21 @@</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsXPCOMCID.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> void SetProxyPref(const nsACString&amp; aHostPort, const char* aPref,</span>
<a href="#l10.10"></a><span id="l10.10">                   const char* aPortPref, nsIPrefBranch* aPrefs)</span>
<a href="#l10.11"></a><span id="l10.11"> {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  nsCAutoString hostPort(aHostPort);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  nsAutoCString hostPort(aHostPort);</span>
<a href="#l10.14"></a><span id="l10.14">   int32_t portDelimOffset = hostPort.RFindChar(':');</span>
<a href="#l10.15"></a><span id="l10.15">   if (portDelimOffset &gt; 0) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-    nsCAutoString host(Substring(hostPort, 0, portDelimOffset));</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-    nsCAutoString port(Substring(hostPort, portDelimOffset + 1,</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+    nsAutoCString host(Substring(hostPort, 0, portDelimOffset));</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+    nsAutoCString port(Substring(hostPort, portDelimOffset + 1,</span>
<a href="#l10.20"></a><span id="l10.20">                                  hostPort.Length() - (portDelimOffset + 1)));</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">     aPrefs-&gt;SetCharPref(aPref, host.get());</span>
<a href="#l10.23"></a><span id="l10.23">     nsresult stringErr;</span>
<a href="#l10.24"></a><span id="l10.24">     int32_t portValue = port.ToInteger(&amp;stringErr);</span>
<a href="#l10.25"></a><span id="l10.25">     aPrefs-&gt;SetIntPref(aPortPref, portValue);</span>
<a href="#l10.26"></a><span id="l10.26">   }</span>
<a href="#l10.27"></a><span id="l10.27">   else</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineat">@@ -32,17 +32,17 @@ void SetProxyPref(const nsACString&amp; aHos</span>
<a href="#l10.29"></a><span id="l10.29"> }</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31"> void ParseOverrideServers(const char* aServers, nsIPrefBranch* aBranch)</span>
<a href="#l10.32"></a><span id="l10.32"> {</span>
<a href="#l10.33"></a><span id="l10.33">   // Windows (and Opera) formats its proxy override list in the form:</span>
<a href="#l10.34"></a><span id="l10.34">   // server;server;server where server is a server name or ip address,</span>
<a href="#l10.35"></a><span id="l10.35">   // or &quot;&lt;local&gt;&quot;. Mozilla's format is server,server,server, and &lt;local&gt;</span>
<a href="#l10.36"></a><span id="l10.36">   // must be translated to &quot;localhost,127.0.0.1&quot;</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-  nsCAutoString override(aServers);</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+  nsAutoCString override(aServers);</span>
<a href="#l10.39"></a><span id="l10.39">   int32_t left = 0, right = 0;</span>
<a href="#l10.40"></a><span id="l10.40">   for (;;) {</span>
<a href="#l10.41"></a><span id="l10.41">     right = override.FindChar(';', right);</span>
<a href="#l10.42"></a><span id="l10.42">     const nsACString&amp; host = Substring(override, left,</span>
<a href="#l10.43"></a><span id="l10.43">                                        (right &lt; 0 ? override.Length() : right) - left);</span>
<a href="#l10.44"></a><span id="l10.44">     if (host.Equals(&quot;&lt;local&gt;&quot;))</span>
<a href="#l10.45"></a><span id="l10.45">       override.Replace(left, 7, NS_LITERAL_CSTRING(&quot;localhost,127.0.0.1&quot;));</span>
<a href="#l10.46"></a><span id="l10.46">     if (right &lt; 0)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -57,23 +57,23 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">   if (!profileFileExists)</span>
<a href="#l11.6"></a><span id="l11.6">     return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">   nsINIParser parser;</span>
<a href="#l11.9"></a><span id="l11.9">   rv = parser.Init(profileIni);</span>
<a href="#l11.10"></a><span id="l11.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  nsCAutoString buffer, filePath;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  nsAutoCString buffer, filePath;</span>
<a href="#l11.14"></a><span id="l11.14">   bool isRelative;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">   // This is an infinite loop that is broken when we no longer find profiles</span>
<a href="#l11.17"></a><span id="l11.17">   // for profileID with IsRelative option.</span>
<a href="#l11.18"></a><span id="l11.18">   for (unsigned int c = 0; true; ++c) {</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-    nsCAutoString profileID(&quot;Profile&quot;);</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+    nsAutoCString profileID(&quot;Profile&quot;);</span>
<a href="#l11.21"></a><span id="l11.21">     profileID.AppendInt(c);</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23">     if (NS_FAILED(parser.GetString(profileID.get(), &quot;IsRelative&quot;, buffer)))</span>
<a href="#l11.24"></a><span id="l11.24">       break;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">     isRelative = buffer.EqualsLiteral(&quot;1&quot;);</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">     rv = parser.GetString(profileID.get(), &quot;Path&quot;, filePath);</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineat">@@ -221,34 +221,34 @@ nsNetscapeProfileMigratorBase::GetSignon</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31"> nsresult</span>
<a href="#l11.32"></a><span id="l11.32"> nsNetscapeProfileMigratorBase::LocateSignonsFile(char** aResult)</span>
<a href="#l11.33"></a><span id="l11.33"> {</span>
<a href="#l11.34"></a><span id="l11.34">   nsCOMPtr&lt;nsISimpleEnumerator&gt; entries;</span>
<a href="#l11.35"></a><span id="l11.35">   nsresult rv = mSourceProfile-&gt;GetDirectoryEntries(getter_AddRefs(entries));</span>
<a href="#l11.36"></a><span id="l11.36">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l11.40"></a><span id="l11.40">   do {</span>
<a href="#l11.41"></a><span id="l11.41">     bool hasMore = false;</span>
<a href="#l11.42"></a><span id="l11.42">     rv = entries-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l11.43"></a><span id="l11.43">     if (NS_FAILED(rv) || !hasMore) break;</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45">     nsCOMPtr&lt;nsISupports&gt; supp;</span>
<a href="#l11.46"></a><span id="l11.46">     rv = entries-&gt;GetNext(getter_AddRefs(supp));</span>
<a href="#l11.47"></a><span id="l11.47">     if (NS_FAILED(rv)) break;</span>
<a href="#l11.48"></a><span id="l11.48"> </span>
<a href="#l11.49"></a><span id="l11.49">     nsCOMPtr&lt;nsIFile&gt; currFile(do_QueryInterface(supp));</span>
<a href="#l11.50"></a><span id="l11.50"> </span>
<a href="#l11.51"></a><span id="l11.51">     nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l11.52"></a><span id="l11.52">     rv = NS_NewFileURI(getter_AddRefs(uri), currFile);</span>
<a href="#l11.53"></a><span id="l11.53">     if (NS_FAILED(rv)) break;</span>
<a href="#l11.54"></a><span id="l11.54">     nsCOMPtr&lt;nsIURL&gt; url(do_QueryInterface(uri));</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-    nsCAutoString extn;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+    nsAutoCString extn;</span>
<a href="#l11.58"></a><span id="l11.58">     url-&gt;GetFileExtension(extn);</span>
<a href="#l11.59"></a><span id="l11.59"> </span>
<a href="#l11.60"></a><span id="l11.60"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l11.61"></a><span id="l11.61">     if (extn.EqualsIgnoreCase(&quot;s&quot;)) {</span>
<a href="#l11.62"></a><span id="l11.62">       url-&gt;GetFileName(fileName);</span>
<a href="#l11.63"></a><span id="l11.63">       break;</span>
<a href="#l11.64"></a><span id="l11.64">     }</span>
<a href="#l11.65"></a><span id="l11.65"> #else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -29,17 +29,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> NS_IMPL_ISUPPORTS1(nsProfileMigrator, nsIProfileMigrator)</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> #define MIGRATION_WIZARD_FE_URL &quot;chrome://messenger/content/migration/migration.xul&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> #define MIGRATION_WIZARD_FE_FEATURES &quot;chrome,dialog,modal,centerscreen&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> NS_IMETHODIMP</span>
<a href="#l12.10"></a><span id="l12.10"> nsProfileMigrator::Migrate(nsIProfileStartup* aStartup, const nsACString&amp; aKey)</span>
<a href="#l12.11"></a><span id="l12.11"> {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l12.14"></a><span id="l12.14">   nsCOMPtr&lt;nsIMailProfileMigrator&gt; mailMigrator;</span>
<a href="#l12.15"></a><span id="l12.15">   nsresult rv = GetDefaultMailMigratorKey(key, mailMigrator);</span>
<a href="#l12.16"></a><span id="l12.16">   NS_ENSURE_SUCCESS(rv, rv); // abort migration if we failed to get a mailMigrator (if we were supposed to)</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">   nsCOMPtr&lt;nsISupportsCString&gt; cstr (do_CreateInstance(&quot;@mozilla.org/supports-cstring;1&quot;));</span>
<a href="#l12.19"></a><span id="l12.19">   NS_ENSURE_TRUE(cstr, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l12.20"></a><span id="l12.20">   cstr-&gt;SetData(key);</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -83,17 +83,17 @@ nsProfileMigrator::GetDefaultMailMigrato</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">   nsCString forceMigrationType;</span>
<a href="#l12.25"></a><span id="l12.25">   prefs-&gt;GetCharPref(&quot;profile.force.migration&quot;, getter_Copies(forceMigrationType));</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   // if we are being forced to migrate to a particular migration type, then create an instance of that migrator</span>
<a href="#l12.28"></a><span id="l12.28">   // and return it.</span>
<a href="#l12.29"></a><span id="l12.29">   NS_NAMED_LITERAL_CSTRING(migratorPrefix,</span>
<a href="#l12.30"></a><span id="l12.30">                            NS_MAILPROFILEMIGRATOR_CONTRACTID_PREFIX);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  nsCAutoString migratorID;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  nsAutoCString migratorID;</span>
<a href="#l12.33"></a><span id="l12.33">   if (!forceMigrationType.IsEmpty())</span>
<a href="#l12.34"></a><span id="l12.34">   {</span>
<a href="#l12.35"></a><span id="l12.35">     bool exists = false;</span>
<a href="#l12.36"></a><span id="l12.36">     migratorID = migratorPrefix;</span>
<a href="#l12.37"></a><span id="l12.37">     migratorID.Append(forceMigrationType);</span>
<a href="#l12.38"></a><span id="l12.38">     mailMigrator = do_CreateInstance(migratorID.get());</span>
<a href="#l12.39"></a><span id="l12.39">     if (!mailMigrator)</span>
<a href="#l12.40"></a><span id="l12.40">       return NS_ERROR_NOT_AVAILABLE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -447,17 +447,17 @@ nsSeamonkeyProfileMigrator::CopySignatur</span>
<a href="#l13.4"></a><span id="l13.4">       if (exists)</span>
<a href="#l13.5"></a><span id="l13.5">       {</span>
<a href="#l13.6"></a><span id="l13.6">         nsAutoString leafName;</span>
<a href="#l13.7"></a><span id="l13.7">         srcSigFile-&gt;GetLeafName(leafName);</span>
<a href="#l13.8"></a><span id="l13.8">         srcSigFile-&gt;CopyTo(targetSigFile,leafName); // will fail if we've already copied a sig file here</span>
<a href="#l13.9"></a><span id="l13.9">         targetSigFile-&gt;Append(leafName);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">         // now write out the new descriptor</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-        nsCAutoString descriptorString;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        nsAutoCString descriptorString;</span>
<a href="#l13.14"></a><span id="l13.14">         targetSigFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l13.15"></a><span id="l13.15">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l13.16"></a><span id="l13.16">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l13.17"></a><span id="l13.17">       }</span>
<a href="#l13.18"></a><span id="l13.18">     }</span>
<a href="#l13.19"></a><span id="l13.19">   }</span>
<a href="#l13.20"></a><span id="l13.20">   return NS_OK;</span>
<a href="#l13.21"></a><span id="l13.21"> }</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -541,17 +541,17 @@ nsSeamonkeyProfileMigrator::CopyMailFold</span>
<a href="#l13.23"></a><span id="l13.23">         // the accounts into is unique. This protects against the case where the user</span>
<a href="#l13.24"></a><span id="l13.24">         // has multiple servers with the same host name.</span>
<a href="#l13.25"></a><span id="l13.25">         targetMailFolder-&gt;CreateUnique(nsIFile::DIRECTORY_TYPE, 0777);</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27">         rv = RecursiveCopy(sourceMailFolder, targetMailFolder);</span>
<a href="#l13.28"></a><span id="l13.28">         // now we want to make sure the actual directory pref that gets</span>
<a href="#l13.29"></a><span id="l13.29">         // transformed into the new profile's pref.js has the right file</span>
<a href="#l13.30"></a><span id="l13.30">         // location.</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-        nsCAutoString descriptorString;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+        nsAutoCString descriptorString;</span>
<a href="#l13.33"></a><span id="l13.33">         targetMailFolder-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l13.34"></a><span id="l13.34">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l13.35"></a><span id="l13.35">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l13.36"></a><span id="l13.36">       }</span>
<a href="#l13.37"></a><span id="l13.37">     }</span>
<a href="#l13.38"></a><span id="l13.38">     else if (StringEndsWith(prefName, nsDependentCString(&quot;.newsrc.file&quot;)))</span>
<a href="#l13.39"></a><span id="l13.39">     {</span>
<a href="#l13.40"></a><span id="l13.40">       // copy the news RC file into \News. this won't work if the user has different newsrc files for each account</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineat">@@ -571,17 +571,17 @@ nsSeamonkeyProfileMigrator::CopyMailFold</span>
<a href="#l13.42"></a><span id="l13.42">       if (exists)</span>
<a href="#l13.43"></a><span id="l13.43">       {</span>
<a href="#l13.44"></a><span id="l13.44">         nsAutoString leafName;</span>
<a href="#l13.45"></a><span id="l13.45">         srcNewsRCFile-&gt;GetLeafName(leafName);</span>
<a href="#l13.46"></a><span id="l13.46">         srcNewsRCFile-&gt;CopyTo(targetNewsRCFile,leafName); // will fail if we've already copied a newsrc file here</span>
<a href="#l13.47"></a><span id="l13.47">         targetNewsRCFile-&gt;Append(leafName);</span>
<a href="#l13.48"></a><span id="l13.48"> </span>
<a href="#l13.49"></a><span id="l13.49">         // now write out the new descriptor</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-        nsCAutoString descriptorString;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+        nsAutoCString descriptorString;</span>
<a href="#l13.52"></a><span id="l13.52">         targetNewsRCFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l13.53"></a><span id="l13.53">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l13.54"></a><span id="l13.54">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l13.55"></a><span id="l13.55">       }</span>
<a href="#l13.56"></a><span id="l13.56">     }</span>
<a href="#l13.57"></a><span id="l13.57">   }</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/shell/nsMailGNOMEIntegration.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/shell/nsMailGNOMEIntegration.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -203,17 +203,17 @@ nsMailGNOMEIntegration::KeyMatchesAppNam</span>
<a href="#l14.4"></a><span id="l14.4">   return matches;</span>
<a href="#l14.5"></a><span id="l14.5"> }</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> bool</span>
<a href="#l14.8"></a><span id="l14.8"> nsMailGNOMEIntegration::CheckHandlerMatchesAppName(const nsACString &amp;handler) const</span>
<a href="#l14.9"></a><span id="l14.9"> {</span>
<a href="#l14.10"></a><span id="l14.10">   gint argc;</span>
<a href="#l14.11"></a><span id="l14.11">   gchar **argv;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  nsCAutoString command(handler);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  nsAutoCString command(handler);</span>
<a href="#l14.14"></a><span id="l14.14"> </span>
<a href="#l14.15"></a><span id="l14.15">   if (g_shell_parse_argv(command.get(), &amp;argc, &amp;argv, NULL)) {</span>
<a href="#l14.16"></a><span id="l14.16">     command.Assign(argv[0]);</span>
<a href="#l14.17"></a><span id="l14.17">     g_strfreev(argv);</span>
<a href="#l14.18"></a><span id="l14.18">   } else {</span>
<a href="#l14.19"></a><span id="l14.19">     return false;</span>
<a href="#l14.20"></a><span id="l14.20">   }</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -222,17 +222,17 @@ nsMailGNOMEIntegration::CheckHandlerMatc</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24"> bool</span>
<a href="#l14.25"></a><span id="l14.25"> nsMailGNOMEIntegration::checkDefault(const char* const *aProtocols, unsigned int aLength)</span>
<a href="#l14.26"></a><span id="l14.26"> {</span>
<a href="#l14.27"></a><span id="l14.27">   nsCOMPtr&lt;nsIGConfService&gt; gconf = do_GetService(NS_GCONFSERVICE_CONTRACTID);</span>
<a href="#l14.28"></a><span id="l14.28">   nsCOMPtr&lt;nsIGIOService&gt; giovfs = do_GetService(NS_GIOSERVICE_CONTRACTID);</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30">   bool enabled;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  nsCAutoString handler;</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+  nsAutoCString handler;</span>
<a href="#l14.33"></a><span id="l14.33">   nsresult rv;</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35">   for (unsigned int i = 0; i &lt; aLength; ++i) {</span>
<a href="#l14.36"></a><span id="l14.36">     if (gconf) {</span>
<a href="#l14.37"></a><span id="l14.37">       handler.Truncate();</span>
<a href="#l14.38"></a><span id="l14.38">       rv = gconf-&gt;GetAppForProtocol(nsDependentCString(aProtocols[i]),</span>
<a href="#l14.39"></a><span id="l14.39">                                     &amp;enabled, handler);</span>
<a href="#l14.40"></a><span id="l14.40">       if (NS_SUCCEEDED(rv) &amp;&amp; (!CheckHandlerMatchesAppName(handler) || !enabled)) {</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -259,17 +259,17 @@ nsMailGNOMEIntegration::checkDefault(con</span>
<a href="#l14.42"></a><span id="l14.42"> }</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44"> nsresult</span>
<a href="#l14.45"></a><span id="l14.45"> nsMailGNOMEIntegration::MakeDefault(const char* const *aProtocols,</span>
<a href="#l14.46"></a><span id="l14.46">                                     unsigned int aProtocolsLength,</span>
<a href="#l14.47"></a><span id="l14.47">                                     const char *aMimeType,</span>
<a href="#l14.48"></a><span id="l14.48">                                     const char *aExtensions)</span>
<a href="#l14.49"></a><span id="l14.49"> {</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  nsCAutoString appKeyValue;</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+  nsAutoCString appKeyValue;</span>
<a href="#l14.52"></a><span id="l14.52">   nsCOMPtr&lt;nsIGConfService&gt; gconf = do_GetService(NS_GCONFSERVICE_CONTRACTID);</span>
<a href="#l14.53"></a><span id="l14.53">   nsCOMPtr&lt;nsIGIOService&gt; giovfs = do_GetService(NS_GIOSERVICE_CONTRACTID);</span>
<a href="#l14.54"></a><span id="l14.54">   if(mAppIsInPath) {</span>
<a href="#l14.55"></a><span id="l14.55">     // mAppPath is in the users path, so use only the basename as the launcher</span>
<a href="#l14.56"></a><span id="l14.56">     gchar *tmp = g_path_get_basename(mAppPath.get());</span>
<a href="#l14.57"></a><span id="l14.57">     appKeyValue = tmp;</span>
<a href="#l14.58"></a><span id="l14.58">     g_free(tmp);</span>
<a href="#l14.59"></a><span id="l14.59">   } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbBSDirectory.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbBSDirectory.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -125,17 +125,17 @@ nsresult nsAbBSDirectory::EnsureInitiali</span>
<a href="#l15.4"></a><span id="l15.4">     uint32_t fileNameLen = strlen(server-&gt;fileName);</span>
<a href="#l15.5"></a><span id="l15.5">     if (((fileNameLen &gt; kABFileName_PreviousSuffixLen) &amp;&amp; </span>
<a href="#l15.6"></a><span id="l15.6">       strcmp(server-&gt;fileName + fileNameLen - kABFileName_PreviousSuffixLen,</span>
<a href="#l15.7"></a><span id="l15.7">              kABFileName_PreviousSuffix) == 0) &amp;&amp;</span>
<a href="#l15.8"></a><span id="l15.8">       (server-&gt;dirType == PABDirectory))</span>
<a href="#l15.9"></a><span id="l15.9">       continue;</span>
<a href="#l15.10"></a><span id="l15.10">       </span>
<a href="#l15.11"></a><span id="l15.11">     // Set the uri property</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    nsCAutoString URI (server-&gt;uri);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    nsAutoCString URI (server-&gt;uri);</span>
<a href="#l15.14"></a><span id="l15.14">     // This is in case the uri is never set</span>
<a href="#l15.15"></a><span id="l15.15">     // in the nsDirPref.cpp code.</span>
<a href="#l15.16"></a><span id="l15.16">     if (!server-&gt;uri) </span>
<a href="#l15.17"></a><span id="l15.17">     {</span>
<a href="#l15.18"></a><span id="l15.18">       URI = NS_LITERAL_CSTRING(kMDBDirectoryRoot);</span>
<a href="#l15.19"></a><span id="l15.19">       URI += nsDependentCString(server-&gt;fileName);</span>
<a href="#l15.20"></a><span id="l15.20">     }</span>
<a href="#l15.21"></a><span id="l15.21">       </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbBoolExprToLDAPFilter.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -137,17 +137,17 @@ nsresult nsAbBoolExprToLDAPFilter::Filte</span>
<a href="#l16.4"></a><span id="l16.4">     nsIAbBooleanConditionString* condition,</span>
<a href="#l16.5"></a><span id="l16.5">     nsCString&amp; filter,</span>
<a href="#l16.6"></a><span id="l16.6">     int flags)</span>
<a href="#l16.7"></a><span id="l16.7"> {</span>
<a href="#l16.8"></a><span id="l16.8">     nsCString name;</span>
<a href="#l16.9"></a><span id="l16.9">     nsresult rv = condition-&gt;GetName(getter_Copies (name));</span>
<a href="#l16.10"></a><span id="l16.10">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    nsCAutoString ldapAttr(name);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    nsAutoCString ldapAttr(name);</span>
<a href="#l16.14"></a><span id="l16.14">     if (flags &amp; TRANSLATE_CARD_PROPERTY)</span>
<a href="#l16.15"></a><span id="l16.15">     {</span>
<a href="#l16.16"></a><span id="l16.16">         rv = map-&gt;GetFirstAttribute (name, ldapAttr);</span>
<a href="#l16.17"></a><span id="l16.17">         if (!(flags &amp; ALLOW_NON_CONVERTABLE_CARD_PROPERTY) &amp;&amp; </span>
<a href="#l16.18"></a><span id="l16.18">             !ATTRMAP_FOUND_ATTR(rv, ldapAttr))</span>
<a href="#l16.19"></a><span id="l16.19">             return NS_OK;</span>
<a href="#l16.20"></a><span id="l16.20">     }</span>
<a href="#l16.21"></a><span id="l16.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbContentHandler.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbContentHandler.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -48,17 +48,17 @@ nsAbContentHandler::HandleContent(const </span>
<a href="#l17.4"></a><span id="l17.4">   if (PL_strcasecmp(aContentType, &quot;application/x-addvcard&quot;) == 0) {</span>
<a href="#l17.5"></a><span id="l17.5">     nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l17.6"></a><span id="l17.6">     nsCOMPtr&lt;nsIChannel&gt; aChannel = do_QueryInterface(request);</span>
<a href="#l17.7"></a><span id="l17.7">     if (!aChannel) return NS_ERROR_FAILURE;</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">     rv = aChannel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l17.10"></a><span id="l17.10">     if (uri)</span>
<a href="#l17.11"></a><span id="l17.11">     {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        nsCAutoString path;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        nsAutoCString path;</span>
<a href="#l17.14"></a><span id="l17.14">         rv = uri-&gt;GetPath(path);</span>
<a href="#l17.15"></a><span id="l17.15">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">         const char *startOfVCard = strstr(path.get(), &quot;add?vcard=&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">         if (startOfVCard)</span>
<a href="#l17.19"></a><span id="l17.19">         {</span>
<a href="#l17.20"></a><span id="l17.20">             nsCString unescapedData;</span>
<a href="#l17.21"></a><span id="l17.21">             </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirFactoryService.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirFactoryService.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -36,19 +36,19 @@ nsAbDirFactoryService::GetDirFactory(con</span>
<a href="#l18.4"></a><span id="l18.4">   nsresult rv;</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   // Obtain the network IO service</span>
<a href="#l18.7"></a><span id="l18.7">   nsCOMPtr&lt;nsIIOService&gt; nsService =</span>
<a href="#l18.8"></a><span id="l18.8">     mozilla::services::GetIOService();</span>
<a href="#l18.9"></a><span id="l18.9">   NS_ENSURE_TRUE(nsService, NS_ERROR_UNEXPECTED);</span>
<a href="#l18.10"></a><span id="l18.10">     </span>
<a href="#l18.11"></a><span id="l18.11">   // Extract the scheme</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  nsCAutoString scheme;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  nsAutoCString scheme;</span>
<a href="#l18.14"></a><span id="l18.14">   rv = nsService-&gt;ExtractScheme(aURI, scheme);</span>
<a href="#l18.15"></a><span id="l18.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">   // Try to find a factory using the component manager.</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-  nsCAutoString contractID;</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+  nsAutoCString contractID;</span>
<a href="#l18.20"></a><span id="l18.20">   contractID.AssignLiteral(NS_AB_DIRECTORY_FACTORY_CONTRACTID_PREFIX);</span>
<a href="#l18.21"></a><span id="l18.21">   contractID.Append(scheme);</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">   return CallCreateInstance(contractID.get(), aDirFactory);</span>
<a href="#l18.24"></a><span id="l18.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -48,27 +48,27 @@ nsAbLDAPAutoCompFormatter::Format(nsILDA</span>
<a href="#l19.4"></a><span id="l19.4">         NS_ERROR(&quot;nsAbLDAPAutoCompFormatter::Format(): do_GetService()&quot;</span>
<a href="#l19.5"></a><span id="l19.5">                  &quot; failed trying to obtain&quot;</span>
<a href="#l19.6"></a><span id="l19.6">                  &quot; '@mozilla.org/messenger/headerparser;1'&quot;);</span>
<a href="#l19.7"></a><span id="l19.7">         return NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l19.8"></a><span id="l19.8">     }</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">     // generate the appropriate string</span>
<a href="#l19.11"></a><span id="l19.11">     //</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    nsCAutoString name;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    nsAutoCString name;</span>
<a href="#l19.14"></a><span id="l19.14">     rv = ProcessFormat(mNameFormat, aMsg, &amp;name, 0);</span>
<a href="#l19.15"></a><span id="l19.15">     if (NS_FAILED(rv)) {</span>
<a href="#l19.16"></a><span id="l19.16">         // Something went wrong lower down the stack; a message should</span>
<a href="#l19.17"></a><span id="l19.17">         // have already been logged there.  Return an error, rather</span>
<a href="#l19.18"></a><span id="l19.18">         // than trying to generate a bogus nsIAutoCompleteItem</span>
<a href="#l19.19"></a><span id="l19.19">         //</span>
<a href="#l19.20"></a><span id="l19.20">         return rv;</span>
<a href="#l19.21"></a><span id="l19.21">     }</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-    nsCAutoString address;</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+    nsAutoCString address;</span>
<a href="#l19.25"></a><span id="l19.25">     rv = ProcessFormat(mAddressFormat, aMsg, &amp;address, 0);</span>
<a href="#l19.26"></a><span id="l19.26">     if (NS_FAILED(rv)) {</span>
<a href="#l19.27"></a><span id="l19.27">         // Something went wrong lower down the stack; a message should have </span>
<a href="#l19.28"></a><span id="l19.28">         // already been logged there.  Return an error, rather than trying to </span>
<a href="#l19.29"></a><span id="l19.29">         // generate a bogus nsIAutoCompleteItem.</span>
<a href="#l19.30"></a><span id="l19.30">         //</span>
<a href="#l19.31"></a><span id="l19.31">         return rv;</span>
<a href="#l19.32"></a><span id="l19.32">     }</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineat">@@ -99,17 +99,17 @@ nsAbLDAPAutoCompFormatter::Format(nsILDA</span>
<a href="#l19.34"></a><span id="l19.34">     if (NS_FAILED(rv)) {</span>
<a href="#l19.35"></a><span id="l19.35">         NS_ERROR(&quot;nsAbLDAPAutoCompFormatter::Format(): &quot;</span>
<a href="#l19.36"></a><span id="l19.36">                  &quot;item-&gt;SetValue failed&quot;);</span>
<a href="#l19.37"></a><span id="l19.37">         return rv;</span>
<a href="#l19.38"></a><span id="l19.38">     }</span>
<a href="#l19.39"></a><span id="l19.39"> </span>
<a href="#l19.40"></a><span id="l19.40">     // generate the appropriate string to appear as a comment off to the side</span>
<a href="#l19.41"></a><span id="l19.41">     //</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-    nsCAutoString comment;</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+    nsAutoCString comment;</span>
<a href="#l19.44"></a><span id="l19.44">     rv = ProcessFormat(mCommentFormat, aMsg, &amp;comment, 0);</span>
<a href="#l19.45"></a><span id="l19.45">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l19.46"></a><span id="l19.46">         rv = item-&gt;SetComment(NS_ConvertUTF8toUTF16(comment).get());</span>
<a href="#l19.47"></a><span id="l19.47">         if (NS_FAILED(rv)) {</span>
<a href="#l19.48"></a><span id="l19.48">             NS_WARNING(&quot;nsAbLDAPAutoCompFormatter::Format():&quot;</span>
<a href="#l19.49"></a><span id="l19.49">                        &quot; item-&gt;SetComment() failed&quot;);</span>
<a href="#l19.50"></a><span id="l19.50">         }</span>
<a href="#l19.51"></a><span id="l19.51">     }</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineat">@@ -322,17 +322,17 @@ nsAbLDAPAutoCompFormatter::FormatExcepti</span>
<a href="#l19.53"></a><span id="l19.53">     //</span>
<a href="#l19.54"></a><span id="l19.54">     NS_IF_ADDREF(*aItem = item);</span>
<a href="#l19.55"></a><span id="l19.55">     return NS_OK;</span>
<a href="#l19.56"></a><span id="l19.56"> }</span>
<a href="#l19.57"></a><span id="l19.57"> </span>
<a href="#l19.58"></a><span id="l19.58"> NS_IMETHODIMP</span>
<a href="#l19.59"></a><span id="l19.59"> nsAbLDAPAutoCompFormatter::GetAttributes(nsACString &amp;aResult)</span>
<a href="#l19.60"></a><span id="l19.60"> {</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-    nsCAutoString searchAttrs;</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineplus">+    nsAutoCString searchAttrs;</span>
<a href="#l19.63"></a><span id="l19.63">     nsresult rv = ProcessFormat(mNameFormat, 0, 0, &amp;searchAttrs);</span>
<a href="#l19.64"></a><span id="l19.64">     if (NS_FAILED(rv)) {</span>
<a href="#l19.65"></a><span id="l19.65">         NS_WARNING(&quot;nsAbLDAPAutoCompFormatter::SetNameFormat(): &quot;</span>
<a href="#l19.66"></a><span id="l19.66">                    &quot;ProcessFormat() failed&quot;);</span>
<a href="#l19.67"></a><span id="l19.67">         return rv;</span>
<a href="#l19.68"></a><span id="l19.68">     }</span>
<a href="#l19.69"></a><span id="l19.69">     rv = ProcessFormat(mAddressFormat, 0, 0, &amp;searchAttrs);</span>
<a href="#l19.70"></a><span id="l19.70">     if (NS_FAILED(rv)) {</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineat">@@ -376,17 +376,17 @@ nsAbLDAPAutoCompFormatter::ProcessFormat</span>
<a href="#l19.72"></a><span id="l19.72">     nsCOMPtr&lt;nsIConsoleService&gt; consoleSvc = </span>
<a href="#l19.73"></a><span id="l19.73">         do_GetService(&quot;@mozilla.org/consoleservice;1&quot;, &amp;rv);</span>
<a href="#l19.74"></a><span id="l19.74">     if (NS_FAILED(rv)) {</span>
<a href="#l19.75"></a><span id="l19.75">         NS_WARNING(&quot;nsAbLDAPAutoCompFormatter::ProcessFormat(): &quot;</span>
<a href="#l19.76"></a><span id="l19.76">                    &quot;couldn't get console service&quot;);</span>
<a href="#l19.77"></a><span id="l19.77">     }</span>
<a href="#l19.78"></a><span id="l19.78"> </span>
<a href="#l19.79"></a><span id="l19.79">     bool attrRequired = false;     // is this attr required or optional?</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineminus">-    nsCAutoString attrName;             // current attr to get</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+    nsAutoCString attrName;             // current attr to get</span>
<a href="#l19.82"></a><span id="l19.82"> </span>
<a href="#l19.83"></a><span id="l19.83">     // parse until we hit the end of the string</span>
<a href="#l19.84"></a><span id="l19.84">     //</span>
<a href="#l19.85"></a><span id="l19.85">     while (iter != iterEnd) {</span>
<a href="#l19.86"></a><span id="l19.86"> </span>
<a href="#l19.87"></a><span id="l19.87">         switch (*iter) {            // process the next char</span>
<a href="#l19.88"></a><span id="l19.88"> </span>
<a href="#l19.89"></a><span id="l19.89">         case PRUnichar('{'):</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPCard.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPCard.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -63,17 +63,17 @@ NS_IMETHODIMP nsAbLDAPCard::GetLDAPMessa</span>
<a href="#l20.4"></a><span id="l20.4">   nsresult rv;</span>
<a href="#l20.5"></a><span id="l20.5">   nsCOMPtr&lt;nsIMutableArray&gt; modArray =</span>
<a href="#l20.6"></a><span id="l20.6">     do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l20.7"></a><span id="l20.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.8"></a><span id="l20.8">   </span>
<a href="#l20.9"></a><span id="l20.9">   // Add any missing object classes. We never remove any object</span>
<a href="#l20.10"></a><span id="l20.10">   // classes: if an entry has additional object classes, it's probably</span>
<a href="#l20.11"></a><span id="l20.11">   // for a good reason.</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  nsCAutoString oclass;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  nsAutoCString oclass;</span>
<a href="#l20.14"></a><span id="l20.14">   for (uint32_t i = 0; i &lt; aClassCount; ++i)</span>
<a href="#l20.15"></a><span id="l20.15">   {</span>
<a href="#l20.16"></a><span id="l20.16">     oclass.Assign(nsDependentCString(aClasses[i]));</span>
<a href="#l20.17"></a><span id="l20.17">     ToLowerCase(oclass);</span>
<a href="#l20.18"></a><span id="l20.18">    </span>
<a href="#l20.19"></a><span id="l20.19">     if (m_objectClass.IndexOf(oclass) == nsTArray&lt;nsCString&gt;::NoIndex)</span>
<a href="#l20.20"></a><span id="l20.20">     {</span>
<a href="#l20.21"></a><span id="l20.21">       m_objectClass.AppendElement(oclass);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -108,17 +108,17 @@ NS_IMETHODIMP nsAbLDAPCard::GetLDAPMessa</span>
<a href="#l20.23"></a><span id="l20.23">   modArray-&gt;AppendElement(mod, false);</span>
<a href="#l20.24"></a><span id="l20.24"> </span>
<a href="#l20.25"></a><span id="l20.25">   // Add card properties</span>
<a href="#l20.26"></a><span id="l20.26">   CharPtrArrayGuard props;</span>
<a href="#l20.27"></a><span id="l20.27">   rv = aAttributeMap-&gt;GetAllCardProperties(props.GetSizeAddr(),</span>
<a href="#l20.28"></a><span id="l20.28">     props.GetArrayAddr());</span>
<a href="#l20.29"></a><span id="l20.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-  nsCAutoString attr;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  nsAutoCString attr;</span>
<a href="#l20.33"></a><span id="l20.33">   nsCString propvalue;</span>
<a href="#l20.34"></a><span id="l20.34">   for (uint32_t i = 0; i &lt; props.GetSize(); ++i)</span>
<a href="#l20.35"></a><span id="l20.35">   {</span>
<a href="#l20.36"></a><span id="l20.36">     // Skip some attributes that don't map to LDAP.</span>
<a href="#l20.37"></a><span id="l20.37">     //</span>
<a href="#l20.38"></a><span id="l20.38">     // BirthYear : by default this is mapped to 'birthyear',</span>
<a href="#l20.39"></a><span id="l20.39">     // which is not part of mozillaAbPersonAlpha</span>
<a href="#l20.40"></a><span id="l20.40">     //</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -197,17 +197,17 @@ NS_IMETHODIMP nsAbLDAPCard::BuildRdn(nsI</span>
<a href="#l20.42"></a><span id="l20.42">                                      const char **aAttributes,</span>
<a href="#l20.43"></a><span id="l20.43">                                      nsACString &amp;aRdn)</span>
<a href="#l20.44"></a><span id="l20.44"> {</span>
<a href="#l20.45"></a><span id="l20.45">   NS_ENSURE_ARG_POINTER(aAttributeMap);</span>
<a href="#l20.46"></a><span id="l20.46">   NS_ENSURE_ARG_POINTER(aAttributes);</span>
<a href="#l20.47"></a><span id="l20.47">   </span>
<a href="#l20.48"></a><span id="l20.48">   nsresult rv;</span>
<a href="#l20.49"></a><span id="l20.49">   nsCString attr;</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-  nsCAutoString prop;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+  nsAutoCString prop;</span>
<a href="#l20.52"></a><span id="l20.52">   nsCString propvalue;</span>
<a href="#l20.53"></a><span id="l20.53"> </span>
<a href="#l20.54"></a><span id="l20.54">   aRdn.Truncate();</span>
<a href="#l20.55"></a><span id="l20.55">   for (uint32_t i = 0; i &lt; aAttrCount; ++i)</span>
<a href="#l20.56"></a><span id="l20.56">   {</span>
<a href="#l20.57"></a><span id="l20.57">     attr.Assign(nsDependentCString(aAttributes[i]));</span>
<a href="#l20.58"></a><span id="l20.58">    </span>
<a href="#l20.59"></a><span id="l20.59">     // Lookup the property corresponding to the attribute</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineat">@@ -246,28 +246,28 @@ NS_IMETHODIMP nsAbLDAPCard::SetDn(const </span>
<a href="#l20.61"></a><span id="l20.61">   return SetPropertyAsAUTF8String(kDNColumn, aDN);</span>
<a href="#l20.62"></a><span id="l20.62"> }</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64"> NS_IMETHODIMP nsAbLDAPCard::SetMetaProperties(nsILDAPMessage *aMessage)</span>
<a href="#l20.65"></a><span id="l20.65"> {</span>
<a href="#l20.66"></a><span id="l20.66">   NS_ENSURE_ARG_POINTER(aMessage);</span>
<a href="#l20.67"></a><span id="l20.67">   </span>
<a href="#l20.68"></a><span id="l20.68">   // Get DN</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-  nsCAutoString dn;</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+  nsAutoCString dn;</span>
<a href="#l20.71"></a><span id="l20.71">   nsresult rv = aMessage-&gt;GetDn(dn);</span>
<a href="#l20.72"></a><span id="l20.72">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.73"></a><span id="l20.73"> </span>
<a href="#l20.74"></a><span id="l20.74">   SetDn(dn);</span>
<a href="#l20.75"></a><span id="l20.75"> </span>
<a href="#l20.76"></a><span id="l20.76">   // Get the list of set attributes</span>
<a href="#l20.77"></a><span id="l20.77">   CharPtrArrayGuard attrs;</span>
<a href="#l20.78"></a><span id="l20.78">   rv = aMessage-&gt;GetAttributes(attrs.GetSizeAddr(), attrs.GetArrayAddr());</span>
<a href="#l20.79"></a><span id="l20.79">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.80"></a><span id="l20.80">  </span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-  nsCAutoString attr;</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+  nsAutoCString attr;</span>
<a href="#l20.83"></a><span id="l20.83">   m_attributes.Clear();</span>
<a href="#l20.84"></a><span id="l20.84">   for (uint32_t i = 0; i &lt; attrs.GetSize(); ++i)</span>
<a href="#l20.85"></a><span id="l20.85">   {</span>
<a href="#l20.86"></a><span id="l20.86">     attr.Assign(nsDependentCString(attrs[i]));</span>
<a href="#l20.87"></a><span id="l20.87">     ToLowerCase(attr);</span>
<a href="#l20.88"></a><span id="l20.88">     m_attributes.AppendElement(attr);</span>
<a href="#l20.89"></a><span id="l20.89">   }</span>
<a href="#l20.90"></a><span id="l20.90"> </span>
<a href="#l20.91"></a><span id="l20.91" class="difflineat">@@ -280,17 +280,17 @@ NS_IMETHODIMP nsAbLDAPCard::SetMetaPrope</span>
<a href="#l20.92"></a><span id="l20.92">   // objectClass is not always included in search result entries and</span>
<a href="#l20.93"></a><span id="l20.93">   // nsILDAPMessage::GetValues returns NS_ERROR_LDAP_DECODING_ERROR if the</span>
<a href="#l20.94"></a><span id="l20.94">   // requested attribute doesn't exist.</span>
<a href="#l20.95"></a><span id="l20.95">   if (rv ==  NS_ERROR_LDAP_DECODING_ERROR)</span>
<a href="#l20.96"></a><span id="l20.96">     return NS_OK;</span>
<a href="#l20.97"></a><span id="l20.97"> </span>
<a href="#l20.98"></a><span id="l20.98">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.99"></a><span id="l20.99">   </span>
<a href="#l20.100"></a><span id="l20.100" class="difflineminus">-  nsCAutoString oclass;</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineplus">+  nsAutoCString oclass;</span>
<a href="#l20.102"></a><span id="l20.102">   for (uint32_t i = 0; i &lt; vals.GetSize(); ++i)</span>
<a href="#l20.103"></a><span id="l20.103">   {</span>
<a href="#l20.104"></a><span id="l20.104">     oclass.Assign(NS_LossyConvertUTF16toASCII(nsDependentString(vals[i])));</span>
<a href="#l20.105"></a><span id="l20.105">     ToLowerCase(oclass);</span>
<a href="#l20.106"></a><span id="l20.106">     m_objectClass.AppendElement(oclass);</span>
<a href="#l20.107"></a><span id="l20.107">   }</span>
<a href="#l20.108"></a><span id="l20.108"> </span>
<a href="#l20.109"></a><span id="l20.109">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -107,17 +107,17 @@ nsresult nsAbLDAPProcessChangeLogData::O</span>
<a href="#l21.4"></a><span id="l21.4">         return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6">     nsresult rv = NS_OK;       </span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">     switch(mState)</span>
<a href="#l21.9"></a><span id="l21.9">     {</span>
<a href="#l21.10"></a><span id="l21.10">     case kSearchingAuthDN :</span>
<a href="#l21.11"></a><span id="l21.11">         {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-            nsCAutoString authDN;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+            nsAutoCString authDN;</span>
<a href="#l21.14"></a><span id="l21.14">             rv = aMessage-&gt;GetDn(authDN);</span>
<a href="#l21.15"></a><span id="l21.15">             if(NS_SUCCEEDED(rv) &amp;&amp; !authDN.IsEmpty())</span>
<a href="#l21.16"></a><span id="l21.16">                 mAuthDN = authDN.get();</span>
<a href="#l21.17"></a><span id="l21.17">         }</span>
<a href="#l21.18"></a><span id="l21.18">         break;</span>
<a href="#l21.19"></a><span id="l21.19">     case kSearchingRootDSE:</span>
<a href="#l21.20"></a><span id="l21.20">         rv = ParseRootDSEEntry(aMessage);</span>
<a href="#l21.21"></a><span id="l21.21">         break;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -160,17 +160,17 @@ nsresult nsAbLDAPProcessChangeLogData::O</span>
<a href="#l21.23"></a><span id="l21.23">                 nsCOMPtr&lt;nsIAddrBookSession&gt; abSession = do_GetService(NS_ADDRBOOKSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l21.24"></a><span id="l21.24">                 if (NS_FAILED(rv)) </span>
<a href="#l21.25"></a><span id="l21.25">                     break;</span>
<a href="#l21.26"></a><span id="l21.26">                 nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l21.27"></a><span id="l21.27">                 rv = abSession-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l21.28"></a><span id="l21.28">                 if (NS_FAILED(rv)) </span>
<a href="#l21.29"></a><span id="l21.29">                     break;</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-                nsCAutoString fileName;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+                nsAutoCString fileName;</span>
<a href="#l21.33"></a><span id="l21.33">                 rv = mDirectory-&gt;GetReplicationFileName(fileName);</span>
<a href="#l21.34"></a><span id="l21.34">                 if (NS_FAILED(rv))</span>
<a href="#l21.35"></a><span id="l21.35">                   break;</span>
<a href="#l21.36"></a><span id="l21.36"> </span>
<a href="#l21.37"></a><span id="l21.37">                 rv = dbPath-&gt;AppendNative(fileName);</span>
<a href="#l21.38"></a><span id="l21.38">                 if (NS_FAILED(rv)) </span>
<a href="#l21.39"></a><span id="l21.39">                     break;</span>
<a href="#l21.40"></a><span id="l21.40"> </span>
<a href="#l21.41"></a><span id="l21.41" class="difflineat">@@ -242,17 +242,17 @@ nsresult nsAbLDAPProcessChangeLogData::G</span>
<a href="#l21.42"></a><span id="l21.42">     if (!dialog) </span>
<a href="#l21.43"></a><span id="l21.43">         return NS_ERROR_FAILURE;</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45">     nsCOMPtr&lt;nsILDAPURL&gt; url;</span>
<a href="#l21.46"></a><span id="l21.46">     rv = mQuery-&gt;GetReplicationURL(getter_AddRefs(url));</span>
<a href="#l21.47"></a><span id="l21.47">     if (NS_FAILED(rv))</span>
<a href="#l21.48"></a><span id="l21.48">         return rv;</span>
<a href="#l21.49"></a><span id="l21.49"> </span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-    nsCAutoString serverUri;</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+    nsAutoCString serverUri;</span>
<a href="#l21.52"></a><span id="l21.52">     rv = url-&gt;GetSpec(serverUri);</span>
<a href="#l21.53"></a><span id="l21.53">     if (NS_FAILED(rv)) </span>
<a href="#l21.54"></a><span id="l21.54">         return rv;</span>
<a href="#l21.55"></a><span id="l21.55"> </span>
<a href="#l21.56"></a><span id="l21.56">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l21.57"></a><span id="l21.57">       mozilla::services::GetStringBundleService();</span>
<a href="#l21.58"></a><span id="l21.58">     NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l21.59"></a><span id="l21.59">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPChangeLogQuery.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -84,24 +84,24 @@ NS_IMETHODIMP nsAbLDAPChangeLogQuery::Qu</span>
<a href="#l22.4"></a><span id="l22.4"> {</span>
<a href="#l22.5"></a><span id="l22.5">   if (!mInitialized)</span>
<a href="#l22.6"></a><span id="l22.6">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   nsCOMPtr&lt;nsIAbLDAPAttributeMap&gt; attrMap;</span>
<a href="#l22.9"></a><span id="l22.9">   nsresult rv = mDirectory-&gt;GetAttributeMap(getter_AddRefs(attrMap));</span>
<a href="#l22.10"></a><span id="l22.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    nsCAutoString filter;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    nsAutoCString filter;</span>
<a href="#l22.14"></a><span id="l22.14">     rv = attrMap-&gt;GetFirstAttribute(NS_LITERAL_CSTRING(&quot;PrimaryEmail&quot;), filter);</span>
<a href="#l22.15"></a><span id="l22.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">     filter += '=';</span>
<a href="#l22.18"></a><span id="l22.18">     filter += aValueUsedToFindDn;</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-    nsCAutoString dn;</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+    nsAutoCString dn;</span>
<a href="#l22.22"></a><span id="l22.22">     rv = mURL-&gt;GetDn(dn);</span>
<a href="#l22.23"></a><span id="l22.23">     if(NS_FAILED(rv)) </span>
<a href="#l22.24"></a><span id="l22.24">         return rv;</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26">     rv = CreateNewLDAPOperation();</span>
<a href="#l22.27"></a><span id="l22.27">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.28"></a><span id="l22.28"> </span>
<a href="#l22.29"></a><span id="l22.29">     // XXX We really should be using LDAP_NO_ATTRS here once its exposed via</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineat">@@ -133,17 +133,17 @@ NS_IMETHODIMP nsAbLDAPChangeLogQuery::Qu</span>
<a href="#l22.31"></a><span id="l22.31"> </span>
<a href="#l22.32"></a><span id="l22.32">   int32_t lastChangeNumber;</span>
<a href="#l22.33"></a><span id="l22.33">   nsresult rv = mDirectory-&gt;GetLastChangeNumber(&amp;lastChangeNumber);</span>
<a href="#l22.34"></a><span id="l22.34">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.35"></a><span id="l22.35"> </span>
<a href="#l22.36"></a><span id="l22.36">   // make sure that the filter here just have one condition </span>
<a href="#l22.37"></a><span id="l22.37">   // and should not be enclosed in enclosing brackets.</span>
<a href="#l22.38"></a><span id="l22.38">   // also condition '&gt;' doesnot work, it should be '&gt;='/</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">-  nsCAutoString filter (NS_LITERAL_CSTRING(&quot;changenumber&gt;=&quot;));</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+  nsAutoCString filter (NS_LITERAL_CSTRING(&quot;changenumber&gt;=&quot;));</span>
<a href="#l22.41"></a><span id="l22.41">   filter.AppendInt(lastChangeNumber + 1);</span>
<a href="#l22.42"></a><span id="l22.42"> </span>
<a href="#l22.43"></a><span id="l22.43">   rv = CreateNewLDAPOperation();</span>
<a href="#l22.44"></a><span id="l22.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.45"></a><span id="l22.45"> </span>
<a href="#l22.46"></a><span id="l22.46">   return mOperation-&gt;SearchExt(aChangeLogDN, nsILDAPURL::SCOPE_ONELEVEL, filter, </span>
<a href="#l22.47"></a><span id="l22.47">                                sizeof(sChangeLogEntryAttribs),</span>
<a href="#l22.48"></a><span id="l22.48">                                sChangeLogEntryAttribs, 0, 0);</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineat">@@ -151,17 +151,17 @@ NS_IMETHODIMP nsAbLDAPChangeLogQuery::Qu</span>
<a href="#l22.50"></a><span id="l22.50"> </span>
<a href="#l22.51"></a><span id="l22.51"> NS_IMETHODIMP nsAbLDAPChangeLogQuery::QueryChangedEntries(const nsACString &amp; aChangedEntryDN)</span>
<a href="#l22.52"></a><span id="l22.52"> {</span>
<a href="#l22.53"></a><span id="l22.53">     if(!mInitialized) </span>
<a href="#l22.54"></a><span id="l22.54">         return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l22.55"></a><span id="l22.55">     if(aChangedEntryDN.IsEmpty()) </span>
<a href="#l22.56"></a><span id="l22.56">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l22.57"></a><span id="l22.57"> </span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-    nsCAutoString urlFilter;</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+    nsAutoCString urlFilter;</span>
<a href="#l22.60"></a><span id="l22.60">     nsresult rv = mURL-&gt;GetFilter(urlFilter);</span>
<a href="#l22.61"></a><span id="l22.61">     if(NS_FAILED(rv)) </span>
<a href="#l22.62"></a><span id="l22.62">         return rv;</span>
<a href="#l22.63"></a><span id="l22.63"> </span>
<a href="#l22.64"></a><span id="l22.64">     int32_t scope;</span>
<a href="#l22.65"></a><span id="l22.65">     rv = mURL-&gt;GetScope(&amp;scope);</span>
<a href="#l22.66"></a><span id="l22.66">     if(NS_FAILED(rv)) </span>
<a href="#l22.67"></a><span id="l22.67">         return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirFactory.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -50,17 +50,17 @@ nsAbLDAPDirFactory::GetDirectories(const</span>
<a href="#l23.4"></a><span id="l23.4">      * the same problem that we hit with changing username / hostname</span>
<a href="#l23.5"></a><span id="l23.5">      * for mail servers.  To solve this problem, we add an extra</span>
<a href="#l23.6"></a><span id="l23.6">      * level of indirection.  The URI that we generate</span>
<a href="#l23.7"></a><span id="l23.7">      * (the bridge URI) will be moz-abldapdirectory://&lt;prefName&gt;</span>
<a href="#l23.8"></a><span id="l23.8">      * and when we need the hostname, basedn, port, etc,</span>
<a href="#l23.9"></a><span id="l23.9">      * we'll use the &lt;prefName&gt; to get the necessary prefs.</span>
<a href="#l23.10"></a><span id="l23.10">      * note, &lt;prefName&gt; does not change.</span>
<a href="#l23.11"></a><span id="l23.11">      */</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    nsCAutoString bridgeURI;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+    nsAutoCString bridgeURI;</span>
<a href="#l23.14"></a><span id="l23.14">     bridgeURI = NS_LITERAL_CSTRING(kLDAPDirectoryRoot);</span>
<a href="#l23.15"></a><span id="l23.15">     bridgeURI += aPrefName;</span>
<a href="#l23.16"></a><span id="l23.16">     rv = abManager-&gt;GetDirectory(bridgeURI, getter_AddRefs(directory));</span>
<a href="#l23.17"></a><span id="l23.17">   }</span>
<a href="#l23.18"></a><span id="l23.18">   else {</span>
<a href="#l23.19"></a><span id="l23.19">     rv = abManager-&gt;GetDirectory(aURI, getter_AddRefs(directory));</span>
<a href="#l23.20"></a><span id="l23.20">   }</span>
<a href="#l23.21"></a><span id="l23.21">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -59,17 +59,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetProp</span>
<a href="#l24.4"></a><span id="l24.4"> {</span>
<a href="#l24.5"></a><span id="l24.5">   aResult.AssignLiteral(&quot;chrome://messenger/content/addressbook/pref-directory-add.xul&quot;);</span>
<a href="#l24.6"></a><span id="l24.6">   return NS_OK;</span>
<a href="#l24.7"></a><span id="l24.7"> }</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> NS_IMETHODIMP nsAbLDAPDirectory::Init(const char* aURI)</span>
<a href="#l24.10"></a><span id="l24.10"> {</span>
<a href="#l24.11"></a><span id="l24.11">   // We need to ensure that the m_DirPrefId is initialized properly</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  nsCAutoString uri(aURI);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  nsAutoCString uri(aURI);</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15">   // Find the first ? (of the search params) if there is one.</span>
<a href="#l24.16"></a><span id="l24.16">   // We know we can start at the end of the moz-abldapdirectory:// because</span>
<a href="#l24.17"></a><span id="l24.17">   // that's the URI we should have been passed.</span>
<a href="#l24.18"></a><span id="l24.18">   int32_t searchCharLocation = uri.FindChar('?', kLDAPDirectoryRootLen);</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">   if (searchCharLocation == -1)</span>
<a href="#l24.21"></a><span id="l24.21">     m_DirPrefId = Substring(uri, kLDAPDirectoryRootLen);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -121,17 +121,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetChil</span>
<a href="#l24.23"></a><span id="l24.23">       rv = GetReplicationFileName(fileName);</span>
<a href="#l24.24"></a><span id="l24.24">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.25"></a><span id="l24.25">       </span>
<a href="#l24.26"></a><span id="l24.26">       // if there is no fileName, bail out now.</span>
<a href="#l24.27"></a><span id="l24.27">       if (fileName.IsEmpty())</span>
<a href="#l24.28"></a><span id="l24.28">         return NS_OK;</span>
<a href="#l24.29"></a><span id="l24.29"> </span>
<a href="#l24.30"></a><span id="l24.30">       // perform the same query, but on the local directory</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-      nsCAutoString localDirectoryURI(NS_LITERAL_CSTRING(kMDBDirectoryRoot));</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+      nsAutoCString localDirectoryURI(NS_LITERAL_CSTRING(kMDBDirectoryRoot));</span>
<a href="#l24.33"></a><span id="l24.33">       localDirectoryURI.Append(fileName);</span>
<a href="#l24.34"></a><span id="l24.34">       if (mIsQueryURI) </span>
<a href="#l24.35"></a><span id="l24.35">       {</span>
<a href="#l24.36"></a><span id="l24.36">         localDirectoryURI.AppendLiteral(&quot;?&quot;);</span>
<a href="#l24.37"></a><span id="l24.37">         localDirectoryURI.Append(mQueryString);</span>
<a href="#l24.38"></a><span id="l24.38">       }</span>
<a href="#l24.39"></a><span id="l24.39"> </span>
<a href="#l24.40"></a><span id="l24.40">       nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID,</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineat">@@ -181,17 +181,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::HasCard</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43"> NS_IMETHODIMP nsAbLDAPDirectory::GetLDAPURL(nsILDAPURL** aResult)</span>
<a href="#l24.44"></a><span id="l24.44"> {</span>
<a href="#l24.45"></a><span id="l24.45">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47">   // Rather than using GetURI here we call GetStringValue directly so</span>
<a href="#l24.48"></a><span id="l24.48">   // we can handle the case where the URI isn't specified (see comments</span>
<a href="#l24.49"></a><span id="l24.49">   // below)</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-  nsCAutoString URI;</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+  nsAutoCString URI;</span>
<a href="#l24.52"></a><span id="l24.52">   nsresult rv = GetStringValue(&quot;uri&quot;, EmptyCString(), URI);</span>
<a href="#l24.53"></a><span id="l24.53">   if (NS_FAILED(rv) || URI.IsEmpty())</span>
<a href="#l24.54"></a><span id="l24.54">   {</span>
<a href="#l24.55"></a><span id="l24.55">     /*</span>
<a href="#l24.56"></a><span id="l24.56">      * A recent change in Mozilla now means that the LDAP Address Book</span>
<a href="#l24.57"></a><span id="l24.57">      * URI is based on the unique preference name value i.e.</span>
<a href="#l24.58"></a><span id="l24.58">      * [moz-abldapdirectory://prefName]</span>
<a href="#l24.59"></a><span id="l24.59">      * Prior to this valid change it was based on the actual uri i.e. </span>
<a href="#l24.60"></a><span id="l24.60" class="difflineat">@@ -223,17 +223,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetLDAP</span>
<a href="#l24.61"></a><span id="l24.61"> </span>
<a href="#l24.62"></a><span id="l24.62">   return CallQueryInterface(result, aResult);</span>
<a href="#l24.63"></a><span id="l24.63"> }</span>
<a href="#l24.64"></a><span id="l24.64"> </span>
<a href="#l24.65"></a><span id="l24.65"> NS_IMETHODIMP nsAbLDAPDirectory::SetLDAPURL(nsILDAPURL *aUrl)</span>
<a href="#l24.66"></a><span id="l24.66"> {</span>
<a href="#l24.67"></a><span id="l24.67">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l24.68"></a><span id="l24.68"> </span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-  nsCAutoString oldUrl;</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+  nsAutoCString oldUrl;</span>
<a href="#l24.71"></a><span id="l24.71">   // Note, it doesn't matter if GetStringValue fails - we'll just send an</span>
<a href="#l24.72"></a><span id="l24.72">   // update if its blank (i.e. old value not set).</span>
<a href="#l24.73"></a><span id="l24.73">   GetStringValue(&quot;uri&quot;, EmptyCString(), oldUrl);</span>
<a href="#l24.74"></a><span id="l24.74"> </span>
<a href="#l24.75"></a><span id="l24.75">   // Actually set the new value.</span>
<a href="#l24.76"></a><span id="l24.76">   nsCString tempLDAPURL;</span>
<a href="#l24.77"></a><span id="l24.77">   nsresult rv = aUrl-&gt;GetSpec(tempLDAPURL);</span>
<a href="#l24.78"></a><span id="l24.78">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineat">@@ -430,17 +430,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetIsRe</span>
<a href="#l24.80"></a><span id="l24.80">   *aIsRemote = true;</span>
<a href="#l24.81"></a><span id="l24.81">   return NS_OK;</span>
<a href="#l24.82"></a><span id="l24.82"> }</span>
<a href="#l24.83"></a><span id="l24.83"> </span>
<a href="#l24.84"></a><span id="l24.84"> NS_IMETHODIMP nsAbLDAPDirectory::GetIsSecure(bool *aIsSecure)</span>
<a href="#l24.85"></a><span id="l24.85"> {</span>
<a href="#l24.86"></a><span id="l24.86">   NS_ENSURE_ARG_POINTER(aIsSecure);</span>
<a href="#l24.87"></a><span id="l24.87"> </span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-  nsCAutoString URI;</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineplus">+  nsAutoCString URI;</span>
<a href="#l24.90"></a><span id="l24.90">   nsresult rv = GetStringValue(&quot;uri&quot;, EmptyCString(), URI);</span>
<a href="#l24.91"></a><span id="l24.91">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.92"></a><span id="l24.92">   </span>
<a href="#l24.93"></a><span id="l24.93">   // to determine if this is a secure directory, check if the uri is ldaps:// or not</span>
<a href="#l24.94"></a><span id="l24.94">   *aIsSecure = (strncmp(URI.get(), &quot;ldaps:&quot;, 6) == 0);</span>
<a href="#l24.95"></a><span id="l24.95">   return NS_OK;</span>
<a href="#l24.96"></a><span id="l24.96"> }</span>
<a href="#l24.97"></a><span id="l24.97"> </span>
<a href="#l24.98"></a><span id="l24.98" class="difflineat">@@ -557,17 +557,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetSear</span>
<a href="#l24.99"></a><span id="l24.99"> NS_IMETHODIMP nsAbLDAPDirectory::SetSearchServerControls(nsIMutableArray *aControls)</span>
<a href="#l24.100"></a><span id="l24.100"> {</span>
<a href="#l24.101"></a><span id="l24.101">   mSearchServerControls = aControls;</span>
<a href="#l24.102"></a><span id="l24.102">   return NS_OK;</span>
<a href="#l24.103"></a><span id="l24.103"> }</span>
<a href="#l24.104"></a><span id="l24.104"> </span>
<a href="#l24.105"></a><span id="l24.105"> NS_IMETHODIMP nsAbLDAPDirectory::GetProtocolVersion(uint32_t *aProtocolVersion)</span>
<a href="#l24.106"></a><span id="l24.106"> {</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineminus">-  nsCAutoString versionString;</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineplus">+  nsAutoCString versionString;</span>
<a href="#l24.109"></a><span id="l24.109"> </span>
<a href="#l24.110"></a><span id="l24.110">   nsresult rv = GetStringValue(&quot;protocolVersion&quot;, NS_LITERAL_CSTRING(&quot;3&quot;), versionString);</span>
<a href="#l24.111"></a><span id="l24.111">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.112"></a><span id="l24.112"> </span>
<a href="#l24.113"></a><span id="l24.113">   *aProtocolVersion = versionString.EqualsLiteral(&quot;3&quot;) ?</span>
<a href="#l24.114"></a><span id="l24.114">     (uint32_t)nsILDAPConnection::VERSION3 :</span>
<a href="#l24.115"></a><span id="l24.115">     (uint32_t)nsILDAPConnection::VERSION2;</span>
<a href="#l24.116"></a><span id="l24.116"> </span>
<a href="#l24.117"></a><span id="l24.117" class="difflineat">@@ -719,17 +719,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::AddCard</span>
<a href="#l24.118"></a><span id="l24.118">   // Copy over the card data</span>
<a href="#l24.119"></a><span id="l24.119">   nsCOMPtr&lt;nsIAbCard&gt; copyToCard = do_QueryInterface(card, &amp;rv);</span>
<a href="#l24.120"></a><span id="l24.120">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.121"></a><span id="l24.121"> </span>
<a href="#l24.122"></a><span id="l24.122">   rv = copyToCard-&gt;Copy(aUpdatedCard);</span>
<a href="#l24.123"></a><span id="l24.123">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.124"></a><span id="l24.124">   </span>
<a href="#l24.125"></a><span id="l24.125">   // Retrieve preferences</span>
<a href="#l24.126"></a><span id="l24.126" class="difflineminus">-  nsCAutoString prefString;</span>
<a href="#l24.127"></a><span id="l24.127" class="difflineplus">+  nsAutoCString prefString;</span>
<a href="#l24.128"></a><span id="l24.128">   rv = GetRdnAttributes(prefString);</span>
<a href="#l24.129"></a><span id="l24.129">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.130"></a><span id="l24.130"> </span>
<a href="#l24.131"></a><span id="l24.131">   CharPtrArrayGuard rdnAttrs;</span>
<a href="#l24.132"></a><span id="l24.132">   rv = SplitStringList(prefString, rdnAttrs.GetSizeAddr(),</span>
<a href="#l24.133"></a><span id="l24.133">     rdnAttrs.GetArrayAddr());</span>
<a href="#l24.134"></a><span id="l24.134">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.135"></a><span id="l24.135">   </span>
<a href="#l24.136"></a><span id="l24.136" class="difflineat">@@ -747,49 +747,49 @@ NS_IMETHODIMP nsAbLDAPDirectory::AddCard</span>
<a href="#l24.137"></a><span id="l24.137">     nsILDAPModification::MOD_ADD, getter_AddRefs(modArray));</span>
<a href="#l24.138"></a><span id="l24.138">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.139"></a><span id="l24.139">   </span>
<a href="#l24.140"></a><span id="l24.140">   // For new cards, the base DN is the search base DN</span>
<a href="#l24.141"></a><span id="l24.141">   nsCOMPtr&lt;nsILDAPURL&gt; currentUrl;</span>
<a href="#l24.142"></a><span id="l24.142">   rv = GetLDAPURL(getter_AddRefs(currentUrl));</span>
<a href="#l24.143"></a><span id="l24.143">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.144"></a><span id="l24.144"> </span>
<a href="#l24.145"></a><span id="l24.145" class="difflineminus">-  nsCAutoString baseDN;</span>
<a href="#l24.146"></a><span id="l24.146" class="difflineplus">+  nsAutoCString baseDN;</span>
<a href="#l24.147"></a><span id="l24.147">   rv = currentUrl-&gt;GetDn(baseDN);</span>
<a href="#l24.148"></a><span id="l24.148">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.149"></a><span id="l24.149">  </span>
<a href="#l24.150"></a><span id="l24.150">   // Calculate DN</span>
<a href="#l24.151"></a><span id="l24.151" class="difflineminus">-  nsCAutoString cardDN;</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineplus">+  nsAutoCString cardDN;</span>
<a href="#l24.153"></a><span id="l24.153">   rv = card-&gt;BuildRdn(attrMap, rdnAttrs.GetSize(), rdnAttrs.GetArray(),</span>
<a href="#l24.154"></a><span id="l24.154">     cardDN);</span>
<a href="#l24.155"></a><span id="l24.155">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.156"></a><span id="l24.156">   cardDN.AppendLiteral(&quot;,&quot;);</span>
<a href="#l24.157"></a><span id="l24.157">   cardDN.Append(baseDN);</span>
<a href="#l24.158"></a><span id="l24.158"> </span>
<a href="#l24.159"></a><span id="l24.159">   rv = card-&gt;SetDn(cardDN);</span>
<a href="#l24.160"></a><span id="l24.160">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.161"></a><span id="l24.161"> </span>
<a href="#l24.162"></a><span id="l24.162" class="difflineminus">-  nsCAutoString ourUuid;</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineplus">+  nsAutoCString ourUuid;</span>
<a href="#l24.164"></a><span id="l24.164">   GetUuid(ourUuid);</span>
<a href="#l24.165"></a><span id="l24.165">   copyToCard-&gt;SetDirectoryId(ourUuid);</span>
<a href="#l24.166"></a><span id="l24.166"> </span>
<a href="#l24.167"></a><span id="l24.167">   // Launch query</span>
<a href="#l24.168"></a><span id="l24.168">   rv = DoModify(this, nsILDAPModification::MOD_ADD, cardDN, modArray,</span>
<a href="#l24.169"></a><span id="l24.169">                 EmptyCString(), EmptyCString());</span>
<a href="#l24.170"></a><span id="l24.170">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.171"></a><span id="l24.171"> </span>
<a href="#l24.172"></a><span id="l24.172">   NS_ADDREF(*aAddedCard = copyToCard);</span>
<a href="#l24.173"></a><span id="l24.173">   return NS_OK;</span>
<a href="#l24.174"></a><span id="l24.174"> }</span>
<a href="#l24.175"></a><span id="l24.175"> </span>
<a href="#l24.176"></a><span id="l24.176"> NS_IMETHODIMP nsAbLDAPDirectory::DeleteCards(nsIArray *aCards)</span>
<a href="#l24.177"></a><span id="l24.177"> {</span>
<a href="#l24.178"></a><span id="l24.178">   uint32_t cardCount;</span>
<a href="#l24.179"></a><span id="l24.179">   uint32_t i;</span>
<a href="#l24.180"></a><span id="l24.180" class="difflineminus">-  nsCAutoString cardDN;</span>
<a href="#l24.181"></a><span id="l24.181" class="difflineplus">+  nsAutoCString cardDN;</span>
<a href="#l24.182"></a><span id="l24.182"> </span>
<a href="#l24.183"></a><span id="l24.183">   nsresult rv = aCards-&gt;GetLength(&amp;cardCount);</span>
<a href="#l24.184"></a><span id="l24.184">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.185"></a><span id="l24.185">  </span>
<a href="#l24.186"></a><span id="l24.186">   for (i = 0; i &lt; cardCount; ++i)</span>
<a href="#l24.187"></a><span id="l24.187">   {</span>
<a href="#l24.188"></a><span id="l24.188">     nsCOMPtr&lt;nsIAbLDAPCard&gt; card(do_QueryElementAt(aCards, i, &amp;rv));</span>
<a href="#l24.189"></a><span id="l24.189">     if (NS_FAILED(rv))</span>
<a href="#l24.190"></a><span id="l24.190" class="difflineat">@@ -828,64 +828,64 @@ NS_IMETHODIMP nsAbLDAPDirectory::ModifyC</span>
<a href="#l24.191"></a><span id="l24.191">   // Get the LDAP card</span>
<a href="#l24.192"></a><span id="l24.192">   nsCOMPtr&lt;nsIAbLDAPCard&gt; card = do_QueryInterface(aUpdatedCard, &amp;rv);</span>
<a href="#l24.193"></a><span id="l24.193">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.194"></a><span id="l24.194"> </span>
<a href="#l24.195"></a><span id="l24.195">   rv = Initiate();</span>
<a href="#l24.196"></a><span id="l24.196">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.197"></a><span id="l24.197">   </span>
<a href="#l24.198"></a><span id="l24.198">   // Retrieve preferences</span>
<a href="#l24.199"></a><span id="l24.199" class="difflineminus">-  nsCAutoString prefString;</span>
<a href="#l24.200"></a><span id="l24.200" class="difflineplus">+  nsAutoCString prefString;</span>
<a href="#l24.201"></a><span id="l24.201">   rv = GetObjectClasses(prefString);</span>
<a href="#l24.202"></a><span id="l24.202">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.203"></a><span id="l24.203">   </span>
<a href="#l24.204"></a><span id="l24.204">   CharPtrArrayGuard objClass;</span>
<a href="#l24.205"></a><span id="l24.205">   rv = SplitStringList(prefString, objClass.GetSizeAddr(),</span>
<a href="#l24.206"></a><span id="l24.206">     objClass.GetArrayAddr());</span>
<a href="#l24.207"></a><span id="l24.207">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.208"></a><span id="l24.208"> </span>
<a href="#l24.209"></a><span id="l24.209">   // Process updates</span>
<a href="#l24.210"></a><span id="l24.210">   nsCOMPtr&lt;nsIArray&gt; modArray;</span>
<a href="#l24.211"></a><span id="l24.211">   rv = card-&gt;GetLDAPMessageInfo(attrMap, objClass.GetSize(), objClass.GetArray(),</span>
<a href="#l24.212"></a><span id="l24.212">     nsILDAPModification::MOD_REPLACE, getter_AddRefs(modArray));</span>
<a href="#l24.213"></a><span id="l24.213">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.214"></a><span id="l24.214">   </span>
<a href="#l24.215"></a><span id="l24.215">   // Get current DN</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineminus">-  nsCAutoString oldDN;</span>
<a href="#l24.217"></a><span id="l24.217" class="difflineplus">+  nsAutoCString oldDN;</span>
<a href="#l24.218"></a><span id="l24.218">   rv = card-&gt;GetDn(oldDN);</span>
<a href="#l24.219"></a><span id="l24.219">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.220"></a><span id="l24.220"> </span>
<a href="#l24.221"></a><span id="l24.221">   nsCOMPtr&lt;nsILDAPService&gt; ldapSvc = do_GetService(</span>
<a href="#l24.222"></a><span id="l24.222">     &quot;@mozilla.org/network/ldap-service;1&quot;, &amp;rv);</span>
<a href="#l24.223"></a><span id="l24.223">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.224"></a><span id="l24.224"> </span>
<a href="#l24.225"></a><span id="l24.225">   // Retrieve base DN and RDN attributes</span>
<a href="#l24.226"></a><span id="l24.226" class="difflineminus">-  nsCAutoString baseDN;</span>
<a href="#l24.227"></a><span id="l24.227" class="difflineminus">-  nsCAutoString oldRDN;</span>
<a href="#l24.228"></a><span id="l24.228" class="difflineplus">+  nsAutoCString baseDN;</span>
<a href="#l24.229"></a><span id="l24.229" class="difflineplus">+  nsAutoCString oldRDN;</span>
<a href="#l24.230"></a><span id="l24.230">   CharPtrArrayGuard rdnAttrs;</span>
<a href="#l24.231"></a><span id="l24.231">   rv = ldapSvc-&gt;ParseDn(oldDN.get(), oldRDN, baseDN,</span>
<a href="#l24.232"></a><span id="l24.232">                         rdnAttrs.GetSizeAddr(), rdnAttrs.GetArrayAddr());</span>
<a href="#l24.233"></a><span id="l24.233">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.234"></a><span id="l24.234"> </span>
<a href="#l24.235"></a><span id="l24.235">   // Calculate new RDN and check whether it has changed</span>
<a href="#l24.236"></a><span id="l24.236" class="difflineminus">-  nsCAutoString newRDN;</span>
<a href="#l24.237"></a><span id="l24.237" class="difflineplus">+  nsAutoCString newRDN;</span>
<a href="#l24.238"></a><span id="l24.238">   rv = card-&gt;BuildRdn(attrMap, rdnAttrs.GetSize(), rdnAttrs.GetArray(),</span>
<a href="#l24.239"></a><span id="l24.239">     newRDN);</span>
<a href="#l24.240"></a><span id="l24.240">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.241"></a><span id="l24.241">       </span>
<a href="#l24.242"></a><span id="l24.242">   if (newRDN.Equals(oldRDN))</span>
<a href="#l24.243"></a><span id="l24.243">   {</span>
<a href="#l24.244"></a><span id="l24.244">     // Launch query</span>
<a href="#l24.245"></a><span id="l24.245">     rv = DoModify(this, nsILDAPModification::MOD_REPLACE, oldDN, modArray,</span>
<a href="#l24.246"></a><span id="l24.246">                   EmptyCString(), EmptyCString());</span>
<a href="#l24.247"></a><span id="l24.247">   }</span>
<a href="#l24.248"></a><span id="l24.248">   else</span>
<a href="#l24.249"></a><span id="l24.249">   {</span>
<a href="#l24.250"></a><span id="l24.250">     // Build and store the new DN</span>
<a href="#l24.251"></a><span id="l24.251" class="difflineminus">-    nsCAutoString newDN(newRDN);</span>
<a href="#l24.252"></a><span id="l24.252" class="difflineplus">+    nsAutoCString newDN(newRDN);</span>
<a href="#l24.253"></a><span id="l24.253">     newDN.AppendLiteral(&quot;,&quot;);</span>
<a href="#l24.254"></a><span id="l24.254">     newDN.Append(baseDN);</span>
<a href="#l24.255"></a><span id="l24.255">     </span>
<a href="#l24.256"></a><span id="l24.256">     rv = card-&gt;SetDn(newDN);</span>
<a href="#l24.257"></a><span id="l24.257">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.258"></a><span id="l24.258">     </span>
<a href="#l24.259"></a><span id="l24.259">     // Launch query</span>
<a href="#l24.260"></a><span id="l24.260">     rv = DoModify(this, nsILDAPModification::MOD_REPLACE, oldDN, modArray,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectoryModify.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -235,17 +235,17 @@ nsresult nsAbModifyLDAPMessageListener::</span>
<a href="#l25.4"></a><span id="l25.4">   NS_ENSURE_ARG_POINTER(aMessage);</span>
<a href="#l25.5"></a><span id="l25.5">   </span>
<a href="#l25.6"></a><span id="l25.6">   int32_t errCode;</span>
<a href="#l25.7"></a><span id="l25.7">   rv = aMessage-&gt;GetErrorCode(&amp;errCode);</span>
<a href="#l25.8"></a><span id="l25.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.9"></a><span id="l25.9">  </span>
<a href="#l25.10"></a><span id="l25.10">   if (errCode != nsILDAPErrors::SUCCESS)</span>
<a href="#l25.11"></a><span id="l25.11">   {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    nsCAutoString errMessage;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+    nsAutoCString errMessage;</span>
<a href="#l25.14"></a><span id="l25.14">     rv = aMessage-&gt;GetErrorMessage(errMessage);</span>
<a href="#l25.15"></a><span id="l25.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17">     printf(&quot;LDAP modification failed (code: %i, message: %s)\n&quot;,</span>
<a href="#l25.18"></a><span id="l25.18">            errCode, errMessage.get());</span>
<a href="#l25.19"></a><span id="l25.19">     return NS_ERROR_FAILURE;</span>
<a href="#l25.20"></a><span id="l25.20">   }</span>
<a href="#l25.21"></a><span id="l25.21">   </span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -259,17 +259,17 @@ nsresult nsAbModifyLDAPMessageListener::</span>
<a href="#l25.23"></a><span id="l25.23">   NS_ENSURE_ARG_POINTER(aMessage);</span>
<a href="#l25.24"></a><span id="l25.24">   </span>
<a href="#l25.25"></a><span id="l25.25">   int32_t errCode;</span>
<a href="#l25.26"></a><span id="l25.26">   rv = aMessage-&gt;GetErrorCode(&amp;errCode);</span>
<a href="#l25.27"></a><span id="l25.27">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29">   if (errCode != nsILDAPErrors::SUCCESS)</span>
<a href="#l25.30"></a><span id="l25.30">   {</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-    nsCAutoString errMessage;</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+    nsAutoCString errMessage;</span>
<a href="#l25.33"></a><span id="l25.33">     rv = aMessage-&gt;GetErrorMessage(errMessage);</span>
<a href="#l25.34"></a><span id="l25.34">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.35"></a><span id="l25.35"> </span>
<a href="#l25.36"></a><span id="l25.36">     printf(&quot;LDAP rename failed (code: %i, message: %s)\n&quot;,</span>
<a href="#l25.37"></a><span id="l25.37">            errCode, errMessage.get());</span>
<a href="#l25.38"></a><span id="l25.38">     return NS_ERROR_FAILURE;</span>
<a href="#l25.39"></a><span id="l25.39">   }</span>
<a href="#l25.40"></a><span id="l25.40">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectoryQuery.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -202,29 +202,29 @@ nsresult nsAbQueryLDAPMessageListener::D</span>
<a href="#l26.4"></a><span id="l26.4">   mCanceled = mFinished = false;</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">   mOperation = do_CreateInstance(NS_LDAPOPERATION_CONTRACTID, &amp;rv);</span>
<a href="#l26.7"></a><span id="l26.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   rv = mOperation-&gt;Init(mConnection, this, nullptr);</span>
<a href="#l26.10"></a><span id="l26.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  nsCAutoString dn;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  nsAutoCString dn;</span>
<a href="#l26.14"></a><span id="l26.14">   rv = mSearchUrl-&gt;GetDn(dn);</span>
<a href="#l26.15"></a><span id="l26.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">   int32_t scope;</span>
<a href="#l26.18"></a><span id="l26.18">   rv = mSearchUrl-&gt;GetScope(&amp;scope);</span>
<a href="#l26.19"></a><span id="l26.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-  nsCAutoString filter;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+  nsAutoCString filter;</span>
<a href="#l26.23"></a><span id="l26.23">   rv = mSearchUrl-&gt;GetFilter(filter);</span>
<a href="#l26.24"></a><span id="l26.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-  nsCAutoString attributes;</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+  nsAutoCString attributes;</span>
<a href="#l26.28"></a><span id="l26.28">   rv = mSearchUrl-&gt;GetAttributes(attributes);</span>
<a href="#l26.29"></a><span id="l26.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31">   rv = mOperation-&gt;SetServerControls(mServerSearchControls);</span>
<a href="#l26.32"></a><span id="l26.32">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.33"></a><span id="l26.33"> </span>
<a href="#l26.34"></a><span id="l26.34">   rv = mOperation-&gt;SetClientControls(mClientSearchControls);</span>
<a href="#l26.35"></a><span id="l26.35">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineat">@@ -325,21 +325,21 @@ NS_IMETHODIMP nsAbLDAPDirectoryQuery::Do</span>
<a href="#l26.37"></a><span id="l26.37">   nsCOMPtr&lt;nsIAbLDAPDirectory&gt; directory(do_QueryInterface(aDirectory, &amp;rv));</span>
<a href="#l26.38"></a><span id="l26.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.39"></a><span id="l26.39">   </span>
<a href="#l26.40"></a><span id="l26.40">   // We also need the current URL to check as well...</span>
<a href="#l26.41"></a><span id="l26.41">   nsCOMPtr&lt;nsILDAPURL&gt; currentUrl;</span>
<a href="#l26.42"></a><span id="l26.42">   rv = directory-&gt;GetLDAPURL(getter_AddRefs(currentUrl));</span>
<a href="#l26.43"></a><span id="l26.43">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.44"></a><span id="l26.44">   </span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-  nsCAutoString login;</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+  nsAutoCString login;</span>
<a href="#l26.47"></a><span id="l26.47">   rv = directory-&gt;GetAuthDn(login);</span>
<a href="#l26.48"></a><span id="l26.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.49"></a><span id="l26.49">   </span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-  nsCAutoString saslMechanism;</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+  nsAutoCString saslMechanism;</span>
<a href="#l26.52"></a><span id="l26.52">   rv = directory-&gt;GetSaslMechanism(saslMechanism);</span>
<a href="#l26.53"></a><span id="l26.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.54"></a><span id="l26.54">   </span>
<a href="#l26.55"></a><span id="l26.55">   uint32_t protocolVersion;</span>
<a href="#l26.56"></a><span id="l26.56">   rv = directory-&gt;GetProtocolVersion(&amp;protocolVersion);</span>
<a href="#l26.57"></a><span id="l26.57">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.58"></a><span id="l26.58">   </span>
<a href="#l26.59"></a><span id="l26.59">   // To do:</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineat">@@ -403,17 +403,17 @@ NS_IMETHODIMP nsAbLDAPDirectoryQuery::Do</span>
<a href="#l26.61"></a><span id="l26.61">   nsCOMPtr&lt;nsISupports&gt; iSupportsMap;</span>
<a href="#l26.62"></a><span id="l26.62">   rv = aArguments-&gt;GetTypeSpecificArg(getter_AddRefs(iSupportsMap));</span>
<a href="#l26.63"></a><span id="l26.63">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.64"></a><span id="l26.64"> </span>
<a href="#l26.65"></a><span id="l26.65">   nsCOMPtr&lt;nsIAbLDAPAttributeMap&gt; map = do_QueryInterface(iSupportsMap, &amp;rv);</span>
<a href="#l26.66"></a><span id="l26.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.67"></a><span id="l26.67"> </span>
<a href="#l26.68"></a><span id="l26.68">   // Require all attributes that are mapped to card properties</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-  nsCAutoString returnAttributes;</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+  nsAutoCString returnAttributes;</span>
<a href="#l26.71"></a><span id="l26.71">   rv = map-&gt;GetAllCardAttributes(returnAttributes);</span>
<a href="#l26.72"></a><span id="l26.72">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.73"></a><span id="l26.73"> </span>
<a href="#l26.74"></a><span id="l26.74">   rv = url-&gt;SetAttributes(returnAttributes);</span>
<a href="#l26.75"></a><span id="l26.75">   // Now do the error check</span>
<a href="#l26.76"></a><span id="l26.76">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.77"></a><span id="l26.77"> </span>
<a href="#l26.78"></a><span id="l26.78">   // Also require the objectClass attribute, it is used by</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineat">@@ -421,17 +421,17 @@ NS_IMETHODIMP nsAbLDAPDirectoryQuery::Do</span>
<a href="#l26.80"></a><span id="l26.80">   rv = url-&gt;AddAttribute(NS_LITERAL_CSTRING(&quot;objectClass&quot;));</span>
<a href="#l26.81"></a><span id="l26.81"> </span>
<a href="#l26.82"></a><span id="l26.82">   // Get the filter</span>
<a href="#l26.83"></a><span id="l26.83">   nsCOMPtr&lt;nsISupports&gt; supportsExpression;</span>
<a href="#l26.84"></a><span id="l26.84">   rv = aArguments-&gt;GetExpression (getter_AddRefs (supportsExpression));</span>
<a href="#l26.85"></a><span id="l26.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.86"></a><span id="l26.86">   </span>
<a href="#l26.87"></a><span id="l26.87">   nsCOMPtr&lt;nsIAbBooleanExpression&gt; expression (do_QueryInterface (supportsExpression, &amp;rv));</span>
<a href="#l26.88"></a><span id="l26.88" class="difflineminus">-  nsCAutoString filter;</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineplus">+  nsAutoCString filter;</span>
<a href="#l26.90"></a><span id="l26.90">   </span>
<a href="#l26.91"></a><span id="l26.91">   // figure out how we map attribute names to addressbook fields for this</span>
<a href="#l26.92"></a><span id="l26.92">   // query</span>
<a href="#l26.93"></a><span id="l26.93">   rv = nsAbBoolExprToLDAPFilter::Convert(map, expression, filter);</span>
<a href="#l26.94"></a><span id="l26.94">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.95"></a><span id="l26.95"> </span>
<a href="#l26.96"></a><span id="l26.96">   /*</span>
<a href="#l26.97"></a><span id="l26.97">    * Mozilla itself cannot arrive here with a blank filter</span>
<a href="#l26.98"></a><span id="l26.98" class="difflineat">@@ -448,23 +448,23 @@ NS_IMETHODIMP nsAbLDAPDirectoryQuery::Do</span>
<a href="#l26.99"></a><span id="l26.99">    */</span>
<a href="#l26.100"></a><span id="l26.100">   if (filter.IsEmpty())</span>
<a href="#l26.101"></a><span id="l26.101">   {</span>
<a href="#l26.102"></a><span id="l26.102">     filter.AssignLiteral(&quot;(objectclass=inetorgperson)&quot;);</span>
<a href="#l26.103"></a><span id="l26.103">   }</span>
<a href="#l26.104"></a><span id="l26.104"> </span>
<a href="#l26.105"></a><span id="l26.105">   // get the directoryFilter from the directory url and merge it with the user's</span>
<a href="#l26.106"></a><span id="l26.106">   // search filter</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineminus">-  nsCAutoString urlFilter;</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineplus">+  nsAutoCString urlFilter;</span>
<a href="#l26.109"></a><span id="l26.109">   rv = mDirectoryUrl-&gt;GetFilter(urlFilter);</span>
<a href="#l26.110"></a><span id="l26.110">   </span>
<a href="#l26.111"></a><span id="l26.111">   // if urlFilter is unset (or set to the default &quot;objectclass=*&quot;), there's</span>
<a href="#l26.112"></a><span id="l26.112">   // no need to AND in an empty search term, so leave prefix and suffix empty</span>
<a href="#l26.113"></a><span id="l26.113">   </span>
<a href="#l26.114"></a><span id="l26.114" class="difflineminus">-  nsCAutoString searchFilter;</span>
<a href="#l26.115"></a><span id="l26.115" class="difflineplus">+  nsAutoCString searchFilter;</span>
<a href="#l26.116"></a><span id="l26.116">   if (urlFilter.Length() &amp;&amp; !urlFilter.EqualsLiteral(&quot;(objectclass=*)&quot;))</span>
<a href="#l26.117"></a><span id="l26.117">   {</span>
<a href="#l26.118"></a><span id="l26.118">     // if urlFilter isn't parenthesized, we need to add in parens so that</span>
<a href="#l26.119"></a><span id="l26.119">     // the filter works as a term to &amp;</span>
<a href="#l26.120"></a><span id="l26.120">     //</span>
<a href="#l26.121"></a><span id="l26.121">     if (urlFilter[0] != '(')</span>
<a href="#l26.122"></a><span id="l26.122">     {</span>
<a href="#l26.123"></a><span id="l26.123">       searchFilter = NS_LITERAL_CSTRING(&quot;(&amp;(&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -107,17 +107,17 @@ NS_IMETHODIMP nsAbLDAPListenerBase::OnLD</span>
<a href="#l27.4"></a><span id="l27.4">                &quot;'authPromptTitle' string from bundle &quot;</span>
<a href="#l27.5"></a><span id="l27.5">                &quot;chrome://mozldap/locale/ldap.properties&quot;);</span>
<a href="#l27.6"></a><span id="l27.6">       InitFailed();</span>
<a href="#l27.7"></a><span id="l27.7">       return rv;</span>
<a href="#l27.8"></a><span id="l27.8">     }</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">     // get the host name for the auth prompt</span>
<a href="#l27.11"></a><span id="l27.11">     //</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    nsCAutoString host;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    nsAutoCString host;</span>
<a href="#l27.14"></a><span id="l27.14">     rv = mDirectoryUrl-&gt;GetAsciiHost(host);</span>
<a href="#l27.15"></a><span id="l27.15">     if (NS_FAILED(rv))</span>
<a href="#l27.16"></a><span id="l27.16">     {</span>
<a href="#l27.17"></a><span id="l27.17">       NS_ERROR(&quot;nsAbLDAPListenerBase::OnLDAPInit(): error getting ascii host&quot;</span>
<a href="#l27.18"></a><span id="l27.18">                &quot;name from directory url&quot;);</span>
<a href="#l27.19"></a><span id="l27.19">       InitFailed();</span>
<a href="#l27.20"></a><span id="l27.20">       return rv;</span>
<a href="#l27.21"></a><span id="l27.21">     }</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -237,17 +237,17 @@ NS_IMETHODIMP nsAbLDAPListenerBase::OnLD</span>
<a href="#l27.23"></a><span id="l27.23">     NS_ERROR(&quot;nsAbLDAPMessageBase::OnLDAPInit(): failed to Initialise operation&quot;);</span>
<a href="#l27.24"></a><span id="l27.24">     InitFailed();</span>
<a href="#l27.25"></a><span id="l27.25">     return rv;</span>
<a href="#l27.26"></a><span id="l27.26">   }</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28">   // Try non-password mechanisms first</span>
<a href="#l27.29"></a><span id="l27.29">   if (mSaslMechanism.EqualsLiteral(&quot;GSSAPI&quot;))</span>
<a href="#l27.30"></a><span id="l27.30">   {</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-    nsCAutoString service;</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+    nsAutoCString service;</span>
<a href="#l27.33"></a><span id="l27.33">     rv = mDirectoryUrl-&gt;GetAsciiHost(service);</span>
<a href="#l27.34"></a><span id="l27.34">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.35"></a><span id="l27.35"> </span>
<a href="#l27.36"></a><span id="l27.36">     service.Insert(NS_LITERAL_CSTRING(&quot;ldap@&quot;), 0);</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38">     nsCOMPtr&lt;nsIAuthModule&gt; authModule =</span>
<a href="#l27.39"></a><span id="l27.39">       do_CreateInstance(NS_AUTH_MODULE_CONTRACTID_PREFIX &quot;sasl-gssapi&quot;, &amp;rv);</span>
<a href="#l27.40"></a><span id="l27.40">     NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPReplicationData.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -144,17 +144,17 @@ NS_IMETHODIMP nsAbLDAPProcessReplication</span>
<a href="#l28.4"></a><span id="l28.4">     // force close since we need to delete the file.</span>
<a href="#l28.5"></a><span id="l28.5">     mReplicationDB-&gt;ForceClosed();</span>
<a href="#l28.6"></a><span id="l28.6">     mDBOpen = false;</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8">     // delete the unsaved replication file</span>
<a href="#l28.9"></a><span id="l28.9">     if (mReplicationFile) {</span>
<a href="#l28.10"></a><span id="l28.10">       rv = mReplicationFile-&gt;Remove(false);</span>
<a href="#l28.11"></a><span id="l28.11">       if (NS_SUCCEEDED(rv) &amp;&amp; mDirectory) {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        nsCAutoString fileName;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+        nsAutoCString fileName;</span>
<a href="#l28.14"></a><span id="l28.14">         rv = mDirectory-&gt;GetReplicationFileName(fileName);</span>
<a href="#l28.15"></a><span id="l28.15">         // now put back the backed up replicated file if aborted</span>
<a href="#l28.16"></a><span id="l28.16">         if (NS_SUCCEEDED(rv) &amp;&amp; mBackupReplicationFile)</span>
<a href="#l28.17"></a><span id="l28.17">           rv = mBackupReplicationFile-&gt;MoveToNative(nullptr, fileName);</span>
<a href="#l28.18"></a><span id="l28.18">       }</span>
<a href="#l28.19"></a><span id="l28.19">     }</span>
<a href="#l28.20"></a><span id="l28.20">   }</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -175,35 +175,35 @@ nsresult nsAbLDAPProcessReplicationData:</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24">   mOperation = do_CreateInstance(NS_LDAPOPERATION_CONTRACTID, &amp;rv);</span>
<a href="#l28.25"></a><span id="l28.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.26"></a><span id="l28.26"> </span>
<a href="#l28.27"></a><span id="l28.27">   rv = mOperation-&gt;Init(mConnection, this, nullptr);</span>
<a href="#l28.28"></a><span id="l28.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30">   // get the relevant attributes associated with the directory server url</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-  nsCAutoString urlFilter;</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+  nsAutoCString urlFilter;</span>
<a href="#l28.33"></a><span id="l28.33">   rv = mDirectoryUrl-&gt;GetFilter(urlFilter);</span>
<a href="#l28.34"></a><span id="l28.34">   if (NS_FAILED(rv))</span>
<a href="#l28.35"></a><span id="l28.35">     return rv;</span>
<a href="#l28.36"></a><span id="l28.36"> </span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">-  nsCAutoString dn;</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+  nsAutoCString dn;</span>
<a href="#l28.39"></a><span id="l28.39">   rv = mDirectoryUrl-&gt;GetDn(dn);</span>
<a href="#l28.40"></a><span id="l28.40">   if (NS_FAILED(rv))</span>
<a href="#l28.41"></a><span id="l28.41">     return rv;</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43">   if (dn.IsEmpty())</span>
<a href="#l28.44"></a><span id="l28.44">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l28.45"></a><span id="l28.45"> </span>
<a href="#l28.46"></a><span id="l28.46">   int32_t scope;</span>
<a href="#l28.47"></a><span id="l28.47">   rv = mDirectoryUrl-&gt;GetScope(&amp;scope);</span>
<a href="#l28.48"></a><span id="l28.48">   if (NS_FAILED(rv))</span>
<a href="#l28.49"></a><span id="l28.49">     return rv;</span>
<a href="#l28.50"></a><span id="l28.50"> </span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-  nsCAutoString attributes;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+  nsAutoCString attributes;</span>
<a href="#l28.53"></a><span id="l28.53">   rv = mDirectoryUrl-&gt;GetAttributes(attributes);</span>
<a href="#l28.54"></a><span id="l28.54">   if (NS_FAILED(rv))</span>
<a href="#l28.55"></a><span id="l28.55">     return rv;</span>
<a href="#l28.56"></a><span id="l28.56"> </span>
<a href="#l28.57"></a><span id="l28.57">   mState = kReplicatingAll;</span>
<a href="#l28.58"></a><span id="l28.58"> </span>
<a href="#l28.59"></a><span id="l28.59">   if (mListener &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l28.60"></a><span id="l28.60">     // XXX Cast from bool to nsresult</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineat">@@ -253,17 +253,17 @@ nsresult nsAbLDAPProcessReplicationData:</span>
<a href="#l28.62"></a><span id="l28.62"> </span>
<a href="#l28.63"></a><span id="l28.63">     rv = mReplicationDB-&gt;CreateNewCardAndAddToDB(newCard, false, nullptr);</span>
<a href="#l28.64"></a><span id="l28.64">     if(NS_FAILED(rv)) {</span>
<a href="#l28.65"></a><span id="l28.65">         Abort();</span>
<a href="#l28.66"></a><span id="l28.66">         return rv;</span>
<a href="#l28.67"></a><span id="l28.67">     }</span>
<a href="#l28.68"></a><span id="l28.68"> </span>
<a href="#l28.69"></a><span id="l28.69">     // now set the attribute for the DN of the entry in the card in the DB</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-    nsCAutoString authDN;</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineplus">+    nsAutoCString authDN;</span>
<a href="#l28.72"></a><span id="l28.72">     rv = aMessage-&gt;GetDn(authDN);</span>
<a href="#l28.73"></a><span id="l28.73">     if(NS_SUCCEEDED(rv) &amp;&amp; !authDN.IsEmpty())</span>
<a href="#l28.74"></a><span id="l28.74">     {</span>
<a href="#l28.75"></a><span id="l28.75">         newCard-&gt;SetPropertyAsAUTF8String(&quot;_DN&quot;, authDN);</span>
<a href="#l28.76"></a><span id="l28.76">     }</span>
<a href="#l28.77"></a><span id="l28.77"> </span>
<a href="#l28.78"></a><span id="l28.78">     rv = mReplicationDB-&gt;EditCard(newCard, false, nullptr);</span>
<a href="#l28.79"></a><span id="l28.79">     if(NS_FAILED(rv)) {</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineat">@@ -328,17 +328,17 @@ nsresult nsAbLDAPProcessReplicationData:</span>
<a href="#l28.81"></a><span id="l28.81">         // if error result is returned remove the replicated file</span>
<a href="#l28.82"></a><span id="l28.82">         if(mReplicationFile) {</span>
<a href="#l28.83"></a><span id="l28.83">             rv = mReplicationFile-&gt;Remove(false);</span>
<a href="#l28.84"></a><span id="l28.84">             NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Replication File Remove on Failure failed&quot;);</span>
<a href="#l28.85"></a><span id="l28.85">             if(NS_SUCCEEDED(rv)) {</span>
<a href="#l28.86"></a><span id="l28.86">                 // now put back the backed up replicated file</span>
<a href="#l28.87"></a><span id="l28.87">                 if(mBackupReplicationFile &amp;&amp; mDirectory) </span>
<a href="#l28.88"></a><span id="l28.88">                 {</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-                  nsCAutoString fileName;</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineplus">+                  nsAutoCString fileName;</span>
<a href="#l28.91"></a><span id="l28.91">                   rv = mDirectory-&gt;GetReplicationFileName(fileName);</span>
<a href="#l28.92"></a><span id="l28.92">                   if (NS_SUCCEEDED(rv) &amp;&amp; !fileName.IsEmpty())</span>
<a href="#l28.93"></a><span id="l28.93">                   {</span>
<a href="#l28.94"></a><span id="l28.94">                     rv = mBackupReplicationFile-&gt;MoveToNative(nullptr, fileName);</span>
<a href="#l28.95"></a><span id="l28.95">                     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Replication Backup File Move back on Failure failed&quot;);</span>
<a href="#l28.96"></a><span id="l28.96">                   }</span>
<a href="#l28.97"></a><span id="l28.97">                 }</span>
<a href="#l28.98"></a><span id="l28.98">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPReplicationQuery.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -21,17 +21,17 @@ NS_IMPL_THREADSAFE_ISUPPORTS1(nsAbLDAPRe</span>
<a href="#l29.4"></a><span id="l29.4"> </span>
<a href="#l29.5"></a><span id="l29.5"> nsAbLDAPReplicationQuery::nsAbLDAPReplicationQuery()</span>
<a href="#l29.6"></a><span id="l29.6">     :  mInitialized(false)</span>
<a href="#l29.7"></a><span id="l29.7"> {</span>
<a href="#l29.8"></a><span id="l29.8"> }</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10"> nsresult nsAbLDAPReplicationQuery::InitLDAPData()</span>
<a href="#l29.11"></a><span id="l29.11"> {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l29.14"></a><span id="l29.14">   nsresult rv = mDirectory-&gt;GetReplicationFileName(fileName);</span>
<a href="#l29.15"></a><span id="l29.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.16"></a><span id="l29.16"> </span>
<a href="#l29.17"></a><span id="l29.17">   // this is done here to take care of the problem related to bug # 99124.</span>
<a href="#l29.18"></a><span id="l29.18">   // earlier versions of Mozilla could have the fileName associated with the directory</span>
<a href="#l29.19"></a><span id="l29.19">   // to be abook.mab which is the profile's personal addressbook. If the pref points to</span>
<a href="#l29.20"></a><span id="l29.20">   // it, calls nsDirPrefs to generate a new server filename.</span>
<a href="#l29.21"></a><span id="l29.21">   if (fileName.IsEmpty() || fileName.EqualsLiteral(kPersonalAddressbook))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDIFService.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDIFService.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -385,18 +385,18 @@ void nsAbLDIFService::AddLdifRowToDataba</span>
<a href="#l30.4"></a><span id="l30.4">   // Clear buffer for next record</span>
<a href="#l30.5"></a><span id="l30.5">   ClearLdifRecordBuffer();</span>
<a href="#l30.6"></a><span id="l30.6"> }</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> void nsAbLDIFService::AddLdifColToDatabase(nsIAddrDatabase *aDatabase,</span>
<a href="#l30.9"></a><span id="l30.9">                                            nsIMdbRow* newRow, char* typeSlot,</span>
<a href="#l30.10"></a><span id="l30.10">                                            char* valueSlot, bool bIsList)</span>
<a href="#l30.11"></a><span id="l30.11"> {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  nsCAutoString colType(typeSlot);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-  nsCAutoString column(valueSlot);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  nsAutoCString colType(typeSlot);</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+  nsAutoCString column(valueSlot);</span>
<a href="#l30.16"></a><span id="l30.16"> </span>
<a href="#l30.17"></a><span id="l30.17">   // 4.x exports attributes like &quot;givenname&quot;, </span>
<a href="#l30.18"></a><span id="l30.18">   // mozilla does &quot;givenName&quot; to be compliant with RFC 2798</span>
<a href="#l30.19"></a><span id="l30.19">   ToLowerCase(colType);</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21">   mdb_u1 firstByte = (mdb_u1)(colType.get())[0];</span>
<a href="#l30.22"></a><span id="l30.22">   switch ( firstByte )</span>
<a href="#l30.23"></a><span id="l30.23">   {</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineat">@@ -617,17 +617,17 @@ void nsAbLDIFService::AddLdifColToDataba</span>
<a href="#l30.25"></a><span id="l30.25">       if (mStoreLocAsHome)</span>
<a href="#l30.26"></a><span id="l30.26">         aDatabase-&gt;AddHomeZipCode(newRow, column.get());</span>
<a href="#l30.27"></a><span id="l30.27">       else</span>
<a href="#l30.28"></a><span id="l30.28">         aDatabase-&gt;AddWorkZipCode(newRow, column.get());</span>
<a href="#l30.29"></a><span id="l30.29">     }</span>
<a href="#l30.30"></a><span id="l30.30"> </span>
<a href="#l30.31"></a><span id="l30.31">     else if (colType.EqualsLiteral(&quot;postofficebox&quot;))</span>
<a href="#l30.32"></a><span id="l30.32">     {</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-      nsCAutoString workAddr1, workAddr2;</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+      nsAutoCString workAddr1, workAddr2;</span>
<a href="#l30.35"></a><span id="l30.35">       SplitCRLFAddressField(column, workAddr1, workAddr2);</span>
<a href="#l30.36"></a><span id="l30.36">       aDatabase-&gt;AddWorkAddress(newRow, workAddr1.get());</span>
<a href="#l30.37"></a><span id="l30.37">       aDatabase-&gt;AddWorkAddress2(newRow, workAddr2.get());</span>
<a href="#l30.38"></a><span id="l30.38">     }</span>
<a href="#l30.39"></a><span id="l30.39">     else if (colType.EqualsLiteral(&quot;pager&quot;) || colType.EqualsLiteral(&quot;pagerphone&quot;))</span>
<a href="#l30.40"></a><span id="l30.40">       aDatabase-&gt;AddPagerNumber(newRow, column.get());</span>
<a href="#l30.41"></a><span id="l30.41"> </span>
<a href="#l30.42"></a><span id="l30.42">     break; // 'p'</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineat">@@ -647,17 +647,17 @@ void nsAbLDIFService::AddLdifColToDataba</span>
<a href="#l30.44"></a><span id="l30.44">     if (colType.EqualsLiteral(&quot;sn&quot;) || colType.EqualsLiteral(&quot;surname&quot;))</span>
<a href="#l30.45"></a><span id="l30.45">       aDatabase-&gt;AddLastName(newRow, column.get());</span>
<a href="#l30.46"></a><span id="l30.46"> </span>
<a href="#l30.47"></a><span id="l30.47">     else if (colType.EqualsLiteral(&quot;street&quot;))</span>
<a href="#l30.48"></a><span id="l30.48">       aDatabase-&gt;AddWorkAddress(newRow, column.get());</span>
<a href="#l30.49"></a><span id="l30.49"> </span>
<a href="#l30.50"></a><span id="l30.50">     else if (colType.EqualsLiteral(&quot;streetaddress&quot;))</span>
<a href="#l30.51"></a><span id="l30.51">     {</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineminus">-      nsCAutoString addr1, addr2;</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineplus">+      nsAutoCString addr1, addr2;</span>
<a href="#l30.54"></a><span id="l30.54">       SplitCRLFAddressField(column, addr1, addr2);</span>
<a href="#l30.55"></a><span id="l30.55">       if (mStoreLocAsHome)</span>
<a href="#l30.56"></a><span id="l30.56">       {</span>
<a href="#l30.57"></a><span id="l30.57">         aDatabase-&gt;AddHomeAddress(newRow, addr1.get());</span>
<a href="#l30.58"></a><span id="l30.58">         aDatabase-&gt;AddHomeAddress2(newRow, addr2.get());</span>
<a href="#l30.59"></a><span id="l30.59">       }</span>
<a href="#l30.60"></a><span id="l30.60">       else</span>
<a href="#l30.61"></a><span id="l30.61">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirFactory.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirFactory.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -48,17 +48,17 @@ NS_IMETHODIMP nsAbMDBDirFactory::GetDire</span>
<a href="#l31.4"></a><span id="l31.4">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6">   nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l31.7"></a><span id="l31.7">   rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9">   nsCOMPtr&lt;nsIAddrDatabase&gt; listDatabase;</span>
<a href="#l31.10"></a><span id="l31.10">   if (NS_SUCCEEDED(rv))</span>
<a href="#l31.11"></a><span id="l31.11">   {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    nsCAutoString fileName;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    nsAutoCString fileName;</span>
<a href="#l31.14"></a><span id="l31.14">       </span>
<a href="#l31.15"></a><span id="l31.15">     if (StringBeginsWith(aURI, NS_LITERAL_CSTRING(kMDBDirectoryRoot)))</span>
<a href="#l31.16"></a><span id="l31.16">       fileName = Substring(aURI, kMDBDirectoryRootLen, aURI.Length() - kMDBDirectoryRootLen);</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">     rv = dbPath-&gt;AppendNative(fileName);</span>
<a href="#l31.19"></a><span id="l31.19">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.20"></a><span id="l31.20"> </span>
<a href="#l31.21"></a><span id="l31.21">     nsCOMPtr&lt;nsIAddrDatabase&gt; addrDBFactory = do_GetService(NS_ADDRDATABASE_CONTRACTID, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -59,17 +59,17 @@ NS_IMETHODIMP nsAbMDBDirectory::Init(con</span>
<a href="#l32.4"></a><span id="l32.4">   // Mailing lists don't have their own prefs.</span>
<a href="#l32.5"></a><span id="l32.5">   if (m_DirPrefId.IsEmpty() &amp;&amp; !m_IsMailList)</span>
<a href="#l32.6"></a><span id="l32.6">   {</span>
<a href="#l32.7"></a><span id="l32.7">     // Find the first ? (of the search params) if there is one.</span>
<a href="#l32.8"></a><span id="l32.8">     // We know we can start at the end of the moz-abmdbdirectory:// because</span>
<a href="#l32.9"></a><span id="l32.9">     // that's the URI we should have been passed.</span>
<a href="#l32.10"></a><span id="l32.10">     int32_t searchCharLocation = uri.FindChar('?', kMDBDirectoryRootLen);</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    nsCAutoString filename;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    nsAutoCString filename;</span>
<a href="#l32.14"></a><span id="l32.14"> </span>
<a href="#l32.15"></a><span id="l32.15">     // extract the filename from the uri.</span>
<a href="#l32.16"></a><span id="l32.16">     if (searchCharLocation == -1)</span>
<a href="#l32.17"></a><span id="l32.17">       filename = Substring(uri, kMDBDirectoryRootLen);</span>
<a href="#l32.18"></a><span id="l32.18">     else</span>
<a href="#l32.19"></a><span id="l32.19">       filename = Substring(uri, kMDBDirectoryRootLen, searchCharLocation - kMDBDirectoryRootLen);</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21">     // Get the pref servers and the address book directory branch</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -100,17 +100,17 @@ NS_IMETHODIMP nsAbMDBDirectory::Init(con</span>
<a href="#l32.23"></a><span id="l32.23">         if (NS_SUCCEEDED(prefBranch-&gt;GetCharPref(child.get(),</span>
<a href="#l32.24"></a><span id="l32.24">                                                  getter_Copies(childValue))))</span>
<a href="#l32.25"></a><span id="l32.25">         {</span>
<a href="#l32.26"></a><span id="l32.26">           if (childValue == filename)</span>
<a href="#l32.27"></a><span id="l32.27">           {</span>
<a href="#l32.28"></a><span id="l32.28">             dotOffset = child.RFindChar('.');</span>
<a href="#l32.29"></a><span id="l32.29">             if (dotOffset != -1)</span>
<a href="#l32.30"></a><span id="l32.30">             {</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-              nsCAutoString prefName(StringHead(child, dotOffset));</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+              nsAutoCString prefName(StringHead(child, dotOffset));</span>
<a href="#l32.33"></a><span id="l32.33">               m_DirPrefId.AssignLiteral(PREF_LDAP_SERVER_TREE_NAME &quot;.&quot;);</span>
<a href="#l32.34"></a><span id="l32.34">               m_DirPrefId.Append(prefName);</span>
<a href="#l32.35"></a><span id="l32.35">             }</span>
<a href="#l32.36"></a><span id="l32.36">           }</span>
<a href="#l32.37"></a><span id="l32.37">         }</span>
<a href="#l32.38"></a><span id="l32.38">       }</span>
<a href="#l32.39"></a><span id="l32.39">     }     </span>
<a href="#l32.40"></a><span id="l32.40">     NS_FREE_XPCOM_ALLOCATED_POINTER_ARRAY(childCount, childArray);</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineat">@@ -500,17 +500,17 @@ NS_IMETHODIMP nsAbMDBDirectory::DeleteCa</span>
<a href="#l32.42"></a><span id="l32.42">         else</span>
<a href="#l32.43"></a><span id="l32.43">         {</span>
<a href="#l32.44"></a><span id="l32.44">           mDatabase-&gt;DeleteCard(card, true, this);</span>
<a href="#l32.45"></a><span id="l32.45">           bool bIsMailList = false;</span>
<a href="#l32.46"></a><span id="l32.46">           card-&gt;GetIsMailList(&amp;bIsMailList);</span>
<a href="#l32.47"></a><span id="l32.47">           if (bIsMailList)</span>
<a href="#l32.48"></a><span id="l32.48">           {</span>
<a href="#l32.49"></a><span id="l32.49">             //to do, get mailing list dir side uri and notify nsIAbManager to remove it</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-            nsCAutoString listUri(mURI);</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+            nsAutoCString listUri(mURI);</span>
<a href="#l32.52"></a><span id="l32.52">             listUri.AppendLiteral(&quot;/MailList&quot;);</span>
<a href="#l32.53"></a><span id="l32.53">             listUri.AppendInt(rowID);</span>
<a href="#l32.54"></a><span id="l32.54">             if (!listUri.IsEmpty())</span>
<a href="#l32.55"></a><span id="l32.55">             {</span>
<a href="#l32.56"></a><span id="l32.56">               nsresult rv = NS_OK;</span>
<a href="#l32.57"></a><span id="l32.57"> </span>
<a href="#l32.58"></a><span id="l32.58">               nsCOMPtr&lt;nsIAbManager&gt; abManager =</span>
<a href="#l32.59"></a><span id="l32.59">                   do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineat">@@ -622,17 +622,17 @@ NS_IMETHODIMP nsAbMDBDirectory::AddMailL</span>
<a href="#l32.61"></a><span id="l32.61">   else</span>
<a href="#l32.62"></a><span id="l32.62">     mDatabase-&gt;CreateMailListAndAddToDB(list, true, this);</span>
<a href="#l32.63"></a><span id="l32.63"> </span>
<a href="#l32.64"></a><span id="l32.64">   mDatabase-&gt;Commit(nsAddrDBCommitType::kLargeCommit);</span>
<a href="#l32.65"></a><span id="l32.65"> </span>
<a href="#l32.66"></a><span id="l32.66">   uint32_t dbRowID;</span>
<a href="#l32.67"></a><span id="l32.67">   dblist-&gt;GetDbRowID(&amp;dbRowID);</span>
<a href="#l32.68"></a><span id="l32.68"> </span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-  nsCAutoString listUri(mURI);</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+  nsAutoCString listUri(mURI);</span>
<a href="#l32.71"></a><span id="l32.71">   listUri.AppendLiteral(&quot;/MailList&quot;);</span>
<a href="#l32.72"></a><span id="l32.72">   listUri.AppendInt(dbRowID);</span>
<a href="#l32.73"></a><span id="l32.73"> </span>
<a href="#l32.74"></a><span id="l32.74">   nsCOMPtr&lt;nsIAbDirectory&gt; newList;</span>
<a href="#l32.75"></a><span id="l32.75">   rv = AddDirectory(listUri.get(), getter_AddRefs(newList));</span>
<a href="#l32.76"></a><span id="l32.76">   if (NS_SUCCEEDED(rv) &amp;&amp; newList)</span>
<a href="#l32.77"></a><span id="l32.77">   {</span>
<a href="#l32.78"></a><span id="l32.78">     nsCOMPtr&lt;nsIAbMDBDirectory&gt; dbnewList(do_QueryInterface(newList, &amp;rv));</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineat">@@ -975,17 +975,17 @@ nsresult nsAbMDBDirectory::GetAbDatabase</span>
<a href="#l32.80"></a><span id="l32.80">   if (mDatabase)</span>
<a href="#l32.81"></a><span id="l32.81">     return NS_OK;</span>
<a href="#l32.82"></a><span id="l32.82"> </span>
<a href="#l32.83"></a><span id="l32.83">   nsresult rv;</span>
<a href="#l32.84"></a><span id="l32.84"> </span>
<a href="#l32.85"></a><span id="l32.85">   if (m_IsMailList)</span>
<a href="#l32.86"></a><span id="l32.86">   {</span>
<a href="#l32.87"></a><span id="l32.87">     // Get the database of the parent directory.</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineminus">-    nsCAutoString parentURI(mURINoQuery);</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineplus">+    nsAutoCString parentURI(mURINoQuery);</span>
<a href="#l32.90"></a><span id="l32.90"> </span>
<a href="#l32.91"></a><span id="l32.91">     int32_t pos = parentURI.RFindChar('/');</span>
<a href="#l32.92"></a><span id="l32.92"> </span>
<a href="#l32.93"></a><span id="l32.93">     // If we didn't find a / something really bad has happened</span>
<a href="#l32.94"></a><span id="l32.94">     if (pos == -1)</span>
<a href="#l32.95"></a><span id="l32.95">       return NS_ERROR_FAILURE;</span>
<a href="#l32.96"></a><span id="l32.96"> </span>
<a href="#l32.97"></a><span id="l32.97">     parentURI = StringHead(parentURI, pos);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -245,25 +245,25 @@ NS_IMETHODIMP nsAbManager::GetDirectory(</span>
<a href="#l33.4"></a><span id="l33.4">   }</span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6">   // Do we have a copy of this directory already within our look-up table?</span>
<a href="#l33.7"></a><span id="l33.7">   if (!mAbStore.Get(aURI, getter_AddRefs(directory)))</span>
<a href="#l33.8"></a><span id="l33.8">   {</span>
<a href="#l33.9"></a><span id="l33.9">     // The directory wasn't in our look-up table, so we need to instantiate</span>
<a href="#l33.10"></a><span id="l33.10">     // it. First, extract the scheme from the URI...</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    nsCAutoString scheme;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    nsAutoCString scheme;</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15">     int32_t colon = aURI.FindChar(':');</span>
<a href="#l33.16"></a><span id="l33.16">     if (colon &lt;= 0)</span>
<a href="#l33.17"></a><span id="l33.17">       return NS_ERROR_MALFORMED_URI;</span>
<a href="#l33.18"></a><span id="l33.18">     scheme = Substring(aURI, 0, colon);</span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20">     // Construct the appropriate nsIAbDirectory...</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineminus">-    nsCAutoString contractID;</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineplus">+    nsAutoCString contractID;</span>
<a href="#l33.23"></a><span id="l33.23">     contractID.AssignLiteral(NS_AB_DIRECTORY_TYPE_CONTRACTID_PREFIX);</span>
<a href="#l33.24"></a><span id="l33.24">     contractID.Append(scheme);</span>
<a href="#l33.25"></a><span id="l33.25">     directory = do_CreateInstance(contractID.get(), &amp;rv);</span>
<a href="#l33.26"></a><span id="l33.26">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.27"></a><span id="l33.27"> </span>
<a href="#l33.28"></a><span id="l33.28">     // Init it with the URI</span>
<a href="#l33.29"></a><span id="l33.29">     rv = directory-&gt;Init(PromiseFlatCString(aURI).get());</span>
<a href="#l33.30"></a><span id="l33.30">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineat">@@ -425,17 +425,17 @@ NS_IMETHODIMP nsAbManager::NotifyDirecto</span>
<a href="#l33.32"></a><span id="l33.32"> </span>
<a href="#l33.33"></a><span id="l33.33"> NS_IMETHODIMP nsAbManager::GetUserProfileDirectory(nsIFile **userDir)</span>
<a href="#l33.34"></a><span id="l33.34"> {</span>
<a href="#l33.35"></a><span id="l33.35">   NS_ENSURE_ARG_POINTER(userDir);</span>
<a href="#l33.36"></a><span id="l33.36">   *userDir = nullptr;</span>
<a href="#l33.37"></a><span id="l33.37"> </span>
<a href="#l33.38"></a><span id="l33.38">   nsresult rv;</span>
<a href="#l33.39"></a><span id="l33.39">   nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineminus">-  nsCAutoString pathBuf;</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+  nsAutoCString pathBuf;</span>
<a href="#l33.42"></a><span id="l33.42"> </span>
<a href="#l33.43"></a><span id="l33.43">   rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR, getter_AddRefs(profileDir));</span>
<a href="#l33.44"></a><span id="l33.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.45"></a><span id="l33.45"> </span>
<a href="#l33.46"></a><span id="l33.46">   return CallQueryInterface(profileDir, userDir);</span>
<a href="#l33.47"></a><span id="l33.47"> }</span>
<a href="#l33.48"></a><span id="l33.48"> </span>
<a href="#l33.49"></a><span id="l33.49"> NS_IMETHODIMP nsAbManager::MailListNameExists(const PRUnichar *name, bool *exist)</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineat">@@ -863,17 +863,17 @@ nsAbManager::ExportDirectoryToLDIF(nsIAb</span>
<a href="#l33.51"></a><span id="l33.51">           length = valueCStr.Length();</span>
<a href="#l33.52"></a><span id="l33.52">           rv = outputStream-&gt;Write(valueCStr.get(), length, &amp;writeCount);</span>
<a href="#l33.53"></a><span id="l33.53">           NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.54"></a><span id="l33.54">           if (length != writeCount)</span>
<a href="#l33.55"></a><span id="l33.55">             return NS_ERROR_FAILURE;</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57">           valueCStr.Truncate();</span>
<a href="#l33.58"></a><span id="l33.58"> </span>
<a href="#l33.59"></a><span id="l33.59" class="difflineminus">-          nsCAutoString ldapAttribute;</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineplus">+          nsAutoCString ldapAttribute;</span>
<a href="#l33.61"></a><span id="l33.61"> </span>
<a href="#l33.62"></a><span id="l33.62">           for (i = 0; i &lt; ArrayLength(EXPORT_ATTRIBUTES_TABLE); i++) {</span>
<a href="#l33.63"></a><span id="l33.63">             if (NS_SUCCEEDED(attrMap-&gt;GetFirstAttribute(nsDependentCString(EXPORT_ATTRIBUTES_TABLE[i].abPropertyName),</span>
<a href="#l33.64"></a><span id="l33.64">                                                         ldapAttribute)) &amp;&amp;</span>
<a href="#l33.65"></a><span id="l33.65">                 !ldapAttribute.IsEmpty()) {</span>
<a href="#l33.66"></a><span id="l33.66"> </span>
<a href="#l33.67"></a><span id="l33.67">               rv = card-&gt;GetPropertyAsAString(EXPORT_ATTRIBUTES_TABLE[i].abPropertyName, value);</span>
<a href="#l33.68"></a><span id="l33.68">               if (NS_FAILED(rv))</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineat">@@ -940,17 +940,17 @@ nsresult nsAbManager::AppendLDIFForMailL</span>
<a href="#l33.70"></a><span id="l33.70"> </span>
<a href="#l33.71"></a><span id="l33.71">   aResult += MSG_LINEBREAK \</span>
<a href="#l33.72"></a><span id="l33.72">              &quot;objectclass: top&quot; MSG_LINEBREAK \</span>
<a href="#l33.73"></a><span id="l33.73">              &quot;objectclass: groupOfNames&quot; MSG_LINEBREAK;</span>
<a href="#l33.74"></a><span id="l33.74"> </span>
<a href="#l33.75"></a><span id="l33.75">   rv = aCard-&gt;GetDisplayName(attrValue);</span>
<a href="#l33.76"></a><span id="l33.76">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.77"></a><span id="l33.77"> </span>
<a href="#l33.78"></a><span id="l33.78" class="difflineminus">-  nsCAutoString ldapAttributeName;</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineplus">+  nsAutoCString ldapAttributeName;</span>
<a href="#l33.80"></a><span id="l33.80"> </span>
<a href="#l33.81"></a><span id="l33.81">   rv = aAttrMap-&gt;GetFirstAttribute(NS_LITERAL_CSTRING(kDisplayNameProperty),</span>
<a href="#l33.82"></a><span id="l33.82">                                   ldapAttributeName);</span>
<a href="#l33.83"></a><span id="l33.83">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.84"></a><span id="l33.84"> </span>
<a href="#l33.85"></a><span id="l33.85">   rv = AppendProperty(ldapAttributeName.get(), attrValue.get(), aResult);</span>
<a href="#l33.86"></a><span id="l33.86">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.87"></a><span id="l33.87">   aResult += MSG_LINEBREAK;</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineat">@@ -1007,17 +1007,17 @@ nsresult nsAbManager::AppendLDIFForMailL</span>
<a href="#l33.89"></a><span id="l33.89">   aResult += MSG_LINEBREAK;</span>
<a href="#l33.90"></a><span id="l33.90">   return NS_OK;</span>
<a href="#l33.91"></a><span id="l33.91"> }</span>
<a href="#l33.92"></a><span id="l33.92"> </span>
<a href="#l33.93"></a><span id="l33.93"> nsresult nsAbManager::AppendDNForCard(const char *aProperty, nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult)</span>
<a href="#l33.94"></a><span id="l33.94"> {</span>
<a href="#l33.95"></a><span id="l33.95">   nsString email;</span>
<a href="#l33.96"></a><span id="l33.96">   nsString displayName;</span>
<a href="#l33.97"></a><span id="l33.97" class="difflineminus">-  nsCAutoString ldapAttributeName;</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineplus">+  nsAutoCString ldapAttributeName;</span>
<a href="#l33.99"></a><span id="l33.99"> </span>
<a href="#l33.100"></a><span id="l33.100">   nsresult rv = aCard-&gt;GetPrimaryEmail(email);</span>
<a href="#l33.101"></a><span id="l33.101">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.102"></a><span id="l33.102"> </span>
<a href="#l33.103"></a><span id="l33.103">   rv = aCard-&gt;GetDisplayName(displayName);</span>
<a href="#l33.104"></a><span id="l33.104">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l33.105"></a><span id="l33.105"> </span>
<a href="#l33.106"></a><span id="l33.106">   nsString cnStr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOSXDirectory.mm</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOSXDirectory.mm</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -36,17 +36,17 @@</span>
<a href="#l34.4"></a><span id="l34.4">  */</span>
<a href="#l34.5"></a><span id="l34.5"> #define OSX_CARD_STORE_INIT 100</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7"> static nsresult</span>
<a href="#l34.8"></a><span id="l34.8"> GetOrCreateGroup(NSString *aUid, nsIAbDirectory **aResult)</span>
<a href="#l34.9"></a><span id="l34.9"> {</span>
<a href="#l34.10"></a><span id="l34.10">   NS_ASSERTION(aUid, &quot;No UID for group!.&quot;);</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  nsCAutoString uri(NS_ABOSXDIRECTORY_URI_PREFIX);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  nsAutoCString uri(NS_ABOSXDIRECTORY_URI_PREFIX);</span>
<a href="#l34.14"></a><span id="l34.14">   AppendToCString(aUid, uri);</span>
<a href="#l34.15"></a><span id="l34.15"> </span>
<a href="#l34.16"></a><span id="l34.16">   nsresult rv;</span>
<a href="#l34.17"></a><span id="l34.17">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l34.18"></a><span id="l34.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20">   nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l34.21"></a><span id="l34.21">   rv = abManager-&gt;GetDirectory(uri, getter_AddRefs(directory));</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -59,17 +59,17 @@ GetOrCreateGroup(NSString *aUid, nsIAbDi</span>
<a href="#l34.23"></a><span id="l34.23"> static nsresult</span>
<a href="#l34.24"></a><span id="l34.24"> GetCard(ABRecord *aRecord, nsIAbCard **aResult, nsIAbOSXDirectory *osxDirectory)</span>
<a href="#l34.25"></a><span id="l34.25"> {</span>
<a href="#l34.26"></a><span id="l34.26">   NSString *uid = [aRecord uniqueId];</span>
<a href="#l34.27"></a><span id="l34.27">   NS_ASSERTION(uid, &quot;No UID for card!.&quot;);</span>
<a href="#l34.28"></a><span id="l34.28">   if (!uid)</span>
<a href="#l34.29"></a><span id="l34.29">     return NS_ERROR_FAILURE;</span>
<a href="#l34.30"></a><span id="l34.30"> </span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-  nsCAutoString uri(NS_ABOSXCARD_URI_PREFIX);</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+  nsAutoCString uri(NS_ABOSXCARD_URI_PREFIX);</span>
<a href="#l34.33"></a><span id="l34.33">   AppendToCString(uid, uri);</span>
<a href="#l34.34"></a><span id="l34.34">   nsCOMPtr&lt;nsIAbOSXCard&gt; osxCard;</span>
<a href="#l34.35"></a><span id="l34.35">   nsresult rv = osxDirectory-&gt;GetCardByUri(uri, getter_AddRefs(osxCard));</span>
<a href="#l34.36"></a><span id="l34.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.37"></a><span id="l34.37"> </span>
<a href="#l34.38"></a><span id="l34.38">   nsCOMPtr&lt;nsIAbCard&gt; card = do_QueryInterface(osxCard, &amp;rv);</span>
<a href="#l34.39"></a><span id="l34.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.40"></a><span id="l34.40"> </span>
<a href="#l34.41"></a><span id="l34.41" class="difflineat">@@ -84,17 +84,17 @@ CreateCard(ABRecord *aRecord, nsIAbCard </span>
<a href="#l34.42"></a><span id="l34.42">   NS_ASSERTION(uid, &quot;No UID for card!.&quot;);</span>
<a href="#l34.43"></a><span id="l34.43">   if (!uid)</span>
<a href="#l34.44"></a><span id="l34.44">     return NS_ERROR_FAILURE;</span>
<a href="#l34.45"></a><span id="l34.45"> </span>
<a href="#l34.46"></a><span id="l34.46">   nsresult rv;</span>
<a href="#l34.47"></a><span id="l34.47">   nsCOMPtr&lt;nsIAbOSXCard&gt; osxCard = do_CreateInstance(NS_ABOSXCARD_CONTRACTID, &amp;rv);</span>
<a href="#l34.48"></a><span id="l34.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.49"></a><span id="l34.49"> </span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-  nsCAutoString uri(NS_ABOSXCARD_URI_PREFIX);</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineplus">+  nsAutoCString uri(NS_ABOSXCARD_URI_PREFIX);</span>
<a href="#l34.52"></a><span id="l34.52">   AppendToCString(uid, uri);</span>
<a href="#l34.53"></a><span id="l34.53"> </span>
<a href="#l34.54"></a><span id="l34.54">   rv = osxCard-&gt;Init(uri.get());</span>
<a href="#l34.55"></a><span id="l34.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.56"></a><span id="l34.56"> </span>
<a href="#l34.57"></a><span id="l34.57">   nsCOMPtr&lt;nsIAbCard&gt; card = do_QueryInterface(osxCard, &amp;rv);</span>
<a href="#l34.58"></a><span id="l34.58">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.59"></a><span id="l34.59"> </span>
<a href="#l34.60"></a><span id="l34.60" class="difflineat">@@ -214,17 +214,17 @@ Sync(NSString *aUid)</span>
<a href="#l34.61"></a><span id="l34.61">     nsCOMPtr&lt;nsIAbOSXDirectory&gt; osxDirectory =</span>
<a href="#l34.62"></a><span id="l34.62">       do_QueryInterface(directory, &amp;rv);</span>
<a href="#l34.63"></a><span id="l34.63">     NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l34.64"></a><span id="l34.64"> </span>
<a href="#l34.65"></a><span id="l34.65">     unsigned int i, count = [deleted count];</span>
<a href="#l34.66"></a><span id="l34.66">     for (i = 0; i &lt; count; ++i) {</span>
<a href="#l34.67"></a><span id="l34.67">       NSString *deletedUid = [deleted objectAtIndex:i];</span>
<a href="#l34.68"></a><span id="l34.68"> </span>
<a href="#l34.69"></a><span id="l34.69" class="difflineminus">-      nsCAutoString uid;</span>
<a href="#l34.70"></a><span id="l34.70" class="difflineplus">+      nsAutoCString uid;</span>
<a href="#l34.71"></a><span id="l34.71">       AppendToCString(deletedUid, uid);</span>
<a href="#l34.72"></a><span id="l34.72"> </span>
<a href="#l34.73"></a><span id="l34.73">       rv = osxDirectory-&gt;DeleteUid(uid);</span>
<a href="#l34.74"></a><span id="l34.74">       NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l34.75"></a><span id="l34.75">     }</span>
<a href="#l34.76"></a><span id="l34.76">   }</span>
<a href="#l34.77"></a><span id="l34.77">   </span>
<a href="#l34.78"></a><span id="l34.78">   if (!inserted &amp;&amp; !updated &amp;&amp; !deleted) {</span>
<a href="#l34.79"></a><span id="l34.79" class="difflineat">@@ -499,37 +499,37 @@ nsAbOSXDirectory::Init(const char *aUri)</span>
<a href="#l34.80"></a><span id="l34.80">     else</span>
<a href="#l34.81"></a><span id="l34.81">       rv = mCardList-&gt;Clear();</span>
<a href="#l34.82"></a><span id="l34.82">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.83"></a><span id="l34.83"> </span>
<a href="#l34.84"></a><span id="l34.84">     cardList = mCardList;</span>
<a href="#l34.85"></a><span id="l34.85">   }</span>
<a href="#l34.86"></a><span id="l34.86">   else</span>
<a href="#l34.87"></a><span id="l34.87">   {</span>
<a href="#l34.88"></a><span id="l34.88" class="difflineminus">-    nsCAutoString uid(Substring(mURINoQuery, sizeof(NS_ABOSXDIRECTORY_URI_PREFIX) - 1));</span>
<a href="#l34.89"></a><span id="l34.89" class="difflineplus">+    nsAutoCString uid(Substring(mURINoQuery, sizeof(NS_ABOSXDIRECTORY_URI_PREFIX) - 1));</span>
<a href="#l34.90"></a><span id="l34.90">     ABRecord *card = [addressBook recordForUniqueId:[NSString stringWithUTF8String:uid.get()]];</span>
<a href="#l34.91"></a><span id="l34.91">     NS_ASSERTION([card isKindOfClass:[ABGroup class]], &quot;Huh.&quot;);</span>
<a href="#l34.92"></a><span id="l34.92"> </span>
<a href="#l34.93"></a><span id="l34.93">     m_IsMailList = true;</span>
<a href="#l34.94"></a><span id="l34.94">     AppendToString([card valueForProperty:kABGroupNameProperty], m_ListDirName);</span>
<a href="#l34.95"></a><span id="l34.95"> </span>
<a href="#l34.96"></a><span id="l34.96" class="difflineminus">-    ABGroup *group = (ABGroup*)[addressBook recordForUniqueId:[NSString stringWithUTF8String:nsCAutoString(Substring(mURINoQuery, 21)).get()]];</span>
<a href="#l34.97"></a><span id="l34.97" class="difflineplus">+    ABGroup *group = (ABGroup*)[addressBook recordForUniqueId:[NSString stringWithUTF8String:nsAutoCString(Substring(mURINoQuery, 21)).get()]];</span>
<a href="#l34.98"></a><span id="l34.98">     cards = [[group members] arrayByAddingObjectsFromArray:[group subgroups]];</span>
<a href="#l34.99"></a><span id="l34.99"> </span>
<a href="#l34.100"></a><span id="l34.100">     if (!m_AddressList)</span>
<a href="#l34.101"></a><span id="l34.101">       m_AddressList = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l34.102"></a><span id="l34.102">     else</span>
<a href="#l34.103"></a><span id="l34.103">       rv = m_AddressList-&gt;Clear();</span>
<a href="#l34.104"></a><span id="l34.104">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.105"></a><span id="l34.105"> </span>
<a href="#l34.106"></a><span id="l34.106">     cardList = m_AddressList;</span>
<a href="#l34.107"></a><span id="l34.107">   }</span>
<a href="#l34.108"></a><span id="l34.108"> </span>
<a href="#l34.109"></a><span id="l34.109"> </span>
<a href="#l34.110"></a><span id="l34.110" class="difflineminus">-  nsCAutoString ourUuid;</span>
<a href="#l34.111"></a><span id="l34.111" class="difflineplus">+  nsAutoCString ourUuid;</span>
<a href="#l34.112"></a><span id="l34.112">   GetUuid(ourUuid);</span>
<a href="#l34.113"></a><span id="l34.113"> </span>
<a href="#l34.114"></a><span id="l34.114">   unsigned int nbCards = [cards count];</span>
<a href="#l34.115"></a><span id="l34.115">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l34.116"></a><span id="l34.116">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l34.117"></a><span id="l34.117">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.118"></a><span id="l34.118"> </span>
<a href="#l34.119"></a><span id="l34.119">   nsCOMPtr&lt;nsIAbOSXDirectory&gt; rootOSXDirectory;</span>
<a href="#l34.120"></a><span id="l34.120" class="difflineat">@@ -588,17 +588,17 @@ nsAbOSXDirectory::GetReadOnly(bool *aRea</span>
<a href="#l34.121"></a><span id="l34.121"> static bool</span>
<a href="#l34.122"></a><span id="l34.122"> CheckRedundantCards(nsIAbManager *aManager, nsIAbDirectory *aDirectory,</span>
<a href="#l34.123"></a><span id="l34.123">                     nsIAbCard *aCard, NSMutableArray *aCardList)</span>
<a href="#l34.124"></a><span id="l34.124"> {</span>
<a href="#l34.125"></a><span id="l34.125">   nsresult rv;</span>
<a href="#l34.126"></a><span id="l34.126">   nsCOMPtr&lt;nsIAbOSXCard&gt; osxCard = do_QueryInterface(aCard, &amp;rv);</span>
<a href="#l34.127"></a><span id="l34.127">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l34.128"></a><span id="l34.128"> </span>
<a href="#l34.129"></a><span id="l34.129" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l34.130"></a><span id="l34.130" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l34.131"></a><span id="l34.131">   rv = osxCard-&gt;GetURI(uri);</span>
<a href="#l34.132"></a><span id="l34.132">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l34.133"></a><span id="l34.133">   NSString *uid = [NSString stringWithUTF8String:(uri.get() + 21)];</span>
<a href="#l34.134"></a><span id="l34.134">   </span>
<a href="#l34.135"></a><span id="l34.135">   unsigned int i, count = [aCardList count];</span>
<a href="#l34.136"></a><span id="l34.136">   for (i = 0; i &lt; count; ++i) {</span>
<a href="#l34.137"></a><span id="l34.137">     if ([[[aCardList objectAtIndex:i] uniqueId] isEqualToString:uid]) {</span>
<a href="#l34.138"></a><span id="l34.138">       [aCardList removeObjectAtIndex:i];</span>
<a href="#l34.139"></a><span id="l34.139" class="difflineat">@@ -652,17 +652,17 @@ nsAbOSXDirectory::Update()</span>
<a href="#l34.140"></a><span id="l34.140">   </span>
<a href="#l34.141"></a><span id="l34.141">   ABAddressBook *addressBook = [ABAddressBook sharedAddressBook];</span>
<a href="#l34.142"></a><span id="l34.142">   // Due to the horrible way the address book code works wrt mailing lists</span>
<a href="#l34.143"></a><span id="l34.143">   // we have to use a different list depending on what we are. This pointer</span>
<a href="#l34.144"></a><span id="l34.144">   // holds a reference to that list.</span>
<a href="#l34.145"></a><span id="l34.145">   nsIMutableArray* cardList;</span>
<a href="#l34.146"></a><span id="l34.146">   NSArray *groups, *cards;</span>
<a href="#l34.147"></a><span id="l34.147">   if (m_IsMailList) {</span>
<a href="#l34.148"></a><span id="l34.148" class="difflineminus">-    ABGroup *group = (ABGroup*)[addressBook recordForUniqueId:[NSString stringWithUTF8String:nsCAutoString(Substring(mURINoQuery, 21)).get()]];</span>
<a href="#l34.149"></a><span id="l34.149" class="difflineplus">+    ABGroup *group = (ABGroup*)[addressBook recordForUniqueId:[NSString stringWithUTF8String:nsAutoCString(Substring(mURINoQuery, 21)).get()]];</span>
<a href="#l34.150"></a><span id="l34.150">     groups = nil;</span>
<a href="#l34.151"></a><span id="l34.151">     cards = [[group members] arrayByAddingObjectsFromArray:[group subgroups]];</span>
<a href="#l34.152"></a><span id="l34.152"> </span>
<a href="#l34.153"></a><span id="l34.153">     if (!m_AddressList)</span>
<a href="#l34.154"></a><span id="l34.154">     {</span>
<a href="#l34.155"></a><span id="l34.155">       m_AddressList = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l34.156"></a><span id="l34.156">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.157"></a><span id="l34.157">     }</span>
<a href="#l34.158"></a><span id="l34.158" class="difflineat">@@ -708,17 +708,17 @@ nsAbOSXDirectory::Update()</span>
<a href="#l34.159"></a><span id="l34.159">   {</span>
<a href="#l34.160"></a><span id="l34.160">     rv = GetCard(card, getter_AddRefs(abCard), rootOSXDirectory);</span>
<a href="#l34.161"></a><span id="l34.161">     if (NS_FAILED(rv))</span>
<a href="#l34.162"></a><span id="l34.162">       rv = CreateCard(card, getter_AddRefs(abCard));</span>
<a href="#l34.163"></a><span id="l34.163">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.164"></a><span id="l34.164">     AssertCard(abManager, abCard);</span>
<a href="#l34.165"></a><span id="l34.165">   }</span>
<a href="#l34.166"></a><span id="l34.166">   </span>
<a href="#l34.167"></a><span id="l34.167" class="difflineminus">-  card = (ABRecord*)[addressBook recordForUniqueId:[NSString stringWithUTF8String:nsCAutoString(Substring(mURINoQuery, 21)).get()]];</span>
<a href="#l34.168"></a><span id="l34.168" class="difflineplus">+  card = (ABRecord*)[addressBook recordForUniqueId:[NSString stringWithUTF8String:nsAutoCString(Substring(mURINoQuery, 21)).get()]];</span>
<a href="#l34.169"></a><span id="l34.169">   NSString * stringValue = [card valueForProperty:kABGroupNameProperty];</span>
<a href="#l34.170"></a><span id="l34.170">   if (![stringValue isEqualToString:WrapString(m_ListDirName)])</span>
<a href="#l34.171"></a><span id="l34.171">   {</span>
<a href="#l34.172"></a><span id="l34.172">     nsAutoString oldValue(m_ListDirName);</span>
<a href="#l34.173"></a><span id="l34.173">     AssignToString(stringValue, m_ListDirName);</span>
<a href="#l34.174"></a><span id="l34.174">     nsCOMPtr&lt;nsISupports&gt; supports = do_QueryInterface(static_cast&lt;nsIAbDirectory *&gt;(this), &amp;rv);</span>
<a href="#l34.175"></a><span id="l34.175">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.176"></a><span id="l34.176">     abManager-&gt;NotifyItemPropertyChanged(supports, &quot;DirName&quot;,</span>
<a href="#l34.177"></a><span id="l34.177" class="difflineat">@@ -737,17 +737,17 @@ nsAbOSXDirectory::Update()</span>
<a href="#l34.178"></a><span id="l34.178">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.179"></a><span id="l34.179"> </span>
<a href="#l34.180"></a><span id="l34.180">       while (addressCount--)</span>
<a href="#l34.181"></a><span id="l34.181">       {</span>
<a href="#l34.182"></a><span id="l34.182">         directory = do_QueryElementAt(m_AddressList, addressCount, &amp;rv);</span>
<a href="#l34.183"></a><span id="l34.183">         if (NS_FAILED(rv))</span>
<a href="#l34.184"></a><span id="l34.184">           continue;</span>
<a href="#l34.185"></a><span id="l34.185"> </span>
<a href="#l34.186"></a><span id="l34.186" class="difflineminus">-        nsCAutoString uri;</span>
<a href="#l34.187"></a><span id="l34.187" class="difflineplus">+        nsAutoCString uri;</span>
<a href="#l34.188"></a><span id="l34.188">         directory-&gt;GetURI(uri);</span>
<a href="#l34.189"></a><span id="l34.189">         uri.Cut(0, 21);</span>
<a href="#l34.190"></a><span id="l34.190">         NSString *uid = [NSString stringWithUTF8String:uri.get()];</span>
<a href="#l34.191"></a><span id="l34.191">         </span>
<a href="#l34.192"></a><span id="l34.192">         unsigned int j, arrayCount = [mutableArray count];</span>
<a href="#l34.193"></a><span id="l34.193">         for (j = 0; j &lt; arrayCount; ++j) {</span>
<a href="#l34.194"></a><span id="l34.194">           if ([[[mutableArray objectAtIndex:j] uniqueId] isEqualToString:uid]) {</span>
<a href="#l34.195"></a><span id="l34.195">             [mutableArray removeObjectAtIndex:j];</span>
<a href="#l34.196"></a><span id="l34.196" class="difflineat">@@ -829,17 +829,17 @@ nsAbOSXDirectory::AssertDirectory(nsIAbM</span>
<a href="#l34.197"></a><span id="l34.197"> </span>
<a href="#l34.198"></a><span id="l34.198">   return aManager-&gt;NotifyDirectoryItemAdded(this, aDirectory);</span>
<a href="#l34.199"></a><span id="l34.199"> }</span>
<a href="#l34.200"></a><span id="l34.200"> </span>
<a href="#l34.201"></a><span id="l34.201"> nsresult</span>
<a href="#l34.202"></a><span id="l34.202"> nsAbOSXDirectory::AssertCard(nsIAbManager *aManager,</span>
<a href="#l34.203"></a><span id="l34.203">                              nsIAbCard *aCard)</span>
<a href="#l34.204"></a><span id="l34.204"> {</span>
<a href="#l34.205"></a><span id="l34.205" class="difflineminus">-  nsCAutoString ourUuid;</span>
<a href="#l34.206"></a><span id="l34.206" class="difflineplus">+  nsAutoCString ourUuid;</span>
<a href="#l34.207"></a><span id="l34.207">   GetUuid(ourUuid);</span>
<a href="#l34.208"></a><span id="l34.208">   aCard-&gt;SetDirectoryId(ourUuid);</span>
<a href="#l34.209"></a><span id="l34.209"> </span>
<a href="#l34.210"></a><span id="l34.210">   nsresult rv = m_IsMailList ? m_AddressList-&gt;AppendElement(aCard, false) :</span>
<a href="#l34.211"></a><span id="l34.211">                                mCardList-&gt;AppendElement(aCard, false);</span>
<a href="#l34.212"></a><span id="l34.212">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.213"></a><span id="l34.213"> </span>
<a href="#l34.214"></a><span id="l34.214">   // Get the card's URI and add it to our card store</span>
<a href="#l34.215"></a><span id="l34.215" class="difflineat">@@ -918,17 +918,17 @@ nsAbOSXDirectory::GetChildCards(nsISimpl</span>
<a href="#l34.216"></a><span id="l34.216"> </span>
<a href="#l34.217"></a><span id="l34.217">     if (!mCardList)</span>
<a href="#l34.218"></a><span id="l34.218">       mCardList = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l34.219"></a><span id="l34.219">     else</span>
<a href="#l34.220"></a><span id="l34.220">       mCardList-&gt;Clear();</span>
<a href="#l34.221"></a><span id="l34.221">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.222"></a><span id="l34.222">   </span>
<a href="#l34.223"></a><span id="l34.223">     // The uuid for initializing cards</span>
<a href="#l34.224"></a><span id="l34.224" class="difflineminus">-    nsCAutoString ourUuid;</span>
<a href="#l34.225"></a><span id="l34.225" class="difflineplus">+    nsAutoCString ourUuid;</span>
<a href="#l34.226"></a><span id="l34.226">     GetUuid(ourUuid);</span>
<a href="#l34.227"></a><span id="l34.227"> </span>
<a href="#l34.228"></a><span id="l34.228">     // Fill the results array and update the card list</span>
<a href="#l34.229"></a><span id="l34.229">     unsigned int nbCards = [cards count];</span>
<a href="#l34.230"></a><span id="l34.230">   </span>
<a href="#l34.231"></a><span id="l34.231">     unsigned int i;</span>
<a href="#l34.232"></a><span id="l34.232">     nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l34.233"></a><span id="l34.233">     nsCOMPtr&lt;nsIAbOSXDirectory&gt; rootOSXDirectory;</span>
<a href="#l34.234"></a><span id="l34.234" class="difflineat">@@ -1025,17 +1025,17 @@ nsAbOSXDirectory::GetCardFromProperty(co</span>
<a href="#l34.235"></a><span id="l34.235">   if (!list)</span>
<a href="#l34.236"></a><span id="l34.236">     return NS_OK;</span>
<a href="#l34.237"></a><span id="l34.237"> </span>
<a href="#l34.238"></a><span id="l34.238">   uint32_t length;</span>
<a href="#l34.239"></a><span id="l34.239">   nsresult rv = list-&gt;GetLength(&amp;length);</span>
<a href="#l34.240"></a><span id="l34.240">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.241"></a><span id="l34.241"> </span>
<a href="#l34.242"></a><span id="l34.242">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l34.243"></a><span id="l34.243" class="difflineminus">-  nsCAutoString cardValue;</span>
<a href="#l34.244"></a><span id="l34.244" class="difflineplus">+  nsAutoCString cardValue;</span>
<a href="#l34.245"></a><span id="l34.245"> </span>
<a href="#l34.246"></a><span id="l34.246">   for (uint32_t i = 0; i &lt; length &amp;&amp; !*aResult; ++i)</span>
<a href="#l34.247"></a><span id="l34.247">   {</span>
<a href="#l34.248"></a><span id="l34.248">     card = do_QueryElementAt(list, i, &amp;rv);</span>
<a href="#l34.249"></a><span id="l34.249">     if (NS_SUCCEEDED(rv))</span>
<a href="#l34.250"></a><span id="l34.250">     {</span>
<a href="#l34.251"></a><span id="l34.251">       rv = card-&gt;GetPropertyAsAUTF8String(aProperty, cardValue);</span>
<a href="#l34.252"></a><span id="l34.252">       if (NS_SUCCEEDED(rv))</span>
<a href="#l34.253"></a><span id="l34.253" class="difflineat">@@ -1074,17 +1074,17 @@ nsAbOSXDirectory::GetCardsFromProperty(c</span>
<a href="#l34.254"></a><span id="l34.254">     return NS_NewEmptyEnumerator(aResult);</span>
<a href="#l34.255"></a><span id="l34.255"> </span>
<a href="#l34.256"></a><span id="l34.256">   uint32_t length;</span>
<a href="#l34.257"></a><span id="l34.257">   nsresult rv = list-&gt;GetLength(&amp;length);</span>
<a href="#l34.258"></a><span id="l34.258">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.259"></a><span id="l34.259"> </span>
<a href="#l34.260"></a><span id="l34.260">   nsCOMArray&lt;nsIAbCard&gt; resultArray;</span>
<a href="#l34.261"></a><span id="l34.261">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l34.262"></a><span id="l34.262" class="difflineminus">-  nsCAutoString cardValue;</span>
<a href="#l34.263"></a><span id="l34.263" class="difflineplus">+  nsAutoCString cardValue;</span>
<a href="#l34.264"></a><span id="l34.264"> </span>
<a href="#l34.265"></a><span id="l34.265">   for (uint32_t i = 0; i &lt; length; ++i)</span>
<a href="#l34.266"></a><span id="l34.266">   {</span>
<a href="#l34.267"></a><span id="l34.267">     card = do_QueryElementAt(list, i, &amp;rv);</span>
<a href="#l34.268"></a><span id="l34.268">     if (NS_SUCCEEDED(rv))</span>
<a href="#l34.269"></a><span id="l34.269">     {</span>
<a href="#l34.270"></a><span id="l34.270">       rv = card-&gt;GetPropertyAsAUTF8String(aProperty, cardValue);</span>
<a href="#l34.271"></a><span id="l34.271">       if (NS_SUCCEEDED(rv))</span>
<a href="#l34.272"></a><span id="l34.272" class="difflineat">@@ -1200,17 +1200,17 @@ nsAbOSXDirectory::OnSearchFoundCard(nsIA</span>
<a href="#l34.273"></a><span id="l34.273">   }</span>
<a href="#l34.274"></a><span id="l34.274"> </span>
<a href="#l34.275"></a><span id="l34.275">   rv = m_AddressList-&gt;AppendElement(aCard, false);</span>
<a href="#l34.276"></a><span id="l34.276">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.277"></a><span id="l34.277">   </span>
<a href="#l34.278"></a><span id="l34.278">   rv = mCardList-&gt;AppendElement(aCard, false);</span>
<a href="#l34.279"></a><span id="l34.279">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.280"></a><span id="l34.280"> </span>
<a href="#l34.281"></a><span id="l34.281" class="difflineminus">-  nsCAutoString ourUuid;</span>
<a href="#l34.282"></a><span id="l34.282" class="difflineplus">+  nsAutoCString ourUuid;</span>
<a href="#l34.283"></a><span id="l34.283">   GetUuid(ourUuid);</span>
<a href="#l34.284"></a><span id="l34.284">   aCard-&gt;SetDirectoryId(ourUuid);</span>
<a href="#l34.285"></a><span id="l34.285">   </span>
<a href="#l34.286"></a><span id="l34.286">   return NS_OK;</span>
<a href="#l34.287"></a><span id="l34.287"> }</span>
<a href="#l34.288"></a><span id="l34.288"> </span>
<a href="#l34.289"></a><span id="l34.289"> nsresult</span>
<a href="#l34.290"></a><span id="l34.290"> nsAbOSXDirectory::FallbackSearch(nsIAbBooleanExpression *aExpression,</span>
<a href="#l34.291"></a><span id="l34.291" class="difflineat">@@ -1286,39 +1286,39 @@ nsresult nsAbOSXDirectory::DeleteUid(con</span>
<a href="#l34.292"></a><span id="l34.292"> </span>
<a href="#l34.293"></a><span id="l34.293">   // First, we'll see if its in the group list as it is likely to be shorter.</span>
<a href="#l34.294"></a><span id="l34.294"> </span>
<a href="#l34.295"></a><span id="l34.295">   // See if this item is in our address list</span>
<a href="#l34.296"></a><span id="l34.296">   uint32_t addressCount;</span>
<a href="#l34.297"></a><span id="l34.297">   rv = m_AddressList-&gt;GetLength(&amp;addressCount);</span>
<a href="#l34.298"></a><span id="l34.298">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.299"></a><span id="l34.299"> </span>
<a href="#l34.300"></a><span id="l34.300" class="difflineminus">-  nsCAutoString uri(NS_ABOSXDIRECTORY_URI_PREFIX);</span>
<a href="#l34.301"></a><span id="l34.301" class="difflineplus">+  nsAutoCString uri(NS_ABOSXDIRECTORY_URI_PREFIX);</span>
<a href="#l34.302"></a><span id="l34.302">   uri.Append(aUid);</span>
<a href="#l34.303"></a><span id="l34.303"> </span>
<a href="#l34.304"></a><span id="l34.304">   // Iterate backwards in case we remove something</span>
<a href="#l34.305"></a><span id="l34.305">   while (addressCount--)</span>
<a href="#l34.306"></a><span id="l34.306">   {</span>
<a href="#l34.307"></a><span id="l34.307">     nsCOMPtr&lt;nsIAbItem&gt; abItem(do_QueryElementAt(m_AddressList,</span>
<a href="#l34.308"></a><span id="l34.308">                                                  addressCount, &amp;rv));</span>
<a href="#l34.309"></a><span id="l34.309">     if (NS_FAILED(rv))</span>
<a href="#l34.310"></a><span id="l34.310">       continue;</span>
<a href="#l34.311"></a><span id="l34.311"> </span>
<a href="#l34.312"></a><span id="l34.312">     nsCOMPtr&lt;nsIAbDirectory&gt; directory(do_QueryInterface(abItem, &amp;rv));</span>
<a href="#l34.313"></a><span id="l34.313">     if (NS_SUCCEEDED(rv))</span>
<a href="#l34.314"></a><span id="l34.314">     {</span>
<a href="#l34.315"></a><span id="l34.315" class="difflineminus">-      nsCAutoString dirUri;</span>
<a href="#l34.316"></a><span id="l34.316" class="difflineplus">+      nsAutoCString dirUri;</span>
<a href="#l34.317"></a><span id="l34.317">       directory-&gt;GetURI(dirUri);</span>
<a href="#l34.318"></a><span id="l34.318">       if (uri.Equals(dirUri))</span>
<a href="#l34.319"></a><span id="l34.319">         return UnassertDirectory(abManager, directory);</span>
<a href="#l34.320"></a><span id="l34.320">     } else {</span>
<a href="#l34.321"></a><span id="l34.321">       nsCOMPtr&lt;nsIAbOSXCard&gt; osxCard(do_QueryInterface(abItem, &amp;rv));</span>
<a href="#l34.322"></a><span id="l34.322">       if (NS_SUCCEEDED(rv))</span>
<a href="#l34.323"></a><span id="l34.323">       {</span>
<a href="#l34.324"></a><span id="l34.324" class="difflineminus">-        nsCAutoString cardUri;</span>
<a href="#l34.325"></a><span id="l34.325" class="difflineplus">+        nsAutoCString cardUri;</span>
<a href="#l34.326"></a><span id="l34.326">         osxCard-&gt;GetURI(cardUri);</span>
<a href="#l34.327"></a><span id="l34.327">         if (uri.Equals(cardUri))</span>
<a href="#l34.328"></a><span id="l34.328">         {</span>
<a href="#l34.329"></a><span id="l34.329">           nsCOMPtr&lt;nsIAbCard&gt; card(do_QueryInterface(osxCard, &amp;rv));</span>
<a href="#l34.330"></a><span id="l34.330">           if (NS_SUCCEEDED(rv))</span>
<a href="#l34.331"></a><span id="l34.331">             return UnassertCard(abManager, card, m_AddressList);</span>
<a href="#l34.332"></a><span id="l34.332">         }</span>
<a href="#l34.333"></a><span id="l34.333">       }</span>
<a href="#l34.334"></a><span id="l34.334" class="difflineat">@@ -1336,17 +1336,17 @@ nsresult nsAbOSXDirectory::DeleteUid(con</span>
<a href="#l34.335"></a><span id="l34.335">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l34.336"></a><span id="l34.336"> </span>
<a href="#l34.337"></a><span id="l34.337">   while (addressCount--)</span>
<a href="#l34.338"></a><span id="l34.338">   {</span>
<a href="#l34.339"></a><span id="l34.339">     nsCOMPtr&lt;nsIAbOSXCard&gt; osxCard(do_QueryElementAt(mCardList, addressCount, &amp;rv));</span>
<a href="#l34.340"></a><span id="l34.340">     if (NS_FAILED(rv))</span>
<a href="#l34.341"></a><span id="l34.341">       continue;</span>
<a href="#l34.342"></a><span id="l34.342"> </span>
<a href="#l34.343"></a><span id="l34.343" class="difflineminus">-    nsCAutoString cardUri;</span>
<a href="#l34.344"></a><span id="l34.344" class="difflineplus">+    nsAutoCString cardUri;</span>
<a href="#l34.345"></a><span id="l34.345">     osxCard-&gt;GetURI(cardUri);</span>
<a href="#l34.346"></a><span id="l34.346"> </span>
<a href="#l34.347"></a><span id="l34.347">     if (uri.Equals(cardUri)) {</span>
<a href="#l34.348"></a><span id="l34.348">       nsCOMPtr&lt;nsIAbCard&gt; card(do_QueryInterface(osxCard, &amp;rv));</span>
<a href="#l34.349"></a><span id="l34.349">       if (NS_SUCCEEDED(rv))</span>
<a href="#l34.350"></a><span id="l34.350">         return UnassertCard(abManager, card, mCardList);</span>
<a href="#l34.351"></a><span id="l34.351">     }</span>
<a href="#l34.352"></a><span id="l34.352">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOutlookDirFactory.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -59,18 +59,18 @@ nsAbOutlookDirFactory::GetDirectories(co</span>
<a href="#l35.4"></a><span id="l35.4">   nsCOMPtr&lt;nsIMutableArray&gt; directories(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l35.5"></a><span id="l35.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.6"></a><span id="l35.6">   if (!mapiAddBook-&gt;IsOK() || !mapiAddBook-&gt;GetFolders(folders)) {</span>
<a href="#l35.7"></a><span id="l35.7">     return NS_ERROR_FAILURE;</span>
<a href="#l35.8"></a><span id="l35.8">   }</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">   nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l35.11"></a><span id="l35.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  nsCAutoString entryId;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+  nsAutoCString entryId;</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17">   for (ULONG i = 0; i &lt; folders.mNbEntries; ++i) {</span>
<a href="#l35.18"></a><span id="l35.18">     folders.mEntries[i].ToString(entryId);</span>
<a href="#l35.19"></a><span id="l35.19">     buildAbWinUri(kOutlookDirectoryScheme, abType, uri);</span>
<a href="#l35.20"></a><span id="l35.20">     uri.Append(entryId);</span>
<a href="#l35.21"></a><span id="l35.21"> </span>
<a href="#l35.22"></a><span id="l35.22"> 	nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l35.23"></a><span id="l35.23"> 	rv = abManager-&gt;GetDirectory(uri, getter_AddRefs(directory));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -55,18 +55,18 @@ NS_IMPL_ISUPPORTS_INHERITED3(nsAbOutlook</span>
<a href="#l36.4"></a><span id="l36.4"> NS_IMETHODIMP nsAbOutlookDirectory::Init(const char *aUri)</span>
<a href="#l36.5"></a><span id="l36.5"> {</span>
<a href="#l36.6"></a><span id="l36.6">   mQueryThreads.Init();</span>
<a href="#l36.7"></a><span id="l36.7">   mCardList.Init();</span>
<a href="#l36.8"></a><span id="l36.8"> </span>
<a href="#l36.9"></a><span id="l36.9">   nsresult rv = nsAbDirProperty::Init(aUri);</span>
<a href="#l36.10"></a><span id="l36.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  nsCAutoString entry;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-  nsCAutoString stub;</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+  nsAutoCString entry;</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+  nsAutoCString stub;</span>
<a href="#l36.16"></a><span id="l36.16"> </span>
<a href="#l36.17"></a><span id="l36.17">   mAbWinType = getAbWinType(kOutlookDirectoryScheme, mURINoQuery.get(), stub, entry);</span>
<a href="#l36.18"></a><span id="l36.18">   if (mAbWinType == nsAbWinType_Unknown) {</span>
<a href="#l36.19"></a><span id="l36.19">     PRINTF((&quot;Huge problem URI=%s.\n&quot;, mURINoQuery));</span>
<a href="#l36.20"></a><span id="l36.20">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l36.21"></a><span id="l36.21">   }</span>
<a href="#l36.22"></a><span id="l36.22">   nsAbWinHelperGuard mapiAddBook (mAbWinType);</span>
<a href="#l36.23"></a><span id="l36.23">   nsString prefix;</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineat">@@ -251,29 +251,29 @@ static nsresult ExtractCardEntry(nsIAbCa</span>
<a href="#l36.25"></a><span id="l36.25">   aEntry.Truncate();</span>
<a href="#l36.26"></a><span id="l36.26"> </span>
<a href="#l36.27"></a><span id="l36.27">   nsCString uri;</span>
<a href="#l36.28"></a><span id="l36.28">   aCard-&gt;GetPropertyAsAUTF8String(&quot;OutlookEntryURI&quot;, uri);</span>
<a href="#l36.29"></a><span id="l36.29"> </span>
<a href="#l36.30"></a><span id="l36.30">   // If we don't have a URI, uri will be empty. getAbWinType doesn't set</span>
<a href="#l36.31"></a><span id="l36.31">   // aEntry to anything if uri is empty, so it will be truncated, allowing us</span>
<a href="#l36.32"></a><span id="l36.32">   // to accept cards not initialized by us.</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">-  nsCAutoString stub;</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineplus">+  nsAutoCString stub;</span>
<a href="#l36.35"></a><span id="l36.35">   getAbWinType(kOutlookCardScheme, uri.get(), stub, aEntry);</span>
<a href="#l36.36"></a><span id="l36.36">   return NS_OK;</span>
<a href="#l36.37"></a><span id="l36.37"> }</span>
<a href="#l36.38"></a><span id="l36.38"> </span>
<a href="#l36.39"></a><span id="l36.39"> static nsresult ExtractDirectoryEntry(nsIAbDirectory *aDirectory, nsCString&amp; aEntry)</span>
<a href="#l36.40"></a><span id="l36.40"> {</span>
<a href="#l36.41"></a><span id="l36.41">   aEntry.Truncate();</span>
<a href="#l36.42"></a><span id="l36.42">   nsCString uri;</span>
<a href="#l36.43"></a><span id="l36.43">   nsresult rv = aDirectory-&gt;GetURI(uri);</span>
<a href="#l36.44"></a><span id="l36.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.45"></a><span id="l36.45"> </span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-  nsCAutoString stub;</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineplus">+  nsAutoCString stub;</span>
<a href="#l36.48"></a><span id="l36.48">   nsAbWinType objType = getAbWinType(kOutlookDirectoryScheme, uri.get(), stub, aEntry);</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50">   return NS_OK;</span>
<a href="#l36.51"></a><span id="l36.51"> }</span>
<a href="#l36.52"></a><span id="l36.52"> </span>
<a href="#l36.53"></a><span id="l36.53"> NS_IMETHODIMP nsAbOutlookDirectory::DeleteCards(nsIArray *aCardList)</span>
<a href="#l36.54"></a><span id="l36.54"> {</span>
<a href="#l36.55"></a><span id="l36.55">     if (mIsQueryURI) { return NS_ERROR_NOT_IMPLEMENTED ; }</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineat">@@ -282,17 +282,17 @@ NS_IMETHODIMP nsAbOutlookDirectory::Dele</span>
<a href="#l36.57"></a><span id="l36.57">     nsresult retCode = NS_OK ;</span>
<a href="#l36.58"></a><span id="l36.58">     nsAbWinHelperGuard mapiAddBook (mAbWinType) ;</span>
<a href="#l36.59"></a><span id="l36.59"> </span>
<a href="#l36.60"></a><span id="l36.60">     if (!mapiAddBook-&gt;IsOK()) { return NS_ERROR_FAILURE ; }</span>
<a href="#l36.61"></a><span id="l36.61">     </span>
<a href="#l36.62"></a><span id="l36.62">     retCode = aCardList-&gt;GetLength(&amp;nbCards);</span>
<a href="#l36.63"></a><span id="l36.63">     NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l36.64"></a><span id="l36.64">     uint32_t i = 0 ;</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineminus">-    nsCAutoString entryString ;</span>
<a href="#l36.66"></a><span id="l36.66" class="difflineplus">+    nsAutoCString entryString ;</span>
<a href="#l36.67"></a><span id="l36.67">     nsMapiEntry cardEntry ;</span>
<a href="#l36.68"></a><span id="l36.68"> </span>
<a href="#l36.69"></a><span id="l36.69">     for (i = 0 ; i &lt; nbCards ; ++ i) {</span>
<a href="#l36.70"></a><span id="l36.70">         nsCOMPtr&lt;nsIAbCard&gt; card(do_QueryElementAt(aCardList, i, &amp;retCode));</span>
<a href="#l36.71"></a><span id="l36.71">         NS_ENSURE_SUCCESS(retCode, retCode);</span>
<a href="#l36.72"></a><span id="l36.72"> </span>
<a href="#l36.73"></a><span id="l36.73">         retCode = ExtractCardEntry(card, entryString) ;</span>
<a href="#l36.74"></a><span id="l36.74">         if (NS_SUCCEEDED(retCode) &amp;&amp; !entryString.IsEmpty()) {</span>
<a href="#l36.75"></a><span id="l36.75" class="difflineat">@@ -322,17 +322,17 @@ NS_IMETHODIMP nsAbOutlookDirectory::Dele</span>
<a href="#l36.76"></a><span id="l36.76"> }</span>
<a href="#l36.77"></a><span id="l36.77"> </span>
<a href="#l36.78"></a><span id="l36.78"> NS_IMETHODIMP nsAbOutlookDirectory::DeleteDirectory(nsIAbDirectory *aDirectory)</span>
<a href="#l36.79"></a><span id="l36.79"> {</span>
<a href="#l36.80"></a><span id="l36.80">     if (mIsQueryURI) { return NS_ERROR_NOT_IMPLEMENTED ; }</span>
<a href="#l36.81"></a><span id="l36.81">     if (!aDirectory) { return NS_ERROR_NULL_POINTER ; }</span>
<a href="#l36.82"></a><span id="l36.82">     nsresult retCode = NS_OK ;</span>
<a href="#l36.83"></a><span id="l36.83">     nsAbWinHelperGuard mapiAddBook (mAbWinType) ;</span>
<a href="#l36.84"></a><span id="l36.84" class="difflineminus">-    nsCAutoString entryString ;</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineplus">+    nsAutoCString entryString ;</span>
<a href="#l36.86"></a><span id="l36.86"> </span>
<a href="#l36.87"></a><span id="l36.87">     if (!mapiAddBook-&gt;IsOK()) { return NS_ERROR_FAILURE ; }</span>
<a href="#l36.88"></a><span id="l36.88">     retCode = ExtractDirectoryEntry(aDirectory, entryString) ;</span>
<a href="#l36.89"></a><span id="l36.89">     if (NS_SUCCEEDED(retCode) &amp;&amp; !entryString.IsEmpty()) {</span>
<a href="#l36.90"></a><span id="l36.90">         nsMapiEntry directoryEntry ;</span>
<a href="#l36.91"></a><span id="l36.91"> </span>
<a href="#l36.92"></a><span id="l36.92">         directoryEntry.Assign(entryString) ;</span>
<a href="#l36.93"></a><span id="l36.93">         if (!mapiAddBook-&gt;DeleteEntry(*mMapiData, directoryEntry)) {</span>
<a href="#l36.94"></a><span id="l36.94" class="difflineat">@@ -397,17 +397,17 @@ NS_IMETHODIMP nsAbOutlookDirectory::AddM</span>
<a href="#l36.95"></a><span id="l36.95"> {</span>
<a href="#l36.96"></a><span id="l36.96">   if (mIsQueryURI)</span>
<a href="#l36.97"></a><span id="l36.97">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l36.98"></a><span id="l36.98">   NS_ENSURE_ARG_POINTER(aMailList);</span>
<a href="#l36.99"></a><span id="l36.99">   NS_ENSURE_ARG_POINTER(addedList);</span>
<a href="#l36.100"></a><span id="l36.100">   if (m_IsMailList)</span>
<a href="#l36.101"></a><span id="l36.101">     return NS_OK;</span>
<a href="#l36.102"></a><span id="l36.102">   nsAbWinHelperGuard mapiAddBook (mAbWinType);</span>
<a href="#l36.103"></a><span id="l36.103" class="difflineminus">-  nsCAutoString entryString;</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineplus">+  nsAutoCString entryString;</span>
<a href="#l36.105"></a><span id="l36.105">   nsMapiEntry newEntry;</span>
<a href="#l36.106"></a><span id="l36.106">   bool didCopy = false;</span>
<a href="#l36.107"></a><span id="l36.107"> </span>
<a href="#l36.108"></a><span id="l36.108">   if (!mapiAddBook-&gt;IsOK())</span>
<a href="#l36.109"></a><span id="l36.109">     return NS_ERROR_FAILURE;</span>
<a href="#l36.110"></a><span id="l36.110">   nsresult rv = ExtractDirectoryEntry(aMailList, entryString);</span>
<a href="#l36.111"></a><span id="l36.111">   if (NS_SUCCEEDED(rv) &amp;&amp; !entryString.IsEmpty())</span>
<a href="#l36.112"></a><span id="l36.112">   {</span>
<a href="#l36.113"></a><span id="l36.113" class="difflineat">@@ -420,17 +420,17 @@ NS_IMETHODIMP nsAbOutlookDirectory::AddM</span>
<a href="#l36.114"></a><span id="l36.114">   {</span>
<a href="#l36.115"></a><span id="l36.115">     if (!mapiAddBook-&gt;CreateDistList(*mMapiData, newEntry))</span>
<a href="#l36.116"></a><span id="l36.116">         return NS_ERROR_FAILURE;</span>
<a href="#l36.117"></a><span id="l36.117">   }</span>
<a href="#l36.118"></a><span id="l36.118">   else {</span>
<a href="#l36.119"></a><span id="l36.119">     didCopy = true;</span>
<a href="#l36.120"></a><span id="l36.120">   }</span>
<a href="#l36.121"></a><span id="l36.121">   newEntry.ToString(entryString);</span>
<a href="#l36.122"></a><span id="l36.122" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l36.123"></a><span id="l36.123" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l36.124"></a><span id="l36.124"> </span>
<a href="#l36.125"></a><span id="l36.125">   buildAbWinUri(kOutlookDirectoryScheme, mAbWinType, uri);</span>
<a href="#l36.126"></a><span id="l36.126">   uri.Append(entryString);</span>
<a href="#l36.127"></a><span id="l36.127"> </span>
<a href="#l36.128"></a><span id="l36.128">   nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID,</span>
<a href="#l36.129"></a><span id="l36.129">                                    &amp;rv));</span>
<a href="#l36.130"></a><span id="l36.130">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.131"></a><span id="l36.131"> </span>
<a href="#l36.132"></a><span id="l36.132" class="difflineat">@@ -546,17 +546,17 @@ static nsresult BuildRestriction(nsIAbBo</span>
<a href="#l36.133"></a><span id="l36.133"> {</span>
<a href="#l36.134"></a><span id="l36.134">     if (!aCondition) { return NS_ERROR_NULL_POINTER ; }</span>
<a href="#l36.135"></a><span id="l36.135">     aSkipItem = false ;</span>
<a href="#l36.136"></a><span id="l36.136">     nsAbBooleanConditionType conditionType = 0 ;</span>
<a href="#l36.137"></a><span id="l36.137">     nsresult retCode = NS_OK ;</span>
<a href="#l36.138"></a><span id="l36.138">     nsCString name;</span>
<a href="#l36.139"></a><span id="l36.139">     nsString value;</span>
<a href="#l36.140"></a><span id="l36.140">     ULONG propertyTag = 0 ;</span>
<a href="#l36.141"></a><span id="l36.141" class="difflineminus">-    nsCAutoString valueAscii ;</span>
<a href="#l36.142"></a><span id="l36.142" class="difflineplus">+    nsAutoCString valueAscii ;</span>
<a href="#l36.143"></a><span id="l36.143">     </span>
<a href="#l36.144"></a><span id="l36.144">     retCode = aCondition-&gt;GetCondition(&amp;conditionType) ;</span>
<a href="#l36.145"></a><span id="l36.145">     NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l36.146"></a><span id="l36.146">     retCode = aCondition-&gt;GetName(getter_Copies(name)) ;</span>
<a href="#l36.147"></a><span id="l36.147">     NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l36.148"></a><span id="l36.148">     retCode = aCondition-&gt;GetValue(getter_Copies(value)) ;</span>
<a href="#l36.149"></a><span id="l36.149">     NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l36.150"></a><span id="l36.150">     LossyCopyUTF16toASCII(value, valueAscii);</span>
<a href="#l36.151"></a><span id="l36.151" class="difflineat">@@ -1021,21 +1021,21 @@ nsresult nsAbOutlookDirectory::GetChildC</span>
<a href="#l36.152"></a><span id="l36.152">   nsMapiEntryArray cardEntries;</span>
<a href="#l36.153"></a><span id="l36.153">   LPSRestriction restriction = (LPSRestriction) aRestriction;</span>
<a href="#l36.154"></a><span id="l36.154"> </span>
<a href="#l36.155"></a><span id="l36.155">   if (!mapiAddBook-&gt;GetCards(*mMapiData, restriction, cardEntries)) {</span>
<a href="#l36.156"></a><span id="l36.156">     PRINTF((&quot;Cannot get cards.\n&quot;));</span>
<a href="#l36.157"></a><span id="l36.157">     return NS_ERROR_FAILURE;</span>
<a href="#l36.158"></a><span id="l36.158">   }</span>
<a href="#l36.159"></a><span id="l36.159"> </span>
<a href="#l36.160"></a><span id="l36.160" class="difflineminus">-  nsCAutoString ourUuid;</span>
<a href="#l36.161"></a><span id="l36.161" class="difflineplus">+  nsAutoCString ourUuid;</span>
<a href="#l36.162"></a><span id="l36.162">   GetUuid(ourUuid);</span>
<a href="#l36.163"></a><span id="l36.163"> </span>
<a href="#l36.164"></a><span id="l36.164" class="difflineminus">-  nsCAutoString entryId;</span>
<a href="#l36.165"></a><span id="l36.165" class="difflineminus">-  nsCAutoString uriName;</span>
<a href="#l36.166"></a><span id="l36.166" class="difflineplus">+  nsAutoCString entryId;</span>
<a href="#l36.167"></a><span id="l36.167" class="difflineplus">+  nsAutoCString uriName;</span>
<a href="#l36.168"></a><span id="l36.168">   nsCOMPtr&lt;nsIAbCard&gt; childCard;</span>
<a href="#l36.169"></a><span id="l36.169">   nsresult rv;</span>
<a href="#l36.170"></a><span id="l36.170"> </span>
<a href="#l36.171"></a><span id="l36.171">   for (ULONG card = 0; card &lt; cardEntries.mNbEntries; ++card) {</span>
<a href="#l36.172"></a><span id="l36.172">     cardEntries.mEntries[card].ToString(entryId);</span>
<a href="#l36.173"></a><span id="l36.173">     buildAbWinUri(kOutlookCardScheme, mAbWinType, uriName);</span>
<a href="#l36.174"></a><span id="l36.174">     uriName.Append(entryId);</span>
<a href="#l36.175"></a><span id="l36.175"> </span>
<a href="#l36.176"></a><span id="l36.176" class="difflineat">@@ -1061,18 +1061,18 @@ nsresult nsAbOutlookDirectory::GetChildN</span>
<a href="#l36.177"></a><span id="l36.177">       return NS_ERROR_FAILURE;</span>
<a href="#l36.178"></a><span id="l36.178"> </span>
<a href="#l36.179"></a><span id="l36.179">   if (!mapiAddBook-&gt;GetNodes(*mMapiData, nodeEntries))</span>
<a href="#l36.180"></a><span id="l36.180">   {</span>
<a href="#l36.181"></a><span id="l36.181">     PRINTF((&quot;Cannot get nodes.\n&quot;));</span>
<a href="#l36.182"></a><span id="l36.182">     return NS_ERROR_FAILURE;</span>
<a href="#l36.183"></a><span id="l36.183">   }</span>
<a href="#l36.184"></a><span id="l36.184"> </span>
<a href="#l36.185"></a><span id="l36.185" class="difflineminus">-  nsCAutoString entryId;</span>
<a href="#l36.186"></a><span id="l36.186" class="difflineminus">-  nsCAutoString uriName;</span>
<a href="#l36.187"></a><span id="l36.187" class="difflineplus">+  nsAutoCString entryId;</span>
<a href="#l36.188"></a><span id="l36.188" class="difflineplus">+  nsAutoCString uriName;</span>
<a href="#l36.189"></a><span id="l36.189">   nsresult rv = NS_OK;</span>
<a href="#l36.190"></a><span id="l36.190"> </span>
<a href="#l36.191"></a><span id="l36.191">   nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l36.192"></a><span id="l36.192">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.193"></a><span id="l36.193"> </span>
<a href="#l36.194"></a><span id="l36.194">   for (ULONG node = 0; node &lt; nodeEntries.mNbEntries; ++node)</span>
<a href="#l36.195"></a><span id="l36.195">   {</span>
<a href="#l36.196"></a><span id="l36.196">     nodeEntries.mEntries[node].ToString(entryId);</span>
<a href="#l36.197"></a><span id="l36.197" class="difflineat">@@ -1173,17 +1173,17 @@ nsresult nsAbOutlookDirectory::UpdateAdd</span>
<a href="#l36.198"></a><span id="l36.198"> </span>
<a href="#l36.199"></a><span id="l36.199"> nsresult nsAbOutlookDirectory::CreateCard(nsIAbCard *aData, nsIAbCard **aNewCard) </span>
<a href="#l36.200"></a><span id="l36.200"> {</span>
<a href="#l36.201"></a><span id="l36.201">     if (!aData || !aNewCard) { return NS_ERROR_NULL_POINTER ; }</span>
<a href="#l36.202"></a><span id="l36.202">     *aNewCard = nullptr ;</span>
<a href="#l36.203"></a><span id="l36.203">     nsresult retCode = NS_OK ;</span>
<a href="#l36.204"></a><span id="l36.204">     nsAbWinHelperGuard mapiAddBook (mAbWinType) ;</span>
<a href="#l36.205"></a><span id="l36.205">     nsMapiEntry newEntry ;</span>
<a href="#l36.206"></a><span id="l36.206" class="difflineminus">-    nsCAutoString entryString ;</span>
<a href="#l36.207"></a><span id="l36.207" class="difflineplus">+    nsAutoCString entryString ;</span>
<a href="#l36.208"></a><span id="l36.208">     bool didCopy = false ;</span>
<a href="#l36.209"></a><span id="l36.209"> </span>
<a href="#l36.210"></a><span id="l36.210">     if (!mapiAddBook-&gt;IsOK()) { return NS_ERROR_FAILURE ; }</span>
<a href="#l36.211"></a><span id="l36.211">     // If we get an nsIAbCard that maps onto an Outlook card uri</span>
<a href="#l36.212"></a><span id="l36.212">     // we simply copy the contents of the Outlook card.</span>
<a href="#l36.213"></a><span id="l36.213">     retCode = ExtractCardEntry(aData, entryString) ;</span>
<a href="#l36.214"></a><span id="l36.214">     if (NS_SUCCEEDED(retCode) &amp;&amp; !entryString.IsEmpty()) {</span>
<a href="#l36.215"></a><span id="l36.215">         nsMapiEntry sourceEntry ;</span>
<a href="#l36.216"></a><span id="l36.216" class="difflineat">@@ -1227,26 +1227,26 @@ nsresult nsAbOutlookDirectory::CreateCar</span>
<a href="#l36.217"></a><span id="l36.217">         }</span>
<a href="#l36.218"></a><span id="l36.218">         // If we're on a real address book folder, we can directly create an</span>
<a href="#l36.219"></a><span id="l36.219">         // empty card.</span>
<a href="#l36.220"></a><span id="l36.220">         else if (!mapiAddBook-&gt;CreateEntry(*mMapiData, newEntry)) {</span>
<a href="#l36.221"></a><span id="l36.221">             return NS_ERROR_FAILURE ;</span>
<a href="#l36.222"></a><span id="l36.222">         }</span>
<a href="#l36.223"></a><span id="l36.223">     }</span>
<a href="#l36.224"></a><span id="l36.224">     newEntry.ToString(entryString) ;</span>
<a href="#l36.225"></a><span id="l36.225" class="difflineminus">-    nsCAutoString uri ;</span>
<a href="#l36.226"></a><span id="l36.226" class="difflineplus">+    nsAutoCString uri ;</span>
<a href="#l36.227"></a><span id="l36.227"> </span>
<a href="#l36.228"></a><span id="l36.228">     buildAbWinUri(kOutlookCardScheme, mAbWinType, uri) ;</span>
<a href="#l36.229"></a><span id="l36.229">     uri.Append(entryString) ;</span>
<a href="#l36.230"></a><span id="l36.230">     </span>
<a href="#l36.231"></a><span id="l36.231">     nsCOMPtr&lt;nsIAbCard&gt; newCard;</span>
<a href="#l36.232"></a><span id="l36.232">     retCode = OutlookCardForURI(uri, getter_AddRefs(newCard));</span>
<a href="#l36.233"></a><span id="l36.233">     NS_ENSURE_SUCCESS(retCode, retCode);</span>
<a href="#l36.234"></a><span id="l36.234"> </span>
<a href="#l36.235"></a><span id="l36.235" class="difflineminus">-    nsCAutoString ourUuid;</span>
<a href="#l36.236"></a><span id="l36.236" class="difflineplus">+    nsAutoCString ourUuid;</span>
<a href="#l36.237"></a><span id="l36.237">     GetUuid(ourUuid);</span>
<a href="#l36.238"></a><span id="l36.238">     newCard-&gt;SetDirectoryId(ourUuid);</span>
<a href="#l36.239"></a><span id="l36.239"> </span>
<a href="#l36.240"></a><span id="l36.240">     if (!didCopy) {</span>
<a href="#l36.241"></a><span id="l36.241">         retCode = newCard-&gt;Copy(aData) ;</span>
<a href="#l36.242"></a><span id="l36.242">         NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l36.243"></a><span id="l36.243">         retCode = ModifyCard(newCard) ;</span>
<a href="#l36.244"></a><span id="l36.244">         NS_ENSURE_SUCCESS(retCode, retCode) ;</span>
<a href="#l36.245"></a><span id="l36.245" class="difflineat">@@ -1437,18 +1437,18 @@ static void splitString(nsString&amp; aSourc</span>
<a href="#l36.246"></a><span id="l36.246">     aSource.SetLength(offset);</span>
<a href="#l36.247"></a><span id="l36.247">   }</span>
<a href="#l36.248"></a><span id="l36.248"> }</span>
<a href="#l36.249"></a><span id="l36.249"> </span>
<a href="#l36.250"></a><span id="l36.250"> nsresult OutlookCardForURI(const nsACString &amp;aUri, nsIAbCard **newCard)</span>
<a href="#l36.251"></a><span id="l36.251"> {</span>
<a href="#l36.252"></a><span id="l36.252">   NS_ENSURE_ARG_POINTER(newCard);</span>
<a href="#l36.253"></a><span id="l36.253"> </span>
<a href="#l36.254"></a><span id="l36.254" class="difflineminus">-  nsCAutoString entry;</span>
<a href="#l36.255"></a><span id="l36.255" class="difflineminus">-  nsCAutoString stub;</span>
<a href="#l36.256"></a><span id="l36.256" class="difflineplus">+  nsAutoCString entry;</span>
<a href="#l36.257"></a><span id="l36.257" class="difflineplus">+  nsAutoCString stub;</span>
<a href="#l36.258"></a><span id="l36.258">   uint32_t abWinType = getAbWinType(kOutlookCardScheme,</span>
<a href="#l36.259"></a><span id="l36.259">     PromiseFlatCString(aUri).get(), stub, entry);</span>
<a href="#l36.260"></a><span id="l36.260">   if (abWinType == nsAbWinType_Unknown)</span>
<a href="#l36.261"></a><span id="l36.261">   {</span>
<a href="#l36.262"></a><span id="l36.262">     PRINTF((&quot;Huge problem URI=%s.\n&quot;, PromiseFlatCString(aUri).get()));</span>
<a href="#l36.263"></a><span id="l36.263">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l36.264"></a><span id="l36.264">   }</span>
<a href="#l36.265"></a><span id="l36.265"> </span>
<a href="#l36.266"></a><span id="l36.266" class="difflineat">@@ -1498,17 +1498,17 @@ nsresult OutlookCardForURI(const nsACStr</span>
<a href="#l36.267"></a><span id="l36.267">   }</span>
<a href="#l36.268"></a><span id="l36.268"> </span>
<a href="#l36.269"></a><span id="l36.269">   ULONG cardType = 0;</span>
<a href="#l36.270"></a><span id="l36.270">   if (mapiAddBook-&gt;GetPropertyLong(mapiData, PR_OBJECT_TYPE, cardType))</span>
<a href="#l36.271"></a><span id="l36.271">   {</span>
<a href="#l36.272"></a><span id="l36.272">     card-&gt;SetIsMailList(cardType == MAPI_DISTLIST);</span>
<a href="#l36.273"></a><span id="l36.273">     if (cardType == MAPI_DISTLIST)</span>
<a href="#l36.274"></a><span id="l36.274">     {</span>
<a href="#l36.275"></a><span id="l36.275" class="difflineminus">-      nsCAutoString normalChars;</span>
<a href="#l36.276"></a><span id="l36.276" class="difflineplus">+      nsAutoCString normalChars;</span>
<a href="#l36.277"></a><span id="l36.277">       buildAbWinUri(kOutlookDirectoryScheme, abWinType, normalChars);</span>
<a href="#l36.278"></a><span id="l36.278">       normalChars.Append(entry);</span>
<a href="#l36.279"></a><span id="l36.279">       card-&gt;SetMailListURI(normalChars.get());</span>
<a href="#l36.280"></a><span id="l36.280">     }</span>
<a href="#l36.281"></a><span id="l36.281">   }</span>
<a href="#l36.282"></a><span id="l36.282"> </span>
<a href="#l36.283"></a><span id="l36.283">   nsAutoString unichar;</span>
<a href="#l36.284"></a><span id="l36.284">   nsAutoString unicharBis;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbQueryStringToExpression.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -16,17 +16,17 @@</span>
<a href="#l37.4"></a><span id="l37.4"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6"> nsresult nsAbQueryStringToExpression::Convert (</span>
<a href="#l37.7"></a><span id="l37.7">     const nsACString &amp;aQueryString,</span>
<a href="#l37.8"></a><span id="l37.8">     nsIAbBooleanExpression** expression)</span>
<a href="#l37.9"></a><span id="l37.9"> {</span>
<a href="#l37.10"></a><span id="l37.10">     nsresult rv;</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    nsCAutoString q(aQueryString);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    nsAutoCString q(aQueryString);</span>
<a href="#l37.14"></a><span id="l37.14">     q.StripWhitespace();</span>
<a href="#l37.15"></a><span id="l37.15">     const char *queryChars = q.get();</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17">     nsCOMPtr&lt;nsISupports&gt; s;</span>
<a href="#l37.18"></a><span id="l37.18">     rv = ParseExpression(&amp;queryChars, getter_AddRefs(s));</span>
<a href="#l37.19"></a><span id="l37.19">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l37.20"></a><span id="l37.20"> </span>
<a href="#l37.21"></a><span id="l37.21">     // Case: Not end of string</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbWinHelper.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbWinHelper.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -508,17 +508,17 @@ BOOL nsAbWinHelper::DeleteEntry(const ns</span>
<a href="#l38.4"></a><span id="l38.4">     }</span>
<a href="#l38.5"></a><span id="l38.5">     return TRUE ;</span>
<a href="#l38.6"></a><span id="l38.6"> }</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> BOOL nsAbWinHelper::SetPropertyUString(const nsMapiEntry&amp; aObject, ULONG aPropertyTag, </span>
<a href="#l38.9"></a><span id="l38.9">                                        const PRUnichar *aValue)</span>
<a href="#l38.10"></a><span id="l38.10"> {</span>
<a href="#l38.11"></a><span id="l38.11">     SPropValue value ;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    nsCAutoString alternativeValue ;</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    nsAutoCString alternativeValue ;</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15">     value.ulPropTag = aPropertyTag ;</span>
<a href="#l38.16"></a><span id="l38.16">     if (PROP_TYPE(aPropertyTag) == PT_UNICODE) {</span>
<a href="#l38.17"></a><span id="l38.17">         value.Value.lpszW = const_cast&lt;WCHAR *&gt;(aValue) ;</span>
<a href="#l38.18"></a><span id="l38.18">     }</span>
<a href="#l38.19"></a><span id="l38.19">     else if (PROP_TYPE(aPropertyTag) == PT_STRING8) {</span>
<a href="#l38.20"></a><span id="l38.20">         alternativeValue = NS_LossyConvertUTF16toASCII(aValue);</span>
<a href="#l38.21"></a><span id="l38.21">         value.Value.lpszA = const_cast&lt;char *&gt;(alternativeValue.get()) ;</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -534,17 +534,17 @@ BOOL nsAbWinHelper::SetPropertiesUString</span>
<a href="#l38.23"></a><span id="l38.23">                                          ULONG aNbProperties, nsString *aValues) </span>
<a href="#l38.24"></a><span id="l38.24"> {</span>
<a href="#l38.25"></a><span id="l38.25">     LPSPropValue values = new SPropValue [aNbProperties] ;</span>
<a href="#l38.26"></a><span id="l38.26">     if (!values)</span>
<a href="#l38.27"></a><span id="l38.27">         return FALSE ;</span>
<a href="#l38.28"></a><span id="l38.28"> </span>
<a href="#l38.29"></a><span id="l38.29">     ULONG i = 0 ;</span>
<a href="#l38.30"></a><span id="l38.30">     ULONG currentValue = 0 ;</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-    nsCAutoString alternativeValue ;</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+    nsAutoCString alternativeValue ;</span>
<a href="#l38.33"></a><span id="l38.33">     BOOL retCode = TRUE ;</span>
<a href="#l38.34"></a><span id="l38.34"> </span>
<a href="#l38.35"></a><span id="l38.35">     for (i = 0 ; i &lt; aNbProperties ; ++ i) {</span>
<a href="#l38.36"></a><span id="l38.36">         values [currentValue].ulPropTag = aPropertiesTag [i] ;</span>
<a href="#l38.37"></a><span id="l38.37">         if (PROP_TYPE(aPropertiesTag [i]) == PT_UNICODE) {</span>
<a href="#l38.38"></a><span id="l38.38">             values [currentValue ++].Value.lpszW = const_cast&lt;WCHAR *&gt;(aValues [i].get()) ;</span>
<a href="#l38.39"></a><span id="l38.39">         }</span>
<a href="#l38.40"></a><span id="l38.40">         else if (PROP_TYPE(aPropertiesTag [i]) == PT_STRING8) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -110,17 +110,17 @@ nsAddbookProtocolHandler::NewChannel(nsI</span>
<a href="#l39.4"></a><span id="l39.4">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.5"></a><span id="l39.5">   </span>
<a href="#l39.6"></a><span id="l39.6">   rv = addbookUrl-&gt;GetAddbookOperation(&amp;mAddbookOperation);</span>
<a href="#l39.7"></a><span id="l39.7">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.8"></a><span id="l39.8"> </span>
<a href="#l39.9"></a><span id="l39.9">   if (mAddbookOperation == nsIAddbookUrlOperation::InvalidUrl) {</span>
<a href="#l39.10"></a><span id="l39.10">     nsAutoString errorString;</span>
<a href="#l39.11"></a><span id="l39.11">     errorString.AssignLiteral(&quot;Unsupported format/operation requested for &quot;);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l39.14"></a><span id="l39.14">     rv = aURI-&gt;GetSpec(spec);</span>
<a href="#l39.15"></a><span id="l39.15">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.16"></a><span id="l39.16"> </span>
<a href="#l39.17"></a><span id="l39.17">      errorString.Append(NS_ConvertUTF8toUTF16(spec));</span>
<a href="#l39.18"></a><span id="l39.18">     rv = GenerateXMLOutputChannel(errorString, addbookUrl, aURI, _retval);</span>
<a href="#l39.19"></a><span id="l39.19">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.20"></a><span id="l39.20">     return NS_OK;</span>
<a href="#l39.21"></a><span id="l39.21">   }</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -142,34 +142,34 @@ nsAddbookProtocolHandler::NewChannel(nsI</span>
<a href="#l39.23"></a><span id="l39.23">       return NS_NewInputStreamChannel(_retval, aURI, pipeIn,</span>
<a href="#l39.24"></a><span id="l39.24">           NS_LITERAL_CSTRING(&quot;application/x-addvcard&quot;));</span>
<a href="#l39.25"></a><span id="l39.25">   }</span>
<a href="#l39.26"></a><span id="l39.26"> </span>
<a href="#l39.27"></a><span id="l39.27">   nsString output;</span>
<a href="#l39.28"></a><span id="l39.28">   rv = GeneratePrintOutput(addbookUrl, output);</span>
<a href="#l39.29"></a><span id="l39.29">   if (NS_FAILED(rv)) {</span>
<a href="#l39.30"></a><span id="l39.30">     output.AssignLiteral(&quot;failed to print. url=&quot;);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l39.33"></a><span id="l39.33">     rv = aURI-&gt;GetSpec(spec);</span>
<a href="#l39.34"></a><span id="l39.34">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.35"></a><span id="l39.35">     output.Append(NS_ConvertUTF8toUTF16(spec));</span>
<a href="#l39.36"></a><span id="l39.36">   }</span>
<a href="#l39.37"></a><span id="l39.37">  </span>
<a href="#l39.38"></a><span id="l39.38">   rv = GenerateXMLOutputChannel(output, addbookUrl, aURI, _retval);</span>
<a href="#l39.39"></a><span id="l39.39">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.40"></a><span id="l39.40">   return NS_OK;</span>
<a href="#l39.41"></a><span id="l39.41"> }</span>
<a href="#l39.42"></a><span id="l39.42"> </span>
<a href="#l39.43"></a><span id="l39.43"> nsresult    </span>
<a href="#l39.44"></a><span id="l39.44"> nsAddbookProtocolHandler::GeneratePrintOutput(nsIAddbookUrl *addbookUrl, </span>
<a href="#l39.45"></a><span id="l39.45">                                               nsString &amp;aOutput)</span>
<a href="#l39.46"></a><span id="l39.46"> {</span>
<a href="#l39.47"></a><span id="l39.47">   NS_ENSURE_ARG_POINTER(addbookUrl);</span>
<a href="#l39.48"></a><span id="l39.48"> </span>
<a href="#l39.49"></a><span id="l39.49" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l39.51"></a><span id="l39.51">   nsresult rv = addbookUrl-&gt;GetPath(uri);</span>
<a href="#l39.52"></a><span id="l39.52">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54">   /* turn</span>
<a href="#l39.55"></a><span id="l39.55">    &quot;//moz-abmdbdirectory/abook.mab?action=print&quot;</span>
<a href="#l39.56"></a><span id="l39.56">    into &quot;moz-abmdbdirectory://abook.mab&quot;</span>
<a href="#l39.57"></a><span id="l39.57">   */</span>
<a href="#l39.58"></a><span id="l39.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -32,17 +32,17 @@ nsAddbookUrl::SetSpec(const nsACString &amp;</span>
<a href="#l40.4"></a><span id="l40.4"> {</span>
<a href="#l40.5"></a><span id="l40.5">   nsresult rv = m_baseURL-&gt;SetSpec(aSpec);</span>
<a href="#l40.6"></a><span id="l40.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.7"></a><span id="l40.7">   return ParseUrl();</span>
<a href="#l40.8"></a><span id="l40.8"> }</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10"> nsresult nsAddbookUrl::ParseUrl()</span>
<a href="#l40.11"></a><span id="l40.11"> {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  nsCAutoString pathStr;</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  nsAutoCString pathStr;</span>
<a href="#l40.14"></a><span id="l40.14"> </span>
<a href="#l40.15"></a><span id="l40.15">   nsresult rv = m_baseURL-&gt;GetPath(pathStr);</span>
<a href="#l40.16"></a><span id="l40.16">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18">   if (strstr(pathStr.get(), &quot;?action=print&quot;))</span>
<a href="#l40.19"></a><span id="l40.19">     mOperationType = nsIAddbookUrlOperation::PrintAddressBook;</span>
<a href="#l40.20"></a><span id="l40.20">   else if (strstr(pathStr.get(), &quot;?action=add&quot;))</span>
<a href="#l40.21"></a><span id="l40.21">     mOperationType = nsIAddbookUrlOperation::AddVCard;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -382,31 +382,31 @@ NS_IMETHODIMP nsAddrDatabase::Open</span>
<a href="#l41.4"></a><span id="l41.4">     rv = aMabFile-&gt;Clone(getter_AddRefs(actualBackupMabFile));</span>
<a href="#l41.5"></a><span id="l41.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7">     // Now we try and generate a new name for the corrupt mab</span>
<a href="#l41.8"></a><span id="l41.8">     // file using the dummy backup mab file</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10">     // First append .bak - we have to do this the long way as</span>
<a href="#l41.11"></a><span id="l41.11">     // AppendNative is to the path, not the LeafName.</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    nsCAutoString dummyBackupMabFileName;</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    nsAutoCString dummyBackupMabFileName;</span>
<a href="#l41.14"></a><span id="l41.14">     rv = dummyBackupMabFile-&gt;GetNativeLeafName(dummyBackupMabFileName);</span>
<a href="#l41.15"></a><span id="l41.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.16"></a><span id="l41.16"> </span>
<a href="#l41.17"></a><span id="l41.17">     dummyBackupMabFileName.Append(NS_LITERAL_CSTRING(&quot;.bak&quot;));</span>
<a href="#l41.18"></a><span id="l41.18"> </span>
<a href="#l41.19"></a><span id="l41.19">     rv = dummyBackupMabFile-&gt;SetNativeLeafName(dummyBackupMabFileName);</span>
<a href="#l41.20"></a><span id="l41.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.21"></a><span id="l41.21"> </span>
<a href="#l41.22"></a><span id="l41.22">     // Now see if we can create it unique</span>
<a href="#l41.23"></a><span id="l41.23">     rv = dummyBackupMabFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 0600);</span>
<a href="#l41.24"></a><span id="l41.24">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.25"></a><span id="l41.25"> </span>
<a href="#l41.26"></a><span id="l41.26">     // Now get the new name</span>
<a href="#l41.27"></a><span id="l41.27" class="difflineminus">-    nsCAutoString backupMabFileName;</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineplus">+    nsAutoCString backupMabFileName;</span>
<a href="#l41.29"></a><span id="l41.29">     rv = dummyBackupMabFile-&gt;GetNativeLeafName(backupMabFileName);</span>
<a href="#l41.30"></a><span id="l41.30">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.31"></a><span id="l41.31"> </span>
<a href="#l41.32"></a><span id="l41.32">     // And the parent directory</span>
<a href="#l41.33"></a><span id="l41.33">     nsCOMPtr&lt;nsIFile&gt; parentDir;</span>
<a href="#l41.34"></a><span id="l41.34">     rv = dummyBackupMabFile-&gt;GetParent(getter_AddRefs(parentDir));</span>
<a href="#l41.35"></a><span id="l41.35">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.36"></a><span id="l41.36"> </span>
<a href="#l41.37"></a><span id="l41.37" class="difflineat">@@ -510,17 +510,17 @@ NS_IMETHODIMP nsAddrDatabase::OpenMDB(ns</span>
<a href="#l41.38"></a><span id="l41.38">   nsCOMPtr&lt;nsIMdbFactory&gt; mdbFactory;</span>
<a href="#l41.39"></a><span id="l41.39">   GetMDBFactory(getter_AddRefs(mdbFactory));</span>
<a href="#l41.40"></a><span id="l41.40">   if (mdbFactory)</span>
<a href="#l41.41"></a><span id="l41.41">   {</span>
<a href="#l41.42"></a><span id="l41.42">     ret = mdbFactory-&gt;MakeEnv(NULL, &amp;m_mdbEnv);</span>
<a href="#l41.43"></a><span id="l41.43">     if (NS_SUCCEEDED(ret))</span>
<a href="#l41.44"></a><span id="l41.44">     {</span>
<a href="#l41.45"></a><span id="l41.45">       nsIMdbThumb *thumb = nullptr;</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineminus">-      nsCAutoString filePath;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineplus">+      nsAutoCString filePath;</span>
<a href="#l41.48"></a><span id="l41.48"> </span>
<a href="#l41.49"></a><span id="l41.49">       ret = dbName-&gt;GetNativePath(filePath);</span>
<a href="#l41.50"></a><span id="l41.50">       NS_ENSURE_SUCCESS(ret, ret);</span>
<a href="#l41.51"></a><span id="l41.51"> </span>
<a href="#l41.52"></a><span id="l41.52">       nsIMdbHeap* dbHeap = 0;</span>
<a href="#l41.53"></a><span id="l41.53">       mdb_bool dbFrozen = mdbBool_kFalse; // not readonly, we want modifiable</span>
<a href="#l41.54"></a><span id="l41.54"> </span>
<a href="#l41.55"></a><span id="l41.55">       if (m_mdbEnv)</span>
<a href="#l41.56"></a><span id="l41.56" class="difflineat">@@ -1192,17 +1192,17 @@ nsresult nsAddrDatabase::AddAttributeCol</span>
<a href="#l41.57"></a><span id="l41.57">       nsCOMPtr&lt;nsIProperty&gt; prop = do_QueryInterface(next);</span>
<a href="#l41.58"></a><span id="l41.58">       nsAutoString name;</span>
<a href="#l41.59"></a><span id="l41.59">       prop-&gt;GetName(name);</span>
<a href="#l41.60"></a><span id="l41.60"> </span>
<a href="#l41.61"></a><span id="l41.61">       nsCOMPtr&lt;nsIVariant&gt; variant;</span>
<a href="#l41.62"></a><span id="l41.62">       prop-&gt;GetValue(getter_AddRefs(variant));</span>
<a href="#l41.63"></a><span id="l41.63">       </span>
<a href="#l41.64"></a><span id="l41.64">       // We can't get as a char * because that messes up UTF8 stuff</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineminus">-      nsCAutoString value;</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineplus">+      nsAutoCString value;</span>
<a href="#l41.67"></a><span id="l41.67">       variant-&gt;GetAsAUTF8String(value);</span>
<a href="#l41.68"></a><span id="l41.68"> </span>
<a href="#l41.69"></a><span id="l41.69">       mdb_token token;</span>
<a href="#l41.70"></a><span id="l41.70">       rv = m_mdbStore-&gt;StringToToken(m_mdbEnv, NS_ConvertUTF16toUTF8(name).get(), &amp;token);</span>
<a href="#l41.71"></a><span id="l41.71">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.72"></a><span id="l41.72">  </span>
<a href="#l41.73"></a><span id="l41.73">       rv = AddCharStringColumn(cardRow, token, value.get());</span>
<a href="#l41.74"></a><span id="l41.74">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l41.75"></a><span id="l41.75" class="difflineat">@@ -1227,17 +1227,17 @@ NS_IMETHODIMP nsAddrDatabase::CreateNewC</span>
<a href="#l41.76"></a><span id="l41.76"> </span>
<a href="#l41.77"></a><span id="l41.77">   // Per the UUID requirements, we want to try to reuse the local id if at all</span>
<a href="#l41.78"></a><span id="l41.78">   // possible. nsACString::ToInteger probably won't fail if the local id looks</span>
<a href="#l41.79"></a><span id="l41.79">   // like &quot;23bozo&quot; (returning 23 instead), but it's okay since we aren't going</span>
<a href="#l41.80"></a><span id="l41.80">   // to overwrite anything with 23 if it already exists and the id for the row</span>
<a href="#l41.81"></a><span id="l41.81">   // doesn't matter otherwise.</span>
<a href="#l41.82"></a><span id="l41.82">   nsresult rv;</span>
<a href="#l41.83"></a><span id="l41.83"> </span>
<a href="#l41.84"></a><span id="l41.84" class="difflineminus">-  nsCAutoString id;</span>
<a href="#l41.85"></a><span id="l41.85" class="difflineplus">+  nsAutoCString id;</span>
<a href="#l41.86"></a><span id="l41.86">   aNewCard-&gt;GetLocalId(id);</span>
<a href="#l41.87"></a><span id="l41.87"> </span>
<a href="#l41.88"></a><span id="l41.88">   mdbOid rowId;</span>
<a href="#l41.89"></a><span id="l41.89">   rowId.mOid_Scope = m_CardRowScopeToken;</span>
<a href="#l41.90"></a><span id="l41.90">   rowId.mOid_Id = id.ToInteger(&amp;rv);</span>
<a href="#l41.91"></a><span id="l41.91">   if (NS_SUCCEEDED(rv))</span>
<a href="#l41.92"></a><span id="l41.92">   {</span>
<a href="#l41.93"></a><span id="l41.93">     // Mork is being very naughty here. If the table does not have the oid, we</span>
<a href="#l41.94"></a><span id="l41.94" class="difflineat">@@ -2124,18 +2124,18 @@ NS_IMETHODIMP nsAddrDatabase::AddCardRow</span>
<a href="#l41.95"></a><span id="l41.95"> </span>
<a href="#l41.96"></a><span id="l41.96"> NS_IMETHODIMP nsAddrDatabase::AddLdifListMember(nsIMdbRow* listRow, const char* value)</span>
<a href="#l41.97"></a><span id="l41.97"> {</span>
<a href="#l41.98"></a><span id="l41.98">   if (!m_mdbStore || !listRow || !value || !m_mdbEnv)</span>
<a href="#l41.99"></a><span id="l41.99">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l41.100"></a><span id="l41.100"> </span>
<a href="#l41.101"></a><span id="l41.101">   uint32_t total = GetListAddressTotal(listRow);</span>
<a href="#l41.102"></a><span id="l41.102">   //add member</span>
<a href="#l41.103"></a><span id="l41.103" class="difflineminus">-  nsCAutoString valueString(value);</span>
<a href="#l41.104"></a><span id="l41.104" class="difflineminus">-  nsCAutoString email;</span>
<a href="#l41.105"></a><span id="l41.105" class="difflineplus">+  nsAutoCString valueString(value);</span>
<a href="#l41.106"></a><span id="l41.106" class="difflineplus">+  nsAutoCString email;</span>
<a href="#l41.107"></a><span id="l41.107">   int32_t emailPos = valueString.Find(&quot;mail=&quot;);</span>
<a href="#l41.108"></a><span id="l41.108">   emailPos += strlen(&quot;mail=&quot;);</span>
<a href="#l41.109"></a><span id="l41.109">   email = Substring(valueString, emailPos);</span>
<a href="#l41.110"></a><span id="l41.110">   nsCOMPtr &lt;nsIMdbRow&gt; cardRow;</span>
<a href="#l41.111"></a><span id="l41.111">   // Please DO NOT change the 3rd param of GetRowFromAttribute() call to</span>
<a href="#l41.112"></a><span id="l41.112">   // true (ie, case insensitive) without reading bugs #128535 and #121478.</span>
<a href="#l41.113"></a><span id="l41.113">   nsresult rv = GetRowFromAttribute(kPriEmailProperty, email, false /* retain case */,</span>
<a href="#l41.114"></a><span id="l41.114">                                     getter_AddRefs(cardRow), nullptr);</span>
<a href="#l41.115"></a><span id="l41.115" class="difflineat">@@ -2920,17 +2920,17 @@ nsresult nsAddrDatabase::CreateCard(nsIM</span>
<a href="#l41.116"></a><span id="l41.116">     {</span>
<a href="#l41.117"></a><span id="l41.117">         nsCOMPtr&lt;nsIAbCard&gt; personCard;</span>
<a href="#l41.118"></a><span id="l41.118">       personCard = do_CreateInstance(NS_ABMDBCARD_CONTRACTID, &amp;rv);</span>
<a href="#l41.119"></a><span id="l41.119">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l41.120"></a><span id="l41.120"> </span>
<a href="#l41.121"></a><span id="l41.121">         InitCardFromRow(personCard, cardRow);</span>
<a href="#l41.122"></a><span id="l41.122">         personCard-&gt;SetPropertyAsUint32(kRowIDProperty, rowID);</span>
<a href="#l41.123"></a><span id="l41.123"> </span>
<a href="#l41.124"></a><span id="l41.124" class="difflineminus">-        nsCAutoString id;</span>
<a href="#l41.125"></a><span id="l41.125" class="difflineplus">+        nsAutoCString id;</span>
<a href="#l41.126"></a><span id="l41.126">         id.AppendInt(rowID);</span>
<a href="#l41.127"></a><span id="l41.127">         personCard-&gt;SetLocalId(id);</span>
<a href="#l41.128"></a><span id="l41.128"> </span>
<a href="#l41.129"></a><span id="l41.129">         nsCOMPtr&lt;nsIAbDirectory&gt; abDir(do_QueryReferent(m_dbDirectory));</span>
<a href="#l41.130"></a><span id="l41.130">         if (abDir)</span>
<a href="#l41.131"></a><span id="l41.131">          abDir-&gt;GetUuid(id);</span>
<a href="#l41.132"></a><span id="l41.132"> </span>
<a href="#l41.133"></a><span id="l41.133">         personCard-&gt;SetDirectoryId(id);</span>
<a href="#l41.134"></a><span id="l41.134" class="difflineat">@@ -2978,17 +2978,17 @@ nsresult nsAddrDatabase::CreateABListCar</span>
<a href="#l41.135"></a><span id="l41.135">         if (personCard)</span>
<a href="#l41.136"></a><span id="l41.136">         {</span>
<a href="#l41.137"></a><span id="l41.137">             GetListCardFromDB(personCard, listRow);</span>
<a href="#l41.138"></a><span id="l41.138"> </span>
<a href="#l41.139"></a><span id="l41.139">             personCard-&gt;SetPropertyAsUint32(kRowIDProperty, rowID);</span>
<a href="#l41.140"></a><span id="l41.140">             personCard-&gt;SetIsMailList(true);</span>
<a href="#l41.141"></a><span id="l41.141">             personCard-&gt;SetMailListURI(listURI);</span>
<a href="#l41.142"></a><span id="l41.142"> </span>
<a href="#l41.143"></a><span id="l41.143" class="difflineminus">-            nsCAutoString id;</span>
<a href="#l41.144"></a><span id="l41.144" class="difflineplus">+            nsAutoCString id;</span>
<a href="#l41.145"></a><span id="l41.145">             id.AppendInt(rowID);</span>
<a href="#l41.146"></a><span id="l41.146">             personCard-&gt;SetLocalId(id);</span>
<a href="#l41.147"></a><span id="l41.147"> </span>
<a href="#l41.148"></a><span id="l41.148">             nsCOMPtr&lt;nsIAbDirectory&gt; abDir(do_QueryReferent(m_dbDirectory));</span>
<a href="#l41.149"></a><span id="l41.149">             if (abDir)</span>
<a href="#l41.150"></a><span id="l41.150">              abDir-&gt;GetUuid(id);</span>
<a href="#l41.151"></a><span id="l41.151">             personCard-&gt;SetDirectoryId(id);</span>
<a href="#l41.152"></a><span id="l41.152">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -764,17 +764,17 @@ static nsresult dir_GetChildList(const n</span>
<a href="#l42.4"></a><span id="l42.4"> static char *DIR_GetStringPref(const char *prefRoot, const char *prefLeaf, const char *defaultValue)</span>
<a href="#l42.5"></a><span id="l42.5"> {</span>
<a href="#l42.6"></a><span id="l42.6">     nsresult rv;</span>
<a href="#l42.7"></a><span id="l42.7">     nsCOMPtr&lt;nsIPrefBranch&gt; pPref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l42.8"></a><span id="l42.8">     if (NS_FAILED(rv))</span>
<a href="#l42.9"></a><span id="l42.9">         return nullptr;</span>
<a href="#l42.10"></a><span id="l42.10"> </span>
<a href="#l42.11"></a><span id="l42.11">     nsCString value;</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-    nsCAutoString prefLocation(prefRoot);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+    nsAutoCString prefLocation(prefRoot);</span>
<a href="#l42.14"></a><span id="l42.14"> </span>
<a href="#l42.15"></a><span id="l42.15">     prefLocation.Append('.');</span>
<a href="#l42.16"></a><span id="l42.16">     prefLocation.Append(prefLeaf);</span>
<a href="#l42.17"></a><span id="l42.17"> </span>
<a href="#l42.18"></a><span id="l42.18">     if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), getter_Copies(value))))</span>
<a href="#l42.19"></a><span id="l42.19">     {</span>
<a href="#l42.20"></a><span id="l42.20">         /* unfortunately, there may be some prefs out there which look like this */</span>
<a href="#l42.21"></a><span id="l42.21">         if (value.EqualsLiteral(&quot;(null)&quot;)) </span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -807,17 +807,17 @@ static char *DIR_GetStringPref(const cha</span>
<a href="#l42.23"></a><span id="l42.23"> static char *DIR_GetDescription(const char *prefRoot)</span>
<a href="#l42.24"></a><span id="l42.24"> {</span>
<a href="#l42.25"></a><span id="l42.25">   nsresult rv;</span>
<a href="#l42.26"></a><span id="l42.26">   nsCOMPtr&lt;nsIPrefBranch&gt; pPref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l42.27"></a><span id="l42.27"> </span>
<a href="#l42.28"></a><span id="l42.28">   if (NS_FAILED(rv))</span>
<a href="#l42.29"></a><span id="l42.29">     return nullptr;</span>
<a href="#l42.30"></a><span id="l42.30"> </span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-  nsCAutoString prefLocation(prefRoot);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+  nsAutoCString prefLocation(prefRoot);</span>
<a href="#l42.33"></a><span id="l42.33">   prefLocation.AppendLiteral(&quot;.description&quot;);</span>
<a href="#l42.34"></a><span id="l42.34"> </span>
<a href="#l42.35"></a><span id="l42.35">   nsString wvalue;</span>
<a href="#l42.36"></a><span id="l42.36">   nsCOMPtr&lt;nsIPrefLocalizedString&gt; locStr;</span>
<a href="#l42.37"></a><span id="l42.37"> </span>
<a href="#l42.38"></a><span id="l42.38">   rv = pPref-&gt;GetComplexValue(prefLocation.get(), NS_GET_IID(nsIPrefLocalizedString), getter_AddRefs(locStr));</span>
<a href="#l42.39"></a><span id="l42.39">   if (NS_SUCCEEDED(rv))</span>
<a href="#l42.40"></a><span id="l42.40">     rv = locStr-&gt;ToString(getter_Copies(wvalue));</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineat">@@ -853,17 +853,17 @@ static int32_t DIR_GetIntPref(const char</span>
<a href="#l42.42"></a><span id="l42.42"> {</span>
<a href="#l42.43"></a><span id="l42.43">   nsresult rv;</span>
<a href="#l42.44"></a><span id="l42.44">   nsCOMPtr&lt;nsIPrefBranch&gt; pPref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l42.45"></a><span id="l42.45"> </span>
<a href="#l42.46"></a><span id="l42.46">   if (NS_FAILED(rv))</span>
<a href="#l42.47"></a><span id="l42.47">     return defaultValue;</span>
<a href="#l42.48"></a><span id="l42.48"> </span>
<a href="#l42.49"></a><span id="l42.49">   int32_t value;</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-  nsCAutoString prefLocation(prefRoot);</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+  nsAutoCString prefLocation(prefRoot);</span>
<a href="#l42.52"></a><span id="l42.52"> </span>
<a href="#l42.53"></a><span id="l42.53">   prefLocation.Append('.');</span>
<a href="#l42.54"></a><span id="l42.54">   prefLocation.Append(prefLeaf);</span>
<a href="#l42.55"></a><span id="l42.55"> </span>
<a href="#l42.56"></a><span id="l42.56">   if (NS_FAILED(pPref-&gt;GetIntPref(prefLocation.get(), &amp;value)))</span>
<a href="#l42.57"></a><span id="l42.57">     value = defaultValue;</span>
<a href="#l42.58"></a><span id="l42.58"> </span>
<a href="#l42.59"></a><span id="l42.59">   return value;</span>
<a href="#l42.60"></a><span id="l42.60" class="difflineat">@@ -1225,17 +1225,17 @@ static nsresult DIR_GetServerPreferences</span>
<a href="#l42.61"></a><span id="l42.61"> static void DIR_SetStringPref(const char *prefRoot, const char *prefLeaf, const char *value, const char *defaultValue)</span>
<a href="#l42.62"></a><span id="l42.62"> {</span>
<a href="#l42.63"></a><span id="l42.63">   nsresult rv;</span>
<a href="#l42.64"></a><span id="l42.64">   nsCOMPtr&lt;nsIPrefBranch&gt; pPref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv)); </span>
<a href="#l42.65"></a><span id="l42.65">   if (NS_FAILED(rv)) </span>
<a href="#l42.66"></a><span id="l42.66">     return;</span>
<a href="#l42.67"></a><span id="l42.67"> </span>
<a href="#l42.68"></a><span id="l42.68">   nsCString defaultPref;</span>
<a href="#l42.69"></a><span id="l42.69" class="difflineminus">-  nsCAutoString prefLocation(prefRoot);</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineplus">+  nsAutoCString prefLocation(prefRoot);</span>
<a href="#l42.71"></a><span id="l42.71"> </span>
<a href="#l42.72"></a><span id="l42.72">   prefLocation.Append('.');</span>
<a href="#l42.73"></a><span id="l42.73">   prefLocation.Append(prefLeaf);</span>
<a href="#l42.74"></a><span id="l42.74"> </span>
<a href="#l42.75"></a><span id="l42.75">   if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), getter_Copies(defaultPref))))</span>
<a href="#l42.76"></a><span id="l42.76">   {</span>
<a href="#l42.77"></a><span id="l42.77">     /* If there's a default pref, just set ours in and let libpref worry </span>
<a href="#l42.78"></a><span id="l42.78">      * about potential defaults in all.js</span>
<a href="#l42.79"></a><span id="l42.79" class="difflineat">@@ -1272,17 +1272,17 @@ static void DIR_SetLocalizedStringPref</span>
<a href="#l42.80"></a><span id="l42.80"> (const char *prefRoot, const char *prefLeaf, const char *value)</span>
<a href="#l42.81"></a><span id="l42.81"> {</span>
<a href="#l42.82"></a><span id="l42.82">   nsresult rv;</span>
<a href="#l42.83"></a><span id="l42.83">   nsCOMPtr&lt;nsIPrefService&gt; prefSvc(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l42.84"></a><span id="l42.84"> </span>
<a href="#l42.85"></a><span id="l42.85">   if (NS_FAILED(rv))</span>
<a href="#l42.86"></a><span id="l42.86">     return;</span>
<a href="#l42.87"></a><span id="l42.87"> </span>
<a href="#l42.88"></a><span id="l42.88" class="difflineminus">-  nsCAutoString prefLocation(prefRoot);</span>
<a href="#l42.89"></a><span id="l42.89" class="difflineplus">+  nsAutoCString prefLocation(prefRoot);</span>
<a href="#l42.90"></a><span id="l42.90">   prefLocation.Append('.');</span>
<a href="#l42.91"></a><span id="l42.91"> </span>
<a href="#l42.92"></a><span id="l42.92">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l42.93"></a><span id="l42.93">   rv = prefSvc-&gt;GetBranch(prefLocation.get(), getter_AddRefs(prefBranch));</span>
<a href="#l42.94"></a><span id="l42.94">   if (NS_FAILED(rv))</span>
<a href="#l42.95"></a><span id="l42.95">     return;</span>
<a href="#l42.96"></a><span id="l42.96"> </span>
<a href="#l42.97"></a><span id="l42.97">   nsString wvalue;</span>
<a href="#l42.98"></a><span id="l42.98" class="difflineat">@@ -1356,17 +1356,17 @@ static void DIR_SetLocalizedStringPref</span>
<a href="#l42.99"></a><span id="l42.99"> static void DIR_SetIntPref(const char *prefRoot, const char *prefLeaf, int32_t value, int32_t defaultValue)</span>
<a href="#l42.100"></a><span id="l42.100"> {</span>
<a href="#l42.101"></a><span id="l42.101">   nsresult rv;</span>
<a href="#l42.102"></a><span id="l42.102">   nsCOMPtr&lt;nsIPrefBranch&gt; pPref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv)); </span>
<a href="#l42.103"></a><span id="l42.103">   if (NS_FAILED(rv)) </span>
<a href="#l42.104"></a><span id="l42.104">     return;</span>
<a href="#l42.105"></a><span id="l42.105"> </span>
<a href="#l42.106"></a><span id="l42.106">   int32_t defaultPref;</span>
<a href="#l42.107"></a><span id="l42.107" class="difflineminus">-  nsCAutoString prefLocation(prefRoot);</span>
<a href="#l42.108"></a><span id="l42.108" class="difflineplus">+  nsAutoCString prefLocation(prefRoot);</span>
<a href="#l42.109"></a><span id="l42.109"> </span>
<a href="#l42.110"></a><span id="l42.110">   prefLocation.Append('.');</span>
<a href="#l42.111"></a><span id="l42.111">   prefLocation.Append(prefLeaf);</span>
<a href="#l42.112"></a><span id="l42.112"> </span>
<a href="#l42.113"></a><span id="l42.113">   if (NS_SUCCEEDED(pPref-&gt;GetIntPref(prefLocation.get(), &amp;defaultPref)))</span>
<a href="#l42.114"></a><span id="l42.114">   {</span>
<a href="#l42.115"></a><span id="l42.115">     /* solve the problem where reordering user prefs must override default prefs */</span>
<a href="#l42.116"></a><span id="l42.116">     rv = pPref-&gt;SetIntPref(prefLocation.get(), value);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsLDAPAutoCompleteSession.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -584,17 +584,17 @@ nsLDAPAutoCompleteSession::DoTask()</span>
<a href="#l43.4"></a><span id="l43.4">             FinishAutoCompleteLookup(nsIAutoCompleteStatus::failureItems, rv, </span>
<a href="#l43.5"></a><span id="l43.5">                                      BOUND);</span>
<a href="#l43.6"></a><span id="l43.6">             return NS_ERROR_UNEXPECTED;</span>
<a href="#l43.7"></a><span id="l43.7">         }</span>
<a href="#l43.8"></a><span id="l43.8">     }</span>
<a href="#l43.9"></a><span id="l43.9"> </span>
<a href="#l43.10"></a><span id="l43.10">     // Get the search filter associated with the directory server url;</span>
<a href="#l43.11"></a><span id="l43.11">     // it will be ANDed with the rest of the search filter that we're using.</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    nsCAutoString urlFilter;</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+    nsAutoCString urlFilter;</span>
<a href="#l43.14"></a><span id="l43.14">     rv = mDirectoryUrl-&gt;GetFilter(urlFilter);</span>
<a href="#l43.15"></a><span id="l43.15">     if ( NS_FAILED(rv) ){</span>
<a href="#l43.16"></a><span id="l43.16">         FinishAutoCompleteLookup(nsIAutoCompleteStatus::failureItems, rv,</span>
<a href="#l43.17"></a><span id="l43.17">                                  BOUND);</span>
<a href="#l43.18"></a><span id="l43.18">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l43.19"></a><span id="l43.19">     }</span>
<a href="#l43.20"></a><span id="l43.20"> </span>
<a href="#l43.21"></a><span id="l43.21">     // Get the LDAP service, since createFilter is called through it.</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -605,17 +605,17 @@ nsLDAPAutoCompleteSession::DoTask()</span>
<a href="#l43.23"></a><span id="l43.23">                  &quot;get @mozilla.org/network/ldap-service;1&quot;);</span>
<a href="#l43.24"></a><span id="l43.24">         FinishAutoCompleteLookup(nsIAutoCompleteStatus::failureItems, rv,</span>
<a href="#l43.25"></a><span id="l43.25">                                  BOUND);</span>
<a href="#l43.26"></a><span id="l43.26">         return NS_ERROR_FAILURE;</span>
<a href="#l43.27"></a><span id="l43.27">     }</span>
<a href="#l43.28"></a><span id="l43.28"> </span>
<a href="#l43.29"></a><span id="l43.29">     // If urlFilter is unset (or set to the default &quot;objectclass=*&quot;), there's</span>
<a href="#l43.30"></a><span id="l43.30">     // no need to AND in an empty search term, so leave prefix and suffix empty.</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-    nsCAutoString prefix, suffix;</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+    nsAutoCString prefix, suffix;</span>
<a href="#l43.33"></a><span id="l43.33">     if (urlFilter.Length() &amp;&amp; !urlFilter.EqualsLiteral(&quot;(objectclass=*)&quot;)) {</span>
<a href="#l43.34"></a><span id="l43.34"> </span>
<a href="#l43.35"></a><span id="l43.35">         // If urlFilter isn't parenthesized, we need to add in parens so that</span>
<a href="#l43.36"></a><span id="l43.36">         // the filter works as a term to &amp;</span>
<a href="#l43.37"></a><span id="l43.37">         if (urlFilter[0] != '(') {</span>
<a href="#l43.38"></a><span id="l43.38">             prefix.AssignLiteral(&quot;(&amp;(&quot;);</span>
<a href="#l43.39"></a><span id="l43.39">             prefix.Append(urlFilter);</span>
<a href="#l43.40"></a><span id="l43.40">             prefix.AppendLiteral(&quot;)&quot;);</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineat">@@ -625,17 +625,17 @@ nsLDAPAutoCompleteSession::DoTask()</span>
<a href="#l43.42"></a><span id="l43.42">         }</span>
<a href="#l43.43"></a><span id="l43.43">         </span>
<a href="#l43.44"></a><span id="l43.44">         suffix = ')';</span>
<a href="#l43.45"></a><span id="l43.45">     }</span>
<a href="#l43.46"></a><span id="l43.46"> </span>
<a href="#l43.47"></a><span id="l43.47">     // Generate an LDAP search filter from mFilterTemplate. If it's unset,</span>
<a href="#l43.48"></a><span id="l43.48">     // use the default.</span>
<a href="#l43.49"></a><span id="l43.49"> #define MAX_AUTOCOMPLETE_FILTER_SIZE 1024</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-    nsCAutoString searchFilter;</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineplus">+    nsAutoCString searchFilter;</span>
<a href="#l43.52"></a><span id="l43.52">     rv = ldapSvc-&gt;CreateFilter(MAX_AUTOCOMPLETE_FILTER_SIZE,</span>
<a href="#l43.53"></a><span id="l43.53">                                mFilterTemplate,</span>
<a href="#l43.54"></a><span id="l43.54">                                prefix, suffix, EmptyCString(), </span>
<a href="#l43.55"></a><span id="l43.55">                                NS_ConvertUTF16toUTF8(mSearchString),</span>
<a href="#l43.56"></a><span id="l43.56">                                searchFilter);</span>
<a href="#l43.57"></a><span id="l43.57">     if (NS_FAILED(rv)) {</span>
<a href="#l43.58"></a><span id="l43.58">         switch(rv) {</span>
<a href="#l43.59"></a><span id="l43.59"> </span>
<a href="#l43.60"></a><span id="l43.60" class="difflineat">@@ -674,17 +674,17 @@ nsLDAPAutoCompleteSession::DoTask()</span>
<a href="#l43.61"></a><span id="l43.61">     if (NS_FAILED(rv)) {</span>
<a href="#l43.62"></a><span id="l43.62">         FinishAutoCompleteLookup(nsIAutoCompleteStatus::failed, rv, BOUND);</span>
<a href="#l43.63"></a><span id="l43.63">     }</span>
<a href="#l43.64"></a><span id="l43.64"> </span>
<a href="#l43.65"></a><span id="l43.65">     // Nothing returned yet!</span>
<a href="#l43.66"></a><span id="l43.66">     mEntriesReturned = 0;</span>
<a href="#l43.67"></a><span id="l43.67">     </span>
<a href="#l43.68"></a><span id="l43.68">     // Get the base dn to search</span>
<a href="#l43.69"></a><span id="l43.69" class="difflineminus">-    nsCAutoString dn;</span>
<a href="#l43.70"></a><span id="l43.70" class="difflineplus">+    nsAutoCString dn;</span>
<a href="#l43.71"></a><span id="l43.71">     rv = mDirectoryUrl-&gt;GetDn(dn);</span>
<a href="#l43.72"></a><span id="l43.72">     if ( NS_FAILED(rv) ){</span>
<a href="#l43.73"></a><span id="l43.73">         FinishAutoCompleteLookup(nsIAutoCompleteStatus::failureItems, rv,</span>
<a href="#l43.74"></a><span id="l43.74">                                  BOUND);</span>
<a href="#l43.75"></a><span id="l43.75">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l43.76"></a><span id="l43.76">     }</span>
<a href="#l43.77"></a><span id="l43.77"> </span>
<a href="#l43.78"></a><span id="l43.78">     // And the scope</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/addrbook/src/nsVCardObj.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsVCardObj.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1123,17 +1123,17 @@ static void writeAttrValue(OFile *fp, VO</span>
<a href="#l44.4"></a><span id="l44.4">       appendcOFile(fp,' ');</span>
<a href="#l44.5"></a><span id="l44.5">   }</span>
<a href="#l44.6"></a><span id="l44.6">   writeValue(fp,o,0);</span>
<a href="#l44.7"></a><span id="l44.7">   }</span>
<a href="#l44.8"></a><span id="l44.8"> }</span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10"> static void writeGroup(OFile *fp, VObject *o)</span>
<a href="#l44.11"></a><span id="l44.11"> {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  nsCAutoString buf(NAME_OF(o));</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+  nsAutoCString buf(NAME_OF(o));</span>
<a href="#l44.14"></a><span id="l44.14"> </span>
<a href="#l44.15"></a><span id="l44.15">   while ((o=isAPropertyOf(o,VCGroupingProp)) != 0) {</span>
<a href="#l44.16"></a><span id="l44.16">     buf.Insert(NS_LITERAL_CSTRING(&quot;.&quot;), 0);</span>
<a href="#l44.17"></a><span id="l44.17">     buf.Insert(STRINGZ_VALUE_OF(o), 0);</span>
<a href="#l44.18"></a><span id="l44.18">   }</span>
<a href="#l44.19"></a><span id="l44.19">   appendsOFile(fp, buf.get());</span>
<a href="#l44.20"></a><span id="l44.20"> }</span>
<a href="#l44.21"></a><span id="l44.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -87,17 +87,17 @@ nsMsgBodyHandler::~nsMsgBodyHandler()</span>
<a href="#l45.4"></a><span id="l45.4"> {</span>
<a href="#l45.5"></a><span id="l45.5"> }</span>
<a href="#l45.6"></a><span id="l45.6"> </span>
<a href="#l45.7"></a><span id="l45.7"> int32_t nsMsgBodyHandler::GetNextLine (nsCString &amp;buf)</span>
<a href="#l45.8"></a><span id="l45.8"> {</span>
<a href="#l45.9"></a><span id="l45.9">   int32_t length = -1;          // length of incoming line or -1 eof</span>
<a href="#l45.10"></a><span id="l45.10">   int32_t outLength = -1;       // length of outgoing line or -1 eof</span>
<a href="#l45.11"></a><span id="l45.11">   bool eatThisLine = true;</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  nsCAutoString nextLine;</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  nsAutoCString nextLine;</span>
<a href="#l45.14"></a><span id="l45.14"> </span>
<a href="#l45.15"></a><span id="l45.15">   while (eatThisLine) {</span>
<a href="#l45.16"></a><span id="l45.16">     // first, handle the filtering case...this is easy....</span>
<a href="#l45.17"></a><span id="l45.17">     if (m_Filtering)</span>
<a href="#l45.18"></a><span id="l45.18">       length = GetNextFilterLine(nextLine);</span>
<a href="#l45.19"></a><span id="l45.19">     else</span>
<a href="#l45.20"></a><span id="l45.20">     {</span>
<a href="#l45.21"></a><span id="l45.21">       // 3 cases: Offline IMAP, POP, or we are dealing with a news message....</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -650,17 +650,17 @@ nsresult nsMsgFilter::ConvertMoveOrCopyT</span>
<a href="#l46.4"></a><span id="l46.4">     nsCOMPtr &lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l46.5"></a><span id="l46.5">     nsCString folderUri;</span>
<a href="#l46.6"></a><span id="l46.6"> </span>
<a href="#l46.7"></a><span id="l46.7">     m_filterList-&gt;GetFolder(getter_AddRefs(rootFolder));</span>
<a href="#l46.8"></a><span id="l46.8">     // if relative path starts with kImap, this is a move to folder on the same server</span>
<a href="#l46.9"></a><span id="l46.9">     if (moveValue.Find(kImapPrefix) == 0)</span>
<a href="#l46.10"></a><span id="l46.10">     {</span>
<a href="#l46.11"></a><span id="l46.11">       int32_t prefixLen = PL_strlen(kImapPrefix);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-      nsCAutoString originalServerPath(Substring(moveValue, prefixLen));</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+      nsAutoCString originalServerPath(Substring(moveValue, prefixLen));</span>
<a href="#l46.14"></a><span id="l46.14">       if (filterVersion == k45Version)</span>
<a href="#l46.15"></a><span id="l46.15">       {</span>
<a href="#l46.16"></a><span id="l46.16">         nsAutoString unicodeStr;</span>
<a href="#l46.17"></a><span id="l46.17">         nsresult rv = nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(),</span>
<a href="#l46.18"></a><span id="l46.18">                                                 originalServerPath,</span>
<a href="#l46.19"></a><span id="l46.19">                                                 unicodeStr);</span>
<a href="#l46.20"></a><span id="l46.20">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l46.21"></a><span id="l46.21"> </span>
<a href="#l46.22"></a><span id="l46.22" class="difflineat">@@ -769,17 +769,17 @@ nsMsgFilter::SaveToTextFile(nsIOutputStr</span>
<a href="#l46.23"></a><span id="l46.23">   return err;</span>
<a href="#l46.24"></a><span id="l46.24"> }</span>
<a href="#l46.25"></a><span id="l46.25"> </span>
<a href="#l46.26"></a><span id="l46.26"> nsresult nsMsgFilter::SaveRule(nsIOutputStream *aStream)</span>
<a href="#l46.27"></a><span id="l46.27"> {</span>
<a href="#l46.28"></a><span id="l46.28">   nsresult err = NS_OK;</span>
<a href="#l46.29"></a><span id="l46.29">   nsCOMPtr&lt;nsIMsgFilterList&gt; filterList;</span>
<a href="#l46.30"></a><span id="l46.30">   GetFilterList(getter_AddRefs(filterList));</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-  nsCAutoString  actionFilingStr;</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+  nsAutoCString  actionFilingStr;</span>
<a href="#l46.33"></a><span id="l46.33"> </span>
<a href="#l46.34"></a><span id="l46.34">   uint32_t numActions;</span>
<a href="#l46.35"></a><span id="l46.35">   err = m_actionList-&gt;Count(&amp;numActions);</span>
<a href="#l46.36"></a><span id="l46.36">   NS_ENSURE_SUCCESS(err, err);</span>
<a href="#l46.37"></a><span id="l46.37"> </span>
<a href="#l46.38"></a><span id="l46.38">   for (uint32_t index =0; index &lt; numActions; index++)</span>
<a href="#l46.39"></a><span id="l46.39">   {</span>
<a href="#l46.40"></a><span id="l46.40">     nsCOMPtr&lt;nsIMsgRuleAction&gt; action;</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineat">@@ -804,17 +804,17 @@ nsresult nsMsgFilter::SaveRule(nsIOutput</span>
<a href="#l46.42"></a><span id="l46.42">         action-&gt;GetTargetFolderUri(imapTargetString);</span>
<a href="#l46.43"></a><span id="l46.43">         err = filterList-&gt;WriteStrAttr(nsIMsgFilterList::attribActionValue, imapTargetString.get(), aStream);</span>
<a href="#l46.44"></a><span id="l46.44">       }</span>
<a href="#l46.45"></a><span id="l46.45">       break;</span>
<a href="#l46.46"></a><span id="l46.46">       case nsMsgFilterAction::ChangePriority:</span>
<a href="#l46.47"></a><span id="l46.47">       {</span>
<a href="#l46.48"></a><span id="l46.48">         nsMsgPriorityValue priorityValue;</span>
<a href="#l46.49"></a><span id="l46.49">         action-&gt;GetPriority(&amp;priorityValue);</span>
<a href="#l46.50"></a><span id="l46.50" class="difflineminus">-        nsCAutoString priority;</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineplus">+        nsAutoCString priority;</span>
<a href="#l46.52"></a><span id="l46.52">         NS_MsgGetUntranslatedPriorityName(priorityValue, priority);</span>
<a href="#l46.53"></a><span id="l46.53">         err = filterList-&gt;WriteStrAttr(</span>
<a href="#l46.54"></a><span id="l46.54">                 nsIMsgFilterList::attribActionValue, priority.get(), aStream);</span>
<a href="#l46.55"></a><span id="l46.55">       }</span>
<a href="#l46.56"></a><span id="l46.56">       break;</span>
<a href="#l46.57"></a><span id="l46.57">       case nsMsgFilterAction::Label:</span>
<a href="#l46.58"></a><span id="l46.58">       {</span>
<a href="#l46.59"></a><span id="l46.59">         nsMsgLabelValue label;</span>
<a href="#l46.60"></a><span id="l46.60" class="difflineat">@@ -836,34 +836,34 @@ nsresult nsMsgFilter::SaveRule(nsIOutput</span>
<a href="#l46.61"></a><span id="l46.61">         nsCString strValue;</span>
<a href="#l46.62"></a><span id="l46.62">         action-&gt;GetStrValue(strValue);</span>
<a href="#l46.63"></a><span id="l46.63">         // strValue is e-mail address</span>
<a href="#l46.64"></a><span id="l46.64">         err = filterList-&gt;WriteStrAttr(nsIMsgFilterList::attribActionValue, strValue.get(), aStream);</span>
<a href="#l46.65"></a><span id="l46.65">       }</span>
<a href="#l46.66"></a><span id="l46.66">       break;</span>
<a href="#l46.67"></a><span id="l46.67">       case nsMsgFilterAction::Custom:</span>
<a href="#l46.68"></a><span id="l46.68">       {</span>
<a href="#l46.69"></a><span id="l46.69" class="difflineminus">-        nsCAutoString id;</span>
<a href="#l46.70"></a><span id="l46.70" class="difflineplus">+        nsAutoCString id;</span>
<a href="#l46.71"></a><span id="l46.71">         action-&gt;GetCustomId(id);</span>
<a href="#l46.72"></a><span id="l46.72">         err = filterList-&gt;WriteStrAttr(nsIMsgFilterList::attribCustomId, id.get(), aStream);</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineminus">-        nsCAutoString strValue;</span>
<a href="#l46.74"></a><span id="l46.74" class="difflineplus">+        nsAutoCString strValue;</span>
<a href="#l46.75"></a><span id="l46.75">         action-&gt;GetStrValue(strValue);</span>
<a href="#l46.76"></a><span id="l46.76">         if (strValue.Length())</span>
<a href="#l46.77"></a><span id="l46.77">           err = filterList-&gt;WriteWstrAttr(nsIMsgFilterList::attribActionValue,</span>
<a href="#l46.78"></a><span id="l46.78">                                           NS_ConvertUTF8toUTF16(strValue).get(),</span>
<a href="#l46.79"></a><span id="l46.79">                                           aStream);</span>
<a href="#l46.80"></a><span id="l46.80">       }</span>
<a href="#l46.81"></a><span id="l46.81">       break;</span>
<a href="#l46.82"></a><span id="l46.82"> </span>
<a href="#l46.83"></a><span id="l46.83">       default:</span>
<a href="#l46.84"></a><span id="l46.84">         break;</span>
<a href="#l46.85"></a><span id="l46.85">     }</span>
<a href="#l46.86"></a><span id="l46.86">   }</span>
<a href="#l46.87"></a><span id="l46.87">   // and here the fun begins - file out term list...</span>
<a href="#l46.88"></a><span id="l46.88" class="difflineminus">-  nsCAutoString  condition;</span>
<a href="#l46.89"></a><span id="l46.89" class="difflineplus">+  nsAutoCString  condition;</span>
<a href="#l46.90"></a><span id="l46.90">   err = MsgTermListToString(m_termList, condition);</span>
<a href="#l46.91"></a><span id="l46.91">   if (NS_SUCCEEDED(err))</span>
<a href="#l46.92"></a><span id="l46.92">     err = filterList-&gt;WriteStrAttr(nsIMsgFilterList::attribCondition, condition.get(), aStream);</span>
<a href="#l46.93"></a><span id="l46.93">   return err;</span>
<a href="#l46.94"></a><span id="l46.94"> }</span>
<a href="#l46.95"></a><span id="l46.95"> </span>
<a href="#l46.96"></a><span id="l46.96"> // for each action, this table encodes the filterTypes that support the action.</span>
<a href="#l46.97"></a><span id="l46.97"> struct RuleActionsTableEntry</span>
<a href="#l46.98"></a><span id="l46.98" class="difflineat">@@ -938,14 +938,14 @@ nsMsgFilter::GetVersion()</span>
<a href="#l46.99"></a><span id="l46.99">     int16_t version;</span>
<a href="#l46.100"></a><span id="l46.100">     m_filterList-&gt;GetVersion(&amp;version);</span>
<a href="#l46.101"></a><span id="l46.101">     return version;</span>
<a href="#l46.102"></a><span id="l46.102"> }</span>
<a href="#l46.103"></a><span id="l46.103"> </span>
<a href="#l46.104"></a><span id="l46.104"> #ifdef DEBUG</span>
<a href="#l46.105"></a><span id="l46.105"> void nsMsgFilter::Dump()</span>
<a href="#l46.106"></a><span id="l46.106"> {</span>
<a href="#l46.107"></a><span id="l46.107" class="difflineminus">-  nsCAutoString s;</span>
<a href="#l46.108"></a><span id="l46.108" class="difflineplus">+  nsAutoCString s;</span>
<a href="#l46.109"></a><span id="l46.109">   LossyCopyUTF16toASCII(m_filterName, s);</span>
<a href="#l46.110"></a><span id="l46.110">   printf(&quot;filter %s type = %c desc = %s\n&quot;, s.get(), m_type + '0', m_description.get());</span>
<a href="#l46.111"></a><span id="l46.111"> }</span>
<a href="#l46.112"></a><span id="l46.112"> #endif</span>
<a href="#l46.113"></a><span id="l46.113"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -445,17 +445,17 @@ const char *nsMsgFilterList::GetStringFo</span>
<a href="#l47.4"></a><span id="l47.4">     if (attrib == FilterFileAttribTable[tableIndex].attrib)</span>
<a href="#l47.5"></a><span id="l47.5">       return FilterFileAttribTable[tableIndex].attribName;</span>
<a href="#l47.6"></a><span id="l47.6">   }</span>
<a href="#l47.7"></a><span id="l47.7">   return nullptr;</span>
<a href="#l47.8"></a><span id="l47.8"> }</span>
<a href="#l47.9"></a><span id="l47.9"> </span>
<a href="#l47.10"></a><span id="l47.10"> nsresult nsMsgFilterList::LoadValue(nsCString &amp;value, nsIInputStream *aStream)</span>
<a href="#l47.11"></a><span id="l47.11"> {</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  nsCAutoString  valueStr;</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  nsAutoCString  valueStr;</span>
<a href="#l47.14"></a><span id="l47.14">   char  curChar;</span>
<a href="#l47.15"></a><span id="l47.15">   value = &quot;&quot;;</span>
<a href="#l47.16"></a><span id="l47.16">   curChar = SkipWhitespace(aStream);</span>
<a href="#l47.17"></a><span id="l47.17">   if (curChar != '&quot;')</span>
<a href="#l47.18"></a><span id="l47.18">   {</span>
<a href="#l47.19"></a><span id="l47.19">     NS_ASSERTION(false, &quot;expecting quote as start of value&quot;);</span>
<a href="#l47.20"></a><span id="l47.20">     return NS_MSG_FILTER_PARSE_ERROR;</span>
<a href="#l47.21"></a><span id="l47.21">   }</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -502,17 +502,17 @@ nsresult nsMsgFilterList::LoadTextFilter</span>
<a href="#l47.23"></a><span id="l47.23">   err = NS_NewBufferedInputStream(getter_AddRefs(bufStream), aStream, 10240);</span>
<a href="#l47.24"></a><span id="l47.24">   NS_ENSURE_SUCCESS(err, err);</span>
<a href="#l47.25"></a><span id="l47.25"> </span>
<a href="#l47.26"></a><span id="l47.26">   nsMsgFilterFileAttribValue attrib;</span>
<a href="#l47.27"></a><span id="l47.27">   nsCOMPtr&lt;nsIMsgRuleAction&gt; currentFilterAction;</span>
<a href="#l47.28"></a><span id="l47.28">   // We'd really like to move lot's of these into the objects that they refer to.</span>
<a href="#l47.29"></a><span id="l47.29">   do</span>
<a href="#l47.30"></a><span id="l47.30">   {</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-    nsCAutoString value;</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineplus">+    nsAutoCString value;</span>
<a href="#l47.33"></a><span id="l47.33">     nsresult intToStringResult;</span>
<a href="#l47.34"></a><span id="l47.34"> </span>
<a href="#l47.35"></a><span id="l47.35">     char curChar;</span>
<a href="#l47.36"></a><span id="l47.36">     curChar = LoadAttrib(attrib, bufStream);</span>
<a href="#l47.37"></a><span id="l47.37">     if (curChar == (char) -1)  //reached eof</span>
<a href="#l47.38"></a><span id="l47.38">       break;</span>
<a href="#l47.39"></a><span id="l47.39">     err = LoadValue(value, bufStream);</span>
<a href="#l47.40"></a><span id="l47.40">     if (err != NS_OK)</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineat">@@ -537,17 +537,17 @@ nsresult nsMsgFilterList::LoadTextFilter</span>
<a href="#l47.42"></a><span id="l47.42">       m_startWritingToBuffer = true; //filters begin now</span>
<a href="#l47.43"></a><span id="l47.43">       break;</span>
<a href="#l47.44"></a><span id="l47.44">     case nsIMsgFilterList::attribName:  //every filter starts w/ a name</span>
<a href="#l47.45"></a><span id="l47.45">       {</span>
<a href="#l47.46"></a><span id="l47.46">         if (m_curFilter)</span>
<a href="#l47.47"></a><span id="l47.47">         {</span>
<a href="#l47.48"></a><span id="l47.48">           int32_t nextFilterStartPos = m_unparsedFilterBuffer.RFind(&quot;name&quot;);</span>
<a href="#l47.49"></a><span id="l47.49"> </span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-          nsCAutoString nextFilterPart;</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineplus">+          nsAutoCString nextFilterPart;</span>
<a href="#l47.52"></a><span id="l47.52">           nextFilterPart = Substring(m_unparsedFilterBuffer, nextFilterStartPos, m_unparsedFilterBuffer.Length());</span>
<a href="#l47.53"></a><span id="l47.53">           m_unparsedFilterBuffer.SetLength(nextFilterStartPos);</span>
<a href="#l47.54"></a><span id="l47.54"> </span>
<a href="#l47.55"></a><span id="l47.55">           bool unparseableFilter;</span>
<a href="#l47.56"></a><span id="l47.56">           m_curFilter-&gt;GetUnparseable(&amp;unparseableFilter);</span>
<a href="#l47.57"></a><span id="l47.57">           if (unparseableFilter)</span>
<a href="#l47.58"></a><span id="l47.58">           {</span>
<a href="#l47.59"></a><span id="l47.59">             m_curFilter-&gt;SetUnparsedBuffer(m_unparsedFilterBuffer);</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineat">@@ -641,17 +641,17 @@ nsresult nsMsgFilterList::LoadTextFilter</span>
<a href="#l47.61"></a><span id="l47.61">         }</span>
<a href="#l47.62"></a><span id="l47.62">         else if (type == nsMsgFilterAction::Label)</span>
<a href="#l47.63"></a><span id="l47.63">         {</span>
<a href="#l47.64"></a><span id="l47.64">           // upgrade label to corresponding tag/keyword</span>
<a href="#l47.65"></a><span id="l47.65">           nsresult res;</span>
<a href="#l47.66"></a><span id="l47.66">           int32_t labelInt = value.ToInteger(&amp;res);</span>
<a href="#l47.67"></a><span id="l47.67">           if (NS_SUCCEEDED(res))</span>
<a href="#l47.68"></a><span id="l47.68">           {</span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">-            nsCAutoString keyword(&quot;$label&quot;);</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineplus">+            nsAutoCString keyword(&quot;$label&quot;);</span>
<a href="#l47.71"></a><span id="l47.71">             keyword.Append('0' + labelInt);</span>
<a href="#l47.72"></a><span id="l47.72">             currentFilterAction-&gt;SetType(nsMsgFilterAction::AddTag);</span>
<a href="#l47.73"></a><span id="l47.73">             currentFilterAction-&gt;SetStrValue(keyword);</span>
<a href="#l47.74"></a><span id="l47.74">           }</span>
<a href="#l47.75"></a><span id="l47.75">         }</span>
<a href="#l47.76"></a><span id="l47.76">         else if (type == nsMsgFilterAction::JunkScore)</span>
<a href="#l47.77"></a><span id="l47.77">         {</span>
<a href="#l47.78"></a><span id="l47.78">           nsresult res;</span>
<a href="#l47.79"></a><span id="l47.79" class="difflineat">@@ -812,17 +812,17 @@ NS_IMETHODIMP nsMsgFilterList::ParseCond</span>
<a href="#l47.80"></a><span id="l47.80"> </span>
<a href="#l47.81"></a><span id="l47.81"> nsresult nsMsgFilterList::WriteIntAttr(nsMsgFilterFileAttribValue attrib, int value, nsIOutputStream *aStream)</span>
<a href="#l47.82"></a><span id="l47.82"> {</span>
<a href="#l47.83"></a><span id="l47.83">   nsresult rv = NS_OK;</span>
<a href="#l47.84"></a><span id="l47.84">   const char *attribStr = GetStringForAttrib(attrib);</span>
<a href="#l47.85"></a><span id="l47.85">   if (attribStr)</span>
<a href="#l47.86"></a><span id="l47.86">   {</span>
<a href="#l47.87"></a><span id="l47.87">     uint32_t bytesWritten;</span>
<a href="#l47.88"></a><span id="l47.88" class="difflineminus">-    nsCAutoString writeStr(attribStr);</span>
<a href="#l47.89"></a><span id="l47.89" class="difflineplus">+    nsAutoCString writeStr(attribStr);</span>
<a href="#l47.90"></a><span id="l47.90">     writeStr.AppendLiteral(&quot;=\&quot;&quot;);</span>
<a href="#l47.91"></a><span id="l47.91">     writeStr.AppendInt(value);</span>
<a href="#l47.92"></a><span id="l47.92">     writeStr.AppendLiteral(&quot;\&quot;&quot; MSG_LINEBREAK);</span>
<a href="#l47.93"></a><span id="l47.93">     rv = aStream-&gt;Write(writeStr.get(), writeStr.Length(), &amp;bytesWritten);</span>
<a href="#l47.94"></a><span id="l47.94">   }</span>
<a href="#l47.95"></a><span id="l47.95">   return rv;</span>
<a href="#l47.96"></a><span id="l47.96"> }</span>
<a href="#l47.97"></a><span id="l47.97"> </span>
<a href="#l47.98"></a><span id="l47.98" class="difflineat">@@ -836,17 +836,17 @@ nsMsgFilterList::WriteStrAttr(nsMsgFilte</span>
<a href="#l47.99"></a><span id="l47.99">     char *escapedStr = nullptr;</span>
<a href="#l47.100"></a><span id="l47.100">     if (PL_strchr(aStr, '&quot;'))</span>
<a href="#l47.101"></a><span id="l47.101">       escapedStr = nsMsgSearchTerm::EscapeQuotesInStr(aStr);</span>
<a href="#l47.102"></a><span id="l47.102"> </span>
<a href="#l47.103"></a><span id="l47.103">     const char *attribStr = GetStringForAttrib(attrib);</span>
<a href="#l47.104"></a><span id="l47.104">     if (attribStr)</span>
<a href="#l47.105"></a><span id="l47.105">     {</span>
<a href="#l47.106"></a><span id="l47.106">       uint32_t bytesWritten;</span>
<a href="#l47.107"></a><span id="l47.107" class="difflineminus">-      nsCAutoString writeStr(attribStr);</span>
<a href="#l47.108"></a><span id="l47.108" class="difflineplus">+      nsAutoCString writeStr(attribStr);</span>
<a href="#l47.109"></a><span id="l47.109">       writeStr.AppendLiteral(&quot;=\&quot;&quot;);</span>
<a href="#l47.110"></a><span id="l47.110">       writeStr.Append((escapedStr) ? escapedStr : aStr);</span>
<a href="#l47.111"></a><span id="l47.111">       writeStr.AppendLiteral(&quot;\&quot;&quot; MSG_LINEBREAK);</span>
<a href="#l47.112"></a><span id="l47.112">       rv = aStream-&gt;Write(writeStr.get(), writeStr.Length(), &amp;bytesWritten);</span>
<a href="#l47.113"></a><span id="l47.113">     }</span>
<a href="#l47.114"></a><span id="l47.114">     PR_Free(escapedStr);</span>
<a href="#l47.115"></a><span id="l47.115">   }</span>
<a href="#l47.116"></a><span id="l47.116">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -617,17 +617,17 @@ nsresult nsMsgFilterAfterTheFact::ApplyF</span>
<a href="#l48.4"></a><span id="l48.4">         {</span>
<a href="#l48.5"></a><span id="l48.5">             nsCString keyword;</span>
<a href="#l48.6"></a><span id="l48.6">             filterAction-&gt;GetStrValue(keyword);</span>
<a href="#l48.7"></a><span id="l48.7">             m_curFolder-&gt;AddKeywordsToMessages(m_searchHitHdrs, keyword);</span>
<a href="#l48.8"></a><span id="l48.8">         }</span>
<a href="#l48.9"></a><span id="l48.9">         break;</span>
<a href="#l48.10"></a><span id="l48.10">       case nsMsgFilterAction::JunkScore:</span>
<a href="#l48.11"></a><span id="l48.11">       {</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-        nsCAutoString junkScoreStr;</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+        nsAutoCString junkScoreStr;</span>
<a href="#l48.14"></a><span id="l48.14">         int32_t junkScore;</span>
<a href="#l48.15"></a><span id="l48.15">         filterAction-&gt;GetJunkScore(&amp;junkScore);</span>
<a href="#l48.16"></a><span id="l48.16">         junkScoreStr.AppendInt(junkScore);</span>
<a href="#l48.17"></a><span id="l48.17">         m_curFolder-&gt;SetJunkScoreForMessages(m_searchHitHdrs, junkScoreStr);</span>
<a href="#l48.18"></a><span id="l48.18">         break;</span>
<a href="#l48.19"></a><span id="l48.19">       }</span>
<a href="#l48.20"></a><span id="l48.20">       case nsMsgFilterAction::Forward:</span>
<a href="#l48.21"></a><span id="l48.21">         {</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineat">@@ -746,17 +746,17 @@ nsresult nsMsgFilterAfterTheFact::ApplyF</span>
<a href="#l48.23"></a><span id="l48.23">       case nsMsgFilterAction::Custom:</span>
<a href="#l48.24"></a><span id="l48.24">       {</span>
<a href="#l48.25"></a><span id="l48.25">         nsMsgFilterTypeType filterType;</span>
<a href="#l48.26"></a><span id="l48.26">         m_curFilter-&gt;GetFilterType(&amp;filterType);</span>
<a href="#l48.27"></a><span id="l48.27">         nsCOMPtr&lt;nsIMsgFilterCustomAction&gt; customAction;</span>
<a href="#l48.28"></a><span id="l48.28">         rv = filterAction-&gt;GetCustomAction(getter_AddRefs(customAction));</span>
<a href="#l48.29"></a><span id="l48.29">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l48.30"></a><span id="l48.30"> </span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-        nsCAutoString value;</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+        nsAutoCString value;</span>
<a href="#l48.33"></a><span id="l48.33">         filterAction-&gt;GetStrValue(value);</span>
<a href="#l48.34"></a><span id="l48.34">         customAction-&gt;Apply(m_searchHitHdrs, value, this,</span>
<a href="#l48.35"></a><span id="l48.35">                             filterType, m_msgWindow);</span>
<a href="#l48.36"></a><span id="l48.36"> </span>
<a href="#l48.37"></a><span id="l48.37">         bool isAsync = false;</span>
<a href="#l48.38"></a><span id="l48.38">         customAction-&gt;GetIsAsync(&amp;isAsync);</span>
<a href="#l48.39"></a><span id="l48.39">         if (isAsync)</span>
<a href="#l48.40"></a><span id="l48.40">           return NS_OK;</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineat">@@ -815,17 +815,17 @@ NS_IMETHODIMP nsMsgFilterService::GetCus</span>
<a href="#l48.42"></a><span id="l48.42"> NS_IMETHODIMP</span>
<a href="#l48.43"></a><span id="l48.43"> nsMsgFilterService::GetCustomAction(const nsACString &amp; aId,</span>
<a href="#l48.44"></a><span id="l48.44">                                     nsIMsgFilterCustomAction** aResult)</span>
<a href="#l48.45"></a><span id="l48.45"> {</span>
<a href="#l48.46"></a><span id="l48.46">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l48.47"></a><span id="l48.47"> </span>
<a href="#l48.48"></a><span id="l48.48">   for (int32_t i = 0; i &lt; mCustomActions.Count(); i++)</span>
<a href="#l48.49"></a><span id="l48.49">   {</span>
<a href="#l48.50"></a><span id="l48.50" class="difflineminus">-    nsCAutoString id;</span>
<a href="#l48.51"></a><span id="l48.51" class="difflineplus">+    nsAutoCString id;</span>
<a href="#l48.52"></a><span id="l48.52">     nsresult rv = mCustomActions[i]-&gt;GetId(id);</span>
<a href="#l48.53"></a><span id="l48.53">     if (NS_SUCCEEDED(rv) &amp;&amp; aId.Equals(id))</span>
<a href="#l48.54"></a><span id="l48.54">     {</span>
<a href="#l48.55"></a><span id="l48.55">       NS_ADDREF(*aResult = mCustomActions[i]);</span>
<a href="#l48.56"></a><span id="l48.56">       return NS_OK;</span>
<a href="#l48.57"></a><span id="l48.57">     }</span>
<a href="#l48.58"></a><span id="l48.58">   }</span>
<a href="#l48.59"></a><span id="l48.59">   aResult = nullptr;</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineat">@@ -848,17 +848,17 @@ NS_IMETHODIMP nsMsgFilterService::GetCus</span>
<a href="#l48.61"></a><span id="l48.61"> NS_IMETHODIMP</span>
<a href="#l48.62"></a><span id="l48.62"> nsMsgFilterService::GetCustomTerm(const nsACString&amp; aId,</span>
<a href="#l48.63"></a><span id="l48.63">                                     nsIMsgSearchCustomTerm** aResult)</span>
<a href="#l48.64"></a><span id="l48.64"> {</span>
<a href="#l48.65"></a><span id="l48.65">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l48.66"></a><span id="l48.66"> </span>
<a href="#l48.67"></a><span id="l48.67">   for (int32_t i = 0; i &lt; mCustomTerms.Count(); i++)</span>
<a href="#l48.68"></a><span id="l48.68">   {</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineminus">-    nsCAutoString id;</span>
<a href="#l48.70"></a><span id="l48.70" class="difflineplus">+    nsAutoCString id;</span>
<a href="#l48.71"></a><span id="l48.71">     nsresult rv = mCustomTerms[i]-&gt;GetId(id);</span>
<a href="#l48.72"></a><span id="l48.72">     if (NS_SUCCEEDED(rv) &amp;&amp; aId.Equals(id))</span>
<a href="#l48.73"></a><span id="l48.73">     {</span>
<a href="#l48.74"></a><span id="l48.74">       NS_ADDREF(*aResult = mCustomTerms[i]);</span>
<a href="#l48.75"></a><span id="l48.75">       return NS_OK;</span>
<a href="#l48.76"></a><span id="l48.76">     }</span>
<a href="#l48.77"></a><span id="l48.77">   }</span>
<a href="#l48.78"></a><span id="l48.78">   aResult = nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -294,17 +294,17 @@ nsresult nsMsgSearchAdapter::EncodeImapT</span>
<a href="#l49.4"></a><span id="l49.4"> {</span>
<a href="#l49.5"></a><span id="l49.5">   NS_ENSURE_ARG_POINTER(term);</span>
<a href="#l49.6"></a><span id="l49.6">   NS_ENSURE_ARG_POINTER(ppOutTerm);</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8">   nsresult err = NS_OK;</span>
<a href="#l49.9"></a><span id="l49.9">   bool useNot = false;</span>
<a href="#l49.10"></a><span id="l49.10">   bool useQuotes = false;</span>
<a href="#l49.11"></a><span id="l49.11">   bool ignoreValue = false;</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  nsCAutoString arbitraryHeader;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  nsAutoCString arbitraryHeader;</span>
<a href="#l49.14"></a><span id="l49.14">   const char *whichMnemonic = nullptr;</span>
<a href="#l49.15"></a><span id="l49.15">   const char *orHeaderMnemonic = nullptr;</span>
<a href="#l49.16"></a><span id="l49.16"> </span>
<a href="#l49.17"></a><span id="l49.17">   *ppOutTerm = nullptr;</span>
<a href="#l49.18"></a><span id="l49.18"> </span>
<a href="#l49.19"></a><span id="l49.19">   nsCOMPtr &lt;nsIMsgSearchValue&gt; searchValue;</span>
<a href="#l49.20"></a><span id="l49.20">   nsresult rv = term-&gt;GetValue(getter_AddRefs(searchValue));</span>
<a href="#l49.21"></a><span id="l49.21"> </span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -498,17 +498,17 @@ nsresult nsMsgSearchAdapter::EncodeImapT</span>
<a href="#l49.23"></a><span id="l49.23">         PR_ExplodeTime(matchDay, PR_LocalTimeParameters, &amp;exploded);</span>
<a href="#l49.24"></a><span id="l49.24">         PR_FormatTimeUSEnglish(dateBuf, sizeof(dateBuf), &quot;%d-%b-%Y&quot;, &amp;exploded);</span>
<a href="#l49.25"></a><span id="l49.25">         //      strftime (dateBuf, sizeof(dateBuf), &quot;%d-%b-%Y&quot;, localtime (&amp;matchDay));</span>
<a href="#l49.26"></a><span id="l49.26">         value = dateBuf;</span>
<a href="#l49.27"></a><span id="l49.27">       }</span>
<a href="#l49.28"></a><span id="l49.28">       else if (attrib == nsMsgSearchAttrib::Size)</span>
<a href="#l49.29"></a><span id="l49.29">       {</span>
<a href="#l49.30"></a><span id="l49.30">         uint32_t sizeValue;</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-        nsCAutoString searchTermValue;</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+        nsAutoCString searchTermValue;</span>
<a href="#l49.33"></a><span id="l49.33">         searchValue-&gt;GetSize(&amp;sizeValue);</span>
<a href="#l49.34"></a><span id="l49.34"> </span>
<a href="#l49.35"></a><span id="l49.35">         // Multiply by 1024 to get into kb resolution</span>
<a href="#l49.36"></a><span id="l49.36">         sizeValue *= 1024;</span>
<a href="#l49.37"></a><span id="l49.37"> </span>
<a href="#l49.38"></a><span id="l49.38">         // Ensure that greater than is really greater than</span>
<a href="#l49.39"></a><span id="l49.39">         // in kb resolution.</span>
<a href="#l49.40"></a><span id="l49.40">         if (op == nsMsgSearchOp::IsGreaterThan)</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineat">@@ -538,17 +538,17 @@ nsresult nsMsgSearchAdapter::EncodeImapT</span>
<a href="#l49.42"></a><span id="l49.42"> </span>
<a href="#l49.43"></a><span id="l49.43">         // do all sorts of crazy escaping</span>
<a href="#l49.44"></a><span id="l49.44">         convertedValue = reallyDredd ? EscapeSearchUrl (searchTermValue.get()) :</span>
<a href="#l49.45"></a><span id="l49.45">         EscapeImapSearchProtocol(searchTermValue.get());</span>
<a href="#l49.46"></a><span id="l49.46">         useQuotes = ((!reallyDredd ||</span>
<a href="#l49.47"></a><span id="l49.47">                     (nsDependentString(convertedValue).FindChar(PRUnichar(' ')) != -1)) &amp;&amp;</span>
<a href="#l49.48"></a><span id="l49.48">            (attrib != nsMsgSearchAttrib::Keywords));</span>
<a href="#l49.49"></a><span id="l49.49">         // now convert to char* and escape quoted_specials</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineminus">-        nsCAutoString valueStr;</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineplus">+        nsAutoCString valueStr;</span>
<a href="#l49.52"></a><span id="l49.52">         nsresult rv = ConvertFromUnicode(NS_LossyConvertUTF16toASCII(destCharset).get(),</span>
<a href="#l49.53"></a><span id="l49.53">           nsDependentString(convertedValue), valueStr);</span>
<a href="#l49.54"></a><span id="l49.54">         if (NS_SUCCEEDED(rv))</span>
<a href="#l49.55"></a><span id="l49.55">         {</span>
<a href="#l49.56"></a><span id="l49.56">           const char *vptr = valueStr.get();</span>
<a href="#l49.57"></a><span id="l49.57">           // max escaped length is one extra character for every character in the cmd.</span>
<a href="#l49.58"></a><span id="l49.58">           nsAutoArrayPtr&lt;char&gt; newValue(new char[2*strlen(vptr) + 1]);</span>
<a href="#l49.59"></a><span id="l49.59">           if (newValue)</span>
<a href="#l49.60"></a><span id="l49.60" class="difflineat">@@ -633,17 +633,17 @@ nsresult nsMsgSearchAdapter::EncodeImapV</span>
<a href="#l49.61"></a><span id="l49.61">   {</span>
<a href="#l49.62"></a><span id="l49.62">     // By IMAP RFC, SEARCH HEADER SUBJECT &quot;&quot; is illegal and will generate an error from the server</span>
<a href="#l49.63"></a><span id="l49.63">     if (!value || !value[0])</span>
<a href="#l49.64"></a><span id="l49.64">       return NS_ERROR_NULL_POINTER;</span>
<a href="#l49.65"></a><span id="l49.65">   }</span>
<a href="#l49.66"></a><span id="l49.66"> </span>
<a href="#l49.67"></a><span id="l49.67">   if (!NS_IsAscii(value))</span>
<a href="#l49.68"></a><span id="l49.68">   {</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineminus">-    nsCAutoString lengthStr;</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineplus">+    nsAutoCString lengthStr;</span>
<a href="#l49.71"></a><span id="l49.71">     PL_strcat(encoding, &quot;{&quot;);</span>
<a href="#l49.72"></a><span id="l49.72">     lengthStr.AppendInt((int32_t) strlen(value));</span>
<a href="#l49.73"></a><span id="l49.73">     PL_strcat(encoding, lengthStr.get());</span>
<a href="#l49.74"></a><span id="l49.74">     PL_strcat(encoding, &quot;}&quot; CRLF);</span>
<a href="#l49.75"></a><span id="l49.75">     PL_strcat(encoding, value);</span>
<a href="#l49.76"></a><span id="l49.76">     return NS_OK;</span>
<a href="#l49.77"></a><span id="l49.77">   }</span>
<a href="#l49.78"></a><span id="l49.78">   if (useQuotes)</span>
<a href="#l49.79"></a><span id="l49.79" class="difflineat">@@ -689,17 +689,17 @@ nsresult nsMsgSearchAdapter::EncodeImap </span>
<a href="#l49.80"></a><span id="l49.80">       expression = nsMsgSearchBoolExpression::AddSearchTerm(expression, pTerm, termEncoding);</span>
<a href="#l49.81"></a><span id="l49.81">       delete [] termEncoding;</span>
<a href="#l49.82"></a><span id="l49.82">     }</span>
<a href="#l49.83"></a><span id="l49.83">   }</span>
<a href="#l49.84"></a><span id="l49.84"> </span>
<a href="#l49.85"></a><span id="l49.85">   if (NS_SUCCEEDED(err))</span>
<a href="#l49.86"></a><span id="l49.86">   {</span>
<a href="#l49.87"></a><span id="l49.87">     // Catenate the intermediate encodings together into a big string</span>
<a href="#l49.88"></a><span id="l49.88" class="difflineminus">-    nsCAutoString encodingBuff;</span>
<a href="#l49.89"></a><span id="l49.89" class="difflineplus">+    nsAutoCString encodingBuff;</span>
<a href="#l49.90"></a><span id="l49.90"> </span>
<a href="#l49.91"></a><span id="l49.91">     if (!reallyDredd)</span>
<a href="#l49.92"></a><span id="l49.92">       encodingBuff.Append(m_kImapUnDeleted);</span>
<a href="#l49.93"></a><span id="l49.93"> </span>
<a href="#l49.94"></a><span id="l49.94">     expression-&gt;GenerateEncodeStr(&amp;encodingBuff);</span>
<a href="#l49.95"></a><span id="l49.95">     *ppOutEncoding = ToNewCString(encodingBuff);</span>
<a href="#l49.96"></a><span id="l49.96">   }</span>
<a href="#l49.97"></a><span id="l49.97"> </span>
<a href="#l49.98"></a><span id="l49.98" class="difflineat">@@ -1148,17 +1148,17 @@ nsMsgSearchValidityManager::NewTable(nsI</span>
<a href="#l49.99"></a><span id="l49.99"> </span>
<a href="#l49.100"></a><span id="l49.100"> nsresult</span>
<a href="#l49.101"></a><span id="l49.101"> nsMsgSearchValidityManager::SetOtherHeadersInTable (nsIMsgSearchValidityTable *aTable, const char *customHeaders)</span>
<a href="#l49.102"></a><span id="l49.102"> {</span>
<a href="#l49.103"></a><span id="l49.103">   uint32_t customHeadersLength = strlen(customHeaders);</span>
<a href="#l49.104"></a><span id="l49.104">   uint32_t numHeaders=0;</span>
<a href="#l49.105"></a><span id="l49.105">   if (customHeadersLength)</span>
<a href="#l49.106"></a><span id="l49.106">   {</span>
<a href="#l49.107"></a><span id="l49.107" class="difflineminus">-    nsCAutoString hdrStr(customHeaders);</span>
<a href="#l49.108"></a><span id="l49.108" class="difflineplus">+    nsAutoCString hdrStr(customHeaders);</span>
<a href="#l49.109"></a><span id="l49.109">     hdrStr.StripWhitespace();  //remove whitespace before parsing</span>
<a href="#l49.110"></a><span id="l49.110">     char *newStr = hdrStr.BeginWriting();</span>
<a href="#l49.111"></a><span id="l49.111">     char *token = NS_strtok(&quot;:&quot;, &amp;newStr);</span>
<a href="#l49.112"></a><span id="l49.112">     while(token)</span>
<a href="#l49.113"></a><span id="l49.113">     {</span>
<a href="#l49.114"></a><span id="l49.114">       numHeaders++;</span>
<a href="#l49.115"></a><span id="l49.115">       token = NS_strtok(&quot;:&quot;, &amp;newStr);</span>
<a href="#l49.116"></a><span id="l49.116">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -195,17 +195,17 @@ char *nsMsgSearchNews::EncodeTerm (nsIMs</span>
<a href="#l50.4"></a><span id="l50.4">     return nullptr;</span>
<a href="#l50.5"></a><span id="l50.5"> </span>
<a href="#l50.6"></a><span id="l50.6">   char *pattern = new char [NS_strlen(urlEncoded) + overhead];</span>
<a href="#l50.7"></a><span id="l50.7">   if (!pattern)</span>
<a href="#l50.8"></a><span id="l50.8">     return nullptr;</span>
<a href="#l50.9"></a><span id="l50.9">   else</span>
<a href="#l50.10"></a><span id="l50.10">     pattern[0] = '\0';</span>
<a href="#l50.11"></a><span id="l50.11"> #else</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    nsCAutoString pattern;</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    nsAutoCString pattern;</span>
<a href="#l50.14"></a><span id="l50.14"> #endif</span>
<a href="#l50.15"></a><span id="l50.15"> </span>
<a href="#l50.16"></a><span id="l50.16"> </span>
<a href="#l50.17"></a><span id="l50.17">   if (leadingStar)</span>
<a href="#l50.18"></a><span id="l50.18">       pattern.Append('*');</span>
<a href="#l50.19"></a><span id="l50.19">     pattern.Append(NS_ConvertUTF16toUTF8(escapedValue));</span>
<a href="#l50.20"></a><span id="l50.20">   if (trailingStar)</span>
<a href="#l50.21"></a><span id="l50.21">       pattern.Append('*');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -145,17 +145,17 @@ nsresult NS_MsgGetAttributeFromString(co</span>
<a href="#l51.4"></a><span id="l51.4">     rv = prefService-&gt;GetBranch(nullptr, getter_AddRefs(prefBranch));</span>
<a href="#l51.5"></a><span id="l51.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.6"></a><span id="l51.6"> </span>
<a href="#l51.7"></a><span id="l51.7">     nsCString headers;</span>
<a href="#l51.8"></a><span id="l51.8">     prefBranch-&gt;GetCharPref(MAILNEWS_CUSTOM_HEADERS, getter_Copies(headers));</span>
<a href="#l51.9"></a><span id="l51.9"> </span>
<a href="#l51.10"></a><span id="l51.10">     if (!headers.IsEmpty())</span>
<a href="#l51.11"></a><span id="l51.11">     {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-      nsCAutoString hdrStr(headers);</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+      nsAutoCString hdrStr(headers);</span>
<a href="#l51.14"></a><span id="l51.14">       hdrStr.StripWhitespace();  //remove whitespace before parsing</span>
<a href="#l51.15"></a><span id="l51.15"> </span>
<a href="#l51.16"></a><span id="l51.16">       char *newStr= hdrStr.BeginWriting();</span>
<a href="#l51.17"></a><span id="l51.17">       char *token = NS_strtok(&quot;:&quot;, &amp;newStr);</span>
<a href="#l51.18"></a><span id="l51.18">       uint32_t i=0;</span>
<a href="#l51.19"></a><span id="l51.19">       while (token)</span>
<a href="#l51.20"></a><span id="l51.20">       {</span>
<a href="#l51.21"></a><span id="l51.21">         if (PL_strcasecmp(token, string) == 0)</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineat">@@ -481,24 +481,24 @@ nsresult nsMsgSearchTerm::OutputValue(ns</span>
<a href="#l51.23"></a><span id="l51.23">       }</span>
<a href="#l51.24"></a><span id="l51.24">     case nsMsgSearchAttrib::JunkPercent:</span>
<a href="#l51.25"></a><span id="l51.25">       {</span>
<a href="#l51.26"></a><span id="l51.26">         outputStr.AppendInt(m_value.u.junkPercent);</span>
<a href="#l51.27"></a><span id="l51.27">         break;</span>
<a href="#l51.28"></a><span id="l51.28">       }</span>
<a href="#l51.29"></a><span id="l51.29">     case nsMsgSearchAttrib::MsgStatus:</span>
<a href="#l51.30"></a><span id="l51.30">       {</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-        nsCAutoString status;</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineplus">+        nsAutoCString status;</span>
<a href="#l51.33"></a><span id="l51.33">         NS_MsgGetUntranslatedStatusName (m_value.u.msgStatus, &amp;status);</span>
<a href="#l51.34"></a><span id="l51.34">         outputStr += status;</span>
<a href="#l51.35"></a><span id="l51.35">         break;</span>
<a href="#l51.36"></a><span id="l51.36">       }</span>
<a href="#l51.37"></a><span id="l51.37">     case nsMsgSearchAttrib::Priority:</span>
<a href="#l51.38"></a><span id="l51.38">       {</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineminus">-        nsCAutoString priority;</span>
<a href="#l51.40"></a><span id="l51.40" class="difflineplus">+        nsAutoCString priority;</span>
<a href="#l51.41"></a><span id="l51.41">         NS_MsgGetUntranslatedPriorityName(m_value.u.priority, priority);</span>
<a href="#l51.42"></a><span id="l51.42">         outputStr += priority;</span>
<a href="#l51.43"></a><span id="l51.43">         break;</span>
<a href="#l51.44"></a><span id="l51.44">       }</span>
<a href="#l51.45"></a><span id="l51.45">     case nsMsgSearchAttrib::HasAttachmentStatus:</span>
<a href="#l51.46"></a><span id="l51.46">       {</span>
<a href="#l51.47"></a><span id="l51.47">         outputStr.Append(&quot;true&quot;);  // don't need anything here, really</span>
<a href="#l51.48"></a><span id="l51.48">         break;</span>
<a href="#l51.49"></a><span id="l51.49" class="difflineat">@@ -519,17 +519,17 @@ nsresult nsMsgSearchTerm::OutputValue(ns</span>
<a href="#l51.50"></a><span id="l51.50">     }</span>
<a href="#l51.51"></a><span id="l51.51">   }</span>
<a href="#l51.52"></a><span id="l51.52">   return NS_OK;</span>
<a href="#l51.53"></a><span id="l51.53"> }</span>
<a href="#l51.54"></a><span id="l51.54"> </span>
<a href="#l51.55"></a><span id="l51.55"> NS_IMETHODIMP nsMsgSearchTerm::GetTermAsString (nsACString &amp;outStream)</span>
<a href="#l51.56"></a><span id="l51.56"> {</span>
<a href="#l51.57"></a><span id="l51.57">   const char *operatorStr;</span>
<a href="#l51.58"></a><span id="l51.58" class="difflineminus">-  nsCAutoString  outputStr;</span>
<a href="#l51.59"></a><span id="l51.59" class="difflineplus">+  nsAutoCString  outputStr;</span>
<a href="#l51.60"></a><span id="l51.60">   nsresult  ret;</span>
<a href="#l51.61"></a><span id="l51.61"> </span>
<a href="#l51.62"></a><span id="l51.62">   if (m_matchAll)</span>
<a href="#l51.63"></a><span id="l51.63">   {</span>
<a href="#l51.64"></a><span id="l51.64">     outStream = &quot;ALL&quot;;</span>
<a href="#l51.65"></a><span id="l51.65">     return NS_OK;</span>
<a href="#l51.66"></a><span id="l51.66">   }</span>
<a href="#l51.67"></a><span id="l51.67"> </span>
<a href="#l51.68"></a><span id="l51.68" class="difflineat">@@ -673,17 +673,17 @@ nsMsgSearchTerm::ParseAttribute(char *in</span>
<a href="#l51.69"></a><span id="l51.69">     // arbitrary headers are quoted. Skip first character, which will be the</span>
<a href="#l51.70"></a><span id="l51.70">     // first quote for arbitrary headers</span>
<a href="#l51.71"></a><span id="l51.71">     char *separator = strchr(inStream + 1, quoteVal ? '&quot;' : ',');</span>
<a href="#l51.72"></a><span id="l51.72"> </span>
<a href="#l51.73"></a><span id="l51.73">     if (separator)</span>
<a href="#l51.74"></a><span id="l51.74">         *separator = '\0';</span>
<a href="#l51.75"></a><span id="l51.75"> </span>
<a href="#l51.76"></a><span id="l51.76">     int16_t attributeVal;</span>
<a href="#l51.77"></a><span id="l51.77" class="difflineminus">-    nsCAutoString customId;</span>
<a href="#l51.78"></a><span id="l51.78" class="difflineplus">+    nsAutoCString customId;</span>
<a href="#l51.79"></a><span id="l51.79">     nsresult rv = NS_MsgGetAttributeFromString(inStream, &amp;attributeVal, m_customId);</span>
<a href="#l51.80"></a><span id="l51.80">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.81"></a><span id="l51.81"> </span>
<a href="#l51.82"></a><span id="l51.82">     *attrib = (nsMsgSearchAttribValue) attributeVal;</span>
<a href="#l51.83"></a><span id="l51.83"> </span>
<a href="#l51.84"></a><span id="l51.84">     if (*attrib &gt; nsMsgSearchAttrib::OtherHeader &amp;&amp; *attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes)  // if we are dealing with an arbitrary header....</span>
<a href="#l51.85"></a><span id="l51.85">     {</span>
<a href="#l51.86"></a><span id="l51.86">       m_arbitraryHeader = inStream + 1; // remove the leading quote</span>
<a href="#l51.87"></a><span id="l51.87" class="difflineat">@@ -714,17 +714,17 @@ nsresult nsMsgSearchTerm::DeStreamNew (c</span>
<a href="#l51.88"></a><span id="l51.88">   if (commaSep)</span>
<a href="#l51.89"></a><span id="l51.89">     rv = ParseOperator(commaSep + 1, &amp;m_operator);</span>
<a href="#l51.90"></a><span id="l51.90">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.91"></a><span id="l51.91">   // convert label filters and saved searches to keyword equivalents</span>
<a href="#l51.92"></a><span id="l51.92">   if (secondCommaSep)</span>
<a href="#l51.93"></a><span id="l51.93">     ParseValue(secondCommaSep + 1);</span>
<a href="#l51.94"></a><span id="l51.94">   if (m_attribute == nsMsgSearchAttrib::Label)</span>
<a href="#l51.95"></a><span id="l51.95">   {</span>
<a href="#l51.96"></a><span id="l51.96" class="difflineminus">-    nsCAutoString keyword(&quot;$label&quot;);</span>
<a href="#l51.97"></a><span id="l51.97" class="difflineplus">+    nsAutoCString keyword(&quot;$label&quot;);</span>
<a href="#l51.98"></a><span id="l51.98">     m_value.attribute = m_attribute = nsMsgSearchAttrib::Keywords;</span>
<a href="#l51.99"></a><span id="l51.99">     keyword.Append('0' + m_value.u.label);</span>
<a href="#l51.100"></a><span id="l51.100">     m_value.string = PL_strdup(keyword.get());</span>
<a href="#l51.101"></a><span id="l51.101">   }</span>
<a href="#l51.102"></a><span id="l51.102">   return NS_OK;</span>
<a href="#l51.103"></a><span id="l51.103"> }</span>
<a href="#l51.104"></a><span id="l51.104"> </span>
<a href="#l51.105"></a><span id="l51.105"> </span>
<a href="#l51.106"></a><span id="l51.106" class="difflineat">@@ -761,18 +761,18 @@ nsresult nsMsgSearchTerm::MatchArbitrary</span>
<a href="#l51.107"></a><span id="l51.107">     new nsMsgBodyHandler (scope, length, msg, db, headers, headersSize,</span>
<a href="#l51.108"></a><span id="l51.108">                           ForFiltering);</span>
<a href="#l51.109"></a><span id="l51.109">   if (!bodyHandler)</span>
<a href="#l51.110"></a><span id="l51.110">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l51.111"></a><span id="l51.111"> </span>
<a href="#l51.112"></a><span id="l51.112">   bodyHandler-&gt;SetStripHeaders (false);</span>
<a href="#l51.113"></a><span id="l51.113"> </span>
<a href="#l51.114"></a><span id="l51.114">   nsCString headerFullValue; // contains matched header value accumulated over multiple lines.</span>
<a href="#l51.115"></a><span id="l51.115" class="difflineminus">-  nsCAutoString buf;</span>
<a href="#l51.116"></a><span id="l51.116" class="difflineminus">-  nsCAutoString curMsgHeader;</span>
<a href="#l51.117"></a><span id="l51.117" class="difflineplus">+  nsAutoCString buf;</span>
<a href="#l51.118"></a><span id="l51.118" class="difflineplus">+  nsAutoCString curMsgHeader;</span>
<a href="#l51.119"></a><span id="l51.119">   bool searchingHeaders = true;</span>
<a href="#l51.120"></a><span id="l51.120"> </span>
<a href="#l51.121"></a><span id="l51.121">   // We will allow accumulation of received headers;</span>
<a href="#l51.122"></a><span id="l51.122">   bool isReceivedHeader = m_arbitraryHeader.EqualsLiteral(&quot;received&quot;);</span>
<a href="#l51.123"></a><span id="l51.123">   </span>
<a href="#l51.124"></a><span id="l51.124">   while (searchingHeaders)</span>
<a href="#l51.125"></a><span id="l51.125">   {</span>
<a href="#l51.126"></a><span id="l51.126">     if (bodyHandler-&gt;GetNextLine(buf) &lt; 0 || EMPTY_MESSAGE_LINE(buf))</span>
<a href="#l51.127"></a><span id="l51.127" class="difflineat">@@ -915,17 +915,17 @@ nsresult nsMsgSearchTerm::MatchBody (nsI</span>
<a href="#l51.128"></a><span id="l51.128">   // specified &quot;BODY IS foo&quot;. ### Since length is in lines, this is not quite right.</span>
<a href="#l51.129"></a><span id="l51.129">   if ((length &gt; 0) &amp;&amp; (m_operator == nsMsgSearchOp::Is || m_operator == nsMsgSearchOp::Isnt))</span>
<a href="#l51.130"></a><span id="l51.130">     length = PL_strlen (m_value.string);</span>
<a href="#l51.131"></a><span id="l51.131"> </span>
<a href="#l51.132"></a><span id="l51.132">   nsMsgBodyHandler * bodyHan  = new nsMsgBodyHandler (scope, length, msg, db);</span>
<a href="#l51.133"></a><span id="l51.133">   if (!bodyHan)</span>
<a href="#l51.134"></a><span id="l51.134">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l51.135"></a><span id="l51.135"> </span>
<a href="#l51.136"></a><span id="l51.136" class="difflineminus">-  nsCAutoString buf;</span>
<a href="#l51.137"></a><span id="l51.137" class="difflineplus">+  nsAutoCString buf;</span>
<a href="#l51.138"></a><span id="l51.138">   bool endOfFile = false;  // if retValue == 0, we've hit the end of the file</span>
<a href="#l51.139"></a><span id="l51.139">   uint32 lines = 0;</span>
<a href="#l51.140"></a><span id="l51.140"> </span>
<a href="#l51.141"></a><span id="l51.141">   // Change the sense of the loop so we don't bail out prematurely</span>
<a href="#l51.142"></a><span id="l51.142">   // on negative terms. i.e. opDoesntContain must look at all lines</span>
<a href="#l51.143"></a><span id="l51.143">   bool boolContinueLoop;</span>
<a href="#l51.144"></a><span id="l51.144">   GetMatchAllBeforeDeciding(&amp;boolContinueLoop);</span>
<a href="#l51.145"></a><span id="l51.145">   result = boolContinueLoop;</span>
<a href="#l51.146"></a><span id="l51.146" class="difflineat">@@ -1180,18 +1180,18 @@ NS_IMETHODIMP nsMsgSearchTerm::GetMatchA</span>
<a href="#l51.147"></a><span id="l51.147"> </span>
<a href="#l51.148"></a><span id="l51.148">    if (NS_SUCCEEDED(parseErr) &amp;&amp; count &gt; 0)</span>
<a href="#l51.149"></a><span id="l51.149">    {</span>
<a href="#l51.150"></a><span id="l51.150">      NS_ASSERTION(names, &quot;couldn't get names&quot;);</span>
<a href="#l51.151"></a><span id="l51.151">      NS_ASSERTION(addresses, &quot;couldn't get addresses&quot;);</span>
<a href="#l51.152"></a><span id="l51.152">      if (!names || !addresses)</span>
<a href="#l51.153"></a><span id="l51.153">        return err;</span>
<a href="#l51.154"></a><span id="l51.154"> </span>
<a href="#l51.155"></a><span id="l51.155" class="difflineminus">-     nsCAutoString walkNames;</span>
<a href="#l51.156"></a><span id="l51.156" class="difflineminus">-     nsCAutoString walkAddresses;</span>
<a href="#l51.157"></a><span id="l51.157" class="difflineplus">+     nsAutoCString walkNames;</span>
<a href="#l51.158"></a><span id="l51.158" class="difflineplus">+     nsAutoCString walkAddresses;</span>
<a href="#l51.159"></a><span id="l51.159">      int32_t namePos = 0;</span>
<a href="#l51.160"></a><span id="l51.160">      int32_t addressPos = 0;</span>
<a href="#l51.161"></a><span id="l51.161">      for (uint32_t i = 0; i &lt; count &amp;&amp; result == boolContinueLoop; i++)</span>
<a href="#l51.162"></a><span id="l51.162">      {</span>
<a href="#l51.163"></a><span id="l51.163">        walkNames = names + namePos;</span>
<a href="#l51.164"></a><span id="l51.164">        walkAddresses = addresses + addressPos;</span>
<a href="#l51.165"></a><span id="l51.165">        if ( m_operator == nsMsgSearchOp::IsInAB ||</span>
<a href="#l51.166"></a><span id="l51.166">             m_operator == nsMsgSearchOp::IsntInAB)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/base/src/MailNewsDLF.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/base/src/MailNewsDLF.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -42,17 +42,17 @@ MailNewsDLF::CreateInstance(const char* </span>
<a href="#l52.4"></a><span id="l52.4"> </span>
<a href="#l52.5"></a><span id="l52.5">   aChannel-&gt;SetContentType(NS_LITERAL_CSTRING(TEXT_HTML));</span>
<a href="#l52.6"></a><span id="l52.6"> </span>
<a href="#l52.7"></a><span id="l52.7">   // Get the HTML category</span>
<a href="#l52.8"></a><span id="l52.8">   nsCOMPtr&lt;nsICategoryManager&gt; catMan(</span>
<a href="#l52.9"></a><span id="l52.9">     do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l52.10"></a><span id="l52.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  nsCAutoString contractID;</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  nsAutoCString contractID;</span>
<a href="#l52.14"></a><span id="l52.14">   rv = catMan-&gt;GetCategoryEntry(&quot;Gecko-Content-Viewers&quot;, TEXT_HTML,</span>
<a href="#l52.15"></a><span id="l52.15">                                 getter_Copies(contractID));</span>
<a href="#l52.16"></a><span id="l52.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.17"></a><span id="l52.17"> </span>
<a href="#l52.18"></a><span id="l52.18">   nsCOMPtr&lt;nsIDocumentLoaderFactory&gt; factory(do_GetService(contractID.get(),</span>
<a href="#l52.19"></a><span id="l52.19">                                              &amp;rv));</span>
<a href="#l52.20"></a><span id="l52.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.21"></a><span id="l52.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -601,17 +601,17 @@ nsMessenger::DetachAttachmentsWOPrompts(</span>
<a href="#l53.4"></a><span id="l53.4">   NS_ENSURE_ARG_POINTER(aDisplayNameArray);</span>
<a href="#l53.5"></a><span id="l53.5">   if (!aCount)</span>
<a href="#l53.6"></a><span id="l53.6">     return NS_OK;</span>
<a href="#l53.7"></a><span id="l53.7">   nsSaveAllAttachmentsState *saveState;</span>
<a href="#l53.8"></a><span id="l53.8">   nsCOMPtr&lt;nsIFile&gt; attachmentDestination;</span>
<a href="#l53.9"></a><span id="l53.9">   nsresult rv = aDestFolder-&gt;Clone(getter_AddRefs(attachmentDestination));</span>
<a href="#l53.10"></a><span id="l53.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l53.11"></a><span id="l53.11"> </span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l53.14"></a><span id="l53.14">   rv = attachmentDestination-&gt;GetNativePath(path);</span>
<a href="#l53.15"></a><span id="l53.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l53.16"></a><span id="l53.16"> </span>
<a href="#l53.17"></a><span id="l53.17">   nsAutoString unescapedFileName;</span>
<a href="#l53.18"></a><span id="l53.18">   ConvertAndSanitizeFileName(aDisplayNameArray[0], unescapedFileName);</span>
<a href="#l53.19"></a><span id="l53.19">   rv = attachmentDestination-&gt;Append(unescapedFileName);</span>
<a href="#l53.20"></a><span id="l53.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l53.21"></a><span id="l53.21">   rv = attachmentDestination-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, ATTACHMENT_PERMISSION);</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -641,36 +641,36 @@ nsresult nsMessenger::SaveAttachment(nsI</span>
<a href="#l53.23"></a><span id="l53.23">                                      const nsACString &amp;aMessageUri,</span>
<a href="#l53.24"></a><span id="l53.24">                                      const nsACString &amp;aContentType,</span>
<a href="#l53.25"></a><span id="l53.25">                                      void *closure,</span>
<a href="#l53.26"></a><span id="l53.26">                                      nsIUrlListener *aListener)</span>
<a href="#l53.27"></a><span id="l53.27"> {</span>
<a href="#l53.28"></a><span id="l53.28">   nsCOMPtr&lt;nsIMsgMessageService&gt; messageService;</span>
<a href="#l53.29"></a><span id="l53.29">   nsSaveAllAttachmentsState *saveState= (nsSaveAllAttachmentsState*) closure;</span>
<a href="#l53.30"></a><span id="l53.30">   nsCOMPtr&lt;nsIMsgMessageFetchPartService&gt; fetchService;</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-  nsCAutoString urlString;</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineplus">+  nsAutoCString urlString;</span>
<a href="#l53.33"></a><span id="l53.33">   nsCOMPtr&lt;nsIURI&gt; URL;</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-  nsCAutoString fullMessageUri(aMessageUri);</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineplus">+  nsAutoCString fullMessageUri(aMessageUri);</span>
<a href="#l53.36"></a><span id="l53.36"> </span>
<a href="#l53.37"></a><span id="l53.37">   // This instance will be held onto by the listeners, and will be released once </span>
<a href="#l53.38"></a><span id="l53.38">   // the transfer has been completed.</span>
<a href="#l53.39"></a><span id="l53.39">   nsRefPtr&lt;nsSaveMsgListener&gt; saveListener(new nsSaveMsgListener(aFile, this, aListener));</span>
<a href="#l53.40"></a><span id="l53.40">   if (!saveListener)</span>
<a href="#l53.41"></a><span id="l53.41">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l53.42"></a><span id="l53.42"> </span>
<a href="#l53.43"></a><span id="l53.43">   saveListener-&gt;m_contentType = aContentType;</span>
<a href="#l53.44"></a><span id="l53.44">   if (saveState)</span>
<a href="#l53.45"></a><span id="l53.45">   {</span>
<a href="#l53.46"></a><span id="l53.46">     saveListener-&gt;m_saveAllAttachmentsState = saveState;</span>
<a href="#l53.47"></a><span id="l53.47">     if (saveState-&gt;m_detachingAttachments)</span>
<a href="#l53.48"></a><span id="l53.48">     {</span>
<a href="#l53.49"></a><span id="l53.49">       nsCOMPtr&lt;nsIURI&gt; outputURI;</span>
<a href="#l53.50"></a><span id="l53.50">       nsresult rv = NS_NewFileURI(getter_AddRefs(outputURI), aFile);</span>
<a href="#l53.51"></a><span id="l53.51">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l53.52"></a><span id="l53.52" class="difflineminus">-      nsCAutoString fileUriSpec;</span>
<a href="#l53.53"></a><span id="l53.53" class="difflineplus">+      nsAutoCString fileUriSpec;</span>
<a href="#l53.54"></a><span id="l53.54">       outputURI-&gt;GetSpec(fileUriSpec);</span>
<a href="#l53.55"></a><span id="l53.55">       saveState-&gt;m_savedFiles.AppendElement(fileUriSpec);</span>
<a href="#l53.56"></a><span id="l53.56">     }</span>
<a href="#l53.57"></a><span id="l53.57">   }</span>
<a href="#l53.58"></a><span id="l53.58"> </span>
<a href="#l53.59"></a><span id="l53.59">   urlString = aURL;</span>
<a href="#l53.60"></a><span id="l53.60">   // strip out ?type=application/x-message-display because it confuses libmime</span>
<a href="#l53.61"></a><span id="l53.61"> </span>
<a href="#l53.62"></a><span id="l53.62" class="difflineat">@@ -996,17 +996,17 @@ nsMessenger::SaveAs(const nsACString&amp; aU</span>
<a href="#l53.63"></a><span id="l53.63">     if (saveAsFileType == EML_FILE_TYPE)</span>
<a href="#l53.64"></a><span id="l53.64">     {</span>
<a href="#l53.65"></a><span id="l53.65">       rv = messageService-&gt;SaveMessageToDisk(PromiseFlatCString(aURI).get(), saveAsFile, false,</span>
<a href="#l53.66"></a><span id="l53.66">         urlListener, nullptr,</span>
<a href="#l53.67"></a><span id="l53.67">         true, mMsgWindow);</span>
<a href="#l53.68"></a><span id="l53.68">     }</span>
<a href="#l53.69"></a><span id="l53.69">     else</span>
<a href="#l53.70"></a><span id="l53.70">     {</span>
<a href="#l53.71"></a><span id="l53.71" class="difflineminus">-      nsCAutoString urlString(aURI);</span>
<a href="#l53.72"></a><span id="l53.72" class="difflineplus">+      nsAutoCString urlString(aURI);</span>
<a href="#l53.73"></a><span id="l53.73"> </span>
<a href="#l53.74"></a><span id="l53.74">       // we can't go RFC822 to TXT until bug #1775 is fixed</span>
<a href="#l53.75"></a><span id="l53.75">       // so until then, do the HTML to TXT conversion in</span>
<a href="#l53.76"></a><span id="l53.76">       // nsSaveMsgListener::OnStopRequest(), see ConvertBufToPlainText()</span>
<a href="#l53.77"></a><span id="l53.77">       //</span>
<a href="#l53.78"></a><span id="l53.78">       // Setup the URL for a &quot;Save As...&quot; Operation...</span>
<a href="#l53.79"></a><span id="l53.79">       // For now, if this is a save as TEXT operation, then do</span>
<a href="#l53.80"></a><span id="l53.80">       // a &quot;printing&quot; operation</span>
<a href="#l53.81"></a><span id="l53.81" class="difflineat">@@ -2791,18 +2791,18 @@ nsDelAttachListener::StartProcessing(nsM</span>
<a href="#l53.82"></a><span id="l53.82"> </span>
<a href="#l53.83"></a><span id="l53.83">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(mMsgFileStream), mMsgFile, -1, ATTACHMENT_PERMISSION);</span>
<a href="#l53.84"></a><span id="l53.84"> </span>
<a href="#l53.85"></a><span id="l53.85">   // create the additional header for data conversion. This will tell the stream converter</span>
<a href="#l53.86"></a><span id="l53.86">   // which MIME emitter we want to use, and it will tell the MIME emitter which attachments</span>
<a href="#l53.87"></a><span id="l53.87">   // should be deleted.</span>
<a href="#l53.88"></a><span id="l53.88">   const char * partId;</span>
<a href="#l53.89"></a><span id="l53.89">   const char * nextField;</span>
<a href="#l53.90"></a><span id="l53.90" class="difflineminus">-  nsCAutoString sHeader(&quot;attach&amp;del=&quot;);</span>
<a href="#l53.91"></a><span id="l53.91" class="difflineminus">-  nsCAutoString detachToHeader(&quot;&amp;detachTo=&quot;);</span>
<a href="#l53.92"></a><span id="l53.92" class="difflineplus">+  nsAutoCString sHeader(&quot;attach&amp;del=&quot;);</span>
<a href="#l53.93"></a><span id="l53.93" class="difflineplus">+  nsAutoCString detachToHeader(&quot;&amp;detachTo=&quot;);</span>
<a href="#l53.94"></a><span id="l53.94">   for (uint32_t u = 0; u &lt; mAttach-&gt;mCount; ++u)</span>
<a href="#l53.95"></a><span id="l53.95">   {</span>
<a href="#l53.96"></a><span id="l53.96">     if (u &gt; 0)</span>
<a href="#l53.97"></a><span id="l53.97">     {</span>
<a href="#l53.98"></a><span id="l53.98">       sHeader.Append(&quot;,&quot;);</span>
<a href="#l53.99"></a><span id="l53.99">       if (detaching)</span>
<a href="#l53.100"></a><span id="l53.100">         detachToHeader.Append(&quot;,&quot;);</span>
<a href="#l53.101"></a><span id="l53.101">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -26,17 +26,17 @@ nsMessengerBootstrap::nsMessengerBootstr</span>
<a href="#l54.4"></a><span id="l54.4"> </span>
<a href="#l54.5"></a><span id="l54.5"> nsMessengerBootstrap::~nsMessengerBootstrap()</span>
<a href="#l54.6"></a><span id="l54.6"> {</span>
<a href="#l54.7"></a><span id="l54.7"> }</span>
<a href="#l54.8"></a><span id="l54.8"> </span>
<a href="#l54.9"></a><span id="l54.9"> NS_IMETHODIMP nsMessengerBootstrap::OpenMessengerWindowWithUri(const char *windowType, const char * aFolderURI, nsMsgKey aMessageKey)</span>
<a href="#l54.10"></a><span id="l54.10"> {</span>
<a href="#l54.11"></a><span id="l54.11">   bool standAloneMsgWindow = false;</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  nsCAutoString chromeUrl(&quot;chrome://messenger/content/&quot;);</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+  nsAutoCString chromeUrl(&quot;chrome://messenger/content/&quot;);</span>
<a href="#l54.14"></a><span id="l54.14">   if (windowType &amp;&amp; !strcmp(windowType, &quot;mail:messageWindow&quot;))</span>
<a href="#l54.15"></a><span id="l54.15">   {</span>
<a href="#l54.16"></a><span id="l54.16">     chromeUrl.Append(&quot;messageWindow.xul&quot;);</span>
<a href="#l54.17"></a><span id="l54.17">     standAloneMsgWindow = true;</span>
<a href="#l54.18"></a><span id="l54.18">   }</span>
<a href="#l54.19"></a><span id="l54.19">   nsCOMPtr&lt;nsISupportsArray&gt; argsArray;</span>
<a href="#l54.20"></a><span id="l54.20">   nsresult rv = NS_NewISupportsArray(getter_AddRefs(argsArray));</span>
<a href="#l54.21"></a><span id="l54.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineat">@@ -44,17 +44,17 @@ NS_IMETHODIMP nsMessengerBootstrap::Open</span>
<a href="#l54.23"></a><span id="l54.23">   // create scriptable versions of our strings that we can store in our nsISupportsArray....</span>
<a href="#l54.24"></a><span id="l54.24">   if (aFolderURI)</span>
<a href="#l54.25"></a><span id="l54.25">   {</span>
<a href="#l54.26"></a><span id="l54.26">     if (standAloneMsgWindow)</span>
<a href="#l54.27"></a><span id="l54.27">     {</span>
<a href="#l54.28"></a><span id="l54.28">       nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l54.29"></a><span id="l54.29">       rv = GetExistingFolder(nsDependentCString(aFolderURI), getter_AddRefs(folder));</span>
<a href="#l54.30"></a><span id="l54.30">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-      nsCAutoString msgUri;</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+      nsAutoCString msgUri;</span>
<a href="#l54.33"></a><span id="l54.33">       folder-&gt;GetBaseMessageURI(msgUri);</span>
<a href="#l54.34"></a><span id="l54.34"> </span>
<a href="#l54.35"></a><span id="l54.35">       nsCOMPtr&lt;nsISupportsCString&gt; scriptableMsgURI (do_CreateInstance(NS_SUPPORTS_CSTRING_CONTRACTID));</span>
<a href="#l54.36"></a><span id="l54.36">       NS_ENSURE_TRUE(scriptableMsgURI, NS_ERROR_FAILURE);</span>
<a href="#l54.37"></a><span id="l54.37">       msgUri.Append('#');</span>
<a href="#l54.38"></a><span id="l54.38">       msgUri.AppendInt(aMessageKey, 10);</span>
<a href="#l54.39"></a><span id="l54.39">       scriptableMsgURI-&gt;SetData(msgUri);</span>
<a href="#l54.40"></a><span id="l54.40">       argsArray-&gt;AppendElement(scriptableMsgURI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerContentHandler.cpp</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerContentHandler.cpp</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -45,17 +45,17 @@ NS_IMETHODIMP nsMessengerContentHandler:</span>
<a href="#l55.4"></a><span id="l55.4">     if (aUri)</span>
<a href="#l55.5"></a><span id="l55.5">     {</span>
<a href="#l55.6"></a><span id="l55.6">       rv = request-&gt;Cancel(NS_ERROR_ABORT);</span>
<a href="#l55.7"></a><span id="l55.7">       if (NS_SUCCEEDED(rv))</span>
<a href="#l55.8"></a><span id="l55.8">       {</span>
<a href="#l55.9"></a><span id="l55.9">         nsCOMPtr&lt;nsIURL&gt; aUrl = do_QueryInterface(aUri);</span>
<a href="#l55.10"></a><span id="l55.10">         if (aUrl)</span>
<a href="#l55.11"></a><span id="l55.11">         {</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-          nsCAutoString queryPart;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+          nsAutoCString queryPart;</span>
<a href="#l55.14"></a><span id="l55.14">           aUrl-&gt;GetQuery(queryPart);</span>
<a href="#l55.15"></a><span id="l55.15">           queryPart.Replace(queryPart.Find(&quot;type=message/rfc822&quot;),</span>
<a href="#l55.16"></a><span id="l55.16">                             sizeof(&quot;type=message/rfc822&quot;) - 1,</span>
<a href="#l55.17"></a><span id="l55.17">                             &quot;type=application/x-message-display&quot;);</span>
<a href="#l55.18"></a><span id="l55.18">           aUrl-&gt;SetQuery(queryPart);</span>
<a href="#l55.19"></a><span id="l55.19">           rv = OpenWindow(aUri);</span>
<a href="#l55.20"></a><span id="l55.20">         }</span>
<a href="#l55.21"></a><span id="l55.21">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -42,17 +42,17 @@ nsMsgAccount::getPrefService()</span>
<a href="#l56.4"></a><span id="l56.4">   if (m_prefs)</span>
<a href="#l56.5"></a><span id="l56.5">     return NS_OK;</span>
<a href="#l56.6"></a><span id="l56.6"> </span>
<a href="#l56.7"></a><span id="l56.7">   nsresult rv;</span>
<a href="#l56.8"></a><span id="l56.8">   NS_ENSURE_FALSE(m_accountKey.IsEmpty(), NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l56.9"></a><span id="l56.9">   nsCOMPtr&lt;nsIPrefService&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l56.10"></a><span id="l56.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l56.11"></a><span id="l56.11"> </span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  nsCAutoString accountRoot(&quot;mail.account.&quot;);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+  nsAutoCString accountRoot(&quot;mail.account.&quot;);</span>
<a href="#l56.14"></a><span id="l56.14">   accountRoot.Append(m_accountKey);</span>
<a href="#l56.15"></a><span id="l56.15">   accountRoot.Append('.');</span>
<a href="#l56.16"></a><span id="l56.16">   return prefs-&gt;GetBranch(accountRoot.get(), getter_AddRefs(m_prefs));</span>
<a href="#l56.17"></a><span id="l56.17"> }</span>
<a href="#l56.18"></a><span id="l56.18"> </span>
<a href="#l56.19"></a><span id="l56.19"> NS_IMETHODIMP</span>
<a href="#l56.20"></a><span id="l56.20"> nsMsgAccount::GetIncomingServer(nsIMsgIncomingServer **aIncomingServer)</span>
<a href="#l56.21"></a><span id="l56.21"> {</span>
<a href="#l56.22"></a><span id="l56.22" class="difflineat">@@ -208,17 +208,17 @@ nsMsgAccount::createIdentities()</span>
<a href="#l56.23"></a><span id="l56.23">            do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l56.24"></a><span id="l56.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l56.25"></a><span id="l56.25"> </span>
<a href="#l56.26"></a><span id="l56.26">   char* newStr = identityKey.BeginWriting();</span>
<a href="#l56.27"></a><span id="l56.27">   char* token = NS_strtok(&quot;,&quot;, &amp;newStr);</span>
<a href="#l56.28"></a><span id="l56.28"> </span>
<a href="#l56.29"></a><span id="l56.29">   // temporaries used inside the loop</span>
<a href="#l56.30"></a><span id="l56.30">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity;</span>
<a href="#l56.31"></a><span id="l56.31" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l56.33"></a><span id="l56.33"> </span>
<a href="#l56.34"></a><span id="l56.34">   // iterate through id1,id2, etc</span>
<a href="#l56.35"></a><span id="l56.35">   while (token) {</span>
<a href="#l56.36"></a><span id="l56.36">     key = token;</span>
<a href="#l56.37"></a><span id="l56.37">     key.StripWhitespace();</span>
<a href="#l56.38"></a><span id="l56.38"> </span>
<a href="#l56.39"></a><span id="l56.39">     // create the account</span>
<a href="#l56.40"></a><span id="l56.40">     rv = accountManager-&gt;GetIdentity(key, getter_AddRefs(identity));</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineat">@@ -291,19 +291,19 @@ nsMsgAccount::AddIdentity(nsIMsgIdentity</span>
<a href="#l56.42"></a><span id="l56.42">   // when this is actually implemented, don't refcount the default identity</span>
<a href="#l56.43"></a><span id="l56.43">   nsCString key;</span>
<a href="#l56.44"></a><span id="l56.44">   nsresult rv = identity-&gt;GetKey(key);</span>
<a href="#l56.45"></a><span id="l56.45"> </span>
<a href="#l56.46"></a><span id="l56.46">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l56.47"></a><span id="l56.47">     nsCString identityList;</span>
<a href="#l56.48"></a><span id="l56.48">     m_prefs-&gt;GetCharPref(&quot;identities&quot;, getter_Copies(identityList));</span>
<a href="#l56.49"></a><span id="l56.49"> </span>
<a href="#l56.50"></a><span id="l56.50" class="difflineminus">-    nsCAutoString newIdentityList(identityList);</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineplus">+    nsAutoCString newIdentityList(identityList);</span>
<a href="#l56.52"></a><span id="l56.52"> </span>
<a href="#l56.53"></a><span id="l56.53" class="difflineminus">-    nsCAutoString testKey;      // temporary to strip whitespace</span>
<a href="#l56.54"></a><span id="l56.54" class="difflineplus">+    nsAutoCString testKey;      // temporary to strip whitespace</span>
<a href="#l56.55"></a><span id="l56.55">     bool foundIdentity = false; // if the input identity is found</span>
<a href="#l56.56"></a><span id="l56.56"> </span>
<a href="#l56.57"></a><span id="l56.57">     if (!identityList.IsEmpty()) {</span>
<a href="#l56.58"></a><span id="l56.58">       char *newStr = identityList.BeginWriting();</span>
<a href="#l56.59"></a><span id="l56.59">       char *token = NS_strtok(&quot;,&quot;, &amp;newStr);</span>
<a href="#l56.60"></a><span id="l56.60"> </span>
<a href="#l56.61"></a><span id="l56.61">       // look for the identity key that we're adding</span>
<a href="#l56.62"></a><span id="l56.62">       while (token) {</span>
<a href="#l56.63"></a><span id="l56.63" class="difflineat">@@ -361,17 +361,17 @@ nsMsgAccount::RemoveIdentity(nsIMsgIdent</span>
<a href="#l56.64"></a><span id="l56.64">   // clear out the actual pref values associated with the identity</span>
<a href="#l56.65"></a><span id="l56.65">   aIdentity-&gt;ClearAllValues();</span>
<a href="#l56.66"></a><span id="l56.66"> </span>
<a href="#l56.67"></a><span id="l56.67">   // if we just deleted the default identity, clear it out so we pick a new one</span>
<a href="#l56.68"></a><span id="l56.68">   if (m_defaultIdentity == aIdentity)</span>
<a href="#l56.69"></a><span id="l56.69">     m_defaultIdentity = nullptr;</span>
<a href="#l56.70"></a><span id="l56.70"> </span>
<a href="#l56.71"></a><span id="l56.71">   // now rebuild the identity pref</span>
<a href="#l56.72"></a><span id="l56.72" class="difflineminus">-  nsCAutoString newIdentityList;</span>
<a href="#l56.73"></a><span id="l56.73" class="difflineplus">+  nsAutoCString newIdentityList;</span>
<a href="#l56.74"></a><span id="l56.74"> </span>
<a href="#l56.75"></a><span id="l56.75">   // iterate over the remaining identities</span>
<a href="#l56.76"></a><span id="l56.76">   for (uint32_t index = 0; index &lt; count; index++)</span>
<a href="#l56.77"></a><span id="l56.77">   {</span>
<a href="#l56.78"></a><span id="l56.78">     nsCOMPtr&lt;nsIMsgIdentity&gt; identity = do_QueryElementAt(m_identities, index, &amp;rv);</span>
<a href="#l56.79"></a><span id="l56.79">     if (identity)</span>
<a href="#l56.80"></a><span id="l56.80">     {</span>
<a href="#l56.81"></a><span id="l56.81">       identity-&gt;GetKey(key);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -364,17 +364,17 @@ nsMsgAccountManager::getUniqueAccountKey</span>
<a href="#l57.4"></a><span id="l57.4">       accounts-&gt;EnumerateForwards(findAccountByKey, (void *)&amp;findEntry);</span>
<a href="#l57.5"></a><span id="l57.5">     } while (findEntry.account);</span>
<a href="#l57.6"></a><span id="l57.6">   }</span>
<a href="#l57.7"></a><span id="l57.7"> }</span>
<a href="#l57.8"></a><span id="l57.8"> </span>
<a href="#l57.9"></a><span id="l57.9"> void</span>
<a href="#l57.10"></a><span id="l57.10"> nsMsgAccountManager::GetUniqueServerKey(nsACString&amp; aResult)</span>
<a href="#l57.11"></a><span id="l57.11"> {</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  nsCAutoString prefResult;</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  nsAutoCString prefResult;</span>
<a href="#l57.14"></a><span id="l57.14">   bool usePrefsScan = true;</span>
<a href="#l57.15"></a><span id="l57.15">   nsresult rv;</span>
<a href="#l57.16"></a><span id="l57.16">   nsCOMPtr&lt;nsIPrefService&gt; prefService(do_GetService(NS_PREFSERVICE_CONTRACTID,</span>
<a href="#l57.17"></a><span id="l57.17">                                        &amp;rv));</span>
<a href="#l57.18"></a><span id="l57.18">   if (NS_FAILED(rv))</span>
<a href="#l57.19"></a><span id="l57.19">     usePrefsScan = false;</span>
<a href="#l57.20"></a><span id="l57.20"> </span>
<a href="#l57.21"></a><span id="l57.21">   // Loop over existing pref names mail.server.server(lastKey).type</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineat">@@ -383,51 +383,51 @@ nsMsgAccountManager::GetUniqueServerKey(</span>
<a href="#l57.23"></a><span id="l57.23">   {</span>
<a href="#l57.24"></a><span id="l57.24">     rv = prefService-&gt;GetBranch(PREF_MAIL_SERVER_PREFIX, getter_AddRefs(prefBranchServer));</span>
<a href="#l57.25"></a><span id="l57.25">     if (NS_FAILED(rv))</span>
<a href="#l57.26"></a><span id="l57.26">       usePrefsScan = false;</span>
<a href="#l57.27"></a><span id="l57.27">   }</span>
<a href="#l57.28"></a><span id="l57.28"> </span>
<a href="#l57.29"></a><span id="l57.29">   if (usePrefsScan)</span>
<a href="#l57.30"></a><span id="l57.30">   {</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-    nsCAutoString type;</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineminus">-    nsCAutoString typeKey;</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineplus">+    nsAutoCString type;</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineplus">+    nsAutoCString typeKey;</span>
<a href="#l57.35"></a><span id="l57.35">     for (PRInt32 lastKey = 1; ; lastKey++)</span>
<a href="#l57.36"></a><span id="l57.36">     {</span>
<a href="#l57.37"></a><span id="l57.37">       aResult.AssignLiteral(SERVER_PREFIX);</span>
<a href="#l57.38"></a><span id="l57.38">       aResult.AppendInt(lastKey);</span>
<a href="#l57.39"></a><span id="l57.39">       typeKey.Assign(aResult);</span>
<a href="#l57.40"></a><span id="l57.40">       typeKey.AppendLiteral(&quot;.type&quot;);</span>
<a href="#l57.41"></a><span id="l57.41">       prefBranchServer-&gt;GetCharPref(typeKey.get(), getter_Copies(type));</span>
<a href="#l57.42"></a><span id="l57.42">       if (type.IsEmpty()) // a server slot with no type is considered empty</span>
<a href="#l57.43"></a><span id="l57.43">         return;</span>
<a href="#l57.44"></a><span id="l57.44">     }</span>
<a href="#l57.45"></a><span id="l57.45">   }</span>
<a href="#l57.46"></a><span id="l57.46">   else</span>
<a href="#l57.47"></a><span id="l57.47">   {</span>
<a href="#l57.48"></a><span id="l57.48">     // If pref service fails, try to find a free serverX key</span>
<a href="#l57.49"></a><span id="l57.49">     // by checking which keys exist.</span>
<a href="#l57.50"></a><span id="l57.50" class="difflineminus">-    nsCAutoString internalResult;</span>
<a href="#l57.51"></a><span id="l57.51" class="difflineplus">+    nsAutoCString internalResult;</span>
<a href="#l57.52"></a><span id="l57.52">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l57.53"></a><span id="l57.53">     PRInt32 i = 1;</span>
<a href="#l57.54"></a><span id="l57.54">     do {</span>
<a href="#l57.55"></a><span id="l57.55">       aResult.AssignLiteral(SERVER_PREFIX);</span>
<a href="#l57.56"></a><span id="l57.56">       aResult.AppendInt(i++);</span>
<a href="#l57.57"></a><span id="l57.57">       m_incomingServers.Get(aResult, getter_AddRefs(server));</span>
<a href="#l57.58"></a><span id="l57.58">     } while (server);</span>
<a href="#l57.59"></a><span id="l57.59">     return;</span>
<a href="#l57.60"></a><span id="l57.60">   }</span>
<a href="#l57.61"></a><span id="l57.61"> }</span>
<a href="#l57.62"></a><span id="l57.62"> </span>
<a href="#l57.63"></a><span id="l57.63"> nsresult</span>
<a href="#l57.64"></a><span id="l57.64"> nsMsgAccountManager::CreateIdentity(nsIMsgIdentity **_retval)</span>
<a href="#l57.65"></a><span id="l57.65"> {</span>
<a href="#l57.66"></a><span id="l57.66">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l57.67"></a><span id="l57.67">   nsresult rv;</span>
<a href="#l57.68"></a><span id="l57.68" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l57.69"></a><span id="l57.69" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l57.70"></a><span id="l57.70">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity;</span>
<a href="#l57.71"></a><span id="l57.71">   int32_t i = 1;</span>
<a href="#l57.72"></a><span id="l57.72">   do {</span>
<a href="#l57.73"></a><span id="l57.73">     key.AssignLiteral(ID_PREFIX);</span>
<a href="#l57.74"></a><span id="l57.74">     key.AppendInt(i++);</span>
<a href="#l57.75"></a><span id="l57.75">     m_identities.Get(key, getter_AddRefs(identity));</span>
<a href="#l57.76"></a><span id="l57.76">   } while (identity);</span>
<a href="#l57.77"></a><span id="l57.77"> </span>
<a href="#l57.78"></a><span id="l57.78" class="difflineat">@@ -480,17 +480,17 @@ nsMsgAccountManager::CreateIncomingServe</span>
<a href="#l57.79"></a><span id="l57.79">                                           const nsACString&amp; type,</span>
<a href="#l57.80"></a><span id="l57.80">                                           nsIMsgIncomingServer **_retval)</span>
<a href="#l57.81"></a><span id="l57.81"> {</span>
<a href="#l57.82"></a><span id="l57.82">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l57.83"></a><span id="l57.83"> </span>
<a href="#l57.84"></a><span id="l57.84">   nsresult rv = LoadAccounts();</span>
<a href="#l57.85"></a><span id="l57.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l57.86"></a><span id="l57.86"> </span>
<a href="#l57.87"></a><span id="l57.87" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l57.88"></a><span id="l57.88" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l57.89"></a><span id="l57.89">   GetUniqueServerKey(key);</span>
<a href="#l57.90"></a><span id="l57.90">   rv = createKeyedServer(key, username, hostname, type, _retval);</span>
<a href="#l57.91"></a><span id="l57.91">   if (*_retval)</span>
<a href="#l57.92"></a><span id="l57.92">   {</span>
<a href="#l57.93"></a><span id="l57.93">     nsCString defaultStore;</span>
<a href="#l57.94"></a><span id="l57.94">     m_prefs-&gt;GetCharPref(&quot;mail.serverDefaultStoreContractID&quot;, getter_Copies(defaultStore));</span>
<a href="#l57.95"></a><span id="l57.95">     (*_retval)-&gt;SetCharValue(&quot;storeContractID&quot;, defaultStore);</span>
<a href="#l57.96"></a><span id="l57.96">   }</span>
<a href="#l57.97"></a><span id="l57.97" class="difflineat">@@ -510,21 +510,21 @@ nsMsgAccountManager::GetIncomingServer(c</span>
<a href="#l57.98"></a><span id="l57.98">   // server doesn't exist, so create it</span>
<a href="#l57.99"></a><span id="l57.99">   // this is really horrible because we are doing our own prefname munging</span>
<a href="#l57.100"></a><span id="l57.100">   // instead of leaving it up to the incoming server.</span>
<a href="#l57.101"></a><span id="l57.101">   // this should be fixed somehow so that we can create the incoming server</span>
<a href="#l57.102"></a><span id="l57.102">   // and then read from the incoming server's attributes</span>
<a href="#l57.103"></a><span id="l57.103"> </span>
<a href="#l57.104"></a><span id="l57.104">   // in order to create the right kind of server, we have to look</span>
<a href="#l57.105"></a><span id="l57.105">   // at the pref for this server to get the username, hostname, and type</span>
<a href="#l57.106"></a><span id="l57.106" class="difflineminus">-  nsCAutoString serverPrefPrefix(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l57.107"></a><span id="l57.107" class="difflineplus">+  nsAutoCString serverPrefPrefix(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l57.108"></a><span id="l57.108">   serverPrefPrefix.Append(key);</span>
<a href="#l57.109"></a><span id="l57.109"> </span>
<a href="#l57.110"></a><span id="l57.110">   nsCString serverType;</span>
<a href="#l57.111"></a><span id="l57.111" class="difflineminus">-  nsCAutoString serverPref (serverPrefPrefix);</span>
<a href="#l57.112"></a><span id="l57.112" class="difflineplus">+  nsAutoCString serverPref (serverPrefPrefix);</span>
<a href="#l57.113"></a><span id="l57.113">   serverPref.AppendLiteral(&quot;.type&quot;);</span>
<a href="#l57.114"></a><span id="l57.114">   rv = m_prefs-&gt;GetCharPref(serverPref.get(), getter_Copies(serverType));</span>
<a href="#l57.115"></a><span id="l57.115">   NS_ENSURE_SUCCESS(rv, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l57.116"></a><span id="l57.116"> </span>
<a href="#l57.117"></a><span id="l57.117">   //</span>
<a href="#l57.118"></a><span id="l57.118">   // .userName</span>
<a href="#l57.119"></a><span id="l57.119">   serverPref = serverPrefPrefix;</span>
<a href="#l57.120"></a><span id="l57.120">   serverPref.AppendLiteral(&quot;.userName&quot;);</span>
<a href="#l57.121"></a><span id="l57.121" class="difflineat">@@ -624,17 +624,17 @@ nsMsgAccountManager::createKeyedServer(c</span>
<a href="#l57.122"></a><span id="l57.122">                                        const nsACString&amp; hostname,</span>
<a href="#l57.123"></a><span id="l57.123">                                        const nsACString&amp; type,</span>
<a href="#l57.124"></a><span id="l57.124">                                        nsIMsgIncomingServer ** aServer)</span>
<a href="#l57.125"></a><span id="l57.125"> {</span>
<a href="#l57.126"></a><span id="l57.126">   nsresult rv;</span>
<a href="#l57.127"></a><span id="l57.127">   *aServer = nullptr;</span>
<a href="#l57.128"></a><span id="l57.128"> </span>
<a href="#l57.129"></a><span id="l57.129">   //construct the contractid</span>
<a href="#l57.130"></a><span id="l57.130" class="difflineminus">-  nsCAutoString serverContractID(NS_MSGINCOMINGSERVER_CONTRACTID_PREFIX);</span>
<a href="#l57.131"></a><span id="l57.131" class="difflineplus">+  nsAutoCString serverContractID(NS_MSGINCOMINGSERVER_CONTRACTID_PREFIX);</span>
<a href="#l57.132"></a><span id="l57.132">   serverContractID += type;</span>
<a href="#l57.133"></a><span id="l57.133"> </span>
<a href="#l57.134"></a><span id="l57.134">   // finally, create the server</span>
<a href="#l57.135"></a><span id="l57.135">   // (This will fail if type is from an extension that has been removed)</span>
<a href="#l57.136"></a><span id="l57.136">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server =</span>
<a href="#l57.137"></a><span id="l57.137">            do_CreateInstance(serverContractID.get(), &amp;rv);</span>
<a href="#l57.138"></a><span id="l57.138">   NS_ENSURE_SUCCESS(rv, NS_ERROR_NOT_AVAILABLE);</span>
<a href="#l57.139"></a><span id="l57.139"> </span>
<a href="#l57.140"></a><span id="l57.140" class="difflineat">@@ -1435,17 +1435,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l57.141"></a><span id="l57.141">     // if we've already seen this exact account, advance to the next account.</span>
<a href="#l57.142"></a><span id="l57.142">     // After the loop, we'll notice that we don't have as many actual accounts</span>
<a href="#l57.143"></a><span id="l57.143">     // as there were accounts in the pref, and rewrite the pref.</span>
<a href="#l57.144"></a><span id="l57.144">     if (accountsArray.IndexOf(accountsArray[i]) != i)</span>
<a href="#l57.145"></a><span id="l57.145">       continue;</span>
<a href="#l57.146"></a><span id="l57.146"> </span>
<a href="#l57.147"></a><span id="l57.147">     // get the &quot;server&quot; pref to see if we already have an account with this</span>
<a href="#l57.148"></a><span id="l57.148">     // server. If we do, we ignore this account.</span>
<a href="#l57.149"></a><span id="l57.149" class="difflineminus">-    nsCAutoString serverKeyPref(&quot;mail.account.&quot;);</span>
<a href="#l57.150"></a><span id="l57.150" class="difflineplus">+    nsAutoCString serverKeyPref(&quot;mail.account.&quot;);</span>
<a href="#l57.151"></a><span id="l57.151">     serverKeyPref += accountsArray[i];</span>
<a href="#l57.152"></a><span id="l57.152"> </span>
<a href="#l57.153"></a><span id="l57.153">     nsCOMPtr&lt;nsIPrefBranch&gt; accountPrefBranch;</span>
<a href="#l57.154"></a><span id="l57.154">     rv = prefservice-&gt;GetBranch(serverKeyPref.get(),</span>
<a href="#l57.155"></a><span id="l57.155">                                 getter_AddRefs(accountPrefBranch));</span>
<a href="#l57.156"></a><span id="l57.156">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l57.157"></a><span id="l57.157"> </span>
<a href="#l57.158"></a><span id="l57.158">     serverKeyPref += &quot;.server&quot;;</span>
<a href="#l57.159"></a><span id="l57.159" class="difflineat">@@ -1467,19 +1467,19 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l57.160"></a><span id="l57.160">                                      getter_AddRefs(account))) || !account)</span>
<a href="#l57.161"></a><span id="l57.161">     {</span>
<a href="#l57.162"></a><span id="l57.162">       NS_WARNING(&quot;unexpected entry in account list; prefs corrupt?&quot;);</span>
<a href="#l57.163"></a><span id="l57.163">       continue;</span>
<a href="#l57.164"></a><span id="l57.164">     }</span>
<a href="#l57.165"></a><span id="l57.165"> </span>
<a href="#l57.166"></a><span id="l57.166">     // See nsIMsgAccount.idl for a description of the secondsToLeaveUnavailable</span>
<a href="#l57.167"></a><span id="l57.167">     //  and timeFoundUnavailable preferences</span>
<a href="#l57.168"></a><span id="l57.168" class="difflineminus">-    nsCAutoString toLeavePref(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l57.169"></a><span id="l57.169" class="difflineplus">+    nsAutoCString toLeavePref(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l57.170"></a><span id="l57.170">     toLeavePref.Append(serverKey);</span>
<a href="#l57.171"></a><span id="l57.171" class="difflineminus">-    nsCAutoString unavailablePref(toLeavePref); // this is the server-specific prefix</span>
<a href="#l57.172"></a><span id="l57.172" class="difflineplus">+    nsAutoCString unavailablePref(toLeavePref); // this is the server-specific prefix</span>
<a href="#l57.173"></a><span id="l57.173">     unavailablePref.AppendLiteral(&quot;.timeFoundUnavailable&quot;);</span>
<a href="#l57.174"></a><span id="l57.174">     toLeavePref.AppendLiteral(&quot;.secondsToLeaveUnavailable&quot;);</span>
<a href="#l57.175"></a><span id="l57.175">     PRInt32 secondsToLeave = 0;</span>
<a href="#l57.176"></a><span id="l57.176">     PRInt32 timeUnavailable = 0;</span>
<a href="#l57.177"></a><span id="l57.177"> </span>
<a href="#l57.178"></a><span id="l57.178">     m_prefs-&gt;GetIntPref(toLeavePref.get(), &amp;secondsToLeave);</span>
<a href="#l57.179"></a><span id="l57.179"> </span>
<a href="#l57.180"></a><span id="l57.180">     // force load of accounts (need to find a better way to do this)</span>
<a href="#l57.181"></a><span id="l57.181" class="difflineat">@@ -1537,17 +1537,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l57.182"></a><span id="l57.182"> </span>
<a href="#l57.183"></a><span id="l57.183">   // Go through the accounts seeing if any existing server is deferred to</span>
<a href="#l57.184"></a><span id="l57.184">   // an account we removed. If so, fix the deferral. Then clean up the prefs</span>
<a href="#l57.185"></a><span id="l57.185">   // for the removed account.</span>
<a href="#l57.186"></a><span id="l57.186">   for (int32_t i = 0; i &lt; cnt; i++)</span>
<a href="#l57.187"></a><span id="l57.187">   {</span>
<a href="#l57.188"></a><span id="l57.188">     dupAccount = dupAccounts[i];</span>
<a href="#l57.189"></a><span id="l57.189">     m_incomingServers.Enumerate(hashCleanupDeferral, (void *) dupAccount.get());</span>
<a href="#l57.190"></a><span id="l57.190" class="difflineminus">-    nsCAutoString accountKeyPref(&quot;mail.account.&quot;);</span>
<a href="#l57.191"></a><span id="l57.191" class="difflineplus">+    nsAutoCString accountKeyPref(&quot;mail.account.&quot;);</span>
<a href="#l57.192"></a><span id="l57.192">     nsCString dupAccountKey;</span>
<a href="#l57.193"></a><span id="l57.193">     dupAccount-&gt;GetKey(dupAccountKey);</span>
<a href="#l57.194"></a><span id="l57.194">     if (dupAccountKey.IsEmpty())</span>
<a href="#l57.195"></a><span id="l57.195">       continue;</span>
<a href="#l57.196"></a><span id="l57.196">     accountKeyPref += dupAccountKey;</span>
<a href="#l57.197"></a><span id="l57.197"> </span>
<a href="#l57.198"></a><span id="l57.198">     nsCOMPtr&lt;nsIPrefBranch&gt; accountPrefBranch;</span>
<a href="#l57.199"></a><span id="l57.199">     rv = prefservice-&gt;GetBranch(accountKeyPref.get(),</span>
<a href="#l57.200"></a><span id="l57.200" class="difflineat">@@ -1776,17 +1776,17 @@ nsMsgAccountManager::createKeyedAccount(</span>
<a href="#l57.201"></a><span id="l57.201">   return NS_OK;</span>
<a href="#l57.202"></a><span id="l57.202"> }</span>
<a href="#l57.203"></a><span id="l57.203"> </span>
<a href="#l57.204"></a><span id="l57.204"> NS_IMETHODIMP</span>
<a href="#l57.205"></a><span id="l57.205"> nsMsgAccountManager::CreateAccount(nsIMsgAccount **_retval)</span>
<a href="#l57.206"></a><span id="l57.206"> {</span>
<a href="#l57.207"></a><span id="l57.207">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l57.208"></a><span id="l57.208"> </span>
<a href="#l57.209"></a><span id="l57.209" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l57.210"></a><span id="l57.210" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l57.211"></a><span id="l57.211">   getUniqueAccountKey(m_accounts, key);</span>
<a href="#l57.212"></a><span id="l57.212"> </span>
<a href="#l57.213"></a><span id="l57.213">   return createKeyedAccount(key, _retval);</span>
<a href="#l57.214"></a><span id="l57.214"> }</span>
<a href="#l57.215"></a><span id="l57.215"> </span>
<a href="#l57.216"></a><span id="l57.216"> NS_IMETHODIMP</span>
<a href="#l57.217"></a><span id="l57.217"> nsMsgAccountManager::GetAccount(const nsACString&amp; key, nsIMsgAccount **_retval)</span>
<a href="#l57.218"></a><span id="l57.218"> {</span>
<a href="#l57.219"></a><span id="l57.219" class="difflineat">@@ -1933,29 +1933,29 @@ nsMsgAccountManager::FindServerByURI(nsI</span>
<a href="#l57.220"></a><span id="l57.220">                                 nsIMsgIncomingServer** aResult)</span>
<a href="#l57.221"></a><span id="l57.221"> {</span>
<a href="#l57.222"></a><span id="l57.222">   NS_ENSURE_ARG_POINTER(aURI);</span>
<a href="#l57.223"></a><span id="l57.223"> </span>
<a href="#l57.224"></a><span id="l57.224">   nsresult rv = LoadAccounts();</span>
<a href="#l57.225"></a><span id="l57.225">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l57.226"></a><span id="l57.226"> </span>
<a href="#l57.227"></a><span id="l57.227">   // Get username and hostname and port so we can get the server</span>
<a href="#l57.228"></a><span id="l57.228" class="difflineminus">-  nsCAutoString username;</span>
<a href="#l57.229"></a><span id="l57.229" class="difflineminus">-  nsCAutoString escapedUsername;</span>
<a href="#l57.230"></a><span id="l57.230" class="difflineplus">+  nsAutoCString username;</span>
<a href="#l57.231"></a><span id="l57.231" class="difflineplus">+  nsAutoCString escapedUsername;</span>
<a href="#l57.232"></a><span id="l57.232">   rv = aURI-&gt;GetUserPass(escapedUsername);</span>
<a href="#l57.233"></a><span id="l57.233">   if (NS_SUCCEEDED(rv) &amp;&amp; !escapedUsername.IsEmpty())</span>
<a href="#l57.234"></a><span id="l57.234">     MsgUnescapeString(escapedUsername, 0,  username);</span>
<a href="#l57.235"></a><span id="l57.235"> </span>
<a href="#l57.236"></a><span id="l57.236" class="difflineminus">-  nsCAutoString hostname;</span>
<a href="#l57.237"></a><span id="l57.237" class="difflineminus">-  nsCAutoString escapedHostname;</span>
<a href="#l57.238"></a><span id="l57.238" class="difflineplus">+  nsAutoCString hostname;</span>
<a href="#l57.239"></a><span id="l57.239" class="difflineplus">+  nsAutoCString escapedHostname;</span>
<a href="#l57.240"></a><span id="l57.240">   rv = aURI-&gt;GetHost(escapedHostname);</span>
<a href="#l57.241"></a><span id="l57.241">   if (NS_SUCCEEDED(rv) &amp;&amp; !escapedHostname.IsEmpty())</span>
<a href="#l57.242"></a><span id="l57.242">     MsgUnescapeString(escapedHostname, 0, hostname);</span>
<a href="#l57.243"></a><span id="l57.243"> </span>
<a href="#l57.244"></a><span id="l57.244" class="difflineminus">-  nsCAutoString type;</span>
<a href="#l57.245"></a><span id="l57.245" class="difflineplus">+  nsAutoCString type;</span>
<a href="#l57.246"></a><span id="l57.246">   rv = aURI-&gt;GetScheme(type);</span>
<a href="#l57.247"></a><span id="l57.247">   if (NS_SUCCEEDED(rv) &amp;&amp; !type.IsEmpty())</span>
<a href="#l57.248"></a><span id="l57.248">   {</span>
<a href="#l57.249"></a><span id="l57.249">     // now modify type if pop or news</span>
<a href="#l57.250"></a><span id="l57.250">     if (type.EqualsLiteral(&quot;pop&quot;))</span>
<a href="#l57.251"></a><span id="l57.251">       type.AssignLiteral(&quot;pop3&quot;);</span>
<a href="#l57.252"></a><span id="l57.252">     // we use &quot;nntp&quot; in the server list so translate it here.</span>
<a href="#l57.253"></a><span id="l57.253">     else if (type.EqualsLiteral(&quot;news&quot;))</span>
<a href="#l57.254"></a><span id="l57.254" class="difflineat">@@ -2682,17 +2682,17 @@ nsMsgAccountManager::GetChromePackageNam</span>
<a href="#l57.255"></a><span id="l57.255">   rv = catman-&gt;EnumerateCategory(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, getter_AddRefs(e));</span>
<a href="#l57.256"></a><span id="l57.256">   if(NS_SUCCEEDED(rv) &amp;&amp; e) {</span>
<a href="#l57.257"></a><span id="l57.257">     while (true) {</span>
<a href="#l57.258"></a><span id="l57.258">       nsCOMPtr&lt;nsISupportsCString&gt; catEntry;</span>
<a href="#l57.259"></a><span id="l57.259">       rv = e-&gt;GetNext(getter_AddRefs(catEntry));</span>
<a href="#l57.260"></a><span id="l57.260">       if (NS_FAILED(rv) || !catEntry)</span>
<a href="#l57.261"></a><span id="l57.261">         break;</span>
<a href="#l57.262"></a><span id="l57.262"> </span>
<a href="#l57.263"></a><span id="l57.263" class="difflineminus">-      nsCAutoString entryString;</span>
<a href="#l57.264"></a><span id="l57.264" class="difflineplus">+      nsAutoCString entryString;</span>
<a href="#l57.265"></a><span id="l57.265">       rv = catEntry-&gt;GetData(entryString);</span>
<a href="#l57.266"></a><span id="l57.266">       if (NS_FAILED(rv))</span>
<a href="#l57.267"></a><span id="l57.267">          break;</span>
<a href="#l57.268"></a><span id="l57.268"> </span>
<a href="#l57.269"></a><span id="l57.269">       nsCString contractidString;</span>
<a href="#l57.270"></a><span id="l57.270">       rv = catman-&gt;GetCategoryEntry(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, entryString.get(),</span>
<a href="#l57.271"></a><span id="l57.271">                                     getter_Copies(contractidString));</span>
<a href="#l57.272"></a><span id="l57.272">       if (NS_FAILED(rv))</span>
<a href="#l57.273"></a><span id="l57.273" class="difflineat">@@ -3139,17 +3139,17 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l57.274"></a><span id="l57.274">      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l57.275"></a><span id="l57.275">      nsCOMPtr&lt;nsIFileInputStream&gt; fileStream = do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l57.276"></a><span id="l57.276">      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l57.277"></a><span id="l57.277"> </span>
<a href="#l57.278"></a><span id="l57.278">      rv = fileStream-&gt;Init(file,  PR_RDONLY, 0664, false);</span>
<a href="#l57.279"></a><span id="l57.279">      nsCOMPtr &lt;nsILineInputStream&gt; lineInputStream(do_QueryInterface(fileStream));</span>
<a href="#l57.280"></a><span id="l57.280"> </span>
<a href="#l57.281"></a><span id="l57.281">     bool isMore = true;</span>
<a href="#l57.282"></a><span id="l57.282" class="difflineminus">-    nsCAutoString buffer;</span>
<a href="#l57.283"></a><span id="l57.283" class="difflineplus">+    nsAutoCString buffer;</span>
<a href="#l57.284"></a><span id="l57.284">     int32_t version = -1;</span>
<a href="#l57.285"></a><span id="l57.285">     nsCOMPtr &lt;nsIMsgFolder&gt; virtualFolder;</span>
<a href="#l57.286"></a><span id="l57.286">     nsCOMPtr &lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l57.287"></a><span id="l57.287">     nsCOMPtr&lt;nsIRDFResource&gt; resource;</span>
<a href="#l57.288"></a><span id="l57.288">     nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;, &amp;rv));</span>
<a href="#l57.289"></a><span id="l57.289">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l57.290"></a><span id="l57.290">     nsCOMPtr&lt;nsIArray&gt; allFolders;</span>
<a href="#l57.291"></a><span id="l57.291"> </span>
<a href="#l57.292"></a><span id="l57.292" class="difflineat">@@ -3192,17 +3192,17 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l57.293"></a><span id="l57.293">               // hold a reference so it won't get deleted before it's parented.</span>
<a href="#l57.294"></a><span id="l57.294">               oldParent = parentFolder;</span>
<a href="#l57.295"></a><span id="l57.295"> </span>
<a href="#l57.296"></a><span id="l57.296">               rdf-&gt;GetResource(parentUri, getter_AddRefs(resource));</span>
<a href="#l57.297"></a><span id="l57.297">               parentFolder = do_QueryInterface(resource);</span>
<a href="#l57.298"></a><span id="l57.298">               if (parentFolder)</span>
<a href="#l57.299"></a><span id="l57.299">               {</span>
<a href="#l57.300"></a><span id="l57.300">                 nsAutoString currentFolderNameStr;</span>
<a href="#l57.301"></a><span id="l57.301" class="difflineminus">-                nsCAutoString currentFolderNameCStr;</span>
<a href="#l57.302"></a><span id="l57.302" class="difflineplus">+                nsAutoCString currentFolderNameCStr;</span>
<a href="#l57.303"></a><span id="l57.303">                 MsgUnescapeString(nsCString(Substring(buffer, lastSlash + 1, buffer.Length())), 0, currentFolderNameCStr);</span>
<a href="#l57.304"></a><span id="l57.304">                 CopyUTF8toUTF16(currentFolderNameCStr, currentFolderNameStr);</span>
<a href="#l57.305"></a><span id="l57.305">                 nsCOMPtr &lt;nsIMsgFolder&gt; childFolder;</span>
<a href="#l57.306"></a><span id="l57.306">                 nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l57.307"></a><span id="l57.307">                 // force db to get created.</span>
<a href="#l57.308"></a><span id="l57.308">                 virtualFolder-&gt;SetParent(parentFolder);</span>
<a href="#l57.309"></a><span id="l57.309">                 rv = virtualFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l57.310"></a><span id="l57.310">                 if (rv == NS_MSG_ERROR_FOLDER_SUMMARY_MISSING)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -338,17 +338,17 @@ nsMsgAccountManagerDataSource::GetTarget</span>
<a href="#l58.4"></a><span id="l58.4">         nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager, &amp;rv);</span>
<a href="#l58.5"></a><span id="l58.5">         NS_ENSURE_SUCCESS(rv, NS_OK);</span>
<a href="#l58.6"></a><span id="l58.6"> </span>
<a href="#l58.7"></a><span id="l58.7">         // turn NC#PageTitlefoobar into foobar, so we can get the am-foobar.properties bundle</span>
<a href="#l58.8"></a><span id="l58.8">         nsCString chromePackageName;</span>
<a href="#l58.9"></a><span id="l58.9">         rv = am-&gt;GetChromePackageName(nsCString(sourceValue + strlen(NC_RDF_PAGETITLE_PREFIX)), chromePackageName);</span>
<a href="#l58.10"></a><span id="l58.10">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l58.11"></a><span id="l58.11"> </span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-        nsCAutoString bundleURL;</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+        nsAutoCString bundleURL;</span>
<a href="#l58.14"></a><span id="l58.14">         bundleURL = &quot;chrome://&quot;;</span>
<a href="#l58.15"></a><span id="l58.15">         bundleURL += chromePackageName;</span>
<a href="#l58.16"></a><span id="l58.16">         bundleURL += &quot;/locale/am-&quot;;</span>
<a href="#l58.17"></a><span id="l58.17">         bundleURL += (sourceValue + strlen(NC_RDF_PAGETITLE_PREFIX));</span>
<a href="#l58.18"></a><span id="l58.18">         bundleURL += &quot;.properties&quot;;</span>
<a href="#l58.19"></a><span id="l58.19"> </span>
<a href="#l58.20"></a><span id="l58.20">         nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l58.21"></a><span id="l58.21">         rv = strBundleService-&gt;CreateBundle(bundleURL.get(), getter_AddRefs(bundle));</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineat">@@ -622,17 +622,17 @@ nsMsgAccountManagerDataSource::appendGen</span>
<a href="#l58.23"></a><span id="l58.23">   rv = catman-&gt;EnumerateCategory(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, getter_AddRefs(e));</span>
<a href="#l58.24"></a><span id="l58.24">   if(NS_SUCCEEDED(rv) &amp;&amp; e) {</span>
<a href="#l58.25"></a><span id="l58.25">     while (true) {</span>
<a href="#l58.26"></a><span id="l58.26">       nsCOMPtr&lt;nsISupportsCString&gt; catEntry;</span>
<a href="#l58.27"></a><span id="l58.27">       rv = e-&gt;GetNext(getter_AddRefs(catEntry));</span>
<a href="#l58.28"></a><span id="l58.28">       if (NS_FAILED(rv) || !catEntry)</span>
<a href="#l58.29"></a><span id="l58.29">         break;</span>
<a href="#l58.30"></a><span id="l58.30"> </span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-      nsCAutoString entryString;</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+      nsAutoCString entryString;</span>
<a href="#l58.33"></a><span id="l58.33">       rv = catEntry-&gt;GetData(entryString);</span>
<a href="#l58.34"></a><span id="l58.34">       if (NS_FAILED(rv))</span>
<a href="#l58.35"></a><span id="l58.35">         break;</span>
<a href="#l58.36"></a><span id="l58.36"> </span>
<a href="#l58.37"></a><span id="l58.37">       nsCString contractidString;</span>
<a href="#l58.38"></a><span id="l58.38">       rv = catman-&gt;GetCategoryEntry(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, entryString.get(), getter_Copies(contractidString));</span>
<a href="#l58.39"></a><span id="l58.39">       if (NS_FAILED(rv))</span>
<a href="#l58.40"></a><span id="l58.40">         break;</span>
<a href="#l58.41"></a><span id="l58.41" class="difflineat">@@ -666,17 +666,17 @@ nsresult</span>
<a href="#l58.42"></a><span id="l58.42"> nsMsgAccountManagerDataSource::appendGenericSetting(const char *name,</span>
<a href="#l58.43"></a><span id="l58.43">                                                     nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l58.44"></a><span id="l58.44"> {</span>
<a href="#l58.45"></a><span id="l58.45">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l58.46"></a><span id="l58.46">   NS_ENSURE_ARG_POINTER(aNodeArray);</span>
<a href="#l58.47"></a><span id="l58.47"> </span>
<a href="#l58.48"></a><span id="l58.48">   nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l58.49"></a><span id="l58.49"> </span>
<a href="#l58.50"></a><span id="l58.50" class="difflineminus">-  nsCAutoString resourceStr;</span>
<a href="#l58.51"></a><span id="l58.51" class="difflineplus">+  nsAutoCString resourceStr;</span>
<a href="#l58.52"></a><span id="l58.52">   resourceStr = NC_RDF_PAGETITLE_PREFIX;</span>
<a href="#l58.53"></a><span id="l58.53">   resourceStr += name;</span>
<a href="#l58.54"></a><span id="l58.54"> </span>
<a href="#l58.55"></a><span id="l58.55">   nsresult rv = getRDFService()-&gt;GetResource(resourceStr, getter_AddRefs(resource));</span>
<a href="#l58.56"></a><span id="l58.56">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l58.57"></a><span id="l58.57"> </span>
<a href="#l58.58"></a><span id="l58.58">   // AppendElement will addref.</span>
<a href="#l58.59"></a><span id="l58.59">   aNodeArray-&gt;AppendObject(resource);</span>
<a href="#l58.60"></a><span id="l58.60" class="difflineat">@@ -995,17 +995,17 @@ nsMsgAccountManagerDataSource::supportsF</span>
<a href="#l58.61"></a><span id="l58.61"> </span>
<a href="#l58.62"></a><span id="l58.62"> bool</span>
<a href="#l58.63"></a><span id="l58.63"> nsMsgAccountManagerDataSource::canGetMessages(nsIMsgIncomingServer *aServer)</span>
<a href="#l58.64"></a><span id="l58.64"> {</span>
<a href="#l58.65"></a><span id="l58.65">   nsCString type;</span>
<a href="#l58.66"></a><span id="l58.66">   nsresult rv = aServer-&gt;GetType(type);</span>
<a href="#l58.67"></a><span id="l58.67">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l58.68"></a><span id="l58.68"> </span>
<a href="#l58.69"></a><span id="l58.69" class="difflineminus">-  nsCAutoString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l58.70"></a><span id="l58.70" class="difflineplus">+  nsAutoCString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l58.71"></a><span id="l58.71">   contractid.Append(type);</span>
<a href="#l58.72"></a><span id="l58.72"> </span>
<a href="#l58.73"></a><span id="l58.73">   nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo = do_GetService(contractid.get(), &amp;rv);</span>
<a href="#l58.74"></a><span id="l58.74">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l58.75"></a><span id="l58.75"> </span>
<a href="#l58.76"></a><span id="l58.76">   bool canGetMessages = false;</span>
<a href="#l58.77"></a><span id="l58.77">   protocolInfo-&gt;GetCanGetMessages(&amp;canGetMessages);</span>
<a href="#l58.78"></a><span id="l58.78"> </span>
<a href="#l58.79"></a><span id="l58.79" class="difflineat">@@ -1014,17 +1014,17 @@ nsMsgAccountManagerDataSource::canGetMes</span>
<a href="#l58.80"></a><span id="l58.80"> </span>
<a href="#l58.81"></a><span id="l58.81"> bool</span>
<a href="#l58.82"></a><span id="l58.82"> nsMsgAccountManagerDataSource::canGetIncomingMessages(nsIMsgIncomingServer *aServer)</span>
<a href="#l58.83"></a><span id="l58.83"> {</span>
<a href="#l58.84"></a><span id="l58.84">   nsCString type;</span>
<a href="#l58.85"></a><span id="l58.85">   nsresult rv = aServer-&gt;GetType(type);</span>
<a href="#l58.86"></a><span id="l58.86">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l58.87"></a><span id="l58.87"> </span>
<a href="#l58.88"></a><span id="l58.88" class="difflineminus">-  nsCAutoString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l58.89"></a><span id="l58.89" class="difflineplus">+  nsAutoCString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l58.90"></a><span id="l58.90">   contractid.Append(type);</span>
<a href="#l58.91"></a><span id="l58.91"> </span>
<a href="#l58.92"></a><span id="l58.92">   nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo = do_GetService(contractid.get(), &amp;rv);</span>
<a href="#l58.93"></a><span id="l58.93">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l58.94"></a><span id="l58.94"> </span>
<a href="#l58.95"></a><span id="l58.95">   bool canGetIncomingMessages = false;</span>
<a href="#l58.96"></a><span id="l58.96">   protocolInfo-&gt;GetCanGetIncomingMessages(&amp;canGetIncomingMessages);</span>
<a href="#l58.97"></a><span id="l58.97"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -143,17 +143,17 @@ nsMsgContentPolicy::ShouldAcceptRemoteCo</span>
<a href="#l59.4"></a><span id="l59.4"> /**</span>
<a href="#l59.5"></a><span id="l59.5">  * Extract the host name from aContentLocation, and look it up in our list</span>
<a href="#l59.6"></a><span id="l59.6">  * of trusted domains.</span>
<a href="#l59.7"></a><span id="l59.7">  */</span>
<a href="#l59.8"></a><span id="l59.8"> bool nsMsgContentPolicy::IsTrustedDomain(nsIURI * aContentLocation)</span>
<a href="#l59.9"></a><span id="l59.9"> {</span>
<a href="#l59.10"></a><span id="l59.10">   bool trustedDomain = false;</span>
<a href="#l59.11"></a><span id="l59.11">   // get the host name of the server hosting the remote image</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-  nsCAutoString host;</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+  nsAutoCString host;</span>
<a href="#l59.14"></a><span id="l59.14">   nsresult rv = aContentLocation-&gt;GetHost(host);</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16">   if (NS_SUCCEEDED(rv) &amp;&amp; !mTrustedMailDomains.IsEmpty()) </span>
<a href="#l59.17"></a><span id="l59.17">     trustedDomain = MsgHostDomainIsTrusted(host, mTrustedMailDomains);</span>
<a href="#l59.18"></a><span id="l59.18"> </span>
<a href="#l59.19"></a><span id="l59.19">   return trustedDomain;</span>
<a href="#l59.20"></a><span id="l59.20"> }</span>
<a href="#l59.21"></a><span id="l59.21"> </span>
<a href="#l59.22"></a><span id="l59.22" class="difflineat">@@ -357,17 +357,17 @@ nsMsgContentPolicy::IsSafeRequestingLoca</span>
<a href="#l59.23"></a><span id="l59.23"> </span>
<a href="#l59.24"></a><span id="l59.24"> /**</span>
<a href="#l59.25"></a><span id="l59.25">  * Determines if the content location is a scheme that we're willing to expose</span>
<a href="#l59.26"></a><span id="l59.26">  * for unlimited loading of content.</span>
<a href="#l59.27"></a><span id="l59.27">  */</span>
<a href="#l59.28"></a><span id="l59.28"> bool</span>
<a href="#l59.29"></a><span id="l59.29"> nsMsgContentPolicy::IsExposedProtocol(nsIURI *aContentLocation)</span>
<a href="#l59.30"></a><span id="l59.30"> {</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-  nsCAutoString contentScheme;</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineplus">+  nsAutoCString contentScheme;</span>
<a href="#l59.33"></a><span id="l59.33">   nsresult rv = aContentLocation-&gt;GetScheme(contentScheme);</span>
<a href="#l59.34"></a><span id="l59.34">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l59.35"></a><span id="l59.35"> </span>
<a href="#l59.36"></a><span id="l59.36">   // If you are changing this list, you may need to also consider changing the</span>
<a href="#l59.37"></a><span id="l59.37">   // list of network.protocol-handler.expose.* prefs in all-thunderbird.js.</span>
<a href="#l59.38"></a><span id="l59.38">   if (MsgLowerCaseEqualsLiteral(contentScheme, &quot;mailto&quot;) ||</span>
<a href="#l59.39"></a><span id="l59.39">       MsgLowerCaseEqualsLiteral(contentScheme, &quot;news&quot;) ||</span>
<a href="#l59.40"></a><span id="l59.40">       MsgLowerCaseEqualsLiteral(contentScheme, &quot;snews&quot;) ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -833,17 +833,17 @@ nsresult nsMsgDBView::FetchKeywords(nsIM</span>
<a href="#l60.4"></a><span id="l60.4">   }</span>
<a href="#l60.5"></a><span id="l60.5">   nsMsgLabelValue label = 0;</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7">   rv = aHdr-&gt;GetLabel(&amp;label);</span>
<a href="#l60.8"></a><span id="l60.8">   nsCString keywords;</span>
<a href="#l60.9"></a><span id="l60.9">   aHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l60.10"></a><span id="l60.10">   if (label &gt; 0)</span>
<a href="#l60.11"></a><span id="l60.11">   {</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-    nsCAutoString labelStr(&quot;$label&quot;);</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+    nsAutoCString labelStr(&quot;$label&quot;);</span>
<a href="#l60.14"></a><span id="l60.14">     labelStr.Append((char) (label + '0'));</span>
<a href="#l60.15"></a><span id="l60.15">     if (keywords.Find(labelStr, CaseInsensitiveCompare) == -1)</span>
<a href="#l60.16"></a><span id="l60.16">     {</span>
<a href="#l60.17"></a><span id="l60.17">       if (!keywords.IsEmpty())</span>
<a href="#l60.18"></a><span id="l60.18">         keywords.Append(' ');</span>
<a href="#l60.19"></a><span id="l60.19">       keywords.Append(labelStr);</span>
<a href="#l60.20"></a><span id="l60.20">     }</span>
<a href="#l60.21"></a><span id="l60.21">   }</span>
<a href="#l60.22"></a><span id="l60.22" class="difflineat">@@ -901,17 +901,17 @@ nsresult nsMsgDBView::FetchTags(nsIMsgDB</span>
<a href="#l60.23"></a><span id="l60.23">   nsString tags;</span>
<a href="#l60.24"></a><span id="l60.24">   nsCString keywords;</span>
<a href="#l60.25"></a><span id="l60.25">   aHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l60.26"></a><span id="l60.26"> </span>
<a href="#l60.27"></a><span id="l60.27">   nsMsgLabelValue label = 0;</span>
<a href="#l60.28"></a><span id="l60.28">   rv = aHdr-&gt;GetLabel(&amp;label);</span>
<a href="#l60.29"></a><span id="l60.29">   if (label &gt; 0)</span>
<a href="#l60.30"></a><span id="l60.30">   {</span>
<a href="#l60.31"></a><span id="l60.31" class="difflineminus">-    nsCAutoString labelStr(&quot;$label&quot;);</span>
<a href="#l60.32"></a><span id="l60.32" class="difflineplus">+    nsAutoCString labelStr(&quot;$label&quot;);</span>
<a href="#l60.33"></a><span id="l60.33">     labelStr.Append((char) (label + '0'));</span>
<a href="#l60.34"></a><span id="l60.34">     if (keywords.Find(labelStr, CaseInsensitiveCompare) == -1)</span>
<a href="#l60.35"></a><span id="l60.35">       FetchLabel(aHdr, tags);</span>
<a href="#l60.36"></a><span id="l60.36">   }</span>
<a href="#l60.37"></a><span id="l60.37"> </span>
<a href="#l60.38"></a><span id="l60.38">   nsTArray&lt;nsCString&gt; keywordsArray;</span>
<a href="#l60.39"></a><span id="l60.39">   ParseString(keywords, ' ', keywordsArray);</span>
<a href="#l60.40"></a><span id="l60.40">   nsAutoString tag;</span>
<a href="#l60.41"></a><span id="l60.41" class="difflineat">@@ -1135,17 +1135,17 @@ NS_IMETHODIMP nsMsgDBView::SetSelection(</span>
<a href="#l60.42"></a><span id="l60.42">   return NS_OK;</span>
<a href="#l60.43"></a><span id="l60.43"> }</span>
<a href="#l60.44"></a><span id="l60.44"> </span>
<a href="#l60.45"></a><span id="l60.45"> NS_IMETHODIMP nsMsgDBView::ReloadMessageWithAllParts()</span>
<a href="#l60.46"></a><span id="l60.46"> {</span>
<a href="#l60.47"></a><span id="l60.47">   if (m_currentlyDisplayedMsgUri.IsEmpty() || mSuppressMsgDisplay)</span>
<a href="#l60.48"></a><span id="l60.48">     return NS_OK;</span>
<a href="#l60.49"></a><span id="l60.49"> </span>
<a href="#l60.50"></a><span id="l60.50" class="difflineminus">-  nsCAutoString forceAllParts(m_currentlyDisplayedMsgUri);</span>
<a href="#l60.51"></a><span id="l60.51" class="difflineplus">+  nsAutoCString forceAllParts(m_currentlyDisplayedMsgUri);</span>
<a href="#l60.52"></a><span id="l60.52">   forceAllParts += (forceAllParts.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l60.53"></a><span id="l60.53">   forceAllParts.AppendLiteral(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l60.54"></a><span id="l60.54">   nsCOMPtr&lt;nsIMessenger&gt; messenger (do_QueryReferent(mMessengerWeak));</span>
<a href="#l60.55"></a><span id="l60.55">   NS_ENSURE_TRUE(messenger, NS_ERROR_FAILURE);</span>
<a href="#l60.56"></a><span id="l60.56"> </span>
<a href="#l60.57"></a><span id="l60.57">   nsresult rv = messenger-&gt;OpenURL(forceAllParts);</span>
<a href="#l60.58"></a><span id="l60.58">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l60.59"></a><span id="l60.59"> </span>
<a href="#l60.60"></a><span id="l60.60" class="difflineat">@@ -1498,18 +1498,18 @@ NS_IMETHODIMP nsMsgDBView::GetCellProper</span>
<a href="#l60.61"></a><span id="l60.61">   // this is a double fetch of the keywords property since we also fetch</span>
<a href="#l60.62"></a><span id="l60.62">   // it for the tags - do we want to do this?</span>
<a href="#l60.63"></a><span id="l60.63">   // I'm not sure anyone uses the kw- property, though it could be nice</span>
<a href="#l60.64"></a><span id="l60.64">   // for people wanting to extend the thread pane.</span>
<a href="#l60.65"></a><span id="l60.65">   nsCString keywordProperty;</span>
<a href="#l60.66"></a><span id="l60.66">   msgHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywordProperty));</span>
<a href="#l60.67"></a><span id="l60.67">   if (!keywordProperty.IsEmpty())</span>
<a href="#l60.68"></a><span id="l60.68">   {</span>
<a href="#l60.69"></a><span id="l60.69" class="difflineminus">-    nsCAutoString keywords(keywordProperty);</span>
<a href="#l60.70"></a><span id="l60.70" class="difflineminus">-    nsCAutoString nextKeyword;</span>
<a href="#l60.71"></a><span id="l60.71" class="difflineplus">+    nsAutoCString keywords(keywordProperty);</span>
<a href="#l60.72"></a><span id="l60.72" class="difflineplus">+    nsAutoCString nextKeyword;</span>
<a href="#l60.73"></a><span id="l60.73">     int32_t spaceIndex = 0;</span>
<a href="#l60.74"></a><span id="l60.74">     do</span>
<a href="#l60.75"></a><span id="l60.75">     {</span>
<a href="#l60.76"></a><span id="l60.76">       spaceIndex = keywords.FindChar(' ');</span>
<a href="#l60.77"></a><span id="l60.77">       int32_t endOfKeyword = (spaceIndex == -1) ? keywords.Length() : spaceIndex;</span>
<a href="#l60.78"></a><span id="l60.78">       nextKeyword.AssignLiteral(&quot;kw-&quot;);</span>
<a href="#l60.79"></a><span id="l60.79">       nextKeyword.Append(StringHead(keywords, endOfKeyword));</span>
<a href="#l60.80"></a><span id="l60.80">       nsCOMPtr &lt;nsIAtom&gt; keywordAtom = MsgGetAtom(nextKeyword.get());</span>
<a href="#l60.81"></a><span id="l60.81" class="difflineat">@@ -3374,17 +3374,17 @@ nsresult nsMsgDBView::SetMsgHdrJunkStatu</span>
<a href="#l60.82"></a><span id="l60.82">     // and told us the junk status of this message.</span>
<a href="#l60.83"></a><span id="l60.83">     // Set origin first so that listeners on the junkscore will</span>
<a href="#l60.84"></a><span id="l60.84">     // know the correct origin.</span>
<a href="#l60.85"></a><span id="l60.85">     rv = db-&gt;SetStringProperty(msgKey, &quot;junkscoreorigin&quot;, &quot;user&quot;);</span>
<a href="#l60.86"></a><span id="l60.86">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;SetStringPropertyByIndex failed&quot;);</span>
<a href="#l60.87"></a><span id="l60.87"> </span>
<a href="#l60.88"></a><span id="l60.88">     // set the junk score on the message itself</span>
<a href="#l60.89"></a><span id="l60.89"> </span>
<a href="#l60.90"></a><span id="l60.90" class="difflineminus">-    nsCAutoString msgJunkScore;</span>
<a href="#l60.91"></a><span id="l60.91" class="difflineplus">+    nsAutoCString msgJunkScore;</span>
<a href="#l60.92"></a><span id="l60.92">     msgJunkScore.AppendInt(aNewClassification == nsIJunkMailPlugin::JUNK ?</span>
<a href="#l60.93"></a><span id="l60.93">           nsIJunkMailPlugin::IS_SPAM_SCORE:</span>
<a href="#l60.94"></a><span id="l60.94">           nsIJunkMailPlugin::IS_HAM_SCORE);</span>
<a href="#l60.95"></a><span id="l60.95">     db-&gt;SetStringProperty(msgKey, &quot;junkscore&quot;, msgJunkScore.get());</span>
<a href="#l60.96"></a><span id="l60.96">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l60.97"></a><span id="l60.97"> </span>
<a href="#l60.98"></a><span id="l60.98">     return rv;</span>
<a href="#l60.99"></a><span id="l60.99"> }</span>
<a href="#l60.100"></a><span id="l60.100" class="difflineat">@@ -7582,17 +7582,17 @@ nsresult nsMsgDBView::InitDisplayFormats</span>
<a href="#l60.101"></a><span id="l60.101">   getDateFormatPref( dateFormatPrefs, &quot;today&quot;, m_dateFormatToday );</span>
<a href="#l60.102"></a><span id="l60.102">   return rv;</span>
<a href="#l60.103"></a><span id="l60.103"> }</span>
<a href="#l60.104"></a><span id="l60.104"> </span>
<a href="#l60.105"></a><span id="l60.105"> void nsMsgDBView::SetMRUTimeForFolder(nsIMsgFolder *folder)</span>
<a href="#l60.106"></a><span id="l60.106"> {</span>
<a href="#l60.107"></a><span id="l60.107">   uint32_t seconds;</span>
<a href="#l60.108"></a><span id="l60.108">   PRTime2Seconds(PR_Now(), &amp;seconds);</span>
<a href="#l60.109"></a><span id="l60.109" class="difflineminus">-  nsCAutoString nowStr;</span>
<a href="#l60.110"></a><span id="l60.110" class="difflineplus">+  nsAutoCString nowStr;</span>
<a href="#l60.111"></a><span id="l60.111">   nowStr.AppendInt(seconds);</span>
<a href="#l60.112"></a><span id="l60.112">   folder-&gt;SetStringProperty(MRU_TIME_PROPERTY, nowStr);</span>
<a href="#l60.113"></a><span id="l60.113"> }</span>
<a href="#l60.114"></a><span id="l60.114"> </span>
<a href="#l60.115"></a><span id="l60.115"> </span>
<a href="#l60.116"></a><span id="l60.116"> NS_IMPL_ISUPPORTS1(nsMsgDBView::nsMsgViewHdrEnumerator, nsISimpleEnumerator)</span>
<a href="#l60.117"></a><span id="l60.117"> </span>
<a href="#l60.118"></a><span id="l60.118"> nsMsgDBView::nsMsgViewHdrEnumerator::nsMsgViewHdrEnumerator(nsMsgDBView *view)</span>
<a href="#l60.119"></a><span id="l60.119" class="difflineat">@@ -7674,25 +7674,25 @@ bool nsMsgDBView::JunkControlsEnabled(ns</span>
<a href="#l60.120"></a><span id="l60.120">     GetFolderForViewIndex(aViewIndex, getter_AddRefs(folder));</span>
<a href="#l60.121"></a><span id="l60.121">   if (folder)</span>
<a href="#l60.122"></a><span id="l60.122">   {</span>
<a href="#l60.123"></a><span id="l60.123">     // Check if this is a mail message in search folders.</span>
<a href="#l60.124"></a><span id="l60.124">     if (mIsXFVirtual)</span>
<a href="#l60.125"></a><span id="l60.125">     {</span>
<a href="#l60.126"></a><span id="l60.126">       nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l60.127"></a><span id="l60.127">       folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l60.128"></a><span id="l60.128" class="difflineminus">-      nsCAutoString type;</span>
<a href="#l60.129"></a><span id="l60.129" class="difflineplus">+      nsAutoCString type;</span>
<a href="#l60.130"></a><span id="l60.130">       if (server)</span>
<a href="#l60.131"></a><span id="l60.131">         server-&gt;GetType(type);</span>
<a href="#l60.132"></a><span id="l60.132">       if (!(MsgLowerCaseEqualsLiteral(type, &quot;nntp&quot;) || MsgLowerCaseEqualsLiteral(type, &quot;rss&quot;)))</span>
<a href="#l60.133"></a><span id="l60.133">         return true;</span>
<a href="#l60.134"></a><span id="l60.134">     }</span>
<a href="#l60.135"></a><span id="l60.135"> </span>
<a href="#l60.136"></a><span id="l60.136">     // For rss and news, check the inherited folder property.</span>
<a href="#l60.137"></a><span id="l60.137" class="difflineminus">-    nsCAutoString junkEnableOverride;</span>
<a href="#l60.138"></a><span id="l60.138" class="difflineplus">+    nsAutoCString junkEnableOverride;</span>
<a href="#l60.139"></a><span id="l60.139">     folder-&gt;GetInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;,</span>
<a href="#l60.140"></a><span id="l60.140">                                        junkEnableOverride);</span>
<a href="#l60.141"></a><span id="l60.141">     if (junkEnableOverride.EqualsLiteral(&quot;true&quot;))</span>
<a href="#l60.142"></a><span id="l60.142">       return true;</span>
<a href="#l60.143"></a><span id="l60.143">   }</span>
<a href="#l60.144"></a><span id="l60.144"> </span>
<a href="#l60.145"></a><span id="l60.145">   return false;</span>
<a href="#l60.146"></a><span id="l60.146"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -232,17 +232,17 @@ NS_IMETHODIMP nsMsgFolderCache::Init(nsI</span>
<a href="#l61.4"></a><span id="l61.4"> {</span>
<a href="#l61.5"></a><span id="l61.5">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l61.6"></a><span id="l61.6"> </span>
<a href="#l61.7"></a><span id="l61.7">   m_cacheElements.Init();</span>
<a href="#l61.8"></a><span id="l61.8"> </span>
<a href="#l61.9"></a><span id="l61.9">   bool exists;</span>
<a href="#l61.10"></a><span id="l61.10">   aFile-&gt;Exists(&amp;exists);</span>
<a href="#l61.11"></a><span id="l61.11"> </span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  nsCAutoString dbPath;</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+  nsAutoCString dbPath;</span>
<a href="#l61.14"></a><span id="l61.14">   aFile-&gt;GetNativePath(dbPath);</span>
<a href="#l61.15"></a><span id="l61.15">   // ### evil cast until MDB supports file streams.</span>
<a href="#l61.16"></a><span id="l61.16">   nsresult rv = OpenMDB(dbPath, exists);</span>
<a href="#l61.17"></a><span id="l61.17">   // if this fails and panacea.dat exists, try blowing away the db and recreating it</span>
<a href="#l61.18"></a><span id="l61.18">   if (NS_FAILED(rv) &amp;&amp; exists)</span>
<a href="#l61.19"></a><span id="l61.19">   {</span>
<a href="#l61.20"></a><span id="l61.20">     if (m_mdbStore)</span>
<a href="#l61.21"></a><span id="l61.21">       m_mdbStore-&gt;Release();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCacheElement.cpp</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCacheElement.cpp</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -110,17 +110,17 @@ NS_IMETHODIMP nsMsgFolderCacheElement::S</span>
<a href="#l62.4"></a><span id="l62.4">   }</span>
<a href="#l62.5"></a><span id="l62.5">   return rv;</span>
<a href="#l62.6"></a><span id="l62.6"> }</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> NS_IMETHODIMP nsMsgFolderCacheElement::SetInt32Property(const char *propertyName, int32_t propertyValue)</span>
<a href="#l62.9"></a><span id="l62.9"> {</span>
<a href="#l62.10"></a><span id="l62.10">   NS_ENSURE_ARG_POINTER(propertyName);</span>
<a href="#l62.11"></a><span id="l62.11">   NS_ENSURE_TRUE(m_mdbRow, NS_ERROR_FAILURE);</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  nsCAutoString propertyStr;</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+  nsAutoCString propertyStr;</span>
<a href="#l62.14"></a><span id="l62.14">   propertyStr.AppendInt(propertyValue, 16);</span>
<a href="#l62.15"></a><span id="l62.15">   return SetStringProperty(propertyName, propertyStr);</span>
<a href="#l62.16"></a><span id="l62.16"> }</span>
<a href="#l62.17"></a><span id="l62.17"> </span>
<a href="#l62.18"></a><span id="l62.18"> void nsMsgFolderCacheElement::SetMDBRow(nsIMdbRow *row)</span>
<a href="#l62.19"></a><span id="l62.19"> {</span>
<a href="#l62.20"></a><span id="l62.20">   if (m_mdbRow)</span>
<a href="#l62.21"></a><span id="l62.21">     NS_RELEASE(m_mdbRow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -384,17 +384,17 @@ nsFolderCompactState::FinishCompact()</span>
<a href="#l63.4"></a><span id="l63.4">   folderPath-&gt;InitWithFile(path);</span>
<a href="#l63.5"></a><span id="l63.5">   // need to make sure we put the .msf file in the same directory</span>
<a href="#l63.6"></a><span id="l63.6">   // as the original mailbox, so resolve symlinks.</span>
<a href="#l63.7"></a><span id="l63.7">   folderPath-&gt;SetFollowLinks(true);</span>
<a href="#l63.8"></a><span id="l63.8">   GetSummaryFileLocation(folderPath, getter_AddRefs(summaryFile));</span>
<a href="#l63.9"></a><span id="l63.9"> </span>
<a href="#l63.10"></a><span id="l63.10">   nsCString leafName;</span>
<a href="#l63.11"></a><span id="l63.11">   summaryFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  nsCAutoString dbName(leafName);</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+  nsAutoCString dbName(leafName);</span>
<a href="#l63.14"></a><span id="l63.14"> </span>
<a href="#l63.15"></a><span id="l63.15">   path-&gt;GetNativeLeafName(leafName);</span>
<a href="#l63.16"></a><span id="l63.16"> </span>
<a href="#l63.17"></a><span id="l63.17">     // close down the temp file stream; preparing for deleting the old folder</span>
<a href="#l63.18"></a><span id="l63.18">     // and its database; then rename the temp folder and database</span>
<a href="#l63.19"></a><span id="l63.19">   m_fileStream-&gt;Flush();</span>
<a href="#l63.20"></a><span id="l63.20">   m_fileStream-&gt;Close();</span>
<a href="#l63.21"></a><span id="l63.21">   m_fileStream = nullptr;</span>
<a href="#l63.22"></a><span id="l63.22" class="difflineat">@@ -748,17 +748,17 @@ nsFolderCompactState::OnDataAvailable(ns</span>
<a href="#l63.23"></a><span id="l63.23">         { // no keywords, so write blank header</span>
<a href="#l63.24"></a><span id="l63.24">           m_fileStream-&gt;Write(X_MOZILLA_KEYWORDS, sizeof(X_MOZILLA_KEYWORDS) - 1, &amp;bytesWritten);</span>
<a href="#l63.25"></a><span id="l63.25">           m_addedHeaderSize += bytesWritten;</span>
<a href="#l63.26"></a><span id="l63.26">         }</span>
<a href="#l63.27"></a><span id="l63.27">         else</span>
<a href="#l63.28"></a><span id="l63.28">         {</span>
<a href="#l63.29"></a><span id="l63.29">           if (msgHdrKeywords.Length() &lt; sizeof(X_MOZILLA_KEYWORDS) - sizeof(HEADER_X_MOZILLA_KEYWORDS) + 10 /* allow some slop */)</span>
<a href="#l63.30"></a><span id="l63.30">           { // keywords fit in normal blank header, so replace blanks in keyword hdr with keywords</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-            nsCAutoString keywordsHdr(X_MOZILLA_KEYWORDS);</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineplus">+            nsAutoCString keywordsHdr(X_MOZILLA_KEYWORDS);</span>
<a href="#l63.33"></a><span id="l63.33">             keywordsHdr.Replace(sizeof(HEADER_X_MOZILLA_KEYWORDS) + 1, msgHdrKeywords.Length(), msgHdrKeywords);</span>
<a href="#l63.34"></a><span id="l63.34">             m_fileStream-&gt;Write(keywordsHdr.get(), keywordsHdr.Length(), &amp;bytesWritten);</span>
<a href="#l63.35"></a><span id="l63.35">             m_addedHeaderSize += bytesWritten;</span>
<a href="#l63.36"></a><span id="l63.36">           }</span>
<a href="#l63.37"></a><span id="l63.37">           else</span>
<a href="#l63.38"></a><span id="l63.38">           { // keywords don't fit, so write out keywords on one line and an extra blank line</span>
<a href="#l63.39"></a><span id="l63.39">             nsCString newKeywordHeader(HEADER_X_MOZILLA_KEYWORDS &quot;: &quot;);</span>
<a href="#l63.40"></a><span id="l63.40">             newKeywordHeader.Append(msgHdrKeywords);</span>
<a href="#l63.41"></a><span id="l63.41" class="difflineat">@@ -788,17 +788,17 @@ nsFolderCompactState::OnDataAvailable(ns</span>
<a href="#l63.42"></a><span id="l63.42">         }</span>
<a href="#l63.43"></a><span id="l63.43">         int32_t oldKeywordSize = blockOffset - preKeywordBlockOffset;</span>
<a href="#l63.44"></a><span id="l63.44"> </span>
<a href="#l63.45"></a><span id="l63.45">         // rewrite the headers up to and including the x-mozilla-status2 header</span>
<a href="#l63.46"></a><span id="l63.46">         m_fileStream-&gt;Write(m_dataBuffer, preKeywordBlockOffset, &amp;writeCount);</span>
<a href="#l63.47"></a><span id="l63.47">         // let's just rewrite all the keywords on several lines and add a blank line,</span>
<a href="#l63.48"></a><span id="l63.48">         // instead of worrying about which are missing.</span>
<a href="#l63.49"></a><span id="l63.49">         bool done = false;</span>
<a href="#l63.50"></a><span id="l63.50" class="difflineminus">-        nsCAutoString keywordHdr(HEADER_X_MOZILLA_KEYWORDS &quot;: &quot;);</span>
<a href="#l63.51"></a><span id="l63.51" class="difflineplus">+        nsAutoCString keywordHdr(HEADER_X_MOZILLA_KEYWORDS &quot;: &quot;);</span>
<a href="#l63.52"></a><span id="l63.52">         int32_t nextBlankOffset = 0;</span>
<a href="#l63.53"></a><span id="l63.53">         int32_t curHdrLineStart = 0;</span>
<a href="#l63.54"></a><span id="l63.54">         int32_t newKeywordSize = 0;</span>
<a href="#l63.55"></a><span id="l63.55">         while (!done)</span>
<a href="#l63.56"></a><span id="l63.56">         {</span>
<a href="#l63.57"></a><span id="l63.57">           nextBlankOffset = msgHdrKeywords.FindChar(' ', nextBlankOffset);</span>
<a href="#l63.58"></a><span id="l63.58">           if (nextBlankOffset == kNotFound)</span>
<a href="#l63.59"></a><span id="l63.59">           {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -2109,17 +2109,17 @@ nsMsgFlatFolderDataSource::~nsMsgFlatFol</span>
<a href="#l64.4"></a><span id="l64.4"> {</span>
<a href="#l64.5"></a><span id="l64.5"> }</span>
<a href="#l64.6"></a><span id="l64.6"> </span>
<a href="#l64.7"></a><span id="l64.7"> nsresult nsMsgFlatFolderDataSource::Init()</span>
<a href="#l64.8"></a><span id="l64.8"> {</span>
<a href="#l64.9"></a><span id="l64.9">   nsIRDFService* rdf = getRDFService();</span>
<a href="#l64.10"></a><span id="l64.10">   NS_ENSURE_TRUE(rdf, NS_ERROR_FAILURE);</span>
<a href="#l64.11"></a><span id="l64.11">   nsCOMPtr&lt;nsIRDFResource&gt; source;</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  nsCAutoString dsUri(m_dsName);</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  nsAutoCString dsUri(m_dsName);</span>
<a href="#l64.14"></a><span id="l64.14">   dsUri.Append(&quot;:/&quot;);</span>
<a href="#l64.15"></a><span id="l64.15">   rdf-&gt;GetResource(dsUri, getter_AddRefs(m_rootResource));</span>
<a href="#l64.16"></a><span id="l64.16"> </span>
<a href="#l64.17"></a><span id="l64.17">   return nsMsgFolderDataSource::Init();</span>
<a href="#l64.18"></a><span id="l64.18"> }</span>
<a href="#l64.19"></a><span id="l64.19"> </span>
<a href="#l64.20"></a><span id="l64.20"> void nsMsgFlatFolderDataSource::Cleanup()</span>
<a href="#l64.21"></a><span id="l64.21"> {</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineat">@@ -2208,17 +2208,17 @@ void nsMsgFlatFolderDataSource::EnsureFo</span>
<a href="#l64.23"></a><span id="l64.23">       }</span>
<a href="#l64.24"></a><span id="l64.24">     }</span>
<a href="#l64.25"></a><span id="l64.25">   }</span>
<a href="#l64.26"></a><span id="l64.26"> }</span>
<a href="#l64.27"></a><span id="l64.27"> </span>
<a href="#l64.28"></a><span id="l64.28"> </span>
<a href="#l64.29"></a><span id="l64.29"> NS_IMETHODIMP nsMsgFlatFolderDataSource::GetURI(char* *aUri)</span>
<a href="#l64.30"></a><span id="l64.30"> {</span>
<a href="#l64.31"></a><span id="l64.31" class="difflineminus">-  nsCAutoString uri(&quot;rdf:&quot;);</span>
<a href="#l64.32"></a><span id="l64.32" class="difflineplus">+  nsAutoCString uri(&quot;rdf:&quot;);</span>
<a href="#l64.33"></a><span id="l64.33">   uri.Append(m_dsName);</span>
<a href="#l64.34"></a><span id="l64.34">   return (*aUri = ToNewCString(uri))</span>
<a href="#l64.35"></a><span id="l64.35">     ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l64.36"></a><span id="l64.36"> }</span>
<a href="#l64.37"></a><span id="l64.37"> </span>
<a href="#l64.38"></a><span id="l64.38"> NS_IMETHODIMP nsMsgFlatFolderDataSource::HasAssertion(nsIRDFResource* source,</span>
<a href="#l64.39"></a><span id="l64.39">                             nsIRDFResource* property,</span>
<a href="#l64.40"></a><span id="l64.40">                             nsIRDFNode* target,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -159,17 +159,17 @@ protected:</span>
<a href="#l65.4"></a><span id="l65.4">                         nsIMsgWindow *window);</span>
<a href="#l65.5"></a><span id="l65.5"> </span>
<a href="#l65.6"></a><span id="l65.6">   nsresult DoFolderAssert(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target);</span>
<a href="#l65.7"></a><span id="l65.7">   nsresult DoFolderUnassert(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target);</span>
<a href="#l65.8"></a><span id="l65.8"> </span>
<a href="#l65.9"></a><span id="l65.9">   nsresult DoFolderHasAssertion(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target,</span>
<a href="#l65.10"></a><span id="l65.10">                                 bool tv, bool *hasAssertion);</span>
<a href="#l65.11"></a><span id="l65.11"> </span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  nsresult GetBiffStateString(uint32_t biffState, nsCAutoString &amp; biffStateStr);</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+  nsresult GetBiffStateString(uint32_t biffState, nsAutoCString &amp; biffStateStr);</span>
<a href="#l65.14"></a><span id="l65.14"> </span>
<a href="#l65.15"></a><span id="l65.15">   nsresult CreateUnreadMessagesNameString(int32_t unreadMessages, nsAutoString &amp;nameString);</span>
<a href="#l65.16"></a><span id="l65.16">   nsresult CreateArcsOutEnumerator();</span>
<a href="#l65.17"></a><span id="l65.17"> </span>
<a href="#l65.18"></a><span id="l65.18">   virtual nsresult OnItemAddedOrRemoved(nsIMsgFolder *parentItem, nsISupports *item, bool added);</span>
<a href="#l65.19"></a><span id="l65.19"> </span>
<a href="#l65.20"></a><span id="l65.20">   nsresult OnUnreadMessagePropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue);</span>
<a href="#l65.21"></a><span id="l65.21">   nsresult OnTotalMessagePropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -414,17 +414,17 @@ nsMsgMailSession::ConvertMsgURIToMsgURL(</span>
<a href="#l66.4"></a><span id="l66.4">   nsCOMPtr &lt;nsIMsgMessageService&gt; msgService;</span>
<a href="#l66.5"></a><span id="l66.5">   nsresult rv = GetMessageServiceFromURI(nsDependentCString(aURI), getter_AddRefs(msgService));</span>
<a href="#l66.6"></a><span id="l66.6">   NS_ENSURE_SUCCESS(rv, NS_ERROR_NULL_POINTER);</span>
<a href="#l66.7"></a><span id="l66.7"> </span>
<a href="#l66.8"></a><span id="l66.8">   nsCOMPtr&lt;nsIURI&gt; tURI;</span>
<a href="#l66.9"></a><span id="l66.9">   rv = msgService-&gt;GetUrlForUri(aURI, getter_AddRefs(tURI), aMsgWindow);</span>
<a href="#l66.10"></a><span id="l66.10">   NS_ENSURE_SUCCESS(rv, NS_ERROR_NULL_POINTER);</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-  nsCAutoString urlString;</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+  nsAutoCString urlString;</span>
<a href="#l66.14"></a><span id="l66.14">   if (NS_SUCCEEDED(tURI-&gt;GetSpec(urlString)))</span>
<a href="#l66.15"></a><span id="l66.15">   {</span>
<a href="#l66.16"></a><span id="l66.16">     *aURL = ToNewCString(urlString);</span>
<a href="#l66.17"></a><span id="l66.17">     NS_ENSURE_ARG_POINTER(aURL);</span>
<a href="#l66.18"></a><span id="l66.18">   }</span>
<a href="#l66.19"></a><span id="l66.19">   return rv;</span>
<a href="#l66.20"></a><span id="l66.20"> }</span>
<a href="#l66.21"></a><span id="l66.21"> </span>
<a href="#l66.22"></a><span id="l66.22" class="difflineat">@@ -440,17 +440,17 @@ nsMsgMailSession::GetSelectedLocaleDataD</span>
<a href="#l66.23"></a><span id="l66.23">   bool baseDirExists = false;</span>
<a href="#l66.24"></a><span id="l66.24">   nsresult rv = defaultsDir-&gt;Exists(&amp;baseDirExists);</span>
<a href="#l66.25"></a><span id="l66.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l66.26"></a><span id="l66.26"> </span>
<a href="#l66.27"></a><span id="l66.27">   if (baseDirExists) {</span>
<a href="#l66.28"></a><span id="l66.28">     nsCOMPtr&lt;nsIXULChromeRegistry&gt; packageRegistry =</span>
<a href="#l66.29"></a><span id="l66.29">       mozilla::services::GetXULChromeRegistryService();</span>
<a href="#l66.30"></a><span id="l66.30">     if (packageRegistry) {</span>
<a href="#l66.31"></a><span id="l66.31" class="difflineminus">-      nsCAutoString localeName;</span>
<a href="#l66.32"></a><span id="l66.32" class="difflineplus">+      nsAutoCString localeName;</span>
<a href="#l66.33"></a><span id="l66.33">       rv = packageRegistry-&gt;GetSelectedLocale(NS_LITERAL_CSTRING(&quot;global-region&quot;), localeName);</span>
<a href="#l66.34"></a><span id="l66.34"> </span>
<a href="#l66.35"></a><span id="l66.35">       if (NS_SUCCEEDED(rv) &amp;&amp; !localeName.IsEmpty()) {</span>
<a href="#l66.36"></a><span id="l66.36">         bool localeDirExists = false;</span>
<a href="#l66.37"></a><span id="l66.37">         nsCOMPtr&lt;nsIFile&gt; localeDataDir;</span>
<a href="#l66.38"></a><span id="l66.38"> </span>
<a href="#l66.39"></a><span id="l66.39">         rv = defaultsDir-&gt;Clone(getter_AddRefs(localeDataDir));</span>
<a href="#l66.40"></a><span id="l66.40">         NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -137,17 +137,17 @@ nsMsgPrintEngine::OnStateChange(nsIWebPr</span>
<a href="#l67.4"></a><span id="l67.4">           }</span>
<a href="#l67.5"></a><span id="l67.5">           nsCOMPtr&lt;nsIChannel&gt; aChannel = do_QueryInterface(aRequest);</span>
<a href="#l67.6"></a><span id="l67.6">           if (!aChannel) return NS_ERROR_FAILURE;</span>
<a href="#l67.7"></a><span id="l67.7"> </span>
<a href="#l67.8"></a><span id="l67.8">           // Make sure this isn't just &quot;about:blank&quot; finishing....</span>
<a href="#l67.9"></a><span id="l67.9">           nsCOMPtr&lt;nsIURI&gt; originalURI = nullptr;</span>
<a href="#l67.10"></a><span id="l67.10">           if (NS_SUCCEEDED(aChannel-&gt;GetOriginalURI(getter_AddRefs(originalURI))) &amp;&amp; originalURI)</span>
<a href="#l67.11"></a><span id="l67.11">           {</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-            nsCAutoString spec;</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+            nsAutoCString spec;</span>
<a href="#l67.14"></a><span id="l67.14"> </span>
<a href="#l67.15"></a><span id="l67.15">             if (NS_SUCCEEDED(originalURI-&gt;GetSpec(spec)))</span>
<a href="#l67.16"></a><span id="l67.16">             {      </span>
<a href="#l67.17"></a><span id="l67.17">               if (spec.Equals(&quot;about:blank&quot;))</span>
<a href="#l67.18"></a><span id="l67.18">               {</span>
<a href="#l67.19"></a><span id="l67.19">                 return StartNextPrintOperation();</span>
<a href="#l67.20"></a><span id="l67.20">               }</span>
<a href="#l67.21"></a><span id="l67.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPurgeService.cpp</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPurgeService.cpp</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -223,17 +223,17 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l68.4"></a><span id="l68.4">               }</span>
<a href="#l68.5"></a><span id="l68.5">             }</span>
<a href="#l68.6"></a><span id="l68.6">           }</span>
<a href="#l68.7"></a><span id="l68.7">         }</span>
<a href="#l68.8"></a><span id="l68.8">         nsCString type;</span>
<a href="#l68.9"></a><span id="l68.9">         nsresult rv = server-&gt;GetType(type);</span>
<a href="#l68.10"></a><span id="l68.10">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l68.11"></a><span id="l68.11"> </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-        nsCAutoString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+        nsAutoCString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l68.14"></a><span id="l68.14">         contractid.Append(type);</span>
<a href="#l68.15"></a><span id="l68.15"> </span>
<a href="#l68.16"></a><span id="l68.16">         nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo =</span>
<a href="#l68.17"></a><span id="l68.17">           do_GetService(contractid.get(), &amp;rv);</span>
<a href="#l68.18"></a><span id="l68.18">         NS_ENSURE_SUCCESS(rv, NS_OK);</span>
<a href="#l68.19"></a><span id="l68.19"> </span>
<a href="#l68.20"></a><span id="l68.20">         nsCString realHostName;</span>
<a href="#l68.21"></a><span id="l68.21">         server-&gt;GetRealHostName(realHostName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -1253,31 +1253,31 @@ nsMsgViewIndex nsMsgSearchDBView::FindHd</span>
<a href="#l69.4"></a><span id="l69.4"> // first by looking up the message id, then references, and finally, if subject</span>
<a href="#l69.5"></a><span id="l69.5"> // threading is turned on, the subject.</span>
<a href="#l69.6"></a><span id="l69.6"> nsresult nsMsgSearchDBView::GetXFThreadFromMsgHdr(nsIMsgDBHdr *msgHdr, </span>
<a href="#l69.7"></a><span id="l69.7">                                                   nsIMsgThread **pThread,</span>
<a href="#l69.8"></a><span id="l69.8">                                                   bool *foundByMessageId)</span>
<a href="#l69.9"></a><span id="l69.9"> {</span>
<a href="#l69.10"></a><span id="l69.10">   NS_ENSURE_ARG_POINTER(pThread);</span>
<a href="#l69.11"></a><span id="l69.11"> </span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-  nsCAutoString messageId;</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+  nsAutoCString messageId;</span>
<a href="#l69.14"></a><span id="l69.14">   msgHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l69.15"></a><span id="l69.15">   *pThread = nullptr;</span>
<a href="#l69.16"></a><span id="l69.16">   m_threadsTable.Get(messageId, pThread);</span>
<a href="#l69.17"></a><span id="l69.17">   // The caller may want to know if we found the thread by the msgHdr's</span>
<a href="#l69.18"></a><span id="l69.18">   // messageId</span>
<a href="#l69.19"></a><span id="l69.19">   if (foundByMessageId)</span>
<a href="#l69.20"></a><span id="l69.20">     *foundByMessageId = *pThread != nullptr;</span>
<a href="#l69.21"></a><span id="l69.21">   if (!*pThread)</span>
<a href="#l69.22"></a><span id="l69.22">   {</span>
<a href="#l69.23"></a><span id="l69.23">     uint16_t numReferences = 0;</span>
<a href="#l69.24"></a><span id="l69.24">     msgHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l69.25"></a><span id="l69.25">     for (int32_t i = numReferences - 1; i &gt;= 0  &amp;&amp; !*pThread; i--)</span>
<a href="#l69.26"></a><span id="l69.26">     {</span>
<a href="#l69.27"></a><span id="l69.27" class="difflineminus">-      nsCAutoString reference;</span>
<a href="#l69.28"></a><span id="l69.28" class="difflineplus">+      nsAutoCString reference;</span>
<a href="#l69.29"></a><span id="l69.29">       </span>
<a href="#l69.30"></a><span id="l69.30">       msgHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l69.31"></a><span id="l69.31">       if (reference.IsEmpty())</span>
<a href="#l69.32"></a><span id="l69.32">         break;</span>
<a href="#l69.33"></a><span id="l69.33"> </span>
<a href="#l69.34"></a><span id="l69.34">       m_threadsTable.Get(reference, pThread);</span>
<a href="#l69.35"></a><span id="l69.35">     }</span>
<a href="#l69.36"></a><span id="l69.36">   }</span>
<a href="#l69.37"></a><span id="l69.37" class="difflineat">@@ -1324,17 +1324,17 @@ nsresult nsMsgSearchDBView::AddMsgToHash</span>
<a href="#l69.38"></a><span id="l69.38">   NS_ENSURE_ARG_POINTER(msgHdr);</span>
<a href="#l69.39"></a><span id="l69.39"> </span>
<a href="#l69.40"></a><span id="l69.40">   uint16_t numReferences = 0;</span>
<a href="#l69.41"></a><span id="l69.41">   nsresult rv;</span>
<a href="#l69.42"></a><span id="l69.42"> </span>
<a href="#l69.43"></a><span id="l69.43">   msgHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l69.44"></a><span id="l69.44">   for (int32_t i = 0; i &lt; numReferences; i++)</span>
<a href="#l69.45"></a><span id="l69.45">   {</span>
<a href="#l69.46"></a><span id="l69.46" class="difflineminus">-    nsCAutoString reference;</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineplus">+    nsAutoCString reference;</span>
<a href="#l69.48"></a><span id="l69.48"> </span>
<a href="#l69.49"></a><span id="l69.49">     msgHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l69.50"></a><span id="l69.50">     if (reference.IsEmpty())</span>
<a href="#l69.51"></a><span id="l69.51">       break;</span>
<a href="#l69.52"></a><span id="l69.52"> </span>
<a href="#l69.53"></a><span id="l69.53">     rv = AddRefToHash(reference, thread);</span>
<a href="#l69.54"></a><span id="l69.54">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l69.55"></a><span id="l69.55">   }</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineat">@@ -1364,17 +1364,17 @@ nsresult nsMsgSearchDBView::RemoveMsgFro</span>
<a href="#l69.57"></a><span id="l69.57"> </span>
<a href="#l69.58"></a><span id="l69.58">   uint16_t numReferences = 0;</span>
<a href="#l69.59"></a><span id="l69.59">   nsresult rv = NS_OK;</span>
<a href="#l69.60"></a><span id="l69.60"> </span>
<a href="#l69.61"></a><span id="l69.61">   msgHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l69.62"></a><span id="l69.62"> </span>
<a href="#l69.63"></a><span id="l69.63">   for (int32_t i = 0; i &lt; numReferences; i++)</span>
<a href="#l69.64"></a><span id="l69.64">   {</span>
<a href="#l69.65"></a><span id="l69.65" class="difflineminus">-    nsCAutoString reference;</span>
<a href="#l69.66"></a><span id="l69.66" class="difflineplus">+    nsAutoCString reference;</span>
<a href="#l69.67"></a><span id="l69.67">     msgHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l69.68"></a><span id="l69.68">     if (reference.IsEmpty())</span>
<a href="#l69.69"></a><span id="l69.69">       break;</span>
<a href="#l69.70"></a><span id="l69.70"> </span>
<a href="#l69.71"></a><span id="l69.71">     rv = RemoveRefFromHash(reference);</span>
<a href="#l69.72"></a><span id="l69.72">     if (NS_FAILED(rv))</span>
<a href="#l69.73"></a><span id="l69.73">       break;</span>
<a href="#l69.74"></a><span id="l69.74">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/base/src/nsMsgServiceProvider.cpp</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgServiceProvider.cpp</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -102,17 +102,17 @@ void nsMsgServiceProviderService::LoadIS</span>
<a href="#l70.4"></a><span id="l70.4">   // we only care about the .rdf files in this directory</span>
<a href="#l70.5"></a><span id="l70.5">   nsCOMPtr&lt;nsIFile&gt; file;</span>
<a href="#l70.6"></a><span id="l70.6">   while (NS_SUCCEEDED(files-&gt;GetNextFile(getter_AddRefs(file))) &amp;&amp; file) {</span>
<a href="#l70.7"></a><span id="l70.7">     nsAutoString leafName;</span>
<a href="#l70.8"></a><span id="l70.8">     file-&gt;GetLeafName(leafName);</span>
<a href="#l70.9"></a><span id="l70.9">     if (!StringEndsWith(leafName, NS_LITERAL_STRING(&quot;.rdf&quot;)))</span>
<a href="#l70.10"></a><span id="l70.10">       continue;</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-    nsCAutoString urlSpec;</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+    nsAutoCString urlSpec;</span>
<a href="#l70.14"></a><span id="l70.14">     rv = NS_GetURLSpecFromFile(file, urlSpec);</span>
<a href="#l70.15"></a><span id="l70.15">     if (NS_SUCCEEDED(rv))</span>
<a href="#l70.16"></a><span id="l70.16">       LoadDataSource(urlSpec.get());</span>
<a href="#l70.17"></a><span id="l70.17">   }</span>
<a href="#l70.18"></a><span id="l70.18"> }</span>
<a href="#l70.19"></a><span id="l70.19"> </span>
<a href="#l70.20"></a><span id="l70.20"> nsresult</span>
<a href="#l70.21"></a><span id="l70.21"> nsMsgServiceProviderService::LoadDataSource(const char *aURI)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -50,17 +50,17 @@ CompareMsgTags(const void* aTagPref1, co</span>
<a href="#l71.4"></a><span id="l71.4">   if (!element1 &amp;&amp; !element2)</span>
<a href="#l71.5"></a><span id="l71.5">     return TAG_CMP_EQUAL;</span>
<a href="#l71.6"></a><span id="l71.6">   if (!element2)</span>
<a href="#l71.7"></a><span id="l71.7">     return TAG_CMP_LESSER;</span>
<a href="#l71.8"></a><span id="l71.8">   if (!element1)</span>
<a href="#l71.9"></a><span id="l71.9">     return TAG_CMP_GREATER;</span>
<a href="#l71.10"></a><span id="l71.10"> </span>
<a href="#l71.11"></a><span id="l71.11">   // only use the key if the ordinal is not defined or empty</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-  nsCAutoString value1, value2;</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+  nsAutoCString value1, value2;</span>
<a href="#l71.14"></a><span id="l71.14">   element1-&gt;GetOrdinal(value1);</span>
<a href="#l71.15"></a><span id="l71.15">   if (value1.IsEmpty())</span>
<a href="#l71.16"></a><span id="l71.16">     element1-&gt;GetKey(value1);</span>
<a href="#l71.17"></a><span id="l71.17">   element2-&gt;GetOrdinal(value2);</span>
<a href="#l71.18"></a><span id="l71.18">   if (value2.IsEmpty())</span>
<a href="#l71.19"></a><span id="l71.19">     element2-&gt;GetKey(value2);</span>
<a href="#l71.20"></a><span id="l71.20"> </span>
<a href="#l71.21"></a><span id="l71.21">   return strcmp(value1.get(), value2.get());</span>
<a href="#l71.22"></a><span id="l71.22" class="difflineat">@@ -135,27 +135,27 @@ nsMsgTagService::nsMsgTagService()</span>
<a href="#l71.23"></a><span id="l71.23"> nsMsgTagService::~nsMsgTagService()</span>
<a href="#l71.24"></a><span id="l71.24"> {</span>
<a href="#l71.25"></a><span id="l71.25">   /* destructor code */</span>
<a href="#l71.26"></a><span id="l71.26"> }</span>
<a href="#l71.27"></a><span id="l71.27"> </span>
<a href="#l71.28"></a><span id="l71.28"> /* wstring getTagForKey (in string key); */</span>
<a href="#l71.29"></a><span id="l71.29"> NS_IMETHODIMP nsMsgTagService::GetTagForKey(const nsACString &amp;key, nsAString &amp;_retval)</span>
<a href="#l71.30"></a><span id="l71.30"> {</span>
<a href="#l71.31"></a><span id="l71.31" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.33"></a><span id="l71.33">   if (!gMigratingKeys)</span>
<a href="#l71.34"></a><span id="l71.34">     ToLowerCase(prefName);</span>
<a href="#l71.35"></a><span id="l71.35">   prefName.AppendLiteral(TAG_PREF_SUFFIX_TAG);</span>
<a href="#l71.36"></a><span id="l71.36">   return GetUnicharPref(prefName.get(), _retval);</span>
<a href="#l71.37"></a><span id="l71.37"> }</span>
<a href="#l71.38"></a><span id="l71.38"> </span>
<a href="#l71.39"></a><span id="l71.39"> /* void setTagForKey (in string key); */</span>
<a href="#l71.40"></a><span id="l71.40"> NS_IMETHODIMP nsMsgTagService::SetTagForKey(const nsACString &amp;key, const nsAString &amp;tag )</span>
<a href="#l71.41"></a><span id="l71.41"> {</span>
<a href="#l71.42"></a><span id="l71.42" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.43"></a><span id="l71.43" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.44"></a><span id="l71.44">   ToLowerCase(prefName);</span>
<a href="#l71.45"></a><span id="l71.45">   prefName.AppendLiteral(TAG_PREF_SUFFIX_TAG);</span>
<a href="#l71.46"></a><span id="l71.46">   return SetUnicharPref(prefName.get(), tag);</span>
<a href="#l71.47"></a><span id="l71.47"> }</span>
<a href="#l71.48"></a><span id="l71.48"> </span>
<a href="#l71.49"></a><span id="l71.49"> /* void getKeyForTag (in wstring tag); */</span>
<a href="#l71.50"></a><span id="l71.50"> NS_IMETHODIMP nsMsgTagService::GetKeyForTag(const nsAString &amp;aTag, nsACString &amp;aKey)</span>
<a href="#l71.51"></a><span id="l71.51"> {</span>
<a href="#l71.52"></a><span id="l71.52" class="difflineat">@@ -223,17 +223,17 @@ NS_IMETHODIMP nsMsgTagService::GetTopKey</span>
<a href="#l71.53"></a><span id="l71.53"> }</span>
<a href="#l71.54"></a><span id="l71.54"> </span>
<a href="#l71.55"></a><span id="l71.55"> /* void addTagForKey (in string key, in wstring tag, in string color, in string ordinal); */</span>
<a href="#l71.56"></a><span id="l71.56"> NS_IMETHODIMP nsMsgTagService::AddTagForKey(const nsACString &amp;key,</span>
<a href="#l71.57"></a><span id="l71.57">                                             const nsAString  &amp;tag,</span>
<a href="#l71.58"></a><span id="l71.58">                                             const nsACString &amp;color,</span>
<a href="#l71.59"></a><span id="l71.59">                                             const nsACString &amp;ordinal)</span>
<a href="#l71.60"></a><span id="l71.60"> {</span>
<a href="#l71.61"></a><span id="l71.61" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.62"></a><span id="l71.62" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.63"></a><span id="l71.63">   ToLowerCase(prefName);</span>
<a href="#l71.64"></a><span id="l71.64">   prefName.AppendLiteral(TAG_PREF_SUFFIX_TAG);</span>
<a href="#l71.65"></a><span id="l71.65">   nsresult rv = SetUnicharPref(prefName.get(), tag);</span>
<a href="#l71.66"></a><span id="l71.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.67"></a><span id="l71.67">   rv = SetColorForKey(key, color);</span>
<a href="#l71.68"></a><span id="l71.68">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.69"></a><span id="l71.69">   rv = RefreshKeyCache();</span>
<a href="#l71.70"></a><span id="l71.70">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.71"></a><span id="l71.71" class="difflineat">@@ -247,94 +247,94 @@ NS_IMETHODIMP nsMsgTagService::AddTag(co</span>
<a href="#l71.72"></a><span id="l71.72"> {</span>
<a href="#l71.73"></a><span id="l71.73">   // figure out key from tag. Apply transformation stripping out</span>
<a href="#l71.74"></a><span id="l71.74">   // illegal characters like &lt;SP&gt; and then convert to imap mod utf7.</span>
<a href="#l71.75"></a><span id="l71.75">   // Then, check if we have a tag with that key yet, and if so,</span>
<a href="#l71.76"></a><span id="l71.76">   // make it unique by appending A, AA, etc.</span>
<a href="#l71.77"></a><span id="l71.77">   // Should we use an iterator?</span>
<a href="#l71.78"></a><span id="l71.78">   nsAutoString transformedTag(tag);</span>
<a href="#l71.79"></a><span id="l71.79">   MsgReplaceChar(transformedTag, &quot; ()/{%*&lt;&gt;\\\&quot;&quot;, '_');</span>
<a href="#l71.80"></a><span id="l71.80" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l71.81"></a><span id="l71.81" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l71.82"></a><span id="l71.82">   CopyUTF16toMUTF7(transformedTag, key);</span>
<a href="#l71.83"></a><span id="l71.83">   // We have an imap server that converts keys to upper case so we're going</span>
<a href="#l71.84"></a><span id="l71.84">   // to normalize all keys to lower case (upper case looks ugly in prefs.js)</span>
<a href="#l71.85"></a><span id="l71.85">   ToLowerCase(key);</span>
<a href="#l71.86"></a><span id="l71.86" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.87"></a><span id="l71.87" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.88"></a><span id="l71.88">   while (true)</span>
<a href="#l71.89"></a><span id="l71.89">   {</span>
<a href="#l71.90"></a><span id="l71.90">     nsAutoString tagValue;</span>
<a href="#l71.91"></a><span id="l71.91">     nsresult rv = GetTagForKey(prefName, tagValue);</span>
<a href="#l71.92"></a><span id="l71.92">     if (NS_FAILED(rv) || tagValue.IsEmpty() || tagValue.Equals(tag))</span>
<a href="#l71.93"></a><span id="l71.93">       return AddTagForKey(prefName, tag, color, ordinal);</span>
<a href="#l71.94"></a><span id="l71.94">     prefName.Append('A');</span>
<a href="#l71.95"></a><span id="l71.95">   }</span>
<a href="#l71.96"></a><span id="l71.96">   NS_ASSERTION(false, &quot;can't get here&quot;);</span>
<a href="#l71.97"></a><span id="l71.97">   return NS_ERROR_FAILURE;</span>
<a href="#l71.98"></a><span id="l71.98"> }</span>
<a href="#l71.99"></a><span id="l71.99"> </span>
<a href="#l71.100"></a><span id="l71.100"> /* long getColorForKey (in string key); */</span>
<a href="#l71.101"></a><span id="l71.101"> NS_IMETHODIMP nsMsgTagService::GetColorForKey(const nsACString &amp;key, nsACString  &amp;_retval)</span>
<a href="#l71.102"></a><span id="l71.102"> {</span>
<a href="#l71.103"></a><span id="l71.103" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.104"></a><span id="l71.104" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.105"></a><span id="l71.105">   if (!gMigratingKeys)</span>
<a href="#l71.106"></a><span id="l71.106">     ToLowerCase(prefName);</span>
<a href="#l71.107"></a><span id="l71.107">   prefName.AppendLiteral(TAG_PREF_SUFFIX_COLOR);</span>
<a href="#l71.108"></a><span id="l71.108">   nsCString color;</span>
<a href="#l71.109"></a><span id="l71.109">   nsresult rv = m_tagPrefBranch-&gt;GetCharPref(prefName.get(), getter_Copies(color));</span>
<a href="#l71.110"></a><span id="l71.110">   if (NS_SUCCEEDED(rv))</span>
<a href="#l71.111"></a><span id="l71.111">     _retval = color;</span>
<a href="#l71.112"></a><span id="l71.112">   return NS_OK;</span>
<a href="#l71.113"></a><span id="l71.113"> }</span>
<a href="#l71.114"></a><span id="l71.114"> </span>
<a href="#l71.115"></a><span id="l71.115"> /* void setColorForKey (in ACString key, in ACString color); */</span>
<a href="#l71.116"></a><span id="l71.116"> NS_IMETHODIMP nsMsgTagService::SetColorForKey(const nsACString &amp; key, const nsACString &amp; color)</span>
<a href="#l71.117"></a><span id="l71.117"> {</span>
<a href="#l71.118"></a><span id="l71.118" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.119"></a><span id="l71.119" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.120"></a><span id="l71.120">   ToLowerCase(prefName);</span>
<a href="#l71.121"></a><span id="l71.121">   prefName.AppendLiteral(TAG_PREF_SUFFIX_COLOR);</span>
<a href="#l71.122"></a><span id="l71.122">   if (color.IsEmpty())</span>
<a href="#l71.123"></a><span id="l71.123">   {</span>
<a href="#l71.124"></a><span id="l71.124">     m_tagPrefBranch-&gt;ClearUserPref(prefName.get());</span>
<a href="#l71.125"></a><span id="l71.125">     return NS_OK;</span>
<a href="#l71.126"></a><span id="l71.126">   }</span>
<a href="#l71.127"></a><span id="l71.127">   return m_tagPrefBranch-&gt;SetCharPref(prefName.get(), nsCString(color).get());</span>
<a href="#l71.128"></a><span id="l71.128"> }</span>
<a href="#l71.129"></a><span id="l71.129"> </span>
<a href="#l71.130"></a><span id="l71.130"> /* ACString getOrdinalForKey (in ACString key); */</span>
<a href="#l71.131"></a><span id="l71.131"> NS_IMETHODIMP nsMsgTagService::GetOrdinalForKey(const nsACString &amp; key, nsACString &amp; _retval)</span>
<a href="#l71.132"></a><span id="l71.132"> {</span>
<a href="#l71.133"></a><span id="l71.133" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.134"></a><span id="l71.134" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.135"></a><span id="l71.135">   if (!gMigratingKeys)</span>
<a href="#l71.136"></a><span id="l71.136">     ToLowerCase(prefName);</span>
<a href="#l71.137"></a><span id="l71.137">   prefName.AppendLiteral(TAG_PREF_SUFFIX_ORDINAL);</span>
<a href="#l71.138"></a><span id="l71.138">   nsCString ordinal;</span>
<a href="#l71.139"></a><span id="l71.139">   nsresult rv = m_tagPrefBranch-&gt;GetCharPref(prefName.get(), getter_Copies(ordinal));</span>
<a href="#l71.140"></a><span id="l71.140">   _retval = ordinal;</span>
<a href="#l71.141"></a><span id="l71.141">   return rv;</span>
<a href="#l71.142"></a><span id="l71.142"> }</span>
<a href="#l71.143"></a><span id="l71.143"> </span>
<a href="#l71.144"></a><span id="l71.144"> /* void setOrdinalForKey (in ACString key, in ACString ordinal); */</span>
<a href="#l71.145"></a><span id="l71.145"> NS_IMETHODIMP nsMsgTagService::SetOrdinalForKey(const nsACString &amp; key, const nsACString &amp; ordinal)</span>
<a href="#l71.146"></a><span id="l71.146"> {</span>
<a href="#l71.147"></a><span id="l71.147" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.148"></a><span id="l71.148" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.149"></a><span id="l71.149">   ToLowerCase(prefName);</span>
<a href="#l71.150"></a><span id="l71.150">   prefName.AppendLiteral(TAG_PREF_SUFFIX_ORDINAL);</span>
<a href="#l71.151"></a><span id="l71.151">   if (ordinal.IsEmpty())</span>
<a href="#l71.152"></a><span id="l71.152">   {</span>
<a href="#l71.153"></a><span id="l71.153">     m_tagPrefBranch-&gt;ClearUserPref(prefName.get());</span>
<a href="#l71.154"></a><span id="l71.154">     return NS_OK;</span>
<a href="#l71.155"></a><span id="l71.155">   }</span>
<a href="#l71.156"></a><span id="l71.156">   return m_tagPrefBranch-&gt;SetCharPref(prefName.get(), nsCString(ordinal).get());</span>
<a href="#l71.157"></a><span id="l71.157"> }</span>
<a href="#l71.158"></a><span id="l71.158"> </span>
<a href="#l71.159"></a><span id="l71.159"> /* void deleteTag (in wstring tag); */</span>
<a href="#l71.160"></a><span id="l71.160"> NS_IMETHODIMP nsMsgTagService::DeleteKey(const nsACString &amp;key)</span>
<a href="#l71.161"></a><span id="l71.161"> {</span>
<a href="#l71.162"></a><span id="l71.162">   // clear the associated prefs</span>
<a href="#l71.163"></a><span id="l71.163" class="difflineminus">-  nsCAutoString prefName(key);</span>
<a href="#l71.164"></a><span id="l71.164" class="difflineplus">+  nsAutoCString prefName(key);</span>
<a href="#l71.165"></a><span id="l71.165">   if (!gMigratingKeys)</span>
<a href="#l71.166"></a><span id="l71.166">     ToLowerCase(prefName);</span>
<a href="#l71.167"></a><span id="l71.167">   nsresult rv = m_tagPrefBranch-&gt;DeleteBranch(prefName.get());</span>
<a href="#l71.168"></a><span id="l71.168">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.169"></a><span id="l71.169">   return RefreshKeyCache();</span>
<a href="#l71.170"></a><span id="l71.170"> }</span>
<a href="#l71.171"></a><span id="l71.171"> </span>
<a href="#l71.172"></a><span id="l71.172"> /* void getAllTags (out unsigned long count, [array, size_is (count), retval] out nsIMsgTag tagArray); */</span>
<a href="#l71.173"></a><span id="l71.173" class="difflineat">@@ -370,17 +370,17 @@ NS_IMETHODIMP nsMsgTagService::GetAllTag</span>
<a href="#l71.174"></a><span id="l71.174">   nsString tag;</span>
<a href="#l71.175"></a><span id="l71.175">   nsCString lastKey, color, ordinal;</span>
<a href="#l71.176"></a><span id="l71.176">   for (uint32_t i = prefCount; i--;)</span>
<a href="#l71.177"></a><span id="l71.177">   {</span>
<a href="#l71.178"></a><span id="l71.178">     // extract just the key from &lt;key&gt;.&lt;info=tag|color|ordinal&gt;</span>
<a href="#l71.179"></a><span id="l71.179">     char *info = strrchr(prefList[i], '.');</span>
<a href="#l71.180"></a><span id="l71.180">     if (info)</span>
<a href="#l71.181"></a><span id="l71.181">     {</span>
<a href="#l71.182"></a><span id="l71.182" class="difflineminus">-      nsCAutoString key(Substring(prefList[i], info));</span>
<a href="#l71.183"></a><span id="l71.183" class="difflineplus">+      nsAutoCString key(Substring(prefList[i], info));</span>
<a href="#l71.184"></a><span id="l71.184">       if (key != lastKey)</span>
<a href="#l71.185"></a><span id="l71.185">       {</span>
<a href="#l71.186"></a><span id="l71.186">         if (!key.IsEmpty())</span>
<a href="#l71.187"></a><span id="l71.187">         {</span>
<a href="#l71.188"></a><span id="l71.188">           // .tag MUST exist (but may be empty)</span>
<a href="#l71.189"></a><span id="l71.189">           rv = GetTagForKey(key, tag);</span>
<a href="#l71.190"></a><span id="l71.190">           if (NS_SUCCEEDED(rv))</span>
<a href="#l71.191"></a><span id="l71.191">           {</span>
<a href="#l71.192"></a><span id="l71.192" class="difflineat">@@ -475,17 +475,17 @@ nsresult nsMsgTagService::MigrateLabelsT</span>
<a href="#l71.193"></a><span id="l71.193">   {</span>
<a href="#l71.194"></a><span id="l71.194">     gMigratingKeys = true;</span>
<a href="#l71.195"></a><span id="l71.195">   // need to convert the keys to lower case</span>
<a href="#l71.196"></a><span id="l71.196">     nsIMsgTag **tagArray;</span>
<a href="#l71.197"></a><span id="l71.197">     uint32_t numTags;</span>
<a href="#l71.198"></a><span id="l71.198">     GetAllTags(&amp;numTags, &amp;tagArray);</span>
<a href="#l71.199"></a><span id="l71.199">     for (uint32_t tagIndex = 0; tagIndex &lt; numTags; tagIndex++)</span>
<a href="#l71.200"></a><span id="l71.200">     {</span>
<a href="#l71.201"></a><span id="l71.201" class="difflineminus">-      nsCAutoString key, color, ordinal;</span>
<a href="#l71.202"></a><span id="l71.202" class="difflineplus">+      nsAutoCString key, color, ordinal;</span>
<a href="#l71.203"></a><span id="l71.203">       nsAutoString tagStr;</span>
<a href="#l71.204"></a><span id="l71.204">       nsIMsgTag *tag = tagArray[tagIndex];</span>
<a href="#l71.205"></a><span id="l71.205">       tag-&gt;GetKey(key);</span>
<a href="#l71.206"></a><span id="l71.206">       tag-&gt;GetTag(tagStr);</span>
<a href="#l71.207"></a><span id="l71.207">       tag-&gt;GetOrdinal(ordinal);</span>
<a href="#l71.208"></a><span id="l71.208">       tag-&gt;GetColor(color);</span>
<a href="#l71.209"></a><span id="l71.209">       DeleteKey(key);</span>
<a href="#l71.210"></a><span id="l71.210">       ToLowerCase(key);</span>
<a href="#l71.211"></a><span id="l71.211" class="difflineat">@@ -494,17 +494,17 @@ nsresult nsMsgTagService::MigrateLabelsT</span>
<a href="#l71.212"></a><span id="l71.212">     NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numTags, tagArray);</span>
<a href="#l71.213"></a><span id="l71.213">     gMigratingKeys = false;</span>
<a href="#l71.214"></a><span id="l71.214">   }</span>
<a href="#l71.215"></a><span id="l71.215">   else </span>
<a href="#l71.216"></a><span id="l71.216">   {</span>
<a href="#l71.217"></a><span id="l71.217">     nsCOMPtr&lt;nsIPrefBranch&gt; prefRoot(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l71.218"></a><span id="l71.218">     nsCOMPtr&lt;nsIPrefLocalizedString&gt; pls;</span>
<a href="#l71.219"></a><span id="l71.219">     nsString ucsval;</span>
<a href="#l71.220"></a><span id="l71.220" class="difflineminus">-    nsCAutoString labelKey(&quot;$label1&quot;);</span>
<a href="#l71.221"></a><span id="l71.221" class="difflineplus">+    nsAutoCString labelKey(&quot;$label1&quot;);</span>
<a href="#l71.222"></a><span id="l71.222">     for(int32_t i = 0; i &lt; PREF_LABELS_MAX; )</span>
<a href="#l71.223"></a><span id="l71.223">     {</span>
<a href="#l71.224"></a><span id="l71.224">       prefString.Assign(PREF_LABELS_DESCRIPTION);</span>
<a href="#l71.225"></a><span id="l71.225">       prefString.AppendInt(i + 1);</span>
<a href="#l71.226"></a><span id="l71.226">       rv = prefRoot-&gt;GetComplexValue(prefString.get(),</span>
<a href="#l71.227"></a><span id="l71.227">                                      NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l71.228"></a><span id="l71.228">                                      getter_AddRefs(pls));</span>
<a href="#l71.229"></a><span id="l71.229">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l71.230"></a><span id="l71.230" class="difflineat">@@ -543,17 +543,17 @@ nsresult nsMsgTagService::RefreshKeyCach</span>
<a href="#l71.231"></a><span id="l71.231"> </span>
<a href="#l71.232"></a><span id="l71.232">   for (uint32_t tagIndex = 0; tagIndex &lt; numTags; tagIndex++)</span>
<a href="#l71.233"></a><span id="l71.233">   {</span>
<a href="#l71.234"></a><span id="l71.234">     nsIMsgTag *tag = tagArray[tagIndex];</span>
<a href="#l71.235"></a><span id="l71.235">     if (!tag) {</span>
<a href="#l71.236"></a><span id="l71.236">       rv = NS_ERROR_FAILURE;</span>
<a href="#l71.237"></a><span id="l71.237">       break;</span>
<a href="#l71.238"></a><span id="l71.238">     }</span>
<a href="#l71.239"></a><span id="l71.239" class="difflineminus">-    nsCAutoString key;</span>
<a href="#l71.240"></a><span id="l71.240" class="difflineplus">+    nsAutoCString key;</span>
<a href="#l71.241"></a><span id="l71.241">     tag-&gt;GetKey(key);</span>
<a href="#l71.242"></a><span id="l71.242">     if (!m_keys.InsertElementAt(tagIndex, key)) {</span>
<a href="#l71.243"></a><span id="l71.243">       rv = NS_ERROR_FAILURE;</span>
<a href="#l71.244"></a><span id="l71.244">       break;</span>
<a href="#l71.245"></a><span id="l71.245">     }</span>
<a href="#l71.246"></a><span id="l71.246">   }</span>
<a href="#l71.247"></a><span id="l71.247">   NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numTags, tagArray);</span>
<a href="#l71.248"></a><span id="l71.248">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -128,17 +128,17 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l72.4"></a><span id="l72.4">   // to this thread.</span>
<a href="#l72.5"></a><span id="l72.5">   uint16_t numReferences;</span>
<a href="#l72.6"></a><span id="l72.6">   newHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l72.7"></a><span id="l72.7">   nsCOMPtr&lt;nsIMsgDBHdr&gt; parent;</span>
<a href="#l72.8"></a><span id="l72.8">   int32_t parentIndex;</span>
<a href="#l72.9"></a><span id="l72.9"> </span>
<a href="#l72.10"></a><span id="l72.10">   for (int32_t i = numReferences - 1; i &gt;= 0;  i--)</span>
<a href="#l72.11"></a><span id="l72.11">   {</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-    nsCAutoString reference;</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+    nsAutoCString reference;</span>
<a href="#l72.14"></a><span id="l72.14">     newHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l72.15"></a><span id="l72.15">     if (reference.IsEmpty())</span>
<a href="#l72.16"></a><span id="l72.16">       break;</span>
<a href="#l72.17"></a><span id="l72.17"> </span>
<a href="#l72.18"></a><span id="l72.18">     // I could look for the thread from the reference, but getting</span>
<a href="#l72.19"></a><span id="l72.19">     // the header directly should be fine. If it's not, that means</span>
<a href="#l72.20"></a><span id="l72.20">     // that the parent isn't in this thread, though it should be.</span>
<a href="#l72.21"></a><span id="l72.21">     m_view-&gt;GetMsgHdrFromHash(reference, getter_AddRefs(parent));</span>
<a href="#l72.22"></a><span id="l72.22" class="difflineat">@@ -370,17 +370,17 @@ void nsMsgXFViewThread::ChangeChildCount</span>
<a href="#l72.23"></a><span id="l72.23">   m_numChildren += delta;</span>
<a href="#l72.24"></a><span id="l72.24"> }</span>
<a href="#l72.25"></a><span id="l72.25"> </span>
<a href="#l72.26"></a><span id="l72.26"> bool nsMsgXFViewThread::IsHdrParentOf(nsIMsgDBHdr *possibleParent, </span>
<a href="#l72.27"></a><span id="l72.27">                                         nsIMsgDBHdr *possibleChild)</span>
<a href="#l72.28"></a><span id="l72.28"> {</span>
<a href="#l72.29"></a><span id="l72.29">   uint16_t referenceToCheck = 0;</span>
<a href="#l72.30"></a><span id="l72.30">   possibleChild-&gt;GetNumReferences(&amp;referenceToCheck);</span>
<a href="#l72.31"></a><span id="l72.31" class="difflineminus">-  nsCAutoString reference;</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineplus">+  nsAutoCString reference;</span>
<a href="#l72.33"></a><span id="l72.33"> </span>
<a href="#l72.34"></a><span id="l72.34">   nsCString messageId;</span>
<a href="#l72.35"></a><span id="l72.35">   possibleParent-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l72.36"></a><span id="l72.36"> </span>
<a href="#l72.37"></a><span id="l72.37">   while (referenceToCheck &gt; 0)</span>
<a href="#l72.38"></a><span id="l72.38">   {</span>
<a href="#l72.39"></a><span id="l72.39">     possibleChild-&gt;GetStringReference(referenceToCheck - 1, reference);</span>
<a href="#l72.40"></a><span id="l72.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -355,17 +355,17 @@ NS_IMETHODIMP nsSpamSettings::Initialize</span>
<a href="#l73.4"></a><span id="l73.4">     nsCOMPtr&lt;nsIMsgAccountManager&gt;</span>
<a href="#l73.5"></a><span id="l73.5">       accountManager(do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l73.6"></a><span id="l73.6">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l73.7"></a><span id="l73.7"> </span>
<a href="#l73.8"></a><span id="l73.8">     nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l73.9"></a><span id="l73.9">     rv = accountManager-&gt;FindAccountForServer(aServer, getter_AddRefs(account));</span>
<a href="#l73.10"></a><span id="l73.10">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l73.11"></a><span id="l73.11"> </span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-    nsCAutoString accountKey;</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+    nsAutoCString accountKey;</span>
<a href="#l73.14"></a><span id="l73.14">     if (account) </span>
<a href="#l73.15"></a><span id="l73.15">       account-&gt;GetKey(accountKey);</span>
<a href="#l73.16"></a><span id="l73.16"> </span>
<a href="#l73.17"></a><span id="l73.17">     // Loop through all accounts, adding emails from this account, as well as</span>
<a href="#l73.18"></a><span id="l73.18">     // from any accounts that defer to this account.</span>
<a href="#l73.19"></a><span id="l73.19">     mEmails.Clear();</span>
<a href="#l73.20"></a><span id="l73.20">     nsCOMPtr&lt;nsISupportsArray&gt; accounts;</span>
<a href="#l73.21"></a><span id="l73.21">     rv = accountManager-&gt;GetAccounts(getter_AddRefs(accounts));</span>
<a href="#l73.22"></a><span id="l73.22" class="difflineat">@@ -374,21 +374,21 @@ NS_IMETHODIMP nsSpamSettings::Initialize</span>
<a href="#l73.23"></a><span id="l73.23">     if (account &amp;&amp; accounts) // no sense scanning accounts if we've nothing to match</span>
<a href="#l73.24"></a><span id="l73.24">       accounts-&gt;Count(&amp;accountCount);</span>
<a href="#l73.25"></a><span id="l73.25"> </span>
<a href="#l73.26"></a><span id="l73.26">     for (uint32_t i = 0; i &lt; accountCount; i++)</span>
<a href="#l73.27"></a><span id="l73.27">     {</span>
<a href="#l73.28"></a><span id="l73.28">       nsCOMPtr&lt;nsIMsgAccount&gt; loopAccount(do_QueryElementAt(accounts, i));</span>
<a href="#l73.29"></a><span id="l73.29">       if (!loopAccount)</span>
<a href="#l73.30"></a><span id="l73.30">         continue;</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-      nsCAutoString loopAccountKey;</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+      nsAutoCString loopAccountKey;</span>
<a href="#l73.33"></a><span id="l73.33">       loopAccount-&gt;GetKey(loopAccountKey);</span>
<a href="#l73.34"></a><span id="l73.34">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; loopServer;</span>
<a href="#l73.35"></a><span id="l73.35">       loopAccount-&gt;GetIncomingServer(getter_AddRefs(loopServer));</span>
<a href="#l73.36"></a><span id="l73.36" class="difflineminus">-      nsCAutoString deferredToAccountKey;</span>
<a href="#l73.37"></a><span id="l73.37" class="difflineplus">+      nsAutoCString deferredToAccountKey;</span>
<a href="#l73.38"></a><span id="l73.38">       if (loopServer)</span>
<a href="#l73.39"></a><span id="l73.39">         loopServer-&gt;GetCharValue(&quot;deferred_to_account&quot;, deferredToAccountKey);</span>
<a href="#l73.40"></a><span id="l73.40"> </span>
<a href="#l73.41"></a><span id="l73.41">       // Add the emails for any account that defers to this one, or for the</span>
<a href="#l73.42"></a><span id="l73.42">       // account itself.</span>
<a href="#l73.43"></a><span id="l73.43">       if (accountKey.Equals(deferredToAccountKey) || accountKey.Equals(loopAccountKey))</span>
<a href="#l73.44"></a><span id="l73.44">       {</span>
<a href="#l73.45"></a><span id="l73.45">         nsCOMPtr&lt;nsISupportsArray&gt; identities;</span>
<a href="#l73.46"></a><span id="l73.46" class="difflineat">@@ -397,17 +397,17 @@ NS_IMETHODIMP nsSpamSettings::Initialize</span>
<a href="#l73.47"></a><span id="l73.47">           continue;</span>
<a href="#l73.48"></a><span id="l73.48">         uint32_t identityCount = 0;</span>
<a href="#l73.49"></a><span id="l73.49">         identities-&gt;Count(&amp;identityCount);</span>
<a href="#l73.50"></a><span id="l73.50">         for (uint32_t j = 0; j &lt; identityCount; ++j)</span>
<a href="#l73.51"></a><span id="l73.51">         {</span>
<a href="#l73.52"></a><span id="l73.52">           nsCOMPtr&lt;nsIMsgIdentity&gt; identity(do_QueryElementAt(identities, j));</span>
<a href="#l73.53"></a><span id="l73.53">           if (!identity)</span>
<a href="#l73.54"></a><span id="l73.54">             continue;</span>
<a href="#l73.55"></a><span id="l73.55" class="difflineminus">-          nsCAutoString email;</span>
<a href="#l73.56"></a><span id="l73.56" class="difflineplus">+          nsAutoCString email;</span>
<a href="#l73.57"></a><span id="l73.57">           identity-&gt;GetEmail(email);</span>
<a href="#l73.58"></a><span id="l73.58">           if (!email.IsEmpty())</span>
<a href="#l73.59"></a><span id="l73.59">             mEmails.AppendElement(email);</span>
<a href="#l73.60"></a><span id="l73.60">         }</span>
<a href="#l73.61"></a><span id="l73.61">       }</span>
<a href="#l73.62"></a><span id="l73.62">     }</span>
<a href="#l73.63"></a><span id="l73.63">   }</span>
<a href="#l73.64"></a><span id="l73.64"> </span>
<a href="#l73.65"></a><span id="l73.65" class="difflineat">@@ -575,17 +575,17 @@ NS_IMETHODIMP nsSpamSettings::SetServerF</span>
<a href="#l73.66"></a><span id="l73.66"> }</span>
<a href="#l73.67"></a><span id="l73.67"> </span>
<a href="#l73.68"></a><span id="l73.68"> NS_IMETHODIMP nsSpamSettings::GetServerFilterFile(nsIFile ** aFile)</span>
<a href="#l73.69"></a><span id="l73.69"> {</span>
<a href="#l73.70"></a><span id="l73.70">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l73.71"></a><span id="l73.71">   if (!mServerFilterFile)</span>
<a href="#l73.72"></a><span id="l73.72">   {</span>
<a href="#l73.73"></a><span id="l73.73">     nsresult rv;</span>
<a href="#l73.74"></a><span id="l73.74" class="difflineminus">-    nsCAutoString serverFilterFileName;</span>
<a href="#l73.75"></a><span id="l73.75" class="difflineplus">+    nsAutoCString serverFilterFileName;</span>
<a href="#l73.76"></a><span id="l73.76">     GetServerFilterName(serverFilterFileName);</span>
<a href="#l73.77"></a><span id="l73.77">     serverFilterFileName.Append(&quot;.sfd&quot;);</span>
<a href="#l73.78"></a><span id="l73.78"> </span>
<a href="#l73.79"></a><span id="l73.79">     nsCOMPtr&lt;nsIProperties&gt; dirSvc = do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l73.80"></a><span id="l73.80">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l73.81"></a><span id="l73.81"> </span>
<a href="#l73.82"></a><span id="l73.82">     // Walk through the list of isp directories</span>
<a href="#l73.83"></a><span id="l73.83">     nsCOMPtr&lt;nsISimpleEnumerator&gt; ispDirectories;</span>
<a href="#l73.84"></a><span id="l73.84" class="difflineat">@@ -795,17 +795,17 @@ NS_IMETHODIMP nsSpamSettings::CheckWhite</span>
<a href="#l73.85"></a><span id="l73.85"> </span>
<a href="#l73.86"></a><span id="l73.86">   nsCString author;</span>
<a href="#l73.87"></a><span id="l73.87">   aMsgHdr-&gt;GetAuthor(getter_Copies(author));</span>
<a href="#l73.88"></a><span id="l73.88">   nsresult rv;</span>
<a href="#l73.89"></a><span id="l73.89">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; headerParser =</span>
<a href="#l73.90"></a><span id="l73.90">     do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID, &amp;rv);</span>
<a href="#l73.91"></a><span id="l73.91">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l73.92"></a><span id="l73.92"> </span>
<a href="#l73.93"></a><span id="l73.93" class="difflineminus">-  nsCAutoString authorEmailAddress;</span>
<a href="#l73.94"></a><span id="l73.94" class="difflineplus">+  nsAutoCString authorEmailAddress;</span>
<a href="#l73.95"></a><span id="l73.95">   rv = headerParser-&gt;ExtractHeaderAddressMailboxes(author, authorEmailAddress);</span>
<a href="#l73.96"></a><span id="l73.96">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l73.97"></a><span id="l73.97"> </span>
<a href="#l73.98"></a><span id="l73.98">   if (authorEmailAddress.IsEmpty())</span>
<a href="#l73.99"></a><span id="l73.99">     return NS_OK;</span>
<a href="#l73.100"></a><span id="l73.100"> </span>
<a href="#l73.101"></a><span id="l73.101">   // should we skip whitelisting for the identity email?</span>
<a href="#l73.102"></a><span id="l73.102">   if (mInhibitWhiteListingIdentityUser)</span>
<a href="#l73.103"></a><span id="l73.103" class="difflineat">@@ -814,34 +814,34 @@ NS_IMETHODIMP nsSpamSettings::CheckWhite</span>
<a href="#l73.104"></a><span id="l73.104">     {</span>
<a href="#l73.105"></a><span id="l73.105">       if (mEmails[i].Equals(authorEmailAddress, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l73.106"></a><span id="l73.106">         return NS_OK;</span>
<a href="#l73.107"></a><span id="l73.107">     }</span>
<a href="#l73.108"></a><span id="l73.108">   }</span>
<a href="#l73.109"></a><span id="l73.109"> </span>
<a href="#l73.110"></a><span id="l73.110">   if (!mTrustedMailDomains.IsEmpty() || mInhibitWhiteListingIdentityDomain)</span>
<a href="#l73.111"></a><span id="l73.111">   {</span>
<a href="#l73.112"></a><span id="l73.112" class="difflineminus">-    nsCAutoString domain;</span>
<a href="#l73.113"></a><span id="l73.113" class="difflineplus">+    nsAutoCString domain;</span>
<a href="#l73.114"></a><span id="l73.114">     int32_t atPos = authorEmailAddress.FindChar('@');</span>
<a href="#l73.115"></a><span id="l73.115">     if (atPos &gt;= 0)</span>
<a href="#l73.116"></a><span id="l73.116">       domain = Substring(authorEmailAddress, atPos + 1);</span>
<a href="#l73.117"></a><span id="l73.117">     if (!domain.IsEmpty())</span>
<a href="#l73.118"></a><span id="l73.118">     {</span>
<a href="#l73.119"></a><span id="l73.119">       if (!mTrustedMailDomains.IsEmpty() &amp;&amp;</span>
<a href="#l73.120"></a><span id="l73.120">           MsgHostDomainIsTrusted(domain, mTrustedMailDomains))</span>
<a href="#l73.121"></a><span id="l73.121">       {</span>
<a href="#l73.122"></a><span id="l73.122">         *aResult = true;</span>
<a href="#l73.123"></a><span id="l73.123">         return NS_OK;</span>
<a href="#l73.124"></a><span id="l73.124">       }</span>
<a href="#l73.125"></a><span id="l73.125"> </span>
<a href="#l73.126"></a><span id="l73.126">       if (mInhibitWhiteListingIdentityDomain)</span>
<a href="#l73.127"></a><span id="l73.127">       {</span>
<a href="#l73.128"></a><span id="l73.128">         for (uint32_t i = 0; i &lt; mEmails.Length(); ++i)</span>
<a href="#l73.129"></a><span id="l73.129">         {</span>
<a href="#l73.130"></a><span id="l73.130" class="difflineminus">-          nsCAutoString identityDomain;</span>
<a href="#l73.131"></a><span id="l73.131" class="difflineplus">+          nsAutoCString identityDomain;</span>
<a href="#l73.132"></a><span id="l73.132">           int32_t atPos = mEmails[i].FindChar('@');</span>
<a href="#l73.133"></a><span id="l73.133">           if (atPos &gt;= 0)</span>
<a href="#l73.134"></a><span id="l73.134">           {</span>
<a href="#l73.135"></a><span id="l73.135">             identityDomain = Substring(mEmails[i], atPos + 1);</span>
<a href="#l73.136"></a><span id="l73.136">             if (identityDomain.Equals(domain, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l73.137"></a><span id="l73.137">               return NS_OK; // don't whitelist</span>
<a href="#l73.138"></a><span id="l73.138">           }</span>
<a href="#l73.139"></a><span id="l73.139">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -200,22 +200,22 @@ nsSubscribableServer::NotifyAssert(Subsc</span>
<a href="#l74.4"></a><span id="l74.4">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.5"></a><span id="l74.5">     rv = mSubscribeDS-&gt;GetHasObservers(&amp;hasObservers);</span>
<a href="#l74.6"></a><span id="l74.6">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.7"></a><span id="l74.7">     // no need to do all this work, there are no observers</span>
<a href="#l74.8"></a><span id="l74.8">     if (!hasObservers) {</span>
<a href="#l74.9"></a><span id="l74.9">         return NS_OK;</span>
<a href="#l74.10"></a><span id="l74.10">     }</span>
<a href="#l74.11"></a><span id="l74.11"> </span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-    nsCAutoString subjectUri;</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+    nsAutoCString subjectUri;</span>
<a href="#l74.14"></a><span id="l74.14">     BuildURIFromNode(subjectNode, subjectUri);</span>
<a href="#l74.15"></a><span id="l74.15"> </span>
<a href="#l74.16"></a><span id="l74.16">     // we could optimize this, since we know that objectUri == subjectUri + mDelimiter + object-&gt;name</span>
<a href="#l74.17"></a><span id="l74.17">     // is it worth it?</span>
<a href="#l74.18"></a><span id="l74.18" class="difflineminus">-    nsCAutoString objectUri;</span>
<a href="#l74.19"></a><span id="l74.19" class="difflineplus">+    nsAutoCString objectUri;</span>
<a href="#l74.20"></a><span id="l74.20">     BuildURIFromNode(objectNode, objectUri);</span>
<a href="#l74.21"></a><span id="l74.21"> </span>
<a href="#l74.22"></a><span id="l74.22">     nsCOMPtr &lt;nsIRDFResource&gt; subject;</span>
<a href="#l74.23"></a><span id="l74.23">     nsCOMPtr &lt;nsIRDFResource&gt; object;</span>
<a href="#l74.24"></a><span id="l74.24"> </span>
<a href="#l74.25"></a><span id="l74.25">     rv = EnsureRDFService();</span>
<a href="#l74.26"></a><span id="l74.26">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.27"></a><span id="l74.27"> </span>
<a href="#l74.28"></a><span id="l74.28" class="difflineat">@@ -254,17 +254,17 @@ nsSubscribableServer::NotifyChange(Subsc</span>
<a href="#l74.29"></a><span id="l74.29">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.30"></a><span id="l74.30">     rv = mSubscribeDS-&gt;GetHasObservers(&amp;hasObservers);</span>
<a href="#l74.31"></a><span id="l74.31">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.32"></a><span id="l74.32">     // no need to do all this work, there are no observers</span>
<a href="#l74.33"></a><span id="l74.33">     if (!hasObservers) {</span>
<a href="#l74.34"></a><span id="l74.34">         return NS_OK;</span>
<a href="#l74.35"></a><span id="l74.35">     }</span>
<a href="#l74.36"></a><span id="l74.36"> </span>
<a href="#l74.37"></a><span id="l74.37" class="difflineminus">-    nsCAutoString subjectUri;</span>
<a href="#l74.38"></a><span id="l74.38" class="difflineplus">+    nsAutoCString subjectUri;</span>
<a href="#l74.39"></a><span id="l74.39">     BuildURIFromNode(subjectNode, subjectUri);</span>
<a href="#l74.40"></a><span id="l74.40"> </span>
<a href="#l74.41"></a><span id="l74.41">     rv = EnsureRDFService();</span>
<a href="#l74.42"></a><span id="l74.42">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.43"></a><span id="l74.43"> </span>
<a href="#l74.44"></a><span id="l74.44">     rv = mRDFService-&gt;GetResource(subjectUri, getter_AddRefs(subject));</span>
<a href="#l74.45"></a><span id="l74.45">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l74.46"></a><span id="l74.46"> </span>
<a href="#l74.47"></a><span id="l74.47" class="difflineat">@@ -732,17 +732,17 @@ nsSubscribableServer::GetChildren(const </span>
<a href="#l74.48"></a><span id="l74.48">     SubscribeTreeNode *node = nullptr;</span>
<a href="#l74.49"></a><span id="l74.49">     nsresult rv = FindAndCreateNode(aPath, &amp;node);</span>
<a href="#l74.50"></a><span id="l74.50">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l74.51"></a><span id="l74.51"> </span>
<a href="#l74.52"></a><span id="l74.52">     NS_ASSERTION(node,&quot;didn't find the node&quot;);</span>
<a href="#l74.53"></a><span id="l74.53">     if (!node)</span>
<a href="#l74.54"></a><span id="l74.54">       return NS_ERROR_FAILURE;</span>
<a href="#l74.55"></a><span id="l74.55"> </span>
<a href="#l74.56"></a><span id="l74.56" class="difflineminus">-    nsCAutoString uriPrefix;</span>
<a href="#l74.57"></a><span id="l74.57" class="difflineplus">+    nsAutoCString uriPrefix;</span>
<a href="#l74.58"></a><span id="l74.58">     NS_ASSERTION(mTreeRoot, &quot;no tree root!&quot;);</span>
<a href="#l74.59"></a><span id="l74.59">     if (!mTreeRoot)</span>
<a href="#l74.60"></a><span id="l74.60">       return NS_ERROR_UNEXPECTED;</span>
<a href="#l74.61"></a><span id="l74.61"> </span>
<a href="#l74.62"></a><span id="l74.62">     uriPrefix = mTreeRoot-&gt;name; // the root's name is the server uri</span>
<a href="#l74.63"></a><span id="l74.63">     uriPrefix += &quot;/&quot;;</span>
<a href="#l74.64"></a><span id="l74.64">     if (!aPath.IsEmpty()) {</span>
<a href="#l74.65"></a><span id="l74.65">         uriPrefix += aPath;</span>
<a href="#l74.66"></a><span id="l74.66" class="difflineat">@@ -755,17 +755,17 @@ nsSubscribableServer::GetChildren(const </span>
<a href="#l74.67"></a><span id="l74.67">     SubscribeTreeNode *current = node-&gt;lastChild;</span>
<a href="#l74.68"></a><span id="l74.68">     // return failure if there are no children.</span>
<a href="#l74.69"></a><span id="l74.69">     if (!current)</span>
<a href="#l74.70"></a><span id="l74.70">       return NS_ERROR_FAILURE;</span>
<a href="#l74.71"></a><span id="l74.71"> </span>
<a href="#l74.72"></a><span id="l74.72">     nsCOMArray&lt;nsIRDFResource&gt; result;</span>
<a href="#l74.73"></a><span id="l74.73"> </span>
<a href="#l74.74"></a><span id="l74.74">     while (current) {</span>
<a href="#l74.75"></a><span id="l74.75" class="difflineminus">-        nsCAutoString uri;</span>
<a href="#l74.76"></a><span id="l74.76" class="difflineplus">+        nsAutoCString uri;</span>
<a href="#l74.77"></a><span id="l74.77">         uri = uriPrefix;</span>
<a href="#l74.78"></a><span id="l74.78">         NS_ASSERTION(current-&gt;name, &quot;no name&quot;);</span>
<a href="#l74.79"></a><span id="l74.79">         if (!current-&gt;name)</span>
<a href="#l74.80"></a><span id="l74.80">           return NS_ERROR_FAILURE;</span>
<a href="#l74.81"></a><span id="l74.81"> </span>
<a href="#l74.82"></a><span id="l74.82">         uri += current-&gt;name;</span>
<a href="#l74.83"></a><span id="l74.83"> </span>
<a href="#l74.84"></a><span id="l74.84">         nsCOMPtr &lt;nsIRDFResource&gt; res;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -272,17 +272,17 @@ NS_IMETHODIMP nsMsgDBFolder::CloseAndBac</span>
<a href="#l75.4"></a><span id="l75.4">   bool backupExists;</span>
<a href="#l75.5"></a><span id="l75.5">   backupDBFile-&gt;Exists(&amp;backupExists);</span>
<a href="#l75.6"></a><span id="l75.6">   NS_ASSERTION(!backupExists, &quot;Couldn't delete database backup&quot;);</span>
<a href="#l75.7"></a><span id="l75.7">   if (backupExists)</span>
<a href="#l75.8"></a><span id="l75.8">     return NS_ERROR_FAILURE;</span>
<a href="#l75.9"></a><span id="l75.9"> </span>
<a href="#l75.10"></a><span id="l75.10">   if (!newName.IsEmpty())</span>
<a href="#l75.11"></a><span id="l75.11">   {</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-    nsCAutoString backupName;</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+    nsAutoCString backupName;</span>
<a href="#l75.14"></a><span id="l75.14">     rv = backupDBFile-&gt;GetNativeLeafName(backupName);</span>
<a href="#l75.15"></a><span id="l75.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.16"></a><span id="l75.16">     return dbFile-&gt;CopyToNative(backupDir, backupName);</span>
<a href="#l75.17"></a><span id="l75.17">   }</span>
<a href="#l75.18"></a><span id="l75.18">   else</span>
<a href="#l75.19"></a><span id="l75.19">     return dbFile-&gt;CopyToNative(backupDir, EmptyCString());</span>
<a href="#l75.20"></a><span id="l75.20"> }</span>
<a href="#l75.21"></a><span id="l75.21"> </span>
<a href="#l75.22"></a><span id="l75.22" class="difflineat">@@ -1611,17 +1611,17 @@ NS_IMETHODIMP nsMsgDBFolder::IsCommandEn</span>
<a href="#l75.23"></a><span id="l75.23"> {</span>
<a href="#l75.24"></a><span id="l75.24">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l75.25"></a><span id="l75.25">   *result = true;</span>
<a href="#l75.26"></a><span id="l75.26">   return NS_OK;</span>
<a href="#l75.27"></a><span id="l75.27"> }</span>
<a href="#l75.28"></a><span id="l75.28"> </span>
<a href="#l75.29"></a><span id="l75.29"> nsresult nsMsgDBFolder::WriteStartOfNewLocalMessage()</span>
<a href="#l75.30"></a><span id="l75.30"> {</span>
<a href="#l75.31"></a><span id="l75.31" class="difflineminus">-  nsCAutoString result;</span>
<a href="#l75.32"></a><span id="l75.32" class="difflineplus">+  nsAutoCString result;</span>
<a href="#l75.33"></a><span id="l75.33">   uint32_t writeCount;</span>
<a href="#l75.34"></a><span id="l75.34">   time_t now = time ((time_t*) 0);</span>
<a href="#l75.35"></a><span id="l75.35">   char *ct = ctime(&amp;now);</span>
<a href="#l75.36"></a><span id="l75.36">   ct[24] = 0;</span>
<a href="#l75.37"></a><span id="l75.37">   result = &quot;From - &quot;;</span>
<a href="#l75.38"></a><span id="l75.38">   result += ct;</span>
<a href="#l75.39"></a><span id="l75.39">   result += MSG_LINEBREAK;</span>
<a href="#l75.40"></a><span id="l75.40">   m_bytesAddedToLocalMsg = result.Length();</span>
<a href="#l75.41"></a><span id="l75.41" class="difflineat">@@ -1721,17 +1721,17 @@ nsresult nsMsgDBFolder::EndNewOfflineMes</span>
<a href="#l75.42"></a><span id="l75.42">        {</span>
<a href="#l75.43"></a><span id="l75.43">          m_tempMessageStream-&gt;Close();</span>
<a href="#l75.44"></a><span id="l75.44">          m_tempMessageStream = nullptr;</span>
<a href="#l75.45"></a><span id="l75.45">          ReleaseSemaphore(static_cast&lt;nsIMsgFolder*&gt;(this));</span>
<a href="#l75.46"></a><span id="l75.46">          if (msgStore)</span>
<a href="#l75.47"></a><span id="l75.47">            msgStore-&gt;DiscardNewMessage(m_tempMessageStream, m_offlineHeader);</span>
<a href="#l75.48"></a><span id="l75.48">        }</span>
<a href="#l75.49"></a><span id="l75.49"> #ifdef _DEBUG</span>
<a href="#l75.50"></a><span id="l75.50" class="difflineminus">-       nsCAutoString message(&quot;Offline message too small: messageSize=&quot;);</span>
<a href="#l75.51"></a><span id="l75.51" class="difflineplus">+       nsAutoCString message(&quot;Offline message too small: messageSize=&quot;);</span>
<a href="#l75.52"></a><span id="l75.52">        message.AppendInt(messageSize);</span>
<a href="#l75.53"></a><span id="l75.53">        message.Append(&quot; curStorePos=&quot;);</span>
<a href="#l75.54"></a><span id="l75.54">        message.AppendInt(curStorePos);</span>
<a href="#l75.55"></a><span id="l75.55">        message.Append(&quot; numOfflineMsgLines=&quot;);</span>
<a href="#l75.56"></a><span id="l75.56">        message.AppendInt(m_numOfflineMsgLines);</span>
<a href="#l75.57"></a><span id="l75.57">        NS_ERROR(message.get());</span>
<a href="#l75.58"></a><span id="l75.58"> #endif</span>
<a href="#l75.59"></a><span id="l75.59">     }</span>
<a href="#l75.60"></a><span id="l75.60" class="difflineat">@@ -2162,28 +2162,28 @@ nsMsgDBFolder::SetStringProperty(const c</span>
<a href="#l75.61"></a><span id="l75.61">   return NS_OK;</span>
<a href="#l75.62"></a><span id="l75.62"> }</span>
<a href="#l75.63"></a><span id="l75.63"> </span>
<a href="#l75.64"></a><span id="l75.64"> // Get/Set ForcePropertyEmpty is only used with inherited properties</span>
<a href="#l75.65"></a><span id="l75.65"> NS_IMETHODIMP</span>
<a href="#l75.66"></a><span id="l75.66"> nsMsgDBFolder::GetForcePropertyEmpty(const char *aPropertyName, bool *_retval)</span>
<a href="#l75.67"></a><span id="l75.67"> {</span>
<a href="#l75.68"></a><span id="l75.68">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l75.69"></a><span id="l75.69" class="difflineminus">-  nsCAutoString nameEmpty(aPropertyName);</span>
<a href="#l75.70"></a><span id="l75.70" class="difflineplus">+  nsAutoCString nameEmpty(aPropertyName);</span>
<a href="#l75.71"></a><span id="l75.71">   nameEmpty.Append(NS_LITERAL_CSTRING(&quot;.empty&quot;));</span>
<a href="#l75.72"></a><span id="l75.72">   nsCString value;</span>
<a href="#l75.73"></a><span id="l75.73">   GetStringProperty(nameEmpty.get(), value);</span>
<a href="#l75.74"></a><span id="l75.74">   *_retval = value.EqualsLiteral(&quot;true&quot;);</span>
<a href="#l75.75"></a><span id="l75.75">   return NS_OK;</span>
<a href="#l75.76"></a><span id="l75.76"> }</span>
<a href="#l75.77"></a><span id="l75.77"> </span>
<a href="#l75.78"></a><span id="l75.78"> NS_IMETHODIMP</span>
<a href="#l75.79"></a><span id="l75.79"> nsMsgDBFolder::SetForcePropertyEmpty(const char *aPropertyName, bool aValue)</span>
<a href="#l75.80"></a><span id="l75.80"> {</span>
<a href="#l75.81"></a><span id="l75.81" class="difflineminus">- nsCAutoString nameEmpty(aPropertyName);</span>
<a href="#l75.82"></a><span id="l75.82" class="difflineplus">+ nsAutoCString nameEmpty(aPropertyName);</span>
<a href="#l75.83"></a><span id="l75.83">  nameEmpty.Append(NS_LITERAL_CSTRING(&quot;.empty&quot;));</span>
<a href="#l75.84"></a><span id="l75.84">  return SetStringProperty(nameEmpty.get(),</span>
<a href="#l75.85"></a><span id="l75.85">    aValue ? NS_LITERAL_CSTRING(&quot;true&quot;) : NS_LITERAL_CSTRING(&quot;&quot;));</span>
<a href="#l75.86"></a><span id="l75.86"> }</span>
<a href="#l75.87"></a><span id="l75.87"> </span>
<a href="#l75.88"></a><span id="l75.88"> NS_IMETHODIMP</span>
<a href="#l75.89"></a><span id="l75.89"> nsMsgDBFolder::GetInheritedStringProperty(const char *aPropertyName, nsACString&amp; aPropertyValue)</span>
<a href="#l75.90"></a><span id="l75.90"> {</span>
<a href="#l75.91"></a><span id="l75.91" class="difflineat">@@ -2356,24 +2356,24 @@ nsMsgDBFolder::OnMessageClassified(const</span>
<a href="#l75.92"></a><span id="l75.92">   uint32_t processingFlags;</span>
<a href="#l75.93"></a><span id="l75.93">   GetProcessingFlags(msgKey, &amp;processingFlags);</span>
<a href="#l75.94"></a><span id="l75.94"> </span>
<a href="#l75.95"></a><span id="l75.95">   if (processingFlags &amp; nsMsgProcessingFlags::ClassifyJunk)</span>
<a href="#l75.96"></a><span id="l75.96">   {</span>
<a href="#l75.97"></a><span id="l75.97">     mClassifiedMsgKeys.AppendElement(msgKey);</span>
<a href="#l75.98"></a><span id="l75.98">     AndProcessingFlags(msgKey, ~nsMsgProcessingFlags::ClassifyJunk);</span>
<a href="#l75.99"></a><span id="l75.99"> </span>
<a href="#l75.100"></a><span id="l75.100" class="difflineminus">-    nsCAutoString msgJunkScore;</span>
<a href="#l75.101"></a><span id="l75.101" class="difflineplus">+    nsAutoCString msgJunkScore;</span>
<a href="#l75.102"></a><span id="l75.102">     msgJunkScore.AppendInt(aClassification == nsIJunkMailPlugin::JUNK ?</span>
<a href="#l75.103"></a><span id="l75.103">           nsIJunkMailPlugin::IS_SPAM_SCORE:</span>
<a href="#l75.104"></a><span id="l75.104">           nsIJunkMailPlugin::IS_HAM_SCORE);</span>
<a href="#l75.105"></a><span id="l75.105">     mDatabase-&gt;SetStringProperty(msgKey, &quot;junkscore&quot;, msgJunkScore.get());</span>
<a href="#l75.106"></a><span id="l75.106">     mDatabase-&gt;SetStringProperty(msgKey, &quot;junkscoreorigin&quot;, &quot;plugin&quot;);</span>
<a href="#l75.107"></a><span id="l75.107"> </span>
<a href="#l75.108"></a><span id="l75.108" class="difflineminus">-    nsCAutoString strPercent;</span>
<a href="#l75.109"></a><span id="l75.109" class="difflineplus">+    nsAutoCString strPercent;</span>
<a href="#l75.110"></a><span id="l75.110">     strPercent.AppendInt(aJunkPercent);</span>
<a href="#l75.111"></a><span id="l75.111">     mDatabase-&gt;SetStringProperty(msgKey, &quot;junkpercent&quot;, strPercent.get());</span>
<a href="#l75.112"></a><span id="l75.112"> </span>
<a href="#l75.113"></a><span id="l75.113">     if (aClassification == nsIJunkMailPlugin::JUNK)</span>
<a href="#l75.114"></a><span id="l75.114">     {</span>
<a href="#l75.115"></a><span id="l75.115">       // IMAP has its own way of marking read.</span>
<a href="#l75.116"></a><span id="l75.116">       if (!(mFlags &amp; nsMsgFolderFlags::ImapBox))</span>
<a href="#l75.117"></a><span id="l75.117">       {</span>
<a href="#l75.118"></a><span id="l75.118" class="difflineat">@@ -2424,20 +2424,20 @@ nsMsgDBFolder::OnMessageTraitsClassified</span>
<a href="#l75.119"></a><span id="l75.119">   nsCOMPtr&lt;nsIMsgTraitService&gt; traitService;</span>
<a href="#l75.120"></a><span id="l75.120">   traitService = do_GetService(&quot;@mozilla.org/msg-trait-service;1&quot;, &amp;rv);</span>
<a href="#l75.121"></a><span id="l75.121">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.122"></a><span id="l75.122"> </span>
<a href="#l75.123"></a><span id="l75.123">   for (uint32_t i = 0; i &lt; aTraitCount; i++)</span>
<a href="#l75.124"></a><span id="l75.124">   {</span>
<a href="#l75.125"></a><span id="l75.125">     if (aTraits[i] == nsIJunkMailPlugin::JUNK_TRAIT)</span>
<a href="#l75.126"></a><span id="l75.126">       continue; // junk is processed by the junk listener</span>
<a href="#l75.127"></a><span id="l75.127" class="difflineminus">-    nsCAutoString traitId;</span>
<a href="#l75.128"></a><span id="l75.128" class="difflineplus">+    nsAutoCString traitId;</span>
<a href="#l75.129"></a><span id="l75.129">     rv = traitService-&gt;GetId(aTraits[i], traitId);</span>
<a href="#l75.130"></a><span id="l75.130">     traitId.Insert(NS_LITERAL_CSTRING(&quot;bayespercent/&quot;), 0);</span>
<a href="#l75.131"></a><span id="l75.131" class="difflineminus">-    nsCAutoString strPercent;</span>
<a href="#l75.132"></a><span id="l75.132" class="difflineplus">+    nsAutoCString strPercent;</span>
<a href="#l75.133"></a><span id="l75.133">     strPercent.AppendInt(aPercents[i]);</span>
<a href="#l75.134"></a><span id="l75.134">     mDatabase-&gt;SetStringPropertyByHdr(msgHdr, traitId.get(), strPercent.get());</span>
<a href="#l75.135"></a><span id="l75.135">   }</span>
<a href="#l75.136"></a><span id="l75.136">   return NS_OK;</span>
<a href="#l75.137"></a><span id="l75.137"> }</span>
<a href="#l75.138"></a><span id="l75.138"> </span>
<a href="#l75.139"></a><span id="l75.139"> /**</span>
<a href="#l75.140"></a><span id="l75.140">  * Call the filter plugins (XXX currently just one)</span>
<a href="#l75.141"></a><span id="l75.141" class="difflineat">@@ -2505,17 +2505,17 @@ nsMsgDBFolder::CallFilterPlugins(nsIMsgW</span>
<a href="#l75.142"></a><span id="l75.142">   /*</span>
<a href="#l75.143"></a><span id="l75.143">    * We'll use inherited folder properties for the junk trait to override the</span>
<a href="#l75.144"></a><span id="l75.144">    * standard server-based activation of junk processing. This provides a</span>
<a href="#l75.145"></a><span id="l75.145">    * hook for extensions to customize the application of junk filtering.</span>
<a href="#l75.146"></a><span id="l75.146">    * Set inherited property &quot;dobayes.mailnews@mozilla.org#junk&quot; to &quot;true&quot;</span>
<a href="#l75.147"></a><span id="l75.147">    * to force junk processing, and &quot;false&quot; to skip junk processing.</span>
<a href="#l75.148"></a><span id="l75.148">    */</span>
<a href="#l75.149"></a><span id="l75.149"> </span>
<a href="#l75.150"></a><span id="l75.150" class="difflineminus">-  nsCAutoString junkEnableOverride;</span>
<a href="#l75.151"></a><span id="l75.151" class="difflineplus">+  nsAutoCString junkEnableOverride;</span>
<a href="#l75.152"></a><span id="l75.152">   GetInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;, junkEnableOverride);</span>
<a href="#l75.153"></a><span id="l75.153">   if (junkEnableOverride.EqualsLiteral(&quot;true&quot;))</span>
<a href="#l75.154"></a><span id="l75.154">     filterForJunk = true;</span>
<a href="#l75.155"></a><span id="l75.155">   else if (junkEnableOverride.EqualsLiteral(&quot;false&quot;))</span>
<a href="#l75.156"></a><span id="l75.156">     filterForJunk = false;</span>
<a href="#l75.157"></a><span id="l75.157"> </span>
<a href="#l75.158"></a><span id="l75.158">   bool userHasClassified = false;</span>
<a href="#l75.159"></a><span id="l75.159">   // if the user has not classified any messages yet, then we shouldn't bother</span>
<a href="#l75.160"></a><span id="l75.160" class="difflineat">@@ -2552,21 +2552,21 @@ nsMsgDBFolder::CallFilterPlugins(nsIMsgW</span>
<a href="#l75.161"></a><span id="l75.161">       // the string value &quot;false&quot;</span>
<a href="#l75.162"></a><span id="l75.162">       //</span>
<a href="#l75.163"></a><span id="l75.163">       // If any non-junk traits are active on the folder, then the bayes</span>
<a href="#l75.164"></a><span id="l75.164">       // processing will calculate probabilities for all enabled traits.</span>
<a href="#l75.165"></a><span id="l75.165"> </span>
<a href="#l75.166"></a><span id="l75.166">       if (proIndices[i] != nsIJunkMailPlugin::JUNK_TRAIT)</span>
<a href="#l75.167"></a><span id="l75.167">       {</span>
<a href="#l75.168"></a><span id="l75.168">         filterForOther = true;</span>
<a href="#l75.169"></a><span id="l75.169" class="difflineminus">-        nsCAutoString traitId;</span>
<a href="#l75.170"></a><span id="l75.170" class="difflineminus">-        nsCAutoString property(&quot;dobayes.&quot;);</span>
<a href="#l75.171"></a><span id="l75.171" class="difflineplus">+        nsAutoCString traitId;</span>
<a href="#l75.172"></a><span id="l75.172" class="difflineplus">+        nsAutoCString property(&quot;dobayes.&quot;);</span>
<a href="#l75.173"></a><span id="l75.173">         traitService-&gt;GetId(proIndices[i], traitId);</span>
<a href="#l75.174"></a><span id="l75.174">         property.Append(traitId);</span>
<a href="#l75.175"></a><span id="l75.175" class="difflineminus">-        nsCAutoString isEnabledOnFolder;</span>
<a href="#l75.176"></a><span id="l75.176" class="difflineplus">+        nsAutoCString isEnabledOnFolder;</span>
<a href="#l75.177"></a><span id="l75.177">         GetInheritedStringProperty(property.get(), isEnabledOnFolder);</span>
<a href="#l75.178"></a><span id="l75.178">         if (isEnabledOnFolder.EqualsLiteral(&quot;false&quot;))</span>
<a href="#l75.179"></a><span id="l75.179">           filterForOther = false;</span>
<a href="#l75.180"></a><span id="l75.180">         // We might have to allow a &quot;true&quot; override in the future, but</span>
<a href="#l75.181"></a><span id="l75.181">         // for now there is no way for that to affect the processing</span>
<a href="#l75.182"></a><span id="l75.182">         break;</span>
<a href="#l75.183"></a><span id="l75.183">       }</span>
<a href="#l75.184"></a><span id="l75.184">     }</span>
<a href="#l75.185"></a><span id="l75.185" class="difflineat">@@ -2650,17 +2650,17 @@ nsMsgDBFolder::CallFilterPlugins(nsIMsgW</span>
<a href="#l75.186"></a><span id="l75.186">         break;</span>
<a href="#l75.187"></a><span id="l75.187"> </span>
<a href="#l75.188"></a><span id="l75.188">       bool whiteListMessage = false;</span>
<a href="#l75.189"></a><span id="l75.189">       spamSettings-&gt;CheckWhiteList(msgHdr, &amp;whiteListMessage);</span>
<a href="#l75.190"></a><span id="l75.190">       if (whiteListMessage)</span>
<a href="#l75.191"></a><span id="l75.191">       {</span>
<a href="#l75.192"></a><span id="l75.192">         // mark this msg as non-junk, because we whitelisted it.</span>
<a href="#l75.193"></a><span id="l75.193"> </span>
<a href="#l75.194"></a><span id="l75.194" class="difflineminus">-        nsCAutoString msgJunkScore;</span>
<a href="#l75.195"></a><span id="l75.195" class="difflineplus">+        nsAutoCString msgJunkScore;</span>
<a href="#l75.196"></a><span id="l75.196">         msgJunkScore.AppendInt(nsIJunkMailPlugin::IS_HAM_SCORE);</span>
<a href="#l75.197"></a><span id="l75.197">         mDatabase-&gt;SetStringProperty(msgKey, &quot;junkscore&quot;, msgJunkScore.get());</span>
<a href="#l75.198"></a><span id="l75.198">         mDatabase-&gt;SetStringProperty(msgKey, &quot;junkscoreorigin&quot;, &quot;whitelist&quot;);</span>
<a href="#l75.199"></a><span id="l75.199">         break; // skip this msg since it's in the white list</span>
<a href="#l75.200"></a><span id="l75.200">       }</span>
<a href="#l75.201"></a><span id="l75.201">       filterMessageForJunk = true;</span>
<a href="#l75.202"></a><span id="l75.202"> </span>
<a href="#l75.203"></a><span id="l75.203">       OrProcessingFlags(msgKey, nsMsgProcessingFlags::ClassifyJunk);</span>
<a href="#l75.204"></a><span id="l75.204" class="difflineat">@@ -2976,17 +2976,17 @@ nsMsgDBFolder::FindSubFolder(const nsACS</span>
<a href="#l75.205"></a><span id="l75.205"> {</span>
<a href="#l75.206"></a><span id="l75.206">   nsresult rv = NS_OK;</span>
<a href="#l75.207"></a><span id="l75.207">   nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l75.208"></a><span id="l75.208"> </span>
<a href="#l75.209"></a><span id="l75.209">   if (NS_FAILED(rv))</span>
<a href="#l75.210"></a><span id="l75.210">     return rv;</span>
<a href="#l75.211"></a><span id="l75.211"> </span>
<a href="#l75.212"></a><span id="l75.212">   // XXX use necko here</span>
<a href="#l75.213"></a><span id="l75.213" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l75.214"></a><span id="l75.214" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l75.215"></a><span id="l75.215">   uri.Append(mURI);</span>
<a href="#l75.216"></a><span id="l75.216">   uri.Append('/');</span>
<a href="#l75.217"></a><span id="l75.217">   uri.Append(aEscapedSubFolderName);</span>
<a href="#l75.218"></a><span id="l75.218"> </span>
<a href="#l75.219"></a><span id="l75.219">   nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l75.220"></a><span id="l75.220">   rv = rdf-&gt;GetResource(uri, getter_AddRefs(res));</span>
<a href="#l75.221"></a><span id="l75.221">   if (NS_FAILED(rv))</span>
<a href="#l75.222"></a><span id="l75.222">     return rv;</span>
<a href="#l75.223"></a><span id="l75.223" class="difflineat">@@ -3103,30 +3103,30 @@ nsMsgDBFolder::parseURI(bool needServer)</span>
<a href="#l75.224"></a><span id="l75.224">   url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l75.225"></a><span id="l75.225">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.226"></a><span id="l75.226"> </span>
<a href="#l75.227"></a><span id="l75.227">   rv = url-&gt;SetSpec(mURI);</span>
<a href="#l75.228"></a><span id="l75.228">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.229"></a><span id="l75.229">   // empty path tells us it's a server.</span>
<a href="#l75.230"></a><span id="l75.230">   if (!mIsServerIsValid)</span>
<a href="#l75.231"></a><span id="l75.231">   {</span>
<a href="#l75.232"></a><span id="l75.232" class="difflineminus">-    nsCAutoString path;</span>
<a href="#l75.233"></a><span id="l75.233" class="difflineplus">+    nsAutoCString path;</span>
<a href="#l75.234"></a><span id="l75.234">     rv = url-&gt;GetPath(path);</span>
<a href="#l75.235"></a><span id="l75.235">     if (NS_SUCCEEDED(rv))</span>
<a href="#l75.236"></a><span id="l75.236">       mIsServer = path.EqualsLiteral(&quot;/&quot;);</span>
<a href="#l75.237"></a><span id="l75.237">     mIsServerIsValid = true;</span>
<a href="#l75.238"></a><span id="l75.238">   }</span>
<a href="#l75.239"></a><span id="l75.239"> </span>
<a href="#l75.240"></a><span id="l75.240">   // grab the name off the leaf of the server</span>
<a href="#l75.241"></a><span id="l75.241">   if (mName.IsEmpty())</span>
<a href="#l75.242"></a><span id="l75.242">   {</span>
<a href="#l75.243"></a><span id="l75.243">     // mName:</span>
<a href="#l75.244"></a><span id="l75.244">     // the name is the trailing directory in the path</span>
<a href="#l75.245"></a><span id="l75.245" class="difflineminus">-    nsCAutoString fileName;</span>
<a href="#l75.246"></a><span id="l75.246" class="difflineminus">-    nsCAutoString escapedFileName;</span>
<a href="#l75.247"></a><span id="l75.247" class="difflineplus">+    nsAutoCString fileName;</span>
<a href="#l75.248"></a><span id="l75.248" class="difflineplus">+    nsAutoCString escapedFileName;</span>
<a href="#l75.249"></a><span id="l75.249">     url-&gt;GetFileName(escapedFileName);</span>
<a href="#l75.250"></a><span id="l75.250">     if (!escapedFileName.IsEmpty())</span>
<a href="#l75.251"></a><span id="l75.251">     {</span>
<a href="#l75.252"></a><span id="l75.252">       // XXX conversion to unicode here? is fileName in UTF8?</span>
<a href="#l75.253"></a><span id="l75.253">       // yes, let's say it is in utf8</span>
<a href="#l75.254"></a><span id="l75.254">       MsgUnescapeString(escapedFileName, 0, fileName);</span>
<a href="#l75.255"></a><span id="l75.255">       NS_ASSERTION(MsgIsUTF8(fileName), &quot;fileName is not in UTF-8&quot;);</span>
<a href="#l75.256"></a><span id="l75.256">       CopyUTF8toUTF16(fileName, mName);</span>
<a href="#l75.257"></a><span id="l75.257" class="difflineat">@@ -3167,32 +3167,32 @@ nsMsgDBFolder::parseURI(bool needServer)</span>
<a href="#l75.258"></a><span id="l75.258">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.259"></a><span id="l75.259">     }</span>
<a href="#l75.260"></a><span id="l75.260">     mServer = do_GetWeakReference(server);</span>
<a href="#l75.261"></a><span id="l75.261">   } /* !mServer */</span>
<a href="#l75.262"></a><span id="l75.262"> </span>
<a href="#l75.263"></a><span id="l75.263">   // now try to find the local path for this folder</span>
<a href="#l75.264"></a><span id="l75.264">   if (server)</span>
<a href="#l75.265"></a><span id="l75.265">   {</span>
<a href="#l75.266"></a><span id="l75.266" class="difflineminus">-    nsCAutoString newPath;</span>
<a href="#l75.267"></a><span id="l75.267" class="difflineminus">-    nsCAutoString escapedUrlPath;</span>
<a href="#l75.268"></a><span id="l75.268" class="difflineminus">-    nsCAutoString urlPath;</span>
<a href="#l75.269"></a><span id="l75.269" class="difflineplus">+    nsAutoCString newPath;</span>
<a href="#l75.270"></a><span id="l75.270" class="difflineplus">+    nsAutoCString escapedUrlPath;</span>
<a href="#l75.271"></a><span id="l75.271" class="difflineplus">+    nsAutoCString urlPath;</span>
<a href="#l75.272"></a><span id="l75.272">     url-&gt;GetFilePath(escapedUrlPath);</span>
<a href="#l75.273"></a><span id="l75.273">     if (!escapedUrlPath.IsEmpty())</span>
<a href="#l75.274"></a><span id="l75.274">     {</span>
<a href="#l75.275"></a><span id="l75.275">       MsgUnescapeString(escapedUrlPath, 0, urlPath);</span>
<a href="#l75.276"></a><span id="l75.276"> </span>
<a href="#l75.277"></a><span id="l75.277">       // transform the filepath from the URI, such as</span>
<a href="#l75.278"></a><span id="l75.278">       // &quot;/folder1/folder2/foldern&quot;</span>
<a href="#l75.279"></a><span id="l75.279">       // to</span>
<a href="#l75.280"></a><span id="l75.280">       // &quot;folder1.sbd/folder2.sbd/foldern&quot;</span>
<a href="#l75.281"></a><span id="l75.281">       // (remove leading / and add .sbd to first n-1 folders)</span>
<a href="#l75.282"></a><span id="l75.282">       // to be appended onto the server's path</span>
<a href="#l75.283"></a><span id="l75.283">       bool isNewsFolder = false;</span>
<a href="#l75.284"></a><span id="l75.284" class="difflineminus">-      nsCAutoString scheme;</span>
<a href="#l75.285"></a><span id="l75.285" class="difflineplus">+      nsAutoCString scheme;</span>
<a href="#l75.286"></a><span id="l75.286">       if (NS_SUCCEEDED(url-&gt;GetScheme(scheme)))</span>
<a href="#l75.287"></a><span id="l75.287">       {</span>
<a href="#l75.288"></a><span id="l75.288">         isNewsFolder = scheme.EqualsLiteral(&quot;news&quot;) ||</span>
<a href="#l75.289"></a><span id="l75.289">                        scheme.EqualsLiteral(&quot;snews&quot;) ||</span>
<a href="#l75.290"></a><span id="l75.290">                        scheme.EqualsLiteral(&quot;nntp&quot;);</span>
<a href="#l75.291"></a><span id="l75.291">       }</span>
<a href="#l75.292"></a><span id="l75.292">       NS_MsgCreatePathStringFromFolderURI(urlPath.get(), newPath, scheme,</span>
<a href="#l75.293"></a><span id="l75.293">                                           isNewsFolder);</span>
<a href="#l75.294"></a><span id="l75.294" class="difflineat">@@ -3660,22 +3660,22 @@ NS_IMETHODIMP nsMsgDBFolder::AddSubfolde</span>
<a href="#l75.295"></a><span id="l75.295"> {</span>
<a href="#l75.296"></a><span id="l75.296">   NS_ENSURE_ARG_POINTER(child);</span>
<a href="#l75.297"></a><span id="l75.297"> </span>
<a href="#l75.298"></a><span id="l75.298">   int32_t flags = 0;</span>
<a href="#l75.299"></a><span id="l75.299">   nsresult rv;</span>
<a href="#l75.300"></a><span id="l75.300">   nsCOMPtr&lt;nsIRDFService&gt; rdf = do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;, &amp;rv);</span>
<a href="#l75.301"></a><span id="l75.301">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l75.302"></a><span id="l75.302"> </span>
<a href="#l75.303"></a><span id="l75.303" class="difflineminus">-  nsCAutoString uri(mURI);</span>
<a href="#l75.304"></a><span id="l75.304" class="difflineplus">+  nsAutoCString uri(mURI);</span>
<a href="#l75.305"></a><span id="l75.305">   uri.Append('/');</span>
<a href="#l75.306"></a><span id="l75.306"> </span>
<a href="#l75.307"></a><span id="l75.307">   // URI should use UTF-8</span>
<a href="#l75.308"></a><span id="l75.308">   // (see RFC2396 Uniform Resource Identifiers (URI): Generic Syntax)</span>
<a href="#l75.309"></a><span id="l75.309" class="difflineminus">-  nsCAutoString escapedName;</span>
<a href="#l75.310"></a><span id="l75.310" class="difflineplus">+  nsAutoCString escapedName;</span>
<a href="#l75.311"></a><span id="l75.311">   rv = NS_MsgEscapeEncodeURLPath(name, escapedName);</span>
<a href="#l75.312"></a><span id="l75.312">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.313"></a><span id="l75.313"> </span>
<a href="#l75.314"></a><span id="l75.314">   // fix for #192780</span>
<a href="#l75.315"></a><span id="l75.315">   // if this is the root folder</span>
<a href="#l75.316"></a><span id="l75.316">   // make sure the the special folders</span>
<a href="#l75.317"></a><span id="l75.317">   // have the right uri.</span>
<a href="#l75.318"></a><span id="l75.318">   // on disk, host\INBOX should be a folder with the uri mailbox://user@host/Inbox&quot;</span>
<a href="#l75.319"></a><span id="l75.319" class="difflineat">@@ -3893,17 +3893,17 @@ nsresult nsMsgDBFolder::GetBackupSummary</span>
<a href="#l75.320"></a><span id="l75.320">     rv = backupDBDummyFolder-&gt;AppendNative(newName);</span>
<a href="#l75.321"></a><span id="l75.321">   }</span>
<a href="#l75.322"></a><span id="l75.322">   else // if newName is null, use the folder name</span>
<a href="#l75.323"></a><span id="l75.323">   {</span>
<a href="#l75.324"></a><span id="l75.324">     nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l75.325"></a><span id="l75.325">     rv = GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l75.326"></a><span id="l75.326">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.327"></a><span id="l75.327"> </span>
<a href="#l75.328"></a><span id="l75.328" class="difflineminus">-    nsCAutoString folderName;</span>
<a href="#l75.329"></a><span id="l75.329" class="difflineplus">+    nsAutoCString folderName;</span>
<a href="#l75.330"></a><span id="l75.330">     rv = folderPath-&gt;GetNativeLeafName(folderName);</span>
<a href="#l75.331"></a><span id="l75.331">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.332"></a><span id="l75.332">     rv = backupDBDummyFolder-&gt;AppendNative(folderName);</span>
<a href="#l75.333"></a><span id="l75.333">   }</span>
<a href="#l75.334"></a><span id="l75.334">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.335"></a><span id="l75.335"> </span>
<a href="#l75.336"></a><span id="l75.336">   nsCOMPtr&lt;nsIFile&gt; backupDBFile;</span>
<a href="#l75.337"></a><span id="l75.337">   rv = GetSummaryFileLocation(backupDBDummyFolder, getter_AddRefs(backupDBFile));</span>
<a href="#l75.338"></a><span id="l75.338" class="difflineat">@@ -4623,19 +4623,19 @@ NS_IMETHODIMP nsMsgDBFolder::GetNumNewMe</span>
<a href="#l75.339"></a><span id="l75.339"> </span>
<a href="#l75.340"></a><span id="l75.340"> NS_IMETHODIMP nsMsgDBFolder::SetNumNewMessages(int32_t aNumNewMessages)</span>
<a href="#l75.341"></a><span id="l75.341"> {</span>
<a href="#l75.342"></a><span id="l75.342">   if (aNumNewMessages != mNumNewBiffMessages)</span>
<a href="#l75.343"></a><span id="l75.343">   {</span>
<a href="#l75.344"></a><span id="l75.344">     int32_t oldNumMessages = mNumNewBiffMessages;</span>
<a href="#l75.345"></a><span id="l75.345">     mNumNewBiffMessages = aNumNewMessages;</span>
<a href="#l75.346"></a><span id="l75.346"> </span>
<a href="#l75.347"></a><span id="l75.347" class="difflineminus">-    nsCAutoString oldNumMessagesStr;</span>
<a href="#l75.348"></a><span id="l75.348" class="difflineplus">+    nsAutoCString oldNumMessagesStr;</span>
<a href="#l75.349"></a><span id="l75.349">     oldNumMessagesStr.AppendInt(oldNumMessages);</span>
<a href="#l75.350"></a><span id="l75.350" class="difflineminus">-    nsCAutoString newNumMessagesStr;</span>
<a href="#l75.351"></a><span id="l75.351" class="difflineplus">+    nsAutoCString newNumMessagesStr;</span>
<a href="#l75.352"></a><span id="l75.352">     newNumMessagesStr.AppendInt(aNumNewMessages);</span>
<a href="#l75.353"></a><span id="l75.353">     NotifyPropertyChanged(kNumNewBiffMessagesAtom, oldNumMessagesStr, newNumMessagesStr);</span>
<a href="#l75.354"></a><span id="l75.354">   }</span>
<a href="#l75.355"></a><span id="l75.355">   return NS_OK;</span>
<a href="#l75.356"></a><span id="l75.356"> }</span>
<a href="#l75.357"></a><span id="l75.357"> </span>
<a href="#l75.358"></a><span id="l75.358"> NS_IMETHODIMP nsMsgDBFolder::GetRootFolder(nsIMsgFolder * *aRootFolder)</span>
<a href="#l75.359"></a><span id="l75.359"> {</span>
<a href="#l75.360"></a><span id="l75.360" class="difflineat">@@ -5099,17 +5099,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetBaseMess</span>
<a href="#l75.361"></a><span id="l75.361">   return NS_OK;</span>
<a href="#l75.362"></a><span id="l75.362"> }</span>
<a href="#l75.363"></a><span id="l75.363"> </span>
<a href="#l75.364"></a><span id="l75.364"> NS_IMETHODIMP nsMsgDBFolder::GetUriForMsg(nsIMsgDBHdr *msgHdr, nsACString&amp; aURI)</span>
<a href="#l75.365"></a><span id="l75.365"> {</span>
<a href="#l75.366"></a><span id="l75.366">   NS_ENSURE_ARG(msgHdr);</span>
<a href="#l75.367"></a><span id="l75.367">   nsMsgKey msgKey;</span>
<a href="#l75.368"></a><span id="l75.368">   msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l75.369"></a><span id="l75.369" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l75.370"></a><span id="l75.370" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l75.371"></a><span id="l75.371">   uri.Assign(mBaseMessageURI);</span>
<a href="#l75.372"></a><span id="l75.372"> </span>
<a href="#l75.373"></a><span id="l75.373">   // append a &quot;#&quot; followed by the message key.</span>
<a href="#l75.374"></a><span id="l75.374">   uri.Append('#');</span>
<a href="#l75.375"></a><span id="l75.375">   uri.AppendInt(msgKey);</span>
<a href="#l75.376"></a><span id="l75.376">   aURI = uri;</span>
<a href="#l75.377"></a><span id="l75.377">   return NS_OK;</span>
<a href="#l75.378"></a><span id="l75.378"> }</span>
<a href="#l75.379"></a><span id="l75.379" class="difflineat">@@ -5396,21 +5396,21 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l75.380"></a><span id="l75.380">    3. mime message, text/plain - body follows headers</span>
<a href="#l75.381"></a><span id="l75.381">    4. multipart/mixed - scan past boundary, treat next part as body.</span>
<a href="#l75.382"></a><span id="l75.382">    */</span>
<a href="#l75.383"></a><span id="l75.383"> </span>
<a href="#l75.384"></a><span id="l75.384">   nsLineBuffer&lt;char&gt; *lineBuffer;</span>
<a href="#l75.385"></a><span id="l75.385">   nsresult rv = NS_InitLineBuffer(&amp;lineBuffer);</span>
<a href="#l75.386"></a><span id="l75.386">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.387"></a><span id="l75.387"> </span>
<a href="#l75.388"></a><span id="l75.388" class="difflineminus">-  nsCAutoString msgText;</span>
<a href="#l75.389"></a><span id="l75.389" class="difflineplus">+  nsAutoCString msgText;</span>
<a href="#l75.390"></a><span id="l75.390">   nsAutoString contentType;</span>
<a href="#l75.391"></a><span id="l75.391">   nsAutoString encoding;</span>
<a href="#l75.392"></a><span id="l75.392" class="difflineminus">-  nsCAutoString curLine;</span>
<a href="#l75.393"></a><span id="l75.393" class="difflineminus">-  nsCAutoString charset(aCharset);</span>
<a href="#l75.394"></a><span id="l75.394" class="difflineplus">+  nsAutoCString curLine;</span>
<a href="#l75.395"></a><span id="l75.395" class="difflineplus">+  nsAutoCString charset(aCharset);</span>
<a href="#l75.396"></a><span id="l75.396"> </span>
<a href="#l75.397"></a><span id="l75.397">   // might want to use a state var instead of bools.</span>
<a href="#l75.398"></a><span id="l75.398">   bool msgBodyIsHtml = false;</span>
<a href="#l75.399"></a><span id="l75.399">   bool more = true;</span>
<a href="#l75.400"></a><span id="l75.400">   bool reachedEndBody = false;</span>
<a href="#l75.401"></a><span id="l75.401">   bool isBase64 = false;</span>
<a href="#l75.402"></a><span id="l75.402">   bool inMsgBody = false;</span>
<a href="#l75.403"></a><span id="l75.403">   bool justPassedEndBoundary = false;</span>
<a href="#l75.404"></a><span id="l75.404" class="difflineat">@@ -5423,17 +5423,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l75.405"></a><span id="l75.405">   nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimeHdrParam(do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv));</span>
<a href="#l75.406"></a><span id="l75.406">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.407"></a><span id="l75.407"> </span>
<a href="#l75.408"></a><span id="l75.408">   // Stack of boundaries, used to figure out where we are</span>
<a href="#l75.409"></a><span id="l75.409">   nsTArray&lt;nsCString&gt; boundaryStack;</span>
<a href="#l75.410"></a><span id="l75.410"> </span>
<a href="#l75.411"></a><span id="l75.411">   while (!inMsgBody &amp;&amp; bytesRead &lt;= bytesToRead)</span>
<a href="#l75.412"></a><span id="l75.412">   {</span>
<a href="#l75.413"></a><span id="l75.413" class="difflineminus">-    nsCAutoString msgHeaders;</span>
<a href="#l75.414"></a><span id="l75.414" class="difflineplus">+    nsAutoCString msgHeaders;</span>
<a href="#l75.415"></a><span id="l75.415">     // We want to NS_ReadLine until we get to a blank line (the end of the headers)</span>
<a href="#l75.416"></a><span id="l75.416">     while (more)</span>
<a href="#l75.417"></a><span id="l75.417">     {</span>
<a href="#l75.418"></a><span id="l75.418">       rv = NS_ReadLine(stream, lineBuffer, curLine, &amp;more);</span>
<a href="#l75.419"></a><span id="l75.419">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.420"></a><span id="l75.420">       if (curLine.IsEmpty())</span>
<a href="#l75.421"></a><span id="l75.421">         break;</span>
<a href="#l75.422"></a><span id="l75.422">       msgHeaders.Append(curLine);</span>
<a href="#l75.423"></a><span id="l75.423" class="difflineat">@@ -5446,17 +5446,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l75.424"></a><span id="l75.424">     // There's no point in processing if we can't get the body</span>
<a href="#l75.425"></a><span id="l75.425">     if (bytesRead &gt; bytesToRead)</span>
<a href="#l75.426"></a><span id="l75.426">       break;</span>
<a href="#l75.427"></a><span id="l75.427"> </span>
<a href="#l75.428"></a><span id="l75.428">     // Process the headers, looking for things we need</span>
<a href="#l75.429"></a><span id="l75.429">     rv = mimeHeaders-&gt;Initialize(msgHeaders.get(), msgHeaders.Length());</span>
<a href="#l75.430"></a><span id="l75.430">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l75.431"></a><span id="l75.431"> </span>
<a href="#l75.432"></a><span id="l75.432" class="difflineminus">-    nsCAutoString contentTypeHdr;</span>
<a href="#l75.433"></a><span id="l75.433" class="difflineplus">+    nsAutoCString contentTypeHdr;</span>
<a href="#l75.434"></a><span id="l75.434">     mimeHeaders-&gt;ExtractHeader(&quot;Content-Type&quot;, false, getter_Copies(contentTypeHdr));</span>
<a href="#l75.435"></a><span id="l75.435"> </span>
<a href="#l75.436"></a><span id="l75.436">     // Get the content type</span>
<a href="#l75.437"></a><span id="l75.437">     // If we don't have a content type, then we assign text/plain</span>
<a href="#l75.438"></a><span id="l75.438">     // this is in violation of the RFC for multipart/digest, though</span>
<a href="#l75.439"></a><span id="l75.439">     // Also, if we've just passed an end boundary, we're going to ignore this.</span>
<a href="#l75.440"></a><span id="l75.440">     if (!justPassedEndBoundary &amp;&amp; contentTypeHdr.IsEmpty())</span>
<a href="#l75.441"></a><span id="l75.441">       contentType.Assign(NS_LITERAL_STRING(&quot;text/plain&quot;));</span>
<a href="#l75.442"></a><span id="l75.442" class="difflineat">@@ -5467,17 +5467,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l75.443"></a><span id="l75.443"> </span>
<a href="#l75.444"></a><span id="l75.444">     // If we are multipart, then we need to get the boundary</span>
<a href="#l75.445"></a><span id="l75.445">     if (StringBeginsWith(contentType, NS_LITERAL_STRING(&quot;multipart/&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l75.446"></a><span id="l75.446">     {</span>
<a href="#l75.447"></a><span id="l75.447">       nsAutoString boundaryParam;</span>
<a href="#l75.448"></a><span id="l75.448">       mimeHdrParam-&gt;GetParameter(contentTypeHdr, &quot;boundary&quot;, EmptyCString(), false, nullptr, boundaryParam);</span>
<a href="#l75.449"></a><span id="l75.449">       if (!boundaryParam.IsEmpty())</span>
<a href="#l75.450"></a><span id="l75.450">       {</span>
<a href="#l75.451"></a><span id="l75.451" class="difflineminus">-        nsCAutoString boundary(NS_LITERAL_CSTRING(&quot;--&quot;));</span>
<a href="#l75.452"></a><span id="l75.452" class="difflineplus">+        nsAutoCString boundary(NS_LITERAL_CSTRING(&quot;--&quot;));</span>
<a href="#l75.453"></a><span id="l75.453">         boundary.Append(NS_ConvertUTF16toUTF8(boundaryParam));</span>
<a href="#l75.454"></a><span id="l75.454">         boundaryStack.AppendElement(boundary);</span>
<a href="#l75.455"></a><span id="l75.455">       }</span>
<a href="#l75.456"></a><span id="l75.456">     }</span>
<a href="#l75.457"></a><span id="l75.457"> </span>
<a href="#l75.458"></a><span id="l75.458">     // If we are message/rfc822, then there's another header block coming up</span>
<a href="#l75.459"></a><span id="l75.459">     else if (contentType.LowerCaseEqualsLiteral(&quot;message/rfc822&quot;))</span>
<a href="#l75.460"></a><span id="l75.460">       continue;</span>
<a href="#l75.461"></a><span id="l75.461" class="difflineat">@@ -5494,29 +5494,29 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l75.462"></a><span id="l75.462">       if (charset.IsEmpty())</span>
<a href="#l75.463"></a><span id="l75.463">       {</span>
<a href="#l75.464"></a><span id="l75.464">         nsAutoString charsetW;</span>
<a href="#l75.465"></a><span id="l75.465">         mimeHdrParam-&gt;GetParameter(contentTypeHdr, &quot;charset&quot;, EmptyCString(), false, nullptr, charsetW);</span>
<a href="#l75.466"></a><span id="l75.466">         charset.Assign(NS_ConvertUTF16toUTF8(charsetW));</span>
<a href="#l75.467"></a><span id="l75.467">       }</span>
<a href="#l75.468"></a><span id="l75.468"> </span>
<a href="#l75.469"></a><span id="l75.469">       // Finally, get the encoding</span>
<a href="#l75.470"></a><span id="l75.470" class="difflineminus">-      nsCAutoString encodingHdr;</span>
<a href="#l75.471"></a><span id="l75.471" class="difflineplus">+      nsAutoCString encodingHdr;</span>
<a href="#l75.472"></a><span id="l75.472">       mimeHeaders-&gt;ExtractHeader(&quot;Content-Transfer-Encoding&quot;, false, getter_Copies(encodingHdr));</span>
<a href="#l75.473"></a><span id="l75.473">       if (!encodingHdr.IsEmpty())</span>
<a href="#l75.474"></a><span id="l75.474">         mimeHdrParam-&gt;GetParameter(encodingHdr, nullptr, EmptyCString(), false, nullptr, encoding);</span>
<a href="#l75.475"></a><span id="l75.475"> </span>
<a href="#l75.476"></a><span id="l75.476">       if (encoding.LowerCaseEqualsLiteral(ENCODING_BASE64))</span>
<a href="#l75.477"></a><span id="l75.477">         isBase64 = true;</span>
<a href="#l75.478"></a><span id="l75.478">     }</span>
<a href="#l75.479"></a><span id="l75.479"> </span>
<a href="#l75.480"></a><span id="l75.480">     // We need to consume the rest, until the next headers</span>
<a href="#l75.481"></a><span id="l75.481">     uint32_t count = boundaryStack.Length();</span>
<a href="#l75.482"></a><span id="l75.482" class="difflineminus">-    nsCAutoString boundary;</span>
<a href="#l75.483"></a><span id="l75.483" class="difflineminus">-    nsCAutoString endBoundary;</span>
<a href="#l75.484"></a><span id="l75.484" class="difflineplus">+    nsAutoCString boundary;</span>
<a href="#l75.485"></a><span id="l75.485" class="difflineplus">+    nsAutoCString endBoundary;</span>
<a href="#l75.486"></a><span id="l75.486">     if (count)</span>
<a href="#l75.487"></a><span id="l75.487">     {</span>
<a href="#l75.488"></a><span id="l75.488">       boundary.Assign(boundaryStack.ElementAt(count - 1));</span>
<a href="#l75.489"></a><span id="l75.489">       endBoundary.Assign(boundary);</span>
<a href="#l75.490"></a><span id="l75.490">       endBoundary.Append(NS_LITERAL_CSTRING(&quot;--&quot;));</span>
<a href="#l75.491"></a><span id="l75.491">     }</span>
<a href="#l75.492"></a><span id="l75.492">     while (more)</span>
<a href="#l75.493"></a><span id="l75.493">     {</span>
<a href="#l75.494"></a><span id="l75.494" class="difflineat">@@ -5687,19 +5687,19 @@ NS_IMETHODIMP nsMsgDBFolder::ConvertMsgS</span>
<a href="#l75.495"></a><span id="l75.495">   nsCOMPtr&lt;nsIParserUtils&gt; utils =</span>
<a href="#l75.496"></a><span id="l75.496">     do_GetService(NS_PARSERUTILS_CONTRACTID);</span>
<a href="#l75.497"></a><span id="l75.497">   return utils-&gt;ConvertToPlainText(aMessageText, flags, 80, aOutText);</span>
<a href="#l75.498"></a><span id="l75.498"> }</span>
<a href="#l75.499"></a><span id="l75.499"> </span>
<a href="#l75.500"></a><span id="l75.500"> nsresult nsMsgDBFolder::GetMsgPreviewTextFromStream(nsIMsgDBHdr *msgHdr, nsIInputStream *stream)</span>
<a href="#l75.501"></a><span id="l75.501"> {</span>
<a href="#l75.502"></a><span id="l75.502">   nsCString msgBody;</span>
<a href="#l75.503"></a><span id="l75.503" class="difflineminus">-  nsCAutoString charset;</span>
<a href="#l75.504"></a><span id="l75.504" class="difflineplus">+  nsAutoCString charset;</span>
<a href="#l75.505"></a><span id="l75.505">   msgHdr-&gt;GetCharset(getter_Copies(charset));</span>
<a href="#l75.506"></a><span id="l75.506" class="difflineminus">-  nsCAutoString contentType;</span>
<a href="#l75.507"></a><span id="l75.507" class="difflineplus">+  nsAutoCString contentType;</span>
<a href="#l75.508"></a><span id="l75.508">   nsresult rv = GetMsgTextFromStream(stream, charset, 4096, 255, true, true, contentType, msgBody);</span>
<a href="#l75.509"></a><span id="l75.509">   // replaces all tabs and line returns with a space, </span>
<a href="#l75.510"></a><span id="l75.510">   // then trims off leading and trailing white space</span>
<a href="#l75.511"></a><span id="l75.511">   MsgCompressWhitespace(msgBody);</span>
<a href="#l75.512"></a><span id="l75.512">   msgHdr-&gt;SetStringProperty(&quot;preview&quot;, msgBody.get());</span>
<a href="#l75.513"></a><span id="l75.513">   return rv;</span>
<a href="#l75.514"></a><span id="l75.514"> }</span>
<a href="#l75.515"></a><span id="l75.515"> </span>
<a href="#l75.516"></a><span id="l75.516" class="difflineat">@@ -5721,26 +5721,26 @@ void nsMsgDBFolder::UpdateTimestamps(boo</span>
<a href="#l75.517"></a><span id="l75.517">     }</span>
<a href="#l75.518"></a><span id="l75.518">   }</span>
<a href="#l75.519"></a><span id="l75.519"> }</span>
<a href="#l75.520"></a><span id="l75.520"> </span>
<a href="#l75.521"></a><span id="l75.521"> void nsMsgDBFolder::SetMRUTime()</span>
<a href="#l75.522"></a><span id="l75.522"> {</span>
<a href="#l75.523"></a><span id="l75.523">   uint32_t seconds;</span>
<a href="#l75.524"></a><span id="l75.524">   PRTime2Seconds(PR_Now(), &amp;seconds);</span>
<a href="#l75.525"></a><span id="l75.525" class="difflineminus">-  nsCAutoString nowStr;</span>
<a href="#l75.526"></a><span id="l75.526" class="difflineplus">+  nsAutoCString nowStr;</span>
<a href="#l75.527"></a><span id="l75.527">   nowStr.AppendInt(seconds);</span>
<a href="#l75.528"></a><span id="l75.528">   SetStringProperty(MRU_TIME_PROPERTY, nowStr);</span>
<a href="#l75.529"></a><span id="l75.529"> }</span>
<a href="#l75.530"></a><span id="l75.530"> </span>
<a href="#l75.531"></a><span id="l75.531"> void nsMsgDBFolder::SetMRMTime()</span>
<a href="#l75.532"></a><span id="l75.532"> {</span>
<a href="#l75.533"></a><span id="l75.533">   uint32_t seconds;</span>
<a href="#l75.534"></a><span id="l75.534">   PRTime2Seconds(PR_Now(), &amp;seconds);</span>
<a href="#l75.535"></a><span id="l75.535" class="difflineminus">-  nsCAutoString nowStr;</span>
<a href="#l75.536"></a><span id="l75.536" class="difflineplus">+  nsAutoCString nowStr;</span>
<a href="#l75.537"></a><span id="l75.537">   nowStr.AppendInt(seconds);</span>
<a href="#l75.538"></a><span id="l75.538">   SetStringProperty(MRM_TIME_PROPERTY, nowStr);</span>
<a href="#l75.539"></a><span id="l75.539"> }</span>
<a href="#l75.540"></a><span id="l75.540"> </span>
<a href="#l75.541"></a><span id="l75.541"> NS_IMETHODIMP nsMsgDBFolder::AddKeywordsToMessages(nsIArray *aMessages, const nsACString&amp; aKeywords)</span>
<a href="#l75.542"></a><span id="l75.542"> {</span>
<a href="#l75.543"></a><span id="l75.543">   NS_ENSURE_ARG(aMessages);</span>
<a href="#l75.544"></a><span id="l75.544">   nsresult rv = NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -157,17 +157,17 @@ nsresult nsMsgI18NConvertToUnicode(const</span>
<a href="#l76.4"></a><span id="l76.4">   }</span>
<a href="#l76.5"></a><span id="l76.5">   return rv;</span>
<a href="#l76.6"></a><span id="l76.6"> }</span>
<a href="#l76.7"></a><span id="l76.7"> </span>
<a href="#l76.8"></a><span id="l76.8"> // Charset used by the file system.</span>
<a href="#l76.9"></a><span id="l76.9"> const char * nsMsgI18NFileSystemCharset()</span>
<a href="#l76.10"></a><span id="l76.10"> {</span>
<a href="#l76.11"></a><span id="l76.11">   /* Get a charset used for the file. */</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  static nsCAutoString fileSystemCharset;</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+  static nsAutoCString fileSystemCharset;</span>
<a href="#l76.14"></a><span id="l76.14"> </span>
<a href="#l76.15"></a><span id="l76.15">   if (fileSystemCharset.IsEmpty()) </span>
<a href="#l76.16"></a><span id="l76.16">   {</span>
<a href="#l76.17"></a><span id="l76.17">     nsresult rv;</span>
<a href="#l76.18"></a><span id="l76.18">     nsCOMPtr &lt;nsIPlatformCharset&gt; platformCharset = do_GetService(NS_PLATFORMCHARSET_CONTRACTID, &amp;rv);</span>
<a href="#l76.19"></a><span id="l76.19">         if (NS_SUCCEEDED(rv)) {</span>
<a href="#l76.20"></a><span id="l76.20">           rv = platformCharset-&gt;GetCharset(kPlatformCharsetSel_FileName,</span>
<a href="#l76.21"></a><span id="l76.21">                                            fileSystemCharset);</span>
<a href="#l76.22"></a><span id="l76.22" class="difflineat">@@ -195,17 +195,17 @@ void nsMsgI18NTextFileCharset(nsACString</span>
<a href="#l76.23"></a><span id="l76.23"> }</span>
<a href="#l76.24"></a><span id="l76.24"> </span>
<a href="#l76.25"></a><span id="l76.25"> // MIME encoder, output string should be freed by PR_FREE</span>
<a href="#l76.26"></a><span id="l76.26"> // XXX : fix callers later to avoid allocation and copy</span>
<a href="#l76.27"></a><span id="l76.27"> char * nsMsgI18NEncodeMimePartIIStr(const char *header, bool structured, const char *charset, int32_t fieldnamelen, bool usemime) </span>
<a href="#l76.28"></a><span id="l76.28"> {</span>
<a href="#l76.29"></a><span id="l76.29">   // No MIME, convert to the outgoing mail charset.</span>
<a href="#l76.30"></a><span id="l76.30">   if (false == usemime) {</span>
<a href="#l76.31"></a><span id="l76.31" class="difflineminus">-    nsCAutoString convertedStr;</span>
<a href="#l76.32"></a><span id="l76.32" class="difflineplus">+    nsAutoCString convertedStr;</span>
<a href="#l76.33"></a><span id="l76.33">     if (NS_SUCCEEDED(ConvertFromUnicode(charset, NS_ConvertUTF8toUTF16(header),</span>
<a href="#l76.34"></a><span id="l76.34">                                         convertedStr)))</span>
<a href="#l76.35"></a><span id="l76.35">       return PL_strdup(convertedStr.get());</span>
<a href="#l76.36"></a><span id="l76.36">     else</span>
<a href="#l76.37"></a><span id="l76.37">       return PL_strdup(header);</span>
<a href="#l76.38"></a><span id="l76.38">   }</span>
<a href="#l76.39"></a><span id="l76.39"> </span>
<a href="#l76.40"></a><span id="l76.40">   char *encodedString = nullptr;</span>
<a href="#l76.41"></a><span id="l76.41" class="difflineat">@@ -391,17 +391,17 @@ nsresult nsMsgI18NSaveAsCharset(const ch</span>
<a href="#l76.42"></a><span id="l76.42">   else if (PL_strcasecmp(contentType, TEXT_PLAIN)) {</span>
<a href="#l76.43"></a><span id="l76.43">     return NS_ERROR_ILLEGAL_VALUE;  // not supported type</span>
<a href="#l76.44"></a><span id="l76.44">   }</span>
<a href="#l76.45"></a><span id="l76.45"> </span>
<a href="#l76.46"></a><span id="l76.46">   nsCOMPtr &lt;nsICharsetConverterManager&gt; ccm =</span>
<a href="#l76.47"></a><span id="l76.47">     do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;res);</span>
<a href="#l76.48"></a><span id="l76.48">   NS_ENSURE_SUCCESS(res, res);</span>
<a href="#l76.49"></a><span id="l76.49"> </span>
<a href="#l76.50"></a><span id="l76.50" class="difflineminus">-  nsCAutoString charsetName;</span>
<a href="#l76.51"></a><span id="l76.51" class="difflineplus">+  nsAutoCString charsetName;</span>
<a href="#l76.52"></a><span id="l76.52">   res = ccm-&gt;GetCharsetAlias(charset, charsetName);</span>
<a href="#l76.53"></a><span id="l76.53">   NS_ENSURE_SUCCESS(res, res);</span>
<a href="#l76.54"></a><span id="l76.54"> </span>
<a href="#l76.55"></a><span id="l76.55">   // charset converter plus entity, NCR generation</span>
<a href="#l76.56"></a><span id="l76.56">   nsCOMPtr &lt;nsISaveAsCharset&gt; conv = do_CreateInstance(NS_SAVEASCHARSET_CONTRACTID, &amp;res);</span>
<a href="#l76.57"></a><span id="l76.57">   NS_ENSURE_SUCCESS(res, res);</span>
<a href="#l76.58"></a><span id="l76.58"> </span>
<a href="#l76.59"></a><span id="l76.59">   // attribute: </span>
<a href="#l76.60"></a><span id="l76.60" class="difflineat">@@ -427,17 +427,17 @@ nsresult nsMsgI18NSaveAsCharset(const ch</span>
<a href="#l76.61"></a><span id="l76.61">   res = conv-&gt;Convert(input, outString);</span>
<a href="#l76.62"></a><span id="l76.62"> </span>
<a href="#l76.63"></a><span id="l76.63">   // If the converer cannot encode to the charset,</span>
<a href="#l76.64"></a><span id="l76.64">   // then fallback to pref sepcified charsets.</span>
<a href="#l76.65"></a><span id="l76.65">   if (NS_ERROR_UENC_NOMAPPING == res &amp;&amp; !bTEXT_HTML &amp;&amp; fallbackCharset) {</span>
<a href="#l76.66"></a><span id="l76.66">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;res));</span>
<a href="#l76.67"></a><span id="l76.67">     NS_ENSURE_SUCCESS(res, res);</span>
<a href="#l76.68"></a><span id="l76.68"> </span>
<a href="#l76.69"></a><span id="l76.69" class="difflineminus">-    nsCAutoString prefString(&quot;intl.fallbackCharsetList.&quot;);</span>
<a href="#l76.70"></a><span id="l76.70" class="difflineplus">+    nsAutoCString prefString(&quot;intl.fallbackCharsetList.&quot;);</span>
<a href="#l76.71"></a><span id="l76.71">     prefString.Append(charset);</span>
<a href="#l76.72"></a><span id="l76.72">     nsCString fallbackList;</span>
<a href="#l76.73"></a><span id="l76.73">     res = prefBranch-&gt;GetCharPref(prefString.get(), getter_Copies(fallbackList));</span>
<a href="#l76.74"></a><span id="l76.74">     // do the fallback only if there is a pref for the charset</span>
<a href="#l76.75"></a><span id="l76.75">     if (NS_FAILED(res) || fallbackList.IsEmpty())</span>
<a href="#l76.76"></a><span id="l76.76">       return NS_ERROR_UENC_NOMAPPING;</span>
<a href="#l76.77"></a><span id="l76.77"> </span>
<a href="#l76.78"></a><span id="l76.78">     res = conv-&gt;Init(fallbackList.get(), </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -46,17 +46,17 @@ NS_IMETHODIMP</span>
<a href="#l77.4"></a><span id="l77.4"> nsMsgIdentity::SetKey(const nsACString&amp; identityKey)</span>
<a href="#l77.5"></a><span id="l77.5"> {</span>
<a href="#l77.6"></a><span id="l77.6">   mKey = identityKey;</span>
<a href="#l77.7"></a><span id="l77.7">   nsresult rv;</span>
<a href="#l77.8"></a><span id="l77.8">   nsCOMPtr&lt;nsIPrefService&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l77.9"></a><span id="l77.9">   if (NS_FAILED(rv))</span>
<a href="#l77.10"></a><span id="l77.10">     return rv;</span>
<a href="#l77.11"></a><span id="l77.11"> </span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-  nsCAutoString branchName;</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+  nsAutoCString branchName;</span>
<a href="#l77.14"></a><span id="l77.14">   branchName.AssignLiteral(&quot;mail.identity.&quot;);</span>
<a href="#l77.15"></a><span id="l77.15">   branchName += mKey;</span>
<a href="#l77.16"></a><span id="l77.16">   branchName.Append('.');</span>
<a href="#l77.17"></a><span id="l77.17">   rv = prefs-&gt;GetBranch(branchName.get(), getter_AddRefs(mPrefBranch));</span>
<a href="#l77.18"></a><span id="l77.18">   if (NS_FAILED(rv))</span>
<a href="#l77.19"></a><span id="l77.19">     return rv;</span>
<a href="#l77.20"></a><span id="l77.20"> </span>
<a href="#l77.21"></a><span id="l77.21">   rv = prefs-&gt;GetBranch(&quot;mail.identity.default.&quot;, getter_AddRefs(mDefPrefBranch));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -99,17 +99,17 @@ nsMsgIncomingServer::SetKey(const nsACSt</span>
<a href="#l78.4"></a><span id="l78.4"> {</span>
<a href="#l78.5"></a><span id="l78.5">   m_serverKey.Assign(serverKey);</span>
<a href="#l78.6"></a><span id="l78.6"> </span>
<a href="#l78.7"></a><span id="l78.7">   // in order to actually make use of the key, we need the prefs</span>
<a href="#l78.8"></a><span id="l78.8">   nsresult rv;</span>
<a href="#l78.9"></a><span id="l78.9">   nsCOMPtr&lt;nsIPrefService&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l78.10"></a><span id="l78.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.11"></a><span id="l78.11"> </span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-  nsCAutoString branchName;</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+  nsAutoCString branchName;</span>
<a href="#l78.14"></a><span id="l78.14">   branchName.AssignLiteral(&quot;mail.server.&quot;);</span>
<a href="#l78.15"></a><span id="l78.15">   branchName.Append(m_serverKey);</span>
<a href="#l78.16"></a><span id="l78.16">   branchName.Append('.');</span>
<a href="#l78.17"></a><span id="l78.17">   rv = prefs-&gt;GetBranch(branchName.get(), getter_AddRefs(mPrefBranch));</span>
<a href="#l78.18"></a><span id="l78.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.19"></a><span id="l78.19"> </span>
<a href="#l78.20"></a><span id="l78.20">   return prefs-&gt;GetBranch(&quot;mail.server.default.&quot;, getter_AddRefs(mDefPrefBranch));</span>
<a href="#l78.21"></a><span id="l78.21"> }</span>
<a href="#l78.22"></a><span id="l78.22" class="difflineat">@@ -1055,17 +1055,17 @@ nsMsgIncomingServer::GetFilterList(nsIMs</span>
<a href="#l78.23"></a><span id="l78.23">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.24"></a><span id="l78.24"> </span>
<a href="#l78.25"></a><span id="l78.25">       nsCString filterType;</span>
<a href="#l78.26"></a><span id="l78.26">       rv = GetCharValue(&quot;filter.type&quot;, filterType);</span>
<a href="#l78.27"></a><span id="l78.27">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.28"></a><span id="l78.28"> </span>
<a href="#l78.29"></a><span id="l78.29">       if (!filterType.IsEmpty() &amp;&amp; !filterType.EqualsLiteral(&quot;default&quot;))</span>
<a href="#l78.30"></a><span id="l78.30">       {</span>
<a href="#l78.31"></a><span id="l78.31" class="difflineminus">-        nsCAutoString contractID(&quot;@mozilla.org/filterlist;1?type=&quot;);</span>
<a href="#l78.32"></a><span id="l78.32" class="difflineplus">+        nsAutoCString contractID(&quot;@mozilla.org/filterlist;1?type=&quot;);</span>
<a href="#l78.33"></a><span id="l78.33">         contractID += filterType;</span>
<a href="#l78.34"></a><span id="l78.34">         ToLowerCase(contractID);</span>
<a href="#l78.35"></a><span id="l78.35">         mFilterList = do_CreateInstance(contractID.get(), &amp;rv);</span>
<a href="#l78.36"></a><span id="l78.36">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.37"></a><span id="l78.37"> </span>
<a href="#l78.38"></a><span id="l78.38">         rv = mFilterList-&gt;SetFolder(msgFolder);</span>
<a href="#l78.39"></a><span id="l78.39">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.40"></a><span id="l78.40"> </span>
<a href="#l78.41"></a><span id="l78.41" class="difflineat">@@ -1133,17 +1133,17 @@ nsMsgIncomingServer::GetEditableFilterLi</span>
<a href="#l78.42"></a><span id="l78.42">     nsresult rv = GetBoolValue(&quot;filter.editable.separate&quot;, &amp;editSeparate);</span>
<a href="#l78.43"></a><span id="l78.43">     if (NS_FAILED(rv) || !editSeparate)</span>
<a href="#l78.44"></a><span id="l78.44">       return GetFilterList(aMsgWindow, aResult);</span>
<a href="#l78.45"></a><span id="l78.45"> </span>
<a href="#l78.46"></a><span id="l78.46">     nsCString filterType;</span>
<a href="#l78.47"></a><span id="l78.47">     rv = GetCharValue(&quot;filter.editable.type&quot;, filterType);</span>
<a href="#l78.48"></a><span id="l78.48">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.49"></a><span id="l78.49"> </span>
<a href="#l78.50"></a><span id="l78.50" class="difflineminus">-    nsCAutoString contractID(&quot;@mozilla.org/filterlist;1?type=&quot;);</span>
<a href="#l78.51"></a><span id="l78.51" class="difflineplus">+    nsAutoCString contractID(&quot;@mozilla.org/filterlist;1?type=&quot;);</span>
<a href="#l78.52"></a><span id="l78.52">     contractID += filterType;</span>
<a href="#l78.53"></a><span id="l78.53">     ToLowerCase(contractID);</span>
<a href="#l78.54"></a><span id="l78.54">     mEditableFilterList = do_CreateInstance(contractID.get(), &amp;rv);</span>
<a href="#l78.55"></a><span id="l78.55">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.56"></a><span id="l78.56"> </span>
<a href="#l78.57"></a><span id="l78.57">     nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l78.58"></a><span id="l78.58">     // use GetRootFolder so for deferred pop3 accounts, we'll get the filters</span>
<a href="#l78.59"></a><span id="l78.59">     // file from the deferred account, not the deferred to account,</span>
<a href="#l78.60"></a><span id="l78.60" class="difflineat">@@ -1167,17 +1167,17 @@ nsMsgIncomingServer::GetEditableFilterLi</span>
<a href="#l78.61"></a><span id="l78.61"> nsresult</span>
<a href="#l78.62"></a><span id="l78.62"> nsMsgIncomingServer::InternalSetHostName(const nsACString&amp; aHostname, const char * prefName)</span>
<a href="#l78.63"></a><span id="l78.63"> {</span>
<a href="#l78.64"></a><span id="l78.64">   nsCString hostname;</span>
<a href="#l78.65"></a><span id="l78.65">   hostname = aHostname;</span>
<a href="#l78.66"></a><span id="l78.66">   if (MsgCountChar(hostname, ':') == 1)</span>
<a href="#l78.67"></a><span id="l78.67">   {</span>
<a href="#l78.68"></a><span id="l78.68">     int32_t colonPos = hostname.FindChar(':');</span>
<a href="#l78.69"></a><span id="l78.69" class="difflineminus">-    nsCAutoString portString(Substring(hostname, colonPos));</span>
<a href="#l78.70"></a><span id="l78.70" class="difflineplus">+    nsAutoCString portString(Substring(hostname, colonPos));</span>
<a href="#l78.71"></a><span id="l78.71">     hostname.SetLength(colonPos);</span>
<a href="#l78.72"></a><span id="l78.72">     nsresult err;</span>
<a href="#l78.73"></a><span id="l78.73">     int32_t port = portString.ToInteger(&amp;err);</span>
<a href="#l78.74"></a><span id="l78.74">     if (NS_SUCCEEDED(err))</span>
<a href="#l78.75"></a><span id="l78.75">       SetPort(port);</span>
<a href="#l78.76"></a><span id="l78.76">   }</span>
<a href="#l78.77"></a><span id="l78.77">   return SetCharValue(prefName, hostname);</span>
<a href="#l78.78"></a><span id="l78.78"> }</span>
<a href="#l78.79"></a><span id="l78.79" class="difflineat">@@ -1423,17 +1423,17 @@ nsMsgIncomingServer::getProtocolInfo(nsI</span>
<a href="#l78.80"></a><span id="l78.80"> {</span>
<a href="#l78.81"></a><span id="l78.81">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l78.82"></a><span id="l78.82">   nsresult rv;</span>
<a href="#l78.83"></a><span id="l78.83"> </span>
<a href="#l78.84"></a><span id="l78.84">   nsCString type;</span>
<a href="#l78.85"></a><span id="l78.85">   rv = GetType(type);</span>
<a href="#l78.86"></a><span id="l78.86">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.87"></a><span id="l78.87"> </span>
<a href="#l78.88"></a><span id="l78.88" class="difflineminus">-  nsCAutoString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l78.89"></a><span id="l78.89" class="difflineplus">+  nsAutoCString contractid(NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX);</span>
<a href="#l78.90"></a><span id="l78.90">   contractid.Append(type);</span>
<a href="#l78.91"></a><span id="l78.91"> </span>
<a href="#l78.92"></a><span id="l78.92">   nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo = do_GetService(contractid.get(), &amp;rv);</span>
<a href="#l78.93"></a><span id="l78.93">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.94"></a><span id="l78.94">   protocolInfo.swap(*aResult);</span>
<a href="#l78.95"></a><span id="l78.95">   return NS_OK;</span>
<a href="#l78.96"></a><span id="l78.96"> }</span>
<a href="#l78.97"></a><span id="l78.97"> </span>
<a href="#l78.98"></a><span id="l78.98" class="difflineat">@@ -1795,17 +1795,17 @@ nsMsgIncomingServer::ConfigureTemporaryS</span>
<a href="#l78.99"></a><span id="l78.99">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.100"></a><span id="l78.100"> </span>
<a href="#l78.101"></a><span id="l78.101">   // if we aren't configured to use server filters, then return early.</span>
<a href="#l78.102"></a><span id="l78.102">   if (!useServerFilter)</span>
<a href="#l78.103"></a><span id="l78.103">     return NS_OK;</span>
<a href="#l78.104"></a><span id="l78.104"> </span>
<a href="#l78.105"></a><span id="l78.105">   // For performance reasons, we'll handle clearing of filters if the user turns</span>
<a href="#l78.106"></a><span id="l78.106">   // off the server-side filters from the junk mail controls, in the junk mail controls.</span>
<a href="#l78.107"></a><span id="l78.107" class="difflineminus">-  nsCAutoString serverFilterName;</span>
<a href="#l78.108"></a><span id="l78.108" class="difflineplus">+  nsAutoCString serverFilterName;</span>
<a href="#l78.109"></a><span id="l78.109">   spamSettings-&gt;GetServerFilterName(serverFilterName);</span>
<a href="#l78.110"></a><span id="l78.110">   if (serverFilterName.IsEmpty())</span>
<a href="#l78.111"></a><span id="l78.111">     return NS_OK;</span>
<a href="#l78.112"></a><span id="l78.112">   int32_t serverFilterTrustFlags = 0;</span>
<a href="#l78.113"></a><span id="l78.113">   (void) spamSettings-&gt;GetServerFilterTrustFlags(&amp;serverFilterTrustFlags);</span>
<a href="#l78.114"></a><span id="l78.114">   if (!serverFilterTrustFlags)</span>
<a href="#l78.115"></a><span id="l78.115">     return NS_OK;</span>
<a href="#l78.116"></a><span id="l78.116">   // check if filters have been setup already.</span>
<a href="#l78.117"></a><span id="l78.117" class="difflineat">@@ -2075,17 +2075,17 @@ nsMsgIncomingServer::GetMsgFolderFromURI</span>
<a href="#l78.118"></a><span id="l78.118">   return NS_OK;</span>
<a href="#l78.119"></a><span id="l78.119"> }</span>
<a href="#l78.120"></a><span id="l78.120"> </span>
<a href="#l78.121"></a><span id="l78.121"> NS_IMETHODIMP</span>
<a href="#l78.122"></a><span id="l78.122"> nsMsgIncomingServer::GetSpamSettings(nsISpamSettings **aSpamSettings)</span>
<a href="#l78.123"></a><span id="l78.123"> {</span>
<a href="#l78.124"></a><span id="l78.124">   NS_ENSURE_ARG_POINTER(aSpamSettings);</span>
<a href="#l78.125"></a><span id="l78.125"> </span>
<a href="#l78.126"></a><span id="l78.126" class="difflineminus">-  nsCAutoString spamActionTargetAccount;</span>
<a href="#l78.127"></a><span id="l78.127" class="difflineplus">+  nsAutoCString spamActionTargetAccount;</span>
<a href="#l78.128"></a><span id="l78.128">   GetCharValue(&quot;spamActionTargetAccount&quot;, spamActionTargetAccount);</span>
<a href="#l78.129"></a><span id="l78.129">   if (spamActionTargetAccount.IsEmpty())</span>
<a href="#l78.130"></a><span id="l78.130">   {</span>
<a href="#l78.131"></a><span id="l78.131">     GetServerURI(spamActionTargetAccount);</span>
<a href="#l78.132"></a><span id="l78.132">     SetCharValue(&quot;spamActionTargetAccount&quot;, spamActionTargetAccount);</span>
<a href="#l78.133"></a><span id="l78.133">   }</span>
<a href="#l78.134"></a><span id="l78.134"> </span>
<a href="#l78.135"></a><span id="l78.135">   if (!mSpamSettings) {</span>
<a href="#l78.136"></a><span id="l78.136" class="difflineat">@@ -2219,17 +2219,17 @@ NS_IMETHODIMP nsMsgIncomingServer::IsNew</span>
<a href="#l78.137"></a><span id="l78.137"> </span>
<a href="#l78.138"></a><span id="l78.138">   // If the message has been partially downloaded, the message should not</span>
<a href="#l78.139"></a><span id="l78.139">   // be considered a duplicated message. See bug 714090.</span>
<a href="#l78.140"></a><span id="l78.140">   uint32_t flags;</span>
<a href="#l78.141"></a><span id="l78.141">   aNewHdr-&gt;GetFlags(&amp;flags);</span>
<a href="#l78.142"></a><span id="l78.142">   if (flags &amp; nsMsgMessageFlags::Partial)</span>
<a href="#l78.143"></a><span id="l78.143">     return NS_OK;</span>
<a href="#l78.144"></a><span id="l78.144"> </span>
<a href="#l78.145"></a><span id="l78.145" class="difflineminus">-  nsCAutoString strHashKey;</span>
<a href="#l78.146"></a><span id="l78.146" class="difflineplus">+  nsAutoCString strHashKey;</span>
<a href="#l78.147"></a><span id="l78.147">   nsCString messageId, subject;</span>
<a href="#l78.148"></a><span id="l78.148">   aNewHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l78.149"></a><span id="l78.149">   strHashKey.Append(messageId);</span>
<a href="#l78.150"></a><span id="l78.150">   aNewHdr-&gt;GetSubject(getter_Copies(subject));</span>
<a href="#l78.151"></a><span id="l78.151">   // err on the side of caution and ignore messages w/o subject or messageid.</span>
<a href="#l78.152"></a><span id="l78.152">   if (subject.IsEmpty() || messageId.IsEmpty())</span>
<a href="#l78.153"></a><span id="l78.153">     return NS_OK;</span>
<a href="#l78.154"></a><span id="l78.154">   strHashKey.Append(subject);</span>
<a href="#l78.155"></a><span id="l78.155" class="difflineat">@@ -2250,24 +2250,24 @@ NS_IMETHODIMP nsMsgIncomingServer::IsNew</span>
<a href="#l78.156"></a><span id="l78.156">   }</span>
<a href="#l78.157"></a><span id="l78.157">   return NS_OK;</span>
<a href="#l78.158"></a><span id="l78.158"> }</span>
<a href="#l78.159"></a><span id="l78.159"> </span>
<a href="#l78.160"></a><span id="l78.160"> NS_IMETHODIMP</span>
<a href="#l78.161"></a><span id="l78.161"> nsMsgIncomingServer::GetForcePropertyEmpty(const char *aPropertyName, bool *_retval)</span>
<a href="#l78.162"></a><span id="l78.162"> {</span>
<a href="#l78.163"></a><span id="l78.163">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l78.164"></a><span id="l78.164" class="difflineminus">-  nsCAutoString nameEmpty(aPropertyName);</span>
<a href="#l78.165"></a><span id="l78.165" class="difflineplus">+  nsAutoCString nameEmpty(aPropertyName);</span>
<a href="#l78.166"></a><span id="l78.166">   nameEmpty.Append(NS_LITERAL_CSTRING(&quot;.empty&quot;));</span>
<a href="#l78.167"></a><span id="l78.167">   nsCString value;</span>
<a href="#l78.168"></a><span id="l78.168">   GetCharValue(nameEmpty.get(), value);</span>
<a href="#l78.169"></a><span id="l78.169">   *_retval = value.EqualsLiteral(&quot;true&quot;);</span>
<a href="#l78.170"></a><span id="l78.170">   return NS_OK;</span>
<a href="#l78.171"></a><span id="l78.171"> }</span>
<a href="#l78.172"></a><span id="l78.172"> </span>
<a href="#l78.173"></a><span id="l78.173"> NS_IMETHODIMP</span>
<a href="#l78.174"></a><span id="l78.174"> nsMsgIncomingServer::SetForcePropertyEmpty(const char *aPropertyName, bool aValue)</span>
<a href="#l78.175"></a><span id="l78.175"> {</span>
<a href="#l78.176"></a><span id="l78.176" class="difflineminus">- nsCAutoString nameEmpty(aPropertyName);</span>
<a href="#l78.177"></a><span id="l78.177" class="difflineplus">+ nsAutoCString nameEmpty(aPropertyName);</span>
<a href="#l78.178"></a><span id="l78.178">  nameEmpty.Append(NS_LITERAL_CSTRING(&quot;.empty&quot;));</span>
<a href="#l78.179"></a><span id="l78.179">  return SetCharValue(nameEmpty.get(),</span>
<a href="#l78.180"></a><span id="l78.180">    aValue ? NS_LITERAL_CSTRING(&quot;true&quot;) : NS_LITERAL_CSTRING(&quot;&quot;));</span>
<a href="#l78.181"></a><span id="l78.181"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -133,18 +133,18 @@ nsresult nsMsgMailNewsUrl::UnRegisterLis</span>
<a href="#l79.4"></a><span id="l79.4"> NS_IMETHODIMP nsMsgMailNewsUrl::GetServer(nsIMsgIncomingServer ** aIncomingServer)</span>
<a href="#l79.5"></a><span id="l79.5"> {</span>
<a href="#l79.6"></a><span id="l79.6">   // mscott --&gt; we could cache a copy of the server here....but if we did, we run</span>
<a href="#l79.7"></a><span id="l79.7">   // the risk of leaking the server if any single url gets leaked....of course that</span>
<a href="#l79.8"></a><span id="l79.8">   // shouldn't happen...but it could. so i'm going to look it up every time and</span>
<a href="#l79.9"></a><span id="l79.9">   // we can look at caching it later.</span>
<a href="#l79.10"></a><span id="l79.10"> </span>
<a href="#l79.11"></a><span id="l79.11">   nsresult rv;</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-  nsCAutoString urlstr;</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineminus">-  nsCAutoString scheme;</span>
<a href="#l79.14"></a><span id="l79.14" class="difflineplus">+  nsAutoCString urlstr;</span>
<a href="#l79.15"></a><span id="l79.15" class="difflineplus">+  nsAutoCString scheme;</span>
<a href="#l79.16"></a><span id="l79.16"> </span>
<a href="#l79.17"></a><span id="l79.17">   nsCOMPtr&lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l79.18"></a><span id="l79.18">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l79.19"></a><span id="l79.19"> </span>
<a href="#l79.20"></a><span id="l79.20">   m_baseURL-&gt;GetSpec(urlstr);</span>
<a href="#l79.21"></a><span id="l79.21">   rv = url-&gt;SetSpec(urlstr);</span>
<a href="#l79.22"></a><span id="l79.22">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l79.23"></a><span id="l79.23">   rv = GetScheme(scheme);</span>
<a href="#l79.24"></a><span id="l79.24" class="difflineat">@@ -347,17 +347,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetSpec(</span>
<a href="#l79.25"></a><span id="l79.25"> {</span>
<a href="#l79.26"></a><span id="l79.26">   return m_baseURL-&gt;GetSpec(aSpec);</span>
<a href="#l79.27"></a><span id="l79.27"> }</span>
<a href="#l79.28"></a><span id="l79.28"> </span>
<a href="#l79.29"></a><span id="l79.29"> #define FILENAME_PART_LEN 10</span>
<a href="#l79.30"></a><span id="l79.30"> </span>
<a href="#l79.31"></a><span id="l79.31"> NS_IMETHODIMP nsMsgMailNewsUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l79.32"></a><span id="l79.32"> {</span>
<a href="#l79.33"></a><span id="l79.33" class="difflineminus">-  nsCAutoString spec(aSpec);</span>
<a href="#l79.34"></a><span id="l79.34" class="difflineplus">+  nsAutoCString spec(aSpec);</span>
<a href="#l79.35"></a><span id="l79.35">   // Parse out &quot;filename&quot; attribute if present.</span>
<a href="#l79.36"></a><span id="l79.36">   char *start, *end;</span>
<a href="#l79.37"></a><span id="l79.37">   start = PL_strcasestr(spec.BeginWriting(),&quot;?filename=&quot;);</span>
<a href="#l79.38"></a><span id="l79.38">   if (!start)</span>
<a href="#l79.39"></a><span id="l79.39">     start = PL_strcasestr(spec.BeginWriting(),&quot;&amp;filename=&quot;);</span>
<a href="#l79.40"></a><span id="l79.40">   if (start)</span>
<a href="#l79.41"></a><span id="l79.41">   { // Make sure we only get our own value.</span>
<a href="#l79.42"></a><span id="l79.42">     end = PL_strcasestr((char*)(start+FILENAME_PART_LEN),&quot;&amp;&quot;);</span>
<a href="#l79.43"></a><span id="l79.43" class="difflineat">@@ -533,17 +533,17 @@ nsMsgMailNewsUrl::GetHasRef(bool *result</span>
<a href="#l79.44"></a><span id="l79.44"> NS_IMETHODIMP nsMsgMailNewsUrl::SchemeIs(const char *aScheme, bool *_retval)</span>
<a href="#l79.45"></a><span id="l79.45"> {</span>
<a href="#l79.46"></a><span id="l79.46">   return m_baseURL-&gt;SchemeIs(aScheme, _retval);</span>
<a href="#l79.47"></a><span id="l79.47"> }</span>
<a href="#l79.48"></a><span id="l79.48"> </span>
<a href="#l79.49"></a><span id="l79.49"> NS_IMETHODIMP nsMsgMailNewsUrl::Clone(nsIURI **_retval)</span>
<a href="#l79.50"></a><span id="l79.50"> {</span>
<a href="#l79.51"></a><span id="l79.51">   nsresult rv;</span>
<a href="#l79.52"></a><span id="l79.52" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l79.53"></a><span id="l79.53" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l79.54"></a><span id="l79.54">   nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l79.55"></a><span id="l79.55">     mozilla::services::GetIOService();</span>
<a href="#l79.56"></a><span id="l79.56">   NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l79.57"></a><span id="l79.57">   rv = GetSpec(urlSpec);</span>
<a href="#l79.58"></a><span id="l79.58">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.59"></a><span id="l79.59">   rv = ioService-&gt;NewURI(urlSpec, nullptr, nullptr, _retval);</span>
<a href="#l79.60"></a><span id="l79.60">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.61"></a><span id="l79.61"> </span>
<a href="#l79.62"></a><span id="l79.62" class="difflineat">@@ -568,17 +568,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::Resolve(</span>
<a href="#l79.63"></a><span id="l79.63">   if (!relativePath.IsEmpty() &amp;&amp; relativePath.First() == '#') // an anchor</span>
<a href="#l79.64"></a><span id="l79.64">     return m_baseURL-&gt;Resolve(relativePath, result);</span>
<a href="#l79.65"></a><span id="l79.65">   else</span>
<a href="#l79.66"></a><span id="l79.66">   {</span>
<a href="#l79.67"></a><span id="l79.67">     // if relativePath is a complete url with it's own scheme then allow it...</span>
<a href="#l79.68"></a><span id="l79.68">     nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l79.69"></a><span id="l79.69">       mozilla::services::GetIOService();</span>
<a href="#l79.70"></a><span id="l79.70">     NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l79.71"></a><span id="l79.71" class="difflineminus">-    nsCAutoString scheme;</span>
<a href="#l79.72"></a><span id="l79.72" class="difflineplus">+    nsAutoCString scheme;</span>
<a href="#l79.73"></a><span id="l79.73"> </span>
<a href="#l79.74"></a><span id="l79.74">     rv = ioService-&gt;ExtractScheme(relativePath, scheme);</span>
<a href="#l79.75"></a><span id="l79.75">     // if we have a fully qualified scheme then pass the relative path back as the result</span>
<a href="#l79.76"></a><span id="l79.76">     if (NS_SUCCEEDED(rv) &amp;&amp; !scheme.IsEmpty())</span>
<a href="#l79.77"></a><span id="l79.77">     {</span>
<a href="#l79.78"></a><span id="l79.78">       result = relativePath;</span>
<a href="#l79.79"></a><span id="l79.79">       rv = NS_OK;</span>
<a href="#l79.80"></a><span id="l79.80">     }</span>
<a href="#l79.81"></a><span id="l79.81" class="difflineat">@@ -934,17 +934,17 @@ nsresult nsMsgSaveAsListener::SetupMsgWr</span>
<a href="#l79.82"></a><span id="l79.82">   aFile-&gt;Remove(false);</span>
<a href="#l79.83"></a><span id="l79.83"> </span>
<a href="#l79.84"></a><span id="l79.84">   nsresult rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_outputStream),</span>
<a href="#l79.85"></a><span id="l79.85">                                                aFile, -1, 00600);</span>
<a href="#l79.86"></a><span id="l79.86">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.87"></a><span id="l79.87"> </span>
<a href="#l79.88"></a><span id="l79.88">   if (m_outputStream &amp;&amp; addDummyEnvelope)</span>
<a href="#l79.89"></a><span id="l79.89">   {</span>
<a href="#l79.90"></a><span id="l79.90" class="difflineminus">-    nsCAutoString result;</span>
<a href="#l79.91"></a><span id="l79.91" class="difflineplus">+    nsAutoCString result;</span>
<a href="#l79.92"></a><span id="l79.92">     uint32_t writeCount;</span>
<a href="#l79.93"></a><span id="l79.93"> </span>
<a href="#l79.94"></a><span id="l79.94">     time_t now = time((time_t*) 0);</span>
<a href="#l79.95"></a><span id="l79.95">     char *ct = ctime(&amp;now);</span>
<a href="#l79.96"></a><span id="l79.96">     // Remove the ending new-line character.</span>
<a href="#l79.97"></a><span id="l79.97">     ct[24] = '\0';</span>
<a href="#l79.98"></a><span id="l79.98">     result = &quot;From - &quot;;</span>
<a href="#l79.99"></a><span id="l79.99">     result += ct;</span>
<a href="#l79.100"></a><span id="l79.100" class="difflineat">@@ -992,13 +992,13 @@ NS_IMETHODIMP nsMsgMailNewsUrl::SetMsgHe</span>
<a href="#l79.101"></a><span id="l79.101"> {</span>
<a href="#l79.102"></a><span id="l79.102">     mMsgHeaderSink = aMsgHdrSink;</span>
<a href="#l79.103"></a><span id="l79.103">     return NS_OK;</span>
<a href="#l79.104"></a><span id="l79.104"> }</span>
<a href="#l79.105"></a><span id="l79.105"> </span>
<a href="#l79.106"></a><span id="l79.106"> NS_IMETHODIMP nsMsgMailNewsUrl::GetIsMessageUri(bool *aIsMessageUri)</span>
<a href="#l79.107"></a><span id="l79.107"> {</span>
<a href="#l79.108"></a><span id="l79.108">   NS_ENSURE_ARG(aIsMessageUri);</span>
<a href="#l79.109"></a><span id="l79.109" class="difflineminus">-  nsCAutoString scheme;</span>
<a href="#l79.110"></a><span id="l79.110" class="difflineplus">+  nsAutoCString scheme;</span>
<a href="#l79.111"></a><span id="l79.111">   m_baseURL-&gt;GetScheme(scheme);</span>
<a href="#l79.112"></a><span id="l79.112">   *aIsMessageUri = StringEndsWith(scheme, NS_LITERAL_CSTRING(&quot;-message&quot;));</span>
<a href="#l79.113"></a><span id="l79.113">   return NS_OK;</span>
<a href="#l79.114"></a><span id="l79.114"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -94,17 +94,17 @@ nsresult</span>
<a href="#l80.4"></a><span id="l80.4"> nsMsgProtocol::GetQoSBits(uint8_t *aQoSBits)</span>
<a href="#l80.5"></a><span id="l80.5"> {</span>
<a href="#l80.6"></a><span id="l80.6">   NS_ENSURE_ARG_POINTER(aQoSBits);</span>
<a href="#l80.7"></a><span id="l80.7">   const char* protocol = GetType();</span>
<a href="#l80.8"></a><span id="l80.8"> </span>
<a href="#l80.9"></a><span id="l80.9">   if (!protocol)</span>
<a href="#l80.10"></a><span id="l80.10">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l80.11"></a><span id="l80.11"> </span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-  nsCAutoString prefName(&quot;mail.&quot;);</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+  nsAutoCString prefName(&quot;mail.&quot;);</span>
<a href="#l80.14"></a><span id="l80.14">   prefName.Append(protocol);</span>
<a href="#l80.15"></a><span id="l80.15">   prefName.Append(&quot;.qos&quot;);</span>
<a href="#l80.16"></a><span id="l80.16"> </span>
<a href="#l80.17"></a><span id="l80.17">   nsresult rv;</span>
<a href="#l80.18"></a><span id="l80.18">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l80.19"></a><span id="l80.19">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l80.20"></a><span id="l80.20"> </span>
<a href="#l80.21"></a><span id="l80.21">   int32_t val;</span>
<a href="#l80.22"></a><span id="l80.22" class="difflineat">@@ -168,17 +168,17 @@ nsMsgProtocol::OpenNetworkSocketWithInfo</span>
<a href="#l80.23"></a><span id="l80.23"> </span>
<a href="#l80.24"></a><span id="l80.24"> // open a connection on this url</span>
<a href="#l80.25"></a><span id="l80.25"> nsresult</span>
<a href="#l80.26"></a><span id="l80.26"> nsMsgProtocol::OpenNetworkSocket(nsIURI * aURL, const char *connectionType,</span>
<a href="#l80.27"></a><span id="l80.27">                                  nsIInterfaceRequestor* callbacks)</span>
<a href="#l80.28"></a><span id="l80.28"> {</span>
<a href="#l80.29"></a><span id="l80.29">   NS_ENSURE_ARG(aURL);</span>
<a href="#l80.30"></a><span id="l80.30"> </span>
<a href="#l80.31"></a><span id="l80.31" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l80.32"></a><span id="l80.32" class="difflineplus">+  nsAutoCString hostName;</span>
<a href="#l80.33"></a><span id="l80.33">   int32_t port = 0;</span>
<a href="#l80.34"></a><span id="l80.34"> </span>
<a href="#l80.35"></a><span id="l80.35">   aURL-&gt;GetPort(&amp;port);</span>
<a href="#l80.36"></a><span id="l80.36">   aURL-&gt;GetAsciiHost(hostName);</span>
<a href="#l80.37"></a><span id="l80.37"> </span>
<a href="#l80.38"></a><span id="l80.38">   nsCOMPtr&lt;nsIProxyInfo&gt; proxyInfo;</span>
<a href="#l80.39"></a><span id="l80.39"> </span>
<a href="#l80.40"></a><span id="l80.40">   nsCOMPtr&lt;nsIProtocolProxyService&gt; pps =</span>
<a href="#l80.41"></a><span id="l80.41" class="difflineat">@@ -197,17 +197,17 @@ nsMsgProtocol::OpenNetworkSocket(nsIURI </span>
<a href="#l80.42"></a><span id="l80.42">       // nsSmtpUrl calls nsStandardUrl's clone method, which fails</span>
<a href="#l80.43"></a><span id="l80.43">       // because smtp isn't a registered protocol.</span>
<a href="#l80.44"></a><span id="l80.44">       // So we cheat. Whilst creating a uri manually is valid here,</span>
<a href="#l80.45"></a><span id="l80.45">       // do _NOT_ copy this to use in your own code - bbaetz</span>
<a href="#l80.46"></a><span id="l80.46">       nsCOMPtr&lt;nsIURI&gt; proxyUri = aURL;</span>
<a href="#l80.47"></a><span id="l80.47">       bool isSMTP = false;</span>
<a href="#l80.48"></a><span id="l80.48">       if (NS_SUCCEEDED(aURL-&gt;SchemeIs(&quot;smtp&quot;, &amp;isSMTP)) &amp;&amp; isSMTP)</span>
<a href="#l80.49"></a><span id="l80.49">       {</span>
<a href="#l80.50"></a><span id="l80.50" class="difflineminus">-          nsCAutoString spec;</span>
<a href="#l80.51"></a><span id="l80.51" class="difflineplus">+          nsAutoCString spec;</span>
<a href="#l80.52"></a><span id="l80.52">           rv = aURL-&gt;GetSpec(spec);</span>
<a href="#l80.53"></a><span id="l80.53">           if (NS_SUCCEEDED(rv))</span>
<a href="#l80.54"></a><span id="l80.54">               proxyUri = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l80.55"></a><span id="l80.55"> </span>
<a href="#l80.56"></a><span id="l80.56">           if (NS_SUCCEEDED(rv))</span>
<a href="#l80.57"></a><span id="l80.57">               rv = proxyUri-&gt;SetSpec(spec);</span>
<a href="#l80.58"></a><span id="l80.58">           if (NS_SUCCEEDED(rv))</span>
<a href="#l80.59"></a><span id="l80.59">               rv = proxyUri-&gt;SetScheme(NS_LITERAL_CSTRING(&quot;mailto&quot;));</span>
<a href="#l80.60"></a><span id="l80.60" class="difflineat">@@ -227,17 +227,17 @@ nsMsgProtocol::OpenNetworkSocket(nsIURI </span>
<a href="#l80.61"></a><span id="l80.61">                                    proxyInfo, callbacks);</span>
<a href="#l80.62"></a><span id="l80.62"> }</span>
<a href="#l80.63"></a><span id="l80.63"> </span>
<a href="#l80.64"></a><span id="l80.64"> nsresult nsMsgProtocol::GetFileFromURL(nsIURI * aURL, nsIFile **aResult)</span>
<a href="#l80.65"></a><span id="l80.65"> {</span>
<a href="#l80.66"></a><span id="l80.66">   NS_ENSURE_ARG_POINTER(aURL);</span>
<a href="#l80.67"></a><span id="l80.67">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l80.68"></a><span id="l80.68">   // extract the file path from the uri...</span>
<a href="#l80.69"></a><span id="l80.69" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l80.70"></a><span id="l80.70" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l80.71"></a><span id="l80.71">   aURL-&gt;GetPath(urlSpec);</span>
<a href="#l80.72"></a><span id="l80.72">   urlSpec.Insert(NS_LITERAL_CSTRING(&quot;file://&quot;), 0);</span>
<a href="#l80.73"></a><span id="l80.73">   nsresult rv;</span>
<a href="#l80.74"></a><span id="l80.74"> </span>
<a href="#l80.75"></a><span id="l80.75"> // dougt - there should be an easier way!</span>
<a href="#l80.76"></a><span id="l80.76">   nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l80.77"></a><span id="l80.77">   if (NS_FAILED(rv = NS_NewURI(getter_AddRefs(uri), urlSpec.get())))</span>
<a href="#l80.78"></a><span id="l80.78">       return rv;</span>
<a href="#l80.79"></a><span id="l80.79" class="difflineat">@@ -583,17 +583,17 @@ NS_IMETHODIMP nsMsgProtocol::Open(nsIInp</span>
<a href="#l80.80"></a><span id="l80.80"> </span>
<a href="#l80.81"></a><span id="l80.81"> NS_IMETHODIMP nsMsgProtocol::AsyncOpen(nsIStreamListener *listener, nsISupports *ctxt)</span>
<a href="#l80.82"></a><span id="l80.82"> {</span>
<a href="#l80.83"></a><span id="l80.83">     int32_t port;</span>
<a href="#l80.84"></a><span id="l80.84">     nsresult rv = m_url-&gt;GetPort(&amp;port);</span>
<a href="#l80.85"></a><span id="l80.85">     if (NS_FAILED(rv))</span>
<a href="#l80.86"></a><span id="l80.86">         return rv;</span>
<a href="#l80.87"></a><span id="l80.87"> </span>
<a href="#l80.88"></a><span id="l80.88" class="difflineminus">-    nsCAutoString scheme;</span>
<a href="#l80.89"></a><span id="l80.89" class="difflineplus">+    nsAutoCString scheme;</span>
<a href="#l80.90"></a><span id="l80.90">     rv = m_url-&gt;GetScheme(scheme);</span>
<a href="#l80.91"></a><span id="l80.91">     if (NS_FAILED(rv))</span>
<a href="#l80.92"></a><span id="l80.92">         return rv;</span>
<a href="#l80.93"></a><span id="l80.93"> </span>
<a href="#l80.94"></a><span id="l80.94"> </span>
<a href="#l80.95"></a><span id="l80.95">     rv = NS_CheckPortSafety(port, scheme.get());</span>
<a href="#l80.96"></a><span id="l80.96">     if (NS_FAILED(rv))</span>
<a href="#l80.97"></a><span id="l80.97">         return rv;</span>
<a href="#l80.98"></a><span id="l80.98" class="difflineat">@@ -627,17 +627,17 @@ NS_IMETHODIMP nsMsgProtocol::GetContentT</span>
<a href="#l80.99"></a><span id="l80.99">     aContentType.AssignLiteral(&quot;message/rfc822&quot;);</span>
<a href="#l80.100"></a><span id="l80.100">   else</span>
<a href="#l80.101"></a><span id="l80.101">     aContentType = m_ContentType;</span>
<a href="#l80.102"></a><span id="l80.102">   return NS_OK;</span>
<a href="#l80.103"></a><span id="l80.103"> }</span>
<a href="#l80.104"></a><span id="l80.104"> </span>
<a href="#l80.105"></a><span id="l80.105"> NS_IMETHODIMP nsMsgProtocol::SetContentType(const nsACString &amp;aContentType)</span>
<a href="#l80.106"></a><span id="l80.106"> {</span>
<a href="#l80.107"></a><span id="l80.107" class="difflineminus">-    nsCAutoString charset;</span>
<a href="#l80.108"></a><span id="l80.108" class="difflineplus">+    nsAutoCString charset;</span>
<a href="#l80.109"></a><span id="l80.109">     return NS_ParseContentType(aContentType, m_ContentType, charset);</span>
<a href="#l80.110"></a><span id="l80.110"> }</span>
<a href="#l80.111"></a><span id="l80.111"> </span>
<a href="#l80.112"></a><span id="l80.112"> NS_IMETHODIMP nsMsgProtocol::GetContentCharset(nsACString &amp;aContentCharset)</span>
<a href="#l80.113"></a><span id="l80.113"> {</span>
<a href="#l80.114"></a><span id="l80.114">   aContentCharset.Truncate();</span>
<a href="#l80.115"></a><span id="l80.115">   return NS_OK;</span>
<a href="#l80.116"></a><span id="l80.116"> }</span>
<a href="#l80.117"></a><span id="l80.117" class="difflineat">@@ -741,17 +741,17 @@ nsMsgProtocol::OnTransportStatus(nsITran</span>
<a href="#l80.118"></a><span id="l80.118"> </span>
<a href="#l80.119"></a><span id="l80.119">   if (!mProgressEventSink)</span>
<a href="#l80.120"></a><span id="l80.120">   {</span>
<a href="#l80.121"></a><span id="l80.121">     NS_QueryNotificationCallbacks(mCallbacks, m_loadGroup, mProgressEventSink);</span>
<a href="#l80.122"></a><span id="l80.122">     if (!mProgressEventSink)</span>
<a href="#l80.123"></a><span id="l80.123">       return NS_OK;</span>
<a href="#l80.124"></a><span id="l80.124">   }</span>
<a href="#l80.125"></a><span id="l80.125"> </span>
<a href="#l80.126"></a><span id="l80.126" class="difflineminus">-  nsCAutoString host;</span>
<a href="#l80.127"></a><span id="l80.127" class="difflineplus">+  nsAutoCString host;</span>
<a href="#l80.128"></a><span id="l80.128">   m_url-&gt;GetHost(host);</span>
<a href="#l80.129"></a><span id="l80.129"> </span>
<a href="#l80.130"></a><span id="l80.130">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_url);</span>
<a href="#l80.131"></a><span id="l80.131">   if (mailnewsUrl)</span>
<a href="#l80.132"></a><span id="l80.132">   {</span>
<a href="#l80.133"></a><span id="l80.133">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l80.134"></a><span id="l80.134">     mailnewsUrl-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l80.135"></a><span id="l80.135">     if (server)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -81,37 +81,37 @@ static NS_DEFINE_CID(kCNntpUrlCID, NS_NN</span>
<a href="#l81.4"></a><span id="l81.4"> #define ILLEGAL_FOLDER_CHARS_AS_LAST_LETTER  &quot;.~ &quot;</span>
<a href="#l81.5"></a><span id="l81.5"> </span>
<a href="#l81.6"></a><span id="l81.6"> #define FOUR_K 4096</span>
<a href="#l81.7"></a><span id="l81.7"> </span>
<a href="#l81.8"></a><span id="l81.8"> nsresult GetMessageServiceContractIDForURI(const char *uri, nsCString &amp;contractID)</span>
<a href="#l81.9"></a><span id="l81.9"> {</span>
<a href="#l81.10"></a><span id="l81.10">   nsresult rv = NS_OK;</span>
<a href="#l81.11"></a><span id="l81.11">   //Find protocol</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-  nsCAutoString uriStr(uri);</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+  nsAutoCString uriStr(uri);</span>
<a href="#l81.14"></a><span id="l81.14">   int32_t pos = uriStr.FindChar(':');</span>
<a href="#l81.15"></a><span id="l81.15">   if (pos == -1)</span>
<a href="#l81.16"></a><span id="l81.16">     return NS_ERROR_FAILURE;</span>
<a href="#l81.17"></a><span id="l81.17"> </span>
<a href="#l81.18"></a><span id="l81.18" class="difflineminus">-  nsCAutoString protocol(StringHead(uriStr, pos));</span>
<a href="#l81.19"></a><span id="l81.19" class="difflineplus">+  nsAutoCString protocol(StringHead(uriStr, pos));</span>
<a href="#l81.20"></a><span id="l81.20"> </span>
<a href="#l81.21"></a><span id="l81.21">   if (protocol.Equals(&quot;file&quot;) &amp;&amp; uriStr.Find(&quot;application/x-message-display&quot;) != -1)</span>
<a href="#l81.22"></a><span id="l81.22">     protocol.Assign(&quot;mailbox&quot;);</span>
<a href="#l81.23"></a><span id="l81.23">   //Build message service contractid</span>
<a href="#l81.24"></a><span id="l81.24">   contractID = &quot;@mozilla.org/messenger/messageservice;1?type=&quot;;</span>
<a href="#l81.25"></a><span id="l81.25">   contractID += protocol.get();</span>
<a href="#l81.26"></a><span id="l81.26"> </span>
<a href="#l81.27"></a><span id="l81.27">   return rv;</span>
<a href="#l81.28"></a><span id="l81.28"> }</span>
<a href="#l81.29"></a><span id="l81.29"> </span>
<a href="#l81.30"></a><span id="l81.30"> nsresult GetMessageServiceFromURI(const nsACString&amp; uri, nsIMsgMessageService **aMessageService)</span>
<a href="#l81.31"></a><span id="l81.31"> {</span>
<a href="#l81.32"></a><span id="l81.32">   nsresult rv;</span>
<a href="#l81.33"></a><span id="l81.33"> </span>
<a href="#l81.34"></a><span id="l81.34" class="difflineminus">-  nsCAutoString contractID;</span>
<a href="#l81.35"></a><span id="l81.35" class="difflineplus">+  nsAutoCString contractID;</span>
<a href="#l81.36"></a><span id="l81.36">   rv = GetMessageServiceContractIDForURI(PromiseFlatCString(uri).get(), contractID);</span>
<a href="#l81.37"></a><span id="l81.37">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l81.38"></a><span id="l81.38"> </span>
<a href="#l81.39"></a><span id="l81.39">   nsCOMPtr &lt;nsIMsgMessageService&gt; msgService = do_GetService(contractID.get(), &amp;rv);</span>
<a href="#l81.40"></a><span id="l81.40">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l81.41"></a><span id="l81.41"> </span>
<a href="#l81.42"></a><span id="l81.42">   NS_IF_ADDREF(*aMessageService = msgService);</span>
<a href="#l81.43"></a><span id="l81.43">   return rv;</span>
<a href="#l81.44"></a><span id="l81.44" class="difflineat">@@ -343,17 +343,17 @@ MsgFindCharInSet(const nsString &amp;aString</span>
<a href="#l81.45"></a><span id="l81.45">       return index;</span>
<a href="#l81.46"></a><span id="l81.46">   }</span>
<a href="#l81.47"></a><span id="l81.47">   return -1;</span>
<a href="#l81.48"></a><span id="l81.48"> #endif</span>
<a href="#l81.49"></a><span id="l81.49"> }</span>
<a href="#l81.50"></a><span id="l81.50"> </span>
<a href="#l81.51"></a><span id="l81.51"> static bool ConvertibleToNative(const nsAutoString&amp; str)</span>
<a href="#l81.52"></a><span id="l81.52"> {</span>
<a href="#l81.53"></a><span id="l81.53" class="difflineminus">-    nsCAutoString native;</span>
<a href="#l81.54"></a><span id="l81.54" class="difflineplus">+    nsAutoCString native;</span>
<a href="#l81.55"></a><span id="l81.55">     nsAutoString roundTripped;</span>
<a href="#l81.56"></a><span id="l81.56"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l81.57"></a><span id="l81.57">     NS_CopyUnicodeToNative(str, native);</span>
<a href="#l81.58"></a><span id="l81.58">     NS_CopyNativeToUnicode(native, roundTripped);</span>
<a href="#l81.59"></a><span id="l81.59"> #else</span>
<a href="#l81.60"></a><span id="l81.60">     nsMsgI18NConvertFromUnicode(nsMsgI18NFileSystemCharset(), str, native);</span>
<a href="#l81.61"></a><span id="l81.61">     nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(), native, roundTripped);</span>
<a href="#l81.62"></a><span id="l81.62"> #endif</span>
<a href="#l81.63"></a><span id="l81.63" class="difflineat">@@ -365,19 +365,19 @@ static bool ConvertibleToNative(const ns</span>
<a href="#l81.64"></a><span id="l81.64"> #elif defined(XP_WIN32)</span>
<a href="#l81.65"></a><span id="l81.65">   const static uint32_t MAX_LEN = 55;</span>
<a href="#l81.66"></a><span id="l81.66"> #elif defined(XP_OS2)</span>
<a href="#l81.67"></a><span id="l81.67">   const static uint32_t MAX_LEN = 55;</span>
<a href="#l81.68"></a><span id="l81.68"> #else</span>
<a href="#l81.69"></a><span id="l81.69">   #error need_to_define_your_max_filename_length</span>
<a href="#l81.70"></a><span id="l81.70"> #endif</span>
<a href="#l81.71"></a><span id="l81.71"> </span>
<a href="#l81.72"></a><span id="l81.72" class="difflineminus">-nsresult NS_MsgHashIfNecessary(nsCAutoString &amp;name)</span>
<a href="#l81.73"></a><span id="l81.73" class="difflineplus">+nsresult NS_MsgHashIfNecessary(nsAutoCString &amp;name)</span>
<a href="#l81.74"></a><span id="l81.74"> {</span>
<a href="#l81.75"></a><span id="l81.75" class="difflineminus">-  nsCAutoString str(name);</span>
<a href="#l81.76"></a><span id="l81.76" class="difflineplus">+  nsAutoCString str(name);</span>
<a href="#l81.77"></a><span id="l81.77"> </span>
<a href="#l81.78"></a><span id="l81.78">   // Given a filename, make it safe for filesystem</span>
<a href="#l81.79"></a><span id="l81.79">   // certain filenames require hashing because they</span>
<a href="#l81.80"></a><span id="l81.80">   // are too long or contain illegal characters</span>
<a href="#l81.81"></a><span id="l81.81">   int32_t illegalCharacterIndex = MsgFindCharInSet(str,</span>
<a href="#l81.82"></a><span id="l81.82">                                                    FILE_PATH_SEPARATOR</span>
<a href="#l81.83"></a><span id="l81.83">                                                    FILE_ILLEGAL_CHARACTERS</span>
<a href="#l81.84"></a><span id="l81.84">                                                    ILLEGAL_FOLDER_CHARS, 0);</span>
<a href="#l81.85"></a><span id="l81.85" class="difflineat">@@ -558,17 +558,17 @@ nsresult NS_MsgCreatePathStringFromFolde</span>
<a href="#l81.86"></a><span id="l81.86">       // add .sbd onto the previous path</span>
<a href="#l81.87"></a><span id="l81.87">       if (haveFirst)</span>
<a href="#l81.88"></a><span id="l81.88">       {</span>
<a href="#l81.89"></a><span id="l81.89">         path.AppendLiteral(&quot;.sbd/&quot;);</span>
<a href="#l81.90"></a><span id="l81.90">       }</span>
<a href="#l81.91"></a><span id="l81.91"> </span>
<a href="#l81.92"></a><span id="l81.92">       if (aIsNewsFolder)</span>
<a href="#l81.93"></a><span id="l81.93">       {</span>
<a href="#l81.94"></a><span id="l81.94" class="difflineminus">-          nsCAutoString tmp;</span>
<a href="#l81.95"></a><span id="l81.95" class="difflineplus">+          nsAutoCString tmp;</span>
<a href="#l81.96"></a><span id="l81.96">           CopyUTF16toMUTF7(pathPiece, tmp);</span>
<a href="#l81.97"></a><span id="l81.97">           CopyASCIItoUTF16(tmp, pathPiece);</span>
<a href="#l81.98"></a><span id="l81.98">       }</span>
<a href="#l81.99"></a><span id="l81.99"> #ifdef XP_MACOSX</span>
<a href="#l81.100"></a><span id="l81.100">       // Don't hash path pieces because local mail folder uri's have already</span>
<a href="#l81.101"></a><span id="l81.101">       // been hashed. We're only doing this on the mac to limit potential</span>
<a href="#l81.102"></a><span id="l81.102">       // regressions.</span>
<a href="#l81.103"></a><span id="l81.103">       if (!isMailboxUri)</span>
<a href="#l81.104"></a><span id="l81.104" class="difflineat">@@ -609,17 +609,17 @@ bool NS_MsgStripRE(const char **stringP,</span>
<a href="#l81.105"></a><span id="l81.105">   nsString utf16LocalizedRe;</span>
<a href="#l81.106"></a><span id="l81.106">   NS_GetLocalizedUnicharPreferenceWithDefault(nullptr,</span>
<a href="#l81.107"></a><span id="l81.107">                                               &quot;mailnews.localizedRe&quot;,</span>
<a href="#l81.108"></a><span id="l81.108">                                               EmptyString(),</span>
<a href="#l81.109"></a><span id="l81.109">                                               utf16LocalizedRe);</span>
<a href="#l81.110"></a><span id="l81.110">   NS_ConvertUTF16toUTF8 localizedRe(utf16LocalizedRe);</span>
<a href="#l81.111"></a><span id="l81.111"> </span>
<a href="#l81.112"></a><span id="l81.112">   // hardcoded &quot;Re&quot; so that noone can configure Mozilla standards incompatible</span>
<a href="#l81.113"></a><span id="l81.113" class="difflineminus">-  nsCAutoString checkString(&quot;Re,RE,re,rE&quot;);</span>
<a href="#l81.114"></a><span id="l81.114" class="difflineplus">+  nsAutoCString checkString(&quot;Re,RE,re,rE&quot;);</span>
<a href="#l81.115"></a><span id="l81.115">   if (!localizedRe.IsEmpty()) {</span>
<a href="#l81.116"></a><span id="l81.116">     checkString.Append(',');</span>
<a href="#l81.117"></a><span id="l81.117">     checkString.Append(localizedRe);</span>
<a href="#l81.118"></a><span id="l81.118">   }</span>
<a href="#l81.119"></a><span id="l81.119"> </span>
<a href="#l81.120"></a><span id="l81.120">   // decode the string</span>
<a href="#l81.121"></a><span id="l81.121">   nsCString decodedString;</span>
<a href="#l81.122"></a><span id="l81.122">   nsCOMPtr&lt;nsIMimeConverter&gt; mimeConverter;</span>
<a href="#l81.123"></a><span id="l81.123" class="difflineat">@@ -772,17 +772,17 @@ char * NS_MsgSACat (char **destination, </span>
<a href="#l81.124"></a><span id="l81.124"> nsresult NS_MsgEscapeEncodeURLPath(const nsAString&amp; aStr, nsCString&amp; aResult)</span>
<a href="#l81.125"></a><span id="l81.125"> {</span>
<a href="#l81.126"></a><span id="l81.126">   return MsgEscapeString(NS_ConvertUTF16toUTF8(aStr), nsINetUtil::ESCAPE_URL_PATH, aResult);</span>
<a href="#l81.127"></a><span id="l81.127"> }</span>
<a href="#l81.128"></a><span id="l81.128"> </span>
<a href="#l81.129"></a><span id="l81.129"> nsresult NS_MsgDecodeUnescapeURLPath(const nsACString&amp; aPath,</span>
<a href="#l81.130"></a><span id="l81.130">                                      nsAString&amp; aResult)</span>
<a href="#l81.131"></a><span id="l81.131"> {</span>
<a href="#l81.132"></a><span id="l81.132" class="difflineminus">-  nsCAutoString unescapedName;</span>
<a href="#l81.133"></a><span id="l81.133" class="difflineplus">+  nsAutoCString unescapedName;</span>
<a href="#l81.134"></a><span id="l81.134">   MsgUnescapeString(aPath, nsINetUtil::ESCAPE_URL_FILE_BASENAME |</span>
<a href="#l81.135"></a><span id="l81.135">                  nsINetUtil::ESCAPE_URL_FORCED, unescapedName);</span>
<a href="#l81.136"></a><span id="l81.136">   CopyUTF8toUTF16(unescapedName, aResult);</span>
<a href="#l81.137"></a><span id="l81.137">   return NS_OK;</span>
<a href="#l81.138"></a><span id="l81.138"> }</span>
<a href="#l81.139"></a><span id="l81.139"> </span>
<a href="#l81.140"></a><span id="l81.140"> bool WeAreOffline()</span>
<a href="#l81.141"></a><span id="l81.141"> {</span>
<a href="#l81.142"></a><span id="l81.142" class="difflineat">@@ -1040,17 +1040,17 @@ nsresult IsRSSArticle(nsIURI * aMsgURI, </span>
<a href="#l81.143"></a><span id="l81.143"> }</span>
<a href="#l81.144"></a><span id="l81.144"> </span>
<a href="#l81.145"></a><span id="l81.145"> </span>
<a href="#l81.146"></a><span id="l81.146"> // digest needs to be a pointer to a DIGEST_LENGTH (16) byte buffer</span>
<a href="#l81.147"></a><span id="l81.147"> nsresult MSGCramMD5(const char *text, int32_t text_len, const char *key, int32_t key_len, unsigned char *digest)</span>
<a href="#l81.148"></a><span id="l81.148"> {</span>
<a href="#l81.149"></a><span id="l81.149">   nsresult rv;</span>
<a href="#l81.150"></a><span id="l81.150"> </span>
<a href="#l81.151"></a><span id="l81.151" class="difflineminus">-  nsCAutoString hash;</span>
<a href="#l81.152"></a><span id="l81.152" class="difflineplus">+  nsAutoCString hash;</span>
<a href="#l81.153"></a><span id="l81.153">   nsCOMPtr&lt;nsICryptoHash&gt; hasher = do_CreateInstance(&quot;@mozilla.org/security/hash;1&quot;, &amp;rv);</span>
<a href="#l81.154"></a><span id="l81.154">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.155"></a><span id="l81.155"> </span>
<a href="#l81.156"></a><span id="l81.156"> </span>
<a href="#l81.157"></a><span id="l81.157">   // this code adapted from http://www.cis.ohio-state.edu/cgi-bin/rfc/rfc2104.html</span>
<a href="#l81.158"></a><span id="l81.158"> </span>
<a href="#l81.159"></a><span id="l81.159">   char innerPad[65];    /* inner padding - key XORd with innerPad */</span>
<a href="#l81.160"></a><span id="l81.160">   char outerPad[65];    /* outer padding - key XORd with outerPad */</span>
<a href="#l81.161"></a><span id="l81.161" class="difflineat">@@ -1093,17 +1093,17 @@ nsresult MSGCramMD5(const char *text, in</span>
<a href="#l81.162"></a><span id="l81.162">   for (i=0; i&lt;64; i++)</span>
<a href="#l81.163"></a><span id="l81.163">   {</span>
<a href="#l81.164"></a><span id="l81.164">     innerPad[i] ^= 0x36;</span>
<a href="#l81.165"></a><span id="l81.165">     outerPad[i] ^= 0x5c;</span>
<a href="#l81.166"></a><span id="l81.166">   }</span>
<a href="#l81.167"></a><span id="l81.167">   /*</span>
<a href="#l81.168"></a><span id="l81.168">    * perform inner MD5</span>
<a href="#l81.169"></a><span id="l81.169">    */</span>
<a href="#l81.170"></a><span id="l81.170" class="difflineminus">-  nsCAutoString result;</span>
<a href="#l81.171"></a><span id="l81.171" class="difflineplus">+  nsAutoCString result;</span>
<a href="#l81.172"></a><span id="l81.172">   rv = hasher-&gt;Init(nsICryptoHash::MD5); /* init context for 1st pass */</span>
<a href="#l81.173"></a><span id="l81.173">   rv = hasher-&gt;Update((const uint8_t*)innerPad, 64);       /* start with inner pad */</span>
<a href="#l81.174"></a><span id="l81.174">   rv = hasher-&gt;Update((const uint8_t*)text, text_len);     /* then text of datagram */</span>
<a href="#l81.175"></a><span id="l81.175">   rv = hasher-&gt;Finish(false, result);   /* finish up 1st pass */</span>
<a href="#l81.176"></a><span id="l81.176"> </span>
<a href="#l81.177"></a><span id="l81.177">   /*</span>
<a href="#l81.178"></a><span id="l81.178">    * perform outer MD5</span>
<a href="#l81.179"></a><span id="l81.179">    */</span>
<a href="#l81.180"></a><span id="l81.180" class="difflineat">@@ -1121,17 +1121,17 @@ nsresult MSGCramMD5(const char *text, in</span>
<a href="#l81.181"></a><span id="l81.181"> </span>
<a href="#l81.182"></a><span id="l81.182"> }</span>
<a href="#l81.183"></a><span id="l81.183"> </span>
<a href="#l81.184"></a><span id="l81.184"> </span>
<a href="#l81.185"></a><span id="l81.185"> // digest needs to be a pointer to a DIGEST_LENGTH (16) byte buffer</span>
<a href="#l81.186"></a><span id="l81.186"> nsresult MSGApopMD5(const char *text, int32_t text_len, const char *password, int32_t password_len, unsigned char *digest)</span>
<a href="#l81.187"></a><span id="l81.187"> {</span>
<a href="#l81.188"></a><span id="l81.188">   nsresult rv;</span>
<a href="#l81.189"></a><span id="l81.189" class="difflineminus">-  nsCAutoString result;</span>
<a href="#l81.190"></a><span id="l81.190" class="difflineplus">+  nsAutoCString result;</span>
<a href="#l81.191"></a><span id="l81.191"> </span>
<a href="#l81.192"></a><span id="l81.192">   nsCOMPtr&lt;nsICryptoHash&gt; hasher = do_CreateInstance(&quot;@mozilla.org/security/hash;1&quot;, &amp;rv);</span>
<a href="#l81.193"></a><span id="l81.193">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.194"></a><span id="l81.194"> </span>
<a href="#l81.195"></a><span id="l81.195">   rv = hasher-&gt;Init(nsICryptoHash::MD5);</span>
<a href="#l81.196"></a><span id="l81.196">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.197"></a><span id="l81.197"> </span>
<a href="#l81.198"></a><span id="l81.198">   rv = hasher-&gt;Update((const uint8_t*) text, text_len);</span>
<a href="#l81.199"></a><span id="l81.199" class="difflineat">@@ -2034,17 +2034,17 @@ bool MsgAdvanceToNextLine(const char *bu</span>
<a href="#l81.200"></a><span id="l81.200"> NS_MSG_BASE nsresult</span>
<a href="#l81.201"></a><span id="l81.201"> MsgExamineForProxy(const char *scheme, const char *host,</span>
<a href="#l81.202"></a><span id="l81.202">                    int32_t port, nsIProxyInfo **proxyInfo)</span>
<a href="#l81.203"></a><span id="l81.203"> {</span>
<a href="#l81.204"></a><span id="l81.204">   nsresult rv;</span>
<a href="#l81.205"></a><span id="l81.205">   nsCOMPtr&lt;nsIProtocolProxyService&gt; pps =</span>
<a href="#l81.206"></a><span id="l81.206">           do_GetService(NS_PROTOCOLPROXYSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l81.207"></a><span id="l81.207">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l81.208"></a><span id="l81.208" class="difflineminus">-    nsCAutoString spec(scheme);</span>
<a href="#l81.209"></a><span id="l81.209" class="difflineplus">+    nsAutoCString spec(scheme);</span>
<a href="#l81.210"></a><span id="l81.210">     spec.Append(&quot;://&quot;);</span>
<a href="#l81.211"></a><span id="l81.211">     spec.Append(host);</span>
<a href="#l81.212"></a><span id="l81.212">     spec.Append(':');</span>
<a href="#l81.213"></a><span id="l81.213">     spec.AppendInt(port);</span>
<a href="#l81.214"></a><span id="l81.214">     // XXXXX - Under no circumstances whatsoever should any code which</span>
<a href="#l81.215"></a><span id="l81.215">     // wants a uri do this. I do this here because I do not, in fact,</span>
<a href="#l81.216"></a><span id="l81.216">     // actually want a uri (the dummy uris created here may not be </span>
<a href="#l81.217"></a><span id="l81.217">     // syntactically valid for the specific protocol), and all we need</span>
<a href="#l81.218"></a><span id="l81.218" class="difflineat">@@ -2137,17 +2137,17 @@ NS_MSG_BASE nsresult MsgTermListToString</span>
<a href="#l81.219"></a><span id="l81.219"> {</span>
<a href="#l81.220"></a><span id="l81.220">   uint32_t count;</span>
<a href="#l81.221"></a><span id="l81.221">   aTermList-&gt;Count(&amp;count);</span>
<a href="#l81.222"></a><span id="l81.222">   nsresult rv = NS_OK;</span>
<a href="#l81.223"></a><span id="l81.223"> </span>
<a href="#l81.224"></a><span id="l81.224">   for (uint32_t searchIndex = 0; searchIndex &lt; count;</span>
<a href="#l81.225"></a><span id="l81.225">        searchIndex++)</span>
<a href="#l81.226"></a><span id="l81.226">   {</span>
<a href="#l81.227"></a><span id="l81.227" class="difflineminus">-    nsCAutoString stream;</span>
<a href="#l81.228"></a><span id="l81.228" class="difflineplus">+    nsAutoCString stream;</span>
<a href="#l81.229"></a><span id="l81.229"> </span>
<a href="#l81.230"></a><span id="l81.230">     nsCOMPtr&lt;nsIMsgSearchTerm&gt; term;</span>
<a href="#l81.231"></a><span id="l81.231">     aTermList-&gt;QueryElementAt(searchIndex, NS_GET_IID(nsIMsgSearchTerm),</span>
<a href="#l81.232"></a><span id="l81.232">                                (void **)getter_AddRefs(term));</span>
<a href="#l81.233"></a><span id="l81.233">     if (!term)</span>
<a href="#l81.234"></a><span id="l81.234">       continue;</span>
<a href="#l81.235"></a><span id="l81.235"> </span>
<a href="#l81.236"></a><span id="l81.236">     if (aOutString.Length() &gt; 1)</span>
<a href="#l81.237"></a><span id="l81.237" class="difflineat">@@ -2190,18 +2190,18 @@ NS_MSG_BASE uint64_t ParseUint64Str(cons</span>
<a href="#l81.238"></a><span id="l81.238"> </span>
<a href="#l81.239"></a><span id="l81.239"> NS_MSG_BASE nsresult</span>
<a href="#l81.240"></a><span id="l81.240"> MsgStreamMsgHeaders(nsIInputStream *aInputStream, nsIStreamListener *aConsumer)</span>
<a href="#l81.241"></a><span id="l81.241"> {</span>
<a href="#l81.242"></a><span id="l81.242">   nsLineBuffer&lt;char&gt; *lineBuffer;</span>
<a href="#l81.243"></a><span id="l81.243">   nsresult rv = NS_InitLineBuffer(&amp;lineBuffer);</span>
<a href="#l81.244"></a><span id="l81.244">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.245"></a><span id="l81.245"> </span>
<a href="#l81.246"></a><span id="l81.246" class="difflineminus">-  nsCAutoString msgHeaders;</span>
<a href="#l81.247"></a><span id="l81.247" class="difflineminus">-  nsCAutoString curLine;</span>
<a href="#l81.248"></a><span id="l81.248" class="difflineplus">+  nsAutoCString msgHeaders;</span>
<a href="#l81.249"></a><span id="l81.249" class="difflineplus">+  nsAutoCString curLine;</span>
<a href="#l81.250"></a><span id="l81.250"> </span>
<a href="#l81.251"></a><span id="l81.251">   bool more = true;</span>
<a href="#l81.252"></a><span id="l81.252"> </span>
<a href="#l81.253"></a><span id="l81.253">   // We want to NS_ReadLine until we get to a blank line (the end of the headers)</span>
<a href="#l81.254"></a><span id="l81.254">   while (more)</span>
<a href="#l81.255"></a><span id="l81.255">   {</span>
<a href="#l81.256"></a><span id="l81.256">     rv = NS_ReadLine(aInputStream, lineBuffer, curLine, &amp;more);</span>
<a href="#l81.257"></a><span id="l81.257">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.258"></a><span id="l81.258" class="difflineat">@@ -2250,30 +2250,30 @@ MsgDetectCharsetFromFile(nsIFile *aFile,</span>
<a href="#l81.259"></a><span id="l81.259">     = do_CreateInstance(NS_CHARSET_DETECTOR_CONTRACTID_BASE</span>
<a href="#l81.260"></a><span id="l81.260">                         &quot;universal_charset_detector&quot;);</span>
<a href="#l81.261"></a><span id="l81.261">   if (!detector) {</span>
<a href="#l81.262"></a><span id="l81.262">     // No universal charset detector, try the default charset detector</span>
<a href="#l81.263"></a><span id="l81.263">     nsString detectorName;</span>
<a href="#l81.264"></a><span id="l81.264">     NS_GetLocalizedUnicharPreferenceWithDefault(nullptr, &quot;intl.charset.detector&quot;,</span>
<a href="#l81.265"></a><span id="l81.265">                                                 EmptyString(), detectorName);</span>
<a href="#l81.266"></a><span id="l81.266">     if (!detectorName.IsEmpty()) {</span>
<a href="#l81.267"></a><span id="l81.267" class="difflineminus">-      nsCAutoString detectorContractID;</span>
<a href="#l81.268"></a><span id="l81.268" class="difflineplus">+      nsAutoCString detectorContractID;</span>
<a href="#l81.269"></a><span id="l81.269">       detectorContractID.AssignLiteral(NS_CHARSET_DETECTOR_CONTRACTID_BASE);</span>
<a href="#l81.270"></a><span id="l81.270">       AppendUTF16toUTF8(detectorName, detectorContractID);</span>
<a href="#l81.271"></a><span id="l81.271">       detector = do_CreateInstance(detectorContractID.get());</span>
<a href="#l81.272"></a><span id="l81.272">     }</span>
<a href="#l81.273"></a><span id="l81.273">   }</span>
<a href="#l81.274"></a><span id="l81.274"> </span>
<a href="#l81.275"></a><span id="l81.275">   nsresult rv;</span>
<a href="#l81.276"></a><span id="l81.276">   nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l81.277"></a><span id="l81.277">   rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), aFile);</span>
<a href="#l81.278"></a><span id="l81.278">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.279"></a><span id="l81.279"> </span>
<a href="#l81.280"></a><span id="l81.280">   if (detector) {</span>
<a href="#l81.281"></a><span id="l81.281" class="difflineminus">-    nsCAutoString buffer;</span>
<a href="#l81.282"></a><span id="l81.282" class="difflineplus">+    nsAutoCString buffer;</span>
<a href="#l81.283"></a><span id="l81.283"> </span>
<a href="#l81.284"></a><span id="l81.284">     nsCOMPtr&lt;CharsetDetectionObserver&gt; observer = new CharsetDetectionObserver();</span>
<a href="#l81.285"></a><span id="l81.285"> </span>
<a href="#l81.286"></a><span id="l81.286">     rv = detector-&gt;Init(observer);</span>
<a href="#l81.287"></a><span id="l81.287">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.288"></a><span id="l81.288"> </span>
<a href="#l81.289"></a><span id="l81.289">     nsCOMPtr&lt;nsILineInputStream&gt; lineInputStream;</span>
<a href="#l81.290"></a><span id="l81.290">     lineInputStream = do_QueryInterface(inputStream, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -54,17 +54,17 @@ NS_MSG_BASE nsresult NS_MsgGetPriorityVa</span>
<a href="#l82.4"></a><span id="l82.4">                        const nsMsgPriorityValue p,</span>
<a href="#l82.5"></a><span id="l82.5">                        nsACString &amp; outValueString);</span>
<a href="#l82.6"></a><span id="l82.6"> </span>
<a href="#l82.7"></a><span id="l82.7"> NS_MSG_BASE nsresult NS_MsgGetUntranslatedPriorityName(</span>
<a href="#l82.8"></a><span id="l82.8">                        const nsMsgPriorityValue p,</span>
<a href="#l82.9"></a><span id="l82.9">                        nsACString &amp; outName);</span>
<a href="#l82.10"></a><span id="l82.10"> </span>
<a href="#l82.11"></a><span id="l82.11"> NS_MSG_BASE nsresult NS_MsgHashIfNecessary(nsAutoString &amp;name);</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-NS_MSG_BASE nsresult NS_MsgHashIfNecessary(nsCAutoString &amp;name);</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+NS_MSG_BASE nsresult NS_MsgHashIfNecessary(nsAutoCString &amp;name);</span>
<a href="#l82.14"></a><span id="l82.14"> </span>
<a href="#l82.15"></a><span id="l82.15"> NS_MSG_BASE nsresult FormatFileSize(uint64_t size, bool useKB, nsAString &amp;formattedSize);</span>
<a href="#l82.16"></a><span id="l82.16"> </span>
<a href="#l82.17"></a><span id="l82.17"> </span>
<a href="#l82.18"></a><span id="l82.18"> /**</span>
<a href="#l82.19"></a><span id="l82.19">  * given a folder uri, return the path to folder in the user profile directory.</span>
<a href="#l82.20"></a><span id="l82.20">  *</span>
<a href="#l82.21"></a><span id="l82.21">  * @param aFolderURI uri of folder we want the path to, without the scheme</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -60,17 +60,17 @@ MacGetFileType(nsIFile   *fs,</span>
<a href="#l83.4"></a><span id="l83.4">     // see what we can find out?</span>
<a href="#l83.5"></a><span id="l83.5">     nsresult      rv;</span>
<a href="#l83.6"></a><span id="l83.6">     nsCOMPtr &lt;nsIURI&gt; tURI;</span>
<a href="#l83.7"></a><span id="l83.7">     if (NS_SUCCEEDED(NS_NewFileURI(getter_AddRefs(tURI), fs)) &amp;&amp; tURI)</span>
<a href="#l83.8"></a><span id="l83.8">     {</span>
<a href="#l83.9"></a><span id="l83.9">       nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder (do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l83.10"></a><span id="l83.10">       if (NS_SUCCEEDED(rv) &amp;&amp; mimeFinder) </span>
<a href="#l83.11"></a><span id="l83.11">       {</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-        nsCAutoString mimeType;</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+        nsAutoCString mimeType;</span>
<a href="#l83.14"></a><span id="l83.14">         rv = mimeFinder-&gt;GetTypeFromURI(tURI, mimeType);</span>
<a href="#l83.15"></a><span id="l83.15">         if (NS_SUCCEEDED(rv)) </span>
<a href="#l83.16"></a><span id="l83.16">         {</span>
<a href="#l83.17"></a><span id="l83.17">           *fileType = ToNewCString(mimeType);</span>
<a href="#l83.18"></a><span id="l83.18">           return;</span>
<a href="#l83.19"></a><span id="l83.19">         }        </span>
<a href="#l83.20"></a><span id="l83.20">       }</span>
<a href="#l83.21"></a><span id="l83.21">     }</span>
<a href="#l83.22"></a><span id="l83.22" class="difflineat">@@ -95,17 +95,17 @@ int ap_encode_init( appledouble_encode_o</span>
<a href="#l83.23"></a><span id="l83.23"> {</span>
<a href="#l83.24"></a><span id="l83.24">   nsCOMPtr &lt;nsIFile&gt; myFile;</span>
<a href="#l83.25"></a><span id="l83.25">   NS_NewNativeLocalFile(nsDependentCString(fname), true, getter_AddRefs(myFile));</span>
<a href="#l83.26"></a><span id="l83.26">   bool exists;</span>
<a href="#l83.27"></a><span id="l83.27">   if (myFile &amp;&amp; NS_SUCCEEDED(myFile-&gt;Exists(&amp;exists)) &amp;&amp; !exists)</span>
<a href="#l83.28"></a><span id="l83.28">     return -1;</span>
<a href="#l83.29"></a><span id="l83.29"> </span>
<a href="#l83.30"></a><span id="l83.30">   nsCOMPtr&lt;nsILocalFileMac&gt; macFile = do_QueryInterface(myFile);</span>
<a href="#l83.31"></a><span id="l83.31" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l83.32"></a><span id="l83.32" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l83.33"></a><span id="l83.33">   macFile-&gt;GetNativePath(path);</span>
<a href="#l83.34"></a><span id="l83.34"> </span>
<a href="#l83.35"></a><span id="l83.35"> 	memset(p_ap_encode_obj, 0, sizeof(appledouble_encode_object));</span>
<a href="#l83.36"></a><span id="l83.36"> 	</span>
<a href="#l83.37"></a><span id="l83.37"> 	/*</span>
<a href="#l83.38"></a><span id="l83.38"> 	**	Fill out the source file inforamtion.</span>
<a href="#l83.39"></a><span id="l83.39"> 	*/	</span>
<a href="#l83.40"></a><span id="l83.40">   memcpy(p_ap_encode_obj-&gt;fname, path.get(), path.Length());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAppleEncode.cpp</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAppleEncode.cpp</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -185,17 +185,17 @@ int ap_encode_file_infor(</span>
<a href="#l84.4"></a><span id="l84.4"> 	head.entries = NUM_ENTRIES - 1;</span>
<a href="#l84.5"></a><span id="l84.5"> 	status = to64(p_ap_encode_obj,</span>
<a href="#l84.6"></a><span id="l84.6"> 					(char *) &amp;head,</span>
<a href="#l84.7"></a><span id="l84.7"> 					sizeof (head));				</span>
<a href="#l84.8"></a><span id="l84.8"> 	if (status != noErr)</span>
<a href="#l84.9"></a><span id="l84.9"> 		return status;</span>
<a href="#l84.10"></a><span id="l84.10"> </span>
<a href="#l84.11"></a><span id="l84.11"> 	/* write entry descriptors */</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-    nsCAutoString leafname;</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+    nsAutoCString leafname;</span>
<a href="#l84.14"></a><span id="l84.14">     macFile-&gt;GetNativeLeafName(leafname);</span>
<a href="#l84.15"></a><span id="l84.15"> 	entries[0].offset = sizeof (head) + sizeof (ap_entry) * head.entries;</span>
<a href="#l84.16"></a><span id="l84.16"> 	entries[0].id 	= ENT_NAME;</span>
<a href="#l84.17"></a><span id="l84.17">     entries[0].length = leafname.Length();</span>
<a href="#l84.18"></a><span id="l84.18"> 	entries[1].id 	= ENT_FINFO;</span>
<a href="#l84.19"></a><span id="l84.19"> 	entries[1].length = sizeof (FInfo) + sizeof (FXInfo);</span>
<a href="#l84.20"></a><span id="l84.20"> 	entries[2].id 	= ENT_DATES;</span>
<a href="#l84.21"></a><span id="l84.21"> 	entries[2].length = sizeof (ap_dates);</span>
<a href="#l84.22"></a><span id="l84.22" class="difflineat">@@ -480,17 +480,17 @@ int ap_encode_data(</span>
<a href="#l84.23"></a><span id="l84.23"> 		else</span>
<a href="#l84.24"></a><span id="l84.24"> 		{</span>
<a href="#l84.25"></a><span id="l84.25"> 			magic_type = text_type;		/* we already know it is a text type.	*/</span>
<a href="#l84.26"></a><span id="l84.26"> 		}</span>
<a href="#l84.27"></a><span id="l84.27"> </span>
<a href="#l84.28"></a><span id="l84.28"> 		/*</span>
<a href="#l84.29"></a><span id="l84.29"> 		**	the data portion header information.</span>
<a href="#l84.30"></a><span id="l84.30"> 		*/</span>
<a href="#l84.31"></a><span id="l84.31" class="difflineminus">-        nsCAutoString leafName;</span>
<a href="#l84.32"></a><span id="l84.32" class="difflineplus">+        nsAutoCString leafName;</span>
<a href="#l84.33"></a><span id="l84.33">         resFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l84.34"></a><span id="l84.34"> 		PR_snprintf(rd_buff, sizeof(rd_buff),</span>
<a href="#l84.35"></a><span id="l84.35"> 			&quot;Content-Type: %s; name=\&quot;%s\&quot;&quot; CRLF &quot;Content-Transfer-Encoding: base64&quot; CRLF &quot;Content-Disposition: inline; filename=\&quot;%s\&quot;&quot; CRLF CRLF,</span>
<a href="#l84.36"></a><span id="l84.36"> 			magic_type,</span>
<a href="#l84.37"></a><span id="l84.37"> 			leafName.get(),</span>
<a href="#l84.38"></a><span id="l84.38"> 			leafName.get());</span>
<a href="#l84.39"></a><span id="l84.39"> 			</span>
<a href="#l84.40"></a><span id="l84.40"> 		status = write_stream(p_ap_encode_obj, </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachment.cpp</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachment.cpp</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -221,17 +221,17 @@ NS_IMETHODIMP nsMsgAttachment::SetSize(i</span>
<a href="#l85.4"></a><span id="l85.4"> }</span>
<a href="#l85.5"></a><span id="l85.5"> </span>
<a href="#l85.6"></a><span id="l85.6"> /* boolean equalsUrl (in nsIMsgAttachment attachment); */</span>
<a href="#l85.7"></a><span id="l85.7"> NS_IMETHODIMP nsMsgAttachment::EqualsUrl(nsIMsgAttachment *attachment, bool *_retval)</span>
<a href="#l85.8"></a><span id="l85.8"> {</span>
<a href="#l85.9"></a><span id="l85.9">   NS_ENSURE_ARG_POINTER(attachment);</span>
<a href="#l85.10"></a><span id="l85.10">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l85.11"></a><span id="l85.11"> </span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-  nsCAutoString url;</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+  nsAutoCString url;</span>
<a href="#l85.14"></a><span id="l85.14">   attachment-&gt;GetUrl(url);</span>
<a href="#l85.15"></a><span id="l85.15"> </span>
<a href="#l85.16"></a><span id="l85.16">   *_retval = mUrl.Equals(url);</span>
<a href="#l85.17"></a><span id="l85.17">   return NS_OK;</span>
<a href="#l85.18"></a><span id="l85.18"> }</span>
<a href="#l85.19"></a><span id="l85.19"> </span>
<a href="#l85.20"></a><span id="l85.20"> </span>
<a href="#l85.21"></a><span id="l85.21"> nsresult nsMsgAttachment::DeleteAttachment()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -520,17 +520,17 @@ nsMsgAttachmentHandler::SnarfMsgAttachme</span>
<a href="#l86.4"></a><span id="l86.4">         rv =  NS_ERROR_UNEXPECTED;</span>
<a href="#l86.5"></a><span id="l86.5">       goto done;</span>
<a href="#l86.6"></a><span id="l86.6">     }</span>
<a href="#l86.7"></a><span id="l86.7"> </span>
<a href="#l86.8"></a><span id="l86.8">     rv = fetcher-&gt;Initialize(mTmpFile, mOutFile, FetcherURLDoneCallback, this);</span>
<a href="#l86.9"></a><span id="l86.9">     rv = GetMessageServiceFromURI(m_uri, getter_AddRefs(messageService));</span>
<a href="#l86.10"></a><span id="l86.10">     if (NS_SUCCEEDED(rv) &amp;&amp; messageService)</span>
<a href="#l86.11"></a><span id="l86.11">     {</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-      nsCAutoString uri(m_uri);</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+      nsAutoCString uri(m_uri);</span>
<a href="#l86.14"></a><span id="l86.14">       uri += (uri.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l86.15"></a><span id="l86.15">       uri.Append(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l86.16"></a><span id="l86.16">       nsCOMPtr&lt;nsIStreamListener&gt; strListener;</span>
<a href="#l86.17"></a><span id="l86.17">       fetcher-&gt;QueryInterface(NS_GET_IID(nsIStreamListener), getter_AddRefs(strListener));</span>
<a href="#l86.18"></a><span id="l86.18"> </span>
<a href="#l86.19"></a><span id="l86.19">       // initialize a new stream converter, that uses the strListener as its input</span>
<a href="#l86.20"></a><span id="l86.20">       // obtain the input stream listener from the new converter,</span>
<a href="#l86.21"></a><span id="l86.21">       // and pass the converter's input stream listener to DisplayMessage</span>
<a href="#l86.22"></a><span id="l86.22" class="difflineat">@@ -634,19 +634,19 @@ nsMsgAttachmentHandler::SnarfAttachment(</span>
<a href="#l86.23"></a><span id="l86.23">   }</span>
<a href="#l86.24"></a><span id="l86.24"> </span>
<a href="#l86.25"></a><span id="l86.25">   nsCString sourceURISpec;</span>
<a href="#l86.26"></a><span id="l86.26">   mURL-&gt;GetSpec(sourceURISpec);</span>
<a href="#l86.27"></a><span id="l86.27"> #ifdef XP_MACOSX</span>
<a href="#l86.28"></a><span id="l86.28">   if (!m_bogus_attachment &amp;&amp; StringBeginsWith(sourceURISpec, NS_LITERAL_CSTRING(&quot;file://&quot;)))</span>
<a href="#l86.29"></a><span id="l86.29">   {</span>
<a href="#l86.30"></a><span id="l86.30">     // Unescape the path (i.e. un-URLify it) before making a FSSpec</span>
<a href="#l86.31"></a><span id="l86.31" class="difflineminus">-    nsCAutoString filePath;</span>
<a href="#l86.32"></a><span id="l86.32" class="difflineplus">+    nsAutoCString filePath;</span>
<a href="#l86.33"></a><span id="l86.33">     filePath.Adopt(nsMsgGetLocalFileFromURL(sourceURISpec.get()));</span>
<a href="#l86.34"></a><span id="l86.34" class="difflineminus">-    nsCAutoString unescapedFilePath;</span>
<a href="#l86.35"></a><span id="l86.35" class="difflineplus">+    nsAutoCString unescapedFilePath;</span>
<a href="#l86.36"></a><span id="l86.36">     MsgUnescapeString(filePath, 0, unescapedFilePath);</span>
<a href="#l86.37"></a><span id="l86.37"> </span>
<a href="#l86.38"></a><span id="l86.38">     nsCOMPtr&lt;nsIFile&gt; sourceFile;</span>
<a href="#l86.39"></a><span id="l86.39">     NS_NewNativeLocalFile(unescapedFilePath, true, getter_AddRefs(sourceFile));</span>
<a href="#l86.40"></a><span id="l86.40">     if (!sourceFile)</span>
<a href="#l86.41"></a><span id="l86.41">       return NS_ERROR_FAILURE;</span>
<a href="#l86.42"></a><span id="l86.42">       </span>
<a href="#l86.43"></a><span id="l86.43">     // check if it is a bundle. if it is, we'll zip it. </span>
<a href="#l86.44"></a><span id="l86.44" class="difflineat">@@ -681,17 +681,17 @@ nsMsgAttachmentHandler::SnarfAttachment(</span>
<a href="#l86.45"></a><span id="l86.45">   return fetcher-&gt;FireURLRequest(mURL, mTmpFile, mOutFile, FetcherURLDoneCallback, this);</span>
<a href="#l86.46"></a><span id="l86.46"> }</span>
<a href="#l86.47"></a><span id="l86.47"> </span>
<a href="#l86.48"></a><span id="l86.48"> #ifdef XP_MACOSX</span>
<a href="#l86.49"></a><span id="l86.49"> nsresult</span>
<a href="#l86.50"></a><span id="l86.50"> nsMsgAttachmentHandler::ConvertToZipFile(nsILocalFileMac *aSourceFile)</span>
<a href="#l86.51"></a><span id="l86.51"> {</span>
<a href="#l86.52"></a><span id="l86.52">   // append &quot;.zip&quot; to the real file name</span>
<a href="#l86.53"></a><span id="l86.53" class="difflineminus">-  nsCAutoString zippedName;</span>
<a href="#l86.54"></a><span id="l86.54" class="difflineplus">+  nsAutoCString zippedName;</span>
<a href="#l86.55"></a><span id="l86.55">   nsresult rv = aSourceFile-&gt;GetNativeLeafName(zippedName);</span>
<a href="#l86.56"></a><span id="l86.56">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l86.57"></a><span id="l86.57">   zippedName.AppendLiteral(&quot;.zip&quot;);</span>
<a href="#l86.58"></a><span id="l86.58"> </span>
<a href="#l86.59"></a><span id="l86.59">   // create a temporary file that we'll work on</span>
<a href="#l86.60"></a><span id="l86.60">   nsCOMPtr &lt;nsIFile&gt; tmpFile;</span>
<a href="#l86.61"></a><span id="l86.61">   rv = nsMsgCreateTempFile(zippedName.get(), getter_AddRefs(tmpFile));</span>
<a href="#l86.62"></a><span id="l86.62">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l86.63"></a><span id="l86.63" class="difflineat">@@ -744,17 +744,17 @@ nsMsgAttachmentHandler::ConvertToAppleEn</span>
<a href="#l86.64"></a><span id="l86.64">   if (sendResourceFork)</span>
<a href="#l86.65"></a><span id="l86.65">   {</span>
<a href="#l86.66"></a><span id="l86.66">     nsCOMPtr&lt;nsIURL&gt; fileUrl(do_CreateInstance(NS_STANDARDURL_CONTRACTID));</span>
<a href="#l86.67"></a><span id="l86.67">     if (fileUrl)</span>
<a href="#l86.68"></a><span id="l86.68">     {</span>
<a href="#l86.69"></a><span id="l86.69">       rv = fileUrl-&gt;SetSpec(aFileURI);</span>
<a href="#l86.70"></a><span id="l86.70">       if (NS_SUCCEEDED(rv))</span>
<a href="#l86.71"></a><span id="l86.71">       {</span>
<a href="#l86.72"></a><span id="l86.72" class="difflineminus">-        nsCAutoString ext;</span>
<a href="#l86.73"></a><span id="l86.73" class="difflineplus">+        nsAutoCString ext;</span>
<a href="#l86.74"></a><span id="l86.74">         rv = fileUrl-&gt;GetFileExtension(ext);</span>
<a href="#l86.75"></a><span id="l86.75">         if (NS_SUCCEEDED(rv) &amp;&amp; !ext.IsEmpty())</span>
<a href="#l86.76"></a><span id="l86.76">         {</span>
<a href="#l86.77"></a><span id="l86.77">           sendResourceFork =</span>
<a href="#l86.78"></a><span id="l86.78">           PL_strcasecmp(ext.get(), &quot;TXT&quot;) &amp;&amp;</span>
<a href="#l86.79"></a><span id="l86.79">           PL_strcasecmp(ext.get(), &quot;JPG&quot;) &amp;&amp;</span>
<a href="#l86.80"></a><span id="l86.80">           PL_strcasecmp(ext.get(), &quot;GIF&quot;) &amp;&amp;</span>
<a href="#l86.81"></a><span id="l86.81">           PL_strcasecmp(ext.get(), &quot;TIF&quot;) &amp;&amp;</span>
<a href="#l86.82"></a><span id="l86.82" class="difflineat">@@ -1046,17 +1046,17 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l86.83"></a><span id="l86.83">     if (mode == nsIMsgSend::nsMsgSaveAsDraft || mode == nsIMsgSend::nsMsgSaveAsTemplate)</span>
<a href="#l86.84"></a><span id="l86.84">       bundle-&gt;GetStringFromID(NS_MSG_FAILURE_ON_OBJ_EMBED_WHILE_SAVING, getter_Copies(msg));</span>
<a href="#l86.85"></a><span id="l86.85">     else</span>
<a href="#l86.86"></a><span id="l86.86">       bundle-&gt;GetStringFromID(NS_MSG_FAILURE_ON_OBJ_EMBED_WHILE_SENDING, getter_Copies(msg));</span>
<a href="#l86.87"></a><span id="l86.87">     if (!m_realName.IsEmpty())</span>
<a href="#l86.88"></a><span id="l86.88">       printfString = nsTextFormatter::smprintf(msg.get(), m_realName.get());</span>
<a href="#l86.89"></a><span id="l86.89">     else if (NS_SUCCEEDED(mURL-&gt;GetSpec(turl)) &amp;&amp; !turl.IsEmpty())</span>
<a href="#l86.90"></a><span id="l86.90">     {</span>
<a href="#l86.91"></a><span id="l86.91" class="difflineminus">-      nsCAutoString unescapedUrl;</span>
<a href="#l86.92"></a><span id="l86.92" class="difflineplus">+      nsAutoCString unescapedUrl;</span>
<a href="#l86.93"></a><span id="l86.93">       MsgUnescapeString(turl, 0, unescapedUrl);</span>
<a href="#l86.94"></a><span id="l86.94">       if (unescapedUrl.IsEmpty())</span>
<a href="#l86.95"></a><span id="l86.95">         printfString = nsTextFormatter::smprintf(msg.get(), turl.get());</span>
<a href="#l86.96"></a><span id="l86.96">       else</span>
<a href="#l86.97"></a><span id="l86.97">         printfString = nsTextFormatter::smprintf(msg.get(), unescapedUrl.get());</span>
<a href="#l86.98"></a><span id="l86.98">     }</span>
<a href="#l86.99"></a><span id="l86.99">     else</span>
<a href="#l86.100"></a><span id="l86.100">       printfString = nsTextFormatter::smprintf(msg.get(), &quot;?&quot;);</span>
<a href="#l86.101"></a><span id="l86.101" class="difflineat">@@ -1108,17 +1108,17 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l86.102"></a><span id="l86.102">         if (mDeleteFile)</span>
<a href="#l86.103"></a><span id="l86.103">           mTmpFile-&gt;Remove(false);</span>
<a href="#l86.104"></a><span id="l86.104"> </span>
<a href="#l86.105"></a><span id="l86.105">         nsCOMPtr&lt;nsIOutputStream&gt; outputStream;</span>
<a href="#l86.106"></a><span id="l86.106">         nsresult rv = NS_NewLocalFileOutputStream(getter_AddRefs(outputStream), mTmpFile,  PR_WRONLY | PR_CREATE_FILE, 00600);</span>
<a href="#l86.107"></a><span id="l86.107"> </span>
<a href="#l86.108"></a><span id="l86.108">         if (NS_SUCCEEDED(rv))</span>
<a href="#l86.109"></a><span id="l86.109">         {</span>
<a href="#l86.110"></a><span id="l86.110" class="difflineminus">-          nsCAutoString tData;</span>
<a href="#l86.111"></a><span id="l86.111" class="difflineplus">+          nsAutoCString tData;</span>
<a href="#l86.112"></a><span id="l86.112">           if (NS_FAILED(ConvertFromUnicode(m_charset.get(), conData, tData)))</span>
<a href="#l86.113"></a><span id="l86.113">             LossyCopyUTF16toASCII(conData, tData);</span>
<a href="#l86.114"></a><span id="l86.114">           if (!tData.IsEmpty())</span>
<a href="#l86.115"></a><span id="l86.115">           {</span>
<a href="#l86.116"></a><span id="l86.116">             uint32_t bytesWritten;</span>
<a href="#l86.117"></a><span id="l86.117">             (void) outputStream-&gt;Write(tData.get(), tData.Length(), &amp;bytesWritten);</span>
<a href="#l86.118"></a><span id="l86.118">           }</span>
<a href="#l86.119"></a><span id="l86.119">           outputStream-&gt;Close();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -626,17 +626,17 @@ nsresult nsMsgCompFields::SplitRecipient</span>
<a href="#l87.4"></a><span id="l87.4">   nsresult rv;</span>
<a href="#l87.5"></a><span id="l87.5"> </span>
<a href="#l87.6"></a><span id="l87.6">   nsCOMPtr&lt;nsIMsgHeaderParser&gt; parser =</span>
<a href="#l87.7"></a><span id="l87.7">     do_GetService(NS_MAILNEWS_MIME_HEADER_PARSER_CONTRACTID, &amp;rv);</span>
<a href="#l87.8"></a><span id="l87.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l87.9"></a><span id="l87.9">   nsCOMPtr&lt;nsIMimeConverter&gt; converter = do_GetService(NS_MIME_CONVERTER_CONTRACTID, &amp;rv);</span>
<a href="#l87.10"></a><span id="l87.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l87.11"></a><span id="l87.11"> </span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-  nsCAutoString recipientsStr;</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+  nsAutoCString recipientsStr;</span>
<a href="#l87.14"></a><span id="l87.14">   char *names;</span>
<a href="#l87.15"></a><span id="l87.15">   char *addresses;</span>
<a href="#l87.16"></a><span id="l87.16">   uint32_t numAddresses;</span>
<a href="#l87.17"></a><span id="l87.17"> </span>
<a href="#l87.18"></a><span id="l87.18">   CopyUTF16toUTF8(recipients, recipientsStr);</span>
<a href="#l87.19"></a><span id="l87.19">   rv = parser-&gt;ParseHeaderAddresses(recipientsStr.get(), &amp;names,</span>
<a href="#l87.20"></a><span id="l87.20">                                     &amp;addresses, &amp;numAddresses);</span>
<a href="#l87.21"></a><span id="l87.21">   if (NS_SUCCEEDED(rv))</span>
<a href="#l87.22"></a><span id="l87.22" class="difflineat">@@ -718,17 +718,17 @@ NS_IMETHODIMP nsMsgCompFields::GetDefaul</span>
<a href="#l87.23"></a><span id="l87.23">   *aDefaultCharacterSet = ToNewCString(m_DefaultCharacterSet);</span>
<a href="#l87.24"></a><span id="l87.24">   return *aDefaultCharacterSet ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l87.25"></a><span id="l87.25"> }</span>
<a href="#l87.26"></a><span id="l87.26"> </span>
<a href="#l87.27"></a><span id="l87.27"> NS_IMETHODIMP nsMsgCompFields::CheckCharsetConversion(char **fallbackCharset, bool *_retval)</span>
<a href="#l87.28"></a><span id="l87.28"> {</span>
<a href="#l87.29"></a><span id="l87.29">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l87.30"></a><span id="l87.30"> </span>
<a href="#l87.31"></a><span id="l87.31" class="difflineminus">-  nsCAutoString headers;</span>
<a href="#l87.32"></a><span id="l87.32" class="difflineplus">+  nsAutoCString headers;</span>
<a href="#l87.33"></a><span id="l87.33">   for (int16_t i = 0; i &lt; MSG_MAX_HEADERS; i++)</span>
<a href="#l87.34"></a><span id="l87.34">     headers.Append(m_headers[i]);</span>
<a href="#l87.35"></a><span id="l87.35"> </span>
<a href="#l87.36"></a><span id="l87.36">   // charset conversion check</span>
<a href="#l87.37"></a><span id="l87.37">   *_retval = nsMsgI18Ncheck_data_in_charset_range(GetCharacterSet(), NS_ConvertUTF8toUTF16(headers.get()).get(),</span>
<a href="#l87.38"></a><span id="l87.38">                                                   fallbackCharset);</span>
<a href="#l87.39"></a><span id="l87.39"> </span>
<a href="#l87.40"></a><span id="l87.40">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -282,17 +282,17 @@ mime_generate_headers (nsMsgCompFields *</span>
<a href="#l88.4"></a><span id="l88.4">   const char* pSubject;</span>
<a href="#l88.5"></a><span id="l88.5">   const char* pPriority;</span>
<a href="#l88.6"></a><span id="l88.6">   const char* pReference;</span>
<a href="#l88.7"></a><span id="l88.7">   const char* pOtherHdr;</span>
<a href="#l88.8"></a><span id="l88.8">   char *convbuf;</span>
<a href="#l88.9"></a><span id="l88.9"> </span>
<a href="#l88.10"></a><span id="l88.10">   bool hasDisclosedRecipient = false;</span>
<a href="#l88.11"></a><span id="l88.11"> </span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-  nsCAutoString headerBuf;    // accumulate header strings to get length</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineplus">+  nsAutoCString headerBuf;    // accumulate header strings to get length</span>
<a href="#l88.14"></a><span id="l88.14">   headerBuf.Truncate();</span>
<a href="#l88.15"></a><span id="l88.15"> </span>
<a href="#l88.16"></a><span id="l88.16">   NS_ASSERTION (fields, &quot;null fields&quot;);</span>
<a href="#l88.17"></a><span id="l88.17">   if (!fields)</span>
<a href="#l88.18"></a><span id="l88.18">     return nullptr;</span>
<a href="#l88.19"></a><span id="l88.19"> </span>
<a href="#l88.20"></a><span id="l88.20">   pFrom = fields-&gt;GetFrom();</span>
<a href="#l88.21"></a><span id="l88.21">   if (pFrom)</span>
<a href="#l88.22"></a><span id="l88.22" class="difflineat">@@ -442,17 +442,17 @@ mime_generate_headers (nsMsgCompFields *</span>
<a href="#l88.23"></a><span id="l88.23"> </span>
<a href="#l88.24"></a><span id="l88.24">     PUSH_NEWLINE ();</span>
<a href="#l88.25"></a><span id="l88.25">   }</span>
<a href="#l88.26"></a><span id="l88.26"> </span>
<a href="#l88.27"></a><span id="l88.27"> </span>
<a href="#l88.28"></a><span id="l88.28">   nsCOMPtr&lt;nsIHttpProtocolHandler&gt; pHTTPHandler = do_GetService(NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX &quot;http&quot;, &amp;rv);</span>
<a href="#l88.29"></a><span id="l88.29">   if (NS_SUCCEEDED(rv) &amp;&amp; pHTTPHandler)</span>
<a href="#l88.30"></a><span id="l88.30">   {</span>
<a href="#l88.31"></a><span id="l88.31" class="difflineminus">-    nsCAutoString userAgentString;</span>
<a href="#l88.32"></a><span id="l88.32" class="difflineplus">+    nsAutoCString userAgentString;</span>
<a href="#l88.33"></a><span id="l88.33">     pHTTPHandler-&gt;GetUserAgent(userAgentString);</span>
<a href="#l88.34"></a><span id="l88.34"> </span>
<a href="#l88.35"></a><span id="l88.35">     if (!userAgentString.IsEmpty())</span>
<a href="#l88.36"></a><span id="l88.36">     {</span>
<a href="#l88.37"></a><span id="l88.37">       PUSH_STRING (&quot;User-Agent: &quot;);</span>
<a href="#l88.38"></a><span id="l88.38">       PUSH_STRING(userAgentString.get());</span>
<a href="#l88.39"></a><span id="l88.39">       PUSH_NEWLINE ();</span>
<a href="#l88.40"></a><span id="l88.40">     }</span>
<a href="#l88.41"></a><span id="l88.41" class="difflineat">@@ -627,18 +627,18 @@ mime_generate_headers (nsMsgCompFields *</span>
<a href="#l88.42"></a><span id="l88.42">   if (pPriority &amp;&amp; *pPriority) </span>
<a href="#l88.43"></a><span id="l88.43">   {</span>
<a href="#l88.44"></a><span id="l88.44">     nsMsgPriorityValue priorityValue;</span>
<a href="#l88.45"></a><span id="l88.45"> </span>
<a href="#l88.46"></a><span id="l88.46">     NS_MsgGetPriorityFromString(pPriority, priorityValue);</span>
<a href="#l88.47"></a><span id="l88.47"> </span>
<a href="#l88.48"></a><span id="l88.48">     // Skip default priority.</span>
<a href="#l88.49"></a><span id="l88.49">     if (priorityValue != nsMsgPriority::Default) {</span>
<a href="#l88.50"></a><span id="l88.50" class="difflineminus">-      nsCAutoString priorityName;</span>
<a href="#l88.51"></a><span id="l88.51" class="difflineminus">-      nsCAutoString priorityValueString;</span>
<a href="#l88.52"></a><span id="l88.52" class="difflineplus">+      nsAutoCString priorityName;</span>
<a href="#l88.53"></a><span id="l88.53" class="difflineplus">+      nsAutoCString priorityValueString;</span>
<a href="#l88.54"></a><span id="l88.54"> </span>
<a href="#l88.55"></a><span id="l88.55">       NS_MsgGetPriorityValueString(priorityValue, priorityValueString);</span>
<a href="#l88.56"></a><span id="l88.56">       NS_MsgGetUntranslatedPriorityName(priorityValue, priorityName);</span>
<a href="#l88.57"></a><span id="l88.57"> </span>
<a href="#l88.58"></a><span id="l88.58">       // Output format: [X-Priority: &lt;pValue&gt; (&lt;pName&gt;)]</span>
<a href="#l88.59"></a><span id="l88.59">       PUSH_STRING(&quot;X-Priority: &quot;);</span>
<a href="#l88.60"></a><span id="l88.60">       PUSH_STRING(priorityValueString.get());</span>
<a href="#l88.61"></a><span id="l88.61">       PUSH_STRING(&quot; (&quot;);</span>
<a href="#l88.62"></a><span id="l88.62" class="difflineat">@@ -1135,17 +1135,17 @@ RFC2231ParmFolding(const char *parmName,</span>
<a href="#l88.63"></a><span id="l88.63"> {</span>
<a href="#l88.64"></a><span id="l88.64">   NS_ENSURE_TRUE(parmName &amp;&amp; *parmName &amp;&amp; !parmValue.IsEmpty(), nullptr);</span>
<a href="#l88.65"></a><span id="l88.65"> </span>
<a href="#l88.66"></a><span id="l88.66">   bool needEscape;</span>
<a href="#l88.67"></a><span id="l88.67">   nsCString dupParm;</span>
<a href="#l88.68"></a><span id="l88.68"> </span>
<a href="#l88.69"></a><span id="l88.69">   if (!NS_IsAscii(parmValue.get()) || is7bitCharset(charset)) {</span>
<a href="#l88.70"></a><span id="l88.70">     needEscape = true;</span>
<a href="#l88.71"></a><span id="l88.71" class="difflineminus">-    nsCAutoString nativeParmValue;</span>
<a href="#l88.72"></a><span id="l88.72" class="difflineplus">+    nsAutoCString nativeParmValue;</span>
<a href="#l88.73"></a><span id="l88.73">     ConvertFromUnicode(charset.get(), parmValue, nativeParmValue);</span>
<a href="#l88.74"></a><span id="l88.74">     MsgEscapeString(nativeParmValue, nsINetUtil::ESCAPE_ALL, dupParm);</span>
<a href="#l88.75"></a><span id="l88.75">   }</span>
<a href="#l88.76"></a><span id="l88.76">   else {</span>
<a href="#l88.77"></a><span id="l88.77">     needEscape = false;</span>
<a href="#l88.78"></a><span id="l88.78">     dupParm.Adopt(</span>
<a href="#l88.79"></a><span id="l88.79">       msg_make_filename_qtext(NS_LossyConvertUTF16toASCII(parmValue).get(),</span>
<a href="#l88.80"></a><span id="l88.80">                               true));</span>
<a href="#l88.81"></a><span id="l88.81" class="difflineat">@@ -1701,17 +1701,17 @@ nsMsgNewURL(nsIURI** aInstancePtrResult,</span>
<a href="#l88.82"></a><span id="l88.82">   if (nullptr == aInstancePtrResult)</span>
<a href="#l88.83"></a><span id="l88.83">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l88.84"></a><span id="l88.84">   nsCOMPtr&lt;nsIIOService&gt; pNetService =</span>
<a href="#l88.85"></a><span id="l88.85">     mozilla::services::GetIOService();</span>
<a href="#l88.86"></a><span id="l88.86">   NS_ENSURE_TRUE(pNetService, NS_ERROR_UNEXPECTED);</span>
<a href="#l88.87"></a><span id="l88.87">   if (PL_strstr(aSpec, &quot;://&quot;) == nullptr &amp;&amp; strncmp(aSpec, &quot;data:&quot;, 5))</span>
<a href="#l88.88"></a><span id="l88.88">   {</span>
<a href="#l88.89"></a><span id="l88.89">     //XXXjag Temporary fix for bug 139362 until the real problem(bug 70083) get fixed</span>
<a href="#l88.90"></a><span id="l88.90" class="difflineminus">-    nsCAutoString uri(NS_LITERAL_CSTRING(&quot;http://&quot;));</span>
<a href="#l88.91"></a><span id="l88.91" class="difflineplus">+    nsAutoCString uri(NS_LITERAL_CSTRING(&quot;http://&quot;));</span>
<a href="#l88.92"></a><span id="l88.92">     uri.Append(aSpec);</span>
<a href="#l88.93"></a><span id="l88.93">     rv = pNetService-&gt;NewURI(uri, nullptr, nullptr, aInstancePtrResult);</span>
<a href="#l88.94"></a><span id="l88.94">   }</span>
<a href="#l88.95"></a><span id="l88.95">   else</span>
<a href="#l88.96"></a><span id="l88.96">     rv = pNetService-&gt;NewURI(nsDependentCString(aSpec), nullptr, nullptr, aInstancePtrResult);</span>
<a href="#l88.97"></a><span id="l88.97">   return rv;</span>
<a href="#l88.98"></a><span id="l88.98"> }</span>
<a href="#l88.99"></a><span id="l88.99"> </span>
<a href="#l88.100"></a><span id="l88.100" class="difflineat">@@ -1752,17 +1752,17 @@ nsMsgParseURLHost(const char *url)</span>
<a href="#l88.101"></a><span id="l88.101"> {</span>
<a href="#l88.102"></a><span id="l88.102">   nsIURI        *workURI = nullptr;</span>
<a href="#l88.103"></a><span id="l88.103">   nsresult      rv;</span>
<a href="#l88.104"></a><span id="l88.104"> </span>
<a href="#l88.105"></a><span id="l88.105">   rv = nsMsgNewURL(&amp;workURI, url);</span>
<a href="#l88.106"></a><span id="l88.106">   if (NS_FAILED(rv) || !workURI)</span>
<a href="#l88.107"></a><span id="l88.107">     return nullptr;</span>
<a href="#l88.108"></a><span id="l88.108"> </span>
<a href="#l88.109"></a><span id="l88.109" class="difflineminus">-  nsCAutoString host;</span>
<a href="#l88.110"></a><span id="l88.110" class="difflineplus">+  nsAutoCString host;</span>
<a href="#l88.111"></a><span id="l88.111">   rv = workURI-&gt;GetHost(host);</span>
<a href="#l88.112"></a><span id="l88.112">   NS_IF_RELEASE(workURI);</span>
<a href="#l88.113"></a><span id="l88.113">   if (NS_FAILED(rv))</span>
<a href="#l88.114"></a><span id="l88.114">     return nullptr;</span>
<a href="#l88.115"></a><span id="l88.115"> </span>
<a href="#l88.116"></a><span id="l88.116">   return ToNewCString(host);</span>
<a href="#l88.117"></a><span id="l88.117"> }</span>
<a href="#l88.118"></a><span id="l88.118"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -280,26 +280,26 @@ bool nsMsgCompose::IsEmbeddedObjectSafe(</span>
<a href="#l89.4"></a><span id="l89.4">     return false;</span>
<a href="#l89.5"></a><span id="l89.5"> </span>
<a href="#l89.6"></a><span id="l89.6">   if (!objURL.IsEmpty())</span>
<a href="#l89.7"></a><span id="l89.7">   {</span>
<a href="#l89.8"></a><span id="l89.8">     nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l89.9"></a><span id="l89.9">     rv = NS_NewURI(getter_AddRefs(uri), objURL);</span>
<a href="#l89.10"></a><span id="l89.10">     if (NS_SUCCEEDED(rv) &amp;&amp; uri)</span>
<a href="#l89.11"></a><span id="l89.11">     {</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-      nsCAutoString scheme;</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+      nsAutoCString scheme;</span>
<a href="#l89.14"></a><span id="l89.14">       rv = uri-&gt;GetScheme(scheme);</span>
<a href="#l89.15"></a><span id="l89.15">       if (NS_SUCCEEDED(rv) &amp;&amp; scheme.Equals(originalScheme, nsCaseInsensitiveCStringComparator()))</span>
<a href="#l89.16"></a><span id="l89.16">       {</span>
<a href="#l89.17"></a><span id="l89.17" class="difflineminus">-        nsCAutoString host;</span>
<a href="#l89.18"></a><span id="l89.18" class="difflineplus">+        nsAutoCString host;</span>
<a href="#l89.19"></a><span id="l89.19">         rv = uri-&gt;GetAsciiHost(host);</span>
<a href="#l89.20"></a><span id="l89.20">         // mailbox url don't have a host therefore don't be too strict.</span>
<a href="#l89.21"></a><span id="l89.21">         if (NS_SUCCEEDED(rv) &amp;&amp; (host.IsEmpty() || originalHost || host.Equals(originalHost, nsCaseInsensitiveCStringComparator())))</span>
<a href="#l89.22"></a><span id="l89.22">         {</span>
<a href="#l89.23"></a><span id="l89.23" class="difflineminus">-          nsCAutoString path;</span>
<a href="#l89.24"></a><span id="l89.24" class="difflineplus">+          nsAutoCString path;</span>
<a href="#l89.25"></a><span id="l89.25">           rv = uri-&gt;GetPath(path);</span>
<a href="#l89.26"></a><span id="l89.26">           if (NS_SUCCEEDED(rv))</span>
<a href="#l89.27"></a><span id="l89.27">           {</span>
<a href="#l89.28"></a><span id="l89.28">             const char * query = strrchr(path.get(), '?');</span>
<a href="#l89.29"></a><span id="l89.29">             if (query &amp;&amp; PL_strncasecmp(path.get(), originalPath, query - path.get()) == 0)</span>
<a href="#l89.30"></a><span id="l89.30">                 return true; //This object is a part of the original message, we can send it safely.</span>
<a href="#l89.31"></a><span id="l89.31">           }</span>
<a href="#l89.32"></a><span id="l89.32">         }</span>
<a href="#l89.33"></a><span id="l89.33" class="difflineat">@@ -920,17 +920,17 @@ nsMsgCompose::Initialize(nsIMsgComposePa</span>
<a href="#l89.34"></a><span id="l89.34">   nsCOMPtr&lt;nsIMsgComposeService&gt; composeService = do_GetService(NS_MSGCOMPOSESERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l89.35"></a><span id="l89.35">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.36"></a><span id="l89.36"> </span>
<a href="#l89.37"></a><span id="l89.37">   rv = composeService-&gt;DetermineComposeHTML(m_identity, format, &amp;m_composeHTML);</span>
<a href="#l89.38"></a><span id="l89.38">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.39"></a><span id="l89.39"> </span>
<a href="#l89.40"></a><span id="l89.40">   if (composeFields)</span>
<a href="#l89.41"></a><span id="l89.41">   {</span>
<a href="#l89.42"></a><span id="l89.42" class="difflineminus">-    nsCAutoString draftId; // will get set for drafts and templates</span>
<a href="#l89.43"></a><span id="l89.43" class="difflineplus">+    nsAutoCString draftId; // will get set for drafts and templates</span>
<a href="#l89.44"></a><span id="l89.44">     rv = composeFields-&gt;GetDraftId(getter_Copies(draftId));</span>
<a href="#l89.45"></a><span id="l89.45">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.46"></a><span id="l89.46"> </span>
<a href="#l89.47"></a><span id="l89.47">     // Set return receipt flag and type, and if we should attach a vCard</span>
<a href="#l89.48"></a><span id="l89.48">     // by checking the identity prefs - but don't clobber the values for</span>
<a href="#l89.49"></a><span id="l89.49">     // drafts and templates as they were set up already by mime when</span>
<a href="#l89.50"></a><span id="l89.50">     // initializing the message.</span>
<a href="#l89.51"></a><span id="l89.51">     if (m_identity &amp;&amp; draftId.IsEmpty())</span>
<a href="#l89.52"></a><span id="l89.52" class="difflineat">@@ -1668,17 +1668,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l89.53"></a><span id="l89.53">                                      nsIMsgCompFields * compFields)</span>
<a href="#l89.54"></a><span id="l89.54"> {</span>
<a href="#l89.55"></a><span id="l89.55">   nsresult rv = NS_OK;</span>
<a href="#l89.56"></a><span id="l89.56"> </span>
<a href="#l89.57"></a><span id="l89.57">   mType = type;</span>
<a href="#l89.58"></a><span id="l89.58">   mDraftDisposition = nsIMsgFolder::nsMsgDispositionState_None;</span>
<a href="#l89.59"></a><span id="l89.59"> </span>
<a href="#l89.60"></a><span id="l89.60">   mDeleteDraft = (type == nsIMsgCompType::Draft);</span>
<a href="#l89.61"></a><span id="l89.61" class="difflineminus">-  nsCAutoString msgUri(originalMsgURI);</span>
<a href="#l89.62"></a><span id="l89.62" class="difflineplus">+  nsAutoCString msgUri(originalMsgURI);</span>
<a href="#l89.63"></a><span id="l89.63">   bool fileUrl = StringBeginsWith(msgUri, NS_LITERAL_CSTRING(&quot;file:&quot;));</span>
<a href="#l89.64"></a><span id="l89.64">   int32_t typeIndex = msgUri.Find(&quot;type=application/x-message-display&quot;);</span>
<a href="#l89.65"></a><span id="l89.65">   if (typeIndex != kNotFound &amp;&amp; typeIndex &gt; 0)</span>
<a href="#l89.66"></a><span id="l89.66">   {</span>
<a href="#l89.67"></a><span id="l89.67">     // Strip out type=application/x-message-display because it confuses libmime.</span>
<a href="#l89.68"></a><span id="l89.68">     msgUri.Cut(typeIndex, sizeof(&quot;type=application/x-message-display&quot;));</span>
<a href="#l89.69"></a><span id="l89.69">     if (fileUrl) // we're dealing with an .eml file msg</span>
<a href="#l89.70"></a><span id="l89.70">     {</span>
<a href="#l89.71"></a><span id="l89.71" class="difflineat">@@ -1838,20 +1838,20 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l89.72"></a><span id="l89.72">       }</span>
<a href="#l89.73"></a><span id="l89.73">     }</span>
<a href="#l89.74"></a><span id="l89.74"> </span>
<a href="#l89.75"></a><span id="l89.75">     // We want to treat this message as a reference too</span>
<a href="#l89.76"></a><span id="l89.76">     nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l89.77"></a><span id="l89.77">     rv = GetMsgDBHdrFromURI(originalMsgURI, getter_AddRefs(msgHdr));</span>
<a href="#l89.78"></a><span id="l89.78">     if (NS_SUCCEEDED(rv))</span>
<a href="#l89.79"></a><span id="l89.79">     {</span>
<a href="#l89.80"></a><span id="l89.80" class="difflineminus">-      nsCAutoString messageId;</span>
<a href="#l89.81"></a><span id="l89.81" class="difflineplus">+      nsAutoCString messageId;</span>
<a href="#l89.82"></a><span id="l89.82">       msgHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l89.83"></a><span id="l89.83"> </span>
<a href="#l89.84"></a><span id="l89.84" class="difflineminus">-      nsCAutoString reference;</span>
<a href="#l89.85"></a><span id="l89.85" class="difflineplus">+      nsAutoCString reference;</span>
<a href="#l89.86"></a><span id="l89.86">       reference.Append(NS_LITERAL_CSTRING(&quot;&lt;&quot;));</span>
<a href="#l89.87"></a><span id="l89.87">       reference.Append(messageId);</span>
<a href="#l89.88"></a><span id="l89.88">       reference.Append(NS_LITERAL_CSTRING(&quot;&gt;&quot;));</span>
<a href="#l89.89"></a><span id="l89.89">       // We're forwarding, which means we're composing a message that has no</span>
<a href="#l89.90"></a><span id="l89.90">       // references yet, so we can set the value safely</span>
<a href="#l89.91"></a><span id="l89.91">       m_compFields-&gt;SetReferences(reference.get());</span>
<a href="#l89.92"></a><span id="l89.92">     }</span>
<a href="#l89.93"></a><span id="l89.93"> </span>
<a href="#l89.94"></a><span id="l89.94" class="difflineat">@@ -1915,17 +1915,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l89.95"></a><span id="l89.95">       {</span>
<a href="#l89.96"></a><span id="l89.96">         rv = msgHdr-&gt;GetCharset(getter_Copies(charset));</span>
<a href="#l89.97"></a><span id="l89.97">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.98"></a><span id="l89.98">       }</span>
<a href="#l89.99"></a><span id="l89.99"> </span>
<a href="#l89.100"></a><span id="l89.100">       // save the charset of a message being replied to because</span>
<a href="#l89.101"></a><span id="l89.101">       // we need to use it when decoding RFC-2047-encoded author name</span>
<a href="#l89.102"></a><span id="l89.102">       // with |charsetOverride|.</span>
<a href="#l89.103"></a><span id="l89.103" class="difflineminus">-      nsCAutoString originCharset(charset);</span>
<a href="#l89.104"></a><span id="l89.104" class="difflineplus">+      nsAutoCString originCharset(charset);</span>
<a href="#l89.105"></a><span id="l89.105"> </span>
<a href="#l89.106"></a><span id="l89.106">       bool replyInDefault = false;</span>
<a href="#l89.107"></a><span id="l89.107">       prefs-&gt;GetBoolPref(&quot;mailnews.reply_in_default_charset&quot;,</span>
<a href="#l89.108"></a><span id="l89.108">                           &amp;replyInDefault);</span>
<a href="#l89.109"></a><span id="l89.109">       // Use send_default_charset if reply_in_default_charset is on.</span>
<a href="#l89.110"></a><span id="l89.110">       if (replyInDefault)</span>
<a href="#l89.111"></a><span id="l89.111">       {</span>
<a href="#l89.112"></a><span id="l89.112">         nsString str;</span>
<a href="#l89.113"></a><span id="l89.113" class="difflineat">@@ -1964,17 +1964,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l89.114"></a><span id="l89.114">           // firstly, get the database via the folder</span>
<a href="#l89.115"></a><span id="l89.115">           nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l89.116"></a><span id="l89.116">           msgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l89.117"></a><span id="l89.117">           if (folder) {</span>
<a href="#l89.118"></a><span id="l89.118">             nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l89.119"></a><span id="l89.119">             folder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l89.120"></a><span id="l89.120"> </span>
<a href="#l89.121"></a><span id="l89.121">             if (db) {</span>
<a href="#l89.122"></a><span id="l89.122" class="difflineminus">-              nsCAutoString reference;</span>
<a href="#l89.123"></a><span id="l89.123" class="difflineplus">+              nsAutoCString reference;</span>
<a href="#l89.124"></a><span id="l89.124">               msgHdr-&gt;GetStringReference(0, reference);</span>
<a href="#l89.125"></a><span id="l89.125"> </span>
<a href="#l89.126"></a><span id="l89.126">               nsCOMPtr&lt;nsIMsgDBHdr&gt; refHdr;</span>
<a href="#l89.127"></a><span id="l89.127">               db-&gt;GetMsgHdrForMessageID(reference.get(), getter_AddRefs(refHdr));</span>
<a href="#l89.128"></a><span id="l89.128"> </span>
<a href="#l89.129"></a><span id="l89.129">               if (refHdr) {</span>
<a href="#l89.130"></a><span id="l89.130">                 nsCString refSubject;</span>
<a href="#l89.131"></a><span id="l89.131">                 rv = refHdr-&gt;GetSubject(getter_Copies(refSubject));</span>
<a href="#l89.132"></a><span id="l89.132" class="difflineat">@@ -2138,29 +2138,29 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l89.133"></a><span id="l89.133"> </span>
<a href="#l89.134"></a><span id="l89.134">             // Setup quoting callbacks for later...</span>
<a href="#l89.135"></a><span id="l89.135">             mWhatHolder = 1;</span>
<a href="#l89.136"></a><span id="l89.136">             break;</span>
<a href="#l89.137"></a><span id="l89.137">           }</span>
<a href="#l89.138"></a><span id="l89.138">         case nsIMsgCompType::ForwardAsAttachment:</span>
<a href="#l89.139"></a><span id="l89.139">           {</span>
<a href="#l89.140"></a><span id="l89.140">             // Add the forwarded message in the references, first</span>
<a href="#l89.141"></a><span id="l89.141" class="difflineminus">-            nsCAutoString messageId;</span>
<a href="#l89.142"></a><span id="l89.142" class="difflineplus">+            nsAutoCString messageId;</span>
<a href="#l89.143"></a><span id="l89.143">             msgHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l89.144"></a><span id="l89.144">             if (isFirstPass)</span>
<a href="#l89.145"></a><span id="l89.145">             {</span>
<a href="#l89.146"></a><span id="l89.146" class="difflineminus">-              nsCAutoString reference;</span>
<a href="#l89.147"></a><span id="l89.147" class="difflineplus">+              nsAutoCString reference;</span>
<a href="#l89.148"></a><span id="l89.148">               reference.Append(NS_LITERAL_CSTRING(&quot;&lt;&quot;));</span>
<a href="#l89.149"></a><span id="l89.149">               reference.Append(messageId);</span>
<a href="#l89.150"></a><span id="l89.150">               reference.Append(NS_LITERAL_CSTRING(&quot;&gt;&quot;));</span>
<a href="#l89.151"></a><span id="l89.151">               m_compFields-&gt;SetReferences(reference.get());</span>
<a href="#l89.152"></a><span id="l89.152">             }</span>
<a href="#l89.153"></a><span id="l89.153">             else</span>
<a href="#l89.154"></a><span id="l89.154">             {</span>
<a href="#l89.155"></a><span id="l89.155" class="difflineminus">-              nsCAutoString references;</span>
<a href="#l89.156"></a><span id="l89.156" class="difflineplus">+              nsAutoCString references;</span>
<a href="#l89.157"></a><span id="l89.157">               m_compFields-&gt;GetReferences(getter_Copies(references));</span>
<a href="#l89.158"></a><span id="l89.158">               references.Append(NS_LITERAL_CSTRING(&quot; &lt;&quot;));</span>
<a href="#l89.159"></a><span id="l89.159">               references.Append(messageId);</span>
<a href="#l89.160"></a><span id="l89.160">               references.Append(NS_LITERAL_CSTRING(&quot;&gt;&quot;));</span>
<a href="#l89.161"></a><span id="l89.161">               m_compFields-&gt;SetReferences(references.get());</span>
<a href="#l89.162"></a><span id="l89.162">             }</span>
<a href="#l89.163"></a><span id="l89.163"> </span>
<a href="#l89.164"></a><span id="l89.164">             uint32_t flags;</span>
<a href="#l89.165"></a><span id="l89.165" class="difflineat">@@ -2226,17 +2226,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l89.166"></a><span id="l89.166">               }</span>
<a href="#l89.167"></a><span id="l89.167">               m_compFields-&gt;SetSubject(subject);</span>
<a href="#l89.168"></a><span id="l89.168">             }</span>
<a href="#l89.169"></a><span id="l89.169">             break;</span>
<a href="#l89.170"></a><span id="l89.170">           }</span>
<a href="#l89.171"></a><span id="l89.171">         case nsIMsgCompType::Redirect:</span>
<a href="#l89.172"></a><span id="l89.172">           {</span>
<a href="#l89.173"></a><span id="l89.173">             // For a redirect, set the Reply-To: header to what was in the original From: header...</span>
<a href="#l89.174"></a><span id="l89.174" class="difflineminus">-            nsCAutoString author;</span>
<a href="#l89.175"></a><span id="l89.175" class="difflineplus">+            nsAutoCString author;</span>
<a href="#l89.176"></a><span id="l89.176">             msgHdr-&gt;GetAuthor(getter_Copies(author));</span>
<a href="#l89.177"></a><span id="l89.177">             m_compFields-&gt;SetReplyTo(author.get());</span>
<a href="#l89.178"></a><span id="l89.178"> </span>
<a href="#l89.179"></a><span id="l89.179">             // ... and empty out the various recipient headers</span>
<a href="#l89.180"></a><span id="l89.180">             nsAutoString empty;</span>
<a href="#l89.181"></a><span id="l89.181">             m_compFields-&gt;SetTo(empty);</span>
<a href="#l89.182"></a><span id="l89.182">             m_compFields-&gt;SetCc(empty);</span>
<a href="#l89.183"></a><span id="l89.183">             m_compFields-&gt;SetBcc(empty);</span>
<a href="#l89.184"></a><span id="l89.184" class="difflineat">@@ -2338,17 +2338,17 @@ QuotingOutputStreamListener::QuotingOutp</span>
<a href="#l89.185"></a><span id="l89.185">     if (originalMsgHdr &amp;&amp; !quoteHeaders)</span>
<a href="#l89.186"></a><span id="l89.186">     {</span>
<a href="#l89.187"></a><span id="l89.187">       // Setup the cite information....</span>
<a href="#l89.188"></a><span id="l89.188">       nsCString myGetter;</span>
<a href="#l89.189"></a><span id="l89.189">       if (NS_SUCCEEDED(originalMsgHdr-&gt;GetMessageId(getter_Copies(myGetter))))</span>
<a href="#l89.190"></a><span id="l89.190">       {</span>
<a href="#l89.191"></a><span id="l89.191">         if (!myGetter.IsEmpty())</span>
<a href="#l89.192"></a><span id="l89.192">         {</span>
<a href="#l89.193"></a><span id="l89.193" class="difflineminus">-          nsCAutoString buf;</span>
<a href="#l89.194"></a><span id="l89.194" class="difflineplus">+          nsAutoCString buf;</span>
<a href="#l89.195"></a><span id="l89.195">           mCiteReference.AssignLiteral(&quot;mid:&quot;);</span>
<a href="#l89.196"></a><span id="l89.196">           MsgEscapeURL(myGetter,</span>
<a href="#l89.197"></a><span id="l89.197">                        nsINetUtil::ESCAPE_URL_FILE_BASENAME | nsINetUtil::ESCAPE_URL_FORCED,</span>
<a href="#l89.198"></a><span id="l89.198">                        buf);</span>
<a href="#l89.199"></a><span id="l89.199">           mCiteReference.Append(NS_ConvertASCIItoUTF16(buf));</span>
<a href="#l89.200"></a><span id="l89.200">         }</span>
<a href="#l89.201"></a><span id="l89.201">       }</span>
<a href="#l89.202"></a><span id="l89.202"> </span>
<a href="#l89.203"></a><span id="l89.203" class="difflineat">@@ -3315,17 +3315,17 @@ NS_IMETHODIMP nsMsgCompose::RememberQueu</span>
<a href="#l89.204"></a><span id="l89.204">   else if (mType == nsIMsgCompType::ForwardAsAttachment ||</span>
<a href="#l89.205"></a><span id="l89.205">            mType == nsIMsgCompType::ForwardInline)</span>
<a href="#l89.206"></a><span id="l89.206">     dispositionSetting = &quot;forwarded&quot;;</span>
<a href="#l89.207"></a><span id="l89.207"> </span>
<a href="#l89.208"></a><span id="l89.208">   nsMsgKey msgKey;</span>
<a href="#l89.209"></a><span id="l89.209">   if (mMsgSend)</span>
<a href="#l89.210"></a><span id="l89.210">   {</span>
<a href="#l89.211"></a><span id="l89.211">     mMsgSend-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l89.212"></a><span id="l89.212" class="difflineminus">-    nsCAutoString msgUri(m_folderName);</span>
<a href="#l89.213"></a><span id="l89.213" class="difflineplus">+    nsAutoCString msgUri(m_folderName);</span>
<a href="#l89.214"></a><span id="l89.214">     nsCString identityKey;</span>
<a href="#l89.215"></a><span id="l89.215"> </span>
<a href="#l89.216"></a><span id="l89.216">     m_identity-&gt;GetKey(identityKey);</span>
<a href="#l89.217"></a><span id="l89.217"> </span>
<a href="#l89.218"></a><span id="l89.218">     int32_t insertIndex = StringBeginsWith(msgUri, NS_LITERAL_CSTRING(&quot;mailbox&quot;)) ? 7 : 4;</span>
<a href="#l89.219"></a><span id="l89.219">     msgUri.Insert(&quot;-message&quot;, insertIndex); // &quot;mailbox/imap: -&gt; &quot;mailbox/imap-message:&quot;</span>
<a href="#l89.220"></a><span id="l89.220">     msgUri.Append('#');</span>
<a href="#l89.221"></a><span id="l89.221">     msgUri.AppendInt(msgKey);</span>
<a href="#l89.222"></a><span id="l89.222" class="difflineat">@@ -3881,17 +3881,17 @@ nsMsgComposeSendListener::RemoveCurrentD</span>
<a href="#l89.223"></a><span id="l89.223">         nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(msgFolder);</span>
<a href="#l89.224"></a><span id="l89.224">         NS_ASSERTION(imapFolder, &quot;The draft folder MUST be an imap folder in order to mark the msg delete!&quot;);</span>
<a href="#l89.225"></a><span id="l89.225">         if (NS_SUCCEEDED(rv) &amp;&amp; imapFolder)</span>
<a href="#l89.226"></a><span id="l89.226">         {</span>
<a href="#l89.227"></a><span id="l89.227">           const char * str = PL_strchr(curDraftIdURL.get(), '#');</span>
<a href="#l89.228"></a><span id="l89.228">           NS_ASSERTION(str, &quot;Failed to get current draft id url&quot;);</span>
<a href="#l89.229"></a><span id="l89.229">           if (str)</span>
<a href="#l89.230"></a><span id="l89.230">           {</span>
<a href="#l89.231"></a><span id="l89.231" class="difflineminus">-            nsCAutoString srcStr(str+1);</span>
<a href="#l89.232"></a><span id="l89.232" class="difflineplus">+            nsAutoCString srcStr(str+1);</span>
<a href="#l89.233"></a><span id="l89.233">             nsresult err;</span>
<a href="#l89.234"></a><span id="l89.234">             nsMsgKey messageID = srcStr.ToInteger(&amp;err);</span>
<a href="#l89.235"></a><span id="l89.235">             if (messageID != nsMsgKey_None)</span>
<a href="#l89.236"></a><span id="l89.236">             {</span>
<a href="#l89.237"></a><span id="l89.237">               rv = imapFolder-&gt;StoreImapFlags(kImapMsgDeletedFlag, true,</span>
<a href="#l89.238"></a><span id="l89.238">                                               &amp;messageID, 1, nullptr);</span>
<a href="#l89.239"></a><span id="l89.239">             }</span>
<a href="#l89.240"></a><span id="l89.240">           }</span>
<a href="#l89.241"></a><span id="l89.241" class="difflineat">@@ -4093,47 +4093,47 @@ nsMsgCompose::LoadDataFromFile(nsIFile *</span>
<a href="#l89.242"></a><span id="l89.242">     else {</span>
<a href="#l89.243"></a><span id="l89.243">       readSize = 0;</span>
<a href="#l89.244"></a><span id="l89.244">     }</span>
<a href="#l89.245"></a><span id="l89.245">   }</span>
<a href="#l89.246"></a><span id="l89.246">   inputFile-&gt;Close();</span>
<a href="#l89.247"></a><span id="l89.247"> </span>
<a href="#l89.248"></a><span id="l89.248">   readSize = (uint32_t) fileSize;</span>
<a href="#l89.249"></a><span id="l89.249"> </span>
<a href="#l89.250"></a><span id="l89.250" class="difflineminus">-  nsCAutoString sigEncoding(nsMsgI18NParseMetaCharset(file));</span>
<a href="#l89.251"></a><span id="l89.251" class="difflineplus">+  nsAutoCString sigEncoding(nsMsgI18NParseMetaCharset(file));</span>
<a href="#l89.252"></a><span id="l89.252">   bool removeSigCharset = !sigEncoding.IsEmpty() &amp;&amp; m_composeHTML;</span>
<a href="#l89.253"></a><span id="l89.253"> </span>
<a href="#l89.254"></a><span id="l89.254">   if (sigEncoding.IsEmpty()) {</span>
<a href="#l89.255"></a><span id="l89.255">     if (aAllowUTF8 &amp;&amp; MsgIsUTF8(nsDependentCString(readBuf))) {</span>
<a href="#l89.256"></a><span id="l89.256">       sigEncoding.Assign(&quot;UTF-8&quot;);</span>
<a href="#l89.257"></a><span id="l89.257">     }</span>
<a href="#l89.258"></a><span id="l89.258">     else if (sigEncoding.IsEmpty() &amp;&amp; aAllowUTF16 &amp;&amp;</span>
<a href="#l89.259"></a><span id="l89.259">              readSize % 2 == 0 &amp;&amp; readSize &gt;= 2 &amp;&amp;</span>
<a href="#l89.260"></a><span id="l89.260">              ((readBuf[0] == char(0xFE) &amp;&amp; readBuf[1] == char(0xFF)) ||</span>
<a href="#l89.261"></a><span id="l89.261">               (readBuf[0] == char(0xFF) &amp;&amp; readBuf[1] == char(0xFE)))) {</span>
<a href="#l89.262"></a><span id="l89.262">       sigEncoding.Assign(&quot;UTF-16&quot;);</span>
<a href="#l89.263"></a><span id="l89.263">     }</span>
<a href="#l89.264"></a><span id="l89.264">     else {</span>
<a href="#l89.265"></a><span id="l89.265">       //default to platform encoding for plain text files w/o meta charset</span>
<a href="#l89.266"></a><span id="l89.266" class="difflineminus">-      nsCAutoString textFileCharset;</span>
<a href="#l89.267"></a><span id="l89.267" class="difflineplus">+      nsAutoCString textFileCharset;</span>
<a href="#l89.268"></a><span id="l89.268">       nsMsgI18NTextFileCharset(textFileCharset);</span>
<a href="#l89.269"></a><span id="l89.269">       sigEncoding.Assign(textFileCharset);</span>
<a href="#l89.270"></a><span id="l89.270">     }</span>
<a href="#l89.271"></a><span id="l89.271">   }</span>
<a href="#l89.272"></a><span id="l89.272"> </span>
<a href="#l89.273"></a><span id="l89.273" class="difflineminus">-  nsCAutoString readStr(readBuf, (int32_t) fileSize);</span>
<a href="#l89.274"></a><span id="l89.274" class="difflineplus">+  nsAutoCString readStr(readBuf, (int32_t) fileSize);</span>
<a href="#l89.275"></a><span id="l89.275">   PR_FREEIF(readBuf);</span>
<a href="#l89.276"></a><span id="l89.276"> </span>
<a href="#l89.277"></a><span id="l89.277">   if (NS_FAILED(ConvertToUnicode(sigEncoding.get(), readStr, sigData)))</span>
<a href="#l89.278"></a><span id="l89.278">     CopyASCIItoUTF16(readStr, sigData);</span>
<a href="#l89.279"></a><span id="l89.279"> </span>
<a href="#l89.280"></a><span id="l89.280">   //remove sig meta charset to allow user charset override during composition</span>
<a href="#l89.281"></a><span id="l89.281">   if (removeSigCharset)</span>
<a href="#l89.282"></a><span id="l89.282">   {</span>
<a href="#l89.283"></a><span id="l89.283" class="difflineminus">-    nsCAutoString metaCharset(&quot;charset=&quot;);</span>
<a href="#l89.284"></a><span id="l89.284" class="difflineplus">+    nsAutoCString metaCharset(&quot;charset=&quot;);</span>
<a href="#l89.285"></a><span id="l89.285">     metaCharset.Append(sigEncoding);</span>
<a href="#l89.286"></a><span id="l89.286">     int32_t pos = sigData.Find(metaCharset.BeginReading(), true);</span>
<a href="#l89.287"></a><span id="l89.287">     if (pos != kNotFound)</span>
<a href="#l89.288"></a><span id="l89.288">       sigData.Cut(pos, metaCharset.Length());</span>
<a href="#l89.289"></a><span id="l89.289">   }</span>
<a href="#l89.290"></a><span id="l89.290"> </span>
<a href="#l89.291"></a><span id="l89.291">   return NS_OK;</span>
<a href="#l89.292"></a><span id="l89.292"> }</span>
<a href="#l89.293"></a><span id="l89.293" class="difflineat">@@ -4179,17 +4179,17 @@ nsMsgCompose::ProcessSignature(nsIMsgIde</span>
<a href="#l89.294"></a><span id="l89.294">   // insert the correct HTML into the composer to have it work, but if we</span>
<a href="#l89.295"></a><span id="l89.295">   // are doing plain text compose, we should insert some sort of message</span>
<a href="#l89.296"></a><span id="l89.296">   // saying &quot;Image Signature Omitted&quot; or something (not done yet).</span>
<a href="#l89.297"></a><span id="l89.297">   //</span>
<a href="#l89.298"></a><span id="l89.298">   // If there's a sig pref, it will only be used if there is no sig file defined,</span>
<a href="#l89.299"></a><span id="l89.299">   // thus if attach_signature is checked, htmlSigText is ignored (bug 324495).</span>
<a href="#l89.300"></a><span id="l89.300">   // Plain-text signatures may or may not have a trailing line break (bug 428040).</span>
<a href="#l89.301"></a><span id="l89.301"> </span>
<a href="#l89.302"></a><span id="l89.302" class="difflineminus">-  nsCAutoString sigNativePath;</span>
<a href="#l89.303"></a><span id="l89.303" class="difflineplus">+  nsAutoCString sigNativePath;</span>
<a href="#l89.304"></a><span id="l89.304">   bool          attachFile = false;</span>
<a href="#l89.305"></a><span id="l89.305">   bool          useSigFile = false;</span>
<a href="#l89.306"></a><span id="l89.306">   bool          htmlSig = false;</span>
<a href="#l89.307"></a><span id="l89.307">   bool          imageSig = false;</span>
<a href="#l89.308"></a><span id="l89.308">   nsAutoString  sigData;</span>
<a href="#l89.309"></a><span id="l89.309">   nsAutoString sigOutput;</span>
<a href="#l89.310"></a><span id="l89.310">   int32_t      reply_on_top = 0;</span>
<a href="#l89.311"></a><span id="l89.311">   bool         sig_bottom = true;</span>
<a href="#l89.312"></a><span id="l89.312" class="difflineat">@@ -4214,17 +4214,17 @@ nsMsgCompose::ProcessSignature(nsIMsgIde</span>
<a href="#l89.313"></a><span id="l89.313">         if (NS_SUCCEEDED(rv) &amp;&amp; !sigNativePath.IsEmpty()) {</span>
<a href="#l89.314"></a><span id="l89.314">           bool exists = false;</span>
<a href="#l89.315"></a><span id="l89.315">           sigFile-&gt;Exists(&amp;exists);</span>
<a href="#l89.316"></a><span id="l89.316">           if (exists) {</span>
<a href="#l89.317"></a><span id="l89.317">             useSigFile = true; // ok, there's a signature file</span>
<a href="#l89.318"></a><span id="l89.318"> </span>
<a href="#l89.319"></a><span id="l89.319">             // Now, most importantly, we need to figure out what the content type is for</span>
<a href="#l89.320"></a><span id="l89.320">             // this signature...if we can't, we assume text</span>
<a href="#l89.321"></a><span id="l89.321" class="difflineminus">-            nsCAutoString sigContentType;</span>
<a href="#l89.322"></a><span id="l89.322" class="difflineplus">+            nsAutoCString sigContentType;</span>
<a href="#l89.323"></a><span id="l89.323">             nsresult rv2; // don't want to clobber the other rv</span>
<a href="#l89.324"></a><span id="l89.324">             nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder (do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv2));</span>
<a href="#l89.325"></a><span id="l89.325">             if (NS_SUCCEEDED(rv2)) {</span>
<a href="#l89.326"></a><span id="l89.326">               rv2 = mimeFinder-&gt;GetTypeFromFile(sigFile, sigContentType);</span>
<a href="#l89.327"></a><span id="l89.327">               if (NS_SUCCEEDED(rv2)) {</span>
<a href="#l89.328"></a><span id="l89.328">                 if (StringBeginsWith(sigContentType, NS_LITERAL_CSTRING(&quot;image/&quot;), nsCaseInsensitiveCStringComparator()))</span>
<a href="#l89.329"></a><span id="l89.329">                   imageSig = true;</span>
<a href="#l89.330"></a><span id="l89.330">                 else if (sigContentType.Equals(TEXT_HTML, nsCaseInsensitiveCStringComparator()))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -427,17 +427,17 @@ nsMsgComposeService::GetOrigWindowSelect</span>
<a href="#l90.4"></a><span id="l90.4"> </span>
<a href="#l90.5"></a><span id="l90.5">   nsCOMPtr&lt;nsIDOMWindow&gt; domWindow(do_GetInterface(childAsItem, &amp;rv));</span>
<a href="#l90.6"></a><span id="l90.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l90.7"></a><span id="l90.7">   nsCOMPtr&lt;nsISelection&gt; sel;</span>
<a href="#l90.8"></a><span id="l90.8">   rv = domWindow-&gt;GetSelection(getter_AddRefs(sel));</span>
<a href="#l90.9"></a><span id="l90.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l90.10"></a><span id="l90.10"> </span>
<a href="#l90.11"></a><span id="l90.11">   bool requireMultipleWords = true;</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-  nsCAutoString charsOnlyIf;</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineplus">+  nsAutoCString charsOnlyIf;</span>
<a href="#l90.14"></a><span id="l90.14">   prefs-&gt;GetBoolPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_MULTI_WORD, &amp;requireMultipleWords);</span>
<a href="#l90.15"></a><span id="l90.15">   prefs-&gt;GetCharPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_ONLY_IF, getter_Copies(charsOnlyIf));</span>
<a href="#l90.16"></a><span id="l90.16">   if (sel &amp;&amp; (requireMultipleWords || !charsOnlyIf.IsEmpty()))</span>
<a href="#l90.17"></a><span id="l90.17">   {</span>
<a href="#l90.18"></a><span id="l90.18">     nsAutoString selPlain;</span>
<a href="#l90.19"></a><span id="l90.19">     rv = sel-&gt;ToString(selPlain);</span>
<a href="#l90.20"></a><span id="l90.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l90.21"></a><span id="l90.21"> </span>
<a href="#l90.22"></a><span id="l90.22" class="difflineat">@@ -509,17 +509,17 @@ nsMsgComposeService::OpenComposeWindow(c</span>
<a href="#l90.23"></a><span id="l90.23">     GetDefaultIdentity(getter_AddRefs(identity));</span>
<a href="#l90.24"></a><span id="l90.24"> </span>
<a href="#l90.25"></a><span id="l90.25">   /* Actually, the only way to implement forward inline is to simulate a template message.</span>
<a href="#l90.26"></a><span id="l90.26">      Maybe one day when we will have more time we can change that</span>
<a href="#l90.27"></a><span id="l90.27">   */</span>
<a href="#l90.28"></a><span id="l90.28">   if (type == nsIMsgCompType::ForwardInline || type == nsIMsgCompType::Draft || type == nsIMsgCompType::Template</span>
<a href="#l90.29"></a><span id="l90.29">     || type == nsIMsgCompType::ReplyWithTemplate || type == nsIMsgCompType::Redirect)</span>
<a href="#l90.30"></a><span id="l90.30">   {</span>
<a href="#l90.31"></a><span id="l90.31" class="difflineminus">-    nsCAutoString uriToOpen(originalMsgURI);</span>
<a href="#l90.32"></a><span id="l90.32" class="difflineplus">+    nsAutoCString uriToOpen(originalMsgURI);</span>
<a href="#l90.33"></a><span id="l90.33">     uriToOpen += (uriToOpen.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l90.34"></a><span id="l90.34">     uriToOpen.Append(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l90.35"></a><span id="l90.35">     if (type == nsIMsgCompType::Redirect)</span>
<a href="#l90.36"></a><span id="l90.36">       uriToOpen.Append(&quot;&amp;redirect=true&quot;);</span>
<a href="#l90.37"></a><span id="l90.37"> </span>
<a href="#l90.38"></a><span id="l90.38">     aMsgWindow-&gt;SetCharsetOverride(true);</span>
<a href="#l90.39"></a><span id="l90.39">     return LoadDraftOrTemplate(uriToOpen, type == nsIMsgCompType::ForwardInline || type == nsIMsgCompType::Draft ?</span>
<a href="#l90.40"></a><span id="l90.40">                                nsMimeOutput::nsMimeMessageDraftOrTemplate : nsMimeOutput::nsMimeMessageEditorTemplate,</span>
<a href="#l90.41"></a><span id="l90.41" class="difflineat">@@ -540,41 +540,41 @@ nsMsgComposeService::OpenComposeWindow(c</span>
<a href="#l90.42"></a><span id="l90.42">       // When doing a reply (except with a template) see if there's a selection that we should quote</span>
<a href="#l90.43"></a><span id="l90.43">       if (type == nsIMsgCompType::Reply ||</span>
<a href="#l90.44"></a><span id="l90.44">           type == nsIMsgCompType::ReplyAll ||</span>
<a href="#l90.45"></a><span id="l90.45">           type == nsIMsgCompType::ReplyToSender ||</span>
<a href="#l90.46"></a><span id="l90.46">           type == nsIMsgCompType::ReplyToGroup ||</span>
<a href="#l90.47"></a><span id="l90.47">           type == nsIMsgCompType::ReplyToSenderAndGroup ||</span>
<a href="#l90.48"></a><span id="l90.48">           type == nsIMsgCompType::ReplyToList)</span>
<a href="#l90.49"></a><span id="l90.49">       {</span>
<a href="#l90.50"></a><span id="l90.50" class="difflineminus">-        nsCAutoString selHTML;</span>
<a href="#l90.51"></a><span id="l90.51" class="difflineplus">+        nsAutoCString selHTML;</span>
<a href="#l90.52"></a><span id="l90.52">         if (NS_SUCCEEDED(GetOrigWindowSelection(type, aMsgWindow, selHTML)))</span>
<a href="#l90.53"></a><span id="l90.53">           pMsgComposeParams-&gt;SetHtmlToQuote(selHTML);</span>
<a href="#l90.54"></a><span id="l90.54">       }</span>
<a href="#l90.55"></a><span id="l90.55"> </span>
<a href="#l90.56"></a><span id="l90.56">       if (originalMsgURI &amp;&amp; *originalMsgURI)</span>
<a href="#l90.57"></a><span id="l90.57">       {</span>
<a href="#l90.58"></a><span id="l90.58">         if (type == nsIMsgCompType::NewsPost)</span>
<a href="#l90.59"></a><span id="l90.59">         {</span>
<a href="#l90.60"></a><span id="l90.60" class="difflineminus">-          nsCAutoString newsURI(originalMsgURI);</span>
<a href="#l90.61"></a><span id="l90.61" class="difflineminus">-          nsCAutoString group;</span>
<a href="#l90.62"></a><span id="l90.62" class="difflineminus">-          nsCAutoString host;</span>
<a href="#l90.63"></a><span id="l90.63" class="difflineplus">+          nsAutoCString newsURI(originalMsgURI);</span>
<a href="#l90.64"></a><span id="l90.64" class="difflineplus">+          nsAutoCString group;</span>
<a href="#l90.65"></a><span id="l90.65" class="difflineplus">+          nsAutoCString host;</span>
<a href="#l90.66"></a><span id="l90.66"> </span>
<a href="#l90.67"></a><span id="l90.67">           int32_t slashpos = newsURI.RFindChar('/');</span>
<a href="#l90.68"></a><span id="l90.68">           if (slashpos &gt; 0 )</span>
<a href="#l90.69"></a><span id="l90.69">           {</span>
<a href="#l90.70"></a><span id="l90.70">             // uri is &quot;[s]news://host[:port]/group&quot;</span>
<a href="#l90.71"></a><span id="l90.71">             host = StringHead(newsURI, slashpos);</span>
<a href="#l90.72"></a><span id="l90.72">             group = Substring(newsURI, slashpos + 1);</span>
<a href="#l90.73"></a><span id="l90.73"> </span>
<a href="#l90.74"></a><span id="l90.74">           }</span>
<a href="#l90.75"></a><span id="l90.75">           else</span>
<a href="#l90.76"></a><span id="l90.76">             group = originalMsgURI;</span>
<a href="#l90.77"></a><span id="l90.77"> </span>
<a href="#l90.78"></a><span id="l90.78" class="difflineminus">-          nsCAutoString unescapedName;</span>
<a href="#l90.79"></a><span id="l90.79" class="difflineplus">+          nsAutoCString unescapedName;</span>
<a href="#l90.80"></a><span id="l90.80">           MsgUnescapeString(group,</span>
<a href="#l90.81"></a><span id="l90.81">                             nsINetUtil::ESCAPE_URL_FILE_BASENAME | nsINetUtil::ESCAPE_URL_FORCED,</span>
<a href="#l90.82"></a><span id="l90.82">                             unescapedName);</span>
<a href="#l90.83"></a><span id="l90.83">           pMsgCompFields-&gt;SetNewsgroups(NS_ConvertUTF8toUTF16(unescapedName));</span>
<a href="#l90.84"></a><span id="l90.84">           pMsgCompFields-&gt;SetNewshost(host.get());</span>
<a href="#l90.85"></a><span id="l90.85">         }</span>
<a href="#l90.86"></a><span id="l90.86">         else</span>
<a href="#l90.87"></a><span id="l90.87">         {</span>
<a href="#l90.88"></a><span id="l90.88" class="difflineat">@@ -1100,28 +1100,28 @@ NS_IMETHODIMP nsMsgComposeService::Reply</span>
<a href="#l90.89"></a><span id="l90.89"> </span>
<a href="#l90.90"></a><span id="l90.90">   nsCOMPtr &lt;nsIMsgFolder&gt; templateFolder;</span>
<a href="#l90.91"></a><span id="l90.91">   nsCOMPtr &lt;nsIMsgDatabase&gt; templateDB;</span>
<a href="#l90.92"></a><span id="l90.92">   nsCString templateMsgHdrUri;</span>
<a href="#l90.93"></a><span id="l90.93">   const char * query = PL_strstr(templateUri, &quot;?messageId=&quot;);</span>
<a href="#l90.94"></a><span id="l90.94">   if (!query)</span>
<a href="#l90.95"></a><span id="l90.95">     return NS_ERROR_FAILURE;</span>
<a href="#l90.96"></a><span id="l90.96"> </span>
<a href="#l90.97"></a><span id="l90.97" class="difflineminus">-  nsCAutoString folderUri(Substring(templateUri, query)); </span>
<a href="#l90.98"></a><span id="l90.98" class="difflineplus">+  nsAutoCString folderUri(Substring(templateUri, query)); </span>
<a href="#l90.99"></a><span id="l90.99">   nsresult rv = GetExistingFolder(folderUri, getter_AddRefs(templateFolder));</span>
<a href="#l90.100"></a><span id="l90.100">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l90.101"></a><span id="l90.101">   rv = templateFolder-&gt;GetMsgDatabase(getter_AddRefs(templateDB));</span>
<a href="#l90.102"></a><span id="l90.102">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l90.103"></a><span id="l90.103"> </span>
<a href="#l90.104"></a><span id="l90.104">   const char *subject = PL_strstr(templateUri, &quot;&amp;subject=&quot;);</span>
<a href="#l90.105"></a><span id="l90.105">   if (subject)</span>
<a href="#l90.106"></a><span id="l90.106">   {</span>
<a href="#l90.107"></a><span id="l90.107">     const char *subjectEnd = subject + strlen(subject);</span>
<a href="#l90.108"></a><span id="l90.108" class="difflineminus">-    nsCAutoString messageId(Substring(query + 11, subject));</span>
<a href="#l90.109"></a><span id="l90.109" class="difflineminus">-    nsCAutoString subjectString(Substring(subject + 9, subjectEnd));</span>
<a href="#l90.110"></a><span id="l90.110" class="difflineplus">+    nsAutoCString messageId(Substring(query + 11, subject));</span>
<a href="#l90.111"></a><span id="l90.111" class="difflineplus">+    nsAutoCString subjectString(Substring(subject + 9, subjectEnd));</span>
<a href="#l90.112"></a><span id="l90.112">     templateDB-&gt;GetMsgHdrForMessageID(messageId.get(), getter_AddRefs(helper-&gt;mTemplateHdr));</span>
<a href="#l90.113"></a><span id="l90.113">     if (helper-&gt;mTemplateHdr)</span>
<a href="#l90.114"></a><span id="l90.114">       templateFolder-&gt;GetUriForMsg(helper-&gt;mTemplateHdr, templateMsgHdrUri);</span>
<a href="#l90.115"></a><span id="l90.115">     // to use the subject, we'd need to expose a method to find a message by subject,</span>
<a href="#l90.116"></a><span id="l90.116">     // or painfully iterate through messages...We'll try to make the message-id</span>
<a href="#l90.117"></a><span id="l90.117">     // not change when saving a template first.</span>
<a href="#l90.118"></a><span id="l90.118">   }</span>
<a href="#l90.119"></a><span id="l90.119">   if (templateMsgHdrUri.IsEmpty())</span>
<a href="#l90.120"></a><span id="l90.120" class="difflineat">@@ -1365,17 +1365,17 @@ nsresult nsMsgComposeService::AddGlobalH</span>
<a href="#l90.121"></a><span id="l90.121">     if (NS_SUCCEEDED(rv) &amp;&amp; !globalHtmlDomainList.IsEmpty()) {</span>
<a href="#l90.122"></a><span id="l90.122">       nsTArray&lt;nsCString&gt; domainArray;</span>
<a href="#l90.123"></a><span id="l90.123"> </span>
<a href="#l90.124"></a><span id="l90.124">       // Get user's current HTML domain set for send format</span>
<a href="#l90.125"></a><span id="l90.125">       nsCString currentHtmlDomainList;</span>
<a href="#l90.126"></a><span id="l90.126">       rv = prefBranch-&gt;GetCharPref(USER_CURRENT_HTMLDOMAINLIST_PREF_NAME, getter_Copies(currentHtmlDomainList));</span>
<a href="#l90.127"></a><span id="l90.127">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l90.128"></a><span id="l90.128"> </span>
<a href="#l90.129"></a><span id="l90.129" class="difflineminus">-      nsCAutoString newHtmlDomainList(currentHtmlDomainList);</span>
<a href="#l90.130"></a><span id="l90.130" class="difflineplus">+      nsAutoCString newHtmlDomainList(currentHtmlDomainList);</span>
<a href="#l90.131"></a><span id="l90.131">       // Get the current html domain list into new list var</span>
<a href="#l90.132"></a><span id="l90.132">       ParseString(currentHtmlDomainList, DOMAIN_DELIMITER, domainArray);</span>
<a href="#l90.133"></a><span id="l90.133"> </span>
<a href="#l90.134"></a><span id="l90.134">       // Get user's current Plaintext domain set for send format</span>
<a href="#l90.135"></a><span id="l90.135">       nsCString currentPlaintextDomainList;</span>
<a href="#l90.136"></a><span id="l90.136">       rv = prefBranch-&gt;GetCharPref(USER_CURRENT_PLAINTEXTDOMAINLIST_PREF_NAME, getter_Copies(currentPlaintextDomainList));</span>
<a href="#l90.137"></a><span id="l90.137">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l90.138"></a><span id="l90.138"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -120,17 +120,17 @@ nsMsgQuote::QuoteMessage(const char *msg</span>
<a href="#l91.4"></a><span id="l91.4"> {</span>
<a href="#l91.5"></a><span id="l91.5">   nsresult  rv;</span>
<a href="#l91.6"></a><span id="l91.6">   if (!msgURI)</span>
<a href="#l91.7"></a><span id="l91.7">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l91.8"></a><span id="l91.8"> </span>
<a href="#l91.9"></a><span id="l91.9">   mQuoteHeaders = quoteHeaders;</span>
<a href="#l91.10"></a><span id="l91.10">   mStreamListener = aQuoteMsgStreamListener;</span>
<a href="#l91.11"></a><span id="l91.11"> </span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  nsCAutoString msgUri(msgURI);</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineplus">+  nsAutoCString msgUri(msgURI);</span>
<a href="#l91.14"></a><span id="l91.14">   bool fileUrl = !strncmp(msgURI, &quot;file:&quot;, 5);</span>
<a href="#l91.15"></a><span id="l91.15">   bool forwardedMessage = PL_strstr(msgURI, &quot;&amp;realtype=message/rfc822&quot;) != nullptr;</span>
<a href="#l91.16"></a><span id="l91.16">   nsCOMPtr&lt;nsIURI&gt; aURL;</span>
<a href="#l91.17"></a><span id="l91.17">   if (fileUrl)</span>
<a href="#l91.18"></a><span id="l91.18">   {</span>
<a href="#l91.19"></a><span id="l91.19">     msgUri.Replace(0, 5, NS_LITERAL_CSTRING(&quot;mailbox:&quot;));</span>
<a href="#l91.20"></a><span id="l91.20">     msgUri.AppendLiteral(&quot;?number=0&quot;);</span>
<a href="#l91.21"></a><span id="l91.21">     rv = NS_NewURI(getter_AddRefs(aURL), msgUri);</span>
<a href="#l91.22"></a><span id="l91.22" class="difflineat">@@ -147,17 +147,17 @@ nsMsgQuote::QuoteMessage(const char *msg</span>
<a href="#l91.23"></a><span id="l91.23">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l91.24"></a><span id="l91.24">     rv = msgService-&gt;GetUrlForUri(msgURI, getter_AddRefs(aURL), nullptr);</span>
<a href="#l91.25"></a><span id="l91.25">   }</span>
<a href="#l91.26"></a><span id="l91.26">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l91.27"></a><span id="l91.27"> </span>
<a href="#l91.28"></a><span id="l91.28">   nsCOMPtr &lt;nsIURL&gt; mailNewsUrl = do_QueryInterface(aURL, &amp;rv);</span>
<a href="#l91.29"></a><span id="l91.29">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l91.30"></a><span id="l91.30"> </span>
<a href="#l91.31"></a><span id="l91.31" class="difflineminus">-  nsCAutoString queryPart;</span>
<a href="#l91.32"></a><span id="l91.32" class="difflineplus">+  nsAutoCString queryPart;</span>
<a href="#l91.33"></a><span id="l91.33">   rv = mailNewsUrl-&gt;GetQuery(queryPart);</span>
<a href="#l91.34"></a><span id="l91.34">   if (!queryPart.IsEmpty())</span>
<a href="#l91.35"></a><span id="l91.35">     queryPart.Append('&amp;');</span>
<a href="#l91.36"></a><span id="l91.36"> </span>
<a href="#l91.37"></a><span id="l91.37">   if (headersOnly) /* We don't need to quote the message body but we still need to extract the headers */</span>
<a href="#l91.38"></a><span id="l91.38">     queryPart.Append(&quot;header=only&quot;);</span>
<a href="#l91.39"></a><span id="l91.39">   else if (quoteHeaders)</span>
<a href="#l91.40"></a><span id="l91.40">     queryPart.Append(&quot;header=quote&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -553,17 +553,17 @@ nsMsgComposeAndSend::GatherMimeAttachmen</span>
<a href="#l92.4"></a><span id="l92.4">     tempfile-&gt;Close();</span>
<a href="#l92.5"></a><span id="l92.5"> </span>
<a href="#l92.6"></a><span id="l92.6">     m_plaintext = new nsMsgAttachmentHandler;</span>
<a href="#l92.7"></a><span id="l92.7">     if (!m_plaintext)</span>
<a href="#l92.8"></a><span id="l92.8">       goto FAILMEM;</span>
<a href="#l92.9"></a><span id="l92.9">     m_plaintext-&gt;SetMimeDeliveryState(this);</span>
<a href="#l92.10"></a><span id="l92.10">     m_plaintext-&gt;m_bogus_attachment = true;</span>
<a href="#l92.11"></a><span id="l92.11"> </span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-    nsCAutoString tempURL;</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineplus">+    nsAutoCString tempURL;</span>
<a href="#l92.14"></a><span id="l92.14">     rv = NS_GetURLSpecFromFile(mHTMLFile, tempURL);</span>
<a href="#l92.15"></a><span id="l92.15">     if (NS_FAILED(rv) || NS_FAILED(nsMsgNewURL(getter_AddRefs(m_plaintext-&gt;mURL), tempURL.get())))</span>
<a href="#l92.16"></a><span id="l92.16">     {</span>
<a href="#l92.17"></a><span id="l92.17">       delete m_plaintext;</span>
<a href="#l92.18"></a><span id="l92.18">       m_plaintext = nullptr;</span>
<a href="#l92.19"></a><span id="l92.19">       goto FAILMEM;</span>
<a href="#l92.20"></a><span id="l92.20">     }</span>
<a href="#l92.21"></a><span id="l92.21"> </span>
<a href="#l92.22"></a><span id="l92.22" class="difflineat">@@ -1312,47 +1312,47 @@ nsMsgComposeAndSend::GetEmbeddedObjectIn</span>
<a href="#l92.23"></a><span id="l92.23">   nsCOMPtr&lt;nsIDOMHTMLAnchorElement&gt;   anchor = (do_QueryInterface(node));</span>
<a href="#l92.24"></a><span id="l92.24"> </span>
<a href="#l92.25"></a><span id="l92.25">   // First, try to see if the body as a background image</span>
<a href="#l92.26"></a><span id="l92.26">   if (body)</span>
<a href="#l92.27"></a><span id="l92.27">   {</span>
<a href="#l92.28"></a><span id="l92.28">     nsAutoString    tUrl;</span>
<a href="#l92.29"></a><span id="l92.29">     if (NS_SUCCEEDED(body-&gt;GetBackground(tUrl)))</span>
<a href="#l92.30"></a><span id="l92.30">     {</span>
<a href="#l92.31"></a><span id="l92.31" class="difflineminus">-      nsCAutoString turlC;</span>
<a href="#l92.32"></a><span id="l92.32" class="difflineplus">+      nsAutoCString turlC;</span>
<a href="#l92.33"></a><span id="l92.33">       CopyUTF16toUTF8(tUrl, turlC);</span>
<a href="#l92.34"></a><span id="l92.34">       if (NS_FAILED(nsMsgNewURL(getter_AddRefs(attachment-&gt;m_url), turlC.get())))</span>
<a href="#l92.35"></a><span id="l92.35">         return NS_OK;</span>
<a href="#l92.36"></a><span id="l92.36">      }</span>
<a href="#l92.37"></a><span id="l92.37">   }</span>
<a href="#l92.38"></a><span id="l92.38">   else if (image)        // Is this an image?</span>
<a href="#l92.39"></a><span id="l92.39">   {</span>
<a href="#l92.40"></a><span id="l92.40">     nsString    tUrl;</span>
<a href="#l92.41"></a><span id="l92.41">     nsString    tName;</span>
<a href="#l92.42"></a><span id="l92.42">     nsString    tDesc;</span>
<a href="#l92.43"></a><span id="l92.43"> </span>
<a href="#l92.44"></a><span id="l92.44">     // Create the URI</span>
<a href="#l92.45"></a><span id="l92.45">     if (NS_FAILED(image-&gt;GetSrc(tUrl)))</span>
<a href="#l92.46"></a><span id="l92.46">       return NS_ERROR_FAILURE;</span>
<a href="#l92.47"></a><span id="l92.47" class="difflineminus">-    nsCAutoString turlC;</span>
<a href="#l92.48"></a><span id="l92.48" class="difflineplus">+    nsAutoCString turlC;</span>
<a href="#l92.49"></a><span id="l92.49">     CopyUTF16toUTF8(tUrl, turlC);</span>
<a href="#l92.50"></a><span id="l92.50">     if (NS_FAILED(nsMsgNewURL(getter_AddRefs(attachment-&gt;m_url), turlC.get())))</span>
<a href="#l92.51"></a><span id="l92.51">     {</span>
<a href="#l92.52"></a><span id="l92.52">       // Well, the first time failed...which means we probably didn't get</span>
<a href="#l92.53"></a><span id="l92.53">       // the full path name...</span>
<a href="#l92.54"></a><span id="l92.54">       //</span>
<a href="#l92.55"></a><span id="l92.55">       nsIDOMDocument    *ownerDocument = nullptr;</span>
<a href="#l92.56"></a><span id="l92.56">       node-&gt;GetOwnerDocument(&amp;ownerDocument);</span>
<a href="#l92.57"></a><span id="l92.57">       if (ownerDocument)</span>
<a href="#l92.58"></a><span id="l92.58">       {</span>
<a href="#l92.59"></a><span id="l92.59">         nsIDocument     *doc = nullptr;</span>
<a href="#l92.60"></a><span id="l92.60">         if (NS_FAILED(ownerDocument-&gt;QueryInterface(NS_GET_IID(nsIDocument),(void**)&amp;doc)) || !doc)</span>
<a href="#l92.61"></a><span id="l92.61">           return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l92.62"></a><span id="l92.62"> </span>
<a href="#l92.63"></a><span id="l92.63" class="difflineminus">-        nsCAutoString spec;</span>
<a href="#l92.64"></a><span id="l92.64" class="difflineplus">+        nsAutoCString spec;</span>
<a href="#l92.65"></a><span id="l92.65">         nsIURI *uri = doc-&gt;GetDocumentURI();</span>
<a href="#l92.66"></a><span id="l92.66"> </span>
<a href="#l92.67"></a><span id="l92.67">         if (!uri)</span>
<a href="#l92.68"></a><span id="l92.68">           return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l92.69"></a><span id="l92.69"> </span>
<a href="#l92.70"></a><span id="l92.70">         uri-&gt;GetSpec(spec);</span>
<a href="#l92.71"></a><span id="l92.71"> </span>
<a href="#l92.72"></a><span id="l92.72">         // Ok, now get the path to the root doc and tack on the name we</span>
<a href="#l92.73"></a><span id="l92.73" class="difflineat">@@ -1380,30 +1380,30 @@ nsMsgComposeAndSend::GetEmbeddedObjectIn</span>
<a href="#l92.74"></a><span id="l92.74">   }</span>
<a href="#l92.75"></a><span id="l92.75">   else if (link)        // Is this a link?</span>
<a href="#l92.76"></a><span id="l92.76">   {</span>
<a href="#l92.77"></a><span id="l92.77">     nsString    tUrl;</span>
<a href="#l92.78"></a><span id="l92.78"> </span>
<a href="#l92.79"></a><span id="l92.79">     // Create the URI</span>
<a href="#l92.80"></a><span id="l92.80">     rv = link-&gt;GetHref(tUrl);</span>
<a href="#l92.81"></a><span id="l92.81">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l92.82"></a><span id="l92.82" class="difflineminus">-    nsCAutoString turlC;</span>
<a href="#l92.83"></a><span id="l92.83" class="difflineplus">+    nsAutoCString turlC;</span>
<a href="#l92.84"></a><span id="l92.84">     CopyUTF16toUTF8(tUrl, turlC);</span>
<a href="#l92.85"></a><span id="l92.85">     rv = nsMsgNewURL(getter_AddRefs(attachment-&gt;m_url), turlC.get());</span>
<a href="#l92.86"></a><span id="l92.86">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l92.87"></a><span id="l92.87">   }</span>
<a href="#l92.88"></a><span id="l92.88">   else if (anchor)</span>
<a href="#l92.89"></a><span id="l92.89">   {</span>
<a href="#l92.90"></a><span id="l92.90">     nsString    tUrl;</span>
<a href="#l92.91"></a><span id="l92.91">     nsString    tName;</span>
<a href="#l92.92"></a><span id="l92.92"> </span>
<a href="#l92.93"></a><span id="l92.93">     // Create the URI</span>
<a href="#l92.94"></a><span id="l92.94">     rv = anchor-&gt;GetHref(tUrl);</span>
<a href="#l92.95"></a><span id="l92.95">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l92.96"></a><span id="l92.96" class="difflineminus">-    nsCAutoString turlC;</span>
<a href="#l92.97"></a><span id="l92.97" class="difflineplus">+    nsAutoCString turlC;</span>
<a href="#l92.98"></a><span id="l92.98">     CopyUTF16toUTF8(tUrl, turlC);</span>
<a href="#l92.99"></a><span id="l92.99">     // ignore errors here.</span>
<a href="#l92.100"></a><span id="l92.100">     (void) nsMsgNewURL(getter_AddRefs(attachment-&gt;m_url), turlC.get());</span>
<a href="#l92.101"></a><span id="l92.101">     rv = anchor-&gt;GetName(tName);</span>
<a href="#l92.102"></a><span id="l92.102">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l92.103"></a><span id="l92.103">     LossyCopyUTF16toASCII(tName, attachment-&gt;m_realName);</span>
<a href="#l92.104"></a><span id="l92.104">   }</span>
<a href="#l92.105"></a><span id="l92.105">   else</span>
<a href="#l92.106"></a><span id="l92.106" class="difflineat">@@ -1435,17 +1435,17 @@ nsMsgComposeAndSend::GetEmbeddedObjectIn</span>
<a href="#l92.107"></a><span id="l92.107">         if (NS_FAILED(rv))</span>
<a href="#l92.108"></a><span id="l92.108">           isAValidFile = false;</span>
<a href="#l92.109"></a><span id="l92.109">         else</span>
<a href="#l92.110"></a><span id="l92.110">         {</span>
<a href="#l92.111"></a><span id="l92.111">           if (anchor)</span>
<a href="#l92.112"></a><span id="l92.112">           {</span>
<a href="#l92.113"></a><span id="l92.113">             // One more test, if the anchor points to a local network server, let's check what the pref</span>
<a href="#l92.114"></a><span id="l92.114">             // mail.compose.dont_attach_source_of_local_network_links tells us to do.</span>
<a href="#l92.115"></a><span id="l92.115" class="difflineminus">-            nsCAutoString urlSpec;</span>
<a href="#l92.116"></a><span id="l92.116" class="difflineplus">+            nsAutoCString urlSpec;</span>
<a href="#l92.117"></a><span id="l92.117">             rv = attachment-&gt;m_url-&gt;GetSpec(urlSpec);</span>
<a href="#l92.118"></a><span id="l92.118">             if (NS_SUCCEEDED(rv))</span>
<a href="#l92.119"></a><span id="l92.119">               if (StringBeginsWith(urlSpec, NS_LITERAL_CSTRING(&quot;file://///&quot;)))</span>
<a href="#l92.120"></a><span id="l92.120">               {</span>
<a href="#l92.121"></a><span id="l92.121">                 nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l92.122"></a><span id="l92.122">                 if (pPrefBranch)</span>
<a href="#l92.123"></a><span id="l92.123">                 {</span>
<a href="#l92.124"></a><span id="l92.124">                   bool dontSend = false;</span>
<a href="#l92.125"></a><span id="l92.125" class="difflineat">@@ -2201,41 +2201,41 @@ nsMsgComposeAndSend::AddCompFieldLocalAt</span>
<a href="#l92.126"></a><span id="l92.126">           {</span>
<a href="#l92.127"></a><span id="l92.127">             nsresult  rv = NS_OK;</span>
<a href="#l92.128"></a><span id="l92.128">             nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder (do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l92.129"></a><span id="l92.129">             if (NS_SUCCEEDED(rv) &amp;&amp; mimeFinder)</span>
<a href="#l92.130"></a><span id="l92.130">             {</span>
<a href="#l92.131"></a><span id="l92.131">               nsCOMPtr&lt;nsIURL&gt; fileUrl(do_CreateInstance(NS_STANDARDURL_CONTRACTID));</span>
<a href="#l92.132"></a><span id="l92.132">               if (fileUrl)</span>
<a href="#l92.133"></a><span id="l92.133">               {</span>
<a href="#l92.134"></a><span id="l92.134" class="difflineminus">-                nsCAutoString fileExt;</span>
<a href="#l92.135"></a><span id="l92.135" class="difflineplus">+                nsAutoCString fileExt;</span>
<a href="#l92.136"></a><span id="l92.136">                 //First try using the real file name</span>
<a href="#l92.137"></a><span id="l92.137">                 rv = fileUrl-&gt;SetFileName(m_attachments[newLoc].m_realName);</span>
<a href="#l92.138"></a><span id="l92.138">                 if (NS_SUCCEEDED(rv))</span>
<a href="#l92.139"></a><span id="l92.139">                 {</span>
<a href="#l92.140"></a><span id="l92.140">                   rv = fileUrl-&gt;GetFileExtension(fileExt);</span>
<a href="#l92.141"></a><span id="l92.141">                   if (NS_SUCCEEDED(rv) &amp;&amp; !fileExt.IsEmpty()) {</span>
<a href="#l92.142"></a><span id="l92.142" class="difflineminus">-                    nsCAutoString type;</span>
<a href="#l92.143"></a><span id="l92.143" class="difflineplus">+                    nsAutoCString type;</span>
<a href="#l92.144"></a><span id="l92.144">                     mimeFinder-&gt;GetTypeFromExtension(fileExt, type);</span>
<a href="#l92.145"></a><span id="l92.145">   #ifndef XP_MACOSX</span>
<a href="#l92.146"></a><span id="l92.146">                     if (!type.Equals(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l92.147"></a><span id="l92.147">   #endif</span>
<a href="#l92.148"></a><span id="l92.148">                     m_attachments[newLoc].m_type = type;</span>
<a href="#l92.149"></a><span id="l92.149">                   }</span>
<a href="#l92.150"></a><span id="l92.150">                 }</span>
<a href="#l92.151"></a><span id="l92.151"> </span>
<a href="#l92.152"></a><span id="l92.152">                 //Then try using the url if we still haven't figured out the content type</span>
<a href="#l92.153"></a><span id="l92.153">                 if (m_attachments[newLoc].m_type.IsEmpty())</span>
<a href="#l92.154"></a><span id="l92.154">                 {</span>
<a href="#l92.155"></a><span id="l92.155">                   rv = fileUrl-&gt;SetSpec(url);</span>
<a href="#l92.156"></a><span id="l92.156">                   if (NS_SUCCEEDED(rv))</span>
<a href="#l92.157"></a><span id="l92.157">                   {</span>
<a href="#l92.158"></a><span id="l92.158">                     rv = fileUrl-&gt;GetFileExtension(fileExt);</span>
<a href="#l92.159"></a><span id="l92.159">                     if (NS_SUCCEEDED(rv) &amp;&amp; !fileExt.IsEmpty()) {</span>
<a href="#l92.160"></a><span id="l92.160" class="difflineminus">-                      nsCAutoString type;</span>
<a href="#l92.161"></a><span id="l92.161" class="difflineplus">+                      nsAutoCString type;</span>
<a href="#l92.162"></a><span id="l92.162">                       mimeFinder-&gt;GetTypeFromExtension(fileExt, type);</span>
<a href="#l92.163"></a><span id="l92.163">   #ifndef XP_MACOSX</span>
<a href="#l92.164"></a><span id="l92.164">                     if (!type.Equals(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l92.165"></a><span id="l92.165">   #endif</span>
<a href="#l92.166"></a><span id="l92.166">                       m_attachments[newLoc].m_type = type;</span>
<a href="#l92.167"></a><span id="l92.167">                     // rtf and vcs files may look like text to sniffers,</span>
<a href="#l92.168"></a><span id="l92.168">                     // but they're not human readable.</span>
<a href="#l92.169"></a><span id="l92.169">                     if (type.IsEmpty() &amp;&amp; !fileExt.IsEmpty() &amp;&amp;</span>
<a href="#l92.170"></a><span id="l92.170" class="difflineat">@@ -2969,27 +2969,27 @@ nsMsgComposeAndSend::AddDefaultCustomHea</span>
<a href="#l92.171"></a><span id="l92.171">   nsCString headersList;</span>
<a href="#l92.172"></a><span id="l92.172">   // get names of prefs containing headers to add</span>
<a href="#l92.173"></a><span id="l92.173">   nsresult rv = mUserIdentity-&gt;GetCharAttribute(&quot;headers&quot;, headersList);</span>
<a href="#l92.174"></a><span id="l92.174">   if (NS_SUCCEEDED(rv) &amp;&amp; !headersList.IsEmpty()) {</span>
<a href="#l92.175"></a><span id="l92.175">     int32_t start = 0;</span>
<a href="#l92.176"></a><span id="l92.176">     int32_t end = 0;</span>
<a href="#l92.177"></a><span id="l92.177">     int32_t len = 0;</span>
<a href="#l92.178"></a><span id="l92.178">     // preserve any custom headers that have been added through the UI</span>
<a href="#l92.179"></a><span id="l92.179" class="difflineminus">-    nsCAutoString newHeaderVal(mCompFields-&gt;GetOtherRandomHeaders());</span>
<a href="#l92.180"></a><span id="l92.180" class="difflineplus">+    nsAutoCString newHeaderVal(mCompFields-&gt;GetOtherRandomHeaders());</span>
<a href="#l92.181"></a><span id="l92.181"> </span>
<a href="#l92.182"></a><span id="l92.182">     while (end != -1) {</span>
<a href="#l92.183"></a><span id="l92.183">       end = headersList.FindChar(',', start);</span>
<a href="#l92.184"></a><span id="l92.184">       if (end == -1) {</span>
<a href="#l92.185"></a><span id="l92.185">         len = headersList.Length() - start;</span>
<a href="#l92.186"></a><span id="l92.186">       } else {</span>
<a href="#l92.187"></a><span id="l92.187">         len = end - start;</span>
<a href="#l92.188"></a><span id="l92.188">       }</span>
<a href="#l92.189"></a><span id="l92.189">       // grab the name of the current header pref</span>
<a href="#l92.190"></a><span id="l92.190" class="difflineminus">-      nsCAutoString headerName(&quot;header.&quot;);</span>
<a href="#l92.191"></a><span id="l92.191" class="difflineplus">+      nsAutoCString headerName(&quot;header.&quot;);</span>
<a href="#l92.192"></a><span id="l92.192">       headerName.Append(Substring(headersList, start, len));</span>
<a href="#l92.193"></a><span id="l92.193">       start = end + 1;</span>
<a href="#l92.194"></a><span id="l92.194"> </span>
<a href="#l92.195"></a><span id="l92.195">       nsCString headerVal;</span>
<a href="#l92.196"></a><span id="l92.196">       rv = mUserIdentity-&gt;GetCharAttribute(headerName.get(), headerVal);</span>
<a href="#l92.197"></a><span id="l92.197">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l92.198"></a><span id="l92.198">         int32_t colonIdx = headerVal.FindChar(':') + 1;</span>
<a href="#l92.199"></a><span id="l92.199">         if (colonIdx != 0) { // check that the header is *most likely* valid.</span>
<a href="#l92.200"></a><span id="l92.200" class="difflineat">@@ -3025,26 +3025,26 @@ nsMsgComposeAndSend::AddMailFollowupToHe</span>
<a href="#l92.201"></a><span id="l92.201">   nsDependentCString customHeaders(mCompFields-&gt;GetOtherRandomHeaders());</span>
<a href="#l92.202"></a><span id="l92.202">   // ...and look for MFT-Header.  Stop here if MFT is already set.</span>
<a href="#l92.203"></a><span id="l92.203">   NS_NAMED_LITERAL_CSTRING(mftHeaderLabel, &quot;Mail-Followup-To: &quot;);</span>
<a href="#l92.204"></a><span id="l92.204">   if (StringBeginsWith(customHeaders, mftHeaderLabel) ||</span>
<a href="#l92.205"></a><span id="l92.205">       customHeaders.Find(&quot;\r\nMail-Followup-To: &quot;) != -1)</span>
<a href="#l92.206"></a><span id="l92.206">     return NS_OK;</span>
<a href="#l92.207"></a><span id="l92.207"> </span>
<a href="#l92.208"></a><span id="l92.208">   // Get list of subscribed mailing lists</span>
<a href="#l92.209"></a><span id="l92.209" class="difflineminus">-  nsCAutoString mailing_lists;</span>
<a href="#l92.210"></a><span id="l92.210" class="difflineplus">+  nsAutoCString mailing_lists;</span>
<a href="#l92.211"></a><span id="l92.211">   rv = mUserIdentity-&gt;GetCharAttribute(&quot;subscribed_mailing_lists&quot;, mailing_lists);</span>
<a href="#l92.212"></a><span id="l92.212">   // Stop here if this list is missing or empty</span>
<a href="#l92.213"></a><span id="l92.213">   if (NS_FAILED(rv) || mailing_lists.IsEmpty())</span>
<a href="#l92.214"></a><span id="l92.214">     return NS_OK;</span>
<a href="#l92.215"></a><span id="l92.215"> </span>
<a href="#l92.216"></a><span id="l92.216">   // Get a list of all recipients excluding bcc</span>
<a href="#l92.217"></a><span id="l92.217">   nsDependentCString to(mCompFields-&gt;GetTo());</span>
<a href="#l92.218"></a><span id="l92.218">   nsDependentCString cc(mCompFields-&gt;GetCc());</span>
<a href="#l92.219"></a><span id="l92.219" class="difflineminus">-  nsCAutoString recipients;</span>
<a href="#l92.220"></a><span id="l92.220" class="difflineplus">+  nsAutoCString recipients;</span>
<a href="#l92.221"></a><span id="l92.221"> </span>
<a href="#l92.222"></a><span id="l92.222">   if (to.IsEmpty() &amp;&amp; cc.IsEmpty())</span>
<a href="#l92.223"></a><span id="l92.223">     // We have bcc recipients only, so we don't add the Mail-Followup-To header</span>
<a href="#l92.224"></a><span id="l92.224">     return NS_OK;</span>
<a href="#l92.225"></a><span id="l92.225"> </span>
<a href="#l92.226"></a><span id="l92.226">   if (!to.IsEmpty() &amp;&amp; cc.IsEmpty())</span>
<a href="#l92.227"></a><span id="l92.227">     recipients = to;</span>
<a href="#l92.228"></a><span id="l92.228">   else if (to.IsEmpty() &amp;&amp; !cc.IsEmpty())</span>
<a href="#l92.229"></a><span id="l92.229" class="difflineat">@@ -3097,40 +3097,40 @@ nsMsgComposeAndSend::AddMailFollowupToHe</span>
<a href="#l92.230"></a><span id="l92.230"> nsresult</span>
<a href="#l92.231"></a><span id="l92.231"> nsMsgComposeAndSend::AddMailReplyToHeader() {</span>
<a href="#l92.232"></a><span id="l92.232">   nsresult rv;</span>
<a href="#l92.233"></a><span id="l92.233"> </span>
<a href="#l92.234"></a><span id="l92.234">   // Get OtherRandomHeaders...</span>
<a href="#l92.235"></a><span id="l92.235">   nsDependentCString customHeaders(mCompFields-&gt;GetOtherRandomHeaders());</span>
<a href="#l92.236"></a><span id="l92.236">   // ...and look for MRT-Header.  Stop here if MRT is already set.</span>
<a href="#l92.237"></a><span id="l92.237">   NS_NAMED_LITERAL_CSTRING(mrtHeaderLabel, &quot;Mail-Reply-To: &quot;);</span>
<a href="#l92.238"></a><span id="l92.238" class="difflineminus">-  nsCAutoString headers_match = nsCAutoString(&quot;\r\n&quot;);</span>
<a href="#l92.239"></a><span id="l92.239" class="difflineplus">+  nsAutoCString headers_match = nsAutoCString(&quot;\r\n&quot;);</span>
<a href="#l92.240"></a><span id="l92.240">   headers_match.Append(mrtHeaderLabel);</span>
<a href="#l92.241"></a><span id="l92.241">   if ((StringHead(customHeaders, mrtHeaderLabel.Length()) == mrtHeaderLabel) ||</span>
<a href="#l92.242"></a><span id="l92.242">       (customHeaders.Find(headers_match) != -1))</span>
<a href="#l92.243"></a><span id="l92.243">     return NS_OK;</span>
<a href="#l92.244"></a><span id="l92.244"> </span>
<a href="#l92.245"></a><span id="l92.245">   // Get list of reply-to mangling mailing lists</span>
<a href="#l92.246"></a><span id="l92.246" class="difflineminus">-  nsCAutoString mailing_lists;</span>
<a href="#l92.247"></a><span id="l92.247" class="difflineplus">+  nsAutoCString mailing_lists;</span>
<a href="#l92.248"></a><span id="l92.248">   rv = mUserIdentity-&gt;GetCharAttribute(&quot;replyto_mangling_mailing_lists&quot;, mailing_lists);</span>
<a href="#l92.249"></a><span id="l92.249">   // Stop here if this list is missing or empty</span>
<a href="#l92.250"></a><span id="l92.250">   if (NS_FAILED(rv) || mailing_lists.IsEmpty())</span>
<a href="#l92.251"></a><span id="l92.251">     return NS_OK;</span>
<a href="#l92.252"></a><span id="l92.252"> </span>
<a href="#l92.253"></a><span id="l92.253">   // MRT will be set if the recipients of the message contains at least one</span>
<a href="#l92.254"></a><span id="l92.254">   // of the addresses in mailing_lists or if mailing_lists has '*' as first</span>
<a href="#l92.255"></a><span id="l92.255">   // character.  The latter case gives the user an easy way to always set</span>
<a href="#l92.256"></a><span id="l92.256">   // the MRT header.  Notice that this behaviour wouldn't make sense for MFT</span>
<a href="#l92.257"></a><span id="l92.257">   // in AddMailFollowupToHeader() above.</span>
<a href="#l92.258"></a><span id="l92.258"> </span>
<a href="#l92.259"></a><span id="l92.259">   if (mailing_lists[0] != '*') {</span>
<a href="#l92.260"></a><span id="l92.260">     // Get a list of all recipients excluding bcc</span>
<a href="#l92.261"></a><span id="l92.261">     nsDependentCString to(mCompFields-&gt;GetTo());</span>
<a href="#l92.262"></a><span id="l92.262">     nsDependentCString cc(mCompFields-&gt;GetCc());</span>
<a href="#l92.263"></a><span id="l92.263" class="difflineminus">-    nsCAutoString recipients;</span>
<a href="#l92.264"></a><span id="l92.264" class="difflineplus">+    nsAutoCString recipients;</span>
<a href="#l92.265"></a><span id="l92.265"> </span>
<a href="#l92.266"></a><span id="l92.266">     if (to.IsEmpty() &amp;&amp; cc.IsEmpty())</span>
<a href="#l92.267"></a><span id="l92.267">       // We have bcc recipients only, so we don't add the Mail-Reply-To header</span>
<a href="#l92.268"></a><span id="l92.268">       return NS_OK;</span>
<a href="#l92.269"></a><span id="l92.269"> </span>
<a href="#l92.270"></a><span id="l92.270">     if (!to.IsEmpty() &amp;&amp; cc.IsEmpty())</span>
<a href="#l92.271"></a><span id="l92.271">       recipients = to;</span>
<a href="#l92.272"></a><span id="l92.272">     else if (to.IsEmpty() &amp;&amp; !cc.IsEmpty())</span>
<a href="#l92.273"></a><span id="l92.273" class="difflineat">@@ -3162,17 +3162,17 @@ nsMsgComposeAndSend::AddMailReplyToHeade</span>
<a href="#l92.274"></a><span id="l92.274"> </span>
<a href="#l92.275"></a><span id="l92.275">     // ... If the result is equal to the input, none of the recipients</span>
<a href="#l92.276"></a><span id="l92.276">     // occure in the MRT addresses and therefore we stop here.</span>
<a href="#l92.277"></a><span id="l92.277">     if (recipients_no_dups == recipients_without_mailing_lists)</span>
<a href="#l92.278"></a><span id="l92.278">       return NS_OK;</span>
<a href="#l92.279"></a><span id="l92.279">   }</span>
<a href="#l92.280"></a><span id="l92.280"> </span>
<a href="#l92.281"></a><span id="l92.281">   // Set Mail-Reply-To</span>
<a href="#l92.282"></a><span id="l92.282" class="difflineminus">-  nsCAutoString replyTo, mailReplyTo;</span>
<a href="#l92.283"></a><span id="l92.283" class="difflineplus">+  nsAutoCString replyTo, mailReplyTo;</span>
<a href="#l92.284"></a><span id="l92.284">   replyTo = mCompFields-&gt;GetReplyTo();</span>
<a href="#l92.285"></a><span id="l92.285">   if (replyTo.IsEmpty())</span>
<a href="#l92.286"></a><span id="l92.286">     mailReplyTo = mCompFields-&gt;GetFrom();</span>
<a href="#l92.287"></a><span id="l92.287">   else</span>
<a href="#l92.288"></a><span id="l92.288">     mailReplyTo = replyTo;</span>
<a href="#l92.289"></a><span id="l92.289">   char * mimeHeader = nsMsgI18NEncodeMimePartIIStr(mailReplyTo.get(), true,</span>
<a href="#l92.290"></a><span id="l92.290">     mCompFields-&gt;GetCharacterSet(), mrtHeaderLabel.Length(), true);</span>
<a href="#l92.291"></a><span id="l92.291">   if (!mimeHeader)</span>
<a href="#l92.292"></a><span id="l92.292" class="difflineat">@@ -3183,17 +3183,17 @@ nsMsgComposeAndSend::AddMailReplyToHeade</span>
<a href="#l92.293"></a><span id="l92.293">   customHeaders.AppendLiteral(&quot;\r\n&quot;);</span>
<a href="#l92.294"></a><span id="l92.294">   mCompFields-&gt;SetOtherRandomHeaders(customHeaders.get());</span>
<a href="#l92.295"></a><span id="l92.295">   PR_Free(mimeHeader);</span>
<a href="#l92.296"></a><span id="l92.296">   return NS_OK;</span>
<a href="#l92.297"></a><span id="l92.297"> }</span>
<a href="#l92.298"></a><span id="l92.298"> </span>
<a href="#l92.299"></a><span id="l92.299"> nsresult</span>
<a href="#l92.300"></a><span id="l92.300"> nsMsgComposeAndSend::AddXForwardedMessageIdHeader() {</span>
<a href="#l92.301"></a><span id="l92.301" class="difflineminus">-  nsCAutoString otherHeaders;</span>
<a href="#l92.302"></a><span id="l92.302" class="difflineplus">+  nsAutoCString otherHeaders;</span>
<a href="#l92.303"></a><span id="l92.303">   otherHeaders.Append(nsDependentCString(mCompFields-&gt;GetOtherRandomHeaders()));</span>
<a href="#l92.304"></a><span id="l92.304">   otherHeaders.Append(NS_LITERAL_CSTRING(&quot;X-Forwarded-Message-Id: &quot;));</span>
<a href="#l92.305"></a><span id="l92.305">   otherHeaders.Append(nsDependentCString(mCompFields-&gt;GetReferences()));</span>
<a href="#l92.306"></a><span id="l92.306">   otherHeaders.Append(NS_LITERAL_CSTRING(&quot;\r\n&quot;));</span>
<a href="#l92.307"></a><span id="l92.307">   return mCompFields-&gt;SetOtherRandomHeaders(otherHeaders.get());</span>
<a href="#l92.308"></a><span id="l92.308"> }</span>
<a href="#l92.309"></a><span id="l92.309"> </span>
<a href="#l92.310"></a><span id="l92.310"> nsresult</span>
<a href="#l92.311"></a><span id="l92.311" class="difflineat">@@ -4335,17 +4335,17 @@ BuildURLAttachmentData(nsIURI *url)</span>
<a href="#l92.312"></a><span id="l92.312">   if (!url)</span>
<a href="#l92.313"></a><span id="l92.313">     return nullptr;</span>
<a href="#l92.314"></a><span id="l92.314"> </span>
<a href="#l92.315"></a><span id="l92.315">   attachments = new nsMsgAttachmentData[attachCount];</span>
<a href="#l92.316"></a><span id="l92.316">   if (!attachments)</span>
<a href="#l92.317"></a><span id="l92.317">     return nullptr;</span>
<a href="#l92.318"></a><span id="l92.318"> </span>
<a href="#l92.319"></a><span id="l92.319">   // Now get a readable name...</span>
<a href="#l92.320"></a><span id="l92.320" class="difflineminus">-  nsCAutoString spec;</span>
<a href="#l92.321"></a><span id="l92.321" class="difflineplus">+  nsAutoCString spec;</span>
<a href="#l92.322"></a><span id="l92.322">   url-&gt;GetSpec(spec);</span>
<a href="#l92.323"></a><span id="l92.323">   if (!spec.IsEmpty())</span>
<a href="#l92.324"></a><span id="l92.324">   {</span>
<a href="#l92.325"></a><span id="l92.325">     theName = strrchr(spec.get(), '/');</span>
<a href="#l92.326"></a><span id="l92.326">   }</span>
<a href="#l92.327"></a><span id="l92.327"> </span>
<a href="#l92.328"></a><span id="l92.328">   if (!theName)</span>
<a href="#l92.329"></a><span id="l92.329">     theName = &quot;Unknown&quot;; // Don't I18N this string...should never happen...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -279,17 +279,17 @@ void nsSmtpProtocol::Initialize(nsIURI *</span>
<a href="#l93.4"></a><span id="l93.4">     if (smtpServer) {</span>
<a href="#l93.5"></a><span id="l93.5">         smtpServer-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l93.6"></a><span id="l93.6">         smtpServer-&gt;GetSocketType(&amp;m_prefSocketType);</span>
<a href="#l93.7"></a><span id="l93.7">         smtpServer-&gt;GetHelloArgument(getter_Copies(m_helloArgument));</span>
<a href="#l93.8"></a><span id="l93.8">     }</span>
<a href="#l93.9"></a><span id="l93.9">     InitPrefAuthMethods(authMethod);</span>
<a href="#l93.10"></a><span id="l93.10"> </span>
<a href="#l93.11"></a><span id="l93.11"> #if defined(PR_LOGGING)</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-    nsCAutoString hostName;</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+    nsAutoCString hostName;</span>
<a href="#l93.14"></a><span id="l93.14">     aURL-&gt;GetAsciiHost(hostName);</span>
<a href="#l93.15"></a><span id="l93.15">     PR_LOG(SMTPLogModule, PR_LOG_ALWAYS, (&quot;SMTP Connecting to: %s&quot;, hostName.get()));</span>
<a href="#l93.16"></a><span id="l93.16"> #endif</span>
<a href="#l93.17"></a><span id="l93.17"> </span>
<a href="#l93.18"></a><span id="l93.18">     // When we are making a secure connection, we need to make sure that we</span>
<a href="#l93.19"></a><span id="l93.19">     // pass an interface requestor down to the socket transport so that PSM can</span>
<a href="#l93.20"></a><span id="l93.20">     // retrieve a nsIPrompt instance if needed.</span>
<a href="#l93.21"></a><span id="l93.21">     nsCOMPtr&lt;nsIInterfaceRequestor&gt; callbacks;</span>
<a href="#l93.22"></a><span id="l93.22" class="difflineat">@@ -524,33 +524,33 @@ nsresult nsSmtpProtocol::ExtensionLoginR</span>
<a href="#l93.23"></a><span id="l93.23">     nsExplainErrorDetails(m_runningURL, NS_ERROR_SMTP_GREETING,</span>
<a href="#l93.24"></a><span id="l93.24">                           m_responseText.get());</span>
<a href="#l93.25"></a><span id="l93.25">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to explain SMTP error&quot;);</span>
<a href="#l93.26"></a><span id="l93.26"> </span>
<a href="#l93.27"></a><span id="l93.27">     m_urlErrorState = NS_ERROR_BUT_DONT_SHOW_ALERT;</span>
<a href="#l93.28"></a><span id="l93.28">     return NS_ERROR_SMTP_AUTH_FAILURE;</span>
<a href="#l93.29"></a><span id="l93.29">   }</span>
<a href="#l93.30"></a><span id="l93.30"> </span>
<a href="#l93.31"></a><span id="l93.31" class="difflineminus">-  nsCAutoString buffer(&quot;EHLO &quot;);</span>
<a href="#l93.32"></a><span id="l93.32" class="difflineplus">+  nsAutoCString buffer(&quot;EHLO &quot;);</span>
<a href="#l93.33"></a><span id="l93.33">   AppendHelloArgument(buffer);</span>
<a href="#l93.34"></a><span id="l93.34">   buffer += CRLF;</span>
<a href="#l93.35"></a><span id="l93.35"> </span>
<a href="#l93.36"></a><span id="l93.36">   status = SendData(buffer.get());</span>
<a href="#l93.37"></a><span id="l93.37"> </span>
<a href="#l93.38"></a><span id="l93.38">   m_nextState = SMTP_RESPONSE;</span>
<a href="#l93.39"></a><span id="l93.39">   m_nextStateAfterResponse = SMTP_SEND_EHLO_RESPONSE;</span>
<a href="#l93.40"></a><span id="l93.40">   SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l93.41"></a><span id="l93.41"> </span>
<a href="#l93.42"></a><span id="l93.42">   return(status);</span>
<a href="#l93.43"></a><span id="l93.43"> }</span>
<a href="#l93.44"></a><span id="l93.44"> </span>
<a href="#l93.45"></a><span id="l93.45"> nsresult nsSmtpProtocol::SendHeloResponse(nsIInputStream * inputStream, uint32_t length)</span>
<a href="#l93.46"></a><span id="l93.46"> {</span>
<a href="#l93.47"></a><span id="l93.47">   nsresult status = NS_OK;</span>
<a href="#l93.48"></a><span id="l93.48" class="difflineminus">-  nsCAutoString buffer;</span>
<a href="#l93.49"></a><span id="l93.49" class="difflineplus">+  nsAutoCString buffer;</span>
<a href="#l93.50"></a><span id="l93.50">   nsresult rv;</span>
<a href="#l93.51"></a><span id="l93.51"> </span>
<a href="#l93.52"></a><span id="l93.52">   if (m_responseCode != 250)</span>
<a href="#l93.53"></a><span id="l93.53">   {</span>
<a href="#l93.54"></a><span id="l93.54"> #ifdef DEBUG</span>
<a href="#l93.55"></a><span id="l93.55">     rv =</span>
<a href="#l93.56"></a><span id="l93.56"> #endif</span>
<a href="#l93.57"></a><span id="l93.57">     nsExplainErrorDetails(m_runningURL, NS_ERROR_SMTP_SERVER_ERROR,</span>
<a href="#l93.58"></a><span id="l93.58" class="difflineat">@@ -669,17 +669,17 @@ nsresult nsSmtpProtocol::SendEhloRespons</span>
<a href="#l93.59"></a><span id="l93.59">             if (m_prefSocketType == nsMsgSocketType::alwaysSTARTTLS &amp;&amp;</span>
<a href="#l93.60"></a><span id="l93.60">                 !m_tlsEnabled)</span>
<a href="#l93.61"></a><span id="l93.61">             {</span>
<a href="#l93.62"></a><span id="l93.62">                 m_nextState = SMTP_ERROR_DONE;</span>
<a href="#l93.63"></a><span id="l93.63">                 m_urlErrorState = NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS;</span>
<a href="#l93.64"></a><span id="l93.64">                 return(NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS);</span>
<a href="#l93.65"></a><span id="l93.65">             }</span>
<a href="#l93.66"></a><span id="l93.66"> </span>
<a href="#l93.67"></a><span id="l93.67" class="difflineminus">-            nsCAutoString buffer(&quot;HELO &quot;);</span>
<a href="#l93.68"></a><span id="l93.68" class="difflineplus">+            nsAutoCString buffer(&quot;HELO &quot;);</span>
<a href="#l93.69"></a><span id="l93.69">             AppendHelloArgument(buffer);</span>
<a href="#l93.70"></a><span id="l93.70">             buffer += CRLF;</span>
<a href="#l93.71"></a><span id="l93.71"> </span>
<a href="#l93.72"></a><span id="l93.72">             status = SendData(buffer.get());</span>
<a href="#l93.73"></a><span id="l93.73"> </span>
<a href="#l93.74"></a><span id="l93.74">             m_nextState = SMTP_RESPONSE;</span>
<a href="#l93.75"></a><span id="l93.75">             m_nextStateAfterResponse = SMTP_SEND_HELO_RESPONSE;</span>
<a href="#l93.76"></a><span id="l93.76">             SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l93.77"></a><span id="l93.77" class="difflineat">@@ -703,17 +703,17 @@ nsresult nsSmtpProtocol::SendEhloRespons</span>
<a href="#l93.78"></a><span id="l93.78">     }</span>
<a href="#l93.79"></a><span id="l93.79"> </span>
<a href="#l93.80"></a><span id="l93.80">     int32_t responseLength = m_responseText.Length();</span>
<a href="#l93.81"></a><span id="l93.81">     int32_t startPos = 0;</span>
<a href="#l93.82"></a><span id="l93.82">     int32_t endPos;</span>
<a href="#l93.83"></a><span id="l93.83">     do</span>
<a href="#l93.84"></a><span id="l93.84">     {</span>
<a href="#l93.85"></a><span id="l93.85">         endPos = m_responseText.FindChar('\n', startPos + 1);</span>
<a href="#l93.86"></a><span id="l93.86" class="difflineminus">-        nsCAutoString responseLine;</span>
<a href="#l93.87"></a><span id="l93.87" class="difflineplus">+        nsAutoCString responseLine;</span>
<a href="#l93.88"></a><span id="l93.88">         responseLine.Assign(Substring(m_responseText, startPos,</span>
<a href="#l93.89"></a><span id="l93.89">             (endPos &gt;= 0 ? endPos : responseLength) - startPos));</span>
<a href="#l93.90"></a><span id="l93.90"> </span>
<a href="#l93.91"></a><span id="l93.91">         MsgCompressWhitespace(responseLine);</span>
<a href="#l93.92"></a><span id="l93.92">         if (responseLine.LowerCaseEqualsLiteral(&quot;starttls&quot;))</span>
<a href="#l93.93"></a><span id="l93.93">         {</span>
<a href="#l93.94"></a><span id="l93.94">             SetFlag(SMTP_EHLO_STARTTLS_ENABLED);</span>
<a href="#l93.95"></a><span id="l93.95">         }</span>
<a href="#l93.96"></a><span id="l93.96" class="difflineat">@@ -922,17 +922,17 @@ void nsSmtpProtocol::ResetAuthMethods()</span>
<a href="#l93.97"></a><span id="l93.97"> {</span>
<a href="#l93.98"></a><span id="l93.98">   m_currentAuthMethod = 0;</span>
<a href="#l93.99"></a><span id="l93.99">   m_failedAuthMethods = 0;</span>
<a href="#l93.100"></a><span id="l93.100"> }</span>
<a href="#l93.101"></a><span id="l93.101"> </span>
<a href="#l93.102"></a><span id="l93.102"> nsresult nsSmtpProtocol::ProcessAuth()</span>
<a href="#l93.103"></a><span id="l93.103"> {</span>
<a href="#l93.104"></a><span id="l93.104">     nsresult status = NS_OK;</span>
<a href="#l93.105"></a><span id="l93.105" class="difflineminus">-    nsCAutoString buffer;</span>
<a href="#l93.106"></a><span id="l93.106" class="difflineplus">+    nsAutoCString buffer;</span>
<a href="#l93.107"></a><span id="l93.107"> </span>
<a href="#l93.108"></a><span id="l93.108">     if (!m_tlsEnabled)</span>
<a href="#l93.109"></a><span id="l93.109">     {</span>
<a href="#l93.110"></a><span id="l93.110">         if (TestFlag(SMTP_EHLO_STARTTLS_ENABLED))</span>
<a href="#l93.111"></a><span id="l93.111">         {</span>
<a href="#l93.112"></a><span id="l93.112">             // Do not try to combine SMTPS with STARTTLS.</span>
<a href="#l93.113"></a><span id="l93.113">             // If nsMsgSocketType::SSL is set,</span>
<a href="#l93.114"></a><span id="l93.114">             // we are alrady using a secure connection.</span>
<a href="#l93.115"></a><span id="l93.115" class="difflineat">@@ -1143,19 +1143,19 @@ nsresult nsSmtpProtocol::AuthLoginRespon</span>
<a href="#l93.116"></a><span id="l93.116">   }</span>
<a href="#l93.117"></a><span id="l93.117"> </span>
<a href="#l93.118"></a><span id="l93.118">   return (status);</span>
<a href="#l93.119"></a><span id="l93.119"> }</span>
<a href="#l93.120"></a><span id="l93.120"> </span>
<a href="#l93.121"></a><span id="l93.121"> nsresult nsSmtpProtocol::AuthGSSAPIFirst()</span>
<a href="#l93.122"></a><span id="l93.122"> {</span>
<a href="#l93.123"></a><span id="l93.123">   NS_ASSERTION(m_currentAuthMethod == SMTP_AUTH_GSSAPI_ENABLED, &quot;called in invalid state&quot;);</span>
<a href="#l93.124"></a><span id="l93.124" class="difflineminus">-  nsCAutoString command(&quot;AUTH GSSAPI &quot;);</span>
<a href="#l93.125"></a><span id="l93.125" class="difflineminus">-  nsCAutoString resp;</span>
<a href="#l93.126"></a><span id="l93.126" class="difflineminus">-  nsCAutoString service(&quot;smtp@&quot;);</span>
<a href="#l93.127"></a><span id="l93.127" class="difflineplus">+  nsAutoCString command(&quot;AUTH GSSAPI &quot;);</span>
<a href="#l93.128"></a><span id="l93.128" class="difflineplus">+  nsAutoCString resp;</span>
<a href="#l93.129"></a><span id="l93.129" class="difflineplus">+  nsAutoCString service(&quot;smtp@&quot;);</span>
<a href="#l93.130"></a><span id="l93.130">   nsCString hostName;</span>
<a href="#l93.131"></a><span id="l93.131">   nsCString userName;</span>
<a href="#l93.132"></a><span id="l93.132">   nsresult rv;</span>
<a href="#l93.133"></a><span id="l93.133">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l93.134"></a><span id="l93.134">   rv = m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l93.135"></a><span id="l93.135">   if (NS_FAILED(rv))</span>
<a href="#l93.136"></a><span id="l93.136">     return NS_ERROR_FAILURE;</span>
<a href="#l93.137"></a><span id="l93.137"> </span>
<a href="#l93.138"></a><span id="l93.138" class="difflineat">@@ -1189,17 +1189,17 @@ nsresult nsSmtpProtocol::AuthGSSAPIFirst</span>
<a href="#l93.139"></a><span id="l93.139"> </span>
<a href="#l93.140"></a><span id="l93.140"> // GSSAPI may consist of multiple round trips</span>
<a href="#l93.141"></a><span id="l93.141"> </span>
<a href="#l93.142"></a><span id="l93.142"> nsresult nsSmtpProtocol::AuthGSSAPIStep()</span>
<a href="#l93.143"></a><span id="l93.143"> {</span>
<a href="#l93.144"></a><span id="l93.144">   PR_LOG(SMTPLogModule, PR_LOG_DEBUG, (&quot;SMTP: GSSAPI auth step 2&quot;));</span>
<a href="#l93.145"></a><span id="l93.145">   NS_ASSERTION(m_currentAuthMethod == SMTP_AUTH_GSSAPI_ENABLED, &quot;called in invalid state&quot;);</span>
<a href="#l93.146"></a><span id="l93.146">   nsresult rv;</span>
<a href="#l93.147"></a><span id="l93.147" class="difflineminus">-  nsCAutoString cmd;</span>
<a href="#l93.148"></a><span id="l93.148" class="difflineplus">+  nsAutoCString cmd;</span>
<a href="#l93.149"></a><span id="l93.149"> </span>
<a href="#l93.150"></a><span id="l93.150">   // Check to see what the server said</span>
<a href="#l93.151"></a><span id="l93.151">   if (m_responseCode / 100 != 3) {</span>
<a href="#l93.152"></a><span id="l93.152">     m_nextState = SMTP_AUTH_LOGIN_RESPONSE;</span>
<a href="#l93.153"></a><span id="l93.153">     return NS_OK;</span>
<a href="#l93.154"></a><span id="l93.154">   }</span>
<a href="#l93.155"></a><span id="l93.155"> </span>
<a href="#l93.156"></a><span id="l93.156">   rv = DoGSSAPIStep2(m_responseText, cmd);</span>
<a href="#l93.157"></a><span id="l93.157" class="difflineat">@@ -1220,17 +1220,17 @@ nsresult nsSmtpProtocol::AuthGSSAPIStep(</span>
<a href="#l93.158"></a><span id="l93.158"> // PLAIN or CRAM-MD5, so we've to start here and continue with AuthStep1</span>
<a href="#l93.159"></a><span id="l93.159"> // if the server responds with with a 3xx code to &quot;AUTH LOGIN&quot; or &quot;AUTH MSN&quot;</span>
<a href="#l93.160"></a><span id="l93.160"> nsresult nsSmtpProtocol::AuthLoginStep0()</span>
<a href="#l93.161"></a><span id="l93.161"> {</span>
<a href="#l93.162"></a><span id="l93.162">     NS_ASSERTION(m_currentAuthMethod == SMTP_AUTH_MSN_ENABLED ||</span>
<a href="#l93.163"></a><span id="l93.163">         m_currentAuthMethod == SMTP_AUTH_LOGIN_ENABLED,</span>
<a href="#l93.164"></a><span id="l93.164">         &quot;called in invalid state&quot;);</span>
<a href="#l93.165"></a><span id="l93.165">     PR_LOG(SMTPLogModule, PR_LOG_DEBUG, (&quot;SMTP: MSN or LOGIN auth, step 0&quot;));</span>
<a href="#l93.166"></a><span id="l93.166" class="difflineminus">-    nsCAutoString command(m_currentAuthMethod == SMTP_AUTH_MSN_ENABLED</span>
<a href="#l93.167"></a><span id="l93.167" class="difflineplus">+    nsAutoCString command(m_currentAuthMethod == SMTP_AUTH_MSN_ENABLED</span>
<a href="#l93.168"></a><span id="l93.168">         ? &quot;AUTH MSN&quot; CRLF : &quot;AUTH LOGIN&quot; CRLF);</span>
<a href="#l93.169"></a><span id="l93.169">     m_nextState = SMTP_RESPONSE;</span>
<a href="#l93.170"></a><span id="l93.170">     m_nextStateAfterResponse = SMTP_AUTH_LOGIN_STEP0_RESPONSE;</span>
<a href="#l93.171"></a><span id="l93.171">     SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l93.172"></a><span id="l93.172"> </span>
<a href="#l93.173"></a><span id="l93.173">     return SendData(command.get());</span>
<a href="#l93.174"></a><span id="l93.174"> }</span>
<a href="#l93.175"></a><span id="l93.175"> </span>
<a href="#l93.176"></a><span id="l93.176" class="difflineat">@@ -1242,22 +1242,22 @@ void nsSmtpProtocol::AuthLoginStep0Respo</span>
<a href="#l93.177"></a><span id="l93.177">     // need the test to be here instead in AuthLoginResponse() to</span>
<a href="#l93.178"></a><span id="l93.178">     // continue with step 1 instead of 2 in case of a code 3xx</span>
<a href="#l93.179"></a><span id="l93.179">     m_nextState = (m_responseCode/100 == 3) ?</span>
<a href="#l93.180"></a><span id="l93.180">                   SMTP_SEND_AUTH_LOGIN_STEP1 : SMTP_AUTH_LOGIN_RESPONSE;</span>
<a href="#l93.181"></a><span id="l93.181"> }</span>
<a href="#l93.182"></a><span id="l93.182"> </span>
<a href="#l93.183"></a><span id="l93.183"> nsresult nsSmtpProtocol::AuthLoginStep1()</span>
<a href="#l93.184"></a><span id="l93.184"> {</span>
<a href="#l93.185"></a><span id="l93.185" class="difflineminus">-  char buffer[512]; // TODO nsCAutoString</span>
<a href="#l93.186"></a><span id="l93.186" class="difflineplus">+  char buffer[512]; // TODO nsAutoCString</span>
<a href="#l93.187"></a><span id="l93.187">   nsresult rv;</span>
<a href="#l93.188"></a><span id="l93.188">   nsresult status = NS_OK;</span>
<a href="#l93.189"></a><span id="l93.189">   nsCString username;</span>
<a href="#l93.190"></a><span id="l93.190">   char *base64Str = nullptr;</span>
<a href="#l93.191"></a><span id="l93.191" class="difflineminus">-  nsCAutoString password;</span>
<a href="#l93.192"></a><span id="l93.192" class="difflineplus">+  nsAutoCString password;</span>
<a href="#l93.193"></a><span id="l93.193">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l93.194"></a><span id="l93.194">   rv = m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l93.195"></a><span id="l93.195">   if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l93.196"></a><span id="l93.196"> </span>
<a href="#l93.197"></a><span id="l93.197">   rv = smtpServer-&gt;GetUsername(username);</span>
<a href="#l93.198"></a><span id="l93.198">   if (username.IsEmpty())</span>
<a href="#l93.199"></a><span id="l93.199">   {</span>
<a href="#l93.200"></a><span id="l93.200">     rv = GetUsernamePassword(username, password);</span>
<a href="#l93.201"></a><span id="l93.201" class="difflineat">@@ -1280,17 +1280,17 @@ nsresult nsSmtpProtocol::AuthLoginStep1(</span>
<a href="#l93.202"></a><span id="l93.202">   {</span>
<a href="#l93.203"></a><span id="l93.203">     PR_LOG(SMTPLogModule, PR_LOG_ERROR, (&quot;CRAM auth, step 1&quot;));</span>
<a href="#l93.204"></a><span id="l93.204">     PR_snprintf(buffer, sizeof(buffer), &quot;AUTH CRAM-MD5&quot; CRLF);</span>
<a href="#l93.205"></a><span id="l93.205">   }</span>
<a href="#l93.206"></a><span id="l93.206">   else if (m_currentAuthMethod == SMTP_AUTH_NTLM_ENABLED ||</span>
<a href="#l93.207"></a><span id="l93.207">            m_currentAuthMethod == SMTP_AUTH_MSN_ENABLED)</span>
<a href="#l93.208"></a><span id="l93.208">   {</span>
<a href="#l93.209"></a><span id="l93.209">     PR_LOG(SMTPLogModule, PR_LOG_DEBUG, (&quot;NTLM/MSN auth, step 1&quot;));</span>
<a href="#l93.210"></a><span id="l93.210" class="difflineminus">-    nsCAutoString response;</span>
<a href="#l93.211"></a><span id="l93.211" class="difflineplus">+    nsAutoCString response;</span>
<a href="#l93.212"></a><span id="l93.212">     rv = DoNtlmStep1(username.get(), password.get(), response);</span>
<a href="#l93.213"></a><span id="l93.213">     PR_snprintf(buffer, sizeof(buffer), TestFlag(SMTP_AUTH_NTLM_ENABLED) ?</span>
<a href="#l93.214"></a><span id="l93.214">                                         &quot;AUTH NTLM %.256s&quot; CRLF :</span>
<a href="#l93.215"></a><span id="l93.215">                                         &quot;%.256s&quot; CRLF, response.get());</span>
<a href="#l93.216"></a><span id="l93.216">   }</span>
<a href="#l93.217"></a><span id="l93.217">   else if (m_currentAuthMethod == SMTP_AUTH_PLAIN_ENABLED)</span>
<a href="#l93.218"></a><span id="l93.218">   {</span>
<a href="#l93.219"></a><span id="l93.219">     PR_LOG(SMTPLogModule, PR_LOG_DEBUG, (&quot;PLAIN auth&quot;));</span>
<a href="#l93.220"></a><span id="l93.220" class="difflineat">@@ -1330,17 +1330,17 @@ nsresult nsSmtpProtocol::AuthLoginStep2(</span>
<a href="#l93.221"></a><span id="l93.221"> {</span>
<a href="#l93.222"></a><span id="l93.222">   /* use cached smtp password first</span>
<a href="#l93.223"></a><span id="l93.223">   * if not then use cached pop password</span>
<a href="#l93.224"></a><span id="l93.224">   * if pop password undefined</span>
<a href="#l93.225"></a><span id="l93.225">   * sync with smtp password</span>
<a href="#l93.226"></a><span id="l93.226">   */</span>
<a href="#l93.227"></a><span id="l93.227">   nsresult status = NS_OK;</span>
<a href="#l93.228"></a><span id="l93.228">   nsresult rv;</span>
<a href="#l93.229"></a><span id="l93.229" class="difflineminus">-  nsCAutoString password;</span>
<a href="#l93.230"></a><span id="l93.230" class="difflineplus">+  nsAutoCString password;</span>
<a href="#l93.231"></a><span id="l93.231"> </span>
<a href="#l93.232"></a><span id="l93.232">   GetPassword(password);</span>
<a href="#l93.233"></a><span id="l93.233">   if (password.IsEmpty())</span>
<a href="#l93.234"></a><span id="l93.234">   {</span>
<a href="#l93.235"></a><span id="l93.235">     m_urlErrorState = NS_ERROR_SMTP_PASSWORD_UNDEFINED;</span>
<a href="#l93.236"></a><span id="l93.236">     return NS_ERROR_SMTP_PASSWORD_UNDEFINED;</span>
<a href="#l93.237"></a><span id="l93.237">   }</span>
<a href="#l93.238"></a><span id="l93.238">   PR_LOG(SMTPLogModule, PR_LOG_MAX, (&quot;SMTP AuthLoginStep2&quot;));</span>
<a href="#l93.239"></a><span id="l93.239" class="difflineat">@@ -1358,17 +1358,17 @@ nsresult nsSmtpProtocol::AuthLoginStep2(</span>
<a href="#l93.240"></a><span id="l93.240">       if (decodedChallenge)</span>
<a href="#l93.241"></a><span id="l93.241">         rv = MSGCramMD5(decodedChallenge, strlen(decodedChallenge), password.get(), password.Length(), digest);</span>
<a href="#l93.242"></a><span id="l93.242">       else</span>
<a href="#l93.243"></a><span id="l93.243">         rv = NS_ERROR_FAILURE;</span>
<a href="#l93.244"></a><span id="l93.244"> </span>
<a href="#l93.245"></a><span id="l93.245">       PR_Free(decodedChallenge);</span>
<a href="#l93.246"></a><span id="l93.246">       if (NS_SUCCEEDED(rv))</span>
<a href="#l93.247"></a><span id="l93.247">       {</span>
<a href="#l93.248"></a><span id="l93.248" class="difflineminus">-        nsCAutoString encodedDigest;</span>
<a href="#l93.249"></a><span id="l93.249" class="difflineplus">+        nsAutoCString encodedDigest;</span>
<a href="#l93.250"></a><span id="l93.250">         char hexVal[8];</span>
<a href="#l93.251"></a><span id="l93.251"> </span>
<a href="#l93.252"></a><span id="l93.252">         for (uint32_t j=0; j&lt;16; j++)</span>
<a href="#l93.253"></a><span id="l93.253">         {</span>
<a href="#l93.254"></a><span id="l93.254">           PR_snprintf (hexVal,8, &quot;%.2x&quot;, 0x0ff &amp; (unsigned short)digest[j]);</span>
<a href="#l93.255"></a><span id="l93.255">           encodedDigest.Append(hexVal);</span>
<a href="#l93.256"></a><span id="l93.256">         }</span>
<a href="#l93.257"></a><span id="l93.257"> </span>
<a href="#l93.258"></a><span id="l93.258" class="difflineat">@@ -1386,17 +1386,17 @@ nsresult nsSmtpProtocol::AuthLoginStep2(</span>
<a href="#l93.259"></a><span id="l93.259">       }</span>
<a href="#l93.260"></a><span id="l93.260">       if (NS_FAILED(rv))</span>
<a href="#l93.261"></a><span id="l93.261">         PR_snprintf(buffer, sizeof(buffer), &quot;*&quot; CRLF);</span>
<a href="#l93.262"></a><span id="l93.262">     }</span>
<a href="#l93.263"></a><span id="l93.263">     else if (m_currentAuthMethod == SMTP_AUTH_NTLM_ENABLED ||</span>
<a href="#l93.264"></a><span id="l93.264">              m_currentAuthMethod == SMTP_AUTH_MSN_ENABLED)</span>
<a href="#l93.265"></a><span id="l93.265">     {</span>
<a href="#l93.266"></a><span id="l93.266">       PR_LOG(SMTPLogModule, PR_LOG_DEBUG, (&quot;NTLM/MSN auth, step 2&quot;));</span>
<a href="#l93.267"></a><span id="l93.267" class="difflineminus">-      nsCAutoString response;</span>
<a href="#l93.268"></a><span id="l93.268" class="difflineplus">+      nsAutoCString response;</span>
<a href="#l93.269"></a><span id="l93.269">       rv = DoNtlmStep2(m_responseText, response);</span>
<a href="#l93.270"></a><span id="l93.270">       PR_snprintf(buffer, sizeof(buffer), &quot;%.256s&quot; CRLF, response.get());</span>
<a href="#l93.271"></a><span id="l93.271">     }</span>
<a href="#l93.272"></a><span id="l93.272">     else if (m_currentAuthMethod == SMTP_AUTH_PLAIN_ENABLED ||</span>
<a href="#l93.273"></a><span id="l93.273">              m_currentAuthMethod == SMTP_AUTH_LOGIN_ENABLED)</span>
<a href="#l93.274"></a><span id="l93.274">     {</span>
<a href="#l93.275"></a><span id="l93.275">       PR_LOG(SMTPLogModule, PR_LOG_DEBUG, (&quot;PLAIN/LOGIN auth, step 2&quot;));</span>
<a href="#l93.276"></a><span id="l93.276">       char *base64Str = PL_Base64Encode(password.get(), password.Length(), nullptr);</span>
<a href="#l93.277"></a><span id="l93.277" class="difflineat">@@ -1416,17 +1416,17 @@ nsresult nsSmtpProtocol::AuthLoginStep2(</span>
<a href="#l93.278"></a><span id="l93.278">   // XXX -1 is not a valid nsresult</span>
<a href="#l93.279"></a><span id="l93.279">   return static_cast&lt;nsresult&gt;(-1);</span>
<a href="#l93.280"></a><span id="l93.280"> }</span>
<a href="#l93.281"></a><span id="l93.281"> </span>
<a href="#l93.282"></a><span id="l93.282"> </span>
<a href="#l93.283"></a><span id="l93.283"> nsresult nsSmtpProtocol::SendMailResponse()</span>
<a href="#l93.284"></a><span id="l93.284"> {</span>
<a href="#l93.285"></a><span id="l93.285">   nsresult status = NS_OK;</span>
<a href="#l93.286"></a><span id="l93.286" class="difflineminus">-  nsCAutoString buffer;</span>
<a href="#l93.287"></a><span id="l93.287" class="difflineplus">+  nsAutoCString buffer;</span>
<a href="#l93.288"></a><span id="l93.288">   nsresult rv;</span>
<a href="#l93.289"></a><span id="l93.289"> </span>
<a href="#l93.290"></a><span id="l93.290">   if (m_responseCode/10 != 25)</span>
<a href="#l93.291"></a><span id="l93.291">   {</span>
<a href="#l93.292"></a><span id="l93.292">     nsresult errorcode;</span>
<a href="#l93.293"></a><span id="l93.293">     if (TestFlag(SMTP_EHLO_SIZE_ENABLED))</span>
<a href="#l93.294"></a><span id="l93.294">       errorcode = (m_responseCode == 452) ? NS_ERROR_SMTP_TEMP_SIZE_EXCEEDED :</span>
<a href="#l93.295"></a><span id="l93.295">                   (m_responseCode == 552) ? NS_ERROR_SMTP_PERM_SIZE_EXCEEDED_2 :</span>
<a href="#l93.296"></a><span id="l93.296" class="difflineat">@@ -1462,17 +1462,17 @@ nsresult nsSmtpProtocol::SendMailRespons</span>
<a href="#l93.297"></a><span id="l93.297">   rv = prefBranch-&gt;GetBoolPref(&quot;mail.dsn.request_on_delay_on&quot;, &amp;requestOnDelay);</span>
<a href="#l93.298"></a><span id="l93.298"> </span>
<a href="#l93.299"></a><span id="l93.299">   bool requestOnNever = false;</span>
<a href="#l93.300"></a><span id="l93.300">   rv = prefBranch-&gt;GetBoolPref(&quot;mail.dsn.request_never_on&quot;, &amp;requestOnNever);</span>
<a href="#l93.301"></a><span id="l93.301"> </span>
<a href="#l93.302"></a><span id="l93.302">   if (TestFlag(SMTP_EHLO_DSN_ENABLED) &amp;&amp; requestDSN &amp;&amp; (requestOnSuccess || requestOnFailure || requestOnDelay || requestOnNever))</span>
<a href="#l93.303"></a><span id="l93.303">     {</span>
<a href="#l93.304"></a><span id="l93.304">       char *encodedAddress = esmtp_value_encode(m_addresses);</span>
<a href="#l93.305"></a><span id="l93.305" class="difflineminus">-      nsCAutoString dsnBuffer;</span>
<a href="#l93.306"></a><span id="l93.306" class="difflineplus">+      nsAutoCString dsnBuffer;</span>
<a href="#l93.307"></a><span id="l93.307"> </span>
<a href="#l93.308"></a><span id="l93.308">       if (encodedAddress)</span>
<a href="#l93.309"></a><span id="l93.309">       {</span>
<a href="#l93.310"></a><span id="l93.310">         buffer = &quot;RCPT TO:&lt;&quot;;</span>
<a href="#l93.311"></a><span id="l93.311">         buffer += m_addresses;</span>
<a href="#l93.312"></a><span id="l93.312">         buffer += &quot;&gt; NOTIFY=&quot;;</span>
<a href="#l93.313"></a><span id="l93.313"> </span>
<a href="#l93.314"></a><span id="l93.314">         if (requestOnNever)</span>
<a href="#l93.315"></a><span id="l93.315" class="difflineat">@@ -1515,17 +1515,17 @@ nsresult nsSmtpProtocol::SendMailRespons</span>
<a href="#l93.316"></a><span id="l93.316">     SetFlag(SMTP_PAUSE_FOR_READ);</span>
<a href="#l93.317"></a><span id="l93.317"> </span>
<a href="#l93.318"></a><span id="l93.318">     return(status);</span>
<a href="#l93.319"></a><span id="l93.319"> }</span>
<a href="#l93.320"></a><span id="l93.320"> </span>
<a href="#l93.321"></a><span id="l93.321"> nsresult nsSmtpProtocol::SendRecipientResponse()</span>
<a href="#l93.322"></a><span id="l93.322"> {</span>
<a href="#l93.323"></a><span id="l93.323">   nsresult status = NS_OK;</span>
<a href="#l93.324"></a><span id="l93.324" class="difflineminus">-  nsCAutoString buffer;</span>
<a href="#l93.325"></a><span id="l93.325" class="difflineplus">+  nsAutoCString buffer;</span>
<a href="#l93.326"></a><span id="l93.326">   nsresult rv;</span>
<a href="#l93.327"></a><span id="l93.327"> </span>
<a href="#l93.328"></a><span id="l93.328">   if (m_responseCode / 10 != 25)</span>
<a href="#l93.329"></a><span id="l93.329">   {</span>
<a href="#l93.330"></a><span id="l93.330">     nsresult errorcode;</span>
<a href="#l93.331"></a><span id="l93.331">     if (TestFlag(SMTP_EHLO_SIZE_ENABLED))</span>
<a href="#l93.332"></a><span id="l93.332">       errorcode = (m_responseCode == 452) ? NS_ERROR_SMTP_TEMP_SIZE_EXCEEDED :</span>
<a href="#l93.333"></a><span id="l93.333">                   (m_responseCode == 552) ? NS_ERROR_SMTP_PERM_SIZE_EXCEEDED_2 :</span>
<a href="#l93.334"></a><span id="l93.334" class="difflineat">@@ -1691,17 +1691,17 @@ nsresult nsSmtpProtocol::LoadUrl(nsIURI </span>
<a href="#l93.335"></a><span id="l93.335">   m_runningURL = do_QueryInterface(aURL);</span>
<a href="#l93.336"></a><span id="l93.336">   if (!m_runningURL)</span>
<a href="#l93.337"></a><span id="l93.337">     return NS_ERROR_FAILURE;</span>
<a href="#l93.338"></a><span id="l93.338"> </span>
<a href="#l93.339"></a><span id="l93.339">   // we had a bug where we failed to bring up an alert if the host</span>
<a href="#l93.340"></a><span id="l93.340">   // name was empty....so throw up an alert saying we don't have</span>
<a href="#l93.341"></a><span id="l93.341">   // a host name and inform the caller that we are not going to</span>
<a href="#l93.342"></a><span id="l93.342">   // run the url...</span>
<a href="#l93.343"></a><span id="l93.343" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l93.344"></a><span id="l93.344" class="difflineplus">+  nsAutoCString hostName;</span>
<a href="#l93.345"></a><span id="l93.345">   aURL-&gt;GetHost(hostName);</span>
<a href="#l93.346"></a><span id="l93.346">   if (hostName.IsEmpty())</span>
<a href="#l93.347"></a><span id="l93.347">   {</span>
<a href="#l93.348"></a><span id="l93.348">     nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; aMsgUrl = do_QueryInterface(aURL);</span>
<a href="#l93.349"></a><span id="l93.349">     if (aMsgUrl)</span>
<a href="#l93.350"></a><span id="l93.350">     {</span>
<a href="#l93.351"></a><span id="l93.351">       aMsgUrl-&gt;SetUrlState(true, NS_OK);</span>
<a href="#l93.352"></a><span id="l93.352">       // set the url as a url currently being run...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -56,17 +56,17 @@ nsSmtpServer::SetKey(const char * aKey)</span>
<a href="#l94.4"></a><span id="l94.4"> </span>
<a href="#l94.5"></a><span id="l94.5"> nsresult nsSmtpServer::getPrefs()</span>
<a href="#l94.6"></a><span id="l94.6"> {</span>
<a href="#l94.7"></a><span id="l94.7">     nsresult rv;</span>
<a href="#l94.8"></a><span id="l94.8">     nsCOMPtr&lt;nsIPrefService&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l94.9"></a><span id="l94.9">     if (NS_FAILED(rv))</span>
<a href="#l94.10"></a><span id="l94.10">         return rv;</span>
<a href="#l94.11"></a><span id="l94.11"> </span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-    nsCAutoString branchName;</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+    nsAutoCString branchName;</span>
<a href="#l94.14"></a><span id="l94.14">     branchName.AssignLiteral(&quot;mail.smtpserver.&quot;);</span>
<a href="#l94.15"></a><span id="l94.15">     branchName += mKey;</span>
<a href="#l94.16"></a><span id="l94.16">     branchName.Append('.');</span>
<a href="#l94.17"></a><span id="l94.17">     rv = prefs-&gt;GetBranch(branchName.get(), getter_AddRefs(mPrefBranch));</span>
<a href="#l94.18"></a><span id="l94.18">     if (NS_FAILED(rv))</span>
<a href="#l94.19"></a><span id="l94.19">         return rv;</span>
<a href="#l94.20"></a><span id="l94.20"> </span>
<a href="#l94.21"></a><span id="l94.21">     if(!mDefPrefBranch) {</span>
<a href="#l94.22"></a><span id="l94.22" class="difflineat">@@ -466,17 +466,17 @@ NS_IMETHODIMP</span>
<a href="#l94.23"></a><span id="l94.23"> nsSmtpServer::ForgetPassword()</span>
<a href="#l94.24"></a><span id="l94.24"> {</span>
<a href="#l94.25"></a><span id="l94.25">   nsresult rv;</span>
<a href="#l94.26"></a><span id="l94.26">   nsCOMPtr&lt;nsILoginManager&gt; loginMgr =</span>
<a href="#l94.27"></a><span id="l94.27">     do_GetService(NS_LOGINMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l94.28"></a><span id="l94.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l94.29"></a><span id="l94.29"> </span>
<a href="#l94.30"></a><span id="l94.30">   // Get the current server URI without the username</span>
<a href="#l94.31"></a><span id="l94.31" class="difflineminus">-  nsCAutoString serverUri(NS_LITERAL_CSTRING(&quot;smtp://&quot;));</span>
<a href="#l94.32"></a><span id="l94.32" class="difflineplus">+  nsAutoCString serverUri(NS_LITERAL_CSTRING(&quot;smtp://&quot;));</span>
<a href="#l94.33"></a><span id="l94.33"> </span>
<a href="#l94.34"></a><span id="l94.34">   nsCString hostname;</span>
<a href="#l94.35"></a><span id="l94.35">   rv = GetHostname(hostname);</span>
<a href="#l94.36"></a><span id="l94.36"> </span>
<a href="#l94.37"></a><span id="l94.37">   if (NS_SUCCEEDED(rv) &amp;&amp; !hostname.IsEmpty()) {</span>
<a href="#l94.38"></a><span id="l94.38">     nsCString escapedHostname;</span>
<a href="#l94.39"></a><span id="l94.39">     MsgEscapeString(hostname, nsINetUtil::ESCAPE_URL_PATH, escapedHostname);</span>
<a href="#l94.40"></a><span id="l94.40">     // not all servers have a hostname</span>
<a href="#l94.41"></a><span id="l94.41" class="difflineat">@@ -516,17 +516,17 @@ nsSmtpServer::ForgetPassword()</span>
<a href="#l94.42"></a><span id="l94.42">   rv = SetPassword(EmptyCString());</span>
<a href="#l94.43"></a><span id="l94.43">   m_logonFailed = true;</span>
<a href="#l94.44"></a><span id="l94.44">   return rv;</span>
<a href="#l94.45"></a><span id="l94.45"> }</span>
<a href="#l94.46"></a><span id="l94.46"> </span>
<a href="#l94.47"></a><span id="l94.47"> NS_IMETHODIMP</span>
<a href="#l94.48"></a><span id="l94.48"> nsSmtpServer::GetServerURI(nsACString &amp;aResult)</span>
<a href="#l94.49"></a><span id="l94.49"> {</span>
<a href="#l94.50"></a><span id="l94.50" class="difflineminus">-    nsCAutoString uri(NS_LITERAL_CSTRING(&quot;smtp://&quot;));</span>
<a href="#l94.51"></a><span id="l94.51" class="difflineplus">+    nsAutoCString uri(NS_LITERAL_CSTRING(&quot;smtp://&quot;));</span>
<a href="#l94.52"></a><span id="l94.52"> </span>
<a href="#l94.53"></a><span id="l94.53">     nsCString username;</span>
<a href="#l94.54"></a><span id="l94.54">     nsresult rv = GetUsername(username);</span>
<a href="#l94.55"></a><span id="l94.55"> </span>
<a href="#l94.56"></a><span id="l94.56">     if (NS_SUCCEEDED(rv) &amp;&amp; !username.IsEmpty()) {</span>
<a href="#l94.57"></a><span id="l94.57">         nsCString escapedUsername;</span>
<a href="#l94.58"></a><span id="l94.58">         MsgEscapeString(username, nsINetUtil::ESCAPE_XALPHAS, escapedUsername);</span>
<a href="#l94.59"></a><span id="l94.59">         // not all servers have a username</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -145,17 +145,17 @@ nsresult NS_MsgBuildSmtpUrl(nsIFile * aF</span>
<a href="#l95.4"></a><span id="l95.4">     if (!smtpPort)</span>
<a href="#l95.5"></a><span id="l95.5">       smtpPort = (socketType == nsMsgSocketType::SSL) ?</span>
<a href="#l95.6"></a><span id="l95.6">         nsISmtpUrl::DEFAULT_SMTPS_PORT :  nsISmtpUrl::DEFAULT_SMTP_PORT;</span>
<a href="#l95.7"></a><span id="l95.7"> </span>
<a href="#l95.8"></a><span id="l95.8">   nsresult rv;</span>
<a href="#l95.9"></a><span id="l95.9">   nsCOMPtr&lt;nsISmtpUrl&gt; smtpUrl(do_CreateInstance(kCSmtpUrlCID, &amp;rv));</span>
<a href="#l95.10"></a><span id="l95.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l95.11"></a><span id="l95.11"> </span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-  nsCAutoString urlSpec(&quot;smtp://&quot;);</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+  nsAutoCString urlSpec(&quot;smtp://&quot;);</span>
<a href="#l95.14"></a><span id="l95.14"> </span>
<a href="#l95.15"></a><span id="l95.15">   if (!smtpUserName.IsEmpty())</span>
<a href="#l95.16"></a><span id="l95.16">   {</span>
<a href="#l95.17"></a><span id="l95.17">     nsCString escapedUsername;</span>
<a href="#l95.18"></a><span id="l95.18">     MsgEscapeString(smtpUserName, nsINetUtil::ESCAPE_XALPHAS,</span>
<a href="#l95.19"></a><span id="l95.19">                     escapedUsername);</span>
<a href="#l95.20"></a><span id="l95.20">     urlSpec.Append(escapedUsername);</span>
<a href="#l95.21"></a><span id="l95.21">     urlSpec.Append('@');</span>
<a href="#l95.22"></a><span id="l95.22" class="difflineat">@@ -289,17 +289,17 @@ NS_IMETHODIMP nsSmtpService::NewURI(cons</span>
<a href="#l95.23"></a><span id="l95.23">                                     nsIURI *aBaseURI,</span>
<a href="#l95.24"></a><span id="l95.24">                                     nsIURI **_retval)</span>
<a href="#l95.25"></a><span id="l95.25"> {</span>
<a href="#l95.26"></a><span id="l95.26">   // get a new smtp url</span>
<a href="#l95.27"></a><span id="l95.27">   nsresult rv;</span>
<a href="#l95.28"></a><span id="l95.28">   nsCOMPtr&lt;nsIURI&gt; mailtoUrl = do_CreateInstance(kCMailtoUrlCID, &amp;rv);</span>
<a href="#l95.29"></a><span id="l95.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l95.30"></a><span id="l95.30"> </span>
<a href="#l95.31"></a><span id="l95.31" class="difflineminus">-  nsCAutoString utf8Spec;</span>
<a href="#l95.32"></a><span id="l95.32" class="difflineplus">+  nsAutoCString utf8Spec;</span>
<a href="#l95.33"></a><span id="l95.33">   if (aOriginCharset)</span>
<a href="#l95.34"></a><span id="l95.34">   {</span>
<a href="#l95.35"></a><span id="l95.35">     nsCOMPtr&lt;nsIUTF8ConverterService&gt;</span>
<a href="#l95.36"></a><span id="l95.36">       utf8Converter(do_GetService(NS_UTF8CONVERTERSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l95.37"></a><span id="l95.37">     if (NS_SUCCEEDED(rv))</span>
<a href="#l95.38"></a><span id="l95.38">       rv = utf8Converter-&gt;ConvertURISpecToUTF8(aSpec, aOriginCharset, utf8Spec);</span>
<a href="#l95.39"></a><span id="l95.39">   }</span>
<a href="#l95.40"></a><span id="l95.40"> </span>
<a href="#l95.41"></a><span id="l95.41" class="difflineat">@@ -581,17 +581,17 @@ nsSmtpService::CreateSmtpServer(nsISmtpS</span>
<a href="#l95.42"></a><span id="l95.42">     if (!aResult) return NS_ERROR_NULL_POINTER;</span>
<a href="#l95.43"></a><span id="l95.43"> </span>
<a href="#l95.44"></a><span id="l95.44">     loadSmtpServers();</span>
<a href="#l95.45"></a><span id="l95.45">     nsresult rv;</span>
<a href="#l95.46"></a><span id="l95.46">     int32_t i = 0;</span>
<a href="#l95.47"></a><span id="l95.47">     bool unique = false;</span>
<a href="#l95.48"></a><span id="l95.48"> </span>
<a href="#l95.49"></a><span id="l95.49">     findServerByKeyEntry entry;</span>
<a href="#l95.50"></a><span id="l95.50" class="difflineminus">-    nsCAutoString key;</span>
<a href="#l95.51"></a><span id="l95.51" class="difflineplus">+    nsAutoCString key;</span>
<a href="#l95.52"></a><span id="l95.52"> </span>
<a href="#l95.53"></a><span id="l95.53">     do {</span>
<a href="#l95.54"></a><span id="l95.54">         key = &quot;smtp&quot;;</span>
<a href="#l95.55"></a><span id="l95.55">         key.AppendInt(++i);</span>
<a href="#l95.56"></a><span id="l95.56">         entry.key = key.get();</span>
<a href="#l95.57"></a><span id="l95.57">         entry.server = nullptr;</span>
<a href="#l95.58"></a><span id="l95.58"> </span>
<a href="#l95.59"></a><span id="l95.59">         mSmtpServers.EnumerateForwards(findServerByKey, (void *)&amp;entry);</span>
<a href="#l95.60"></a><span id="l95.60" class="difflineat">@@ -643,17 +643,17 @@ nsSmtpService::DeleteSmtpServer(nsISmtpS</span>
<a href="#l95.61"></a><span id="l95.61">     </span>
<a href="#l95.62"></a><span id="l95.62">     mSmtpServers.RemoveObjectAt(idx);</span>
<a href="#l95.63"></a><span id="l95.63"> </span>
<a href="#l95.64"></a><span id="l95.64">     if (mDefaultSmtpServer.get() == aServer)</span>
<a href="#l95.65"></a><span id="l95.65">         mDefaultSmtpServer = nullptr;</span>
<a href="#l95.66"></a><span id="l95.66">     if (mSessionDefaultServer.get() == aServer)</span>
<a href="#l95.67"></a><span id="l95.67">         mSessionDefaultServer = nullptr;</span>
<a href="#l95.68"></a><span id="l95.68">     </span>
<a href="#l95.69"></a><span id="l95.69" class="difflineminus">-    nsCAutoString newServerList;</span>
<a href="#l95.70"></a><span id="l95.70" class="difflineplus">+    nsAutoCString newServerList;</span>
<a href="#l95.71"></a><span id="l95.71">     nsCString tmpStr = mServerKeyList;</span>
<a href="#l95.72"></a><span id="l95.72">     char *newStr = tmpStr.BeginWriting();</span>
<a href="#l95.73"></a><span id="l95.73">     char *token = NS_strtok(&quot;,&quot;, &amp;newStr);</span>
<a href="#l95.74"></a><span id="l95.74">     while (token) {</span>
<a href="#l95.75"></a><span id="l95.75">       // only re-add the string if it's not the key</span>
<a href="#l95.76"></a><span id="l95.76">       if (strcmp(token, serverKey.get()) != 0) {</span>
<a href="#l95.77"></a><span id="l95.77">           if (newServerList.IsEmpty())</span>
<a href="#l95.78"></a><span id="l95.78">               newServerList = token;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -353,17 +353,17 @@ nsresult nsMailtoUrl::ParseMailtoUrl(cha</span>
<a href="#l96.4"></a><span id="l96.4">       // If References is not set, set it to be the In-Reply-To.</span>
<a href="#l96.5"></a><span id="l96.5">       m_referencePart = inReplyToPart;</span>
<a href="#l96.6"></a><span id="l96.6">     }</span>
<a href="#l96.7"></a><span id="l96.7">     else</span>
<a href="#l96.8"></a><span id="l96.8">     {</span>
<a href="#l96.9"></a><span id="l96.9">       // References is set. Add the In-Reply-To as last header unless it's</span>
<a href="#l96.10"></a><span id="l96.10">       // set as last reference already.</span>
<a href="#l96.11"></a><span id="l96.11">       int32_t lastRefStart = m_referencePart.RFindChar('&lt;');</span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-      nsCAutoString lastReference;</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+      nsAutoCString lastReference;</span>
<a href="#l96.14"></a><span id="l96.14">       if (lastRefStart != -1)</span>
<a href="#l96.15"></a><span id="l96.15">         lastReference = StringTail(m_referencePart, lastRefStart);</span>
<a href="#l96.16"></a><span id="l96.16">       else</span>
<a href="#l96.17"></a><span id="l96.17">         lastReference = m_referencePart;</span>
<a href="#l96.18"></a><span id="l96.18"> </span>
<a href="#l96.19"></a><span id="l96.19">       if (lastReference != inReplyToPart)</span>
<a href="#l96.20"></a><span id="l96.20">       {</span>
<a href="#l96.21"></a><span id="l96.21">         m_referencePart += &quot; &quot;;</span>
<a href="#l96.22"></a><span id="l96.22" class="difflineat">@@ -404,17 +404,17 @@ nsresult nsMailtoUrl::ParseUrl()</span>
<a href="#l96.23"></a><span id="l96.23">   // we can get the path from the simple url.....</span>
<a href="#l96.24"></a><span id="l96.24">   nsCString escapedPath;</span>
<a href="#l96.25"></a><span id="l96.25">   m_baseURL-&gt;GetPath(escapedPath);</span>
<a href="#l96.26"></a><span id="l96.26"> </span>
<a href="#l96.27"></a><span id="l96.27">   int32_t startOfSearchPart = escapedPath.FindChar('?');</span>
<a href="#l96.28"></a><span id="l96.28">   if (startOfSearchPart &gt;= 0)</span>
<a href="#l96.29"></a><span id="l96.29">   {</span>
<a href="#l96.30"></a><span id="l96.30">     // now parse out the search field...</span>
<a href="#l96.31"></a><span id="l96.31" class="difflineminus">-    nsCAutoString searchPart(Substring(escapedPath, startOfSearchPart));</span>
<a href="#l96.32"></a><span id="l96.32" class="difflineplus">+    nsAutoCString searchPart(Substring(escapedPath, startOfSearchPart));</span>
<a href="#l96.33"></a><span id="l96.33"> </span>
<a href="#l96.34"></a><span id="l96.34">     if (!searchPart.IsEmpty())</span>
<a href="#l96.35"></a><span id="l96.35">     {</span>
<a href="#l96.36"></a><span id="l96.36">       // now we need to strip off the search part from the</span>
<a href="#l96.37"></a><span id="l96.37">       // to part....</span>
<a href="#l96.38"></a><span id="l96.38">       escapedPath.SetLength(startOfSearchPart);</span>
<a href="#l96.39"></a><span id="l96.39">       MsgUnescapeString(escapedPath, 0, m_toPart);</span>
<a href="#l96.40"></a><span id="l96.40">       ParseMailtoUrl(searchPart.BeginWriting());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -440,26 +440,26 @@ NS_IMETHODIMP nsURLFetcherStreamConsumer</span>
<a href="#l97.4"></a><span id="l97.4"> </span>
<a href="#l97.5"></a><span id="l97.5"> /* void onStopRequest (in nsIRequest request, in nsISupports ctxt, in nsresult status); */</span>
<a href="#l97.6"></a><span id="l97.6"> NS_IMETHODIMP nsURLFetcherStreamConsumer::OnStopRequest(nsIRequest *aRequest, nsISupports *ctxt, nsresult status)</span>
<a href="#l97.7"></a><span id="l97.7"> {</span>
<a href="#l97.8"></a><span id="l97.8">   if (!mURLFetcher)</span>
<a href="#l97.9"></a><span id="l97.9">     return NS_ERROR_FAILURE;</span>
<a href="#l97.10"></a><span id="l97.10"> </span>
<a href="#l97.11"></a><span id="l97.11">   // Check the content type!</span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-  nsCAutoString contentType;</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineminus">-  nsCAutoString charset;</span>
<a href="#l97.14"></a><span id="l97.14" class="difflineplus">+  nsAutoCString contentType;</span>
<a href="#l97.15"></a><span id="l97.15" class="difflineplus">+  nsAutoCString charset;</span>
<a href="#l97.16"></a><span id="l97.16"> </span>
<a href="#l97.17"></a><span id="l97.17">   nsCOMPtr&lt;nsIChannel&gt; channel = do_QueryInterface(aRequest);</span>
<a href="#l97.18"></a><span id="l97.18">   if(!channel) return NS_ERROR_FAILURE;</span>
<a href="#l97.19"></a><span id="l97.19"> </span>
<a href="#l97.20"></a><span id="l97.20">   if (NS_SUCCEEDED(channel-&gt;GetContentType(contentType)) &amp;&amp;</span>
<a href="#l97.21"></a><span id="l97.21">       !contentType.EqualsLiteral(UNKNOWN_CONTENT_TYPE))</span>
<a href="#l97.22"></a><span id="l97.22">   {</span>
<a href="#l97.23"></a><span id="l97.23" class="difflineminus">-    nsCAutoString uriSpec;</span>
<a href="#l97.24"></a><span id="l97.24" class="difflineplus">+    nsAutoCString uriSpec;</span>
<a href="#l97.25"></a><span id="l97.25">     nsCOMPtr &lt;nsIURI&gt; channelURI;</span>
<a href="#l97.26"></a><span id="l97.26">     channel-&gt;GetURI(getter_AddRefs(channelURI));</span>
<a href="#l97.27"></a><span id="l97.27">     channelURI-&gt;GetSpec(uriSpec);</span>
<a href="#l97.28"></a><span id="l97.28">     if (uriSpec.Find(&quot;&amp;realtype=message/rfc822&quot;) &gt;= 0)</span>
<a href="#l97.29"></a><span id="l97.29">       mURLFetcher-&gt;mContentType = MESSAGE_RFC822;</span>
<a href="#l97.30"></a><span id="l97.30">     else</span>
<a href="#l97.31"></a><span id="l97.31">       mURLFetcher-&gt;mContentType = contentType;</span>
<a href="#l97.32"></a><span id="l97.32">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsMsgHdr.h</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsMsgHdr.h</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -40,17 +40,17 @@ public:</span>
<a href="#l98.4"></a><span id="l98.4">     bool        IsAncestorKilled(uint32_t ancestorsToCheck);</span>
<a href="#l98.5"></a><span id="l98.5">     void        ReparentInThread(nsIMsgThread *thread);</span>
<a href="#l98.6"></a><span id="l98.6"> protected:</span>
<a href="#l98.7"></a><span id="l98.7">     nsresult SetStringColumn(const char *str, mdb_token token);</span>
<a href="#l98.8"></a><span id="l98.8">     nsresult SetUInt32Column(uint32_t value, mdb_token token);</span>
<a href="#l98.9"></a><span id="l98.9">     nsresult GetUInt32Column(mdb_token token, uint32_t *pvalue, uint32_t defaultValue = 0);</span>
<a href="#l98.10"></a><span id="l98.10">     nsresult SetUInt64Column(uint64_t value, mdb_token token);</span>
<a href="#l98.11"></a><span id="l98.11">     nsresult GetUInt64Column(mdb_token token, uint64_t *pvalue, uint64_t defaultValue = 0);</span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-    nsresult BuildRecipientsFromArray(const char *names, const char *addresses, uint32_t numAddresses, nsCAutoString&amp; allRecipients);</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+    nsresult BuildRecipientsFromArray(const char *names, const char *addresses, uint32_t numAddresses, nsAutoCString&amp; allRecipients);</span>
<a href="#l98.14"></a><span id="l98.14"> </span>
<a href="#l98.15"></a><span id="l98.15">     // reference and threading stuff.</span>
<a href="#l98.16"></a><span id="l98.16">     nsresult	ParseReferences(const char *references);</span>
<a href="#l98.17"></a><span id="l98.17">     const char* GetNextReference(const char *startNextRef, nsCString &amp;reference,</span>
<a href="#l98.18"></a><span id="l98.18">                                  bool acceptNonDelimitedReferences);</span>
<a href="#l98.19"></a><span id="l98.19"> </span>
<a href="#l98.20"></a><span id="l98.20">     nsMsgKey	m_threadId; </span>
<a href="#l98.21"></a><span id="l98.21">     nsMsgKey	m_messageKey; 	//news: article number, mail mbox offset, imap uid...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -114,17 +114,17 @@ NS_IMETHODIMP nsMsgDBService::OpenFolder</span>
<a href="#l99.4"></a><span id="l99.4">     // caller wants to synchronously open it, so just do it.</span>
<a href="#l99.5"></a><span id="l99.5">     if (cacheDB-&gt;m_thumb)</span>
<a href="#l99.6"></a><span id="l99.6">       return cacheDB-&gt;Open(summaryFilePath, false, aLeaveInvalidDB);</span>
<a href="#l99.7"></a><span id="l99.7">     return NS_OK;</span>
<a href="#l99.8"></a><span id="l99.8">   }</span>
<a href="#l99.9"></a><span id="l99.9"> </span>
<a href="#l99.10"></a><span id="l99.10">   nsCString localStoreType;</span>
<a href="#l99.11"></a><span id="l99.11">   incomingServer-&gt;GetLocalStoreType(localStoreType);</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-  nsCAutoString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+  nsAutoCString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l99.14"></a><span id="l99.14">   dbContractID.Append(localStoreType.get());</span>
<a href="#l99.15"></a><span id="l99.15">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB = do_CreateInstance(dbContractID.get(), &amp;rv);</span>
<a href="#l99.16"></a><span id="l99.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.17"></a><span id="l99.17"> </span>
<a href="#l99.18"></a><span id="l99.18">   // Don't try to create the database yet--let the createNewDB call do that.</span>
<a href="#l99.19"></a><span id="l99.19">   nsMsgDatabase *msgDatabase = static_cast&lt;nsMsgDatabase *&gt;(msgDB.get());</span>
<a href="#l99.20"></a><span id="l99.20">   msgDatabase-&gt;m_folder = aFolder;</span>
<a href="#l99.21"></a><span id="l99.21">   rv = msgDatabase-&gt;Open(summaryFilePath, false, aLeaveInvalidDB);</span>
<a href="#l99.22"></a><span id="l99.22" class="difflineat">@@ -179,17 +179,17 @@ NS_IMETHODIMP nsMsgDBService::AsyncOpenF</span>
<a href="#l99.23"></a><span id="l99.23">   rv = msgStore-&gt;GetSummaryFile(aFolder, getter_AddRefs(summaryFilePath));</span>
<a href="#l99.24"></a><span id="l99.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.25"></a><span id="l99.25"> </span>
<a href="#l99.26"></a><span id="l99.26">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l99.27"></a><span id="l99.27">   rv = aFolder-&gt;GetServer(getter_AddRefs(incomingServer));</span>
<a href="#l99.28"></a><span id="l99.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.29"></a><span id="l99.29">   nsCString localStoreType;</span>
<a href="#l99.30"></a><span id="l99.30">   incomingServer-&gt;GetLocalStoreType(localStoreType);</span>
<a href="#l99.31"></a><span id="l99.31" class="difflineminus">-  nsCAutoString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l99.32"></a><span id="l99.32" class="difflineplus">+  nsAutoCString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l99.33"></a><span id="l99.33">   dbContractID.Append(localStoreType.get());</span>
<a href="#l99.34"></a><span id="l99.34">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB = do_CreateInstance(dbContractID.get(), &amp;rv);</span>
<a href="#l99.35"></a><span id="l99.35">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.36"></a><span id="l99.36"> </span>
<a href="#l99.37"></a><span id="l99.37">   nsMsgDatabase *msgDatabase = static_cast&lt;nsMsgDatabase *&gt;(msgDB.get());</span>
<a href="#l99.38"></a><span id="l99.38">   rv = msgDatabase-&gt;OpenInternal(summaryFilePath, false, aLeaveInvalidDB,</span>
<a href="#l99.39"></a><span id="l99.39">                                  false /* open asynchronously */);</span>
<a href="#l99.40"></a><span id="l99.40"> </span>
<a href="#l99.41"></a><span id="l99.41" class="difflineat">@@ -356,17 +356,17 @@ NS_IMETHODIMP nsMsgDBService::CreateNewD</span>
<a href="#l99.42"></a><span id="l99.42">   rv = aFolder-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l99.43"></a><span id="l99.43">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.44"></a><span id="l99.44">   nsCOMPtr&lt;nsIFile&gt; summaryFilePath;</span>
<a href="#l99.45"></a><span id="l99.45">   rv = msgStore-&gt;GetSummaryFile(aFolder, getter_AddRefs(summaryFilePath));</span>
<a href="#l99.46"></a><span id="l99.46">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.47"></a><span id="l99.47"> </span>
<a href="#l99.48"></a><span id="l99.48">   nsCString localStoreType;</span>
<a href="#l99.49"></a><span id="l99.49">   incomingServer-&gt;GetLocalStoreType(localStoreType);</span>
<a href="#l99.50"></a><span id="l99.50" class="difflineminus">-  nsCAutoString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l99.51"></a><span id="l99.51" class="difflineplus">+  nsAutoCString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l99.52"></a><span id="l99.52">   dbContractID.Append(localStoreType.get());</span>
<a href="#l99.53"></a><span id="l99.53">   </span>
<a href="#l99.54"></a><span id="l99.54">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB = do_CreateInstance(dbContractID.get(), &amp;rv);</span>
<a href="#l99.55"></a><span id="l99.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.56"></a><span id="l99.56"> </span>
<a href="#l99.57"></a><span id="l99.57">   nsMsgDatabase *msgDatabase = static_cast&lt;nsMsgDatabase *&gt;(msgDB.get());</span>
<a href="#l99.58"></a><span id="l99.58"> </span>
<a href="#l99.59"></a><span id="l99.59">   msgDatabase-&gt;m_folder = aFolder;</span>
<a href="#l99.60"></a><span id="l99.60" class="difflineat">@@ -1111,17 +1111,17 @@ nsresult nsMsgDatabase::Open(nsIFile *aF</span>
<a href="#l99.61"></a><span id="l99.61"> {</span>
<a href="#l99.62"></a><span id="l99.62">   return nsMsgDatabase::OpenInternal(aFolderName, aCreate, aLeaveInvalidDB,</span>
<a href="#l99.63"></a><span id="l99.63">                                      true /* open synchronously */);</span>
<a href="#l99.64"></a><span id="l99.64"> }</span>
<a href="#l99.65"></a><span id="l99.65"> </span>
<a href="#l99.66"></a><span id="l99.66"> nsresult nsMsgDatabase::OpenInternal(nsIFile *summaryFile, bool aCreate,</span>
<a href="#l99.67"></a><span id="l99.67">                                      bool aLeaveInvalidDB, bool sync)</span>
<a href="#l99.68"></a><span id="l99.68"> {</span>
<a href="#l99.69"></a><span id="l99.69" class="difflineminus">-  nsCAutoString summaryFilePath;</span>
<a href="#l99.70"></a><span id="l99.70" class="difflineplus">+  nsAutoCString summaryFilePath;</span>
<a href="#l99.71"></a><span id="l99.71">   summaryFile-&gt;GetNativePath(summaryFilePath);</span>
<a href="#l99.72"></a><span id="l99.72"> </span>
<a href="#l99.73"></a><span id="l99.73">   PR_LOG(DBLog, PR_LOG_ALWAYS, (&quot;nsMsgDatabase::Open(%s, %s, %p, %s)\n&quot;,</span>
<a href="#l99.74"></a><span id="l99.74">     (const char*)summaryFilePath.get(), aCreate ? &quot;TRUE&quot;:&quot;FALSE&quot;,</span>
<a href="#l99.75"></a><span id="l99.75">     this, aLeaveInvalidDB ? &quot;TRUE&quot;:&quot;FALSE&quot;));</span>
<a href="#l99.76"></a><span id="l99.76"> </span>
<a href="#l99.77"></a><span id="l99.77"> </span>
<a href="#l99.78"></a><span id="l99.78">   nsresult rv = OpenMDB(summaryFilePath.get(), aCreate, sync);</span>
<a href="#l99.79"></a><span id="l99.79" class="difflineat">@@ -1683,17 +1683,17 @@ nsresult nsMsgDatabase::InitExistingDB()</span>
<a href="#l99.80"></a><span id="l99.80">                hasMore)</span>
<a href="#l99.81"></a><span id="l99.81">         {</span>
<a href="#l99.82"></a><span id="l99.82">           nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l99.83"></a><span id="l99.83">           err = enumerator-&gt;GetNext(getter_AddRefs(msgHdr));</span>
<a href="#l99.84"></a><span id="l99.84">           NS_ASSERTION(NS_SUCCEEDED(err), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l99.85"></a><span id="l99.85">           if (msgHdr &amp;&amp; NS_SUCCEEDED(err))</span>
<a href="#l99.86"></a><span id="l99.86">           {</span>
<a href="#l99.87"></a><span id="l99.87">             nsCString messageId;</span>
<a href="#l99.88"></a><span id="l99.88" class="difflineminus">-            nsCAutoString firstReference;</span>
<a href="#l99.89"></a><span id="l99.89" class="difflineplus">+            nsAutoCString firstReference;</span>
<a href="#l99.90"></a><span id="l99.90">             msgHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l99.91"></a><span id="l99.91">             msgHdr-&gt;GetStringReference(0, firstReference);</span>
<a href="#l99.92"></a><span id="l99.92">             if (messageId.Equals(firstReference))</span>
<a href="#l99.93"></a><span id="l99.93">             {</span>
<a href="#l99.94"></a><span id="l99.94">               err = NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE;</span>
<a href="#l99.95"></a><span id="l99.95">               break;</span>
<a href="#l99.96"></a><span id="l99.96">             }</span>
<a href="#l99.97"></a><span id="l99.97">           }</span>
<a href="#l99.98"></a><span id="l99.98" class="difflineat">@@ -4148,17 +4148,17 @@ nsresult nsMsgDatabase::AddMsgRefsToHash</span>
<a href="#l99.99"></a><span id="l99.99">   nsMsgKey threadId;</span>
<a href="#l99.100"></a><span id="l99.100">   nsresult rv = NS_OK;</span>
<a href="#l99.101"></a><span id="l99.101"> </span>
<a href="#l99.102"></a><span id="l99.102">   msgHdr-&gt;GetThreadId(&amp;threadId);</span>
<a href="#l99.103"></a><span id="l99.103">   msgHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l99.104"></a><span id="l99.104"> </span>
<a href="#l99.105"></a><span id="l99.105">   for (int32_t i = 0; i &lt; numReferences; i++)</span>
<a href="#l99.106"></a><span id="l99.106">   {</span>
<a href="#l99.107"></a><span id="l99.107" class="difflineminus">-    nsCAutoString reference;</span>
<a href="#l99.108"></a><span id="l99.108" class="difflineplus">+    nsAutoCString reference;</span>
<a href="#l99.109"></a><span id="l99.109">     </span>
<a href="#l99.110"></a><span id="l99.110">     msgHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l99.111"></a><span id="l99.111">     if (reference.IsEmpty())</span>
<a href="#l99.112"></a><span id="l99.112">       break;</span>
<a href="#l99.113"></a><span id="l99.113"> </span>
<a href="#l99.114"></a><span id="l99.114">     rv = AddRefToHash(reference, threadId);</span>
<a href="#l99.115"></a><span id="l99.115">     if (NS_FAILED(rv))</span>
<a href="#l99.116"></a><span id="l99.116">       break;</span>
<a href="#l99.117"></a><span id="l99.117" class="difflineat">@@ -4188,17 +4188,17 @@ nsresult nsMsgDatabase::RemoveMsgRefsFro</span>
<a href="#l99.118"></a><span id="l99.118"> {</span>
<a href="#l99.119"></a><span id="l99.119">   uint16_t numReferences = 0;</span>
<a href="#l99.120"></a><span id="l99.120">   nsresult rv = NS_OK;</span>
<a href="#l99.121"></a><span id="l99.121"> </span>
<a href="#l99.122"></a><span id="l99.122">   msgHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l99.123"></a><span id="l99.123"> </span>
<a href="#l99.124"></a><span id="l99.124">   for (int32_t i = 0; i &lt; numReferences; i++)</span>
<a href="#l99.125"></a><span id="l99.125">   {</span>
<a href="#l99.126"></a><span id="l99.126" class="difflineminus">-    nsCAutoString reference;</span>
<a href="#l99.127"></a><span id="l99.127" class="difflineplus">+    nsAutoCString reference;</span>
<a href="#l99.128"></a><span id="l99.128">     </span>
<a href="#l99.129"></a><span id="l99.129">     msgHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l99.130"></a><span id="l99.130">     if (reference.IsEmpty())</span>
<a href="#l99.131"></a><span id="l99.131">       break;</span>
<a href="#l99.132"></a><span id="l99.132"> </span>
<a href="#l99.133"></a><span id="l99.133">     rv = RemoveRefFromHash(reference);</span>
<a href="#l99.134"></a><span id="l99.134">     if (NS_FAILED(rv))</span>
<a href="#l99.135"></a><span id="l99.135">       break;</span>
<a href="#l99.136"></a><span id="l99.136" class="difflineat">@@ -4445,17 +4445,17 @@ nsresult nsMsgDatabase::ThreadNewHdr(nsM</span>
<a href="#l99.137"></a><span id="l99.137">   // in m_newSet yet.</span>
<a href="#l99.138"></a><span id="l99.138">   newHdr-&gt;GetRawFlags(&amp;newHdrFlags);</span>
<a href="#l99.139"></a><span id="l99.139">   newHdr-&gt;GetNumReferences(&amp;numReferences);</span>
<a href="#l99.140"></a><span id="l99.140">   newHdr-&gt;GetMessageKey(&amp;newHdrKey);</span>
<a href="#l99.141"></a><span id="l99.141"> </span>
<a href="#l99.142"></a><span id="l99.142">   // try reference threading first</span>
<a href="#l99.143"></a><span id="l99.143">   for (int32_t i = numReferences - 1; i &gt;= 0;  i--)</span>
<a href="#l99.144"></a><span id="l99.144">   {</span>
<a href="#l99.145"></a><span id="l99.145" class="difflineminus">-    nsCAutoString reference;</span>
<a href="#l99.146"></a><span id="l99.146" class="difflineplus">+    nsAutoCString reference;</span>
<a href="#l99.147"></a><span id="l99.147"> </span>
<a href="#l99.148"></a><span id="l99.148">     newHdr-&gt;GetStringReference(i, reference);</span>
<a href="#l99.149"></a><span id="l99.149">     // first reference we have hdr for is best top-level hdr.</span>
<a href="#l99.150"></a><span id="l99.150">     // but we have to handle case of promoting new header to top-level</span>
<a href="#l99.151"></a><span id="l99.151">     // in case the top-level header comes after a reply.</span>
<a href="#l99.152"></a><span id="l99.152"> </span>
<a href="#l99.153"></a><span id="l99.153">     if (reference.IsEmpty())</span>
<a href="#l99.154"></a><span id="l99.154">       break;</span>
<a href="#l99.155"></a><span id="l99.155" class="difflineat">@@ -4485,17 +4485,17 @@ nsresult nsMsgDatabase::ThreadNewHdr(nsM</span>
<a href="#l99.156"></a><span id="l99.156">   // if user hasn't said &quot;only thread by ref headers&quot;, thread by subject</span>
<a href="#l99.157"></a><span id="l99.157">   if (!thread &amp;&amp; !UseStrictThreading())</span>
<a href="#l99.158"></a><span id="l99.158">   {</span>
<a href="#l99.159"></a><span id="l99.159">     // try subject threading if we couldn't find a reference and the subject starts with Re:</span>
<a href="#l99.160"></a><span id="l99.160">     nsCString subject;</span>
<a href="#l99.161"></a><span id="l99.161">     newHdr-&gt;GetSubject(getter_Copies(subject));</span>
<a href="#l99.162"></a><span id="l99.162">     if (ThreadBySubjectWithoutRe() || (newHdrFlags &amp; nsMsgMessageFlags::HasRe))</span>
<a href="#l99.163"></a><span id="l99.163">     {</span>
<a href="#l99.164"></a><span id="l99.164" class="difflineminus">-      nsCAutoString cSubject(subject);</span>
<a href="#l99.165"></a><span id="l99.165" class="difflineplus">+      nsAutoCString cSubject(subject);</span>
<a href="#l99.166"></a><span id="l99.166">       thread = getter_AddRefs(GetThreadForSubject(cSubject));</span>
<a href="#l99.167"></a><span id="l99.167">       if(thread)</span>
<a href="#l99.168"></a><span id="l99.168">       {</span>
<a href="#l99.169"></a><span id="l99.169">         thread-&gt;GetThreadKey(&amp;threadId);</span>
<a href="#l99.170"></a><span id="l99.170">         newHdr-&gt;SetThreadId(threadId);</span>
<a href="#l99.171"></a><span id="l99.171">         //TRACE(&quot;threading based on subject %s\n&quot;, (const char *) msgHdr-&gt;m_subject);</span>
<a href="#l99.172"></a><span id="l99.172">         // if we move this and do subject threading after, ref threading,</span>
<a href="#l99.173"></a><span id="l99.173">         // don't thread within children, since we know it won't work. But for now, pass TRUE.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgHdr.cpp</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgHdr.cpp</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -309,17 +309,17 @@ NS_IMETHODIMP nsMsgHdr::GetNumReferences</span>
<a href="#l100.4"></a><span id="l100.4">   // there is no real failure here; if there are no references, there are no</span>
<a href="#l100.5"></a><span id="l100.5">   //  references.</span>
<a href="#l100.6"></a><span id="l100.6">   return NS_OK;</span>
<a href="#l100.7"></a><span id="l100.7"> }</span>
<a href="#l100.8"></a><span id="l100.8"> </span>
<a href="#l100.9"></a><span id="l100.9"> nsresult nsMsgHdr::ParseReferences(const char *references)</span>
<a href="#l100.10"></a><span id="l100.10"> {</span>
<a href="#l100.11"></a><span id="l100.11">   const char *startNextRef = references;</span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-  nsCAutoString resultReference;</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineplus">+  nsAutoCString resultReference;</span>
<a href="#l100.14"></a><span id="l100.14">   nsCString messageId;</span>
<a href="#l100.15"></a><span id="l100.15">   GetMessageId(getter_Copies(messageId));</span>
<a href="#l100.16"></a><span id="l100.16"> </span>
<a href="#l100.17"></a><span id="l100.17">   while (startNextRef &amp;&amp; *startNextRef)</span>
<a href="#l100.18"></a><span id="l100.18">   {</span>
<a href="#l100.19"></a><span id="l100.19">     startNextRef = GetNextReference(startNextRef, resultReference,</span>
<a href="#l100.20"></a><span id="l100.20">                                     startNextRef == references);</span>
<a href="#l100.21"></a><span id="l100.21">     // Don't add self-references.</span>
<a href="#l100.22"></a><span id="l100.22" class="difflineat">@@ -356,17 +356,17 @@ NS_IMETHODIMP nsMsgHdr::GetDateInSeconds</span>
<a href="#l100.23"></a><span id="l100.23"> {</span>
<a href="#l100.24"></a><span id="l100.24">   return GetUInt32Column(m_mdb-&gt;m_dateColumnToken, aResult);</span>
<a href="#l100.25"></a><span id="l100.25"> }</span>
<a href="#l100.26"></a><span id="l100.26"> </span>
<a href="#l100.27"></a><span id="l100.27"> NS_IMETHODIMP nsMsgHdr::SetMessageId(const char *messageId)</span>
<a href="#l100.28"></a><span id="l100.28"> {</span>
<a href="#l100.29"></a><span id="l100.29">   if (messageId &amp;&amp; *messageId == '&lt;')</span>
<a href="#l100.30"></a><span id="l100.30">   {</span>
<a href="#l100.31"></a><span id="l100.31" class="difflineminus">-    nsCAutoString tempMessageID(messageId + 1);</span>
<a href="#l100.32"></a><span id="l100.32" class="difflineplus">+    nsAutoCString tempMessageID(messageId + 1);</span>
<a href="#l100.33"></a><span id="l100.33">     if (tempMessageID.CharAt(tempMessageID.Length() - 1) == '&gt;')</span>
<a href="#l100.34"></a><span id="l100.34">       tempMessageID.SetLength(tempMessageID.Length() - 1);</span>
<a href="#l100.35"></a><span id="l100.35">     return SetStringColumn(tempMessageID.get(), m_mdb-&gt;m_messageIdColumnToken);</span>
<a href="#l100.36"></a><span id="l100.36">   }</span>
<a href="#l100.37"></a><span id="l100.37">   return SetStringColumn(messageId, m_mdb-&gt;m_messageIdColumnToken);</span>
<a href="#l100.38"></a><span id="l100.38"> }</span>
<a href="#l100.39"></a><span id="l100.39"> </span>
<a href="#l100.40"></a><span id="l100.40"> NS_IMETHODIMP nsMsgHdr::SetSubject(const char *subject)</span>
<a href="#l100.41"></a><span id="l100.41" class="difflineat">@@ -391,17 +391,17 @@ NS_IMETHODIMP nsMsgHdr::SetReferences(co</span>
<a href="#l100.42"></a><span id="l100.42"> }</span>
<a href="#l100.43"></a><span id="l100.43"> </span>
<a href="#l100.44"></a><span id="l100.44"> NS_IMETHODIMP nsMsgHdr::SetRecipients(const char *recipients)</span>
<a href="#l100.45"></a><span id="l100.45"> {</span>
<a href="#l100.46"></a><span id="l100.46">   // need to put in rfc822 address parsing code here (or make caller do it...)</span>
<a href="#l100.47"></a><span id="l100.47">   return SetStringColumn(recipients, m_mdb-&gt;m_recipientsColumnToken);</span>
<a href="#l100.48"></a><span id="l100.48"> }</span>
<a href="#l100.49"></a><span id="l100.49"> </span>
<a href="#l100.50"></a><span id="l100.50" class="difflineminus">-nsresult nsMsgHdr::BuildRecipientsFromArray(const char *names, const char *addresses, uint32_t numAddresses, nsCAutoString&amp; allRecipients)</span>
<a href="#l100.51"></a><span id="l100.51" class="difflineplus">+nsresult nsMsgHdr::BuildRecipientsFromArray(const char *names, const char *addresses, uint32_t numAddresses, nsAutoCString&amp; allRecipients)</span>
<a href="#l100.52"></a><span id="l100.52"> {</span>
<a href="#l100.53"></a><span id="l100.53">   NS_ENSURE_ARG_POINTER(names);</span>
<a href="#l100.54"></a><span id="l100.54">   NS_ENSURE_ARG_POINTER(addresses);</span>
<a href="#l100.55"></a><span id="l100.55">   nsresult ret = NS_OK;</span>
<a href="#l100.56"></a><span id="l100.56">   const char *curName = names;</span>
<a href="#l100.57"></a><span id="l100.57">   const char *curAddress = addresses;</span>
<a href="#l100.58"></a><span id="l100.58">   nsIMsgHeaderParser *headerParser = m_mdb-&gt;GetHeaderParser();</span>
<a href="#l100.59"></a><span id="l100.59"> </span>
<a href="#l100.60"></a><span id="l100.60" class="difflineat">@@ -438,17 +438,17 @@ nsresult nsMsgHdr::BuildRecipientsFromAr</span>
<a href="#l100.61"></a><span id="l100.61">   }</span>
<a href="#l100.62"></a><span id="l100.62"> </span>
<a href="#l100.63"></a><span id="l100.63">   return ret;</span>
<a href="#l100.64"></a><span id="l100.64"> }</span>
<a href="#l100.65"></a><span id="l100.65"> </span>
<a href="#l100.66"></a><span id="l100.66"> NS_IMETHODIMP nsMsgHdr::SetRecipientsArray(const char *names, const char *addresses, uint32_t numAddresses)</span>
<a href="#l100.67"></a><span id="l100.67"> {</span>
<a href="#l100.68"></a><span id="l100.68"> 	nsresult ret;</span>
<a href="#l100.69"></a><span id="l100.69" class="difflineminus">-	nsCAutoString	allRecipients;</span>
<a href="#l100.70"></a><span id="l100.70" class="difflineplus">+	nsAutoCString	allRecipients;</span>
<a href="#l100.71"></a><span id="l100.71"> </span>
<a href="#l100.72"></a><span id="l100.72">     ret = BuildRecipientsFromArray(names, addresses, numAddresses, allRecipients);</span>
<a href="#l100.73"></a><span id="l100.73">     if (NS_FAILED(ret))</span>
<a href="#l100.74"></a><span id="l100.74">         return ret;</span>
<a href="#l100.75"></a><span id="l100.75"> </span>
<a href="#l100.76"></a><span id="l100.76"> 	ret = SetRecipients(allRecipients.get());</span>
<a href="#l100.77"></a><span id="l100.77"> 	return ret;</span>
<a href="#l100.78"></a><span id="l100.78"> }</span>
<a href="#l100.79"></a><span id="l100.79" class="difflineat">@@ -457,17 +457,17 @@ NS_IMETHODIMP nsMsgHdr::SetCcList(const </span>
<a href="#l100.80"></a><span id="l100.80"> {</span>
<a href="#l100.81"></a><span id="l100.81"> 	return SetStringColumn(ccList, m_mdb-&gt;m_ccListColumnToken);</span>
<a href="#l100.82"></a><span id="l100.82"> }</span>
<a href="#l100.83"></a><span id="l100.83"> </span>
<a href="#l100.84"></a><span id="l100.84"> // ###should make helper routine that takes column token!</span>
<a href="#l100.85"></a><span id="l100.85"> NS_IMETHODIMP nsMsgHdr::SetCCListArray(const char *names, const char *addresses, uint32_t numAddresses)</span>
<a href="#l100.86"></a><span id="l100.86"> {</span>
<a href="#l100.87"></a><span id="l100.87"> 	nsresult ret;</span>
<a href="#l100.88"></a><span id="l100.88" class="difflineminus">-	nsCAutoString	allRecipients;</span>
<a href="#l100.89"></a><span id="l100.89" class="difflineplus">+	nsAutoCString	allRecipients;</span>
<a href="#l100.90"></a><span id="l100.90"> </span>
<a href="#l100.91"></a><span id="l100.91">     ret = BuildRecipientsFromArray(names, addresses, numAddresses, allRecipients);</span>
<a href="#l100.92"></a><span id="l100.92">     if (NS_FAILED(ret))</span>
<a href="#l100.93"></a><span id="l100.93">         return ret;</span>
<a href="#l100.94"></a><span id="l100.94"> </span>
<a href="#l100.95"></a><span id="l100.95"> 	ret = SetCcList(allRecipients.get());</span>
<a href="#l100.96"></a><span id="l100.96"> 	return ret;</span>
<a href="#l100.97"></a><span id="l100.97"> }</span>
<a href="#l100.98"></a><span id="l100.98" class="difflineat">@@ -477,17 +477,17 @@ NS_IMETHODIMP nsMsgHdr::SetBccList(const</span>
<a href="#l100.99"></a><span id="l100.99">   return SetStringColumn(bccList, m_mdb-&gt;m_bccListColumnToken);</span>
<a href="#l100.100"></a><span id="l100.100"> }</span>
<a href="#l100.101"></a><span id="l100.101"> </span>
<a href="#l100.102"></a><span id="l100.102"> NS_IMETHODIMP</span>
<a href="#l100.103"></a><span id="l100.103"> nsMsgHdr::SetBCCListArray(const char *names,</span>
<a href="#l100.104"></a><span id="l100.104">                           const char *addresses,</span>
<a href="#l100.105"></a><span id="l100.105">                           uint32_t numAddresses)</span>
<a href="#l100.106"></a><span id="l100.106"> {</span>
<a href="#l100.107"></a><span id="l100.107" class="difflineminus">-  nsCAutoString allRecipients;</span>
<a href="#l100.108"></a><span id="l100.108" class="difflineplus">+  nsAutoCString allRecipients;</span>
<a href="#l100.109"></a><span id="l100.109"> </span>
<a href="#l100.110"></a><span id="l100.110">   nsresult rv = BuildRecipientsFromArray(names, addresses, numAddresses,</span>
<a href="#l100.111"></a><span id="l100.111">                                          allRecipients);</span>
<a href="#l100.112"></a><span id="l100.112">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l100.113"></a><span id="l100.113"> </span>
<a href="#l100.114"></a><span id="l100.114">   return SetBccList(allRecipients.get());</span>
<a href="#l100.115"></a><span id="l100.115"> }</span>
<a href="#l100.116"></a><span id="l100.116"> </span>
<a href="#l100.117"></a><span id="l100.117" class="difflineat">@@ -870,17 +870,17 @@ const char *nsMsgHdr::GetNextReference(c</span>
<a href="#l100.118"></a><span id="l100.118">     reference = whitespaceEndedAt;</span>
<a href="#l100.119"></a><span id="l100.119">   return ptr;</span>
<a href="#l100.120"></a><span id="l100.120"> }</span>
<a href="#l100.121"></a><span id="l100.121"> </span>
<a href="#l100.122"></a><span id="l100.122"> bool nsMsgHdr::IsParentOf(nsIMsgDBHdr *possibleChild)</span>
<a href="#l100.123"></a><span id="l100.123"> {</span>
<a href="#l100.124"></a><span id="l100.124">   uint16_t referenceToCheck = 0;</span>
<a href="#l100.125"></a><span id="l100.125">   possibleChild-&gt;GetNumReferences(&amp;referenceToCheck);</span>
<a href="#l100.126"></a><span id="l100.126" class="difflineminus">-  nsCAutoString reference;</span>
<a href="#l100.127"></a><span id="l100.127" class="difflineplus">+  nsAutoCString reference;</span>
<a href="#l100.128"></a><span id="l100.128"> </span>
<a href="#l100.129"></a><span id="l100.129">   nsCString messageId;</span>
<a href="#l100.130"></a><span id="l100.130">   GetMessageId(getter_Copies(messageId));</span>
<a href="#l100.131"></a><span id="l100.131"> </span>
<a href="#l100.132"></a><span id="l100.132">   while (referenceToCheck &gt; 0)</span>
<a href="#l100.133"></a><span id="l100.133">   {</span>
<a href="#l100.134"></a><span id="l100.134">     possibleChild-&gt;GetStringReference(referenceToCheck - 1, reference);</span>
<a href="#l100.135"></a><span id="l100.135"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgOfflineImapOperation.cpp</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -243,17 +243,17 @@ NS_IMETHODIMP nsMsgOfflineImapOperation:</span>
<a href="#l101.4"></a><span id="l101.4">   SetOperation(kRemoveKeywords);</span>
<a href="#l101.5"></a><span id="l101.5">   return AddKeyword(aKeyword, m_keywordsToRemove, PROP_KEYWORD_REMOVE, m_keywordsToAdd, PROP_KEYWORD_ADD);</span>
<a href="#l101.6"></a><span id="l101.6"> }</span>
<a href="#l101.7"></a><span id="l101.7"> </span>
<a href="#l101.8"></a><span id="l101.8"> </span>
<a href="#l101.9"></a><span id="l101.9"> NS_IMETHODIMP nsMsgOfflineImapOperation::AddMessageCopyOperation(const char *destinationBox)</span>
<a href="#l101.10"></a><span id="l101.10"> {</span>
<a href="#l101.11"></a><span id="l101.11">   SetOperation(kMsgCopy);</span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-  nsCAutoString newDest(destinationBox);</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineplus">+  nsAutoCString newDest(destinationBox);</span>
<a href="#l101.14"></a><span id="l101.14">   nsresult rv = GetCopiesFromDB();</span>
<a href="#l101.15"></a><span id="l101.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l101.16"></a><span id="l101.16">   m_copyDestinations.AppendElement(newDest);</span>
<a href="#l101.17"></a><span id="l101.17">   return SetCopiesToDB();</span>
<a href="#l101.18"></a><span id="l101.18"> }</span>
<a href="#l101.19"></a><span id="l101.19"> </span>
<a href="#l101.20"></a><span id="l101.20"> // we write out the folders as one string, separated by 0x1.</span>
<a href="#l101.21"></a><span id="l101.21"> #define FOLDER_SEP_CHAR '\001'</span>
<a href="#l101.22"></a><span id="l101.22" class="difflineat">@@ -281,17 +281,17 @@ nsresult nsMsgOfflineImapOperation::GetC</span>
<a href="#l101.23"></a><span id="l101.23">       m_copyDestinations.AppendElement(curDest);</span>
<a href="#l101.24"></a><span id="l101.24">     }</span>
<a href="#l101.25"></a><span id="l101.25">   }</span>
<a href="#l101.26"></a><span id="l101.26">   return rv;</span>
<a href="#l101.27"></a><span id="l101.27"> }</span>
<a href="#l101.28"></a><span id="l101.28"> </span>
<a href="#l101.29"></a><span id="l101.29"> nsresult nsMsgOfflineImapOperation::SetCopiesToDB()</span>
<a href="#l101.30"></a><span id="l101.30"> {</span>
<a href="#l101.31"></a><span id="l101.31" class="difflineminus">-  nsCAutoString copyDests;</span>
<a href="#l101.32"></a><span id="l101.32" class="difflineplus">+  nsAutoCString copyDests;</span>
<a href="#l101.33"></a><span id="l101.33"> </span>
<a href="#l101.34"></a><span id="l101.34">   // use 0x1 as the delimiter between folders</span>
<a href="#l101.35"></a><span id="l101.35">   for (uint32_t i = 0; i &lt; m_copyDestinations.Length(); i++)</span>
<a href="#l101.36"></a><span id="l101.36">   {</span>
<a href="#l101.37"></a><span id="l101.37">     if (i &gt; 0)</span>
<a href="#l101.38"></a><span id="l101.38">       copyDests.Append(FOLDER_SEP_CHAR);</span>
<a href="#l101.39"></a><span id="l101.39">     copyDests.Append(m_copyDestinations.ElementAt(i));</span>
<a href="#l101.40"></a><span id="l101.40">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -495,33 +495,33 @@ void Tokenizer::addTokenForHeader(const </span>
<a href="#l102.4"></a><span id="l102.4">         }</span>
<a href="#l102.5"></a><span id="l102.5">       }</span>
<a href="#l102.6"></a><span id="l102.6">     }</span>
<a href="#l102.7"></a><span id="l102.7">   }</span>
<a href="#l102.8"></a><span id="l102.8"> }</span>
<a href="#l102.9"></a><span id="l102.9"> </span>
<a href="#l102.10"></a><span id="l102.10"> void Tokenizer::tokenizeAttachment(const char * aContentType, const char * aFileName)</span>
<a href="#l102.11"></a><span id="l102.11"> {</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-  nsCAutoString contentType;</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l102.14"></a><span id="l102.14" class="difflineplus">+  nsAutoCString contentType;</span>
<a href="#l102.15"></a><span id="l102.15" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l102.16"></a><span id="l102.16">   fileName.Assign(aFileName);</span>
<a href="#l102.17"></a><span id="l102.17">   contentType.Assign(aContentType);</span>
<a href="#l102.18"></a><span id="l102.18"> </span>
<a href="#l102.19"></a><span id="l102.19">   // normalize the content type and the file name</span>
<a href="#l102.20"></a><span id="l102.20">   ToLowerCase(fileName);</span>
<a href="#l102.21"></a><span id="l102.21">   ToLowerCase(contentType);</span>
<a href="#l102.22"></a><span id="l102.22">   addTokenForHeader(&quot;attachment/filename&quot;, fileName);</span>
<a href="#l102.23"></a><span id="l102.23"> </span>
<a href="#l102.24"></a><span id="l102.24">   addTokenForHeader(&quot;attachment/content-type&quot;, contentType);</span>
<a href="#l102.25"></a><span id="l102.25"> }</span>
<a href="#l102.26"></a><span id="l102.26"> </span>
<a href="#l102.27"></a><span id="l102.27"> void Tokenizer::tokenizeHeaders(nsIUTF8StringEnumerator * aHeaderNames, nsIUTF8StringEnumerator * aHeaderValues)</span>
<a href="#l102.28"></a><span id="l102.28"> {</span>
<a href="#l102.29"></a><span id="l102.29">   nsCString headerValue;</span>
<a href="#l102.30"></a><span id="l102.30" class="difflineminus">-  nsCAutoString headerName; // we'll be normalizing all header names to lower case</span>
<a href="#l102.31"></a><span id="l102.31" class="difflineplus">+  nsAutoCString headerName; // we'll be normalizing all header names to lower case</span>
<a href="#l102.32"></a><span id="l102.32">   bool hasMore;</span>
<a href="#l102.33"></a><span id="l102.33">  </span>
<a href="#l102.34"></a><span id="l102.34">   while (aHeaderNames-&gt;HasMore(&amp;hasMore), hasMore)</span>
<a href="#l102.35"></a><span id="l102.35">   {</span>
<a href="#l102.36"></a><span id="l102.36">     aHeaderNames-&gt;GetNext(headerName);</span>
<a href="#l102.37"></a><span id="l102.37">     ToLowerCase(headerName);</span>
<a href="#l102.38"></a><span id="l102.38">     aHeaderValues-&gt;GetNext(headerValue);</span>
<a href="#l102.39"></a><span id="l102.39"> </span>
<a href="#l102.40"></a><span id="l102.40" class="difflineat">@@ -858,17 +858,17 @@ void Tokenizer::tokenize(const char* aTe</span>
<a href="#l102.41"></a><span id="l102.41">         }</span>
<a href="#l102.42"></a><span id="l102.42">     }</span>
<a href="#l102.43"></a><span id="l102.43">   }</span>
<a href="#l102.44"></a><span id="l102.44"> }</span>
<a href="#l102.45"></a><span id="l102.45"> </span>
<a href="#l102.46"></a><span id="l102.46"> // helper function to escape \n, \t, etc from a CString</span>
<a href="#l102.47"></a><span id="l102.47"> void Tokenizer::UnescapeCString(nsCString&amp; aCString)</span>
<a href="#l102.48"></a><span id="l102.48"> {</span>
<a href="#l102.49"></a><span id="l102.49" class="difflineminus">-  nsCAutoString result;</span>
<a href="#l102.50"></a><span id="l102.50" class="difflineplus">+  nsAutoCString result;</span>
<a href="#l102.51"></a><span id="l102.51"> </span>
<a href="#l102.52"></a><span id="l102.52">   const char* readEnd = aCString.EndReading();</span>
<a href="#l102.53"></a><span id="l102.53">   char* writeStart = result.BeginWriting();</span>
<a href="#l102.54"></a><span id="l102.54">   char* writeIter = writeStart;</span>
<a href="#l102.55"></a><span id="l102.55"> </span>
<a href="#l102.56"></a><span id="l102.56">   bool inEscape = false;</span>
<a href="#l102.57"></a><span id="l102.57">   for (const char* readIter = aCString.BeginReading(); readIter != readEnd; readIter++)</span>
<a href="#l102.58"></a><span id="l102.58">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -666,17 +666,17 @@ nsresult nsMsgMdnGenerator::CreateSecond</span>
<a href="#l103.4"></a><span id="l103.4">     tmpBuffer = PR_smprintf(&quot;Content-Transfer-Encoding: %s&quot; CRLF CRLF,</span>
<a href="#l103.5"></a><span id="l103.5">                             ENCODING_7BIT);</span>
<a href="#l103.6"></a><span id="l103.6">     PUSH_N_FREE_STRING(tmpBuffer);</span>
<a href="#l103.7"></a><span id="l103.7"> </span>
<a href="#l103.8"></a><span id="l103.8">     nsCOMPtr&lt;nsIHttpProtocolHandler&gt; pHTTPHandler =</span>
<a href="#l103.9"></a><span id="l103.9">         do_GetService(NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX &quot;http&quot;, &amp;rv);</span>
<a href="#l103.10"></a><span id="l103.10">     if (NS_SUCCEEDED(rv) &amp;&amp; pHTTPHandler)</span>
<a href="#l103.11"></a><span id="l103.11">     {</span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-      nsCAutoString userAgentString;</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineplus">+      nsAutoCString userAgentString;</span>
<a href="#l103.14"></a><span id="l103.14">       pHTTPHandler-&gt;GetUserAgent(userAgentString);</span>
<a href="#l103.15"></a><span id="l103.15"> </span>
<a href="#l103.16"></a><span id="l103.16">       if (!userAgentString.IsEmpty())</span>
<a href="#l103.17"></a><span id="l103.17">       {</span>
<a href="#l103.18"></a><span id="l103.18">         // Prepend the product name with the dns name according to RFC 3798.</span>
<a href="#l103.19"></a><span id="l103.19">         char hostName[256];</span>
<a href="#l103.20"></a><span id="l103.20">         PR_GetSystemInfo(PR_SI_HOSTNAME_UNTRUNCATED, hostName, sizeof hostName);</span>
<a href="#l103.21"></a><span id="l103.21">         if ((hostName[0] != '\0') &amp;&amp; (strchr(hostName, '.') != NULL))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -622,17 +622,17 @@ nsresult nsMsgComposeSecure::MimeFinishM</span>
<a href="#l104.4"></a><span id="l104.4">   sMIMEBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;mime_smimeSignatureContentDesc&quot;).get(),</span>
<a href="#l104.5"></a><span id="l104.5">                                  getter_Copies(mime_smime_sig_content_desc));</span>
<a href="#l104.6"></a><span id="l104.6"> </span>
<a href="#l104.7"></a><span id="l104.7">   NS_ConvertUTF16toUTF8 sig_content_desc_utf8(mime_smime_sig_content_desc);</span>
<a href="#l104.8"></a><span id="l104.8"> </span>
<a href="#l104.9"></a><span id="l104.9">   /* Compute the hash...</span>
<a href="#l104.10"></a><span id="l104.10">    */</span>
<a href="#l104.11"></a><span id="l104.11"> </span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-  nsCAutoString hashString;</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+  nsAutoCString hashString;</span>
<a href="#l104.14"></a><span id="l104.14">   mDataHash-&gt;Finish(false, hashString);</span>
<a href="#l104.15"></a><span id="l104.15"> </span>
<a href="#l104.16"></a><span id="l104.16">   mDataHash = 0;</span>
<a href="#l104.17"></a><span id="l104.17"> </span>
<a href="#l104.18"></a><span id="l104.18">   status = PR_GetError();</span>
<a href="#l104.19"></a><span id="l104.19">   if (status &lt; 0) goto FAIL;</span>
<a href="#l104.20"></a><span id="l104.20"> </span>
<a href="#l104.21"></a><span id="l104.21">   /* Write out the headers for the signature.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -623,17 +623,17 @@ NS_IMETHODIMP nsAutoSyncState::DownloadM</span>
<a href="#l105.4"></a><span id="l105.4">   </span>
<a href="#l105.5"></a><span id="l105.5">   uint32_t count;</span>
<a href="#l105.6"></a><span id="l105.6">   nsresult rv = aMessagesList-&gt;GetLength(&amp;count);</span>
<a href="#l105.7"></a><span id="l105.7">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l105.8"></a><span id="l105.8">   </span>
<a href="#l105.9"></a><span id="l105.9">   nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l105.10"></a><span id="l105.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l105.11"></a><span id="l105.11">   </span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-  nsCAutoString messageIds;</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineplus">+  nsAutoCString messageIds;</span>
<a href="#l105.14"></a><span id="l105.14">   nsTArray&lt;nsMsgKey&gt; msgKeys;</span>
<a href="#l105.15"></a><span id="l105.15">   </span>
<a href="#l105.16"></a><span id="l105.16">   rv = nsImapMailFolder::BuildIdsAndKeyArray(aMessagesList, messageIds, msgKeys);  </span>
<a href="#l105.17"></a><span id="l105.17">   if (NS_FAILED(rv) || messageIds.IsEmpty()) </span>
<a href="#l105.18"></a><span id="l105.18">     return rv;</span>
<a href="#l105.19"></a><span id="l105.19"> </span>
<a href="#l105.20"></a><span id="l105.20">   // acquire semaphore for offline store. If it fails, we won't download</span>
<a href="#l105.21"></a><span id="l105.21">   nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryReferent(mOwnerFolder, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -102,17 +102,17 @@ NS_IMETHODIMP nsImapIncomingServer::SetK</span>
<a href="#l106.4"></a><span id="l106.4"> </span>
<a href="#l106.5"></a><span id="l106.5">   nsCString key(aKey);</span>
<a href="#l106.6"></a><span id="l106.6">   hostSession-&gt;AddHostToList(key.get(), this);</span>
<a href="#l106.7"></a><span id="l106.7">   nsMsgImapDeleteModel deleteModel = nsMsgImapDeleteModels::MoveToTrash; // default to trash</span>
<a href="#l106.8"></a><span id="l106.8">   GetDeleteModel(&amp;deleteModel);</span>
<a href="#l106.9"></a><span id="l106.9">   hostSession-&gt;SetDeleteIsMoveToTrashForHost(key.get(), deleteModel == nsMsgImapDeleteModels::MoveToTrash);</span>
<a href="#l106.10"></a><span id="l106.10">   hostSession-&gt;SetShowDeletedMessagesForHost(key.get(), deleteModel == nsMsgImapDeleteModels::IMAPDelete);</span>
<a href="#l106.11"></a><span id="l106.11"> </span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-  nsCAutoString onlineDir;</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineplus">+  nsAutoCString onlineDir;</span>
<a href="#l106.14"></a><span id="l106.14">   rv = GetServerDirectory(onlineDir);</span>
<a href="#l106.15"></a><span id="l106.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.16"></a><span id="l106.16">   if (!onlineDir.IsEmpty())</span>
<a href="#l106.17"></a><span id="l106.17">     hostSession-&gt;SetOnlineDirForHost(key.get(), onlineDir.get());</span>
<a href="#l106.18"></a><span id="l106.18"> </span>
<a href="#l106.19"></a><span id="l106.19">   nsCString personalNamespace;</span>
<a href="#l106.20"></a><span id="l106.20">   nsCString publicNamespace;</span>
<a href="#l106.21"></a><span id="l106.21">   nsCString otherUsersNamespace;</span>
<a href="#l106.22"></a><span id="l106.22" class="difflineat">@@ -140,18 +140,18 @@ NS_IMETHODIMP nsImapIncomingServer::SetK</span>
<a href="#l106.23"></a><span id="l106.23">   return rv;</span>
<a href="#l106.24"></a><span id="l106.24"> }</span>
<a href="#l106.25"></a><span id="l106.25"> </span>
<a href="#l106.26"></a><span id="l106.26"> // construct the pretty name to show to the user if they haven't</span>
<a href="#l106.27"></a><span id="l106.27"> // specified one. This should be overridden for news and mail.</span>
<a href="#l106.28"></a><span id="l106.28"> NS_IMETHODIMP</span>
<a href="#l106.29"></a><span id="l106.29"> nsImapIncomingServer::GetConstructedPrettyName(nsAString&amp; retval)</span>
<a href="#l106.30"></a><span id="l106.30"> {</span>
<a href="#l106.31"></a><span id="l106.31" class="difflineminus">-  nsCAutoString username;</span>
<a href="#l106.32"></a><span id="l106.32" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l106.33"></a><span id="l106.33" class="difflineplus">+  nsAutoCString username;</span>
<a href="#l106.34"></a><span id="l106.34" class="difflineplus">+  nsAutoCString hostName;</span>
<a href="#l106.35"></a><span id="l106.35">   nsresult rv;</span>
<a href="#l106.36"></a><span id="l106.36"> </span>
<a href="#l106.37"></a><span id="l106.37">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l106.38"></a><span id="l106.38">            do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l106.39"></a><span id="l106.39">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l106.40"></a><span id="l106.40"> </span>
<a href="#l106.41"></a><span id="l106.41">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity;</span>
<a href="#l106.42"></a><span id="l106.42">   rv = accountManager-&gt;GetFirstIdentityForServer(this, getter_AddRefs(identity));</span>
<a href="#l106.43"></a><span id="l106.43" class="difflineat">@@ -325,17 +325,17 @@ nsImapIncomingServer::SetDeleteModel(int</span>
<a href="#l106.44"></a><span id="l106.44">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l106.45"></a><span id="l106.45">     hostSession-&gt;SetDeleteIsMoveToTrashForHost(m_serverKey.get(), ivalue == nsMsgImapDeleteModels::MoveToTrash);</span>
<a href="#l106.46"></a><span id="l106.46">     hostSession-&gt;SetShowDeletedMessagesForHost(m_serverKey.get(), ivalue == nsMsgImapDeleteModels::IMAPDelete);</span>
<a href="#l106.47"></a><span id="l106.47"> </span>
<a href="#l106.48"></a><span id="l106.48">     nsAutoString trashFolderName;</span>
<a href="#l106.49"></a><span id="l106.49">     nsresult rv = GetTrashFolderName(trashFolderName);</span>
<a href="#l106.50"></a><span id="l106.50">     if (NS_SUCCEEDED(rv))</span>
<a href="#l106.51"></a><span id="l106.51">     {</span>
<a href="#l106.52"></a><span id="l106.52" class="difflineminus">-      nsCAutoString trashFolderNameUtf7;</span>
<a href="#l106.53"></a><span id="l106.53" class="difflineplus">+      nsAutoCString trashFolderNameUtf7;</span>
<a href="#l106.54"></a><span id="l106.54">       rv = CopyUTF16toMUTF7(trashFolderName, trashFolderNameUtf7);</span>
<a href="#l106.55"></a><span id="l106.55">       if (NS_SUCCEEDED(rv))</span>
<a href="#l106.56"></a><span id="l106.56">       {</span>
<a href="#l106.57"></a><span id="l106.57">         nsCOMPtr&lt;nsIMsgFolder&gt; trashFolder;</span>
<a href="#l106.58"></a><span id="l106.58">         rv = GetFolder(trashFolderNameUtf7, getter_AddRefs(trashFolder));</span>
<a href="#l106.59"></a><span id="l106.59">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.60"></a><span id="l106.60">         nsCString trashURI;</span>
<a href="#l106.61"></a><span id="l106.61">         trashFolder-&gt;GetURI(trashURI);</span>
<a href="#l106.62"></a><span id="l106.62" class="difflineat">@@ -723,30 +723,30 @@ nsImapIncomingServer::GetImapConnection(</span>
<a href="#l106.63"></a><span id="l106.63">     {</span>
<a href="#l106.64"></a><span id="l106.64">       bool badConnection = ConnectionTimeOut(connection);</span>
<a href="#l106.65"></a><span id="l106.65">       if (!badConnection)</span>
<a href="#l106.66"></a><span id="l106.66">       {</span>
<a href="#l106.67"></a><span id="l106.67">         badConnection = NS_FAILED(connection-&gt;CanHandleUrl(aImapUrl,</span>
<a href="#l106.68"></a><span id="l106.68">                                                            &amp;canRunUrlImmediately,</span>
<a href="#l106.69"></a><span id="l106.69">                                                            &amp;canRunButBusy));</span>
<a href="#l106.70"></a><span id="l106.70"> #ifdef DEBUG_bienvenu</span>
<a href="#l106.71"></a><span id="l106.71" class="difflineminus">-        nsCAutoString curSelectedFolderName;</span>
<a href="#l106.72"></a><span id="l106.72" class="difflineplus">+        nsAutoCString curSelectedFolderName;</span>
<a href="#l106.73"></a><span id="l106.73">         if (connection)</span>
<a href="#l106.74"></a><span id="l106.74">           connection-&gt;GetSelectedMailboxName(getter_Copies(curSelectedFolderName));</span>
<a href="#l106.75"></a><span id="l106.75">         // check that no other connection is in the same selected state.</span>
<a href="#l106.76"></a><span id="l106.76">         if (!curSelectedFolderName.IsEmpty())</span>
<a href="#l106.77"></a><span id="l106.77">         {</span>
<a href="#l106.78"></a><span id="l106.78">           for (uint32_t j = 0; j &lt; cnt; j++)</span>
<a href="#l106.79"></a><span id="l106.79">           {</span>
<a href="#l106.80"></a><span id="l106.80">             if (j != i)</span>
<a href="#l106.81"></a><span id="l106.81">             {</span>
<a href="#l106.82"></a><span id="l106.82">               nsCOMPtr&lt;nsIImapProtocol&gt; otherConnection = do_QueryElementAt(m_connectionCache, j);</span>
<a href="#l106.83"></a><span id="l106.83">               if (otherConnection)</span>
<a href="#l106.84"></a><span id="l106.84">               {</span>
<a href="#l106.85"></a><span id="l106.85" class="difflineminus">-                nsCAutoString otherSelectedFolderName;</span>
<a href="#l106.86"></a><span id="l106.86" class="difflineplus">+                nsAutoCString otherSelectedFolderName;</span>
<a href="#l106.87"></a><span id="l106.87">                 otherConnection-&gt;GetSelectedMailboxName(getter_Copies(otherSelectedFolderName));</span>
<a href="#l106.88"></a><span id="l106.88">                 NS_ASSERTION(!curSelectedFolderName.Equals(otherSelectedFolderName), &quot;two connections selected on same folder&quot;);</span>
<a href="#l106.89"></a><span id="l106.89">               }</span>
<a href="#l106.90"></a><span id="l106.90"> </span>
<a href="#l106.91"></a><span id="l106.91">             }</span>
<a href="#l106.92"></a><span id="l106.92">           }</span>
<a href="#l106.93"></a><span id="l106.93">         }</span>
<a href="#l106.94"></a><span id="l106.94"> #endif // DEBUG_bienvenu</span>
<a href="#l106.95"></a><span id="l106.95" class="difflineat">@@ -767,17 +767,17 @@ nsImapIncomingServer::GetImapConnection(</span>
<a href="#l106.96"></a><span id="l106.96">           continue;</span>
<a href="#l106.97"></a><span id="l106.97">         // if max connections is &lt;= 1, we have to re-use the inbox connection.</span>
<a href="#l106.98"></a><span id="l106.98">         if (!isBusy &amp;&amp; (!isInboxConnection || maxConnections &lt;= 1))</span>
<a href="#l106.99"></a><span id="l106.99">         {</span>
<a href="#l106.100"></a><span id="l106.100">           if (!freeConnection)</span>
<a href="#l106.101"></a><span id="l106.101">             freeConnection = connection;</span>
<a href="#l106.102"></a><span id="l106.102">           else  // check which is the better free connection to use.</span>
<a href="#l106.103"></a><span id="l106.103">           {     // We prefer one not in the selected state.</span>
<a href="#l106.104"></a><span id="l106.104" class="difflineminus">-            nsCAutoString selectedFolderName;</span>
<a href="#l106.105"></a><span id="l106.105" class="difflineplus">+            nsAutoCString selectedFolderName;</span>
<a href="#l106.106"></a><span id="l106.106">             connection-&gt;GetSelectedMailboxName(getter_Copies(selectedFolderName));</span>
<a href="#l106.107"></a><span id="l106.107">             if (selectedFolderName.IsEmpty())</span>
<a href="#l106.108"></a><span id="l106.108">               freeConnection = connection;</span>
<a href="#l106.109"></a><span id="l106.109">           }</span>
<a href="#l106.110"></a><span id="l106.110">         }</span>
<a href="#l106.111"></a><span id="l106.111">     }</span>
<a href="#l106.112"></a><span id="l106.112">     // don't leave this loop with connection set if we can't use it!</span>
<a href="#l106.113"></a><span id="l106.113">     if (!canRunButBusy &amp;&amp; !canRunUrlImmediately)</span>
<a href="#l106.114"></a><span id="l106.114" class="difflineat">@@ -1045,17 +1045,17 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l106.115"></a><span id="l106.115"> </span>
<a href="#l106.116"></a><span id="l106.116">   *aNewFolder = false;</span>
<a href="#l106.117"></a><span id="l106.117">   nsCOMPtr&lt;nsIMsgFolder&gt; a_nsIFolder;</span>
<a href="#l106.118"></a><span id="l106.118">   rv = GetRootFolder(getter_AddRefs(a_nsIFolder));</span>
<a href="#l106.119"></a><span id="l106.119"> </span>
<a href="#l106.120"></a><span id="l106.120">   if(NS_FAILED(rv))</span>
<a href="#l106.121"></a><span id="l106.121">     return rv;</span>
<a href="#l106.122"></a><span id="l106.122"> </span>
<a href="#l106.123"></a><span id="l106.123" class="difflineminus">-  nsCAutoString dupFolderPath(folderPath);</span>
<a href="#l106.124"></a><span id="l106.124" class="difflineplus">+  nsAutoCString dupFolderPath(folderPath);</span>
<a href="#l106.125"></a><span id="l106.125">   if (dupFolderPath.Last() == '/')</span>
<a href="#l106.126"></a><span id="l106.126">   {</span>
<a href="#l106.127"></a><span id="l106.127">     dupFolderPath.SetLength(dupFolderPath.Length()-1);</span>
<a href="#l106.128"></a><span id="l106.128">     if (dupFolderPath.IsEmpty())</span>
<a href="#l106.129"></a><span id="l106.129">       return NS_ERROR_FAILURE;</span>
<a href="#l106.130"></a><span id="l106.130">     // *** this is what we did in 4.x in order to list uw folder only</span>
<a href="#l106.131"></a><span id="l106.131">     // mailbox in order to get the \NoSelect flag</span>
<a href="#l106.132"></a><span id="l106.132">     explicitlyVerify = !(boxFlags &amp; kNameSpace);</span>
<a href="#l106.133"></a><span id="l106.133" class="difflineat">@@ -1085,18 +1085,18 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l106.134"></a><span id="l106.134">       return rv;</span>
<a href="#l106.135"></a><span id="l106.135">     }</span>
<a href="#l106.136"></a><span id="l106.136">   }</span>
<a href="#l106.137"></a><span id="l106.137"> </span>
<a href="#l106.138"></a><span id="l106.138">   hostFolder = do_QueryInterface(a_nsIFolder, &amp;rv);</span>
<a href="#l106.139"></a><span id="l106.139">   if (NS_FAILED(rv))</span>
<a href="#l106.140"></a><span id="l106.140">     return rv;</span>
<a href="#l106.141"></a><span id="l106.141"> </span>
<a href="#l106.142"></a><span id="l106.142" class="difflineminus">-  nsCAutoString tempFolderName(dupFolderPath);</span>
<a href="#l106.143"></a><span id="l106.143" class="difflineminus">-  nsCAutoString tokenStr, remStr, changedStr;</span>
<a href="#l106.144"></a><span id="l106.144" class="difflineplus">+  nsAutoCString tempFolderName(dupFolderPath);</span>
<a href="#l106.145"></a><span id="l106.145" class="difflineplus">+  nsAutoCString tokenStr, remStr, changedStr;</span>
<a href="#l106.146"></a><span id="l106.146">   int32_t slashPos = tempFolderName.FindChar('/');</span>
<a href="#l106.147"></a><span id="l106.147">   if (slashPos &gt; 0)</span>
<a href="#l106.148"></a><span id="l106.148">   {</span>
<a href="#l106.149"></a><span id="l106.149">     tokenStr = StringHead(tempFolderName, slashPos);</span>
<a href="#l106.150"></a><span id="l106.150">     remStr = Substring(tempFolderName, slashPos);</span>
<a href="#l106.151"></a><span id="l106.151">   }</span>
<a href="#l106.152"></a><span id="l106.152">   else</span>
<a href="#l106.153"></a><span id="l106.153">     tokenStr.Assign(tempFolderName);</span>
<a href="#l106.154"></a><span id="l106.154" class="difflineat">@@ -1105,25 +1105,25 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l106.155"></a><span id="l106.155">     changedStr.Append(&quot;INBOX&quot;);</span>
<a href="#l106.156"></a><span id="l106.156">   else</span>
<a href="#l106.157"></a><span id="l106.157">     changedStr.Append(tokenStr);</span>
<a href="#l106.158"></a><span id="l106.158"> </span>
<a href="#l106.159"></a><span id="l106.159">   if (slashPos &gt; 0 )</span>
<a href="#l106.160"></a><span id="l106.160">     changedStr.Append(remStr);</span>
<a href="#l106.161"></a><span id="l106.161"> </span>
<a href="#l106.162"></a><span id="l106.162">   dupFolderPath.Assign(changedStr);</span>
<a href="#l106.163"></a><span id="l106.163" class="difflineminus">-  nsCAutoString folderName(dupFolderPath);</span>
<a href="#l106.164"></a><span id="l106.164" class="difflineminus">-</span>
<a href="#l106.165"></a><span id="l106.165" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l106.166"></a><span id="l106.166" class="difflineplus">+  nsAutoCString folderName(dupFolderPath);</span>
<a href="#l106.167"></a><span id="l106.167" class="difflineplus">+</span>
<a href="#l106.168"></a><span id="l106.168" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l106.169"></a><span id="l106.169">   nsCString serverUri;</span>
<a href="#l106.170"></a><span id="l106.170">   GetServerURI(serverUri);</span>
<a href="#l106.171"></a><span id="l106.171">   uri.Assign(serverUri);</span>
<a href="#l106.172"></a><span id="l106.172">   int32_t leafPos = folderName.RFindChar('/');</span>
<a href="#l106.173"></a><span id="l106.173" class="difflineminus">-  nsCAutoString parentName(folderName);</span>
<a href="#l106.174"></a><span id="l106.174" class="difflineminus">-  nsCAutoString parentUri(uri);</span>
<a href="#l106.175"></a><span id="l106.175" class="difflineplus">+  nsAutoCString parentName(folderName);</span>
<a href="#l106.176"></a><span id="l106.176" class="difflineplus">+  nsAutoCString parentUri(uri);</span>
<a href="#l106.177"></a><span id="l106.177"> </span>
<a href="#l106.178"></a><span id="l106.178">   if (leafPos &gt; 0)</span>
<a href="#l106.179"></a><span id="l106.179">   {</span>
<a href="#l106.180"></a><span id="l106.180">     // If there is a hierarchy, there is a parent.</span>
<a href="#l106.181"></a><span id="l106.181">     // Don't strip off slash if it's the first character</span>
<a href="#l106.182"></a><span id="l106.182">     parentName.SetLength(leafPos);</span>
<a href="#l106.183"></a><span id="l106.183">     folderName.Cut(0, leafPos + 1);	// get rid of the parent name</span>
<a href="#l106.184"></a><span id="l106.184">     haveParent = true;</span>
<a href="#l106.185"></a><span id="l106.185" class="difflineat">@@ -1169,17 +1169,17 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l106.186"></a><span id="l106.186">     caseInsensitive = MsgLowerCaseEqualsLiteral(dupFolderPath, &quot;inbox&quot;);</span>
<a href="#l106.187"></a><span id="l106.187">     a_nsIFolder-&gt;GetChildWithURI(uri, true, caseInsensitive, getter_AddRefs(child));</span>
<a href="#l106.188"></a><span id="l106.188">   }</span>
<a href="#l106.189"></a><span id="l106.189">   if (child)</span>
<a href="#l106.190"></a><span id="l106.190">   {</span>
<a href="#l106.191"></a><span id="l106.191">     nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(child);</span>
<a href="#l106.192"></a><span id="l106.192">     if (imapFolder)</span>
<a href="#l106.193"></a><span id="l106.193">     {</span>
<a href="#l106.194"></a><span id="l106.194" class="difflineminus">-      nsCAutoString onlineName;</span>
<a href="#l106.195"></a><span id="l106.195" class="difflineplus">+      nsAutoCString onlineName;</span>
<a href="#l106.196"></a><span id="l106.196">       nsAutoString unicodeName;</span>
<a href="#l106.197"></a><span id="l106.197">       imapFolder-&gt;SetVerifiedAsOnlineFolder(true);</span>
<a href="#l106.198"></a><span id="l106.198">       imapFolder-&gt;SetHierarchyDelimiter(hierarchyDelimiter);</span>
<a href="#l106.199"></a><span id="l106.199">       if (boxFlags &amp; kImapTrash)</span>
<a href="#l106.200"></a><span id="l106.200">       {</span>
<a href="#l106.201"></a><span id="l106.201">         int32_t deleteModel;</span>
<a href="#l106.202"></a><span id="l106.202">         GetDeleteModel(&amp;deleteModel);</span>
<a href="#l106.203"></a><span id="l106.203">         if (deleteModel == nsMsgImapDeleteModels::MoveToTrash)</span>
<a href="#l106.204"></a><span id="l106.204" class="difflineat">@@ -1289,17 +1289,17 @@ nsresult nsImapIncomingServer::GetFolder</span>
<a href="#l106.205"></a><span id="l106.205">   nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l106.206"></a><span id="l106.206">   rv = GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l106.207"></a><span id="l106.207">   if (NS_SUCCEEDED(rv) &amp;&amp; rootFolder)</span>
<a href="#l106.208"></a><span id="l106.208">   {</span>
<a href="#l106.209"></a><span id="l106.209">     nsCString uri;</span>
<a href="#l106.210"></a><span id="l106.210">     rv = rootFolder-&gt;GetURI(uri);</span>
<a href="#l106.211"></a><span id="l106.211">     if (NS_SUCCEEDED(rv) &amp;&amp; !uri.IsEmpty())</span>
<a href="#l106.212"></a><span id="l106.212">     {</span>
<a href="#l106.213"></a><span id="l106.213" class="difflineminus">-      nsCAutoString uriString(uri);</span>
<a href="#l106.214"></a><span id="l106.214" class="difflineplus">+      nsAutoCString uriString(uri);</span>
<a href="#l106.215"></a><span id="l106.215">       uriString.Append('/');</span>
<a href="#l106.216"></a><span id="l106.216">       uriString.Append(name);</span>
<a href="#l106.217"></a><span id="l106.217">       nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l106.218"></a><span id="l106.218">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.219"></a><span id="l106.219">       nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l106.220"></a><span id="l106.220">       rv = rdf-&gt;GetResource(uriString, getter_AddRefs(res));</span>
<a href="#l106.221"></a><span id="l106.221">       if (NS_SUCCEEDED(rv))</span>
<a href="#l106.222"></a><span id="l106.222">       {</span>
<a href="#l106.223"></a><span id="l106.223" class="difflineat">@@ -1780,17 +1780,17 @@ bool nsImapIncomingServer::AllDescendent</span>
<a href="#l106.224"></a><span id="l106.224"> #endif // 0</span>
<a href="#l106.225"></a><span id="l106.225">   return allDescendentsAreNoSelect;</span>
<a href="#l106.226"></a><span id="l106.226"> }</span>
<a href="#l106.227"></a><span id="l106.227"> </span>
<a href="#l106.228"></a><span id="l106.228"> NS_IMETHODIMP</span>
<a href="#l106.229"></a><span id="l106.229"> nsImapIncomingServer::PromptLoginFailed(nsIMsgWindow *aMsgWindow,</span>
<a href="#l106.230"></a><span id="l106.230">                                         int32_t *aResult)</span>
<a href="#l106.231"></a><span id="l106.231"> {</span>
<a href="#l106.232"></a><span id="l106.232" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l106.233"></a><span id="l106.233" class="difflineplus">+  nsAutoCString hostName;</span>
<a href="#l106.234"></a><span id="l106.234">   GetRealHostName(hostName);</span>
<a href="#l106.235"></a><span id="l106.235"> </span>
<a href="#l106.236"></a><span id="l106.236">   return MsgPromptLoginFailed(aMsgWindow, hostName, aResult);</span>
<a href="#l106.237"></a><span id="l106.237"> }</span>
<a href="#l106.238"></a><span id="l106.238"> </span>
<a href="#l106.239"></a><span id="l106.239"> NS_IMETHODIMP</span>
<a href="#l106.240"></a><span id="l106.240"> nsImapIncomingServer::FEAlert(const nsAString&amp; aString, nsIMsgMailNewsUrl *aUrl)</span>
<a href="#l106.241"></a><span id="l106.241"> {</span>
<a href="#l106.242"></a><span id="l106.242" class="difflineat">@@ -2442,17 +2442,17 @@ nsImapIncomingServer::AddTo(const nsACSt</span>
<a href="#l106.243"></a><span id="l106.243"> </span>
<a href="#l106.244"></a><span id="l106.244">   // RFC 3501 allows UTF-8 in addition to modified UTF-7</span>
<a href="#l106.245"></a><span id="l106.245">   // If it's not UTF-8, it cannot be MUTF7, either. We just ignore it.</span>
<a href="#l106.246"></a><span id="l106.246">   // (otherwise we'll crash. see #63186)</span>
<a href="#l106.247"></a><span id="l106.247">   if (!MsgIsUTF8(aName))</span>
<a href="#l106.248"></a><span id="l106.248">     return NS_OK;</span>
<a href="#l106.249"></a><span id="l106.249"> </span>
<a href="#l106.250"></a><span id="l106.250">   if (!NS_IsAscii(aName.BeginReading(), aName.Length())) {</span>
<a href="#l106.251"></a><span id="l106.251" class="difflineminus">-    nsCAutoString name;</span>
<a href="#l106.252"></a><span id="l106.252" class="difflineplus">+    nsAutoCString name;</span>
<a href="#l106.253"></a><span id="l106.253">     CopyUTF16toMUTF7(NS_ConvertUTF8toUTF16(aName), name);</span>
<a href="#l106.254"></a><span id="l106.254">     return mInner-&gt;AddTo(name, addAsSubscribed, aSubscribable, changeIfExists);</span>
<a href="#l106.255"></a><span id="l106.255">   }</span>
<a href="#l106.256"></a><span id="l106.256">   return mInner-&gt;AddTo(aName, addAsSubscribed, aSubscribable, changeIfExists);</span>
<a href="#l106.257"></a><span id="l106.257"> }</span>
<a href="#l106.258"></a><span id="l106.258"> </span>
<a href="#l106.259"></a><span id="l106.259"> NS_IMETHODIMP</span>
<a href="#l106.260"></a><span id="l106.260"> nsImapIncomingServer::StopPopulating(nsIMsgWindow *aMsgWindow)</span>
<a href="#l106.261"></a><span id="l106.261" class="difflineat">@@ -2700,17 +2700,17 @@ nsImapIncomingServer::GetCanEmptyTrashOn</span>
<a href="#l106.262"></a><span id="l106.262">   NS_ENSURE_ARG_POINTER(canEmptyTrashOnExit);</span>
<a href="#l106.263"></a><span id="l106.263">   // Initialize canEmptyTrashOnExit true, a default value for IMAP</span>
<a href="#l106.264"></a><span id="l106.264">   *canEmptyTrashOnExit = true;</span>
<a href="#l106.265"></a><span id="l106.265">   GetPrefForServerAttribute(&quot;canEmptyTrashOnExit&quot;, canEmptyTrashOnExit);</span>
<a href="#l106.266"></a><span id="l106.266">   return NS_OK;</span>
<a href="#l106.267"></a><span id="l106.267"> }</span>
<a href="#l106.268"></a><span id="l106.268"> </span>
<a href="#l106.269"></a><span id="l106.269"> nsresult</span>
<a href="#l106.270"></a><span id="l106.270" class="difflineminus">-nsImapIncomingServer::CreateHostSpecificPrefName(const char *prefPrefix, nsCAutoString &amp;prefName)</span>
<a href="#l106.271"></a><span id="l106.271" class="difflineplus">+nsImapIncomingServer::CreateHostSpecificPrefName(const char *prefPrefix, nsAutoCString &amp;prefName)</span>
<a href="#l106.272"></a><span id="l106.272"> {</span>
<a href="#l106.273"></a><span id="l106.273">   NS_ENSURE_ARG_POINTER(prefPrefix);</span>
<a href="#l106.274"></a><span id="l106.274"> </span>
<a href="#l106.275"></a><span id="l106.275">   nsCString hostName;</span>
<a href="#l106.276"></a><span id="l106.276">   nsresult rv = GetHostName(hostName);</span>
<a href="#l106.277"></a><span id="l106.277">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l106.278"></a><span id="l106.278"> </span>
<a href="#l106.279"></a><span id="l106.279">   prefName = prefPrefix;</span>
<a href="#l106.280"></a><span id="l106.280" class="difflineat">@@ -2718,17 +2718,17 @@ nsImapIncomingServer::CreateHostSpecific</span>
<a href="#l106.281"></a><span id="l106.281">   prefName.Append(hostName);</span>
<a href="#l106.282"></a><span id="l106.282">   return NS_OK;</span>
<a href="#l106.283"></a><span id="l106.283"> }</span>
<a href="#l106.284"></a><span id="l106.284"> </span>
<a href="#l106.285"></a><span id="l106.285"> NS_IMETHODIMP</span>
<a href="#l106.286"></a><span id="l106.286"> nsImapIncomingServer::GetSupportsDiskSpace(bool *aSupportsDiskSpace)</span>
<a href="#l106.287"></a><span id="l106.287"> {</span>
<a href="#l106.288"></a><span id="l106.288">   NS_ENSURE_ARG_POINTER(aSupportsDiskSpace);</span>
<a href="#l106.289"></a><span id="l106.289" class="difflineminus">-  nsCAutoString prefName;</span>
<a href="#l106.290"></a><span id="l106.290" class="difflineplus">+  nsAutoCString prefName;</span>
<a href="#l106.291"></a><span id="l106.291">   nsresult rv = CreateHostSpecificPrefName(&quot;default_supports_diskspace&quot;, prefName);</span>
<a href="#l106.292"></a><span id="l106.292">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l106.293"></a><span id="l106.293"> </span>
<a href="#l106.294"></a><span id="l106.294">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l106.295"></a><span id="l106.295">   if (NS_SUCCEEDED(rv))</span>
<a href="#l106.296"></a><span id="l106.296">      rv = prefBranch-&gt;GetBoolPref(prefName.get(), aSupportsDiskSpace);</span>
<a href="#l106.297"></a><span id="l106.297"> </span>
<a href="#l106.298"></a><span id="l106.298">   // Couldn't get the default value with the hostname.</span>
<a href="#l106.299"></a><span id="l106.299" class="difflineat">@@ -2793,17 +2793,17 @@ nsImapIncomingServer::GetOfflineSupportL</span>
<a href="#l106.300"></a><span id="l106.300"> {</span>
<a href="#l106.301"></a><span id="l106.301">   NS_ENSURE_ARG_POINTER(aSupportLevel);</span>
<a href="#l106.302"></a><span id="l106.302">   nsresult rv = NS_OK;</span>
<a href="#l106.303"></a><span id="l106.303"> </span>
<a href="#l106.304"></a><span id="l106.304">   rv = GetIntValue(&quot;offline_support_level&quot;, aSupportLevel);</span>
<a href="#l106.305"></a><span id="l106.305">   if (*aSupportLevel != OFFLINE_SUPPORT_LEVEL_UNDEFINED)</span>
<a href="#l106.306"></a><span id="l106.306">     return rv;</span>
<a href="#l106.307"></a><span id="l106.307"> </span>
<a href="#l106.308"></a><span id="l106.308" class="difflineminus">-  nsCAutoString prefName;</span>
<a href="#l106.309"></a><span id="l106.309" class="difflineplus">+  nsAutoCString prefName;</span>
<a href="#l106.310"></a><span id="l106.310">   rv = CreateHostSpecificPrefName(&quot;default_offline_support_level&quot;, prefName);</span>
<a href="#l106.311"></a><span id="l106.311">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l106.312"></a><span id="l106.312"> </span>
<a href="#l106.313"></a><span id="l106.313">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l106.314"></a><span id="l106.314">   if (NS_SUCCEEDED(rv))</span>
<a href="#l106.315"></a><span id="l106.315">     rv = prefBranch-&gt;GetIntPref(prefName.get(), aSupportLevel);</span>
<a href="#l106.316"></a><span id="l106.316"> </span>
<a href="#l106.317"></a><span id="l106.317">   // Couldn't get the pref value with the hostname.</span>
<a href="#l106.318"></a><span id="l106.318" class="difflineat">@@ -3098,46 +3098,46 @@ nsImapIncomingServer::OnUserOrHostNameCh</span>
<a href="#l106.319"></a><span id="l106.319">   // 1. Do common things in the base class.</span>
<a href="#l106.320"></a><span id="l106.320">   rv = nsMsgIncomingServer::OnUserOrHostNameChanged(oldName, newName, hostnameChanged);</span>
<a href="#l106.321"></a><span id="l106.321">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l106.322"></a><span id="l106.322"> </span>
<a href="#l106.323"></a><span id="l106.323">   // 2. Reset 'HaveWeEverDiscoveredFolders' flag so the new folder list can be</span>
<a href="#l106.324"></a><span id="l106.324">   //    reloaded (ie, DiscoverMailboxList() will be invoked in nsImapProtocol).</span>
<a href="#l106.325"></a><span id="l106.325">   nsCOMPtr&lt;nsIImapHostSessionList&gt; hostSessionList = do_GetService(kCImapHostSessionListCID, &amp;rv);</span>
<a href="#l106.326"></a><span id="l106.326">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.327"></a><span id="l106.327" class="difflineminus">-  nsCAutoString serverKey;</span>
<a href="#l106.328"></a><span id="l106.328" class="difflineplus">+  nsAutoCString serverKey;</span>
<a href="#l106.329"></a><span id="l106.329">   rv = GetKey(serverKey);</span>
<a href="#l106.330"></a><span id="l106.330">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.331"></a><span id="l106.331">   hostSessionList-&gt;SetHaveWeEverDiscoveredFoldersForHost(serverKey.get(), false);</span>
<a href="#l106.332"></a><span id="l106.332">   // 3. Make all the existing folders 'unverified' so that they can be</span>
<a href="#l106.333"></a><span id="l106.333">   //    removed from the folder pane after users log into the new server.</span>
<a href="#l106.334"></a><span id="l106.334">   ResetFoldersToUnverified(nullptr);</span>
<a href="#l106.335"></a><span id="l106.335">   return NS_OK;</span>
<a href="#l106.336"></a><span id="l106.336"> }</span>
<a href="#l106.337"></a><span id="l106.337"> </span>
<a href="#l106.338"></a><span id="l106.338"> // use canonical format in originalUri &amp; convertedUri</span>
<a href="#l106.339"></a><span id="l106.339"> NS_IMETHODIMP</span>
<a href="#l106.340"></a><span id="l106.340"> nsImapIncomingServer::GetUriWithNamespacePrefixIfNecessary(int32_t namespaceType,</span>
<a href="#l106.341"></a><span id="l106.341">                                                            const nsACString&amp; originalUri,</span>
<a href="#l106.342"></a><span id="l106.342">                                                            nsACString&amp; convertedUri)</span>
<a href="#l106.343"></a><span id="l106.343"> {</span>
<a href="#l106.344"></a><span id="l106.344">   nsresult rv = NS_OK;</span>
<a href="#l106.345"></a><span id="l106.345" class="difflineminus">-  nsCAutoString serverKey;</span>
<a href="#l106.346"></a><span id="l106.346" class="difflineplus">+  nsAutoCString serverKey;</span>
<a href="#l106.347"></a><span id="l106.347">   rv = GetKey(serverKey);</span>
<a href="#l106.348"></a><span id="l106.348">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.349"></a><span id="l106.349">   nsCOMPtr&lt;nsIImapHostSessionList&gt; hostSessionList = do_GetService(kCImapHostSessionListCID, &amp;rv);</span>
<a href="#l106.350"></a><span id="l106.350">   nsIMAPNamespace *ns = nullptr;</span>
<a href="#l106.351"></a><span id="l106.351">   rv = hostSessionList-&gt;GetDefaultNamespaceOfTypeForHost(serverKey.get(), (EIMAPNamespaceType)namespaceType, ns);</span>
<a href="#l106.352"></a><span id="l106.352">   if (ns)</span>
<a href="#l106.353"></a><span id="l106.353">   {</span>
<a href="#l106.354"></a><span id="l106.354" class="difflineminus">-    nsCAutoString namespacePrefix(ns-&gt;GetPrefix());</span>
<a href="#l106.355"></a><span id="l106.355" class="difflineplus">+    nsAutoCString namespacePrefix(ns-&gt;GetPrefix());</span>
<a href="#l106.356"></a><span id="l106.356">     if (!namespacePrefix.IsEmpty())</span>
<a href="#l106.357"></a><span id="l106.357">     {</span>
<a href="#l106.358"></a><span id="l106.358">       // check if namespacePrefix is the same as the online directory; if so, ignore it.</span>
<a href="#l106.359"></a><span id="l106.359" class="difflineminus">-      nsCAutoString onlineDir;</span>
<a href="#l106.360"></a><span id="l106.360" class="difflineplus">+      nsAutoCString onlineDir;</span>
<a href="#l106.361"></a><span id="l106.361">       rv = GetServerDirectory(onlineDir);</span>
<a href="#l106.362"></a><span id="l106.362">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l106.363"></a><span id="l106.363">       if (!onlineDir.IsEmpty())</span>
<a href="#l106.364"></a><span id="l106.364">       {</span>
<a href="#l106.365"></a><span id="l106.365">         char delimiter = ns-&gt;GetDelimiter();</span>
<a href="#l106.366"></a><span id="l106.366">           if ( onlineDir.Last() != delimiter )</span>
<a href="#l106.367"></a><span id="l106.367">             onlineDir += delimiter;</span>
<a href="#l106.368"></a><span id="l106.368">           if (onlineDir.Equals(namespacePrefix))</span>
<a href="#l106.369"></a><span id="l106.369" class="difflineat">@@ -3172,17 +3172,17 @@ NS_IMETHODIMP nsImapIncomingServer::GetT</span>
<a href="#l106.370"></a><span id="l106.370"> </span>
<a href="#l106.371"></a><span id="l106.371"> NS_IMETHODIMP nsImapIncomingServer::SetTrashFolderName(const nsAString&amp; chvalue)</span>
<a href="#l106.372"></a><span id="l106.372"> {</span>
<a href="#l106.373"></a><span id="l106.373">   // clear trash flag from the old pref</span>
<a href="#l106.374"></a><span id="l106.374">   nsAutoString oldTrashName;</span>
<a href="#l106.375"></a><span id="l106.375">   nsresult rv = GetTrashFolderName(oldTrashName);</span>
<a href="#l106.376"></a><span id="l106.376">   if (NS_SUCCEEDED(rv))</span>
<a href="#l106.377"></a><span id="l106.377">   {</span>
<a href="#l106.378"></a><span id="l106.378" class="difflineminus">-    nsCAutoString oldTrashNameUtf7;</span>
<a href="#l106.379"></a><span id="l106.379" class="difflineplus">+    nsAutoCString oldTrashNameUtf7;</span>
<a href="#l106.380"></a><span id="l106.380">     rv = CopyUTF16toMUTF7(oldTrashName, oldTrashNameUtf7);</span>
<a href="#l106.381"></a><span id="l106.381">     if (NS_SUCCEEDED(rv))</span>
<a href="#l106.382"></a><span id="l106.382">     {</span>
<a href="#l106.383"></a><span id="l106.383">       nsCOMPtr&lt;nsIMsgFolder&gt; oldFolder;</span>
<a href="#l106.384"></a><span id="l106.384">       rv = GetFolder(oldTrashNameUtf7, getter_AddRefs(oldFolder));</span>
<a href="#l106.385"></a><span id="l106.385">       if (NS_SUCCEEDED(rv) &amp;&amp; oldFolder)</span>
<a href="#l106.386"></a><span id="l106.386">         oldFolder-&gt;ClearFlag(nsMsgFolderFlags::Trash);</span>
<a href="#l106.387"></a><span id="l106.387">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.h</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.h</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -84,17 +84,17 @@ protected:</span>
<a href="#l107.4"></a><span id="l107.4">   nsString GetImapStringByName(const nsString &amp;aName);</span>
<a href="#l107.5"></a><span id="l107.5">   static nsresult AlertUser(const nsAString&amp; aString, nsIMsgMailNewsUrl *aUrl);</span>
<a href="#l107.6"></a><span id="l107.6"> </span>
<a href="#l107.7"></a><span id="l107.7"> private:</span>
<a href="#l107.8"></a><span id="l107.8">   nsresult SubscribeToFolder(const PRUnichar *aName, bool subscribe);</span>
<a href="#l107.9"></a><span id="l107.9">   nsresult GetImapConnection(nsIImapUrl* aImapUrl,</span>
<a href="#l107.10"></a><span id="l107.10">                              nsIImapProtocol** aImapConnection);</span>
<a href="#l107.11"></a><span id="l107.11">   nsresult CreateProtocolInstance(nsIImapProtocol ** aImapConnection);</span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-  nsresult CreateHostSpecificPrefName(const char *prefPrefix, nsCAutoString &amp;prefName);</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineplus">+  nsresult CreateHostSpecificPrefName(const char *prefPrefix, nsAutoCString &amp;prefName);</span>
<a href="#l107.14"></a><span id="l107.14"> </span>
<a href="#l107.15"></a><span id="l107.15">   nsresult DoomUrlIfChannelHasError(nsIImapUrl *aImapUrl, bool *urlDoomed);</span>
<a href="#l107.16"></a><span id="l107.16">   bool ConnectionTimeOut(nsIImapProtocol* aImapConnection);</span>
<a href="#l107.17"></a><span id="l107.17">   nsresult GetFormattedStringFromID(const nsAString&amp; aValue, int32_t aID, nsAString&amp; aResult);</span>
<a href="#l107.18"></a><span id="l107.18">   nsresult GetPrefForServerAttribute(const char *prefSuffix, bool *prefValue);</span>
<a href="#l107.19"></a><span id="l107.19">   bool CheckSpecialFolder(nsIRDFService *rdf, nsCString &amp;folderUri,</span>
<a href="#l107.20"></a><span id="l107.20">                             uint32_t folderFlag, nsCString &amp;existingUri);</span>
<a href="#l107.21"></a><span id="l107.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -278,23 +278,23 @@ NS_IMETHODIMP nsImapMailFolder::AddSubfo</span>
<a href="#l108.4"></a><span id="l108.4"> {</span>
<a href="#l108.5"></a><span id="l108.5">   NS_ENSURE_ARG_POINTER(aChild);</span>
<a href="#l108.6"></a><span id="l108.6"> </span>
<a href="#l108.7"></a><span id="l108.7">   int32_t flags = 0;</span>
<a href="#l108.8"></a><span id="l108.8">   nsresult rv;</span>
<a href="#l108.9"></a><span id="l108.9">   nsCOMPtr&lt;nsIRDFService&gt; rdf = do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;, &amp;rv);</span>
<a href="#l108.10"></a><span id="l108.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l108.11"></a><span id="l108.11"> </span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-  nsCAutoString uri(mURI);</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+  nsAutoCString uri(mURI);</span>
<a href="#l108.14"></a><span id="l108.14">   uri.Append('/');</span>
<a href="#l108.15"></a><span id="l108.15"> </span>
<a href="#l108.16"></a><span id="l108.16">   // If AddSubFolder starts getting called for folders other than virtual folders,</span>
<a href="#l108.17"></a><span id="l108.17">   // we'll have to do convert those names to modified utf-7. For now, the account manager code</span>
<a href="#l108.18"></a><span id="l108.18">   // that loads the virtual folders for each account, expects utf8 not modified utf-7.</span>
<a href="#l108.19"></a><span id="l108.19" class="difflineminus">-  nsCAutoString escapedName;</span>
<a href="#l108.20"></a><span id="l108.20" class="difflineplus">+  nsAutoCString escapedName;</span>
<a href="#l108.21"></a><span id="l108.21">   rv = NS_MsgEscapeEncodeURLPath(aName, escapedName);</span>
<a href="#l108.22"></a><span id="l108.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.23"></a><span id="l108.23"> </span>
<a href="#l108.24"></a><span id="l108.24">   uri += escapedName.get();</span>
<a href="#l108.25"></a><span id="l108.25"> </span>
<a href="#l108.26"></a><span id="l108.26">   nsCOMPtr &lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l108.27"></a><span id="l108.27">   rv = GetChildWithURI(uri, false/*deep*/, true /*case Insensitive*/, getter_AddRefs(msgFolder));</span>
<a href="#l108.28"></a><span id="l108.28">   if (NS_SUCCEEDED(rv) &amp;&amp; msgFolder)</span>
<a href="#l108.29"></a><span id="l108.29" class="difflineat">@@ -348,17 +348,17 @@ nsresult nsImapMailFolder::AddSubfolderW</span>
<a href="#l108.30"></a><span id="l108.30"> {</span>
<a href="#l108.31"></a><span id="l108.31">   NS_ENSURE_ARG_POINTER(child);</span>
<a href="#l108.32"></a><span id="l108.32"> </span>
<a href="#l108.33"></a><span id="l108.33">   nsresult rv;</span>
<a href="#l108.34"></a><span id="l108.34">   nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l108.35"></a><span id="l108.35">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.36"></a><span id="l108.36">   int32_t flags = 0;</span>
<a href="#l108.37"></a><span id="l108.37"> </span>
<a href="#l108.38"></a><span id="l108.38" class="difflineminus">-  nsCAutoString uri(mURI);</span>
<a href="#l108.39"></a><span id="l108.39" class="difflineplus">+  nsAutoCString uri(mURI);</span>
<a href="#l108.40"></a><span id="l108.40">   uri.Append('/');</span>
<a href="#l108.41"></a><span id="l108.41">   AppendUTF16toUTF8(name, uri);</span>
<a href="#l108.42"></a><span id="l108.42"> </span>
<a href="#l108.43"></a><span id="l108.43">   bool isServer;</span>
<a href="#l108.44"></a><span id="l108.44">   rv = GetIsServer(&amp;isServer);</span>
<a href="#l108.45"></a><span id="l108.45">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.46"></a><span id="l108.46"> </span>
<a href="#l108.47"></a><span id="l108.47">   bool isInbox = isServer &amp;&amp; name.LowerCaseEqualsLiteral(&quot;inbox&quot;);</span>
<a href="#l108.48"></a><span id="l108.48" class="difflineat">@@ -703,17 +703,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateFo</span>
<a href="#l108.49"></a><span id="l108.49">                                            getter_AddRefs(term));</span>
<a href="#l108.50"></a><span id="l108.50">           nsMsgSearchAttribValue attrib;</span>
<a href="#l108.51"></a><span id="l108.51">           rv = term-&gt;GetAttrib(&amp;attrib);</span>
<a href="#l108.52"></a><span id="l108.52">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.53"></a><span id="l108.53">           if (attrib == nsMsgSearchAttrib::Body)</span>
<a href="#l108.54"></a><span id="l108.54">             m_filterListRequiresBody = true;</span>
<a href="#l108.55"></a><span id="l108.55">           else if (attrib == nsMsgSearchAttrib::Custom)</span>
<a href="#l108.56"></a><span id="l108.56">           {</span>
<a href="#l108.57"></a><span id="l108.57" class="difflineminus">-            nsCAutoString customId;</span>
<a href="#l108.58"></a><span id="l108.58" class="difflineplus">+            nsAutoCString customId;</span>
<a href="#l108.59"></a><span id="l108.59">             rv = term-&gt;GetCustomId(customId);</span>
<a href="#l108.60"></a><span id="l108.60">             nsCOMPtr&lt;nsIMsgSearchCustomTerm&gt; customTerm;</span>
<a href="#l108.61"></a><span id="l108.61">             if (NS_SUCCEEDED(rv) &amp;&amp; filterService)</span>
<a href="#l108.62"></a><span id="l108.62">               rv = filterService-&gt;GetCustomTerm(customId,</span>
<a href="#l108.63"></a><span id="l108.63">                                                 getter_AddRefs(customTerm));</span>
<a href="#l108.64"></a><span id="l108.64">             bool needsBody = false;</span>
<a href="#l108.65"></a><span id="l108.65">             if (NS_SUCCEEDED(rv) &amp;&amp; customTerm)</span>
<a href="#l108.66"></a><span id="l108.66">               rv = customTerm-&gt;GetNeedsBody(&amp;needsBody);</span>
<a href="#l108.67"></a><span id="l108.67" class="difflineat">@@ -899,31 +899,31 @@ NS_IMETHODIMP nsImapMailFolder::CreateCl</span>
<a href="#l108.68"></a><span id="l108.68">   // not be a leaf folder.</span>
<a href="#l108.69"></a><span id="l108.69">   int32_t folderStart = leafName.RFindChar('/');</span>
<a href="#l108.70"></a><span id="l108.70">   if (folderStart &gt; 0)</span>
<a href="#l108.71"></a><span id="l108.71">   {</span>
<a href="#l108.72"></a><span id="l108.72">     nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l108.73"></a><span id="l108.73">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.74"></a><span id="l108.74">     nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l108.75"></a><span id="l108.75">     nsCOMPtr&lt;nsIMsgImapMailFolder&gt; parentFolder;</span>
<a href="#l108.76"></a><span id="l108.76" class="difflineminus">-    nsCAutoString uri (mURI);</span>
<a href="#l108.77"></a><span id="l108.77" class="difflineplus">+    nsAutoCString uri (mURI);</span>
<a href="#l108.78"></a><span id="l108.78">     leafName.Assign(Substring(parentName, folderStart + 1));</span>
<a href="#l108.79"></a><span id="l108.79">     parentName.SetLength(folderStart);</span>
<a href="#l108.80"></a><span id="l108.80"> </span>
<a href="#l108.81"></a><span id="l108.81">     rv = CreateDirectoryForFolder(getter_AddRefs(path));</span>
<a href="#l108.82"></a><span id="l108.82">     if (NS_FAILED(rv))</span>
<a href="#l108.83"></a><span id="l108.83">       return rv;</span>
<a href="#l108.84"></a><span id="l108.84">     uri.Append('/');</span>
<a href="#l108.85"></a><span id="l108.85">     uri.Append(NS_LossyConvertUTF16toASCII(parentName));</span>
<a href="#l108.86"></a><span id="l108.86">     rv = rdf-&gt;GetResource(uri, getter_AddRefs(res));</span>
<a href="#l108.87"></a><span id="l108.87">     if (NS_FAILED(rv))</span>
<a href="#l108.88"></a><span id="l108.88">       return rv;</span>
<a href="#l108.89"></a><span id="l108.89">     parentFolder = do_QueryInterface(res, &amp;rv);</span>
<a href="#l108.90"></a><span id="l108.90">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.91"></a><span id="l108.91" class="difflineminus">-    nsCAutoString leafnameC;</span>
<a href="#l108.92"></a><span id="l108.92" class="difflineplus">+    nsAutoCString leafnameC;</span>
<a href="#l108.93"></a><span id="l108.93">     LossyCopyUTF16toASCII(leafName, leafnameC);</span>
<a href="#l108.94"></a><span id="l108.94">     return parentFolder-&gt;CreateClientSubfolderInfo(leafnameC, hierarchyDelimiter,flags, suppressNotification);</span>
<a href="#l108.95"></a><span id="l108.95">   }</span>
<a href="#l108.96"></a><span id="l108.96"> </span>
<a href="#l108.97"></a><span id="l108.97">   // if we get here, it's really a leaf, and &quot;this&quot; is the parent.</span>
<a href="#l108.98"></a><span id="l108.98">   folderNameStr = leafName;</span>
<a href="#l108.99"></a><span id="l108.99"> </span>
<a href="#l108.100"></a><span id="l108.100">   // Create an empty database for this mail folder, set its name from the user</span>
<a href="#l108.101"></a><span id="l108.101" class="difflineat">@@ -950,17 +950,17 @@ NS_IMETHODIMP nsImapMailFolder::CreateCl</span>
<a href="#l108.102"></a><span id="l108.102">   if (NS_SUCCEEDED(rv) &amp;&amp; unusedDB)</span>
<a href="#l108.103"></a><span id="l108.103">   {</span>
<a href="#l108.104"></a><span id="l108.104">   //need to set the folder name</span>
<a href="#l108.105"></a><span id="l108.105">     nsCOMPtr &lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l108.106"></a><span id="l108.106">     rv = unusedDB-&gt;GetDBFolderInfo(getter_AddRefs(folderInfo));</span>
<a href="#l108.107"></a><span id="l108.107">     nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(child, &amp;rv);</span>
<a href="#l108.108"></a><span id="l108.108">     if (NS_SUCCEEDED(rv))</span>
<a href="#l108.109"></a><span id="l108.109">     {</span>
<a href="#l108.110"></a><span id="l108.110" class="difflineminus">-      nsCAutoString onlineName(m_onlineFolderName);</span>
<a href="#l108.111"></a><span id="l108.111" class="difflineplus">+      nsAutoCString onlineName(m_onlineFolderName);</span>
<a href="#l108.112"></a><span id="l108.112">       if (!onlineName.IsEmpty())</span>
<a href="#l108.113"></a><span id="l108.113">         onlineName.Append(hierarchyDelimiter);</span>
<a href="#l108.114"></a><span id="l108.114">       onlineName.Append(NS_LossyConvertUTF16toASCII(folderNameStr));</span>
<a href="#l108.115"></a><span id="l108.115">       imapFolder-&gt;SetVerifiedAsOnlineFolder(true);</span>
<a href="#l108.116"></a><span id="l108.116">       imapFolder-&gt;SetOnlineName(onlineName);</span>
<a href="#l108.117"></a><span id="l108.117">       imapFolder-&gt;SetHierarchyDelimiter(hierarchyDelimiter);</span>
<a href="#l108.118"></a><span id="l108.118">       imapFolder-&gt;SetBoxFlags(flags);</span>
<a href="#l108.119"></a><span id="l108.119"> </span>
<a href="#l108.120"></a><span id="l108.120" class="difflineat">@@ -1031,20 +1031,20 @@ NS_IMETHODIMP nsImapMailFolder::CreateSt</span>
<a href="#l108.121"></a><span id="l108.121">   nsresult rv = NS_OK;</span>
<a href="#l108.122"></a><span id="l108.122">   nsCOMPtr &lt;nsIMsgFolder&gt; msgParent;</span>
<a href="#l108.123"></a><span id="l108.123">   GetParent(getter_AddRefs(msgParent));</span>
<a href="#l108.124"></a><span id="l108.124"> </span>
<a href="#l108.125"></a><span id="l108.125">   // parent is probably not set because *this* was probably created by rdf</span>
<a href="#l108.126"></a><span id="l108.126">   // and not by folder discovery. So, we have to compute the parent.</span>
<a href="#l108.127"></a><span id="l108.127">   if (!msgParent)</span>
<a href="#l108.128"></a><span id="l108.128">   {</span>
<a href="#l108.129"></a><span id="l108.129" class="difflineminus">-    nsCAutoString folderName(mURI);</span>
<a href="#l108.130"></a><span id="l108.130" class="difflineplus">+    nsAutoCString folderName(mURI);</span>
<a href="#l108.131"></a><span id="l108.131"> </span>
<a href="#l108.132"></a><span id="l108.132">     int32_t leafPos = folderName.RFindChar('/');</span>
<a href="#l108.133"></a><span id="l108.133" class="difflineminus">-    nsCAutoString parentName(folderName);</span>
<a href="#l108.134"></a><span id="l108.134" class="difflineplus">+    nsAutoCString parentName(folderName);</span>
<a href="#l108.135"></a><span id="l108.135"> </span>
<a href="#l108.136"></a><span id="l108.136">     if (leafPos &gt; 0)</span>
<a href="#l108.137"></a><span id="l108.137">     {</span>
<a href="#l108.138"></a><span id="l108.138">       // If there is a hierarchy, there is a parent.</span>
<a href="#l108.139"></a><span id="l108.139">       // Don't strip off slash if it's the first character</span>
<a href="#l108.140"></a><span id="l108.140">       parentName.SetLength(leafPos);</span>
<a href="#l108.141"></a><span id="l108.141">       // get the corresponding RDF resource</span>
<a href="#l108.142"></a><span id="l108.142">       // RDF will create the folder resource if it doesn't already exist</span>
<a href="#l108.143"></a><span id="l108.143" class="difflineat">@@ -1697,18 +1697,18 @@ NS_IMETHODIMP nsImapMailFolder::PrepareT</span>
<a href="#l108.144"></a><span id="l108.144"> }</span>
<a href="#l108.145"></a><span id="l108.145"> </span>
<a href="#l108.146"></a><span id="l108.146"> NS_IMETHODIMP nsImapMailFolder::RenameLocal(const nsACString&amp; newName, nsIMsgFolder *parent)</span>
<a href="#l108.147"></a><span id="l108.147"> {</span>
<a href="#l108.148"></a><span id="l108.148">   // XXX Here it's assumed that IMAP folder names are stored locally</span>
<a href="#l108.149"></a><span id="l108.149">   // in modified UTF-7 (ASCII-only) as is stored remotely.  If we ever change</span>
<a href="#l108.150"></a><span id="l108.150">   // this, we have to work with nsString instead of nsCString</span>
<a href="#l108.151"></a><span id="l108.151">   // (ref. bug 264071)</span>
<a href="#l108.152"></a><span id="l108.152" class="difflineminus">-  nsCAutoString leafname(newName);</span>
<a href="#l108.153"></a><span id="l108.153" class="difflineminus">-  nsCAutoString parentName;</span>
<a href="#l108.154"></a><span id="l108.154" class="difflineplus">+  nsAutoCString leafname(newName);</span>
<a href="#l108.155"></a><span id="l108.155" class="difflineplus">+  nsAutoCString parentName;</span>
<a href="#l108.156"></a><span id="l108.156">   // newName always in the canonical form &quot;greatparent/parentname/leafname&quot;</span>
<a href="#l108.157"></a><span id="l108.157">   int32_t leafpos = leafname.RFindChar('/');</span>
<a href="#l108.158"></a><span id="l108.158">   if (leafpos &gt;0)</span>
<a href="#l108.159"></a><span id="l108.159">       leafname.Cut(0, leafpos+1);</span>
<a href="#l108.160"></a><span id="l108.160">   m_msgParser = nullptr;</span>
<a href="#l108.161"></a><span id="l108.161">   PrepareToRename();</span>
<a href="#l108.162"></a><span id="l108.162">   CloseAndBackupFolderDB(leafname);</span>
<a href="#l108.163"></a><span id="l108.163"> </span>
<a href="#l108.164"></a><span id="l108.164" class="difflineat">@@ -1731,24 +1731,24 @@ NS_IMETHODIMP nsImapMailFolder::RenameLo</span>
<a href="#l108.165"></a><span id="l108.165">   int32_t count = mSubFolders.Count();</span>
<a href="#l108.166"></a><span id="l108.166">   if (count &gt; 0)</span>
<a href="#l108.167"></a><span id="l108.167">     rv = CreateDirectoryForFolder(getter_AddRefs(dirFile));</span>
<a href="#l108.168"></a><span id="l108.168"> </span>
<a href="#l108.169"></a><span id="l108.169">   nsCOMPtr &lt;nsIFile&gt; oldSummaryFile;</span>
<a href="#l108.170"></a><span id="l108.170">   rv = GetSummaryFileLocation(oldPathFile, getter_AddRefs(oldSummaryFile));</span>
<a href="#l108.171"></a><span id="l108.171">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.172"></a><span id="l108.172"> </span>
<a href="#l108.173"></a><span id="l108.173" class="difflineminus">-  nsCAutoString newNameStr;</span>
<a href="#l108.174"></a><span id="l108.174" class="difflineplus">+  nsAutoCString newNameStr;</span>
<a href="#l108.175"></a><span id="l108.175">   oldSummaryFile-&gt;Remove(false);</span>
<a href="#l108.176"></a><span id="l108.176">   if (count &gt; 0)</span>
<a href="#l108.177"></a><span id="l108.177">   {</span>
<a href="#l108.178"></a><span id="l108.178">     newNameStr = leafname;</span>
<a href="#l108.179"></a><span id="l108.179">     NS_MsgHashIfNecessary(newNameStr);</span>
<a href="#l108.180"></a><span id="l108.180">     newNameStr += &quot;.sbd&quot;;</span>
<a href="#l108.181"></a><span id="l108.181" class="difflineminus">-    nsCAutoString leafName;</span>
<a href="#l108.182"></a><span id="l108.182" class="difflineplus">+    nsAutoCString leafName;</span>
<a href="#l108.183"></a><span id="l108.183">     dirFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l108.184"></a><span id="l108.184">     if (!leafName.Equals(newNameStr))</span>
<a href="#l108.185"></a><span id="l108.185">       return dirFile-&gt;MoveToNative(nullptr, newNameStr);      // in case of rename operation leaf names will differ</span>
<a href="#l108.186"></a><span id="l108.186"> </span>
<a href="#l108.187"></a><span id="l108.187">     parentPathFile-&gt;AppendNative(newNameStr);    //only for move we need to progress further in case the parent differs</span>
<a href="#l108.188"></a><span id="l108.188">     bool isDirectory = false;</span>
<a href="#l108.189"></a><span id="l108.189">     parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l108.190"></a><span id="l108.190">     if (!isDirectory)</span>
<a href="#l108.191"></a><span id="l108.191" class="difflineat">@@ -1880,17 +1880,17 @@ nsImapMailFolder::AddMessageDispositionS</span>
<a href="#l108.192"></a><span id="l108.192"> </span>
<a href="#l108.193"></a><span id="l108.193"> NS_IMETHODIMP</span>
<a href="#l108.194"></a><span id="l108.194"> nsImapMailFolder::MarkMessagesRead(nsIArray *messages, bool markRead)</span>
<a href="#l108.195"></a><span id="l108.195"> {</span>
<a href="#l108.196"></a><span id="l108.196">   // tell the folder to do it, which will mark them read in the db.</span>
<a href="#l108.197"></a><span id="l108.197">   nsresult rv = nsMsgDBFolder::MarkMessagesRead(messages, markRead);</span>
<a href="#l108.198"></a><span id="l108.198">   if (NS_SUCCEEDED(rv))</span>
<a href="#l108.199"></a><span id="l108.199">   {</span>
<a href="#l108.200"></a><span id="l108.200" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.201"></a><span id="l108.201" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.202"></a><span id="l108.202">     nsTArray&lt;nsMsgKey&gt; keysToMarkRead;</span>
<a href="#l108.203"></a><span id="l108.203">     rv = BuildIdsAndKeyArray(messages, messageIds, keysToMarkRead);</span>
<a href="#l108.204"></a><span id="l108.204">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.205"></a><span id="l108.205"> </span>
<a href="#l108.206"></a><span id="l108.206">     StoreImapFlags(kImapMsgSeenFlag, markRead, keysToMarkRead.Elements(), keysToMarkRead.Length(), nullptr);</span>
<a href="#l108.207"></a><span id="l108.207">     rv = GetDatabase();</span>
<a href="#l108.208"></a><span id="l108.208">     if (NS_SUCCEEDED(rv))</span>
<a href="#l108.209"></a><span id="l108.209">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l108.210"></a><span id="l108.210" class="difflineat">@@ -1901,17 +1901,17 @@ nsImapMailFolder::MarkMessagesRead(nsIAr</span>
<a href="#l108.211"></a><span id="l108.211"> NS_IMETHODIMP</span>
<a href="#l108.212"></a><span id="l108.212"> nsImapMailFolder::SetLabelForMessages(nsIArray *aMessages, nsMsgLabelValue aLabel)</span>
<a href="#l108.213"></a><span id="l108.213"> {</span>
<a href="#l108.214"></a><span id="l108.214">   NS_ENSURE_ARG(aMessages);</span>
<a href="#l108.215"></a><span id="l108.215"> </span>
<a href="#l108.216"></a><span id="l108.216">   nsresult rv = nsMsgDBFolder::SetLabelForMessages(aMessages, aLabel);</span>
<a href="#l108.217"></a><span id="l108.217">   if (NS_SUCCEEDED(rv))</span>
<a href="#l108.218"></a><span id="l108.218">   {</span>
<a href="#l108.219"></a><span id="l108.219" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.220"></a><span id="l108.220" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.221"></a><span id="l108.221">     nsTArray&lt;nsMsgKey&gt; keysToLabel;</span>
<a href="#l108.222"></a><span id="l108.222">     nsresult rv = BuildIdsAndKeyArray(aMessages, messageIds, keysToLabel);</span>
<a href="#l108.223"></a><span id="l108.223">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.224"></a><span id="l108.224">     StoreImapFlags((aLabel &lt;&lt; 9), true, keysToLabel.Elements(), keysToLabel.Length(), nullptr);</span>
<a href="#l108.225"></a><span id="l108.225">     rv = GetDatabase();</span>
<a href="#l108.226"></a><span id="l108.226">     if (NS_SUCCEEDED(rv))</span>
<a href="#l108.227"></a><span id="l108.227">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l108.228"></a><span id="l108.228">   }</span>
<a href="#l108.229"></a><span id="l108.229" class="difflineat">@@ -2022,17 +2022,17 @@ NS_IMETHODIMP nsImapMailFolder::WriteToF</span>
<a href="#l108.230"></a><span id="l108.230"> NS_IMETHODIMP</span>
<a href="#l108.231"></a><span id="l108.231"> nsImapMailFolder::MarkMessagesFlagged(nsIArray *messages, bool markFlagged)</span>
<a href="#l108.232"></a><span id="l108.232"> {</span>
<a href="#l108.233"></a><span id="l108.233">   nsresult rv;</span>
<a href="#l108.234"></a><span id="l108.234">   // tell the folder to do it, which will mark them read in the db.</span>
<a href="#l108.235"></a><span id="l108.235">   rv = nsMsgDBFolder::MarkMessagesFlagged(messages, markFlagged);</span>
<a href="#l108.236"></a><span id="l108.236">   if (NS_SUCCEEDED(rv))</span>
<a href="#l108.237"></a><span id="l108.237">   {</span>
<a href="#l108.238"></a><span id="l108.238" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.239"></a><span id="l108.239" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.240"></a><span id="l108.240">     nsTArray&lt;nsMsgKey&gt; keysToMarkFlagged;</span>
<a href="#l108.241"></a><span id="l108.241">     rv = BuildIdsAndKeyArray(messages, messageIds, keysToMarkFlagged);</span>
<a href="#l108.242"></a><span id="l108.242">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l108.243"></a><span id="l108.243">     rv = StoreImapFlags(kImapMsgFlaggedFlag, markFlagged,  keysToMarkFlagged.Elements(),</span>
<a href="#l108.244"></a><span id="l108.244">                         keysToMarkFlagged.Length(), nullptr);</span>
<a href="#l108.245"></a><span id="l108.245">     mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l108.246"></a><span id="l108.246">   }</span>
<a href="#l108.247"></a><span id="l108.247">   return rv;</span>
<a href="#l108.248"></a><span id="l108.248" class="difflineat">@@ -2209,19 +2209,19 @@ nsresult nsImapMailFolder::MarkMessagesI</span>
<a href="#l108.249"></a><span id="l108.249"> NS_IMETHODIMP nsImapMailFolder::DeleteMessages(nsIArray *messages,</span>
<a href="#l108.250"></a><span id="l108.250">                                                nsIMsgWindow *msgWindow,</span>
<a href="#l108.251"></a><span id="l108.251">                                                bool deleteStorage, bool isMove,</span>
<a href="#l108.252"></a><span id="l108.252">                                                nsIMsgCopyServiceListener* listener,</span>
<a href="#l108.253"></a><span id="l108.253">                                                bool allowUndo)</span>
<a href="#l108.254"></a><span id="l108.254"> {</span>
<a href="#l108.255"></a><span id="l108.255">   // *** jt - assuming delete is move to the trash folder for now</span>
<a href="#l108.256"></a><span id="l108.256">   nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l108.257"></a><span id="l108.257" class="difflineminus">-  nsCAutoString uri;</span>
<a href="#l108.258"></a><span id="l108.258" class="difflineplus">+  nsAutoCString uri;</span>
<a href="#l108.259"></a><span id="l108.259">   bool deleteImmediatelyNoTrash = false;</span>
<a href="#l108.260"></a><span id="l108.260" class="difflineminus">-  nsCAutoString messageIds;</span>
<a href="#l108.261"></a><span id="l108.261" class="difflineplus">+  nsAutoCString messageIds;</span>
<a href="#l108.262"></a><span id="l108.262">   nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l108.263"></a><span id="l108.263">   bool deleteMsgs = true;  //used for toggling delete status - default is true</span>
<a href="#l108.264"></a><span id="l108.264">   nsMsgImapDeleteModel deleteModel = nsMsgImapDeleteModels::MoveToTrash;</span>
<a href="#l108.265"></a><span id="l108.265">   imapMessageFlagsType messageFlags = kImapMsgDeletedFlag;</span>
<a href="#l108.266"></a><span id="l108.266"> </span>
<a href="#l108.267"></a><span id="l108.267">   nsCOMPtr&lt;nsIImapIncomingServer&gt; imapServer;</span>
<a href="#l108.268"></a><span id="l108.268">   nsresult rv = GetFlag(nsMsgFolderFlags::Trash, &amp;deleteImmediatelyNoTrash);</span>
<a href="#l108.269"></a><span id="l108.269">   rv = GetImapIncomingServer(getter_AddRefs(imapServer));</span>
<a href="#l108.270"></a><span id="l108.270" class="difflineat">@@ -3465,17 +3465,17 @@ NS_IMETHODIMP nsImapMailFolder::ApplyFil</span>
<a href="#l108.271"></a><span id="l108.271">         {</span>
<a href="#l108.272"></a><span id="l108.272">           NS_ASSERTION(false, &quot;actionTargetFolderUri is empty&quot;);</span>
<a href="#l108.273"></a><span id="l108.273">           continue;</span>
<a href="#l108.274"></a><span id="l108.274">         }</span>
<a href="#l108.275"></a><span id="l108.275">       }</span>
<a href="#l108.276"></a><span id="l108.276"> </span>
<a href="#l108.277"></a><span id="l108.277">       uint32_t msgFlags;</span>
<a href="#l108.278"></a><span id="l108.278">       nsMsgKey    msgKey;</span>
<a href="#l108.279"></a><span id="l108.279" class="difflineminus">-      nsCAutoString trashNameVal;</span>
<a href="#l108.280"></a><span id="l108.280" class="difflineplus">+      nsAutoCString trashNameVal;</span>
<a href="#l108.281"></a><span id="l108.281"> </span>
<a href="#l108.282"></a><span id="l108.282">       msgHdr-&gt;GetFlags(&amp;msgFlags);</span>
<a href="#l108.283"></a><span id="l108.283">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l108.284"></a><span id="l108.284">       bool isRead = (msgFlags &amp; nsMsgMessageFlags::Read);</span>
<a href="#l108.285"></a><span id="l108.285">       switch (actionType)</span>
<a href="#l108.286"></a><span id="l108.286">       {</span>
<a href="#l108.287"></a><span id="l108.287">         case nsMsgFilterAction::Delete:</span>
<a href="#l108.288"></a><span id="l108.288">         {</span>
<a href="#l108.289"></a><span id="l108.289" class="difflineat">@@ -3637,17 +3637,17 @@ NS_IMETHODIMP nsImapMailFolder::ApplyFil</span>
<a href="#l108.290"></a><span id="l108.290">           nsCOMPtr&lt;nsIMutableArray&gt; messageArray(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l108.291"></a><span id="l108.291">           NS_ENSURE_TRUE(messageArray, rv);</span>
<a href="#l108.292"></a><span id="l108.292">           messageArray-&gt;AppendElement(msgHdr, false);</span>
<a href="#l108.293"></a><span id="l108.293">           AddKeywordsToMessages(messageArray, keyword);</span>
<a href="#l108.294"></a><span id="l108.294">           break;</span>
<a href="#l108.295"></a><span id="l108.295">         }</span>
<a href="#l108.296"></a><span id="l108.296">         case nsMsgFilterAction::JunkScore:</span>
<a href="#l108.297"></a><span id="l108.297">         {</span>
<a href="#l108.298"></a><span id="l108.298" class="difflineminus">-          nsCAutoString junkScoreStr;</span>
<a href="#l108.299"></a><span id="l108.299" class="difflineplus">+          nsAutoCString junkScoreStr;</span>
<a href="#l108.300"></a><span id="l108.300">           int32_t junkScore;</span>
<a href="#l108.301"></a><span id="l108.301">           filterAction-&gt;GetJunkScore(&amp;junkScore);</span>
<a href="#l108.302"></a><span id="l108.302">           junkScoreStr.AppendInt(junkScore);</span>
<a href="#l108.303"></a><span id="l108.303">           mDatabase-&gt;SetStringProperty(msgKey, &quot;junkscore&quot;, junkScoreStr.get());</span>
<a href="#l108.304"></a><span id="l108.304">           mDatabase-&gt;SetStringProperty(msgKey, &quot;junkscoreorigin&quot;, &quot;filter&quot;);</span>
<a href="#l108.305"></a><span id="l108.305"> </span>
<a href="#l108.306"></a><span id="l108.306">           // If score is available, set up to store junk status on server.</span>
<a href="#l108.307"></a><span id="l108.307">           if (junkScore == nsIJunkMailPlugin::IS_SPAM_SCORE ||</span>
<a href="#l108.308"></a><span id="l108.308" class="difflineat">@@ -3726,17 +3726,17 @@ NS_IMETHODIMP nsImapMailFolder::ApplyFil</span>
<a href="#l108.309"></a><span id="l108.309">         break;</span>
<a href="#l108.310"></a><span id="l108.310"> </span>
<a href="#l108.311"></a><span id="l108.311">         case nsMsgFilterAction::Custom:</span>
<a href="#l108.312"></a><span id="l108.312">         {</span>
<a href="#l108.313"></a><span id="l108.313">           nsCOMPtr&lt;nsIMsgFilterCustomAction&gt; customAction;</span>
<a href="#l108.314"></a><span id="l108.314">           rv = filterAction-&gt;GetCustomAction(getter_AddRefs(customAction));</span>
<a href="#l108.315"></a><span id="l108.315">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.316"></a><span id="l108.316"> </span>
<a href="#l108.317"></a><span id="l108.317" class="difflineminus">-          nsCAutoString value;</span>
<a href="#l108.318"></a><span id="l108.318" class="difflineplus">+          nsAutoCString value;</span>
<a href="#l108.319"></a><span id="l108.319">           filterAction-&gt;GetStrValue(value);</span>
<a href="#l108.320"></a><span id="l108.320"> </span>
<a href="#l108.321"></a><span id="l108.321">           nsCOMPtr&lt;nsIMutableArray&gt; messageArray(</span>
<a href="#l108.322"></a><span id="l108.322">               do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l108.323"></a><span id="l108.323">           NS_ENSURE_TRUE(messageArray, rv);</span>
<a href="#l108.324"></a><span id="l108.324">           messageArray-&gt;AppendElement(msgHdr, false);</span>
<a href="#l108.325"></a><span id="l108.325"> </span>
<a href="#l108.326"></a><span id="l108.326">           customAction-&gt;Apply(messageArray, value, nullptr,</span>
<a href="#l108.327"></a><span id="l108.327" class="difflineat">@@ -3776,17 +3776,17 @@ NS_IMETHODIMP nsImapMailFolder::ApplyFil</span>
<a href="#l108.328"></a><span id="l108.328"> }</span>
<a href="#l108.329"></a><span id="l108.329"> </span>
<a href="#l108.330"></a><span id="l108.330"> NS_IMETHODIMP nsImapMailFolder::SetImapFlags(const char *uids, int32_t flags, nsIURI **url)</span>
<a href="#l108.331"></a><span id="l108.331"> {</span>
<a href="#l108.332"></a><span id="l108.332">   nsresult rv;</span>
<a href="#l108.333"></a><span id="l108.333">   nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.334"></a><span id="l108.334">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l108.335"></a><span id="l108.335"> </span>
<a href="#l108.336"></a><span id="l108.336" class="difflineminus">-  return imapService-&gt;SetMessageFlags(this, this, url, nsCAutoString(uids), flags, true);</span>
<a href="#l108.337"></a><span id="l108.337" class="difflineplus">+  return imapService-&gt;SetMessageFlags(this, this, url, nsAutoCString(uids), flags, true);</span>
<a href="#l108.338"></a><span id="l108.338"> }</span>
<a href="#l108.339"></a><span id="l108.339"> </span>
<a href="#l108.340"></a><span id="l108.340"> // &quot;this&quot; is the parent folder</span>
<a href="#l108.341"></a><span id="l108.341"> NS_IMETHODIMP nsImapMailFolder::PlaybackOfflineFolderCreate(const nsAString&amp; aFolderName, nsIMsgWindow *aWindow, nsIURI **url)</span>
<a href="#l108.342"></a><span id="l108.342"> {</span>
<a href="#l108.343"></a><span id="l108.343">   nsresult rv;</span>
<a href="#l108.344"></a><span id="l108.344">   nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.345"></a><span id="l108.345">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l108.346"></a><span id="l108.346" class="difflineat">@@ -3854,17 +3854,17 @@ nsImapMailFolder::ReplayOfflineMoveCopy(</span>
<a href="#l108.347"></a><span id="l108.347">     }</span>
<a href="#l108.348"></a><span id="l108.348">     // if we can't get the dst folder db, we should still try to playback</span>
<a href="#l108.349"></a><span id="l108.349">     // the offline move/copy.</span>
<a href="#l108.350"></a><span id="l108.350">   }</span>
<a href="#l108.351"></a><span id="l108.351"> </span>
<a href="#l108.352"></a><span id="l108.352">   nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.353"></a><span id="l108.353">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.354"></a><span id="l108.354">   nsCOMPtr &lt;nsIURI&gt; resultUrl;</span>
<a href="#l108.355"></a><span id="l108.355" class="difflineminus">-  nsCAutoString uids;</span>
<a href="#l108.356"></a><span id="l108.356" class="difflineplus">+  nsAutoCString uids;</span>
<a href="#l108.357"></a><span id="l108.357">   AllocateUidStringFromKeys(aMsgKeys, aNumKeys, uids);</span>
<a href="#l108.358"></a><span id="l108.358">   rv = imapService-&gt;OnlineMessageCopy(this, uids, aDstFolder,</span>
<a href="#l108.359"></a><span id="l108.359">                                       true, isMove, aUrlListener,</span>
<a href="#l108.360"></a><span id="l108.360">                                       getter_AddRefs(resultUrl), nullptr, aWindow);</span>
<a href="#l108.361"></a><span id="l108.361">   if (resultUrl)</span>
<a href="#l108.362"></a><span id="l108.362">   {</span>
<a href="#l108.363"></a><span id="l108.363">     nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(resultUrl, &amp;rv);</span>
<a href="#l108.364"></a><span id="l108.364">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.365"></a><span id="l108.365" class="difflineat">@@ -3895,17 +3895,17 @@ NS_IMETHODIMP nsImapMailFolder::StoreIma</span>
<a href="#l108.366"></a><span id="l108.366">                                                nsMsgKey *keys, uint32_t numKeys,</span>
<a href="#l108.367"></a><span id="l108.367">                                                nsIUrlListener *aUrlListener)</span>
<a href="#l108.368"></a><span id="l108.368"> {</span>
<a href="#l108.369"></a><span id="l108.369">   nsresult rv;</span>
<a href="#l108.370"></a><span id="l108.370">   if (!WeAreOffline())</span>
<a href="#l108.371"></a><span id="l108.371">   {</span>
<a href="#l108.372"></a><span id="l108.372">     nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.373"></a><span id="l108.373">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.374"></a><span id="l108.374" class="difflineminus">-    nsCAutoString msgIds;</span>
<a href="#l108.375"></a><span id="l108.375" class="difflineplus">+    nsAutoCString msgIds;</span>
<a href="#l108.376"></a><span id="l108.376">     AllocateUidStringFromKeys(keys, numKeys, msgIds);</span>
<a href="#l108.377"></a><span id="l108.377">     if (addFlags)</span>
<a href="#l108.378"></a><span id="l108.378">       imapService-&gt;AddMessageFlags(this, aUrlListener ? aUrlListener : this,</span>
<a href="#l108.379"></a><span id="l108.379">                                    nullptr, msgIds, flags, true);</span>
<a href="#l108.380"></a><span id="l108.380">     else</span>
<a href="#l108.381"></a><span id="l108.381">       imapService-&gt;SubtractMessageFlags(this, aUrlListener ? aUrlListener : this,</span>
<a href="#l108.382"></a><span id="l108.382">                                         nullptr, msgIds, flags, true);</span>
<a href="#l108.383"></a><span id="l108.383">   }</span>
<a href="#l108.384"></a><span id="l108.384" class="difflineat">@@ -4013,17 +4013,17 @@ NS_IMETHODIMP nsImapMailFolder::FolderPr</span>
<a href="#l108.385"></a><span id="l108.385"> #ifdef DEBUG_bienvenu</span>
<a href="#l108.386"></a><span id="l108.386">   m_adminUrl.Assign(&quot;http://www.netscape.com&quot;);</span>
<a href="#l108.387"></a><span id="l108.387"> #endif</span>
<a href="#l108.388"></a><span id="l108.388">   if (!m_adminUrl.IsEmpty())</span>
<a href="#l108.389"></a><span id="l108.389">   {</span>
<a href="#l108.390"></a><span id="l108.390">     nsCOMPtr&lt;nsIExternalProtocolService&gt; extProtService = do_GetService(NS_EXTERNALPROTOCOLSERVICE_CONTRACTID);</span>
<a href="#l108.391"></a><span id="l108.391">     if (extProtService) </span>
<a href="#l108.392"></a><span id="l108.392">     {</span>
<a href="#l108.393"></a><span id="l108.393" class="difflineminus">-      nsCAutoString scheme;</span>
<a href="#l108.394"></a><span id="l108.394" class="difflineplus">+      nsAutoCString scheme;</span>
<a href="#l108.395"></a><span id="l108.395">       nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l108.396"></a><span id="l108.396">       if (NS_FAILED(rv = NS_NewURI(getter_AddRefs(uri), m_adminUrl.get())))</span>
<a href="#l108.397"></a><span id="l108.397">         return rv;</span>
<a href="#l108.398"></a><span id="l108.398">       uri-&gt;GetScheme(scheme);</span>
<a href="#l108.399"></a><span id="l108.399">       if (!scheme.IsEmpty()) </span>
<a href="#l108.400"></a><span id="l108.400">       {</span>
<a href="#l108.401"></a><span id="l108.401">         // if the URL scheme does not correspond to an exposed protocol, then we</span>
<a href="#l108.402"></a><span id="l108.402">         // need to hand this link click over to the external protocol handler.</span>
<a href="#l108.403"></a><span id="l108.403" class="difflineat">@@ -4453,17 +4453,17 @@ void nsImapMailFolder::TweakHeaderFlags(</span>
<a href="#l108.404"></a><span id="l108.404"> NS_IMETHODIMP</span>
<a href="#l108.405"></a><span id="l108.405"> nsImapMailFolder::SetupMsgWriteStream(nsIFile * aFile, bool addDummyEnvelope)</span>
<a href="#l108.406"></a><span id="l108.406"> {</span>
<a href="#l108.407"></a><span id="l108.407">   nsresult rv;</span>
<a href="#l108.408"></a><span id="l108.408">   aFile-&gt;Remove(false);</span>
<a href="#l108.409"></a><span id="l108.409">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_tempMessageStream), aFile, PR_WRONLY | PR_CREATE_FILE | PR_TRUNCATE, 00700);</span>
<a href="#l108.410"></a><span id="l108.410">   if (m_tempMessageStream &amp;&amp; addDummyEnvelope)</span>
<a href="#l108.411"></a><span id="l108.411">   {</span>
<a href="#l108.412"></a><span id="l108.412" class="difflineminus">-    nsCAutoString result;</span>
<a href="#l108.413"></a><span id="l108.413" class="difflineplus">+    nsAutoCString result;</span>
<a href="#l108.414"></a><span id="l108.414">     char *ct;</span>
<a href="#l108.415"></a><span id="l108.415">     uint32_t writeCount;</span>
<a href="#l108.416"></a><span id="l108.416">     time_t now = time ((time_t*) 0);</span>
<a href="#l108.417"></a><span id="l108.417">     ct = ctime(&amp;now);</span>
<a href="#l108.418"></a><span id="l108.418">     ct[24] = 0;</span>
<a href="#l108.419"></a><span id="l108.419">     result = &quot;From - &quot;;</span>
<a href="#l108.420"></a><span id="l108.420">     result += ct;</span>
<a href="#l108.421"></a><span id="l108.421">     result += MSG_LINEBREAK;</span>
<a href="#l108.422"></a><span id="l108.422" class="difflineat">@@ -4476,17 +4476,17 @@ nsImapMailFolder::SetupMsgWriteStream(ns</span>
<a href="#l108.423"></a><span id="l108.423">     result += MSG_LINEBREAK;</span>
<a href="#l108.424"></a><span id="l108.424">     m_tempMessageStream-&gt;Write(result.get(), result.Length(), &amp;writeCount);</span>
<a href="#l108.425"></a><span id="l108.425">   }</span>
<a href="#l108.426"></a><span id="l108.426">   return rv;</span>
<a href="#l108.427"></a><span id="l108.427"> }</span>
<a href="#l108.428"></a><span id="l108.428"> </span>
<a href="#l108.429"></a><span id="l108.429"> NS_IMETHODIMP nsImapMailFolder::DownloadMessagesForOffline(nsIArray *messages, nsIMsgWindow *window)</span>
<a href="#l108.430"></a><span id="l108.430"> {</span>
<a href="#l108.431"></a><span id="l108.431" class="difflineminus">-  nsCAutoString messageIds;</span>
<a href="#l108.432"></a><span id="l108.432" class="difflineplus">+  nsAutoCString messageIds;</span>
<a href="#l108.433"></a><span id="l108.433">   nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l108.434"></a><span id="l108.434">   nsresult rv = BuildIdsAndKeyArray(messages, messageIds, srcKeyArray);</span>
<a href="#l108.435"></a><span id="l108.435">   if (NS_FAILED(rv) || messageIds.IsEmpty()) return rv;</span>
<a href="#l108.436"></a><span id="l108.436"> </span>
<a href="#l108.437"></a><span id="l108.437">   nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.438"></a><span id="l108.438">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l108.439"></a><span id="l108.439"> </span>
<a href="#l108.440"></a><span id="l108.440">   rv = AcquireSemaphore(static_cast&lt;nsIMsgFolder*&gt;(this));</span>
<a href="#l108.441"></a><span id="l108.441" class="difflineat">@@ -4502,17 +4502,17 @@ NS_IMETHODIMP nsImapMailFolder::Download</span>
<a href="#l108.442"></a><span id="l108.442"> {</span>
<a href="#l108.443"></a><span id="l108.443">   nsresult rv;</span>
<a href="#l108.444"></a><span id="l108.444">   nsCOMPtr &lt;nsIURI&gt; runningURI;</span>
<a href="#l108.445"></a><span id="l108.445">   bool noSelect;</span>
<a href="#l108.446"></a><span id="l108.446">   GetFlag(nsMsgFolderFlags::ImapNoselect, &amp;noSelect);</span>
<a href="#l108.447"></a><span id="l108.447"> </span>
<a href="#l108.448"></a><span id="l108.448">   if (!noSelect)</span>
<a href="#l108.449"></a><span id="l108.449">   {</span>
<a href="#l108.450"></a><span id="l108.450" class="difflineminus">-    nsCAutoString messageIdsToDownload;</span>
<a href="#l108.451"></a><span id="l108.451" class="difflineplus">+    nsAutoCString messageIdsToDownload;</span>
<a href="#l108.452"></a><span id="l108.452">     nsTArray&lt;nsMsgKey&gt; msgsToDownload;</span>
<a href="#l108.453"></a><span id="l108.453"> </span>
<a href="#l108.454"></a><span id="l108.454">     GetDatabase();</span>
<a href="#l108.455"></a><span id="l108.455">     m_downloadingFolderForOfflineUse = true;</span>
<a href="#l108.456"></a><span id="l108.456"> </span>
<a href="#l108.457"></a><span id="l108.457">     rv = AcquireSemaphore(static_cast&lt;nsIMsgFolder*&gt;(this));</span>
<a href="#l108.458"></a><span id="l108.458">     if (NS_FAILED(rv))</span>
<a href="#l108.459"></a><span id="l108.459">     {</span>
<a href="#l108.460"></a><span id="l108.460" class="difflineat">@@ -4759,26 +4759,26 @@ nsresult nsImapMailFolder::HandleCustomF</span>
<a href="#l108.461"></a><span id="l108.461">                                              nsCString &amp;keywords)</span>
<a href="#l108.462"></a><span id="l108.462"> {</span>
<a href="#l108.463"></a><span id="l108.463">   ToLowerCase(keywords);</span>
<a href="#l108.464"></a><span id="l108.464">   bool messageClassified = true;</span>
<a href="#l108.465"></a><span id="l108.465">   // Mac Mail uses &quot;NotJunk&quot;</span>
<a href="#l108.466"></a><span id="l108.466">   if (keywords.Find(&quot;NonJunk&quot;, CaseInsensitiveCompare) != -1 ||</span>
<a href="#l108.467"></a><span id="l108.467">       keywords.Find(&quot;NotJunk&quot;, CaseInsensitiveCompare) != -1)</span>
<a href="#l108.468"></a><span id="l108.468">   {</span>
<a href="#l108.469"></a><span id="l108.469" class="difflineminus">-    nsCAutoString msgJunkScore;</span>
<a href="#l108.470"></a><span id="l108.470" class="difflineplus">+    nsAutoCString msgJunkScore;</span>
<a href="#l108.471"></a><span id="l108.471">     msgJunkScore.AppendInt(nsIJunkMailPlugin::IS_HAM_SCORE);</span>
<a href="#l108.472"></a><span id="l108.472">     mDatabase-&gt;SetStringProperty(uidOfMessage, &quot;junkscore&quot;, msgJunkScore.get());</span>
<a href="#l108.473"></a><span id="l108.473">   }</span>
<a href="#l108.474"></a><span id="l108.474">   // ### TODO: we really should parse the keywords into space delimited keywords before checking</span>
<a href="#l108.475"></a><span id="l108.475">   else if (keywords.Find(&quot;Junk&quot;, CaseInsensitiveCompare) != -1)</span>
<a href="#l108.476"></a><span id="l108.476">   {</span>
<a href="#l108.477"></a><span id="l108.477">     uint32_t newFlags;</span>
<a href="#l108.478"></a><span id="l108.478">     dbHdr-&gt;AndFlags(~nsMsgMessageFlags::New, &amp;newFlags);</span>
<a href="#l108.479"></a><span id="l108.479" class="difflineminus">-    nsCAutoString msgJunkScore;</span>
<a href="#l108.480"></a><span id="l108.480" class="difflineplus">+    nsAutoCString msgJunkScore;</span>
<a href="#l108.481"></a><span id="l108.481">     msgJunkScore.AppendInt(nsIJunkMailPlugin::IS_SPAM_SCORE);</span>
<a href="#l108.482"></a><span id="l108.482">     mDatabase-&gt;SetStringProperty(uidOfMessage, &quot;junkscore&quot;, msgJunkScore.get());</span>
<a href="#l108.483"></a><span id="l108.483">   }</span>
<a href="#l108.484"></a><span id="l108.484">   else</span>
<a href="#l108.485"></a><span id="l108.485">     messageClassified = false;</span>
<a href="#l108.486"></a><span id="l108.486">   if (messageClassified)</span>
<a href="#l108.487"></a><span id="l108.487">   {</span>
<a href="#l108.488"></a><span id="l108.488">     // only set the junkscore origin if it wasn't set before. </span>
<a href="#l108.489"></a><span id="l108.489" class="difflineat">@@ -5247,17 +5247,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l108.490"></a><span id="l108.490">                 if (m_copyState-&gt;m_allowUndo)</span>
<a href="#l108.491"></a><span id="l108.491">                 {</span>
<a href="#l108.492"></a><span id="l108.492">                   msgTxn = m_copyState-&gt;m_undoMsgTxn;</span>
<a href="#l108.493"></a><span id="l108.493">                   if (msgTxn)</span>
<a href="#l108.494"></a><span id="l108.494">                     msgTxn-&gt;GetSrcKeyArray(srcKeyArray);</span>
<a href="#l108.495"></a><span id="l108.495">                 }</span>
<a href="#l108.496"></a><span id="l108.496">                 else</span>
<a href="#l108.497"></a><span id="l108.497">                 {</span>
<a href="#l108.498"></a><span id="l108.498" class="difflineminus">-                  nsCAutoString messageIds;</span>
<a href="#l108.499"></a><span id="l108.499" class="difflineplus">+                  nsAutoCString messageIds;</span>
<a href="#l108.500"></a><span id="l108.500">                   rv = BuildIdsAndKeyArray(m_copyState-&gt;m_messages, messageIds, srcKeyArray);</span>
<a href="#l108.501"></a><span id="l108.501">                   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l108.502"></a><span id="l108.502">                 }</span>
<a href="#l108.503"></a><span id="l108.503"> </span>
<a href="#l108.504"></a><span id="l108.504">                 if (!ShowDeletedMessages())</span>
<a href="#l108.505"></a><span id="l108.505">                   srcDB-&gt;DeleteMessages(srcKeyArray.Length(), srcKeyArray.Elements(), nullptr);</span>
<a href="#l108.506"></a><span id="l108.506">                 else</span>
<a href="#l108.507"></a><span id="l108.507">                   MarkMessagesImapDeleted(&amp;srcKeyArray, true, srcDB);</span>
<a href="#l108.508"></a><span id="l108.508" class="difflineat">@@ -6162,17 +6162,17 @@ nsMsgIMAPFolderACL::nsMsgIMAPFolderACL(n</span>
<a href="#l108.509"></a><span id="l108.509"> </span>
<a href="#l108.510"></a><span id="l108.510"> nsMsgIMAPFolderACL::~nsMsgIMAPFolderACL()</span>
<a href="#l108.511"></a><span id="l108.511"> {</span>
<a href="#l108.512"></a><span id="l108.512"> }</span>
<a href="#l108.513"></a><span id="l108.513"> </span>
<a href="#l108.514"></a><span id="l108.514"> // We cache most of our own rights in the MSG_FOLDER_PREF_* flags</span>
<a href="#l108.515"></a><span id="l108.515"> void nsMsgIMAPFolderACL::BuildInitialACLFromCache()</span>
<a href="#l108.516"></a><span id="l108.516"> {</span>
<a href="#l108.517"></a><span id="l108.517" class="difflineminus">-  nsCAutoString myrights;</span>
<a href="#l108.518"></a><span id="l108.518" class="difflineplus">+  nsAutoCString myrights;</span>
<a href="#l108.519"></a><span id="l108.519"> </span>
<a href="#l108.520"></a><span id="l108.520">   uint32_t startingFlags;</span>
<a href="#l108.521"></a><span id="l108.521">   m_folder-&gt;GetAclFlags(&amp;startingFlags);</span>
<a href="#l108.522"></a><span id="l108.522"> </span>
<a href="#l108.523"></a><span id="l108.523">   if (startingFlags &amp; IMAP_ACL_READ_FLAG)</span>
<a href="#l108.524"></a><span id="l108.524">     myrights += &quot;r&quot;;</span>
<a href="#l108.525"></a><span id="l108.525">   if (startingFlags &amp; IMAP_ACL_STORE_SEEN_FLAG)</span>
<a href="#l108.526"></a><span id="l108.526">     myrights += &quot;s&quot;;</span>
<a href="#l108.527"></a><span id="l108.527" class="difflineat">@@ -6254,17 +6254,17 @@ bool nsMsgIMAPFolderACL::SetFolderRights</span>
<a href="#l108.528"></a><span id="l108.528">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l108.529"></a><span id="l108.529">   nsresult rv = m_folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l108.530"></a><span id="l108.530">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l108.531"></a><span id="l108.531"> </span>
<a href="#l108.532"></a><span id="l108.532">   // we need the real user name to match with what the imap server returns</span>
<a href="#l108.533"></a><span id="l108.533">   // in the acl response.</span>
<a href="#l108.534"></a><span id="l108.534">   server-&gt;GetRealUsername(myUserName);</span>
<a href="#l108.535"></a><span id="l108.535"> </span>
<a href="#l108.536"></a><span id="l108.536" class="difflineminus">-  nsCAutoString ourUserName;</span>
<a href="#l108.537"></a><span id="l108.537" class="difflineplus">+  nsAutoCString ourUserName;</span>
<a href="#l108.538"></a><span id="l108.538">   if (userName.IsEmpty())</span>
<a href="#l108.539"></a><span id="l108.539">     ourUserName.Assign(myUserName);</span>
<a href="#l108.540"></a><span id="l108.540">   else</span>
<a href="#l108.541"></a><span id="l108.541">     ourUserName.Assign(userName);</span>
<a href="#l108.542"></a><span id="l108.542"> </span>
<a href="#l108.543"></a><span id="l108.543">   if (ourUserName.IsEmpty())</span>
<a href="#l108.544"></a><span id="l108.544">     return false;</span>
<a href="#l108.545"></a><span id="l108.545"> </span>
<a href="#l108.546"></a><span id="l108.546" class="difflineat">@@ -6834,17 +6834,17 @@ nsImapMailFolder::CopyMessagesWithStream</span>
<a href="#l108.547"></a><span id="l108.547">   if(NS_FAILED(rv))</span>
<a href="#l108.548"></a><span id="l108.548">     return rv;</span>
<a href="#l108.549"></a><span id="l108.549"> </span>
<a href="#l108.550"></a><span id="l108.550">   m_copyState-&gt;m_streamCopy = true;</span>
<a href="#l108.551"></a><span id="l108.551"> </span>
<a href="#l108.552"></a><span id="l108.552">   // ** jt - needs to create server to server move/copy undo msg txn</span>
<a href="#l108.553"></a><span id="l108.553">   if (m_copyState-&gt;m_allowUndo)</span>
<a href="#l108.554"></a><span id="l108.554">   {</span>
<a href="#l108.555"></a><span id="l108.555" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.556"></a><span id="l108.556" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.557"></a><span id="l108.557">     nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l108.558"></a><span id="l108.558">     rv = BuildIdsAndKeyArray(messages, messageIds, srcKeyArray);</span>
<a href="#l108.559"></a><span id="l108.559"> </span>
<a href="#l108.560"></a><span id="l108.560">     nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; undoMsgTxn = new nsImapMoveCopyMsgTxn;</span>
<a href="#l108.561"></a><span id="l108.561"> </span>
<a href="#l108.562"></a><span id="l108.562">     if (!undoMsgTxn || NS_FAILED(undoMsgTxn-&gt;Init(srcFolder, &amp;srcKeyArray, messageIds.get(), this,</span>
<a href="#l108.563"></a><span id="l108.563">                                 true, isMove)))</span>
<a href="#l108.564"></a><span id="l108.564">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l108.565"></a><span id="l108.565" class="difflineat">@@ -7407,38 +7407,38 @@ void nsImapMailFolder::SetPendingAttribu</span>
<a href="#l108.566"></a><span id="l108.566">     if (mDatabase &amp;&amp; msgDBHdr)</span>
<a href="#l108.567"></a><span id="l108.567">     {</span>
<a href="#l108.568"></a><span id="l108.568">       if (!(supportedUserFlags &amp; kImapMsgSupportUserFlag))</span>
<a href="#l108.569"></a><span id="l108.569">       {</span>
<a href="#l108.570"></a><span id="l108.570">         nsMsgLabelValue label;</span>
<a href="#l108.571"></a><span id="l108.571">         msgDBHdr-&gt;GetLabel(&amp;label);</span>
<a href="#l108.572"></a><span id="l108.572">         if (label != 0)</span>
<a href="#l108.573"></a><span id="l108.573">         {</span>
<a href="#l108.574"></a><span id="l108.574" class="difflineminus">-          nsCAutoString labelStr;</span>
<a href="#l108.575"></a><span id="l108.575" class="difflineplus">+          nsAutoCString labelStr;</span>
<a href="#l108.576"></a><span id="l108.576">           labelStr.AppendInt(label);</span>
<a href="#l108.577"></a><span id="l108.577">           mDatabase-&gt;SetAttributeOnPendingHdr(msgDBHdr, &quot;label&quot;, labelStr.get());</span>
<a href="#l108.578"></a><span id="l108.578">         }</span>
<a href="#l108.579"></a><span id="l108.579">         nsCString keywords;</span>
<a href="#l108.580"></a><span id="l108.580">         msgDBHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l108.581"></a><span id="l108.581">         if (!keywords.IsEmpty())</span>
<a href="#l108.582"></a><span id="l108.582">           mDatabase-&gt;SetAttributeOnPendingHdr(msgDBHdr, &quot;keywords&quot;, keywords.get());</span>
<a href="#l108.583"></a><span id="l108.583">       }</span>
<a href="#l108.584"></a><span id="l108.584"> </span>
<a href="#l108.585"></a><span id="l108.585">       // do this even if the server supports user-defined flags.</span>
<a href="#l108.586"></a><span id="l108.586">       nsCOMPtr&lt;nsIUTF8StringEnumerator&gt; propertyEnumerator;</span>
<a href="#l108.587"></a><span id="l108.587">       nsresult rv = msgDBHdr-&gt;GetPropertyEnumerator(getter_AddRefs(propertyEnumerator));</span>
<a href="#l108.588"></a><span id="l108.588">       NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l108.589"></a><span id="l108.589"> </span>
<a href="#l108.590"></a><span id="l108.590" class="difflineminus">-      nsCAutoString property;</span>
<a href="#l108.591"></a><span id="l108.591" class="difflineplus">+      nsAutoCString property;</span>
<a href="#l108.592"></a><span id="l108.592">       nsCString sourceString;</span>
<a href="#l108.593"></a><span id="l108.593">       bool hasMore;</span>
<a href="#l108.594"></a><span id="l108.594">       while (NS_SUCCEEDED(propertyEnumerator-&gt;HasMore(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l108.595"></a><span id="l108.595">       {</span>
<a href="#l108.596"></a><span id="l108.596">         propertyEnumerator-&gt;GetNext(property);</span>
<a href="#l108.597"></a><span id="l108.597" class="difflineminus">-        nsCAutoString propertyEx(NS_LITERAL_CSTRING(&quot; &quot;));</span>
<a href="#l108.598"></a><span id="l108.598" class="difflineplus">+        nsAutoCString propertyEx(NS_LITERAL_CSTRING(&quot; &quot;));</span>
<a href="#l108.599"></a><span id="l108.599">         propertyEx.Append(property);</span>
<a href="#l108.600"></a><span id="l108.600">         propertyEx.AppendLiteral(&quot; &quot;);</span>
<a href="#l108.601"></a><span id="l108.601">         if (dontPreserveEx.Find(propertyEx) != -1) // -1 is not found</span>
<a href="#l108.602"></a><span id="l108.602">           continue;</span>
<a href="#l108.603"></a><span id="l108.603"> </span>
<a href="#l108.604"></a><span id="l108.604">         nsCString sourceString;</span>
<a href="#l108.605"></a><span id="l108.605">         msgDBHdr-&gt;GetStringProperty(property.get(), getter_Copies(sourceString));</span>
<a href="#l108.606"></a><span id="l108.606">         mDatabase-&gt;SetAttributeOnPendingHdr(msgDBHdr, property.get(), sourceString.get());</span>
<a href="#l108.607"></a><span id="l108.607" class="difflineat">@@ -7460,17 +7460,17 @@ void nsImapMailFolder::SetPendingAttribu</span>
<a href="#l108.608"></a><span id="l108.608">                                                   nsMsgMessageFlags::Offline);</span>
<a href="#l108.609"></a><span id="l108.609">         mDatabase-&gt;SetAttributeOnPendingHdr(msgDBHdr, &quot;storeToken&quot;,</span>
<a href="#l108.610"></a><span id="l108.610">                                             storeToken.get());</span>
<a href="#l108.611"></a><span id="l108.611">       }</span>
<a href="#l108.612"></a><span id="l108.612">       nsMsgPriorityValue priority;</span>
<a href="#l108.613"></a><span id="l108.613">       msgDBHdr-&gt;GetPriority(&amp;priority);</span>
<a href="#l108.614"></a><span id="l108.614">       if(priority != 0)</span>
<a href="#l108.615"></a><span id="l108.615">       {</span>
<a href="#l108.616"></a><span id="l108.616" class="difflineminus">-        nsCAutoString priorityStr;</span>
<a href="#l108.617"></a><span id="l108.617" class="difflineplus">+        nsAutoCString priorityStr;</span>
<a href="#l108.618"></a><span id="l108.618">         priorityStr.AppendInt(priority);</span>
<a href="#l108.619"></a><span id="l108.619">         mDatabase-&gt;SetAttributeOnPendingHdr(msgDBHdr, &quot;priority&quot;, priorityStr.get());</span>
<a href="#l108.620"></a><span id="l108.620">       }</span>
<a href="#l108.621"></a><span id="l108.621">     }</span>
<a href="#l108.622"></a><span id="l108.622">   }</span>
<a href="#l108.623"></a><span id="l108.623"> }</span>
<a href="#l108.624"></a><span id="l108.624"> </span>
<a href="#l108.625"></a><span id="l108.625"> NS_IMETHODIMP</span>
<a href="#l108.626"></a><span id="l108.626" class="difflineat">@@ -7543,17 +7543,17 @@ nsImapMailFolder::CopyMessages(nsIMsgFol</span>
<a href="#l108.627"></a><span id="l108.627">               </span>
<a href="#l108.628"></a><span id="l108.628">       srcImapFolder-&gt;m_playbackTimer-&gt;InitWithFuncCallback(PlaybackTimerCallback, (void *) srcImapFolder-&gt;m_pendingPlaybackReq, </span>
<a href="#l108.629"></a><span id="l108.629">                                         PLAYBACK_TIMER_INTERVAL_IN_MS, nsITimer::TYPE_ONE_SHOT);</span>
<a href="#l108.630"></a><span id="l108.630">     }</span>
<a href="#l108.631"></a><span id="l108.631">     return rv;</span>
<a href="#l108.632"></a><span id="l108.632">   }</span>
<a href="#l108.633"></a><span id="l108.633">   else </span>
<a href="#l108.634"></a><span id="l108.634">   {</span>
<a href="#l108.635"></a><span id="l108.635" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.636"></a><span id="l108.636" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.637"></a><span id="l108.637">     nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l108.638"></a><span id="l108.638">     nsCOMPtr&lt;nsIUrlListener&gt; urlListener;</span>
<a href="#l108.639"></a><span id="l108.639">     nsCOMPtr&lt;nsISupports&gt; copySupport;</span>
<a href="#l108.640"></a><span id="l108.640">     </span>
<a href="#l108.641"></a><span id="l108.641">     if (WeAreOffline())</span>
<a href="#l108.642"></a><span id="l108.642">       return CopyMessagesOffline(srcFolder, messages, isMove, msgWindow, listener);</span>
<a href="#l108.643"></a><span id="l108.643">     </span>
<a href="#l108.644"></a><span id="l108.644">     nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.645"></a><span id="l108.645" class="difflineat">@@ -7979,17 +7979,17 @@ nsImapMailFolder::CopyFileMessage(nsIFil</span>
<a href="#l108.646"></a><span id="l108.646">                                   bool isDraftOrTemplate,</span>
<a href="#l108.647"></a><span id="l108.647">                                   uint32_t aNewMsgFlags,</span>
<a href="#l108.648"></a><span id="l108.648">                                   const nsACString &amp;aNewMsgKeywords,</span>
<a href="#l108.649"></a><span id="l108.649">                                   nsIMsgWindow *msgWindow,</span>
<a href="#l108.650"></a><span id="l108.650">                                   nsIMsgCopyServiceListener* listener)</span>
<a href="#l108.651"></a><span id="l108.651"> {</span>
<a href="#l108.652"></a><span id="l108.652">     nsresult rv = NS_ERROR_NULL_POINTER;</span>
<a href="#l108.653"></a><span id="l108.653">     nsMsgKey key = 0xffffffff;</span>
<a href="#l108.654"></a><span id="l108.654" class="difflineminus">-    nsCAutoString messageId;</span>
<a href="#l108.655"></a><span id="l108.655" class="difflineplus">+    nsAutoCString messageId;</span>
<a href="#l108.656"></a><span id="l108.656">     nsCOMPtr&lt;nsIUrlListener&gt; urlListener;</span>
<a href="#l108.657"></a><span id="l108.657">     nsCOMPtr&lt;nsIMutableArray&gt; messages(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l108.658"></a><span id="l108.658">     nsCOMPtr&lt;nsISupports&gt; srcSupport = do_QueryInterface(file, &amp;rv);</span>
<a href="#l108.659"></a><span id="l108.659"> </span>
<a href="#l108.660"></a><span id="l108.660">     if (!messages)</span>
<a href="#l108.661"></a><span id="l108.661">       return OnCopyCompleted(srcSupport, rv);</span>
<a href="#l108.662"></a><span id="l108.662"> </span>
<a href="#l108.663"></a><span id="l108.663">     nsCOMPtr&lt;nsIImapService&gt; imapService = do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l108.664"></a><span id="l108.664" class="difflineat">@@ -8652,18 +8652,18 @@ NS_IMETHODIMP nsImapMailFolder::RenameCl</span>
<a href="#l108.665"></a><span id="l108.665">     //Now let's create the actual new folder</span>
<a href="#l108.666"></a><span id="l108.666">     rv = AddSubfolderWithPath(folderNameStr, dbFile, getter_AddRefs(child));</span>
<a href="#l108.667"></a><span id="l108.667">     if (!child || NS_FAILED(rv)) </span>
<a href="#l108.668"></a><span id="l108.668">       return rv;</span>
<a href="#l108.669"></a><span id="l108.669">     child-&gt;SetName(newLeafName);</span>
<a href="#l108.670"></a><span id="l108.670">     imapFolder = do_QueryInterface(child);</span>
<a href="#l108.671"></a><span id="l108.671">     if (imapFolder)</span>
<a href="#l108.672"></a><span id="l108.672">     {</span>
<a href="#l108.673"></a><span id="l108.673" class="difflineminus">-      nsCAutoString onlineName(m_onlineFolderName);</span>
<a href="#l108.674"></a><span id="l108.674" class="difflineminus">-      nsCAutoString utf7LeafName;</span>
<a href="#l108.675"></a><span id="l108.675" class="difflineplus">+      nsAutoCString onlineName(m_onlineFolderName);</span>
<a href="#l108.676"></a><span id="l108.676" class="difflineplus">+      nsAutoCString utf7LeafName;</span>
<a href="#l108.677"></a><span id="l108.677"> </span>
<a href="#l108.678"></a><span id="l108.678">       if (!onlineName.IsEmpty())</span>
<a href="#l108.679"></a><span id="l108.679">         onlineName.Append(hierarchyDelimiter);</span>
<a href="#l108.680"></a><span id="l108.680">       CopyUTF16toMUTF7(folderNameStr, utf7LeafName);</span>
<a href="#l108.681"></a><span id="l108.681">       onlineName.Append(utf7LeafName);</span>
<a href="#l108.682"></a><span id="l108.682">       imapFolder-&gt;SetVerifiedAsOnlineFolder(true);</span>
<a href="#l108.683"></a><span id="l108.683">       imapFolder-&gt;SetOnlineName(onlineName);</span>
<a href="#l108.684"></a><span id="l108.684">       imapFolder-&gt;SetHierarchyDelimiter(hierarchyDelimiter);</span>
<a href="#l108.685"></a><span id="l108.685" class="difflineat">@@ -8739,17 +8739,17 @@ NS_IMETHODIMP nsImapMailFolder::RenameSu</span>
<a href="#l108.686"></a><span id="l108.686">     rv = msgFolder-&gt;GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l108.687"></a><span id="l108.687">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l108.688"></a><span id="l108.688"> </span>
<a href="#l108.689"></a><span id="l108.689">     nsCOMPtr&lt;nsIFile&gt; newParentPathFile;</span>
<a href="#l108.690"></a><span id="l108.690">     rv = GetFilePath(getter_AddRefs(newParentPathFile));</span>
<a href="#l108.691"></a><span id="l108.691">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l108.692"></a><span id="l108.692"> </span>
<a href="#l108.693"></a><span id="l108.693">     rv = AddDirectorySeparator(newParentPathFile);</span>
<a href="#l108.694"></a><span id="l108.694" class="difflineminus">-    nsCAutoString oldLeafName;</span>
<a href="#l108.695"></a><span id="l108.695" class="difflineplus">+    nsAutoCString oldLeafName;</span>
<a href="#l108.696"></a><span id="l108.696">     oldPathFile-&gt;GetNativeLeafName(oldLeafName);</span>
<a href="#l108.697"></a><span id="l108.697">     newParentPathFile-&gt;AppendNative(oldLeafName);</span>
<a href="#l108.698"></a><span id="l108.698"> </span>
<a href="#l108.699"></a><span id="l108.699">     nsCString newPathStr;</span>
<a href="#l108.700"></a><span id="l108.700">     newParentPathFile-&gt;GetNativePath(newPathStr);</span>
<a href="#l108.701"></a><span id="l108.701"> </span>
<a href="#l108.702"></a><span id="l108.702">     nsCOMPtr&lt;nsIFile&gt; newPathFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l108.703"></a><span id="l108.703">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.704"></a><span id="l108.704" class="difflineat">@@ -8773,17 +8773,17 @@ NS_IMETHODIMP nsImapMailFolder::RenameSu</span>
<a href="#l108.705"></a><span id="l108.705"> </span>
<a href="#l108.706"></a><span id="l108.706">     rv = AddSubfolderWithPath(unicodeLeafName, dbFilePath, getter_AddRefs(child));</span>
<a href="#l108.707"></a><span id="l108.707">     if (!child || NS_FAILED(rv)) return rv;</span>
<a href="#l108.708"></a><span id="l108.708"> </span>
<a href="#l108.709"></a><span id="l108.709">     child-&gt;SetName(folderName);</span>
<a href="#l108.710"></a><span id="l108.710">     nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(child);</span>
<a href="#l108.711"></a><span id="l108.711">     nsCString onlineName;</span>
<a href="#l108.712"></a><span id="l108.712">     GetOnlineName(onlineName);</span>
<a href="#l108.713"></a><span id="l108.713" class="difflineminus">-    nsCAutoString onlineCName(onlineName);</span>
<a href="#l108.714"></a><span id="l108.714" class="difflineplus">+    nsAutoCString onlineCName(onlineName);</span>
<a href="#l108.715"></a><span id="l108.715">     onlineCName.Append(hierarchyDelimiter);</span>
<a href="#l108.716"></a><span id="l108.716">     onlineCName.Append(utf7LeafName);</span>
<a href="#l108.717"></a><span id="l108.717">     if (imapFolder)</span>
<a href="#l108.718"></a><span id="l108.718">     {</span>
<a href="#l108.719"></a><span id="l108.719">      imapFolder-&gt;SetVerifiedAsOnlineFolder(verified);</span>
<a href="#l108.720"></a><span id="l108.720">      imapFolder-&gt;SetOnlineName(onlineCName);</span>
<a href="#l108.721"></a><span id="l108.721">      imapFolder-&gt;SetHierarchyDelimiter(hierarchyDelimiter);</span>
<a href="#l108.722"></a><span id="l108.722">      imapFolder-&gt;SetBoxFlags(boxflags);</span>
<a href="#l108.723"></a><span id="l108.723" class="difflineat">@@ -8898,17 +8898,17 @@ nsImapMailFolder::StoreCustomKeywords(ns</span>
<a href="#l108.724"></a><span id="l108.724">         }</span>
<a href="#l108.725"></a><span id="l108.725">       }</span>
<a href="#l108.726"></a><span id="l108.726">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit); // flush offline ops</span>
<a href="#l108.727"></a><span id="l108.727">       return rv;</span>
<a href="#l108.728"></a><span id="l108.728">     }</span>
<a href="#l108.729"></a><span id="l108.729">   }</span>
<a href="#l108.730"></a><span id="l108.730">   nsCOMPtr&lt;nsIImapService&gt; imapService(do_GetService(NS_IMAPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l108.731"></a><span id="l108.731">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.732"></a><span id="l108.732" class="difflineminus">-  nsCAutoString msgIds;</span>
<a href="#l108.733"></a><span id="l108.733" class="difflineplus">+  nsAutoCString msgIds;</span>
<a href="#l108.734"></a><span id="l108.734">   AllocateUidStringFromKeys(aKeysToStore, aNumKeys, msgIds);</span>
<a href="#l108.735"></a><span id="l108.735">   return imapService-&gt;StoreCustomKeywords(this, aMsgWindow, aFlagsToAdd,</span>
<a href="#l108.736"></a><span id="l108.736">                                           aFlagsToSubtract, msgIds, _retval);</span>
<a href="#l108.737"></a><span id="l108.737"> }</span>
<a href="#l108.738"></a><span id="l108.738"> </span>
<a href="#l108.739"></a><span id="l108.739"> NS_IMETHODIMP nsImapMailFolder::NotifyIfNewMail()</span>
<a href="#l108.740"></a><span id="l108.740"> {</span>
<a href="#l108.741"></a><span id="l108.741">   return PerformBiffNotifications();</span>
<a href="#l108.742"></a><span id="l108.742" class="difflineat">@@ -8944,17 +8944,17 @@ nsImapMailFolder::PlaybackCoalescedOpera</span>
<a href="#l108.743"></a><span id="l108.743"> NS_IMETHODIMP</span>
<a href="#l108.744"></a><span id="l108.744"> nsImapMailFolder::SetJunkScoreForMessages(nsIArray *aMessages, const nsACString&amp; aJunkScore)</span>
<a href="#l108.745"></a><span id="l108.745"> {</span>
<a href="#l108.746"></a><span id="l108.746">   NS_ENSURE_ARG(aMessages);</span>
<a href="#l108.747"></a><span id="l108.747"> </span>
<a href="#l108.748"></a><span id="l108.748">   nsresult rv = nsMsgDBFolder::SetJunkScoreForMessages(aMessages, aJunkScore);</span>
<a href="#l108.749"></a><span id="l108.749">   if (NS_SUCCEEDED(rv))</span>
<a href="#l108.750"></a><span id="l108.750">   {</span>
<a href="#l108.751"></a><span id="l108.751" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.752"></a><span id="l108.752" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.753"></a><span id="l108.753">     nsTArray&lt;nsMsgKey&gt; keys;</span>
<a href="#l108.754"></a><span id="l108.754">     nsresult rv = BuildIdsAndKeyArray(aMessages, messageIds, keys);</span>
<a href="#l108.755"></a><span id="l108.755">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.756"></a><span id="l108.756">     StoreCustomKeywords(nullptr, aJunkScore.Equals(&quot;0&quot;) ? NS_LITERAL_CSTRING(&quot;NonJunk&quot;) : NS_LITERAL_CSTRING(&quot;Junk&quot;), EmptyCString(), keys.Elements(),</span>
<a href="#l108.757"></a><span id="l108.757">       keys.Length(), nullptr);</span>
<a href="#l108.758"></a><span id="l108.758">     if (mDatabase)</span>
<a href="#l108.759"></a><span id="l108.759">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l108.760"></a><span id="l108.760">   }</span>
<a href="#l108.761"></a><span id="l108.761" class="difflineat">@@ -9229,48 +9229,48 @@ NS_IMETHODIMP nsImapMailFolder::FetchMsg</span>
<a href="#l108.762"></a><span id="l108.762">       }</span>
<a href="#l108.763"></a><span id="l108.763">       else if (!aLocalOnly)</span>
<a href="#l108.764"></a><span id="l108.764">         keysToFetchFromServer.AppendElement(msgKey);</span>
<a href="#l108.765"></a><span id="l108.765">     }</span>
<a href="#l108.766"></a><span id="l108.766">   }</span>
<a href="#l108.767"></a><span id="l108.767">   if (!keysToFetchFromServer.IsEmpty())</span>
<a href="#l108.768"></a><span id="l108.768">   {</span>
<a href="#l108.769"></a><span id="l108.769">     uint32_t msgCount = keysToFetchFromServer.Length();</span>
<a href="#l108.770"></a><span id="l108.770" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.771"></a><span id="l108.771" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.772"></a><span id="l108.772">     AllocateImapUidString(keysToFetchFromServer.Elements(), msgCount,</span>
<a href="#l108.773"></a><span id="l108.773">                          nullptr, messageIds);</span>
<a href="#l108.774"></a><span id="l108.774">     rv = imapService-&gt;GetBodyStart(this, aUrlListener,</span>
<a href="#l108.775"></a><span id="l108.775">                                    messageIds, 2048, nullptr);</span>
<a href="#l108.776"></a><span id="l108.776">     *aAsyncResults = true; // the preview text will be available async...</span>
<a href="#l108.777"></a><span id="l108.777">   }</span>
<a href="#l108.778"></a><span id="l108.778">   return NS_OK;</span>
<a href="#l108.779"></a><span id="l108.779"> }</span>
<a href="#l108.780"></a><span id="l108.780"> </span>
<a href="#l108.781"></a><span id="l108.781"> NS_IMETHODIMP nsImapMailFolder::AddKeywordsToMessages(nsIArray *aMessages, const nsACString&amp; aKeywords)</span>
<a href="#l108.782"></a><span id="l108.782"> {</span>
<a href="#l108.783"></a><span id="l108.783">   nsresult rv = nsMsgDBFolder::AddKeywordsToMessages(aMessages, aKeywords);</span>
<a href="#l108.784"></a><span id="l108.784">   if (NS_SUCCEEDED(rv))</span>
<a href="#l108.785"></a><span id="l108.785">   {</span>
<a href="#l108.786"></a><span id="l108.786" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.787"></a><span id="l108.787" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.788"></a><span id="l108.788">     nsTArray&lt;nsMsgKey&gt; keys;</span>
<a href="#l108.789"></a><span id="l108.789">     rv = BuildIdsAndKeyArray(aMessages, messageIds, keys);</span>
<a href="#l108.790"></a><span id="l108.790">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.791"></a><span id="l108.791">     rv = StoreCustomKeywords(nullptr, aKeywords, EmptyCString(), keys.Elements(), keys.Length(), nullptr);</span>
<a href="#l108.792"></a><span id="l108.792">     if (mDatabase)</span>
<a href="#l108.793"></a><span id="l108.793">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l108.794"></a><span id="l108.794">   }</span>
<a href="#l108.795"></a><span id="l108.795">   return rv;</span>
<a href="#l108.796"></a><span id="l108.796"> }</span>
<a href="#l108.797"></a><span id="l108.797"> </span>
<a href="#l108.798"></a><span id="l108.798"> NS_IMETHODIMP nsImapMailFolder::RemoveKeywordsFromMessages(nsIArray *aMessages, const nsACString&amp; aKeywords)</span>
<a href="#l108.799"></a><span id="l108.799"> {</span>
<a href="#l108.800"></a><span id="l108.800">   nsresult rv = nsMsgDBFolder::RemoveKeywordsFromMessages(aMessages, aKeywords);</span>
<a href="#l108.801"></a><span id="l108.801">   if (NS_SUCCEEDED(rv))</span>
<a href="#l108.802"></a><span id="l108.802">   {</span>
<a href="#l108.803"></a><span id="l108.803" class="difflineminus">-    nsCAutoString messageIds;</span>
<a href="#l108.804"></a><span id="l108.804" class="difflineplus">+    nsAutoCString messageIds;</span>
<a href="#l108.805"></a><span id="l108.805">     nsTArray&lt;nsMsgKey&gt; keys;</span>
<a href="#l108.806"></a><span id="l108.806">     nsresult rv = BuildIdsAndKeyArray(aMessages, messageIds, keys);</span>
<a href="#l108.807"></a><span id="l108.807">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l108.808"></a><span id="l108.808">     rv = StoreCustomKeywords(nullptr, EmptyCString(), aKeywords, keys.Elements(), keys.Length(), nullptr);</span>
<a href="#l108.809"></a><span id="l108.809">     if (mDatabase)</span>
<a href="#l108.810"></a><span id="l108.810">       mDatabase-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l108.811"></a><span id="l108.811">   }</span>
<a href="#l108.812"></a><span id="l108.812">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/mailnews/imap/src/nsImapOfflineSync.cpp</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapOfflineSync.cpp</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -248,17 +248,17 @@ void nsImapOfflineSync::ProcessFlagOpera</span>
<a href="#l109.4"></a><span id="l109.4">       currentOp-&gt;GetNewFlags(&amp;newFlags);</span>
<a href="#l109.5"></a><span id="l109.5">     }</span>
<a href="#l109.6"></a><span id="l109.6">     flagsMatch = (flagOperation &amp; nsIMsgOfflineImapOperation::kFlagsChanged)</span>
<a href="#l109.7"></a><span id="l109.7">                   &amp;&amp; (newFlags == matchingFlags);</span>
<a href="#l109.8"></a><span id="l109.8">   } while (currentOp);</span>
<a href="#l109.9"></a><span id="l109.9"> </span>
<a href="#l109.10"></a><span id="l109.10">   if (!matchingFlagKeys.IsEmpty())</span>
<a href="#l109.11"></a><span id="l109.11">   {</span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-    nsCAutoString uids;</span>
<a href="#l109.13"></a><span id="l109.13" class="difflineplus">+    nsAutoCString uids;</span>
<a href="#l109.14"></a><span id="l109.14">     nsImapMailFolder::AllocateUidStringFromKeys(matchingFlagKeys.Elements(), matchingFlagKeys.Length(), uids);</span>
<a href="#l109.15"></a><span id="l109.15">     uint32_t curFolderFlags;</span>
<a href="#l109.16"></a><span id="l109.16">     m_currentFolder-&gt;GetFlags(&amp;curFolderFlags);</span>
<a href="#l109.17"></a><span id="l109.17"> </span>
<a href="#l109.18"></a><span id="l109.18">     if (uids.get() &amp;&amp; (curFolderFlags &amp; nsMsgFolderFlags::ImapBox)) </span>
<a href="#l109.19"></a><span id="l109.19">     {</span>
<a href="#l109.20"></a><span id="l109.20">       nsresult rv = NS_OK;</span>
<a href="#l109.21"></a><span id="l109.21">       nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(m_currentFolder);</span>
<a href="#l109.22"></a><span id="l109.22" class="difflineat">@@ -280,17 +280,17 @@ void nsImapOfflineSync::ProcessFlagOpera</span>
<a href="#l109.23"></a><span id="l109.23"> }</span>
<a href="#l109.24"></a><span id="l109.24"> </span>
<a href="#l109.25"></a><span id="l109.25"> void nsImapOfflineSync::ProcessKeywordOperation(nsIMsgOfflineImapOperation *op)</span>
<a href="#l109.26"></a><span id="l109.26"> {</span>
<a href="#l109.27"></a><span id="l109.27">   nsCOMPtr &lt;nsIMsgOfflineImapOperation&gt; currentOp = op;</span>
<a href="#l109.28"></a><span id="l109.28">   nsTArray&lt;nsMsgKey&gt; matchingKeywordKeys;</span>
<a href="#l109.29"></a><span id="l109.29">   uint32_t currentKeyIndex = m_KeyIndex;</span>
<a href="#l109.30"></a><span id="l109.30"> </span>
<a href="#l109.31"></a><span id="l109.31" class="difflineminus">-  nsCAutoString keywords;</span>
<a href="#l109.32"></a><span id="l109.32" class="difflineplus">+  nsAutoCString keywords;</span>
<a href="#l109.33"></a><span id="l109.33">   if (mCurrentPlaybackOpType == nsIMsgOfflineImapOperation::kAddKeywords)</span>
<a href="#l109.34"></a><span id="l109.34">     currentOp-&gt;GetKeywordsToAdd(getter_Copies(keywords));</span>
<a href="#l109.35"></a><span id="l109.35">   else</span>
<a href="#l109.36"></a><span id="l109.36">     currentOp-&gt;GetKeywordsToRemove(getter_Copies(keywords));</span>
<a href="#l109.37"></a><span id="l109.37">   bool keywordsMatch = true;	</span>
<a href="#l109.38"></a><span id="l109.38">   do</span>
<a href="#l109.39"></a><span id="l109.39">   { // loop for all messsages with the same keywords</span>
<a href="#l109.40"></a><span id="l109.40">     if (keywordsMatch)</span>
<a href="#l109.41"></a><span id="l109.41" class="difflineat">@@ -302,17 +302,17 @@ void nsImapOfflineSync::ProcessKeywordOp</span>
<a href="#l109.42"></a><span id="l109.42">       m_currentOpsToClear.AppendObject(currentOp);</span>
<a href="#l109.43"></a><span id="l109.43">     }</span>
<a href="#l109.44"></a><span id="l109.44">     currentOp = nullptr;</span>
<a href="#l109.45"></a><span id="l109.45">     if (++currentKeyIndex &lt; m_CurrentKeys.Length())</span>
<a href="#l109.46"></a><span id="l109.46">       m_currentDB-&gt;GetOfflineOpForKey(m_CurrentKeys[currentKeyIndex], false,</span>
<a href="#l109.47"></a><span id="l109.47">         getter_AddRefs(currentOp));</span>
<a href="#l109.48"></a><span id="l109.48">     if (currentOp)</span>
<a href="#l109.49"></a><span id="l109.49">     {</span>
<a href="#l109.50"></a><span id="l109.50" class="difflineminus">-      nsCAutoString curOpKeywords;</span>
<a href="#l109.51"></a><span id="l109.51" class="difflineplus">+      nsAutoCString curOpKeywords;</span>
<a href="#l109.52"></a><span id="l109.52">       nsOfflineImapOperationType operation;</span>
<a href="#l109.53"></a><span id="l109.53">       currentOp-&gt;GetOperation(&amp;operation);</span>
<a href="#l109.54"></a><span id="l109.54">       if (mCurrentPlaybackOpType == nsIMsgOfflineImapOperation::kAddKeywords)</span>
<a href="#l109.55"></a><span id="l109.55">         currentOp-&gt;GetKeywordsToAdd(getter_Copies(curOpKeywords));</span>
<a href="#l109.56"></a><span id="l109.56">       else</span>
<a href="#l109.57"></a><span id="l109.57">         currentOp-&gt;GetKeywordsToRemove(getter_Copies(curOpKeywords));</span>
<a href="#l109.58"></a><span id="l109.58">       keywordsMatch = (operation &amp; mCurrentPlaybackOpType)</span>
<a href="#l109.59"></a><span id="l109.59">                   &amp;&amp; (curOpKeywords.Equals(keywords));</span>
<a href="#l109.60"></a><span id="l109.60" class="difflineat">@@ -623,17 +623,17 @@ void nsImapOfflineSync::ProcessCopyOpera</span>
<a href="#l109.61"></a><span id="l109.61">           currentOp-&gt;GetCopyDestination(0, getter_Copies(nextDestination));</span>
<a href="#l109.62"></a><span id="l109.62">           copyMatches = copyDestination.Equals(nextDestination);</span>
<a href="#l109.63"></a><span id="l109.63">         }</span>
<a href="#l109.64"></a><span id="l109.64">       }</span>
<a href="#l109.65"></a><span id="l109.65">     }</span>
<a href="#l109.66"></a><span id="l109.66">   } </span>
<a href="#l109.67"></a><span id="l109.67">   while (currentOp);</span>
<a href="#l109.68"></a><span id="l109.68"> </span>
<a href="#l109.69"></a><span id="l109.69" class="difflineminus">-  nsCAutoString uids;</span>
<a href="#l109.70"></a><span id="l109.70" class="difflineplus">+  nsAutoCString uids;</span>
<a href="#l109.71"></a><span id="l109.71">   nsCOMPtr&lt;nsIMsgFolder&gt; destFolder;</span>
<a href="#l109.72"></a><span id="l109.72">   GetExistingFolder(copyDestination, getter_AddRefs(destFolder));</span>
<a href="#l109.73"></a><span id="l109.73">   // if the dest folder doesn't really exist, these operations are</span>
<a href="#l109.74"></a><span id="l109.74">   // going to fail, so clear them out and move on.</span>
<a href="#l109.75"></a><span id="l109.75">   if (!destFolder)</span>
<a href="#l109.76"></a><span id="l109.76">   {</span>
<a href="#l109.77"></a><span id="l109.77">     NS_ERROR(&quot;trying to playing back copy to non-existent folder&quot;);</span>
<a href="#l109.78"></a><span id="l109.78">     ClearCurrentOps();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -1365,17 +1365,17 @@ nsImapProtocol::ImapThreadMainLoop()</span>
<a href="#l110.4"></a><span id="l110.4">   m_imapThreadIsRunning = false;</span>
<a href="#l110.5"></a><span id="l110.5"> </span>
<a href="#l110.6"></a><span id="l110.6">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;ImapThreadMainLoop leaving [this=%x]\n&quot;, this));</span>
<a href="#l110.7"></a><span id="l110.7"> }</span>
<a href="#l110.8"></a><span id="l110.8"> </span>
<a href="#l110.9"></a><span id="l110.9"> void nsImapProtocol::HandleIdleResponses()</span>
<a href="#l110.10"></a><span id="l110.10"> {</span>
<a href="#l110.11"></a><span id="l110.11">   // int32_t oldRecent = GetServerStateParser().NumberOfRecentMessages();</span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-  nsCAutoString commandBuffer(GetServerCommandTag());</span>
<a href="#l110.13"></a><span id="l110.13" class="difflineplus">+  nsAutoCString commandBuffer(GetServerCommandTag());</span>
<a href="#l110.14"></a><span id="l110.14">   commandBuffer.Append(&quot; IDLE&quot; CRLF);</span>
<a href="#l110.15"></a><span id="l110.15"> </span>
<a href="#l110.16"></a><span id="l110.16">   do</span>
<a href="#l110.17"></a><span id="l110.17">   {</span>
<a href="#l110.18"></a><span id="l110.18">     ParseIMAPandCheckForNewMail(commandBuffer.get());</span>
<a href="#l110.19"></a><span id="l110.19">   }</span>
<a href="#l110.20"></a><span id="l110.20">   while (m_inputStreamBuffer-&gt;NextLineAvailable() &amp;&amp; GetServerStateParser().Connected());</span>
<a href="#l110.21"></a><span id="l110.21"> </span>
<a href="#l110.22"></a><span id="l110.22" class="difflineat">@@ -1409,17 +1409,17 @@ void nsImapProtocol::EstablishServerConn</span>
<a href="#l110.23"></a><span id="l110.23">     SetFlag(IMAP_RECEIVED_GREETING);</span>
<a href="#l110.24"></a><span id="l110.24"> </span>
<a href="#l110.25"></a><span id="l110.25">   if (!PL_strncasecmp(serverResponse, ESC_OK, ESC_OK_LEN))</span>
<a href="#l110.26"></a><span id="l110.26">   {</span>
<a href="#l110.27"></a><span id="l110.27">     SetConnectionStatus(NS_OK);</span>
<a href="#l110.28"></a><span id="l110.28"> </span>
<a href="#l110.29"></a><span id="l110.29">     if (!PL_strncasecmp(serverResponse, ESC_CAPABILITY_GREETING, ESC_CAPABILITY_GREETING_LEN))</span>
<a href="#l110.30"></a><span id="l110.30">     {</span>
<a href="#l110.31"></a><span id="l110.31" class="difflineminus">-      nsCAutoString tmpstr(serverResponse);</span>
<a href="#l110.32"></a><span id="l110.32" class="difflineplus">+      nsAutoCString tmpstr(serverResponse);</span>
<a href="#l110.33"></a><span id="l110.33">       int32_t endIndex = tmpstr.FindChar(']', ESC_CAPABILITY_GREETING_LEN);</span>
<a href="#l110.34"></a><span id="l110.34">       if (endIndex &gt;= 0)</span>
<a href="#l110.35"></a><span id="l110.35">       {</span>
<a href="#l110.36"></a><span id="l110.36">         // Allocate the new buffer here. This buffer will be passed to</span>
<a href="#l110.37"></a><span id="l110.37">         // ParseIMAPServerResponse() where it will be used to fill the</span>
<a href="#l110.38"></a><span id="l110.38">         // fCurrentLine field and will be freed by the next call to</span>
<a href="#l110.39"></a><span id="l110.39">         // ResetLexAnalyzer().</span>
<a href="#l110.40"></a><span id="l110.40">         char *fakeServerResponse = (char*)PR_Malloc(PL_strlen(serverResponse));</span>
<a href="#l110.41"></a><span id="l110.41" class="difflineat">@@ -1549,17 +1549,17 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l110.42"></a><span id="l110.42">     SetupSinkProxy(); // try this again. Evil, but I'm desperate.</span>
<a href="#l110.43"></a><span id="l110.43"> </span>
<a href="#l110.44"></a><span id="l110.44">   // Reinitialize the parser</span>
<a href="#l110.45"></a><span id="l110.45">   GetServerStateParser().InitializeState();</span>
<a href="#l110.46"></a><span id="l110.46">   GetServerStateParser().SetConnected(true);</span>
<a href="#l110.47"></a><span id="l110.47"> </span>
<a href="#l110.48"></a><span id="l110.48">   // acknowledge that we are running the url now..</span>
<a href="#l110.49"></a><span id="l110.49">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(m_runningUrl, &amp;rv);</span>
<a href="#l110.50"></a><span id="l110.50" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l110.51"></a><span id="l110.51" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l110.52"></a><span id="l110.52">   mailnewsurl-&gt;GetSpec(urlSpec);</span>
<a href="#l110.53"></a><span id="l110.53">   Log(&quot;ProcessCurrentURL&quot;, urlSpec.get(), (validUrl) ? &quot; = currentUrl\n&quot; : &quot; is not valid\n&quot;);</span>
<a href="#l110.54"></a><span id="l110.54">   if (!validUrl)</span>
<a href="#l110.55"></a><span id="l110.55">     return false;</span>
<a href="#l110.56"></a><span id="l110.56"> </span>
<a href="#l110.57"></a><span id="l110.57">   if (NS_SUCCEEDED(rv) &amp;&amp; mailnewsurl &amp;&amp; m_imapMailFolderSink &amp;&amp; !rerunningUrl)</span>
<a href="#l110.58"></a><span id="l110.58">     m_imapMailFolderSink-&gt;SetUrlState(this, mailnewsurl, true, false,</span>
<a href="#l110.59"></a><span id="l110.59">                                       NS_OK);</span>
<a href="#l110.60"></a><span id="l110.60" class="difflineat">@@ -1637,17 +1637,17 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l110.61"></a><span id="l110.61">                     GetServerStateParser().SetCapabilityFlag(capabilityFlag);</span>
<a href="#l110.62"></a><span id="l110.62">                     CommitCapability();</span>
<a href="#l110.63"></a><span id="l110.63">                   }</span>
<a href="#l110.64"></a><span id="l110.64">                 }</span>
<a href="#l110.65"></a><span id="l110.65">               }</span>
<a href="#l110.66"></a><span id="l110.66">             }</span>
<a href="#l110.67"></a><span id="l110.67">             if (NS_FAILED(rv))</span>
<a href="#l110.68"></a><span id="l110.68">             {</span>
<a href="#l110.69"></a><span id="l110.69" class="difflineminus">-              nsCAutoString logLine(&quot;STARTTLS negotiation failed. Error 0x&quot;);</span>
<a href="#l110.70"></a><span id="l110.70" class="difflineplus">+              nsAutoCString logLine(&quot;STARTTLS negotiation failed. Error 0x&quot;);</span>
<a href="#l110.71"></a><span id="l110.71">               logLine.AppendInt(rv, 16);</span>
<a href="#l110.72"></a><span id="l110.72">               Log(&quot;ProcessCurrentURL&quot;, nullptr, logLine.get());</span>
<a href="#l110.73"></a><span id="l110.73">               if (m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l110.74"></a><span id="l110.74">               {</span>
<a href="#l110.75"></a><span id="l110.75">                 SetConnectionStatus(rv);        // stop netlib</span>
<a href="#l110.76"></a><span id="l110.76">                 m_transport-&gt;Close(rv);</span>
<a href="#l110.77"></a><span id="l110.77">               }</span>
<a href="#l110.78"></a><span id="l110.78">               else if (m_socketType == nsMsgSocketType::trySTARTTLS)</span>
<a href="#l110.79"></a><span id="l110.79" class="difflineat">@@ -2068,17 +2068,17 @@ bool nsImapProtocol::TryToRunUrlLocally(</span>
<a href="#l110.80"></a><span id="l110.80"> // on this monitor). There is a contract that the imap thread has already been started b4 we</span>
<a href="#l110.81"></a><span id="l110.81"> // attempt to load a url....</span>
<a href="#l110.82"></a><span id="l110.82"> NS_IMETHODIMP nsImapProtocol::LoadImapUrl(nsIURI * aURL, nsISupports * aConsumer)</span>
<a href="#l110.83"></a><span id="l110.83"> {</span>
<a href="#l110.84"></a><span id="l110.84">   nsresult rv;</span>
<a href="#l110.85"></a><span id="l110.85">   if (aURL)</span>
<a href="#l110.86"></a><span id="l110.86">   {</span>
<a href="#l110.87"></a><span id="l110.87"> #ifdef DEBUG_bienvenu</span>
<a href="#l110.88"></a><span id="l110.88" class="difflineminus">-    nsCAutoString urlSpec;</span>
<a href="#l110.89"></a><span id="l110.89" class="difflineplus">+    nsAutoCString urlSpec;</span>
<a href="#l110.90"></a><span id="l110.90">     aURL-&gt;GetSpec(urlSpec);</span>
<a href="#l110.91"></a><span id="l110.91">     printf(&quot;loading url %s\n&quot;, urlSpec.get());</span>
<a href="#l110.92"></a><span id="l110.92"> #endif</span>
<a href="#l110.93"></a><span id="l110.93">     if (TryToRunUrlLocally(aURL, aConsumer))</span>
<a href="#l110.94"></a><span id="l110.94">       return NS_OK;</span>
<a href="#l110.95"></a><span id="l110.95">     m_urlInProgress = true;</span>
<a href="#l110.96"></a><span id="l110.96">     m_imapMailFolderSink = nullptr;</span>
<a href="#l110.97"></a><span id="l110.97">     rv = SetupWithUrl(aURL, aConsumer);</span>
<a href="#l110.98"></a><span id="l110.98" class="difflineat">@@ -2181,18 +2181,18 @@ NS_IMETHODIMP nsImapProtocol::CanHandleU</span>
<a href="#l110.99"></a><span id="l110.99">   {</span>
<a href="#l110.100"></a><span id="l110.100">     // this connection might not be fully set up yet.</span>
<a href="#l110.101"></a><span id="l110.101">     return NS_ERROR_FAILURE;</span>
<a href="#l110.102"></a><span id="l110.102">   }</span>
<a href="#l110.103"></a><span id="l110.103">   IsBusy(&amp;isBusy, &amp;isInboxConnection);</span>
<a href="#l110.104"></a><span id="l110.104">   bool inSelectedState = GetServerStateParser().GetIMAPstate() ==</span>
<a href="#l110.105"></a><span id="l110.105">     nsImapServerResponseParser::kFolderSelected;</span>
<a href="#l110.106"></a><span id="l110.106"> </span>
<a href="#l110.107"></a><span id="l110.107" class="difflineminus">-  nsCAutoString curSelectedUrlFolderName;</span>
<a href="#l110.108"></a><span id="l110.108" class="difflineminus">-  nsCAutoString pendingUrlFolderName;</span>
<a href="#l110.109"></a><span id="l110.109" class="difflineplus">+  nsAutoCString curSelectedUrlFolderName;</span>
<a href="#l110.110"></a><span id="l110.110" class="difflineplus">+  nsAutoCString pendingUrlFolderName;</span>
<a href="#l110.111"></a><span id="l110.111">   if (inSelectedState)</span>
<a href="#l110.112"></a><span id="l110.112">     curSelectedUrlFolderName = GetServerStateParser().GetSelectedMailboxName();</span>
<a href="#l110.113"></a><span id="l110.113"> </span>
<a href="#l110.114"></a><span id="l110.114">   if (isBusy)</span>
<a href="#l110.115"></a><span id="l110.115">   {</span>
<a href="#l110.116"></a><span id="l110.116">     nsImapState curUrlImapState;</span>
<a href="#l110.117"></a><span id="l110.117">     NS_ASSERTION(m_runningUrl,&quot;isBusy, but no running url.&quot;);</span>
<a href="#l110.118"></a><span id="l110.118">     if (m_runningUrl)</span>
<a href="#l110.119"></a><span id="l110.119" class="difflineat">@@ -2666,17 +2666,17 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l110.120"></a><span id="l110.120">           // if we explicitly ask for headers, as opposed to getting them as a result</span>
<a href="#l110.121"></a><span id="l110.121">           // of selecting the folder, or biff, send the headerFetchCompleted notification</span>
<a href="#l110.122"></a><span id="l110.122">           // to flush out the header cache.</span>
<a href="#l110.123"></a><span id="l110.123">           HeaderFetchCompleted();</span>
<a href="#l110.124"></a><span id="l110.124">         }</span>
<a href="#l110.125"></a><span id="l110.125">         break;</span>
<a href="#l110.126"></a><span id="l110.126">       case nsIImapUrl::nsImapSearch:</span>
<a href="#l110.127"></a><span id="l110.127">         {</span>
<a href="#l110.128"></a><span id="l110.128" class="difflineminus">-          nsCAutoString searchCriteriaString;</span>
<a href="#l110.129"></a><span id="l110.129" class="difflineplus">+          nsAutoCString searchCriteriaString;</span>
<a href="#l110.130"></a><span id="l110.130">           m_runningUrl-&gt;CreateSearchCriteriaString(getter_Copies(searchCriteriaString));</span>
<a href="#l110.131"></a><span id="l110.131">           Search(searchCriteriaString.get(), bMessageIdsAreUids);</span>
<a href="#l110.132"></a><span id="l110.132">           // drop the results on the floor for now</span>
<a href="#l110.133"></a><span id="l110.133">         }</span>
<a href="#l110.134"></a><span id="l110.134">         break;</span>
<a href="#l110.135"></a><span id="l110.135">       case nsIImapUrl::nsImapUserDefinedMsgCommand:</span>
<a href="#l110.136"></a><span id="l110.136">         {</span>
<a href="#l110.137"></a><span id="l110.137">           nsCString messageIdString;</span>
<a href="#l110.138"></a><span id="l110.138" class="difflineat">@@ -2708,24 +2708,24 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l110.139"></a><span id="l110.139">           nsCString addFlags;</span>
<a href="#l110.140"></a><span id="l110.140">           nsCString subtractFlags;</span>
<a href="#l110.141"></a><span id="l110.141">           </span>
<a href="#l110.142"></a><span id="l110.142">           m_runningUrl-&gt;GetListOfMessageIds(messageIdString);</span>
<a href="#l110.143"></a><span id="l110.143">           m_runningUrl-&gt;GetCustomAddFlags(addFlags);</span>
<a href="#l110.144"></a><span id="l110.144">           m_runningUrl-&gt;GetCustomSubtractFlags(subtractFlags);</span>
<a href="#l110.145"></a><span id="l110.145">           if (!addFlags.IsEmpty())</span>
<a href="#l110.146"></a><span id="l110.146">           {</span>
<a href="#l110.147"></a><span id="l110.147" class="difflineminus">-            nsCAutoString storeString(&quot;+FLAGS (&quot;);</span>
<a href="#l110.148"></a><span id="l110.148" class="difflineplus">+            nsAutoCString storeString(&quot;+FLAGS (&quot;);</span>
<a href="#l110.149"></a><span id="l110.149">             storeString.Append(addFlags);</span>
<a href="#l110.150"></a><span id="l110.150">             storeString.Append(&quot;)&quot;);</span>
<a href="#l110.151"></a><span id="l110.151">             Store(messageIdString, storeString.get(), true);</span>
<a href="#l110.152"></a><span id="l110.152">           }</span>
<a href="#l110.153"></a><span id="l110.153">           if (!subtractFlags.IsEmpty())</span>
<a href="#l110.154"></a><span id="l110.154">           {</span>
<a href="#l110.155"></a><span id="l110.155" class="difflineminus">-            nsCAutoString storeString(&quot;-FLAGS (&quot;);</span>
<a href="#l110.156"></a><span id="l110.156" class="difflineplus">+            nsAutoCString storeString(&quot;-FLAGS (&quot;);</span>
<a href="#l110.157"></a><span id="l110.157">             storeString.Append(subtractFlags);</span>
<a href="#l110.158"></a><span id="l110.158">             storeString.Append(&quot;)&quot;);</span>
<a href="#l110.159"></a><span id="l110.159">             Store(messageIdString, storeString.get(), true);</span>
<a href="#l110.160"></a><span id="l110.160">           }</span>
<a href="#l110.161"></a><span id="l110.161">         }</span>
<a href="#l110.162"></a><span id="l110.162">         break;</span>
<a href="#l110.163"></a><span id="l110.163">       case nsIImapUrl::nsImapDeleteMsg:</span>
<a href="#l110.164"></a><span id="l110.164">         {</span>
<a href="#l110.165"></a><span id="l110.165" class="difflineat">@@ -3247,17 +3247,17 @@ void nsImapProtocol::PipelinedFetchMessa</span>
<a href="#l110.166"></a><span id="l110.166">   }</span>
<a href="#l110.167"></a><span id="l110.167"> }</span>
<a href="#l110.168"></a><span id="l110.168"> </span>
<a href="#l110.169"></a><span id="l110.169"> </span>
<a href="#l110.170"></a><span id="l110.170"> void nsImapProtocol::FetchMsgAttribute(const nsCString &amp;messageIds, const nsCString &amp;attribute)</span>
<a href="#l110.171"></a><span id="l110.171"> {</span>
<a href="#l110.172"></a><span id="l110.172">     IncrementCommandTagNumber();</span>
<a href="#l110.173"></a><span id="l110.173"> </span>
<a href="#l110.174"></a><span id="l110.174" class="difflineminus">-    nsCAutoString commandString (GetServerCommandTag());</span>
<a href="#l110.175"></a><span id="l110.175" class="difflineplus">+    nsAutoCString commandString (GetServerCommandTag());</span>
<a href="#l110.176"></a><span id="l110.176">     commandString.Append(&quot; UID fetch &quot;);</span>
<a href="#l110.177"></a><span id="l110.177">     commandString.Append(messageIds);</span>
<a href="#l110.178"></a><span id="l110.178">     commandString.Append(&quot; (&quot;);</span>
<a href="#l110.179"></a><span id="l110.179">     commandString.Append(attribute);</span>
<a href="#l110.180"></a><span id="l110.180">     commandString.Append(&quot;)&quot; CRLF);</span>
<a href="#l110.181"></a><span id="l110.181">     nsresult rv = SendData(commandString.get());</span>
<a href="#l110.182"></a><span id="l110.182"> </span>
<a href="#l110.183"></a><span id="l110.183">     if (NS_SUCCEEDED(rv))</span>
<a href="#l110.184"></a><span id="l110.184" class="difflineat">@@ -3902,17 +3902,17 @@ void nsImapProtocol::NormalMessageEndDow</span>
<a href="#l110.185"></a><span id="l110.185">   FlushDownloadCache();</span>
<a href="#l110.186"></a><span id="l110.186"> </span>
<a href="#l110.187"></a><span id="l110.187">   if (!GetServerStateParser().GetDownloadingHeaders())</span>
<a href="#l110.188"></a><span id="l110.188">   {</span>
<a href="#l110.189"></a><span id="l110.189">     int32_t updatedMessageSize = -1;</span>
<a href="#l110.190"></a><span id="l110.190">     if (m_bytesToChannel != GetServerStateParser().SizeOfMostRecentMessage()) {</span>
<a href="#l110.191"></a><span id="l110.191">       updatedMessageSize = m_bytesToChannel;</span>
<a href="#l110.192"></a><span id="l110.192"> #ifdef DEBUG</span>
<a href="#l110.193"></a><span id="l110.193" class="difflineminus">-      nsCAutoString message(&quot;Server's RFC822.SIZE &quot;);</span>
<a href="#l110.194"></a><span id="l110.194" class="difflineplus">+      nsAutoCString message(&quot;Server's RFC822.SIZE &quot;);</span>
<a href="#l110.195"></a><span id="l110.195">       message.AppendInt(GetServerStateParser().SizeOfMostRecentMessage());</span>
<a href="#l110.196"></a><span id="l110.196">       message += &quot; actual size &quot;;</span>
<a href="#l110.197"></a><span id="l110.197">       message.AppendInt(m_bytesToChannel);</span>
<a href="#l110.198"></a><span id="l110.198">       NS_WARNING(message.get());</span>
<a href="#l110.199"></a><span id="l110.199"> #endif</span>
<a href="#l110.200"></a><span id="l110.200">     }</span>
<a href="#l110.201"></a><span id="l110.201">     // need to know if we're downloading for display or not. We'll use action == nsImapMsgFetch for now</span>
<a href="#l110.202"></a><span id="l110.202">     nsImapAction imapAction = nsIImapUrl::nsImapSelectFolder; // just set it to some legal value</span>
<a href="#l110.203"></a><span id="l110.203" class="difflineat">@@ -3968,17 +3968,17 @@ void nsImapProtocol::ProcessMailboxUpdat</span>
<a href="#l110.204"></a><span id="l110.204"> </span>
<a href="#l110.205"></a><span id="l110.205">   // fetch the flags and uids of all existing messages or new ones</span>
<a href="#l110.206"></a><span id="l110.206">   if (!DeathSignalReceived() &amp;&amp; GetServerStateParser().NumberOfMessages())</span>
<a href="#l110.207"></a><span id="l110.207">   {</span>
<a href="#l110.208"></a><span id="l110.208">     if (handlePossibleUndo)</span>
<a href="#l110.209"></a><span id="l110.209">     {</span>
<a href="#l110.210"></a><span id="l110.210">       // undo any delete flags we may have asked to</span>
<a href="#l110.211"></a><span id="l110.211">       nsCString undoIdsStr;</span>
<a href="#l110.212"></a><span id="l110.212" class="difflineminus">-      nsCAutoString undoIds;</span>
<a href="#l110.213"></a><span id="l110.213" class="difflineplus">+      nsAutoCString undoIds;</span>
<a href="#l110.214"></a><span id="l110.214"> </span>
<a href="#l110.215"></a><span id="l110.215">       GetCurrentUrl()-&gt;GetListOfMessageIds(undoIdsStr);</span>
<a href="#l110.216"></a><span id="l110.216">       undoIds.Assign(undoIdsStr);</span>
<a href="#l110.217"></a><span id="l110.217">       if (!undoIds.IsEmpty())</span>
<a href="#l110.218"></a><span id="l110.218">       {</span>
<a href="#l110.219"></a><span id="l110.219">         char firstChar = (char) undoIds.CharAt(0);</span>
<a href="#l110.220"></a><span id="l110.220">         undoIds.Cut(0, 1);  // remove first character</span>
<a href="#l110.221"></a><span id="l110.221">         // if this string started with a '-', then this is an undo of a delete</span>
<a href="#l110.222"></a><span id="l110.222" class="difflineat">@@ -4322,17 +4322,17 @@ bool nsImapProtocol::CheckNewMail()</span>
<a href="#l110.223"></a><span id="l110.223">   if (!IMAP)</span>
<a href="#l110.224"></a><span id="l110.224">     IMAP = PR_NewLogModule(&quot;IMAP&quot;);</span>
<a href="#l110.225"></a><span id="l110.225"> </span>
<a href="#l110.226"></a><span id="l110.226">   if (PR_LOG_TEST(IMAP, PR_LOG_ALWAYS))</span>
<a href="#l110.227"></a><span id="l110.227">   {</span>
<a href="#l110.228"></a><span id="l110.228">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l110.229"></a><span id="l110.229">     if (mailnewsUrl)</span>
<a href="#l110.230"></a><span id="l110.230">     {</span>
<a href="#l110.231"></a><span id="l110.231" class="difflineminus">-      nsCAutoString urlSpec, unescapedUrlSpec;</span>
<a href="#l110.232"></a><span id="l110.232" class="difflineplus">+      nsAutoCString urlSpec, unescapedUrlSpec;</span>
<a href="#l110.233"></a><span id="l110.233">       mailnewsUrl-&gt;GetSpec(urlSpec);</span>
<a href="#l110.234"></a><span id="l110.234">       MsgUnescapeString(urlSpec, 0, unescapedUrlSpec);</span>
<a href="#l110.235"></a><span id="l110.235">       PR_LOG(IMAP, PR_LOG_ALWAYS, (&quot;%s:%s&quot;, logMsg, unescapedUrlSpec.get()));</span>
<a href="#l110.236"></a><span id="l110.236">     }</span>
<a href="#l110.237"></a><span id="l110.237">   }</span>
<a href="#l110.238"></a><span id="l110.238"> }</span>
<a href="#l110.239"></a><span id="l110.239"> </span>
<a href="#l110.240"></a><span id="l110.240"> // log info including current state...</span>
<a href="#l110.241"></a><span id="l110.241" class="difflineat">@@ -4700,17 +4700,17 @@ char* nsImapProtocol::CreateNewLineFromS</span>
<a href="#l110.242"></a><span id="l110.242">           else</span>
<a href="#l110.243"></a><span id="l110.243">             AlertUserEventUsingId(TestFlag(IMAP_RECEIVED_GREETING)</span>
<a href="#l110.244"></a><span id="l110.244">             ? IMAP_SERVER_DISCONNECTED : IMAP_SERVER_DROPPED_CONNECTION);</span>
<a href="#l110.245"></a><span id="l110.245">           break;</span>
<a href="#l110.246"></a><span id="l110.246">         default:</span>
<a href="#l110.247"></a><span id="l110.247">             break;</span>
<a href="#l110.248"></a><span id="l110.248">     }</span>
<a href="#l110.249"></a><span id="l110.249"> </span>
<a href="#l110.250"></a><span id="l110.250" class="difflineminus">-    nsCAutoString logMsg(&quot;clearing IMAP_CONNECTION_IS_OPEN - rv = &quot;);</span>
<a href="#l110.251"></a><span id="l110.251" class="difflineplus">+    nsAutoCString logMsg(&quot;clearing IMAP_CONNECTION_IS_OPEN - rv = &quot;);</span>
<a href="#l110.252"></a><span id="l110.252">     logMsg.AppendInt(rv, 16);</span>
<a href="#l110.253"></a><span id="l110.253">     Log(&quot;CreateNewLineFromSocket&quot;, nullptr, logMsg.get());</span>
<a href="#l110.254"></a><span id="l110.254">     ClearFlag(IMAP_CONNECTION_IS_OPEN);</span>
<a href="#l110.255"></a><span id="l110.255">     TellThreadToDie();</span>
<a href="#l110.256"></a><span id="l110.256">   }</span>
<a href="#l110.257"></a><span id="l110.257">   Log(&quot;CreateNewLineFromSocket&quot;, nullptr, newLine);</span>
<a href="#l110.258"></a><span id="l110.258">   SetConnectionStatus(newLine &amp;&amp; numBytesInLine ? NS_OK : rv); // set &gt; 0 if string is not null or empty</span>
<a href="#l110.259"></a><span id="l110.259">   return newLine;</span>
<a href="#l110.260"></a><span id="l110.260" class="difflineat">@@ -4839,17 +4839,17 @@ nsImapProtocol::DiscoverMailboxSpec(nsIm</span>
<a href="#l110.261"></a><span id="l110.261">           nsCString serverTrashName;</span>
<a href="#l110.262"></a><span id="l110.262">           m_runningUrl-&gt;AllocateCanonicalPath(trashMatch.get(),</span>
<a href="#l110.263"></a><span id="l110.263">                                               ns-&gt;GetDelimiter(),</span>
<a href="#l110.264"></a><span id="l110.264">                                               getter_Copies(serverTrashName));</span>
<a href="#l110.265"></a><span id="l110.265">           if (StringBeginsWith(serverTrashName,</span>
<a href="#l110.266"></a><span id="l110.266">                                NS_LITERAL_CSTRING(&quot;INBOX/&quot;),</span>
<a href="#l110.267"></a><span id="l110.267">                                nsCaseInsensitiveCStringComparator()))</span>
<a href="#l110.268"></a><span id="l110.268">           {</span>
<a href="#l110.269"></a><span id="l110.269" class="difflineminus">-            nsCAutoString pathName(adoptedBoxSpec-&gt;mAllocatedPathName.get() + 6);</span>
<a href="#l110.270"></a><span id="l110.270" class="difflineplus">+            nsAutoCString pathName(adoptedBoxSpec-&gt;mAllocatedPathName.get() + 6);</span>
<a href="#l110.271"></a><span id="l110.271">             trashExists =</span>
<a href="#l110.272"></a><span id="l110.272">               StringBeginsWith(adoptedBoxSpec-&gt;mAllocatedPathName,</span>
<a href="#l110.273"></a><span id="l110.273">                                serverTrashName,</span>
<a href="#l110.274"></a><span id="l110.274">                                nsCaseInsensitiveCStringComparator()) &amp;&amp; /* &quot;INBOX/&quot; */</span>
<a href="#l110.275"></a><span id="l110.275">               pathName.Equals(Substring(serverTrashName, 6), nsCaseInsensitiveCStringComparator());</span>
<a href="#l110.276"></a><span id="l110.276">           }</span>
<a href="#l110.277"></a><span id="l110.277">           else</span>
<a href="#l110.278"></a><span id="l110.278">             trashExists = adoptedBoxSpec-&gt;mAllocatedPathName.Equals(serverTrashName, nsCaseInsensitiveCStringComparator());</span>
<a href="#l110.279"></a><span id="l110.279" class="difflineat">@@ -5224,17 +5224,17 @@ nsImapProtocol::Expunge()</span>
<a href="#l110.280"></a><span id="l110.280">       nsMsgKey key = search-&gt;GetNextMessageNumber();</span>
<a href="#l110.281"></a><span id="l110.281">       delete search;</span>
<a href="#l110.282"></a><span id="l110.282">       if (key == 0)</span>
<a href="#l110.283"></a><span id="l110.283">         return;  //no deleted messages to expunge (bug 235004)</span>
<a href="#l110.284"></a><span id="l110.284">     }</span>
<a href="#l110.285"></a><span id="l110.285">   }</span>
<a href="#l110.286"></a><span id="l110.286"> </span>
<a href="#l110.287"></a><span id="l110.287">   IncrementCommandTagNumber();</span>
<a href="#l110.288"></a><span id="l110.288" class="difflineminus">-  nsCAutoString command(GetServerCommandTag());</span>
<a href="#l110.289"></a><span id="l110.289" class="difflineplus">+  nsAutoCString command(GetServerCommandTag());</span>
<a href="#l110.290"></a><span id="l110.290">   command.Append(&quot; expunge&quot; CRLF);</span>
<a href="#l110.291"></a><span id="l110.291"> </span>
<a href="#l110.292"></a><span id="l110.292">   nsresult rv = SendData(command.get());</span>
<a href="#l110.293"></a><span id="l110.293">   if (NS_SUCCEEDED(rv))</span>
<a href="#l110.294"></a><span id="l110.294">     ParseIMAPandCheckForNewMail();</span>
<a href="#l110.295"></a><span id="l110.295"> }</span>
<a href="#l110.296"></a><span id="l110.296"> </span>
<a href="#l110.297"></a><span id="l110.297"> void</span>
<a href="#l110.298"></a><span id="l110.298" class="difflineat">@@ -5392,17 +5392,17 @@ void nsImapProtocol::Language()</span>
<a href="#l110.299"></a><span id="l110.299"> </span>
<a href="#l110.300"></a><span id="l110.300">     // extract the desired language attribute from prefs</span>
<a href="#l110.301"></a><span id="l110.301">     nsresult rv = NS_OK;</span>
<a href="#l110.302"></a><span id="l110.302"> </span>
<a href="#l110.303"></a><span id="l110.303">     // we need to parse out the first language out of this comma separated list....</span>
<a href="#l110.304"></a><span id="l110.304">     // i.e if we have en,ja we only want to send en to the server.</span>
<a href="#l110.305"></a><span id="l110.305">     if (mAcceptLanguages.get())</span>
<a href="#l110.306"></a><span id="l110.306">     {</span>
<a href="#l110.307"></a><span id="l110.307" class="difflineminus">-      nsCAutoString extractedLanguage;</span>
<a href="#l110.308"></a><span id="l110.308" class="difflineplus">+      nsAutoCString extractedLanguage;</span>
<a href="#l110.309"></a><span id="l110.309">       LossyCopyUTF16toASCII(mAcceptLanguages, extractedLanguage);</span>
<a href="#l110.310"></a><span id="l110.310">       int32_t pos = extractedLanguage.FindChar(',');</span>
<a href="#l110.311"></a><span id="l110.311">       if (pos &gt; 0) // we have a comma separated list of languages...</span>
<a href="#l110.312"></a><span id="l110.312">         extractedLanguage.SetLength(pos); // truncate everything after the first comma (including the comma)</span>
<a href="#l110.313"></a><span id="l110.313"> </span>
<a href="#l110.314"></a><span id="l110.314">       if (extractedLanguage.IsEmpty())</span>
<a href="#l110.315"></a><span id="l110.315">         return;</span>
<a href="#l110.316"></a><span id="l110.316"> </span>
<a href="#l110.317"></a><span id="l110.317" class="difflineat">@@ -5553,49 +5553,49 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l110.318"></a><span id="l110.318">   char * currentCommand=nullptr;</span>
<a href="#l110.319"></a><span id="l110.319">   nsresult rv;</span>
<a href="#l110.320"></a><span id="l110.320"> </span>
<a href="#l110.321"></a><span id="l110.321">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;IMAP: trying auth method 0x%X&quot;, m_currentAuthMethod));</span>
<a href="#l110.322"></a><span id="l110.322"> </span>
<a href="#l110.323"></a><span id="l110.323">   if (flag &amp; kHasAuthExternalCapability)</span>
<a href="#l110.324"></a><span id="l110.324">   {</span>
<a href="#l110.325"></a><span id="l110.325">       char *base64UserName = PL_Base64Encode(userName, strlen(userName), nullptr);</span>
<a href="#l110.326"></a><span id="l110.326" class="difflineminus">-      nsCAutoString command (GetServerCommandTag());</span>
<a href="#l110.327"></a><span id="l110.327" class="difflineplus">+      nsAutoCString command (GetServerCommandTag());</span>
<a href="#l110.328"></a><span id="l110.328">       command.Append(&quot; authenticate EXTERNAL &quot; );</span>
<a href="#l110.329"></a><span id="l110.329">       command.Append(base64UserName);</span>
<a href="#l110.330"></a><span id="l110.330">       command.Append(CRLF);</span>
<a href="#l110.331"></a><span id="l110.331"> 	  PR_Free(base64UserName);</span>
<a href="#l110.332"></a><span id="l110.332">       rv = SendData(command.get());</span>
<a href="#l110.333"></a><span id="l110.333">       ParseIMAPandCheckForNewMail();</span>
<a href="#l110.334"></a><span id="l110.334">       nsImapServerResponseParser &amp;parser = GetServerStateParser();</span>
<a href="#l110.335"></a><span id="l110.335">       if (parser.LastCommandSuccessful())</span>
<a href="#l110.336"></a><span id="l110.336">         return NS_OK;</span>
<a href="#l110.337"></a><span id="l110.337">       parser.SetCapabilityFlag(parser.GetCapabilityFlag() &amp; ~kHasAuthExternalCapability);</span>
<a href="#l110.338"></a><span id="l110.338">   }</span>
<a href="#l110.339"></a><span id="l110.339">   else if (flag &amp; kHasCRAMCapability)</span>
<a href="#l110.340"></a><span id="l110.340">   {</span>
<a href="#l110.341"></a><span id="l110.341">     NS_ENSURE_TRUE(m_imapServerSink, NS_ERROR_NULL_POINTER);</span>
<a href="#l110.342"></a><span id="l110.342">     PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;MD5 auth&quot;));</span>
<a href="#l110.343"></a><span id="l110.343">     // inform the server that we want to begin a CRAM authentication procedure...</span>
<a href="#l110.344"></a><span id="l110.344" class="difflineminus">-    nsCAutoString command (GetServerCommandTag());</span>
<a href="#l110.345"></a><span id="l110.345" class="difflineplus">+    nsAutoCString command (GetServerCommandTag());</span>
<a href="#l110.346"></a><span id="l110.346">     command.Append(&quot; authenticate CRAM-MD5&quot; CRLF);</span>
<a href="#l110.347"></a><span id="l110.347">     rv = SendData(command.get());</span>
<a href="#l110.348"></a><span id="l110.348">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.349"></a><span id="l110.349">     ParseIMAPandCheckForNewMail();</span>
<a href="#l110.350"></a><span id="l110.350">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l110.351"></a><span id="l110.351">     {</span>
<a href="#l110.352"></a><span id="l110.352">       char *digest = nullptr;</span>
<a href="#l110.353"></a><span id="l110.353">       char *cramDigest = GetServerStateParser().fAuthChallenge;</span>
<a href="#l110.354"></a><span id="l110.354">       char *decodedChallenge = PL_Base64Decode(cramDigest,</span>
<a href="#l110.355"></a><span id="l110.355">                                                 strlen(cramDigest), nullptr);</span>
<a href="#l110.356"></a><span id="l110.356">       rv = m_imapServerSink-&gt;CramMD5Hash(decodedChallenge, password.get(), &amp;digest);</span>
<a href="#l110.357"></a><span id="l110.357">       PR_Free(decodedChallenge);</span>
<a href="#l110.358"></a><span id="l110.358">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.359"></a><span id="l110.359">       NS_ENSURE_TRUE(digest, NS_ERROR_NULL_POINTER);</span>
<a href="#l110.360"></a><span id="l110.360" class="difflineminus">-      nsCAutoString encodedDigest;</span>
<a href="#l110.361"></a><span id="l110.361" class="difflineplus">+      nsAutoCString encodedDigest;</span>
<a href="#l110.362"></a><span id="l110.362">       char hexVal[8];</span>
<a href="#l110.363"></a><span id="l110.363"> </span>
<a href="#l110.364"></a><span id="l110.364">       for (uint32_t j=0; j&lt;16; j++)</span>
<a href="#l110.365"></a><span id="l110.365">       {</span>
<a href="#l110.366"></a><span id="l110.366">         PR_snprintf (hexVal,8, &quot;%.2x&quot;, 0x0ff &amp; (unsigned short)(digest[j]));</span>
<a href="#l110.367"></a><span id="l110.367">         encodedDigest.Append(hexVal);</span>
<a href="#l110.368"></a><span id="l110.368">       }</span>
<a href="#l110.369"></a><span id="l110.369"> </span>
<a href="#l110.370"></a><span id="l110.370" class="difflineat">@@ -5614,24 +5614,24 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l110.371"></a><span id="l110.371">     PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;MD5 auth&quot;));</span>
<a href="#l110.372"></a><span id="l110.372"> </span>
<a href="#l110.373"></a><span id="l110.373">     // Only try GSSAPI once - if it fails, its going to be because we don't</span>
<a href="#l110.374"></a><span id="l110.374">     // have valid credentials</span>
<a href="#l110.375"></a><span id="l110.375">     //MarkAuthMethodAsFailed(kHasAuthGssApiCapability);</span>
<a href="#l110.376"></a><span id="l110.376"> </span>
<a href="#l110.377"></a><span id="l110.377">     // We do step1 first, so we don't try GSSAPI against a server which</span>
<a href="#l110.378"></a><span id="l110.378">     // we can't get credentials for.</span>
<a href="#l110.379"></a><span id="l110.379" class="difflineminus">-    nsCAutoString response;</span>
<a href="#l110.380"></a><span id="l110.380" class="difflineminus">-</span>
<a href="#l110.381"></a><span id="l110.381" class="difflineminus">-    nsCAutoString service(&quot;imap@&quot;);</span>
<a href="#l110.382"></a><span id="l110.382" class="difflineplus">+    nsAutoCString response;</span>
<a href="#l110.383"></a><span id="l110.383" class="difflineplus">+</span>
<a href="#l110.384"></a><span id="l110.384" class="difflineplus">+    nsAutoCString service(&quot;imap@&quot;);</span>
<a href="#l110.385"></a><span id="l110.385">     service.Append(m_realHostName);</span>
<a href="#l110.386"></a><span id="l110.386">     rv = DoGSSAPIStep1(service.get(), userName, response);</span>
<a href="#l110.387"></a><span id="l110.387">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.388"></a><span id="l110.388"> </span>
<a href="#l110.389"></a><span id="l110.389" class="difflineminus">-    nsCAutoString command (GetServerCommandTag());</span>
<a href="#l110.390"></a><span id="l110.390" class="difflineplus">+    nsAutoCString command (GetServerCommandTag());</span>
<a href="#l110.391"></a><span id="l110.391">     command.Append(&quot; authenticate GSSAPI&quot; CRLF);</span>
<a href="#l110.392"></a><span id="l110.392">     rv = SendData(command.get());</span>
<a href="#l110.393"></a><span id="l110.393">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.394"></a><span id="l110.394"> </span>
<a href="#l110.395"></a><span id="l110.395">     ParseIMAPandCheckForNewMail(&quot;AUTH GSSAPI&quot;);</span>
<a href="#l110.396"></a><span id="l110.396">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l110.397"></a><span id="l110.397">     {</span>
<a href="#l110.398"></a><span id="l110.398">       response += CRLF;</span>
<a href="#l110.399"></a><span id="l110.399" class="difflineat">@@ -5657,24 +5657,24 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l110.400"></a><span id="l110.400">         ParseIMAPandCheckForNewMail(command.get());</span>
<a href="#l110.401"></a><span id="l110.401">       }</span>
<a href="#l110.402"></a><span id="l110.402">       // TODO: whether it worked or not is shown by LastCommandSuccessful(), not gssrv, right?</span>
<a href="#l110.403"></a><span id="l110.403">     }</span>
<a href="#l110.404"></a><span id="l110.404">   }</span>
<a href="#l110.405"></a><span id="l110.405">   else if (flag &amp; (kHasAuthNTLMCapability | kHasAuthMSNCapability))</span>
<a href="#l110.406"></a><span id="l110.406">   {</span>
<a href="#l110.407"></a><span id="l110.407">     PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;NTLM auth&quot;));</span>
<a href="#l110.408"></a><span id="l110.408" class="difflineminus">-    nsCAutoString command (GetServerCommandTag());</span>
<a href="#l110.409"></a><span id="l110.409" class="difflineplus">+    nsAutoCString command (GetServerCommandTag());</span>
<a href="#l110.410"></a><span id="l110.410">     command.Append((flag &amp; kHasAuthNTLMCapability) ? &quot; authenticate NTLM&quot; CRLF</span>
<a href="#l110.411"></a><span id="l110.411">                                                    : &quot; authenticate MSN&quot; CRLF);</span>
<a href="#l110.412"></a><span id="l110.412">     rv = SendData(command.get());</span>
<a href="#l110.413"></a><span id="l110.413">     ParseIMAPandCheckForNewMail(&quot;AUTH NTLM&quot;); // this just waits for ntlm step 1</span>
<a href="#l110.414"></a><span id="l110.414">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l110.415"></a><span id="l110.415">     {</span>
<a href="#l110.416"></a><span id="l110.416" class="difflineminus">-      nsCAutoString cmd;</span>
<a href="#l110.417"></a><span id="l110.417" class="difflineplus">+      nsAutoCString cmd;</span>
<a href="#l110.418"></a><span id="l110.418">       rv = DoNtlmStep1(userName, password.get(), cmd);</span>
<a href="#l110.419"></a><span id="l110.419">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.420"></a><span id="l110.420">       cmd += CRLF;</span>
<a href="#l110.421"></a><span id="l110.421">       rv = SendData(cmd.get());</span>
<a href="#l110.422"></a><span id="l110.422">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.423"></a><span id="l110.423">       ParseIMAPandCheckForNewMail(command.get());</span>
<a href="#l110.424"></a><span id="l110.424">       if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l110.425"></a><span id="l110.425">       {</span>
<a href="#l110.426"></a><span id="l110.426" class="difflineat">@@ -5694,17 +5694,17 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l110.427"></a><span id="l110.427">     PR_snprintf(m_dataOutputBuf, OUTPUT_BUFFER_SIZE, &quot;%s authenticate plain&quot; CRLF, GetServerCommandTag());</span>
<a href="#l110.428"></a><span id="l110.428">     rv = SendData(m_dataOutputBuf);</span>
<a href="#l110.429"></a><span id="l110.429">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.430"></a><span id="l110.430">     currentCommand = PL_strdup(m_dataOutputBuf); /* StrAllocCopy(currentCommand, GetOutputBuffer()); */</span>
<a href="#l110.431"></a><span id="l110.431">     ParseIMAPandCheckForNewMail();</span>
<a href="#l110.432"></a><span id="l110.432">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l110.433"></a><span id="l110.433">     {</span>
<a href="#l110.434"></a><span id="l110.434">       // RFC 4616</span>
<a href="#l110.435"></a><span id="l110.435" class="difflineminus">-      char plainstr[512]; // placeholder for &quot;&lt;NUL&gt;userName&lt;NUL&gt;password&quot; TODO nsCAutoString</span>
<a href="#l110.436"></a><span id="l110.436" class="difflineplus">+      char plainstr[512]; // placeholder for &quot;&lt;NUL&gt;userName&lt;NUL&gt;password&quot; TODO nsAutoCString</span>
<a href="#l110.437"></a><span id="l110.437">       int len = 1; // count for first &lt;NUL&gt; char</span>
<a href="#l110.438"></a><span id="l110.438">       memset(plainstr, 0, 512);</span>
<a href="#l110.439"></a><span id="l110.439">       PR_snprintf(&amp;plainstr[1], 510, &quot;%s&quot;, userName);</span>
<a href="#l110.440"></a><span id="l110.440">       len += PL_strlen(userName);</span>
<a href="#l110.441"></a><span id="l110.441">       len++;  // count for second &lt;NUL&gt; char</span>
<a href="#l110.442"></a><span id="l110.442">       PR_snprintf(&amp;plainstr[len], 511-len, &quot;%s&quot;, password.get());</span>
<a href="#l110.443"></a><span id="l110.443">       len += password.Length();</span>
<a href="#l110.444"></a><span id="l110.444">       char *base64Str = PL_Base64Encode(plainstr, len, nullptr);</span>
<a href="#l110.445"></a><span id="l110.445" class="difflineat">@@ -5746,25 +5746,25 @@ nsresult nsImapProtocol::AuthLogin(const</span>
<a href="#l110.446"></a><span id="l110.446">     } // if last command successful</span>
<a href="#l110.447"></a><span id="l110.447">   } // if has auth login capability</span>
<a href="#l110.448"></a><span id="l110.448">   else if (flag &amp; kHasAuthOldLoginCapability)</span>
<a href="#l110.449"></a><span id="l110.449">   {</span>
<a href="#l110.450"></a><span id="l110.450">     PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;old-style auth&quot;));</span>
<a href="#l110.451"></a><span id="l110.451">     ProgressEventFunctionUsingId (IMAP_STATUS_SENDING_LOGIN);</span>
<a href="#l110.452"></a><span id="l110.452">     IncrementCommandTagNumber();</span>
<a href="#l110.453"></a><span id="l110.453">     nsCString command (GetServerCommandTag());</span>
<a href="#l110.454"></a><span id="l110.454" class="difflineminus">-    nsCAutoString escapedUserName;</span>
<a href="#l110.455"></a><span id="l110.455" class="difflineplus">+    nsAutoCString escapedUserName;</span>
<a href="#l110.456"></a><span id="l110.456">     command.Append(&quot; login \&quot;&quot;);</span>
<a href="#l110.457"></a><span id="l110.457">     EscapeUserNamePasswordString(userName, &amp;escapedUserName);</span>
<a href="#l110.458"></a><span id="l110.458">     command.Append(escapedUserName);</span>
<a href="#l110.459"></a><span id="l110.459">     command.Append(&quot;\&quot; \&quot;&quot;);</span>
<a href="#l110.460"></a><span id="l110.460"> </span>
<a href="#l110.461"></a><span id="l110.461">     // if the password contains a \, login will fail</span>
<a href="#l110.462"></a><span id="l110.462">     // turn foo\bar into foo\\bar</span>
<a href="#l110.463"></a><span id="l110.463" class="difflineminus">-    nsCAutoString correctedPassword;</span>
<a href="#l110.464"></a><span id="l110.464" class="difflineplus">+    nsAutoCString correctedPassword;</span>
<a href="#l110.465"></a><span id="l110.465">     EscapeUserNamePasswordString(password.get(), &amp;correctedPassword);</span>
<a href="#l110.466"></a><span id="l110.466">     command.Append(correctedPassword);</span>
<a href="#l110.467"></a><span id="l110.467">     command.Append(&quot;\&quot;&quot; CRLF);</span>
<a href="#l110.468"></a><span id="l110.468">     rv = SendData(command.get(), true /* suppress logging */);</span>
<a href="#l110.469"></a><span id="l110.469">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l110.470"></a><span id="l110.470">     ParseIMAPandCheckForNewMail();</span>
<a href="#l110.471"></a><span id="l110.471">   }</span>
<a href="#l110.472"></a><span id="l110.472">   else if (flag &amp; kHasAuthNoneCapability)</span>
<a href="#l110.473"></a><span id="l110.473" class="difflineat">@@ -6482,17 +6482,17 @@ void nsImapProtocol::OnStatusForFolder(c</span>
<a href="#l110.474"></a><span id="l110.474">     if (m_imapMailFolderSink &amp;&amp; GetServerStateParser().NumberOfRecentMessages()</span>
<a href="#l110.475"></a><span id="l110.475">           || prevNumMessages != GetServerStateParser().NumberOfMessages())</span>
<a href="#l110.476"></a><span id="l110.476">       m_imapMailFolderSink-&gt;OnNewIdleMessages();</span>
<a href="#l110.477"></a><span id="l110.477">     return;</span>
<a href="#l110.478"></a><span id="l110.478">   }</span>
<a href="#l110.479"></a><span id="l110.479"> </span>
<a href="#l110.480"></a><span id="l110.480">   IncrementCommandTagNumber();</span>
<a href="#l110.481"></a><span id="l110.481"> </span>
<a href="#l110.482"></a><span id="l110.482" class="difflineminus">-  nsCAutoString command(GetServerCommandTag());</span>
<a href="#l110.483"></a><span id="l110.483" class="difflineplus">+  nsAutoCString command(GetServerCommandTag());</span>
<a href="#l110.484"></a><span id="l110.484">   nsCString escapedName;</span>
<a href="#l110.485"></a><span id="l110.485">   CreateEscapedMailboxName(mailboxName, escapedName);</span>
<a href="#l110.486"></a><span id="l110.486"> </span>
<a href="#l110.487"></a><span id="l110.487">   command.Append(&quot; STATUS \&quot;&quot;);</span>
<a href="#l110.488"></a><span id="l110.488">   command.Append(escapedName);</span>
<a href="#l110.489"></a><span id="l110.489">   command.Append(&quot;\&quot; (UIDNEXT MESSAGES UNSEEN RECENT)&quot; CRLF);</span>
<a href="#l110.490"></a><span id="l110.490"> </span>
<a href="#l110.491"></a><span id="l110.491">   nsresult rv = SendData(command.get());</span>
<a href="#l110.492"></a><span id="l110.492" class="difflineat">@@ -7064,23 +7064,23 @@ void nsImapProtocol::DiscoverAllAndSubsc</span>
<a href="#l110.493"></a><span id="l110.493">             }</span>
<a href="#l110.494"></a><span id="l110.494"> </span>
<a href="#l110.495"></a><span id="l110.495">             DiscoverMailboxSpec(boxSpec);</span>
<a href="#l110.496"></a><span id="l110.496">           }</span>
<a href="#l110.497"></a><span id="l110.497">           else</span>
<a href="#l110.498"></a><span id="l110.498">             HandleMemoryFailure();</span>
<a href="#l110.499"></a><span id="l110.499">         }</span>
<a href="#l110.500"></a><span id="l110.500"> </span>
<a href="#l110.501"></a><span id="l110.501" class="difflineminus">-        nsCAutoString allPattern(prefix);</span>
<a href="#l110.502"></a><span id="l110.502" class="difflineplus">+        nsAutoCString allPattern(prefix);</span>
<a href="#l110.503"></a><span id="l110.503">         allPattern += '*';</span>
<a href="#l110.504"></a><span id="l110.504"> </span>
<a href="#l110.505"></a><span id="l110.505" class="difflineminus">-        nsCAutoString topLevelPattern(prefix);</span>
<a href="#l110.506"></a><span id="l110.506" class="difflineplus">+        nsAutoCString topLevelPattern(prefix);</span>
<a href="#l110.507"></a><span id="l110.507">         topLevelPattern += '%';</span>
<a href="#l110.508"></a><span id="l110.508"> </span>
<a href="#l110.509"></a><span id="l110.509" class="difflineminus">-        nsCAutoString secondLevelPattern;</span>
<a href="#l110.510"></a><span id="l110.510" class="difflineplus">+        nsAutoCString secondLevelPattern;</span>
<a href="#l110.511"></a><span id="l110.511"> </span>
<a href="#l110.512"></a><span id="l110.512">         char delimiter = ns-&gt;GetDelimiter();</span>
<a href="#l110.513"></a><span id="l110.513">         if (delimiter)</span>
<a href="#l110.514"></a><span id="l110.514">         {</span>
<a href="#l110.515"></a><span id="l110.515">           // Hierarchy delimiter might be NIL, in which case there's no hierarchy anyway</span>
<a href="#l110.516"></a><span id="l110.516">           secondLevelPattern = prefix;</span>
<a href="#l110.517"></a><span id="l110.517">           secondLevelPattern += '%';</span>
<a href="#l110.518"></a><span id="l110.518">           secondLevelPattern += delimiter;</span>
<a href="#l110.519"></a><span id="l110.519" class="difflineat">@@ -7125,17 +7125,17 @@ void nsImapProtocol::DiscoverMailboxList</span>
<a href="#l110.520"></a><span id="l110.520">   // Pretend that the Trash folder doesn't exist, so we will rediscover it if we need to.</span>
<a href="#l110.521"></a><span id="l110.521">   m_hostSessionList-&gt;SetOnlineTrashFolderExistsForHost(GetImapServerKey(), false);</span>
<a href="#l110.522"></a><span id="l110.522"> </span>
<a href="#l110.523"></a><span id="l110.523">   // should we check a pref here, to be able to turn off XList?</span>
<a href="#l110.524"></a><span id="l110.524">   bool hasXLIST = GetServerStateParser().GetCapabilityFlag() &amp; kHasXListCapability;</span>
<a href="#l110.525"></a><span id="l110.525">   if (hasXLIST &amp;&amp; usingSubscription)</span>
<a href="#l110.526"></a><span id="l110.526">   {</span>
<a href="#l110.527"></a><span id="l110.527">     m_hierarchyNameState = kXListing;</span>
<a href="#l110.528"></a><span id="l110.528" class="difflineminus">-    nsCAutoString pattern(&quot;%&quot;);</span>
<a href="#l110.529"></a><span id="l110.529" class="difflineplus">+    nsAutoCString pattern(&quot;%&quot;);</span>
<a href="#l110.530"></a><span id="l110.530">     List(&quot;%&quot;, true, true);</span>
<a href="#l110.531"></a><span id="l110.531">     // We list the first and second levels since special folders are unlikely</span>
<a href="#l110.532"></a><span id="l110.532">     // to be more than 2 levels deep.</span>
<a href="#l110.533"></a><span id="l110.533">     char separator = 0;</span>
<a href="#l110.534"></a><span id="l110.534">     m_runningUrl-&gt;GetOnlineSubDirSeparator(&amp;separator);</span>
<a href="#l110.535"></a><span id="l110.535">     pattern.Append(separator);</span>
<a href="#l110.536"></a><span id="l110.536">     pattern += '%';</span>
<a href="#l110.537"></a><span id="l110.537">     List(pattern.get(), true, true);</span>
<a href="#l110.538"></a><span id="l110.538" class="difflineat">@@ -7578,17 +7578,17 @@ void nsImapProtocol::Unsubscribe(const c</span>
<a href="#l110.539"></a><span id="l110.539"> }</span>
<a href="#l110.540"></a><span id="l110.540"> </span>
<a href="#l110.541"></a><span id="l110.541"> void nsImapProtocol::Idle()</span>
<a href="#l110.542"></a><span id="l110.542"> {</span>
<a href="#l110.543"></a><span id="l110.543">   IncrementCommandTagNumber();</span>
<a href="#l110.544"></a><span id="l110.544"> </span>
<a href="#l110.545"></a><span id="l110.545">   if (m_urlInProgress)</span>
<a href="#l110.546"></a><span id="l110.546">     return;</span>
<a href="#l110.547"></a><span id="l110.547" class="difflineminus">-  nsCAutoString command (GetServerCommandTag());</span>
<a href="#l110.548"></a><span id="l110.548" class="difflineplus">+  nsAutoCString command (GetServerCommandTag());</span>
<a href="#l110.549"></a><span id="l110.549">   command += &quot; IDLE&quot; CRLF;</span>
<a href="#l110.550"></a><span id="l110.550">   nsresult rv = SendData(command.get());</span>
<a href="#l110.551"></a><span id="l110.551">   if (NS_SUCCEEDED(rv))</span>
<a href="#l110.552"></a><span id="l110.552">   {</span>
<a href="#l110.553"></a><span id="l110.553">       m_idle = true;</span>
<a href="#l110.554"></a><span id="l110.554">       // we'll just get back a continuation char at first.</span>
<a href="#l110.555"></a><span id="l110.555">       // + idling...</span>
<a href="#l110.556"></a><span id="l110.556">       ParseIMAPandCheckForNewMail();</span>
<a href="#l110.557"></a><span id="l110.557" class="difflineat">@@ -7640,17 +7640,17 @@ void nsImapProtocol::Search(const char *</span>
<a href="#l110.558"></a><span id="l110.558">   protocolString.Append(searchCriteria);</span>
<a href="#l110.559"></a><span id="l110.559">   // the search criteria can contain string literals, which means we</span>
<a href="#l110.560"></a><span id="l110.560">   // need to break up the protocol string by CRLF's, and after sending CRLF,</span>
<a href="#l110.561"></a><span id="l110.561">   // wait for the server to respond OK before sending more data</span>
<a href="#l110.562"></a><span id="l110.562">   nsresult rv;</span>
<a href="#l110.563"></a><span id="l110.563">   int32_t crlfIndex;</span>
<a href="#l110.564"></a><span id="l110.564">   while (crlfIndex = protocolString.Find(CRLF), crlfIndex != kNotFound &amp;&amp; !DeathSignalReceived())</span>
<a href="#l110.565"></a><span id="l110.565">   {</span>
<a href="#l110.566"></a><span id="l110.566" class="difflineminus">-    nsCAutoString tempProtocolString;</span>
<a href="#l110.567"></a><span id="l110.567" class="difflineplus">+    nsAutoCString tempProtocolString;</span>
<a href="#l110.568"></a><span id="l110.568">     tempProtocolString = StringHead(protocolString, crlfIndex + 2);</span>
<a href="#l110.569"></a><span id="l110.569">     rv = SendData(tempProtocolString.get());</span>
<a href="#l110.570"></a><span id="l110.570">     if (NS_FAILED(rv))</span>
<a href="#l110.571"></a><span id="l110.571">       return;</span>
<a href="#l110.572"></a><span id="l110.572">     ParseIMAPandCheckForNewMail();</span>
<a href="#l110.573"></a><span id="l110.573">     protocolString.Cut(0, crlfIndex + 2);</span>
<a href="#l110.574"></a><span id="l110.574">   }</span>
<a href="#l110.575"></a><span id="l110.575">   protocolString.Append(CRLF);</span>
<a href="#l110.576"></a><span id="l110.576" class="difflineat">@@ -7692,17 +7692,17 @@ void nsImapProtocol::Copy(const char * m</span>
<a href="#l110.577"></a><span id="l110.577">       AllocateImapUidString(msgKeys.Elements() + msgsHandled, msgsToHandle, m_flagState, idString);</span>
<a href="#l110.578"></a><span id="l110.578">     else</span>
<a href="#l110.579"></a><span id="l110.579">       idString.Assign(messageList);</span>
<a href="#l110.580"></a><span id="l110.580"> </span>
<a href="#l110.581"></a><span id="l110.581">     msgsHandled += msgsToHandle;</span>
<a href="#l110.582"></a><span id="l110.582">     msgCountLeft -= msgsToHandle;</span>
<a href="#l110.583"></a><span id="l110.583"> </span>
<a href="#l110.584"></a><span id="l110.584">     IncrementCommandTagNumber();</span>
<a href="#l110.585"></a><span id="l110.585" class="difflineminus">-    nsCAutoString protocolString(GetServerCommandTag());</span>
<a href="#l110.586"></a><span id="l110.586" class="difflineplus">+    nsAutoCString protocolString(GetServerCommandTag());</span>
<a href="#l110.587"></a><span id="l110.587">     if (idsAreUid)</span>
<a href="#l110.588"></a><span id="l110.588">       protocolString.Append(&quot; uid&quot;);</span>
<a href="#l110.589"></a><span id="l110.589">     // If it's a MOVE operation on aol servers then use 'xaol-move' cmd.</span>
<a href="#l110.590"></a><span id="l110.590">     if ((m_imapAction == nsIImapUrl::nsImapOnlineMove) &amp;&amp;</span>
<a href="#l110.591"></a><span id="l110.591">         GetServerStateParser().ServerIsAOLServer())</span>
<a href="#l110.592"></a><span id="l110.592">       protocolString.Append(&quot; xaol-move &quot;);</span>
<a href="#l110.593"></a><span id="l110.593">     else if ((m_imapAction == nsIImapUrl::nsImapOnlineMove) &amp;&amp;</span>
<a href="#l110.594"></a><span id="l110.594">              GetServerStateParser().GetCapabilityFlag() &amp; kHasMoveCapability)</span>
<a href="#l110.595"></a><span id="l110.595" class="difflineat">@@ -7730,18 +7730,18 @@ void nsImapProtocol::NthLevelChildList(c</span>
<a href="#l110.596"></a><span id="l110.596">                   &quot;Oops ... depth must be equal or greater than 0&quot;);</span>
<a href="#l110.597"></a><span id="l110.597">   if (depth &lt; 0) return;</span>
<a href="#l110.598"></a><span id="l110.598"> </span>
<a href="#l110.599"></a><span id="l110.599">   nsCString truncatedPrefix (onlineMailboxPrefix);</span>
<a href="#l110.600"></a><span id="l110.600">   PRUnichar slash = '/';</span>
<a href="#l110.601"></a><span id="l110.601">   if (truncatedPrefix.Last() == slash)</span>
<a href="#l110.602"></a><span id="l110.602">         truncatedPrefix.SetLength(truncatedPrefix.Length()-1);</span>
<a href="#l110.603"></a><span id="l110.603"> </span>
<a href="#l110.604"></a><span id="l110.604" class="difflineminus">-  nsCAutoString pattern(truncatedPrefix);</span>
<a href="#l110.605"></a><span id="l110.605" class="difflineminus">-  nsCAutoString suffix;</span>
<a href="#l110.606"></a><span id="l110.606" class="difflineplus">+  nsAutoCString pattern(truncatedPrefix);</span>
<a href="#l110.607"></a><span id="l110.607" class="difflineplus">+  nsAutoCString suffix;</span>
<a href="#l110.608"></a><span id="l110.608">   int count = 0;</span>
<a href="#l110.609"></a><span id="l110.609">   char separator = 0;</span>
<a href="#l110.610"></a><span id="l110.610">   m_runningUrl-&gt;GetOnlineSubDirSeparator(&amp;separator);</span>
<a href="#l110.611"></a><span id="l110.611">   suffix.Assign(separator);</span>
<a href="#l110.612"></a><span id="l110.612">   suffix += '%';</span>
<a href="#l110.613"></a><span id="l110.613"> </span>
<a href="#l110.614"></a><span id="l110.614">   while (count &lt; depth)</span>
<a href="#l110.615"></a><span id="l110.615">   {</span>
<a href="#l110.616"></a><span id="l110.616" class="difflineat">@@ -8104,17 +8104,17 @@ nsresult nsImapProtocol::GetPassword(nsC</span>
<a href="#l110.617"></a><span id="l110.617">   rv = server-&gt;GetPassword(password);</span>
<a href="#l110.618"></a><span id="l110.618">   if (NS_FAILED(rv) || password.IsEmpty())</span>
<a href="#l110.619"></a><span id="l110.619">   {</span>
<a href="#l110.620"></a><span id="l110.620">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l110.621"></a><span id="l110.621">     GetMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l110.622"></a><span id="l110.622">     NS_ENSURE_TRUE(msgWindow, NS_ERROR_NOT_AVAILABLE); // biff case</span>
<a href="#l110.623"></a><span id="l110.623"> </span>
<a href="#l110.624"></a><span id="l110.624">     // Get the password from pw manager (harddisk) or user (dialog)</span>
<a href="#l110.625"></a><span id="l110.625" class="difflineminus">-    nsCAutoString pwd; // GetPasswordWithUI truncates the password on Cancel</span>
<a href="#l110.626"></a><span id="l110.626" class="difflineplus">+    nsAutoCString pwd; // GetPasswordWithUI truncates the password on Cancel</span>
<a href="#l110.627"></a><span id="l110.627">     rv = m_imapServerSink-&gt;AsyncGetPassword(this,</span>
<a href="#l110.628"></a><span id="l110.628">                                                      newPasswordRequested,</span>
<a href="#l110.629"></a><span id="l110.629">                                                      password);</span>
<a href="#l110.630"></a><span id="l110.630">     if (password.IsEmpty())</span>
<a href="#l110.631"></a><span id="l110.631">     {</span>
<a href="#l110.632"></a><span id="l110.632">       PRIntervalTime sleepTime = kImapSleepTime;</span>
<a href="#l110.633"></a><span id="l110.633">       m_passwordStatus = NS_OK;</span>
<a href="#l110.634"></a><span id="l110.634">       ReentrantMonitorAutoEnter mon(m_passwordReadyMonitor);</span>
<a href="#l110.635"></a><span id="l110.635" class="difflineat">@@ -8179,18 +8179,18 @@ nsImapProtocol::OnPromptCanceled()</span>
<a href="#l110.636"></a><span id="l110.636"> }</span>
<a href="#l110.637"></a><span id="l110.637"> </span>
<a href="#l110.638"></a><span id="l110.638"> bool nsImapProtocol::TryToLogon()</span>
<a href="#l110.639"></a><span id="l110.639"> {</span>
<a href="#l110.640"></a><span id="l110.640">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;try to log in&quot;));</span>
<a href="#l110.641"></a><span id="l110.641">   NS_ENSURE_TRUE(m_imapServerSink, false);</span>
<a href="#l110.642"></a><span id="l110.642">   bool loginSucceeded = false;</span>
<a href="#l110.643"></a><span id="l110.643">   bool skipLoop = false;</span>
<a href="#l110.644"></a><span id="l110.644" class="difflineminus">-  nsCAutoString password;</span>
<a href="#l110.645"></a><span id="l110.645" class="difflineminus">-  nsCAutoString userName;</span>
<a href="#l110.646"></a><span id="l110.646" class="difflineplus">+  nsAutoCString password;</span>
<a href="#l110.647"></a><span id="l110.647" class="difflineplus">+  nsAutoCString userName;</span>
<a href="#l110.648"></a><span id="l110.648"> </span>
<a href="#l110.649"></a><span id="l110.649">   nsresult rv = ChooseAuthMethod();</span>
<a href="#l110.650"></a><span id="l110.650">   if (NS_FAILED(rv)) // all methods failed</span>
<a href="#l110.651"></a><span id="l110.651">   {</span>
<a href="#l110.652"></a><span id="l110.652">     // are there any matching login schemes at all?</span>
<a href="#l110.653"></a><span id="l110.653">     if (!(GetServerStateParser().GetCapabilityFlag() &amp; m_prefAuthMethods))</span>
<a href="#l110.654"></a><span id="l110.654">     {</span>
<a href="#l110.655"></a><span id="l110.655">       // Pref doesn't match server. Now, find an appropriate error msg.</span>
<a href="#l110.656"></a><span id="l110.656" class="difflineat">@@ -8418,17 +8418,17 @@ void nsImapProtocol::GetQuotaDataIfSuppo</span>
<a href="#l110.657"></a><span id="l110.657">   if (NS_FAILED(rv))</span>
<a href="#l110.658"></a><span id="l110.658">     return;</span>
<a href="#l110.659"></a><span id="l110.659"> </span>
<a href="#l110.660"></a><span id="l110.660">   nsCString escapedName;</span>
<a href="#l110.661"></a><span id="l110.661">   CreateEscapedMailboxName(aBoxName, escapedName);</span>
<a href="#l110.662"></a><span id="l110.662"> </span>
<a href="#l110.663"></a><span id="l110.663">   IncrementCommandTagNumber();</span>
<a href="#l110.664"></a><span id="l110.664"> </span>
<a href="#l110.665"></a><span id="l110.665" class="difflineminus">-  nsCAutoString quotacommand(GetServerCommandTag());</span>
<a href="#l110.666"></a><span id="l110.666" class="difflineplus">+  nsAutoCString quotacommand(GetServerCommandTag());</span>
<a href="#l110.667"></a><span id="l110.667">   quotacommand.Append(NS_LITERAL_CSTRING(&quot; getquotaroot \&quot;&quot;));</span>
<a href="#l110.668"></a><span id="l110.668">   quotacommand.Append(escapedName);</span>
<a href="#l110.669"></a><span id="l110.669">   quotacommand.Append(NS_LITERAL_CSTRING(&quot;\&quot;&quot; CRLF));</span>
<a href="#l110.670"></a><span id="l110.670"> </span>
<a href="#l110.671"></a><span id="l110.671">   NS_ASSERTION(m_imapMailFolderSink, &quot;m_imapMailFolderSink is null!&quot;);</span>
<a href="#l110.672"></a><span id="l110.672">   if (m_imapMailFolderSink)</span>
<a href="#l110.673"></a><span id="l110.673">     m_imapMailFolderSink-&gt;SetFolderQuotaCommandIssued(true);</span>
<a href="#l110.674"></a><span id="l110.674"> </span>
<a href="#l110.675"></a><span id="l110.675" class="difflineat">@@ -8822,17 +8822,17 @@ nsImapMockChannel::OnCacheEntryAvailable</span>
<a href="#l110.676"></a><span id="l110.676">   {</span>
<a href="#l110.677"></a><span id="l110.677">     entry-&gt;Doom();</span>
<a href="#l110.678"></a><span id="l110.678">     return NS_OK;</span>
<a href="#l110.679"></a><span id="l110.679">   }</span>
<a href="#l110.680"></a><span id="l110.680"> </span>
<a href="#l110.681"></a><span id="l110.681">   NS_ENSURE_ARG(m_url); // kick out if m_url is null for some reason.</span>
<a href="#l110.682"></a><span id="l110.682"> </span>
<a href="#l110.683"></a><span id="l110.683"> #ifdef DEBUG_bienvenu</span>
<a href="#l110.684"></a><span id="l110.684" class="difflineminus">-      nsCAutoString entryKey(&quot;null&quot;);</span>
<a href="#l110.685"></a><span id="l110.685" class="difflineplus">+      nsAutoCString entryKey(&quot;null&quot;);</span>
<a href="#l110.686"></a><span id="l110.686">       if (entry)</span>
<a href="#l110.687"></a><span id="l110.687">         entry-&gt;GetKey(entryKey);</span>
<a href="#l110.688"></a><span id="l110.688">       printf(&quot;*** OnCacheEntryAvailable %s with access %d status %u\n&quot;, entryKey.get(), access, status);</span>
<a href="#l110.689"></a><span id="l110.689"> #endif</span>
<a href="#l110.690"></a><span id="l110.690">   if (NS_SUCCEEDED(status))</span>
<a href="#l110.691"></a><span id="l110.691">   {</span>
<a href="#l110.692"></a><span id="l110.692">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_url, &amp;rv);</span>
<a href="#l110.693"></a><span id="l110.693">     mailnewsUrl-&gt;SetMemCacheEntry(entry);</span>
<a href="#l110.694"></a><span id="l110.694" class="difflineat">@@ -8908,34 +8908,34 @@ nsresult nsImapMockChannel::OpenCacheEnt</span>
<a href="#l110.695"></a><span id="l110.695">   // away and not use it, and turn around and ask for a cache entry for the whole</span>
<a href="#l110.696"></a><span id="l110.696">   // message, if that's available. But it seems like we shouldn't write into that</span>
<a href="#l110.697"></a><span id="l110.697">   // cache entry if we just fetch that part - though we're doing that now. Maybe</span>
<a href="#l110.698"></a><span id="l110.698">   // we never try to download just a single part from imap because our mime parser</span>
<a href="#l110.699"></a><span id="l110.699">   // can't handle that, though I would think saving a single part as a file wouldn't</span>
<a href="#l110.700"></a><span id="l110.700">   // need to go through mime...</span>
<a href="#l110.701"></a><span id="l110.701"> </span>
<a href="#l110.702"></a><span id="l110.702">   // Open a cache entry with key = url</span>
<a href="#l110.703"></a><span id="l110.703" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l110.704"></a><span id="l110.704" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l110.705"></a><span id="l110.705">   m_url-&gt;GetAsciiSpec(urlSpec);</span>
<a href="#l110.706"></a><span id="l110.706"> </span>
<a href="#l110.707"></a><span id="l110.707">   // for now, truncate of the query part so we don't duplicate urls in the cache...</span>
<a href="#l110.708"></a><span id="l110.708">   int32_t anchorIndex = urlSpec.RFindChar('?');</span>
<a href="#l110.709"></a><span id="l110.709">   if (anchorIndex &gt; 0)</span>
<a href="#l110.710"></a><span id="l110.710">   {</span>
<a href="#l110.711"></a><span id="l110.711">     // if we were trying to read a part, we failed - fall back and look for whole msg</span>
<a href="#l110.712"></a><span id="l110.712">     if (mTryingToReadPart)</span>
<a href="#l110.713"></a><span id="l110.713">     {</span>
<a href="#l110.714"></a><span id="l110.714">       mTryingToReadPart = false;</span>
<a href="#l110.715"></a><span id="l110.715">       urlSpec.SetLength(anchorIndex);</span>
<a href="#l110.716"></a><span id="l110.716">     }</span>
<a href="#l110.717"></a><span id="l110.717">     else</span>
<a href="#l110.718"></a><span id="l110.718">     {</span>
<a href="#l110.719"></a><span id="l110.719">       // check if this is a filter plugin requesting the message. In that case,we're not</span>
<a href="#l110.720"></a><span id="l110.720">       // fetching a part, and we want the cache key to be just the uri.</span>
<a href="#l110.721"></a><span id="l110.721" class="difflineminus">-      nsCAutoString anchor(Substring(urlSpec, anchorIndex));</span>
<a href="#l110.722"></a><span id="l110.722" class="difflineplus">+      nsAutoCString anchor(Substring(urlSpec, anchorIndex));</span>
<a href="#l110.723"></a><span id="l110.723"> </span>
<a href="#l110.724"></a><span id="l110.724">       if (!anchor.EqualsLiteral(&quot;?header=filter&quot;)</span>
<a href="#l110.725"></a><span id="l110.725">         &amp;&amp; !anchor.EqualsLiteral(&quot;?header=attach&quot;) &amp;&amp; !anchor.EqualsLiteral(&quot;?header=src&quot;))</span>
<a href="#l110.726"></a><span id="l110.726">         mTryingToReadPart = true;</span>
<a href="#l110.727"></a><span id="l110.727">       else</span>
<a href="#l110.728"></a><span id="l110.728">         urlSpec.SetLength(anchorIndex);</span>
<a href="#l110.729"></a><span id="l110.729">     }</span>
<a href="#l110.730"></a><span id="l110.730">   }</span>
<a href="#l110.731"></a><span id="l110.731" class="difflineat">@@ -8954,29 +8954,29 @@ nsresult nsImapMockChannel::OpenCacheEnt</span>
<a href="#l110.732"></a><span id="l110.732">     imapUrl-&gt;GetStoreResultsOffline(&amp;storeResultsOffline);</span>
<a href="#l110.733"></a><span id="l110.733">     // If we're storing the message in the offline store, don't</span>
<a href="#l110.734"></a><span id="l110.734">     // write to the disk cache.</span>
<a href="#l110.735"></a><span id="l110.735">     if (storeResultsOffline)</span>
<a href="#l110.736"></a><span id="l110.736">       cacheAccess = nsICache::ACCESS_READ;</span>
<a href="#l110.737"></a><span id="l110.737">   }</span>
<a href="#l110.738"></a><span id="l110.738">   // stick the uid validity in front of the url, so that if the uid validity</span>
<a href="#l110.739"></a><span id="l110.739">   // changes, we won't re-use the wrong cache entries.</span>
<a href="#l110.740"></a><span id="l110.740" class="difflineminus">-  nsCAutoString cacheKey;</span>
<a href="#l110.741"></a><span id="l110.741" class="difflineplus">+  nsAutoCString cacheKey;</span>
<a href="#l110.742"></a><span id="l110.742">   cacheKey.AppendInt(uidValidity, 16);</span>
<a href="#l110.743"></a><span id="l110.743">   cacheKey.Append(urlSpec);</span>
<a href="#l110.744"></a><span id="l110.744">   return cacheSession-&gt;AsyncOpenCacheEntry(cacheKey, cacheAccess, this, false);</span>
<a href="#l110.745"></a><span id="l110.745"> }</span>
<a href="#l110.746"></a><span id="l110.746"> </span>
<a href="#l110.747"></a><span id="l110.747"> nsresult nsImapMockChannel::ReadFromMemCache(nsICacheEntryDescriptor *entry)</span>
<a href="#l110.748"></a><span id="l110.748"> {</span>
<a href="#l110.749"></a><span id="l110.749">   NS_ENSURE_ARG(entry);</span>
<a href="#l110.750"></a><span id="l110.750"> </span>
<a href="#l110.751"></a><span id="l110.751">   nsCString annotation;</span>
<a href="#l110.752"></a><span id="l110.752" class="difflineminus">-  nsCAutoString entryKey;</span>
<a href="#l110.753"></a><span id="l110.753" class="difflineminus">-  nsCAutoString contentType;</span>
<a href="#l110.754"></a><span id="l110.754" class="difflineplus">+  nsAutoCString entryKey;</span>
<a href="#l110.755"></a><span id="l110.755" class="difflineplus">+  nsAutoCString contentType;</span>
<a href="#l110.756"></a><span id="l110.756">   nsresult rv = NS_OK;</span>
<a href="#l110.757"></a><span id="l110.757">   bool shouldUseCacheEntry = false;</span>
<a href="#l110.758"></a><span id="l110.758"> </span>
<a href="#l110.759"></a><span id="l110.759">   entry-&gt;GetKey(entryKey);</span>
<a href="#l110.760"></a><span id="l110.760">   // if we have a part, then we should use the cache entry.</span>
<a href="#l110.761"></a><span id="l110.761">   if (entryKey.FindChar('?') != kNotFound)</span>
<a href="#l110.762"></a><span id="l110.762">   {</span>
<a href="#l110.763"></a><span id="l110.763">     entry-&gt;GetMetaDataElement(&quot;contentType&quot;, getter_Copies(contentType));</span>
<a href="#l110.764"></a><span id="l110.764" class="difflineat">@@ -9132,17 +9132,17 @@ bool nsImapMockChannel::ReadFromLocalCac</span>
<a href="#l110.765"></a><span id="l110.765"> </span>
<a href="#l110.766"></a><span id="l110.766">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl = do_QueryInterface(m_url);</span>
<a href="#l110.767"></a><span id="l110.767">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_url, &amp;rv);</span>
<a href="#l110.768"></a><span id="l110.768"> </span>
<a href="#l110.769"></a><span id="l110.769">   bool useLocalCache = false;</span>
<a href="#l110.770"></a><span id="l110.770">   mailnewsUrl-&gt;GetMsgIsInLocalCache(&amp;useLocalCache);</span>
<a href="#l110.771"></a><span id="l110.771">   if (useLocalCache)</span>
<a href="#l110.772"></a><span id="l110.772">   {</span>
<a href="#l110.773"></a><span id="l110.773" class="difflineminus">-    nsCAutoString messageIdString;</span>
<a href="#l110.774"></a><span id="l110.774" class="difflineplus">+    nsAutoCString messageIdString;</span>
<a href="#l110.775"></a><span id="l110.775"> </span>
<a href="#l110.776"></a><span id="l110.776">     SetupPartExtractorListener(imapUrl, m_channelListener);</span>
<a href="#l110.777"></a><span id="l110.777"> </span>
<a href="#l110.778"></a><span id="l110.778">     imapUrl-&gt;GetListOfMessageIds(messageIdString);</span>
<a href="#l110.779"></a><span id="l110.779">     nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l110.780"></a><span id="l110.780">     rv = mailnewsUrl-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l110.781"></a><span id="l110.781">     if (folder &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l110.782"></a><span id="l110.782">     {</span>
<a href="#l110.783"></a><span id="l110.783" class="difflineat">@@ -9302,17 +9302,17 @@ NS_IMETHODIMP nsImapMockChannel::GetCont</span>
<a href="#l110.784"></a><span id="l110.784">   }</span>
<a href="#l110.785"></a><span id="l110.785">   else</span>
<a href="#l110.786"></a><span id="l110.786">     aContentType = m_ContentType;</span>
<a href="#l110.787"></a><span id="l110.787">   return NS_OK;</span>
<a href="#l110.788"></a><span id="l110.788"> }</span>
<a href="#l110.789"></a><span id="l110.789"> </span>
<a href="#l110.790"></a><span id="l110.790"> NS_IMETHODIMP nsImapMockChannel::SetContentType(const nsACString &amp;aContentType)</span>
<a href="#l110.791"></a><span id="l110.791"> {</span>
<a href="#l110.792"></a><span id="l110.792" class="difflineminus">-  nsCAutoString charset;</span>
<a href="#l110.793"></a><span id="l110.793" class="difflineplus">+  nsAutoCString charset;</span>
<a href="#l110.794"></a><span id="l110.794">   return NS_ParseContentType(aContentType, m_ContentType, charset);</span>
<a href="#l110.795"></a><span id="l110.795"> }</span>
<a href="#l110.796"></a><span id="l110.796"> </span>
<a href="#l110.797"></a><span id="l110.797"> NS_IMETHODIMP nsImapMockChannel::GetContentCharset(nsACString &amp;aContentCharset)</span>
<a href="#l110.798"></a><span id="l110.798"> {</span>
<a href="#l110.799"></a><span id="l110.799">   aContentCharset.Truncate();</span>
<a href="#l110.800"></a><span id="l110.800">   return NS_OK;</span>
<a href="#l110.801"></a><span id="l110.801"> }</span>
<a href="#l110.802"></a><span id="l110.802" class="difflineat">@@ -9471,17 +9471,17 @@ nsImapMockChannel::OnTransportStatus(nsI</span>
<a href="#l110.803"></a><span id="l110.803"> </span>
<a href="#l110.804"></a><span id="l110.804">   if (!mProgressEventSink)</span>
<a href="#l110.805"></a><span id="l110.805">   {</span>
<a href="#l110.806"></a><span id="l110.806">     NS_QueryNotificationCallbacks(mCallbacks, m_loadGroup, mProgressEventSink);</span>
<a href="#l110.807"></a><span id="l110.807">     if (!mProgressEventSink)</span>
<a href="#l110.808"></a><span id="l110.808">       return NS_OK;</span>
<a href="#l110.809"></a><span id="l110.809">   }</span>
<a href="#l110.810"></a><span id="l110.810"> </span>
<a href="#l110.811"></a><span id="l110.811" class="difflineminus">-  nsCAutoString host;</span>
<a href="#l110.812"></a><span id="l110.812" class="difflineplus">+  nsAutoCString host;</span>
<a href="#l110.813"></a><span id="l110.813">   m_url-&gt;GetHost(host);</span>
<a href="#l110.814"></a><span id="l110.814"> </span>
<a href="#l110.815"></a><span id="l110.815">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_url);</span>
<a href="#l110.816"></a><span id="l110.816">   if (mailnewsUrl)</span>
<a href="#l110.817"></a><span id="l110.817">   {</span>
<a href="#l110.818"></a><span id="l110.818">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l110.819"></a><span id="l110.819">     mailnewsUrl-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l110.820"></a><span id="l110.820">     if (server)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.cpp</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -674,21 +674,21 @@ void nsImapServerResponseParser::respons</span>
<a href="#l111.4"></a><span id="l111.4">         xmailboxinfo_data();</span>
<a href="#l111.5"></a><span id="l111.5">       else if (!PL_strcasecmp(fNextToken, &quot;XAOL-OPTION&quot;))</span>
<a href="#l111.6"></a><span id="l111.6">         skip_to_CRLF();</span>
<a href="#l111.7"></a><span id="l111.7">       else if (!PL_strcasecmp(fNextToken, &quot;XLIST&quot;))</span>
<a href="#l111.8"></a><span id="l111.8">         mailbox_data();</span>
<a href="#l111.9"></a><span id="l111.9">       else </span>
<a href="#l111.10"></a><span id="l111.10">       {</span>
<a href="#l111.11"></a><span id="l111.11">         // check if custom command</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-        nsCAutoString customCommand;</span>
<a href="#l111.13"></a><span id="l111.13" class="difflineplus">+        nsAutoCString customCommand;</span>
<a href="#l111.14"></a><span id="l111.14">         fServerConnection.GetCurrentUrl()-&gt;GetCommand(customCommand);</span>
<a href="#l111.15"></a><span id="l111.15">         if (customCommand.Equals(fNextToken))</span>
<a href="#l111.16"></a><span id="l111.16">         {</span>
<a href="#l111.17"></a><span id="l111.17" class="difflineminus">-          nsCAutoString customCommandResponse;</span>
<a href="#l111.18"></a><span id="l111.18" class="difflineplus">+          nsAutoCString customCommandResponse;</span>
<a href="#l111.19"></a><span id="l111.19">           while (Connected() &amp;&amp; !fAtEndOfLine)</span>
<a href="#l111.20"></a><span id="l111.20">           {</span>
<a href="#l111.21"></a><span id="l111.21">             AdvanceToNextToken();</span>
<a href="#l111.22"></a><span id="l111.22">             customCommandResponse.Append(fNextToken);</span>
<a href="#l111.23"></a><span id="l111.23">             customCommandResponse.Append(&quot; &quot;);</span>
<a href="#l111.24"></a><span id="l111.24">           }</span>
<a href="#l111.25"></a><span id="l111.25">           fServerConnection.GetCurrentUrl()-&gt;SetCustomCommandResult(customCommandResponse);</span>
<a href="#l111.26"></a><span id="l111.26">         }</span>
<a href="#l111.27"></a><span id="l111.27" class="difflineat">@@ -1301,17 +1301,17 @@ void nsImapServerResponseParser::msg_fet</span>
<a href="#l111.28"></a><span id="l111.28">         xaolenvelope_data();</span>
<a href="#l111.29"></a><span id="l111.29">       }</span>
<a href="#l111.30"></a><span id="l111.30">       else</span>
<a href="#l111.31"></a><span id="l111.31">       {</span>
<a href="#l111.32"></a><span id="l111.32">         nsImapAction imapAction; </span>
<a href="#l111.33"></a><span id="l111.33">         if (!fServerConnection.GetCurrentUrl())</span>
<a href="#l111.34"></a><span id="l111.34">           return;</span>
<a href="#l111.35"></a><span id="l111.35">         fServerConnection.GetCurrentUrl()-&gt;GetImapAction(&amp;imapAction);</span>
<a href="#l111.36"></a><span id="l111.36" class="difflineminus">-        nsCAutoString userDefinedFetchAttribute;</span>
<a href="#l111.37"></a><span id="l111.37" class="difflineplus">+        nsAutoCString userDefinedFetchAttribute;</span>
<a href="#l111.38"></a><span id="l111.38">         fServerConnection.GetCurrentUrl()-&gt;GetCustomAttributeToFetch(userDefinedFetchAttribute);</span>
<a href="#l111.39"></a><span id="l111.39">         if ((imapAction == nsIImapUrl::nsImapUserDefinedFetchAttribute &amp;&amp; !strcmp(userDefinedFetchAttribute.get(), fNextToken)) ||</span>
<a href="#l111.40"></a><span id="l111.40">             imapAction == nsIImapUrl::nsImapUserDefinedMsgCommand)</span>
<a href="#l111.41"></a><span id="l111.41">         {</span>
<a href="#l111.42"></a><span id="l111.42">           AdvanceToNextToken();</span>
<a href="#l111.43"></a><span id="l111.43">           char *fetchResult;</span>
<a href="#l111.44"></a><span id="l111.44">           if (fNextToken[0] == '(') </span>
<a href="#l111.45"></a><span id="l111.45">             // look through the tokens until we find the closing ')'</span>
<a href="#l111.46"></a><span id="l111.46" class="difflineat">@@ -1414,31 +1414,31 @@ void nsImapServerResponseParser::envelop</span>
<a href="#l111.47"></a><span id="l111.47">       break;</span>
<a href="#l111.48"></a><span id="l111.48">     else if (*fNextToken == ')')</span>
<a href="#l111.49"></a><span id="l111.49">     {</span>
<a href="#l111.50"></a><span id="l111.50">       SetSyntaxError(true); // envelope too short</span>
<a href="#l111.51"></a><span id="l111.51">       break;</span>
<a href="#l111.52"></a><span id="l111.52">     }</span>
<a href="#l111.53"></a><span id="l111.53">     else</span>
<a href="#l111.54"></a><span id="l111.54">     {</span>
<a href="#l111.55"></a><span id="l111.55" class="difflineminus">-      nsCAutoString headerLine(EnvelopeTable[tableIndex].name);</span>
<a href="#l111.56"></a><span id="l111.56" class="difflineplus">+      nsAutoCString headerLine(EnvelopeTable[tableIndex].name);</span>
<a href="#l111.57"></a><span id="l111.57">       headerLine += &quot;: &quot;;</span>
<a href="#l111.58"></a><span id="l111.58">       bool headerNonNil = true;</span>
<a href="#l111.59"></a><span id="l111.59">       if (EnvelopeTable[tableIndex].type == envelopeString)</span>
<a href="#l111.60"></a><span id="l111.60">       {</span>
<a href="#l111.61"></a><span id="l111.61" class="difflineminus">-        nsCAutoString strValue;</span>
<a href="#l111.62"></a><span id="l111.62" class="difflineplus">+        nsAutoCString strValue;</span>
<a href="#l111.63"></a><span id="l111.63">         strValue.Adopt(CreateNilString());</span>
<a href="#l111.64"></a><span id="l111.64">         if (!strValue.IsEmpty())</span>
<a href="#l111.65"></a><span id="l111.65">           headerLine.Append(strValue);</span>
<a href="#l111.66"></a><span id="l111.66">         else</span>
<a href="#l111.67"></a><span id="l111.67">           headerNonNil = false;</span>
<a href="#l111.68"></a><span id="l111.68">       }</span>
<a href="#l111.69"></a><span id="l111.69">       else</span>
<a href="#l111.70"></a><span id="l111.70">       {</span>
<a href="#l111.71"></a><span id="l111.71" class="difflineminus">-        nsCAutoString address;</span>
<a href="#l111.72"></a><span id="l111.72" class="difflineplus">+        nsAutoCString address;</span>
<a href="#l111.73"></a><span id="l111.73">         parse_address(address);</span>
<a href="#l111.74"></a><span id="l111.74">         headerLine += address;</span>
<a href="#l111.75"></a><span id="l111.75">         if (address.IsEmpty())</span>
<a href="#l111.76"></a><span id="l111.76">           headerNonNil = false;</span>
<a href="#l111.77"></a><span id="l111.77">       }</span>
<a href="#l111.78"></a><span id="l111.78">       if (headerNonNil)</span>
<a href="#l111.79"></a><span id="l111.79">         fServerConnection.HandleMessageDownLoadLine(headerLine.get(), false);</span>
<a href="#l111.80"></a><span id="l111.80">     }</span>
<a href="#l111.81"></a><span id="l111.81" class="difflineat">@@ -1454,74 +1454,74 @@ void nsImapServerResponseParser::xaolenv</span>
<a href="#l111.82"></a><span id="l111.82"> {</span>
<a href="#l111.83"></a><span id="l111.83">   // eat the opening '('</span>
<a href="#l111.84"></a><span id="l111.84">   fNextToken++;</span>
<a href="#l111.85"></a><span id="l111.85">   </span>
<a href="#l111.86"></a><span id="l111.86">   if (ContinueParse() &amp;&amp; (*fNextToken != ')'))</span>
<a href="#l111.87"></a><span id="l111.87">   {</span>
<a href="#l111.88"></a><span id="l111.88">     AdvanceToNextToken();</span>
<a href="#l111.89"></a><span id="l111.89">     fNextToken++; // eat '('</span>
<a href="#l111.90"></a><span id="l111.90" class="difflineminus">-    nsCAutoString subject;</span>
<a href="#l111.91"></a><span id="l111.91" class="difflineplus">+    nsAutoCString subject;</span>
<a href="#l111.92"></a><span id="l111.92">     subject.Adopt(CreateNilString());</span>
<a href="#l111.93"></a><span id="l111.93" class="difflineminus">-    nsCAutoString subjectLine(&quot;Subject: &quot;);</span>
<a href="#l111.94"></a><span id="l111.94" class="difflineplus">+    nsAutoCString subjectLine(&quot;Subject: &quot;);</span>
<a href="#l111.95"></a><span id="l111.95">     subjectLine += subject;</span>
<a href="#l111.96"></a><span id="l111.96">     fServerConnection.HandleMessageDownLoadLine(subjectLine.get(), false);</span>
<a href="#l111.97"></a><span id="l111.97">     fNextToken++; // eat the next '('</span>
<a href="#l111.98"></a><span id="l111.98">     if (ContinueParse())</span>
<a href="#l111.99"></a><span id="l111.99">     {</span>
<a href="#l111.100"></a><span id="l111.100">       AdvanceToNextToken();</span>
<a href="#l111.101"></a><span id="l111.101">       if (ContinueParse())</span>
<a href="#l111.102"></a><span id="l111.102">       {</span>
<a href="#l111.103"></a><span id="l111.103" class="difflineminus">-        nsCAutoString fromLine;</span>
<a href="#l111.104"></a><span id="l111.104" class="difflineplus">+        nsAutoCString fromLine;</span>
<a href="#l111.105"></a><span id="l111.105">         if (!strcmp(GetSelectedMailboxName(), &quot;Sent Items&quot;))</span>
<a href="#l111.106"></a><span id="l111.106">         {</span>
<a href="#l111.107"></a><span id="l111.107">           // xaol envelope switches the From with the To, so we switch them back and</span>
<a href="#l111.108"></a><span id="l111.108">           // create a fake from line From: user@aol.com</span>
<a href="#l111.109"></a><span id="l111.109">           fromLine.Append(&quot;To: &quot;);</span>
<a href="#l111.110"></a><span id="l111.110" class="difflineminus">-          nsCAutoString fakeFromLine(NS_LITERAL_CSTRING(&quot;From: &quot;));</span>
<a href="#l111.111"></a><span id="l111.111" class="difflineplus">+          nsAutoCString fakeFromLine(NS_LITERAL_CSTRING(&quot;From: &quot;));</span>
<a href="#l111.112"></a><span id="l111.112">           fakeFromLine.Append(fServerConnection.GetImapUserName());</span>
<a href="#l111.113"></a><span id="l111.113">           fakeFromLine.Append(NS_LITERAL_CSTRING(&quot;@aol.com&quot;));</span>
<a href="#l111.114"></a><span id="l111.114">           fServerConnection.HandleMessageDownLoadLine(fakeFromLine.get(), false);</span>
<a href="#l111.115"></a><span id="l111.115">         }</span>
<a href="#l111.116"></a><span id="l111.116">         else</span>
<a href="#l111.117"></a><span id="l111.117">         {</span>
<a href="#l111.118"></a><span id="l111.118">           fromLine.Append(&quot;From: &quot;);</span>
<a href="#l111.119"></a><span id="l111.119">         }</span>
<a href="#l111.120"></a><span id="l111.120">         parse_address(fromLine);</span>
<a href="#l111.121"></a><span id="l111.121">         fServerConnection.HandleMessageDownLoadLine(fromLine.get(), false);</span>
<a href="#l111.122"></a><span id="l111.122">         if (ContinueParse())</span>
<a href="#l111.123"></a><span id="l111.123">         {</span>
<a href="#l111.124"></a><span id="l111.124">           AdvanceToNextToken();	// ge attachment size</span>
<a href="#l111.125"></a><span id="l111.125">           int32_t attachmentSize = atoi(fNextToken);</span>
<a href="#l111.126"></a><span id="l111.126">           if (attachmentSize != 0)</span>
<a href="#l111.127"></a><span id="l111.127">           {</span>
<a href="#l111.128"></a><span id="l111.128" class="difflineminus">-            nsCAutoString attachmentLine(&quot;X-attachment-size: &quot;);</span>
<a href="#l111.129"></a><span id="l111.129" class="difflineplus">+            nsAutoCString attachmentLine(&quot;X-attachment-size: &quot;);</span>
<a href="#l111.130"></a><span id="l111.130">             attachmentLine.AppendInt(attachmentSize);</span>
<a href="#l111.131"></a><span id="l111.131">             fServerConnection.HandleMessageDownLoadLine(attachmentLine.get(), false);</span>
<a href="#l111.132"></a><span id="l111.132">           }</span>
<a href="#l111.133"></a><span id="l111.133">         }</span>
<a href="#l111.134"></a><span id="l111.134">         if (ContinueParse())</span>
<a href="#l111.135"></a><span id="l111.135">         {</span>
<a href="#l111.136"></a><span id="l111.136">           AdvanceToNextToken();	// skip image size</span>
<a href="#l111.137"></a><span id="l111.137">           int32_t imageSize = atoi(fNextToken);</span>
<a href="#l111.138"></a><span id="l111.138">           if (imageSize != 0)</span>
<a href="#l111.139"></a><span id="l111.139">           {</span>
<a href="#l111.140"></a><span id="l111.140" class="difflineminus">-            nsCAutoString imageLine(&quot;X-image-size: &quot;);</span>
<a href="#l111.141"></a><span id="l111.141" class="difflineplus">+            nsAutoCString imageLine(&quot;X-image-size: &quot;);</span>
<a href="#l111.142"></a><span id="l111.142">             imageLine.AppendInt(imageSize);</span>
<a href="#l111.143"></a><span id="l111.143">             fServerConnection.HandleMessageDownLoadLine(imageLine.get(), false);</span>
<a href="#l111.144"></a><span id="l111.144">           }</span>
<a href="#l111.145"></a><span id="l111.145">         }</span>
<a href="#l111.146"></a><span id="l111.146">         if (ContinueParse())</span>
<a href="#l111.147"></a><span id="l111.147">           AdvanceToNextToken();	// skip )</span>
<a href="#l111.148"></a><span id="l111.148">       }</span>
<a href="#l111.149"></a><span id="l111.149">     }</span>
<a href="#l111.150"></a><span id="l111.150">   }</span>
<a href="#l111.151"></a><span id="l111.151"> }</span>
<a href="#l111.152"></a><span id="l111.152"> </span>
<a href="#l111.153"></a><span id="l111.153" class="difflineminus">-void nsImapServerResponseParser::parse_address(nsCAutoString &amp;addressLine)</span>
<a href="#l111.154"></a><span id="l111.154" class="difflineplus">+void nsImapServerResponseParser::parse_address(nsAutoCString &amp;addressLine)</span>
<a href="#l111.155"></a><span id="l111.155"> {</span>
<a href="#l111.156"></a><span id="l111.156">   if (!strcmp(fNextToken, &quot;NIL&quot;))</span>
<a href="#l111.157"></a><span id="l111.157">     return;</span>
<a href="#l111.158"></a><span id="l111.158">   bool firstAddress = true;</span>
<a href="#l111.159"></a><span id="l111.159">   // should really look at chars here</span>
<a href="#l111.160"></a><span id="l111.160">   NS_ASSERTION(*fNextToken == '(', &quot;address should start with '('&quot;);</span>
<a href="#l111.161"></a><span id="l111.161">   fNextToken++; // eat the next '('</span>
<a href="#l111.162"></a><span id="l111.162">   while (ContinueParse() &amp;&amp; *fNextToken == '(')</span>
<a href="#l111.163"></a><span id="l111.163" class="difflineat">@@ -1577,17 +1577,17 @@ void nsImapServerResponseParser::parse_a</span>
<a href="#l111.164"></a><span id="l111.164">   //	AdvanceToNextToken();	// skip &quot;))&quot;</span>
<a href="#l111.165"></a><span id="l111.165"> }</span>
<a href="#l111.166"></a><span id="l111.166"> </span>
<a href="#l111.167"></a><span id="l111.167"> void nsImapServerResponseParser::internal_date()</span>
<a href="#l111.168"></a><span id="l111.168"> {</span>
<a href="#l111.169"></a><span id="l111.169">   AdvanceToNextToken();</span>
<a href="#l111.170"></a><span id="l111.170">   if (ContinueParse())</span>
<a href="#l111.171"></a><span id="l111.171">   {</span>
<a href="#l111.172"></a><span id="l111.172" class="difflineminus">-    nsCAutoString dateLine(&quot;Date: &quot;);</span>
<a href="#l111.173"></a><span id="l111.173" class="difflineplus">+    nsAutoCString dateLine(&quot;Date: &quot;);</span>
<a href="#l111.174"></a><span id="l111.174">     char *strValue = CreateNilString();</span>
<a href="#l111.175"></a><span id="l111.175">     if (strValue)</span>
<a href="#l111.176"></a><span id="l111.176">     {</span>
<a href="#l111.177"></a><span id="l111.177">       dateLine += strValue;</span>
<a href="#l111.178"></a><span id="l111.178">       NS_Free(strValue);</span>
<a href="#l111.179"></a><span id="l111.179">     }</span>
<a href="#l111.180"></a><span id="l111.180">     fServerConnection.HandleMessageDownLoadLine(dateLine.get(), false);</span>
<a href="#l111.181"></a><span id="l111.181">   }</span>
<a href="#l111.182"></a><span id="l111.182" class="difflineat">@@ -1680,17 +1680,17 @@ void nsImapServerResponseParser::flags()</span>
<a href="#l111.183"></a><span id="l111.183">         }</span>
<a href="#l111.184"></a><span id="l111.184">         break;</span>
<a href="#l111.185"></a><span id="l111.185">       default:</span>
<a href="#l111.186"></a><span id="l111.186">         break;</span>
<a href="#l111.187"></a><span id="l111.187">       }</span>
<a href="#l111.188"></a><span id="l111.188">     }</span>
<a href="#l111.189"></a><span id="l111.189">     if (!knownFlag &amp;&amp; fFlagState)</span>
<a href="#l111.190"></a><span id="l111.190">     {</span>
<a href="#l111.191"></a><span id="l111.191" class="difflineminus">-      nsCAutoString flag(fNextToken);</span>
<a href="#l111.192"></a><span id="l111.192" class="difflineplus">+      nsAutoCString flag(fNextToken);</span>
<a href="#l111.193"></a><span id="l111.193">       int32_t parenIndex = flag.FindChar(')');</span>
<a href="#l111.194"></a><span id="l111.194">       if (parenIndex &gt; 0)</span>
<a href="#l111.195"></a><span id="l111.195">         flag.SetLength(parenIndex);</span>
<a href="#l111.196"></a><span id="l111.196">       messageFlags |= kImapMsgCustomKeywordFlag;</span>
<a href="#l111.197"></a><span id="l111.197">       if (CurrentResponseUID() != nsMsgKey_None &amp;&amp; CurrentResponseUID() != 0)</span>
<a href="#l111.198"></a><span id="l111.198">         fFlagState-&gt;AddUidCustomFlagPair(CurrentResponseUID(), flag.get());</span>
<a href="#l111.199"></a><span id="l111.199">       else</span>
<a href="#l111.200"></a><span id="l111.200">         fCustomFlags.AppendElement(flag);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/mailnews/imap/src/nsImapServerResponseParser.h</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapServerResponseParser.h</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -124,17 +124,17 @@ public:</span>
<a href="#l112.4"></a><span id="l112.4">   bool            fCondStoreEnabled;  </span>
<a href="#l112.5"></a><span id="l112.5">   bool            fUseModSeq;  // can use mod seq for currently selected folder</span>
<a href="#l112.6"></a><span id="l112.6">   uint64_t        fHighestModSeq;</span>
<a href="#l112.7"></a><span id="l112.7"> </span>
<a href="#l112.8"></a><span id="l112.8"> protected:</span>
<a href="#l112.9"></a><span id="l112.9">   virtual void    flags();</span>
<a href="#l112.10"></a><span id="l112.10">   virtual void    envelope_data();</span>
<a href="#l112.11"></a><span id="l112.11">   virtual void    xaolenvelope_data();</span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-  virtual void    parse_address(nsCAutoString &amp;addressLine);</span>
<a href="#l112.13"></a><span id="l112.13" class="difflineplus">+  virtual void    parse_address(nsAutoCString &amp;addressLine);</span>
<a href="#l112.14"></a><span id="l112.14">   virtual void    internal_date();</span>
<a href="#l112.15"></a><span id="l112.15">   virtual nsresult BeginMessageDownload(const char *content_type);</span>
<a href="#l112.16"></a><span id="l112.16"> </span>
<a href="#l112.17"></a><span id="l112.17">   virtual void    response_data();</span>
<a href="#l112.18"></a><span id="l112.18">   virtual void    resp_text();</span>
<a href="#l112.19"></a><span id="l112.19">   virtual void    resp_cond_state(bool isTagged);</span>
<a href="#l112.20"></a><span id="l112.20">   virtual void    text_mime2();</span>
<a href="#l112.21"></a><span id="l112.21">   virtual void    text();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -187,17 +187,17 @@ NS_IMETHODIMP nsImapService::SelectFolde</span>
<a href="#l113.4"></a><span id="l113.4">   if (imapFolder)</span>
<a href="#l113.5"></a><span id="l113.5">     imapFolder-&gt;GetCanOpenFolder(&amp;canOpenThisFolder);</span>
<a href="#l113.6"></a><span id="l113.6"> </span>
<a href="#l113.7"></a><span id="l113.7">   if (!canOpenThisFolder) </span>
<a href="#l113.8"></a><span id="l113.8">     return NS_OK;</span>
<a href="#l113.9"></a><span id="l113.9"> </span>
<a href="#l113.10"></a><span id="l113.10">   nsresult rv;</span>
<a href="#l113.11"></a><span id="l113.11">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.14"></a><span id="l113.14">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.15"></a><span id="l113.15">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl),</span>
<a href="#l113.16"></a><span id="l113.16">                             aImapMailFolder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.17"></a><span id="l113.17"> </span>
<a href="#l113.18"></a><span id="l113.18">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.19"></a><span id="l113.19">   {</span>
<a href="#l113.20"></a><span id="l113.20">     // nsImapUrl::SetSpec() will set the imap action properly</span>
<a href="#l113.21"></a><span id="l113.21">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapSelectFolder);</span>
<a href="#l113.22"></a><span id="l113.22" class="difflineat">@@ -207,17 +207,17 @@ NS_IMETHODIMP nsImapService::SelectFolde</span>
<a href="#l113.23"></a><span id="l113.23">     if (!aMsgWindow)</span>
<a href="#l113.24"></a><span id="l113.24">       mailNewsUrl-&gt;SetSuppressErrorMsgs(true);</span>
<a href="#l113.25"></a><span id="l113.25">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l113.26"></a><span id="l113.26">     mailNewsUrl-&gt;SetUpdatingFolder(true);</span>
<a href="#l113.27"></a><span id="l113.27">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l113.28"></a><span id="l113.28"> </span>
<a href="#l113.29"></a><span id="l113.29">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.30"></a><span id="l113.30">     {</span>
<a href="#l113.31"></a><span id="l113.31" class="difflineminus">-      nsCAutoString folderName;</span>
<a href="#l113.32"></a><span id="l113.32" class="difflineplus">+      nsAutoCString folderName;</span>
<a href="#l113.33"></a><span id="l113.33">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l113.34"></a><span id="l113.34">       urlSpec.Append(&quot;/select&gt;&quot;);</span>
<a href="#l113.35"></a><span id="l113.35">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.36"></a><span id="l113.36">       urlSpec.Append(folderName);</span>
<a href="#l113.37"></a><span id="l113.37">       rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l113.38"></a><span id="l113.38">       if (NS_SUCCEEDED(rv))</span>
<a href="#l113.39"></a><span id="l113.39">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l113.40"></a><span id="l113.40">     }</span>
<a href="#l113.41"></a><span id="l113.41" class="difflineat">@@ -237,44 +237,44 @@ NS_IMETHODIMP nsImapService::LiteSelectF</span>
<a href="#l113.42"></a><span id="l113.42">   return FolderCommand(aImapMailFolder, aUrlListener,</span>
<a href="#l113.43"></a><span id="l113.43">                        &quot;/liteselect&gt;&quot;, nsIImapUrl::nsImapLiteSelectFolder, aMsgWindow, aURL);</span>
<a href="#l113.44"></a><span id="l113.44"> }</span>
<a href="#l113.45"></a><span id="l113.45"> </span>
<a href="#l113.46"></a><span id="l113.46"> NS_IMETHODIMP nsImapService::GetUrlForUri(const char *aMessageURI, </span>
<a href="#l113.47"></a><span id="l113.47">                                           nsIURI **aURL, </span>
<a href="#l113.48"></a><span id="l113.48">                                           nsIMsgWindow *aMsgWindow) </span>
<a href="#l113.49"></a><span id="l113.49"> {</span>
<a href="#l113.50"></a><span id="l113.50" class="difflineminus">-  nsCAutoString messageURI(aMessageURI);</span>
<a href="#l113.51"></a><span id="l113.51" class="difflineplus">+  nsAutoCString messageURI(aMessageURI);</span>
<a href="#l113.52"></a><span id="l113.52"> </span>
<a href="#l113.53"></a><span id="l113.53">   if (messageURI.Find(NS_LITERAL_CSTRING(&quot;&amp;type=application/x-message-display&quot;)) != kNotFound)</span>
<a href="#l113.54"></a><span id="l113.54">     return NS_NewURI(aURL, aMessageURI);</span>
<a href="#l113.55"></a><span id="l113.55"> </span>
<a href="#l113.56"></a><span id="l113.56">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.57"></a><span id="l113.57" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.58"></a><span id="l113.58" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.59"></a><span id="l113.59">   nsresult rv = DecomposeImapURI(messageURI, getter_AddRefs(folder), msgKey);</span>
<a href="#l113.60"></a><span id="l113.60">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.61"></a><span id="l113.61">   {</span>
<a href="#l113.62"></a><span id="l113.62">     nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.63"></a><span id="l113.63" class="difflineminus">-    nsCAutoString urlSpec;</span>
<a href="#l113.64"></a><span id="l113.64" class="difflineplus">+    nsAutoCString urlSpec;</span>
<a href="#l113.65"></a><span id="l113.65">     char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.66"></a><span id="l113.66">     rv = CreateStartOfImapUrl(messageURI, getter_AddRefs(imapUrl), folder, nullptr, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.67"></a><span id="l113.67">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.68"></a><span id="l113.68">     rv = SetImapUrlSink(folder, imapUrl);</span>
<a href="#l113.69"></a><span id="l113.69">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.70"></a><span id="l113.70">     nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l113.71"></a><span id="l113.71">     bool useLocalCache = false;</span>
<a href="#l113.72"></a><span id="l113.72">     folder-&gt;HasMsgOffline(atoi(msgKey.get()), &amp;useLocalCache);</span>
<a href="#l113.73"></a><span id="l113.73">     mailnewsUrl-&gt;SetMsgIsInLocalCache(useLocalCache);</span>
<a href="#l113.74"></a><span id="l113.74"> </span>
<a href="#l113.75"></a><span id="l113.75">     nsCOMPtr&lt;nsIURI&gt; url = do_QueryInterface(imapUrl);</span>
<a href="#l113.76"></a><span id="l113.76">     url-&gt;GetSpec(urlSpec);</span>
<a href="#l113.77"></a><span id="l113.77">     urlSpec.Append(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l113.78"></a><span id="l113.78">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.79"></a><span id="l113.79"> </span>
<a href="#l113.80"></a><span id="l113.80" class="difflineminus">-    nsCAutoString folderName;</span>
<a href="#l113.81"></a><span id="l113.81" class="difflineplus">+    nsAutoCString folderName;</span>
<a href="#l113.82"></a><span id="l113.82">     GetFolderName(folder, folderName);</span>
<a href="#l113.83"></a><span id="l113.83">     urlSpec.Append(folderName);</span>
<a href="#l113.84"></a><span id="l113.84">     urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l113.85"></a><span id="l113.85">     urlSpec.Append(msgKey);</span>
<a href="#l113.86"></a><span id="l113.86">     rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l113.87"></a><span id="l113.87">     imapUrl-&gt;QueryInterface(NS_GET_IID(nsIURI), (void **) aURL);</span>
<a href="#l113.88"></a><span id="l113.88">   }</span>
<a href="#l113.89"></a><span id="l113.89"> </span>
<a href="#l113.90"></a><span id="l113.90" class="difflineat">@@ -288,18 +288,18 @@ NS_IMETHODIMP nsImapService::OpenAttachm</span>
<a href="#l113.91"></a><span id="l113.91">                                             nsISupports *aDisplayConsumer, </span>
<a href="#l113.92"></a><span id="l113.92">                                             nsIMsgWindow *aMsgWindow, </span>
<a href="#l113.93"></a><span id="l113.93">                                             nsIUrlListener *aUrlListener)</span>
<a href="#l113.94"></a><span id="l113.94"> {</span>
<a href="#l113.95"></a><span id="l113.95">   // okay this is a little tricky....we may have to fetch the mime part</span>
<a href="#l113.96"></a><span id="l113.96">   // or it may already be downloaded for us....the only way i can tell to </span>
<a href="#l113.97"></a><span id="l113.97">   // distinguish the two events is to search for ?section or ?part</span>
<a href="#l113.98"></a><span id="l113.98">   </span>
<a href="#l113.99"></a><span id="l113.99" class="difflineminus">-  nsCAutoString uri(aMessageUri);</span>
<a href="#l113.100"></a><span id="l113.100" class="difflineminus">-  nsCAutoString urlString(aUrl);</span>
<a href="#l113.101"></a><span id="l113.101" class="difflineplus">+  nsAutoCString uri(aMessageUri);</span>
<a href="#l113.102"></a><span id="l113.102" class="difflineplus">+  nsAutoCString urlString(aUrl);</span>
<a href="#l113.103"></a><span id="l113.103">   MsgReplaceSubstring(urlString, &quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l113.104"></a><span id="l113.104">   </span>
<a href="#l113.105"></a><span id="l113.105">   // more stuff i don't understand</span>
<a href="#l113.106"></a><span id="l113.106">   int32_t sectionPos = urlString.Find(&quot;?section&quot;);</span>
<a href="#l113.107"></a><span id="l113.107">   // if we have a section field then we must be dealing with a mime part we need to fetchf</span>
<a href="#l113.108"></a><span id="l113.108">   if (sectionPos &gt; 0)</span>
<a href="#l113.109"></a><span id="l113.109">   {</span>
<a href="#l113.110"></a><span id="l113.110">     uri.Append(Substring(urlString, sectionPos));</span>
<a href="#l113.111"></a><span id="l113.111" class="difflineat">@@ -319,31 +319,31 @@ NS_IMETHODIMP nsImapService::OpenAttachm</span>
<a href="#l113.112"></a><span id="l113.112">     uri += Substring(part, 0, part.FindChar('&amp;'));</span>
<a href="#l113.113"></a><span id="l113.113">     uri += &quot;&amp;type=&quot;;</span>
<a href="#l113.114"></a><span id="l113.114">     uri += aContentType;</span>
<a href="#l113.115"></a><span id="l113.115">     uri += &quot;&amp;filename=&quot;;</span>
<a href="#l113.116"></a><span id="l113.116">     uri += aFileName;</span>
<a href="#l113.117"></a><span id="l113.117">   }</span>
<a href="#l113.118"></a><span id="l113.118"> </span>
<a href="#l113.119"></a><span id="l113.119">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.120"></a><span id="l113.120" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.121"></a><span id="l113.121" class="difflineminus">-  nsCAutoString uriMimePart;</span>
<a href="#l113.122"></a><span id="l113.122" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l113.123"></a><span id="l113.123" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.124"></a><span id="l113.124" class="difflineplus">+  nsAutoCString uriMimePart;</span>
<a href="#l113.125"></a><span id="l113.125" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l113.126"></a><span id="l113.126">   nsMsgKey key;</span>
<a href="#l113.127"></a><span id="l113.127"> </span>
<a href="#l113.128"></a><span id="l113.128">   nsresult rv = DecomposeImapURI(uri, getter_AddRefs(folder), msgKey);</span>
<a href="#l113.129"></a><span id="l113.129">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.130"></a><span id="l113.130">   rv = nsParseImapMessageURI(uri.get(), folderURI, &amp;key, getter_Copies(uriMimePart));</span>
<a href="#l113.131"></a><span id="l113.131">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.132"></a><span id="l113.132">   {</span>
<a href="#l113.133"></a><span id="l113.133">     nsCOMPtr&lt;nsIImapMessageSink&gt; imapMessageSink(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l113.134"></a><span id="l113.134">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.135"></a><span id="l113.135">     {</span>
<a href="#l113.136"></a><span id="l113.136">       nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.137"></a><span id="l113.137" class="difflineminus">-      nsCAutoString urlSpec;</span>
<a href="#l113.138"></a><span id="l113.138" class="difflineplus">+      nsAutoCString urlSpec;</span>
<a href="#l113.139"></a><span id="l113.139">       char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.140"></a><span id="l113.140">       rv = CreateStartOfImapUrl(uri, getter_AddRefs(imapUrl), folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.141"></a><span id="l113.141">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.142"></a><span id="l113.142"> </span>
<a href="#l113.143"></a><span id="l113.143">       urlSpec.Append(&quot;/fetch&gt;UID&gt;&quot;);</span>
<a href="#l113.144"></a><span id="l113.144">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.145"></a><span id="l113.145"> </span>
<a href="#l113.146"></a><span id="l113.146">       nsCString folderName;</span>
<a href="#l113.147"></a><span id="l113.147" class="difflineat">@@ -375,20 +375,20 @@ NS_IMETHODIMP nsImapService::OpenAttachm</span>
<a href="#l113.148"></a><span id="l113.148"> NS_IMETHODIMP nsImapService::FetchMimePart(nsIURI *aURI, </span>
<a href="#l113.149"></a><span id="l113.149">                                            const char *aMessageURI, </span>
<a href="#l113.150"></a><span id="l113.150">                                            nsISupports *aDisplayConsumer, </span>
<a href="#l113.151"></a><span id="l113.151">                                            nsIMsgWindow *aMsgWindow, </span>
<a href="#l113.152"></a><span id="l113.152">                                            nsIUrlListener *aUrlListener, </span>
<a href="#l113.153"></a><span id="l113.153">                                            nsIURI **aURL)</span>
<a href="#l113.154"></a><span id="l113.154"> {</span>
<a href="#l113.155"></a><span id="l113.155">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.156"></a><span id="l113.156" class="difflineminus">-  nsCAutoString messageURI(aMessageURI);</span>
<a href="#l113.157"></a><span id="l113.157" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.158"></a><span id="l113.158" class="difflineminus">-  nsCAutoString mimePart;</span>
<a href="#l113.159"></a><span id="l113.159" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l113.160"></a><span id="l113.160" class="difflineplus">+  nsAutoCString messageURI(aMessageURI);</span>
<a href="#l113.161"></a><span id="l113.161" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.162"></a><span id="l113.162" class="difflineplus">+  nsAutoCString mimePart;</span>
<a href="#l113.163"></a><span id="l113.163" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l113.164"></a><span id="l113.164">   nsMsgKey key;</span>
<a href="#l113.165"></a><span id="l113.165">   </span>
<a href="#l113.166"></a><span id="l113.166">   nsresult rv = DecomposeImapURI(messageURI, getter_AddRefs(folder), msgKey);</span>
<a href="#l113.167"></a><span id="l113.167">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.168"></a><span id="l113.168">   rv = nsParseImapMessageURI(aMessageURI, folderURI, &amp;key, getter_Copies(mimePart));</span>
<a href="#l113.169"></a><span id="l113.169">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.170"></a><span id="l113.170">   {</span>
<a href="#l113.171"></a><span id="l113.171">     nsCOMPtr&lt;nsIImapMessageSink&gt; imapMessageSink(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l113.172"></a><span id="l113.172" class="difflineat">@@ -415,21 +415,21 @@ NS_IMETHODIMP nsImapService::DisplayMess</span>
<a href="#l113.173"></a><span id="l113.173">                                             nsIMsgWindow *aMsgWindow,</span>
<a href="#l113.174"></a><span id="l113.174">                                             nsIUrlListener *aUrlListener,</span>
<a href="#l113.175"></a><span id="l113.175">                                             const char *aCharsetOverride,</span>
<a href="#l113.176"></a><span id="l113.176">                                             nsIURI **aURL)</span>
<a href="#l113.177"></a><span id="l113.177"> {</span>
<a href="#l113.178"></a><span id="l113.178">   nsresult rv;</span>
<a href="#l113.179"></a><span id="l113.179"> </span>
<a href="#l113.180"></a><span id="l113.180">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.181"></a><span id="l113.181" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.182"></a><span id="l113.182" class="difflineminus">-  nsCAutoString mimePart;</span>
<a href="#l113.183"></a><span id="l113.183" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l113.184"></a><span id="l113.184" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.185"></a><span id="l113.185" class="difflineplus">+  nsAutoCString mimePart;</span>
<a href="#l113.186"></a><span id="l113.186" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l113.187"></a><span id="l113.187">   nsMsgKey key;</span>
<a href="#l113.188"></a><span id="l113.188" class="difflineminus">-  nsCAutoString messageURI(aMessageURI);</span>
<a href="#l113.189"></a><span id="l113.189" class="difflineplus">+  nsAutoCString messageURI(aMessageURI);</span>
<a href="#l113.190"></a><span id="l113.190"> </span>
<a href="#l113.191"></a><span id="l113.191">   int32_t typeIndex = messageURI.Find(&quot;&amp;type=application/x-message-display&quot;);</span>
<a href="#l113.192"></a><span id="l113.192">   if (typeIndex != kNotFound)</span>
<a href="#l113.193"></a><span id="l113.193">   {</span>
<a href="#l113.194"></a><span id="l113.194">     // This happens with forward inline of a message/rfc822 attachment opened in</span>
<a href="#l113.195"></a><span id="l113.195">     // a standalone msg window.</span>
<a href="#l113.196"></a><span id="l113.196">     // So, just cut to the chase and call AsyncOpen on a channel.</span>
<a href="#l113.197"></a><span id="l113.197">     nsCOMPtr &lt;nsIURI&gt; uri;</span>
<a href="#l113.198"></a><span id="l113.198" class="difflineat">@@ -463,17 +463,17 @@ NS_IMETHODIMP nsImapService::DisplayMess</span>
<a href="#l113.199"></a><span id="l113.199"> </span>
<a href="#l113.200"></a><span id="l113.200">   rv = nsParseImapMessageURI(aMessageURI, folderURI, &amp;key, getter_Copies(mimePart));</span>
<a href="#l113.201"></a><span id="l113.201">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.202"></a><span id="l113.202">   {</span>
<a href="#l113.203"></a><span id="l113.203">     nsCOMPtr&lt;nsIImapMessageSink&gt; imapMessageSink(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l113.204"></a><span id="l113.204">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.205"></a><span id="l113.205">     {</span>
<a href="#l113.206"></a><span id="l113.206">       nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.207"></a><span id="l113.207" class="difflineminus">-      nsCAutoString urlSpec;</span>
<a href="#l113.208"></a><span id="l113.208" class="difflineplus">+      nsAutoCString urlSpec;</span>
<a href="#l113.209"></a><span id="l113.209">       char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.210"></a><span id="l113.210">       rv = CreateStartOfImapUrl(messageURI, getter_AddRefs(imapUrl), folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.211"></a><span id="l113.211">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.212"></a><span id="l113.212">       if (!mimePart.IsEmpty())</span>
<a href="#l113.213"></a><span id="l113.213">       {</span>
<a href="#l113.214"></a><span id="l113.214">         return FetchMimePart(imapUrl, nsIImapUrl::nsImapMsgFetch, folder, imapMessageSink,</span>
<a href="#l113.215"></a><span id="l113.215">                              aURL, aDisplayConsumer, msgKey, mimePart);</span>
<a href="#l113.216"></a><span id="l113.216">       }</span>
<a href="#l113.217"></a><span id="l113.217" class="difflineat">@@ -498,17 +498,17 @@ NS_IMETHODIMP nsImapService::DisplayMess</span>
<a href="#l113.218"></a><span id="l113.218"> </span>
<a href="#l113.219"></a><span id="l113.219">       if (NS_SUCCEEDED(rv) &amp;&amp; aMsgIncomingServer)</span>
<a href="#l113.220"></a><span id="l113.220">       {</span>
<a href="#l113.221"></a><span id="l113.221">         nsCOMPtr&lt;nsIImapIncomingServer&gt; aImapServer(do_QueryInterface(aMsgIncomingServer, &amp;rv));</span>
<a href="#l113.222"></a><span id="l113.222">         if (NS_SUCCEEDED(rv) &amp;&amp; aImapServer)</span>
<a href="#l113.223"></a><span id="l113.223">           aImapServer-&gt;GetMimePartsOnDemand(&amp;useMimePartsOnDemand);</span>
<a href="#l113.224"></a><span id="l113.224">       }</span>
<a href="#l113.225"></a><span id="l113.225"> </span>
<a href="#l113.226"></a><span id="l113.226" class="difflineminus">-      nsCAutoString uriStr(aMessageURI);</span>
<a href="#l113.227"></a><span id="l113.227" class="difflineplus">+      nsAutoCString uriStr(aMessageURI);</span>
<a href="#l113.228"></a><span id="l113.228">       int32_t keySeparator = uriStr.RFindChar('#');</span>
<a href="#l113.229"></a><span id="l113.229">       if(keySeparator != -1)</span>
<a href="#l113.230"></a><span id="l113.230">       {</span>
<a href="#l113.231"></a><span id="l113.231">         int32_t keyEndSeparator = MsgFindCharInSet(uriStr, &quot;/?&amp;&quot;, keySeparator);</span>
<a href="#l113.232"></a><span id="l113.232">         int32_t mpodFetchPos = MsgFind(uriStr, &quot;fetchCompleteMessage=true&quot;, false, keyEndSeparator);</span>
<a href="#l113.233"></a><span id="l113.233">         if (mpodFetchPos != -1)</span>
<a href="#l113.234"></a><span id="l113.234">           useMimePartsOnDemand = false;</span>
<a href="#l113.235"></a><span id="l113.235">       }</span>
<a href="#l113.236"></a><span id="l113.236" class="difflineat">@@ -562,17 +562,17 @@ nsresult nsImapService::FetchMimePart(ns</span>
<a href="#l113.237"></a><span id="l113.237"> {</span>
<a href="#l113.238"></a><span id="l113.238">   NS_ENSURE_ARG_POINTER(aImapUrl);</span>
<a href="#l113.239"></a><span id="l113.239">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.240"></a><span id="l113.240">   NS_ENSURE_ARG_POINTER(aImapMessage);</span>
<a href="#l113.241"></a><span id="l113.241"> </span>
<a href="#l113.242"></a><span id="l113.242">   // create a protocol instance to handle the request.</span>
<a href="#l113.243"></a><span id="l113.243">   // NOTE: once we start working with multiple connections, this step will be much more complicated...but for now</span>
<a href="#l113.244"></a><span id="l113.244">   // just create a connection and process the request.</span>
<a href="#l113.245"></a><span id="l113.245" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.246"></a><span id="l113.246" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.247"></a><span id="l113.247">   nsresult rv = SetImapUrlSink(aImapMailFolder, aImapUrl);</span>
<a href="#l113.248"></a><span id="l113.248">   nsImapAction actionToUse = aImapAction;</span>
<a href="#l113.249"></a><span id="l113.249">   if (actionToUse == nsImapUrl::nsImapOpenMimePart)</span>
<a href="#l113.250"></a><span id="l113.250">     actionToUse = nsIImapUrl::nsImapMsgFetch;</span>
<a href="#l113.251"></a><span id="l113.251"> </span>
<a href="#l113.252"></a><span id="l113.252">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgurl (do_QueryInterface(aImapUrl));</span>
<a href="#l113.253"></a><span id="l113.253">   if (aImapMailFolder &amp;&amp; msgurl &amp;&amp; !messageIdentifierList.IsEmpty())</span>
<a href="#l113.254"></a><span id="l113.254">   {</span>
<a href="#l113.255"></a><span id="l113.255" class="difflineat">@@ -696,25 +696,25 @@ NS_IMETHODIMP nsImapService::CopyMessage</span>
<a href="#l113.256"></a><span id="l113.256">   NS_ENSURE_ARG_POINTER(aMailboxCopy);</span>
<a href="#l113.257"></a><span id="l113.257">   </span>
<a href="#l113.258"></a><span id="l113.258">   nsresult rv;</span>
<a href="#l113.259"></a><span id="l113.259">   nsCOMPtr&lt;nsISupports&gt; streamSupport;</span>
<a href="#l113.260"></a><span id="l113.260">   streamSupport = do_QueryInterface(aMailboxCopy, &amp;rv);</span>
<a href="#l113.261"></a><span id="l113.261">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.262"></a><span id="l113.262">   </span>
<a href="#l113.263"></a><span id="l113.263">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.264"></a><span id="l113.264" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.265"></a><span id="l113.265" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.266"></a><span id="l113.266">   rv = DecomposeImapURI(nsDependentCString(aSrcMailboxURI), getter_AddRefs(folder), msgKey);</span>
<a href="#l113.267"></a><span id="l113.267">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.268"></a><span id="l113.268">   {</span>
<a href="#l113.269"></a><span id="l113.269">     nsCOMPtr&lt;nsIImapMessageSink&gt; imapMessageSink(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l113.270"></a><span id="l113.270">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.271"></a><span id="l113.271">     {</span>
<a href="#l113.272"></a><span id="l113.272">       nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.273"></a><span id="l113.273" class="difflineminus">-      nsCAutoString urlSpec;</span>
<a href="#l113.274"></a><span id="l113.274" class="difflineplus">+      nsAutoCString urlSpec;</span>
<a href="#l113.275"></a><span id="l113.275">       char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.276"></a><span id="l113.276">       bool hasMsgOffline = false;</span>
<a href="#l113.277"></a><span id="l113.277">       nsMsgKey key = atoi(msgKey.get());</span>
<a href="#l113.278"></a><span id="l113.278"> </span>
<a href="#l113.279"></a><span id="l113.279">       rv = CreateStartOfImapUrl(nsDependentCString(aSrcMailboxURI), getter_AddRefs(imapUrl),</span>
<a href="#l113.280"></a><span id="l113.280">                                 folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.281"></a><span id="l113.281">       if (folder)</span>
<a href="#l113.282"></a><span id="l113.282">       {</span>
<a href="#l113.283"></a><span id="l113.283" class="difflineat">@@ -761,17 +761,17 @@ NS_IMETHODIMP nsImapService::CopyMessage</span>
<a href="#l113.284"></a><span id="l113.284">       // GetMessage in nsCopyMessageStreamListener will get an unescaped username</span>
<a href="#l113.285"></a><span id="l113.285">       // and be able to find the msg hdr. See bug 259656 for details</span>
<a href="#l113.286"></a><span id="l113.286">       nsCString uri;</span>
<a href="#l113.287"></a><span id="l113.287">       srcFolder-&gt;GenerateMessageURI(aKeys[0], uri);</span>
<a href="#l113.288"></a><span id="l113.288"> </span>
<a href="#l113.289"></a><span id="l113.289">       nsCString messageIds;</span>
<a href="#l113.290"></a><span id="l113.290">       AllocateImapUidString(aKeys, aNumKeys, nullptr, messageIds);</span>
<a href="#l113.291"></a><span id="l113.291">       nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.292"></a><span id="l113.292" class="difflineminus">-      nsCAutoString urlSpec;</span>
<a href="#l113.293"></a><span id="l113.293" class="difflineplus">+      nsAutoCString urlSpec;</span>
<a href="#l113.294"></a><span id="l113.294">       char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.295"></a><span id="l113.295">       rv = CreateStartOfImapUrl(uri, getter_AddRefs(imapUrl), folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.296"></a><span id="l113.296">       nsImapAction action;</span>
<a href="#l113.297"></a><span id="l113.297">       if (moveMessage) // don't use ?: syntax here, it seems to break the Mac.</span>
<a href="#l113.298"></a><span id="l113.298">         action = nsIImapUrl::nsImapOnlineToOfflineMove;</span>
<a href="#l113.299"></a><span id="l113.299">       else</span>
<a href="#l113.300"></a><span id="l113.300">         action = nsIImapUrl::nsImapOnlineToOfflineCopy;</span>
<a href="#l113.301"></a><span id="l113.301">       imapUrl-&gt;SetCopyState(aMailboxCopy);</span>
<a href="#l113.302"></a><span id="l113.302" class="difflineat">@@ -793,17 +793,17 @@ NS_IMETHODIMP nsImapService::Search(nsIM</span>
<a href="#l113.303"></a><span id="l113.303">   NS_ENSURE_ARG_POINTER(aSearchUri);</span>
<a href="#l113.304"></a><span id="l113.304">   NS_ENSURE_ARG_POINTER(aMsgFolder);</span>
<a href="#l113.305"></a><span id="l113.305">   nsresult rv;</span>
<a href="#l113.306"></a><span id="l113.306"> </span>
<a href="#l113.307"></a><span id="l113.307">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.308"></a><span id="l113.308">   nsCOMPtr &lt;nsIUrlListener&gt; urlListener = do_QueryInterface(aSearchSession, &amp;rv);</span>
<a href="#l113.309"></a><span id="l113.309">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.310"></a><span id="l113.310"> </span>
<a href="#l113.311"></a><span id="l113.311" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.312"></a><span id="l113.312" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.313"></a><span id="l113.313">   char hierarchyDelimiter = GetHierarchyDelimiter(aMsgFolder);</span>
<a href="#l113.314"></a><span id="l113.314">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl),</span>
<a href="#l113.315"></a><span id="l113.315">                             aMsgFolder, urlListener, urlSpec,</span>
<a href="#l113.316"></a><span id="l113.316">                             hierarchyDelimiter);</span>
<a href="#l113.317"></a><span id="l113.317">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.318"></a><span id="l113.318">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgurl (do_QueryInterface(imapUrl));</span>
<a href="#l113.319"></a><span id="l113.319"> </span>
<a href="#l113.320"></a><span id="l113.320">   msgurl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l113.321"></a><span id="l113.321" class="difflineat">@@ -843,33 +843,33 @@ nsresult nsImapService::DecomposeImapURI</span>
<a href="#l113.322"></a><span id="l113.322">                                          nsACString &amp;aMsgKey)</span>
<a href="#l113.323"></a><span id="l113.323"> {</span>
<a href="#l113.324"></a><span id="l113.324">   nsMsgKey msgKey;</span>
<a href="#l113.325"></a><span id="l113.325">   nsresult rv = DecomposeImapURI(aMessageURI, aFolder, &amp;msgKey);</span>
<a href="#l113.326"></a><span id="l113.326">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.327"></a><span id="l113.327"> </span>
<a href="#l113.328"></a><span id="l113.328">   if (msgKey)</span>
<a href="#l113.329"></a><span id="l113.329">   {</span>
<a href="#l113.330"></a><span id="l113.330" class="difflineminus">-    nsCAutoString messageIdString;</span>
<a href="#l113.331"></a><span id="l113.331" class="difflineplus">+    nsAutoCString messageIdString;</span>
<a href="#l113.332"></a><span id="l113.332">     messageIdString.AppendInt(msgKey);</span>
<a href="#l113.333"></a><span id="l113.333">     aMsgKey = messageIdString;</span>
<a href="#l113.334"></a><span id="l113.334">   }</span>
<a href="#l113.335"></a><span id="l113.335"> </span>
<a href="#l113.336"></a><span id="l113.336">   return rv;</span>
<a href="#l113.337"></a><span id="l113.337"> }</span>
<a href="#l113.338"></a><span id="l113.338"> </span>
<a href="#l113.339"></a><span id="l113.339"> // just a helper method to break down imap message URIs....</span>
<a href="#l113.340"></a><span id="l113.340"> nsresult nsImapService::DecomposeImapURI(const nsACString &amp;aMessageURI,</span>
<a href="#l113.341"></a><span id="l113.341">                                          nsIMsgFolder **aFolder,</span>
<a href="#l113.342"></a><span id="l113.342">                                          nsMsgKey *aMsgKey)</span>
<a href="#l113.343"></a><span id="l113.343"> {</span>
<a href="#l113.344"></a><span id="l113.344">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l113.345"></a><span id="l113.345">   NS_ENSURE_ARG_POINTER(aMsgKey);</span>
<a href="#l113.346"></a><span id="l113.346"> </span>
<a href="#l113.347"></a><span id="l113.347" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l113.348"></a><span id="l113.348" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l113.349"></a><span id="l113.349">   nsresult rv = nsParseImapMessageURI(PromiseFlatCString(aMessageURI).get(),</span>
<a href="#l113.350"></a><span id="l113.350">                                       folderURI, aMsgKey, nullptr);</span>
<a href="#l113.351"></a><span id="l113.351">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.352"></a><span id="l113.352"> </span>
<a href="#l113.353"></a><span id="l113.353">   nsCOMPtr &lt;nsIRDFService&gt; rdf = do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;,&amp;rv);</span>
<a href="#l113.354"></a><span id="l113.354">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.355"></a><span id="l113.355"> </span>
<a href="#l113.356"></a><span id="l113.356">   nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l113.357"></a><span id="l113.357" class="difflineat">@@ -889,28 +889,28 @@ NS_IMETHODIMP nsImapService::SaveMessage</span>
<a href="#l113.358"></a><span id="l113.358">                                                bool aAddDummyEnvelope,</span>
<a href="#l113.359"></a><span id="l113.359">                                                nsIUrlListener *aUrlListener,</span>
<a href="#l113.360"></a><span id="l113.360">                                                nsIURI **aURL,</span>
<a href="#l113.361"></a><span id="l113.361">                                                bool canonicalLineEnding,</span>
<a href="#l113.362"></a><span id="l113.362">                                                nsIMsgWindow *aMsgWindow)</span>
<a href="#l113.363"></a><span id="l113.363"> {</span>
<a href="#l113.364"></a><span id="l113.364">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.365"></a><span id="l113.365">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.366"></a><span id="l113.366" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.367"></a><span id="l113.367" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.368"></a><span id="l113.368"> </span>
<a href="#l113.369"></a><span id="l113.369">   nsresult rv = DecomposeImapURI(nsDependentCString(aMessageURI),</span>
<a href="#l113.370"></a><span id="l113.370">                                  getter_AddRefs(folder), msgKey);</span>
<a href="#l113.371"></a><span id="l113.371">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.372"></a><span id="l113.372"> </span>
<a href="#l113.373"></a><span id="l113.373">   bool hasMsgOffline = false;</span>
<a href="#l113.374"></a><span id="l113.374"> </span>
<a href="#l113.375"></a><span id="l113.375">   if (folder)</span>
<a href="#l113.376"></a><span id="l113.376">     folder-&gt;HasMsgOffline(atoi(msgKey.get()), &amp;hasMsgOffline);</span>
<a href="#l113.377"></a><span id="l113.377"> </span>
<a href="#l113.378"></a><span id="l113.378" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.379"></a><span id="l113.379" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.380"></a><span id="l113.380">   char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.381"></a><span id="l113.381">   rv = CreateStartOfImapUrl(nsDependentCString(aMessageURI), getter_AddRefs(imapUrl), </span>
<a href="#l113.382"></a><span id="l113.382">                             folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.383"></a><span id="l113.383">   if (NS_SUCCEEDED(rv)) </span>
<a href="#l113.384"></a><span id="l113.384">   {</span>
<a href="#l113.385"></a><span id="l113.385">     nsCOMPtr&lt;nsIImapMessageSink&gt; imapMessageSink(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l113.386"></a><span id="l113.386">     NS_ENSURE_SUCCESS(rv, rv);  </span>
<a href="#l113.387"></a><span id="l113.387">     nsCOMPtr&lt;nsIMsgMessageUrl&gt; msgUrl = do_QueryInterface(imapUrl, &amp;rv);</span>
<a href="#l113.388"></a><span id="l113.388" class="difflineat">@@ -938,25 +938,25 @@ NS_IMETHODIMP nsImapService::SaveMessage</span>
<a href="#l113.389"></a><span id="l113.389"> /* will set the 'SEEN' flag */</span>
<a href="#l113.390"></a><span id="l113.390"> NS_IMETHODIMP nsImapService::AddImapFetchToUrl(nsIURI *aUrl,</span>
<a href="#l113.391"></a><span id="l113.391">                                                nsIMsgFolder *aImapMailFolder,</span>
<a href="#l113.392"></a><span id="l113.392">                                                const nsACString &amp;aMessageIdentifierList,</span>
<a href="#l113.393"></a><span id="l113.393">                                                const nsACString &amp;aAdditionalHeader)</span>
<a href="#l113.394"></a><span id="l113.394"> {</span>
<a href="#l113.395"></a><span id="l113.395">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l113.396"></a><span id="l113.396"> </span>
<a href="#l113.397"></a><span id="l113.397" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.398"></a><span id="l113.398" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.399"></a><span id="l113.399">   aUrl-&gt;GetSpec(urlSpec);</span>
<a href="#l113.400"></a><span id="l113.400"> </span>
<a href="#l113.401"></a><span id="l113.401">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.402"></a><span id="l113.402"> </span>
<a href="#l113.403"></a><span id="l113.403">   urlSpec.Append(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l113.404"></a><span id="l113.404">   urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.405"></a><span id="l113.405"> </span>
<a href="#l113.406"></a><span id="l113.406" class="difflineminus">-  nsCAutoString folderName;</span>
<a href="#l113.407"></a><span id="l113.407" class="difflineplus">+  nsAutoCString folderName;</span>
<a href="#l113.408"></a><span id="l113.408">   GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l113.409"></a><span id="l113.409">   urlSpec.Append(folderName);</span>
<a href="#l113.410"></a><span id="l113.410"> </span>
<a href="#l113.411"></a><span id="l113.411">   urlSpec.Append(&quot;&gt;&quot;);</span>
<a href="#l113.412"></a><span id="l113.412">   urlSpec.Append(aMessageIdentifierList);</span>
<a href="#l113.413"></a><span id="l113.413"> </span>
<a href="#l113.414"></a><span id="l113.414">   if (!aAdditionalHeader.IsEmpty())</span>
<a href="#l113.415"></a><span id="l113.415">   {</span>
<a href="#l113.416"></a><span id="l113.416" class="difflineat">@@ -1121,48 +1121,48 @@ NS_IMETHODIMP nsImapService::StreamMessa</span>
<a href="#l113.417"></a><span id="l113.417">                                            bool aConvertData,</span>
<a href="#l113.418"></a><span id="l113.418">                                            const nsACString &amp;aAdditionalHeader,</span>
<a href="#l113.419"></a><span id="l113.419">                                            bool aLocalOnly,</span>
<a href="#l113.420"></a><span id="l113.420">                                            nsIURI **aURL)</span>
<a href="#l113.421"></a><span id="l113.421"> {</span>
<a href="#l113.422"></a><span id="l113.422">   NS_ENSURE_ARG_POINTER(aMessageURI);</span>
<a href="#l113.423"></a><span id="l113.423"> </span>
<a href="#l113.424"></a><span id="l113.424">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.425"></a><span id="l113.425" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.426"></a><span id="l113.426" class="difflineminus">-  nsCAutoString mimePart;</span>
<a href="#l113.427"></a><span id="l113.427" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l113.428"></a><span id="l113.428" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.429"></a><span id="l113.429" class="difflineplus">+  nsAutoCString mimePart;</span>
<a href="#l113.430"></a><span id="l113.430" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l113.431"></a><span id="l113.431">   nsMsgKey key;</span>
<a href="#l113.432"></a><span id="l113.432"> </span>
<a href="#l113.433"></a><span id="l113.433">   nsresult rv = DecomposeImapURI(nsDependentCString(aMessageURI), getter_AddRefs(folder), msgKey);</span>
<a href="#l113.434"></a><span id="l113.434">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.435"></a><span id="l113.435"> </span>
<a href="#l113.436"></a><span id="l113.436">   if (msgKey.IsEmpty())</span>
<a href="#l113.437"></a><span id="l113.437">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l113.438"></a><span id="l113.438">   rv = nsParseImapMessageURI(aMessageURI, folderURI, &amp;key, getter_Copies(mimePart));</span>
<a href="#l113.439"></a><span id="l113.439">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.440"></a><span id="l113.440">   {</span>
<a href="#l113.441"></a><span id="l113.441">     nsCOMPtr&lt;nsIImapMessageSink&gt; imapMessageSink(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l113.442"></a><span id="l113.442">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.443"></a><span id="l113.443">     {</span>
<a href="#l113.444"></a><span id="l113.444">       nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.445"></a><span id="l113.445" class="difflineminus">-      nsCAutoString urlSpec;</span>
<a href="#l113.446"></a><span id="l113.446" class="difflineplus">+      nsAutoCString urlSpec;</span>
<a href="#l113.447"></a><span id="l113.447">       char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.448"></a><span id="l113.448">       rv = CreateStartOfImapUrl(nsDependentCString(aMessageURI), getter_AddRefs(imapUrl), </span>
<a href="#l113.449"></a><span id="l113.449">                                 folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.450"></a><span id="l113.450">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.451"></a><span id="l113.451">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgurl (do_QueryInterface(imapUrl));</span>
<a href="#l113.452"></a><span id="l113.452">       nsCOMPtr&lt;nsIURI&gt; url(do_QueryInterface(imapUrl));</span>
<a href="#l113.453"></a><span id="l113.453"> </span>
<a href="#l113.454"></a><span id="l113.454">       // This option is used by the JS Mime Emitter, in case we want a cheap</span>
<a href="#l113.455"></a><span id="l113.455">       // streaming, for example, if we just want a quick look at some header,</span>
<a href="#l113.456"></a><span id="l113.456">       // without having to download all the attachments...</span>
<a href="#l113.457"></a><span id="l113.457"> </span>
<a href="#l113.458"></a><span id="l113.458">       uint32_t messageSize = 0;</span>
<a href="#l113.459"></a><span id="l113.459">       imapMessageSink-&gt;GetMessageSizeFromDB(msgKey.get(), &amp;messageSize);</span>
<a href="#l113.460"></a><span id="l113.460" class="difflineminus">-      nsCAutoString additionalHeader(aAdditionalHeader);</span>
<a href="#l113.461"></a><span id="l113.461" class="difflineplus">+      nsAutoCString additionalHeader(aAdditionalHeader);</span>
<a href="#l113.462"></a><span id="l113.462">       bool fetchOnDemand =</span>
<a href="#l113.463"></a><span id="l113.463">         additionalHeader.Find(&quot;&amp;fetchCompleteMessage=false&quot;) != kNotFound &amp;&amp;</span>
<a href="#l113.464"></a><span id="l113.464">           messageSize &gt; (uint32_t) gMIMEOnDemandThreshold;</span>
<a href="#l113.465"></a><span id="l113.465">       imapUrl-&gt;SetFetchPartsOnDemand(fetchOnDemand);</span>
<a href="#l113.466"></a><span id="l113.466"> </span>
<a href="#l113.467"></a><span id="l113.467">       // We need to add the fetch command here for the cache lookup to behave correctly</span>
<a href="#l113.468"></a><span id="l113.468">       rv = AddImapFetchToUrl(url, folder, msgKey, additionalHeader);</span>
<a href="#l113.469"></a><span id="l113.469">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.470"></a><span id="l113.470" class="difflineat">@@ -1211,18 +1211,18 @@ NS_IMETHODIMP nsImapService::StreamHeade</span>
<a href="#l113.471"></a><span id="l113.471">                                            nsIStreamListener *aConsumer,</span>
<a href="#l113.472"></a><span id="l113.472">                                            nsIUrlListener *aUrlListener,</span>
<a href="#l113.473"></a><span id="l113.473">                                            bool aLocalOnly,</span>
<a href="#l113.474"></a><span id="l113.474">                                            nsIURI **aURL)</span>
<a href="#l113.475"></a><span id="l113.475"> {</span>
<a href="#l113.476"></a><span id="l113.476">   NS_ENSURE_ARG_POINTER(aMessageURI);</span>
<a href="#l113.477"></a><span id="l113.477">   NS_ENSURE_ARG_POINTER(aConsumer);</span>
<a href="#l113.478"></a><span id="l113.478">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l113.479"></a><span id="l113.479" class="difflineminus">-  nsCAutoString msgKey;</span>
<a href="#l113.480"></a><span id="l113.480" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l113.481"></a><span id="l113.481" class="difflineplus">+  nsAutoCString msgKey;</span>
<a href="#l113.482"></a><span id="l113.482" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l113.483"></a><span id="l113.483">   nsCString mimePart;</span>
<a href="#l113.484"></a><span id="l113.484">   nsMsgKey key;</span>
<a href="#l113.485"></a><span id="l113.485"> </span>
<a href="#l113.486"></a><span id="l113.486">   nsresult rv = DecomposeImapURI(nsDependentCString(aMessageURI), getter_AddRefs(folder), msgKey);</span>
<a href="#l113.487"></a><span id="l113.487">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.488"></a><span id="l113.488"> </span>
<a href="#l113.489"></a><span id="l113.489">   if (msgKey.IsEmpty())</span>
<a href="#l113.490"></a><span id="l113.490">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l113.491"></a><span id="l113.491" class="difflineat">@@ -1236,17 +1236,17 @@ NS_IMETHODIMP nsImapService::StreamHeade</span>
<a href="#l113.492"></a><span id="l113.492">     {</span>
<a href="#l113.493"></a><span id="l113.493">       int64_t messageOffset;</span>
<a href="#l113.494"></a><span id="l113.494">       uint32_t messageSize;</span>
<a href="#l113.495"></a><span id="l113.495">       folder-&gt;GetOfflineFileStream(key, &amp;messageOffset, &amp;messageSize, getter_AddRefs(inputStream));</span>
<a href="#l113.496"></a><span id="l113.496">       if (inputStream)</span>
<a href="#l113.497"></a><span id="l113.497">         return MsgStreamMsgHeaders(inputStream, aConsumer);</span>
<a href="#l113.498"></a><span id="l113.498">     }</span>
<a href="#l113.499"></a><span id="l113.499">     nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.500"></a><span id="l113.500" class="difflineminus">-    nsCAutoString urlSpec;</span>
<a href="#l113.501"></a><span id="l113.501" class="difflineplus">+    nsAutoCString urlSpec;</span>
<a href="#l113.502"></a><span id="l113.502">     char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.503"></a><span id="l113.503">     rv = CreateStartOfImapUrl(nsDependentCString(aMessageURI), getter_AddRefs(imapUrl), </span>
<a href="#l113.504"></a><span id="l113.504">                               folder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.505"></a><span id="l113.505">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.506"></a><span id="l113.506">     nsCOMPtr&lt;nsIURI&gt; url(do_QueryInterface(imapUrl));</span>
<a href="#l113.507"></a><span id="l113.507">     nsCOMPtr&lt;nsICacheEntryDescriptor&gt; cacheEntry;</span>
<a href="#l113.508"></a><span id="l113.508">     bool msgInMemCache = false;</span>
<a href="#l113.509"></a><span id="l113.509">     rv = IsMsgInMemCache(url, folder, getter_AddRefs(cacheEntry), &amp;msgInMemCache);</span>
<a href="#l113.510"></a><span id="l113.510" class="difflineat">@@ -1279,18 +1279,18 @@ NS_IMETHODIMP nsImapService::IsMsgInMemC</span>
<a href="#l113.511"></a><span id="l113.511">     nsresult rv;</span>
<a href="#l113.512"></a><span id="l113.512">     nsCOMPtr&lt;nsIImapMailFolderSink&gt; folderSink(do_QueryInterface(aImapMailFolder, &amp;rv));</span>
<a href="#l113.513"></a><span id="l113.513">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.514"></a><span id="l113.514"> </span>
<a href="#l113.515"></a><span id="l113.515">     int32_t uidValidity = -1;</span>
<a href="#l113.516"></a><span id="l113.516">     folderSink-&gt;GetUidValidity(&amp;uidValidity);</span>
<a href="#l113.517"></a><span id="l113.517">     // stick the uid validity in front of the url, so that if the uid validity</span>
<a href="#l113.518"></a><span id="l113.518">     // changes, we won't re-use the wrong cache entries.</span>
<a href="#l113.519"></a><span id="l113.519" class="difflineminus">-    nsCAutoString cacheKey;</span>
<a href="#l113.520"></a><span id="l113.520" class="difflineminus">-    nsCAutoString escapedSpec;</span>
<a href="#l113.521"></a><span id="l113.521" class="difflineplus">+    nsAutoCString cacheKey;</span>
<a href="#l113.522"></a><span id="l113.522" class="difflineplus">+    nsAutoCString escapedSpec;</span>
<a href="#l113.523"></a><span id="l113.523"> </span>
<a href="#l113.524"></a><span id="l113.524">     cacheKey.AppendInt(uidValidity, 16);</span>
<a href="#l113.525"></a><span id="l113.525">     aUrl-&gt;GetAsciiSpec(escapedSpec);</span>
<a href="#l113.526"></a><span id="l113.526">     cacheKey.Append(escapedSpec);</span>
<a href="#l113.527"></a><span id="l113.527">     nsCOMPtr&lt;nsICacheEntryDescriptor&gt; cacheEntry;</span>
<a href="#l113.528"></a><span id="l113.528">     rv = mCacheSession-&gt;OpenCacheEntry(cacheKey, nsICache::ACCESS_READ, false,</span>
<a href="#l113.529"></a><span id="l113.529">                                        getter_AddRefs(cacheEntry));</span>
<a href="#l113.530"></a><span id="l113.530">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.531"></a><span id="l113.531" class="difflineat">@@ -1346,17 +1346,17 @@ nsresult nsImapService::CreateStartOfIma</span>
<a href="#l113.532"></a><span id="l113.532">     msgurl-&gt;SetUri(PromiseFlatCString(aImapURI).get());</span>
<a href="#l113.533"></a><span id="l113.533"> </span>
<a href="#l113.534"></a><span id="l113.534">     urlSpec = &quot;imap://&quot;;</span>
<a href="#l113.535"></a><span id="l113.535">     urlSpec.Append(escapedUsername);</span>
<a href="#l113.536"></a><span id="l113.536">     urlSpec.Append('@');</span>
<a href="#l113.537"></a><span id="l113.537">     urlSpec.Append(hostname);</span>
<a href="#l113.538"></a><span id="l113.538">     urlSpec.Append(':');</span>
<a href="#l113.539"></a><span id="l113.539"> </span>
<a href="#l113.540"></a><span id="l113.540" class="difflineminus">-    nsCAutoString portStr;</span>
<a href="#l113.541"></a><span id="l113.541" class="difflineplus">+    nsAutoCString portStr;</span>
<a href="#l113.542"></a><span id="l113.542">     portStr.AppendInt(port);</span>
<a href="#l113.543"></a><span id="l113.543">     urlSpec.Append(portStr);</span>
<a href="#l113.544"></a><span id="l113.544"> </span>
<a href="#l113.545"></a><span id="l113.545">     // *** jefft - force to parse the urlSpec in order to search for</span>
<a href="#l113.546"></a><span id="l113.546">     // the correct incoming server</span>
<a href="#l113.547"></a><span id="l113.547">     rv = mailnewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l113.548"></a><span id="l113.548">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.549"></a><span id="l113.549"> </span>
<a href="#l113.550"></a><span id="l113.550" class="difflineat">@@ -1379,17 +1379,17 @@ NS_IMETHODIMP nsImapService::GetHeaders(</span>
<a href="#l113.551"></a><span id="l113.551">                                         bool messageIdsAreUID)</span>
<a href="#l113.552"></a><span id="l113.552"> {</span>
<a href="#l113.553"></a><span id="l113.553">   // create a protocol instance to handle the request.</span>
<a href="#l113.554"></a><span id="l113.554">   // NOTE: once we start working with multiple connections, this step will be much more complicated...but for now</span>
<a href="#l113.555"></a><span id="l113.555">   // just create a connection and process the request.</span>
<a href="#l113.556"></a><span id="l113.556">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.557"></a><span id="l113.557"> </span>
<a href="#l113.558"></a><span id="l113.558">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.559"></a><span id="l113.559" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.560"></a><span id="l113.560" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.561"></a><span id="l113.561">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.562"></a><span id="l113.562"> </span>
<a href="#l113.563"></a><span id="l113.563">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aImapMailFolder, </span>
<a href="#l113.564"></a><span id="l113.564">                                      aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.565"></a><span id="l113.565">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.566"></a><span id="l113.566">   {</span>
<a href="#l113.567"></a><span id="l113.567">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l113.568"></a><span id="l113.568"> </span>
<a href="#l113.569"></a><span id="l113.569" class="difflineat">@@ -1429,17 +1429,17 @@ NS_IMETHODIMP nsImapService::GetBodyStar</span>
<a href="#l113.570"></a><span id="l113.570">                                           const nsACString &amp;messageIdentifierList,</span>
<a href="#l113.571"></a><span id="l113.571">                                           int32_t numBytes,</span>
<a href="#l113.572"></a><span id="l113.572">                                           nsIURI **aURL)</span>
<a href="#l113.573"></a><span id="l113.573"> {</span>
<a href="#l113.574"></a><span id="l113.574">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.575"></a><span id="l113.575"> </span>
<a href="#l113.576"></a><span id="l113.576">   nsresult rv;</span>
<a href="#l113.577"></a><span id="l113.577">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.578"></a><span id="l113.578" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.579"></a><span id="l113.579" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.580"></a><span id="l113.580"> </span>
<a href="#l113.581"></a><span id="l113.581">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.582"></a><span id="l113.582">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aImapMailFolder, </span>
<a href="#l113.583"></a><span id="l113.583">     aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.584"></a><span id="l113.584">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.585"></a><span id="l113.585">   {</span>
<a href="#l113.586"></a><span id="l113.586">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgPreview);</span>
<a href="#l113.587"></a><span id="l113.587">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l113.588"></a><span id="l113.588" class="difflineat">@@ -1473,17 +1473,17 @@ nsresult nsImapService::FolderCommand(ns</span>
<a href="#l113.589"></a><span id="l113.589">                                       const char *aCommand,</span>
<a href="#l113.590"></a><span id="l113.590">                                       nsImapAction imapAction,</span>
<a href="#l113.591"></a><span id="l113.591">                                       nsIMsgWindow *msgWindow,</span>
<a href="#l113.592"></a><span id="l113.592">                                       nsIURI **url)</span>
<a href="#l113.593"></a><span id="l113.593"> {</span>
<a href="#l113.594"></a><span id="l113.594">   NS_ENSURE_ARG_POINTER(imapMailFolder);</span>
<a href="#l113.595"></a><span id="l113.595"> </span>
<a href="#l113.596"></a><span id="l113.596">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.597"></a><span id="l113.597" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.598"></a><span id="l113.598" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.599"></a><span id="l113.599"> </span>
<a href="#l113.600"></a><span id="l113.600">   char hierarchyDelimiter = GetHierarchyDelimiter(imapMailFolder);</span>
<a href="#l113.601"></a><span id="l113.601">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl),</span>
<a href="#l113.602"></a><span id="l113.602">                                      imapMailFolder, urlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.603"></a><span id="l113.603">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.604"></a><span id="l113.604">   {</span>
<a href="#l113.605"></a><span id="l113.605">     rv = imapUrl-&gt;SetImapAction(imapAction);</span>
<a href="#l113.606"></a><span id="l113.606">     rv = SetImapUrlSink(imapMailFolder, imapUrl);</span>
<a href="#l113.607"></a><span id="l113.607" class="difflineat">@@ -1508,17 +1508,17 @@ nsresult nsImapService::FolderCommand(ns</span>
<a href="#l113.608"></a><span id="l113.608">   return rv;</span>
<a href="#l113.609"></a><span id="l113.609"> }</span>
<a href="#l113.610"></a><span id="l113.610"> </span>
<a href="#l113.611"></a><span id="l113.611"> NS_IMETHODIMP</span>
<a href="#l113.612"></a><span id="l113.612"> nsImapService::VerifyLogon(nsIMsgFolder *aFolder, nsIUrlListener *aUrlListener,</span>
<a href="#l113.613"></a><span id="l113.613">                            nsIMsgWindow *aMsgWindow, nsIURI **aURL)</span>
<a href="#l113.614"></a><span id="l113.614"> {</span>
<a href="#l113.615"></a><span id="l113.615">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.616"></a><span id="l113.616" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.617"></a><span id="l113.617" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.618"></a><span id="l113.618"> </span>
<a href="#l113.619"></a><span id="l113.619">   char delimiter = '/'; // shouldn't matter what is is.</span>
<a href="#l113.620"></a><span id="l113.620">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aFolder,</span>
<a href="#l113.621"></a><span id="l113.621">                                      aUrlListener, urlSpec, delimiter);</span>
<a href="#l113.622"></a><span id="l113.622">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.623"></a><span id="l113.623">   {</span>
<a href="#l113.624"></a><span id="l113.624">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l113.625"></a><span id="l113.625"> </span>
<a href="#l113.626"></a><span id="l113.626" class="difflineat">@@ -1575,17 +1575,17 @@ NS_IMETHODIMP nsImapService::Biff(nsIMsg</span>
<a href="#l113.627"></a><span id="l113.627">                                   nsIUrlListener *aUrlListener, </span>
<a href="#l113.628"></a><span id="l113.628">                                   nsIURI **aURL,</span>
<a href="#l113.629"></a><span id="l113.629">                                   uint32_t uidHighWater)</span>
<a href="#l113.630"></a><span id="l113.630"> {</span>
<a href="#l113.631"></a><span id="l113.631">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.632"></a><span id="l113.632"> </span>
<a href="#l113.633"></a><span id="l113.633">   // static const char *formatString = &quot;biff&gt;%c%s&gt;%ld&quot;;</span>
<a href="#l113.634"></a><span id="l113.634">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.635"></a><span id="l113.635" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.636"></a><span id="l113.636" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.637"></a><span id="l113.637"> </span>
<a href="#l113.638"></a><span id="l113.638">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.639"></a><span id="l113.639">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl),</span>
<a href="#l113.640"></a><span id="l113.640">     aImapMailFolder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.641"></a><span id="l113.641">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.642"></a><span id="l113.642">   {</span>
<a href="#l113.643"></a><span id="l113.643">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapExpungeFolder);</span>
<a href="#l113.644"></a><span id="l113.644">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l113.645"></a><span id="l113.645" class="difflineat">@@ -1640,17 +1640,17 @@ NS_IMETHODIMP nsImapService::DeleteMessa</span>
<a href="#l113.646"></a><span id="l113.646"> {</span>
<a href="#l113.647"></a><span id="l113.647">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.648"></a><span id="l113.648"> </span>
<a href="#l113.649"></a><span id="l113.649">   // create a protocol instance to handle the request.</span>
<a href="#l113.650"></a><span id="l113.650">   // NOTE: once we start working with multiple connections, this step will be much more complicated...but for now</span>
<a href="#l113.651"></a><span id="l113.651">   // just create a connection and process the request.</span>
<a href="#l113.652"></a><span id="l113.652">   nsresult rv;</span>
<a href="#l113.653"></a><span id="l113.653">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.654"></a><span id="l113.654" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.655"></a><span id="l113.655" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.656"></a><span id="l113.656"> </span>
<a href="#l113.657"></a><span id="l113.657">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.658"></a><span id="l113.658">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aImapMailFolder, </span>
<a href="#l113.659"></a><span id="l113.659">     aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.660"></a><span id="l113.660">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.661"></a><span id="l113.661">   {</span>
<a href="#l113.662"></a><span id="l113.662">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgFetch);</span>
<a href="#l113.663"></a><span id="l113.663">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l113.664"></a><span id="l113.664" class="difflineat">@@ -1737,17 +1737,17 @@ nsresult nsImapService::DiddleFlags(nsIM</span>
<a href="#l113.665"></a><span id="l113.665"> {</span>
<a href="#l113.666"></a><span id="l113.666">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.667"></a><span id="l113.667"> </span>
<a href="#l113.668"></a><span id="l113.668">   // create a protocol instance to handle the request.</span>
<a href="#l113.669"></a><span id="l113.669">   // NOTE: once we start working with multiple connections, </span>
<a href="#l113.670"></a><span id="l113.670">   //       this step will be much more complicated...but for now</span>
<a href="#l113.671"></a><span id="l113.671">   // just create a connection and process the request.</span>
<a href="#l113.672"></a><span id="l113.672">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.673"></a><span id="l113.673" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.674"></a><span id="l113.674" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.675"></a><span id="l113.675"> </span>
<a href="#l113.676"></a><span id="l113.676">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.677"></a><span id="l113.677">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl),</span>
<a href="#l113.678"></a><span id="l113.678">                                      aImapMailFolder, aUrlListener, urlSpec, hierarchyDelimiter); </span>
<a href="#l113.679"></a><span id="l113.679">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.680"></a><span id="l113.680">   {</span>
<a href="#l113.681"></a><span id="l113.681">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgFetch);</span>
<a href="#l113.682"></a><span id="l113.682">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l113.683"></a><span id="l113.683" class="difflineat">@@ -1811,17 +1811,17 @@ nsresult nsImapService::SetImapUrlSink(n</span>
<a href="#l113.684"></a><span id="l113.684"> NS_IMETHODIMP nsImapService::DiscoverAllFolders(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l113.685"></a><span id="l113.685">                                                 nsIUrlListener *aUrlListener,</span>
<a href="#l113.686"></a><span id="l113.686">                                                 nsIMsgWindow *aMsgWindow,</span>
<a href="#l113.687"></a><span id="l113.687">                                                 nsIURI **aURL)</span>
<a href="#l113.688"></a><span id="l113.688"> {</span>
<a href="#l113.689"></a><span id="l113.689">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.690"></a><span id="l113.690"> </span>
<a href="#l113.691"></a><span id="l113.691">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.692"></a><span id="l113.692" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.693"></a><span id="l113.693" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.694"></a><span id="l113.694"> </span>
<a href="#l113.695"></a><span id="l113.695">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.696"></a><span id="l113.696">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aImapMailFolder, </span>
<a href="#l113.697"></a><span id="l113.697">                                      aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.698"></a><span id="l113.698">   if (NS_SUCCEEDED (rv))</span>
<a href="#l113.699"></a><span id="l113.699">   {</span>
<a href="#l113.700"></a><span id="l113.700">     rv = SetImapUrlSink(aImapMailFolder, imapUrl);</span>
<a href="#l113.701"></a><span id="l113.701"> </span>
<a href="#l113.702"></a><span id="l113.702" class="difflineat">@@ -1843,17 +1843,17 @@ NS_IMETHODIMP nsImapService::DiscoverAll</span>
<a href="#l113.703"></a><span id="l113.703"> </span>
<a href="#l113.704"></a><span id="l113.704"> NS_IMETHODIMP nsImapService::DiscoverAllAndSubscribedFolders(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l113.705"></a><span id="l113.705">                                                              nsIUrlListener *aUrlListener,</span>
<a href="#l113.706"></a><span id="l113.706">                                                              nsIURI **aURL)</span>
<a href="#l113.707"></a><span id="l113.707"> {</span>
<a href="#l113.708"></a><span id="l113.708">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.709"></a><span id="l113.709"> </span>
<a href="#l113.710"></a><span id="l113.710">   nsCOMPtr&lt;nsIImapUrl&gt; aImapUrl;</span>
<a href="#l113.711"></a><span id="l113.711" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.712"></a><span id="l113.712" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.713"></a><span id="l113.713"> </span>
<a href="#l113.714"></a><span id="l113.714">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.715"></a><span id="l113.715">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(aImapUrl), aImapMailFolder,</span>
<a href="#l113.716"></a><span id="l113.716">                                      aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.717"></a><span id="l113.717">   if (NS_SUCCEEDED(rv) &amp;&amp; aImapUrl)</span>
<a href="#l113.718"></a><span id="l113.718">   {</span>
<a href="#l113.719"></a><span id="l113.719">     rv = SetImapUrlSink(aImapMailFolder, aImapUrl);</span>
<a href="#l113.720"></a><span id="l113.720">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.721"></a><span id="l113.721" class="difflineat">@@ -1871,17 +1871,17 @@ NS_IMETHODIMP nsImapService::DiscoverAll</span>
<a href="#l113.722"></a><span id="l113.722"> NS_IMETHODIMP nsImapService::DiscoverChildren(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l113.723"></a><span id="l113.723">                                               nsIUrlListener *aUrlListener,</span>
<a href="#l113.724"></a><span id="l113.724">                                               const nsACString &amp;folderPath,</span>
<a href="#l113.725"></a><span id="l113.725">                                               nsIURI **aURL)</span>
<a href="#l113.726"></a><span id="l113.726"> {</span>
<a href="#l113.727"></a><span id="l113.727">   NS_ENSURE_ARG_POINTER(aImapMailFolder);</span>
<a href="#l113.728"></a><span id="l113.728"> </span>
<a href="#l113.729"></a><span id="l113.729">   nsCOMPtr&lt;nsIImapUrl&gt; aImapUrl;</span>
<a href="#l113.730"></a><span id="l113.730" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.731"></a><span id="l113.731" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.732"></a><span id="l113.732"> </span>
<a href="#l113.733"></a><span id="l113.733">   char hierarchyDelimiter = GetHierarchyDelimiter(aImapMailFolder);</span>
<a href="#l113.734"></a><span id="l113.734">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(aImapUrl), aImapMailFolder, </span>
<a href="#l113.735"></a><span id="l113.735">                                      aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.736"></a><span id="l113.736">   if (NS_SUCCEEDED (rv))</span>
<a href="#l113.737"></a><span id="l113.737">   {</span>
<a href="#l113.738"></a><span id="l113.738">     rv = SetImapUrlSink(aImapMailFolder, aImapUrl);</span>
<a href="#l113.739"></a><span id="l113.739">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.740"></a><span id="l113.740" class="difflineat">@@ -1942,17 +1942,17 @@ NS_IMETHODIMP nsImapService::OnlineMessa</span>
<a href="#l113.741"></a><span id="l113.741">   if (!sameServer) </span>
<a href="#l113.742"></a><span id="l113.742">   {</span>
<a href="#l113.743"></a><span id="l113.743">     NS_ASSERTION(false, &quot;can't use this method to copy across servers&quot;);</span>
<a href="#l113.744"></a><span id="l113.744">     // *** can only take message from the same imap host and user accnt</span>
<a href="#l113.745"></a><span id="l113.745">     return NS_ERROR_FAILURE;</span>
<a href="#l113.746"></a><span id="l113.746">   }</span>
<a href="#l113.747"></a><span id="l113.747"> </span>
<a href="#l113.748"></a><span id="l113.748">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.749"></a><span id="l113.749" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.750"></a><span id="l113.750" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.751"></a><span id="l113.751"> </span>
<a href="#l113.752"></a><span id="l113.752">   char hierarchyDelimiter = GetHierarchyDelimiter(aSrcFolder);</span>
<a href="#l113.753"></a><span id="l113.753">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aSrcFolder, aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.754"></a><span id="l113.754">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.755"></a><span id="l113.755">   {</span>
<a href="#l113.756"></a><span id="l113.756">     SetImapUrlSink(aSrcFolder, imapUrl);</span>
<a href="#l113.757"></a><span id="l113.757">     imapUrl-&gt;SetCopyState(copyState);</span>
<a href="#l113.758"></a><span id="l113.758"> </span>
<a href="#l113.759"></a><span id="l113.759" class="difflineat">@@ -2124,17 +2124,17 @@ NS_IMETHODIMP nsImapService::AppendMessa</span>
<a href="#l113.760"></a><span id="l113.760">                                                    nsISupports *aCopyState,</span>
<a href="#l113.761"></a><span id="l113.761">                                                    nsIMsgWindow *aMsgWindow)</span>
<a href="#l113.762"></a><span id="l113.762"> {</span>
<a href="#l113.763"></a><span id="l113.763">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l113.764"></a><span id="l113.764">   NS_ENSURE_ARG_POINTER(aDstFolder);</span>
<a href="#l113.765"></a><span id="l113.765"> </span>
<a href="#l113.766"></a><span id="l113.766">   nsresult rv;</span>
<a href="#l113.767"></a><span id="l113.767">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.768"></a><span id="l113.768" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.769"></a><span id="l113.769" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.770"></a><span id="l113.770"> </span>
<a href="#l113.771"></a><span id="l113.771">   char hierarchyDelimiter = GetHierarchyDelimiter(aDstFolder);</span>
<a href="#l113.772"></a><span id="l113.772">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aDstFolder, aListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.773"></a><span id="l113.773">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.774"></a><span id="l113.774">   {</span>
<a href="#l113.775"></a><span id="l113.775">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl = do_QueryInterface(imapUrl);</span>
<a href="#l113.776"></a><span id="l113.776">     if (msgUrl &amp;&amp; aMsgWindow)</span>
<a href="#l113.777"></a><span id="l113.777">     {</span>
<a href="#l113.778"></a><span id="l113.778" class="difflineat">@@ -2230,17 +2230,17 @@ NS_IMETHODIMP nsImapService::MoveFolder(</span>
<a href="#l113.779"></a><span id="l113.779">                                         nsIUrlListener *urlListener, </span>
<a href="#l113.780"></a><span id="l113.780">                                         nsIMsgWindow *msgWindow, </span>
<a href="#l113.781"></a><span id="l113.781">                                         nsIURI **url)</span>
<a href="#l113.782"></a><span id="l113.782"> {</span>
<a href="#l113.783"></a><span id="l113.783">   NS_ENSURE_ARG_POINTER(srcFolder);</span>
<a href="#l113.784"></a><span id="l113.784">   NS_ENSURE_ARG_POINTER(dstFolder);</span>
<a href="#l113.785"></a><span id="l113.785"> </span>
<a href="#l113.786"></a><span id="l113.786">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.787"></a><span id="l113.787" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.788"></a><span id="l113.788" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.789"></a><span id="l113.789">   nsresult rv;</span>
<a href="#l113.790"></a><span id="l113.790"> </span>
<a href="#l113.791"></a><span id="l113.791">   char default_hierarchyDelimiter = GetHierarchyDelimiter(dstFolder);</span>
<a href="#l113.792"></a><span id="l113.792">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), dstFolder, </span>
<a href="#l113.793"></a><span id="l113.793">                             urlListener, urlSpec, default_hierarchyDelimiter);</span>
<a href="#l113.794"></a><span id="l113.794">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.795"></a><span id="l113.795">   {</span>
<a href="#l113.796"></a><span id="l113.796">     rv = SetImapUrlSink(dstFolder, imapUrl);</span>
<a href="#l113.797"></a><span id="l113.797" class="difflineat">@@ -2279,17 +2279,17 @@ NS_IMETHODIMP nsImapService::RenameLeaf(</span>
<a href="#l113.798"></a><span id="l113.798">                                         const nsAString &amp;newLeafName, </span>
<a href="#l113.799"></a><span id="l113.799">                                         nsIUrlListener *urlListener,</span>
<a href="#l113.800"></a><span id="l113.800">                                         nsIMsgWindow *msgWindow, </span>
<a href="#l113.801"></a><span id="l113.801">                                         nsIURI **url)</span>
<a href="#l113.802"></a><span id="l113.802"> {</span>
<a href="#l113.803"></a><span id="l113.803">   NS_ENSURE_ARG_POINTER(srcFolder);</span>
<a href="#l113.804"></a><span id="l113.804"> </span>
<a href="#l113.805"></a><span id="l113.805">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.806"></a><span id="l113.806" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.807"></a><span id="l113.807" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.808"></a><span id="l113.808"> </span>
<a href="#l113.809"></a><span id="l113.809">   char hierarchyDelimiter = GetHierarchyDelimiter(srcFolder);</span>
<a href="#l113.810"></a><span id="l113.810">   nsresult rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), srcFolder, </span>
<a href="#l113.811"></a><span id="l113.811">                             urlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.812"></a><span id="l113.812">   if (NS_SUCCEEDED(rv))</span>
<a href="#l113.813"></a><span id="l113.813">   {</span>
<a href="#l113.814"></a><span id="l113.814">     rv = SetImapUrlSink(srcFolder, imapUrl);</span>
<a href="#l113.815"></a><span id="l113.815">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.816"></a><span id="l113.816" class="difflineat">@@ -2300,27 +2300,27 @@ NS_IMETHODIMP nsImapService::RenameLeaf(</span>
<a href="#l113.817"></a><span id="l113.817">         mailNewsUrl-&gt;SetMsgWindow(msgWindow);</span>
<a href="#l113.818"></a><span id="l113.818">       nsCString folderName;</span>
<a href="#l113.819"></a><span id="l113.819">       GetFolderName(srcFolder, folderName);</span>
<a href="#l113.820"></a><span id="l113.820">       urlSpec.Append(&quot;/rename&gt;&quot;);</span>
<a href="#l113.821"></a><span id="l113.821">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.822"></a><span id="l113.822">       urlSpec.Append(folderName);</span>
<a href="#l113.823"></a><span id="l113.823">       urlSpec.Append('&gt;');</span>
<a href="#l113.824"></a><span id="l113.824">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.825"></a><span id="l113.825" class="difflineminus">-      nsCAutoString cStrFolderName;</span>
<a href="#l113.826"></a><span id="l113.826" class="difflineplus">+      nsAutoCString cStrFolderName;</span>
<a href="#l113.827"></a><span id="l113.827">       // Unescape the name before looking for parent path</span>
<a href="#l113.828"></a><span id="l113.828">       MsgUnescapeString(folderName, 0, cStrFolderName);</span>
<a href="#l113.829"></a><span id="l113.829">       int32_t leafNameStart = cStrFolderName.RFindChar(hierarchyDelimiter);</span>
<a href="#l113.830"></a><span id="l113.830">       if (leafNameStart != -1)</span>
<a href="#l113.831"></a><span id="l113.831">       {</span>
<a href="#l113.832"></a><span id="l113.832">         cStrFolderName.SetLength(leafNameStart+1);</span>
<a href="#l113.833"></a><span id="l113.833">         urlSpec.Append(cStrFolderName);</span>
<a href="#l113.834"></a><span id="l113.834">       }</span>
<a href="#l113.835"></a><span id="l113.835"> </span>
<a href="#l113.836"></a><span id="l113.836" class="difflineminus">-      nsCAutoString utfNewName;</span>
<a href="#l113.837"></a><span id="l113.837" class="difflineplus">+      nsAutoCString utfNewName;</span>
<a href="#l113.838"></a><span id="l113.838">       CopyUTF16toMUTF7(PromiseFlatString(newLeafName), utfNewName);</span>
<a href="#l113.839"></a><span id="l113.839">       nsCString escapedNewName;</span>
<a href="#l113.840"></a><span id="l113.840">       MsgEscapeString(utfNewName, nsINetUtil::ESCAPE_URL_PATH, escapedNewName);</span>
<a href="#l113.841"></a><span id="l113.841">       nsCString escapedSlashName;</span>
<a href="#l113.842"></a><span id="l113.842">       rv = nsImapUrl::EscapeSlashes(escapedNewName.get(), getter_Copies(escapedSlashName));</span>
<a href="#l113.843"></a><span id="l113.843">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.844"></a><span id="l113.844">       urlSpec.Append(escapedSlashName);</span>
<a href="#l113.845"></a><span id="l113.845"> </span>
<a href="#l113.846"></a><span id="l113.846" class="difflineat">@@ -2335,17 +2335,17 @@ NS_IMETHODIMP nsImapService::RenameLeaf(</span>
<a href="#l113.847"></a><span id="l113.847"> NS_IMETHODIMP nsImapService::CreateFolder(nsIMsgFolder *parent,</span>
<a href="#l113.848"></a><span id="l113.848">                                           const nsAString &amp;newFolderName,</span>
<a href="#l113.849"></a><span id="l113.849">                                           nsIUrlListener *urlListener,</span>
<a href="#l113.850"></a><span id="l113.850">                                           nsIURI **url)</span>
<a href="#l113.851"></a><span id="l113.851"> {</span>
<a href="#l113.852"></a><span id="l113.852">   NS_ENSURE_ARG_POINTER(parent);</span>
<a href="#l113.853"></a><span id="l113.853"> </span>
<a href="#l113.854"></a><span id="l113.854">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.855"></a><span id="l113.855" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.856"></a><span id="l113.856" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.857"></a><span id="l113.857">   nsresult rv;</span>
<a href="#l113.858"></a><span id="l113.858"> </span>
<a href="#l113.859"></a><span id="l113.859">   char hierarchyDelimiter = GetHierarchyDelimiter(parent);</span>
<a href="#l113.860"></a><span id="l113.860">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), parent, </span>
<a href="#l113.861"></a><span id="l113.861">                             urlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.862"></a><span id="l113.862">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.863"></a><span id="l113.863">   {</span>
<a href="#l113.864"></a><span id="l113.864">     rv = SetImapUrlSink(parent, imapUrl);</span>
<a href="#l113.865"></a><span id="l113.865" class="difflineat">@@ -2362,17 +2362,17 @@ NS_IMETHODIMP nsImapService::CreateFolde</span>
<a href="#l113.866"></a><span id="l113.866">         nsCString canonicalName;</span>
<a href="#l113.867"></a><span id="l113.867">         nsImapUrl::ConvertToCanonicalFormat(folderName.get(),</span>
<a href="#l113.868"></a><span id="l113.868">                                             hierarchyDelimiter,</span>
<a href="#l113.869"></a><span id="l113.869">                                             getter_Copies(canonicalName));</span>
<a href="#l113.870"></a><span id="l113.870">         urlSpec.Append(canonicalName);</span>
<a href="#l113.871"></a><span id="l113.871">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.872"></a><span id="l113.872">       }</span>
<a href="#l113.873"></a><span id="l113.873"> </span>
<a href="#l113.874"></a><span id="l113.874" class="difflineminus">-      nsCAutoString utfNewName;</span>
<a href="#l113.875"></a><span id="l113.875" class="difflineplus">+      nsAutoCString utfNewName;</span>
<a href="#l113.876"></a><span id="l113.876">       rv = CopyUTF16toMUTF7(PromiseFlatString(newFolderName), utfNewName);</span>
<a href="#l113.877"></a><span id="l113.877">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.878"></a><span id="l113.878">       nsCString escapedFolderName;</span>
<a href="#l113.879"></a><span id="l113.879">       MsgEscapeString(utfNewName, nsINetUtil::ESCAPE_URL_PATH, escapedFolderName);</span>
<a href="#l113.880"></a><span id="l113.880">       urlSpec.Append(escapedFolderName);</span>
<a href="#l113.881"></a><span id="l113.881"> </span>
<a href="#l113.882"></a><span id="l113.882">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l113.883"></a><span id="l113.883">       if (NS_SUCCEEDED(rv))</span>
<a href="#l113.884"></a><span id="l113.884" class="difflineat">@@ -2385,17 +2385,17 @@ NS_IMETHODIMP nsImapService::CreateFolde</span>
<a href="#l113.885"></a><span id="l113.885"> NS_IMETHODIMP nsImapService::EnsureFolderExists(nsIMsgFolder *parent,</span>
<a href="#l113.886"></a><span id="l113.886">                                                 const nsAString &amp;newFolderName, </span>
<a href="#l113.887"></a><span id="l113.887">                                                 nsIUrlListener *urlListener, </span>
<a href="#l113.888"></a><span id="l113.888">                                                 nsIURI **url)</span>
<a href="#l113.889"></a><span id="l113.889"> {</span>
<a href="#l113.890"></a><span id="l113.890">   NS_ENSURE_ARG_POINTER(parent);</span>
<a href="#l113.891"></a><span id="l113.891"> </span>
<a href="#l113.892"></a><span id="l113.892">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.893"></a><span id="l113.893" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.894"></a><span id="l113.894" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.895"></a><span id="l113.895">   nsresult rv;</span>
<a href="#l113.896"></a><span id="l113.896"> </span>
<a href="#l113.897"></a><span id="l113.897">   char hierarchyDelimiter = GetHierarchyDelimiter(parent);</span>
<a href="#l113.898"></a><span id="l113.898">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), parent, urlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.899"></a><span id="l113.899">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.900"></a><span id="l113.900">   {</span>
<a href="#l113.901"></a><span id="l113.901">     rv = SetImapUrlSink(parent, imapUrl);</span>
<a href="#l113.902"></a><span id="l113.902">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.903"></a><span id="l113.903" class="difflineat">@@ -2406,17 +2406,17 @@ NS_IMETHODIMP nsImapService::EnsureFolde</span>
<a href="#l113.904"></a><span id="l113.904">       GetFolderName(parent, folderName);</span>
<a href="#l113.905"></a><span id="l113.905">       urlSpec.Append(&quot;/ensureExists&gt;&quot;);</span>
<a href="#l113.906"></a><span id="l113.906">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.907"></a><span id="l113.907">       if (!folderName.IsEmpty())</span>
<a href="#l113.908"></a><span id="l113.908">       {</span>
<a href="#l113.909"></a><span id="l113.909">         urlSpec.Append(folderName);</span>
<a href="#l113.910"></a><span id="l113.910">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.911"></a><span id="l113.911">       }</span>
<a href="#l113.912"></a><span id="l113.912" class="difflineminus">-      nsCAutoString utfNewName; </span>
<a href="#l113.913"></a><span id="l113.913" class="difflineplus">+      nsAutoCString utfNewName; </span>
<a href="#l113.914"></a><span id="l113.914">       CopyUTF16toMUTF7(PromiseFlatString(newFolderName), utfNewName);</span>
<a href="#l113.915"></a><span id="l113.915">       nsCString escapedFolderName;</span>
<a href="#l113.916"></a><span id="l113.916">       MsgEscapeString(utfNewName, nsINetUtil::ESCAPE_URL_PATH, escapedFolderName);</span>
<a href="#l113.917"></a><span id="l113.917">       urlSpec.Append(escapedFolderName);</span>
<a href="#l113.918"></a><span id="l113.918"> </span>
<a href="#l113.919"></a><span id="l113.919">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l113.920"></a><span id="l113.920">       if (NS_SUCCEEDED(rv))</span>
<a href="#l113.921"></a><span id="l113.921">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l113.922"></a><span id="l113.922" class="difflineat">@@ -2489,18 +2489,18 @@ NS_IMETHODIMP nsImapService::GetDefaultS</span>
<a href="#l113.923"></a><span id="l113.923"> </span>
<a href="#l113.924"></a><span id="l113.924"> // this method first tries to find an exact username and hostname match with the given url</span>
<a href="#l113.925"></a><span id="l113.925"> // then, tries to find any account on the passed in imap host in case this is a url to </span>
<a href="#l113.926"></a><span id="l113.926"> // a shared imap folder.</span>
<a href="#l113.927"></a><span id="l113.927"> nsresult nsImapService::GetServerFromUrl(nsIImapUrl *aImapUrl, nsIMsgIncomingServer **aServer)</span>
<a href="#l113.928"></a><span id="l113.928"> {</span>
<a href="#l113.929"></a><span id="l113.929">   nsresult rv;</span>
<a href="#l113.930"></a><span id="l113.930">   nsCString folderName;</span>
<a href="#l113.931"></a><span id="l113.931" class="difflineminus">-  nsCAutoString userPass;</span>
<a href="#l113.932"></a><span id="l113.932" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l113.933"></a><span id="l113.933" class="difflineplus">+  nsAutoCString userPass;</span>
<a href="#l113.934"></a><span id="l113.934" class="difflineplus">+  nsAutoCString hostName;</span>
<a href="#l113.935"></a><span id="l113.935">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(aImapUrl);</span>
<a href="#l113.936"></a><span id="l113.936">   </span>
<a href="#l113.937"></a><span id="l113.937">   // if we can't get a folder name out of the url then I think this is an error</span>
<a href="#l113.938"></a><span id="l113.938">   aImapUrl-&gt;CreateCanonicalSourceFolderPathString(getter_Copies(folderName));</span>
<a href="#l113.939"></a><span id="l113.939">   if (folderName.IsEmpty())</span>
<a href="#l113.940"></a><span id="l113.940">   {</span>
<a href="#l113.941"></a><span id="l113.941">     rv = mailnewsUrl-&gt;GetFileName(folderName);</span>
<a href="#l113.942"></a><span id="l113.942">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.943"></a><span id="l113.943" class="difflineat">@@ -2511,17 +2511,17 @@ nsresult nsImapService::GetServerFromUrl</span>
<a href="#l113.944"></a><span id="l113.944">   </span>
<a href="#l113.945"></a><span id="l113.945">   rv = accountManager-&gt;FindServerByURI(mailnewsUrl, false, aServer);</span>
<a href="#l113.946"></a><span id="l113.946">   </span>
<a href="#l113.947"></a><span id="l113.947">   // look for server with any user name, in case we're trying to subscribe</span>
<a href="#l113.948"></a><span id="l113.948">   // to a folder with some one else's user name like the following</span>
<a href="#l113.949"></a><span id="l113.949">   // &quot;IMAP://userSharingFolder@server1/SharedFolderName&quot;</span>
<a href="#l113.950"></a><span id="l113.950">   if (NS_FAILED(rv) || !aServer)</span>
<a href="#l113.951"></a><span id="l113.951">   {</span>
<a href="#l113.952"></a><span id="l113.952" class="difflineminus">-    nsCAutoString turl;</span>
<a href="#l113.953"></a><span id="l113.953" class="difflineplus">+    nsAutoCString turl;</span>
<a href="#l113.954"></a><span id="l113.954">     nsCOMPtr&lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l113.955"></a><span id="l113.955">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.956"></a><span id="l113.956">     </span>
<a href="#l113.957"></a><span id="l113.957">     mailnewsUrl-&gt;GetSpec(turl);</span>
<a href="#l113.958"></a><span id="l113.958">     rv = url-&gt;SetSpec(turl);</span>
<a href="#l113.959"></a><span id="l113.959">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.960"></a><span id="l113.960">     </span>
<a href="#l113.961"></a><span id="l113.961">     url-&gt;SetUserPass(EmptyCString());</span>
<a href="#l113.962"></a><span id="l113.962" class="difflineat">@@ -2543,23 +2543,23 @@ NS_IMETHODIMP nsImapService::NewURI(cons</span>
<a href="#l113.963"></a><span id="l113.963">   NS_ENSURE_ARG_POINTER(aRetVal);</span>
<a href="#l113.964"></a><span id="l113.964"> </span>
<a href="#l113.965"></a><span id="l113.965">   nsresult rv;</span>
<a href="#l113.966"></a><span id="l113.966">   nsCOMPtr&lt;nsIImapUrl&gt; aImapUrl = do_CreateInstance(kImapUrlCID, &amp;rv);</span>
<a href="#l113.967"></a><span id="l113.967">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.968"></a><span id="l113.968"> </span>
<a href="#l113.969"></a><span id="l113.969">   // now extract lots of fun information...</span>
<a href="#l113.970"></a><span id="l113.970">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(aImapUrl);</span>
<a href="#l113.971"></a><span id="l113.971" class="difflineminus">-  // nsCAutoString unescapedSpec(aSpec);</span>
<a href="#l113.972"></a><span id="l113.972" class="difflineplus">+  // nsAutoCString unescapedSpec(aSpec);</span>
<a href="#l113.973"></a><span id="l113.973">   // nsUnescape(unescapedSpec.BeginWriting());</span>
<a href="#l113.974"></a><span id="l113.974"> </span>
<a href="#l113.975"></a><span id="l113.975">   // set the spec</span>
<a href="#l113.976"></a><span id="l113.976">   if (aBaseURI)</span>
<a href="#l113.977"></a><span id="l113.977">   {</span>
<a href="#l113.978"></a><span id="l113.978" class="difflineminus">-    nsCAutoString newSpec;</span>
<a href="#l113.979"></a><span id="l113.979" class="difflineplus">+    nsAutoCString newSpec;</span>
<a href="#l113.980"></a><span id="l113.980">     aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l113.981"></a><span id="l113.981">     rv = mailnewsUrl-&gt;SetSpec(newSpec);</span>
<a href="#l113.982"></a><span id="l113.982">   }</span>
<a href="#l113.983"></a><span id="l113.983">   else</span>
<a href="#l113.984"></a><span id="l113.984">   {</span>
<a href="#l113.985"></a><span id="l113.985">     rv = mailnewsUrl-&gt;SetSpec(aSpec);</span>
<a href="#l113.986"></a><span id="l113.986">   }</span>
<a href="#l113.987"></a><span id="l113.987"> </span>
<a href="#l113.988"></a><span id="l113.988" class="difflineat">@@ -2695,17 +2695,17 @@ NS_IMETHODIMP nsImapService::NewChannel(</span>
<a href="#l113.989"></a><span id="l113.989">     {</span>
<a href="#l113.990"></a><span id="l113.990">       imapRoot-&gt;FindOnlineSubFolder(folderName, getter_AddRefs(subFolder));</span>
<a href="#l113.991"></a><span id="l113.991">       aFolder = do_QueryInterface(subFolder);</span>
<a href="#l113.992"></a><span id="l113.992">     }</span>
<a href="#l113.993"></a><span id="l113.993">     nsCOMPtr &lt;nsIMsgFolder&gt; parent;</span>
<a href="#l113.994"></a><span id="l113.994">     if (aFolder)</span>
<a href="#l113.995"></a><span id="l113.995">       aFolder-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l113.996"></a><span id="l113.996">     nsCString serverKey;</span>
<a href="#l113.997"></a><span id="l113.997" class="difflineminus">-    nsCAutoString userPass;</span>
<a href="#l113.998"></a><span id="l113.998" class="difflineplus">+    nsAutoCString userPass;</span>
<a href="#l113.999"></a><span id="l113.999">     rv = mailnewsUrl-&gt;GetUserPass(userPass);</span>
<a href="#l113.1000"></a><span id="l113.1000">     server-&gt;GetKey(serverKey);</span>
<a href="#l113.1001"></a><span id="l113.1001">     nsCString fullFolderName;</span>
<a href="#l113.1002"></a><span id="l113.1002">     if (parent)</span>
<a href="#l113.1003"></a><span id="l113.1003">       fullFolderName = folderName;</span>
<a href="#l113.1004"></a><span id="l113.1004">     if (!parent &amp;&amp; !folderName.IsEmpty())  // check if this folder is another user's folder</span>
<a href="#l113.1005"></a><span id="l113.1005">     {</span>
<a href="#l113.1006"></a><span id="l113.1006">       fullFolderName = nsIMAPNamespaceList::GenerateFullFolderNameWithDefaultNamespace(serverKey.get(), </span>
<a href="#l113.1007"></a><span id="l113.1007" class="difflineat">@@ -2961,18 +2961,18 @@ NS_IMETHODIMP nsImapService::GetListOfFo</span>
<a href="#l113.1008"></a><span id="l113.1008"> </span>
<a href="#l113.1009"></a><span id="l113.1009">   // Locate the folder so that the correct hierarchical delimiter is used in the folder</span>
<a href="#l113.1010"></a><span id="l113.1010">   // pathnames, otherwise root's (ie, '^') is used and this is wrong.</span>
<a href="#l113.1011"></a><span id="l113.1011">   nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l113.1012"></a><span id="l113.1012">   if (rootMsgFolder &amp;&amp; !folderPath.IsEmpty())</span>
<a href="#l113.1013"></a><span id="l113.1013">   {</span>
<a href="#l113.1014"></a><span id="l113.1014">     // If the folder path contains 'INBOX' of any forms, we need to convert it to uppercase</span>
<a href="#l113.1015"></a><span id="l113.1015">     // before finding it under the root folder. We do the same in PossibleImapMailbox().</span>
<a href="#l113.1016"></a><span id="l113.1016" class="difflineminus">-    nsCAutoString tempFolderName(folderPath);</span>
<a href="#l113.1017"></a><span id="l113.1017" class="difflineminus">-    nsCAutoString tokenStr, remStr, changedStr;</span>
<a href="#l113.1018"></a><span id="l113.1018" class="difflineplus">+    nsAutoCString tempFolderName(folderPath);</span>
<a href="#l113.1019"></a><span id="l113.1019" class="difflineplus">+    nsAutoCString tokenStr, remStr, changedStr;</span>
<a href="#l113.1020"></a><span id="l113.1020">     int32_t slashPos = tempFolderName.FindChar('/');</span>
<a href="#l113.1021"></a><span id="l113.1021">     if (slashPos &gt; 0)</span>
<a href="#l113.1022"></a><span id="l113.1022">     {</span>
<a href="#l113.1023"></a><span id="l113.1023">       tokenStr = StringHead(tempFolderName, slashPos);</span>
<a href="#l113.1024"></a><span id="l113.1024">       remStr = Substring(tempFolderName, slashPos);</span>
<a href="#l113.1025"></a><span id="l113.1025">     }</span>
<a href="#l113.1026"></a><span id="l113.1026">     else</span>
<a href="#l113.1027"></a><span id="l113.1027">       tokenStr.Assign(tempFolderName);</span>
<a href="#l113.1028"></a><span id="l113.1028" class="difflineat">@@ -3027,30 +3027,30 @@ nsresult nsImapService::ChangeFolderSubs</span>
<a href="#l113.1029"></a><span id="l113.1029">                                                  const nsAString &amp;folderName, </span>
<a href="#l113.1030"></a><span id="l113.1030">                                                  const char *command,</span>
<a href="#l113.1031"></a><span id="l113.1031">                                                  nsIUrlListener *urlListener, </span>
<a href="#l113.1032"></a><span id="l113.1032">                                                  nsIURI **url)</span>
<a href="#l113.1033"></a><span id="l113.1033"> {</span>
<a href="#l113.1034"></a><span id="l113.1034">   NS_ENSURE_ARG_POINTER(folder);</span>
<a href="#l113.1035"></a><span id="l113.1035"> </span>
<a href="#l113.1036"></a><span id="l113.1036">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.1037"></a><span id="l113.1037" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.1038"></a><span id="l113.1038" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.1039"></a><span id="l113.1039">   nsresult rv;</span>
<a href="#l113.1040"></a><span id="l113.1040">   char hierarchyDelimiter = GetHierarchyDelimiter(folder);</span>
<a href="#l113.1041"></a><span id="l113.1041">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), folder, urlListener,</span>
<a href="#l113.1042"></a><span id="l113.1042">                             urlSpec, hierarchyDelimiter);</span>
<a href="#l113.1043"></a><span id="l113.1043">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.1044"></a><span id="l113.1044">   {</span>
<a href="#l113.1045"></a><span id="l113.1045">     rv = SetImapUrlSink(folder, imapUrl);</span>
<a href="#l113.1046"></a><span id="l113.1046">     if (NS_SUCCEEDED(rv))</span>
<a href="#l113.1047"></a><span id="l113.1047">     {</span>
<a href="#l113.1048"></a><span id="l113.1048">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l113.1049"></a><span id="l113.1049">       urlSpec.Append(command);</span>
<a href="#l113.1050"></a><span id="l113.1050">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l113.1051"></a><span id="l113.1051" class="difflineminus">-      nsCAutoString utfFolderName;</span>
<a href="#l113.1052"></a><span id="l113.1052" class="difflineplus">+      nsAutoCString utfFolderName;</span>
<a href="#l113.1053"></a><span id="l113.1053">       rv = CopyUTF16toMUTF7(PromiseFlatString(folderName), utfFolderName);</span>
<a href="#l113.1054"></a><span id="l113.1054">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.1055"></a><span id="l113.1055">       nsCString escapedFolderName;</span>
<a href="#l113.1056"></a><span id="l113.1056">       MsgEscapeString(utfFolderName, nsINetUtil::ESCAPE_URL_PATH, escapedFolderName);</span>
<a href="#l113.1057"></a><span id="l113.1057">       urlSpec.Append(escapedFolderName);</span>
<a href="#l113.1058"></a><span id="l113.1058">       rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l113.1059"></a><span id="l113.1059">       if (NS_SUCCEEDED(rv))</span>
<a href="#l113.1060"></a><span id="l113.1060">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l113.1061"></a><span id="l113.1061" class="difflineat">@@ -3085,17 +3085,17 @@ NS_IMETHODIMP nsImapService::IssueComman</span>
<a href="#l113.1062"></a><span id="l113.1062">                                                 const nsACString &amp;aCommand,</span>
<a href="#l113.1063"></a><span id="l113.1063">                                                 const nsACString &amp;uids,</span>
<a href="#l113.1064"></a><span id="l113.1064">                                                 nsIURI **aURL)</span>
<a href="#l113.1065"></a><span id="l113.1065"> {</span>
<a href="#l113.1066"></a><span id="l113.1066">   NS_ENSURE_ARG_POINTER(anImapFolder);</span>
<a href="#l113.1067"></a><span id="l113.1067">   NS_ENSURE_ARG_POINTER(aMsgWindow);</span>
<a href="#l113.1068"></a><span id="l113.1068"> </span>
<a href="#l113.1069"></a><span id="l113.1069">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.1070"></a><span id="l113.1070" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.1071"></a><span id="l113.1071" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.1072"></a><span id="l113.1072">   nsresult rv;</span>
<a href="#l113.1073"></a><span id="l113.1073">   char hierarchyDelimiter = GetHierarchyDelimiter(anImapFolder);</span>
<a href="#l113.1074"></a><span id="l113.1074">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), anImapFolder, nullptr, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.1075"></a><span id="l113.1075"> </span>
<a href="#l113.1076"></a><span id="l113.1076">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.1077"></a><span id="l113.1077">   {</span>
<a href="#l113.1078"></a><span id="l113.1078">     // nsImapUrl::SetSpec() will set the imap action properly</span>
<a href="#l113.1079"></a><span id="l113.1079">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapUserDefinedMsgCommand);</span>
<a href="#l113.1080"></a><span id="l113.1080" class="difflineat">@@ -3132,17 +3132,17 @@ NS_IMETHODIMP nsImapService::FetchCustom</span>
<a href="#l113.1081"></a><span id="l113.1081">                                                      const nsACString &amp;aAttribute,</span>
<a href="#l113.1082"></a><span id="l113.1082">                                                      const nsACString &amp;uids,</span>
<a href="#l113.1083"></a><span id="l113.1083">                                                      nsIURI **aURL)</span>
<a href="#l113.1084"></a><span id="l113.1084"> {</span>
<a href="#l113.1085"></a><span id="l113.1085">   NS_ENSURE_ARG_POINTER(anImapFolder);</span>
<a href="#l113.1086"></a><span id="l113.1086">   NS_ENSURE_ARG_POINTER(aMsgWindow);</span>
<a href="#l113.1087"></a><span id="l113.1087"> </span>
<a href="#l113.1088"></a><span id="l113.1088">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.1089"></a><span id="l113.1089" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.1090"></a><span id="l113.1090" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.1091"></a><span id="l113.1091">   nsresult rv;</span>
<a href="#l113.1092"></a><span id="l113.1092">   char hierarchyDelimiter = GetHierarchyDelimiter(anImapFolder);</span>
<a href="#l113.1093"></a><span id="l113.1093">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), anImapFolder, </span>
<a href="#l113.1094"></a><span id="l113.1094">                             nullptr, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.1095"></a><span id="l113.1095">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.1096"></a><span id="l113.1096">   {</span>
<a href="#l113.1097"></a><span id="l113.1097">     // nsImapUrl::SetSpec() will set the imap action properly</span>
<a href="#l113.1098"></a><span id="l113.1098">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapUserDefinedFetchAttribute);</span>
<a href="#l113.1099"></a><span id="l113.1099" class="difflineat">@@ -3177,17 +3177,17 @@ NS_IMETHODIMP nsImapService::StoreCustom</span>
<a href="#l113.1100"></a><span id="l113.1100">                                                  const nsACString &amp;flagsToAdd,</span>
<a href="#l113.1101"></a><span id="l113.1101">                                                  const nsACString &amp;flagsToSubtract,</span>
<a href="#l113.1102"></a><span id="l113.1102">                                                  const nsACString &amp;uids,</span>
<a href="#l113.1103"></a><span id="l113.1103">                                                  nsIURI **aURL)</span>
<a href="#l113.1104"></a><span id="l113.1104"> {</span>
<a href="#l113.1105"></a><span id="l113.1105">   NS_ENSURE_ARG_POINTER(anImapFolder);</span>
<a href="#l113.1106"></a><span id="l113.1106"> </span>
<a href="#l113.1107"></a><span id="l113.1107">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.1108"></a><span id="l113.1108" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.1109"></a><span id="l113.1109" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.1110"></a><span id="l113.1110">   nsresult rv;</span>
<a href="#l113.1111"></a><span id="l113.1111">   char hierarchyDelimiter = GetHierarchyDelimiter(anImapFolder);</span>
<a href="#l113.1112"></a><span id="l113.1112">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), anImapFolder, nullptr, urlSpec, hierarchyDelimiter);</span>
<a href="#l113.1113"></a><span id="l113.1113"> </span>
<a href="#l113.1114"></a><span id="l113.1114">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.1115"></a><span id="l113.1115">   {</span>
<a href="#l113.1116"></a><span id="l113.1116">     // nsImapUrl::SetSpec() will set the imap action properly</span>
<a href="#l113.1117"></a><span id="l113.1117">     rv = imapUrl-&gt;SetImapAction(nsIImapUrl::nsImapMsgStoreCustomKeywords);</span>
<a href="#l113.1118"></a><span id="l113.1118" class="difflineat">@@ -3223,17 +3223,17 @@ NS_IMETHODIMP nsImapService::StoreCustom</span>
<a href="#l113.1119"></a><span id="l113.1119"> NS_IMETHODIMP nsImapService::DownloadMessagesForOffline(const nsACString &amp;messageIds, </span>
<a href="#l113.1120"></a><span id="l113.1120">                                                         nsIMsgFolder *aFolder, </span>
<a href="#l113.1121"></a><span id="l113.1121">                                                         nsIUrlListener *aUrlListener, </span>
<a href="#l113.1122"></a><span id="l113.1122">                                                         nsIMsgWindow *aMsgWindow)</span>
<a href="#l113.1123"></a><span id="l113.1123"> {</span>
<a href="#l113.1124"></a><span id="l113.1124">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l113.1125"></a><span id="l113.1125"> </span>
<a href="#l113.1126"></a><span id="l113.1126">   nsCOMPtr&lt;nsIImapUrl&gt; imapUrl;</span>
<a href="#l113.1127"></a><span id="l113.1127" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l113.1128"></a><span id="l113.1128" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l113.1129"></a><span id="l113.1129">   nsresult rv;</span>
<a href="#l113.1130"></a><span id="l113.1130">   char hierarchyDelimiter = GetHierarchyDelimiter(aFolder);</span>
<a href="#l113.1131"></a><span id="l113.1131">   rv = CreateStartOfImapUrl(EmptyCString(), getter_AddRefs(imapUrl), aFolder, nullptr,</span>
<a href="#l113.1132"></a><span id="l113.1132">                             urlSpec, hierarchyDelimiter);</span>
<a href="#l113.1133"></a><span id="l113.1133">   if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l113.1134"></a><span id="l113.1134">   {</span>
<a href="#l113.1135"></a><span id="l113.1135">     nsCOMPtr&lt;nsIURI&gt; runningURI;</span>
<a href="#l113.1136"></a><span id="l113.1136">     // need to pass in stream listener in order to get the channel created correctly</span>
<a href="#l113.1137"></a><span id="l113.1137" class="difflineat">@@ -3337,17 +3337,17 @@ NS_IMETHODIMP nsImapService::HandleConte</span>
<a href="#l113.1138"></a><span id="l113.1138">     rv = aChannel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l113.1139"></a><span id="l113.1139">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.1140"></a><span id="l113.1140"> </span>
<a href="#l113.1141"></a><span id="l113.1141">     if (uri)</span>
<a href="#l113.1142"></a><span id="l113.1142">     {</span>
<a href="#l113.1143"></a><span id="l113.1143">       request-&gt;Cancel(NS_BINDING_ABORTED);</span>
<a href="#l113.1144"></a><span id="l113.1144">       nsCOMPtr&lt;nsIWindowMediator&gt; mediator(do_GetService(NS_WINDOWMEDIATOR_CONTRACTID, &amp;rv));</span>
<a href="#l113.1145"></a><span id="l113.1145">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l113.1146"></a><span id="l113.1146" class="difflineminus">-      nsCAutoString uriStr;</span>
<a href="#l113.1147"></a><span id="l113.1147" class="difflineplus">+      nsAutoCString uriStr;</span>
<a href="#l113.1148"></a><span id="l113.1148"> </span>
<a href="#l113.1149"></a><span id="l113.1149">       uri-&gt;GetSpec(uriStr);</span>
<a href="#l113.1150"></a><span id="l113.1150"> </span>
<a href="#l113.1151"></a><span id="l113.1151">       // imap uri's are unescaped, so unescape the url.</span>
<a href="#l113.1152"></a><span id="l113.1152">       nsCString unescapedUriStr;</span>
<a href="#l113.1153"></a><span id="l113.1153">       MsgUnescapeString(uriStr, 0, unescapedUriStr);</span>
<a href="#l113.1154"></a><span id="l113.1154">       nsCOMPtr &lt;nsIMessengerWindowService&gt; messengerWindowService = do_GetService(NS_MESSENGERWINDOWSERVICE_CONTRACTID,&amp;rv);</span>
<a href="#l113.1155"></a><span id="l113.1155">       NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -465,17 +465,17 @@ NS_IMETHODIMP nsImapMoveCopyMsgTxn::OnSt</span>
<a href="#l114.4"></a><span id="l114.4">         {</span>
<a href="#l114.5"></a><span id="l114.5">           nsMsgKey dstKey;</span>
<a href="#l114.6"></a><span id="l114.6">           dstHdr-&gt;GetMessageKey(&amp;dstKey);</span>
<a href="#l114.7"></a><span id="l114.7">           dstKeys.AppendElement(dstKey);</span>
<a href="#l114.8"></a><span id="l114.8">         }</span>
<a href="#l114.9"></a><span id="l114.9">       }</span>
<a href="#l114.10"></a><span id="l114.10">       if (dstKeys.Length())</span>
<a href="#l114.11"></a><span id="l114.11">       {</span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">-        nsCAutoString uids;</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineplus">+        nsAutoCString uids;</span>
<a href="#l114.14"></a><span id="l114.14">         nsImapMailFolder::AllocateUidStringFromKeys(dstKeys.Elements(), dstKeys.Length(), uids);</span>
<a href="#l114.15"></a><span id="l114.15">         rv = imapService-&gt;OnlineMessageCopy(dstFolder, uids, srcFolder,</span>
<a href="#l114.16"></a><span id="l114.16">                                             true, true, nullptr,</span>
<a href="#l114.17"></a><span id="l114.17">                                             nullptr, nullptr, nullptr);</span>
<a href="#l114.18"></a><span id="l114.18">       }</span>
<a href="#l114.19"></a><span id="l114.19">     }</span>
<a href="#l114.20"></a><span id="l114.20">   }</span>
<a href="#l114.21"></a><span id="l114.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -225,19 +225,19 @@ NS_IMETHODIMP nsImapUrl::SetQuery(const </span>
<a href="#l115.4"></a><span id="l115.4"> }</span>
<a href="#l115.5"></a><span id="l115.5"> </span>
<a href="#l115.6"></a><span id="l115.6"> nsresult nsImapUrl::ParseUrl()</span>
<a href="#l115.7"></a><span id="l115.7"> {</span>
<a href="#l115.8"></a><span id="l115.8">   nsresult rv = NS_OK;</span>
<a href="#l115.9"></a><span id="l115.9">   // extract the user name</span>
<a href="#l115.10"></a><span id="l115.10">   GetUserPass(m_userName);</span>
<a href="#l115.11"></a><span id="l115.11"> </span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-  nsCAutoString imapPartOfUrl;</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineplus">+  nsAutoCString imapPartOfUrl;</span>
<a href="#l115.14"></a><span id="l115.14">   rv = GetPath(imapPartOfUrl);</span>
<a href="#l115.15"></a><span id="l115.15" class="difflineminus">-  nsCAutoString unescapedImapPartOfUrl;</span>
<a href="#l115.16"></a><span id="l115.16" class="difflineplus">+  nsAutoCString unescapedImapPartOfUrl;</span>
<a href="#l115.17"></a><span id="l115.17">   MsgUnescapeString(imapPartOfUrl, 0, unescapedImapPartOfUrl);</span>
<a href="#l115.18"></a><span id="l115.18">   if (NS_SUCCEEDED(rv) &amp;&amp; !unescapedImapPartOfUrl.IsEmpty())</span>
<a href="#l115.19"></a><span id="l115.19">   {</span>
<a href="#l115.20"></a><span id="l115.20">     ParseImapPart(unescapedImapPartOfUrl.BeginWriting()+1);  // GetPath leaves leading '/' in the path!!!</span>
<a href="#l115.21"></a><span id="l115.21">   }</span>
<a href="#l115.22"></a><span id="l115.22"> </span>
<a href="#l115.23"></a><span id="l115.23">   return NS_OK;</span>
<a href="#l115.24"></a><span id="l115.24"> }</span>
<a href="#l115.25"></a><span id="l115.25" class="difflineat">@@ -736,17 +736,17 @@ NS_IMETHODIMP nsImapUrl::AddOnlineDirect</span>
<a href="#l115.26"></a><span id="l115.26">   nsresult rv;</span>
<a href="#l115.27"></a><span id="l115.27">   nsString onlineDirString;</span>
<a href="#l115.28"></a><span id="l115.28">   char *newOnlineName = nullptr;</span>
<a href="#l115.29"></a><span id="l115.29"> </span>
<a href="#l115.30"></a><span id="l115.30">   nsCOMPtr&lt;nsIImapHostSessionList&gt; hostSessionList =</span>
<a href="#l115.31"></a><span id="l115.31">     do_GetService(kCImapHostSessionListCID, &amp;rv);</span>
<a href="#l115.32"></a><span id="l115.32">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l115.33"></a><span id="l115.33">   rv = hostSessionList-&gt;GetOnlineDirForHost(m_serverKey.get(), onlineDirString);</span>
<a href="#l115.34"></a><span id="l115.34" class="difflineminus">-  nsCAutoString onlineDir;</span>
<a href="#l115.35"></a><span id="l115.35" class="difflineplus">+  nsAutoCString onlineDir;</span>
<a href="#l115.36"></a><span id="l115.36">   LossyCopyUTF16toASCII(onlineDirString, onlineDir);</span>
<a href="#l115.37"></a><span id="l115.37"> </span>
<a href="#l115.38"></a><span id="l115.38">   nsIMAPNamespace *ns = nullptr;</span>
<a href="#l115.39"></a><span id="l115.39">   rv = hostSessionList-&gt;GetNamespaceForMailboxForHost(m_serverKey.get(),</span>
<a href="#l115.40"></a><span id="l115.40">                                                       onlineMailboxName, ns);</span>
<a href="#l115.41"></a><span id="l115.41">   if (!ns)</span>
<a href="#l115.42"></a><span id="l115.42">     hostSessionList-&gt;GetDefaultNamespaceOfTypeForHost(m_serverKey.get(),</span>
<a href="#l115.43"></a><span id="l115.43">                                                       kPersonalNamespace, ns);</span>
<a href="#l115.44"></a><span id="l115.44" class="difflineat">@@ -755,17 +755,17 @@ NS_IMETHODIMP nsImapUrl::AddOnlineDirect</span>
<a href="#l115.45"></a><span id="l115.45">     onlineDir = ns-&gt;GetPrefix();</span>
<a href="#l115.46"></a><span id="l115.46"> </span>
<a href="#l115.47"></a><span id="l115.47">   // If this host has an online server directory configured</span>
<a href="#l115.48"></a><span id="l115.48">   if (onlineMailboxName &amp;&amp; !onlineDir.IsEmpty())</span>
<a href="#l115.49"></a><span id="l115.49">   {</span>
<a href="#l115.50"></a><span id="l115.50">     if (PL_strcasecmp(onlineMailboxName, &quot;INBOX&quot;))</span>
<a href="#l115.51"></a><span id="l115.51">     {</span>
<a href="#l115.52"></a><span id="l115.52">       NS_ASSERTION(ns, &quot;couldn't find namespace for host&quot;);</span>
<a href="#l115.53"></a><span id="l115.53" class="difflineminus">-      nsCAutoString onlineDirWithDelimiter(onlineDir);</span>
<a href="#l115.54"></a><span id="l115.54" class="difflineplus">+      nsAutoCString onlineDirWithDelimiter(onlineDir);</span>
<a href="#l115.55"></a><span id="l115.55">       // make sure the onlineDir ends with the hierarchy delimiter</span>
<a href="#l115.56"></a><span id="l115.56">       if (ns)</span>
<a href="#l115.57"></a><span id="l115.57">       {</span>
<a href="#l115.58"></a><span id="l115.58">         char delimiter = ns-&gt;GetDelimiter();</span>
<a href="#l115.59"></a><span id="l115.59">         if ( delimiter &amp;&amp; delimiter != kOnlineHierarchySeparatorUnknown )</span>
<a href="#l115.60"></a><span id="l115.60">         {</span>
<a href="#l115.61"></a><span id="l115.61">           // try to change the canonical online dir name to real dir name first</span>
<a href="#l115.62"></a><span id="l115.62">           MsgReplaceChar(onlineDirWithDelimiter, '/', delimiter);</span>
<a href="#l115.63"></a><span id="l115.63" class="difflineat">@@ -939,17 +939,17 @@ NS_IMETHODIMP nsImapUrl::AllocateServerP</span>
<a href="#l115.64"></a><span id="l115.64"> // this method is only called from the imap thread</span>
<a href="#l115.65"></a><span id="l115.65"> NS_IMETHODIMP nsImapUrl::AllocateCanonicalPath(const char *serverPath, char onlineDelimiter, char **allocatedPath )</span>
<a href="#l115.66"></a><span id="l115.66"> {</span>
<a href="#l115.67"></a><span id="l115.67">   nsresult rv = NS_ERROR_NULL_POINTER;</span>
<a href="#l115.68"></a><span id="l115.68">   char delimiterToUse = onlineDelimiter;</span>
<a href="#l115.69"></a><span id="l115.69">   char *serverKey = nullptr;</span>
<a href="#l115.70"></a><span id="l115.70">   nsString aString;</span>
<a href="#l115.71"></a><span id="l115.71">   char *currentPath = (char *) serverPath;</span>
<a href="#l115.72"></a><span id="l115.72" class="difflineminus">-  nsCAutoString onlineDir;</span>
<a href="#l115.73"></a><span id="l115.73" class="difflineplus">+  nsAutoCString onlineDir;</span>
<a href="#l115.74"></a><span id="l115.74">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l115.75"></a><span id="l115.75"> </span>
<a href="#l115.76"></a><span id="l115.76">   nsCOMPtr&lt;nsIImapHostSessionList&gt; hostSessionList =</span>
<a href="#l115.77"></a><span id="l115.77">     do_GetService(kCImapHostSessionListCID, &amp;rv);</span>
<a href="#l115.78"></a><span id="l115.78"> </span>
<a href="#l115.79"></a><span id="l115.79">   *allocatedPath = nullptr;</span>
<a href="#l115.80"></a><span id="l115.80"> </span>
<a href="#l115.81"></a><span id="l115.81">   if (onlineDelimiter == kOnlineHierarchySeparatorUnknown ||</span>
<a href="#l115.82"></a><span id="l115.82" class="difflineat">@@ -1197,26 +1197,26 @@ NS_IMETHODIMP nsImapUrl::GetUri(char** a</span>
<a href="#l115.83"></a><span id="l115.83">   else</span>
<a href="#l115.84"></a><span id="l115.84">   {</span>
<a href="#l115.85"></a><span id="l115.85">     *aURI = nullptr;</span>
<a href="#l115.86"></a><span id="l115.86">     uint32_t key = m_listOfMessageIds ? atoi(m_listOfMessageIds) : 0;</span>
<a href="#l115.87"></a><span id="l115.87">     nsCString canonicalPath;</span>
<a href="#l115.88"></a><span id="l115.88">     AllocateCanonicalPath(m_sourceCanonicalFolderPathSubString, m_onlineSubDirSeparator, (getter_Copies(canonicalPath)));</span>
<a href="#l115.89"></a><span id="l115.89">     nsCString fullFolderPath(&quot;/&quot;);</span>
<a href="#l115.90"></a><span id="l115.90">     fullFolderPath.Append(m_userName);</span>
<a href="#l115.91"></a><span id="l115.91" class="difflineminus">-    nsCAutoString hostName;</span>
<a href="#l115.92"></a><span id="l115.92" class="difflineplus">+    nsAutoCString hostName;</span>
<a href="#l115.93"></a><span id="l115.93">     rv = GetHost(hostName);</span>
<a href="#l115.94"></a><span id="l115.94">     fullFolderPath.Append('@');</span>
<a href="#l115.95"></a><span id="l115.95">     fullFolderPath.Append(hostName);</span>
<a href="#l115.96"></a><span id="l115.96">     fullFolderPath.Append('/');</span>
<a href="#l115.97"></a><span id="l115.97">     fullFolderPath.Append(canonicalPath);</span>
<a href="#l115.98"></a><span id="l115.98"> </span>
<a href="#l115.99"></a><span id="l115.99">     nsCString baseMessageURI;</span>
<a href="#l115.100"></a><span id="l115.100">     nsCreateImapBaseMessageURI(fullFolderPath, baseMessageURI);</span>
<a href="#l115.101"></a><span id="l115.101" class="difflineminus">-    nsCAutoString uriStr;</span>
<a href="#l115.102"></a><span id="l115.102" class="difflineplus">+    nsAutoCString uriStr;</span>
<a href="#l115.103"></a><span id="l115.103">     rv = nsBuildImapMessageURI(baseMessageURI.get(), key, uriStr);</span>
<a href="#l115.104"></a><span id="l115.104">     *aURI = ToNewCString(uriStr);</span>
<a href="#l115.105"></a><span id="l115.105">   }</span>
<a href="#l115.106"></a><span id="l115.106">   return rv;</span>
<a href="#l115.107"></a><span id="l115.107"> }</span>
<a href="#l115.108"></a><span id="l115.108"> </span>
<a href="#l115.109"></a><span id="l115.109"> NS_IMPL_GETSET(nsImapUrl, AddDummyEnvelope, bool, m_addDummyEnvelope)</span>
<a href="#l115.110"></a><span id="l115.110"> NS_IMPL_GETSET(nsImapUrl, CanonicalLineEnding, bool, m_canonicalLineEnding)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUtils.cpp</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUtils.cpp</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineat">@@ -22,18 +22,18 @@</span>
<a href="#l116.4"></a><span id="l116.4"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l116.5"></a><span id="l116.5"> #include &quot;nsIMAPNamespace.h&quot;</span>
<a href="#l116.6"></a><span id="l116.6"> #include &quot;nsIImapFlagAndUidState.h&quot;</span>
<a href="#l116.7"></a><span id="l116.7"> </span>
<a href="#l116.8"></a><span id="l116.8"> nsresult</span>
<a href="#l116.9"></a><span id="l116.9"> nsImapURI2FullName(const char* rootURI, const char* hostName, const char* uriStr,</span>
<a href="#l116.10"></a><span id="l116.10">                    char **name)</span>
<a href="#l116.11"></a><span id="l116.11"> {</span>
<a href="#l116.12"></a><span id="l116.12" class="difflineminus">-    nsCAutoString uri(uriStr);</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineminus">-    nsCAutoString fullName;</span>
<a href="#l116.14"></a><span id="l116.14" class="difflineplus">+    nsAutoCString uri(uriStr);</span>
<a href="#l116.15"></a><span id="l116.15" class="difflineplus">+    nsAutoCString fullName;</span>
<a href="#l116.16"></a><span id="l116.16">     if (uri.Find(rootURI) != 0)</span>
<a href="#l116.17"></a><span id="l116.17">       return NS_ERROR_FAILURE;</span>
<a href="#l116.18"></a><span id="l116.18">     fullName = Substring(uri, strlen(rootURI));</span>
<a href="#l116.19"></a><span id="l116.19">     uri = fullName;</span>
<a href="#l116.20"></a><span id="l116.20">     int32_t hostStart = uri.Find(hostName);</span>
<a href="#l116.21"></a><span id="l116.21">     if (hostStart &lt;= 0) </span>
<a href="#l116.22"></a><span id="l116.22">       return NS_ERROR_FAILURE;</span>
<a href="#l116.23"></a><span id="l116.23">     fullName = Substring(uri, hostStart);</span>
<a href="#l116.24"></a><span id="l116.24" class="difflineat">@@ -49,17 +49,17 @@ nsImapURI2FullName(const char* rootURI, </span>
<a href="#l116.25"></a><span id="l116.25"> }</span>
<a href="#l116.26"></a><span id="l116.26"> </span>
<a href="#l116.27"></a><span id="l116.27"> /* parses ImapMessageURI */</span>
<a href="#l116.28"></a><span id="l116.28"> nsresult nsParseImapMessageURI(const char* uri, nsCString&amp; folderURI, uint32_t *key, char **part)</span>
<a href="#l116.29"></a><span id="l116.29"> {</span>
<a href="#l116.30"></a><span id="l116.30">   if(!key)</span>
<a href="#l116.31"></a><span id="l116.31">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l116.32"></a><span id="l116.32"> </span>
<a href="#l116.33"></a><span id="l116.33" class="difflineminus">-  nsCAutoString uriStr(uri);</span>
<a href="#l116.34"></a><span id="l116.34" class="difflineplus">+  nsAutoCString uriStr(uri);</span>
<a href="#l116.35"></a><span id="l116.35">   int32_t folderEnd = -1;</span>
<a href="#l116.36"></a><span id="l116.36">   // imap-message uri's can have imap:// url strings tacked on the end,</span>
<a href="#l116.37"></a><span id="l116.37">   // e.g., when opening/saving attachments. We don't want to look for '#'</span>
<a href="#l116.38"></a><span id="l116.38">   // in that part of the uri, if the attachment name contains '#',</span>
<a href="#l116.39"></a><span id="l116.39">   // so check for that here.</span>
<a href="#l116.40"></a><span id="l116.40">   if (StringBeginsWith(uriStr, NS_LITERAL_CSTRING(&quot;imap-message&quot;)))</span>
<a href="#l116.41"></a><span id="l116.41">     folderEnd = uriStr.Find(&quot;imap://&quot;);</span>
<a href="#l116.42"></a><span id="l116.42"> </span>
<a href="#l116.43"></a><span id="l116.43" class="difflineat">@@ -82,17 +82,17 @@ nsresult nsParseImapMessageURI(const cha</span>
<a href="#l116.44"></a><span id="l116.44">                                          0, unescapedName)))</span>
<a href="#l116.45"></a><span id="l116.45">       {</span>
<a href="#l116.46"></a><span id="l116.46">         // Re-escape the username, matching the way we do it in uris, not the</span>
<a href="#l116.47"></a><span id="l116.47">         // way necko escapes urls. See nsMsgIncomingServer::GetServerURI.</span>
<a href="#l116.48"></a><span id="l116.48">         MsgEscapeString(unescapedName, nsINetUtil::ESCAPE_XALPHAS, escapedName);</span>
<a href="#l116.49"></a><span id="l116.49">         folderURI.Replace(userNamePos, origUserNameLen, escapedName);</span>
<a href="#l116.50"></a><span id="l116.50">       }</span>
<a href="#l116.51"></a><span id="l116.51">     }</span>
<a href="#l116.52"></a><span id="l116.52" class="difflineminus">-    nsCAutoString keyStr;</span>
<a href="#l116.53"></a><span id="l116.53" class="difflineplus">+    nsAutoCString keyStr;</span>
<a href="#l116.54"></a><span id="l116.54">     if (keyEndSeparator != -1)</span>
<a href="#l116.55"></a><span id="l116.55">       keyStr = Substring(uriStr, keySeparator + 1, keyEndSeparator - (keySeparator + 1));</span>
<a href="#l116.56"></a><span id="l116.56">     else</span>
<a href="#l116.57"></a><span id="l116.57">       keyStr = Substring(uriStr, keySeparator + 1);</span>
<a href="#l116.58"></a><span id="l116.58"> </span>
<a href="#l116.59"></a><span id="l116.59">     *key = strtoul(keyStr.get(), nullptr, 10);</span>
<a href="#l116.60"></a><span id="l116.60"> </span>
<a href="#l116.61"></a><span id="l116.61">     if (part &amp;&amp; keyEndSeparator != -1)</span>
<a href="#l116.62"></a><span id="l116.62" class="difflineat">@@ -112,17 +112,17 @@ nsresult nsBuildImapMessageURI(const cha</span>
<a href="#l116.63"></a><span id="l116.63">   uri.Append(baseURI);</span>
<a href="#l116.64"></a><span id="l116.64">   uri.Append('#');</span>
<a href="#l116.65"></a><span id="l116.65">   uri.AppendInt(key);</span>
<a href="#l116.66"></a><span id="l116.66">   return NS_OK;</span>
<a href="#l116.67"></a><span id="l116.67"> }</span>
<a href="#l116.68"></a><span id="l116.68"> </span>
<a href="#l116.69"></a><span id="l116.69"> nsresult nsCreateImapBaseMessageURI(const nsACString&amp; baseURI, nsCString &amp;baseMessageURI)</span>
<a href="#l116.70"></a><span id="l116.70"> {</span>
<a href="#l116.71"></a><span id="l116.71" class="difflineminus">-  nsCAutoString tailURI(baseURI);</span>
<a href="#l116.72"></a><span id="l116.72" class="difflineplus">+  nsAutoCString tailURI(baseURI);</span>
<a href="#l116.73"></a><span id="l116.73">   // chop off imap:/</span>
<a href="#l116.74"></a><span id="l116.74">   if (tailURI.Find(kImapRootURI) == 0)</span>
<a href="#l116.75"></a><span id="l116.75">     tailURI.Cut(0, PL_strlen(kImapRootURI));</span>
<a href="#l116.76"></a><span id="l116.76">   baseMessageURI = kImapMessageRootURI;</span>
<a href="#l116.77"></a><span id="l116.77">   baseMessageURI += tailURI;</span>
<a href="#l116.78"></a><span id="l116.78">   return NS_OK;</span>
<a href="#l116.79"></a><span id="l116.79"> }</span>
<a href="#l116.80"></a><span id="l116.80"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsEmlxHelperUtils.mm</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsEmlxHelperUtils.mm</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -110,17 +110,17 @@ nsresult nsEmlxHelperUtils::AddEmlxMessa</span>
<a href="#l117.4"></a><span id="l117.4">   NS_OBJC_BEGIN_TRY_ABORT_BLOCK_NSRESULT;</span>
<a href="#l117.5"></a><span id="l117.5"> </span>
<a href="#l117.6"></a><span id="l117.6">   // needed to be sure autoreleased objects are released too, which they might not</span>
<a href="#l117.7"></a><span id="l117.7">   // in a C++ environment where the main event loop has no autorelease pool (e.g on a XPCOM thread)</span>
<a href="#l117.8"></a><span id="l117.8">   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];</span>
<a href="#l117.9"></a><span id="l117.9"> </span>
<a href="#l117.10"></a><span id="l117.10">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l117.11"></a><span id="l117.11"> </span>
<a href="#l117.12"></a><span id="l117.12" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l117.13"></a><span id="l117.13" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l117.14"></a><span id="l117.14">   aMessage-&gt;GetNativePath(path);</span>
<a href="#l117.15"></a><span id="l117.15"> </span>
<a href="#l117.16"></a><span id="l117.16">   NSData *data = [NSData dataWithContentsOfFile:[NSString stringWithUTF8String:path.get()]]; </span>
<a href="#l117.17"></a><span id="l117.17">   if (!data) {</span>
<a href="#l117.18"></a><span id="l117.18">     [pool release];</span>
<a href="#l117.19"></a><span id="l117.19">     return NS_ERROR_FAILURE;</span>
<a href="#l117.20"></a><span id="l117.20">   }</span>
<a href="#l117.21"></a><span id="l117.21"> </span>
<a href="#l117.22"></a><span id="l117.22" class="difflineat">@@ -164,17 +164,17 @@ nsresult nsEmlxHelperUtils::AddEmlxMessa</span>
<a href="#l117.23"></a><span id="l117.23">   const char *startOfXMLMetadata = startOfMessageData + numberOfBytesToRead;</span>
<a href="#l117.24"></a><span id="l117.24">   const char *endOfXMLMetadata = (char *)[data bytes] + [data length];</span>
<a href="#l117.25"></a><span id="l117.25"> </span>
<a href="#l117.26"></a><span id="l117.26">   uint32_t x_mozilla_flags = 0;</span>
<a href="#l117.27"></a><span id="l117.27">   ConvertToMozillaStatusFlags(startOfXMLMetadata, endOfXMLMetadata, &amp;x_mozilla_flags);</span>
<a href="#l117.28"></a><span id="l117.28"> </span>
<a href="#l117.29"></a><span id="l117.29">   // write the X-Mozilla-Status header according to which flags we've gathered above.</span>
<a href="#l117.30"></a><span id="l117.30">   uint32_t dummyRv;</span>
<a href="#l117.31"></a><span id="l117.31" class="difflineminus">-  nsCAutoString buf(PR_smprintf(X_MOZILLA_STATUS_FORMAT MSG_LINEBREAK, x_mozilla_flags));</span>
<a href="#l117.32"></a><span id="l117.32" class="difflineplus">+  nsAutoCString buf(PR_smprintf(X_MOZILLA_STATUS_FORMAT MSG_LINEBREAK, x_mozilla_flags));</span>
<a href="#l117.33"></a><span id="l117.33">   NS_ASSERTION(!buf.IsEmpty(), &quot;printf error with X-Mozilla-Status header&quot;);</span>
<a href="#l117.34"></a><span id="l117.34">   if (buf.IsEmpty()) {</span>
<a href="#l117.35"></a><span id="l117.35">     [pool release];</span>
<a href="#l117.36"></a><span id="l117.36">     return rv;</span>
<a href="#l117.37"></a><span id="l117.37">   }</span>
<a href="#l117.38"></a><span id="l117.38"> </span>
<a href="#l117.39"></a><span id="l117.39">   rv = aOut-&gt;Write(buf.get(), buf.Length(), &amp;dummyRv);</span>
<a href="#l117.40"></a><span id="l117.40">   if (NS_FAILED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineat">@@ -1032,17 +1032,17 @@ void nsEudoraAddress::RememberGroupMembe</span>
<a href="#l118.4"></a><span id="l118.4"> </span>
<a href="#l118.5"></a><span id="l118.5"> nsresult nsEudoraAddress::AddGroupMembersAsCards(nsVoidArray &amp;membersArray, nsIAddrDatabase *pDb)</span>
<a href="#l118.6"></a><span id="l118.6"> {</span>
<a href="#l118.7"></a><span id="l118.7">   int32_t max = membersArray.Count();</span>
<a href="#l118.8"></a><span id="l118.8">   CAliasData *pData;</span>
<a href="#l118.9"></a><span id="l118.9">   nsresult rv = NS_OK;</span>
<a href="#l118.10"></a><span id="l118.10">   nsCOMPtr &lt;nsIMdbRow&gt; newRow;</span>
<a href="#l118.11"></a><span id="l118.11">   nsAutoString uniStr;</span>
<a href="#l118.12"></a><span id="l118.12" class="difflineminus">-  nsCAutoString  displayName;</span>
<a href="#l118.13"></a><span id="l118.13" class="difflineplus">+  nsAutoCString  displayName;</span>
<a href="#l118.14"></a><span id="l118.14"> </span>
<a href="#l118.15"></a><span id="l118.15">   for (int32_t i = 0; i &lt; max; i++)</span>
<a href="#l118.16"></a><span id="l118.16">   {</span>
<a href="#l118.17"></a><span id="l118.17">     pData = (CAliasData *)membersArray.ElementAt(i);</span>
<a href="#l118.18"></a><span id="l118.18"> </span>
<a href="#l118.19"></a><span id="l118.19">     if (!pData || (pData-&gt;m_email.IsEmpty()))</span>
<a href="#l118.20"></a><span id="l118.20">       continue;</span>
<a href="#l118.21"></a><span id="l118.21"> </span>
<a href="#l118.22"></a><span id="l118.22" class="difflineat">@@ -1091,17 +1091,17 @@ nsresult nsEudoraAddress::AddSingleList(</span>
<a href="#l118.23"></a><span id="l118.23">   rv = pDb-&gt;AddListNickName(newRow, pEntry-&gt;m_name.get());</span>
<a href="#l118.24"></a><span id="l118.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l118.25"></a><span id="l118.25"> </span>
<a href="#l118.26"></a><span id="l118.26">   // Now add the members.</span>
<a href="#l118.27"></a><span id="l118.27">   int32_t max = emailList.Count();</span>
<a href="#l118.28"></a><span id="l118.28">   for (int32_t i = 0; i &lt; max; i++)</span>
<a href="#l118.29"></a><span id="l118.29">   {</span>
<a href="#l118.30"></a><span id="l118.30">     CAliasData *pData = (CAliasData *)emailList.ElementAt(i);</span>
<a href="#l118.31"></a><span id="l118.31" class="difflineminus">-    nsCAutoString ldifValue(&quot;mail&quot;);</span>
<a href="#l118.32"></a><span id="l118.32" class="difflineplus">+    nsAutoCString ldifValue(&quot;mail&quot;);</span>
<a href="#l118.33"></a><span id="l118.33">     ldifValue.Append(pData-&gt;m_email);</span>
<a href="#l118.34"></a><span id="l118.34">     rv = pDb-&gt;AddLdifListMember(newRow, ldifValue.get());</span>
<a href="#l118.35"></a><span id="l118.35">   }</span>
<a href="#l118.36"></a><span id="l118.36"> </span>
<a href="#l118.37"></a><span id="l118.37">   rv = pDb-&gt;AddCardRowToDB(newRow);</span>
<a href="#l118.38"></a><span id="l118.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l118.39"></a><span id="l118.39"> </span>
<a href="#l118.40"></a><span id="l118.40">   rv = pDb-&gt;AddListDirNode(newRow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -159,18 +159,18 @@ bool nsEudoraFilters::RealImport()</span>
<a href="#l119.4"></a><span id="l119.4">     return false;</span>
<a href="#l119.5"></a><span id="l119.5">   }</span>
<a href="#l119.6"></a><span id="l119.6"> </span>
<a href="#l119.7"></a><span id="l119.7">   nsCOMPtr&lt;nsILineInputStream&gt; lineStream(do_QueryInterface(inputStream, &amp;rv));</span>
<a href="#l119.8"></a><span id="l119.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l119.9"></a><span id="l119.9"> </span>
<a href="#l119.10"></a><span id="l119.10">   nsCString     line;</span>
<a href="#l119.11"></a><span id="l119.11">   bool          more = true;</span>
<a href="#l119.12"></a><span id="l119.12" class="difflineminus">-  nsCAutoString header;</span>
<a href="#l119.13"></a><span id="l119.13" class="difflineminus">-  nsCAutoString verb;</span>
<a href="#l119.14"></a><span id="l119.14" class="difflineplus">+  nsAutoCString header;</span>
<a href="#l119.15"></a><span id="l119.15" class="difflineplus">+  nsAutoCString verb;</span>
<a href="#l119.16"></a><span id="l119.16">   nsAutoString  name;</span>
<a href="#l119.17"></a><span id="l119.17"> </span>
<a href="#l119.18"></a><span id="l119.18">   // Windows Eudora filters files have a version header as a first line - just skip it</span>
<a href="#l119.19"></a><span id="l119.19"> #if defined(XP_WIN) || defined(XP_OS2)</span>
<a href="#l119.20"></a><span id="l119.20">   rv = lineStream-&gt;ReadLine(line, &amp;more);</span>
<a href="#l119.21"></a><span id="l119.21"> #endif</span>
<a href="#l119.22"></a><span id="l119.22"> </span>
<a href="#l119.23"></a><span id="l119.23">   while (more &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l119.24"></a><span id="l119.24" class="difflineat">@@ -256,17 +256,17 @@ bool nsEudoraFilters::RealImport()</span>
<a href="#l119.25"></a><span id="l119.25">         int32_t TBPriority = 6 - atoi(pLine + 9);</span>
<a href="#l119.26"></a><span id="l119.26"> #ifdef XP_MACOSX</span>
<a href="#l119.27"></a><span id="l119.27">         TBPriority++;</span>
<a href="#l119.28"></a><span id="l119.28"> #endif</span>
<a href="#l119.29"></a><span id="l119.29">         rv = AddPriorityAction(TBPriority);</span>
<a href="#l119.30"></a><span id="l119.30">       }</span>
<a href="#l119.31"></a><span id="l119.31">       else if (!strncmp(pLine, &quot;label &quot;, 6))</span>
<a href="#l119.32"></a><span id="l119.32">       {</span>
<a href="#l119.33"></a><span id="l119.33" class="difflineminus">-        nsCAutoString tagName(&quot;$label&quot;);</span>
<a href="#l119.34"></a><span id="l119.34" class="difflineplus">+        nsAutoCString tagName(&quot;$label&quot;);</span>
<a href="#l119.35"></a><span id="l119.35">         tagName += pLine + 6;</span>
<a href="#l119.36"></a><span id="l119.36">         rv = AddStringAction(nsMsgFilterAction::AddTag, tagName.get());</span>
<a href="#l119.37"></a><span id="l119.37">       }</span>
<a href="#l119.38"></a><span id="l119.38">       // Doing strncmp() here because Win Eudora puts a space after &quot;junk&quot; but Mac Eudora doesn't</span>
<a href="#l119.39"></a><span id="l119.39">       else if (!strncmp(pLine, &quot;junk&quot;, 4))</span>
<a href="#l119.40"></a><span id="l119.40">         rv = AddJunkAction(100);</span>
<a href="#l119.41"></a><span id="l119.41">       else if (!strncmp(pLine, &quot;status &quot;, 7))</span>
<a href="#l119.42"></a><span id="l119.42">       {</span>
<a href="#l119.43"></a><span id="l119.43" class="difflineat">@@ -410,17 +410,17 @@ nsresult nsEudoraFilters::LoadServers()</span>
<a href="#l119.44"></a><span id="l119.44">   {</span>
<a href="#l119.45"></a><span id="l119.45">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryElementAt(allServers, serverIndex, &amp;rv);</span>
<a href="#l119.46"></a><span id="l119.46">     if (server &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l119.47"></a><span id="l119.47">     {</span>
<a href="#l119.48"></a><span id="l119.48">       bool canHaveFilters;</span>
<a href="#l119.49"></a><span id="l119.49">       rv = server-&gt;GetCanHaveFilters(&amp;canHaveFilters);</span>
<a href="#l119.50"></a><span id="l119.50">       if (NS_SUCCEEDED(rv) &amp;&amp; canHaveFilters)</span>
<a href="#l119.51"></a><span id="l119.51">       {</span>
<a href="#l119.52"></a><span id="l119.52" class="difflineminus">-        nsCAutoString serverType;</span>
<a href="#l119.53"></a><span id="l119.53" class="difflineplus">+        nsAutoCString serverType;</span>
<a href="#l119.54"></a><span id="l119.54">         rv = server-&gt;GetType(serverType);</span>
<a href="#l119.55"></a><span id="l119.55">         if (NS_SUCCEEDED(rv) &amp;&amp; !serverType.IsEmpty())</span>
<a href="#l119.56"></a><span id="l119.56">         {</span>
<a href="#l119.57"></a><span id="l119.57">           // Only get imap accounts and the special &quot;none&quot; (Local Folders) account</span>
<a href="#l119.58"></a><span id="l119.58">           // since all imported Eudora pop3 accounts will go to Local Folders</span>
<a href="#l119.59"></a><span id="l119.59">           if (serverType.Equals(&quot;none&quot;) || serverType.Equals(&quot;imap&quot;))</span>
<a href="#l119.60"></a><span id="l119.60">           {</span>
<a href="#l119.61"></a><span id="l119.61">             // Pre-fetch filters now so that if there's any problem reading up the</span>
<a href="#l119.62"></a><span id="l119.62" class="difflineat">@@ -626,23 +626,23 @@ static int32_t FindOperator(const char* </span>
<a href="#l119.63"></a><span id="l119.63"> </span>
<a href="#l119.64"></a><span id="l119.64"> static int32_t AddCustomHeader(const char* pHeader)</span>
<a href="#l119.65"></a><span id="l119.65"> {</span>
<a href="#l119.66"></a><span id="l119.66">   nsresult rv;</span>
<a href="#l119.67"></a><span id="l119.67">   int32_t index = -1;</span>
<a href="#l119.68"></a><span id="l119.68">   nsCOMPtr&lt;nsIPrefBranch&gt; pref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l119.69"></a><span id="l119.69">   NS_ENSURE_SUCCESS(rv, index);</span>
<a href="#l119.70"></a><span id="l119.70"> </span>
<a href="#l119.71"></a><span id="l119.71" class="difflineminus">-  nsCAutoString headers;</span>
<a href="#l119.72"></a><span id="l119.72" class="difflineplus">+  nsAutoCString headers;</span>
<a href="#l119.73"></a><span id="l119.73">   pref-&gt;GetCharPref(MAILNEWS_CUSTOM_HEADERS, getter_Copies(headers));</span>
<a href="#l119.74"></a><span id="l119.74">   index = 0;</span>
<a href="#l119.75"></a><span id="l119.75">   if (!headers.IsEmpty())</span>
<a href="#l119.76"></a><span id="l119.76">   {</span>
<a href="#l119.77"></a><span id="l119.77">     char *headersString = ToNewCString(headers);</span>
<a href="#l119.78"></a><span id="l119.78" class="difflineminus">-    nsCAutoString hdrStr;</span>
<a href="#l119.79"></a><span id="l119.79" class="difflineplus">+    nsAutoCString hdrStr;</span>
<a href="#l119.80"></a><span id="l119.80">     hdrStr.Adopt(headersString);</span>
<a href="#l119.81"></a><span id="l119.81">     hdrStr.StripWhitespace();  //remove whitespace before parsing</span>
<a href="#l119.82"></a><span id="l119.82"> </span>
<a href="#l119.83"></a><span id="l119.83">     char *newStr = headersString;</span>
<a href="#l119.84"></a><span id="l119.84">     char *token = NS_strtok(&quot;:&quot;, &amp;newStr);</span>
<a href="#l119.85"></a><span id="l119.85">     while (token)</span>
<a href="#l119.86"></a><span id="l119.86">     {</span>
<a href="#l119.87"></a><span id="l119.87">       if (!PL_strcasecmp(token, pHeader))</span>
<a href="#l119.88"></a><span id="l119.88" class="difflineat">@@ -659,17 +659,17 @@ static int32_t AddCustomHeader(const cha</span>
<a href="#l119.89"></a><span id="l119.89"> }</span>
<a href="#l119.90"></a><span id="l119.90"> </span>
<a href="#l119.91"></a><span id="l119.91"> nsresult nsEudoraFilters::AddTerm(const char* pHeader, const char* pVerb, const char* pValue, bool booleanAnd, bool negateVerb)</span>
<a href="#l119.92"></a><span id="l119.92"> {</span>
<a href="#l119.93"></a><span id="l119.93">   nsresult rv;</span>
<a href="#l119.94"></a><span id="l119.94"> </span>
<a href="#l119.95"></a><span id="l119.95">   nsMsgSearchAttribValue attrib = FindHeader(pHeader);</span>
<a href="#l119.96"></a><span id="l119.96">   nsMsgSearchOpValue     op = FindOperator(pVerb);</span>
<a href="#l119.97"></a><span id="l119.97" class="difflineminus">-  nsCAutoString          arbitraryHeader;</span>
<a href="#l119.98"></a><span id="l119.98" class="difflineplus">+  nsAutoCString          arbitraryHeader;</span>
<a href="#l119.99"></a><span id="l119.99">   nsAutoString           unicodeHeader, unicodeVerb, unicodeValue;</span>
<a href="#l119.100"></a><span id="l119.100">   nsAutoString           filterTitle;</span>
<a href="#l119.101"></a><span id="l119.101"> </span>
<a href="#l119.102"></a><span id="l119.102">   NS_CopyNativeToUnicode(nsCString(pHeader), unicodeHeader);</span>
<a href="#l119.103"></a><span id="l119.103">   NS_CopyNativeToUnicode(nsCString(pVerb), unicodeVerb);</span>
<a href="#l119.104"></a><span id="l119.104">   NS_CopyNativeToUnicode(nsCString(pValue), unicodeValue);</span>
<a href="#l119.105"></a><span id="l119.105"> </span>
<a href="#l119.106"></a><span id="l119.106">   filterTitle = NS_LITERAL_STRING(&quot;- &quot;);</span>
<a href="#l119.107"></a><span id="l119.107" class="difflineat">@@ -804,31 +804,31 @@ nsresult nsEudoraFilters::AddAction(nsMs</span>
<a href="#l119.108"></a><span id="l119.108"> </span>
<a href="#l119.109"></a><span id="l119.109">     rv = action-&gt;SetType(actionType);</span>
<a href="#l119.110"></a><span id="l119.110">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l119.111"></a><span id="l119.111"> </span>
<a href="#l119.112"></a><span id="l119.112">     switch (actionType)</span>
<a href="#l119.113"></a><span id="l119.113">     {</span>
<a href="#l119.114"></a><span id="l119.114">       case nsMsgFilterAction::MoveToFolder:</span>
<a href="#l119.115"></a><span id="l119.115">       case nsMsgFilterAction::CopyToFolder:</span>
<a href="#l119.116"></a><span id="l119.116" class="difflineminus">-        rv = action-&gt;SetTargetFolderUri(nsCAutoString(targetFolderUri));</span>
<a href="#l119.117"></a><span id="l119.117" class="difflineplus">+        rv = action-&gt;SetTargetFolderUri(nsAutoCString(targetFolderUri));</span>
<a href="#l119.118"></a><span id="l119.118">         break;</span>
<a href="#l119.119"></a><span id="l119.119"> </span>
<a href="#l119.120"></a><span id="l119.120">       case nsMsgFilterAction::ChangePriority:</span>
<a href="#l119.121"></a><span id="l119.121">         rv = action-&gt;SetPriority(priority);</span>
<a href="#l119.122"></a><span id="l119.122">         break;</span>
<a href="#l119.123"></a><span id="l119.123"> </span>
<a href="#l119.124"></a><span id="l119.124">       case nsMsgFilterAction::JunkScore:</span>
<a href="#l119.125"></a><span id="l119.125">         rv = action-&gt;SetJunkScore(junkScore);</span>
<a href="#l119.126"></a><span id="l119.126">         break;</span>
<a href="#l119.127"></a><span id="l119.127"> </span>
<a href="#l119.128"></a><span id="l119.128">       case nsMsgFilterAction::AddTag:</span>
<a href="#l119.129"></a><span id="l119.129">       case nsMsgFilterAction::Reply:</span>
<a href="#l119.130"></a><span id="l119.130">       case nsMsgFilterAction::Forward:</span>
<a href="#l119.131"></a><span id="l119.131" class="difflineminus">-        rv = action-&gt;SetStrValue(nsCAutoString(strValue));</span>
<a href="#l119.132"></a><span id="l119.132" class="difflineplus">+        rv = action-&gt;SetStrValue(nsAutoCString(strValue));</span>
<a href="#l119.133"></a><span id="l119.133">         break;</span>
<a href="#l119.134"></a><span id="l119.134"> </span>
<a href="#l119.135"></a><span id="l119.135">       case nsMsgFilterAction::MarkRead:</span>
<a href="#l119.136"></a><span id="l119.136">       case nsMsgFilterAction::StopExecution:</span>
<a href="#l119.137"></a><span id="l119.137">       case nsMsgFilterAction::DeleteFromPop3Server:</span>
<a href="#l119.138"></a><span id="l119.138">       case nsMsgFilterAction::LeaveOnPop3Server:</span>
<a href="#l119.139"></a><span id="l119.139">       case nsMsgFilterAction::FetchBodyFromPop3Server:</span>
<a href="#l119.140"></a><span id="l119.140">         // No parameters for these</span>
<a href="#l119.141"></a><span id="l119.141" class="difflineat">@@ -871,17 +871,17 @@ nsresult nsEudoraFilters::AddMailboxActi</span>
<a href="#l119.142"></a><span id="l119.142"> #endif</span>
<a href="#l119.143"></a><span id="l119.143"> #ifdef XP_MACOSX</span>
<a href="#l119.144"></a><span id="l119.144">   nameHierarchy = pMailboxPath;</span>
<a href="#l119.145"></a><span id="l119.145"> #endif</span>
<a href="#l119.146"></a><span id="l119.146"> </span>
<a href="#l119.147"></a><span id="l119.147">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l119.148"></a><span id="l119.148">   rv = GetMailboxFolder(nameHierarchy.get(), getter_AddRefs(folder));</span>
<a href="#l119.149"></a><span id="l119.149"> </span>
<a href="#l119.150"></a><span id="l119.150" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l119.151"></a><span id="l119.151" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l119.152"></a><span id="l119.152">   if (NS_SUCCEEDED(rv))</span>
<a href="#l119.153"></a><span id="l119.153">     rv = folder-&gt;GetURI(folderURI);</span>
<a href="#l119.154"></a><span id="l119.154">   if (NS_FAILED(rv))</span>
<a href="#l119.155"></a><span id="l119.155">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l119.156"></a><span id="l119.156"> </span>
<a href="#l119.157"></a><span id="l119.157">   rv = AddAction(isTransfer? (nsMsgRuleActionType)nsMsgFilterAction::MoveToFolder : (nsMsgRuleActionType)nsMsgFilterAction::CopyToFolder, 0, 0, 0, nullptr, folderURI.get());</span>
<a href="#l119.158"></a><span id="l119.158"> </span>
<a href="#l119.159"></a><span id="l119.159">   if (NS_SUCCEEDED(rv) &amp;&amp; isTransfer)</span>
<a href="#l119.160"></a><span id="l119.160" class="difflineat">@@ -895,17 +895,17 @@ nsresult nsEudoraFilters::GetMailboxFold</span>
<a href="#l119.161"></a><span id="l119.161">   NS_ENSURE_ARG_POINTER(ppFolder);</span>
<a href="#l119.162"></a><span id="l119.162"> </span>
<a href="#l119.163"></a><span id="l119.163">   nsCOMPtr&lt;nsIMsgFolder&gt; folder(*ppFolder ? *ppFolder : m_pMailboxesRoot.get());</span>
<a href="#l119.164"></a><span id="l119.164"> </span>
<a href="#l119.165"></a><span id="l119.165">   // We've already grabbed the pointer on incoming, so now ensure</span>
<a href="#l119.166"></a><span id="l119.166">   // *ppFolder is null on outgoing if there is an error</span>
<a href="#l119.167"></a><span id="l119.167">   *ppFolder = nullptr;</span>
<a href="#l119.168"></a><span id="l119.168">   </span>
<a href="#l119.169"></a><span id="l119.169" class="difflineminus">-  nsCAutoString name(pNameHierarchy + 1);</span>
<a href="#l119.170"></a><span id="l119.170" class="difflineplus">+  nsAutoCString name(pNameHierarchy + 1);</span>
<a href="#l119.171"></a><span id="l119.171">   int32_t sepIndex = name.FindChar(*pNameHierarchy);</span>
<a href="#l119.172"></a><span id="l119.172">   if (sepIndex &gt;= 0)</span>
<a href="#l119.173"></a><span id="l119.173">     name.SetLength(sepIndex);</span>
<a href="#l119.174"></a><span id="l119.174"> </span>
<a href="#l119.175"></a><span id="l119.175">   nsAutoString unicodeName;</span>
<a href="#l119.176"></a><span id="l119.176">   NS_CopyNativeToUnicode(name, unicodeName);</span>
<a href="#l119.177"></a><span id="l119.177"> </span>
<a href="#l119.178"></a><span id="l119.178">   nsCOMPtr&lt;nsIMsgFolder&gt; subFolder;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -862,17 +862,17 @@ void nsEudoraMac::SetIdentities(nsIMsgAc</span>
<a href="#l120.4"></a><span id="l120.4">     if (pStrs[kFullNameStr]-&gt;Length())</span>
<a href="#l120.5"></a><span id="l120.5">       CopyASCIItoUTF16(pStrs[kFullNameStr]-&gt;get(), fullName);</span>
<a href="#l120.6"></a><span id="l120.6">     id-&gt;SetFullName(fullName);</span>
<a href="#l120.7"></a><span id="l120.7">     id-&gt;SetIdentityName(fullName);</span>
<a href="#l120.8"></a><span id="l120.8">     if (pStrs[kReturnAddressStr]-&gt;Length())</span>
<a href="#l120.9"></a><span id="l120.9">       id-&gt;SetEmail(*(pStrs[kReturnAddressStr]));</span>
<a href="#l120.10"></a><span id="l120.10">     else</span>
<a href="#l120.11"></a><span id="l120.11">     {</span>
<a href="#l120.12"></a><span id="l120.12" class="difflineminus">-      nsCAutoString emailAddress;</span>
<a href="#l120.13"></a><span id="l120.13" class="difflineplus">+      nsAutoCString emailAddress;</span>
<a href="#l120.14"></a><span id="l120.14">       emailAddress = userName;</span>
<a href="#l120.15"></a><span id="l120.15">       emailAddress += &quot;@&quot;;</span>
<a href="#l120.16"></a><span id="l120.16">       emailAddress += serverName;</span>
<a href="#l120.17"></a><span id="l120.17">       id-&gt;SetEmail(emailAddress);</span>
<a href="#l120.18"></a><span id="l120.18">     }</span>
<a href="#l120.19"></a><span id="l120.19">     acc-&gt;AddIdentity(id);</span>
<a href="#l120.20"></a><span id="l120.20">     IMPORT_LOG0(&quot;Created identity and added to the account\n&quot;);</span>
<a href="#l120.21"></a><span id="l120.21">     IMPORT_LOG1(&quot;\tname: %s\n&quot;, pStrs[kFullNameStr]-&gt;get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -274,17 +274,17 @@ nsresult nsEudoraMailbox::ImportMailbox(</span>
<a href="#l121.4"></a><span id="l121.4">     state.size = m_mailSize;</span>
<a href="#l121.5"></a><span id="l121.5">     state.pFile = pSrc;</span>
<a href="#l121.6"></a><span id="l121.6"> </span>
<a href="#l121.7"></a><span id="l121.7">     IMPORT_LOG0(&quot;Reading mailbox\n&quot;);</span>
<a href="#l121.8"></a><span id="l121.8"> </span>
<a href="#l121.9"></a><span id="l121.9">     if (NS_SUCCEEDED(rv))</span>
<a href="#l121.10"></a><span id="l121.10">     {</span>
<a href="#l121.11"></a><span id="l121.11">       nsCString defaultDate;</span>
<a href="#l121.12"></a><span id="l121.12" class="difflineminus">-      nsCAutoString bodyType;</span>
<a href="#l121.13"></a><span id="l121.13" class="difflineplus">+      nsAutoCString bodyType;</span>
<a href="#l121.14"></a><span id="l121.14"> </span>
<a href="#l121.15"></a><span id="l121.15">       IMPORT_LOG0(&quot;Reading first message\n&quot;);</span>
<a href="#l121.16"></a><span id="l121.16"> </span>
<a href="#l121.17"></a><span id="l121.17">       nsCOMPtr&lt;nsIOutputStream&gt; outputStream;</span>
<a href="#l121.18"></a><span id="l121.18">       nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l121.19"></a><span id="l121.19">       rv = dstFolder-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l121.20"></a><span id="l121.20">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l121.21"></a><span id="l121.21"> </span>
<a href="#l121.22"></a><span id="l121.22" class="difflineat">@@ -392,17 +392,17 @@ nsresult nsEudoraMailbox::ImportMailboxU</span>
<a href="#l121.23"></a><span id="l121.23">     rv = msgStore-&gt;GetNewMsgOutputStream(dstFolder, getter_AddRefs(msgHdr), &amp;reusable,</span>
<a href="#l121.24"></a><span id="l121.24">                                          getter_AddRefs(outputStream));</span>
<a href="#l121.25"></a><span id="l121.25">     if (NS_FAILED(rv))</span>
<a href="#l121.26"></a><span id="l121.26">       break;</span>
<a href="#l121.27"></a><span id="l121.27"> </span>
<a href="#l121.28"></a><span id="l121.28">     // Quick and dirty way to read in and parse the message the way the rest</span>
<a href="#l121.29"></a><span id="l121.29">     // of the code expects.</span>
<a href="#l121.30"></a><span id="l121.30">     nsCString              defaultDate;</span>
<a href="#l121.31"></a><span id="l121.31" class="difflineminus">-    nsCAutoString            bodyType;</span>
<a href="#l121.32"></a><span id="l121.32" class="difflineplus">+    nsAutoCString            bodyType;</span>
<a href="#l121.33"></a><span id="l121.33">     ReadFileState            state;</span>
<a href="#l121.34"></a><span id="l121.34"> </span>
<a href="#l121.35"></a><span id="l121.35">     // Seek to the start of the email message.</span>
<a href="#l121.36"></a><span id="l121.36">     mailboxSeekableStream-&gt;Seek(nsISeekableStream::NS_SEEK_SET, tocEntry.m_Offset);</span>
<a href="#l121.37"></a><span id="l121.37"> </span>
<a href="#l121.38"></a><span id="l121.38">     // We're fudging the data to make ReadNextMessage happy. In particular</span>
<a href="#l121.39"></a><span id="l121.39">     // state.size is meant to be the size of the entire file, because it's</span>
<a href="#l121.40"></a><span id="l121.40">     // assumed that ReadNextMessage will actually have to parse. We know</span>
<a href="#l121.41"></a><span id="l121.41" class="difflineat">@@ -539,17 +539,17 @@ nsresult nsEudoraMailbox::ReadTOCEntry(n</span>
<a href="#l121.42"></a><span id="l121.42"> </span>
<a href="#l121.43"></a><span id="l121.43">   return NS_OK;</span>
<a href="#l121.44"></a><span id="l121.44"> }</span>
<a href="#l121.45"></a><span id="l121.45"> </span>
<a href="#l121.46"></a><span id="l121.46"> nsresult nsEudoraMailbox::ImportMessage(</span>
<a href="#l121.47"></a><span id="l121.47">   SimpleBufferTonyRCopiedOnce &amp;headers,</span>
<a href="#l121.48"></a><span id="l121.48">   SimpleBufferTonyRCopiedOnce &amp;body,</span>
<a href="#l121.49"></a><span id="l121.49">   nsCString&amp; defaultDate,</span>
<a href="#l121.50"></a><span id="l121.50" class="difflineminus">-  nsCAutoString&amp; bodyType,</span>
<a href="#l121.51"></a><span id="l121.51" class="difflineplus">+  nsAutoCString&amp; bodyType,</span>
<a href="#l121.52"></a><span id="l121.52">   nsIOutputStream *pDst,</span>
<a href="#l121.53"></a><span id="l121.53">   int32_t  *pMsgCount)</span>
<a href="#l121.54"></a><span id="l121.54"> {</span>
<a href="#l121.55"></a><span id="l121.55">   nsresult rv = NS_OK;</span>
<a href="#l121.56"></a><span id="l121.56">   uint32_t written = 0;</span>
<a href="#l121.57"></a><span id="l121.57">   nsEudoraCompose compose;</span>
<a href="#l121.58"></a><span id="l121.58"> </span>
<a href="#l121.59"></a><span id="l121.59">   // Unfortunately Eudora stores HTML messages in the sent folder</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -163,17 +163,17 @@ protected:</span>
<a href="#l122.4"></a><span id="l122.4"> </span>
<a href="#l122.5"></a><span id="l122.5"> private:</span>
<a href="#l122.6"></a><span id="l122.6">   nsresult ImportMailboxUsingTOC(uint32_t *pBytes, bool *pAbort,</span>
<a href="#l122.7"></a><span id="l122.7">                                  nsIInputStream *pInputStream,</span>
<a href="#l122.8"></a><span id="l122.8">                                  nsIFile *tocFile,</span>
<a href="#l122.9"></a><span id="l122.9">                                  nsIMsgFolder *pDstFolder, int32_t *pMsgCount);</span>
<a href="#l122.10"></a><span id="l122.10"> </span>
<a href="#l122.11"></a><span id="l122.11">    nsresult  ReadTOCEntry(nsIInputStream *pToc, EudoraTOCEntry&amp; tocEntry);</span>
<a href="#l122.12"></a><span id="l122.12" class="difflineminus">-   nsresult  ImportMessage(SimpleBufferTonyRCopiedOnce&amp; headers, SimpleBufferTonyRCopiedOnce&amp; body, nsCString&amp; defaultDate, nsCAutoString&amp; bodyType, nsIOutputStream *pDst, int32_t *pMsgCount);</span>
<a href="#l122.13"></a><span id="l122.13" class="difflineplus">+   nsresult  ImportMessage(SimpleBufferTonyRCopiedOnce&amp; headers, SimpleBufferTonyRCopiedOnce&amp; body, nsCString&amp; defaultDate, nsAutoCString&amp; bodyType, nsIOutputStream *pDst, int32_t *pMsgCount);</span>
<a href="#l122.14"></a><span id="l122.14">    nsresult  ReadNextMessage(ReadFileState *pState, SimpleBufferTonyRCopiedOnce&amp; copy, SimpleBufferTonyRCopiedOnce&amp; header,</span>
<a href="#l122.15"></a><span id="l122.15">                                         SimpleBufferTonyRCopiedOnce&amp; body, nsCString&amp; defaultDate,</span>
<a href="#l122.16"></a><span id="l122.16">                                         nsCString &amp;defBodyType, EudoraTOCEntry *pTocEntry);</span>
<a href="#l122.17"></a><span id="l122.17">   int32_t    FindStartLine(SimpleBufferTonyRCopiedOnce&amp; data);</span>
<a href="#l122.18"></a><span id="l122.18">   int32_t    FindNextEndLine(SimpleBufferTonyRCopiedOnce&amp; data);</span>
<a href="#l122.19"></a><span id="l122.19">   int32_t    IsEndHeaders(SimpleBufferTonyRCopiedOnce&amp; data);</span>
<a href="#l122.20"></a><span id="l122.20">   nsresult  WriteFromSep(nsIOutputStream *pDst);</span>
<a href="#l122.21"></a><span id="l122.21">   nsresult  FillMailBuffer(ReadFileState *pState, SimpleBufferTonyRCopiedOnce&amp; read);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -428,17 +428,17 @@ nsresult nsEudoraWin32::FoundMailbox(nsI</span>
<a href="#l123.4"></a><span id="l123.4"> {</span>
<a href="#l123.5"></a><span id="l123.5">   nsString displayName;</span>
<a href="#l123.6"></a><span id="l123.6">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt; desc;</span>
<a href="#l123.7"></a><span id="l123.7">   nsISupports * pInterface;</span>
<a href="#l123.8"></a><span id="l123.8"> </span>
<a href="#l123.9"></a><span id="l123.9">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l123.10"></a><span id="l123.10"> </span>
<a href="#l123.11"></a><span id="l123.11"> #ifdef IMPORT_DEBUG</span>
<a href="#l123.12"></a><span id="l123.12" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l123.14"></a><span id="l123.14">   mailFile-&gt;GetNativePath(path);</span>
<a href="#l123.15"></a><span id="l123.15">   if (!path.IsEmpty())</span>
<a href="#l123.16"></a><span id="l123.16">     IMPORT_LOG2(&quot;Found eudora mailbox, %s: %s\n&quot;, path.get(), pName);</span>
<a href="#l123.17"></a><span id="l123.17">   else</span>
<a href="#l123.18"></a><span id="l123.18">     IMPORT_LOG1(&quot;Found eudora mailbox, %s\n&quot;, pName);</span>
<a href="#l123.19"></a><span id="l123.19">   IMPORT_LOG1(&quot;\tm_depth = %d\n&quot;, (int)m_depth);</span>
<a href="#l123.20"></a><span id="l123.20"> #endif</span>
<a href="#l123.21"></a><span id="l123.21"> </span>
<a href="#l123.22"></a><span id="l123.22" class="difflineat">@@ -469,17 +469,17 @@ nsresult nsEudoraWin32::FoundMailFolder(</span>
<a href="#l123.23"></a><span id="l123.23"> {</span>
<a href="#l123.24"></a><span id="l123.24">   nsString                displayName;</span>
<a href="#l123.25"></a><span id="l123.25">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt;  desc;</span>
<a href="#l123.26"></a><span id="l123.26">   nsISupports *              pInterface;</span>
<a href="#l123.27"></a><span id="l123.27"> </span>
<a href="#l123.28"></a><span id="l123.28">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l123.29"></a><span id="l123.29"> </span>
<a href="#l123.30"></a><span id="l123.30"> #ifdef IMPORT_DEBUG</span>
<a href="#l123.31"></a><span id="l123.31" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l123.32"></a><span id="l123.32" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l123.33"></a><span id="l123.33">   mailFolder-&gt;GetNativePath(path);</span>
<a href="#l123.34"></a><span id="l123.34">   if (!path.IsEmpty())</span>
<a href="#l123.35"></a><span id="l123.35">     IMPORT_LOG2(&quot;Found eudora folder, %s: %s\n&quot;, path.get(), pName);</span>
<a href="#l123.36"></a><span id="l123.36">   else</span>
<a href="#l123.37"></a><span id="l123.37">     IMPORT_LOG1(&quot;Found eudora folder, %s\n&quot;, pName);</span>
<a href="#l123.38"></a><span id="l123.38">   IMPORT_LOG1(&quot;\tm_depth = %d\n&quot;, (int)m_depth);</span>
<a href="#l123.39"></a><span id="l123.39"> #endif</span>
<a href="#l123.40"></a><span id="l123.40"> </span>
<a href="#l123.41"></a><span id="l123.41" class="difflineat">@@ -503,17 +503,17 @@ nsresult nsEudoraWin32::FoundMailFolder(</span>
<a href="#l123.42"></a><span id="l123.42"> </span>
<a href="#l123.43"></a><span id="l123.43">   return NS_OK;</span>
<a href="#l123.44"></a><span id="l123.44"> }</span>
<a href="#l123.45"></a><span id="l123.45"> </span>
<a href="#l123.46"></a><span id="l123.46"> </span>
<a href="#l123.47"></a><span id="l123.47"> nsresult nsEudoraWin32::FindTOCFile(nsIFile *pMailFile, nsIFile **ppTOCFile, bool *pDeleteToc)</span>
<a href="#l123.48"></a><span id="l123.48"> {</span>
<a href="#l123.49"></a><span id="l123.49">   nsresult    rv;</span>
<a href="#l123.50"></a><span id="l123.50" class="difflineminus">-  nsCAutoString  leaf;</span>
<a href="#l123.51"></a><span id="l123.51" class="difflineplus">+  nsAutoCString  leaf;</span>
<a href="#l123.52"></a><span id="l123.52"> </span>
<a href="#l123.53"></a><span id="l123.53">   *pDeleteToc = false;</span>
<a href="#l123.54"></a><span id="l123.54">   *ppTOCFile = nullptr;</span>
<a href="#l123.55"></a><span id="l123.55">   rv = pMailFile-&gt;GetNativeLeafName(leaf);</span>
<a href="#l123.56"></a><span id="l123.56">   if (NS_FAILED(rv))</span>
<a href="#l123.57"></a><span id="l123.57">     return rv;</span>
<a href="#l123.58"></a><span id="l123.58">   rv = pMailFile-&gt;GetParent(ppTOCFile);</span>
<a href="#l123.59"></a><span id="l123.59">   if (NS_FAILED(rv))</span>
<a href="#l123.60"></a><span id="l123.60" class="difflineat">@@ -683,17 +683,17 @@ bool nsEudoraWin32::GetMailboxNameHierar</span>
<a href="#l123.61"></a><span id="l123.61">   int32_t pathLength;</span>
<a href="#l123.62"></a><span id="l123.62">   const char* backslash = strchr(pEudoraFilePath, '\\');</span>
<a href="#l123.63"></a><span id="l123.63">   if (backslash)</span>
<a href="#l123.64"></a><span id="l123.64">     pathLength = backslash - pEudoraFilePath;</span>
<a href="#l123.65"></a><span id="l123.65">   else</span>
<a href="#l123.66"></a><span id="l123.66">     pathLength = strlen(pEudoraFilePath);</span>
<a href="#l123.67"></a><span id="l123.67"> </span>
<a href="#l123.68"></a><span id="l123.68">   bool more = true;</span>
<a href="#l123.69"></a><span id="l123.69" class="difflineminus">-  nsCAutoString buf;</span>
<a href="#l123.70"></a><span id="l123.70" class="difflineplus">+  nsAutoCString buf;</span>
<a href="#l123.71"></a><span id="l123.71">   while (more)</span>
<a href="#l123.72"></a><span id="l123.72">   {</span>
<a href="#l123.73"></a><span id="l123.73">     rv = lineStream-&gt;ReadLine(buf, &amp;more);</span>
<a href="#l123.74"></a><span id="l123.74">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l123.75"></a><span id="l123.75"> </span>
<a href="#l123.76"></a><span id="l123.76">     int32_t iNameEnd = buf.FindChar(',');</span>
<a href="#l123.77"></a><span id="l123.77">     if (iNameEnd &lt; 0)</span>
<a href="#l123.78"></a><span id="l123.78">       continue;</span>
<a href="#l123.79"></a><span id="l123.79" class="difflineat">@@ -905,19 +905,19 @@ bool nsEudoraWin32::BuildIMAPAccount(nsI</span>
<a href="#l123.80"></a><span id="l123.80">   else</span>
<a href="#l123.81"></a><span id="l123.81">     result = true;</span>
<a href="#l123.82"></a><span id="l123.82"> </span>
<a href="#l123.83"></a><span id="l123.83">   return result;</span>
<a href="#l123.84"></a><span id="l123.84"> }</span>
<a href="#l123.85"></a><span id="l123.85"> </span>
<a href="#l123.86"></a><span id="l123.86"> void nsEudoraWin32::SetIdentities(nsIMsgAccountManager *accMgr, nsIMsgAccount *acc, const char *pSection, const char *pIniFile, const char *userName, const char *serverName, char *pBuff)</span>
<a href="#l123.87"></a><span id="l123.87"> {</span>
<a href="#l123.88"></a><span id="l123.88" class="difflineminus">-  nsCAutoString realName;</span>
<a href="#l123.89"></a><span id="l123.89" class="difflineminus">-  nsCAutoString email;</span>
<a href="#l123.90"></a><span id="l123.90" class="difflineminus">-  nsCAutoString server;</span>
<a href="#l123.91"></a><span id="l123.91" class="difflineplus">+  nsAutoCString realName;</span>
<a href="#l123.92"></a><span id="l123.92" class="difflineplus">+  nsAutoCString email;</span>
<a href="#l123.93"></a><span id="l123.93" class="difflineplus">+  nsAutoCString server;</span>
<a href="#l123.94"></a><span id="l123.94">   DWORD valSize;</span>
<a href="#l123.95"></a><span id="l123.95">   nsresult rv;</span>
<a href="#l123.96"></a><span id="l123.96"> </span>
<a href="#l123.97"></a><span id="l123.97">   valSize = ::GetPrivateProfileString(pSection, &quot;RealName&quot;, &quot;&quot;, pBuff, kIniValueSize, pIniFile);</span>
<a href="#l123.98"></a><span id="l123.98">   if (valSize)</span>
<a href="#l123.99"></a><span id="l123.99">     realName = pBuff;</span>
<a href="#l123.100"></a><span id="l123.100">   valSize = ::GetPrivateProfileString(pSection, &quot;SMTPServer&quot;, &quot;&quot;, pBuff, kIniValueSize, pIniFile);</span>
<a href="#l123.101"></a><span id="l123.101">   if (valSize)</span>
<a href="#l123.102"></a><span id="l123.102" class="difflineat">@@ -998,17 +998,17 @@ nsresult nsEudoraWin32::GetAttachmentInf</span>
<a href="#l123.103"></a><span id="l123.103">     // is received, but doesn't update that path if the attachment directory</span>
<a href="#l123.104"></a><span id="l123.104">     // changes (e.g. if email directory is moved). When operating on an</span>
<a href="#l123.105"></a><span id="l123.105">     // attachment (opening, etc.) Eudora will first check the full path</span>
<a href="#l123.106"></a><span id="l123.106">     // and then if the file doesn't exist there Eudora will check the</span>
<a href="#l123.107"></a><span id="l123.107">     // current attachment directory for a file with the same name.</span>
<a href="#l123.108"></a><span id="l123.108">     //</span>
<a href="#l123.109"></a><span id="l123.109">     // Check to see if we have any better luck looking for the attachment</span>
<a href="#l123.110"></a><span id="l123.110">     // in the current attachment directory.</span>
<a href="#l123.111"></a><span id="l123.111" class="difflineminus">-    nsCAutoString name;</span>
<a href="#l123.112"></a><span id="l123.112" class="difflineplus">+    nsAutoCString name;</span>
<a href="#l123.113"></a><span id="l123.113">     pFile-&gt;GetNativeLeafName(name);</span>
<a href="#l123.114"></a><span id="l123.114">     if (name.IsEmpty())</span>
<a href="#l123.115"></a><span id="l123.115">       return NS_ERROR_FAILURE;</span>
<a href="#l123.116"></a><span id="l123.116"> </span>
<a href="#l123.117"></a><span id="l123.117">     nsCOMPtr &lt;nsIFile&gt; altFile;</span>
<a href="#l123.118"></a><span id="l123.118">     rv = m_mailImportLocation-&gt;Clone(getter_AddRefs(altFile));</span>
<a href="#l123.119"></a><span id="l123.119">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l123.120"></a><span id="l123.120">     // For now, we'll do that using a hard coded name and location for the</span>
<a href="#l123.121"></a><span id="l123.121" class="difflineat">@@ -1038,17 +1038,17 @@ nsresult nsEudoraWin32::GetAttachmentInf</span>
<a href="#l123.122"></a><span id="l123.122">         altFile-&gt;GetNativePath(nativePath);</span>
<a href="#l123.123"></a><span id="l123.123">         pFile-&gt;InitWithNativePath(nativePath);</span>
<a href="#l123.124"></a><span id="l123.124">       }</span>
<a href="#l123.125"></a><span id="l123.125">     }</span>
<a href="#l123.126"></a><span id="l123.126">   }</span>
<a href="#l123.127"></a><span id="l123.127"> </span>
<a href="#l123.128"></a><span id="l123.128">   if (exists &amp;&amp; isFile)</span>
<a href="#l123.129"></a><span id="l123.129">   {</span>
<a href="#l123.130"></a><span id="l123.130" class="difflineminus">-    nsCAutoString name;</span>
<a href="#l123.131"></a><span id="l123.131" class="difflineplus">+    nsAutoCString name;</span>
<a href="#l123.132"></a><span id="l123.132">     pFile-&gt;GetNativeLeafName(name);</span>
<a href="#l123.133"></a><span id="l123.133">     if (name.IsEmpty())</span>
<a href="#l123.134"></a><span id="l123.134">       return NS_ERROR_FAILURE;</span>
<a href="#l123.135"></a><span id="l123.135">     if (name.Length() &gt; 4)</span>
<a href="#l123.136"></a><span id="l123.136">     {</span>
<a href="#l123.137"></a><span id="l123.137">       nsCString ext;</span>
<a href="#l123.138"></a><span id="l123.138">       int32_t idx = name.RFindChar('.');</span>
<a href="#l123.139"></a><span id="l123.139">       if (idx != -1)</span>
<a href="#l123.140"></a><span id="l123.140" class="difflineat">@@ -1184,17 +1184,17 @@ void nsEudoraWin32::GetMimeTypeFromExten</span>
<a href="#l123.141"></a><span id="l123.141">     {</span>
<a href="#l123.142"></a><span id="l123.142">       rv = pFile-&gt;InitWithFile(m_mailImportLocation);</span>
<a href="#l123.143"></a><span id="l123.143">       if (NS_FAILED(rv))</span>
<a href="#l123.144"></a><span id="l123.144">         return;</span>
<a href="#l123.145"></a><span id="l123.145">       if (!FindMimeIniFile(pFile))</span>
<a href="#l123.146"></a><span id="l123.146">         return;</span>
<a href="#l123.147"></a><span id="l123.147">     }</span>
<a href="#l123.148"></a><span id="l123.148"> </span>
<a href="#l123.149"></a><span id="l123.149" class="difflineminus">-    nsCAutoString fileName;</span>
<a href="#l123.150"></a><span id="l123.150" class="difflineplus">+    nsAutoCString fileName;</span>
<a href="#l123.151"></a><span id="l123.151">     pFile-&gt;GetNativePath(fileName);</span>
<a href="#l123.152"></a><span id="l123.152">     if (fileName.IsEmpty())</span>
<a href="#l123.153"></a><span id="l123.153">       return;</span>
<a href="#l123.154"></a><span id="l123.154">     // Read the mime map section</span>
<a href="#l123.155"></a><span id="l123.155">     DWORD  size = 1024;</span>
<a href="#l123.156"></a><span id="l123.156">     DWORD  dSize = size - 2;</span>
<a href="#l123.157"></a><span id="l123.157">     while (dSize == (size - 2))</span>
<a href="#l123.158"></a><span id="l123.158">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOE5File.cpp</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOE5File.cpp</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -293,17 +293,17 @@ nsresult nsOE5File::ImportMailbox(uint32</span>
<a href="#l124.4"></a><span id="l124.4">       If we found a partial line in step #3 then find the rest of the line from the</span>
<a href="#l124.5"></a><span id="l124.5">       current block and write out this line separately.</span>
<a href="#l124.6"></a><span id="l124.6">       5. Reset some of the control variables and repeat step #3.</span>
<a href="#l124.7"></a><span id="l124.7">   */</span>
<a href="#l124.8"></a><span id="l124.8"> </span>
<a href="#l124.9"></a><span id="l124.9">   uint32_t  didBytes = 0;</span>
<a href="#l124.10"></a><span id="l124.10">   uint32_t  next, size;</span>
<a href="#l124.11"></a><span id="l124.11">   char *pStart, *pEnd, *partialLineStart;</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineminus">-  nsCAutoString partialLine, tempLine;</span>
<a href="#l124.13"></a><span id="l124.13" class="difflineplus">+  nsAutoCString partialLine, tempLine;</span>
<a href="#l124.14"></a><span id="l124.14">   nsCOMPtr&lt;nsIOutputStream&gt; outputStream;</span>
<a href="#l124.15"></a><span id="l124.15">   rv = NS_OK;</span>
<a href="#l124.16"></a><span id="l124.16"> </span>
<a href="#l124.17"></a><span id="l124.17">   for (uint32_t i = 0; (i &lt; indexSize) &amp;&amp; !(*pAbort); i++)</span>
<a href="#l124.18"></a><span id="l124.18">   {</span>
<a href="#l124.19"></a><span id="l124.19">     if (! pIndex[i])</span>
<a href="#l124.20"></a><span id="l124.20">       continue;</span>
<a href="#l124.21"></a><span id="l124.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -93,17 +93,17 @@ bool nsOEScanBoxes::Find50Mail(nsIFile *</span>
<a href="#l125.4"></a><span id="l125.4">   nsAutoString storeRoot;</span>
<a href="#l125.5"></a><span id="l125.5">   key-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;Store Root&quot;), storeRoot);</span>
<a href="#l125.6"></a><span id="l125.6">   if (NS_FAILED(rv))</span>
<a href="#l125.7"></a><span id="l125.7">     return false;</span>
<a href="#l125.8"></a><span id="l125.8"> </span>
<a href="#l125.9"></a><span id="l125.9">   nsCOMPtr&lt;nsIFile&gt; localWhere = do_QueryInterface(pWhere);</span>
<a href="#l125.10"></a><span id="l125.10">   localWhere-&gt;InitWithPath(storeRoot);</span>
<a href="#l125.11"></a><span id="l125.11"> </span>
<a href="#l125.12"></a><span id="l125.12" class="difflineminus">-  nsCAutoString nativeStoreRoot;</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineplus">+  nsAutoCString nativeStoreRoot;</span>
<a href="#l125.14"></a><span id="l125.14">   NS_CopyUnicodeToNative(storeRoot, nativeStoreRoot);</span>
<a href="#l125.15"></a><span id="l125.15">   IMPORT_LOG1(&quot;Setting native path: %s\n&quot;, nativeStoreRoot.get());</span>
<a href="#l125.16"></a><span id="l125.16"> </span>
<a href="#l125.17"></a><span id="l125.17">   bool isDir = false;</span>
<a href="#l125.18"></a><span id="l125.18">   rv = localWhere-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l125.19"></a><span id="l125.19">   return isDir;</span>
<a href="#l125.20"></a><span id="l125.20"> }</span>
<a href="#l125.21"></a><span id="l125.21"> </span>
<a href="#l125.22"></a><span id="l125.22" class="difflineat">@@ -604,17 +604,17 @@ void nsOEScanBoxes::ScanMailboxDir(nsIFi</span>
<a href="#l125.23"></a><span id="l125.23"> {</span>
<a href="#l125.24"></a><span id="l125.24">   if (Scan50MailboxDir(srcDir))</span>
<a href="#l125.25"></a><span id="l125.25">     return;</span>
<a href="#l125.26"></a><span id="l125.26"> </span>
<a href="#l125.27"></a><span id="l125.27">   Reset();</span>
<a href="#l125.28"></a><span id="l125.28"> </span>
<a href="#l125.29"></a><span id="l125.29">   MailboxEntry *  pEntry;</span>
<a href="#l125.30"></a><span id="l125.30">   int32_t      index = 1;</span>
<a href="#l125.31"></a><span id="l125.31" class="difflineminus">-  nsCAutoString pLeaf;</span>
<a href="#l125.32"></a><span id="l125.32" class="difflineplus">+  nsAutoCString pLeaf;</span>
<a href="#l125.33"></a><span id="l125.33">   uint32_t    sLen;</span>
<a href="#l125.34"></a><span id="l125.34"> </span>
<a href="#l125.35"></a><span id="l125.35">   bool hasMore;</span>
<a href="#l125.36"></a><span id="l125.36">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l125.37"></a><span id="l125.37">   nsresult rv = srcDir-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l125.38"></a><span id="l125.38">   if (NS_FAILED(rv))</span>
<a href="#l125.39"></a><span id="l125.39">     return;</span>
<a href="#l125.40"></a><span id="l125.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -336,17 +336,17 @@ bool OESettings::DoImport(nsIMsgAccount </span>
<a href="#l126.4"></a><span id="l126.4"> </span>
<a href="#l126.5"></a><span id="l126.5">     nsCOMPtr&lt;nsIWindowsRegKey&gt; subKey;</span>
<a href="#l126.6"></a><span id="l126.6">     rv = key-&gt;OpenChild(keyName,</span>
<a href="#l126.7"></a><span id="l126.7">                         nsIWindowsRegKey::ACCESS_QUERY_VALUE,</span>
<a href="#l126.8"></a><span id="l126.8">                         getter_AddRefs(subKey));</span>
<a href="#l126.9"></a><span id="l126.9">     if (NS_FAILED(rv))</span>
<a href="#l126.10"></a><span id="l126.10">       continue;</span>
<a href="#l126.11"></a><span id="l126.11"> </span>
<a href="#l126.12"></a><span id="l126.12" class="difflineminus">-    nsCAutoString nativeKeyName;</span>
<a href="#l126.13"></a><span id="l126.13" class="difflineplus">+    nsAutoCString nativeKeyName;</span>
<a href="#l126.14"></a><span id="l126.14">     NS_CopyUnicodeToNative(keyName, nativeKeyName);</span>
<a href="#l126.15"></a><span id="l126.15">     IMPORT_LOG1(&quot;Opened Outlook Express account: %s\n&quot;,</span>
<a href="#l126.16"></a><span id="l126.16">                 nativeKeyName.get());</span>
<a href="#l126.17"></a><span id="l126.17"> </span>
<a href="#l126.18"></a><span id="l126.18">     nsIMsgAccount  *anAccount = nullptr;</span>
<a href="#l126.19"></a><span id="l126.19">     nsAutoString value;</span>
<a href="#l126.20"></a><span id="l126.20">     rv = subKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;IMAP Server&quot;), value);</span>
<a href="#l126.21"></a><span id="l126.21">     if (NS_SUCCEEDED(rv) &amp;&amp; DoIMAPServer(accMgr, subKey, value, &amp;anAccount))</span>
<a href="#l126.22"></a><span id="l126.22" class="difflineat">@@ -397,19 +397,19 @@ bool OESettings::DoIMAPServer(nsIMsgAcco</span>
<a href="#l126.23"></a><span id="l126.23">     *ppAccount = nullptr;</span>
<a href="#l126.24"></a><span id="l126.24"> </span>
<a href="#l126.25"></a><span id="l126.25">   nsAutoString userName;</span>
<a href="#l126.26"></a><span id="l126.26">   nsresult rv;</span>
<a href="#l126.27"></a><span id="l126.27">   rv = aKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;IMAP User Name&quot;), userName);</span>
<a href="#l126.28"></a><span id="l126.28">   if (NS_FAILED(rv))</span>
<a href="#l126.29"></a><span id="l126.29">     return false;</span>
<a href="#l126.30"></a><span id="l126.30"> </span>
<a href="#l126.31"></a><span id="l126.31" class="difflineminus">-  nsCAutoString nativeUserName;</span>
<a href="#l126.32"></a><span id="l126.32" class="difflineplus">+  nsAutoCString nativeUserName;</span>
<a href="#l126.33"></a><span id="l126.33">   NS_CopyUnicodeToNative(userName, nativeUserName);</span>
<a href="#l126.34"></a><span id="l126.34" class="difflineminus">-  nsCAutoString nativeServerName;</span>
<a href="#l126.35"></a><span id="l126.35" class="difflineplus">+  nsAutoCString nativeServerName;</span>
<a href="#l126.36"></a><span id="l126.36">   NS_CopyUnicodeToNative(aServerName, nativeServerName);</span>
<a href="#l126.37"></a><span id="l126.37">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l126.38"></a><span id="l126.38">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l126.39"></a><span id="l126.39">   rv = aMgr-&gt;FindServer(nativeUserName,</span>
<a href="#l126.40"></a><span id="l126.40">                         nativeServerName,</span>
<a href="#l126.41"></a><span id="l126.41">                         NS_LITERAL_CSTRING(&quot;imap&quot;),</span>
<a href="#l126.42"></a><span id="l126.42">                         getter_AddRefs(in));</span>
<a href="#l126.43"></a><span id="l126.43">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l126.44"></a><span id="l126.44" class="difflineat">@@ -437,17 +437,17 @@ bool OESettings::DoIMAPServer(nsIMsgAcco</span>
<a href="#l126.45"></a><span id="l126.45">                                   NS_LITERAL_CSTRING(&quot;imap&quot;),</span>
<a href="#l126.46"></a><span id="l126.46">                                   getter_AddRefs(in));</span>
<a href="#l126.47"></a><span id="l126.47">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l126.48"></a><span id="l126.48"> </span>
<a href="#l126.49"></a><span id="l126.49">   nsAutoString rootFolder;</span>
<a href="#l126.50"></a><span id="l126.50">   rv = aKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;IMAP Root Folder&quot;), rootFolder);</span>
<a href="#l126.51"></a><span id="l126.51">   if (NS_SUCCEEDED(rv) &amp;&amp; !rootFolder.IsEmpty()) {</span>
<a href="#l126.52"></a><span id="l126.52">     nsCOMPtr&lt;nsIImapIncomingServer&gt; imapServer = do_QueryInterface(in);</span>
<a href="#l126.53"></a><span id="l126.53" class="difflineminus">-    nsCAutoString nativeRootFolder;</span>
<a href="#l126.54"></a><span id="l126.54" class="difflineplus">+    nsAutoCString nativeRootFolder;</span>
<a href="#l126.55"></a><span id="l126.55">     NS_CopyUnicodeToNative(rootFolder, nativeRootFolder);</span>
<a href="#l126.56"></a><span id="l126.56">     imapServer-&gt;SetServerDirectory(nativeRootFolder);</span>
<a href="#l126.57"></a><span id="l126.57">   }</span>
<a href="#l126.58"></a><span id="l126.58"> </span>
<a href="#l126.59"></a><span id="l126.59">   SetIncomingServerProperties(in, aKey, NS_LITERAL_STRING(&quot;IMAP &quot;));</span>
<a href="#l126.60"></a><span id="l126.60"> </span>
<a href="#l126.61"></a><span id="l126.61">   IMPORT_LOG2(&quot;Created IMAP server named: %s, userName: %s\n&quot;,</span>
<a href="#l126.62"></a><span id="l126.62">               nativeServerName.get(), nativeUserName.get());</span>
<a href="#l126.63"></a><span id="l126.63" class="difflineat">@@ -485,19 +485,19 @@ bool OESettings::DoPOP3Server(nsIMsgAcco</span>
<a href="#l126.64"></a><span id="l126.64">     *ppAccount = nullptr;</span>
<a href="#l126.65"></a><span id="l126.65"> </span>
<a href="#l126.66"></a><span id="l126.66">   nsAutoString userName;</span>
<a href="#l126.67"></a><span id="l126.67">   nsresult rv;</span>
<a href="#l126.68"></a><span id="l126.68">   rv = aKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;POP3 User Name&quot;), userName);</span>
<a href="#l126.69"></a><span id="l126.69">   if (NS_FAILED(rv))</span>
<a href="#l126.70"></a><span id="l126.70">     return false;</span>
<a href="#l126.71"></a><span id="l126.71"> </span>
<a href="#l126.72"></a><span id="l126.72" class="difflineminus">-  nsCAutoString nativeUserName;</span>
<a href="#l126.73"></a><span id="l126.73" class="difflineplus">+  nsAutoCString nativeUserName;</span>
<a href="#l126.74"></a><span id="l126.74">   NS_CopyUnicodeToNative(userName, nativeUserName);</span>
<a href="#l126.75"></a><span id="l126.75" class="difflineminus">-  nsCAutoString nativeServerName;</span>
<a href="#l126.76"></a><span id="l126.76" class="difflineplus">+  nsAutoCString nativeServerName;</span>
<a href="#l126.77"></a><span id="l126.77">   NS_CopyUnicodeToNative(aServerName, nativeServerName);</span>
<a href="#l126.78"></a><span id="l126.78"> </span>
<a href="#l126.79"></a><span id="l126.79">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l126.80"></a><span id="l126.80">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l126.81"></a><span id="l126.81">   rv = aMgr-&gt;FindServer(nativeUserName,</span>
<a href="#l126.82"></a><span id="l126.82">                         nativeServerName,</span>
<a href="#l126.83"></a><span id="l126.83">                         NS_LITERAL_CSTRING(&quot;pop3&quot;),</span>
<a href="#l126.84"></a><span id="l126.84">                         getter_AddRefs(in));</span>
<a href="#l126.85"></a><span id="l126.85" class="difflineat">@@ -618,17 +618,17 @@ bool OESettings::DoNNTPServer(nsIMsgAcco</span>
<a href="#l126.86"></a><span id="l126.86"> </span>
<a href="#l126.87"></a><span id="l126.87">   nsAutoString userName;</span>
<a href="#l126.88"></a><span id="l126.88">   nsresult rv;</span>
<a href="#l126.89"></a><span id="l126.89">   // this only exists if NNTP server requires it or not anon login</span>
<a href="#l126.90"></a><span id="l126.90">   rv = aKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;NNTP User Name&quot;), userName);</span>
<a href="#l126.91"></a><span id="l126.91"> </span>
<a href="#l126.92"></a><span id="l126.92">   bool result = false;</span>
<a href="#l126.93"></a><span id="l126.93"> </span>
<a href="#l126.94"></a><span id="l126.94" class="difflineminus">-  nsCAutoString nativeServerName;</span>
<a href="#l126.95"></a><span id="l126.95" class="difflineplus">+  nsAutoCString nativeServerName;</span>
<a href="#l126.96"></a><span id="l126.96">   NS_CopyUnicodeToNative(aServerName, nativeServerName);</span>
<a href="#l126.97"></a><span id="l126.97">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l126.98"></a><span id="l126.98">   // NNTP can have empty user name.  This is wild card in findserver</span>
<a href="#l126.99"></a><span id="l126.99">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l126.100"></a><span id="l126.100">   rv = aMgr-&gt;FindServer(EmptyCString(),</span>
<a href="#l126.101"></a><span id="l126.101">                         nativeServerName,</span>
<a href="#l126.102"></a><span id="l126.102">                         NS_LITERAL_CSTRING(&quot;nntp&quot;),</span>
<a href="#l126.103"></a><span id="l126.103">                         getter_AddRefs(in));</span>
<a href="#l126.104"></a><span id="l126.104" class="difflineat">@@ -640,17 +640,17 @@ bool OESettings::DoNNTPServer(nsIMsgAcco</span>
<a href="#l126.105"></a><span id="l126.105">                                     getter_AddRefs(in));</span>
<a href="#l126.106"></a><span id="l126.106">     if (NS_SUCCEEDED(rv) &amp;&amp; in) {</span>
<a href="#l126.107"></a><span id="l126.107">       uint32_t port = 0;</span>
<a href="#l126.108"></a><span id="l126.108">       rv = aKey-&gt;ReadIntValue(NS_LITERAL_STRING(&quot;NNTP Port&quot;),</span>
<a href="#l126.109"></a><span id="l126.109">                               &amp;port);</span>
<a href="#l126.110"></a><span id="l126.110">       if (NS_SUCCEEDED(rv) &amp;&amp; port &amp;&amp; port != 119)</span>
<a href="#l126.111"></a><span id="l126.111">         in-&gt;SetPort(static_cast&lt;int32_t&gt;(port));</span>
<a href="#l126.112"></a><span id="l126.112"> </span>
<a href="#l126.113"></a><span id="l126.113" class="difflineminus">-      nsCAutoString nativeUserName;</span>
<a href="#l126.114"></a><span id="l126.114" class="difflineplus">+      nsAutoCString nativeUserName;</span>
<a href="#l126.115"></a><span id="l126.115">       NS_CopyUnicodeToNative(userName, nativeUserName);</span>
<a href="#l126.116"></a><span id="l126.116">       // do nntpincomingserver stuff</span>
<a href="#l126.117"></a><span id="l126.117">       nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer = do_QueryInterface(in);</span>
<a href="#l126.118"></a><span id="l126.118">       if (nntpServer &amp;&amp; !userName.IsEmpty()) {</span>
<a href="#l126.119"></a><span id="l126.119">         nntpServer-&gt;SetPushAuth(true);</span>
<a href="#l126.120"></a><span id="l126.120">         in-&gt;SetUsername(nativeUserName);</span>
<a href="#l126.121"></a><span id="l126.121">       }</span>
<a href="#l126.122"></a><span id="l126.122"> </span>
<a href="#l126.123"></a><span id="l126.123" class="difflineat">@@ -766,30 +766,30 @@ void OESettings::SetIdentities(nsIMsgAcc</span>
<a href="#l126.124"></a><span id="l126.124">   if (NS_FAILED(rv))</span>
<a href="#l126.125"></a><span id="l126.125">     return;</span>
<a href="#l126.126"></a><span id="l126.126"> </span>
<a href="#l126.127"></a><span id="l126.127">   id-&gt;SetFullName(name);</span>
<a href="#l126.128"></a><span id="l126.128">   //BUG 470587. Don't set this: id-&gt;SetIdentityName(fullName);</span>
<a href="#l126.129"></a><span id="l126.129"> </span>
<a href="#l126.130"></a><span id="l126.130">   id-&gt;SetOrganization(orgName);</span>
<a href="#l126.131"></a><span id="l126.131"> </span>
<a href="#l126.132"></a><span id="l126.132" class="difflineminus">-  nsCAutoString nativeEmail;</span>
<a href="#l126.133"></a><span id="l126.133" class="difflineplus">+  nsAutoCString nativeEmail;</span>
<a href="#l126.134"></a><span id="l126.134">   NS_CopyUnicodeToNative(email, nativeEmail);</span>
<a href="#l126.135"></a><span id="l126.135">   id-&gt;SetEmail(nativeEmail);</span>
<a href="#l126.136"></a><span id="l126.136">   if (!reply.IsEmpty()) {</span>
<a href="#l126.137"></a><span id="l126.137" class="difflineminus">-    nsCAutoString nativeReply;</span>
<a href="#l126.138"></a><span id="l126.138" class="difflineplus">+    nsAutoCString nativeReply;</span>
<a href="#l126.139"></a><span id="l126.139">     NS_CopyUnicodeToNative(reply, nativeReply);</span>
<a href="#l126.140"></a><span id="l126.140">     id-&gt;SetReplyTo(nativeReply);</span>
<a href="#l126.141"></a><span id="l126.141">   }</span>
<a href="#l126.142"></a><span id="l126.142"> </span>
<a href="#l126.143"></a><span id="l126.143">   // Outlook Express users are used to top style quoting.</span>
<a href="#l126.144"></a><span id="l126.144">   id-&gt;SetReplyOnTop(isNNTP ? 0 : 1);</span>
<a href="#l126.145"></a><span id="l126.145">   pAcc-&gt;AddIdentity(id);</span>
<a href="#l126.146"></a><span id="l126.146"> </span>
<a href="#l126.147"></a><span id="l126.147" class="difflineminus">-  nsCAutoString nativeName;</span>
<a href="#l126.148"></a><span id="l126.148" class="difflineplus">+  nsAutoCString nativeName;</span>
<a href="#l126.149"></a><span id="l126.149">   NS_CopyUnicodeToNative(name, nativeName);</span>
<a href="#l126.150"></a><span id="l126.150">   IMPORT_LOG0(&quot;Created identity and added to the account\n&quot;);</span>
<a href="#l126.151"></a><span id="l126.151">   IMPORT_LOG1(&quot;\tname: %s\n&quot;, nativeName.get());</span>
<a href="#l126.152"></a><span id="l126.152">   IMPORT_LOG1(&quot;\temail: %s\n&quot;, nativeEmail.get());</span>
<a href="#l126.153"></a><span id="l126.153"> </span>
<a href="#l126.154"></a><span id="l126.154">   if (isNNTP)  // NNTP does not use SMTP in OE or TB</span>
<a href="#l126.155"></a><span id="l126.155">     return;</span>
<a href="#l126.156"></a><span id="l126.156">   nsAutoString smtpServer;</span>
<a href="#l126.157"></a><span id="l126.157" class="difflineat">@@ -827,19 +827,19 @@ void OESettings::SetSmtpServer(const nsS</span>
<a href="#l126.158"></a><span id="l126.158">       break; // initial userName == &quot;&quot;</span>
<a href="#l126.159"></a><span id="l126.159">   }</span>
<a href="#l126.160"></a><span id="l126.160"> </span>
<a href="#l126.161"></a><span id="l126.161">   nsCOMPtr&lt;nsISmtpService&gt; smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l126.162"></a><span id="l126.162">   if (NS_SUCCEEDED(rv) &amp;&amp; smtpService) {</span>
<a href="#l126.163"></a><span id="l126.163">     nsCOMPtr&lt;nsISmtpServer&gt; foundServer;</span>
<a href="#l126.164"></a><span id="l126.164">     // don't try to make another server</span>
<a href="#l126.165"></a><span id="l126.165">     // regardless if username doesn't match</span>
<a href="#l126.166"></a><span id="l126.166" class="difflineminus">-    nsCAutoString nativeUserName;</span>
<a href="#l126.167"></a><span id="l126.167" class="difflineplus">+    nsAutoCString nativeUserName;</span>
<a href="#l126.168"></a><span id="l126.168">     NS_CopyUnicodeToNative(userName, nativeUserName);</span>
<a href="#l126.169"></a><span id="l126.169" class="difflineminus">-    nsCAutoString nativeSmtpServer;</span>
<a href="#l126.170"></a><span id="l126.170" class="difflineplus">+    nsAutoCString nativeSmtpServer;</span>
<a href="#l126.171"></a><span id="l126.171">     NS_CopyUnicodeToNative(aSmtpServer, nativeSmtpServer);</span>
<a href="#l126.172"></a><span id="l126.172">     rv = smtpService-&gt;FindServer(nativeUserName.get(),</span>
<a href="#l126.173"></a><span id="l126.173">                                  nativeSmtpServer.get(),</span>
<a href="#l126.174"></a><span id="l126.174">                                  getter_AddRefs(foundServer));</span>
<a href="#l126.175"></a><span id="l126.175">     if (NS_SUCCEEDED(rv) &amp;&amp; foundServer) {</span>
<a href="#l126.176"></a><span id="l126.176">       // set our account keyed to this smptserver key</span>
<a href="#l126.177"></a><span id="l126.177">       foundServer-&gt;GetKey(getter_Copies(smtpServerKey));</span>
<a href="#l126.178"></a><span id="l126.178">       aId-&gt;SetSmtpServerKey(smtpServerKey);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -598,17 +598,17 @@ nsresult nsOutlookMail::CreateList(const</span>
<a href="#l127.4"></a><span id="l127.4">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l127.5"></a><span id="l127.5">   // Make sure we have db to work with.</span>
<a href="#l127.6"></a><span id="l127.6">   if (!pDb)</span>
<a href="#l127.7"></a><span id="l127.7">     return rv;</span>
<a href="#l127.8"></a><span id="l127.8"> </span>
<a href="#l127.9"></a><span id="l127.9">   nsCOMPtr &lt;nsIMdbRow&gt; newListRow;</span>
<a href="#l127.10"></a><span id="l127.10">   rv = pDb-&gt;GetNewListRow(getter_AddRefs(newListRow));</span>
<a href="#l127.11"></a><span id="l127.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l127.12"></a><span id="l127.12" class="difflineminus">-  nsCAutoString column;</span>
<a href="#l127.13"></a><span id="l127.13" class="difflineplus">+  nsAutoCString column;</span>
<a href="#l127.14"></a><span id="l127.14">   LossyCopyUTF16toASCII(nsDependentString(pName), column);</span>
<a href="#l127.15"></a><span id="l127.15">   rv = pDb-&gt;AddListName(newListRow, column.get());</span>
<a href="#l127.16"></a><span id="l127.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l127.17"></a><span id="l127.17"> </span>
<a href="#l127.18"></a><span id="l127.18">   HRESULT             hr;</span>
<a href="#l127.19"></a><span id="l127.19">   LPSPropValue value = NULL;</span>
<a href="#l127.20"></a><span id="l127.20">   ULONG valueCount = 0;</span>
<a href="#l127.21"></a><span id="l127.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -237,17 +237,17 @@ bool OutlookSettings::DoImport(nsIMsgAcc</span>
<a href="#l128.4"></a><span id="l128.4">     nsCOMPtr&lt;nsIWindowsRegKey&gt; subKey;</span>
<a href="#l128.5"></a><span id="l128.5">     rv = key-&gt;OpenChild(keyName,</span>
<a href="#l128.6"></a><span id="l128.6">                         nsIWindowsRegKey::ACCESS_QUERY_VALUE,</span>
<a href="#l128.7"></a><span id="l128.7">                         getter_AddRefs(subKey));</span>
<a href="#l128.8"></a><span id="l128.8">     if (NS_FAILED(rv))</span>
<a href="#l128.9"></a><span id="l128.9">       continue;</span>
<a href="#l128.10"></a><span id="l128.10"> </span>
<a href="#l128.11"></a><span id="l128.11">     // Get the values for this account.</span>
<a href="#l128.12"></a><span id="l128.12" class="difflineminus">-    nsCAutoString nativeKeyName;</span>
<a href="#l128.13"></a><span id="l128.13" class="difflineplus">+    nsAutoCString nativeKeyName;</span>
<a href="#l128.14"></a><span id="l128.14">     NS_CopyUnicodeToNative(keyName, nativeKeyName);</span>
<a href="#l128.15"></a><span id="l128.15">     IMPORT_LOG1(&quot;Opened Outlook account: %s\n&quot;, nativeKeyName.get());</span>
<a href="#l128.16"></a><span id="l128.16"> </span>
<a href="#l128.17"></a><span id="l128.17">     nsCOMPtr&lt;nsIMsgAccount&gt; account;</span>
<a href="#l128.18"></a><span id="l128.18">     nsAutoString value;</span>
<a href="#l128.19"></a><span id="l128.19">     rv = subKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;IMAP Server&quot;), value);</span>
<a href="#l128.20"></a><span id="l128.20">     if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l128.21"></a><span id="l128.21">         DoIMAPServer(accMgr, subKey, value, getter_AddRefs(account)))</span>
<a href="#l128.22"></a><span id="l128.22" class="difflineat">@@ -301,19 +301,19 @@ bool OutlookSettings::DoIMAPServer(nsIMs</span>
<a href="#l128.23"></a><span id="l128.23">   nsresult rv;</span>
<a href="#l128.24"></a><span id="l128.24">   rv = aKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;IMAP User Name&quot;), userName);</span>
<a href="#l128.25"></a><span id="l128.25">   if (NS_FAILED(rv))</span>
<a href="#l128.26"></a><span id="l128.26">     return false;</span>
<a href="#l128.27"></a><span id="l128.27"> </span>
<a href="#l128.28"></a><span id="l128.28">   bool result = false;</span>
<a href="#l128.29"></a><span id="l128.29"> </span>
<a href="#l128.30"></a><span id="l128.30">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l128.31"></a><span id="l128.31" class="difflineminus">-  nsCAutoString nativeUserName;</span>
<a href="#l128.32"></a><span id="l128.32" class="difflineplus">+  nsAutoCString nativeUserName;</span>
<a href="#l128.33"></a><span id="l128.33">   NS_CopyUnicodeToNative(userName, nativeUserName);</span>
<a href="#l128.34"></a><span id="l128.34" class="difflineminus">-  nsCAutoString nativeServerName;</span>
<a href="#l128.35"></a><span id="l128.35" class="difflineplus">+  nsAutoCString nativeServerName;</span>
<a href="#l128.36"></a><span id="l128.36">   NS_CopyUnicodeToNative(aServerName, nativeServerName);</span>
<a href="#l128.37"></a><span id="l128.37">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l128.38"></a><span id="l128.38">   rv = aMgr-&gt;FindServer(nativeUserName,</span>
<a href="#l128.39"></a><span id="l128.39">                         nativeServerName,</span>
<a href="#l128.40"></a><span id="l128.40">                         NS_LITERAL_CSTRING(&quot;imap&quot;),</span>
<a href="#l128.41"></a><span id="l128.41">                         getter_AddRefs(in));</span>
<a href="#l128.42"></a><span id="l128.42">   if (NS_FAILED(rv) || (in == nullptr)) {</span>
<a href="#l128.43"></a><span id="l128.43">     // Create the incoming server and an account for it?</span>
<a href="#l128.44"></a><span id="l128.44" class="difflineat">@@ -360,19 +360,19 @@ bool OutlookSettings::DoPOP3Server(nsIMs</span>
<a href="#l128.45"></a><span id="l128.45"> {</span>
<a href="#l128.46"></a><span id="l128.46">   nsAutoString userName;</span>
<a href="#l128.47"></a><span id="l128.47">   nsresult rv;</span>
<a href="#l128.48"></a><span id="l128.48">   rv = aKey-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;POP3 User Name&quot;), userName);</span>
<a href="#l128.49"></a><span id="l128.49">   if (NS_FAILED(rv))</span>
<a href="#l128.50"></a><span id="l128.50">     return false;</span>
<a href="#l128.51"></a><span id="l128.51"> </span>
<a href="#l128.52"></a><span id="l128.52">   // I now have a user name/server name pair, find out if it already exists?</span>
<a href="#l128.53"></a><span id="l128.53" class="difflineminus">-  nsCAutoString nativeUserName;</span>
<a href="#l128.54"></a><span id="l128.54" class="difflineplus">+  nsAutoCString nativeUserName;</span>
<a href="#l128.55"></a><span id="l128.55">   NS_CopyUnicodeToNative(userName, nativeUserName);</span>
<a href="#l128.56"></a><span id="l128.56" class="difflineminus">-  nsCAutoString nativeServerName;</span>
<a href="#l128.57"></a><span id="l128.57" class="difflineplus">+  nsAutoCString nativeServerName;</span>
<a href="#l128.58"></a><span id="l128.58">   NS_CopyUnicodeToNative(aServerName, nativeServerName);</span>
<a href="#l128.59"></a><span id="l128.59">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in;</span>
<a href="#l128.60"></a><span id="l128.60">   rv = aMgr-&gt;FindServer(nativeUserName,</span>
<a href="#l128.61"></a><span id="l128.61">                         nativeServerName,</span>
<a href="#l128.62"></a><span id="l128.62">                         NS_LITERAL_CSTRING(&quot;pop3&quot;),</span>
<a href="#l128.63"></a><span id="l128.63">                         getter_AddRefs(in));</span>
<a href="#l128.64"></a><span id="l128.64">   if (NS_SUCCEEDED(rv))</span>
<a href="#l128.65"></a><span id="l128.65">     return true;</span>
<a href="#l128.66"></a><span id="l128.66" class="difflineat">@@ -478,69 +478,69 @@ void OutlookSettings::SetIdentities(nsIM</span>
<a href="#l128.67"></a><span id="l128.67">     // The default identity, nor any other identities matched,</span>
<a href="#l128.68"></a><span id="l128.68">     // create a new one and add it to the account.</span>
<a href="#l128.69"></a><span id="l128.69">     rv = aMgr-&gt;CreateIdentity(getter_AddRefs(id));</span>
<a href="#l128.70"></a><span id="l128.70">     if (id) {</span>
<a href="#l128.71"></a><span id="l128.71">       id-&gt;SetFullName(name);</span>
<a href="#l128.72"></a><span id="l128.72">       id-&gt;SetIdentityName(name);</span>
<a href="#l128.73"></a><span id="l128.73">       id-&gt;SetOrganization(orgName);</span>
<a href="#l128.74"></a><span id="l128.74"> </span>
<a href="#l128.75"></a><span id="l128.75" class="difflineminus">-      nsCAutoString nativeEmail;</span>
<a href="#l128.76"></a><span id="l128.76" class="difflineplus">+      nsAutoCString nativeEmail;</span>
<a href="#l128.77"></a><span id="l128.77">       NS_CopyUnicodeToNative(email, nativeEmail);</span>
<a href="#l128.78"></a><span id="l128.78">       id-&gt;SetEmail(nativeEmail);</span>
<a href="#l128.79"></a><span id="l128.79">       if (!reply.IsEmpty()) {</span>
<a href="#l128.80"></a><span id="l128.80" class="difflineminus">-        nsCAutoString nativeReply;</span>
<a href="#l128.81"></a><span id="l128.81" class="difflineplus">+        nsAutoCString nativeReply;</span>
<a href="#l128.82"></a><span id="l128.82">         NS_CopyUnicodeToNative(reply, nativeReply);</span>
<a href="#l128.83"></a><span id="l128.83">         id-&gt;SetReplyTo(nativeReply);</span>
<a href="#l128.84"></a><span id="l128.84">       }</span>
<a href="#l128.85"></a><span id="l128.85">       aAcc-&gt;AddIdentity(id);</span>
<a href="#l128.86"></a><span id="l128.86"> </span>
<a href="#l128.87"></a><span id="l128.87" class="difflineminus">-      nsCAutoString nativeName;</span>
<a href="#l128.88"></a><span id="l128.88" class="difflineplus">+      nsAutoCString nativeName;</span>
<a href="#l128.89"></a><span id="l128.89">       NS_CopyUnicodeToNative(name, nativeName);</span>
<a href="#l128.90"></a><span id="l128.90">       IMPORT_LOG0(&quot;Created identity and added to the account\n&quot;);</span>
<a href="#l128.91"></a><span id="l128.91">       IMPORT_LOG1(&quot;\tname: %s\n&quot;, nativeName.get());</span>
<a href="#l128.92"></a><span id="l128.92">       IMPORT_LOG1(&quot;\temail: %s\n&quot;, nativeEmail.get());</span>
<a href="#l128.93"></a><span id="l128.93">     }</span>
<a href="#l128.94"></a><span id="l128.94">   }</span>
<a href="#l128.95"></a><span id="l128.95"> </span>
<a href="#l128.96"></a><span id="l128.96">   if (userName.IsEmpty()) {</span>
<a href="#l128.97"></a><span id="l128.97">     nsCOMPtr&lt;nsIMsgIncomingServer&gt;  incomingServer;</span>
<a href="#l128.98"></a><span id="l128.98">     rv = aAcc-&gt;GetIncomingServer(getter_AddRefs(incomingServer));</span>
<a href="#l128.99"></a><span id="l128.99">     if (NS_SUCCEEDED(rv) &amp;&amp; incomingServer) {</span>
<a href="#l128.100"></a><span id="l128.100" class="difflineminus">-      nsCAutoString nativeUserName;</span>
<a href="#l128.101"></a><span id="l128.101" class="difflineplus">+      nsAutoCString nativeUserName;</span>
<a href="#l128.102"></a><span id="l128.102">       rv = incomingServer-&gt;GetUsername(nativeUserName);</span>
<a href="#l128.103"></a><span id="l128.103">       NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Unable to get UserName from incomingServer&quot;);</span>
<a href="#l128.104"></a><span id="l128.104">       NS_CopyNativeToUnicode(nativeUserName, userName);</span>
<a href="#l128.105"></a><span id="l128.105">     }</span>
<a href="#l128.106"></a><span id="l128.106">   }</span>
<a href="#l128.107"></a><span id="l128.107"> </span>
<a href="#l128.108"></a><span id="l128.108">   SetSmtpServer(aMgr, aAcc, id, server, userName);</span>
<a href="#l128.109"></a><span id="l128.109"> }</span>
<a href="#l128.110"></a><span id="l128.110"> </span>
<a href="#l128.111"></a><span id="l128.111"> nsresult OutlookSettings::SetSmtpServerKey(nsIMsgIdentity *aId,</span>
<a href="#l128.112"></a><span id="l128.112">                                            nsISmtpServer *aServer)</span>
<a href="#l128.113"></a><span id="l128.113"> {</span>
<a href="#l128.114"></a><span id="l128.114" class="difflineminus">-  nsCAutoString smtpServerKey;</span>
<a href="#l128.115"></a><span id="l128.115" class="difflineplus">+  nsAutoCString smtpServerKey;</span>
<a href="#l128.116"></a><span id="l128.116">   aServer-&gt;GetKey(getter_Copies(smtpServerKey));</span>
<a href="#l128.117"></a><span id="l128.117">   return aId-&gt;SetSmtpServerKey(smtpServerKey);</span>
<a href="#l128.118"></a><span id="l128.118"> }</span>
<a href="#l128.119"></a><span id="l128.119"> </span>
<a href="#l128.120"></a><span id="l128.120"> nsresult OutlookSettings::SetSmtpServer(nsIMsgAccountManager *aMgr,</span>
<a href="#l128.121"></a><span id="l128.121">                                         nsIMsgAccount *aAcc,</span>
<a href="#l128.122"></a><span id="l128.122">                                         nsIMsgIdentity *aId,</span>
<a href="#l128.123"></a><span id="l128.123">                                         const nsString &amp;aServer,</span>
<a href="#l128.124"></a><span id="l128.124">                                         const nsString &amp;aUser)</span>
<a href="#l128.125"></a><span id="l128.125"> {</span>
<a href="#l128.126"></a><span id="l128.126">   nsresult rv;</span>
<a href="#l128.127"></a><span id="l128.127">   nsCOMPtr&lt;nsISmtpService&gt; smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l128.128"></a><span id="l128.128">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l128.129"></a><span id="l128.129"> </span>
<a href="#l128.130"></a><span id="l128.130" class="difflineminus">-  nsCAutoString nativeUserName;</span>
<a href="#l128.131"></a><span id="l128.131" class="difflineplus">+  nsAutoCString nativeUserName;</span>
<a href="#l128.132"></a><span id="l128.132">   NS_CopyUnicodeToNative(aUser, nativeUserName);</span>
<a href="#l128.133"></a><span id="l128.133" class="difflineminus">-  nsCAutoString nativeServerName;</span>
<a href="#l128.134"></a><span id="l128.134" class="difflineplus">+  nsAutoCString nativeServerName;</span>
<a href="#l128.135"></a><span id="l128.135">   NS_CopyUnicodeToNative(aServer, nativeServerName);</span>
<a href="#l128.136"></a><span id="l128.136">   nsCOMPtr&lt;nsISmtpServer&gt; foundServer;</span>
<a href="#l128.137"></a><span id="l128.137">   rv = smtpService-&gt;FindServer(nativeUserName.get(),</span>
<a href="#l128.138"></a><span id="l128.138">                                nativeServerName.get(),</span>
<a href="#l128.139"></a><span id="l128.139">                                getter_AddRefs(foundServer));</span>
<a href="#l128.140"></a><span id="l128.140">   if (NS_SUCCEEDED(rv) &amp;&amp; foundServer) {</span>
<a href="#l128.141"></a><span id="l128.141">     if (aId)</span>
<a href="#l128.142"></a><span id="l128.142">       SetSmtpServerKey(aId, foundServer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -295,17 +295,17 @@ NS_IMETHODIMP nsImportGenericAddressBook</span>
<a href="#l129.4"></a><span id="l129.4">   if (!PL_strcasecmp(dataId, &quot;addressDestination&quot;)) {</span>
<a href="#l129.5"></a><span id="l129.5">     if (item) {</span>
<a href="#l129.6"></a><span id="l129.6">       nsCOMPtr&lt;nsISupportsCString&gt; abString;</span>
<a href="#l129.7"></a><span id="l129.7">       item-&gt;QueryInterface(NS_GET_IID(nsISupportsCString), getter_AddRefs(abString));</span>
<a href="#l129.8"></a><span id="l129.8">       if (abString) {</span>
<a href="#l129.9"></a><span id="l129.9">         if (m_pDestinationUri)</span>
<a href="#l129.10"></a><span id="l129.10">           NS_Free(m_pDestinationUri);</span>
<a href="#l129.11"></a><span id="l129.11">         m_pDestinationUri = nullptr;</span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-                nsCAutoString tempUri;</span>
<a href="#l129.13"></a><span id="l129.13" class="difflineplus">+                nsAutoCString tempUri;</span>
<a href="#l129.14"></a><span id="l129.14">                 abString-&gt;GetData(tempUri);</span>
<a href="#l129.15"></a><span id="l129.15">                 m_pDestinationUri = ToNewCString(tempUri);</span>
<a href="#l129.16"></a><span id="l129.16">       }</span>
<a href="#l129.17"></a><span id="l129.17">     }</span>
<a href="#l129.18"></a><span id="l129.18">   }</span>
<a href="#l129.19"></a><span id="l129.19"> </span>
<a href="#l129.20"></a><span id="l129.20">   if (!PL_strcasecmp(dataId, &quot;fieldMap&quot;)) {</span>
<a href="#l129.21"></a><span id="l129.21">     NS_IF_RELEASE(m_pFieldMap);</span>
<a href="#l129.22"></a><span id="l129.22" class="difflineat">@@ -565,18 +565,18 @@ already_AddRefed&lt;nsIAddrDatabase&gt; GetAdd</span>
<a href="#l129.23"></a><span id="l129.23">     // This is major bogosity again!  Why doesn't the address book</span>
<a href="#l129.24"></a><span id="l129.24">     // just handle this properly for me?  Uggggg...</span>
<a href="#l129.25"></a><span id="l129.25"> </span>
<a href="#l129.26"></a><span id="l129.26">     nsCOMPtr&lt;nsIAbDirectory&gt; parentDir;</span>
<a href="#l129.27"></a><span id="l129.27">     abManager-&gt;GetDirectory(NS_LITERAL_CSTRING(kAllDirectoryRoot),</span>
<a href="#l129.28"></a><span id="l129.28">                             getter_AddRefs(parentDir));</span>
<a href="#l129.29"></a><span id="l129.29">     if (parentDir)</span>
<a href="#l129.30"></a><span id="l129.30">     {</span>
<a href="#l129.31"></a><span id="l129.31" class="difflineminus">-      nsCAutoString URI(&quot;moz-abmdbdirectory://&quot;);</span>
<a href="#l129.32"></a><span id="l129.32" class="difflineminus">-      nsCAutoString leafName;</span>
<a href="#l129.33"></a><span id="l129.33" class="difflineplus">+      nsAutoCString URI(&quot;moz-abmdbdirectory://&quot;);</span>
<a href="#l129.34"></a><span id="l129.34" class="difflineplus">+      nsAutoCString leafName;</span>
<a href="#l129.35"></a><span id="l129.35">       rv = dbPath-&gt;GetNativeLeafName(leafName);</span>
<a href="#l129.36"></a><span id="l129.36">       if (NS_FAILED(rv))</span>
<a href="#l129.37"></a><span id="l129.37">         IMPORT_LOG0(&quot;*** Error: Unable to get name of database file\n&quot;);</span>
<a href="#l129.38"></a><span id="l129.38">       else</span>
<a href="#l129.39"></a><span id="l129.39">       {</span>
<a href="#l129.40"></a><span id="l129.40">         URI.Append(leafName);</span>
<a href="#l129.41"></a><span id="l129.41">         rv = parentDir-&gt;CreateDirectoryByURI(nsDependentString(name), URI);</span>
<a href="#l129.42"></a><span id="l129.42">         if (NS_FAILED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l130.1"></a><span id="l130.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l130.2"></a><span id="l130.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l130.3"></a><span id="l130.3" class="difflineat">@@ -42,17 +42,17 @@ nsTextAddress::~nsTextAddress()</span>
<a href="#l130.4"></a><span id="l130.4">     NS_IF_RELEASE(m_database);</span>
<a href="#l130.5"></a><span id="l130.5">     NS_IF_RELEASE(m_fieldMap);</span>
<a href="#l130.6"></a><span id="l130.6"> }</span>
<a href="#l130.7"></a><span id="l130.7"> </span>
<a href="#l130.8"></a><span id="l130.8"> nsresult nsTextAddress::GetUnicharLineStreamForFile(nsIFile *aFile,</span>
<a href="#l130.9"></a><span id="l130.9">                                                     nsIInputStream *aInputStream,</span>
<a href="#l130.10"></a><span id="l130.10">                                                     nsIUnicharLineInputStream **aStream)</span>
<a href="#l130.11"></a><span id="l130.11"> {</span>
<a href="#l130.12"></a><span id="l130.12" class="difflineminus">-  nsCAutoString charset;</span>
<a href="#l130.13"></a><span id="l130.13" class="difflineplus">+  nsAutoCString charset;</span>
<a href="#l130.14"></a><span id="l130.14">   nsresult rv = MsgDetectCharsetFromFile(aFile, charset);</span>
<a href="#l130.15"></a><span id="l130.15">   if (NS_FAILED(rv)) {</span>
<a href="#l130.16"></a><span id="l130.16">     IMPORT_LOG0( &quot;*** Error checking address file for charset detection\n&quot;);</span>
<a href="#l130.17"></a><span id="l130.17">     return rv;</span>
<a href="#l130.18"></a><span id="l130.18">   }</span>
<a href="#l130.19"></a><span id="l130.19"> </span>
<a href="#l130.20"></a><span id="l130.20">   nsCOMPtr&lt;nsIConverterInputStream&gt; converterStream =</span>
<a href="#l130.21"></a><span id="l130.21">     do_CreateInstance(&quot;@mozilla.org/intl/converter-input-stream;1&quot;, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l131.1"></a><span id="l131.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l131.2"></a><span id="l131.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l131.3"></a><span id="l131.3" class="difflineat">@@ -188,17 +188,17 @@ bool WMSettings::DoImport(nsIMsgAccount </span>
<a href="#l131.4"></a><span id="l131.4">   // Loop through *.oeaccounts files looking for POP3 &amp; IMAP &amp; NNTP accounts</span>
<a href="#l131.5"></a><span id="l131.5">   // Ignore LDAP for now!</span>
<a href="#l131.6"></a><span id="l131.6">   int accounts = 0;</span>
<a href="#l131.7"></a><span id="l131.7">   nsCOMPtr&lt;nsIDOMDocument&gt; xmlDoc;</span>
<a href="#l131.8"></a><span id="l131.8"> </span>
<a href="#l131.9"></a><span id="l131.9">   for (int32_t i = fileArray.Count() - 1 ; i &gt;= 0; i--){</span>
<a href="#l131.10"></a><span id="l131.10">     nsWMUtils::MakeXMLdoc(getter_AddRefs(xmlDoc), fileArray[i]);</span>
<a href="#l131.11"></a><span id="l131.11"> </span>
<a href="#l131.12"></a><span id="l131.12" class="difflineminus">-    nsCAutoString name;</span>
<a href="#l131.13"></a><span id="l131.13" class="difflineplus">+    nsAutoCString name;</span>
<a href="#l131.14"></a><span id="l131.14">     fileArray[i]-&gt;GetNativeLeafName(name);</span>
<a href="#l131.15"></a><span id="l131.15">     nsAutoString value;</span>
<a href="#l131.16"></a><span id="l131.16">     nsCOMPtr&lt;nsIMsgAccount&gt; anAccount;</span>
<a href="#l131.17"></a><span id="l131.17">     if (NS_SUCCEEDED(nsWMUtils::GetValueForTag(xmlDoc,</span>
<a href="#l131.18"></a><span id="l131.18">                                                &quot;IMAP_Server&quot;,</span>
<a href="#l131.19"></a><span id="l131.19">                                                value)))</span>
<a href="#l131.20"></a><span id="l131.20">       if (DoIMAPServer(accMgr, xmlDoc, value, getter_AddRefs(anAccount)))</span>
<a href="#l131.21"></a><span id="l131.21">         accounts++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l132.1"></a><span id="l132.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l132.2"></a><span id="l132.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l132.3"></a><span id="l132.3" class="difflineat">@@ -488,20 +488,20 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Crea</span>
<a href="#l132.4"></a><span id="l132.4">   nsresult rv;</span>
<a href="#l132.5"></a><span id="l132.5">   nsCOMPtr&lt;nsIMsgFolder&gt; msgParent;</span>
<a href="#l132.6"></a><span id="l132.6">   GetParent(getter_AddRefs(msgParent));</span>
<a href="#l132.7"></a><span id="l132.7"> </span>
<a href="#l132.8"></a><span id="l132.8">   // parent is probably not set because *this* was probably created by rdf</span>
<a href="#l132.9"></a><span id="l132.9">   // and not by folder discovery. So, we have to compute the parent.</span>
<a href="#l132.10"></a><span id="l132.10">   if (!msgParent)</span>
<a href="#l132.11"></a><span id="l132.11">   {</span>
<a href="#l132.12"></a><span id="l132.12" class="difflineminus">-    nsCAutoString folderName(mURI);</span>
<a href="#l132.13"></a><span id="l132.13" class="difflineminus">-    nsCAutoString uri;</span>
<a href="#l132.14"></a><span id="l132.14" class="difflineplus">+    nsAutoCString folderName(mURI);</span>
<a href="#l132.15"></a><span id="l132.15" class="difflineplus">+    nsAutoCString uri;</span>
<a href="#l132.16"></a><span id="l132.16">     int32_t leafPos = folderName.RFindChar('/');</span>
<a href="#l132.17"></a><span id="l132.17" class="difflineminus">-    nsCAutoString parentName(folderName);</span>
<a href="#l132.18"></a><span id="l132.18" class="difflineplus">+    nsAutoCString parentName(folderName);</span>
<a href="#l132.19"></a><span id="l132.19">     if (leafPos &gt; 0)</span>
<a href="#l132.20"></a><span id="l132.20">     {</span>
<a href="#l132.21"></a><span id="l132.21">       // If there is a hierarchy, there is a parent.</span>
<a href="#l132.22"></a><span id="l132.22">       // Don't strip off slash if it's the first character</span>
<a href="#l132.23"></a><span id="l132.23">       parentName.SetLength(leafPos);</span>
<a href="#l132.24"></a><span id="l132.24">       // get the corresponding RDF resource</span>
<a href="#l132.25"></a><span id="l132.25">       // RDF will create the folder resource if it doesn't already exist</span>
<a href="#l132.26"></a><span id="l132.26">       nsCOMPtr&lt;nsIRDFService&gt; rdf = do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;, &amp;rv);</span>
<a href="#l132.27"></a><span id="l132.27" class="difflineat">@@ -1918,17 +1918,17 @@ nsresult nsMsgLocalMailFolder::WriteStar</span>
<a href="#l132.28"></a><span id="l132.28">     if (mCopyState-&gt;m_parseMsgState-&gt;m_newMsgHdr)</span>
<a href="#l132.29"></a><span id="l132.29">       mCopyState-&gt;m_parseMsgState-&gt;m_newMsgHdr-&gt;GetMessageKey(&amp;mCopyState-&gt;m_curDstKey);</span>
<a href="#l132.30"></a><span id="l132.30">     mCopyState-&gt;m_parseMsgState-&gt;SetEnvelopePos(filePos);</span>
<a href="#l132.31"></a><span id="l132.31">     mCopyState-&gt;m_parseMsgState-&gt;SetState(nsIMsgParseMailMsgState::ParseHeadersState);</span>
<a href="#l132.32"></a><span id="l132.32">   }</span>
<a href="#l132.33"></a><span id="l132.33">   if (mCopyState-&gt;m_dummyEnvelopeNeeded)</span>
<a href="#l132.34"></a><span id="l132.34">   {</span>
<a href="#l132.35"></a><span id="l132.35">     nsCString result;</span>
<a href="#l132.36"></a><span id="l132.36" class="difflineminus">-    nsCAutoString nowStr;</span>
<a href="#l132.37"></a><span id="l132.37" class="difflineplus">+    nsAutoCString nowStr;</span>
<a href="#l132.38"></a><span id="l132.38">     MsgGenerateNowStr(nowStr);</span>
<a href="#l132.39"></a><span id="l132.39">     result.AppendLiteral(&quot;From - &quot;);</span>
<a href="#l132.40"></a><span id="l132.40">     result.Append(nowStr);</span>
<a href="#l132.41"></a><span id="l132.41">     result.Append(MSG_LINEBREAK);</span>
<a href="#l132.42"></a><span id="l132.42"> </span>
<a href="#l132.43"></a><span id="l132.43">     // *** jt - hard code status line for now; come back later</span>
<a href="#l132.44"></a><span id="l132.44">     nsresult rv;</span>
<a href="#l132.45"></a><span id="l132.45">     nsCOMPtr &lt;nsIMsgDBHdr&gt; curSourceMessage = do_QueryElementAt(mCopyState-&gt;m_messages,</span>
<a href="#l132.46"></a><span id="l132.46" class="difflineat">@@ -2167,23 +2167,23 @@ nsMsgLocalMailFolder::CopyHdrPropertiesW</span>
<a href="#l132.47"></a><span id="l132.47">   nsresult rv = srcHdr-&gt;GetPropertyEnumerator(getter_AddRefs(propertyEnumerator));</span>
<a href="#l132.48"></a><span id="l132.48">   NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l132.49"></a><span id="l132.49"> </span>
<a href="#l132.50"></a><span id="l132.50">   // We'll add spaces at beginning and end so we can search for space-name-space</span>
<a href="#l132.51"></a><span id="l132.51">   nsCString dontPreserveEx(NS_LITERAL_CSTRING(&quot; &quot;));</span>
<a href="#l132.52"></a><span id="l132.52">   dontPreserveEx.Append(skipList);</span>
<a href="#l132.53"></a><span id="l132.53">   dontPreserveEx.AppendLiteral(&quot; &quot;);</span>
<a href="#l132.54"></a><span id="l132.54"> </span>
<a href="#l132.55"></a><span id="l132.55" class="difflineminus">-  nsCAutoString property;</span>
<a href="#l132.56"></a><span id="l132.56" class="difflineplus">+  nsAutoCString property;</span>
<a href="#l132.57"></a><span id="l132.57">   nsCString sourceString;</span>
<a href="#l132.58"></a><span id="l132.58">   bool hasMore;</span>
<a href="#l132.59"></a><span id="l132.59">   while (NS_SUCCEEDED(propertyEnumerator-&gt;HasMore(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l132.60"></a><span id="l132.60">   {</span>
<a href="#l132.61"></a><span id="l132.61">     propertyEnumerator-&gt;GetNext(property);</span>
<a href="#l132.62"></a><span id="l132.62" class="difflineminus">-    nsCAutoString propertyEx(NS_LITERAL_CSTRING(&quot; &quot;));</span>
<a href="#l132.63"></a><span id="l132.63" class="difflineplus">+    nsAutoCString propertyEx(NS_LITERAL_CSTRING(&quot; &quot;));</span>
<a href="#l132.64"></a><span id="l132.64">     propertyEx.Append(property);</span>
<a href="#l132.65"></a><span id="l132.65">     propertyEx.AppendLiteral(&quot; &quot;);</span>
<a href="#l132.66"></a><span id="l132.66">     if (dontPreserveEx.Find(propertyEx) != -1) // -1 is not found</span>
<a href="#l132.67"></a><span id="l132.67">       continue;</span>
<a href="#l132.68"></a><span id="l132.68"> </span>
<a href="#l132.69"></a><span id="l132.69">     srcHdr-&gt;GetStringProperty(property.get(), getter_Copies(sourceString));</span>
<a href="#l132.70"></a><span id="l132.70">     destHdr-&gt;SetStringProperty(property.get(), sourceString.get());</span>
<a href="#l132.71"></a><span id="l132.71">   }</span>
<a href="#l132.72"></a><span id="l132.72" class="difflineat">@@ -2903,17 +2903,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Sele</span>
<a href="#l132.73"></a><span id="l132.73">       return rv;</span>
<a href="#l132.74"></a><span id="l132.74">     }</span>
<a href="#l132.75"></a><span id="l132.75">     mDatabase-&gt;NotifyKeyDeletedAll(mDownloadOldKey, mDownloadOldParent, mDownloadOldFlags, nullptr);</span>
<a href="#l132.76"></a><span id="l132.76">   }</span>
<a href="#l132.77"></a><span id="l132.77"> #endif</span>
<a href="#l132.78"></a><span id="l132.78"> </span>
<a href="#l132.79"></a><span id="l132.79">   if (mDownloadState == DOWNLOAD_STATE_GOTMSG &amp;&amp; mDownloadWindow)</span>
<a href="#l132.80"></a><span id="l132.80">   {</span>
<a href="#l132.81"></a><span id="l132.81" class="difflineminus">-    nsCAutoString newuri;</span>
<a href="#l132.82"></a><span id="l132.82" class="difflineplus">+    nsAutoCString newuri;</span>
<a href="#l132.83"></a><span id="l132.83">     nsBuildLocalMessageURI(mBaseMessageURI.get(), mDownloadSelectKey, newuri);</span>
<a href="#l132.84"></a><span id="l132.84">     nsCOMPtr&lt;nsIMsgWindowCommands&gt; windowCommands;</span>
<a href="#l132.85"></a><span id="l132.85">     mDownloadWindow-&gt;GetWindowCommands(getter_AddRefs(windowCommands));</span>
<a href="#l132.86"></a><span id="l132.86">     if (windowCommands)</span>
<a href="#l132.87"></a><span id="l132.87">       windowCommands-&gt;SelectMessage(newuri);</span>
<a href="#l132.88"></a><span id="l132.88">     mDownloadState = DOWNLOAD_STATE_DIDSEL;</span>
<a href="#l132.89"></a><span id="l132.89">   }</span>
<a href="#l132.90"></a><span id="l132.90">   return NS_OK;</span>
<a href="#l132.91"></a><span id="l132.91" class="difflineat">@@ -3029,17 +3029,17 @@ nsresult nsMsgLocalMailFolder::CreateBas</span>
<a href="#l132.92"></a><span id="l132.92"> </span>
<a href="#l132.93"></a><span id="l132.93"> NS_IMETHODIMP</span>
<a href="#l132.94"></a><span id="l132.94"> nsMsgLocalMailFolder::OnStartRunningUrl(nsIURI * aUrl)</span>
<a href="#l132.95"></a><span id="l132.95"> {</span>
<a href="#l132.96"></a><span id="l132.96">   nsresult rv;</span>
<a href="#l132.97"></a><span id="l132.97">   nsCOMPtr&lt;nsIPop3URL&gt; popurl = do_QueryInterface(aUrl, &amp;rv);</span>
<a href="#l132.98"></a><span id="l132.98">   if (NS_SUCCEEDED(rv))</span>
<a href="#l132.99"></a><span id="l132.99">   {</span>
<a href="#l132.100"></a><span id="l132.100" class="difflineminus">-    nsCAutoString aSpec;</span>
<a href="#l132.101"></a><span id="l132.101" class="difflineplus">+    nsAutoCString aSpec;</span>
<a href="#l132.102"></a><span id="l132.102">     aUrl-&gt;GetSpec(aSpec);</span>
<a href="#l132.103"></a><span id="l132.103">     if (strstr(aSpec.get(), &quot;uidl=&quot;))</span>
<a href="#l132.104"></a><span id="l132.104">     {</span>
<a href="#l132.105"></a><span id="l132.105">       nsCOMPtr&lt;nsIPop3Sink&gt; popsink;</span>
<a href="#l132.106"></a><span id="l132.106">       rv = popurl-&gt;GetPop3Sink(getter_AddRefs(popsink));</span>
<a href="#l132.107"></a><span id="l132.107">       if (NS_SUCCEEDED(rv))</span>
<a href="#l132.108"></a><span id="l132.108">       {</span>
<a href="#l132.109"></a><span id="l132.109">         popsink-&gt;SetBaseMessageUri(mBaseMessageURI.get());</span>
<a href="#l132.110"></a><span id="l132.110" class="difflineat">@@ -3066,17 +3066,17 @@ nsMsgLocalMailFolder::OnStopRunningUrl(n</span>
<a href="#l132.111"></a><span id="l132.111"> </span>
<a href="#l132.112"></a><span id="l132.112">   nsresult rv;</span>
<a href="#l132.113"></a><span id="l132.113">   if (NS_SUCCEEDED(aExitCode))</span>
<a href="#l132.114"></a><span id="l132.114">   {</span>
<a href="#l132.115"></a><span id="l132.115">     nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l132.116"></a><span id="l132.116">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l132.117"></a><span id="l132.117">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l132.118"></a><span id="l132.118">     rv = mailSession-&gt;GetTopmostMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l132.119"></a><span id="l132.119" class="difflineminus">-    nsCAutoString aSpec;</span>
<a href="#l132.120"></a><span id="l132.120" class="difflineplus">+    nsAutoCString aSpec;</span>
<a href="#l132.121"></a><span id="l132.121">     if (aUrl)</span>
<a href="#l132.122"></a><span id="l132.122">     aUrl-&gt;GetSpec(aSpec);</span>
<a href="#l132.123"></a><span id="l132.123"> </span>
<a href="#l132.124"></a><span id="l132.124">     if (strstr(aSpec.get(), &quot;uidl=&quot;))</span>
<a href="#l132.125"></a><span id="l132.125">     {</span>
<a href="#l132.126"></a><span id="l132.126">       nsCOMPtr&lt;nsIPop3URL&gt; popurl = do_QueryInterface(aUrl, &amp;rv);</span>
<a href="#l132.127"></a><span id="l132.127">       if (NS_SUCCEEDED(rv))</span>
<a href="#l132.128"></a><span id="l132.128">       {</span>
<a href="#l132.129"></a><span id="l132.129" class="difflineat">@@ -3237,17 +3237,17 @@ nsMsgLocalMailFolder::SetFlagsOnDefaultM</span>
<a href="#l132.130"></a><span id="l132.130">   return NS_OK;</span>
<a href="#l132.131"></a><span id="l132.131"> }</span>
<a href="#l132.132"></a><span id="l132.132"> </span>
<a href="#l132.133"></a><span id="l132.133"> nsresult</span>
<a href="#l132.134"></a><span id="l132.134"> nsMsgLocalMailFolder::setSubfolderFlag(const nsAString&amp; aFolderName, uint32_t flags)</span>
<a href="#l132.135"></a><span id="l132.135"> {</span>
<a href="#l132.136"></a><span id="l132.136">   // FindSubFolder() expects the folder name to be escaped</span>
<a href="#l132.137"></a><span id="l132.137">   // see bug #192043</span>
<a href="#l132.138"></a><span id="l132.138" class="difflineminus">-  nsCAutoString escapedFolderName;</span>
<a href="#l132.139"></a><span id="l132.139" class="difflineplus">+  nsAutoCString escapedFolderName;</span>
<a href="#l132.140"></a><span id="l132.140">   nsresult rv = NS_MsgEscapeEncodeURLPath(aFolderName, escapedFolderName);</span>
<a href="#l132.141"></a><span id="l132.141">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l132.142"></a><span id="l132.142">   nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l132.143"></a><span id="l132.143">   rv = FindSubFolder(escapedFolderName, getter_AddRefs(msgFolder));</span>
<a href="#l132.144"></a><span id="l132.144">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l132.145"></a><span id="l132.145"> </span>
<a href="#l132.146"></a><span id="l132.146">   // we only want to do this if the folder *really* exists,</span>
<a href="#l132.147"></a><span id="l132.147">   // so check if it has a parent. Otherwise, we'll create the</span>
<a href="#l132.148"></a><span id="l132.148" class="difflineat">@@ -3412,17 +3412,17 @@ nsMsgLocalMailFolder::OnMessageClassifie</span>
<a href="#l132.149"></a><span id="l132.149">         nsCOMPtr&lt;nsIMsgCopyService&gt; copySvc = do_GetService(NS_MSGCOPYSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l132.150"></a><span id="l132.150">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l132.151"></a><span id="l132.151"> </span>
<a href="#l132.152"></a><span id="l132.152">         rv = copySvc-&gt;CopyMessages(this, messages, folder, true,</span>
<a href="#l132.153"></a><span id="l132.153">           /*nsIMsgCopyServiceListener* listener*/ nullptr, nullptr, false /*allowUndo*/);</span>
<a href="#l132.154"></a><span id="l132.154">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;CopyMessages failed&quot;);</span>
<a href="#l132.155"></a><span id="l132.155">         if (NS_FAILED(rv))</span>
<a href="#l132.156"></a><span id="l132.156">         {</span>
<a href="#l132.157"></a><span id="l132.157" class="difflineminus">-          nsCAutoString logMsg(&quot;failed to copy junk messages to junk folder rv = &quot;);</span>
<a href="#l132.158"></a><span id="l132.158" class="difflineplus">+          nsAutoCString logMsg(&quot;failed to copy junk messages to junk folder rv = &quot;);</span>
<a href="#l132.159"></a><span id="l132.159">           logMsg.AppendInt(rv, 16);</span>
<a href="#l132.160"></a><span id="l132.160">           spamSettings-&gt;LogJunkString(logMsg.get());</span>
<a href="#l132.161"></a><span id="l132.161">         }</span>
<a href="#l132.162"></a><span id="l132.162">       }</span>
<a href="#l132.163"></a><span id="l132.163">     }</span>
<a href="#l132.164"></a><span id="l132.164">     int32_t numNewMessages;</span>
<a href="#l132.165"></a><span id="l132.165">     GetNumNewMessages(false, &amp;numNewMessages);</span>
<a href="#l132.166"></a><span id="l132.166">     uint32_t length;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l133.1"></a><span id="l133.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l133.2"></a><span id="l133.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l133.3"></a><span id="l133.3" class="difflineat">@@ -126,17 +126,17 @@ nsLocalURI2Path(const char* rootURI, con</span>
<a href="#l133.4"></a><span id="l133.4"> </span>
<a href="#l133.5"></a><span id="l133.5">   // verify that rootURI starts with &quot;mailbox:/&quot; or &quot;mailbox-message:/&quot;</span>
<a href="#l133.6"></a><span id="l133.6">   if ((PL_strcmp(rootURI, kMailboxRootURI) != 0) &amp;&amp; </span>
<a href="#l133.7"></a><span id="l133.7">       (PL_strcmp(rootURI, kMailboxMessageRootURI) != 0)) {</span>
<a href="#l133.8"></a><span id="l133.8">     return NS_ERROR_FAILURE;</span>
<a href="#l133.9"></a><span id="l133.9">   }</span>
<a href="#l133.10"></a><span id="l133.10"> </span>
<a href="#l133.11"></a><span id="l133.11">   // verify that uristr starts with rooturi</span>
<a href="#l133.12"></a><span id="l133.12" class="difflineminus">-  nsCAutoString uri(uriStr);</span>
<a href="#l133.13"></a><span id="l133.13" class="difflineplus">+  nsAutoCString uri(uriStr);</span>
<a href="#l133.14"></a><span id="l133.14">   if (uri.Find(rootURI) != 0)</span>
<a href="#l133.15"></a><span id="l133.15">     return NS_ERROR_FAILURE;</span>
<a href="#l133.16"></a><span id="l133.16"> </span>
<a href="#l133.17"></a><span id="l133.17"> </span>
<a href="#l133.18"></a><span id="l133.18">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l133.19"></a><span id="l133.19">   rv = nsLocalURI2Server(uriStr, getter_AddRefs(server));</span>
<a href="#l133.20"></a><span id="l133.20"> </span>
<a href="#l133.21"></a><span id="l133.21">   if (NS_FAILED(rv))</span>
<a href="#l133.22"></a><span id="l133.22" class="difflineat">@@ -154,17 +154,17 @@ nsLocalURI2Path(const char* rootURI, con</span>
<a href="#l133.23"></a><span id="l133.23">   nsEscapeNativePath(localNativePath);</span>
<a href="#l133.24"></a><span id="l133.24">   pathResult = localNativePath.get();</span>
<a href="#l133.25"></a><span id="l133.25">   const char *curPos = uriStr + PL_strlen(rootURI);</span>
<a href="#l133.26"></a><span id="l133.26">   if (curPos) {</span>
<a href="#l133.27"></a><span id="l133.27">     // advance past hostname</span>
<a href="#l133.28"></a><span id="l133.28">     while ((*curPos)=='/') curPos++;</span>
<a href="#l133.29"></a><span id="l133.29">     while (*curPos &amp;&amp; (*curPos)!='/') curPos++;</span>
<a href="#l133.30"></a><span id="l133.30"> </span>
<a href="#l133.31"></a><span id="l133.31" class="difflineminus">-    nsCAutoString newPath(&quot;&quot;);</span>
<a href="#l133.32"></a><span id="l133.32" class="difflineplus">+    nsAutoCString newPath(&quot;&quot;);</span>
<a href="#l133.33"></a><span id="l133.33"> </span>
<a href="#l133.34"></a><span id="l133.34">     // Unescape folder name</span>
<a href="#l133.35"></a><span id="l133.35">     if (curPos) {</span>
<a href="#l133.36"></a><span id="l133.36">       nsCString unescapedStr;</span>
<a href="#l133.37"></a><span id="l133.37">       MsgUnescapeString(nsDependentCString(curPos), 0, unescapedStr);</span>
<a href="#l133.38"></a><span id="l133.38">       NS_MsgCreatePathStringFromFolderURI(unescapedStr.get(), newPath, NS_LITERAL_CSTRING(&quot;none&quot;));</span>
<a href="#l133.39"></a><span id="l133.39">     } else</span>
<a href="#l133.40"></a><span id="l133.40">       NS_MsgCreatePathStringFromFolderURI(curPos, newPath, NS_LITERAL_CSTRING(&quot;none&quot;));</span>
<a href="#l133.41"></a><span id="l133.41" class="difflineat">@@ -185,25 +185,25 @@ nsLocalURI2Path(const char* rootURI, con</span>
<a href="#l133.42"></a><span id="l133.42">  */</span>
<a href="#l133.43"></a><span id="l133.43"> nsresult nsParseLocalMessageURI(const char* uri,</span>
<a href="#l133.44"></a><span id="l133.44">                                 nsCString&amp; folderURI,</span>
<a href="#l133.45"></a><span id="l133.45">                                 uint32_t *key)</span>
<a href="#l133.46"></a><span id="l133.46"> {</span>
<a href="#l133.47"></a><span id="l133.47">   if(!key)</span>
<a href="#l133.48"></a><span id="l133.48">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l133.49"></a><span id="l133.49"> </span>
<a href="#l133.50"></a><span id="l133.50" class="difflineminus">-  nsCAutoString uriStr(uri);</span>
<a href="#l133.51"></a><span id="l133.51" class="difflineplus">+  nsAutoCString uriStr(uri);</span>
<a href="#l133.52"></a><span id="l133.52">   int32_t keySeparator = uriStr.FindChar('#');</span>
<a href="#l133.53"></a><span id="l133.53">   if(keySeparator != -1)</span>
<a href="#l133.54"></a><span id="l133.54">   {</span>
<a href="#l133.55"></a><span id="l133.55">     int32_t keyEndSeparator = MsgFindCharInSet(uriStr, &quot;?&amp;&quot;, keySeparator);</span>
<a href="#l133.56"></a><span id="l133.56">     folderURI = StringHead(uriStr, keySeparator);</span>
<a href="#l133.57"></a><span id="l133.57">     folderURI.Cut(7, 8);    // cut out the -message part of mailbox-message:</span>
<a href="#l133.58"></a><span id="l133.58"> </span>
<a href="#l133.59"></a><span id="l133.59" class="difflineminus">-    nsCAutoString keyStr;</span>
<a href="#l133.60"></a><span id="l133.60" class="difflineplus">+    nsAutoCString keyStr;</span>
<a href="#l133.61"></a><span id="l133.61">     if (keyEndSeparator != -1)</span>
<a href="#l133.62"></a><span id="l133.62">       keyStr = Substring(uriStr, keySeparator + 1,</span>
<a href="#l133.63"></a><span id="l133.63">                          keyEndSeparator - (keySeparator + 1));</span>
<a href="#l133.64"></a><span id="l133.64">     else</span>
<a href="#l133.65"></a><span id="l133.65">       keyStr = StringTail(uriStr, uriStr.Length() - (keySeparator + 1));</span>
<a href="#l133.66"></a><span id="l133.66"> </span>
<a href="#l133.67"></a><span id="l133.67">     *key = (uint32_t) ParseUint64Str(keyStr.get());</span>
<a href="#l133.68"></a><span id="l133.68">     return NS_OK;</span>
<a href="#l133.69"></a><span id="l133.69" class="difflineat">@@ -220,17 +220,17 @@ nsresult nsBuildLocalMessageURI(const ch</span>
<a href="#l133.70"></a><span id="l133.70">   uri.Append(baseURI);</span>
<a href="#l133.71"></a><span id="l133.71">   uri.Append('#');</span>
<a href="#l133.72"></a><span id="l133.72">   uri.AppendInt(key);</span>
<a href="#l133.73"></a><span id="l133.73">   return NS_OK;</span>
<a href="#l133.74"></a><span id="l133.74"> }</span>
<a href="#l133.75"></a><span id="l133.75"> </span>
<a href="#l133.76"></a><span id="l133.76"> nsresult nsCreateLocalBaseMessageURI(const nsACString&amp; baseURI, nsCString &amp;baseMessageURI)</span>
<a href="#l133.77"></a><span id="l133.77"> {</span>
<a href="#l133.78"></a><span id="l133.78" class="difflineminus">-  nsCAutoString tailURI(baseURI);</span>
<a href="#l133.79"></a><span id="l133.79" class="difflineplus">+  nsAutoCString tailURI(baseURI);</span>
<a href="#l133.80"></a><span id="l133.80"> </span>
<a href="#l133.81"></a><span id="l133.81">   // chop off mailbox:/</span>
<a href="#l133.82"></a><span id="l133.82">   if (tailURI.Find(kMailboxRootURI) == 0)</span>
<a href="#l133.83"></a><span id="l133.83">     tailURI.Cut(0, PL_strlen(kMailboxRootURI));</span>
<a href="#l133.84"></a><span id="l133.84">   </span>
<a href="#l133.85"></a><span id="l133.85">   baseMessageURI = kMailboxMessageRootURI;</span>
<a href="#l133.86"></a><span id="l133.86">   baseMessageURI += tailURI;</span>
<a href="#l133.87"></a><span id="l133.87"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l134.1"></a><span id="l134.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxProtocol.cpp</span>
<a href="#l134.2"></a><span id="l134.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxProtocol.cpp</span>
<a href="#l134.3"></a><span id="l134.3" class="difflineat">@@ -462,17 +462,17 @@ nsresult nsMailboxProtocol::LoadUrl(nsIU</span>
<a href="#l134.4"></a><span id="l134.4"> </span>
<a href="#l134.5"></a><span id="l134.5">       // need to check if we're fetching an rfc822 part in order to</span>
<a href="#l134.6"></a><span id="l134.6">       // quote a message.</span>
<a href="#l134.7"></a><span id="l134.7">       if (m_mailboxAction == nsIMailboxUrl::ActionFetchMessage)</span>
<a href="#l134.8"></a><span id="l134.8">       {</span>
<a href="#l134.9"></a><span id="l134.9">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl = do_QueryInterface(m_runningUrl, &amp;rv);</span>
<a href="#l134.10"></a><span id="l134.10">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l134.11"></a><span id="l134.11"> </span>
<a href="#l134.12"></a><span id="l134.12" class="difflineminus">-        nsCAutoString queryStr;</span>
<a href="#l134.13"></a><span id="l134.13" class="difflineplus">+        nsAutoCString queryStr;</span>
<a href="#l134.14"></a><span id="l134.14">         rv = msgUrl-&gt;GetQuery(queryStr);</span>
<a href="#l134.15"></a><span id="l134.15">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l134.16"></a><span id="l134.16"> </span>
<a href="#l134.17"></a><span id="l134.17">         // check if this is a filter plugin requesting the message.</span>
<a href="#l134.18"></a><span id="l134.18">         // in that case, set up a text converter</span>
<a href="#l134.19"></a><span id="l134.19">         convertData = (queryStr.Find(&quot;header=filter&quot;) != -1 ||</span>
<a href="#l134.20"></a><span id="l134.20">                        queryStr.Find(&quot;header=attach&quot;) != -1);</span>
<a href="#l134.21"></a><span id="l134.21">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l135.1"></a><span id="l135.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l135.2"></a><span id="l135.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l135.3"></a><span id="l135.3" class="difflineat">@@ -47,23 +47,23 @@ nsresult nsMailboxService::ParseMailbox(</span>
<a href="#l135.4"></a><span id="l135.4">     do_CreateInstance(NS_MAILBOXURL_CONTRACTID, &amp;rv);</span>
<a href="#l135.5"></a><span id="l135.5">   if (NS_SUCCEEDED(rv) &amp;&amp; mailboxurl)</span>
<a href="#l135.6"></a><span id="l135.6">   {</span>
<a href="#l135.7"></a><span id="l135.7">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url = do_QueryInterface(mailboxurl);</span>
<a href="#l135.8"></a><span id="l135.8">     // okay now generate the url string</span>
<a href="#l135.9"></a><span id="l135.9">     nsCString mailboxPath;</span>
<a href="#l135.10"></a><span id="l135.10"> </span>
<a href="#l135.11"></a><span id="l135.11">     aMailboxPath-&gt;GetNativePath(mailboxPath);</span>
<a href="#l135.12"></a><span id="l135.12" class="difflineminus">-    nsCAutoString buf;</span>
<a href="#l135.13"></a><span id="l135.13" class="difflineplus">+    nsAutoCString buf;</span>
<a href="#l135.14"></a><span id="l135.14">     MsgEscapeURL(mailboxPath,</span>
<a href="#l135.15"></a><span id="l135.15">                  nsINetUtil::ESCAPE_URL_MINIMAL | nsINetUtil::ESCAPE_URL_FORCED, buf);</span>
<a href="#l135.16"></a><span id="l135.16">     nsEscapeNativePath(buf);</span>
<a href="#l135.17"></a><span id="l135.17">     url-&gt;SetUpdatingFolder(true);</span>
<a href="#l135.18"></a><span id="l135.18">     url-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l135.19"></a><span id="l135.19" class="difflineminus">-    nsCAutoString uriSpec(&quot;mailbox://&quot;);</span>
<a href="#l135.20"></a><span id="l135.20" class="difflineplus">+    nsAutoCString uriSpec(&quot;mailbox://&quot;);</span>
<a href="#l135.21"></a><span id="l135.21">     uriSpec.Append(buf);</span>
<a href="#l135.22"></a><span id="l135.22">     rv = url-&gt;SetSpec(uriSpec);</span>
<a href="#l135.23"></a><span id="l135.23">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l135.24"></a><span id="l135.24"> </span>
<a href="#l135.25"></a><span id="l135.25">     mailboxurl-&gt;SetMailboxParser(aMailboxParser);</span>
<a href="#l135.26"></a><span id="l135.26">     if (aUrlListener)</span>
<a href="#l135.27"></a><span id="l135.27">       url-&gt;RegisterListener(aUrlListener);</span>
<a href="#l135.28"></a><span id="l135.28"> </span>
<a href="#l135.29"></a><span id="l135.29" class="difflineat">@@ -150,17 +150,17 @@ nsresult nsMailboxService::FetchMessage(</span>
<a href="#l135.30"></a><span id="l135.30">                                         const char * aCharsetOverride,</span>
<a href="#l135.31"></a><span id="l135.31">                                         nsIURI ** aURL)</span>
<a href="#l135.32"></a><span id="l135.32"> {</span>
<a href="#l135.33"></a><span id="l135.33">   nsresult rv = NS_OK;</span>
<a href="#l135.34"></a><span id="l135.34">   nsCOMPtr&lt;nsIMailboxUrl&gt; mailboxurl;</span>
<a href="#l135.35"></a><span id="l135.35">   nsMailboxAction actionToUse = mailboxAction;</span>
<a href="#l135.36"></a><span id="l135.36">   nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l135.37"></a><span id="l135.37">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl;</span>
<a href="#l135.38"></a><span id="l135.38" class="difflineminus">-  nsCAutoString uriString(aMessageURI);</span>
<a href="#l135.39"></a><span id="l135.39" class="difflineplus">+  nsAutoCString uriString(aMessageURI);</span>
<a href="#l135.40"></a><span id="l135.40"> </span>
<a href="#l135.41"></a><span id="l135.41">   if (!strncmp(aMessageURI, &quot;file:&quot;, 5))</span>
<a href="#l135.42"></a><span id="l135.42">   {</span>
<a href="#l135.43"></a><span id="l135.43">     int64_t fileSize;</span>
<a href="#l135.44"></a><span id="l135.44">     nsCOMPtr&lt;nsIURI&gt; fileUri;</span>
<a href="#l135.45"></a><span id="l135.45">     rv = NS_NewURI(getter_AddRefs(fileUri), aMessageURI);</span>
<a href="#l135.46"></a><span id="l135.46">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l135.47"></a><span id="l135.47">     nsCOMPtr &lt;nsIFileURL&gt; fileUrl = do_QueryInterface(fileUri, &amp;rv);</span>
<a href="#l135.48"></a><span id="l135.48" class="difflineat">@@ -283,17 +283,17 @@ nsMailboxService::StreamMessage(const ch</span>
<a href="#l135.49"></a><span id="l135.49">                                 const nsACString &amp;aAdditionalHeader,</span>
<a href="#l135.50"></a><span id="l135.50">                                 bool aLocalOnly,</span>
<a href="#l135.51"></a><span id="l135.51">                                 nsIURI **aURL)</span>
<a href="#l135.52"></a><span id="l135.52"> {</span>
<a href="#l135.53"></a><span id="l135.53">     // The mailbox protocol object will look for &quot;header=filter&quot; or</span>
<a href="#l135.54"></a><span id="l135.54">     // &quot;header=attach&quot; to decide if it wants to convert the data instead of</span>
<a href="#l135.55"></a><span id="l135.55">     // using aConvertData. It turns out to be way too hard to pass aConvertData</span>
<a href="#l135.56"></a><span id="l135.56">     // all the way over to the mailbox protocol object.</span>
<a href="#l135.57"></a><span id="l135.57" class="difflineminus">-    nsCAutoString aURIString(aMessageURI);</span>
<a href="#l135.58"></a><span id="l135.58" class="difflineplus">+    nsAutoCString aURIString(aMessageURI);</span>
<a href="#l135.59"></a><span id="l135.59">     if (!aAdditionalHeader.IsEmpty())</span>
<a href="#l135.60"></a><span id="l135.60">     {</span>
<a href="#l135.61"></a><span id="l135.61">       aURIString.FindChar('?') == -1 ? aURIString += &quot;?&quot; : aURIString += &quot;&amp;&quot;;</span>
<a href="#l135.62"></a><span id="l135.62">       aURIString += &quot;header=&quot;;</span>
<a href="#l135.63"></a><span id="l135.63">       aURIString += aAdditionalHeader;</span>
<a href="#l135.64"></a><span id="l135.64">     }</span>
<a href="#l135.65"></a><span id="l135.65"> </span>
<a href="#l135.66"></a><span id="l135.66">     return FetchMessage(aURIString.get(), aConsumer, aMsgWindow, aUrlListener, nullptr,</span>
<a href="#l135.67"></a><span id="l135.67" class="difflineat">@@ -303,17 +303,17 @@ nsMailboxService::StreamMessage(const ch</span>
<a href="#l135.68"></a><span id="l135.68"> NS_IMETHODIMP nsMailboxService::StreamHeaders(const char *aMessageURI,</span>
<a href="#l135.69"></a><span id="l135.69">                                               nsIStreamListener *aConsumer,</span>
<a href="#l135.70"></a><span id="l135.70">                                               nsIUrlListener *aUrlListener,</span>
<a href="#l135.71"></a><span id="l135.71">                                               bool aLocalOnly,</span>
<a href="#l135.72"></a><span id="l135.72">                                               nsIURI **aURL)</span>
<a href="#l135.73"></a><span id="l135.73"> {</span>
<a href="#l135.74"></a><span id="l135.74">   NS_ENSURE_ARG_POINTER(aMessageURI);</span>
<a href="#l135.75"></a><span id="l135.75">   NS_ENSURE_ARG_POINTER(aConsumer);</span>
<a href="#l135.76"></a><span id="l135.76" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l135.77"></a><span id="l135.77" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l135.78"></a><span id="l135.78">   nsMsgKey msgKey;</span>
<a href="#l135.79"></a><span id="l135.79">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l135.80"></a><span id="l135.80">   nsresult rv = DecomposeMailboxURI(aMessageURI, getter_AddRefs(folder), &amp;msgKey);</span>
<a href="#l135.81"></a><span id="l135.81">   if (msgKey == nsMsgKey_None)</span>
<a href="#l135.82"></a><span id="l135.82">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l135.83"></a><span id="l135.83"> </span>
<a href="#l135.84"></a><span id="l135.84">   nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l135.85"></a><span id="l135.85">   int64_t messageOffset;</span>
<a href="#l135.86"></a><span id="l135.86" class="difflineat">@@ -336,17 +336,17 @@ NS_IMETHODIMP nsMailboxService::OpenAtta</span>
<a href="#l135.87"></a><span id="l135.87">                                                const char *aFileName,</span>
<a href="#l135.88"></a><span id="l135.88">                                                const char *aUrl,</span>
<a href="#l135.89"></a><span id="l135.89">                                                const char *aMessageUri,</span>
<a href="#l135.90"></a><span id="l135.90">                                                nsISupports *aDisplayConsumer,</span>
<a href="#l135.91"></a><span id="l135.91">                                                nsIMsgWindow *aMsgWindow,</span>
<a href="#l135.92"></a><span id="l135.92">                                                nsIUrlListener *aUrlListener)</span>
<a href="#l135.93"></a><span id="l135.93"> {</span>
<a href="#l135.94"></a><span id="l135.94">   nsCOMPtr &lt;nsIURI&gt; URL;</span>
<a href="#l135.95"></a><span id="l135.95" class="difflineminus">-  nsCAutoString urlString(aUrl);</span>
<a href="#l135.96"></a><span id="l135.96" class="difflineplus">+  nsAutoCString urlString(aUrl);</span>
<a href="#l135.97"></a><span id="l135.97">   urlString += &quot;&amp;type=&quot;;</span>
<a href="#l135.98"></a><span id="l135.98">   urlString += aContentType;</span>
<a href="#l135.99"></a><span id="l135.99">   urlString += &quot;&amp;filename=&quot;;</span>
<a href="#l135.100"></a><span id="l135.100">   urlString += aFileName;</span>
<a href="#l135.101"></a><span id="l135.101">   CreateStartupUrl(urlString.get(), getter_AddRefs(URL));</span>
<a href="#l135.102"></a><span id="l135.102">   nsresult rv;</span>
<a href="#l135.103"></a><span id="l135.103"> </span>
<a href="#l135.104"></a><span id="l135.104">   // try to run the url in the docshell...</span>
<a href="#l135.105"></a><span id="l135.105" class="difflineat">@@ -448,29 +448,29 @@ nsresult nsMailboxService::PrepareMessag</span>
<a href="#l135.106"></a><span id="l135.106">                                              nsMailboxAction aMailboxAction, nsIMailboxUrl ** aMailboxUrl,</span>
<a href="#l135.107"></a><span id="l135.107">                                              nsIMsgWindow *msgWindow)</span>
<a href="#l135.108"></a><span id="l135.108"> {</span>
<a href="#l135.109"></a><span id="l135.109">   nsresult rv = CallCreateInstance(NS_MAILBOXURL_CONTRACTID, aMailboxUrl);</span>
<a href="#l135.110"></a><span id="l135.110">   if (NS_SUCCEEDED(rv) &amp;&amp; aMailboxUrl &amp;&amp; *aMailboxUrl)</span>
<a href="#l135.111"></a><span id="l135.111">   {</span>
<a href="#l135.112"></a><span id="l135.112">     // okay now generate the url string</span>
<a href="#l135.113"></a><span id="l135.113">     char * urlSpec;</span>
<a href="#l135.114"></a><span id="l135.114" class="difflineminus">-    nsCAutoString folderURI;</span>
<a href="#l135.115"></a><span id="l135.115" class="difflineplus">+    nsAutoCString folderURI;</span>
<a href="#l135.116"></a><span id="l135.116">     nsMsgKey msgKey;</span>
<a href="#l135.117"></a><span id="l135.117">     nsCString folderPath;</span>
<a href="#l135.118"></a><span id="l135.118">     const char *part = PL_strstr(aSrcMsgMailboxURI, &quot;part=&quot;);</span>
<a href="#l135.119"></a><span id="l135.119">     const char *header = PL_strstr(aSrcMsgMailboxURI, &quot;header=&quot;);</span>
<a href="#l135.120"></a><span id="l135.120">     rv = nsParseLocalMessageURI(aSrcMsgMailboxURI, folderURI, &amp;msgKey);</span>
<a href="#l135.121"></a><span id="l135.121">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l135.122"></a><span id="l135.122">     rv = nsLocalURI2Path(kMailboxRootURI, folderURI.get(), folderPath);</span>
<a href="#l135.123"></a><span id="l135.123"> </span>
<a href="#l135.124"></a><span id="l135.124">     if (NS_SUCCEEDED(rv))</span>
<a href="#l135.125"></a><span id="l135.125">     {</span>
<a href="#l135.126"></a><span id="l135.126">       // set up the url spec and initialize the url with it.</span>
<a href="#l135.127"></a><span id="l135.127" class="difflineminus">-      nsCAutoString buf;</span>
<a href="#l135.128"></a><span id="l135.128" class="difflineplus">+      nsAutoCString buf;</span>
<a href="#l135.129"></a><span id="l135.129">       MsgEscapeURL(folderPath,</span>
<a href="#l135.130"></a><span id="l135.130">                    nsINetUtil::ESCAPE_URL_DIRECTORY | nsINetUtil::ESCAPE_URL_FORCED, buf);</span>
<a href="#l135.131"></a><span id="l135.131">       if (mPrintingOperation)</span>
<a href="#l135.132"></a><span id="l135.132">         urlSpec = PR_smprintf(&quot;mailbox://%s?number=%lu&amp;header=print&quot;, buf.get(), msgKey);</span>
<a href="#l135.133"></a><span id="l135.133">       else if (part)</span>
<a href="#l135.134"></a><span id="l135.134">         urlSpec = PR_smprintf(&quot;mailbox://%s?number=%lu&amp;%s&quot;, buf.get(), msgKey, part);</span>
<a href="#l135.135"></a><span id="l135.135">       else if (header)</span>
<a href="#l135.136"></a><span id="l135.136">         urlSpec = PR_smprintf(&quot;mailbox://%s?number=%lu&amp;%s&quot;, buf.get(), msgKey, header);</span>
<a href="#l135.137"></a><span id="l135.137" class="difflineat">@@ -547,17 +547,17 @@ NS_IMETHODIMP nsMailboxService::NewURI(c</span>
<a href="#l135.138"></a><span id="l135.138">   nsCOMPtr&lt;nsIURI&gt; aMsgUri = do_CreateInstance(NS_MAILBOXURL_CONTRACTID, &amp;rv);</span>
<a href="#l135.139"></a><span id="l135.139">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l135.140"></a><span id="l135.140">   // SetSpec calls below may fail if the mailbox url is of the form</span>
<a href="#l135.141"></a><span id="l135.141">   // mailbox://&lt;account&gt;/&lt;mailbox name&gt;?... instead of</span>
<a href="#l135.142"></a><span id="l135.142">   // mailbox://&lt;path to folder&gt;?.... This is the case for pop3 download urls.</span>
<a href="#l135.143"></a><span id="l135.143">   // We know this, and the failure is harmless.</span>
<a href="#l135.144"></a><span id="l135.144">   if (aBaseURI)</span>
<a href="#l135.145"></a><span id="l135.145">   {</span>
<a href="#l135.146"></a><span id="l135.146" class="difflineminus">-    nsCAutoString newSpec;</span>
<a href="#l135.147"></a><span id="l135.147" class="difflineplus">+    nsAutoCString newSpec;</span>
<a href="#l135.148"></a><span id="l135.148">     rv = aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l135.149"></a><span id="l135.149">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l135.150"></a><span id="l135.150">     (void) aMsgUri-&gt;SetSpec(newSpec);</span>
<a href="#l135.151"></a><span id="l135.151">   }</span>
<a href="#l135.152"></a><span id="l135.152">   else</span>
<a href="#l135.153"></a><span id="l135.153">   {</span>
<a href="#l135.154"></a><span id="l135.154">     (void) aMsgUri-&gt;SetSpec(aSpec);</span>
<a href="#l135.155"></a><span id="l135.155">   }</span>
<a href="#l135.156"></a><span id="l135.156" class="difflineat">@@ -566,17 +566,17 @@ NS_IMETHODIMP nsMailboxService::NewURI(c</span>
<a href="#l135.157"></a><span id="l135.157">   return rv;</span>
<a href="#l135.158"></a><span id="l135.158"> }</span>
<a href="#l135.159"></a><span id="l135.159"> </span>
<a href="#l135.160"></a><span id="l135.160"> NS_IMETHODIMP nsMailboxService::NewChannel(nsIURI *aURI, nsIChannel **_retval)</span>
<a href="#l135.161"></a><span id="l135.161"> {</span>
<a href="#l135.162"></a><span id="l135.162">   NS_ENSURE_ARG_POINTER(aURI);</span>
<a href="#l135.163"></a><span id="l135.163">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l135.164"></a><span id="l135.164">   nsresult rv = NS_OK;</span>
<a href="#l135.165"></a><span id="l135.165" class="difflineminus">-  nsCAutoString spec;</span>
<a href="#l135.166"></a><span id="l135.166" class="difflineplus">+  nsAutoCString spec;</span>
<a href="#l135.167"></a><span id="l135.167">   aURI-&gt;GetSpec(spec);</span>
<a href="#l135.168"></a><span id="l135.168"> </span>
<a href="#l135.169"></a><span id="l135.169">   if (spec.Find(&quot;?uidl=&quot;) &gt;= 0 || spec.Find(&quot;&amp;uidl=&quot;) &gt;= 0)</span>
<a href="#l135.170"></a><span id="l135.170">   {</span>
<a href="#l135.171"></a><span id="l135.171">     nsCOMPtr&lt;nsIProtocolHandler&gt; handler =</span>
<a href="#l135.172"></a><span id="l135.172">              do_GetService(NS_POP3SERVICE_CONTRACTID1, &amp;rv);</span>
<a href="#l135.173"></a><span id="l135.173">     if (NS_SUCCEEDED(rv))</span>
<a href="#l135.174"></a><span id="l135.174">     {</span>
<a href="#l135.175"></a><span id="l135.175" class="difflineat">@@ -625,17 +625,17 @@ NS_IMETHODIMP nsMailboxService::Search(n</span>
<a href="#l135.176"></a><span id="l135.176"> nsresult</span>
<a href="#l135.177"></a><span id="l135.177"> nsMailboxService::DecomposeMailboxURI(const char * aMessageURI, nsIMsgFolder ** aFolder, nsMsgKey *aMsgKey)</span>
<a href="#l135.178"></a><span id="l135.178"> {</span>
<a href="#l135.179"></a><span id="l135.179">   NS_ENSURE_ARG_POINTER(aMessageURI);</span>
<a href="#l135.180"></a><span id="l135.180">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l135.181"></a><span id="l135.181">   NS_ENSURE_ARG_POINTER(aMsgKey);</span>
<a href="#l135.182"></a><span id="l135.182"> </span>
<a href="#l135.183"></a><span id="l135.183">   nsresult rv = NS_OK;</span>
<a href="#l135.184"></a><span id="l135.184" class="difflineminus">-  nsCAutoString folderURI;</span>
<a href="#l135.185"></a><span id="l135.185" class="difflineplus">+  nsAutoCString folderURI;</span>
<a href="#l135.186"></a><span id="l135.186">   rv = nsParseLocalMessageURI(aMessageURI, folderURI, aMsgKey);</span>
<a href="#l135.187"></a><span id="l135.187">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l135.188"></a><span id="l135.188"> </span>
<a href="#l135.189"></a><span id="l135.189">   nsCOMPtr &lt;nsIRDFService&gt; rdf = do_GetService(&quot;@mozilla.org/rdf/rdf-service;1&quot;,&amp;rv);</span>
<a href="#l135.190"></a><span id="l135.190">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l135.191"></a><span id="l135.191"> </span>
<a href="#l135.192"></a><span id="l135.192">   nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l135.193"></a><span id="l135.193">   rv = rdf-&gt;GetResource(folderURI, getter_AddRefs(res));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l136.1"></a><span id="l136.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l136.2"></a><span id="l136.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l136.3"></a><span id="l136.3" class="difflineat">@@ -149,30 +149,30 @@ NS_IMETHODIMP nsMailboxUrl::GetUri(char </span>
<a href="#l136.4"></a><span id="l136.4">   // otherwise try to reconstruct a URI on the fly....</span>
<a href="#l136.5"></a><span id="l136.5"> </span>
<a href="#l136.6"></a><span id="l136.6">   if (!mURI.IsEmpty())</span>
<a href="#l136.7"></a><span id="l136.7">     *aURI = ToNewCString(mURI);</span>
<a href="#l136.8"></a><span id="l136.8">   else</span>
<a href="#l136.9"></a><span id="l136.9">   {</span>
<a href="#l136.10"></a><span id="l136.10">     if (m_filePath)</span>
<a href="#l136.11"></a><span id="l136.11">     {</span>
<a href="#l136.12"></a><span id="l136.12" class="difflineminus">-      nsCAutoString baseUri;</span>
<a href="#l136.13"></a><span id="l136.13" class="difflineplus">+      nsAutoCString baseUri;</span>
<a href="#l136.14"></a><span id="l136.14">       nsresult rv;</span>
<a href="#l136.15"></a><span id="l136.15">       nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l136.16"></a><span id="l136.16">         do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l136.17"></a><span id="l136.17">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l136.18"></a><span id="l136.18"> </span>
<a href="#l136.19"></a><span id="l136.19">       // we blow off errors here so that we can open attachments</span>
<a href="#l136.20"></a><span id="l136.20">       // in .eml files.</span>
<a href="#l136.21"></a><span id="l136.21">       (void) accountManager-&gt;FolderUriForPath(m_filePath, baseUri);</span>
<a href="#l136.22"></a><span id="l136.22">       if (baseUri.IsEmpty())</span>
<a href="#l136.23"></a><span id="l136.23">         m_baseURL-&gt;GetSpec(baseUri);</span>
<a href="#l136.24"></a><span id="l136.24">       nsCString baseMessageURI;</span>
<a href="#l136.25"></a><span id="l136.25">       nsCreateLocalBaseMessageURI(baseUri, baseMessageURI);</span>
<a href="#l136.26"></a><span id="l136.26" class="difflineminus">-      nsCAutoString uriStr;</span>
<a href="#l136.27"></a><span id="l136.27" class="difflineplus">+      nsAutoCString uriStr;</span>
<a href="#l136.28"></a><span id="l136.28">       nsBuildLocalMessageURI(baseMessageURI.get(), m_messageKey, uriStr);</span>
<a href="#l136.29"></a><span id="l136.29">       *aURI = ToNewCString(uriStr);</span>
<a href="#l136.30"></a><span id="l136.30">     }</span>
<a href="#l136.31"></a><span id="l136.31">     else</span>
<a href="#l136.32"></a><span id="l136.32">       *aURI = nullptr;</span>
<a href="#l136.33"></a><span id="l136.33">   }</span>
<a href="#l136.34"></a><span id="l136.34"> </span>
<a href="#l136.35"></a><span id="l136.35">   return NS_OK;</span>
<a href="#l136.36"></a><span id="l136.36" class="difflineat">@@ -303,17 +303,17 @@ NS_IMETHODIMP nsMailboxUrl::IsUrlType(ui</span>
<a href="#l136.37"></a><span id="l136.37"> // End nsIMailboxUrl specific support</span>
<a href="#l136.38"></a><span id="l136.38"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l136.39"></a><span id="l136.39"> </span>
<a href="#l136.40"></a><span id="l136.40"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l136.41"></a><span id="l136.41"> // possible search part phrases include: MessageID=id&amp;number=MessageKey</span>
<a href="#l136.42"></a><span id="l136.42"> </span>
<a href="#l136.43"></a><span id="l136.43"> nsresult nsMailboxUrl::ParseSearchPart()</span>
<a href="#l136.44"></a><span id="l136.44"> {</span>
<a href="#l136.45"></a><span id="l136.45" class="difflineminus">-  nsCAutoString searchPart;</span>
<a href="#l136.46"></a><span id="l136.46" class="difflineplus">+  nsAutoCString searchPart;</span>
<a href="#l136.47"></a><span id="l136.47">   nsresult rv = GetQuery(searchPart);</span>
<a href="#l136.48"></a><span id="l136.48">   // add code to this function to decompose everything past the '?'.....</span>
<a href="#l136.49"></a><span id="l136.49">   if (NS_SUCCEEDED(rv) &amp;&amp; !searchPart.IsEmpty())</span>
<a href="#l136.50"></a><span id="l136.50">   {</span>
<a href="#l136.51"></a><span id="l136.51">     // the action for this mailbox must be a display message...</span>
<a href="#l136.52"></a><span id="l136.52">     char * msgPart = extractAttributeValue(searchPart.get(), &quot;part=&quot;);</span>
<a href="#l136.53"></a><span id="l136.53">     if (msgPart)  // if we have a part in the url then we must be fetching just the part.</span>
<a href="#l136.54"></a><span id="l136.54">       m_mailboxAction = nsIMailboxUrl::ActionFetchPart;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l137.1"></a><span id="l137.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l137.2"></a><span id="l137.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l137.3"></a><span id="l137.3" class="difflineat">@@ -186,19 +186,19 @@ bool ObtainSpoolLock(const char *aSpoolN</span>
<a href="#l137.4"></a><span id="l137.4">   //        2b: repeat step 2 until retry-count expired or hard-link succeeds</span>
<a href="#l137.5"></a><span id="l137.5">   // step 3: remove SPOOLNAME.mozlock</span>
<a href="#l137.6"></a><span id="l137.6">   // step 4: If step 2 hard-link failed, fail hard; we do not hold the lock</span>
<a href="#l137.7"></a><span id="l137.7">   // DONE.</span>
<a href="#l137.8"></a><span id="l137.8">   //</span>
<a href="#l137.9"></a><span id="l137.9">   // (step 2a not yet implemented)</span>
<a href="#l137.10"></a><span id="l137.10"> </span>
<a href="#l137.11"></a><span id="l137.11"> </span>
<a href="#l137.12"></a><span id="l137.12" class="difflineminus">-  nsCAutoString mozlockstr(aSpoolName);</span>
<a href="#l137.13"></a><span id="l137.13" class="difflineplus">+  nsAutoCString mozlockstr(aSpoolName);</span>
<a href="#l137.14"></a><span id="l137.14">   mozlockstr.Append(&quot;.mozlock&quot;);</span>
<a href="#l137.15"></a><span id="l137.15" class="difflineminus">-  nsCAutoString lockstr(aSpoolName);</span>
<a href="#l137.16"></a><span id="l137.16" class="difflineplus">+  nsAutoCString lockstr(aSpoolName);</span>
<a href="#l137.17"></a><span id="l137.17">   lockstr.Append(&quot;.lock&quot;);</span>
<a href="#l137.18"></a><span id="l137.18"> </span>
<a href="#l137.19"></a><span id="l137.19">   // Create nsIFile for the spool.mozlock file</span>
<a href="#l137.20"></a><span id="l137.20">   nsCOMPtr&lt;nsIFile&gt; tmplocfile;</span>
<a href="#l137.21"></a><span id="l137.21">   rv = NS_NewNativeLocalFile(mozlockstr, true, getter_AddRefs(tmplocfile));</span>
<a href="#l137.22"></a><span id="l137.22">   if (NS_FAILED(rv))</span>
<a href="#l137.23"></a><span id="l137.23">     return false;</span>
<a href="#l137.24"></a><span id="l137.24">   // THOUGHT: hmm, perhaps use MakeUnique to generate us a unique mozlock?</span>
<a href="#l137.25"></a><span id="l137.25" class="difflineat">@@ -265,17 +265,17 @@ bool YieldSpoolLock(const char *aSpoolNa</span>
<a href="#l137.26"></a><span id="l137.26"> </span>
<a href="#l137.27"></a><span id="l137.27">     bool unlockSucceeded = PR_UnlockFile(fd) == PR_SUCCESS;</span>
<a href="#l137.28"></a><span id="l137.28">     PR_Close(fd);</span>
<a href="#l137.29"></a><span id="l137.29">     if (unlockSucceeded)</span>
<a href="#l137.30"></a><span id="l137.30">       LOG((&quot;YieldSpoolLock was successful.&quot;));</span>
<a href="#l137.31"></a><span id="l137.31">     return unlockSucceeded;</span>
<a href="#l137.32"></a><span id="l137.32">   }</span>
<a href="#l137.33"></a><span id="l137.33"> </span>
<a href="#l137.34"></a><span id="l137.34" class="difflineminus">-  nsCAutoString lockstr(aSpoolName);</span>
<a href="#l137.35"></a><span id="l137.35" class="difflineplus">+  nsAutoCString lockstr(aSpoolName);</span>
<a href="#l137.36"></a><span id="l137.36">   lockstr.Append(&quot;.lock&quot;);</span>
<a href="#l137.37"></a><span id="l137.37"> </span>
<a href="#l137.38"></a><span id="l137.38">   nsresult rv;</span>
<a href="#l137.39"></a><span id="l137.39"> </span>
<a href="#l137.40"></a><span id="l137.40">   // Create nsIFile for the spool.lock file</span>
<a href="#l137.41"></a><span id="l137.41">   nsCOMPtr&lt;nsIFile&gt; locklocfile;</span>
<a href="#l137.42"></a><span id="l137.42">   rv = NS_NewNativeLocalFile(lockstr, true, getter_AddRefs(locklocfile));</span>
<a href="#l137.43"></a><span id="l137.43">   if (NS_FAILED(rv))</span>
<a href="#l137.44"></a><span id="l137.44" class="difflineat">@@ -320,17 +320,17 @@ LocateSpoolFile(nsACString &amp; spoolPath)</span>
<a href="#l137.45"></a><span id="l137.45">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l137.46"></a><span id="l137.46">     rv = spoolFile-&gt;IsFile(&amp;isFile);</span>
<a href="#l137.47"></a><span id="l137.47">     if (NS_SUCCEEDED(rv) &amp;&amp; isFile)</span>
<a href="#l137.48"></a><span id="l137.48">       spoolPath = mailEnv;</span>
<a href="#l137.49"></a><span id="l137.49">   }</span>
<a href="#l137.50"></a><span id="l137.50">   else if (userEnv) {</span>
<a href="#l137.51"></a><span id="l137.51">     // Try to build the mailbox path from the username and a number</span>
<a href="#l137.52"></a><span id="l137.52">     // of guessed spool directory paths.</span>
<a href="#l137.53"></a><span id="l137.53" class="difflineminus">-    nsCAutoString tmpPath;</span>
<a href="#l137.54"></a><span id="l137.54" class="difflineplus">+    nsAutoCString tmpPath;</span>
<a href="#l137.55"></a><span id="l137.55">     uint32_t i;</span>
<a href="#l137.56"></a><span id="l137.56">     for (i = 0; i &lt; NUM_DEFAULT_SPOOL_PATHS; i++) {</span>
<a href="#l137.57"></a><span id="l137.57">       tmpPath = gDefaultSpoolPaths[i];</span>
<a href="#l137.58"></a><span id="l137.58">       tmpPath += userEnv;</span>
<a href="#l137.59"></a><span id="l137.59">       rv = spoolFile-&gt;InitWithNativePath(tmpPath);</span>
<a href="#l137.60"></a><span id="l137.60">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l137.61"></a><span id="l137.61">       rv = spoolFile-&gt;IsFile(&amp;isFile);</span>
<a href="#l137.62"></a><span id="l137.62">       if (NS_SUCCEEDED(rv) &amp;&amp; isFile) {</span>
<a href="#l137.63"></a><span id="l137.63" class="difflineat">@@ -355,17 +355,17 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l137.64"></a><span id="l137.64"> </span>
<a href="#l137.65"></a><span id="l137.65">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; in_server =</span>
<a href="#l137.66"></a><span id="l137.66">       do_QueryInterface(movemailServer);</span>
<a href="#l137.67"></a><span id="l137.67">   if (!in_server)</span>
<a href="#l137.68"></a><span id="l137.68">       return NS_MSG_INVALID_OR_MISSING_SERVER;</span>
<a href="#l137.69"></a><span id="l137.69">   mMsgWindow = aMsgWindow;</span>
<a href="#l137.70"></a><span id="l137.70"> </span>
<a href="#l137.71"></a><span id="l137.71">   // Attempt to locate the mail spool file</span>
<a href="#l137.72"></a><span id="l137.72" class="difflineminus">-  nsCAutoString spoolPath;</span>
<a href="#l137.73"></a><span id="l137.73" class="difflineplus">+  nsAutoCString spoolPath;</span>
<a href="#l137.74"></a><span id="l137.74">   rv = in_server-&gt;GetCharValue(&quot;spoolDir&quot;, spoolPath);</span>
<a href="#l137.75"></a><span id="l137.75">   if (spoolPath.IsEmpty())</span>
<a href="#l137.76"></a><span id="l137.76">     rv = LocateSpoolFile(spoolPath);</span>
<a href="#l137.77"></a><span id="l137.77">   if (NS_FAILED(rv) || spoolPath.IsEmpty()) {</span>
<a href="#l137.78"></a><span id="l137.78">     Error(MOVEMAIL_SPOOL_FILE_NOT_FOUND, nullptr, 0);</span>
<a href="#l137.79"></a><span id="l137.79">     return NS_ERROR_FAILURE;</span>
<a href="#l137.80"></a><span id="l137.80">   }</span>
<a href="#l137.81"></a><span id="l137.81"> </span>
<a href="#l137.82"></a><span id="l137.82" class="difflineat">@@ -424,17 +424,17 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l137.83"></a><span id="l137.83">       lockFile.get()</span>
<a href="#l137.84"></a><span id="l137.84">     };</span>
<a href="#l137.85"></a><span id="l137.85">     Error(MOVEMAIL_CANT_CREATE_LOCK, params, 1);</span>
<a href="#l137.86"></a><span id="l137.86">     return NS_ERROR_FAILURE;</span>
<a href="#l137.87"></a><span id="l137.87">   }</span>
<a href="#l137.88"></a><span id="l137.88"> </span>
<a href="#l137.89"></a><span id="l137.89">   // MIDDLE of the FUN : consume the mailbox data.</span>
<a href="#l137.90"></a><span id="l137.90">   bool isMore = true;</span>
<a href="#l137.91"></a><span id="l137.91" class="difflineminus">-  nsCAutoString buffer;</span>
<a href="#l137.92"></a><span id="l137.92" class="difflineplus">+  nsAutoCString buffer;</span>
<a href="#l137.93"></a><span id="l137.93">   uint32_t bytesWritten;</span>
<a href="#l137.94"></a><span id="l137.94"> </span>
<a href="#l137.95"></a><span id="l137.95">   while (isMore &amp;&amp;</span>
<a href="#l137.96"></a><span id="l137.96">          NS_SUCCEEDED(lineInputStream-&gt;ReadLine(buffer, &amp;isMore)))</span>
<a href="#l137.97"></a><span id="l137.97">   {</span>
<a href="#l137.98"></a><span id="l137.98"> </span>
<a href="#l137.99"></a><span id="l137.99">     // If first string is empty and we're now at EOF then abort parsing.</span>
<a href="#l137.100"></a><span id="l137.100">     if (buffer.IsEmpty() &amp;&amp; !isMore) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l138.1"></a><span id="l138.1" class="difflineminus">--- a/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l138.2"></a><span id="l138.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l138.3"></a><span id="l138.3" class="difflineat">@@ -361,17 +361,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::RenameF</span>
<a href="#l138.4"></a><span id="l138.4">   {</span>
<a href="#l138.5"></a><span id="l138.5">     rv = CreateDirectoryForFolder(dirFile);</span>
<a href="#l138.6"></a><span id="l138.6">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.7"></a><span id="l138.7">   }</span>
<a href="#l138.8"></a><span id="l138.8"> </span>
<a href="#l138.9"></a><span id="l138.9">   nsAutoString safeName(aNewName);</span>
<a href="#l138.10"></a><span id="l138.10">   NS_MsgHashIfNecessary(safeName);</span>
<a href="#l138.11"></a><span id="l138.11"> </span>
<a href="#l138.12"></a><span id="l138.12" class="difflineminus">-  nsCAutoString oldLeafName;</span>
<a href="#l138.13"></a><span id="l138.13" class="difflineplus">+  nsAutoCString oldLeafName;</span>
<a href="#l138.14"></a><span id="l138.14">   oldPathFile-&gt;GetNativeLeafName(oldLeafName);</span>
<a href="#l138.15"></a><span id="l138.15"> </span>
<a href="#l138.16"></a><span id="l138.16">   nsCOMPtr&lt;nsIFile&gt; parentPathFile;</span>
<a href="#l138.17"></a><span id="l138.17">   parentFolder-&gt;GetFilePath(getter_AddRefs(parentPathFile));</span>
<a href="#l138.18"></a><span id="l138.18">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l138.19"></a><span id="l138.19"> </span>
<a href="#l138.20"></a><span id="l138.20">   bool isDirectory = false;</span>
<a href="#l138.21"></a><span id="l138.21">   parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l139.1"></a><span id="l139.1" class="difflineminus">--- a/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l139.2"></a><span id="l139.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l139.3"></a><span id="l139.3" class="difflineat">@@ -80,21 +80,21 @@ nsMsgLocalStoreUtils::ChangeKeywordsHelp</span>
<a href="#l139.4"></a><span id="l139.4">                                            nsIOutputStream *outputStream,</span>
<a href="#l139.5"></a><span id="l139.5">                                            nsISeekableStream *seekableStream,</span>
<a href="#l139.6"></a><span id="l139.6">                                            nsIInputStream *inputStream)</span>
<a href="#l139.7"></a><span id="l139.7"> {</span>
<a href="#l139.8"></a><span id="l139.8">   uint32_t bytesWritten;</span>
<a href="#l139.9"></a><span id="l139.9"> </span>
<a href="#l139.10"></a><span id="l139.10">   for (uint32_t i = 0; i &lt; keywordArray.Length(); i++)</span>
<a href="#l139.11"></a><span id="l139.11">   {</span>
<a href="#l139.12"></a><span id="l139.12" class="difflineminus">-    nsCAutoString header;</span>
<a href="#l139.13"></a><span id="l139.13" class="difflineminus">-    nsCAutoString keywords;</span>
<a href="#l139.14"></a><span id="l139.14" class="difflineplus">+    nsAutoCString header;</span>
<a href="#l139.15"></a><span id="l139.15" class="difflineplus">+    nsAutoCString keywords;</span>
<a href="#l139.16"></a><span id="l139.16">     bool done = false;</span>
<a href="#l139.17"></a><span id="l139.17">     uint32_t len = 0;</span>
<a href="#l139.18"></a><span id="l139.18" class="difflineminus">-    nsCAutoString keywordToWrite(&quot; &quot;);</span>
<a href="#l139.19"></a><span id="l139.19" class="difflineplus">+    nsAutoCString keywordToWrite(&quot; &quot;);</span>
<a href="#l139.20"></a><span id="l139.20"> </span>
<a href="#l139.21"></a><span id="l139.21">     keywordToWrite.Append(keywordArray[i]);</span>
<a href="#l139.22"></a><span id="l139.22">     seekableStream-&gt;Seek(nsISeekableStream::NS_SEEK_SET, desiredOffset);</span>
<a href="#l139.23"></a><span id="l139.23">     // need to reset lineBuffer, which is cheaper than creating a new one.</span>
<a href="#l139.24"></a><span id="l139.24">     lineBuffer-&gt;start = lineBuffer-&gt;end = lineBuffer-&gt;buf;</span>
<a href="#l139.25"></a><span id="l139.25">     bool inKeywordHeader = false;</span>
<a href="#l139.26"></a><span id="l139.26">     bool foundKeyword = false;</span>
<a href="#l139.27"></a><span id="l139.27">     int64_t offsetToAddKeyword = 0;</span>
<a href="#l139.28"></a><span id="l139.28" class="difflineat">@@ -146,17 +146,17 @@ nsMsgLocalStoreUtils::ChangeKeywordsHelp</span>
<a href="#l139.29"></a><span id="l139.29">           done = true;</span>
<a href="#l139.30"></a><span id="l139.30">           break;</span>
<a href="#l139.31"></a><span id="l139.31">         }</span>
<a href="#l139.32"></a><span id="l139.32">         // argh, we need to check all the lines to see if we already have the</span>
<a href="#l139.33"></a><span id="l139.33">         // keyword, but if we don't find it, we want to remember the line and</span>
<a href="#l139.34"></a><span id="l139.34">         // position where we have room to add the keyword.</span>
<a href="#l139.35"></a><span id="l139.35">         if (aAdd)</span>
<a href="#l139.36"></a><span id="l139.36">         {</span>
<a href="#l139.37"></a><span id="l139.37" class="difflineminus">-          nsCAutoString curKeywordHdr(keywordHeaders);</span>
<a href="#l139.38"></a><span id="l139.38" class="difflineplus">+          nsAutoCString curKeywordHdr(keywordHeaders);</span>
<a href="#l139.39"></a><span id="l139.39">           // strip off line ending spaces.</span>
<a href="#l139.40"></a><span id="l139.40">           curKeywordHdr.Trim(&quot; &quot;, false, true);</span>
<a href="#l139.41"></a><span id="l139.41">           if (!offsetToAddKeyword &amp;&amp; curKeywordHdr.Length() +</span>
<a href="#l139.42"></a><span id="l139.42">                 keywordToWrite.Length() &lt; keywordHdrLength)</span>
<a href="#l139.43"></a><span id="l139.43">             offsetToAddKeyword = lineStartPos + curKeywordHdr.Length();</span>
<a href="#l139.44"></a><span id="l139.44">         }</span>
<a href="#l139.45"></a><span id="l139.45">       }</span>
<a href="#l139.46"></a><span id="l139.46">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l140.1"></a><span id="l140.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l140.2"></a><span id="l140.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l140.3"></a><span id="l140.3" class="difflineat">@@ -604,17 +604,17 @@ nsMsgMaildirStore::GetNewMsgOutputStream</span>
<a href="#l140.4"></a><span id="l140.4">   if (!exists) {</span>
<a href="#l140.5"></a><span id="l140.5">     PR_LOG(MailDirLog, PR_LOG_ALWAYS,</span>
<a href="#l140.6"></a><span id="l140.6">            (&quot;GetNewMsgOutputStream - tmp subfolder does not exist!!\n&quot;));</span>
<a href="#l140.7"></a><span id="l140.7">     rv = newFile-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l140.8"></a><span id="l140.8">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.9"></a><span id="l140.9">   }</span>
<a href="#l140.10"></a><span id="l140.10"> </span>
<a href="#l140.11"></a><span id="l140.11">   // generate new file name</span>
<a href="#l140.12"></a><span id="l140.12" class="difflineminus">-  nsCAutoString newName;</span>
<a href="#l140.13"></a><span id="l140.13" class="difflineplus">+  nsAutoCString newName;</span>
<a href="#l140.14"></a><span id="l140.14">   newName.AppendInt(PR_Now());</span>
<a href="#l140.15"></a><span id="l140.15">   newFile-&gt;AppendNative(newName);</span>
<a href="#l140.16"></a><span id="l140.16">   // CreateUnique, in case we get more than one message per millisecond :-)</span>
<a href="#l140.17"></a><span id="l140.17">   newFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 0600);</span>
<a href="#l140.18"></a><span id="l140.18">   newFile-&gt;GetNativeLeafName(newName);</span>
<a href="#l140.19"></a><span id="l140.19">   // save the file name in the message header - otherwise no way to retrieve it</span>
<a href="#l140.20"></a><span id="l140.20">   (*aNewMsgHdr)-&gt;SetStringProperty(&quot;storeToken&quot;, newName.get());</span>
<a href="#l140.21"></a><span id="l140.21">   return MsgNewBufferedFileOutputStream(aResult, newFile,</span>
<a href="#l140.22"></a><span id="l140.22" class="difflineat">@@ -625,17 +625,17 @@ NS_IMETHODIMP</span>
<a href="#l140.23"></a><span id="l140.23"> nsMsgMaildirStore::DiscardNewMessage(nsIOutputStream *aOutputStream,</span>
<a href="#l140.24"></a><span id="l140.24">                                      nsIMsgDBHdr *aNewHdr)</span>
<a href="#l140.25"></a><span id="l140.25"> {</span>
<a href="#l140.26"></a><span id="l140.26">   NS_ENSURE_ARG_POINTER(aOutputStream);</span>
<a href="#l140.27"></a><span id="l140.27">   NS_ENSURE_ARG_POINTER(aNewHdr);</span>
<a href="#l140.28"></a><span id="l140.28"> </span>
<a href="#l140.29"></a><span id="l140.29">   aOutputStream-&gt;Close();</span>
<a href="#l140.30"></a><span id="l140.30">   // file path is stored in message header property &quot;storeToken&quot;</span>
<a href="#l140.31"></a><span id="l140.31" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l140.32"></a><span id="l140.32" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l140.33"></a><span id="l140.33">   aNewHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l140.34"></a><span id="l140.34">   if (fileName.IsEmpty())</span>
<a href="#l140.35"></a><span id="l140.35">     return NS_ERROR_FAILURE;</span>
<a href="#l140.36"></a><span id="l140.36"> </span>
<a href="#l140.37"></a><span id="l140.37">   nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l140.38"></a><span id="l140.38">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l140.39"></a><span id="l140.39">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l140.40"></a><span id="l140.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.41"></a><span id="l140.41" class="difflineat">@@ -661,17 +661,17 @@ nsMsgMaildirStore::FinishNewMessage(nsIO</span>
<a href="#l140.42"></a><span id="l140.42">   nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l140.43"></a><span id="l140.43">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l140.44"></a><span id="l140.44">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l140.45"></a><span id="l140.45">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.46"></a><span id="l140.46">   rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l140.47"></a><span id="l140.47">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.48"></a><span id="l140.48"> </span>
<a href="#l140.49"></a><span id="l140.49">   // file path is stored in message header property</span>
<a href="#l140.50"></a><span id="l140.50" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l140.51"></a><span id="l140.51" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l140.52"></a><span id="l140.52">   aNewHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l140.53"></a><span id="l140.53">   if (fileName.IsEmpty())</span>
<a href="#l140.54"></a><span id="l140.54">   {</span>
<a href="#l140.55"></a><span id="l140.55">     NS_ERROR(&quot;FinishNewMessage - no storeToken in msg hdr!!\n&quot;);</span>
<a href="#l140.56"></a><span id="l140.56">     return NS_ERROR_FAILURE;</span>
<a href="#l140.57"></a><span id="l140.57">   }</span>
<a href="#l140.58"></a><span id="l140.58"> </span>
<a href="#l140.59"></a><span id="l140.59">   // path to the downloaded message</span>
<a href="#l140.60"></a><span id="l140.60" class="difflineat">@@ -717,17 +717,17 @@ nsMsgMaildirStore::MoveNewlyDownloadedMe</span>
<a href="#l140.61"></a><span id="l140.61">   nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l140.62"></a><span id="l140.62">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l140.63"></a><span id="l140.63">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l140.64"></a><span id="l140.64">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.65"></a><span id="l140.65">   rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l140.66"></a><span id="l140.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.67"></a><span id="l140.67"> </span>
<a href="#l140.68"></a><span id="l140.68">   // file path is stored in message header property</span>
<a href="#l140.69"></a><span id="l140.69" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l140.70"></a><span id="l140.70" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l140.71"></a><span id="l140.71">   aNewHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l140.72"></a><span id="l140.72">   if (fileName.IsEmpty())</span>
<a href="#l140.73"></a><span id="l140.73">   {</span>
<a href="#l140.74"></a><span id="l140.74">     NS_ERROR(&quot;FinishNewMessage - no storeToken in msg hdr!!\n&quot;);</span>
<a href="#l140.75"></a><span id="l140.75">     return NS_ERROR_FAILURE;</span>
<a href="#l140.76"></a><span id="l140.76">   }</span>
<a href="#l140.77"></a><span id="l140.77"> </span>
<a href="#l140.78"></a><span id="l140.78">   // path to the downloaded message</span>
<a href="#l140.79"></a><span id="l140.79" class="difflineat">@@ -818,17 +818,17 @@ NS_IMETHODIMP nsMsgMaildirStore::DeleteM</span>
<a href="#l140.80"></a><span id="l140.80">   {</span>
<a href="#l140.81"></a><span id="l140.81">     nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(aHdrArray, i, &amp;rv);</span>
<a href="#l140.82"></a><span id="l140.82">     if (NS_FAILED(rv))</span>
<a href="#l140.83"></a><span id="l140.83">       continue;</span>
<a href="#l140.84"></a><span id="l140.84">     msgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l140.85"></a><span id="l140.85">     nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l140.86"></a><span id="l140.86">     rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l140.87"></a><span id="l140.87">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.88"></a><span id="l140.88" class="difflineminus">-    nsCAutoString fileName;</span>
<a href="#l140.89"></a><span id="l140.89" class="difflineplus">+    nsAutoCString fileName;</span>
<a href="#l140.90"></a><span id="l140.90">     msgHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l140.91"></a><span id="l140.91">     if (fileName.IsEmpty())</span>
<a href="#l140.92"></a><span id="l140.92">       return NS_ERROR_FAILURE;</span>
<a href="#l140.93"></a><span id="l140.93"> </span>
<a href="#l140.94"></a><span id="l140.94">     if (fileName.IsEmpty())</span>
<a href="#l140.95"></a><span id="l140.95">     {</span>
<a href="#l140.96"></a><span id="l140.96">       PR_LOG(MailDirLog, PR_LOG_ALWAYS,</span>
<a href="#l140.97"></a><span id="l140.97">              (&quot;GetMsgInputStream - empty storeToken!!\n&quot;));</span>
<a href="#l140.98"></a><span id="l140.98" class="difflineat">@@ -892,17 +892,17 @@ nsMsgMaildirStore::CopyMessages(bool aIs</span>
<a href="#l140.99"></a><span id="l140.99">       continue;</span>
<a href="#l140.100"></a><span id="l140.100">     nsMsgKey srcKey;</span>
<a href="#l140.101"></a><span id="l140.101">     msgHdr-&gt;GetMessageKey(&amp;srcKey);</span>
<a href="#l140.102"></a><span id="l140.102">     msgTxn-&gt;AddSrcKey(srcKey);</span>
<a href="#l140.103"></a><span id="l140.103">     msgHdr-&gt;GetFolder(getter_AddRefs(srcFolder));</span>
<a href="#l140.104"></a><span id="l140.104">     nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l140.105"></a><span id="l140.105">     rv = srcFolder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l140.106"></a><span id="l140.106">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.107"></a><span id="l140.107" class="difflineminus">-    nsCAutoString fileName;</span>
<a href="#l140.108"></a><span id="l140.108" class="difflineplus">+    nsAutoCString fileName;</span>
<a href="#l140.109"></a><span id="l140.109">     msgHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l140.110"></a><span id="l140.110">     if (fileName.IsEmpty())</span>
<a href="#l140.111"></a><span id="l140.111">       return NS_ERROR_FAILURE;</span>
<a href="#l140.112"></a><span id="l140.112"> </span>
<a href="#l140.113"></a><span id="l140.113">     if (fileName.IsEmpty())</span>
<a href="#l140.114"></a><span id="l140.114">     {</span>
<a href="#l140.115"></a><span id="l140.115">       PR_LOG(MailDirLog, PR_LOG_ALWAYS,</span>
<a href="#l140.116"></a><span id="l140.116">              (&quot;GetMsgInputStream - empty storeToken!!\n&quot;));</span>
<a href="#l140.117"></a><span id="l140.117" class="difflineat">@@ -1052,17 +1052,17 @@ nsresult MaildirStoreParser::ParseNextMe</span>
<a href="#l140.118"></a><span id="l140.118">         NS_Free(newLine);</span>
<a href="#l140.119"></a><span id="l140.119">       }</span>
<a href="#l140.120"></a><span id="l140.120">     } while (newLine &amp;&amp; numBytesInLine &gt; 0);</span>
<a href="#l140.121"></a><span id="l140.121"> </span>
<a href="#l140.122"></a><span id="l140.122">     msgParser-&gt;FinishHeader();</span>
<a href="#l140.123"></a><span id="l140.123">     // A single message needs to be less than 4GB</span>
<a href="#l140.124"></a><span id="l140.124">     newMsgHdr-&gt;SetMessageSize((uint32_t) fileSize);</span>
<a href="#l140.125"></a><span id="l140.125">     m_db-&gt;AddNewHdrToDB(newMsgHdr, true);</span>
<a href="#l140.126"></a><span id="l140.126" class="difflineminus">-    nsCAutoString storeToken;</span>
<a href="#l140.127"></a><span id="l140.127" class="difflineplus">+    nsAutoCString storeToken;</span>
<a href="#l140.128"></a><span id="l140.128">     aFile-&gt;GetNativeLeafName(storeToken);</span>
<a href="#l140.129"></a><span id="l140.129">     newMsgHdr-&gt;SetStringProperty(&quot;storeToken&quot;, storeToken.get());</span>
<a href="#l140.130"></a><span id="l140.130">   }</span>
<a href="#l140.131"></a><span id="l140.131">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.132"></a><span id="l140.132">   return rv;</span>
<a href="#l140.133"></a><span id="l140.133"> }</span>
<a href="#l140.134"></a><span id="l140.134"> </span>
<a href="#l140.135"></a><span id="l140.135"> void MaildirStoreParser::TimerCallback(nsITimer *aTimer, void *aClosure)</span>
<a href="#l140.136"></a><span id="l140.136" class="difflineat">@@ -1081,17 +1081,17 @@ void MaildirStoreParser::TimerCallback(n</span>
<a href="#l140.137"></a><span id="l140.137">     {</span>
<a href="#l140.138"></a><span id="l140.138">       nsresult rv;</span>
<a href="#l140.139"></a><span id="l140.139">       nsCOMPtr&lt;nsIMailboxUrl&gt; mailboxurl =</span>
<a href="#l140.140"></a><span id="l140.140">         do_CreateInstance(NS_MAILBOXURL_CONTRACTID, &amp;rv);</span>
<a href="#l140.141"></a><span id="l140.141">       if (NS_SUCCEEDED(rv) &amp;&amp; mailboxurl)</span>
<a href="#l140.142"></a><span id="l140.142">       {</span>
<a href="#l140.143"></a><span id="l140.143">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url = do_QueryInterface(mailboxurl);</span>
<a href="#l140.144"></a><span id="l140.144">         url-&gt;SetUpdatingFolder(true);</span>
<a href="#l140.145"></a><span id="l140.145" class="difflineminus">-        nsCAutoString uriSpec(&quot;mailbox://&quot;);</span>
<a href="#l140.146"></a><span id="l140.146" class="difflineplus">+        nsAutoCString uriSpec(&quot;mailbox://&quot;);</span>
<a href="#l140.147"></a><span id="l140.147">         // ### TODO - what if SetSpec fails?</span>
<a href="#l140.148"></a><span id="l140.148">         (void) url-&gt;SetSpec(uriSpec);</span>
<a href="#l140.149"></a><span id="l140.149">         parser-&gt;m_listener-&gt;OnStopRunningUrl(url, NS_OK);</span>
<a href="#l140.150"></a><span id="l140.150">       }</span>
<a href="#l140.151"></a><span id="l140.151">     }</span>
<a href="#l140.152"></a><span id="l140.152">     return;</span>
<a href="#l140.153"></a><span id="l140.153">   }</span>
<a href="#l140.154"></a><span id="l140.154">   nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l140.155"></a><span id="l140.155" class="difflineat">@@ -1164,17 +1164,17 @@ NS_IMETHODIMP nsMsgMaildirStore::ChangeF</span>
<a href="#l140.156"></a><span id="l140.156"> }</span>
<a href="#l140.157"></a><span id="l140.157"> </span>
<a href="#l140.158"></a><span id="l140.158"> // get output stream from header</span>
<a href="#l140.159"></a><span id="l140.159"> nsresult</span>
<a href="#l140.160"></a><span id="l140.160"> nsMsgMaildirStore::GetOutputStream(nsIMsgDBHdr *aHdr,</span>
<a href="#l140.161"></a><span id="l140.161">                                    nsCOMPtr&lt;nsIOutputStream&gt; &amp;aOutputStream)</span>
<a href="#l140.162"></a><span id="l140.162"> {</span>
<a href="#l140.163"></a><span id="l140.163">   // file name is stored in message header property &quot;storeToken&quot;</span>
<a href="#l140.164"></a><span id="l140.164" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l140.165"></a><span id="l140.165" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l140.166"></a><span id="l140.166">   aHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l140.167"></a><span id="l140.167">   if (fileName.IsEmpty())</span>
<a href="#l140.168"></a><span id="l140.168">     return NS_ERROR_FAILURE;</span>
<a href="#l140.169"></a><span id="l140.169"> </span>
<a href="#l140.170"></a><span id="l140.170">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l140.171"></a><span id="l140.171">   nsresult rv = aHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l140.172"></a><span id="l140.172">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.173"></a><span id="l140.173"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l141.1"></a><span id="l141.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l141.2"></a><span id="l141.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l141.3"></a><span id="l141.3" class="difflineat">@@ -1118,21 +1118,21 @@ SEARCH_NEWLINE:</span>
<a href="#l141.4"></a><span id="l141.4">       while (header-&gt;length &gt; 0 &amp;&amp;</span>
<a href="#l141.5"></a><span id="l141.5">         IS_SPACE (header-&gt;value [header-&gt;length - 1]))</span>
<a href="#l141.6"></a><span id="l141.6">         ((char *) header-&gt;value) [--header-&gt;length] = 0;</span>
<a href="#l141.7"></a><span id="l141.7">       if (header == &amp;receivedBy &amp;&amp; m_receivedTime == 0)</span>
<a href="#l141.8"></a><span id="l141.8">       {</span>
<a href="#l141.9"></a><span id="l141.9">         // parse Received: header for date.</span>
<a href="#l141.10"></a><span id="l141.10">         // We trust the first header as that is closest to recipient,</span>
<a href="#l141.11"></a><span id="l141.11">         // and less likely to be spoofed.</span>
<a href="#l141.12"></a><span id="l141.12" class="difflineminus">-        nsCAutoString receivedHdr(header-&gt;value, header-&gt;length);</span>
<a href="#l141.13"></a><span id="l141.13" class="difflineplus">+        nsAutoCString receivedHdr(header-&gt;value, header-&gt;length);</span>
<a href="#l141.14"></a><span id="l141.14">         int32_t lastSemicolon = receivedHdr.RFindChar(';');</span>
<a href="#l141.15"></a><span id="l141.15">         if (lastSemicolon != -1)</span>
<a href="#l141.16"></a><span id="l141.16">         {</span>
<a href="#l141.17"></a><span id="l141.17" class="difflineminus">-          nsCAutoString receivedDate;</span>
<a href="#l141.18"></a><span id="l141.18" class="difflineplus">+          nsAutoCString receivedDate;</span>
<a href="#l141.19"></a><span id="l141.19">           receivedDate = Substring(receivedHdr, lastSemicolon + 1);</span>
<a href="#l141.20"></a><span id="l141.20">           receivedDate.Trim(&quot; \t\b\r\n&quot;);</span>
<a href="#l141.21"></a><span id="l141.21">           PRTime resultTime;</span>
<a href="#l141.22"></a><span id="l141.22">           if (PR_ParseTimeString (receivedDate.get(), false, &amp;resultTime) == PR_SUCCESS)</span>
<a href="#l141.23"></a><span id="l141.23">             m_receivedTime = resultTime;</span>
<a href="#l141.24"></a><span id="l141.24">         }</span>
<a href="#l141.25"></a><span id="l141.25">       }</span>
<a href="#l141.26"></a><span id="l141.26">     }</span>
<a href="#l141.27"></a><span id="l141.27" class="difflineat">@@ -1330,17 +1330,17 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l141.28"></a><span id="l141.28">     uint32_t flags2 = 0;</span>
<a href="#l141.29"></a><span id="l141.29">     sscanf(mozstatus2-&gt;value, &quot; %x &quot;, &amp;flags2);</span>
<a href="#l141.30"></a><span id="l141.30">     flags |= flags2;</span>
<a href="#l141.31"></a><span id="l141.31">   }</span>
<a href="#l141.32"></a><span id="l141.32"> </span>
<a href="#l141.33"></a><span id="l141.33">   if (!(flags &amp; nsMsgMessageFlags::Expunged))  // message was deleted, don't bother creating a hdr.</span>
<a href="#l141.34"></a><span id="l141.34">   {</span>
<a href="#l141.35"></a><span id="l141.35">     // We'll need the message id first to recover data from the backup database</span>
<a href="#l141.36"></a><span id="l141.36" class="difflineminus">-    nsCAutoString rawMsgId;</span>
<a href="#l141.37"></a><span id="l141.37" class="difflineplus">+    nsAutoCString rawMsgId;</span>
<a href="#l141.38"></a><span id="l141.38">     /* Take off &lt;&gt; around message ID. */</span>
<a href="#l141.39"></a><span id="l141.39">     if (id)</span>
<a href="#l141.40"></a><span id="l141.40">     {</span>
<a href="#l141.41"></a><span id="l141.41">       if (id-&gt;value[0] == '&lt;')</span>
<a href="#l141.42"></a><span id="l141.42">         id-&gt;value++, id-&gt;length--;</span>
<a href="#l141.43"></a><span id="l141.43">       if (id-&gt;value[id-&gt;length - 1] == '&gt;')</span>
<a href="#l141.44"></a><span id="l141.44">         /* generate a new null-terminated string without the final &gt; */</span>
<a href="#l141.45"></a><span id="l141.45">         rawMsgId.Assign(id-&gt;value, id-&gt;length - 1);</span>
<a href="#l141.46"></a><span id="l141.46" class="difflineat">@@ -1418,17 +1418,17 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l141.47"></a><span id="l141.47">       group in the summary list, and only being able to sort on the first</span>
<a href="#l141.48"></a><span id="l141.48">         group rather than the whole list.  It's worth it. */</span>
<a href="#l141.49"></a><span id="l141.49">         char * ch;</span>
<a href="#l141.50"></a><span id="l141.50">         NS_ASSERTION (recipient-&gt;length == (uint16_t) strlen(recipient-&gt;value), &quot;invalid recipient&quot;);</span>
<a href="#l141.51"></a><span id="l141.51">         ch = PL_strchr(recipient-&gt;value, ',');</span>
<a href="#l141.52"></a><span id="l141.52">         if (ch)</span>
<a href="#l141.53"></a><span id="l141.53">         {</span>
<a href="#l141.54"></a><span id="l141.54">           /* generate a new string that terminates before the , */</span>
<a href="#l141.55"></a><span id="l141.55" class="difflineminus">-          nsCAutoString firstGroup;</span>
<a href="#l141.56"></a><span id="l141.56" class="difflineplus">+          nsAutoCString firstGroup;</span>
<a href="#l141.57"></a><span id="l141.57">           firstGroup.Assign(recipient-&gt;value, ch - recipient-&gt;value);</span>
<a href="#l141.58"></a><span id="l141.58">           m_newMsgHdr-&gt;SetRecipients(firstGroup.get());</span>
<a href="#l141.59"></a><span id="l141.59">         }</span>
<a href="#l141.60"></a><span id="l141.60">         m_newMsgHdr-&gt;SetRecipients(recipient-&gt;value);</span>
<a href="#l141.61"></a><span id="l141.61">       }</span>
<a href="#l141.62"></a><span id="l141.62">       else if (recipient)</span>
<a href="#l141.63"></a><span id="l141.63">       {</span>
<a href="#l141.64"></a><span id="l141.64">         // note that we're now setting the whole recipient list,</span>
<a href="#l141.65"></a><span id="l141.65" class="difflineat">@@ -1489,17 +1489,17 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l141.66"></a><span id="l141.66">       }</span>
<a href="#l141.67"></a><span id="l141.67"> </span>
<a href="#l141.68"></a><span id="l141.68">       status = InternSubject (subject);</span>
<a href="#l141.69"></a><span id="l141.69">       if (status &gt;= 0)</span>
<a href="#l141.70"></a><span id="l141.70">       {</span>
<a href="#l141.71"></a><span id="l141.71">         if (! id)</span>
<a href="#l141.72"></a><span id="l141.72">         {</span>
<a href="#l141.73"></a><span id="l141.73">           // what to do about this? we used to do a hash of all the headers...</span>
<a href="#l141.74"></a><span id="l141.74" class="difflineminus">-          nsCAutoString hash;</span>
<a href="#l141.75"></a><span id="l141.75" class="difflineplus">+          nsAutoCString hash;</span>
<a href="#l141.76"></a><span id="l141.76">           const char *md5_b64 = &quot;dummy.message.id&quot;;</span>
<a href="#l141.77"></a><span id="l141.77">           nsresult rv;</span>
<a href="#l141.78"></a><span id="l141.78">           nsCOMPtr&lt;nsICryptoHash&gt; hasher = do_CreateInstance(&quot;@mozilla.org/security/hash;1&quot;, &amp;rv);</span>
<a href="#l141.79"></a><span id="l141.79">           if (NS_SUCCEEDED(rv))</span>
<a href="#l141.80"></a><span id="l141.80">           {</span>
<a href="#l141.81"></a><span id="l141.81">             if (NS_SUCCEEDED(hasher-&gt;Init(nsICryptoHash::MD5)) &amp;&amp;</span>
<a href="#l141.82"></a><span id="l141.82">                 NS_SUCCEEDED(hasher-&gt;Update((const uint8_t*) m_headers.GetBuffer(), m_headers.GetSize())) &amp;&amp;</span>
<a href="#l141.83"></a><span id="l141.83">                 NS_SUCCEEDED(hasher-&gt;Finish(true, hash)))</span>
<a href="#l141.84"></a><span id="l141.84" class="difflineat">@@ -1596,25 +1596,25 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l141.85"></a><span id="l141.85">         if (priority)</span>
<a href="#l141.86"></a><span id="l141.86">           m_newMsgHdr-&gt;SetPriorityString(priority-&gt;value);</span>
<a href="#l141.87"></a><span id="l141.87">         else if (priorityFlags == nsMsgPriority::notSet)</span>
<a href="#l141.88"></a><span id="l141.88">           m_newMsgHdr-&gt;SetPriority(nsMsgPriority::none);</span>
<a href="#l141.89"></a><span id="l141.89">         if (keywords)</span>
<a href="#l141.90"></a><span id="l141.90">         {</span>
<a href="#l141.91"></a><span id="l141.91">           // When there are many keywords, some may not have been written</span>
<a href="#l141.92"></a><span id="l141.92">           // to the message file, so add extra keywords from the backup</span>
<a href="#l141.93"></a><span id="l141.93" class="difflineminus">-          nsCAutoString oldKeywords;</span>
<a href="#l141.94"></a><span id="l141.94" class="difflineplus">+          nsAutoCString oldKeywords;</span>
<a href="#l141.95"></a><span id="l141.95">           m_newMsgHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(oldKeywords));</span>
<a href="#l141.96"></a><span id="l141.96">           nsTArray&lt;nsCString&gt; newKeywordArray, oldKeywordArray;</span>
<a href="#l141.97"></a><span id="l141.97">           ParseString(Substring(keywords-&gt;value, keywords-&gt;value + keywords-&gt;length), ' ', newKeywordArray);</span>
<a href="#l141.98"></a><span id="l141.98">           ParseString(oldKeywords, ' ', oldKeywordArray);</span>
<a href="#l141.99"></a><span id="l141.99">           for (uint32_t i = 0; i &lt; oldKeywordArray.Length(); i++)</span>
<a href="#l141.100"></a><span id="l141.100">             if (!newKeywordArray.Contains(oldKeywordArray[i]))</span>
<a href="#l141.101"></a><span id="l141.101">               newKeywordArray.AppendElement(oldKeywordArray[i]);</span>
<a href="#l141.102"></a><span id="l141.102" class="difflineminus">-          nsCAutoString newKeywords;</span>
<a href="#l141.103"></a><span id="l141.103" class="difflineplus">+          nsAutoCString newKeywords;</span>
<a href="#l141.104"></a><span id="l141.104">           for (uint32_t i = 0; i &lt; newKeywordArray.Length(); i++)</span>
<a href="#l141.105"></a><span id="l141.105">           {</span>
<a href="#l141.106"></a><span id="l141.106">             if (i)</span>
<a href="#l141.107"></a><span id="l141.107">               newKeywords.Append(&quot; &quot;);</span>
<a href="#l141.108"></a><span id="l141.108">             newKeywords.Append(newKeywordArray[i]);</span>
<a href="#l141.109"></a><span id="l141.109">           }</span>
<a href="#l141.110"></a><span id="l141.110">           m_newMsgHdr-&gt;SetStringProperty(&quot;keywords&quot;, newKeywords.get());</span>
<a href="#l141.111"></a><span id="l141.111">         }</span>
<a href="#l141.112"></a><span id="l141.112" class="difflineat">@@ -1639,17 +1639,17 @@ int nsParseMailMessageState::FinalizeHea</span>
<a href="#l141.113"></a><span id="l141.113">               char *end = charset;</span>
<a href="#l141.114"></a><span id="l141.114">               while (*end &amp;&amp; !IS_SPACE (*end) &amp;&amp; '\&quot;' != *end &amp;&amp; ';' != *end)</span>
<a href="#l141.115"></a><span id="l141.115">                 end++;</span>
<a href="#l141.116"></a><span id="l141.116">               if (*charset)</span>
<a href="#l141.117"></a><span id="l141.117">               {</span>
<a href="#l141.118"></a><span id="l141.118">                 if (*end != '\0') {</span>
<a href="#l141.119"></a><span id="l141.119">                   // if we're not at the very end of the line, we need</span>
<a href="#l141.120"></a><span id="l141.120">                   // to generate a new string without the trailing crud</span>
<a href="#l141.121"></a><span id="l141.121" class="difflineminus">-                  nsCAutoString rawCharSet;</span>
<a href="#l141.122"></a><span id="l141.122" class="difflineplus">+                  nsAutoCString rawCharSet;</span>
<a href="#l141.123"></a><span id="l141.123">                   rawCharSet.Assign(charset, end - charset);</span>
<a href="#l141.124"></a><span id="l141.124">                   m_newMsgHdr-&gt;SetCharset(rawCharSet.get());</span>
<a href="#l141.125"></a><span id="l141.125">                 } else {</span>
<a href="#l141.126"></a><span id="l141.126">                   m_newMsgHdr-&gt;SetCharset(charset);</span>
<a href="#l141.127"></a><span id="l141.127">                 }</span>
<a href="#l141.128"></a><span id="l141.128">               }</span>
<a href="#l141.129"></a><span id="l141.129">             }</span>
<a href="#l141.130"></a><span id="l141.130">           }</span>
<a href="#l141.131"></a><span id="l141.131" class="difflineat">@@ -2138,17 +2138,17 @@ NS_IMETHODIMP nsParseNewMailState::Apply</span>
<a href="#l141.132"></a><span id="l141.132">         nsMsgLabelValue filterLabel;</span>
<a href="#l141.133"></a><span id="l141.133">         filterAction-&gt;GetLabel(&amp;filterLabel);</span>
<a href="#l141.134"></a><span id="l141.134">         nsMsgKey msgKey;</span>
<a href="#l141.135"></a><span id="l141.135">         msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l141.136"></a><span id="l141.136">         m_mailDB-&gt;SetLabel(msgKey, filterLabel);</span>
<a href="#l141.137"></a><span id="l141.137">         break;</span>
<a href="#l141.138"></a><span id="l141.138">       case nsMsgFilterAction::JunkScore:</span>
<a href="#l141.139"></a><span id="l141.139">       {</span>
<a href="#l141.140"></a><span id="l141.140" class="difflineminus">-        nsCAutoString junkScoreStr;</span>
<a href="#l141.141"></a><span id="l141.141" class="difflineplus">+        nsAutoCString junkScoreStr;</span>
<a href="#l141.142"></a><span id="l141.142">         int32_t junkScore;</span>
<a href="#l141.143"></a><span id="l141.143">         filterAction-&gt;GetJunkScore(&amp;junkScore);</span>
<a href="#l141.144"></a><span id="l141.144">         junkScoreStr.AppendInt(junkScore);</span>
<a href="#l141.145"></a><span id="l141.145">         if (junkScore == nsIJunkMailPlugin::IS_SPAM_SCORE)</span>
<a href="#l141.146"></a><span id="l141.146">           msgIsNew = false;</span>
<a href="#l141.147"></a><span id="l141.147">         nsMsgKey msgKey;</span>
<a href="#l141.148"></a><span id="l141.148">         msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l141.149"></a><span id="l141.149">         msgHdr-&gt;SetStringProperty(&quot;junkscore&quot;, junkScoreStr.get());</span>
<a href="#l141.150"></a><span id="l141.150" class="difflineat">@@ -2228,17 +2228,17 @@ NS_IMETHODIMP nsParseNewMailState::Apply</span>
<a href="#l141.151"></a><span id="l141.151">       break;</span>
<a href="#l141.152"></a><span id="l141.152"> </span>
<a href="#l141.153"></a><span id="l141.153">       case nsMsgFilterAction::Custom:</span>
<a href="#l141.154"></a><span id="l141.154">       {</span>
<a href="#l141.155"></a><span id="l141.155">         nsCOMPtr&lt;nsIMsgFilterCustomAction&gt; customAction;</span>
<a href="#l141.156"></a><span id="l141.156">         rv = filterAction-&gt;GetCustomAction(getter_AddRefs(customAction));</span>
<a href="#l141.157"></a><span id="l141.157">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l141.158"></a><span id="l141.158"> </span>
<a href="#l141.159"></a><span id="l141.159" class="difflineminus">-        nsCAutoString value;</span>
<a href="#l141.160"></a><span id="l141.160" class="difflineplus">+        nsAutoCString value;</span>
<a href="#l141.161"></a><span id="l141.161">         filterAction-&gt;GetStrValue(value);</span>
<a href="#l141.162"></a><span id="l141.162"> </span>
<a href="#l141.163"></a><span id="l141.163">         nsCOMPtr&lt;nsIMutableArray&gt; messageArray(</span>
<a href="#l141.164"></a><span id="l141.164">             do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l141.165"></a><span id="l141.165">         NS_ENSURE_TRUE(messageArray, rv);</span>
<a href="#l141.166"></a><span id="l141.166">         messageArray-&gt;AppendElement(msgHdr, false);</span>
<a href="#l141.167"></a><span id="l141.167"> </span>
<a href="#l141.168"></a><span id="l141.168">         customAction-&gt;Apply(messageArray, value, nullptr,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l142.1"></a><span id="l142.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l142.2"></a><span id="l142.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l142.3"></a><span id="l142.3" class="difflineat">@@ -754,17 +754,17 @@ NS_IMETHODIMP nsPop3Protocol::OnPromptSt</span>
<a href="#l142.4"></a><span id="l142.4">   PR_LOG(POP3LOGMODULE, PR_LOG_MAX, (&quot;OnPromptStart()&quot;));</span>
<a href="#l142.5"></a><span id="l142.5"> </span>
<a href="#l142.6"></a><span id="l142.6">   *aResult = false;</span>
<a href="#l142.7"></a><span id="l142.7"> </span>
<a href="#l142.8"></a><span id="l142.8">   nsresult rv;</span>
<a href="#l142.9"></a><span id="l142.9">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server, &amp;rv);</span>
<a href="#l142.10"></a><span id="l142.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l142.11"></a><span id="l142.11"> </span>
<a href="#l142.12"></a><span id="l142.12" class="difflineminus">-  nsCAutoString passwordResult;</span>
<a href="#l142.13"></a><span id="l142.13" class="difflineplus">+  nsAutoCString passwordResult;</span>
<a href="#l142.14"></a><span id="l142.14"> </span>
<a href="#l142.15"></a><span id="l142.15">   // pass the failed password into the password prompt so that</span>
<a href="#l142.16"></a><span id="l142.16">   // it will be pre-filled, in case it failed because of a</span>
<a href="#l142.17"></a><span id="l142.17">   // server problem and not because it was wrong.</span>
<a href="#l142.18"></a><span id="l142.18">   if (!m_lastPasswordSent.IsEmpty())</span>
<a href="#l142.19"></a><span id="l142.19">     passwordResult = m_lastPasswordSent;</span>
<a href="#l142.20"></a><span id="l142.20"> </span>
<a href="#l142.21"></a><span id="l142.21">   // Set up some items that we're going to need for the prompting.</span>
<a href="#l142.22"></a><span id="l142.22" class="difflineat">@@ -1012,17 +1012,17 @@ nsresult nsPop3Protocol::LoadUrl(nsIURI*</span>
<a href="#l142.23"></a><span id="l142.23"> </span>
<a href="#l142.24"></a><span id="l142.24">   int32_t port;</span>
<a href="#l142.25"></a><span id="l142.25">   rv = url-&gt;GetPort(&amp;port);</span>
<a href="#l142.26"></a><span id="l142.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l142.27"></a><span id="l142.27"> </span>
<a href="#l142.28"></a><span id="l142.28">   rv = NS_CheckPortSafety(port, &quot;pop&quot;);</span>
<a href="#l142.29"></a><span id="l142.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l142.30"></a><span id="l142.30"> </span>
<a href="#l142.31"></a><span id="l142.31" class="difflineminus">-  nsCAutoString queryPart;</span>
<a href="#l142.32"></a><span id="l142.32" class="difflineplus">+  nsAutoCString queryPart;</span>
<a href="#l142.33"></a><span id="l142.33">   rv = url-&gt;GetQuery(queryPart);</span>
<a href="#l142.34"></a><span id="l142.34">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;unable to get the url spect&quot;);</span>
<a href="#l142.35"></a><span id="l142.35"> </span>
<a href="#l142.36"></a><span id="l142.36">   m_pop3ConData-&gt;only_check_for_new_mail = (PL_strcasestr(queryPart.get(), &quot;check&quot;) != nullptr);</span>
<a href="#l142.37"></a><span id="l142.37">   m_pop3ConData-&gt;verify_logon = (PL_strcasestr(queryPart.get(), &quot;verifyLogon&quot;) != nullptr);</span>
<a href="#l142.38"></a><span id="l142.38">   m_pop3ConData-&gt;get_url = (PL_strcasestr(queryPart.get(), &quot;gurl&quot;) != nullptr);</span>
<a href="#l142.39"></a><span id="l142.39"> </span>
<a href="#l142.40"></a><span id="l142.40">   bool deleteByAgeFromServer = false;</span>
<a href="#l142.41"></a><span id="l142.41" class="difflineat">@@ -1341,17 +1341,17 @@ nsresult nsPop3Protocol::SendData(const </span>
<a href="#l142.42"></a><span id="l142.42">  * POP3 AUTH extension</span>
<a href="#l142.43"></a><span id="l142.43">  */</span>
<a href="#l142.44"></a><span id="l142.44"> </span>
<a href="#l142.45"></a><span id="l142.45"> int32_t nsPop3Protocol::SendAuth()</span>
<a href="#l142.46"></a><span id="l142.46"> {</span>
<a href="#l142.47"></a><span id="l142.47">   if(!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l142.48"></a><span id="l142.48">     return(Error(POP3_SERVER_ERROR));</span>
<a href="#l142.49"></a><span id="l142.49"> </span>
<a href="#l142.50"></a><span id="l142.50" class="difflineminus">-  nsCAutoString command(&quot;AUTH&quot; CRLF);</span>
<a href="#l142.51"></a><span id="l142.51" class="difflineplus">+  nsAutoCString command(&quot;AUTH&quot; CRLF);</span>
<a href="#l142.52"></a><span id="l142.52"> </span>
<a href="#l142.53"></a><span id="l142.53">   m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_RESPONSE;</span>
<a href="#l142.54"></a><span id="l142.54">   return SendData(command.get());</span>
<a href="#l142.55"></a><span id="l142.55"> }</span>
<a href="#l142.56"></a><span id="l142.56"> </span>
<a href="#l142.57"></a><span id="l142.57"> int32_t nsPop3Protocol::AuthResponse(nsIInputStream* inputStream,</span>
<a href="#l142.58"></a><span id="l142.58">                              uint32_t length)</span>
<a href="#l142.59"></a><span id="l142.59"> {</span>
<a href="#l142.60"></a><span id="l142.60" class="difflineat">@@ -1435,17 +1435,17 @@ int32_t nsPop3Protocol::AuthResponse(nsI</span>
<a href="#l142.61"></a><span id="l142.61">  */</span>
<a href="#l142.62"></a><span id="l142.62"> </span>
<a href="#l142.63"></a><span id="l142.63"> int32_t nsPop3Protocol::SendCapa()</span>
<a href="#l142.64"></a><span id="l142.64"> {</span>
<a href="#l142.65"></a><span id="l142.65">     PR_LOG(POP3LOGMODULE, PR_LOG_MAX, (&quot;SendCapa()&quot;));</span>
<a href="#l142.66"></a><span id="l142.66">     if(!m_pop3ConData-&gt;command_succeeded)</span>
<a href="#l142.67"></a><span id="l142.67">         return(Error(POP3_SERVER_ERROR));</span>
<a href="#l142.68"></a><span id="l142.68"> </span>
<a href="#l142.69"></a><span id="l142.69" class="difflineminus">-    nsCAutoString command(&quot;CAPA&quot; CRLF);</span>
<a href="#l142.70"></a><span id="l142.70" class="difflineplus">+    nsAutoCString command(&quot;CAPA&quot; CRLF);</span>
<a href="#l142.71"></a><span id="l142.71"> </span>
<a href="#l142.72"></a><span id="l142.72">     m_pop3ConData-&gt;next_state_after_response = POP3_CAPA_RESPONSE;</span>
<a href="#l142.73"></a><span id="l142.73">     return SendData(command.get());</span>
<a href="#l142.74"></a><span id="l142.74"> }</span>
<a href="#l142.75"></a><span id="l142.75"> </span>
<a href="#l142.76"></a><span id="l142.76"> int32_t nsPop3Protocol::CapaResponse(nsIInputStream* inputStream,</span>
<a href="#l142.77"></a><span id="l142.77">                              uint32_t length)</span>
<a href="#l142.78"></a><span id="l142.78"> {</span>
<a href="#l142.79"></a><span id="l142.79" class="difflineat">@@ -1514,17 +1514,17 @@ int32_t nsPop3Protocol::CapaResponse(nsI</span>
<a href="#l142.80"></a><span id="l142.80">             SetCapFlag(POP3_HAS_STLS);</span>
<a href="#l142.81"></a><span id="l142.81">             m_pop3Server-&gt;SetPop3CapabilityFlags(m_pop3ConData-&gt;capability_flags);</span>
<a href="#l142.82"></a><span id="l142.82">         }</span>
<a href="#l142.83"></a><span id="l142.83">     }</span>
<a href="#l142.84"></a><span id="l142.84">     else</span>
<a href="#l142.85"></a><span id="l142.85">     // see RFC 2449, chapter 6.3</span>
<a href="#l142.86"></a><span id="l142.86">     if (!PL_strncasecmp(line, &quot;SASL&quot;, 4) &amp;&amp; strlen(line) &gt; 6)</span>
<a href="#l142.87"></a><span id="l142.87">     {</span>
<a href="#l142.88"></a><span id="l142.88" class="difflineminus">-        nsCAutoString responseLine;</span>
<a href="#l142.89"></a><span id="l142.89" class="difflineplus">+        nsAutoCString responseLine;</span>
<a href="#l142.90"></a><span id="l142.90">         responseLine.Assign(line + 5);</span>
<a href="#l142.91"></a><span id="l142.91"> </span>
<a href="#l142.92"></a><span id="l142.92">         if (responseLine.Find(&quot;PLAIN&quot;, CaseInsensitiveCompare) &gt;= 0)</span>
<a href="#l142.93"></a><span id="l142.93">             SetCapFlag(POP3_HAS_AUTH_PLAIN);</span>
<a href="#l142.94"></a><span id="l142.94"> </span>
<a href="#l142.95"></a><span id="l142.95">         if (responseLine.Find(&quot;LOGIN&quot;, CaseInsensitiveCompare) &gt;= 0)</span>
<a href="#l142.96"></a><span id="l142.96">             SetCapFlag(POP3_HAS_AUTH_LOGIN);</span>
<a href="#l142.97"></a><span id="l142.97"> </span>
<a href="#l142.98"></a><span id="l142.98" class="difflineat">@@ -1727,17 +1727,17 @@ int32_t nsPop3Protocol::ProcessAuth()</span>
<a href="#l142.99"></a><span id="l142.99">     // Try to upgrade to STARTTLS -- TODO move into its own function</span>
<a href="#l142.100"></a><span id="l142.100">     if (!m_tlsEnabled)</span>
<a href="#l142.101"></a><span id="l142.101">     {</span>
<a href="#l142.102"></a><span id="l142.102">       if(TestCapFlag(POP3_HAS_STLS))</span>
<a href="#l142.103"></a><span id="l142.103">       {</span>
<a href="#l142.104"></a><span id="l142.104">         if (m_socketType == nsMsgSocketType::trySTARTTLS ||</span>
<a href="#l142.105"></a><span id="l142.105">             m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l142.106"></a><span id="l142.106">         {</span>
<a href="#l142.107"></a><span id="l142.107" class="difflineminus">-            nsCAutoString command(&quot;STLS&quot; CRLF);</span>
<a href="#l142.108"></a><span id="l142.108" class="difflineplus">+            nsAutoCString command(&quot;STLS&quot; CRLF);</span>
<a href="#l142.109"></a><span id="l142.109"> </span>
<a href="#l142.110"></a><span id="l142.110">             m_pop3ConData-&gt;next_state_after_response = POP3_TLS_RESPONSE;</span>
<a href="#l142.111"></a><span id="l142.111">             return SendData(command.get());</span>
<a href="#l142.112"></a><span id="l142.112">         }</span>
<a href="#l142.113"></a><span id="l142.113">       }</span>
<a href="#l142.114"></a><span id="l142.114">       else if (m_socketType == nsMsgSocketType::alwaysSTARTTLS)</span>
<a href="#l142.115"></a><span id="l142.115">       {</span>
<a href="#l142.116"></a><span id="l142.116">           m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l142.117"></a><span id="l142.117" class="difflineat">@@ -1934,17 +1934,17 @@ int32_t nsPop3Protocol::NextAuthStep()</span>
<a href="#l142.118"></a><span id="l142.118">     return 0;</span>
<a href="#l142.119"></a><span id="l142.119"> }</span>
<a href="#l142.120"></a><span id="l142.120"> </span>
<a href="#l142.121"></a><span id="l142.121"> // LOGIN consists of three steps not two as USER/PASS or CRAM-MD5,</span>
<a href="#l142.122"></a><span id="l142.122"> // so we've to start here and continue in SendUsername if the server</span>
<a href="#l142.123"></a><span id="l142.123"> // responds + to &quot;AUTH LOGIN&quot;</span>
<a href="#l142.124"></a><span id="l142.124"> int32_t nsPop3Protocol::AuthLogin()</span>
<a href="#l142.125"></a><span id="l142.125"> {</span>
<a href="#l142.126"></a><span id="l142.126" class="difflineminus">-    nsCAutoString command(&quot;AUTH LOGIN&quot; CRLF);</span>
<a href="#l142.127"></a><span id="l142.127" class="difflineplus">+    nsAutoCString command(&quot;AUTH LOGIN&quot; CRLF);</span>
<a href="#l142.128"></a><span id="l142.128">     m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_LOGIN_RESPONSE;</span>
<a href="#l142.129"></a><span id="l142.129">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l142.130"></a><span id="l142.130"> </span>
<a href="#l142.131"></a><span id="l142.131">     return SendData(command.get());</span>
<a href="#l142.132"></a><span id="l142.132"> }</span>
<a href="#l142.133"></a><span id="l142.133"> </span>
<a href="#l142.134"></a><span id="l142.134"> int32_t nsPop3Protocol::AuthLoginResponse()</span>
<a href="#l142.135"></a><span id="l142.135"> {</span>
<a href="#l142.136"></a><span id="l142.136" class="difflineat">@@ -1965,17 +1965,17 @@ int32_t nsPop3Protocol::AuthLoginRespons</span>
<a href="#l142.137"></a><span id="l142.137">     return 0;</span>
<a href="#l142.138"></a><span id="l142.138"> }</span>
<a href="#l142.139"></a><span id="l142.139"> </span>
<a href="#l142.140"></a><span id="l142.140"> // NTLM, like LOGIN consists of three steps not two as USER/PASS or CRAM-MD5,</span>
<a href="#l142.141"></a><span id="l142.141"> // so we've to start here and continue in SendUsername if the server</span>
<a href="#l142.142"></a><span id="l142.142"> // responds + to &quot;AUTH NTLM&quot;</span>
<a href="#l142.143"></a><span id="l142.143"> int32_t nsPop3Protocol::AuthNtlm()</span>
<a href="#l142.144"></a><span id="l142.144"> {</span>
<a href="#l142.145"></a><span id="l142.145" class="difflineminus">-    nsCAutoString command (m_currentAuthMethod == POP3_HAS_AUTH_MSN</span>
<a href="#l142.146"></a><span id="l142.146" class="difflineplus">+    nsAutoCString command (m_currentAuthMethod == POP3_HAS_AUTH_MSN</span>
<a href="#l142.147"></a><span id="l142.147">           ? &quot;AUTH MSN&quot; CRLF : &quot;AUTH NTLM&quot; CRLF);</span>
<a href="#l142.148"></a><span id="l142.148">     m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_NTLM_RESPONSE;</span>
<a href="#l142.149"></a><span id="l142.149">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l142.150"></a><span id="l142.150"> </span>
<a href="#l142.151"></a><span id="l142.151">     return SendData(command.get());</span>
<a href="#l142.152"></a><span id="l142.152"> }</span>
<a href="#l142.153"></a><span id="l142.153"> </span>
<a href="#l142.154"></a><span id="l142.154"> int32_t nsPop3Protocol::AuthNtlmResponse()</span>
<a href="#l142.155"></a><span id="l142.155" class="difflineat">@@ -1997,18 +1997,18 @@ int32_t nsPop3Protocol::AuthNtlmResponse</span>
<a href="#l142.156"></a><span id="l142.156">     return 0;</span>
<a href="#l142.157"></a><span id="l142.157"> }</span>
<a href="#l142.158"></a><span id="l142.158"> </span>
<a href="#l142.159"></a><span id="l142.159"> int32_t nsPop3Protocol::AuthGSSAPI()</span>
<a href="#l142.160"></a><span id="l142.160"> {</span>
<a href="#l142.161"></a><span id="l142.161">     PR_LOG(POP3LOGMODULE, PR_LOG_DEBUG, (&quot;AuthGSSAPI()&quot;));</span>
<a href="#l142.162"></a><span id="l142.162">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l142.163"></a><span id="l142.163">     if (server) {</span>
<a href="#l142.164"></a><span id="l142.164" class="difflineminus">-        nsCAutoString cmd;</span>
<a href="#l142.165"></a><span id="l142.165" class="difflineminus">-        nsCAutoString service(&quot;pop@&quot;);</span>
<a href="#l142.166"></a><span id="l142.166" class="difflineplus">+        nsAutoCString cmd;</span>
<a href="#l142.167"></a><span id="l142.167" class="difflineplus">+        nsAutoCString service(&quot;pop@&quot;);</span>
<a href="#l142.168"></a><span id="l142.168">         nsCString hostName;</span>
<a href="#l142.169"></a><span id="l142.169">         nsresult rv;</span>
<a href="#l142.170"></a><span id="l142.170">         server-&gt;GetRealHostName(hostName);</span>
<a href="#l142.171"></a><span id="l142.171">         service.Append(hostName);</span>
<a href="#l142.172"></a><span id="l142.172">         rv = DoGSSAPIStep1(service.get(), m_username.get(), cmd);</span>
<a href="#l142.173"></a><span id="l142.173">         if (NS_SUCCEEDED(rv)) {</span>
<a href="#l142.174"></a><span id="l142.174">             m_GSSAPICache.Assign(cmd);</span>
<a href="#l142.175"></a><span id="l142.175">             m_pop3ConData-&gt;next_state_after_response = POP3_AUTH_GSSAPI_FIRST;</span>
<a href="#l142.176"></a><span id="l142.176" class="difflineat">@@ -2041,17 +2041,17 @@ int32_t nsPop3Protocol::AuthGSSAPIRespon</span>
<a href="#l142.177"></a><span id="l142.177">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l142.178"></a><span id="l142.178"> </span>
<a href="#l142.179"></a><span id="l142.179">     if (first) {</span>
<a href="#l142.180"></a><span id="l142.180">         m_GSSAPICache += CRLF;</span>
<a href="#l142.181"></a><span id="l142.181">         rv = SendData(m_GSSAPICache.get());</span>
<a href="#l142.182"></a><span id="l142.182">         m_GSSAPICache.Truncate();</span>
<a href="#l142.183"></a><span id="l142.183">     }</span>
<a href="#l142.184"></a><span id="l142.184">     else {</span>
<a href="#l142.185"></a><span id="l142.185" class="difflineminus">-        nsCAutoString cmd;</span>
<a href="#l142.186"></a><span id="l142.186" class="difflineplus">+        nsAutoCString cmd;</span>
<a href="#l142.187"></a><span id="l142.187">         PR_LOG(POP3LOGMODULE, PR_LOG_DEBUG, (&quot;GSSAPI step 2&quot;));</span>
<a href="#l142.188"></a><span id="l142.188">         rv = DoGSSAPIStep2(m_commandResponse, cmd);</span>
<a href="#l142.189"></a><span id="l142.189">         if (NS_FAILED(rv))</span>
<a href="#l142.190"></a><span id="l142.190">             cmd = &quot;*&quot;;</span>
<a href="#l142.191"></a><span id="l142.191">         if (rv == NS_SUCCESS_AUTH_FINISHED) {</span>
<a href="#l142.192"></a><span id="l142.192">             m_pop3ConData-&gt;next_state_after_response = POP3_NEXT_AUTH_STEP;</span>
<a href="#l142.193"></a><span id="l142.193">             m_password_already_sent = true;</span>
<a href="#l142.194"></a><span id="l142.194">         }</span>
<a href="#l142.195"></a><span id="l142.195" class="difflineat">@@ -2076,17 +2076,17 @@ int32_t nsPop3Protocol::SendUsername()</span>
<a href="#l142.196"></a><span id="l142.196">     // If the password is still empty here, don't try to go on.</span>
<a href="#l142.197"></a><span id="l142.197">     if (m_passwordResult.IsEmpty())</span>
<a href="#l142.198"></a><span id="l142.198">     {</span>
<a href="#l142.199"></a><span id="l142.199">       m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l142.200"></a><span id="l142.200">       return Error(POP3_PASSWORD_UNDEFINED);</span>
<a href="#l142.201"></a><span id="l142.201">     }</span>
<a href="#l142.202"></a><span id="l142.202">     // &lt;/copied&gt;</span>
<a href="#l142.203"></a><span id="l142.203"> </span>
<a href="#l142.204"></a><span id="l142.204" class="difflineminus">-    nsCAutoString cmd;</span>
<a href="#l142.205"></a><span id="l142.205" class="difflineplus">+    nsAutoCString cmd;</span>
<a href="#l142.206"></a><span id="l142.206"> </span>
<a href="#l142.207"></a><span id="l142.207">     if (m_currentAuthMethod == POP3_HAS_AUTH_NTLM)</span>
<a href="#l142.208"></a><span id="l142.208">         (void) DoNtlmStep1(m_username.get(), m_passwordResult.get(), cmd);</span>
<a href="#l142.209"></a><span id="l142.209">     else if (m_currentAuthMethod == POP3_HAS_AUTH_CRAM_MD5)</span>
<a href="#l142.210"></a><span id="l142.210">         cmd = &quot;AUTH CRAM-MD5&quot;;</span>
<a href="#l142.211"></a><span id="l142.211">     else if (m_currentAuthMethod == POP3_HAS_AUTH_PLAIN)</span>
<a href="#l142.212"></a><span id="l142.212">         cmd = &quot;AUTH PLAIN&quot;;</span>
<a href="#l142.213"></a><span id="l142.213">     else if (m_currentAuthMethod == POP3_HAS_AUTH_LOGIN)</span>
<a href="#l142.214"></a><span id="l142.214" class="difflineat">@@ -2131,39 +2131,39 @@ int32_t nsPop3Protocol::SendPassword()</span>
<a href="#l142.215"></a><span id="l142.215">   // If the password is still empty here, don't try to go on.</span>
<a href="#l142.216"></a><span id="l142.216">   if (m_passwordResult.IsEmpty())</span>
<a href="#l142.217"></a><span id="l142.217">   {</span>
<a href="#l142.218"></a><span id="l142.218">     m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l142.219"></a><span id="l142.219">     return Error(POP3_PASSWORD_UNDEFINED);</span>
<a href="#l142.220"></a><span id="l142.220">   }</span>
<a href="#l142.221"></a><span id="l142.221">   // &lt;/copied&gt;</span>
<a href="#l142.222"></a><span id="l142.222"> </span>
<a href="#l142.223"></a><span id="l142.223" class="difflineminus">-  nsCAutoString cmd;</span>
<a href="#l142.224"></a><span id="l142.224" class="difflineplus">+  nsAutoCString cmd;</span>
<a href="#l142.225"></a><span id="l142.225">   nsresult rv;</span>
<a href="#l142.226"></a><span id="l142.226"> </span>
<a href="#l142.227"></a><span id="l142.227">   if (m_currentAuthMethod == POP3_HAS_AUTH_NTLM)</span>
<a href="#l142.228"></a><span id="l142.228">     rv = DoNtlmStep2(m_commandResponse, cmd);</span>
<a href="#l142.229"></a><span id="l142.229">   else if (m_currentAuthMethod == POP3_HAS_AUTH_CRAM_MD5)</span>
<a href="#l142.230"></a><span id="l142.230">   {</span>
<a href="#l142.231"></a><span id="l142.231">     PR_LOG(POP3LOGMODULE, PR_LOG_DEBUG, (&quot;CRAM login&quot;));</span>
<a href="#l142.232"></a><span id="l142.232" class="difflineminus">-    char buffer[512]; // TODO nsCAutoString</span>
<a href="#l142.233"></a><span id="l142.233" class="difflineplus">+    char buffer[512]; // TODO nsAutoCString</span>
<a href="#l142.234"></a><span id="l142.234">     unsigned char digest[DIGEST_LENGTH];</span>
<a href="#l142.235"></a><span id="l142.235"> </span>
<a href="#l142.236"></a><span id="l142.236">     char *decodedChallenge = PL_Base64Decode(m_commandResponse.get(),</span>
<a href="#l142.237"></a><span id="l142.237">     m_commandResponse.Length(), nullptr);</span>
<a href="#l142.238"></a><span id="l142.238"> </span>
<a href="#l142.239"></a><span id="l142.239">     if (decodedChallenge)</span>
<a href="#l142.240"></a><span id="l142.240">       rv = MSGCramMD5(decodedChallenge, strlen(decodedChallenge),</span>
<a href="#l142.241"></a><span id="l142.241">                       m_passwordResult.get(), m_passwordResult.Length(), digest);</span>
<a href="#l142.242"></a><span id="l142.242">     else</span>
<a href="#l142.243"></a><span id="l142.243">       rv = NS_ERROR_NULL_POINTER;</span>
<a href="#l142.244"></a><span id="l142.244"> </span>
<a href="#l142.245"></a><span id="l142.245">     if (NS_SUCCEEDED(rv))</span>
<a href="#l142.246"></a><span id="l142.246">     {</span>
<a href="#l142.247"></a><span id="l142.247" class="difflineminus">-      nsCAutoString encodedDigest;</span>
<a href="#l142.248"></a><span id="l142.248" class="difflineplus">+      nsAutoCString encodedDigest;</span>
<a href="#l142.249"></a><span id="l142.249">       char hexVal[8];</span>
<a href="#l142.250"></a><span id="l142.250"> </span>
<a href="#l142.251"></a><span id="l142.251">       for (uint32_t j = 0; j &lt; 16; j++)</span>
<a href="#l142.252"></a><span id="l142.252">       {</span>
<a href="#l142.253"></a><span id="l142.253">         PR_snprintf (hexVal,8, &quot;%.2x&quot;, 0x0ff &amp; (unsigned short)digest[j]);</span>
<a href="#l142.254"></a><span id="l142.254">         encodedDigest.Append(hexVal);</span>
<a href="#l142.255"></a><span id="l142.255">       }</span>
<a href="#l142.256"></a><span id="l142.256"> </span>
<a href="#l142.257"></a><span id="l142.257" class="difflineat">@@ -2183,17 +2183,17 @@ int32_t nsPop3Protocol::SendPassword()</span>
<a href="#l142.258"></a><span id="l142.258">     char buffer[512];</span>
<a href="#l142.259"></a><span id="l142.259">     unsigned char digest[DIGEST_LENGTH];</span>
<a href="#l142.260"></a><span id="l142.260"> </span>
<a href="#l142.261"></a><span id="l142.261">     rv = MSGApopMD5(m_ApopTimestamp.get(), m_ApopTimestamp.Length(),</span>
<a href="#l142.262"></a><span id="l142.262">                     m_passwordResult.get(), m_passwordResult.Length(), digest);</span>
<a href="#l142.263"></a><span id="l142.263"> </span>
<a href="#l142.264"></a><span id="l142.264">     if (NS_SUCCEEDED(rv))</span>
<a href="#l142.265"></a><span id="l142.265">     {</span>
<a href="#l142.266"></a><span id="l142.266" class="difflineminus">-      nsCAutoString encodedDigest;</span>
<a href="#l142.267"></a><span id="l142.267" class="difflineplus">+      nsAutoCString encodedDigest;</span>
<a href="#l142.268"></a><span id="l142.268">       char hexVal[8];</span>
<a href="#l142.269"></a><span id="l142.269"> </span>
<a href="#l142.270"></a><span id="l142.270">       for (uint32_t j=0; j&lt;16; j++)</span>
<a href="#l142.271"></a><span id="l142.271">       {</span>
<a href="#l142.272"></a><span id="l142.272">         PR_snprintf (hexVal,8, &quot;%.2x&quot;, 0x0ff &amp; (unsigned short)digest[j]);</span>
<a href="#l142.273"></a><span id="l142.273">         encodedDigest.Append(hexVal);</span>
<a href="#l142.274"></a><span id="l142.274">       }</span>
<a href="#l142.275"></a><span id="l142.275"> </span>
<a href="#l142.276"></a><span id="l142.276" class="difflineat">@@ -2271,17 +2271,17 @@ int32_t nsPop3Protocol::SendPassword()</span>
<a href="#l142.277"></a><span id="l142.277"> </span>
<a href="#l142.278"></a><span id="l142.278">   m_password_already_sent = true;</span>
<a href="#l142.279"></a><span id="l142.279">   m_lastPasswordSent = m_passwordResult;</span>
<a href="#l142.280"></a><span id="l142.280">   return SendData(cmd.get(), true);</span>
<a href="#l142.281"></a><span id="l142.281"> }</span>
<a href="#l142.282"></a><span id="l142.282"> </span>
<a href="#l142.283"></a><span id="l142.283"> int32_t nsPop3Protocol::SendStatOrGurl(bool sendStat)</span>
<a href="#l142.284"></a><span id="l142.284"> {</span>
<a href="#l142.285"></a><span id="l142.285" class="difflineminus">-  nsCAutoString cmd;</span>
<a href="#l142.286"></a><span id="l142.286" class="difflineplus">+  nsAutoCString cmd;</span>
<a href="#l142.287"></a><span id="l142.287">   if (sendStat)</span>
<a href="#l142.288"></a><span id="l142.288">   {</span>
<a href="#l142.289"></a><span id="l142.289">     cmd  = &quot;STAT&quot; CRLF;</span>
<a href="#l142.290"></a><span id="l142.290">     m_pop3ConData-&gt;next_state_after_response = POP3_GET_STAT;</span>
<a href="#l142.291"></a><span id="l142.291">   }</span>
<a href="#l142.292"></a><span id="l142.292">   else</span>
<a href="#l142.293"></a><span id="l142.293">   {</span>
<a href="#l142.294"></a><span id="l142.294">     cmd = &quot;GURL&quot; CRLF;</span>
<a href="#l142.295"></a><span id="l142.295" class="difflineat">@@ -3494,17 +3494,17 @@ nsPop3Protocol::TopResponse(nsIInputStre</span>
<a href="#l142.296"></a><span id="l142.296">     Note that the progress bar will not be accurate in this case.</span>
<a href="#l142.297"></a><span id="l142.297">     Oops. #### */</span>
<a href="#l142.298"></a><span id="l142.298">     m_pop3ConData-&gt;truncating_cur_msg = false;</span>
<a href="#l142.299"></a><span id="l142.299"> </span>
<a href="#l142.300"></a><span id="l142.300">     nsString statusTemplate;</span>
<a href="#l142.301"></a><span id="l142.301">     mLocalBundle-&gt;GetStringFromID(POP3_SERVER_DOES_NOT_SUPPORT_THE_TOP_COMMAND, getter_Copies(statusTemplate));</span>
<a href="#l142.302"></a><span id="l142.302">     if (!statusTemplate.IsEmpty())</span>
<a href="#l142.303"></a><span id="l142.303">     {</span>
<a href="#l142.304"></a><span id="l142.304" class="difflineminus">-      nsCAutoString hostName;</span>
<a href="#l142.305"></a><span id="l142.305" class="difflineplus">+      nsAutoCString hostName;</span>
<a href="#l142.306"></a><span id="l142.306">       PRUnichar * statusString = nullptr;</span>
<a href="#l142.307"></a><span id="l142.307">       m_url-&gt;GetHost(hostName);</span>
<a href="#l142.308"></a><span id="l142.308"> </span>
<a href="#l142.309"></a><span id="l142.309">       statusString = nsTextFormatter::smprintf(statusTemplate.get(), hostName.get());</span>
<a href="#l142.310"></a><span id="l142.310">       UpdateStatusWithString(statusString);</span>
<a href="#l142.311"></a><span id="l142.311">       nsTextFormatter::smprintf_free(statusString);</span>
<a href="#l142.312"></a><span id="l142.312">     }</span>
<a href="#l142.313"></a><span id="l142.313"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l143.1"></a><span id="l143.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l143.2"></a><span id="l143.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l143.3"></a><span id="l143.3" class="difflineat">@@ -312,17 +312,17 @@ NS_IMETHODIMP nsPop3Service::GetProtocol</span>
<a href="#l143.4"></a><span id="l143.4"> </span>
<a href="#l143.5"></a><span id="l143.5"> NS_IMETHODIMP nsPop3Service::NewURI(const nsACString &amp;aSpec,</span>
<a href="#l143.6"></a><span id="l143.6">                                     const char *aOriginCharset, // ignored</span>
<a href="#l143.7"></a><span id="l143.7">                                     nsIURI *aBaseURI,</span>
<a href="#l143.8"></a><span id="l143.8">                                     nsIURI **_retval)</span>
<a href="#l143.9"></a><span id="l143.9"> {</span>
<a href="#l143.10"></a><span id="l143.10">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l143.11"></a><span id="l143.11"> </span>
<a href="#l143.12"></a><span id="l143.12" class="difflineminus">-    nsCAutoString folderUri(aSpec);</span>
<a href="#l143.13"></a><span id="l143.13" class="difflineplus">+    nsAutoCString folderUri(aSpec);</span>
<a href="#l143.14"></a><span id="l143.14">     nsCOMPtr&lt;nsIRDFResource&gt; resource;</span>
<a href="#l143.15"></a><span id="l143.15">     int32_t offset = folderUri.FindChar('?');</span>
<a href="#l143.16"></a><span id="l143.16">     if (offset != kNotFound)</span>
<a href="#l143.17"></a><span id="l143.17">       folderUri.SetLength(offset);</span>
<a href="#l143.18"></a><span id="l143.18"> </span>
<a href="#l143.19"></a><span id="l143.19">     const char *uidl = PL_strstr(nsCString(aSpec).get(), &quot;uidl=&quot;);</span>
<a href="#l143.20"></a><span id="l143.20">     NS_ENSURE_TRUE(uidl, NS_ERROR_FAILURE);</span>
<a href="#l143.21"></a><span id="l143.21"> </span>
<a href="#l143.22"></a><span id="l143.22" class="difflineat">@@ -384,17 +384,17 @@ NS_IMETHODIMP nsPop3Service::NewURI(cons</span>
<a href="#l143.23"></a><span id="l143.23">     server-&gt;GetPort(&amp;port);</span>
<a href="#l143.24"></a><span id="l143.24">     if (port == -1) port = nsIPop3URL::DEFAULT_POP3_PORT;</span>
<a href="#l143.25"></a><span id="l143.25"> </span>
<a href="#l143.26"></a><span id="l143.26">     // we need to escape the username because it may contain</span>
<a href="#l143.27"></a><span id="l143.27">     // characters like / % or @</span>
<a href="#l143.28"></a><span id="l143.28">     nsCString escapedUsername;</span>
<a href="#l143.29"></a><span id="l143.29">     MsgEscapeString(username, nsINetUtil::ESCAPE_XALPHAS, escapedUsername);</span>
<a href="#l143.30"></a><span id="l143.30"> </span>
<a href="#l143.31"></a><span id="l143.31" class="difflineminus">-    nsCAutoString popSpec(&quot;pop://&quot;);</span>
<a href="#l143.32"></a><span id="l143.32" class="difflineplus">+    nsAutoCString popSpec(&quot;pop://&quot;);</span>
<a href="#l143.33"></a><span id="l143.33">     popSpec += escapedUsername;</span>
<a href="#l143.34"></a><span id="l143.34">     popSpec += &quot;@&quot;;</span>
<a href="#l143.35"></a><span id="l143.35">     popSpec += hostname;</span>
<a href="#l143.36"></a><span id="l143.36">     popSpec += &quot;:&quot;;</span>
<a href="#l143.37"></a><span id="l143.37">     popSpec.AppendInt(port);</span>
<a href="#l143.38"></a><span id="l143.38">     popSpec += &quot;?&quot;;</span>
<a href="#l143.39"></a><span id="l143.39">     popSpec += uidl;</span>
<a href="#l143.40"></a><span id="l143.40">     nsCOMPtr&lt;nsIUrlListener&gt; urlListener = do_QueryInterface(folder, &amp;rv);</span>
<a href="#l143.41"></a><span id="l143.41" class="difflineat">@@ -410,17 +410,17 @@ NS_IMETHODIMP nsPop3Service::NewURI(cons</span>
<a href="#l143.42"></a><span id="l143.42">       // escape the username before we call SetUsername().  we do this because GetUsername()</span>
<a href="#l143.43"></a><span id="l143.43">       // will unescape the username</span>
<a href="#l143.44"></a><span id="l143.44">       mailnewsurl-&gt;SetUsername(escapedUsername);</span>
<a href="#l143.45"></a><span id="l143.45">     }</span>
<a href="#l143.46"></a><span id="l143.46"> </span>
<a href="#l143.47"></a><span id="l143.47">     nsCOMPtr&lt;nsIPop3URL&gt; popurl = do_QueryInterface(mailnewsurl, &amp;rv);</span>
<a href="#l143.48"></a><span id="l143.48">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l143.49"></a><span id="l143.49"> </span>
<a href="#l143.50"></a><span id="l143.50" class="difflineminus">-    nsCAutoString messageUri (aSpec);</span>
<a href="#l143.51"></a><span id="l143.51" class="difflineplus">+    nsAutoCString messageUri (aSpec);</span>
<a href="#l143.52"></a><span id="l143.52">     if (!strncmp(messageUri.get(), &quot;mailbox:&quot;, 8))</span>
<a href="#l143.53"></a><span id="l143.53">       messageUri.Replace(0, 8, &quot;mailbox-message:&quot;);</span>
<a href="#l143.54"></a><span id="l143.54">     offset = messageUri.Find(&quot;?number=&quot;);</span>
<a href="#l143.55"></a><span id="l143.55">     if (offset != kNotFound)</span>
<a href="#l143.56"></a><span id="l143.56">       messageUri.Replace(offset, 8, &quot;#&quot;);</span>
<a href="#l143.57"></a><span id="l143.57">     offset = messageUri.FindChar('&amp;');</span>
<a href="#l143.58"></a><span id="l143.58">     if (offset != kNotFound)</span>
<a href="#l143.59"></a><span id="l143.59">       messageUri.SetLength(offset);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l144.1"></a><span id="l144.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l144.2"></a><span id="l144.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l144.3"></a><span id="l144.3" class="difflineat">@@ -570,25 +570,25 @@ nsPop3Sink::IncorporateBegin(const char*</span>
<a href="#l144.4"></a><span id="l144.4"> </span>
<a href="#l144.5"></a><span id="l144.5">   rv = WriteLineToMailbox(dummyEnvelope);</span>
<a href="#l144.6"></a><span id="l144.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l144.7"></a><span id="l144.7">     // write out account-key before UIDL so the code that looks for</span>
<a href="#l144.8"></a><span id="l144.8">     // UIDL will find the account first and know it can stop looking</span>
<a href="#l144.9"></a><span id="l144.9">     // once it finds the UIDL line.</span>
<a href="#l144.10"></a><span id="l144.10">     if (!m_accountKey.IsEmpty())</span>
<a href="#l144.11"></a><span id="l144.11">     {</span>
<a href="#l144.12"></a><span id="l144.12" class="difflineminus">-      nsCAutoString outputString;</span>
<a href="#l144.13"></a><span id="l144.13" class="difflineplus">+      nsAutoCString outputString;</span>
<a href="#l144.14"></a><span id="l144.14">       outputString.AssignLiteral(HEADER_X_MOZILLA_ACCOUNT_KEY &quot;: &quot;);</span>
<a href="#l144.15"></a><span id="l144.15">       outputString.Append(m_accountKey);</span>
<a href="#l144.16"></a><span id="l144.16">       outputString.AppendLiteral(MSG_LINEBREAK);</span>
<a href="#l144.17"></a><span id="l144.17">       WriteLineToMailbox(outputString.get());</span>
<a href="#l144.18"></a><span id="l144.18">     }</span>
<a href="#l144.19"></a><span id="l144.19">     if (uidlString)</span>
<a href="#l144.20"></a><span id="l144.20">     {</span>
<a href="#l144.21"></a><span id="l144.21" class="difflineminus">-      nsCAutoString uidlCString(&quot;X-UIDL: &quot;);</span>
<a href="#l144.22"></a><span id="l144.22" class="difflineplus">+      nsAutoCString uidlCString(&quot;X-UIDL: &quot;);</span>
<a href="#l144.23"></a><span id="l144.23">       uidlCString += uidlString;</span>
<a href="#l144.24"></a><span id="l144.24">       uidlCString += MSG_LINEBREAK;</span>
<a href="#l144.25"></a><span id="l144.25">       rv = WriteLineToMailbox(const_cast&lt;char*&gt;(uidlCString.get()));</span>
<a href="#l144.26"></a><span id="l144.26">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l144.27"></a><span id="l144.27">     }</span>
<a href="#l144.28"></a><span id="l144.28">     // WriteLineToMailbox(&quot;X-Mozilla-Status: 8000&quot; MSG_LINEBREAK);</span>
<a href="#l144.29"></a><span id="l144.29">     char *statusLine = PR_smprintf(X_MOZILLA_STATUS_FORMAT MSG_LINEBREAK, flags);</span>
<a href="#l144.30"></a><span id="l144.30">     rv = WriteLineToMailbox(statusLine);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l145.1"></a><span id="l145.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/Registry.cpp</span>
<a href="#l145.2"></a><span id="l145.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/Registry.cpp</span>
<a href="#l145.3"></a><span id="l145.3" class="difflineat">@@ -39,23 +39,23 @@ BOOL CLSIDtochar(const CLSID&amp; clsid, cha</span>
<a href="#l145.4"></a><span id="l145.4">     // Free memory.</span>
<a href="#l145.5"></a><span id="l145.5">     CoTaskMemFree(wszCLSID);</span>
<a href="#l145.6"></a><span id="l145.6"> </span>
<a href="#l145.7"></a><span id="l145.7">     return TRUE;</span>
<a href="#l145.8"></a><span id="l145.8"> }</span>
<a href="#l145.9"></a><span id="l145.9"> </span>
<a href="#l145.10"></a><span id="l145.10"> // Create a key and set its value.</span>
<a href="#l145.11"></a><span id="l145.11"> </span>
<a href="#l145.12"></a><span id="l145.12" class="difflineminus">-BOOL setKeyAndValue(nsCAutoString keyName, const char* subKey,</span>
<a href="#l145.13"></a><span id="l145.13" class="difflineplus">+BOOL setKeyAndValue(nsAutoCString keyName, const char* subKey,</span>
<a href="#l145.14"></a><span id="l145.14">                     const char* theValue)</span>
<a href="#l145.15"></a><span id="l145.15"> {</span>
<a href="#l145.16"></a><span id="l145.16">     HKEY hKey;</span>
<a href="#l145.17"></a><span id="l145.17">     BOOL retValue = TRUE;</span>
<a href="#l145.18"></a><span id="l145.18"> </span>
<a href="#l145.19"></a><span id="l145.19" class="difflineminus">-    nsCAutoString theKey(keyName);</span>
<a href="#l145.20"></a><span id="l145.20" class="difflineplus">+    nsAutoCString theKey(keyName);</span>
<a href="#l145.21"></a><span id="l145.21">     if (subKey != NULL)</span>
<a href="#l145.22"></a><span id="l145.22">     {</span>
<a href="#l145.23"></a><span id="l145.23">         theKey += &quot;\\&quot;;</span>
<a href="#l145.24"></a><span id="l145.24">         theKey += subKey;</span>
<a href="#l145.25"></a><span id="l145.25">     }</span>
<a href="#l145.26"></a><span id="l145.26"> </span>
<a href="#l145.27"></a><span id="l145.27">     // Create and open key and subkey.</span>
<a href="#l145.28"></a><span id="l145.28">     long lResult = RegCreateKeyEx(HKEY_CLASSES_ROOT, theKey.get(), </span>
<a href="#l145.29"></a><span id="l145.29" class="difflineat">@@ -130,17 +130,17 @@ void RegisterProxy()</span>
<a href="#l145.30"></a><span id="l145.30">     if (dwResult == 0)</span>
<a href="#l145.31"></a><span id="l145.31">         return;</span>
<a href="#l145.32"></a><span id="l145.32"> </span>
<a href="#l145.33"></a><span id="l145.33">     pTemp = strrchr(szModule, '\\');</span>
<a href="#l145.34"></a><span id="l145.34">     if (pTemp == NULL)</span>
<a href="#l145.35"></a><span id="l145.35">         return;</span>
<a href="#l145.36"></a><span id="l145.36"> </span>
<a href="#l145.37"></a><span id="l145.37">     *pTemp = '\0';</span>
<a href="#l145.38"></a><span id="l145.38" class="difflineminus">-    nsCAutoString proxyPath(szModule);</span>
<a href="#l145.39"></a><span id="l145.39" class="difflineplus">+    nsAutoCString proxyPath(szModule);</span>
<a href="#l145.40"></a><span id="l145.40"> </span>
<a href="#l145.41"></a><span id="l145.41">     proxyPath += &quot;\\&quot;;</span>
<a href="#l145.42"></a><span id="l145.42">     proxyPath += MAPI_PROXY_DLL_NAME;</span>
<a href="#l145.43"></a><span id="l145.43"> </span>
<a href="#l145.44"></a><span id="l145.44">     h = LoadLibrary(proxyPath.get());</span>
<a href="#l145.45"></a><span id="l145.45">     if (h == NULL)</span>
<a href="#l145.46"></a><span id="l145.46">         return;</span>
<a href="#l145.47"></a><span id="l145.47"> </span>
<a href="#l145.48"></a><span id="l145.48" class="difflineat">@@ -165,17 +165,17 @@ void UnRegisterProxy()</span>
<a href="#l145.49"></a><span id="l145.49">     if (dwResult == 0)</span>
<a href="#l145.50"></a><span id="l145.50">         return;</span>
<a href="#l145.51"></a><span id="l145.51"> </span>
<a href="#l145.52"></a><span id="l145.52">     pTemp = strrchr(szModule, '\\');</span>
<a href="#l145.53"></a><span id="l145.53">     if (pTemp == NULL)</span>
<a href="#l145.54"></a><span id="l145.54">         return;</span>
<a href="#l145.55"></a><span id="l145.55"> </span>
<a href="#l145.56"></a><span id="l145.56">     *pTemp = '\0';</span>
<a href="#l145.57"></a><span id="l145.57" class="difflineminus">-    nsCAutoString proxyPath(szModule);</span>
<a href="#l145.58"></a><span id="l145.58" class="difflineplus">+    nsAutoCString proxyPath(szModule);</span>
<a href="#l145.59"></a><span id="l145.59"> </span>
<a href="#l145.60"></a><span id="l145.60">     proxyPath += &quot;\\&quot;;</span>
<a href="#l145.61"></a><span id="l145.61">     proxyPath += MAPI_PROXY_DLL_NAME;</span>
<a href="#l145.62"></a><span id="l145.62"> </span>
<a href="#l145.63"></a><span id="l145.63">     h = LoadLibrary(proxyPath.get());</span>
<a href="#l145.64"></a><span id="l145.64">     if (h == NULL)</span>
<a href="#l145.65"></a><span id="l145.65">         return;</span>
<a href="#l145.66"></a><span id="l145.66"> </span>
<a href="#l145.67"></a><span id="l145.67" class="difflineat">@@ -192,27 +192,27 @@ HRESULT RegisterServer(const CLSID&amp; clsi</span>
<a href="#l145.68"></a><span id="l145.68">                        const char* szFriendlyName, // Friendly Name</span>
<a href="#l145.69"></a><span id="l145.69">                        const char* szVerIndProgID, // Programmatic</span>
<a href="#l145.70"></a><span id="l145.70">                        const char* szProgID)       //   IDs</span>
<a href="#l145.71"></a><span id="l145.71"> {</span>
<a href="#l145.72"></a><span id="l145.72">     HMODULE hModule = GetModuleHandle(NULL);</span>
<a href="#l145.73"></a><span id="l145.73">     char szModuleName[MAX_SIZE];</span>
<a href="#l145.74"></a><span id="l145.74">     char szCLSID[CLSID_STRING_SIZE];</span>
<a href="#l145.75"></a><span id="l145.75"> </span>
<a href="#l145.76"></a><span id="l145.76" class="difflineminus">-    nsCAutoString independentProgId(szVerIndProgID);</span>
<a href="#l145.77"></a><span id="l145.77" class="difflineminus">-    nsCAutoString progId(szProgID);</span>
<a href="#l145.78"></a><span id="l145.78" class="difflineplus">+    nsAutoCString independentProgId(szVerIndProgID);</span>
<a href="#l145.79"></a><span id="l145.79" class="difflineplus">+    nsAutoCString progId(szProgID);</span>
<a href="#l145.80"></a><span id="l145.80"> </span>
<a href="#l145.81"></a><span id="l145.81">     DWORD dwResult = ::GetModuleFileName(hModule, szModuleName,</span>
<a href="#l145.82"></a><span id="l145.82">                               sizeof(szModuleName)/sizeof(char));</span>
<a href="#l145.83"></a><span id="l145.83"> </span>
<a href="#l145.84"></a><span id="l145.84">     if (dwResult == 0)</span>
<a href="#l145.85"></a><span id="l145.85">         return S_FALSE;</span>
<a href="#l145.86"></a><span id="l145.86"> </span>
<a href="#l145.87"></a><span id="l145.87" class="difflineminus">-    nsCAutoString moduleName(szModuleName);</span>
<a href="#l145.88"></a><span id="l145.88" class="difflineminus">-    nsCAutoString registryKey(&quot;CLSID\\&quot;);</span>
<a href="#l145.89"></a><span id="l145.89" class="difflineplus">+    nsAutoCString moduleName(szModuleName);</span>
<a href="#l145.90"></a><span id="l145.90" class="difflineplus">+    nsAutoCString registryKey(&quot;CLSID\\&quot;);</span>
<a href="#l145.91"></a><span id="l145.91"> </span>
<a href="#l145.92"></a><span id="l145.92">     moduleName += MAPI_STARTUP_ARG;</span>
<a href="#l145.93"></a><span id="l145.93"> </span>
<a href="#l145.94"></a><span id="l145.94">     // Convert the CLSID into a char.</span>
<a href="#l145.95"></a><span id="l145.95"> </span>
<a href="#l145.96"></a><span id="l145.96">     if (!CLSIDtochar(clsid, szCLSID, sizeof(szCLSID)))</span>
<a href="#l145.97"></a><span id="l145.97">         return S_FALSE;</span>
<a href="#l145.98"></a><span id="l145.98">     registryKey += szCLSID;</span>
<a href="#l145.99"></a><span id="l145.99" class="difflineat">@@ -260,17 +260,17 @@ LONG UnregisterServer(const CLSID&amp; clsid</span>
<a href="#l145.100"></a><span id="l145.100">     // Convert the CLSID into a char.</span>
<a href="#l145.101"></a><span id="l145.101"> </span>
<a href="#l145.102"></a><span id="l145.102">     char szCLSID[CLSID_STRING_SIZE];</span>
<a href="#l145.103"></a><span id="l145.103">     if (!CLSIDtochar(clsid, szCLSID, sizeof(szCLSID)))</span>
<a href="#l145.104"></a><span id="l145.104">         return S_FALSE;</span>
<a href="#l145.105"></a><span id="l145.105"> </span>
<a href="#l145.106"></a><span id="l145.106">     UnRegisterProxy();</span>
<a href="#l145.107"></a><span id="l145.107"> </span>
<a href="#l145.108"></a><span id="l145.108" class="difflineminus">-    nsCAutoString registryKey(&quot;CLSID\\&quot;);</span>
<a href="#l145.109"></a><span id="l145.109" class="difflineplus">+    nsAutoCString registryKey(&quot;CLSID\\&quot;);</span>
<a href="#l145.110"></a><span id="l145.110">     registryKey += szCLSID;</span>
<a href="#l145.111"></a><span id="l145.111"> </span>
<a href="#l145.112"></a><span id="l145.112">     lResult = recursiveDeleteKey(HKEY_CLASSES_ROOT, registryKey.get());</span>
<a href="#l145.113"></a><span id="l145.113">     if (lResult == ERROR_SUCCESS || lResult == ERROR_FILE_NOT_FOUND)</span>
<a href="#l145.114"></a><span id="l145.114">         return lResult;</span>
<a href="#l145.115"></a><span id="l145.115"> </span>
<a href="#l145.116"></a><span id="l145.116">     registryKey += &quot;\\LocalServer32&quot;;</span>
<a href="#l145.117"></a><span id="l145.117"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l146.1"></a><span id="l146.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l146.2"></a><span id="l146.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l146.3"></a><span id="l146.3" class="difflineat">@@ -299,17 +299,17 @@ nsresult nsMapiHook::BlindSendMail (unsi</span>
<a href="#l146.4"></a><span id="l146.4"> </span>
<a href="#l146.5"></a><span id="l146.5">   rv = appService-&gt;GetHiddenDOMWindow(getter_AddRefs(hiddenWindow));</span>
<a href="#l146.6"></a><span id="l146.6">   if ( NS_FAILED(rv) ) return rv ;</span>
<a href="#l146.7"></a><span id="l146.7">   // smtp password and Logged in used IdKey from MapiConfig (session obj)</span>
<a href="#l146.8"></a><span id="l146.8">   nsMAPIConfiguration * pMapiConfig = nsMAPIConfiguration::GetMAPIConfiguration() ;</span>
<a href="#l146.9"></a><span id="l146.9">   if (!pMapiConfig) return NS_ERROR_FAILURE ;  // get the singelton obj</span>
<a href="#l146.10"></a><span id="l146.10">   PRUnichar * password = pMapiConfig-&gt;GetPassword(aSession) ;</span>
<a href="#l146.11"></a><span id="l146.11">   // password</span>
<a href="#l146.12"></a><span id="l146.12" class="difflineminus">-  nsCAutoString smtpPassword;</span>
<a href="#l146.13"></a><span id="l146.13" class="difflineplus">+  nsAutoCString smtpPassword;</span>
<a href="#l146.14"></a><span id="l146.14">   LossyCopyUTF16toASCII(password, smtpPassword);</span>
<a href="#l146.15"></a><span id="l146.15"> </span>
<a href="#l146.16"></a><span id="l146.16">   // Id key</span>
<a href="#l146.17"></a><span id="l146.17">   nsCString MsgIdKey;</span>
<a href="#l146.18"></a><span id="l146.18">   pMapiConfig-&gt;GetIdKey(aSession, MsgIdKey);</span>
<a href="#l146.19"></a><span id="l146.19"> </span>
<a href="#l146.20"></a><span id="l146.20">   // get the MsgIdentity for the above key using AccountManager</span>
<a href="#l146.21"></a><span id="l146.21">   nsCOMPtr &lt;nsIMsgAccountManager&gt; accountManager = do_GetService (NS_MSGACCOUNTMANAGER_CONTRACTID) ;</span>
<a href="#l146.22"></a><span id="l146.22" class="difflineat">@@ -448,18 +448,18 @@ nsresult nsMapiHook::PopulateCompFields(</span>
<a href="#l146.23"></a><span id="l146.23">   return rv ;</span>
<a href="#l146.24"></a><span id="l146.24"> }</span>
<a href="#l146.25"></a><span id="l146.25"> </span>
<a href="#l146.26"></a><span id="l146.26"> nsresult nsMapiHook::HandleAttachments (nsIMsgCompFields * aCompFields, int32_t aFileCount,</span>
<a href="#l146.27"></a><span id="l146.27">                                         lpnsMapiFileDesc aFiles, BOOL aIsUnicode)</span>
<a href="#l146.28"></a><span id="l146.28"> {</span>
<a href="#l146.29"></a><span id="l146.29">     nsresult rv = NS_OK ;</span>
<a href="#l146.30"></a><span id="l146.30"> </span>
<a href="#l146.31"></a><span id="l146.31" class="difflineminus">-    nsCAutoString Attachments ;</span>
<a href="#l146.32"></a><span id="l146.32" class="difflineminus">-    nsCAutoString TempFiles ;</span>
<a href="#l146.33"></a><span id="l146.33" class="difflineplus">+    nsAutoCString Attachments ;</span>
<a href="#l146.34"></a><span id="l146.34" class="difflineplus">+    nsAutoCString TempFiles ;</span>
<a href="#l146.35"></a><span id="l146.35"> </span>
<a href="#l146.36"></a><span id="l146.36">     nsCOMPtr &lt;nsIFile&gt; pFile = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l146.37"></a><span id="l146.37">     if (NS_FAILED(rv) || (!pFile) ) return rv ;</span>
<a href="#l146.38"></a><span id="l146.38">     nsCOMPtr &lt;nsIFile&gt; pTempDir = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l146.39"></a><span id="l146.39">     if (NS_FAILED(rv) || (!pTempDir) ) return rv ;</span>
<a href="#l146.40"></a><span id="l146.40"> </span>
<a href="#l146.41"></a><span id="l146.41">     for (int i=0 ; i &lt; aFileCount ; i++)</span>
<a href="#l146.42"></a><span id="l146.42">     {</span>
<a href="#l146.43"></a><span id="l146.43" class="difflineat">@@ -536,17 +536,17 @@ nsresult nsMapiHook::HandleAttachments (</span>
<a href="#l146.44"></a><span id="l146.44">             // point pFile to the new location of the attachment</span>
<a href="#l146.45"></a><span id="l146.45">             pFile-&gt;InitWithFile(pTempDir);</span>
<a href="#l146.46"></a><span id="l146.46">             pFile-&gt;Append(leafName);</span>
<a href="#l146.47"></a><span id="l146.47"> </span>
<a href="#l146.48"></a><span id="l146.48">             // create MsgCompose attachment object</span>
<a href="#l146.49"></a><span id="l146.49">             attachment-&gt;SetTemporary(true); // this one is a temp file so set the flag for MsgCompose</span>
<a href="#l146.50"></a><span id="l146.50"> </span>
<a href="#l146.51"></a><span id="l146.51">             // now set the attachment object</span>
<a href="#l146.52"></a><span id="l146.52" class="difflineminus">-            nsCAutoString pURL ;</span>
<a href="#l146.53"></a><span id="l146.53" class="difflineplus">+            nsAutoCString pURL ;</span>
<a href="#l146.54"></a><span id="l146.54">             NS_GetURLSpecFromFile(pFile, pURL);</span>
<a href="#l146.55"></a><span id="l146.55">             attachment-&gt;SetUrl(pURL);</span>
<a href="#l146.56"></a><span id="l146.56"> </span>
<a href="#l146.57"></a><span id="l146.57">             // set the file size</span>
<a href="#l146.58"></a><span id="l146.58">             int64_t fileSize;</span>
<a href="#l146.59"></a><span id="l146.59">             pFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l146.60"></a><span id="l146.60">             attachment-&gt;SetSize(fileSize);</span>
<a href="#l146.61"></a><span id="l146.61"> </span>
<a href="#l146.62"></a><span id="l146.62" class="difflineat">@@ -614,17 +614,17 @@ nsresult nsMapiHook::PopulateCompFieldsW</span>
<a href="#l146.63"></a><span id="l146.63"> </span>
<a href="#l146.64"></a><span id="l146.64">   // set To, Cc, Bcc</span>
<a href="#l146.65"></a><span id="l146.65">   aCompFields-&gt;SetTo (To) ;</span>
<a href="#l146.66"></a><span id="l146.66">   aCompFields-&gt;SetCc (Cc) ;</span>
<a href="#l146.67"></a><span id="l146.67">   aCompFields-&gt;SetBcc (Bcc) ;</span>
<a href="#l146.68"></a><span id="l146.68"> </span>
<a href="#l146.69"></a><span id="l146.69">   PR_LOG(MAPI, PR_LOG_DEBUG, (&quot;to: %s cc: %s bcc: %s \n&quot;, NS_ConvertUTF16toUTF8(To).get(), NS_ConvertUTF16toUTF8(Cc).get(), NS_ConvertUTF16toUTF8(Bcc).get()));</span>
<a href="#l146.70"></a><span id="l146.70"> </span>
<a href="#l146.71"></a><span id="l146.71" class="difflineminus">-  nsCAutoString platformCharSet;</span>
<a href="#l146.72"></a><span id="l146.72" class="difflineplus">+  nsAutoCString platformCharSet;</span>
<a href="#l146.73"></a><span id="l146.73">   // set subject</span>
<a href="#l146.74"></a><span id="l146.74">   if (aMessage-&gt;lpszSubject)</span>
<a href="#l146.75"></a><span id="l146.75">   {</span>
<a href="#l146.76"></a><span id="l146.76">     nsAutoString Subject ;</span>
<a href="#l146.77"></a><span id="l146.77">     if (platformCharSet.IsEmpty())</span>
<a href="#l146.78"></a><span id="l146.78">       platformCharSet.Assign(nsMsgI18NFileSystemCharset());</span>
<a href="#l146.79"></a><span id="l146.79">     rv = ConvertToUnicode(platformCharSet.get(), (char *) aMessage-&gt;lpszSubject, Subject);</span>
<a href="#l146.80"></a><span id="l146.80">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l146.81"></a><span id="l146.81" class="difflineat">@@ -775,17 +775,17 @@ nsresult nsMapiHook::PopulateCompFieldsF</span>
<a href="#l146.82"></a><span id="l146.82"> </span>
<a href="#l146.83"></a><span id="l146.83">       // now turn pTempDir into a full file path to the temp file</span>
<a href="#l146.84"></a><span id="l146.84">       pTempDir-&gt;Append(fileNameNative);</span>
<a href="#l146.85"></a><span id="l146.85"> </span>
<a href="#l146.86"></a><span id="l146.86">       // this one is a temp file so set the flag for MsgCompose</span>
<a href="#l146.87"></a><span id="l146.87">       attachment-&gt;SetTemporary(true);</span>
<a href="#l146.88"></a><span id="l146.88"> </span>
<a href="#l146.89"></a><span id="l146.89">       // now set the attachment object</span>
<a href="#l146.90"></a><span id="l146.90" class="difflineminus">-      nsCAutoString pURL;</span>
<a href="#l146.91"></a><span id="l146.91" class="difflineplus">+      nsAutoCString pURL;</span>
<a href="#l146.92"></a><span id="l146.92">       NS_GetURLSpecFromFile(pTempDir, pURL);</span>
<a href="#l146.93"></a><span id="l146.93">       attachment-&gt;SetUrl(pURL);</span>
<a href="#l146.94"></a><span id="l146.94"> </span>
<a href="#l146.95"></a><span id="l146.95">       // set the file size</span>
<a href="#l146.96"></a><span id="l146.96">       int64_t fileSize;</span>
<a href="#l146.97"></a><span id="l146.97">       pFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l146.98"></a><span id="l146.98">       attachment-&gt;SetSize(fileSize);</span>
<a href="#l146.99"></a><span id="l146.99"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l147.1"></a><span id="l147.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l147.2"></a><span id="l147.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l147.3"></a><span id="l147.3" class="difflineat">@@ -411,17 +411,17 @@ STDMETHODIMP CMapiImp::FindNext(unsigned</span>
<a href="#l147.4"></a><span id="l147.4">   PR_LOG(MAPI, PR_LOG_DEBUG, (&quot;CMapiImp::FindNext returning key %s\n&quot;, (char *) lpszMessageID));</span>
<a href="#l147.5"></a><span id="l147.5">   return(SUCCESS_SUCCESS);</span>
<a href="#l147.6"></a><span id="l147.6"> }</span>
<a href="#l147.7"></a><span id="l147.7"> </span>
<a href="#l147.8"></a><span id="l147.8"> STDMETHODIMP CMapiImp::ReadMail(unsigned long aSession, unsigned long ulUIParam, LPTSTR lpszMessageID,</span>
<a href="#l147.9"></a><span id="l147.9">                               unsigned long flFlags, unsigned long ulReserved, lpnsMapiMessage *lppMessage)</span>
<a href="#l147.10"></a><span id="l147.10"> {</span>
<a href="#l147.11"></a><span id="l147.11">   nsresult irv;</span>
<a href="#l147.12"></a><span id="l147.12" class="difflineminus">-  nsCAutoString keyString((char *) lpszMessageID);</span>
<a href="#l147.13"></a><span id="l147.13" class="difflineplus">+  nsAutoCString keyString((char *) lpszMessageID);</span>
<a href="#l147.14"></a><span id="l147.14">   PR_LOG(MAPI, PR_LOG_DEBUG, (&quot;CMapiImp::ReadMail asking for key %s\n&quot;, (char *) lpszMessageID));</span>
<a href="#l147.15"></a><span id="l147.15">   nsMsgKey msgKey = keyString.ToInteger(&amp;irv);</span>
<a href="#l147.16"></a><span id="l147.16">   if (NS_FAILED(irv))</span>
<a href="#l147.17"></a><span id="l147.17">   {</span>
<a href="#l147.18"></a><span id="l147.18">     NS_ASSERTION(false, &quot;invalid lpszMessageID&quot;);</span>
<a href="#l147.19"></a><span id="l147.19">     return MAPI_E_INVALID_MESSAGE;</span>
<a href="#l147.20"></a><span id="l147.20">   }</span>
<a href="#l147.21"></a><span id="l147.21">   MsgMapiListContext *listContext;</span>
<a href="#l147.22"></a><span id="l147.22" class="difflineat">@@ -437,17 +437,17 @@ STDMETHODIMP CMapiImp::ReadMail(unsigned</span>
<a href="#l147.23"></a><span id="l147.23">   return (*lppMessage) ? SUCCESS_SUCCESS : E_FAIL;</span>
<a href="#l147.24"></a><span id="l147.24"> }</span>
<a href="#l147.25"></a><span id="l147.25"> </span>
<a href="#l147.26"></a><span id="l147.26"> </span>
<a href="#l147.27"></a><span id="l147.27"> STDMETHODIMP CMapiImp::DeleteMail(unsigned long aSession, unsigned long ulUIParam, LPTSTR lpszMessageID,</span>
<a href="#l147.28"></a><span id="l147.28">                               unsigned long flFlags, unsigned long ulReserved)</span>
<a href="#l147.29"></a><span id="l147.29"> {</span>
<a href="#l147.30"></a><span id="l147.30">   nsresult irv;</span>
<a href="#l147.31"></a><span id="l147.31" class="difflineminus">-  nsCAutoString keyString((char *) lpszMessageID);</span>
<a href="#l147.32"></a><span id="l147.32" class="difflineplus">+  nsAutoCString keyString((char *) lpszMessageID);</span>
<a href="#l147.33"></a><span id="l147.33">   nsMsgKey msgKey = keyString.ToInteger(&amp;irv);</span>
<a href="#l147.34"></a><span id="l147.34">   // XXX Why do we return success on failure?</span>
<a href="#l147.35"></a><span id="l147.35">   if (NS_FAILED(irv))</span>
<a href="#l147.36"></a><span id="l147.36">     return SUCCESS_SUCCESS;</span>
<a href="#l147.37"></a><span id="l147.37">   MsgMapiListContext *listContext;</span>
<a href="#l147.38"></a><span id="l147.38">   LONG ret = InitContext(aSession, &amp;listContext);</span>
<a href="#l147.39"></a><span id="l147.39">   if (ret != SUCCESS_SUCCESS)</span>
<a href="#l147.40"></a><span id="l147.40">     return ret;</span>
<a href="#l147.41"></a><span id="l147.41" class="difflineat">@@ -735,17 +735,17 @@ char *MsgMapiListContext::ConvertBodyToM</span>
<a href="#l147.42"></a><span id="l147.42">     // ### really want to skip past headers...</span>
<a href="#l147.43"></a><span id="l147.43">     uint64_t messageOffset;</span>
<a href="#l147.44"></a><span id="l147.44">     uint32_t lineCount;</span>
<a href="#l147.45"></a><span id="l147.45">     hdr-&gt;GetMessageOffset(&amp;messageOffset);</span>
<a href="#l147.46"></a><span id="l147.46">     hdr-&gt;GetLineCount(&amp;lineCount);</span>
<a href="#l147.47"></a><span id="l147.47">     nsCOMPtr &lt;nsISeekableStream&gt; seekableStream = do_QueryInterface(inputStream);</span>
<a href="#l147.48"></a><span id="l147.48">     seekableStream-&gt;Seek(PR_SEEK_SET, messageOffset);</span>
<a href="#l147.49"></a><span id="l147.49">     bool hasMore = true;</span>
<a href="#l147.50"></a><span id="l147.50" class="difflineminus">-    nsCAutoString curLine;</span>
<a href="#l147.51"></a><span id="l147.51" class="difflineplus">+    nsAutoCString curLine;</span>
<a href="#l147.52"></a><span id="l147.52">     bool inMessageBody = false;</span>
<a href="#l147.53"></a><span id="l147.53">     nsresult rv = NS_OK;</span>
<a href="#l147.54"></a><span id="l147.54">     while (hasMore) // advance past message headers</span>
<a href="#l147.55"></a><span id="l147.55">     {</span>
<a href="#l147.56"></a><span id="l147.56">       nsresult rv = fileLineStream-&gt;ReadLine(curLine, &amp;hasMore);</span>
<a href="#l147.57"></a><span id="l147.57">       if (NS_FAILED(rv) || EMPTY_MESSAGE_LINE(curLine))</span>
<a href="#l147.58"></a><span id="l147.58">         break;</span>
<a href="#l147.59"></a><span id="l147.59">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l148.1"></a><span id="l148.1" class="difflineminus">--- a/mailnews/mime/cthandlers/vcard/mimevcrd.cpp</span>
<a href="#l148.2"></a><span id="l148.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/vcard/mimevcrd.cpp</span>
<a href="#l148.3"></a><span id="l148.3" class="difflineat">@@ -238,18 +238,18 @@ static int GenerateVCardData(MimeObject </span>
<a href="#l148.4"></a><span id="l148.4"> </span>
<a href="#l148.5"></a><span id="l148.5">   vCardOutput = &quot;&lt;table class=\&quot;moz-vcard-table\&quot;&gt; &lt;tr&gt; &quot;;  // outer table plus the first (and only row) we use for this table</span>
<a href="#l148.6"></a><span id="l148.6"> </span>
<a href="#l148.7"></a><span id="l148.7">   // we need to get an escaped vCard url to bind to our add to address book button</span>
<a href="#l148.8"></a><span id="l148.8">   nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService = do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l148.9"></a><span id="l148.9">   if (!vCardService)</span>
<a href="#l148.10"></a><span id="l148.10">       return -1;</span>
<a href="#l148.11"></a><span id="l148.11"> </span>
<a href="#l148.12"></a><span id="l148.12" class="difflineminus">-  nsCAutoString vCard;</span>
<a href="#l148.13"></a><span id="l148.13" class="difflineminus">-  nsCAutoString vEscCard;</span>
<a href="#l148.14"></a><span id="l148.14" class="difflineplus">+  nsAutoCString vCard;</span>
<a href="#l148.15"></a><span id="l148.15" class="difflineplus">+  nsAutoCString vEscCard;</span>
<a href="#l148.16"></a><span id="l148.16">   int len = 0;</span>
<a href="#l148.17"></a><span id="l148.17"> </span>
<a href="#l148.18"></a><span id="l148.18">   vCard.Adopt(vCardService-&gt;WriteMemoryVObjects(0, &amp;len, aVcard, false));</span>
<a href="#l148.19"></a><span id="l148.19">   MsgEscapeString(vCard, nsINetUtil::ESCAPE_XALPHAS, vEscCard);</span>
<a href="#l148.20"></a><span id="l148.20"> </span>
<a href="#l148.21"></a><span id="l148.21">   // first cell in the outer table row is a clickable image which brings up the rich address book UI for the vcard</span>
<a href="#l148.22"></a><span id="l148.22">   vCardOutput += &quot;&lt;td valign=\&quot;top\&quot;&gt; &lt;a class=\&quot;moz-vcard-badge\&quot; href=\&quot;addbook:add?action=add?vcard=&quot;;</span>
<a href="#l148.23"></a><span id="l148.23">   vCardOutput += vEscCard; // the href is the vCard</span>
<a href="#l148.24"></a><span id="l148.24" class="difflineat">@@ -272,19 +272,19 @@ static int GenerateVCardData(MimeObject </span>
<a href="#l148.25"></a><span id="l148.25"> }</span>
<a href="#l148.26"></a><span id="l148.26"> </span>
<a href="#l148.27"></a><span id="l148.27"> </span>
<a href="#l148.28"></a><span id="l148.28"> static int OutputBasicVcard(MimeObject *aMimeObj, VObject *aVcard, nsACString&amp; vCardOutput)</span>
<a href="#l148.29"></a><span id="l148.29"> {</span>
<a href="#l148.30"></a><span id="l148.30">   int status = 0;</span>
<a href="#l148.31"></a><span id="l148.31"> </span>
<a href="#l148.32"></a><span id="l148.32">   VObject *prop = NULL;</span>
<a href="#l148.33"></a><span id="l148.33" class="difflineminus">-  nsCAutoString urlstring;</span>
<a href="#l148.34"></a><span id="l148.34" class="difflineminus">-  nsCAutoString namestring;</span>
<a href="#l148.35"></a><span id="l148.35" class="difflineminus">-  nsCAutoString emailstring;</span>
<a href="#l148.36"></a><span id="l148.36" class="difflineplus">+  nsAutoCString urlstring;</span>
<a href="#l148.37"></a><span id="l148.37" class="difflineplus">+  nsAutoCString namestring;</span>
<a href="#l148.38"></a><span id="l148.38" class="difflineplus">+  nsAutoCString emailstring;</span>
<a href="#l148.39"></a><span id="l148.39"> </span>
<a href="#l148.40"></a><span id="l148.40">   nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService =  do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l148.41"></a><span id="l148.41">   if (!vCardService)</span>
<a href="#l148.42"></a><span id="l148.42">       return -1;</span>
<a href="#l148.43"></a><span id="l148.43"> </span>
<a href="#l148.44"></a><span id="l148.44">   /* get the name and email */</span>
<a href="#l148.45"></a><span id="l148.45">   prop = vCardService-&gt;IsAPropertyOf(aVcard, VCFullNameProp);</span>
<a href="#l148.46"></a><span id="l148.46">   if (prop)</span>
<a href="#l148.47"></a><span id="l148.47" class="difflineat">@@ -348,17 +348,17 @@ static int OutputBasicVcard(MimeObject *</span>
<a href="#l148.48"></a><span id="l148.48">   }</span>
<a href="#l148.49"></a><span id="l148.49"> </span>
<a href="#l148.50"></a><span id="l148.50">   return 0;</span>
<a href="#l148.51"></a><span id="l148.51"> }</span>
<a href="#l148.52"></a><span id="l148.52"> </span>
<a href="#l148.53"></a><span id="l148.53"> static int OutputVcardAttribute(MimeObject *aMimeObj, VObject *aVcard, const char* id, nsACString&amp; vCardOutput)</span>
<a href="#l148.54"></a><span id="l148.54"> {</span>
<a href="#l148.55"></a><span id="l148.55">   VObject *prop = NULL;</span>
<a href="#l148.56"></a><span id="l148.56" class="difflineminus">-  nsCAutoString string;</span>
<a href="#l148.57"></a><span id="l148.57" class="difflineplus">+  nsAutoCString string;</span>
<a href="#l148.58"></a><span id="l148.58"> </span>
<a href="#l148.59"></a><span id="l148.59">   nsCOMPtr&lt;nsIMsgVCardService&gt; vCardService = do_GetService(MSGVCARDSERVICE_CONTRACT_ID);</span>
<a href="#l148.60"></a><span id="l148.60">   if (!vCardService)</span>
<a href="#l148.61"></a><span id="l148.61">       return -1;</span>
<a href="#l148.62"></a><span id="l148.62"> </span>
<a href="#l148.63"></a><span id="l148.63">   prop = vCardService-&gt;IsAPropertyOf(aVcard, id);</span>
<a href="#l148.64"></a><span id="l148.64">   if (prop)</span>
<a href="#l148.65"></a><span id="l148.65">     if (VALUE_TYPE(prop))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l149.1"></a><span id="l149.1" class="difflineminus">--- a/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp</span>
<a href="#l149.2"></a><span id="l149.2" class="difflineplus">+++ b/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp</span>
<a href="#l149.3"></a><span id="l149.3" class="difflineat">@@ -572,17 +572,17 @@ nsMimeBaseEmitter::StartHeader(bool root</span>
<a href="#l149.4"></a><span id="l149.4"> //</span>
<a href="#l149.5"></a><span id="l149.5"> NS_IMETHODIMP</span>
<a href="#l149.6"></a><span id="l149.6"> nsMimeBaseEmitter::UpdateCharacterSet(const char *aCharset)</span>
<a href="#l149.7"></a><span id="l149.7"> {</span>
<a href="#l149.8"></a><span id="l149.8">   if ( (aCharset) &amp;&amp; (PL_strcasecmp(aCharset, &quot;US-ASCII&quot;)) &amp;&amp;</span>
<a href="#l149.9"></a><span id="l149.9">         (PL_strcasecmp(aCharset, &quot;ISO-8859-1&quot;)) &amp;&amp;</span>
<a href="#l149.10"></a><span id="l149.10">         (PL_strcasecmp(aCharset, &quot;UTF-8&quot;)) )</span>
<a href="#l149.11"></a><span id="l149.11">   {</span>
<a href="#l149.12"></a><span id="l149.12" class="difflineminus">-    nsCAutoString contentType;</span>
<a href="#l149.13"></a><span id="l149.13" class="difflineplus">+    nsAutoCString contentType;</span>
<a href="#l149.14"></a><span id="l149.14"> </span>
<a href="#l149.15"></a><span id="l149.15">     if (NS_SUCCEEDED(mChannel-&gt;GetContentType(contentType)) &amp;&amp; !contentType.IsEmpty())</span>
<a href="#l149.16"></a><span id="l149.16">     {</span>
<a href="#l149.17"></a><span id="l149.17">       char *cBegin = contentType.BeginWriting();</span>
<a href="#l149.18"></a><span id="l149.18"> </span>
<a href="#l149.19"></a><span id="l149.19">       const char *cPtr = PL_strcasestr(cBegin, &quot;charset=&quot;);</span>
<a href="#l149.20"></a><span id="l149.20"> </span>
<a href="#l149.21"></a><span id="l149.21">       if (cPtr)</span>
<a href="#l149.22"></a><span id="l149.22" class="difflineat">@@ -773,17 +773,17 @@ nsMimeBaseEmitter::GetLocalizedDateStrin</span>
<a href="#l149.23"></a><span id="l149.23">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l149.24"></a><span id="l149.24"> </span>
<a href="#l149.25"></a><span id="l149.25">   if (prefBranch)</span>
<a href="#l149.26"></a><span id="l149.26">     prefBranch-&gt;GetBoolPref(&quot;mailnews.display.original_date&quot;,</span>
<a href="#l149.27"></a><span id="l149.27">                             &amp;displayOriginalDate);</span>
<a href="#l149.28"></a><span id="l149.28"> </span>
<a href="#l149.29"></a><span id="l149.29">   if (!displayOriginalDate)</span>
<a href="#l149.30"></a><span id="l149.30">   {</span>
<a href="#l149.31"></a><span id="l149.31" class="difflineminus">-    nsCAutoString convertedDateString;</span>
<a href="#l149.32"></a><span id="l149.32" class="difflineplus">+    nsAutoCString convertedDateString;</span>
<a href="#l149.33"></a><span id="l149.33">     nsresult rv = GenerateDateString(dateString, convertedDateString, true);</span>
<a href="#l149.34"></a><span id="l149.34">     if (NS_SUCCEEDED(rv))</span>
<a href="#l149.35"></a><span id="l149.35">       i18nValue = strdup(convertedDateString.get());</span>
<a href="#l149.36"></a><span id="l149.36">     else</span>
<a href="#l149.37"></a><span id="l149.37">       i18nValue = strdup(dateString);</span>
<a href="#l149.38"></a><span id="l149.38">   }</span>
<a href="#l149.39"></a><span id="l149.39">   else</span>
<a href="#l149.40"></a><span id="l149.40">     i18nValue = strdup(dateString);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l150.1"></a><span id="l150.1" class="difflineminus">--- a/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</span>
<a href="#l150.2"></a><span id="l150.2" class="difflineplus">+++ b/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</span>
<a href="#l150.3"></a><span id="l150.3" class="difflineat">@@ -163,17 +163,17 @@ nsresult nsMimeHtmlDisplayEmitter::Broad</span>
<a href="#l150.4"></a><span id="l150.4">   // two string enumerators to pass out to the header sink</span>
<a href="#l150.5"></a><span id="l150.5">   nsRefPtr&lt;nsMimeStringEnumerator&gt; headerNameEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l150.6"></a><span id="l150.6">   NS_ENSURE_TRUE(headerNameEnumerator, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l150.7"></a><span id="l150.7">   nsRefPtr&lt;nsMimeStringEnumerator&gt; headerValueEnumerator = new nsMimeStringEnumerator();</span>
<a href="#l150.8"></a><span id="l150.8">   NS_ENSURE_TRUE(headerValueEnumerator, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l150.9"></a><span id="l150.9"> </span>
<a href="#l150.10"></a><span id="l150.10">   nsCString extraExpandedHeaders;</span>
<a href="#l150.11"></a><span id="l150.11">   nsTArray&lt;nsCString&gt; extraExpandedHeadersArray;</span>
<a href="#l150.12"></a><span id="l150.12" class="difflineminus">-  nsCAutoString convertedDateString;</span>
<a href="#l150.13"></a><span id="l150.13" class="difflineplus">+  nsAutoCString convertedDateString;</span>
<a href="#l150.14"></a><span id="l150.14"> </span>
<a href="#l150.15"></a><span id="l150.15">   nsresult rv;</span>
<a href="#l150.16"></a><span id="l150.16">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l150.17"></a><span id="l150.17">   if (pPrefBranch)</span>
<a href="#l150.18"></a><span id="l150.18">   {</span>
<a href="#l150.19"></a><span id="l150.19">     pPrefBranch-&gt;GetCharPref(&quot;mailnews.headers.extraExpandedHeaders&quot;, getter_Copies(extraExpandedHeaders));</span>
<a href="#l150.20"></a><span id="l150.20">     // todo - should make this upper case</span>
<a href="#l150.21"></a><span id="l150.21">     if (!extraExpandedHeaders.IsEmpty())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l151.1"></a><span id="l151.1" class="difflineminus">--- a/mailnews/mime/src/comi18n.cpp</span>
<a href="#l151.2"></a><span id="l151.2" class="difflineplus">+++ b/mailnews/mime/src/comi18n.cpp</span>
<a href="#l151.3"></a><span id="l151.3" class="difflineat">@@ -161,17 +161,17 @@ static unsigned char * utf8_nextchar(uns</span>
<a href="#l151.4"></a><span id="l151.4"> </span>
<a href="#l151.5"></a><span id="l151.5"> static</span>
<a href="#l151.6"></a><span id="l151.6"> int32_t generate_encodedwords(char *pUTF8, const char *charset, char method, char *output, int32_t outlen, int32_t output_carryoverlen, int32_t foldlen, bool foldingonly)</span>
<a href="#l151.7"></a><span id="l151.7"> {</span>
<a href="#l151.8"></a><span id="l151.8">   nsCOMPtr &lt;nsISaveAsCharset&gt; conv;</span>
<a href="#l151.9"></a><span id="l151.9">   PRUnichar *_pUCS2 = nullptr, *pUCS2 = nullptr, *pUCS2Head = nullptr, cUCS2Tmp = 0;</span>
<a href="#l151.10"></a><span id="l151.10">   char  *ibuf, *o = output;</span>
<a href="#l151.11"></a><span id="l151.11">   char  encodedword_head[nsIMimeConverter::MAX_CHARSET_NAME_LENGTH+4+1];</span>
<a href="#l151.12"></a><span id="l151.12" class="difflineminus">-  nsCAutoString _charset;</span>
<a href="#l151.13"></a><span id="l151.13" class="difflineplus">+  nsAutoCString _charset;</span>
<a href="#l151.14"></a><span id="l151.14">   char  *pUTF8Head = nullptr, cUTF8Tmp = 0;</span>
<a href="#l151.15"></a><span id="l151.15">   int32_t   olen = 0, obufsize = outlen, offset, linelen = output_carryoverlen, convlen = 0;</span>
<a href="#l151.16"></a><span id="l151.16">   int32_t   encodedword_headlen = 0, encodedword_taillen = foldingonly ? 0 : 2; // &quot;?=&quot;</span>
<a href="#l151.17"></a><span id="l151.17">   nsresult rv;</span>
<a href="#l151.18"></a><span id="l151.18"> </span>
<a href="#l151.19"></a><span id="l151.19">   encodedword_head[0] = 0;</span>
<a href="#l151.20"></a><span id="l151.20"> </span>
<a href="#l151.21"></a><span id="l151.21">   if (!foldingonly) {</span>
<a href="#l151.22"></a><span id="l151.22" class="difflineat">@@ -687,17 +687,17 @@ extern &quot;C&quot; char *MIME_DecodeMimeHeader(c</span>
<a href="#l151.23"></a><span id="l151.23">                                        const char *default_charset,</span>
<a href="#l151.24"></a><span id="l151.24">                                        bool override_charset,</span>
<a href="#l151.25"></a><span id="l151.25">                                        bool eatContinuations)</span>
<a href="#l151.26"></a><span id="l151.26"> {</span>
<a href="#l151.27"></a><span id="l151.27">   nsresult rv;</span>
<a href="#l151.28"></a><span id="l151.28">   nsCOMPtr &lt;nsIMIMEHeaderParam&gt; mimehdrpar = do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv);</span>
<a href="#l151.29"></a><span id="l151.29">   if (NS_FAILED(rv))</span>
<a href="#l151.30"></a><span id="l151.30">     return nullptr;</span>
<a href="#l151.31"></a><span id="l151.31" class="difflineminus">-  nsCAutoString result;</span>
<a href="#l151.32"></a><span id="l151.32" class="difflineplus">+  nsAutoCString result;</span>
<a href="#l151.33"></a><span id="l151.33">   rv = mimehdrpar-&gt;DecodeRFC2047Header(header, default_charset, override_charset,</span>
<a href="#l151.34"></a><span id="l151.34">                                        eatContinuations, result);</span>
<a href="#l151.35"></a><span id="l151.35">   if (NS_SUCCEEDED(rv))</span>
<a href="#l151.36"></a><span id="l151.36">     return ToNewCString(result);</span>
<a href="#l151.37"></a><span id="l151.37">   return nullptr;</span>
<a href="#l151.38"></a><span id="l151.38"> }</span>
<a href="#l151.39"></a><span id="l151.39"> </span>
<a href="#l151.40"></a><span id="l151.40"> char *MIME_EncodeMimePartIIStr(const char* header, bool structured, const char* mailCharset, const int32_t fieldNameLen, const int32_t encodedWordSize)</span>
<a href="#l151.41"></a><span id="l151.41" class="difflineat">@@ -718,17 +718,17 @@ MIME_detect_charset(const char *aBuf, in</span>
<a href="#l151.42"></a><span id="l151.42"> {</span>
<a href="#l151.43"></a><span id="l151.43">   nsresult res = NS_ERROR_UNEXPECTED;</span>
<a href="#l151.44"></a><span id="l151.44">   nsString detector_name;</span>
<a href="#l151.45"></a><span id="l151.45">   *aCharset = nullptr;</span>
<a href="#l151.46"></a><span id="l151.46"> </span>
<a href="#l151.47"></a><span id="l151.47">   NS_GetLocalizedUnicharPreferenceWithDefault(nullptr, &quot;intl.charset.detector&quot;, EmptyString(), detector_name);</span>
<a href="#l151.48"></a><span id="l151.48"> </span>
<a href="#l151.49"></a><span id="l151.49">   if (!detector_name.IsEmpty()) {</span>
<a href="#l151.50"></a><span id="l151.50" class="difflineminus">-    nsCAutoString detector_contractid;</span>
<a href="#l151.51"></a><span id="l151.51" class="difflineplus">+    nsAutoCString detector_contractid;</span>
<a href="#l151.52"></a><span id="l151.52">     detector_contractid.AssignLiteral(NS_STRCDETECTOR_CONTRACTID_BASE);</span>
<a href="#l151.53"></a><span id="l151.53">     detector_contractid.Append(NS_ConvertUTF16toUTF8(detector_name));</span>
<a href="#l151.54"></a><span id="l151.54">     nsCOMPtr&lt;nsIStringCharsetDetector&gt; detector = do_CreateInstance(detector_contractid.get(), &amp;res);</span>
<a href="#l151.55"></a><span id="l151.55">     if (NS_SUCCEEDED(res)) {</span>
<a href="#l151.56"></a><span id="l151.56">       nsDetectionConfident oConfident;</span>
<a href="#l151.57"></a><span id="l151.57">       res = detector-&gt;DoIt(aBuf, aLength, aCharset, oConfident);</span>
<a href="#l151.58"></a><span id="l151.58">       if (NS_SUCCEEDED(res) &amp;&amp; (eBestAnswer == oConfident || eSureAnswer == oConfident)) {</span>
<a href="#l151.59"></a><span id="l151.59">         return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l152.1"></a><span id="l152.1" class="difflineminus">--- a/mailnews/mime/src/mimecms.cpp</span>
<a href="#l152.2"></a><span id="l152.2" class="difflineplus">+++ b/mailnews/mime/src/mimecms.cpp</span>
<a href="#l152.3"></a><span id="l152.3" class="difflineat">@@ -479,17 +479,17 @@ static void *MimeCMS_init(MimeObject *ob</span>
<a href="#l152.4"></a><span id="l152.4">       nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l152.5"></a><span id="l152.5">       nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l152.6"></a><span id="l152.6">       nsCOMPtr&lt;nsIMsgHeaderSink&gt; headerSink;</span>
<a href="#l152.7"></a><span id="l152.7">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgurl;</span>
<a href="#l152.8"></a><span id="l152.8">       nsCOMPtr&lt;nsISupports&gt; securityInfo;</span>
<a href="#l152.9"></a><span id="l152.9">       channel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l152.10"></a><span id="l152.10">       if (uri)</span>
<a href="#l152.11"></a><span id="l152.11">       {</span>
<a href="#l152.12"></a><span id="l152.12" class="difflineminus">-        nsCAutoString urlSpec;</span>
<a href="#l152.13"></a><span id="l152.13" class="difflineplus">+        nsAutoCString urlSpec;</span>
<a href="#l152.14"></a><span id="l152.14">         rv = uri-&gt;GetSpec(urlSpec);</span>
<a href="#l152.15"></a><span id="l152.15"> </span>
<a href="#l152.16"></a><span id="l152.16">         // We only want to update the UI if the current mime transaction</span>
<a href="#l152.17"></a><span id="l152.17">         // is intended for display.</span>
<a href="#l152.18"></a><span id="l152.18">         // If the current transaction is intended for background processing,</span>
<a href="#l152.19"></a><span id="l152.19">         // we can learn that by looking at the additional header=filter</span>
<a href="#l152.20"></a><span id="l152.20">         // string contained in the URI.</span>
<a href="#l152.21"></a><span id="l152.21">         //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l153.1"></a><span id="l153.1" class="difflineminus">--- a/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l153.2"></a><span id="l153.2" class="difflineplus">+++ b/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l153.3"></a><span id="l153.3" class="difflineat">@@ -135,17 +135,17 @@ mime_dump_attachments ( nsMsgAttachmentD</span>
<a href="#l153.4"></a><span id="l153.4">   class nsMsgAttachmentData  *tmp = attachData;</span>
<a href="#l153.5"></a><span id="l153.5"> </span>
<a href="#l153.6"></a><span id="l153.6">   while ( (tmp) &amp;&amp; (tmp-&gt;m_url) )</span>
<a href="#l153.7"></a><span id="l153.7">   {</span>
<a href="#l153.8"></a><span id="l153.8">     printf(&quot;Real Name         : %s\n&quot;, tmp-&gt;m_realName.get());</span>
<a href="#l153.9"></a><span id="l153.9"> </span>
<a href="#l153.10"></a><span id="l153.10">     if ( tmp-&gt;m_url )</span>
<a href="#l153.11"></a><span id="l153.11">     {</span>
<a href="#l153.12"></a><span id="l153.12" class="difflineminus">-      nsCAutoString spec;</span>
<a href="#l153.13"></a><span id="l153.13" class="difflineplus">+      nsAutoCString spec;</span>
<a href="#l153.14"></a><span id="l153.14">       tmp-&gt;m_url-&gt;GetSpec(spec);</span>
<a href="#l153.15"></a><span id="l153.15">       printf(&quot;URL               : %s\n&quot;, spec.get());</span>
<a href="#l153.16"></a><span id="l153.16">     }</span>
<a href="#l153.17"></a><span id="l153.17"> </span>
<a href="#l153.18"></a><span id="l153.18">     printf(&quot;Desired Type      : %s\n&quot;, tmp-&gt;m_desiredType.get());</span>
<a href="#l153.19"></a><span id="l153.19">     printf(&quot;Real Type         : %s\n&quot;, tmp-&gt;m_realType.get());</span>
<a href="#l153.20"></a><span id="l153.20">     printf(&quot;Real Encoding     : %s\n&quot;, tmp-&gt;m_realEncoding.get());</span>
<a href="#l153.21"></a><span id="l153.21">     printf(&quot;Description       : %s\n&quot;, tmp-&gt;m_description.get());</span>
<a href="#l153.22"></a><span id="l153.22" class="difflineat">@@ -170,17 +170,17 @@ nsresult CreateComposeParams(nsCOMPtr&lt;ns</span>
<a href="#l153.23"></a><span id="l153.23"> #ifdef NS_DEBUG</span>
<a href="#l153.24"></a><span id="l153.24">   mime_dump_attachments ( attachmentList );</span>
<a href="#l153.25"></a><span id="l153.25"> #endif</span>
<a href="#l153.26"></a><span id="l153.26"> </span>
<a href="#l153.27"></a><span id="l153.27">   nsresult rv;</span>
<a href="#l153.28"></a><span id="l153.28">   nsMsgAttachmentData *curAttachment = attachmentList;</span>
<a href="#l153.29"></a><span id="l153.29">   if (curAttachment)</span>
<a href="#l153.30"></a><span id="l153.30">   {</span>
<a href="#l153.31"></a><span id="l153.31" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l153.32"></a><span id="l153.32" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l153.33"></a><span id="l153.33"> </span>
<a href="#l153.34"></a><span id="l153.34">     while (curAttachment &amp;&amp; curAttachment-&gt;m_url)</span>
<a href="#l153.35"></a><span id="l153.35">     {</span>
<a href="#l153.36"></a><span id="l153.36">       rv = curAttachment-&gt;m_url-&gt;GetSpec(spec);</span>
<a href="#l153.37"></a><span id="l153.37">       if (NS_SUCCEEDED(rv))</span>
<a href="#l153.38"></a><span id="l153.38">       {</span>
<a href="#l153.39"></a><span id="l153.39">         nsCOMPtr&lt;nsIMsgAttachment&gt; attachment = do_CreateInstance(NS_MSGATTACHMENT_CONTRACTID, &amp;rv);</span>
<a href="#l153.40"></a><span id="l153.40">         if (NS_SUCCEEDED(rv) &amp;&amp; attachment)</span>
<a href="#l153.41"></a><span id="l153.41" class="difflineat">@@ -414,17 +414,17 @@ CreateCompositionFields(const char      </span>
<a href="#l153.42"></a><span id="l153.42">     PR_FREEIF(val);</span>
<a href="#l153.43"></a><span id="l153.43">   }</span>
<a href="#l153.44"></a><span id="l153.44"> </span>
<a href="#l153.45"></a><span id="l153.45">   if (priority) {</span>
<a href="#l153.46"></a><span id="l153.46">     val = MIME_DecodeMimeHeader(priority, charset, false, true);</span>
<a href="#l153.47"></a><span id="l153.47">     nsMsgPriorityValue priorityValue;</span>
<a href="#l153.48"></a><span id="l153.48">     NS_MsgGetPriorityFromString(val ? val : priority, priorityValue);</span>
<a href="#l153.49"></a><span id="l153.49">     PR_FREEIF(val);</span>
<a href="#l153.50"></a><span id="l153.50" class="difflineminus">-    nsCAutoString priorityName;</span>
<a href="#l153.51"></a><span id="l153.51" class="difflineplus">+    nsAutoCString priorityName;</span>
<a href="#l153.52"></a><span id="l153.52">     NS_MsgGetUntranslatedPriorityName(priorityValue, priorityName);</span>
<a href="#l153.53"></a><span id="l153.53">     cFields-&gt;SetPriority(priorityName.get());</span>
<a href="#l153.54"></a><span id="l153.54">   }</span>
<a href="#l153.55"></a><span id="l153.55"> </span>
<a href="#l153.56"></a><span id="l153.56">   if (newspost_url) {</span>
<a href="#l153.57"></a><span id="l153.57">     val = MIME_DecodeMimeHeader(newspost_url, charset, false, true);</span>
<a href="#l153.58"></a><span id="l153.58">     cFields-&gt;SetNewspostUrl(val ? val : newspost_url);</span>
<a href="#l153.59"></a><span id="l153.59">     PR_FREEIF(val);</span>
<a href="#l153.60"></a><span id="l153.60" class="difflineat">@@ -513,17 +513,17 @@ mime_draft_process_attachments(mime_draf</span>
<a href="#l153.61"></a><span id="l153.61">     else</span>
<a href="#l153.62"></a><span id="l153.62">       tmpFile = mdd-&gt;attachments[attachmentsIndex++];</span>
<a href="#l153.63"></a><span id="l153.63"> </span>
<a href="#l153.64"></a><span id="l153.64">     if (tmpFile-&gt;m_type.LowerCaseEqualsLiteral(&quot;text/x-vcard&quot;))</span>
<a href="#l153.65"></a><span id="l153.65">       tmp-&gt;m_realName = tmpFile-&gt;m_description;</span>
<a href="#l153.66"></a><span id="l153.66"> </span>
<a href="#l153.67"></a><span id="l153.67">     if ( tmpFile-&gt;m_origUrl )</span>
<a href="#l153.68"></a><span id="l153.68">     {</span>
<a href="#l153.69"></a><span id="l153.69" class="difflineminus">-      nsCAutoString tmpSpec;</span>
<a href="#l153.70"></a><span id="l153.70" class="difflineplus">+      nsAutoCString tmpSpec;</span>
<a href="#l153.71"></a><span id="l153.71">       if (NS_FAILED(tmpFile-&gt;m_origUrl-&gt;GetSpec(tmpSpec)))</span>
<a href="#l153.72"></a><span id="l153.72">         goto FAIL;</span>
<a href="#l153.73"></a><span id="l153.73"> </span>
<a href="#l153.74"></a><span id="l153.74">       if (NS_FAILED(nsMimeNewURI(getter_AddRefs(tmp-&gt;m_url), tmpSpec.get(), nullptr)))</span>
<a href="#l153.75"></a><span id="l153.75">         goto FAIL;</span>
<a href="#l153.76"></a><span id="l153.76"> </span>
<a href="#l153.77"></a><span id="l153.77">       if (tmp-&gt;m_realName.IsEmpty())</span>
<a href="#l153.78"></a><span id="l153.78">       {</span>
<a href="#l153.79"></a><span id="l153.79" class="difflineat">@@ -1217,17 +1217,17 @@ mime_parse_stream_complete (nsMIMESessio</span>
<a href="#l153.80"></a><span id="l153.80">     if (forward_inline)</span>
<a href="#l153.81"></a><span id="l153.81">     {</span>
<a href="#l153.82"></a><span id="l153.82">       if (subj)</span>
<a href="#l153.83"></a><span id="l153.83">       {</span>
<a href="#l153.84"></a><span id="l153.84">         nsresult rv;</span>
<a href="#l153.85"></a><span id="l153.85">         nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l153.86"></a><span id="l153.86">         if (NS_SUCCEEDED(rv))</span>
<a href="#l153.87"></a><span id="l153.87">         {</span>
<a href="#l153.88"></a><span id="l153.88" class="difflineminus">-          nsCAutoString fwdPrefix;</span>
<a href="#l153.89"></a><span id="l153.89" class="difflineplus">+          nsAutoCString fwdPrefix;</span>
<a href="#l153.90"></a><span id="l153.90">           prefBranch-&gt;GetCharPref(&quot;mail.forward_subject_prefix&quot;,</span>
<a href="#l153.91"></a><span id="l153.91">                                   getter_Copies(fwdPrefix));</span>
<a href="#l153.92"></a><span id="l153.92">           char *newSubj = PR_smprintf(&quot;%s: %s&quot;, !fwdPrefix.IsEmpty() ?</span>
<a href="#l153.93"></a><span id="l153.93">                                                 fwdPrefix.get(): &quot;Fwd&quot;, subj);</span>
<a href="#l153.94"></a><span id="l153.94">           if (newSubj)</span>
<a href="#l153.95"></a><span id="l153.95">           {</span>
<a href="#l153.96"></a><span id="l153.96">             PR_Free(subj);</span>
<a href="#l153.97"></a><span id="l153.97">             subj = newSubj;</span>
<a href="#l153.98"></a><span id="l153.98" class="difflineat">@@ -1789,44 +1789,44 @@ mime_decompose_file_init_fn ( void *stre</span>
<a href="#l153.99"></a><span id="l153.99"> </span>
<a href="#l153.100"></a><span id="l153.100">   newAttachment-&gt;m_cloudPartInfo.Adopt(MimeHeaders_get(headers,</span>
<a href="#l153.101"></a><span id="l153.101">                                        HEADER_X_MOZILLA_CLOUD_PART,</span>
<a href="#l153.102"></a><span id="l153.102">                                        false, false));</span>
<a href="#l153.103"></a><span id="l153.103"> </span>
<a href="#l153.104"></a><span id="l153.104">   // There's no file in the message if it's a cloud part.</span>
<a href="#l153.105"></a><span id="l153.105">   if (!newAttachment-&gt;m_cloudPartInfo.IsEmpty())</span>
<a href="#l153.106"></a><span id="l153.106">   {</span>
<a href="#l153.107"></a><span id="l153.107" class="difflineminus">-    nsCAutoString fileURL;</span>
<a href="#l153.108"></a><span id="l153.108" class="difflineplus">+    nsAutoCString fileURL;</span>
<a href="#l153.109"></a><span id="l153.109">     fileURL.Adopt(</span>
<a href="#l153.110"></a><span id="l153.110">       MimeHeaders_get_parameter(newAttachment-&gt;m_cloudPartInfo.get(), &quot;file&quot;,</span>
<a href="#l153.111"></a><span id="l153.111">                                 nullptr, nullptr));</span>
<a href="#l153.112"></a><span id="l153.112">     if (!fileURL.IsEmpty())</span>
<a href="#l153.113"></a><span id="l153.113">       nsMimeNewURI(getter_AddRefs(newAttachment-&gt;m_origUrl), fileURL.get(),</span>
<a href="#l153.114"></a><span id="l153.114">                    nullptr);</span>
<a href="#l153.115"></a><span id="l153.115">     mdd-&gt;tmpFile = nullptr;</span>
<a href="#l153.116"></a><span id="l153.116">     return 0;</span>
<a href="#l153.117"></a><span id="l153.117">   }</span>
<a href="#l153.118"></a><span id="l153.118"> </span>
<a href="#l153.119"></a><span id="l153.119">   nsCOMPtr &lt;nsIFile&gt; tmpFile = nullptr;</span>
<a href="#l153.120"></a><span id="l153.120">   {</span>
<a href="#l153.121"></a><span id="l153.121">     // Let's build a temp file with an extension based on the content-type: nsmail.&lt;extension&gt;</span>
<a href="#l153.122"></a><span id="l153.122"> </span>
<a href="#l153.123"></a><span id="l153.123" class="difflineminus">-    nsCAutoString  newAttachName (&quot;nsmail&quot;);</span>
<a href="#l153.124"></a><span id="l153.124" class="difflineplus">+    nsAutoCString  newAttachName (&quot;nsmail&quot;);</span>
<a href="#l153.125"></a><span id="l153.125">     bool extensionAdded = false;</span>
<a href="#l153.126"></a><span id="l153.126">     // the content type may contain a charset. i.e. text/html; ISO-2022-JP...we want to strip off the charset</span>
<a href="#l153.127"></a><span id="l153.127">     // before we ask the mime service for a mime info for this content type.</span>
<a href="#l153.128"></a><span id="l153.128" class="difflineminus">-    nsCAutoString contentType (newAttachment-&gt;m_type);</span>
<a href="#l153.129"></a><span id="l153.129" class="difflineplus">+    nsAutoCString contentType (newAttachment-&gt;m_type);</span>
<a href="#l153.130"></a><span id="l153.130">     int32_t pos = contentType.FindChar(';');</span>
<a href="#l153.131"></a><span id="l153.131">     if (pos &gt; 0)</span>
<a href="#l153.132"></a><span id="l153.132">       contentType.SetLength(pos);</span>
<a href="#l153.133"></a><span id="l153.133">     nsresult  rv = NS_OK;</span>
<a href="#l153.134"></a><span id="l153.134">     nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder (do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l153.135"></a><span id="l153.135">     if (NS_SUCCEEDED(rv) &amp;&amp; mimeFinder)</span>
<a href="#l153.136"></a><span id="l153.136">     {</span>
<a href="#l153.137"></a><span id="l153.137" class="difflineminus">-      nsCAutoString fileExtension;</span>
<a href="#l153.138"></a><span id="l153.138" class="difflineplus">+      nsAutoCString fileExtension;</span>
<a href="#l153.139"></a><span id="l153.139">       rv = mimeFinder-&gt;GetPrimaryExtension(contentType, EmptyCString(), fileExtension);</span>
<a href="#l153.140"></a><span id="l153.140"> </span>
<a href="#l153.141"></a><span id="l153.141">       if (NS_SUCCEEDED(rv) &amp;&amp; !fileExtension.IsEmpty())</span>
<a href="#l153.142"></a><span id="l153.142">       {</span>
<a href="#l153.143"></a><span id="l153.143">         newAttachName.Append(&quot;.&quot;);</span>
<a href="#l153.144"></a><span id="l153.144">         newAttachName.Append(fileExtension);</span>
<a href="#l153.145"></a><span id="l153.145">         extensionAdded = true;</span>
<a href="#l153.146"></a><span id="l153.146">       }</span>
<a href="#l153.147"></a><span id="l153.147" class="difflineat">@@ -1841,17 +1841,17 @@ mime_decompose_file_init_fn ( void *stre</span>
<a href="#l153.148"></a><span id="l153.148">   }</span>
<a href="#l153.149"></a><span id="l153.149">   nsresult rv;</span>
<a href="#l153.150"></a><span id="l153.150"> </span>
<a href="#l153.151"></a><span id="l153.151">   // This needs to be done so the attachment structure has a handle</span>
<a href="#l153.152"></a><span id="l153.152">   // on the temp file for this attachment...</span>
<a href="#l153.153"></a><span id="l153.153">   // if ( (tmpFile) &amp;&amp; (!bodyPart) )</span>
<a href="#l153.154"></a><span id="l153.154">   if (tmpFile)</span>
<a href="#l153.155"></a><span id="l153.155">   {</span>
<a href="#l153.156"></a><span id="l153.156" class="difflineminus">-      nsCAutoString fileURL;</span>
<a href="#l153.157"></a><span id="l153.157" class="difflineplus">+      nsAutoCString fileURL;</span>
<a href="#l153.158"></a><span id="l153.158">       rv = NS_GetURLSpecFromFile(tmpFile, fileURL);</span>
<a href="#l153.159"></a><span id="l153.159">       if (NS_SUCCEEDED(rv))</span>
<a href="#l153.160"></a><span id="l153.160">         nsMimeNewURI(getter_AddRefs(newAttachment-&gt;m_origUrl),</span>
<a href="#l153.161"></a><span id="l153.161">                      fileURL.get(), nullptr);</span>
<a href="#l153.162"></a><span id="l153.162">   }</span>
<a href="#l153.163"></a><span id="l153.163"> </span>
<a href="#l153.164"></a><span id="l153.164">   PR_FREEIF(workURLSpec);</span>
<a href="#l153.165"></a><span id="l153.165">   if (!tmpFile)</span>
<a href="#l153.166"></a><span id="l153.166" class="difflineat">@@ -1984,20 +1984,20 @@ mime_bridge_create_draft_stream(</span>
<a href="#l153.167"></a><span id="l153.167"> </span>
<a href="#l153.168"></a><span id="l153.168">   if ( !uri )</span>
<a href="#l153.169"></a><span id="l153.169">     return nullptr;</span>
<a href="#l153.170"></a><span id="l153.170"> </span>
<a href="#l153.171"></a><span id="l153.171">   mdd = new mime_draft_data;</span>
<a href="#l153.172"></a><span id="l153.172">   if (!mdd)</span>
<a href="#l153.173"></a><span id="l153.173">     return nullptr;</span>
<a href="#l153.174"></a><span id="l153.174"> </span>
<a href="#l153.175"></a><span id="l153.175" class="difflineminus">-  nsCAutoString turl;</span>
<a href="#l153.176"></a><span id="l153.176" class="difflineplus">+  nsAutoCString turl;</span>
<a href="#l153.177"></a><span id="l153.177">   nsCOMPtr &lt;nsIMsgMessageService&gt; msgService;</span>
<a href="#l153.178"></a><span id="l153.178">   nsCOMPtr&lt;nsIURI&gt; aURL;</span>
<a href="#l153.179"></a><span id="l153.179" class="difflineminus">-  nsCAutoString urlString;</span>
<a href="#l153.180"></a><span id="l153.180" class="difflineplus">+  nsAutoCString urlString;</span>
<a href="#l153.181"></a><span id="l153.181">   nsresult rv;</span>
<a href="#l153.182"></a><span id="l153.182"> </span>
<a href="#l153.183"></a><span id="l153.183">   // first, convert the rdf msg uri into a url that represents the message...</span>
<a href="#l153.184"></a><span id="l153.184">   if (NS_FAILED(uri-&gt;GetSpec(turl)))</span>
<a href="#l153.185"></a><span id="l153.185">     goto FAIL;</span>
<a href="#l153.186"></a><span id="l153.186"> </span>
<a href="#l153.187"></a><span id="l153.187">   rv = GetMessageServiceFromURI(turl, getter_AddRefs(msgService));</span>
<a href="#l153.188"></a><span id="l153.188">   if (NS_FAILED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l154.1"></a><span id="l154.1" class="difflineminus">--- a/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l154.2"></a><span id="l154.2" class="difflineplus">+++ b/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l154.3"></a><span id="l154.3" class="difflineat">@@ -35,17 +35,17 @@ MimeHeaders_convert_header_value(MimeDis</span>
<a href="#l154.4"></a><span id="l154.4"> {</span>
<a href="#l154.5"></a><span id="l154.5">   char        *converted;</span>
<a href="#l154.6"></a><span id="l154.6"> </span>
<a href="#l154.7"></a><span id="l154.7">   if (value.IsEmpty())</span>
<a href="#l154.8"></a><span id="l154.8">     return;</span>
<a href="#l154.9"></a><span id="l154.9"> </span>
<a href="#l154.10"></a><span id="l154.10">   if (convert_charset_only)</span>
<a href="#l154.11"></a><span id="l154.11">   {</span>
<a href="#l154.12"></a><span id="l154.12" class="difflineminus">-    nsCAutoString output;</span>
<a href="#l154.13"></a><span id="l154.13" class="difflineplus">+    nsAutoCString output;</span>
<a href="#l154.14"></a><span id="l154.14">     ConvertRawBytesToUTF8(value, opt-&gt;default_charset, output);</span>
<a href="#l154.15"></a><span id="l154.15">     value.Assign(output);</span>
<a href="#l154.16"></a><span id="l154.16">     return;</span>
<a href="#l154.17"></a><span id="l154.17">   }</span>
<a href="#l154.18"></a><span id="l154.18"> </span>
<a href="#l154.19"></a><span id="l154.19">   if (opt &amp;&amp; opt-&gt;rfc1522_conversion_p)</span>
<a href="#l154.20"></a><span id="l154.20">   {</span>
<a href="#l154.21"></a><span id="l154.21">     converted = MIME_DecodeMimeHeader(value.get(), opt-&gt;default_charset,</span>
<a href="#l154.22"></a><span id="l154.22" class="difflineat">@@ -583,34 +583,34 @@ MimeHeaders_write_all_headers (MimeHeade</span>
<a href="#l154.23"></a><span id="l154.23">     /* Skip over whitespace after colon. */</span>
<a href="#l154.24"></a><span id="l154.24">     while (contents &lt; end &amp;&amp; IS_SPACE(*contents))</span>
<a href="#l154.25"></a><span id="l154.25">       contents++;</span>
<a href="#l154.26"></a><span id="l154.26"> </span>
<a href="#l154.27"></a><span id="l154.27">     /* Take off trailing whitespace... */</span>
<a href="#l154.28"></a><span id="l154.28">     while (end &gt; contents &amp;&amp; IS_SPACE(end[-1]))</span>
<a href="#l154.29"></a><span id="l154.29">       end--;</span>
<a href="#l154.30"></a><span id="l154.30"> </span>
<a href="#l154.31"></a><span id="l154.31" class="difflineminus">-    nsCAutoString name(Substring(head, colon));</span>
<a href="#l154.32"></a><span id="l154.32" class="difflineminus">-    nsCAutoString hdr_value;</span>
<a href="#l154.33"></a><span id="l154.33" class="difflineplus">+    nsAutoCString name(Substring(head, colon));</span>
<a href="#l154.34"></a><span id="l154.34" class="difflineplus">+    nsAutoCString hdr_value;</span>
<a href="#l154.35"></a><span id="l154.35"> </span>
<a href="#l154.36"></a><span id="l154.36">     if ( (end - contents) &gt; 0 )</span>
<a href="#l154.37"></a><span id="l154.37">     {</span>
<a href="#l154.38"></a><span id="l154.38">       hdr_value = Substring(contents, end);</span>
<a href="#l154.39"></a><span id="l154.39">     }</span>
<a href="#l154.40"></a><span id="l154.40"> </span>
<a href="#l154.41"></a><span id="l154.41">     // MW Fixme: more?</span>
<a href="#l154.42"></a><span id="l154.42">     bool convert_charset_only =</span>
<a href="#l154.43"></a><span id="l154.43">           MsgLowerCaseEqualsLiteral(name, &quot;to&quot;) || MsgLowerCaseEqualsLiteral(name, &quot;from&quot;) ||</span>
<a href="#l154.44"></a><span id="l154.44">           MsgLowerCaseEqualsLiteral(name, &quot;cc&quot;) || MsgLowerCaseEqualsLiteral(name, &quot;bcc&quot;) ||</span>
<a href="#l154.45"></a><span id="l154.45">           MsgLowerCaseEqualsLiteral(name, &quot;reply-to&quot;) || MsgLowerCaseEqualsLiteral(name, &quot;sender&quot;);</span>
<a href="#l154.46"></a><span id="l154.46">     MimeHeaders_convert_header_value(opt, hdr_value, convert_charset_only);</span>
<a href="#l154.47"></a><span id="l154.47">     // if we're saving as html, we need to convert headers from utf8 to message charset, if any</span>
<a href="#l154.48"></a><span id="l154.48">     if (opt-&gt;format_out == nsMimeOutput::nsMimeMessageSaveAs &amp;&amp; charset)</span>
<a href="#l154.49"></a><span id="l154.49">     {</span>
<a href="#l154.50"></a><span id="l154.50" class="difflineminus">-      nsCAutoString convertedStr;</span>
<a href="#l154.51"></a><span id="l154.51" class="difflineplus">+      nsAutoCString convertedStr;</span>
<a href="#l154.52"></a><span id="l154.52">       if (NS_SUCCEEDED(ConvertFromUnicode(charset, NS_ConvertUTF8toUTF16(hdr_value),</span>
<a href="#l154.53"></a><span id="l154.53">                        convertedStr)))</span>
<a href="#l154.54"></a><span id="l154.54">       {</span>
<a href="#l154.55"></a><span id="l154.55">         hdr_value = convertedStr;</span>
<a href="#l154.56"></a><span id="l154.56">       }</span>
<a href="#l154.57"></a><span id="l154.57">     }</span>
<a href="#l154.58"></a><span id="l154.58"> </span>
<a href="#l154.59"></a><span id="l154.59">     if (attachment)</span>
<a href="#l154.60"></a><span id="l154.60" class="difflineat">@@ -668,17 +668,17 @@ mime_decode_filename(const char *name, c</span>
<a href="#l154.61"></a><span id="l154.61">                      MimeDisplayOptions *opt)</span>
<a href="#l154.62"></a><span id="l154.62"> {</span>
<a href="#l154.63"></a><span id="l154.63">   nsresult rv;</span>
<a href="#l154.64"></a><span id="l154.64">   nsCOMPtr &lt;nsIMIMEHeaderParam&gt; mimehdrpar =</span>
<a href="#l154.65"></a><span id="l154.65">     do_GetService(NS_MIMEHEADERPARAM_CONTRACTID, &amp;rv);</span>
<a href="#l154.66"></a><span id="l154.66"> </span>
<a href="#l154.67"></a><span id="l154.67">   if (NS_FAILED(rv))</span>
<a href="#l154.68"></a><span id="l154.68">     return nullptr;</span>
<a href="#l154.69"></a><span id="l154.69" class="difflineminus">-  nsCAutoString result;</span>
<a href="#l154.70"></a><span id="l154.70" class="difflineplus">+  nsAutoCString result;</span>
<a href="#l154.71"></a><span id="l154.71">   rv = mimehdrpar-&gt;DecodeParameter(nsDependentCString(name), charset,</span>
<a href="#l154.72"></a><span id="l154.72">                                    opt ? opt-&gt;default_charset : nullptr,</span>
<a href="#l154.73"></a><span id="l154.73">                                    opt ? opt-&gt;override_charset : false,</span>
<a href="#l154.74"></a><span id="l154.74">                                    result);</span>
<a href="#l154.75"></a><span id="l154.75">   return NS_SUCCEEDED(rv) ? PL_strdup(result.get()) : nullptr;</span>
<a href="#l154.76"></a><span id="l154.76"> }</span>
<a href="#l154.77"></a><span id="l154.77"> </span>
<a href="#l154.78"></a><span id="l154.78"> /* Pull the name out of some header or another.  Order is:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l155.1"></a><span id="l155.1" class="difflineminus">--- a/mailnews/mime/src/mimei.cpp</span>
<a href="#l155.2"></a><span id="l155.2" class="difflineplus">+++ b/mailnews/mime/src/mimei.cpp</span>
<a href="#l155.3"></a><span id="l155.3" class="difflineat">@@ -188,18 +188,18 @@ mime_locate_external_content_handler(con</span>
<a href="#l155.4"></a><span id="l155.4">                                      contentTypeHandlerInitStruct  *ctHandlerInfo)</span>
<a href="#l155.5"></a><span id="l155.5"> {</span>
<a href="#l155.6"></a><span id="l155.6">   if (!content_type || !*(content_type)) // null or empty content type</span>
<a href="#l155.7"></a><span id="l155.7">     return nullptr;</span>
<a href="#l155.8"></a><span id="l155.8"> </span>
<a href="#l155.9"></a><span id="l155.9">   MimeObjectClass               *newObj = NULL;</span>
<a href="#l155.10"></a><span id="l155.10">   nsresult rv;</span>
<a href="#l155.11"></a><span id="l155.11"> </span>
<a href="#l155.12"></a><span id="l155.12" class="difflineminus">-  nsCAutoString lookupID(&quot;@mozilla.org/mimecth;1?type=&quot;);</span>
<a href="#l155.13"></a><span id="l155.13" class="difflineminus">-  nsCAutoString lowerCaseContentType;</span>
<a href="#l155.14"></a><span id="l155.14" class="difflineplus">+  nsAutoCString lookupID(&quot;@mozilla.org/mimecth;1?type=&quot;);</span>
<a href="#l155.15"></a><span id="l155.15" class="difflineplus">+  nsAutoCString lowerCaseContentType;</span>
<a href="#l155.16"></a><span id="l155.16">   ToLowerCase(nsDependentCString(content_type), lowerCaseContentType);</span>
<a href="#l155.17"></a><span id="l155.17">   lookupID += lowerCaseContentType;</span>
<a href="#l155.18"></a><span id="l155.18"> </span>
<a href="#l155.19"></a><span id="l155.19">   nsCOMPtr&lt;nsIMimeContentTypeHandler&gt; ctHandler = do_CreateInstance(lookupID.get(), &amp;rv);</span>
<a href="#l155.20"></a><span id="l155.20">   if (NS_FAILED(rv) || !ctHandler) {</span>
<a href="#l155.21"></a><span id="l155.21">     nsCOMPtr&lt;nsICategoryManager&gt; catman =</span>
<a href="#l155.22"></a><span id="l155.22">       do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l155.23"></a><span id="l155.23">     if (NS_FAILED(rv))</span>
<a href="#l155.24"></a><span id="l155.24" class="difflineat">@@ -1242,17 +1242,17 @@ mime_set_url_part(const char *url, const</span>
<a href="#l155.25"></a><span id="l155.25">   const char *part_begin = 0;</span>
<a href="#l155.26"></a><span id="l155.26">   const char *part_end = 0;</span>
<a href="#l155.27"></a><span id="l155.27">   bool got_q = false;</span>
<a href="#l155.28"></a><span id="l155.28">   const char *s;</span>
<a href="#l155.29"></a><span id="l155.29">   char *result;</span>
<a href="#l155.30"></a><span id="l155.30"> </span>
<a href="#l155.31"></a><span id="l155.31">   if (!url || !part) return 0;</span>
<a href="#l155.32"></a><span id="l155.32"> </span>
<a href="#l155.33"></a><span id="l155.33" class="difflineminus">-  nsCAutoString urlString(url);</span>
<a href="#l155.34"></a><span id="l155.34" class="difflineplus">+  nsAutoCString urlString(url);</span>
<a href="#l155.35"></a><span id="l155.35">   int32_t typeIndex = urlString.Find(&quot;?type=application/x-message-display&quot;);</span>
<a href="#l155.36"></a><span id="l155.36">   if (typeIndex != -1)</span>
<a href="#l155.37"></a><span id="l155.37">   {</span>
<a href="#l155.38"></a><span id="l155.38">     urlString.Cut(typeIndex, sizeof(&quot;?type=application/x-message-display&quot;) - 1);</span>
<a href="#l155.39"></a><span id="l155.39">     if (urlString.CharAt(typeIndex) == '&amp;')</span>
<a href="#l155.40"></a><span id="l155.40">       urlString.Replace(typeIndex, 1, '?');</span>
<a href="#l155.41"></a><span id="l155.41">     url = urlString.get();</span>
<a href="#l155.42"></a><span id="l155.42">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l156.1"></a><span id="l156.1" class="difflineminus">--- a/mailnews/mime/src/mimeiimg.cpp</span>
<a href="#l156.2"></a><span id="l156.2" class="difflineplus">+++ b/mailnews/mime/src/mimeiimg.cpp</span>
<a href="#l156.3"></a><span id="l156.3" class="difflineat">@@ -104,17 +104,17 @@ MimeInlineImage_parse_begin (MimeObject </span>
<a href="#l156.4"></a><span id="l156.4">       return MIME_OUT_OF_MEMORY;</span>
<a href="#l156.5"></a><span id="l156.5">     }</span>
<a href="#l156.6"></a><span id="l156.6">     PR_Free(part);</span>
<a href="#l156.7"></a><span id="l156.7"> </span>
<a href="#l156.8"></a><span id="l156.8">     ct = obj-&gt;content_type;</span>
<a href="#l156.9"></a><span id="l156.9">     if (!ct) ct = IMAGE_GIF;  /* Can't happen?  Close enough. */</span>
<a href="#l156.10"></a><span id="l156.10"> </span>
<a href="#l156.11"></a><span id="l156.11">     // Fill in content type and attachment name here.</span>
<a href="#l156.12"></a><span id="l156.12" class="difflineminus">-    nsCAutoString url_with_filename(image_url);</span>
<a href="#l156.13"></a><span id="l156.13" class="difflineplus">+    nsAutoCString url_with_filename(image_url);</span>
<a href="#l156.14"></a><span id="l156.14">     url_with_filename += &quot;&amp;type=&quot;;</span>
<a href="#l156.15"></a><span id="l156.15">     url_with_filename += ct;</span>
<a href="#l156.16"></a><span id="l156.16">     char * filename = MimeHeaders_get_name ( obj-&gt;headers, obj-&gt;options );</span>
<a href="#l156.17"></a><span id="l156.17">     if (filename)</span>
<a href="#l156.18"></a><span id="l156.18">     {</span>
<a href="#l156.19"></a><span id="l156.19">       nsCString escapedName;</span>
<a href="#l156.20"></a><span id="l156.20">       MsgEscapeString(nsDependentCString(filename), nsINetUtil::ESCAPE_URL_PATH,</span>
<a href="#l156.21"></a><span id="l156.21">                       escapedName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l157.1"></a><span id="l157.1" class="difflineminus">--- a/mailnews/mime/src/mimemcms.cpp</span>
<a href="#l157.2"></a><span id="l157.2" class="difflineplus">+++ b/mailnews/mime/src/mimemcms.cpp</span>
<a href="#l157.3"></a><span id="l157.3" class="difflineat">@@ -225,17 +225,17 @@ MimeMultCMS_init (MimeObject *obj)</span>
<a href="#l157.4"></a><span id="l157.4">       nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l157.5"></a><span id="l157.5">       nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l157.6"></a><span id="l157.6">       nsCOMPtr&lt;nsIMsgHeaderSink&gt; headerSink;</span>
<a href="#l157.7"></a><span id="l157.7">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgurl;</span>
<a href="#l157.8"></a><span id="l157.8">       nsCOMPtr&lt;nsISupports&gt; securityInfo;</span>
<a href="#l157.9"></a><span id="l157.9">       channel-&gt;GetURI(getter_AddRefs(uri));</span>
<a href="#l157.10"></a><span id="l157.10">       if (uri)</span>
<a href="#l157.11"></a><span id="l157.11">       {</span>
<a href="#l157.12"></a><span id="l157.12" class="difflineminus">-        nsCAutoString urlSpec;</span>
<a href="#l157.13"></a><span id="l157.13" class="difflineplus">+        nsAutoCString urlSpec;</span>
<a href="#l157.14"></a><span id="l157.14">         rv = uri-&gt;GetSpec(urlSpec);</span>
<a href="#l157.15"></a><span id="l157.15"> </span>
<a href="#l157.16"></a><span id="l157.16">         // We only want to update the UI if the current mime transaction</span>
<a href="#l157.17"></a><span id="l157.17">         // is intended for display.</span>
<a href="#l157.18"></a><span id="l157.18">         // If the current transaction is intended for background processing,</span>
<a href="#l157.19"></a><span id="l157.19">         // we can learn that by looking at the additional header=filter</span>
<a href="#l157.20"></a><span id="l157.20">         // string contained in the URI.</span>
<a href="#l157.21"></a><span id="l157.21">         //</span>
<a href="#l157.22"></a><span id="l157.22" class="difflineat">@@ -285,17 +285,17 @@ MimeMultCMS_data_hash (const char *buf, </span>
<a href="#l157.23"></a><span id="l157.23"> static int</span>
<a href="#l157.24"></a><span id="l157.24"> MimeMultCMS_data_eof (void *crypto_closure, bool abort_p)</span>
<a href="#l157.25"></a><span id="l157.25"> {</span>
<a href="#l157.26"></a><span id="l157.26">   MimeMultCMSdata *data = (MimeMultCMSdata *) crypto_closure;</span>
<a href="#l157.27"></a><span id="l157.27">   if (!data || !data-&gt;data_hash_context) {</span>
<a href="#l157.28"></a><span id="l157.28">     return -1;</span>
<a href="#l157.29"></a><span id="l157.29">   }</span>
<a href="#l157.30"></a><span id="l157.30"> </span>
<a href="#l157.31"></a><span id="l157.31" class="difflineminus">-  nsCAutoString hashString;</span>
<a href="#l157.32"></a><span id="l157.32" class="difflineplus">+  nsAutoCString hashString;</span>
<a href="#l157.33"></a><span id="l157.33">   data-&gt;data_hash_context-&gt;Finish(false, hashString);</span>
<a href="#l157.34"></a><span id="l157.34">   PR_SetError(0, 0);</span>
<a href="#l157.35"></a><span id="l157.35"> </span>
<a href="#l157.36"></a><span id="l157.36">   data-&gt;item_len  = hashString.Length();</span>
<a href="#l157.37"></a><span id="l157.37">   data-&gt;item_data = new unsigned char[data-&gt;item_len];</span>
<a href="#l157.38"></a><span id="l157.38">   if (!data-&gt;item_data) return MIME_OUT_OF_MEMORY;</span>
<a href="#l157.39"></a><span id="l157.39"> </span>
<a href="#l157.40"></a><span id="l157.40">   memcpy(data-&gt;item_data, hashString.get(), data-&gt;item_len);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l158.1"></a><span id="l158.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l158.2"></a><span id="l158.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l158.3"></a><span id="l158.3" class="difflineat">@@ -247,25 +247,25 @@ ValidateRealName(nsMsgAttachmentData *aA</span>
<a href="#l158.4"></a><span id="l158.4"> </span>
<a href="#l158.5"></a><span id="l158.5">   //</span>
<a href="#l158.6"></a><span id="l158.6">   // Now validate any other name we have for the attachment!</span>
<a href="#l158.7"></a><span id="l158.7">   //</span>
<a href="#l158.8"></a><span id="l158.8">   if (aAttach-&gt;m_realName.IsEmpty())</span>
<a href="#l158.9"></a><span id="l158.9">   {</span>
<a href="#l158.10"></a><span id="l158.10">     aAttach-&gt;m_realName = &quot;attachment&quot;;</span>
<a href="#l158.11"></a><span id="l158.11">     nsresult rv = NS_OK;</span>
<a href="#l158.12"></a><span id="l158.12" class="difflineminus">-    nsCAutoString contentType (aAttach-&gt;m_realType);</span>
<a href="#l158.13"></a><span id="l158.13" class="difflineplus">+    nsAutoCString contentType (aAttach-&gt;m_realType);</span>
<a href="#l158.14"></a><span id="l158.14">     int32_t pos = contentType.FindChar(';');</span>
<a href="#l158.15"></a><span id="l158.15">     if (pos &gt; 0)</span>
<a href="#l158.16"></a><span id="l158.16">       contentType.SetLength(pos);</span>
<a href="#l158.17"></a><span id="l158.17"> </span>
<a href="#l158.18"></a><span id="l158.18">     nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder (do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l158.19"></a><span id="l158.19">     if (NS_SUCCEEDED(rv))</span>
<a href="#l158.20"></a><span id="l158.20">     {</span>
<a href="#l158.21"></a><span id="l158.21" class="difflineminus">-      nsCAutoString fileExtension;</span>
<a href="#l158.22"></a><span id="l158.22" class="difflineplus">+      nsAutoCString fileExtension;</span>
<a href="#l158.23"></a><span id="l158.23">       rv = mimeFinder-&gt;GetPrimaryExtension(contentType, EmptyCString(), fileExtension);</span>
<a href="#l158.24"></a><span id="l158.24"> </span>
<a href="#l158.25"></a><span id="l158.25">       if (NS_SUCCEEDED(rv) &amp;&amp; !fileExtension.IsEmpty())</span>
<a href="#l158.26"></a><span id="l158.26">       {</span>
<a href="#l158.27"></a><span id="l158.27">         aAttach-&gt;m_realName.Append('.');</span>
<a href="#l158.28"></a><span id="l158.28">         aAttach-&gt;m_realName.Append(fileExtension);</span>
<a href="#l158.29"></a><span id="l158.29">       }</span>
<a href="#l158.30"></a><span id="l158.30">     }</span>
<a href="#l158.31"></a><span id="l158.31" class="difflineat">@@ -438,17 +438,17 @@ GenerateAttachmentData(MimeObject *objec</span>
<a href="#l158.32"></a><span id="l158.32">   } else {</span>
<a href="#l158.33"></a><span id="l158.33">     tmp-&gt;m_hasFilename = true;</span>
<a href="#l158.34"></a><span id="l158.34">   }</span>
<a href="#l158.35"></a><span id="l158.35">   nsCString urlString(urlSpec);</span>
<a href="#l158.36"></a><span id="l158.36"> </span>
<a href="#l158.37"></a><span id="l158.37">   if (!tmp-&gt;m_realName.IsEmpty() &amp;&amp; !tmp-&gt;m_isExternalAttachment)</span>
<a href="#l158.38"></a><span id="l158.38">   {</span>
<a href="#l158.39"></a><span id="l158.39">     urlString.Append(&quot;&amp;filename=&quot;);</span>
<a href="#l158.40"></a><span id="l158.40" class="difflineminus">-    nsCAutoString aResult;</span>
<a href="#l158.41"></a><span id="l158.41" class="difflineplus">+    nsAutoCString aResult;</span>
<a href="#l158.42"></a><span id="l158.42">     if (NS_SUCCEEDED(MsgEscapeString(tmp-&gt;m_realName,</span>
<a href="#l158.43"></a><span id="l158.43">                                      nsINetUtil::ESCAPE_XALPHAS, aResult)))</span>
<a href="#l158.44"></a><span id="l158.44">       urlString.Append(aResult);</span>
<a href="#l158.45"></a><span id="l158.45">     else</span>
<a href="#l158.46"></a><span id="l158.46">       urlString.Append(tmp-&gt;m_realName);</span>
<a href="#l158.47"></a><span id="l158.47">     if (tmp-&gt;m_realType.EqualsLiteral(&quot;message/rfc822&quot;) &amp;&amp;</span>
<a href="#l158.48"></a><span id="l158.48">            !StringEndsWith(urlString, NS_LITERAL_CSTRING(&quot;.eml&quot;), nsCaseInsensitiveCStringComparator()))</span>
<a href="#l158.49"></a><span id="l158.49">       urlString.Append(&quot;.eml&quot;);</span>
<a href="#l158.50"></a><span id="l158.50" class="difflineat">@@ -656,23 +656,23 @@ NotifyEmittersOfAttachmentList(MimeDispl</span>
<a href="#l158.51"></a><span id="l158.51">         (tmp-&gt;m_realName.IsEmpty() || (!tmp-&gt;m_hasFilename &amp;&amp;</span>
<a href="#l158.52"></a><span id="l158.52">         (opt-&gt;html_as_p != 4 || opt-&gt;metadata_only))))</span>
<a href="#l158.53"></a><span id="l158.53">     {</span>
<a href="#l158.54"></a><span id="l158.54">       ++i;</span>
<a href="#l158.55"></a><span id="l158.55">       ++tmp;</span>
<a href="#l158.56"></a><span id="l158.56">       continue;</span>
<a href="#l158.57"></a><span id="l158.57">     }</span>
<a href="#l158.58"></a><span id="l158.58"> </span>
<a href="#l158.59"></a><span id="l158.59" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l158.60"></a><span id="l158.60" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l158.61"></a><span id="l158.61">     if (tmp-&gt;m_url)</span>
<a href="#l158.62"></a><span id="l158.62">       tmp-&gt;m_url-&gt;GetSpec(spec);</span>
<a href="#l158.63"></a><span id="l158.63"> </span>
<a href="#l158.64"></a><span id="l158.64" class="difflineminus">-    nsCAutoString sizeStr;</span>
<a href="#l158.65"></a><span id="l158.65" class="difflineplus">+    nsAutoCString sizeStr;</span>
<a href="#l158.66"></a><span id="l158.66">     sizeStr.AppendInt(tmp-&gt;m_size);</span>
<a href="#l158.67"></a><span id="l158.67" class="difflineminus">-    nsCAutoString downloadedStr;</span>
<a href="#l158.68"></a><span id="l158.68" class="difflineplus">+    nsAutoCString downloadedStr;</span>
<a href="#l158.69"></a><span id="l158.69">     downloadedStr.AppendInt(tmp-&gt;m_isDownloaded);</span>
<a href="#l158.70"></a><span id="l158.70"> </span>
<a href="#l158.71"></a><span id="l158.71">     mimeEmitterStartAttachment(opt, tmp-&gt;m_realName.get(), tmp-&gt;m_realType.get(),</span>
<a href="#l158.72"></a><span id="l158.72">                                spec.get(), tmp-&gt;m_isExternalAttachment);</span>
<a href="#l158.73"></a><span id="l158.73">     mimeEmitterAddAttachmentField(opt, HEADER_X_MOZILLA_PART_URL, spec.get());</span>
<a href="#l158.74"></a><span id="l158.74">     mimeEmitterAddAttachmentField(opt, HEADER_X_MOZILLA_PART_SIZE, sizeStr.get());</span>
<a href="#l158.75"></a><span id="l158.75">     mimeEmitterAddAttachmentField(opt, HEADER_X_MOZILLA_PART_DOWNLOADED, downloadedStr.get());</span>
<a href="#l158.76"></a><span id="l158.76"> </span>
<a href="#l158.77"></a><span id="l158.77" class="difflineat">@@ -771,17 +771,17 @@ mime_file_type (const char *filename, vo</span>
<a href="#l158.78"></a><span id="l158.78">   nsresult    rv;</span>
<a href="#l158.79"></a><span id="l158.79"> </span>
<a href="#l158.80"></a><span id="l158.80">   ext = PL_strrchr(filename, '.');</span>
<a href="#l158.81"></a><span id="l158.81">   if (ext)</span>
<a href="#l158.82"></a><span id="l158.82">   {</span>
<a href="#l158.83"></a><span id="l158.83">     ext++;</span>
<a href="#l158.84"></a><span id="l158.84">     nsCOMPtr&lt;nsIMIMEService&gt; mimeFinder (do_GetService(NS_MIMESERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l158.85"></a><span id="l158.85">     if (mimeFinder) {</span>
<a href="#l158.86"></a><span id="l158.86" class="difflineminus">-      nsCAutoString type;</span>
<a href="#l158.87"></a><span id="l158.87" class="difflineplus">+      nsAutoCString type;</span>
<a href="#l158.88"></a><span id="l158.88">       mimeFinder-&gt;GetTypeFromExtension(nsDependentCString(ext), type);</span>
<a href="#l158.89"></a><span id="l158.89">       retType = ToNewCString(type);</span>
<a href="#l158.90"></a><span id="l158.90">     }</span>
<a href="#l158.91"></a><span id="l158.91">   }</span>
<a href="#l158.92"></a><span id="l158.92"> </span>
<a href="#l158.93"></a><span id="l158.93">   return retType;</span>
<a href="#l158.94"></a><span id="l158.94"> }</span>
<a href="#l158.95"></a><span id="l158.95"> </span>
<a href="#l158.96"></a><span id="l158.96" class="difflineat">@@ -1519,17 +1519,17 @@ mime_bridge_create_display_stream(</span>
<a href="#l158.97"></a><span id="l158.97">   if (!msd)</span>
<a href="#l158.98"></a><span id="l158.98">     return NULL;</span>
<a href="#l158.99"></a><span id="l158.99"> </span>
<a href="#l158.100"></a><span id="l158.100">   // Assign the new mime emitter - will handle output operations</span>
<a href="#l158.101"></a><span id="l158.101">   msd-&gt;output_emitter = newEmitter;</span>
<a href="#l158.102"></a><span id="l158.102">   msd-&gt;firstCheck = true;</span>
<a href="#l158.103"></a><span id="l158.103"> </span>
<a href="#l158.104"></a><span id="l158.104">   // Store the URL string for this decode operation</span>
<a href="#l158.105"></a><span id="l158.105" class="difflineminus">-  nsCAutoString urlString;</span>
<a href="#l158.106"></a><span id="l158.106" class="difflineplus">+  nsAutoCString urlString;</span>
<a href="#l158.107"></a><span id="l158.107">   nsresult rv;</span>
<a href="#l158.108"></a><span id="l158.108"> </span>
<a href="#l158.109"></a><span id="l158.109">   // Keep a hold of the channel...</span>
<a href="#l158.110"></a><span id="l158.110">   msd-&gt;channel = aChannel;</span>
<a href="#l158.111"></a><span id="l158.111">   rv = uri-&gt;GetSpec(urlString);</span>
<a href="#l158.112"></a><span id="l158.112">   if (NS_SUCCEEDED(rv))</span>
<a href="#l158.113"></a><span id="l158.113">   {</span>
<a href="#l158.114"></a><span id="l158.114">     if (!urlString.IsEmpty())</span>
<a href="#l158.115"></a><span id="l158.115" class="difflineat">@@ -2131,30 +2131,30 @@ ResetChannelCharset(MimeObject *obj)</span>
<a href="#l158.116"></a><span id="l158.116"> nsresult GetMailNewsFont(MimeObject *obj, bool styleFixed,  int32_t *fontPixelSize,</span>
<a href="#l158.117"></a><span id="l158.117">                          int32_t *fontSizePercentage, nsCString&amp; fontLang)</span>
<a href="#l158.118"></a><span id="l158.118"> {</span>
<a href="#l158.119"></a><span id="l158.119">   nsresult rv = NS_OK;</span>
<a href="#l158.120"></a><span id="l158.120"> </span>
<a href="#l158.121"></a><span id="l158.121">   nsIPrefBranch *prefBranch = GetPrefBranch(obj-&gt;options);</span>
<a href="#l158.122"></a><span id="l158.122">   if (prefBranch) {</span>
<a href="#l158.123"></a><span id="l158.123">     MimeInlineText  *text = (MimeInlineText *) obj;</span>
<a href="#l158.124"></a><span id="l158.124" class="difflineminus">-    nsCAutoString charset;</span>
<a href="#l158.125"></a><span id="l158.125" class="difflineplus">+    nsAutoCString charset;</span>
<a href="#l158.126"></a><span id="l158.126"> </span>
<a href="#l158.127"></a><span id="l158.127">     // get a charset</span>
<a href="#l158.128"></a><span id="l158.128">     if (!text-&gt;initializeCharset)</span>
<a href="#l158.129"></a><span id="l158.129">       ((MimeInlineTextClass*)&amp;mimeInlineTextClass)-&gt;initialize_charset(obj);</span>
<a href="#l158.130"></a><span id="l158.130"> </span>
<a href="#l158.131"></a><span id="l158.131">     if (!text-&gt;charset || !(*text-&gt;charset))</span>
<a href="#l158.132"></a><span id="l158.132">       charset.Assign(&quot;us-ascii&quot;);</span>
<a href="#l158.133"></a><span id="l158.133">     else</span>
<a href="#l158.134"></a><span id="l158.134">       charset.Assign(text-&gt;charset);</span>
<a href="#l158.135"></a><span id="l158.135"> </span>
<a href="#l158.136"></a><span id="l158.136">     nsCOMPtr&lt;nsICharsetConverterManager&gt; charSetConverterManager2;</span>
<a href="#l158.137"></a><span id="l158.137">     nsCOMPtr&lt;nsIAtom&gt; langGroupAtom;</span>
<a href="#l158.138"></a><span id="l158.138" class="difflineminus">-    nsCAutoString prefStr;</span>
<a href="#l158.139"></a><span id="l158.139" class="difflineplus">+    nsAutoCString prefStr;</span>
<a href="#l158.140"></a><span id="l158.140"> </span>
<a href="#l158.141"></a><span id="l158.141">     ToLowerCase(charset);</span>
<a href="#l158.142"></a><span id="l158.142"> </span>
<a href="#l158.143"></a><span id="l158.143">     charSetConverterManager2 = do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l158.144"></a><span id="l158.144">     if ( NS_FAILED(rv))</span>
<a href="#l158.145"></a><span id="l158.145">       return rv;</span>
<a href="#l158.146"></a><span id="l158.146"> </span>
<a href="#l158.147"></a><span id="l158.147">     // get a language, e.g. x-western, ja</span>
<a href="#l158.148"></a><span id="l158.148" class="difflineat">@@ -2231,17 +2231,17 @@ HTMLSanitize(const nsString&amp; inString, n</span>
<a href="#l158.149"></a><span id="l158.149">   // once at app startup.</span>
<a href="#l158.150"></a><span id="l158.150">   bool migrated = false;</span>
<a href="#l158.151"></a><span id="l158.151">   nsresult rv = prefs-&gt;GetBoolPref(</span>
<a href="#l158.152"></a><span id="l158.152">     &quot;mailnews.display.html_sanitizer.allowed_tags.migrated&quot;,</span>
<a href="#l158.153"></a><span id="l158.153">     &amp;migrated);</span>
<a href="#l158.154"></a><span id="l158.154">   if (NS_SUCCEEDED(rv) &amp;&amp; !migrated) {</span>
<a href="#l158.155"></a><span id="l158.155">     prefs-&gt;SetBoolPref(&quot;mailnews.display.html_sanitizer.allowed_tags.migrated&quot;,</span>
<a href="#l158.156"></a><span id="l158.156">                        true);</span>
<a href="#l158.157"></a><span id="l158.157" class="difflineminus">-    nsCAutoString legacy;</span>
<a href="#l158.158"></a><span id="l158.158" class="difflineplus">+    nsAutoCString legacy;</span>
<a href="#l158.159"></a><span id="l158.159">     rv = prefs-&gt;GetCharPref(&quot;mailnews.display.html_sanitizer.allowed_tags&quot;,</span>
<a href="#l158.160"></a><span id="l158.160">                             getter_Copies(legacy));</span>
<a href="#l158.161"></a><span id="l158.161">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l158.162"></a><span id="l158.162">       prefs-&gt;SetBoolPref(&quot;mailnews.display.html_sanitizer.drop_non_css_presentation&quot;,</span>
<a href="#l158.163"></a><span id="l158.163">                          legacy.Find(&quot;font&quot;) &lt; 0);</span>
<a href="#l158.164"></a><span id="l158.164">       prefs-&gt;SetBoolPref(&quot;mailnews.display.html_sanitizer.drop_media&quot;,</span>
<a href="#l158.165"></a><span id="l158.165">                          legacy.Find(&quot;img&quot;) &lt; 0);</span>
<a href="#l158.166"></a><span id="l158.166">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l159.1"></a><span id="l159.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l159.2"></a><span id="l159.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.cpp</span>
<a href="#l159.3"></a><span id="l159.3" class="difflineat">@@ -390,17 +390,17 @@ MakeAbsoluteURL(char *base_url, char *re</span>
<a href="#l159.4"></a><span id="l159.4">     NS_MsgSACopy(&amp;retString, relative_url);</span>
<a href="#l159.5"></a><span id="l159.5">     return retString;</span>
<a href="#l159.6"></a><span id="l159.6">   }</span>
<a href="#l159.7"></a><span id="l159.7"> </span>
<a href="#l159.8"></a><span id="l159.8">   nsresult err = nsMimeNewURI(&amp;base, base_url, nullptr);</span>
<a href="#l159.9"></a><span id="l159.9">   if (err != NS_OK)</span>
<a href="#l159.10"></a><span id="l159.10">     return nullptr;</span>
<a href="#l159.11"></a><span id="l159.11"> </span>
<a href="#l159.12"></a><span id="l159.12" class="difflineminus">-  nsCAutoString spec;</span>
<a href="#l159.13"></a><span id="l159.13" class="difflineplus">+  nsAutoCString spec;</span>
<a href="#l159.14"></a><span id="l159.14"> </span>
<a href="#l159.15"></a><span id="l159.15">   nsIURI    *url = nullptr;</span>
<a href="#l159.16"></a><span id="l159.16">   err = nsMimeNewURI(&amp;url, relative_url, base);</span>
<a href="#l159.17"></a><span id="l159.17">   if (err != NS_OK)</span>
<a href="#l159.18"></a><span id="l159.18">     goto done;</span>
<a href="#l159.19"></a><span id="l159.19"> </span>
<a href="#l159.20"></a><span id="l159.20">   err = url-&gt;GetSpec(spec);</span>
<a href="#l159.21"></a><span id="l159.21">   if (err)</span>
<a href="#l159.22"></a><span id="l159.22" class="difflineat">@@ -456,18 +456,18 @@ MimeMultipartRelated_output_child_p(Mime</span>
<a href="#l159.23"></a><span id="l159.23">       char *absolute;</span>
<a href="#l159.24"></a><span id="l159.24">       char *base_url = MimeHeaders_get(child-&gt;headers, HEADER_CONTENT_BASE,</span>
<a href="#l159.25"></a><span id="l159.25">                        false, false);</span>
<a href="#l159.26"></a><span id="l159.26">       absolute = MakeAbsoluteURL(base_url ? base_url : relobj-&gt;base_url, location);</span>
<a href="#l159.27"></a><span id="l159.27"> </span>
<a href="#l159.28"></a><span id="l159.28">       PR_FREEIF(base_url);</span>
<a href="#l159.29"></a><span id="l159.29">       PR_Free(location);</span>
<a href="#l159.30"></a><span id="l159.30">       if (absolute) {</span>
<a href="#l159.31"></a><span id="l159.31" class="difflineminus">-        nsCAutoString partnum;</span>
<a href="#l159.32"></a><span id="l159.32" class="difflineminus">-        nsCAutoString imappartnum;</span>
<a href="#l159.33"></a><span id="l159.33" class="difflineplus">+        nsAutoCString partnum;</span>
<a href="#l159.34"></a><span id="l159.34" class="difflineplus">+        nsAutoCString imappartnum;</span>
<a href="#l159.35"></a><span id="l159.35">         partnum.Adopt(mime_part_address(child));</span>
<a href="#l159.36"></a><span id="l159.36">         if (!partnum.IsEmpty()) {</span>
<a href="#l159.37"></a><span id="l159.37">           if (obj-&gt;options-&gt;missing_parts)</span>
<a href="#l159.38"></a><span id="l159.38">           {</span>
<a href="#l159.39"></a><span id="l159.39">             char * imappart = mime_imap_part_address(child);</span>
<a href="#l159.40"></a><span id="l159.40">             if (imappart)</span>
<a href="#l159.41"></a><span id="l159.41">               imappartnum.Adopt(imappart);</span>
<a href="#l159.42"></a><span id="l159.42">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l160.1"></a><span id="l160.1" class="difflineminus">--- a/mailnews/mime/src/mimemsg.cpp</span>
<a href="#l160.2"></a><span id="l160.2" class="difflineplus">+++ b/mailnews/mime/src/mimemsg.cpp</span>
<a href="#l160.3"></a><span id="l160.3" class="difflineat">@@ -815,17 +815,17 @@ MimeMessage_write_headers_html (MimeObje</span>
<a href="#l160.4"></a><span id="l160.4">   return 0;</span>
<a href="#l160.5"></a><span id="l160.5"> }</span>
<a href="#l160.6"></a><span id="l160.6"> </span>
<a href="#l160.7"></a><span id="l160.7"> static char *</span>
<a href="#l160.8"></a><span id="l160.8"> MimeMessage_partial_message_html(const char *data, void *closure,</span>
<a href="#l160.9"></a><span id="l160.9">                                  MimeHeaders *headers)</span>
<a href="#l160.10"></a><span id="l160.10"> {</span>
<a href="#l160.11"></a><span id="l160.11">   MimeMessage *msg = (MimeMessage *)closure;</span>
<a href="#l160.12"></a><span id="l160.12" class="difflineminus">-  nsCAutoString orig_url(data);</span>
<a href="#l160.13"></a><span id="l160.13" class="difflineplus">+  nsAutoCString orig_url(data);</span>
<a href="#l160.14"></a><span id="l160.14">   char *uidl = MimeHeaders_get(headers, HEADER_X_UIDL, false, false);</span>
<a href="#l160.15"></a><span id="l160.15">   char *msgId = MimeHeaders_get(headers, HEADER_MESSAGE_ID, false,</span>
<a href="#l160.16"></a><span id="l160.16">                   false);</span>
<a href="#l160.17"></a><span id="l160.17">   char *msgIdPtr = PL_strchr(msgId, '&lt;');</span>
<a href="#l160.18"></a><span id="l160.18"> </span>
<a href="#l160.19"></a><span id="l160.19">   int32_t pos = orig_url.Find(&quot;mailbox-message&quot;);</span>
<a href="#l160.20"></a><span id="l160.20">   if (pos != -1)</span>
<a href="#l160.21"></a><span id="l160.21">     orig_url.Cut(pos + 7, 8);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l161.1"></a><span id="l161.1" class="difflineminus">--- a/mailnews/mime/src/mimemult.cpp</span>
<a href="#l161.2"></a><span id="l161.2" class="difflineplus">+++ b/mailnews/mime/src/mimemult.cpp</span>
<a href="#l161.3"></a><span id="l161.3" class="difflineat">@@ -164,17 +164,17 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l161.4"></a><span id="l161.4">       if (mult-&gt;hdrs)</span>
<a href="#l161.5"></a><span id="l161.5">         MimeHeaders_free(mult-&gt;hdrs);</span>
<a href="#l161.6"></a><span id="l161.6">       mult-&gt;hdrs = MimeHeaders_new();</span>
<a href="#l161.7"></a><span id="l161.7">       if (!mult-&gt;hdrs)</span>
<a href="#l161.8"></a><span id="l161.8">         return MIME_OUT_OF_MEMORY;</span>
<a href="#l161.9"></a><span id="l161.9">       if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;state &amp;&amp;</span>
<a href="#l161.10"></a><span id="l161.10">           obj-&gt;options-&gt;state-&gt;partsToStrip.Length() &gt; 0)</span>
<a href="#l161.11"></a><span id="l161.11">       {</span>
<a href="#l161.12"></a><span id="l161.12" class="difflineminus">-        nsCAutoString newPart(mime_part_address(obj));</span>
<a href="#l161.13"></a><span id="l161.13" class="difflineplus">+        nsAutoCString newPart(mime_part_address(obj));</span>
<a href="#l161.14"></a><span id="l161.14">         newPart.Append('.');</span>
<a href="#l161.15"></a><span id="l161.15">         newPart.AppendInt(container-&gt;nchildren + 1);</span>
<a href="#l161.16"></a><span id="l161.16">         obj-&gt;options-&gt;state-&gt;strippingPart = false;</span>
<a href="#l161.17"></a><span id="l161.17">         // check if this is a sub-part of a part we're stripping.</span>
<a href="#l161.18"></a><span id="l161.18">         for (uint32_t partIndex = 0; partIndex &lt; obj-&gt;options-&gt;state-&gt;partsToStrip.Length(); partIndex++)</span>
<a href="#l161.19"></a><span id="l161.19">         {</span>
<a href="#l161.20"></a><span id="l161.20">           nsCString &amp;curPartToStrip = obj-&gt;options-&gt;state-&gt;partsToStrip[partIndex];</span>
<a href="#l161.21"></a><span id="l161.21">           if (newPart.Find(curPartToStrip) == 0 &amp;&amp; (newPart.Length() == curPartToStrip.Length() || newPart.CharAt(curPartToStrip.Length()) == '.'))</span>
<a href="#l161.22"></a><span id="l161.22" class="difflineat">@@ -228,17 +228,17 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l161.23"></a><span id="l161.23">       if (*line == '\r' || *line == '\n')</span>
<a href="#l161.24"></a><span id="l161.24">       {</span>
<a href="#l161.25"></a><span id="l161.25">         if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;state &amp;&amp;</span>
<a href="#l161.26"></a><span id="l161.26">             obj-&gt;options-&gt;state-&gt;strippingPart)</span>
<a href="#l161.27"></a><span id="l161.27">         {</span>
<a href="#l161.28"></a><span id="l161.28">           stripping = true;</span>
<a href="#l161.29"></a><span id="l161.29">           bool detachingPart = obj-&gt;options-&gt;state-&gt;detachedFilePath.Length() &gt; 0;</span>
<a href="#l161.30"></a><span id="l161.30"> </span>
<a href="#l161.31"></a><span id="l161.31" class="difflineminus">-          nsCAutoString fileName;</span>
<a href="#l161.32"></a><span id="l161.32" class="difflineplus">+          nsAutoCString fileName;</span>
<a href="#l161.33"></a><span id="l161.33">           fileName.Adopt(MimeHeaders_get_name(mult-&gt;hdrs, obj-&gt;options));</span>
<a href="#l161.34"></a><span id="l161.34">           if (detachingPart)</span>
<a href="#l161.35"></a><span id="l161.35">           {</span>
<a href="#l161.36"></a><span id="l161.36">             char *contentType = MimeHeaders_get(mult-&gt;hdrs, &quot;Content-Type&quot;, false, false);</span>
<a href="#l161.37"></a><span id="l161.37">             if (contentType)</span>
<a href="#l161.38"></a><span id="l161.38">             {</span>
<a href="#l161.39"></a><span id="l161.39">               MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;Content-Type: &quot;));</span>
<a href="#l161.40"></a><span id="l161.40">               MimeWriteAString(obj, nsDependentCString(contentType));</span>
<a href="#l161.41"></a><span id="l161.41" class="difflineat">@@ -250,17 +250,17 @@ MimeMultipart_parse_line (const char *li</span>
<a href="#l161.42"></a><span id="l161.42">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK));</span>
<a href="#l161.43"></a><span id="l161.43">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;X-Mozilla-External-Attachment-URL: &quot;));</span>
<a href="#l161.44"></a><span id="l161.44">             MimeWriteAString(obj, obj-&gt;options-&gt;state-&gt;detachedFilePath);</span>
<a href="#l161.45"></a><span id="l161.45">             MimeWriteAString(obj, NS_LITERAL_CSTRING(MSG_LINEBREAK));</span>
<a href="#l161.46"></a><span id="l161.46">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;X-Mozilla-Altered: AttachmentDetached; date=\&quot;&quot;));</span>
<a href="#l161.47"></a><span id="l161.47">           }</span>
<a href="#l161.48"></a><span id="l161.48">           else</span>
<a href="#l161.49"></a><span id="l161.49">           {</span>
<a href="#l161.50"></a><span id="l161.50" class="difflineminus">-            nsCAutoString header(&quot;Content-Type: text/x-moz-deleted; name=\&quot;Deleted: &quot;);</span>
<a href="#l161.51"></a><span id="l161.51" class="difflineplus">+            nsAutoCString header(&quot;Content-Type: text/x-moz-deleted; name=\&quot;Deleted: &quot;);</span>
<a href="#l161.52"></a><span id="l161.52">             header.Append(fileName);</span>
<a href="#l161.53"></a><span id="l161.53">             status = MimeWriteAString(obj, header);</span>
<a href="#l161.54"></a><span id="l161.54">             if (status &lt; 0) </span>
<a href="#l161.55"></a><span id="l161.55">               return status;</span>
<a href="#l161.56"></a><span id="l161.56">             status = MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK &quot;Content-Transfer-Encoding: 8bit&quot; MSG_LINEBREAK));</span>
<a href="#l161.57"></a><span id="l161.57">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;Content-Disposition: inline; filename=\&quot;Deleted: &quot;));</span>
<a href="#l161.58"></a><span id="l161.58">             MimeWriteAString(obj, fileName);</span>
<a href="#l161.59"></a><span id="l161.59">             MimeWriteAString(obj, NS_LITERAL_CSTRING(&quot;\&quot;&quot; MSG_LINEBREAK &quot;X-Mozilla-Altered: AttachmentDeleted; date=\&quot;&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l162.1"></a><span id="l162.1" class="difflineminus">--- a/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l162.2"></a><span id="l162.2" class="difflineplus">+++ b/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l162.3"></a><span id="l162.3" class="difflineat">@@ -97,17 +97,17 @@ MimeObject_initialize (MimeObject *obj)</span>
<a href="#l162.4"></a><span id="l162.4">        !PL_strcasecmp(obj-&gt;content_type, IMAGE_XBM3))</span>
<a href="#l162.5"></a><span id="l162.5">   {</span>
<a href="#l162.6"></a><span id="l162.6">     PR_Free(obj-&gt;content_type);</span>
<a href="#l162.7"></a><span id="l162.7">     obj-&gt;content_type = strdup(IMAGE_XBM);</span>
<a href="#l162.8"></a><span id="l162.8">   }</span>
<a href="#l162.9"></a><span id="l162.9">   else {</span>
<a href="#l162.10"></a><span id="l162.10">     // MIME-types are case-insenitive, but let's make it lower case internally</span>
<a href="#l162.11"></a><span id="l162.11">     // to avoid some hassle later down the road.</span>
<a href="#l162.12"></a><span id="l162.12" class="difflineminus">-    nsCAutoString lowerCaseContentType;</span>
<a href="#l162.13"></a><span id="l162.13" class="difflineplus">+    nsAutoCString lowerCaseContentType;</span>
<a href="#l162.14"></a><span id="l162.14">     ToLowerCase(nsDependentCString(obj-&gt;content_type), lowerCaseContentType);</span>
<a href="#l162.15"></a><span id="l162.15">     PR_Free(obj-&gt;content_type);</span>
<a href="#l162.16"></a><span id="l162.16">     obj-&gt;content_type = ToNewCString(lowerCaseContentType);</span>
<a href="#l162.17"></a><span id="l162.17">   }</span>
<a href="#l162.18"></a><span id="l162.18"> </span>
<a href="#l162.19"></a><span id="l162.19">   if (!obj-&gt;encoding)</span>
<a href="#l162.20"></a><span id="l162.20">   ;</span>
<a href="#l162.21"></a><span id="l162.21">   else if (!PL_strcasecmp(obj-&gt;encoding, ENCODING_UUENCODE2) ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l163.1"></a><span id="l163.1" class="difflineminus">--- a/mailnews/mime/src/mimethsa.cpp</span>
<a href="#l163.2"></a><span id="l163.2" class="difflineplus">+++ b/mailnews/mime/src/mimethsa.cpp</span>
<a href="#l163.3"></a><span id="l163.3" class="difflineat">@@ -73,17 +73,17 @@ printf(&quot; B2\n&quot;);</span>
<a href="#l163.4"></a><span id="l163.4">   if (content_type)</span>
<a href="#l163.5"></a><span id="l163.5">   {</span>
<a href="#l163.6"></a><span id="l163.6">     char* charset = MimeHeaders_get_parameter(content_type,</span>
<a href="#l163.7"></a><span id="l163.7">                                               HEADER_PARM_CHARSET,</span>
<a href="#l163.8"></a><span id="l163.8">                                               NULL, NULL);</span>
<a href="#l163.9"></a><span id="l163.9">     PR_Free(content_type);</span>
<a href="#l163.10"></a><span id="l163.10">     if (charset)</span>
<a href="#l163.11"></a><span id="l163.11">     {</span>
<a href="#l163.12"></a><span id="l163.12" class="difflineminus">-      nsCAutoString charsetline(</span>
<a href="#l163.13"></a><span id="l163.13" class="difflineplus">+      nsAutoCString charsetline(</span>
<a href="#l163.14"></a><span id="l163.14">         &quot;\n&lt;meta http-equiv=\&quot;Context-Type\&quot; content=\&quot;text/html; charset=&quot;);</span>
<a href="#l163.15"></a><span id="l163.15">       charsetline += charset;</span>
<a href="#l163.16"></a><span id="l163.16">       charsetline += &quot;\&quot;&gt;\n&quot;;</span>
<a href="#l163.17"></a><span id="l163.17">       int status = MimeObject_write(obj,</span>
<a href="#l163.18"></a><span id="l163.18">                                     charsetline.get(),</span>
<a href="#l163.19"></a><span id="l163.19">                                     charsetline.Length(),</span>
<a href="#l163.20"></a><span id="l163.20">                                     true);</span>
<a href="#l163.21"></a><span id="l163.21">       PR_Free(charset);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l164.1"></a><span id="l164.1" class="difflineminus">--- a/mailnews/mime/src/mimethtm.cpp</span>
<a href="#l164.2"></a><span id="l164.2" class="difflineplus">+++ b/mailnews/mime/src/mimethtm.cpp</span>
<a href="#l164.3"></a><span id="l164.3" class="difflineat">@@ -45,17 +45,17 @@ MimeInlineTextHTML_parse_begin (MimeObje</span>
<a href="#l164.4"></a><span id="l164.4"> </span>
<a href="#l164.5"></a><span id="l164.5">   // Set a default font (otherwise unicode font will be used since the data is UTF-8).</span>
<a href="#l164.6"></a><span id="l164.6">   if (nsMimeOutput::nsMimeMessageBodyDisplay == obj-&gt;options-&gt;format_out ||</span>
<a href="#l164.7"></a><span id="l164.7">       nsMimeOutput::nsMimeMessagePrintOutput == obj-&gt;options-&gt;format_out)</span>
<a href="#l164.8"></a><span id="l164.8">   {</span>
<a href="#l164.9"></a><span id="l164.9">     char buf[256];            // local buffer for html tag</span>
<a href="#l164.10"></a><span id="l164.10">     int32_t fontSize;         // default font size</span>
<a href="#l164.11"></a><span id="l164.11">     int32_t fontSizePercentage;   // size percentage</span>
<a href="#l164.12"></a><span id="l164.12" class="difflineminus">-    nsCAutoString fontLang;       // langgroup of the font.</span>
<a href="#l164.13"></a><span id="l164.13" class="difflineplus">+    nsAutoCString fontLang;       // langgroup of the font.</span>
<a href="#l164.14"></a><span id="l164.14">     if (NS_SUCCEEDED(GetMailNewsFont(obj, false, &amp;fontSize, &amp;fontSizePercentage,fontLang)))</span>
<a href="#l164.15"></a><span id="l164.15">     {</span>
<a href="#l164.16"></a><span id="l164.16">       PR_snprintf(buf, 256, &quot;&lt;div class=\&quot;moz-text-html\&quot;  lang=\&quot;%s\&quot;&gt;&quot;,</span>
<a href="#l164.17"></a><span id="l164.17">                   fontLang.get());</span>
<a href="#l164.18"></a><span id="l164.18">       status = MimeObject_write(obj, buf, strlen(buf), true);</span>
<a href="#l164.19"></a><span id="l164.19">     }</span>
<a href="#l164.20"></a><span id="l164.20">     else</span>
<a href="#l164.21"></a><span id="l164.21">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l165.1"></a><span id="l165.1" class="difflineminus">--- a/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l165.2"></a><span id="l165.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l165.3"></a><span id="l165.3" class="difflineat">@@ -122,18 +122,18 @@ MimeInlineTextPlainFlowed_parse_begin (M</span>
<a href="#l165.4"></a><span id="l165.4">     nsresult rv = prefBranch-&gt;GetBoolPref(&quot;mail.fixed_width_messages&quot;,</span>
<a href="#l165.5"></a><span id="l165.5">                                           &amp;(exdata-&gt;fixedwidthfont));</span>
<a href="#l165.6"></a><span id="l165.6">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to get pref&quot;);</span>
<a href="#l165.7"></a><span id="l165.7">          // Check at least the success of one</span>
<a href="#l165.8"></a><span id="l165.8">   }</span>
<a href="#l165.9"></a><span id="l165.9"> </span>
<a href="#l165.10"></a><span id="l165.10">   // Get font</span>
<a href="#l165.11"></a><span id="l165.11">   // only used for viewing (!plainHTML)</span>
<a href="#l165.12"></a><span id="l165.12" class="difflineminus">-  nsCAutoString fontstyle;</span>
<a href="#l165.13"></a><span id="l165.13" class="difflineminus">-  nsCAutoString fontLang;     // langgroup of the font</span>
<a href="#l165.14"></a><span id="l165.14" class="difflineplus">+  nsAutoCString fontstyle;</span>
<a href="#l165.15"></a><span id="l165.15" class="difflineplus">+  nsAutoCString fontLang;     // langgroup of the font</span>
<a href="#l165.16"></a><span id="l165.16"> </span>
<a href="#l165.17"></a><span id="l165.17"> </span>
<a href="#l165.18"></a><span id="l165.18">   // generic font-family name ( -moz-fixed for fixed font and NULL for</span>
<a href="#l165.19"></a><span id="l165.19">   // variable font ) is sufficient now that bug 105199 has been fixed.</span>
<a href="#l165.20"></a><span id="l165.20"> </span>
<a href="#l165.21"></a><span id="l165.21">   if (exdata-&gt;fixedwidthfont)</span>
<a href="#l165.22"></a><span id="l165.22">     fontstyle = &quot;font-family: -moz-fixed&quot;;</span>
<a href="#l165.23"></a><span id="l165.23"> </span>
<a href="#l165.24"></a><span id="l165.24" class="difflineat">@@ -155,17 +155,17 @@ MimeInlineTextPlainFlowed_parse_begin (M</span>
<a href="#l165.25"></a><span id="l165.25">     }</span>
<a href="#l165.26"></a><span id="l165.26">   }</span>
<a href="#l165.27"></a><span id="l165.27"> </span>
<a href="#l165.28"></a><span id="l165.28">   // Opening &lt;div&gt;.</span>
<a href="#l165.29"></a><span id="l165.29">   if (!quoting)</span>
<a href="#l165.30"></a><span id="l165.30">        /* 4.x' editor can't break &lt;div&gt;s (e.g. to interleave comments).</span>
<a href="#l165.31"></a><span id="l165.31">           We'll add the class to the &lt;blockquote type=cite&gt; later. */</span>
<a href="#l165.32"></a><span id="l165.32">   {</span>
<a href="#l165.33"></a><span id="l165.33" class="difflineminus">-    nsCAutoString openingDiv(&quot;&lt;div class=\&quot;moz-text-flowed\&quot;&quot;);</span>
<a href="#l165.34"></a><span id="l165.34" class="difflineplus">+    nsAutoCString openingDiv(&quot;&lt;div class=\&quot;moz-text-flowed\&quot;&quot;);</span>
<a href="#l165.35"></a><span id="l165.35">     // We currently have to add formatting here. :-(</span>
<a href="#l165.36"></a><span id="l165.36">     if (!plainHTML &amp;&amp; !fontstyle.IsEmpty())</span>
<a href="#l165.37"></a><span id="l165.37">     {</span>
<a href="#l165.38"></a><span id="l165.38">       openingDiv += &quot; style=\&quot;&quot;;</span>
<a href="#l165.39"></a><span id="l165.39">       openingDiv += fontstyle;</span>
<a href="#l165.40"></a><span id="l165.40">       openingDiv += '&quot;';</span>
<a href="#l165.41"></a><span id="l165.41">     }</span>
<a href="#l165.42"></a><span id="l165.42">     if (!plainHTML &amp;&amp; !fontLang.IsEmpty())</span>
<a href="#l165.43"></a><span id="l165.43" class="difflineat">@@ -270,17 +270,17 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l165.44"></a><span id="l165.44">   }</span>
<a href="#l165.45"></a><span id="l165.45"> </span>
<a href="#l165.46"></a><span id="l165.46">   NS_ASSERTION(exdata, &quot;The extra data has disappeared!&quot;);</span>
<a href="#l165.47"></a><span id="l165.47"> </span>
<a href="#l165.48"></a><span id="l165.48">   NS_ASSERTION(length &gt; 0, &quot;zero length&quot;);</span>
<a href="#l165.49"></a><span id="l165.49">   if (length &lt;= 0) return 0;</span>
<a href="#l165.50"></a><span id="l165.50"> </span>
<a href="#l165.51"></a><span id="l165.51">   uint32 linequotelevel = 0;</span>
<a href="#l165.52"></a><span id="l165.52" class="difflineminus">-  nsCAutoString real_line(aLine, length);</span>
<a href="#l165.53"></a><span id="l165.53" class="difflineplus">+  nsAutoCString real_line(aLine, length);</span>
<a href="#l165.54"></a><span id="l165.54">   char *line = real_line.BeginWriting();</span>
<a href="#l165.55"></a><span id="l165.55">   const char *linep = real_line.BeginReading();</span>
<a href="#l165.56"></a><span id="l165.56">   // Space stuffed?</span>
<a href="#l165.57"></a><span id="l165.57">   if(' ' == *linep) {</span>
<a href="#l165.58"></a><span id="l165.58">     linep++;</span>
<a href="#l165.59"></a><span id="l165.59">   } else {</span>
<a href="#l165.60"></a><span id="l165.60">     // count '&gt;':s before the first non-'&gt;'</span>
<a href="#l165.61"></a><span id="l165.61">     while('&gt;' == *linep) {</span>
<a href="#l165.62"></a><span id="l165.62" class="difflineat">@@ -378,17 +378,17 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l165.63"></a><span id="l165.63">     }</span>
<a href="#l165.64"></a><span id="l165.64">   }</span>
<a href="#l165.65"></a><span id="l165.65">   else</span>
<a href="#l165.66"></a><span id="l165.66">   {</span>
<a href="#l165.67"></a><span id="l165.67">     CopyUTF8toUTF16(nsDependentCString(line, length), lineResult);</span>
<a href="#l165.68"></a><span id="l165.68">     status = NS_OK;</span>
<a href="#l165.69"></a><span id="l165.69">   }</span>
<a href="#l165.70"></a><span id="l165.70"> </span>
<a href="#l165.71"></a><span id="l165.71" class="difflineminus">-  nsCAutoString preface;</span>
<a href="#l165.72"></a><span id="l165.72" class="difflineplus">+  nsAutoCString preface;</span>
<a href="#l165.73"></a><span id="l165.73"> </span>
<a href="#l165.74"></a><span id="l165.74">   /* Correct number of blockquotes */</span>
<a href="#l165.75"></a><span id="l165.75">   int32 quoteleveldiff=linequotelevel - exdata-&gt;quotelevel;</span>
<a href="#l165.76"></a><span id="l165.76">   if((quoteleveldiff != 0) &amp;&amp; flowed &amp;&amp; exdata-&gt;inflow) {</span>
<a href="#l165.77"></a><span id="l165.77">     // From RFC 2646 4.5</span>
<a href="#l165.78"></a><span id="l165.78">     // The receiver SHOULD handle this error by using the 'quote-depth-wins' rule,</span>
<a href="#l165.79"></a><span id="l165.79">     // which is to ignore the flowed indicator and treat the line as fixed.  That</span>
<a href="#l165.80"></a><span id="l165.80">     // is, the change in quote depth ends the paragraph.</span>
<a href="#l165.81"></a><span id="l165.81" class="difflineat">@@ -396,17 +396,17 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l165.82"></a><span id="l165.82">     // We get that behaviour by just going on.</span>
<a href="#l165.83"></a><span id="l165.83">   }</span>
<a href="#l165.84"></a><span id="l165.84">   while(quoteleveldiff&gt;0) {</span>
<a href="#l165.85"></a><span id="l165.85">     quoteleveldiff--;</span>
<a href="#l165.86"></a><span id="l165.86">     preface += &quot;&lt;blockquote type=cite&quot;;</span>
<a href="#l165.87"></a><span id="l165.87">     // This is to have us observe the user pref settings for citations</span>
<a href="#l165.88"></a><span id="l165.88">     MimeInlineTextPlainFlowed *tObj = (MimeInlineTextPlainFlowed *) obj;</span>
<a href="#l165.89"></a><span id="l165.89"> </span>
<a href="#l165.90"></a><span id="l165.90" class="difflineminus">-    nsCAutoString style;</span>
<a href="#l165.91"></a><span id="l165.91" class="difflineplus">+    nsAutoCString style;</span>
<a href="#l165.92"></a><span id="l165.92">     MimeTextBuildPrefixCSS(tObj-&gt;mQuotedSizeSetting, tObj-&gt;mQuotedStyleSetting,</span>
<a href="#l165.93"></a><span id="l165.93">                            tObj-&gt;mCitationColor, style);</span>
<a href="#l165.94"></a><span id="l165.94">     if (!plainHTML &amp;&amp; !style.IsEmpty())</span>
<a href="#l165.95"></a><span id="l165.95">     {</span>
<a href="#l165.96"></a><span id="l165.96">       preface += &quot; style=\&quot;&quot;;</span>
<a href="#l165.97"></a><span id="l165.97">       preface += style;</span>
<a href="#l165.98"></a><span id="l165.98">       preface += '&quot;';</span>
<a href="#l165.99"></a><span id="l165.99">     }</span>
<a href="#l165.100"></a><span id="l165.100" class="difflineat">@@ -449,17 +449,17 @@ MimeInlineTextPlainFlowed_parse_line (co</span>
<a href="#l165.101"></a><span id="l165.101">     lineResult2.AppendLiteral(&quot;&lt;br&gt;&quot;);</span>
<a href="#l165.102"></a><span id="l165.102">     exdata-&gt;inflow = false;</span>
<a href="#l165.103"></a><span id="l165.103">   } // End Fixed line</span>
<a href="#l165.104"></a><span id="l165.104"> </span>
<a href="#l165.105"></a><span id="l165.105">   if (!(exdata-&gt;isSig &amp;&amp; quoting))</span>
<a href="#l165.106"></a><span id="l165.106">   {</span>
<a href="#l165.107"></a><span id="l165.107">     status = MimeObject_write(obj, preface.get(), preface.Length(), true);</span>
<a href="#l165.108"></a><span id="l165.108">     if (status &lt; 0) return status;</span>
<a href="#l165.109"></a><span id="l165.109" class="difflineminus">-    nsCAutoString outString;</span>
<a href="#l165.110"></a><span id="l165.110" class="difflineplus">+    nsAutoCString outString;</span>
<a href="#l165.111"></a><span id="l165.111">     if (obj-&gt;options-&gt;format_out != nsMimeOutput::nsMimeMessageSaveAs ||</span>
<a href="#l165.112"></a><span id="l165.112">         !mailCharset || !*mailCharset)</span>
<a href="#l165.113"></a><span id="l165.113">       CopyUTF16toUTF8(lineResult2, outString);</span>
<a href="#l165.114"></a><span id="l165.114">     else</span>
<a href="#l165.115"></a><span id="l165.115">     { // convert back to mailCharset before writing.</span>
<a href="#l165.116"></a><span id="l165.116">       rv = nsMsgI18NConvertFromUnicode(mailCharset, lineResult2, outString);</span>
<a href="#l165.117"></a><span id="l165.117">       NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l165.118"></a><span id="l165.118">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l166.1"></a><span id="l166.1" class="difflineminus">--- a/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l166.2"></a><span id="l166.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l166.3"></a><span id="l166.3" class="difflineat">@@ -126,18 +126,18 @@ MimeInlineTextPlain_parse_begin (MimeObj</span>
<a href="#l166.4"></a><span id="l166.4">         prefBranch-&gt;GetBoolPref(&quot;mail.quoted_graphical&quot;, &amp;graphicalQuote);</span>
<a href="#l166.5"></a><span id="l166.5">         prefBranch-&gt;GetBoolPref(&quot;mail.quoteasblock&quot;, &amp;(text-&gt;mBlockquoting));</span>
<a href="#l166.6"></a><span id="l166.6">       }</span>
<a href="#l166.7"></a><span id="l166.7"> </span>
<a href="#l166.8"></a><span id="l166.8">       if (!rawPlainText)</span>
<a href="#l166.9"></a><span id="l166.9">       {</span>
<a href="#l166.10"></a><span id="l166.10">         // Get font</span>
<a href="#l166.11"></a><span id="l166.11">         // only used for viewing (!plainHTML)</span>
<a href="#l166.12"></a><span id="l166.12" class="difflineminus">-        nsCAutoString fontstyle;</span>
<a href="#l166.13"></a><span id="l166.13" class="difflineminus">-        nsCAutoString fontLang;  // langgroup of the font</span>
<a href="#l166.14"></a><span id="l166.14" class="difflineplus">+        nsAutoCString fontstyle;</span>
<a href="#l166.15"></a><span id="l166.15" class="difflineplus">+        nsAutoCString fontLang;  // langgroup of the font</span>
<a href="#l166.16"></a><span id="l166.16"> </span>
<a href="#l166.17"></a><span id="l166.17">         // generic font-family name ( -moz-fixed for fixed font and NULL for</span>
<a href="#l166.18"></a><span id="l166.18">         // variable font ) is sufficient now that bug 105199 has been fixed.</span>
<a href="#l166.19"></a><span id="l166.19"> </span>
<a href="#l166.20"></a><span id="l166.20">         if (!obj-&gt;options-&gt;variable_width_plaintext_p)</span>
<a href="#l166.21"></a><span id="l166.21">           fontstyle = &quot;font-family: -moz-fixed&quot;;</span>
<a href="#l166.22"></a><span id="l166.22"> </span>
<a href="#l166.23"></a><span id="l166.23">         if (nsMimeOutput::nsMimeMessageBodyDisplay == obj-&gt;options-&gt;format_out ||</span>
<a href="#l166.24"></a><span id="l166.24" class="difflineat">@@ -155,17 +155,17 @@ MimeInlineTextPlain_parse_begin (MimeObj</span>
<a href="#l166.25"></a><span id="l166.25">             }</span>
<a href="#l166.26"></a><span id="l166.26">             fontstyle += &quot;font-size: &quot;;</span>
<a href="#l166.27"></a><span id="l166.27">             fontstyle.AppendInt(fontSize);</span>
<a href="#l166.28"></a><span id="l166.28">             fontstyle += &quot;px;&quot;;</span>
<a href="#l166.29"></a><span id="l166.29">           }</span>
<a href="#l166.30"></a><span id="l166.30">         }</span>
<a href="#l166.31"></a><span id="l166.31"> </span>
<a href="#l166.32"></a><span id="l166.32">         // Opening &lt;div&gt;. We currently have to add formatting here. :-(</span>
<a href="#l166.33"></a><span id="l166.33" class="difflineminus">-        nsCAutoString openingDiv;</span>
<a href="#l166.34"></a><span id="l166.34" class="difflineplus">+        nsAutoCString openingDiv;</span>
<a href="#l166.35"></a><span id="l166.35">         if (!quoting)</span>
<a href="#l166.36"></a><span id="l166.36">              /* 4.x' editor can't break &lt;div&gt;s (e.g. to interleave comments).</span>
<a href="#l166.37"></a><span id="l166.37">                 We'll add the class to the &lt;blockquote type=cite&gt; later. */</span>
<a href="#l166.38"></a><span id="l166.38">         {</span>
<a href="#l166.39"></a><span id="l166.39">           openingDiv = &quot;&lt;div class=\&quot;moz-text-plain\&quot;&quot;;</span>
<a href="#l166.40"></a><span id="l166.40">           if (!plainHTML)</span>
<a href="#l166.41"></a><span id="l166.41">           {</span>
<a href="#l166.42"></a><span id="l166.42">             if (obj-&gt;options-&gt;wrap_long_lines_p)</span>
<a href="#l166.43"></a><span id="l166.43" class="difflineat">@@ -320,17 +320,17 @@ MimeInlineTextPlain_parse_line (const ch</span>
<a href="#l166.44"></a><span id="l166.44">         NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l166.45"></a><span id="l166.45">       }</span>
<a href="#l166.46"></a><span id="l166.46">       else // this probably never happens ...</span>
<a href="#l166.47"></a><span id="l166.47">         CopyUTF8toUTF16(inputStr, lineSourceStr);</span>
<a href="#l166.48"></a><span id="l166.48">     }</span>
<a href="#l166.49"></a><span id="l166.49">     else  // line is in UTF-8</span>
<a href="#l166.50"></a><span id="l166.50">       CopyUTF8toUTF16(inputStr, lineSourceStr);</span>
<a href="#l166.51"></a><span id="l166.51"> </span>
<a href="#l166.52"></a><span id="l166.52" class="difflineminus">-    nsCAutoString prefaceResultStr;  // Quoting stuff before the real text</span>
<a href="#l166.53"></a><span id="l166.53" class="difflineplus">+    nsAutoCString prefaceResultStr;  // Quoting stuff before the real text</span>
<a href="#l166.54"></a><span id="l166.54"> </span>
<a href="#l166.55"></a><span id="l166.55">     // Recognize quotes</span>
<a href="#l166.56"></a><span id="l166.56">     uint32_t oldCiteLevel = text-&gt;mCiteLevel;</span>
<a href="#l166.57"></a><span id="l166.57">     uint32_t logicalLineStart = 0;</span>
<a href="#l166.58"></a><span id="l166.58">     rv = conv-&gt;CiteLevelTXT(lineSourceStr.get(),</span>
<a href="#l166.59"></a><span id="l166.59">                             &amp;logicalLineStart, &amp;(text-&gt;mCiteLevel));</span>
<a href="#l166.60"></a><span id="l166.60">     NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l166.61"></a><span id="l166.61"> </span>
<a href="#l166.62"></a><span id="l166.62" class="difflineat">@@ -350,17 +350,17 @@ MimeInlineTextPlain_parse_line (const ch</span>
<a href="#l166.63"></a><span id="l166.63">     }</span>
<a href="#l166.64"></a><span id="l166.64"> </span>
<a href="#l166.65"></a><span id="l166.65">     // Write blockquote</span>
<a href="#l166.66"></a><span id="l166.66">     if (text-&gt;mCiteLevel &gt; oldCiteLevel)</span>
<a href="#l166.67"></a><span id="l166.67">     {</span>
<a href="#l166.68"></a><span id="l166.68">       prefaceResultStr += &quot;&lt;/pre&gt;&quot;;</span>
<a href="#l166.69"></a><span id="l166.69">       for (uint32_t i = 0; i &lt; text-&gt;mCiteLevel - oldCiteLevel; i++)</span>
<a href="#l166.70"></a><span id="l166.70">       {</span>
<a href="#l166.71"></a><span id="l166.71" class="difflineminus">-        nsCAutoString style;</span>
<a href="#l166.72"></a><span id="l166.72" class="difflineplus">+        nsAutoCString style;</span>
<a href="#l166.73"></a><span id="l166.73">         MimeTextBuildPrefixCSS(text-&gt;mQuotedSizeSetting, text-&gt;mQuotedStyleSetting,</span>
<a href="#l166.74"></a><span id="l166.74">                                text-&gt;mCitationColor, style);</span>
<a href="#l166.75"></a><span id="l166.75">         if (!plainHTML &amp;&amp; !style.IsEmpty())</span>
<a href="#l166.76"></a><span id="l166.76">         {</span>
<a href="#l166.77"></a><span id="l166.77">           prefaceResultStr += &quot;&lt;blockquote type=cite style=\&quot;&quot;;</span>
<a href="#l166.78"></a><span id="l166.78">           prefaceResultStr += style;</span>
<a href="#l166.79"></a><span id="l166.79">           prefaceResultStr += &quot;\&quot;&gt;&quot;;</span>
<a href="#l166.80"></a><span id="l166.80">         }</span>
<a href="#l166.81"></a><span id="l166.81" class="difflineat">@@ -416,17 +416,17 @@ MimeInlineTextPlain_parse_line (const ch</span>
<a href="#l166.82"></a><span id="l166.82">     rv = conv-&gt;ScanTXT(lineSourceStr.get() + logicalLineStart,</span>
<a href="#l166.83"></a><span id="l166.83">                        whattodo, getter_Copies(lineResultUnichar));</span>
<a href="#l166.84"></a><span id="l166.84">     NS_ENSURE_SUCCESS(rv, -1);</span>
<a href="#l166.85"></a><span id="l166.85"> </span>
<a href="#l166.86"></a><span id="l166.86">     if (!(text-&gt;mIsSig &amp;&amp; quoting))</span>
<a href="#l166.87"></a><span id="l166.87">     {</span>
<a href="#l166.88"></a><span id="l166.88">       status = MimeObject_write(obj, prefaceResultStr.get(), prefaceResultStr.Length(), true);</span>
<a href="#l166.89"></a><span id="l166.89">       if (status &lt; 0) return status;</span>
<a href="#l166.90"></a><span id="l166.90" class="difflineminus">-      nsCAutoString outString;</span>
<a href="#l166.91"></a><span id="l166.91" class="difflineplus">+      nsAutoCString outString;</span>
<a href="#l166.92"></a><span id="l166.92">       if (obj-&gt;options-&gt;format_out != nsMimeOutput::nsMimeMessageSaveAs ||</span>
<a href="#l166.93"></a><span id="l166.93">           !mailCharset || !*mailCharset)</span>
<a href="#l166.94"></a><span id="l166.94">         CopyUTF16toUTF8(lineResultUnichar, outString);</span>
<a href="#l166.95"></a><span id="l166.95">       else</span>
<a href="#l166.96"></a><span id="l166.96">       { // convert back to mailCharset before writing.</span>
<a href="#l166.97"></a><span id="l166.97">         rv = nsMsgI18NConvertFromUnicode(mailCharset,</span>
<a href="#l166.98"></a><span id="l166.98">                                          lineResultUnichar, outString);</span>
<a href="#l166.99"></a><span id="l166.99">         NS_ENSURE_SUCCESS(rv, -1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l167.1"></a><span id="l167.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l167.2"></a><span id="l167.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l167.3"></a><span id="l167.3" class="difflineat">@@ -193,17 +193,17 @@ bridge_new_new_uri(void *bridgeStream, n</span>
<a href="#l167.4"></a><span id="l167.4">                 if (NS_SUCCEEDED(rv) &amp;&amp; force_override)</span>
<a href="#l167.5"></a><span id="l167.5">                 {</span>
<a href="#l167.6"></a><span id="l167.6">                   *override_charset = true;</span>
<a href="#l167.7"></a><span id="l167.7">                 }</span>
<a href="#l167.8"></a><span id="l167.8">               }</span>
<a href="#l167.9"></a><span id="l167.9">             }</span>
<a href="#l167.10"></a><span id="l167.10">           }</span>
<a href="#l167.11"></a><span id="l167.11">         }</span>
<a href="#l167.12"></a><span id="l167.12" class="difflineminus">-        nsCAutoString urlString;</span>
<a href="#l167.13"></a><span id="l167.13" class="difflineplus">+        nsAutoCString urlString;</span>
<a href="#l167.14"></a><span id="l167.14">         if (NS_SUCCEEDED(aURI-&gt;GetSpec(urlString)))</span>
<a href="#l167.15"></a><span id="l167.15">         {</span>
<a href="#l167.16"></a><span id="l167.16">           if (!urlString.IsEmpty())</span>
<a href="#l167.17"></a><span id="l167.17">           {</span>
<a href="#l167.18"></a><span id="l167.18">             NS_Free(*url_name);</span>
<a href="#l167.19"></a><span id="l167.19">             *url_name = ToNewCString(urlString);</span>
<a href="#l167.20"></a><span id="l167.20">             if (!(*url_name))</span>
<a href="#l167.21"></a><span id="l167.21">               return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l167.22"></a><span id="l167.22" class="difflineat">@@ -521,17 +521,17 @@ NS_IMETHODIMP nsStreamConverter::Init(ns</span>
<a href="#l167.23"></a><span id="l167.23"> </span>
<a href="#l167.24"></a><span id="l167.24">   nsresult rv = NS_OK;</span>
<a href="#l167.25"></a><span id="l167.25">   mOutListener = aOutListener;</span>
<a href="#l167.26"></a><span id="l167.26"> </span>
<a href="#l167.27"></a><span id="l167.27">   // mscott --&gt; we need to look at the url and figure out what the correct output type is...</span>
<a href="#l167.28"></a><span id="l167.28">   nsMimeOutputType newType = mOutputType;</span>
<a href="#l167.29"></a><span id="l167.29">   if (!mAlreadyKnowOutputType)</span>
<a href="#l167.30"></a><span id="l167.30">   {</span>
<a href="#l167.31"></a><span id="l167.31" class="difflineminus">-    nsCAutoString urlSpec;</span>
<a href="#l167.32"></a><span id="l167.32" class="difflineplus">+    nsAutoCString urlSpec;</span>
<a href="#l167.33"></a><span id="l167.33">     rv = aURI-&gt;GetSpec(urlSpec);</span>
<a href="#l167.34"></a><span id="l167.34">     DetermineOutputFormat(urlSpec.get(), &amp;newType);</span>
<a href="#l167.35"></a><span id="l167.35">     mAlreadyKnowOutputType = true;</span>
<a href="#l167.36"></a><span id="l167.36">     mOutputType = newType;</span>
<a href="#l167.37"></a><span id="l167.37">   }</span>
<a href="#l167.38"></a><span id="l167.38"> </span>
<a href="#l167.39"></a><span id="l167.39">   switch (newType)</span>
<a href="#l167.40"></a><span id="l167.40">   {</span>
<a href="#l167.41"></a><span id="l167.41" class="difflineat">@@ -599,17 +599,17 @@ NS_IMETHODIMP nsStreamConverter::Init(ns</span>
<a href="#l167.42"></a><span id="l167.42">   // We will first find an appropriate emitter in the repository that supports</span>
<a href="#l167.43"></a><span id="l167.43">   // the requested output format...note, the special exceptions are nsMimeMessageDraftOrTemplate</span>
<a href="#l167.44"></a><span id="l167.44">   // or nsMimeMessageEditorTemplate where we don't need any emitters</span>
<a href="#l167.45"></a><span id="l167.45">   //</span>
<a href="#l167.46"></a><span id="l167.46"> </span>
<a href="#l167.47"></a><span id="l167.47">   if ( (newType != nsMimeOutput::nsMimeMessageDraftOrTemplate) &amp;&amp;</span>
<a href="#l167.48"></a><span id="l167.48">     (newType != nsMimeOutput::nsMimeMessageEditorTemplate) )</span>
<a href="#l167.49"></a><span id="l167.49">   {</span>
<a href="#l167.50"></a><span id="l167.50" class="difflineminus">-    nsCAutoString categoryName (&quot;@mozilla.org/messenger/mimeemitter;1?type=&quot;);</span>
<a href="#l167.51"></a><span id="l167.51" class="difflineplus">+    nsAutoCString categoryName (&quot;@mozilla.org/messenger/mimeemitter;1?type=&quot;);</span>
<a href="#l167.52"></a><span id="l167.52">     if (!mOverrideFormat.IsEmpty())</span>
<a href="#l167.53"></a><span id="l167.53">       categoryName += mOverrideFormat;</span>
<a href="#l167.54"></a><span id="l167.54">     else</span>
<a href="#l167.55"></a><span id="l167.55">       categoryName += mOutputFormat;</span>
<a href="#l167.56"></a><span id="l167.56"> </span>
<a href="#l167.57"></a><span id="l167.57">     nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l167.58"></a><span id="l167.58">     if (NS_SUCCEEDED(rv))</span>
<a href="#l167.59"></a><span id="l167.59">     {</span>
<a href="#l167.60"></a><span id="l167.60" class="difflineat">@@ -882,17 +882,17 @@ nsStreamConverter::OnDataAvailable(nsIRe</span>
<a href="#l167.61"></a><span id="l167.61"> const char output[] = &quot;\</span>
<a href="#l167.62"></a><span id="l167.62"> &lt;HTML&gt;\</span>
<a href="#l167.63"></a><span id="l167.63"> &lt;FRAMESET ROWS=\&quot;30%%,70%%\&quot;&gt;\</span>
<a href="#l167.64"></a><span id="l167.64"> &lt;FRAME NAME=messageHeader SRC=\&quot;%s?header=only\&quot;&gt;\</span>
<a href="#l167.65"></a><span id="l167.65"> &lt;FRAME NAME=messageBody SRC=\&quot;%s?header=none\&quot;&gt;\</span>
<a href="#l167.66"></a><span id="l167.66"> &lt;/FRAMESET&gt;\</span>
<a href="#l167.67"></a><span id="l167.67"> &lt;/HTML&gt;&quot;;</span>
<a href="#l167.68"></a><span id="l167.68"> </span>
<a href="#l167.69"></a><span id="l167.69" class="difflineminus">-    nsCAutoString url;</span>
<a href="#l167.70"></a><span id="l167.70" class="difflineplus">+    nsAutoCString url;</span>
<a href="#l167.71"></a><span id="l167.71">     if (NS_FAILED(mURI-&gt;GetSpec(url)))</span>
<a href="#l167.72"></a><span id="l167.72">       return NS_ERROR_FAILURE;</span>
<a href="#l167.73"></a><span id="l167.73"> </span>
<a href="#l167.74"></a><span id="l167.74">     PR_snprintf(outBuf, sizeof(outBuf), output, url.get(), url.get());</span>
<a href="#l167.75"></a><span id="l167.75"> </span>
<a href="#l167.76"></a><span id="l167.76">     if (mEmitter)</span>
<a href="#l167.77"></a><span id="l167.77">       mEmitter-&gt;Write(nsDependentCString(outBuf), &amp;written);</span>
<a href="#l167.78"></a><span id="l167.78"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l168.1"></a><span id="l168.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l168.2"></a><span id="l168.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l168.3"></a><span id="l168.3" class="difflineat">@@ -111,17 +111,17 @@ nsNNTPNewsgroupList::Initialize(nsINntpU</span>
<a href="#l168.4"></a><span id="l168.4">   ParseString(ngHeaders, ' ', m_filterHeaders);</span>
<a href="#l168.5"></a><span id="l168.5"> </span>
<a href="#l168.6"></a><span id="l168.6">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l168.7"></a><span id="l168.7">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l168.8"></a><span id="l168.8">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l168.9"></a><span id="l168.9"> </span>
<a href="#l168.10"></a><span id="l168.10">   rv = server-&gt;GetFilterList(m_msgWindow, getter_AddRefs(m_serverFilterList));</span>
<a href="#l168.11"></a><span id="l168.11">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l168.12"></a><span id="l168.12" class="difflineminus">-  nsCAutoString servHeaders;</span>
<a href="#l168.13"></a><span id="l168.13" class="difflineplus">+  nsAutoCString servHeaders;</span>
<a href="#l168.14"></a><span id="l168.14">   m_serverFilterList-&gt;GetArbitraryHeaders(servHeaders);</span>
<a href="#l168.15"></a><span id="l168.15"> </span>
<a href="#l168.16"></a><span id="l168.16">   nsTArray&lt;nsCString&gt; servArray;</span>
<a href="#l168.17"></a><span id="l168.17">   ParseString(servHeaders, ' ', servArray);</span>
<a href="#l168.18"></a><span id="l168.18"> </span>
<a href="#l168.19"></a><span id="l168.19">   // servArray may have duplicates already in m_filterHeaders.</span>
<a href="#l168.20"></a><span id="l168.20">   for (uint32_t i = 0; i &lt; servArray.Length(); i++)</span>
<a href="#l168.21"></a><span id="l168.21">   {</span>
<a href="#l168.22"></a><span id="l168.22" class="difflineat">@@ -715,17 +715,17 @@ NS_IMETHODIMP nsNNTPNewsgroupList::Apply</span>
<a href="#l168.23"></a><span id="l168.23">       break;</span>
<a href="#l168.24"></a><span id="l168.24"> </span>
<a href="#l168.25"></a><span id="l168.25">       case nsMsgFilterAction::Custom:</span>
<a href="#l168.26"></a><span id="l168.26">       {</span>
<a href="#l168.27"></a><span id="l168.27">         nsCOMPtr&lt;nsIMsgFilterCustomAction&gt; customAction;</span>
<a href="#l168.28"></a><span id="l168.28">         rv = filterAction-&gt;GetCustomAction(getter_AddRefs(customAction));</span>
<a href="#l168.29"></a><span id="l168.29">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l168.30"></a><span id="l168.30"> </span>
<a href="#l168.31"></a><span id="l168.31" class="difflineminus">-        nsCAutoString value;</span>
<a href="#l168.32"></a><span id="l168.32" class="difflineplus">+        nsAutoCString value;</span>
<a href="#l168.33"></a><span id="l168.33">         filterAction-&gt;GetStrValue(value);</span>
<a href="#l168.34"></a><span id="l168.34"> </span>
<a href="#l168.35"></a><span id="l168.35">         nsCOMPtr&lt;nsIMutableArray&gt; messageArray(</span>
<a href="#l168.36"></a><span id="l168.36">             do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l168.37"></a><span id="l168.37">         NS_ENSURE_TRUE(messageArray, rv);</span>
<a href="#l168.38"></a><span id="l168.38">         messageArray-&gt;AppendElement(m_newMsgHdr, false);</span>
<a href="#l168.39"></a><span id="l168.39"> </span>
<a href="#l168.40"></a><span id="l168.40">         customAction-&gt;Apply(messageArray, value, nullptr,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l169.1"></a><span id="l169.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l169.2"></a><span id="l169.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l169.3"></a><span id="l169.3" class="difflineat">@@ -230,22 +230,22 @@ const char *const stateLabels[] = {</span>
<a href="#l169.4"></a><span id="l169.4"> ////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l169.5"></a><span id="l169.5"> // TEMPORARY HARD CODED FUNCTIONS</span>
<a href="#l169.6"></a><span id="l169.6"> ///////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l169.7"></a><span id="l169.7"> #define NET_IS_SPACE(x) ((x)==' ' || (x)=='\t')</span>
<a href="#l169.8"></a><span id="l169.8"> </span>
<a href="#l169.9"></a><span id="l169.9"> // turn &quot;\xx&quot; (with xx being hex numbers) in string into chars</span>
<a href="#l169.10"></a><span id="l169.10"> char *MSG_UnEscapeSearchUrl (const char *commandSpecificData)</span>
<a href="#l169.11"></a><span id="l169.11"> {</span>
<a href="#l169.12"></a><span id="l169.12" class="difflineminus">-  nsCAutoString result(commandSpecificData);</span>
<a href="#l169.13"></a><span id="l169.13" class="difflineplus">+  nsAutoCString result(commandSpecificData);</span>
<a href="#l169.14"></a><span id="l169.14">   int32_t slashpos = 0;</span>
<a href="#l169.15"></a><span id="l169.15">   while (slashpos = result.FindChar('\\', slashpos),</span>
<a href="#l169.16"></a><span id="l169.16">          slashpos != kNotFound)</span>
<a href="#l169.17"></a><span id="l169.17">   {</span>
<a href="#l169.18"></a><span id="l169.18" class="difflineminus">-    nsCAutoString hex;</span>
<a href="#l169.19"></a><span id="l169.19" class="difflineplus">+    nsAutoCString hex;</span>
<a href="#l169.20"></a><span id="l169.20">     hex.Assign(Substring(result, slashpos + 1, 2));</span>
<a href="#l169.21"></a><span id="l169.21">     int32_t ch;</span>
<a href="#l169.22"></a><span id="l169.22">     nsresult err;</span>
<a href="#l169.23"></a><span id="l169.23">     ch = hex.ToInteger(&amp;err, 16);</span>
<a href="#l169.24"></a><span id="l169.24">     result.Replace(slashpos, 3, err == NS_OK &amp;&amp; ch != 0 ? (char) ch : 'X');</span>
<a href="#l169.25"></a><span id="l169.25">     slashpos++;</span>
<a href="#l169.26"></a><span id="l169.26">   }</span>
<a href="#l169.27"></a><span id="l169.27">   return ToNewCString(result);</span>
<a href="#l169.28"></a><span id="l169.28" class="difflineat">@@ -650,17 +650,17 @@ nsresult nsNNTPProtocol::SetupPartExtrac</span>
<a href="#l169.29"></a><span id="l169.29">   bool convertData = false;</span>
<a href="#l169.30"></a><span id="l169.30">   nsresult rv = NS_OK;</span>
<a href="#l169.31"></a><span id="l169.31"> </span>
<a href="#l169.32"></a><span id="l169.32">   if (m_newsAction == nsINntpUrl::ActionFetchArticle)</span>
<a href="#l169.33"></a><span id="l169.33">   {</span>
<a href="#l169.34"></a><span id="l169.34">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl = do_QueryInterface(m_runningURL, &amp;rv);</span>
<a href="#l169.35"></a><span id="l169.35">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l169.36"></a><span id="l169.36"> </span>
<a href="#l169.37"></a><span id="l169.37" class="difflineminus">-    nsCAutoString queryStr;</span>
<a href="#l169.38"></a><span id="l169.38" class="difflineplus">+    nsAutoCString queryStr;</span>
<a href="#l169.39"></a><span id="l169.39">     rv = msgUrl-&gt;GetQuery(queryStr);</span>
<a href="#l169.40"></a><span id="l169.40">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l169.41"></a><span id="l169.41"> </span>
<a href="#l169.42"></a><span id="l169.42">     // check if this is a filter plugin requesting the message.</span>
<a href="#l169.43"></a><span id="l169.43">     // in that case, set up a text converter</span>
<a href="#l169.44"></a><span id="l169.44">     convertData = (queryStr.Find(&quot;header=filter&quot;) != kNotFound</span>
<a href="#l169.45"></a><span id="l169.45">       || queryStr.Find(&quot;header=attach&quot;) != kNotFound);</span>
<a href="#l169.46"></a><span id="l169.46">   }</span>
<a href="#l169.47"></a><span id="l169.47" class="difflineat">@@ -874,17 +874,17 @@ nsresult nsNNTPProtocol::OpenCacheEntry(</span>
<a href="#l169.48"></a><span id="l169.48">   nsCOMPtr &lt;nsINntpService&gt; nntpService = do_GetService(NS_NNTPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l169.49"></a><span id="l169.49">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l169.50"></a><span id="l169.50"> </span>
<a href="#l169.51"></a><span id="l169.51">   nsCOMPtr&lt;nsICacheSession&gt; cacheSession;</span>
<a href="#l169.52"></a><span id="l169.52">   rv = nntpService-&gt;GetCacheSession(getter_AddRefs(cacheSession));</span>
<a href="#l169.53"></a><span id="l169.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l169.54"></a><span id="l169.54"> </span>
<a href="#l169.55"></a><span id="l169.55">   // Open a cache entry with key = url</span>
<a href="#l169.56"></a><span id="l169.56" class="difflineminus">-  nsCAutoString urlSpec;</span>
<a href="#l169.57"></a><span id="l169.57" class="difflineplus">+  nsAutoCString urlSpec;</span>
<a href="#l169.58"></a><span id="l169.58">   mailnewsUrl-&gt;GetAsciiSpec(urlSpec);</span>
<a href="#l169.59"></a><span id="l169.59">   // for now, truncate of the query part so we don't duplicate urls in the cache...</span>
<a href="#l169.60"></a><span id="l169.60">   int32_t pos = urlSpec.FindChar('?');</span>
<a href="#l169.61"></a><span id="l169.61">   if (pos != -1)</span>
<a href="#l169.62"></a><span id="l169.62">     urlSpec.SetLength(pos);</span>
<a href="#l169.63"></a><span id="l169.63">   return cacheSession-&gt;AsyncOpenCacheEntry(urlSpec, nsICache::ACCESS_READ_WRITE, this, false);</span>
<a href="#l169.64"></a><span id="l169.64"> }</span>
<a href="#l169.65"></a><span id="l169.65"> </span>
<a href="#l169.66"></a><span id="l169.66" class="difflineat">@@ -1515,17 +1515,17 @@ int32_t nsNNTPProtocol::SendListSearches</span>
<a href="#l169.67"></a><span id="l169.67">     SetFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l169.68"></a><span id="l169.68">     return 0;</span>
<a href="#l169.69"></a><span id="l169.69">   }</span>
<a href="#l169.70"></a><span id="l169.70">   if (!line)</span>
<a href="#l169.71"></a><span id="l169.71">     return status;  /* no line yet */</span>
<a href="#l169.72"></a><span id="l169.72"> </span>
<a href="#l169.73"></a><span id="l169.73">   if ('.' != line[0])</span>
<a href="#l169.74"></a><span id="l169.74">   {</span>
<a href="#l169.75"></a><span id="l169.75" class="difflineminus">-        nsCAutoString charset;</span>
<a href="#l169.76"></a><span id="l169.76" class="difflineplus">+        nsAutoCString charset;</span>
<a href="#l169.77"></a><span id="l169.77">         nsAutoString lineUtf16;</span>
<a href="#l169.78"></a><span id="l169.78">         if (NS_FAILED(m_nntpServer-&gt;GetCharset(charset)) ||</span>
<a href="#l169.79"></a><span id="l169.79">             NS_FAILED(nsMsgI18NConvertToUnicode(charset.get(),</span>
<a href="#l169.80"></a><span id="l169.80">                                                 nsDependentCString(line),</span>
<a href="#l169.81"></a><span id="l169.81">                                                 lineUtf16, true)))</span>
<a href="#l169.82"></a><span id="l169.82">             CopyUTF8toUTF16(nsDependentCString(line), lineUtf16);</span>
<a href="#l169.83"></a><span id="l169.83"> </span>
<a href="#l169.84"></a><span id="l169.84">     m_nntpServer-&gt;AddSearchableGroup(lineUtf16);</span>
<a href="#l169.85"></a><span id="l169.85" class="difflineat">@@ -2258,17 +2258,17 @@ int32_t nsNNTPProtocol::ReadArticle(nsII</span>
<a href="#l169.86"></a><span id="l169.86"> </span>
<a href="#l169.87"></a><span id="l169.87">   PR_Free(line);</span>
<a href="#l169.88"></a><span id="l169.88"> </span>
<a href="#l169.89"></a><span id="l169.89">   return 0;</span>
<a href="#l169.90"></a><span id="l169.90"> }</span>
<a href="#l169.91"></a><span id="l169.91"> </span>
<a href="#l169.92"></a><span id="l169.92"> void nsNNTPProtocol::ParseHeaderForCancel(char *buf)</span>
<a href="#l169.93"></a><span id="l169.93"> {</span>
<a href="#l169.94"></a><span id="l169.94" class="difflineminus">-    nsCAutoString header(buf);</span>
<a href="#l169.95"></a><span id="l169.95" class="difflineplus">+    nsAutoCString header(buf);</span>
<a href="#l169.96"></a><span id="l169.96">     int32_t colon = header.FindChar(':');</span>
<a href="#l169.97"></a><span id="l169.97">     if (!colon)</span>
<a href="#l169.98"></a><span id="l169.98">     return;</span>
<a href="#l169.99"></a><span id="l169.99"> </span>
<a href="#l169.100"></a><span id="l169.100">     nsCString value(Substring(header, colon + 1));</span>
<a href="#l169.101"></a><span id="l169.101">     value.StripWhitespace();</span>
<a href="#l169.102"></a><span id="l169.102"> </span>
<a href="#l169.103"></a><span id="l169.103">     switch (header.First()) {</span>
<a href="#l169.104"></a><span id="l169.104" class="difflineat">@@ -2592,17 +2592,17 @@ int32_t nsNNTPProtocol::ProcessNewsgroup</span>
<a href="#l169.105"></a><span id="l169.105">    */</span>
<a href="#l169.106"></a><span id="l169.106">   if (line[0]=='.' &amp;&amp; line[1]=='\0')</span>
<a href="#l169.107"></a><span id="l169.107">   {</span>
<a href="#l169.108"></a><span id="l169.108">     ClearFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l169.109"></a><span id="l169.109">     bool xactive=false;</span>
<a href="#l169.110"></a><span id="l169.110">     rv = m_nntpServer-&gt;QueryExtension(&quot;XACTIVE&quot;,&amp;xactive);</span>
<a href="#l169.111"></a><span id="l169.111">     if (NS_SUCCEEDED(rv) &amp;&amp; xactive)</span>
<a href="#l169.112"></a><span id="l169.112">     {</span>
<a href="#l169.113"></a><span id="l169.113" class="difflineminus">-      nsCAutoString groupName;</span>
<a href="#l169.114"></a><span id="l169.114" class="difflineplus">+      nsAutoCString groupName;</span>
<a href="#l169.115"></a><span id="l169.115">       rv = m_nntpServer-&gt;GetFirstGroupNeedingExtraInfo(groupName);</span>
<a href="#l169.116"></a><span id="l169.116">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l169.117"></a><span id="l169.117">         rv = m_nntpServer-&gt;FindGroup(groupName, getter_AddRefs(m_newsFolder));</span>
<a href="#l169.118"></a><span id="l169.118">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;FindGroup failed&quot;);</span>
<a href="#l169.119"></a><span id="l169.119">         m_nextState = NNTP_LIST_XACTIVE;</span>
<a href="#l169.120"></a><span id="l169.120">         PR_LOG(NNTP,PR_LOG_ALWAYS,(&quot;(%p) listing xactive for %s&quot;, this,</span>
<a href="#l169.121"></a><span id="l169.121">                                    groupName.get()));</span>
<a href="#l169.122"></a><span id="l169.122">         PR_Free(lineToFree);</span>
<a href="#l169.123"></a><span id="l169.123" class="difflineat">@@ -2676,17 +2676,17 @@ int32_t nsNNTPProtocol::ProcessNewsgroup</span>
<a href="#l169.124"></a><span id="l169.124">     rv = m_nntpServer-&gt;AddNewsgroupToList(line);</span>
<a href="#l169.125"></a><span id="l169.125">     NS_ASSERTION(NS_SUCCEEDED(rv),&quot;failed to add to subscribe ds&quot;);</span>
<a href="#l169.126"></a><span id="l169.126">   }</span>
<a href="#l169.127"></a><span id="l169.127"> </span>
<a href="#l169.128"></a><span id="l169.128">   bool xactive=false;</span>
<a href="#l169.129"></a><span id="l169.129">   rv = m_nntpServer-&gt;QueryExtension(&quot;XACTIVE&quot;,&amp;xactive);</span>
<a href="#l169.130"></a><span id="l169.130">   if (NS_SUCCEEDED(rv) &amp;&amp; xactive)</span>
<a href="#l169.131"></a><span id="l169.131">   {</span>
<a href="#l169.132"></a><span id="l169.132" class="difflineminus">-    nsCAutoString charset;</span>
<a href="#l169.133"></a><span id="l169.133" class="difflineplus">+    nsAutoCString charset;</span>
<a href="#l169.134"></a><span id="l169.134">     nsAutoString lineUtf16;</span>
<a href="#l169.135"></a><span id="l169.135">     if (NS_SUCCEEDED(m_nntpServer-&gt;GetCharset(charset)) &amp;&amp;</span>
<a href="#l169.136"></a><span id="l169.136">         NS_SUCCEEDED(nsMsgI18NConvertToUnicode(charset.get(),</span>
<a href="#l169.137"></a><span id="l169.137">                                                nsDependentCString(line),</span>
<a href="#l169.138"></a><span id="l169.138">                                                lineUtf16, true)))</span>
<a href="#l169.139"></a><span id="l169.139">       m_nntpServer-&gt;SetGroupNeedsExtraInfo(NS_ConvertUTF16toUTF8(lineUtf16),</span>
<a href="#l169.140"></a><span id="l169.140">                                            true);</span>
<a href="#l169.141"></a><span id="l169.141">     else</span>
<a href="#l169.142"></a><span id="l169.142" class="difflineat">@@ -3682,17 +3682,17 @@ int32_t nsNNTPProtocol::DoCancel()</span>
<a href="#l169.143"></a><span id="l169.143">   subject = (char *) PR_Malloc (L + 20);</span>
<a href="#l169.144"></a><span id="l169.144">   body = (char *) PR_Malloc (PL_strlen (appName.get()) + 100);</span>
<a href="#l169.145"></a><span id="l169.145"> </span>
<a href="#l169.146"></a><span id="l169.146">   nsString alertText;</span>
<a href="#l169.147"></a><span id="l169.147">   nsString confirmText;</span>
<a href="#l169.148"></a><span id="l169.148">   int32_t confirmCancelResult = 0;</span>
<a href="#l169.149"></a><span id="l169.149"> </span>
<a href="#l169.150"></a><span id="l169.150">   // A little early to declare, but the goto causes problems</span>
<a href="#l169.151"></a><span id="l169.151" class="difflineminus">-  nsCAutoString otherHeaders;</span>
<a href="#l169.152"></a><span id="l169.152" class="difflineplus">+  nsAutoCString otherHeaders;</span>
<a href="#l169.153"></a><span id="l169.153"> </span>
<a href="#l169.154"></a><span id="l169.154">   /* Make sure that this loser isn't cancelling someone else's posting.</span>
<a href="#l169.155"></a><span id="l169.155">      Yes, there are occasionally good reasons to do so.  Those people</span>
<a href="#l169.156"></a><span id="l169.156">      capable of making that decision (news admins) have other tools with</span>
<a href="#l169.157"></a><span id="l169.157">      which to cancel postings (like telnet.)</span>
<a href="#l169.158"></a><span id="l169.158"> </span>
<a href="#l169.159"></a><span id="l169.159">      Don't do this if server tells us it will validate user. DMB 3/19/97</span>
<a href="#l169.160"></a><span id="l169.160">    */</span>
<a href="#l169.161"></a><span id="l169.161" class="difflineat">@@ -3794,17 +3794,17 @@ reported here */</span>
<a href="#l169.162"></a><span id="l169.162">                        &quot;%s&quot; /* body, already with CRLF */</span>
<a href="#l169.163"></a><span id="l169.163">                        &quot;.&quot; CRLF, /* trailing message terminator &quot;.&quot; */</span>
<a href="#l169.164"></a><span id="l169.164">                        cancelInfo.from.get(), newsgroups, subject, id,</span>
<a href="#l169.165"></a><span id="l169.165">                        otherHeaders.get(), body);</span>
<a href="#l169.166"></a><span id="l169.166"> </span>
<a href="#l169.167"></a><span id="l169.167">     status = SendData(data);</span>
<a href="#l169.168"></a><span id="l169.168">     PR_Free (data);</span>
<a href="#l169.169"></a><span id="l169.169">     if (status &lt; 0) {</span>
<a href="#l169.170"></a><span id="l169.170" class="difflineminus">-      nsCAutoString errorText;</span>
<a href="#l169.171"></a><span id="l169.171" class="difflineplus">+      nsAutoCString errorText;</span>
<a href="#l169.172"></a><span id="l169.172">       errorText.AppendInt(status);</span>
<a href="#l169.173"></a><span id="l169.173">       AlertError(MK_TCP_WRITE_ERROR, errorText.get());</span>
<a href="#l169.174"></a><span id="l169.174">       failure = true;</span>
<a href="#l169.175"></a><span id="l169.175">       goto FAIL;</span>
<a href="#l169.176"></a><span id="l169.176">     }</span>
<a href="#l169.177"></a><span id="l169.177"> </span>
<a href="#l169.178"></a><span id="l169.178">     SetFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l169.179"></a><span id="l169.179">     m_nextState = NNTP_RESPONSE;</span>
<a href="#l169.180"></a><span id="l169.180" class="difflineat">@@ -4000,17 +4000,17 @@ int32_t nsNNTPProtocol::ListPrettyNamesR</span>
<a href="#l169.181"></a><span id="l169.181">       char *prettyName;</span>
<a href="#l169.182"></a><span id="l169.182">       if(line[i] == '\0')</span>
<a href="#l169.183"></a><span id="l169.183">         prettyName = &amp;line[i];</span>
<a href="#l169.184"></a><span id="l169.184">       else</span>
<a href="#l169.185"></a><span id="l169.185">         prettyName = &amp;line[i+1];</span>
<a href="#l169.186"></a><span id="l169.186"> </span>
<a href="#l169.187"></a><span id="l169.187">       line[i] = 0; /* terminate group name */</span>
<a href="#l169.188"></a><span id="l169.188">       if (i &gt; 0) {</span>
<a href="#l169.189"></a><span id="l169.189" class="difflineminus">-        nsCAutoString charset;</span>
<a href="#l169.190"></a><span id="l169.190" class="difflineplus">+        nsAutoCString charset;</span>
<a href="#l169.191"></a><span id="l169.191">         nsAutoString lineUtf16, prettyNameUtf16;</span>
<a href="#l169.192"></a><span id="l169.192">         if (NS_FAILED(m_nntpServer-&gt;GetCharset(charset) ||</span>
<a href="#l169.193"></a><span id="l169.193">             NS_FAILED(ConvertToUnicode(charset, line, lineUtf16)) ||</span>
<a href="#l169.194"></a><span id="l169.194">             NS_FAILED(ConvertToUnicode(charset, prettyName, prettyNameUtf16)))) {</span>
<a href="#l169.195"></a><span id="l169.195">           CopyUTF8toUTF16(line, lineUtf16);</span>
<a href="#l169.196"></a><span id="l169.196">           CopyUTF8toUTF16(prettyName, prettyNameUtf16);</span>
<a href="#l169.197"></a><span id="l169.197">         }</span>
<a href="#l169.198"></a><span id="l169.198">         m_nntpServer-&gt;SetPrettyNameForGroup(lineUtf16, prettyNameUtf16);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l170.1"></a><span id="l170.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l170.2"></a><span id="l170.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l170.3"></a><span id="l170.3" class="difflineat">@@ -149,17 +149,17 @@ NS_IMETHODIMP AsyncAuthMigrator::OnPromp</span>
<a href="#l170.4"></a><span id="l170.4"> </span>
<a href="#l170.5"></a><span id="l170.5"> void AsyncAuthMigrator::EnqueuePrompt()</span>
<a href="#l170.6"></a><span id="l170.6"> {</span>
<a href="#l170.7"></a><span id="l170.7">   nsCOMPtr&lt;nsIMsgAsyncPrompter&gt; prompter =</span>
<a href="#l170.8"></a><span id="l170.8">     do_GetService(NS_MSGASYNCPROMPTER_CONTRACTID);</span>
<a href="#l170.9"></a><span id="l170.9"> </span>
<a href="#l170.10"></a><span id="l170.10">   // Make up a fake unique key to prevent coalescing of prompts</span>
<a href="#l170.11"></a><span id="l170.11">   // The address of this object should be sufficient</span>
<a href="#l170.12"></a><span id="l170.12" class="difflineminus">-  nsCAutoString queueKey;</span>
<a href="#l170.13"></a><span id="l170.13" class="difflineplus">+  nsAutoCString queueKey;</span>
<a href="#l170.14"></a><span id="l170.14">   queueKey.AppendInt((int32_t)(uint64_t)this);</span>
<a href="#l170.15"></a><span id="l170.15">   prompter-&gt;QueueAsyncAuthPrompt(queueKey, false, this);</span>
<a href="#l170.16"></a><span id="l170.16"> }</span>
<a href="#l170.17"></a><span id="l170.17"> </span>
<a href="#l170.18"></a><span id="l170.18"> }</span>
<a href="#l170.19"></a><span id="l170.19"> </span>
<a href="#l170.20"></a><span id="l170.20">  </span>
<a href="#l170.21"></a><span id="l170.21"> </span>
<a href="#l170.22"></a><span id="l170.22" class="difflineat">@@ -234,25 +234,25 @@ nsMsgNewsFolder::AddNewsgroup(const nsAC</span>
<a href="#l170.23"></a><span id="l170.23">   nsresult rv;</span>
<a href="#l170.24"></a><span id="l170.24">   nsCOMPtr &lt;nsIRDFService&gt; rdf = do_GetService(kRDFServiceCID, &amp;rv);</span>
<a href="#l170.25"></a><span id="l170.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l170.26"></a><span id="l170.26"> </span>
<a href="#l170.27"></a><span id="l170.27">   nsCOMPtr &lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l170.28"></a><span id="l170.28">   rv = GetNntpServer(getter_AddRefs(nntpServer));</span>
<a href="#l170.29"></a><span id="l170.29">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l170.30"></a><span id="l170.30"> </span>
<a href="#l170.31"></a><span id="l170.31" class="difflineminus">-  nsCAutoString uri(mURI);</span>
<a href="#l170.32"></a><span id="l170.32" class="difflineplus">+  nsAutoCString uri(mURI);</span>
<a href="#l170.33"></a><span id="l170.33">   uri.Append('/');</span>
<a href="#l170.34"></a><span id="l170.34">   // URI should use UTF-8</span>
<a href="#l170.35"></a><span id="l170.35">   // (see RFC2396 Uniform Resource Identifiers (URI): Generic Syntax)</span>
<a href="#l170.36"></a><span id="l170.36"> </span>
<a href="#l170.37"></a><span id="l170.37">   // we are handling newsgroup names in UTF-8</span>
<a href="#l170.38"></a><span id="l170.38">   NS_ConvertUTF8toUTF16 nameUtf16(name);</span>
<a href="#l170.39"></a><span id="l170.39"> </span>
<a href="#l170.40"></a><span id="l170.40" class="difflineminus">-  nsCAutoString escapedName;</span>
<a href="#l170.41"></a><span id="l170.41" class="difflineplus">+  nsAutoCString escapedName;</span>
<a href="#l170.42"></a><span id="l170.42">   rv = NS_MsgEscapeEncodeURLPath(nameUtf16, escapedName);</span>
<a href="#l170.43"></a><span id="l170.43">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l170.44"></a><span id="l170.44"> </span>
<a href="#l170.45"></a><span id="l170.45">   rv = nntpServer-&gt;AddNewsgroup(nameUtf16);</span>
<a href="#l170.46"></a><span id="l170.46">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l170.47"></a><span id="l170.47"> </span>
<a href="#l170.48"></a><span id="l170.48">   uri.Append(escapedName);</span>
<a href="#l170.49"></a><span id="l170.49"> </span>
<a href="#l170.50"></a><span id="l170.50" class="difflineat">@@ -578,17 +578,17 @@ NS_IMETHODIMP nsMsgNewsFolder::CreateSub</span>
<a href="#l170.51"></a><span id="l170.51">   if (NS_SUCCEEDED(rv))</span>
<a href="#l170.52"></a><span id="l170.52">     SetNewsrcHasChanged(true); // subscribe UI does this - but maybe we got here through auto-subscribe</span>
<a href="#l170.53"></a><span id="l170.53"> </span>
<a href="#l170.54"></a><span id="l170.54">   if(NS_SUCCEEDED(rv) &amp;&amp; child){</span>
<a href="#l170.55"></a><span id="l170.55">     nsCOMPtr &lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l170.56"></a><span id="l170.56">     rv = GetNntpServer(getter_AddRefs(nntpServer));</span>
<a href="#l170.57"></a><span id="l170.57">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l170.58"></a><span id="l170.58"> </span>
<a href="#l170.59"></a><span id="l170.59" class="difflineminus">-    nsCAutoString dataCharset;</span>
<a href="#l170.60"></a><span id="l170.60" class="difflineplus">+    nsAutoCString dataCharset;</span>
<a href="#l170.61"></a><span id="l170.61">     rv = nntpServer-&gt;GetCharset(dataCharset);</span>
<a href="#l170.62"></a><span id="l170.62">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l170.63"></a><span id="l170.63"> </span>
<a href="#l170.64"></a><span id="l170.64">     child-&gt;SetCharset(dataCharset);</span>
<a href="#l170.65"></a><span id="l170.65">     NotifyItemAdded(child);</span>
<a href="#l170.66"></a><span id="l170.66">     nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifier(do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));</span>
<a href="#l170.67"></a><span id="l170.67">     if (notifier)</span>
<a href="#l170.68"></a><span id="l170.68">       notifier-&gt;NotifyFolderAdded(child);</span>
<a href="#l170.69"></a><span id="l170.69" class="difflineat">@@ -926,17 +926,17 @@ NS_IMETHODIMP nsMsgNewsFolder::CancelMes</span>
<a href="#l170.70"></a><span id="l170.70">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l170.71"></a><span id="l170.71"> </span>
<a href="#l170.72"></a><span id="l170.72">   // we need to escape the message ID,</span>
<a href="#l170.73"></a><span id="l170.73">   // it might contain characters which will mess us up later, like #</span>
<a href="#l170.74"></a><span id="l170.74">   // see bug #120502</span>
<a href="#l170.75"></a><span id="l170.75">   nsCString escapedMessageID;</span>
<a href="#l170.76"></a><span id="l170.76">   MsgEscapeString(messageID, nsINetUtil::ESCAPE_URL_PATH, escapedMessageID);</span>
<a href="#l170.77"></a><span id="l170.77"> </span>
<a href="#l170.78"></a><span id="l170.78" class="difflineminus">-  nsCAutoString cancelURL(serverURI.get());</span>
<a href="#l170.79"></a><span id="l170.79" class="difflineplus">+  nsAutoCString cancelURL(serverURI.get());</span>
<a href="#l170.80"></a><span id="l170.80">   cancelURL += '/';</span>
<a href="#l170.81"></a><span id="l170.81">   cancelURL += escapedMessageID;</span>
<a href="#l170.82"></a><span id="l170.82">   cancelURL += &quot;?cancel&quot;;</span>
<a href="#l170.83"></a><span id="l170.83"> </span>
<a href="#l170.84"></a><span id="l170.84">   nsCString messageURI;</span>
<a href="#l170.85"></a><span id="l170.85">   rv = GetUriForMsg(msgHdr, messageURI);</span>
<a href="#l170.86"></a><span id="l170.86">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l170.87"></a><span id="l170.87"> </span>
<a href="#l170.88"></a><span id="l170.88" class="difflineat">@@ -1620,17 +1620,17 @@ nsMsgNewsFolder::GetRawName(nsACString &amp;</span>
<a href="#l170.89"></a><span id="l170.89">     rv = GetName(name);</span>
<a href="#l170.90"></a><span id="l170.90">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l170.91"></a><span id="l170.91"> </span>
<a href="#l170.92"></a><span id="l170.92">     // convert to the server-side encoding</span>
<a href="#l170.93"></a><span id="l170.93">     nsCOMPtr &lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l170.94"></a><span id="l170.94">     rv = GetNntpServer(getter_AddRefs(nntpServer));</span>
<a href="#l170.95"></a><span id="l170.95">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l170.96"></a><span id="l170.96"> </span>
<a href="#l170.97"></a><span id="l170.97" class="difflineminus">-    nsCAutoString dataCharset;</span>
<a href="#l170.98"></a><span id="l170.98" class="difflineplus">+    nsAutoCString dataCharset;</span>
<a href="#l170.99"></a><span id="l170.99">     rv = nntpServer-&gt;GetCharset(dataCharset);</span>
<a href="#l170.100"></a><span id="l170.100">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l170.101"></a><span id="l170.101">     rv = nsMsgI18NConvertFromUnicode(dataCharset.get(), name, mRawName);</span>
<a href="#l170.102"></a><span id="l170.102"> </span>
<a href="#l170.103"></a><span id="l170.103">     if (NS_FAILED(rv))</span>
<a href="#l170.104"></a><span id="l170.104">       LossyCopyUTF16toASCII(name, mRawName);</span>
<a href="#l170.105"></a><span id="l170.105">   }</span>
<a href="#l170.106"></a><span id="l170.106">   aRawName = mRawName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l171.1"></a><span id="l171.1" class="difflineminus">--- a/mailnews/news/src/nsNewsUtils.cpp</span>
<a href="#l171.2"></a><span id="l171.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsUtils.cpp</span>
<a href="#l171.3"></a><span id="l171.3" class="difflineat">@@ -11,50 +11,50 @@</span>
<a href="#l171.4"></a><span id="l171.4"> </span>
<a href="#l171.5"></a><span id="l171.5"> /* parses NewsMessageURI */</span>
<a href="#l171.6"></a><span id="l171.6"> nsresult</span>
<a href="#l171.7"></a><span id="l171.7"> nsParseNewsMessageURI(const char* uri, nsCString&amp; group, uint32_t *key)</span>
<a href="#l171.8"></a><span id="l171.8"> {</span>
<a href="#l171.9"></a><span id="l171.9">   NS_ENSURE_ARG_POINTER(uri);</span>
<a href="#l171.10"></a><span id="l171.10">   NS_ENSURE_ARG_POINTER(key);</span>
<a href="#l171.11"></a><span id="l171.11"> </span>
<a href="#l171.12"></a><span id="l171.12" class="difflineminus">-  nsCAutoString uriStr(uri);</span>
<a href="#l171.13"></a><span id="l171.13" class="difflineplus">+  nsAutoCString uriStr(uri);</span>
<a href="#l171.14"></a><span id="l171.14">   int32_t keySeparator = uriStr.FindChar('#');</span>
<a href="#l171.15"></a><span id="l171.15">   if(keySeparator != -1)</span>
<a href="#l171.16"></a><span id="l171.16">   {</span>
<a href="#l171.17"></a><span id="l171.17">     int32_t keyEndSeparator = MsgFindCharInSet(uriStr, &quot;?&amp;&quot;, keySeparator);</span>
<a href="#l171.18"></a><span id="l171.18"> </span>
<a href="#l171.19"></a><span id="l171.19">     // Grab between the last '/' and the '#' for the key</span>
<a href="#l171.20"></a><span id="l171.20">     group = StringHead(uriStr, keySeparator);</span>
<a href="#l171.21"></a><span id="l171.21">     int32_t groupSeparator = group.RFind(&quot;/&quot;);</span>
<a href="#l171.22"></a><span id="l171.22">     if (groupSeparator == -1)</span>
<a href="#l171.23"></a><span id="l171.23">       return NS_ERROR_FAILURE;</span>
<a href="#l171.24"></a><span id="l171.24"> </span>
<a href="#l171.25"></a><span id="l171.25">     // Our string APIs don't let us unescape into the same buffer from earlier,</span>
<a href="#l171.26"></a><span id="l171.26">     // so escape into a temporary</span>
<a href="#l171.27"></a><span id="l171.27" class="difflineminus">-    nsCAutoString unescapedGroup;</span>
<a href="#l171.28"></a><span id="l171.28" class="difflineplus">+    nsAutoCString unescapedGroup;</span>
<a href="#l171.29"></a><span id="l171.29">     MsgUnescapeString(Substring(group, groupSeparator + 1), 0, unescapedGroup);</span>
<a href="#l171.30"></a><span id="l171.30">     group = unescapedGroup;</span>
<a href="#l171.31"></a><span id="l171.31"> </span>
<a href="#l171.32"></a><span id="l171.32" class="difflineminus">-    nsCAutoString keyStr;</span>
<a href="#l171.33"></a><span id="l171.33" class="difflineplus">+    nsAutoCString keyStr;</span>
<a href="#l171.34"></a><span id="l171.34">     if (keyEndSeparator != -1)</span>
<a href="#l171.35"></a><span id="l171.35">       keyStr = Substring(uriStr, keySeparator + 1, keyEndSeparator - (keySeparator + 1));</span>
<a href="#l171.36"></a><span id="l171.36">     else</span>
<a href="#l171.37"></a><span id="l171.37">       keyStr = Substring(uriStr, keySeparator + 1);</span>
<a href="#l171.38"></a><span id="l171.38">     nsresult errorCode;</span>
<a href="#l171.39"></a><span id="l171.39">     *key = keyStr.ToInteger(&amp;errorCode);</span>
<a href="#l171.40"></a><span id="l171.40"> </span>
<a href="#l171.41"></a><span id="l171.41">     return errorCode;</span>
<a href="#l171.42"></a><span id="l171.42">   }</span>
<a href="#l171.43"></a><span id="l171.43">   return NS_ERROR_FAILURE;</span>
<a href="#l171.44"></a><span id="l171.44"> }</span>
<a href="#l171.45"></a><span id="l171.45"> </span>
<a href="#l171.46"></a><span id="l171.46"> nsresult nsCreateNewsBaseMessageURI(const char *baseURI, nsCString &amp;baseMessageURI)</span>
<a href="#l171.47"></a><span id="l171.47"> {</span>
<a href="#l171.48"></a><span id="l171.48" class="difflineminus">-  nsCAutoString tailURI(baseURI);</span>
<a href="#l171.49"></a><span id="l171.49" class="difflineplus">+  nsAutoCString tailURI(baseURI);</span>
<a href="#l171.50"></a><span id="l171.50"> </span>
<a href="#l171.51"></a><span id="l171.51">   // chop off news:/</span>
<a href="#l171.52"></a><span id="l171.52">   if (tailURI.Find(kNewsRootURI) == 0)</span>
<a href="#l171.53"></a><span id="l171.53">     tailURI.Cut(0, PL_strlen(kNewsRootURI));</span>
<a href="#l171.54"></a><span id="l171.54"> </span>
<a href="#l171.55"></a><span id="l171.55">   baseMessageURI = kNewsMessageRootURI;</span>
<a href="#l171.56"></a><span id="l171.56">   baseMessageURI += tailURI;</span>
<a href="#l171.57"></a><span id="l171.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l172.1"></a><span id="l172.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l172.2"></a><span id="l172.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l172.3"></a><span id="l172.3" class="difflineat">@@ -167,17 +167,17 @@ nsNntpIncomingServer::GetNewsrcFilePath(</span>
<a href="#l172.4"></a><span id="l172.4"> </span>
<a href="#l172.5"></a><span id="l172.5">   rv = GetNewsrcRootPath(getter_AddRefs(mNewsrcFilePath));</span>
<a href="#l172.6"></a><span id="l172.6">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l172.7"></a><span id="l172.7"> </span>
<a href="#l172.8"></a><span id="l172.8">   nsCString hostname;</span>
<a href="#l172.9"></a><span id="l172.9">   rv = GetHostName(hostname);</span>
<a href="#l172.10"></a><span id="l172.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l172.11"></a><span id="l172.11"> </span>
<a href="#l172.12"></a><span id="l172.12" class="difflineminus">-  nsCAutoString newsrcFileName(NEWSRC_FILE_PREFIX);</span>
<a href="#l172.13"></a><span id="l172.13" class="difflineplus">+  nsAutoCString newsrcFileName(NEWSRC_FILE_PREFIX);</span>
<a href="#l172.14"></a><span id="l172.14">   newsrcFileName.Append(hostname);</span>
<a href="#l172.15"></a><span id="l172.15">   newsrcFileName.Append(NEWSRC_FILE_SUFFIX);</span>
<a href="#l172.16"></a><span id="l172.16">   rv = mNewsrcFilePath-&gt;AppendNative(newsrcFileName);</span>
<a href="#l172.17"></a><span id="l172.17">   rv = mNewsrcFilePath-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 0644);</span>
<a href="#l172.18"></a><span id="l172.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l172.19"></a><span id="l172.19"> </span>
<a href="#l172.20"></a><span id="l172.20">   rv = SetNewsrcFilePath(mNewsrcFilePath);</span>
<a href="#l172.21"></a><span id="l172.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l172.22"></a><span id="l172.22" class="difflineat">@@ -731,17 +731,17 @@ nsNntpIncomingServer::ContainsNewsgroup(</span>
<a href="#l172.23"></a><span id="l172.23">       nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l172.24"></a><span id="l172.24">       GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l172.25"></a><span id="l172.25">       if (rootFolder)</span>
<a href="#l172.26"></a><span id="l172.26">       {</span>
<a href="#l172.27"></a><span id="l172.27">         nsCOMPtr&lt;nsISimpleEnumerator&gt; subfolders;</span>
<a href="#l172.28"></a><span id="l172.28">         rootFolder-&gt;GetSubFolders(getter_AddRefs(subfolders));</span>
<a href="#l172.29"></a><span id="l172.29">       }</span>
<a href="#l172.30"></a><span id="l172.30">     }</span>
<a href="#l172.31"></a><span id="l172.31" class="difflineminus">-    nsCAutoString unescapedName;</span>
<a href="#l172.32"></a><span id="l172.32" class="difflineplus">+    nsAutoCString unescapedName;</span>
<a href="#l172.33"></a><span id="l172.33">     MsgUnescapeString(name, 0, unescapedName);</span>
<a href="#l172.34"></a><span id="l172.34">     *containsGroup = mSubscribedNewsgroups.Contains(name);</span>
<a href="#l172.35"></a><span id="l172.35">     return NS_OK;</span>
<a href="#l172.36"></a><span id="l172.36"> }</span>
<a href="#l172.37"></a><span id="l172.37"> </span>
<a href="#l172.38"></a><span id="l172.38"> NS_IMETHODIMP</span>
<a href="#l172.39"></a><span id="l172.39"> nsNntpIncomingServer::SubscribeToNewsgroup(const nsACString &amp;aName)</span>
<a href="#l172.40"></a><span id="l172.40"> {</span>
<a href="#l172.41"></a><span id="l172.41" class="difflineat">@@ -793,29 +793,29 @@ nsNntpIncomingServer::WriteHostInfoFile(</span>
<a href="#l172.42"></a><span id="l172.42"> </span>
<a href="#l172.43"></a><span id="l172.43">   if (!mHostInfoFile)</span>
<a href="#l172.44"></a><span id="l172.44">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l172.45"></a><span id="l172.45">   nsCOMPtr&lt;nsIOutputStream&gt; hostInfoStream;</span>
<a href="#l172.46"></a><span id="l172.46">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(hostInfoStream), mHostInfoFile, -1, 00600);</span>
<a href="#l172.47"></a><span id="l172.47">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l172.48"></a><span id="l172.48"> </span>
<a href="#l172.49"></a><span id="l172.49">   // todo, missing some formatting, see the 4.x code</span>
<a href="#l172.50"></a><span id="l172.50" class="difflineminus">-  nsCAutoString header(&quot;# News host information file.&quot;);</span>
<a href="#l172.51"></a><span id="l172.51" class="difflineplus">+  nsAutoCString header(&quot;# News host information file.&quot;);</span>
<a href="#l172.52"></a><span id="l172.52">   WriteLine(hostInfoStream, header);</span>
<a href="#l172.53"></a><span id="l172.53">   header.Assign(&quot;# This is a generated file!  Do not edit.&quot;);</span>
<a href="#l172.54"></a><span id="l172.54">   WriteLine(hostInfoStream, header);</span>
<a href="#l172.55"></a><span id="l172.55">   header.Truncate();</span>
<a href="#l172.56"></a><span id="l172.56">   WriteLine(hostInfoStream, header);</span>
<a href="#l172.57"></a><span id="l172.57" class="difflineminus">-  nsCAutoString version(&quot;version=&quot;);</span>
<a href="#l172.58"></a><span id="l172.58" class="difflineplus">+  nsAutoCString version(&quot;version=&quot;);</span>
<a href="#l172.59"></a><span id="l172.59">   version.AppendInt(VALID_VERSION);</span>
<a href="#l172.60"></a><span id="l172.60">   WriteLine(hostInfoStream, version);</span>
<a href="#l172.61"></a><span id="l172.61" class="difflineminus">-  nsCAutoString newsrcname(&quot;newsrcname=&quot;);</span>
<a href="#l172.62"></a><span id="l172.62" class="difflineplus">+  nsAutoCString newsrcname(&quot;newsrcname=&quot;);</span>
<a href="#l172.63"></a><span id="l172.63">   newsrcname.Append(hostname);</span>
<a href="#l172.64"></a><span id="l172.64">   WriteLine(hostInfoStream, hostname);</span>
<a href="#l172.65"></a><span id="l172.65" class="difflineminus">-  nsCAutoString dateStr(&quot;lastgroupdate=&quot;);</span>
<a href="#l172.66"></a><span id="l172.66" class="difflineplus">+  nsAutoCString dateStr(&quot;lastgroupdate=&quot;);</span>
<a href="#l172.67"></a><span id="l172.67">   dateStr.AppendInt(mLastUpdatedTime);</span>
<a href="#l172.68"></a><span id="l172.68">   WriteLine(hostInfoStream, dateStr);</span>
<a href="#l172.69"></a><span id="l172.69">   dateStr =&quot;firstnewdate=&quot;;</span>
<a href="#l172.70"></a><span id="l172.70">   dateStr.AppendInt(firstnewdate);</span>
<a href="#l172.71"></a><span id="l172.71">   WriteLine(hostInfoStream, dateStr);</span>
<a href="#l172.72"></a><span id="l172.72">   dateStr = &quot;uniqueid=&quot;;</span>
<a href="#l172.73"></a><span id="l172.73">   dateStr.AppendInt(mUniqueId);</span>
<a href="#l172.74"></a><span id="l172.74">   WriteLine(hostInfoStream, dateStr);</span>
<a href="#l172.75"></a><span id="l172.75" class="difflineat">@@ -968,17 +968,17 @@ nsNntpIncomingServer::StartPopulating(ns</span>
<a href="#l172.76"></a><span id="l172.76">  * UTF-8 here for later use.</span>
<a href="#l172.77"></a><span id="l172.77">  **/</span>
<a href="#l172.78"></a><span id="l172.78"> NS_IMETHODIMP</span>
<a href="#l172.79"></a><span id="l172.79"> nsNntpIncomingServer::AddNewsgroupToList(const char *aName)</span>
<a href="#l172.80"></a><span id="l172.80"> {</span>
<a href="#l172.81"></a><span id="l172.81">     nsresult rv;</span>
<a href="#l172.82"></a><span id="l172.82"> </span>
<a href="#l172.83"></a><span id="l172.83">     nsAutoString newsgroupName;</span>
<a href="#l172.84"></a><span id="l172.84" class="difflineminus">-    nsCAutoString dataCharset;</span>
<a href="#l172.85"></a><span id="l172.85" class="difflineplus">+    nsAutoCString dataCharset;</span>
<a href="#l172.86"></a><span id="l172.86">     rv = GetCharset(dataCharset);</span>
<a href="#l172.87"></a><span id="l172.87">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l172.88"></a><span id="l172.88"> </span>
<a href="#l172.89"></a><span id="l172.89">     rv = nsMsgI18NConvertToUnicode(dataCharset.get(),</span>
<a href="#l172.90"></a><span id="l172.90">                                    nsDependentCString(aName),</span>
<a href="#l172.91"></a><span id="l172.91">                                    newsgroupName);</span>
<a href="#l172.92"></a><span id="l172.92"> #ifdef DEBUG_jungshik</span>
<a href="#l172.93"></a><span id="l172.93">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;newsgroup name conversion failed&quot;);</span>
<a href="#l172.94"></a><span id="l172.94" class="difflineat">@@ -1166,17 +1166,17 @@ nsNntpIncomingServer::Unsubscribe(const </span>
<a href="#l172.95"></a><span id="l172.95">   if (NS_FAILED(rv))</span>
<a href="#l172.96"></a><span id="l172.96">     return rv;</span>
<a href="#l172.97"></a><span id="l172.97"> </span>
<a href="#l172.98"></a><span id="l172.98">   if (!serverFolder)</span>
<a href="#l172.99"></a><span id="l172.99">     return NS_ERROR_FAILURE;</span>
<a href="#l172.100"></a><span id="l172.100"> </span>
<a href="#l172.101"></a><span id="l172.101">   // to handle non-ASCII newsgroup names, we store them internally as escaped.</span>
<a href="#l172.102"></a><span id="l172.102">   // so we need to escape and encode the name, in order to find it.</span>
<a href="#l172.103"></a><span id="l172.103" class="difflineminus">-  nsCAutoString escapedName;</span>
<a href="#l172.104"></a><span id="l172.104" class="difflineplus">+  nsAutoCString escapedName;</span>
<a href="#l172.105"></a><span id="l172.105">   rv = NS_MsgEscapeEncodeURLPath(nsDependentString(aUnicharName), escapedName);</span>
<a href="#l172.106"></a><span id="l172.106"> </span>
<a href="#l172.107"></a><span id="l172.107">   nsCOMPtr &lt;nsIMsgFolder&gt; newsgroupFolder;</span>
<a href="#l172.108"></a><span id="l172.108">   rv = serverFolder-&gt;FindSubFolder(escapedName,</span>
<a href="#l172.109"></a><span id="l172.109">                                    getter_AddRefs(newsgroupFolder));</span>
<a href="#l172.110"></a><span id="l172.110"> </span>
<a href="#l172.111"></a><span id="l172.111">   if (NS_FAILED(rv))</span>
<a href="#l172.112"></a><span id="l172.112">     return rv;</span>
<a href="#l172.113"></a><span id="l172.113" class="difflineat">@@ -1495,17 +1495,17 @@ nsNntpIncomingServer::FindGroup(const ns</span>
<a href="#l172.114"></a><span id="l172.114">   nsresult rv;</span>
<a href="#l172.115"></a><span id="l172.115">   nsCOMPtr &lt;nsIMsgFolder&gt; serverFolder;</span>
<a href="#l172.116"></a><span id="l172.116">   rv = GetRootMsgFolder(getter_AddRefs(serverFolder));</span>
<a href="#l172.117"></a><span id="l172.117">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l172.118"></a><span id="l172.118"> </span>
<a href="#l172.119"></a><span id="l172.119">   if (!serverFolder) return NS_ERROR_FAILURE;</span>
<a href="#l172.120"></a><span id="l172.120"> </span>
<a href="#l172.121"></a><span id="l172.121">   // Escape the name for using FindSubFolder</span>
<a href="#l172.122"></a><span id="l172.122" class="difflineminus">-  nsCAutoString escapedName;</span>
<a href="#l172.123"></a><span id="l172.123" class="difflineplus">+  nsAutoCString escapedName;</span>
<a href="#l172.124"></a><span id="l172.124">   rv = MsgEscapeString(name, nsINetUtil::ESCAPE_URL_PATH, escapedName);</span>
<a href="#l172.125"></a><span id="l172.125">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l172.126"></a><span id="l172.126"> </span>
<a href="#l172.127"></a><span id="l172.127">   nsCOMPtr &lt;nsIMsgFolder&gt; subFolder;</span>
<a href="#l172.128"></a><span id="l172.128">   rv = serverFolder-&gt;FindSubFolder(escapedName, getter_AddRefs(subFolder));</span>
<a href="#l172.129"></a><span id="l172.129">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l172.130"></a><span id="l172.130">   if (!subFolder) return NS_ERROR_FAILURE;</span>
<a href="#l172.131"></a><span id="l172.131"> </span>
<a href="#l172.132"></a><span id="l172.132" class="difflineat">@@ -1837,17 +1837,17 @@ nsNntpIncomingServer::GetCellText(int32_</span>
<a href="#l172.133"></a><span id="l172.133"> </span>
<a href="#l172.134"></a><span id="l172.134">     NS_ENSURE_ARG_POINTER(col);</span>
<a href="#l172.135"></a><span id="l172.135"> </span>
<a href="#l172.136"></a><span id="l172.136">     const PRUnichar* colID;</span>
<a href="#l172.137"></a><span id="l172.137">     col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l172.138"></a><span id="l172.138"> </span>
<a href="#l172.139"></a><span id="l172.139">     nsresult rv = NS_OK;</span>
<a href="#l172.140"></a><span id="l172.140">     if (colID[0] == 'n') {</span>
<a href="#l172.141"></a><span id="l172.141" class="difflineminus">-      nsCAutoString str;</span>
<a href="#l172.142"></a><span id="l172.142" class="difflineplus">+      nsAutoCString str;</span>
<a href="#l172.143"></a><span id="l172.143">       if (mSearchResultSortDescending)</span>
<a href="#l172.144"></a><span id="l172.144">         row = mSubscribeSearchResult.Length() - 1 - row;</span>
<a href="#l172.145"></a><span id="l172.145">       // some servers have newsgroup names that are non ASCII.  we store</span>
<a href="#l172.146"></a><span id="l172.146">       // those as escaped. unescape here so the UI is consistent</span>
<a href="#l172.147"></a><span id="l172.147">       rv = NS_MsgDecodeUnescapeURLPath(mSubscribeSearchResult.ElementAt(row), _retval);</span>
<a href="#l172.148"></a><span id="l172.148">     }</span>
<a href="#l172.149"></a><span id="l172.149">     return rv;</span>
<a href="#l172.150"></a><span id="l172.150"> }</span>
<a href="#l172.151"></a><span id="l172.151" class="difflineat">@@ -2103,17 +2103,17 @@ nsNntpIncomingServer::OnUserOrHostNameCh</span>
<a href="#l172.152"></a><span id="l172.152"> </span>
<a href="#l172.153"></a><span id="l172.153">   // If nothing subscribed then we're done.</span>
<a href="#l172.154"></a><span id="l172.154">   if (groupList.Length() == 0)</span>
<a href="#l172.155"></a><span id="l172.155">     return NS_OK;</span>
<a href="#l172.156"></a><span id="l172.156"> </span>
<a href="#l172.157"></a><span id="l172.157">   // Now unsubscribe &amp; subscribe.</span>
<a href="#l172.158"></a><span id="l172.158">   uint32_t i;</span>
<a href="#l172.159"></a><span id="l172.159">   uint32_t cnt = groupList.Length();</span>
<a href="#l172.160"></a><span id="l172.160" class="difflineminus">-  nsCAutoString cname;</span>
<a href="#l172.161"></a><span id="l172.161" class="difflineplus">+  nsAutoCString cname;</span>
<a href="#l172.162"></a><span id="l172.162">   for (i = 0; i &lt; cnt; i++)</span>
<a href="#l172.163"></a><span id="l172.163">   {</span>
<a href="#l172.164"></a><span id="l172.164">     // unsubscribe.</span>
<a href="#l172.165"></a><span id="l172.165">     rv = Unsubscribe(groupList[i].get());</span>
<a href="#l172.166"></a><span id="l172.166">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l172.167"></a><span id="l172.167">   }</span>
<a href="#l172.168"></a><span id="l172.168"> </span>
<a href="#l172.169"></a><span id="l172.169">   for (i = 0; i &lt; cnt; i++)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l173.1"></a><span id="l173.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l173.2"></a><span id="l173.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l173.3"></a><span id="l173.3" class="difflineat">@@ -177,17 +177,17 @@ nsNntpService::CreateMessageIDURL(nsIMsg</span>
<a href="#l173.4"></a><span id="l173.4">     nsCString rootFolderURI;</span>
<a href="#l173.5"></a><span id="l173.5">     rv = rootFolder-&gt;GetURI(rootFolderURI);</span>
<a href="#l173.6"></a><span id="l173.6">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.7"></a><span id="l173.7"> </span>
<a href="#l173.8"></a><span id="l173.8">     nsString groupName;</span>
<a href="#l173.9"></a><span id="l173.9">     rv = folder-&gt;GetName(groupName);</span>
<a href="#l173.10"></a><span id="l173.10">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.11"></a><span id="l173.11"> </span>
<a href="#l173.12"></a><span id="l173.12" class="difflineminus">-    nsCAutoString uri;</span>
<a href="#l173.13"></a><span id="l173.13" class="difflineplus">+    nsAutoCString uri;</span>
<a href="#l173.14"></a><span id="l173.14">     uri = rootFolderURI.get();</span>
<a href="#l173.15"></a><span id="l173.15">     uri += '/';</span>
<a href="#l173.16"></a><span id="l173.16">     uri += escapedMessageID;</span>
<a href="#l173.17"></a><span id="l173.17">     uri += kNewsURIGroupQuery; // ?group=</span>
<a href="#l173.18"></a><span id="l173.18">     AppendUTF16toUTF8(groupName, uri);</span>
<a href="#l173.19"></a><span id="l173.19">     uri += kNewsURIKeyQuery; // &amp;key=</span>
<a href="#l173.20"></a><span id="l173.20">     uri.AppendInt(key);</span>
<a href="#l173.21"></a><span id="l173.21">     *url = ToNewCString(uri);</span>
<a href="#l173.22"></a><span id="l173.22" class="difflineat">@@ -205,17 +205,17 @@ nsNntpService::DisplayMessage(const char</span>
<a href="#l173.23"></a><span id="l173.23">   nsresult rv = NS_OK;</span>
<a href="#l173.24"></a><span id="l173.24">   NS_ENSURE_ARG_POINTER(aMessageURI);</span>
<a href="#l173.25"></a><span id="l173.25"> </span>
<a href="#l173.26"></a><span id="l173.26">   nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l173.27"></a><span id="l173.27">   nsMsgKey key = nsMsgKey_None;</span>
<a href="#l173.28"></a><span id="l173.28">   rv = DecomposeNewsMessageURI(aMessageURI, getter_AddRefs(folder), &amp;key);</span>
<a href="#l173.29"></a><span id="l173.29">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.30"></a><span id="l173.30"> </span>
<a href="#l173.31"></a><span id="l173.31" class="difflineminus">-  nsCAutoString urlStr;</span>
<a href="#l173.32"></a><span id="l173.32" class="difflineplus">+  nsAutoCString urlStr;</span>
<a href="#l173.33"></a><span id="l173.33">   // if we are displaying (or printing), we want the news://host/message-id url</span>
<a href="#l173.34"></a><span id="l173.34">   // we keep the original uri around, for cancelling and so we can get to the</span>
<a href="#l173.35"></a><span id="l173.35">   // articles by doing GROUP and then ARTICLE &lt;n&gt;.</span>
<a href="#l173.36"></a><span id="l173.36">   //</span>
<a href="#l173.37"></a><span id="l173.37">   // using news://host/message-id has an extra benefit.</span>
<a href="#l173.38"></a><span id="l173.38">   // we'll use that to look up in the cache, so if</span>
<a href="#l173.39"></a><span id="l173.39">   // you are reading a message that you've already read, you</span>
<a href="#l173.40"></a><span id="l173.40">   // (from a cross post) it would be in your cache.</span>
<a href="#l173.41"></a><span id="l173.41" class="difflineat">@@ -402,17 +402,17 @@ NS_IMETHODIMP nsNntpService::FetchMimePa</span>
<a href="#l173.42"></a><span id="l173.42">     if (aUrlListener)</span>
<a href="#l173.43"></a><span id="l173.43">       msgUrl-&gt;RegisterListener(aUrlListener);</span>
<a href="#l173.44"></a><span id="l173.44"> </span>
<a href="#l173.45"></a><span id="l173.45">     nsCOMPtr&lt;nsIMsgMessageUrl&gt; msgMessageUrl = do_QueryInterface(aURI);</span>
<a href="#l173.46"></a><span id="l173.46"> // this code isn't ready yet, but it helps getting opening attachments</span>
<a href="#l173.47"></a><span id="l173.47"> // while offline working</span>
<a href="#l173.48"></a><span id="l173.48"> //    if (msgMessageUrl)</span>
<a href="#l173.49"></a><span id="l173.49"> //    {</span>
<a href="#l173.50"></a><span id="l173.50" class="difflineminus">-//      nsCAutoString spec;</span>
<a href="#l173.51"></a><span id="l173.51" class="difflineplus">+//      nsAutoCString spec;</span>
<a href="#l173.52"></a><span id="l173.52"> //      aURI-&gt;GetSpec(spec);</span>
<a href="#l173.53"></a><span id="l173.53"> //      msgMessageUrl-&gt;SetOriginalSpec(spec.get());</span>
<a href="#l173.54"></a><span id="l173.54"> //    }</span>
<a href="#l173.55"></a><span id="l173.55">   return RunNewsUrl(msgUrl, aMsgWindow, aDisplayConsumer);</span>
<a href="#l173.56"></a><span id="l173.56"> }</span>
<a href="#l173.57"></a><span id="l173.57"> </span>
<a href="#l173.58"></a><span id="l173.58"> NS_IMETHODIMP nsNntpService::OpenAttachment(const char *aContentType,</span>
<a href="#l173.59"></a><span id="l173.59">                                             const char *aFileName,</span>
<a href="#l173.60"></a><span id="l173.60" class="difflineat">@@ -422,17 +422,17 @@ NS_IMETHODIMP nsNntpService::OpenAttachm</span>
<a href="#l173.61"></a><span id="l173.61">                                             nsIMsgWindow *aMsgWindow,</span>
<a href="#l173.62"></a><span id="l173.62">                                             nsIUrlListener *aUrlListener)</span>
<a href="#l173.63"></a><span id="l173.63"> {</span>
<a href="#l173.64"></a><span id="l173.64">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l173.65"></a><span id="l173.65">   NS_ENSURE_ARG_POINTER(aFileName);</span>
<a href="#l173.66"></a><span id="l173.66"> </span>
<a href="#l173.67"></a><span id="l173.67">   nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l173.68"></a><span id="l173.68">   nsresult rv = NS_OK;</span>
<a href="#l173.69"></a><span id="l173.69" class="difflineminus">-  nsCAutoString newsUrl;</span>
<a href="#l173.70"></a><span id="l173.70" class="difflineplus">+  nsAutoCString newsUrl;</span>
<a href="#l173.71"></a><span id="l173.71">   newsUrl = aUrl;</span>
<a href="#l173.72"></a><span id="l173.72">   newsUrl += &quot;&amp;type=&quot;;</span>
<a href="#l173.73"></a><span id="l173.73">   newsUrl += aContentType;</span>
<a href="#l173.74"></a><span id="l173.74">   newsUrl += &quot;&amp;filename=&quot;;</span>
<a href="#l173.75"></a><span id="l173.75">   newsUrl += aFileName;</span>
<a href="#l173.76"></a><span id="l173.76"> </span>
<a href="#l173.77"></a><span id="l173.77">   NewURI(newsUrl, nullptr, nullptr, getter_AddRefs(url));</span>
<a href="#l173.78"></a><span id="l173.78"> </span>
<a href="#l173.79"></a><span id="l173.79" class="difflineat">@@ -528,17 +528,17 @@ nsNntpService::DecomposeNewsMessageURI(c</span>
<a href="#l173.80"></a><span id="l173.80">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_CreateInstance(NS_NNTPURL_CONTRACTID,&amp;rv);</span>
<a href="#l173.81"></a><span id="l173.81">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.82"></a><span id="l173.82">   nsCOMPtr&lt;nsINntpUrl&gt; nntpUrl = do_QueryInterface(mailnewsurl, &amp;rv);</span>
<a href="#l173.83"></a><span id="l173.83">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.84"></a><span id="l173.84">   rv = mailnewsurl-&gt;SetSpec(nsDependentCString(aMessageURI));</span>
<a href="#l173.85"></a><span id="l173.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.86"></a><span id="l173.86"> </span>
<a href="#l173.87"></a><span id="l173.87">   // Get the group name and key from the url</span>
<a href="#l173.88"></a><span id="l173.88" class="difflineminus">-  nsCAutoString groupName;</span>
<a href="#l173.89"></a><span id="l173.89" class="difflineplus">+  nsAutoCString groupName;</span>
<a href="#l173.90"></a><span id="l173.90">   rv = nntpUrl-&gt;GetGroup(groupName);</span>
<a href="#l173.91"></a><span id="l173.91">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.92"></a><span id="l173.92"> </span>
<a href="#l173.93"></a><span id="l173.93">   rv = nntpUrl-&gt;GetKey(aMsgKey);</span>
<a href="#l173.94"></a><span id="l173.94">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.95"></a><span id="l173.95"> </span>
<a href="#l173.96"></a><span id="l173.96">   // If there is no group, try the harder way.</span>
<a href="#l173.97"></a><span id="l173.97">   if (groupName.IsEmpty())</span>
<a href="#l173.98"></a><span id="l173.98" class="difflineat">@@ -555,17 +555,17 @@ nsNntpService::GetFolderFromUri(const ch</span>
<a href="#l173.99"></a><span id="l173.99"> {</span>
<a href="#l173.100"></a><span id="l173.100">   NS_ENSURE_ARG_POINTER(aUri);</span>
<a href="#l173.101"></a><span id="l173.101">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l173.102"></a><span id="l173.102"> </span>
<a href="#l173.103"></a><span id="l173.103">   nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l173.104"></a><span id="l173.104">   nsresult rv = NS_NewURI(getter_AddRefs(uri), nsDependentCString(aUri));</span>
<a href="#l173.105"></a><span id="l173.105">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.106"></a><span id="l173.106"> </span>
<a href="#l173.107"></a><span id="l173.107" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l173.108"></a><span id="l173.108" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l173.109"></a><span id="l173.109">   rv = uri-&gt;GetPath(path);</span>
<a href="#l173.110"></a><span id="l173.110">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.111"></a><span id="l173.111"> </span>
<a href="#l173.112"></a><span id="l173.112">   nsCOMPtr &lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l173.113"></a><span id="l173.113">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.114"></a><span id="l173.114"> </span>
<a href="#l173.115"></a><span id="l173.115">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l173.116"></a><span id="l173.116">   rv = accountManager-&gt;FindServerByURI(uri, false, getter_AddRefs(server));</span>
<a href="#l173.117"></a><span id="l173.117" class="difflineat">@@ -739,29 +739,29 @@ nsNntpService::GenerateNewsHeaderValsFor</span>
<a href="#l173.118"></a><span id="l173.118">   // news://host/group</span>
<a href="#l173.119"></a><span id="l173.119">   // news://group</span>
<a href="#l173.120"></a><span id="l173.120">   // host/group</span>
<a href="#l173.121"></a><span id="l173.121">   // group</span>
<a href="#l173.122"></a><span id="l173.122">   //</span>
<a href="#l173.123"></a><span id="l173.123">   // we are not going to allow the user to cross post to multiple hosts.</span>
<a href="#l173.124"></a><span id="l173.124">   // if we detect that, we stop and return error.</span>
<a href="#l173.125"></a><span id="l173.125"> </span>
<a href="#l173.126"></a><span id="l173.126" class="difflineminus">-  nsCAutoString host;</span>
<a href="#l173.127"></a><span id="l173.127" class="difflineminus">-  nsCAutoString str;</span>
<a href="#l173.128"></a><span id="l173.128" class="difflineminus">-  nsCAutoString newsgroups;</span>
<a href="#l173.129"></a><span id="l173.129" class="difflineplus">+  nsAutoCString host;</span>
<a href="#l173.130"></a><span id="l173.130" class="difflineplus">+  nsAutoCString str;</span>
<a href="#l173.131"></a><span id="l173.131" class="difflineplus">+  nsAutoCString newsgroups;</span>
<a href="#l173.132"></a><span id="l173.132"> </span>
<a href="#l173.133"></a><span id="l173.133">   nsTArray&lt;nsCString&gt; list;</span>
<a href="#l173.134"></a><span id="l173.134">   ParseString(newsgroupsList, ',', list);</span>
<a href="#l173.135"></a><span id="l173.135">   for (uint32_t index = 0; index &lt; list.Length(); index++)</span>
<a href="#l173.136"></a><span id="l173.136">   {</span>
<a href="#l173.137"></a><span id="l173.137">     list[index].StripWhitespace();</span>
<a href="#l173.138"></a><span id="l173.138">     if (!list[index].IsEmpty())</span>
<a href="#l173.139"></a><span id="l173.139">     {</span>
<a href="#l173.140"></a><span id="l173.140" class="difflineminus">-      nsCAutoString currentHost;</span>
<a href="#l173.141"></a><span id="l173.141" class="difflineminus">-      nsCAutoString theRest;</span>
<a href="#l173.142"></a><span id="l173.142" class="difflineplus">+      nsAutoCString currentHost;</span>
<a href="#l173.143"></a><span id="l173.143" class="difflineplus">+      nsAutoCString theRest;</span>
<a href="#l173.144"></a><span id="l173.144">       // does str start with &quot;news:/&quot;?</span>
<a href="#l173.145"></a><span id="l173.145">       if (StringBeginsWith(list[index], NS_LITERAL_CSTRING(kNewsRootURI)))</span>
<a href="#l173.146"></a><span id="l173.146">       {</span>
<a href="#l173.147"></a><span id="l173.147">         // we have news://group or news://host/group</span>
<a href="#l173.148"></a><span id="l173.148">         // set theRest to what's after news://</span>
<a href="#l173.149"></a><span id="l173.149">         theRest = Substring(list[index], kNewsRootURILen /* for news:/ */ + 1 /* for the slash */);</span>
<a href="#l173.150"></a><span id="l173.150">       }</span>
<a href="#l173.151"></a><span id="l173.151">       else if (list[index].Find(&quot;:/&quot;) != -1)</span>
<a href="#l173.152"></a><span id="l173.152" class="difflineat">@@ -771,17 +771,17 @@ nsNntpService::GenerateNewsHeaderValsFor</span>
<a href="#l173.153"></a><span id="l173.153">       }</span>
<a href="#l173.154"></a><span id="l173.154">       else</span>
<a href="#l173.155"></a><span id="l173.155">         theRest = list[index];</span>
<a href="#l173.156"></a><span id="l173.156"> </span>
<a href="#l173.157"></a><span id="l173.157">       // theRest is &quot;group&quot; or &quot;host/group&quot;</span>
<a href="#l173.158"></a><span id="l173.158">       int32_t slashpos = theRest.FindChar('/');</span>
<a href="#l173.159"></a><span id="l173.159">       if (slashpos &gt; 0 )</span>
<a href="#l173.160"></a><span id="l173.160">       {</span>
<a href="#l173.161"></a><span id="l173.161" class="difflineminus">-        nsCAutoString currentGroup;</span>
<a href="#l173.162"></a><span id="l173.162" class="difflineplus">+        nsAutoCString currentGroup;</span>
<a href="#l173.163"></a><span id="l173.163"> </span>
<a href="#l173.164"></a><span id="l173.164">         // theRest is &quot;host/group&quot;</span>
<a href="#l173.165"></a><span id="l173.165">         currentHost = StringHead(theRest, slashpos);</span>
<a href="#l173.166"></a><span id="l173.166"> </span>
<a href="#l173.167"></a><span id="l173.167">         // from &quot;host/group&quot;, put &quot;group&quot; into currentGroup;</span>
<a href="#l173.168"></a><span id="l173.168">         currentGroup = Substring(theRest, slashpos + 1);</span>
<a href="#l173.169"></a><span id="l173.169"> </span>
<a href="#l173.170"></a><span id="l173.170">         NS_ASSERTION(!currentGroup.IsEmpty(), &quot;currentGroup is empty&quot;);</span>
<a href="#l173.171"></a><span id="l173.171" class="difflineat">@@ -986,19 +986,19 @@ nsNntpService::CreateNewsAccount(const c</span>
<a href="#l173.172"></a><span id="l173.172">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l173.173"></a><span id="l173.173"> </span>
<a href="#l173.174"></a><span id="l173.174">   return NS_OK;</span>
<a href="#l173.175"></a><span id="l173.175"> }</span>
<a href="#l173.176"></a><span id="l173.176"> </span>
<a href="#l173.177"></a><span id="l173.177"> nsresult</span>
<a href="#l173.178"></a><span id="l173.178"> nsNntpService::GetServerForUri(nsIURI *aUri, nsINntpIncomingServer **aServer)</span>
<a href="#l173.179"></a><span id="l173.179"> {</span>
<a href="#l173.180"></a><span id="l173.180" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l173.181"></a><span id="l173.181" class="difflineminus">-  nsCAutoString scheme;</span>
<a href="#l173.182"></a><span id="l173.182" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l173.183"></a><span id="l173.183" class="difflineplus">+  nsAutoCString hostName;</span>
<a href="#l173.184"></a><span id="l173.184" class="difflineplus">+  nsAutoCString scheme;</span>
<a href="#l173.185"></a><span id="l173.185" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l173.186"></a><span id="l173.186">   int32_t port = 0;</span>
<a href="#l173.187"></a><span id="l173.187">   nsresult rv;</span>
<a href="#l173.188"></a><span id="l173.188"> </span>
<a href="#l173.189"></a><span id="l173.189">   rv = aUri-&gt;GetAsciiHost(hostName);</span>
<a href="#l173.190"></a><span id="l173.190">   rv = aUri-&gt;GetScheme(scheme);</span>
<a href="#l173.191"></a><span id="l173.191">   rv = aUri-&gt;GetPort(&amp;port);</span>
<a href="#l173.192"></a><span id="l173.192">   rv = aUri-&gt;GetPath(path);</span>
<a href="#l173.193"></a><span id="l173.193"> </span>
<a href="#l173.194"></a><span id="l173.194" class="difflineat">@@ -1047,17 +1047,17 @@ nsNntpService::GetServerForUri(nsIURI *a</span>
<a href="#l173.195"></a><span id="l173.195">   nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer;</span>
<a href="#l173.196"></a><span id="l173.196">   nntpServer = do_QueryInterface(server, &amp;rv);</span>
<a href="#l173.197"></a><span id="l173.197"> </span>
<a href="#l173.198"></a><span id="l173.198">   if (!nntpServer || NS_FAILED(rv))</span>
<a href="#l173.199"></a><span id="l173.199">     return rv;</span>
<a href="#l173.200"></a><span id="l173.200"> </span>
<a href="#l173.201"></a><span id="l173.201">   NS_IF_ADDREF(*aServer = nntpServer);</span>
<a href="#l173.202"></a><span id="l173.202"> </span>
<a href="#l173.203"></a><span id="l173.203" class="difflineminus">-  nsCAutoString spec;</span>
<a href="#l173.204"></a><span id="l173.204" class="difflineplus">+  nsAutoCString spec;</span>
<a href="#l173.205"></a><span id="l173.205">   rv = aUri-&gt;GetSpec(spec);</span>
<a href="#l173.206"></a><span id="l173.206">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.207"></a><span id="l173.207"> </span>
<a href="#l173.208"></a><span id="l173.208"> #if 0 // this not ready yet.</span>
<a href="#l173.209"></a><span id="l173.209">   nsNewsAction action = nsINntpUrl::ActionUnknown;</span>
<a href="#l173.210"></a><span id="l173.210">   nsCOMPtr &lt;nsINntpUrl&gt; nntpUrl = do_QueryInterface(aUri);</span>
<a href="#l173.211"></a><span id="l173.211">   if (nntpUrl) {</span>
<a href="#l173.212"></a><span id="l173.212">     rv = nntpUrl-&gt;GetNewsAction(&amp;action);</span>
<a href="#l173.213"></a><span id="l173.213" class="difflineat">@@ -1239,17 +1239,17 @@ NS_IMETHODIMP nsNntpService::NewURI(cons</span>
<a href="#l173.214"></a><span id="l173.214"> {</span>
<a href="#l173.215"></a><span id="l173.215">     nsresult rv;</span>
<a href="#l173.216"></a><span id="l173.216"> </span>
<a href="#l173.217"></a><span id="l173.217">     nsCOMPtr&lt;nsIURI&gt; nntpUri = do_CreateInstance(NS_NNTPURL_CONTRACTID, &amp;rv);</span>
<a href="#l173.218"></a><span id="l173.218">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.219"></a><span id="l173.219"> </span>
<a href="#l173.220"></a><span id="l173.220">     if (aBaseURI)</span>
<a href="#l173.221"></a><span id="l173.221">     {</span>
<a href="#l173.222"></a><span id="l173.222" class="difflineminus">-      nsCAutoString newSpec;</span>
<a href="#l173.223"></a><span id="l173.223" class="difflineplus">+      nsAutoCString newSpec;</span>
<a href="#l173.224"></a><span id="l173.224">       aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l173.225"></a><span id="l173.225">       rv = nntpUri-&gt;SetSpec(newSpec);</span>
<a href="#l173.226"></a><span id="l173.226">     }</span>
<a href="#l173.227"></a><span id="l173.227">     else</span>
<a href="#l173.228"></a><span id="l173.228">     {</span>
<a href="#l173.229"></a><span id="l173.229">       rv = nntpUri-&gt;SetSpec(aSpec);</span>
<a href="#l173.230"></a><span id="l173.230">     }</span>
<a href="#l173.231"></a><span id="l173.231">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l173.232"></a><span id="l173.232" class="difflineat">@@ -1399,31 +1399,31 @@ nsNntpService::StreamMessage(const char </span>
<a href="#l173.233"></a><span id="l173.233">                               bool /* convertData */,</span>
<a href="#l173.234"></a><span id="l173.234">                               const nsACString &amp;aAdditionalHeader,</span>
<a href="#l173.235"></a><span id="l173.235">                               bool aLocalOnly,</span>
<a href="#l173.236"></a><span id="l173.236">                               nsIURI **aURL)</span>
<a href="#l173.237"></a><span id="l173.237"> {</span>
<a href="#l173.238"></a><span id="l173.238">     // The nntp protocol object will look for &quot;header=filter&quot; to decide if it wants to convert</span>
<a href="#l173.239"></a><span id="l173.239">     // the data instead of using aConvertData. It turns out to be way too hard to pass aConvertData</span>
<a href="#l173.240"></a><span id="l173.240">     // all the way over to the nntp protocol object.</span>
<a href="#l173.241"></a><span id="l173.241" class="difflineminus">-    nsCAutoString aURIString(aMessageURI);</span>
<a href="#l173.242"></a><span id="l173.242" class="difflineplus">+    nsAutoCString aURIString(aMessageURI);</span>
<a href="#l173.243"></a><span id="l173.243"> </span>
<a href="#l173.244"></a><span id="l173.244">     if (!aAdditionalHeader.IsEmpty())</span>
<a href="#l173.245"></a><span id="l173.245">     {</span>
<a href="#l173.246"></a><span id="l173.246">       aURIString.FindChar('?') == kNotFound ? aURIString += &quot;?&quot; : aURIString += &quot;&amp;&quot;;</span>
<a href="#l173.247"></a><span id="l173.247">       aURIString += &quot;header=&quot;;</span>
<a href="#l173.248"></a><span id="l173.248">       aURIString += aAdditionalHeader;</span>
<a href="#l173.249"></a><span id="l173.249">     }</span>
<a href="#l173.250"></a><span id="l173.250"> </span>
<a href="#l173.251"></a><span id="l173.251">     nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l173.252"></a><span id="l173.252">     nsMsgKey key;</span>
<a href="#l173.253"></a><span id="l173.253">     nsresult rv = DecomposeNewsMessageURI(aMessageURI, getter_AddRefs(folder), &amp;key);</span>
<a href="#l173.254"></a><span id="l173.254">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.255"></a><span id="l173.255"> </span>
<a href="#l173.256"></a><span id="l173.256" class="difflineminus">-    nsCAutoString urlStr;</span>
<a href="#l173.257"></a><span id="l173.257" class="difflineplus">+    nsAutoCString urlStr;</span>
<a href="#l173.258"></a><span id="l173.258">     rv = CreateMessageIDURL(folder, key, getter_Copies(urlStr));</span>
<a href="#l173.259"></a><span id="l173.259">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.260"></a><span id="l173.260"> </span>
<a href="#l173.261"></a><span id="l173.261">     nsNewsAction action = nsINntpUrl::ActionFetchArticle;</span>
<a href="#l173.262"></a><span id="l173.262">     if (mOpenAttachmentOperation)</span>
<a href="#l173.263"></a><span id="l173.263">       action = nsINntpUrl::ActionFetchPart;</span>
<a href="#l173.264"></a><span id="l173.264"> </span>
<a href="#l173.265"></a><span id="l173.265">     nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l173.266"></a><span id="l173.266" class="difflineat">@@ -1490,17 +1490,17 @@ NS_IMETHODIMP nsNntpService::StreamHeade</span>
<a href="#l173.267"></a><span id="l173.267">   if (hasMsgOffline)</span>
<a href="#l173.268"></a><span id="l173.268">   {</span>
<a href="#l173.269"></a><span id="l173.269">     int64_t messageOffset;</span>
<a href="#l173.270"></a><span id="l173.270">     uint32_t messageSize;</span>
<a href="#l173.271"></a><span id="l173.271">     folder-&gt;GetOfflineFileStream(key, &amp;messageOffset, &amp;messageSize, getter_AddRefs(inputStream));</span>
<a href="#l173.272"></a><span id="l173.272">     if (inputStream)</span>
<a href="#l173.273"></a><span id="l173.273">       return MsgStreamMsgHeaders(inputStream, aConsumer);</span>
<a href="#l173.274"></a><span id="l173.274">   }</span>
<a href="#l173.275"></a><span id="l173.275" class="difflineminus">-  nsCAutoString urlStr;</span>
<a href="#l173.276"></a><span id="l173.276" class="difflineplus">+  nsAutoCString urlStr;</span>
<a href="#l173.277"></a><span id="l173.277">   rv = CreateMessageIDURL(folder, key, getter_Copies(urlStr));</span>
<a href="#l173.278"></a><span id="l173.278">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l173.279"></a><span id="l173.279"> </span>
<a href="#l173.280"></a><span id="l173.280">   nsNewsAction action = nsINntpUrl::ActionFetchArticle;</span>
<a href="#l173.281"></a><span id="l173.281"> </span>
<a href="#l173.282"></a><span id="l173.282">   nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l173.283"></a><span id="l173.283">   rv = ConstructNntpUrl(urlStr.get(), aUrlListener, nullptr, aMessageURI,</span>
<a href="#l173.284"></a><span id="l173.284">                         action, getter_AddRefs(url));</span>
<a href="#l173.285"></a><span id="l173.285" class="difflineat">@@ -1528,17 +1528,17 @@ NS_IMETHODIMP nsNntpService::IsMsgInMemC</span>
<a href="#l173.286"></a><span id="l173.286"> {</span>
<a href="#l173.287"></a><span id="l173.287">   NS_ENSURE_ARG_POINTER(aUrl);</span>
<a href="#l173.288"></a><span id="l173.288">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l173.289"></a><span id="l173.289">   *aResult = false;</span>
<a href="#l173.290"></a><span id="l173.290"> </span>
<a href="#l173.291"></a><span id="l173.291">   if (mCacheSession)</span>
<a href="#l173.292"></a><span id="l173.292">   {</span>
<a href="#l173.293"></a><span id="l173.293">     // check if message is in memory cache</span>
<a href="#l173.294"></a><span id="l173.294" class="difflineminus">-    nsCAutoString cacheKey;</span>
<a href="#l173.295"></a><span id="l173.295" class="difflineplus">+    nsAutoCString cacheKey;</span>
<a href="#l173.296"></a><span id="l173.296">     aUrl-&gt;GetAsciiSpec(cacheKey);</span>
<a href="#l173.297"></a><span id="l173.297">     // nntp urls are truncated at the query part when used as cache keys</span>
<a href="#l173.298"></a><span id="l173.298">     int32_t pos = cacheKey.FindChar('?');</span>
<a href="#l173.299"></a><span id="l173.299">     if (pos != -1)</span>
<a href="#l173.300"></a><span id="l173.300">       cacheKey.SetLength(pos);</span>
<a href="#l173.301"></a><span id="l173.301"> </span>
<a href="#l173.302"></a><span id="l173.302">     nsCOMPtr&lt;nsICacheEntryDescriptor&gt; cacheEntry;</span>
<a href="#l173.303"></a><span id="l173.303">     if (NS_SUCCEEDED(mCacheSession-&gt;OpenCacheEntry(cacheKey,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l174.1"></a><span id="l174.1" class="difflineminus">--- a/mailnews/news/src/nsNntpUrl.cpp</span>
<a href="#l174.2"></a><span id="l174.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpUrl.cpp</span>
<a href="#l174.3"></a><span id="l174.3" class="difflineat">@@ -92,58 +92,58 @@ NS_IMETHODIMP nsNntpUrl::SetSpec(const n</span>
<a href="#l174.4"></a><span id="l174.4">     parseSpec = Substring(aSpec, 0, colon + 1);</span>
<a href="#l174.5"></a><span id="l174.5">     parseSpec.AppendLiteral(&quot;///&quot;);</span>
<a href="#l174.6"></a><span id="l174.6">     parseSpec += Substring(aSpec, colon + 1);</span>
<a href="#l174.7"></a><span id="l174.7">   }</span>
<a href="#l174.8"></a><span id="l174.8"> </span>
<a href="#l174.9"></a><span id="l174.9">   nsresult rv = nsMsgMailNewsUrl::SetSpec(parseSpec);</span>
<a href="#l174.10"></a><span id="l174.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l174.11"></a><span id="l174.11"> </span>
<a href="#l174.12"></a><span id="l174.12" class="difflineminus">-  nsCAutoString scheme;</span>
<a href="#l174.13"></a><span id="l174.13" class="difflineplus">+  nsAutoCString scheme;</span>
<a href="#l174.14"></a><span id="l174.14">   rv = GetScheme(scheme);</span>
<a href="#l174.15"></a><span id="l174.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l174.16"></a><span id="l174.16"> </span>
<a href="#l174.17"></a><span id="l174.17">   if (scheme.EqualsLiteral(&quot;news&quot;) || scheme.EqualsLiteral(&quot;snews&quot;))</span>
<a href="#l174.18"></a><span id="l174.18">     rv = ParseNewsURL();</span>
<a href="#l174.19"></a><span id="l174.19">   else if (scheme.EqualsLiteral(&quot;nntp&quot;) || scheme.EqualsLiteral(&quot;nntps&quot;))</span>
<a href="#l174.20"></a><span id="l174.20">     rv = ParseNntpURL();</span>
<a href="#l174.21"></a><span id="l174.21">   else if (scheme.EqualsLiteral(&quot;news-message&quot;))</span>
<a href="#l174.22"></a><span id="l174.22">   {</span>
<a href="#l174.23"></a><span id="l174.23" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l174.24"></a><span id="l174.24" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l174.25"></a><span id="l174.25">     GetSpec(spec);</span>
<a href="#l174.26"></a><span id="l174.26">     rv = nsParseNewsMessageURI(spec.get(), m_group, &amp;m_key);</span>
<a href="#l174.27"></a><span id="l174.27">     NS_ENSURE_SUCCESS(rv, NS_ERROR_MALFORMED_URI);</span>
<a href="#l174.28"></a><span id="l174.28">   }</span>
<a href="#l174.29"></a><span id="l174.29">   else</span>
<a href="#l174.30"></a><span id="l174.30">     return NS_ERROR_MALFORMED_URI;</span>
<a href="#l174.31"></a><span id="l174.31">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l174.32"></a><span id="l174.32"> </span>
<a href="#l174.33"></a><span id="l174.33">   rv = DetermineNewsAction();</span>
<a href="#l174.34"></a><span id="l174.34">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l174.35"></a><span id="l174.35">   return rv;</span>
<a href="#l174.36"></a><span id="l174.36"> }</span>
<a href="#l174.37"></a><span id="l174.37"> </span>
<a href="#l174.38"></a><span id="l174.38"> nsresult nsNntpUrl::ParseNewsURL()</span>
<a href="#l174.39"></a><span id="l174.39"> {</span>
<a href="#l174.40"></a><span id="l174.40">   // The path here is the group/msgid portion</span>
<a href="#l174.41"></a><span id="l174.41" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l174.42"></a><span id="l174.42" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l174.43"></a><span id="l174.43">   nsresult rv = GetFilePath(path);</span>
<a href="#l174.44"></a><span id="l174.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l174.45"></a><span id="l174.45"> </span>
<a href="#l174.46"></a><span id="l174.46">   // Drop the potential beginning from the path</span>
<a href="#l174.47"></a><span id="l174.47">   if (path.Length() &amp;&amp; path[0] == '/')</span>
<a href="#l174.48"></a><span id="l174.48">     path = Substring(path, 1);</span>
<a href="#l174.49"></a><span id="l174.49"> </span>
<a href="#l174.50"></a><span id="l174.50">   // The presence of an `@' is a sign we have a msgid</span>
<a href="#l174.51"></a><span id="l174.51">   if (path.Find(&quot;@&quot;) != -1 || path.Find(&quot;%40&quot;) != -1)</span>
<a href="#l174.52"></a><span id="l174.52">   {</span>
<a href="#l174.53"></a><span id="l174.53">     MsgUnescapeString(path, 0, m_messageID);</span>
<a href="#l174.54"></a><span id="l174.54"> </span>
<a href="#l174.55"></a><span id="l174.55">     // Set group, key for ?group=foo&amp;key=123 uris</span>
<a href="#l174.56"></a><span id="l174.56" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l174.57"></a><span id="l174.57" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l174.58"></a><span id="l174.58">     GetSpec(spec);</span>
<a href="#l174.59"></a><span id="l174.59">     int32_t groupPos = spec.Find(kNewsURIGroupQuery); // find ?group=</span>
<a href="#l174.60"></a><span id="l174.60">     int32_t keyPos   = spec.Find(kNewsURIKeyQuery);   // find &amp;key=</span>
<a href="#l174.61"></a><span id="l174.61">     if (groupPos != kNotFound &amp;&amp; keyPos != kNotFound)</span>
<a href="#l174.62"></a><span id="l174.62">     {</span>
<a href="#l174.63"></a><span id="l174.63">       // get group name and message key</span>
<a href="#l174.64"></a><span id="l174.64">       m_group = Substring(spec, groupPos + kNewsURIGroupQueryLen,</span>
<a href="#l174.65"></a><span id="l174.65">                           keyPos - groupPos - kNewsURIGroupQueryLen);</span>
<a href="#l174.66"></a><span id="l174.66" class="difflineat">@@ -155,17 +155,17 @@ nsresult nsNntpUrl::ParseNewsURL()</span>
<a href="#l174.67"></a><span id="l174.67">   else</span>
<a href="#l174.68"></a><span id="l174.68">     MsgUnescapeString(path, 0, m_group);</span>
<a href="#l174.69"></a><span id="l174.69"> </span>
<a href="#l174.70"></a><span id="l174.70">   return NS_OK;</span>
<a href="#l174.71"></a><span id="l174.71"> }</span>
<a href="#l174.72"></a><span id="l174.72"> </span>
<a href="#l174.73"></a><span id="l174.73"> nsresult nsNntpUrl::ParseNntpURL()</span>
<a href="#l174.74"></a><span id="l174.74"> {</span>
<a href="#l174.75"></a><span id="l174.75" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l174.76"></a><span id="l174.76" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l174.77"></a><span id="l174.77">   nsresult rv = GetFilePath(path);</span>
<a href="#l174.78"></a><span id="l174.78">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l174.79"></a><span id="l174.79"> </span>
<a href="#l174.80"></a><span id="l174.80">   if (path.Length() &gt; 0 &amp;&amp; path[0] == '/')</span>
<a href="#l174.81"></a><span id="l174.81">     path = Substring(path, 1);</span>
<a href="#l174.82"></a><span id="l174.82"> </span>
<a href="#l174.83"></a><span id="l174.83">   if (path.IsEmpty())</span>
<a href="#l174.84"></a><span id="l174.84">     return NS_ERROR_MALFORMED_URI;</span>
<a href="#l174.85"></a><span id="l174.85" class="difflineat">@@ -174,36 +174,36 @@ nsresult nsNntpUrl::ParseNntpURL()</span>
<a href="#l174.86"></a><span id="l174.86">   if (slash == -1)</span>
<a href="#l174.87"></a><span id="l174.87">   {</span>
<a href="#l174.88"></a><span id="l174.88">     m_group = path;</span>
<a href="#l174.89"></a><span id="l174.89">     m_key = nsMsgKey_None;</span>
<a href="#l174.90"></a><span id="l174.90">   }</span>
<a href="#l174.91"></a><span id="l174.91">   else</span>
<a href="#l174.92"></a><span id="l174.92">   {</span>
<a href="#l174.93"></a><span id="l174.93">     m_group = Substring(path, 0, slash);</span>
<a href="#l174.94"></a><span id="l174.94" class="difflineminus">-    nsCAutoString keyStr;</span>
<a href="#l174.95"></a><span id="l174.95" class="difflineplus">+    nsAutoCString keyStr;</span>
<a href="#l174.96"></a><span id="l174.96">     keyStr = Substring(path, slash + 1);</span>
<a href="#l174.97"></a><span id="l174.97">     m_key = keyStr.ToInteger(&amp;rv, 10);</span>
<a href="#l174.98"></a><span id="l174.98">     NS_ENSURE_SUCCESS(rv, NS_ERROR_MALFORMED_URI);</span>
<a href="#l174.99"></a><span id="l174.99"> </span>
<a href="#l174.100"></a><span id="l174.100">     // Keys must be at least one</span>
<a href="#l174.101"></a><span id="l174.101">     if (m_key == 0)</span>
<a href="#l174.102"></a><span id="l174.102">       return NS_ERROR_MALFORMED_URI;</span>
<a href="#l174.103"></a><span id="l174.103">   }</span>
<a href="#l174.104"></a><span id="l174.104"> </span>
<a href="#l174.105"></a><span id="l174.105">   return NS_OK;</span>
<a href="#l174.106"></a><span id="l174.106"> }</span>
<a href="#l174.107"></a><span id="l174.107"> </span>
<a href="#l174.108"></a><span id="l174.108"> nsresult nsNntpUrl::DetermineNewsAction()</span>
<a href="#l174.109"></a><span id="l174.109"> {</span>
<a href="#l174.110"></a><span id="l174.110" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l174.111"></a><span id="l174.111" class="difflineplus">+  nsAutoCString path;</span>
<a href="#l174.112"></a><span id="l174.112">   nsresult rv = nsMsgMailNewsUrl::GetPath(path);</span>
<a href="#l174.113"></a><span id="l174.113">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l174.114"></a><span id="l174.114"> </span>
<a href="#l174.115"></a><span id="l174.115" class="difflineminus">-  nsCAutoString query;</span>
<a href="#l174.116"></a><span id="l174.116" class="difflineplus">+  nsAutoCString query;</span>
<a href="#l174.117"></a><span id="l174.117">   rv = GetQuery(query);</span>
<a href="#l174.118"></a><span id="l174.118">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l174.119"></a><span id="l174.119"> </span>
<a href="#l174.120"></a><span id="l174.120">   if (query.EqualsLiteral(&quot;cancel&quot;))</span>
<a href="#l174.121"></a><span id="l174.121">   {</span>
<a href="#l174.122"></a><span id="l174.122">     m_newsAction = nsINntpUrl::ActionCancelArticle;</span>
<a href="#l174.123"></a><span id="l174.123">     return NS_OK;</span>
<a href="#l174.124"></a><span id="l174.124">   }</span>
<a href="#l174.125"></a><span id="l174.125" class="difflineat">@@ -310,17 +310,17 @@ NS_IMETHODIMP nsNntpUrl::SetUri(const ch</span>
<a href="#l174.126"></a><span id="l174.126"> // from nsIMsgMessageUrl</span>
<a href="#l174.127"></a><span id="l174.127"> NS_IMETHODIMP nsNntpUrl::GetUri(char ** aURI)</span>
<a href="#l174.128"></a><span id="l174.128"> {</span>
<a href="#l174.129"></a><span id="l174.129">   nsresult rv = NS_OK;</span>
<a href="#l174.130"></a><span id="l174.130"> </span>
<a href="#l174.131"></a><span id="l174.131">   // if we have been given a uri to associate with this url, then use it</span>
<a href="#l174.132"></a><span id="l174.132">   // otherwise try to reconstruct a URI on the fly....</span>
<a href="#l174.133"></a><span id="l174.133">   if (mURI.IsEmpty()) {</span>
<a href="#l174.134"></a><span id="l174.134" class="difflineminus">-    nsCAutoString spec;</span>
<a href="#l174.135"></a><span id="l174.135" class="difflineplus">+    nsAutoCString spec;</span>
<a href="#l174.136"></a><span id="l174.136">     rv = GetSpec(spec);</span>
<a href="#l174.137"></a><span id="l174.137">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l174.138"></a><span id="l174.138">     mURI = spec;</span>
<a href="#l174.139"></a><span id="l174.139">   }</span>
<a href="#l174.140"></a><span id="l174.140"> </span>
<a href="#l174.141"></a><span id="l174.141">   *aURI = ToNewCString(mURI);</span>
<a href="#l174.142"></a><span id="l174.142">   if (!*aURI) return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l174.143"></a><span id="l174.143">   return rv;</span>
<a href="#l174.144"></a><span id="l174.144" class="difflineat">@@ -372,17 +372,17 @@ NS_IMETHODIMP nsNntpUrl::GetMessageHeade</span>
<a href="#l174.145"></a><span id="l174.145">   nsresult rv;</span>
<a href="#l174.146"></a><span id="l174.146"> </span>
<a href="#l174.147"></a><span id="l174.147">   nsCOMPtr &lt;nsINntpService&gt; nntpService = do_GetService(NS_NNTPSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l174.148"></a><span id="l174.148">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l174.149"></a><span id="l174.149"> </span>
<a href="#l174.150"></a><span id="l174.150">   nsCOMPtr &lt;nsIMsgMessageService&gt; msgService = do_QueryInterface(nntpService, &amp;rv);</span>
<a href="#l174.151"></a><span id="l174.151">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l174.152"></a><span id="l174.152"> </span>
<a href="#l174.153"></a><span id="l174.153" class="difflineminus">-  nsCAutoString spec(mOriginalSpec);</span>
<a href="#l174.154"></a><span id="l174.154" class="difflineplus">+  nsAutoCString spec(mOriginalSpec);</span>
<a href="#l174.155"></a><span id="l174.155">   if (spec.IsEmpty())</span>
<a href="#l174.156"></a><span id="l174.156">     // Handle the case where necko directly runs an internal news:// URL,</span>
<a href="#l174.157"></a><span id="l174.157">     // one that looks like news://host/message-id?group=mozilla.announce&amp;key=15</span>
<a href="#l174.158"></a><span id="l174.158">     // Other sorts of URLs -- e.g. news://host/message-id -- will not succeed.</span>
<a href="#l174.159"></a><span id="l174.159">     GetSpec(spec);</span>
<a href="#l174.160"></a><span id="l174.160"> </span>
<a href="#l174.161"></a><span id="l174.161">   return msgService-&gt;MessageURIToMsgHdr(spec.get(), aMsgHdr);</span>
<a href="#l174.162"></a><span id="l174.162"> }</span>
<a href="#l174.163"></a><span id="l174.163" class="difflineat">@@ -421,17 +421,17 @@ nsNntpUrl::SetOriginalSpec(const char *a</span>
<a href="#l174.164"></a><span id="l174.164"> }</span>
<a href="#l174.165"></a><span id="l174.165"> </span>
<a href="#l174.166"></a><span id="l174.166"> NS_IMETHODIMP</span>
<a href="#l174.167"></a><span id="l174.167"> nsNntpUrl::GetServer(nsIMsgIncomingServer **aServer)</span>
<a href="#l174.168"></a><span id="l174.168"> {</span>
<a href="#l174.169"></a><span id="l174.169">   NS_ENSURE_ARG_POINTER(aServer);</span>
<a href="#l174.170"></a><span id="l174.170">   </span>
<a href="#l174.171"></a><span id="l174.171">   nsresult rv;</span>
<a href="#l174.172"></a><span id="l174.172" class="difflineminus">-  nsCAutoString scheme, user, host;</span>
<a href="#l174.173"></a><span id="l174.173" class="difflineplus">+  nsAutoCString scheme, user, host;</span>
<a href="#l174.174"></a><span id="l174.174"> </span>
<a href="#l174.175"></a><span id="l174.175">   GetScheme(scheme);</span>
<a href="#l174.176"></a><span id="l174.176">   GetUsername(user);</span>
<a href="#l174.177"></a><span id="l174.177">   GetHost(host);</span>
<a href="#l174.178"></a><span id="l174.178"> </span>
<a href="#l174.179"></a><span id="l174.179">   // No authority -&gt; no server</span>
<a href="#l174.180"></a><span id="l174.180">   if (host.IsEmpty())</span>
<a href="#l174.181"></a><span id="l174.181">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l175.1"></a><span id="l175.1" class="difflineminus">--- a/suite/feeds/src/nsFeedSniffer.cpp</span>
<a href="#l175.2"></a><span id="l175.2" class="difflineplus">+++ b/suite/feeds/src/nsFeedSniffer.cpp</span>
<a href="#l175.3"></a><span id="l175.3" class="difflineat">@@ -48,17 +48,17 @@ nsFeedSniffer::ConvertEncodedData(nsIReq</span>
<a href="#l175.4"></a><span id="l175.4"> {</span>
<a href="#l175.5"></a><span id="l175.5">   nsresult rv = NS_OK;</span>
<a href="#l175.6"></a><span id="l175.6"> </span>
<a href="#l175.7"></a><span id="l175.7">  mDecodedData = &quot;&quot;;</span>
<a href="#l175.8"></a><span id="l175.8">  nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel(do_QueryInterface(request));</span>
<a href="#l175.9"></a><span id="l175.9">   if (!httpChannel)</span>
<a href="#l175.10"></a><span id="l175.10">     return NS_ERROR_NO_INTERFACE;</span>
<a href="#l175.11"></a><span id="l175.11"> </span>
<a href="#l175.12"></a><span id="l175.12" class="difflineminus">-  nsCAutoString contentEncoding;</span>
<a href="#l175.13"></a><span id="l175.13" class="difflineplus">+  nsAutoCString contentEncoding;</span>
<a href="#l175.14"></a><span id="l175.14">   httpChannel-&gt;GetResponseHeader(NS_LITERAL_CSTRING(&quot;Content-Encoding&quot;),</span>
<a href="#l175.15"></a><span id="l175.15">                                  contentEncoding);</span>
<a href="#l175.16"></a><span id="l175.16">   if (!contentEncoding.IsEmpty()) {</span>
<a href="#l175.17"></a><span id="l175.17">     nsCOMPtr&lt;nsIStreamConverterService&gt; converterService(do_GetService(NS_STREAMCONVERTERSERVICE_CONTRACTID));</span>
<a href="#l175.18"></a><span id="l175.18">     if (converterService) {</span>
<a href="#l175.19"></a><span id="l175.19">       ToLowerCase(contentEncoding);</span>
<a href="#l175.20"></a><span id="l175.20"> </span>
<a href="#l175.21"></a><span id="l175.21">       nsCOMPtr&lt;nsIStreamListener&gt; converter;</span>
<a href="#l175.22"></a><span id="l175.22" class="difflineat">@@ -194,54 +194,54 @@ nsFeedSniffer::GetMIMETypeFromContent(ns</span>
<a href="#l175.23"></a><span id="l175.23">                                       uint32_t length,</span>
<a href="#l175.24"></a><span id="l175.24">                                       nsACString&amp; sniffedType)</span>
<a href="#l175.25"></a><span id="l175.25"> {</span>
<a href="#l175.26"></a><span id="l175.26">   nsCOMPtr&lt;nsIHttpChannel&gt; channel(do_QueryInterface(request));</span>
<a href="#l175.27"></a><span id="l175.27">   if (!channel)</span>
<a href="#l175.28"></a><span id="l175.28">     return NS_ERROR_NO_INTERFACE;</span>
<a href="#l175.29"></a><span id="l175.29"> </span>
<a href="#l175.30"></a><span id="l175.30">   // Check that this is a GET request, since you can't subscribe to a POST...</span>
<a href="#l175.31"></a><span id="l175.31" class="difflineminus">-  nsCAutoString method;</span>
<a href="#l175.32"></a><span id="l175.32" class="difflineplus">+  nsAutoCString method;</span>
<a href="#l175.33"></a><span id="l175.33">   channel-&gt;GetRequestMethod(method);</span>
<a href="#l175.34"></a><span id="l175.34">   if (!method.Equals(&quot;GET&quot;)) {</span>
<a href="#l175.35"></a><span id="l175.35">     sniffedType.Truncate();</span>
<a href="#l175.36"></a><span id="l175.36">     return NS_OK;</span>
<a href="#l175.37"></a><span id="l175.37">   }</span>
<a href="#l175.38"></a><span id="l175.38"> </span>
<a href="#l175.39"></a><span id="l175.39">   // We need to find out if this is a load of a view-source document. In this</span>
<a href="#l175.40"></a><span id="l175.40">   // case we do not want to override the content type, since the source display</span>
<a href="#l175.41"></a><span id="l175.41">   // does not need to be converted from feed format to XUL. More importantly,</span>
<a href="#l175.42"></a><span id="l175.42">   // we don't want to change the content type from something</span>
<a href="#l175.43"></a><span id="l175.43">   // nsContentDLF::CreateInstance knows about (e.g. application/xml, text/html</span>
<a href="#l175.44"></a><span id="l175.44">   // etc) to something that only the application fe knows about (maybe.feed)</span>
<a href="#l175.45"></a><span id="l175.45">   // thus deactivating syntax highlighting.</span>
<a href="#l175.46"></a><span id="l175.46">   nsCOMPtr&lt;nsIURI&gt; originalURI;</span>
<a href="#l175.47"></a><span id="l175.47">   channel-&gt;GetOriginalURI(getter_AddRefs(originalURI));</span>
<a href="#l175.48"></a><span id="l175.48"> </span>
<a href="#l175.49"></a><span id="l175.49" class="difflineminus">-  nsCAutoString scheme;</span>
<a href="#l175.50"></a><span id="l175.50" class="difflineplus">+  nsAutoCString scheme;</span>
<a href="#l175.51"></a><span id="l175.51">   originalURI-&gt;GetScheme(scheme);</span>
<a href="#l175.52"></a><span id="l175.52">   if (scheme.EqualsLiteral(&quot;view-source&quot;)) {</span>
<a href="#l175.53"></a><span id="l175.53">     sniffedType.Truncate();</span>
<a href="#l175.54"></a><span id="l175.54">     return NS_OK;</span>
<a href="#l175.55"></a><span id="l175.55">   }</span>
<a href="#l175.56"></a><span id="l175.56"> </span>
<a href="#l175.57"></a><span id="l175.57">   // Check the Content-Type to see if it is set correctly. If it is set to</span>
<a href="#l175.58"></a><span id="l175.58">   // something specific that we think is a reliable indication of a feed, don't</span>
<a href="#l175.59"></a><span id="l175.59">   // bother sniffing since we assume the site maintainer knows what they're</span>
<a href="#l175.60"></a><span id="l175.60">   // doing.</span>
<a href="#l175.61"></a><span id="l175.61" class="difflineminus">-  nsCAutoString contentType;</span>
<a href="#l175.62"></a><span id="l175.62" class="difflineplus">+  nsAutoCString contentType;</span>
<a href="#l175.63"></a><span id="l175.63">   channel-&gt;GetContentType(contentType);</span>
<a href="#l175.64"></a><span id="l175.64">   bool noSniff = contentType.EqualsLiteral(TYPE_RSS) ||</span>
<a href="#l175.65"></a><span id="l175.65">                    contentType.EqualsLiteral(TYPE_ATOM);</span>
<a href="#l175.66"></a><span id="l175.66"> </span>
<a href="#l175.67"></a><span id="l175.67">   // Check to see if this was a feed request from the location bar or from</span>
<a href="#l175.68"></a><span id="l175.68">   // the feed: protocol. This is also a reliable indication.</span>
<a href="#l175.69"></a><span id="l175.69">   // The value of the header doesn't matter.</span>
<a href="#l175.70"></a><span id="l175.70">   if (!noSniff) {</span>
<a href="#l175.71"></a><span id="l175.71" class="difflineminus">-    nsCAutoString sniffHeader;</span>
<a href="#l175.72"></a><span id="l175.72" class="difflineplus">+    nsAutoCString sniffHeader;</span>
<a href="#l175.73"></a><span id="l175.73">     nsresult foundHeader =</span>
<a href="#l175.74"></a><span id="l175.74">       channel-&gt;GetRequestHeader(NS_LITERAL_CSTRING(&quot;X-Moz-Is-Feed&quot;),</span>
<a href="#l175.75"></a><span id="l175.75">                                 sniffHeader);</span>
<a href="#l175.76"></a><span id="l175.76">     noSniff = NS_SUCCEEDED(foundHeader);</span>
<a href="#l175.77"></a><span id="l175.77">   }</span>
<a href="#l175.78"></a><span id="l175.78"> </span>
<a href="#l175.79"></a><span id="l175.79">   if (noSniff) {</span>
<a href="#l175.80"></a><span id="l175.80">     // check for an attachment after we have a likely feed.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l176.1"></a><span id="l176.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l176.2"></a><span id="l176.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l176.3"></a><span id="l176.3" class="difflineat">@@ -332,22 +332,22 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l176.4"></a><span id="l176.4"> </span>
<a href="#l176.5"></a><span id="l176.5">   if (!profileFileExists)</span>
<a href="#l176.6"></a><span id="l176.6">     return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l176.7"></a><span id="l176.7"> </span>
<a href="#l176.8"></a><span id="l176.8">   nsINIParser parser;</span>
<a href="#l176.9"></a><span id="l176.9">   rv = parser.Init(profileIni);</span>
<a href="#l176.10"></a><span id="l176.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l176.11"></a><span id="l176.11"> </span>
<a href="#l176.12"></a><span id="l176.12" class="difflineminus">-  nsCAutoString buffer, filePath;</span>
<a href="#l176.13"></a><span id="l176.13" class="difflineplus">+  nsAutoCString buffer, filePath;</span>
<a href="#l176.14"></a><span id="l176.14">   bool isRelative;</span>
<a href="#l176.15"></a><span id="l176.15"> </span>
<a href="#l176.16"></a><span id="l176.16">   unsigned int c = 0;</span>
<a href="#l176.17"></a><span id="l176.17">   for (c = 0; true; ++c) {</span>
<a href="#l176.18"></a><span id="l176.18" class="difflineminus">-    nsCAutoString profileID(&quot;Profile&quot;);</span>
<a href="#l176.19"></a><span id="l176.19" class="difflineplus">+    nsAutoCString profileID(&quot;Profile&quot;);</span>
<a href="#l176.20"></a><span id="l176.20">     profileID.AppendInt(c);</span>
<a href="#l176.21"></a><span id="l176.21"> </span>
<a href="#l176.22"></a><span id="l176.22">     rv = parser.GetString(profileID.get(), &quot;IsRelative&quot;, buffer);</span>
<a href="#l176.23"></a><span id="l176.23">     if (NS_FAILED(rv))</span>
<a href="#l176.24"></a><span id="l176.24">       break;</span>
<a href="#l176.25"></a><span id="l176.25"> </span>
<a href="#l176.26"></a><span id="l176.26">     isRelative = buffer.EqualsLiteral(&quot;1&quot;);</span>
<a href="#l176.27"></a><span id="l176.27"> </span>
<a href="#l176.28"></a><span id="l176.28" class="difflineat">@@ -709,17 +709,17 @@ nsNetscapeProfileMigratorBase::GetSignon</span>
<a href="#l176.29"></a><span id="l176.29">     }</span>
<a href="#l176.30"></a><span id="l176.30">   }</span>
<a href="#l176.31"></a><span id="l176.31"> </span>
<a href="#l176.32"></a><span id="l176.32">   nsCOMPtr&lt;nsISimpleEnumerator&gt; entries;</span>
<a href="#l176.33"></a><span id="l176.33">   nsresult rv = mSourceProfile-&gt;GetDirectoryEntries(getter_AddRefs(entries));</span>
<a href="#l176.34"></a><span id="l176.34">   if (NS_FAILED(rv))</span>
<a href="#l176.35"></a><span id="l176.35">     return rv;</span>
<a href="#l176.36"></a><span id="l176.36"> </span>
<a href="#l176.37"></a><span id="l176.37" class="difflineminus">-  nsCAutoString fileName;</span>
<a href="#l176.38"></a><span id="l176.38" class="difflineplus">+  nsAutoCString fileName;</span>
<a href="#l176.39"></a><span id="l176.39">   while (1) {</span>
<a href="#l176.40"></a><span id="l176.40">     bool hasMore = false;</span>
<a href="#l176.41"></a><span id="l176.41">     rv = entries-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l176.42"></a><span id="l176.42">     if (NS_FAILED(rv) || !hasMore)</span>
<a href="#l176.43"></a><span id="l176.43">       break;</span>
<a href="#l176.44"></a><span id="l176.44"> </span>
<a href="#l176.45"></a><span id="l176.45">     nsCOMPtr&lt;nsISupports&gt; supp;</span>
<a href="#l176.46"></a><span id="l176.46">     rv = entries-&gt;GetNext(getter_AddRefs(supp));</span>
<a href="#l176.47"></a><span id="l176.47" class="difflineat">@@ -730,17 +730,17 @@ nsNetscapeProfileMigratorBase::GetSignon</span>
<a href="#l176.48"></a><span id="l176.48"> </span>
<a href="#l176.49"></a><span id="l176.49">     nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l176.50"></a><span id="l176.50">     rv = NS_NewFileURI(getter_AddRefs(uri), currFile);</span>
<a href="#l176.51"></a><span id="l176.51">     if (NS_FAILED(rv))</span>
<a href="#l176.52"></a><span id="l176.52">       break;</span>
<a href="#l176.53"></a><span id="l176.53"> </span>
<a href="#l176.54"></a><span id="l176.54">     nsCOMPtr&lt;nsIURL&gt; url(do_QueryInterface(uri));</span>
<a href="#l176.55"></a><span id="l176.55"> </span>
<a href="#l176.56"></a><span id="l176.56" class="difflineminus">-    nsCAutoString extn;</span>
<a href="#l176.57"></a><span id="l176.57" class="difflineplus">+    nsAutoCString extn;</span>
<a href="#l176.58"></a><span id="l176.58">     url-&gt;GetFileExtension(extn);</span>
<a href="#l176.59"></a><span id="l176.59"> </span>
<a href="#l176.60"></a><span id="l176.60">     if (extn.Equals(&quot;s&quot;, CaseInsensitiveCompare)) {</span>
<a href="#l176.61"></a><span id="l176.61">       url-&gt;GetFileName(fileName);</span>
<a href="#l176.62"></a><span id="l176.62">       break;</span>
<a href="#l176.63"></a><span id="l176.63">     }</span>
<a href="#l176.64"></a><span id="l176.64">   };</span>
<a href="#l176.65"></a><span id="l176.65"> </span>
<a href="#l176.66"></a><span id="l176.66" class="difflineat">@@ -859,17 +859,17 @@ nsNetscapeProfileMigratorBase::CopySigna</span>
<a href="#l176.67"></a><span id="l176.67">       {</span>
<a href="#l176.68"></a><span id="l176.68">         nsAutoString leafName;</span>
<a href="#l176.69"></a><span id="l176.69">         srcSigFile-&gt;GetLeafName(leafName);</span>
<a href="#l176.70"></a><span id="l176.70">         // will fail if we've already copied a sig file here</span>
<a href="#l176.71"></a><span id="l176.71">         srcSigFile-&gt;CopyTo(targetSigFile, leafName);</span>
<a href="#l176.72"></a><span id="l176.72">         targetSigFile-&gt;Append(leafName);</span>
<a href="#l176.73"></a><span id="l176.73"> </span>
<a href="#l176.74"></a><span id="l176.74">         // now write out the new descriptor</span>
<a href="#l176.75"></a><span id="l176.75" class="difflineminus">-        nsCAutoString descriptorString;</span>
<a href="#l176.76"></a><span id="l176.76" class="difflineplus">+        nsAutoCString descriptorString;</span>
<a href="#l176.77"></a><span id="l176.77">         targetSigFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l176.78"></a><span id="l176.78">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l176.79"></a><span id="l176.79">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l176.80"></a><span id="l176.80">       }</span>
<a href="#l176.81"></a><span id="l176.81">     }</span>
<a href="#l176.82"></a><span id="l176.82">   }</span>
<a href="#l176.83"></a><span id="l176.83">   return NS_OK;</span>
<a href="#l176.84"></a><span id="l176.84"> }</span>
<a href="#l176.85"></a><span id="l176.85" class="difflineat">@@ -946,17 +946,17 @@ nsNetscapeProfileMigratorBase::CopyMailF</span>
<a href="#l176.86"></a><span id="l176.86">         // migrate the accounts into is unique. This protects against the</span>
<a href="#l176.87"></a><span id="l176.87">         // case where the user has multiple servers with the same host name.</span>
<a href="#l176.88"></a><span id="l176.88">         targetMailFolder-&gt;CreateUnique(nsIFile::DIRECTORY_TYPE, 0777);</span>
<a href="#l176.89"></a><span id="l176.89"> </span>
<a href="#l176.90"></a><span id="l176.90">         RecursiveCopy(sourceMailFolder, targetMailFolder);</span>
<a href="#l176.91"></a><span id="l176.91">         // now we want to make sure the actual directory pref that gets</span>
<a href="#l176.92"></a><span id="l176.92">         // transformed into the new profile's pref.js has the right file</span>
<a href="#l176.93"></a><span id="l176.93">         // location.</span>
<a href="#l176.94"></a><span id="l176.94" class="difflineminus">-        nsCAutoString descriptorString;</span>
<a href="#l176.95"></a><span id="l176.95" class="difflineplus">+        nsAutoCString descriptorString;</span>
<a href="#l176.96"></a><span id="l176.96">         targetMailFolder-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l176.97"></a><span id="l176.97">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l176.98"></a><span id="l176.98">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l176.99"></a><span id="l176.99">       }</span>
<a href="#l176.100"></a><span id="l176.100">     }</span>
<a href="#l176.101"></a><span id="l176.101">     else if (StringEndsWith(prefName, NS_LITERAL_CSTRING(&quot;.newsrc.file&quot;))) {</span>
<a href="#l176.102"></a><span id="l176.102">       // copy the news RC file into \News. this won't work if the user has</span>
<a href="#l176.103"></a><span id="l176.103">       // different newsrc files for each account I don't know what to do in</span>
<a href="#l176.104"></a><span id="l176.104" class="difflineat">@@ -977,17 +977,17 @@ nsNetscapeProfileMigratorBase::CopyMailF</span>
<a href="#l176.105"></a><span id="l176.105">       if (exists) {</span>
<a href="#l176.106"></a><span id="l176.106">         nsAutoString leafName;</span>
<a href="#l176.107"></a><span id="l176.107">         srcNewsRCFile-&gt;GetLeafName(leafName);</span>
<a href="#l176.108"></a><span id="l176.108">         // will fail if we've already copied a newsrc file here</span>
<a href="#l176.109"></a><span id="l176.109">         srcNewsRCFile-&gt;CopyTo(targetNewsRCFile,leafName);</span>
<a href="#l176.110"></a><span id="l176.110">         targetNewsRCFile-&gt;Append(leafName);</span>
<a href="#l176.111"></a><span id="l176.111"> </span>
<a href="#l176.112"></a><span id="l176.112">         // now write out the new descriptor</span>
<a href="#l176.113"></a><span id="l176.113" class="difflineminus">-        nsCAutoString descriptorString;</span>
<a href="#l176.114"></a><span id="l176.114" class="difflineplus">+        nsAutoCString descriptorString;</span>
<a href="#l176.115"></a><span id="l176.115">         targetNewsRCFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l176.116"></a><span id="l176.116">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l176.117"></a><span id="l176.117">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l176.118"></a><span id="l176.118">       }</span>
<a href="#l176.119"></a><span id="l176.119">     }</span>
<a href="#l176.120"></a><span id="l176.120">   }</span>
<a href="#l176.121"></a><span id="l176.121"> </span>
<a href="#l176.122"></a><span id="l176.122">   // Remove all .directory-rel prefs as those might have changed; MailNews</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l177.1"></a><span id="l177.1" class="difflineminus">--- a/suite/profile/migration/src/nsProfileMigrator.cpp</span>
<a href="#l177.2"></a><span id="l177.2" class="difflineplus">+++ b/suite/profile/migration/src/nsProfileMigrator.cpp</span>
<a href="#l177.3"></a><span id="l177.3" class="difflineat">@@ -29,17 +29,17 @@</span>
<a href="#l177.4"></a><span id="l177.4"> // nsIProfileMigrator</span>
<a href="#l177.5"></a><span id="l177.5"> </span>
<a href="#l177.6"></a><span id="l177.6"> #define MIGRATION_WIZARD_FE_URL &quot;chrome://communicator/content/migration/migration.xul&quot;</span>
<a href="#l177.7"></a><span id="l177.7"> #define MIGRATION_WIZARD_FE_FEATURES &quot;chrome,dialog,modal,centerscreen,titlebar&quot;</span>
<a href="#l177.8"></a><span id="l177.8"> </span>
<a href="#l177.9"></a><span id="l177.9"> NS_IMETHODIMP</span>
<a href="#l177.10"></a><span id="l177.10"> nsProfileMigrator::Migrate(nsIProfileStartup* aStartup, const nsACString&amp; aKey)</span>
<a href="#l177.11"></a><span id="l177.11"> {</span>
<a href="#l177.12"></a><span id="l177.12" class="difflineminus">-  nsCAutoString key;</span>
<a href="#l177.13"></a><span id="l177.13" class="difflineplus">+  nsAutoCString key;</span>
<a href="#l177.14"></a><span id="l177.14">   nsCOMPtr&lt;nsISuiteProfileMigrator&gt; spm;</span>
<a href="#l177.15"></a><span id="l177.15"> </span>
<a href="#l177.16"></a><span id="l177.16">   // Get the migration key/profile to use as default. If it returns failure,</span>
<a href="#l177.17"></a><span id="l177.17">   // we haven't got any profiles avaiable to us, so just return and let the</span>
<a href="#l177.18"></a><span id="l177.18">   // app start.</span>
<a href="#l177.19"></a><span id="l177.19">   nsresult rv = GetSuiteMigratorKey(key, getter_AddRefs(spm));</span>
<a href="#l177.20"></a><span id="l177.20">   if (NS_FAILED(rv))</span>
<a href="#l177.21"></a><span id="l177.21">     return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l178.1"></a><span id="l178.1" class="difflineminus">--- a/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l178.2"></a><span id="l178.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l178.3"></a><span id="l178.3" class="difflineat">@@ -32,17 +32,17 @@ void SetUnicharPref(const char* aPref, c</span>
<a href="#l178.4"></a><span id="l178.4">                              supportsString);</span>
<a href="#l178.5"></a><span id="l178.5">   }</span>
<a href="#l178.6"></a><span id="l178.6"> }</span>
<a href="#l178.7"></a><span id="l178.7"> </span>
<a href="#l178.8"></a><span id="l178.8"> void SetProxyPref(const nsAString&amp; aHostPort, const char* aPref,</span>
<a href="#l178.9"></a><span id="l178.9">                   const char* aPortPref, nsIPrefBranch* aPrefs)</span>
<a href="#l178.10"></a><span id="l178.10"> {</span>
<a href="#l178.11"></a><span id="l178.11">   nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l178.12"></a><span id="l178.12" class="difflineminus">-  nsCAutoString host;</span>
<a href="#l178.13"></a><span id="l178.13" class="difflineplus">+  nsAutoCString host;</span>
<a href="#l178.14"></a><span id="l178.14">   int32_t portValue;</span>
<a href="#l178.15"></a><span id="l178.15"> </span>
<a href="#l178.16"></a><span id="l178.16">   // try parsing it as a URI first</span>
<a href="#l178.17"></a><span id="l178.17">   if (NS_SUCCEEDED(NS_NewURI(getter_AddRefs(uri), aHostPort)) &amp;&amp;</span>
<a href="#l178.18"></a><span id="l178.18">       NS_SUCCEEDED(uri-&gt;GetHost(host)) &amp;&amp;</span>
<a href="#l178.19"></a><span id="l178.19">       !host.IsEmpty() &amp;&amp;</span>
<a href="#l178.20"></a><span id="l178.20">       NS_SUCCEEDED(uri-&gt;GetPort(&amp;portValue))) {</span>
<a href="#l178.21"></a><span id="l178.21">     SetUnicharPref(aPref, NS_ConvertUTF8toUTF16(host), aPrefs);</span>
<a href="#l178.22"></a><span id="l178.22" class="difflineat">@@ -141,18 +141,18 @@ AnnotatePersonalToolbarFolder(nsIFile* a</span>
<a href="#l178.23"></a><span id="l178.23">   rv = NS_NewLocalFileOutputStream(getter_AddRefs(outputStream),</span>
<a href="#l178.24"></a><span id="l178.24">                                    aTargetBookmarksFile);</span>
<a href="#l178.25"></a><span id="l178.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l178.26"></a><span id="l178.26"> </span>
<a href="#l178.27"></a><span id="l178.27">   nsCOMPtr&lt;nsILineInputStream&gt; lineInputStream =</span>
<a href="#l178.28"></a><span id="l178.28">     do_QueryInterface(fileInputStream, &amp;rv);</span>
<a href="#l178.29"></a><span id="l178.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l178.30"></a><span id="l178.30"> </span>
<a href="#l178.31"></a><span id="l178.31" class="difflineminus">-  nsCAutoString sourceBuffer;</span>
<a href="#l178.32"></a><span id="l178.32" class="difflineminus">-  nsCAutoString targetBuffer;</span>
<a href="#l178.33"></a><span id="l178.33" class="difflineplus">+  nsAutoCString sourceBuffer;</span>
<a href="#l178.34"></a><span id="l178.34" class="difflineplus">+  nsAutoCString targetBuffer;</span>
<a href="#l178.35"></a><span id="l178.35">   bool moreData = false;</span>
<a href="#l178.36"></a><span id="l178.36">   uint32_t bytesWritten = 0;</span>
<a href="#l178.37"></a><span id="l178.37">   do {</span>
<a href="#l178.38"></a><span id="l178.38">     lineInputStream-&gt;ReadLine(sourceBuffer, &amp;moreData);</span>
<a href="#l178.39"></a><span id="l178.39">     if (!moreData)</span>
<a href="#l178.40"></a><span id="l178.40">       break;</span>
<a href="#l178.41"></a><span id="l178.41"> </span>
<a href="#l178.42"></a><span id="l178.42">     int32_t nameOffset = sourceBuffer.Find(aToolbarFolderName);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

