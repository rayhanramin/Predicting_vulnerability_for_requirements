<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 2761:81998e37543abff75a46152b22b8a2be76f399e0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 81998e37543abff75a46152b22b8a2be76f399e0" />
<meta property="og:url" content="/comm-central/rev/81998e37543abff75a46152b22b8a2be76f399e0" />
<meta property="og:description" content="Bug 454829 - &quot;summary page for collapsed threads and multiple selections&quot; [r+sr=david.ascher]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 81998e37543abff75a46152b22b8a2be76f399e0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/81998e37543abff75a46152b22b8a2be76f399e0">shortlog</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/81998e37543abff75a46152b22b8a2be76f399e0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0">files</a> |
changeset |
<a href="/comm-central/raw-rev/81998e37543abff75a46152b22b8a2be76f399e0">raw</a>  | <a href="/comm-central/archive/81998e37543abff75a46152b22b8a2be76f399e0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=454829">Bug 454829</a> - &quot;summary page for collapsed threads and multiple selections&quot; [r+sr=david.ascher]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#65;&#115;&#99;&#104;&#101;&#114;&#32;&#60;&#100;&#97;&#118;&#105;&#100;&#46;&#97;&#115;&#99;&#104;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 03 Jun 2009 21:55:27 +0100</td></tr>

<tr>
 <td>changeset 2761</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/81998e37543abff75a46152b22b8a2be76f399e0">81998e37543abff75a46152b22b8a2be76f399e0</a></td>
</tr>



<tr>
<td>parent 2760</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cef628a0149d2b61a8252e5c63952e4d972a7d37">cef628a0149d2b61a8252e5c63952e4d972a7d37</a>
</td>
</tr>

<tr>
<td>child 2762</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/dda9efe767998d07641828848b6eba54d385bb2a">dda9efe767998d07641828848b6eba54d385bb2a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=81998e37543abff75a46152b22b8a2be76f399e0">2239</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 03 Jun 2009 20:56:06 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@81998e37543a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=81998e37543abff75a46152b22b8a2be76f399e0">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=81998e37543abff75a46152b22b8a2be76f399e0&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81998e37543abff75a46152b22b8a2be76f399e0&newProject=comm-central&newRevision=81998e37543abff75a46152b22b8a2be76f399e0&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81998e37543abff75a46152b22b8a2be76f399e0&newProject=comm-central&newRevision=81998e37543abff75a46152b22b8a2be76f399e0&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81998e37543abff75a46152b22b8a2be76f399e0&newProject=comm-central&newRevision=81998e37543abff75a46152b22b8a2be76f399e0&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=454829">454829</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=454829">Bug 454829</a> - &quot;summary page for collapsed threads and multiple selections&quot; [r+sr=david.ascher]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.css">mail/base/content/multimessageview.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.css">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.css">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.css">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.css">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.xhtml">mail/base/content/multimessageview.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.xhtml">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.xhtml">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.xhtml">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.xhtml">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/multimessageview.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/selectionsummaries.js">mail/base/content/selectionsummaries.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/selectionsummaries.js">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/selectionsummaries.js">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/selectionsummaries.js">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/selectionsummaries.js">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/selectionsummaries.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/sharedsummary.css">mail/base/content/sharedsummary.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/sharedsummary.css">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/sharedsummary.css">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/sharedsummary.css">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/sharedsummary.css">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/content/sharedsummary.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/locales/en-US/chrome/messenger/multimessageview.properties">mail/locales/en-US/chrome/messenger/multimessageview.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mail/locales/en-US/chrome/messenger/multimessageview.properties">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mail/locales/en-US/chrome/messenger/multimessageview.properties">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mail/locales/en-US/chrome/messenger/multimessageview.properties">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mail/locales/en-US/chrome/messenger/multimessageview.properties">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mail/locales/en-US/chrome/messenger/multimessageview.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/connotent.js">mailnews/db/gloda/modules/connotent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/connotent.js">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/connotent.js">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/connotent.js">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/connotent.js">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/connotent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/fundattr.js">mailnews/db/gloda/modules/fundattr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/fundattr.js">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/fundattr.js">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/fundattr.js">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/fundattr.js">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/fundattr.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/gloda.js">mailnews/db/gloda/modules/gloda.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/gloda.js">file</a> |
<a href="/comm-central/annotate/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/gloda.js">annotate</a> |
<a href="/comm-central/diff/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/gloda.js">diff</a> |
<a href="/comm-central/comparison/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/gloda.js">comparison</a> |
<a href="/comm-central/log/81998e37543abff75a46152b22b8a2be76f399e0/mailnews/db/gloda/modules/gloda.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/multimessageview.css</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/multimessageview.css</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,301 +1,207 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* Generic (cross-platform) multimessage view CSS.  Some bits will be overriden</span>
<a href="#l1.5"></a><span id="l1.5">   by theme specific files */</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-body {</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-  font-family: sans-serif;</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineminus">-  margin: 0px;</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-  padding: 1ex 1em;</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+@import url(&quot;chrome://messenger/content/sharedsummary.css&quot;);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+#headingwrapper {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+  background-color: #729fcf;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+  position: relative;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+}</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+#headingwrappertable {</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+  position: fixed;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+  top: 0;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+  left: 0;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+  right: 0;</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+}</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+.heading {</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+  font-weight: bold;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+  font-size: medium;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+  margin: 0.5em;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+  border: 1px solid transparent;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+  padding-right: 1em;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+}</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+.header {</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+  margin-left: 19px;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+  padding: 0.3ex 0px;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+}</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+#heading {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+  font-size: large;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+  color: #fff;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+  padding-top: 0.5em;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+  padding-bottom: 0.5em;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+  padding-left: 0.5em;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+  padding-right: 0.5em;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+  margin: 0;</span>
<a href="#l1.48"></a><span id="l1.48"> }</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50"> .star {</span>
<a href="#l1.51"></a><span id="l1.51">   width: 16px;</span>
<a href="#l1.52"></a><span id="l1.52">   height: 16px;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+  position: absolute;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+  left: -4px;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+  top: 6px;</span>
<a href="#l1.56"></a><span id="l1.56">   display: inline-block;</span>
<a href="#l1.57"></a><span id="l1.57">   margin-left: 1ex;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-}</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-#markButton {</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-  width: 5em;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+  margin-right: 1ex;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+  background-repeat: no-repeat;</span>
<a href="#l1.64"></a><span id="l1.64"> }</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-#multimessageview {</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-  font-size: small;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-}</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-#messages {</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-  -moz-border-radius: 0.4ex;</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-  border: 1px solid ThreeDShadow;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+#content {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+  position: absolute;</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+  top: 4em;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+  right: 0;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+  left: 0;</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+  padding: 1em;</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+  z-index: -1;</span>
<a href="#l1.80"></a><span id="l1.80">   padding: 1ex 1em;</span>
<a href="#l1.81"></a><span id="l1.81">   margin: 0px;</span>
<a href="#l1.82"></a><span id="l1.82">   font-size: small;</span>
<a href="#l1.83"></a><span id="l1.83"> }</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-#messagelist {</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-  width: 100%;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-  display: table;</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+.row {</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+  position: relative;</span>
<a href="#l1.90"></a><span id="l1.90"> }</span>
<a href="#l1.91"></a><span id="l1.91"> </span>
<a href="#l1.92"></a><span id="l1.92"> .message {</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">-  display: table-row;</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+  margin-bottom: 1ex;</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+  border-left: 3px solid transparent;</span>
<a href="#l1.96"></a><span id="l1.96"> }</span>
<a href="#l1.97"></a><span id="l1.97"> </span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-.message &gt; .header {</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-  display: table-cell;</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-  padding: 0.6ex 0px;</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+.thread {</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+  -moz-border-radius: 4px;</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+  border: 2px solid lightgrey; </span>
<a href="#l1.104"></a><span id="l1.104"> }</span>
<a href="#l1.105"></a><span id="l1.105"> </span>
<a href="#l1.106"></a><span id="l1.106"> .subject {</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineminus">-  display: inline-block;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+  display: inline;</span>
<a href="#l1.109"></a><span id="l1.109"> }</span>
<a href="#l1.110"></a><span id="l1.110"> </span>
<a href="#l1.111"></a><span id="l1.111"> .sender {</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-  display: inline-block;</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+  display: inline;</span>
<a href="#l1.114"></a><span id="l1.114"> }</span>
<a href="#l1.115"></a><span id="l1.115"> </span>
<a href="#l1.116"></a><span id="l1.116"> .author {</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-  display: inline;</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-  color: grey;</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+  float: right;</span>
<a href="#l1.120"></a><span id="l1.120"> }</span>
<a href="#l1.121"></a><span id="l1.121"> </span>
<a href="#l1.122"></a><span id="l1.122" class="difflineminus">-.count, .date {</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineminus">-  display: table-cell;</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+.count {</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+  display: inline;</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+  white-space: nowrap;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+  color: InactiveCaptionText;</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+}</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+.date {</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+  float: right;</span>
<a href="#l1.132"></a><span id="l1.132">   padding: 0px 1em;</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-  white-space: nowrap;</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-  text-align: right;</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-  color: InactiveCaptionText;</span>
<a href="#l1.136"></a><span id="l1.136"> }</span>
<a href="#l1.137"></a><span id="l1.137"> </span>
<a href="#l1.138"></a><span id="l1.138"> .wrappedsender, .wrappedsubject {</span>
<a href="#l1.139"></a><span id="l1.139">   padding-right: 18px;</span>
<a href="#l1.140"></a><span id="l1.140">   padding-top: 6px;</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  padding-bottom: 6px;</span>
<a href="#l1.142"></a><span id="l1.142"> }</span>
<a href="#l1.143"></a><span id="l1.143"> </span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-.message.unread &gt; .header &gt; .wrappedsubject &gt; .subject,</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-.unread  .subject_and_author,</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-.message.unread &gt; .header &gt; .wrappedsender &gt; .sender  {</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+.message.unread .subject,</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+.message.unread .sender  {</span>
<a href="#l1.149"></a><span id="l1.149">   font-weight: bold;</span>
<a href="#l1.150"></a><span id="l1.150"> }</span>
<a href="#l1.151"></a><span id="l1.151"> </span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-.message &gt; .header &gt; .wrappedsender &gt; .sender:hover,</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-.message &gt; .header &gt; .wrappedsubject &gt; .subject:hover {</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-  text-decoration: underline;</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-  cursor: pointer;</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+.snippet {</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+  color: GrayText;</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+  padding-right: 1.5em;</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+  padding-bottom: 1ex;</span>
<a href="#l1.160"></a><span id="l1.160"> }</span>
<a href="#l1.161"></a><span id="l1.161"> </span>
<a href="#l1.162"></a><span id="l1.162" class="difflineminus">-.message &gt; .header &gt; .snippet, .message .tags {</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-  margin-left: 2em;</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineminus">-}</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineminus">-.message &gt; .header &gt; .snippet {</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-  color: GrayText;</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineminus">-}</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineminus">-</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineminus">-.message &gt; .header &gt; .senders {</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+.senders {</span>
<a href="#l1.172"></a><span id="l1.172">   color: GrayText;</span>
<a href="#l1.173"></a><span id="l1.173"> }</span>
<a href="#l1.174"></a><span id="l1.174"> </span>
<a href="#l1.175"></a><span id="l1.175"> .info {</span>
<a href="#l1.176"></a><span id="l1.176">   font-size: small;</span>
<a href="#l1.177"></a><span id="l1.177"> }</span>
<a href="#l1.178"></a><span id="l1.178"> </span>
<a href="#l1.179"></a><span id="l1.179"> .heading.info {</span>
<a href="#l1.180"></a><span id="l1.180">   font-size: medium;</span>
<a href="#l1.181"></a><span id="l1.181">   font-weight: normal;</span>
<a href="#l1.182"></a><span id="l1.182"> }</span>
<a href="#l1.183"></a><span id="l1.183"> </span>
<a href="#l1.184"></a><span id="l1.184" class="difflineminus">-.tags {</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineminus">-  padding-top: 2px;</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+.tag {</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+  display: inline;</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+  white-space: nowrap; /* for tags like &quot;To Do&quot; */</span>
<a href="#l1.189"></a><span id="l1.189"> }</span>
<a href="#l1.190"></a><span id="l1.190"> </span>
<a href="#l1.191"></a><span id="l1.191" class="difflineminus">-.tag {</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineminus">-  padding: 0.2ex 0.2em;</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineminus">-  margin-right: 0.5em;</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineminus">-  -moz-margin-start: 0px;</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineminus">-  background-image: url(&quot;chrome://messenger/skin/tagbg.png&quot;);</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineminus">-  color: InfoText;</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineminus">-  -moz-border-radius: 2px;</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineminus">-}</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineminus">-</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineminus">-</span>
<a href="#l1.201"></a><span id="l1.201"> #buttonbox {</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineminus">-  display: table-cell;</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineminus">-  text-align: right;</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineplus">+  float: right;</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+  padding-top: 1ex;</span>
<a href="#l1.206"></a><span id="l1.206">   padding-bottom: 1ex;</span>
<a href="#l1.207"></a><span id="l1.207">   font-size: 11px;</span>
<a href="#l1.208"></a><span id="l1.208">   font-family: Lucida Grande;</span>
<a href="#l1.209"></a><span id="l1.209">   border: 1px solid transparent; </span>
<a href="#l1.210"></a><span id="l1.210"> }</span>
<a href="#l1.211"></a><span id="l1.211"> </span>
<a href="#l1.212"></a><span id="l1.212" class="difflineminus">-#headingwrappertable {</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineminus">-  display: table;</span>
<a href="#l1.214"></a><span id="l1.214" class="difflineminus">-  width: 100%;</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineminus">-}</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineminus">-</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineminus">-#headingwrapper {</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineminus">-  display: table-row;</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineminus">-  margin-bottom: 1em;</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineminus">-  border: 1px solid transparent; </span>
<a href="#l1.221"></a><span id="l1.221" class="difflineminus">-}</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineminus">-</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineminus">-.heading {</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-  display: table-cell;</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineminus">-  font-weight: bold;</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineminus">-  font-size: medium;</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineminus">-  margin: 0.5em;</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineminus">-  border: 1px solid transparent;</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineminus">-  padding-right: 1em;</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineminus">-}</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineminus">-</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineminus">-</span>
<a href="#l1.233"></a><span id="l1.233"> .button {</span>
<a href="#l1.234"></a><span id="l1.234">   display: inline;</span>
<a href="#l1.235"></a><span id="l1.235"> }</span>
<a href="#l1.236"></a><span id="l1.236"> </span>
<a href="#l1.237"></a><span id="l1.237"> #trash {</span>
<a href="#l1.238"></a><span id="l1.238">   min-height: 16px !important;</span>
<a href="#l1.239"></a><span id="l1.239">   min-width: 21px !important;</span>
<a href="#l1.240"></a><span id="l1.240">   padding: 0px;</span>
<a href="#l1.241"></a><span id="l1.241"> }</span>
<a href="#l1.242"></a><span id="l1.242"> </span>
<a href="#l1.243"></a><span id="l1.243" class="difflineminus">-.hidden {</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineminus">-  display: none;</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-}</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-</span>
<a href="#l1.248"></a><span id="l1.248"> #column {</span>
<a href="#l1.249"></a><span id="l1.249">   float: right;</span>
<a href="#l1.250"></a><span id="l1.250">   right: 1em;</span>
<a href="#l1.251"></a><span id="l1.251">   top: 1em;</span>
<a href="#l1.252"></a><span id="l1.252"> }</span>
<a href="#l1.253"></a><span id="l1.253"> </span>
<a href="#l1.254"></a><span id="l1.254" class="difflineminus">-#foldericon {</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineminus">-  z-index: -1;</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineminus">-  min-width: 128px;</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineminus">-  min-height: 128px;</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineminus">-  background-image: url(&quot;chrome://messenger/skin/icons/largefolder.jpg&quot;); </span>
<a href="#l1.259"></a><span id="l1.259" class="difflineminus">-  background-repeat: no-repeat;</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineminus">-}</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineminus">-</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineminus">-#tagpie {</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineminus">-    display: block;</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineminus">-}</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineminus">-</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineminus">-#tagdots {</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineminus">-    display: block;</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineminus">-    text-align: center;</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineminus">-    padding: 1em;</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+#header {</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineplus">+  border: 1px solid transparent;</span>
<a href="#l1.272"></a><span id="l1.272"> }</span>
<a href="#l1.273"></a><span id="l1.273"> </span>
<a href="#l1.274"></a><span id="l1.274">  .section_heading {</span>
<a href="#l1.275"></a><span id="l1.275">   font-weight: bold;</span>
<a href="#l1.276"></a><span id="l1.276">   padding-bottom: .5em;</span>
<a href="#l1.277"></a><span id="l1.277">   color: #555;</span>
<a href="#l1.278"></a><span id="l1.278"> }</span>
<a href="#l1.279"></a><span id="l1.279"> </span>
<a href="#l1.280"></a><span id="l1.280" class="difflineminus">-#header {</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineminus">-  border: 1px solid transparent;</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineminus">-}</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineminus">-</span>
<a href="#l1.284"></a><span id="l1.284"> .stats {</span>
<a href="#l1.285"></a><span id="l1.285">   padding: 1em;</span>
<a href="#l1.286"></a><span id="l1.286">   padding-top: 3em;</span>
<a href="#l1.287"></a><span id="l1.287">   text-align: center;</span>
<a href="#l1.288"></a><span id="l1.288">   font-size: small;</span>
<a href="#l1.289"></a><span id="l1.289"> }</span>
<a href="#l1.290"></a><span id="l1.290"> </span>
<a href="#l1.291"></a><span id="l1.291" class="difflineminus">-#mozupdate {</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineminus">-  clear: both;</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineminus">-  -moz-border-radius: 0.4ex;</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineminus">-  border: 1px solid #FFD8B9;</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineminus">-  left: 1em;</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineminus">-  right: 1em;</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineminus">-  padding: 0.5em;</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineminus">-}</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineminus">-</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineminus">-a {</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineminus">-  color: darkblue;</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineminus">-  font-weight: bold;</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineminus">-}</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineminus">-</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineminus">-a:hover {</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineminus">-  text-decoration: underline; </span>
<a href="#l1.307"></a><span id="l1.307" class="difflineminus">-}</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineminus">-</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineminus">-#unread, #authors, #threads, #last_selected_wrapper {</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineminus">-  display: inline-block; </span>
<a href="#l1.311"></a><span id="l1.311" class="difflineminus">-  padding: 1ex 1em;</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineminus">-  margin: 0px;</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineminus">-  margin-right: 1em;</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineminus">-  margin-bottom: 1em;</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineminus">-  font-size: small;</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineminus">-  -moz-border-radius: 0.4ex;</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineminus">-  border: 1px solid ThreeDShadow;</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineminus">-}</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineminus">-</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineminus">-#last_selected_wrapper, #unread {</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineminus">-  min-width: 40em;</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineminus">-}</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineminus">-</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineminus">-#authors, #threads {</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineminus">-  vertical-align: top;</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineminus">-}</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineminus">-</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineminus">-#topten {</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineminus">-  vertical-align: top;</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineminus">-}</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineminus">-</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineminus">-#remotecontent {</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineminus">-  -moz-border-radius: 0.4ex;</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineminus">-  border: 1px solid ThreeDShadow;</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineminus">-  background-color: #fafafa;</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineminus">-  padding: 1ex 1em;</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineminus">-  margin: 0px;</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineminus">-  font-size: smaller;</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineminus">-}</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineminus">-</span>
<a href="#l1.341"></a><span id="l1.341"> .messagecount {</span>
<a href="#l1.342"></a><span id="l1.342">   display: inline-block;</span>
<a href="#l1.343"></a><span id="l1.343">   white-space: nowrap;</span>
<a href="#l1.344"></a><span id="l1.344">   overflow: hidden;</span>
<a href="#l1.345"></a><span id="l1.345"> }</span>
<a href="#l1.346"></a><span id="l1.346"> </span>
<a href="#l1.347"></a><span id="l1.347" class="difflineminus">-.author, .subject {</span>
<a href="#l1.348"></a><span id="l1.348" class="difflineplus">+.tags {</span>
<a href="#l1.349"></a><span id="l1.349">   display: inline;</span>
<a href="#l1.350"></a><span id="l1.350" class="difflineminus">-  overflow: hidden;</span>
<a href="#l1.351"></a><span id="l1.351" class="difflineminus">-  margin-right: 1em;</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineplus">+  padding-top: 4px;</span>
<a href="#l1.353"></a><span id="l1.353"> }</span>
<a href="#l1.354"></a><span id="l1.354"> </span>
<a href="#l1.355"></a><span id="l1.355" class="difflineminus">-.subject_and_author {</span>
<a href="#l1.356"></a><span id="l1.356" class="difflineminus">-  white-space: nowrap;</span>
<a href="#l1.357"></a><span id="l1.357" class="difflineminus">-  overflow: hidden;</span>
<a href="#l1.358"></a><span id="l1.358" class="difflineminus">-  width: 38em;</span>
<a href="#l1.359"></a><span id="l1.359" class="difflineminus">-  margin-right: 1em;</span>
<a href="#l1.360"></a><span id="l1.360" class="difflineminus">-}</span>
<a href="#l1.361"></a><span id="l1.361" class="difflineminus">-</span>
<a href="#l1.362"></a><span id="l1.362" class="difflineminus">-.link:hover {</span>
<a href="#l1.363"></a><span id="l1.363" class="difflineminus">-  text-decoration: underline;</span>
<a href="#l1.364"></a><span id="l1.364" class="difflineminus">-  cursor: pointer;</span>
<a href="#l1.365"></a><span id="l1.365" class="difflineplus">+.snippet {</span>
<a href="#l1.366"></a><span id="l1.366" class="difflineplus">+  color: #888a85;</span>
<a href="#l1.367"></a><span id="l1.367" class="difflineplus">+  font-size: 95%;</span>
<a href="#l1.368"></a><span id="l1.368"> }</span>
<a href="#l1.369"></a><span id="l1.369"> </span>
<a href="#l1.370"></a><span id="l1.370" class="difflineminus">-.sparkline {</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineminus">-  margin-left: .5em;</span>
<a href="#l1.372"></a><span id="l1.372" class="difflineminus">-}</span>
<a href="#l1.373"></a><span id="l1.373" class="difflineminus">-</span>
<a href="#l1.374"></a><span id="l1.374" class="difflineminus">-#last_selected_wrapper {</span>
<a href="#l1.375"></a><span id="l1.375" class="difflineminus">-  border: 1px solid orange;</span>
<a href="#l1.376"></a><span id="l1.376" class="difflineplus">+.tag {</span>
<a href="#l1.377"></a><span id="l1.377" class="difflineplus">+  color: #fff;</span>
<a href="#l1.378"></a><span id="l1.378" class="difflineplus">+  padding: 0.2ex 0.4em;</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineplus">+  margin-right: 0.5em;</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineplus">+  -moz-border-radius: 3px;</span>
<a href="#l1.381"></a><span id="l1.381"> }</span>
<a href="#l1.382"></a><span id="l1.382"> </span>
<a href="#l1.383"></a><span id="l1.383" class="difflineminus">-.last_selected {</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineminus">-  font-weight: normal;</span>
<a href="#l1.385"></a><span id="l1.385" class="difflineminus">-  display: inline;</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineplus">+.notice {</span>
<a href="#l1.387"></a><span id="l1.387" class="difflineplus">+  padding-left: 1em;</span>
<a href="#l1.388"></a><span id="l1.388"> }</span>
<a href="#l1.389"></a><span id="l1.389"> </span>
<a href="#l1.390"></a><span id="l1.390" class="difflineminus">-.hidden {</span>
<a href="#l1.391"></a><span id="l1.391" class="difflineminus">-  visibility: hidden;</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineminus">-  display: none !important; </span>
<a href="#l1.393"></a><span id="l1.393" class="difflineminus">-}</span>
<a href="#l1.394"></a><span id="l1.394" class="difflineminus">-</span>
<a href="#l1.395"></a><span id="l1.395" class="difflineminus">-.histogram {</span>
<a href="#l1.396"></a><span id="l1.396" class="difflineminus">-  display: inline;</span>
<a href="#l1.397"></a><span id="l1.397" class="difflineminus">-  padding-left: 1em;</span>
<a href="#l1.398"></a><span id="l1.398" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/multimessageview.xhtml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/multimessageview.xhtml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -56,33 +56,31 @@</span>
<a href="#l2.4"></a><span id="l2.4">               href=&quot;chrome://messenger/skin/messageHeader.css&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5">         &lt;link rel=&quot;stylesheet&quot; media=&quot;screen&quot; type=&quot;text/css&quot;</span>
<a href="#l2.6"></a><span id="l2.6">               href=&quot;chrome://messenger/skin/multimessageview.css&quot;/&gt;</span>
<a href="#l2.7"></a><span id="l2.7">         &lt;link rel=&quot;stylesheet&quot; media=&quot;screen&quot; type=&quot;text/css&quot;</span>
<a href="#l2.8"></a><span id="l2.8">               href=&quot;chrome://messenger/skin/tagColors.css&quot;/&gt;</span>
<a href="#l2.9"></a><span id="l2.9">         &lt;title&gt;&amp;window.title;&lt;/title&gt;</span>
<a href="#l2.10"></a><span id="l2.10">     &lt;/head&gt;</span>
<a href="#l2.11"></a><span id="l2.11"> &lt;body&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    &lt;div id=&quot;multimessageview&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-        &lt;div id=&quot;headingwrappertable&quot;&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-            &lt;div id=&quot;headingwrapper&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                &lt;div class=&quot;heading&quot; id=&quot;heading&quot;&gt;&amp;selectedmessages.label;&lt;/div&gt;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                &lt;div id=&quot;buttonbox&quot;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                     xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-                     xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-                    &lt;hbox id=&quot;buttonhbox&quot; align=&quot;start&quot;&gt;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-                        &lt;button id=&quot;archive&quot; class=&quot;multimessage button&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-                                onclick=&quot;window.top.MsgArchiveSelectedMessages(null)&quot; label=&quot;&amp;archive.label;&quot;&gt;&lt;/button&gt;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-                        &lt;button id=&quot;trash&quot; class=&quot;multimessage button trashButton&quot;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-                                onclick=&quot;window.top.DefaultController.doCommand('cmd_delete');&quot;/&gt;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-                    &lt;/hbox&gt;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-                &lt;/div&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+    &lt;div id=&quot;headingwrappertable&quot;&gt;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+        &lt;div id=&quot;headingwrapper&quot;&gt;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+            &lt;div id=&quot;buttonbox&quot;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+                 xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+                 xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+                &lt;hbox id=&quot;buttonhbox&quot; align=&quot;start&quot;&gt;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+                    &lt;button id=&quot;archive&quot; class=&quot;multimessage button&quot;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+                            onclick=&quot;window.top.MsgArchiveSelectedMessages(null)&quot; label=&quot;&amp;archive.label;&quot;&gt;&lt;/button&gt;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+                    &lt;button id=&quot;trash&quot; class=&quot;multimessage button trashButton&quot;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+                            onclick=&quot;window.top.DefaultController.doCommand('cmd_delete');&quot;/&gt;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+                &lt;/hbox&gt;</span>
<a href="#l2.37"></a><span id="l2.37">             &lt;/div&gt;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+            &lt;div class=&quot;heading&quot; id=&quot;heading&quot;&gt;&amp;selectedmessages.label;&lt;/div&gt;</span>
<a href="#l2.39"></a><span id="l2.39">         &lt;/div&gt;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-        &lt;div id=&quot;messages&quot;&gt;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-            &lt;div id=&quot;messagelist&quot;/&gt;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-            &lt;p&gt;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-                &lt;span class=&quot;info&quot; id=&quot;size&quot;&gt;&lt;/span&gt; &lt;span class=&quot;info&quot; id=&quot;notice&quot;&gt;&lt;/span&gt;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-            &lt;/p&gt;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+    &lt;div id=&quot;content&quot;&gt;</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+        &lt;div id=&quot;messagelist&quot;/&gt;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+        &lt;div class=&quot;notice&quot;&gt;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+            &lt;span class=&quot;info&quot; id=&quot;size&quot;&gt;&lt;/span&gt; &lt;span class=&quot;info&quot; id=&quot;notice&quot;&gt;&lt;/span&gt;</span>
<a href="#l2.50"></a><span id="l2.50">         &lt;/div&gt;</span>
<a href="#l2.51"></a><span id="l2.51">     &lt;/div&gt;</span>
<a href="#l2.52"></a><span id="l2.52"> &lt;/body&gt;</span>
<a href="#l2.53"></a><span id="l2.53"> &lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/selectionsummaries.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/selectionsummaries.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -34,36 +34,35 @@</span>
<a href="#l3.4"></a><span id="l3.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.5"></a><span id="l3.5">  *</span>
<a href="#l3.6"></a><span id="l3.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> Components.utils.import(&quot;resource://gre/modules/DownloadUtils.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11"> Components.utils.import(&quot;resource://app/modules/gloda/mimemsg.js&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+Components.utils.import(&quot;resource://app/modules/gloda/connotent.js&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14"> let gSelectionSummaryStrings = {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  selectedNMessages: &quot;selectedNMessages&quot;,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-  acrossNThreads: &quot;acrossNThreads&quot;,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  NConversations: &quot;NConversations&quot;,</span>
<a href="#l3.18"></a><span id="l3.18">   numMsgs: &quot;numMsgs&quot;,</span>
<a href="#l3.19"></a><span id="l3.19">   countUnread: &quot;countUnread&quot;,</span>
<a href="#l3.20"></a><span id="l3.20">   Nmessages: &quot;Nmessages&quot;,</span>
<a href="#l3.21"></a><span id="l3.21">   messagesSize: &quot;messagesSize&quot;,</span>
<a href="#l3.22"></a><span id="l3.22">   yesterday: &quot;yesterday&quot;,</span>
<a href="#l3.23"></a><span id="l3.23">   noticeText: &quot;noticeText&quot;,</span>
<a href="#l3.24"></a><span id="l3.24">   noSubject: &quot;noSubject&quot;,</span>
<a href="#l3.25"></a><span id="l3.25"> }</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> /**</span>
<a href="#l3.28"></a><span id="l3.28">  * loadSelectionSummaryStrings does the routine localization of non-pluralized</span>
<a href="#l3.29"></a><span id="l3.29">  * strings, populating the gSelectionSummaryStrings array based on the current</span>
<a href="#l3.30"></a><span id="l3.30">  * locale.</span>
<a href="#l3.31"></a><span id="l3.31">  */</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-function loadSelectionSummaryStrings()</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-{</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+function loadSelectionSummaryStrings() {</span>
<a href="#l3.35"></a><span id="l3.35">   // convert strings to those in the string bundle</span>
<a href="#l3.36"></a><span id="l3.36">   let getStr = function(string) document.getElementById(&quot;bundle_multimessages&quot;).getString(string);</span>
<a href="#l3.37"></a><span id="l3.37">   var strBundleService = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;].getService();</span>
<a href="#l3.38"></a><span id="l3.38">   strBundleService = strBundleService.QueryInterface(Components.interfaces.nsIStringBundleService);</span>
<a href="#l3.39"></a><span id="l3.39">     for (let [name, value] in Iterator(gSelectionSummaryStrings))</span>
<a href="#l3.40"></a><span id="l3.40">       gSelectionSummaryStrings[name] = typeof value == &quot;string&quot; ?</span>
<a href="#l3.41"></a><span id="l3.41">         getStr(value) : value.map(gSelectionSummaryStrings);</span>
<a href="#l3.42"></a><span id="l3.42"> }</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineat">@@ -75,18 +74,17 @@ loadSelectionSummaryStrings();</span>
<a href="#l3.44"></a><span id="l3.44">  * message pane used to display message bodies (&amp; headers), or whether to</span>
<a href="#l3.45"></a><span id="l3.45">  * display an HTML iframe used for the multiple message summaries.</span>
<a href="#l3.46"></a><span id="l3.46">  *</span>
<a href="#l3.47"></a><span id="l3.47">  * @param visiblePaneId</span>
<a href="#l3.48"></a><span id="l3.48">  *        the ID of the pane that we want to make be the visible one.</span>
<a href="#l3.49"></a><span id="l3.49">  * @return the DOM element corresponding to the selected pane.</span>
<a href="#l3.50"></a><span id="l3.50">  *</span>
<a href="#l3.51"></a><span id="l3.51">  */</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-function pickMessagePane(visiblePaneId)</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-{</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+function pickMessagePane(visiblePaneId) {</span>
<a href="#l3.55"></a><span id="l3.55">   var paneIds = ['singlemessage', 'multimessage'];</span>
<a href="#l3.56"></a><span id="l3.56">   // when we want to do folder and account summaries, we just need to add</span>
<a href="#l3.57"></a><span id="l3.57">   // XUL elements for them, and add them to this list.</span>
<a href="#l3.58"></a><span id="l3.58">   //               'foldersummary', 'accountsummary'];</span>
<a href="#l3.59"></a><span id="l3.59">   for (let [,paneId] in Iterator(paneIds))</span>
<a href="#l3.60"></a><span id="l3.60">     document.getElementById(paneId).hidden = paneId != visiblePaneId;</span>
<a href="#l3.61"></a><span id="l3.61"> </span>
<a href="#l3.62"></a><span id="l3.62">   return document.getElementById(visiblePaneId);</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineat">@@ -97,18 +95,17 @@ function pickMessagePane(visiblePaneId)</span>
<a href="#l3.64"></a><span id="l3.64"> /**</span>
<a href="#l3.65"></a><span id="l3.65">  * the equivalent of jQuery's addClass.  Avoids duplicates, nothing fancy.</span>
<a href="#l3.66"></a><span id="l3.66">  *</span>
<a href="#l3.67"></a><span id="l3.67">  * @param node</span>
<a href="#l3.68"></a><span id="l3.68">  *        any old DOM node</span>
<a href="#l3.69"></a><span id="l3.69">  * @param classname</span>
<a href="#l3.70"></a><span id="l3.70">  *        a string, which will be added as a CSS class</span>
<a href="#l3.71"></a><span id="l3.71">  */</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-function _mm_addClass(node, classname)</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-{</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+function _mm_addClass(node, classname) {</span>
<a href="#l3.75"></a><span id="l3.75">   let classes = [];</span>
<a href="#l3.76"></a><span id="l3.76">   if (node.hasAttribute('class'))</span>
<a href="#l3.77"></a><span id="l3.77">     classes = node.getAttribute('class').split(' ');</span>
<a href="#l3.78"></a><span id="l3.78"> </span>
<a href="#l3.79"></a><span id="l3.79">   for each (klass in classes) {</span>
<a href="#l3.80"></a><span id="l3.80">     if (klass == classname) // already have it</span>
<a href="#l3.81"></a><span id="l3.81">       return;</span>
<a href="#l3.82"></a><span id="l3.82">   }</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineat">@@ -120,18 +117,17 @@ function _mm_addClass(node, classname)</span>
<a href="#l3.84"></a><span id="l3.84">  * the equivalent of jQuery's removeClass.  Doesn't freak if the class name</span>
<a href="#l3.85"></a><span id="l3.85">  * isn't in the class attribute.</span>
<a href="#l3.86"></a><span id="l3.86">  *</span>
<a href="#l3.87"></a><span id="l3.87">  * @param node</span>
<a href="#l3.88"></a><span id="l3.88">  *        any old DOM node</span>
<a href="#l3.89"></a><span id="l3.89">  * @param classname</span>
<a href="#l3.90"></a><span id="l3.90">  *        a string, which will be removed from the class set.</span>
<a href="#l3.91"></a><span id="l3.91">  */</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-function _mm_removeClass(node, classname)</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-{</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+function _mm_removeClass(node, classname) {</span>
<a href="#l3.95"></a><span id="l3.95">   if (! node.hasAttribute('class'))</span>
<a href="#l3.96"></a><span id="l3.96">     return;</span>
<a href="#l3.97"></a><span id="l3.97">   let classes = node.getAttribute('class').split(' ');</span>
<a href="#l3.98"></a><span id="l3.98">   let newclasses = [];</span>
<a href="#l3.99"></a><span id="l3.99">   for each (klass in classes) {</span>
<a href="#l3.100"></a><span id="l3.100">     if (klass != classname)</span>
<a href="#l3.101"></a><span id="l3.101">       newclasses.push(klass);</span>
<a href="#l3.102"></a><span id="l3.102">   }</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineat">@@ -157,28 +153,56 @@ function _mm_removeClass(node, classname</span>
<a href="#l3.104"></a><span id="l3.104">  */</span>
<a href="#l3.105"></a><span id="l3.105"> </span>
<a href="#l3.106"></a><span id="l3.106"> function MultiMessageSummary(msgURIs) {</span>
<a href="#l3.107"></a><span id="l3.107">   this._msgURIs = msgURIs;</span>
<a href="#l3.108"></a><span id="l3.108"> }</span>
<a href="#l3.109"></a><span id="l3.109"> </span>
<a href="#l3.110"></a><span id="l3.110"> MultiMessageSummary.prototype = {</span>
<a href="#l3.111"></a><span id="l3.111">   init: function() {</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+    this._msgTagService = Components.classes[&quot;@mozilla.org/messenger/tagservice;1&quot;].</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+                          getService(Components.interfaces.nsIMsgTagService);</span>
<a href="#l3.114"></a><span id="l3.114">     this._msgHdrs = new Array();</span>
<a href="#l3.115"></a><span id="l3.115">     this._glodaQueries = [];</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-    this._headerNodes = {};</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-    this._snippetNodes = {};</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-    this._tagsNodes = {};</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+    this._msgNodes = {};</span>
<a href="#l3.120"></a><span id="l3.120">     for (var i = 0; i &lt; this._msgURIs.length; ++i)</span>
<a href="#l3.121"></a><span id="l3.121">       this._msgHdrs.push(messenger.msgHdrFromURI(this._msgURIs[i]));</span>
<a href="#l3.122"></a><span id="l3.122"> </span>
<a href="#l3.123"></a><span id="l3.123">     this.summarize();</span>
<a href="#l3.124"></a><span id="l3.124">   },</span>
<a href="#l3.125"></a><span id="l3.125"> </span>
<a href="#l3.126"></a><span id="l3.126">   /**</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+   * Given a msgHdr, return a list of tag objects. This function</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+   * just does the messy work of understanding how tags are</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+   * stored in nsIMsgDBHdrs.  It would be a good candidate for</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+   * a utility library.</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+   *</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+   * @param aMsgHdr: the msgHdr whose tags we want</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+   * @return a list of tag objects.</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+   */</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+  getTagsForMsg: function(aMsgHdr) {</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+    let keywords = aMsgHdr.getStringProperty(&quot;keywords&quot;);</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+    let keywordList = keywords.split(' ');</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+    let keywordMap = {};</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+    for (let iKeyword = 0; iKeyword &lt; keywordList.length; iKeyword++) {</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+      let keyword = keywordList[iKeyword];</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+      keywordMap[keyword] = true;</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+    }</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+    let tagArray = this._msgTagService.getAllTags({});</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+    let tags = [];</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+    for (let iTag = 0; iTag &lt; tagArray.length; iTag++) {</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+      let tag = tagArray[iTag];</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+      if (tag.key in keywordMap)</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+        tags.push(tag);</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+    }</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+    return tags;</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+  },</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+  /**</span>
<a href="#l3.155"></a><span id="l3.155">    * Given a name (as one sees in email headers), strip eventual</span>
<a href="#l3.156"></a><span id="l3.156">    * leading/trailing quotes (both single and double).</span>
<a href="#l3.157"></a><span id="l3.157">    *</span>
<a href="#l3.158"></a><span id="l3.158">    * @param senderName</span>
<a href="#l3.159"></a><span id="l3.159">    *     name which might be quoted</span>
<a href="#l3.160"></a><span id="l3.160">    * @return</span>
<a href="#l3.161"></a><span id="l3.161">    *     name without quotes</span>
<a href="#l3.162"></a><span id="l3.162">    **/</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineat">@@ -193,154 +217,172 @@ MultiMessageSummary.prototype = {</span>
<a href="#l3.164"></a><span id="l3.164">    * Fill in the summary pane describing the selected messages</span>
<a href="#l3.165"></a><span id="l3.165">    **/</span>
<a href="#l3.166"></a><span id="l3.166">   summarize: function() {</span>
<a href="#l3.167"></a><span id="l3.167">     let htmlpane = pickMessagePane('multimessage');</span>
<a href="#l3.168"></a><span id="l3.168">     // First, we group the messages in threads.</span>
<a href="#l3.169"></a><span id="l3.169">     // count threads</span>
<a href="#l3.170"></a><span id="l3.170">     let threads = {};</span>
<a href="#l3.171"></a><span id="l3.171">     let numThreads = 0;</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+    let headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;].</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+                         getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l3.174"></a><span id="l3.174">     for (let [,msgHdr] in Iterator(this._msgHdrs))</span>
<a href="#l3.175"></a><span id="l3.175">     {</span>
<a href="#l3.176"></a><span id="l3.176">       if (! threads[msgHdr.threadId]) {</span>
<a href="#l3.177"></a><span id="l3.177">         threads[msgHdr.threadId] = [msgHdr];</span>
<a href="#l3.178"></a><span id="l3.178">         numThreads += 1;</span>
<a href="#l3.179"></a><span id="l3.179">       }</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-      else</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-      {</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+      else {</span>
<a href="#l3.183"></a><span id="l3.183">         threads[msgHdr.threadId].push(msgHdr);</span>
<a href="#l3.184"></a><span id="l3.184">       }</span>
<a href="#l3.185"></a><span id="l3.185">     }</span>
<a href="#l3.186"></a><span id="l3.186"> </span>
<a href="#l3.187"></a><span id="l3.187">     // set the heading based on the number of messages &amp; threads</span>
<a href="#l3.188"></a><span id="l3.188">     let heading = htmlpane.contentDocument.getElementById('heading');</span>
<a href="#l3.189"></a><span id="l3.189">     _mm_addClass(heading, &quot;heading&quot;);</span>
<a href="#l3.190"></a><span id="l3.190">     _mm_addClass(heading, &quot;info&quot;);</span>
<a href="#l3.191"></a><span id="l3.191"> </span>
<a href="#l3.192"></a><span id="l3.192">     let numMessages = this._msgURIs.length;</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-    let messagesTitle = PluralForm.get(numMessages, gSelectionSummaryStrings[&quot;selectedNMessages&quot;]).replace('#1', numMessages);</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-    messagesTitle +=  PluralForm.get(numThreads, gSelectionSummaryStrings[&quot;acrossNThreads&quot;]).replace('#1', numThreads);</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+    let messagesTitle = PluralForm.get(numMessages, gSelectionSummaryStrings[&quot;NConversations&quot;]).replace('#1', numThreads);</span>
<a href="#l3.196"></a><span id="l3.196"> </span>
<a href="#l3.197"></a><span id="l3.197">     heading.innerHTML = messagesTitle;</span>
<a href="#l3.198"></a><span id="l3.198"> </span>
<a href="#l3.199"></a><span id="l3.199">     // clear the messages list</span>
<a href="#l3.200"></a><span id="l3.200">     let messagesElt = htmlpane.contentDocument.getElementById('messagelist');</span>
<a href="#l3.201"></a><span id="l3.201">     while (messagesElt.firstChild)</span>
<a href="#l3.202"></a><span id="l3.202">       messagesElt.removeChild(messagesElt.firstChild);</span>
<a href="#l3.203"></a><span id="l3.203"> </span>
<a href="#l3.204"></a><span id="l3.204">     let MAXCOUNT = 100;</span>
<a href="#l3.205"></a><span id="l3.205">     let count = 0;</span>
<a href="#l3.206"></a><span id="l3.206">     let maxCountExceeded = false;</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineminus">-    // we could consider sorting differently someday</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineminus">-    for (let [thread,msgs] in Iterator(threads))</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineminus">-    {</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineplus">+    var parser = new DOMParser();</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineplus">+</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineplus">+    for (let [thread,msgs] in Iterator(threads)) {</span>
<a href="#l3.213"></a><span id="l3.213">       count += 1;</span>
<a href="#l3.214"></a><span id="l3.214">       if (count &gt; MAXCOUNT) {</span>
<a href="#l3.215"></a><span id="l3.215">         maxCountExceeded = true;</span>
<a href="#l3.216"></a><span id="l3.216">         break;</span>
<a href="#l3.217"></a><span id="l3.217">       }</span>
<a href="#l3.218"></a><span id="l3.218">       let countUnread = 0;</span>
<a href="#l3.219"></a><span id="l3.219">       let countStarred = 0;</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-      let header, subject, tags, countNode;</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-      let msg = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-      _mm_addClass(msg, &quot;message&quot;);</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+      let header, countNode;</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+      </span>
<a href="#l3.225"></a><span id="l3.225">       // we'll mark the thread unread if any messages in it are unread</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-</span>
<a href="#l3.227"></a><span id="l3.227">       for (let [, msgHdr] in Iterator(msgs)) {</span>
<a href="#l3.228"></a><span id="l3.228">         if (! msgHdr.isRead)</span>
<a href="#l3.229"></a><span id="l3.229">           countUnread += 1;</span>
<a href="#l3.230"></a><span id="l3.230">         if (msgHdr.isFlagged)</span>
<a href="#l3.231"></a><span id="l3.231">           countStarred += 1;</span>
<a href="#l3.232"></a><span id="l3.232">       }</span>
<a href="#l3.233"></a><span id="l3.233"> </span>
<a href="#l3.234"></a><span id="l3.234" class="difflineplus">+      let numMsgs = msgs.length;</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineplus">+      let msg_classes = &quot;message &quot;;</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineplus">+      if (numMsgs &gt; 1)</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineplus">+        msg_classes += &quot; thread&quot;;</span>
<a href="#l3.238"></a><span id="l3.238">       if (countUnread)</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineminus">-        _mm_addClass(msg, 'unread');</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineplus">+        msg_classes += &quot; unread&quot;;</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+      if (countStarred)</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+        msg_classes += &quot; starred&quot;;</span>
<a href="#l3.243"></a><span id="l3.243"> </span>
<a href="#l3.244"></a><span id="l3.244" class="difflineminus">-      header = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineminus">-      _mm_addClass(header, &quot;header&quot;);</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineplus">+      let subject = msgs[0].mime2DecodedSubject || gSelectionSummaryStrings['noSubject'];</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineplus">+      let author = headerParser.extractHeaderAddressName(msgs[0].mime2DecodedAuthor);</span>
<a href="#l3.248"></a><span id="l3.248"> </span>
<a href="#l3.249"></a><span id="l3.249" class="difflineminus">-      if (countStarred) {</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineminus">-        _mm_addClass(msg, &quot;starred&quot;);</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineplus">+      let countstring = &quot;&quot;;</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineplus">+      if (numMsgs &gt; 1) {</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineplus">+        countstring += &quot;(&quot;;</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+        countstring += PluralForm.get(numMsgs, gSelectionSummaryStrings[&quot;numMsgs&quot;]).replace('#1', numMsgs);</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineplus">+        if (countUnread)</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineplus">+          countstring += PluralForm.get(numMsgs, gSelectionSummaryStrings[&quot;countUnread&quot;]).replace('#1', countUnread);</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineplus">+        countstring += &quot;)&quot;;</span>
<a href="#l3.258"></a><span id="l3.258">       }</span>
<a href="#l3.259"></a><span id="l3.259"> </span>
<a href="#l3.260"></a><span id="l3.260" class="difflineminus">-      let subjectText = msgs[0].mime2DecodedSubject || gSelectionSummaryStrings['noSubject'];</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineminus">-      // Someday, we might want to handle multi-subject threads</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineminus">-      subject = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineminus">-      _mm_addClass(subject, &quot;subject&quot;);</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineminus">-      subject.innerHTML = escapeXMLchars(subjectText);</span>
<a href="#l3.265"></a><span id="l3.265" class="difflineminus">-</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineminus">-</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineminus">-      let authorText = &quot; &quot; + msgs[0].mime2DecodedAuthor;</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineminus">-      // Someday, we might want to handle multi-subject threads</span>
<a href="#l3.269"></a><span id="l3.269" class="difflineminus">-      let author = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineminus">-      _mm_addClass(author, &quot;author&quot;);</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-      author.innerHTML = escapeXMLchars(authorText);</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineplus">+      let msgContents = &lt;div class=&quot;row&quot;&gt;</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+                          &lt;div class=&quot;star&quot;/&gt;</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineplus">+                          &lt;div class=&quot;header&quot;&gt;</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineplus">+                            &lt;div class=&quot;wrappedsubject&quot;&gt;</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineplus">+                              &lt;div class=&quot;author&quot;&gt;{author}&lt;/div&gt;</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineplus">+                              &lt;div class=&quot;subject link&quot;&gt;{subject}&lt;/div&gt;</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineplus">+                              &lt;div class=&quot;count&quot;&gt;{countstring}&lt;/div&gt;</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineplus">+                              &lt;div class=&quot;tags&quot;&gt;&lt;/div&gt;</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineplus">+                            &lt;/div&gt;</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineplus">+                            &lt;div class=&quot;snippet&quot;&gt;&lt;/div&gt;</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineplus">+                          &lt;/div&gt;</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineplus">+                        &lt;/div&gt;;</span>
<a href="#l3.284"></a><span id="l3.284"> </span>
<a href="#l3.285"></a><span id="l3.285" class="difflineminus">-      let wrappedsubject = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineminus">-      _mm_addClass(wrappedsubject, 'wrappedsubject');</span>
<a href="#l3.287"></a><span id="l3.287" class="difflineminus">-      let star = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.288"></a><span id="l3.288" class="difflineminus">-      _mm_addClass(star, &quot;star&quot;);</span>
<a href="#l3.289"></a><span id="l3.289" class="difflineminus">-      wrappedsubject.appendChild(subject);</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineminus">-      wrappedsubject.appendChild(author);</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineminus">-</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineminus">-      header.appendChild(wrappedsubject);</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineplus">+      let msgNode = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineplus">+      msgNode.innerHTML = msgContents.toXMLString();</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineplus">+      _mm_addClass(msgNode, msg_classes);</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineplus">+      messagesElt.appendChild(msgNode);</span>
<a href="#l3.297"></a><span id="l3.297"> </span>
<a href="#l3.298"></a><span id="l3.298" class="difflineminus">-      // this feels ugly -- is there a better way to pass in data?</span>
<a href="#l3.299"></a><span id="l3.299" class="difflineminus">-      subject.msgs = msgs;</span>
<a href="#l3.300"></a><span id="l3.300" class="difflineminus">-      subject.addEventListener(&quot;click&quot;, function() {</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineminus">-        selectMultipleMessagesByMsgHdr(this.msgs)</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-      }, true);</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineminus">-      _mm_addClass(subject, &quot;link&quot;);</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineminus">-</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineminus">-      msg.appendChild(header);</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineplus">+      let snippetNode = msgNode.getElementsByClassName(&quot;snippet&quot;)[0];</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineplus">+      let authorNode = msgNode.getElementsByClassName(&quot;author&quot;)[0];</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineplus">+      MsgHdrToMimeMessage(msgs[0], null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineplus">+        if (aMimeMsg == null) /* shouldn't happen, but sometimes does? */</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineplus">+          return;</span>
<a href="#l3.311"></a><span id="l3.311"> </span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-      let snippet = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineminus">-      _mm_addClass(snippet, &quot;snippet&quot;);</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineminus">-      header.appendChild(snippet);</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineminus">-</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineminus">-      tags = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineminus">-      _mm_addClass(tags, &quot;tags&quot;);</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineminus">-      header.appendChild(tags);</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineminus">-</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineminus">-      // use the first msgHdr in the thread for key purposes for snippets</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineminus">-      this._snippetNodes[msgs[0].messageKey + msgs[0].folder.URI] = snippet;</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineminus">-      // for tags, stars, and read/unread status, we want to map</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineminus">-      // from all messages to one node</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineminus">-      for each (msgHdr in msgs) {</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineminus">-        this._headerNodes[msgHdr.messageKey + msgHdr.folder.URI] = header;</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineminus">-        this._tagsNodes[msgHdr.messageKey + msgHdr.folder.URI] = tags;</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-      }</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineplus">+        let [text, meta] = mimeMsgToContentSnippetAndMeta(aMimeMsg,</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineplus">+                                                          aMsgHdr.folder, 200);</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineplus">+        snippetNode.innerHTML = escapeXMLchars(text);</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineplus">+        if (meta.author)</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineplus">+          authorNode.innerHTML = escapeXMLchars(meta.author);</span>
<a href="#l3.333"></a><span id="l3.333" class="difflineplus">+      });</span>
<a href="#l3.334"></a><span id="l3.334"> </span>
<a href="#l3.335"></a><span id="l3.335" class="difflineminus">-      let numMsgs = msgs.length;</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineminus">-      countNode = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineminus">-      _mm_addClass(countNode, 'count');</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineminus">-      if (numMsgs &gt; 1) {</span>
<a href="#l3.339"></a><span id="l3.339" class="difflineminus">-        let label = &quot;(&quot;;</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineminus">-        label += PluralForm.get(numMsgs, gSelectionSummaryStrings[&quot;numMsgs&quot;]).replace('#1', numMsgs);</span>
<a href="#l3.341"></a><span id="l3.341" class="difflineminus">-        if (countUnread)</span>
<a href="#l3.342"></a><span id="l3.342" class="difflineminus">-          label += PluralForm.get(numMsgs, gSelectionSummaryStrings[&quot;countUnread&quot;]).replace('#1', countUnread);</span>
<a href="#l3.343"></a><span id="l3.343" class="difflineminus">-        label += &quot;)&quot;;</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineminus">-        countNode.innerHTML = label;</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineplus">+      // get the subject node.</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineplus">+      let subjectNode = msgNode.getElementsByClassName(&quot;subject&quot;)[0];</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineplus">+      subjectNode.msgs = msgs;</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineplus">+      subjectNode.addEventListener(&quot;click&quot;, function() {</span>
<a href="#l3.349"></a><span id="l3.349" class="difflineplus">+        selectMultipleMessagesByMsgHdr(this.msgs);</span>
<a href="#l3.350"></a><span id="l3.350" class="difflineplus">+      }, true);</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineplus">+</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineplus">+      let tagsNode = msgNode.getElementsByClassName(&quot;tags&quot;)[0];</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineplus">+      while (tagsNode.firstChild)</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineplus">+        tagsNode.removeChild(tagsNode.firstChild);</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineplus">+      this._addTagNodes(msgs, tagsNode);</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineplus">+      for each (msgHdr in msgs) {</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineplus">+        this._msgNodes[msgHdr.messageKey + msgHdr.folder.URI] = msgNode;</span>
<a href="#l3.358"></a><span id="l3.358">       }</span>
<a href="#l3.359"></a><span id="l3.359" class="difflineminus">-      msg.appendChild(countNode);</span>
<a href="#l3.360"></a><span id="l3.360" class="difflineminus">-      countNode.appendChild(star);</span>
<a href="#l3.361"></a><span id="l3.361" class="difflineminus">-      messagesElt.appendChild(msg);</span>
<a href="#l3.362"></a><span id="l3.362" class="difflineplus">+      messagesElt.appendChild(msgNode);</span>
<a href="#l3.363"></a><span id="l3.363">     }</span>
<a href="#l3.364"></a><span id="l3.364" class="difflineminus">-    this.computeSize();</span>
<a href="#l3.365"></a><span id="l3.365" class="difflineplus">+    this.computeSize(htmlpane);</span>
<a href="#l3.366"></a><span id="l3.366">     this.notifyMaxCountExceeded(numMessages, MAXCOUNT);</span>
<a href="#l3.367"></a><span id="l3.367"> </span>
<a href="#l3.368"></a><span id="l3.368">     this._glodaQueries.push(Gloda.getMessageCollectionForHeaders(this._msgHdrs, this));</span>
<a href="#l3.369"></a><span id="l3.369">   },</span>
<a href="#l3.370"></a><span id="l3.370"> </span>
<a href="#l3.371"></a><span id="l3.371">   /**</span>
<a href="#l3.372"></a><span id="l3.372" class="difflineplus">+   * clear out the tagsnode, and fill in appropriately for the union of</span>
<a href="#l3.373"></a><span id="l3.373" class="difflineplus">+   * tags in the specified messags</span>
<a href="#l3.374"></a><span id="l3.374" class="difflineplus">+   */</span>
<a href="#l3.375"></a><span id="l3.375" class="difflineplus">+  _addTagNodes: function(msgs, tagsNode) {</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineplus">+      // for tags, stars, and read/unread status, we want to map</span>
<a href="#l3.377"></a><span id="l3.377" class="difflineplus">+      // from all messages to one node</span>
<a href="#l3.378"></a><span id="l3.378" class="difflineplus">+      let tags = {};</span>
<a href="#l3.379"></a><span id="l3.379" class="difflineplus">+      for each (let [, msgHdr] in Iterator(msgs)) {</span>
<a href="#l3.380"></a><span id="l3.380" class="difflineplus">+        let msgTags = this.getTagsForMsg(msgHdr);</span>
<a href="#l3.381"></a><span id="l3.381" class="difflineplus">+        for each (let [,tag] in Iterator(msgTags)) {</span>
<a href="#l3.382"></a><span id="l3.382" class="difflineplus">+          if (!(tag.key in tags)) {</span>
<a href="#l3.383"></a><span id="l3.383" class="difflineplus">+            tags[tag.key] = tag;</span>
<a href="#l3.384"></a><span id="l3.384" class="difflineplus">+          }</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineplus">+        }</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineplus">+      }</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineplus">+      for each (let [, tag] in Iterator(tags)) {</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineplus">+        let tagNode = tagsNode.ownerDocument.createElement('span');</span>
<a href="#l3.389"></a><span id="l3.389" class="difflineplus">+        // see tagColors.css</span>
<a href="#l3.390"></a><span id="l3.390" class="difflineplus">+        let colorClass = &quot;blc-&quot; + this._msgTagService.getColorForKey(tag.key).substr(1);</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineplus">+        _mm_addClass(tagNode, &quot;tag &quot; + tag.tag + &quot; &quot; + colorClass);</span>
<a href="#l3.392"></a><span id="l3.392" class="difflineplus">+        tagNode.innerHTML = tag.tag;</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineplus">+        tagsNode.appendChild(tagNode);</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineplus">+      }</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineplus">+  },</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineplus">+</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineplus">+  /**</span>
<a href="#l3.398"></a><span id="l3.398">    * compute the size of the messages in the selection and display it</span>
<a href="#l3.399"></a><span id="l3.399">    * in the element of id &quot;size&quot;</span>
<a href="#l3.400"></a><span id="l3.400">   **/</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineminus">-  computeSize: function() {</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineminus">-    let htmlpane = pickMessagePane('multimessage');</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineplus">+  computeSize: function(htmlpane) {</span>
<a href="#l3.404"></a><span id="l3.404">     let numThreads = 0;</span>
<a href="#l3.405"></a><span id="l3.405">     let numBytes = 0;</span>
<a href="#l3.406"></a><span id="l3.406"> </span>
<a href="#l3.407"></a><span id="l3.407">     for (let [,msgHdr] in Iterator(this._msgHdrs))</span>
<a href="#l3.408"></a><span id="l3.408">       numBytes += msgHdr.messageSize; // XXX do something about news?</span>
<a href="#l3.409"></a><span id="l3.409">     let [size, unit] = DownloadUtils.convertByteUnits(numBytes);</span>
<a href="#l3.410"></a><span id="l3.410">     let sizeText = replaceInsert(gSelectionSummaryStrings.messagesSize, 1, size);</span>
<a href="#l3.411"></a><span id="l3.411">     sizeText = replaceInsert(sizeText, 2, unit);</span>
<a href="#l3.412"></a><span id="l3.412" class="difflineat">@@ -377,93 +419,66 @@ MultiMessageSummary.prototype = {</span>
<a href="#l3.413"></a><span id="l3.413">   /**</span>
<a href="#l3.414"></a><span id="l3.414">    * Given a set of items from a gloda collection, process them and update</span>
<a href="#l3.415"></a><span id="l3.415">    * the display accordingly.</span>
<a href="#l3.416"></a><span id="l3.416">    *</span>
<a href="#l3.417"></a><span id="l3.417">    * @param aItems</span>
<a href="#l3.418"></a><span id="l3.418">    *        contents of a gloda collection</span>
<a href="#l3.419"></a><span id="l3.419">   **/</span>
<a href="#l3.420"></a><span id="l3.420">   processItems: function(aItems) {</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineminus">-    var tagService = Components.classes[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l3.422"></a><span id="l3.422" class="difflineminus">-                     .getService(Components.interfaces.nsIMsgTagService);</span>
<a href="#l3.423"></a><span id="l3.423" class="difflineplus">+    let knownMessageNodes = [];</span>
<a href="#l3.424"></a><span id="l3.424"> </span>
<a href="#l3.425"></a><span id="l3.425" class="difflineminus">-    let seenTagNode = {};</span>
<a href="#l3.426"></a><span id="l3.426">     for (let [,glodaMsg] in Iterator(aItems)) {</span>
<a href="#l3.427"></a><span id="l3.427">       let messageKey = glodaMsg.messageKey;</span>
<a href="#l3.428"></a><span id="l3.428">       let domkey = messageKey + glodaMsg.folder.uri;</span>
<a href="#l3.429"></a><span id="l3.429"> </span>
<a href="#l3.430"></a><span id="l3.430" class="difflineminus">-      if (this._headerNodes) {</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineminus">-        let headerNode = this._headerNodes[domkey];</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineminus">-        // unread and starred will get set if any of the messages in a</span>
<a href="#l3.433"></a><span id="l3.433" class="difflineminus">-        // collapsed thread qualify</span>
<a href="#l3.434"></a><span id="l3.434" class="difflineminus">-        if (headerNode) {</span>
<a href="#l3.435"></a><span id="l3.435" class="difflineminus">-          if (! glodaMsg.read)</span>
<a href="#l3.436"></a><span id="l3.436" class="difflineminus">-            _mm_addClass(headerNode, &quot;unread&quot;);</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineminus">-          else</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineminus">-            _mm_removeClass(headerNode, &quot;unread&quot;);</span>
<a href="#l3.439"></a><span id="l3.439" class="difflineminus">-          if (glodaMsg.starred)</span>
<a href="#l3.440"></a><span id="l3.440" class="difflineminus">-            _mm_addClass(headerNode, &quot;starred&quot;);</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineminus">-          else</span>
<a href="#l3.442"></a><span id="l3.442" class="difflineminus">-            _mm_removeClass(headerNode, &quot;starred&quot;);</span>
<a href="#l3.443"></a><span id="l3.443" class="difflineminus">-        }</span>
<a href="#l3.444"></a><span id="l3.444" class="difflineplus">+      // Unread and starred will get set if any of the messages in a</span>
<a href="#l3.445"></a><span id="l3.445" class="difflineplus">+      // collapsed thread qualify</span>
<a href="#l3.446"></a><span id="l3.446" class="difflineplus">+      // The trick here is that we may get multiple items corresponding to the same</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineplus">+      // thread (and hence DOM node), so we need to detect when we get the first</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineplus">+      // item for a particular DOM node, stash the preexisting status of that DOM</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineplus">+      // node, an only do transitions if the items warrant it.</span>
<a href="#l3.450"></a><span id="l3.450" class="difflineplus">+      let headerNode = this._msgNodes[domkey];</span>
<a href="#l3.451"></a><span id="l3.451" class="difflineplus">+      if (! headerNode.flags) {</span>
<a href="#l3.452"></a><span id="l3.452" class="difflineplus">+        headerNode.flags = {};</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineplus">+        knownMessageNodes.push(headerNode);</span>
<a href="#l3.454"></a><span id="l3.454">       }</span>
<a href="#l3.455"></a><span id="l3.455" class="difflineminus">-      if (this._snippetNodes) {</span>
<a href="#l3.456"></a><span id="l3.456" class="difflineminus">-        let snippetNode = this._snippetNodes[domkey];</span>
<a href="#l3.457"></a><span id="l3.457" class="difflineminus">-</span>
<a href="#l3.458"></a><span id="l3.458" class="difflineminus">-        MsgHdrToMimeMessage(glodaMsg.folderMessage, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l3.459"></a><span id="l3.459" class="difflineminus">-          if (aMimeMsg == null)</span>
<a href="#l3.460"></a><span id="l3.460" class="difflineminus">-            return;</span>
<a href="#l3.461"></a><span id="l3.461" class="difflineplus">+      </span>
<a href="#l3.462"></a><span id="l3.462" class="difflineplus">+      if (! glodaMsg.read)</span>
<a href="#l3.463"></a><span id="l3.463" class="difflineplus">+        headerNode.flags['unread'] = true;</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineplus">+      if (glodaMsg.starred)</span>
<a href="#l3.465"></a><span id="l3.465" class="difflineplus">+        headerNode.flags['starred'] = true;</span>
<a href="#l3.466"></a><span id="l3.466"> </span>
<a href="#l3.467"></a><span id="l3.467" class="difflineminus">-          let text = Gloda.getMessageContent(glodaMsg, aMimeMsg).getContentSnippet(101);</span>
<a href="#l3.468"></a><span id="l3.468" class="difflineminus">-          if (snippetNode &amp;&amp; text)</span>
<a href="#l3.469"></a><span id="l3.469" class="difflineminus">-          {</span>
<a href="#l3.470"></a><span id="l3.470" class="difflineminus">-            let kSnippetLength = 100;</span>
<a href="#l3.471"></a><span id="l3.471" class="difflineminus">-            if (text.length &gt; kSnippetLength)</span>
<a href="#l3.472"></a><span id="l3.472" class="difflineminus">-              text = text.substring(0, kSnippetLength) + &quot;\u2026&quot;; // ellipsis</span>
<a href="#l3.473"></a><span id="l3.473" class="difflineminus">-            snippetNode.innerHTML = escapeXMLchars(text);</span>
<a href="#l3.474"></a><span id="l3.474" class="difflineminus">-          }</span>
<a href="#l3.475"></a><span id="l3.475" class="difflineminus">-        });</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineplus">+      // for tags, there's a minor problem in that if _some_ of the items in a</span>
<a href="#l3.477"></a><span id="l3.477" class="difflineplus">+      // thread got modified </span>
<a href="#l3.478"></a><span id="l3.478" class="difflineplus">+      let key = messageKey + glodaMsg.folder.uri;</span>
<a href="#l3.479"></a><span id="l3.479" class="difflineplus">+      let tagsNode = headerNode.getElementsByClassName('tags')[0];</span>
<a href="#l3.480"></a><span id="l3.480" class="difflineplus">+      while (tagsNode.firstChild)</span>
<a href="#l3.481"></a><span id="l3.481" class="difflineplus">+        tagsNode.removeChild(tagsNode.firstChild);</span>
<a href="#l3.482"></a><span id="l3.482" class="difflineplus">+      this._addTagNodes([msg.folderMessage for each ([i,msg] in Iterator(aItems))],</span>
<a href="#l3.483"></a><span id="l3.483" class="difflineplus">+                        tagsNode);</span>
<a href="#l3.484"></a><span id="l3.484" class="difflineplus">+    }</span>
<a href="#l3.485"></a><span id="l3.485"> </span>
<a href="#l3.486"></a><span id="l3.486" class="difflineminus">-      }</span>
<a href="#l3.487"></a><span id="l3.487" class="difflineminus">-      if (this._tagsNodes) {</span>
<a href="#l3.488"></a><span id="l3.488" class="difflineminus">-        // for tags, we need to do some fancy stuff, to figure out the set</span>
<a href="#l3.489"></a><span id="l3.489" class="difflineminus">-        // of tags that correspond to all of the messages in a collapsed</span>
<a href="#l3.490"></a><span id="l3.490" class="difflineminus">-        // thread.</span>
<a href="#l3.491"></a><span id="l3.491" class="difflineminus">-        let key = messageKey + glodaMsg.folder.uri;</span>
<a href="#l3.492"></a><span id="l3.492" class="difflineminus">-        let tagsNode = this._tagsNodes[key];</span>
<a href="#l3.493"></a><span id="l3.493" class="difflineminus">-        if (tagsNode) {</span>
<a href="#l3.494"></a><span id="l3.494" class="difflineminus">-          if (! seenTagNode[tagsNode]) {</span>
<a href="#l3.495"></a><span id="l3.495" class="difflineminus">-            // We haven't processed a message from this thread before</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineminus">-            while (tagsNode.childNodes.length) {</span>
<a href="#l3.497"></a><span id="l3.497" class="difflineminus">-              // get rid of all tags</span>
<a href="#l3.498"></a><span id="l3.498" class="difflineminus">-              tagsNode.removeChild(tagsNode.firstChild);</span>
<a href="#l3.499"></a><span id="l3.499" class="difflineminus">-            }</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-            seenTagNode[tagsNode] = {};</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineminus">-          }</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineminus">-          for each (let [,tag] in Iterator(glodaMsg.tags)) {</span>
<a href="#l3.503"></a><span id="l3.503" class="difflineminus">-            // have we already added this tag to the thread?</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineminus">-            if (!(seenTagNode[tagsNode][tag.tag])) {</span>
<a href="#l3.505"></a><span id="l3.505" class="difflineminus">-              let tagNode = tagsNode.ownerDocument.createElement('span');</span>
<a href="#l3.506"></a><span id="l3.506" class="difflineminus">-              // see tagColors.css</span>
<a href="#l3.507"></a><span id="l3.507" class="difflineminus">-              let colorClass = &quot;blc-&quot; + tagService.getColorForKey(tag.key).substr(1);</span>
<a href="#l3.508"></a><span id="l3.508" class="difflineminus">-              _mm_addClass(tagNode, &quot;tag &quot; + tag.tag + &quot; &quot; + colorClass);</span>
<a href="#l3.509"></a><span id="l3.509" class="difflineminus">-              tagNode.innerHTML = tag.tag;</span>
<a href="#l3.510"></a><span id="l3.510" class="difflineminus">-              tagsNode.appendChild(tagNode);</span>
<a href="#l3.511"></a><span id="l3.511" class="difflineminus">-              seenTagNode[tagsNode][tag.tag] = true;</span>
<a href="#l3.512"></a><span id="l3.512" class="difflineminus">-            }</span>
<a href="#l3.513"></a><span id="l3.513" class="difflineminus">-          }</span>
<a href="#l3.514"></a><span id="l3.514" class="difflineminus">-        }</span>
<a href="#l3.515"></a><span id="l3.515" class="difflineminus">-      }</span>
<a href="#l3.516"></a><span id="l3.516" class="difflineplus">+    for ([, headerNode] in Iterator(knownMessageNodes)) {</span>
<a href="#l3.517"></a><span id="l3.517" class="difflineplus">+      if (headerNode.flags['unread'])</span>
<a href="#l3.518"></a><span id="l3.518" class="difflineplus">+        _mm_addClass(headerNode, &quot;unread&quot;);</span>
<a href="#l3.519"></a><span id="l3.519" class="difflineplus">+      else</span>
<a href="#l3.520"></a><span id="l3.520" class="difflineplus">+        _mm_removeClass(headerNode, &quot;unread&quot;);</span>
<a href="#l3.521"></a><span id="l3.521" class="difflineplus">+      if (headerNode.flags['starred'])</span>
<a href="#l3.522"></a><span id="l3.522" class="difflineplus">+        _mm_addClass(headerNode, &quot;starred&quot;);</span>
<a href="#l3.523"></a><span id="l3.523" class="difflineplus">+      else</span>
<a href="#l3.524"></a><span id="l3.524" class="difflineplus">+        _mm_removeClass(headerNode, &quot;starred&quot;);</span>
<a href="#l3.525"></a><span id="l3.525" class="difflineplus">+      headerNode.flags = null;</span>
<a href="#l3.526"></a><span id="l3.526">     }</span>
<a href="#l3.527"></a><span id="l3.527">   },</span>
<a href="#l3.528"></a><span id="l3.528"> </span>
<a href="#l3.529"></a><span id="l3.529">   onQueryCompleted: function(aCollection) {</span>
<a href="#l3.530"></a><span id="l3.530" class="difflineminus">-    if (aCollection.items.length) {</span>
<a href="#l3.531"></a><span id="l3.531" class="difflineminus">-      this.processItems(aCollection.items);</span>
<a href="#l3.532"></a><span id="l3.532" class="difflineminus">-    }</span>
<a href="#l3.533"></a><span id="l3.533" class="difflineplus">+    /* if we need something that's just available from GlodaMessages,</span>
<a href="#l3.534"></a><span id="l3.534" class="difflineplus">+      this is where we'll get it initially */</span>
<a href="#l3.535"></a><span id="l3.535" class="difflineplus">+    return; </span>
<a href="#l3.536"></a><span id="l3.536">   }</span>
<a href="#l3.537"></a><span id="l3.537"> }</span>
<a href="#l3.538"></a><span id="l3.538"> </span>
<a href="#l3.539"></a><span id="l3.539"> </span>
<a href="#l3.540"></a><span id="l3.540"> /**</span>
<a href="#l3.541"></a><span id="l3.541">  * the ThreadSummary class is responsible for populating the message pane</span>
<a href="#l3.542"></a><span id="l3.542">  * with a reasonable summary of a set of messages that are are in a single</span>
<a href="#l3.543"></a><span id="l3.543">  * thread.</span>
<a href="#l3.544"></a><span id="l3.544" class="difflineat">@@ -484,18 +499,17 @@ function ThreadSummary(msgURIs)</span>
<a href="#l3.545"></a><span id="l3.545"> {</span>
<a href="#l3.546"></a><span id="l3.546">   this._msgURIs = msgURIs;</span>
<a href="#l3.547"></a><span id="l3.547"> }</span>
<a href="#l3.548"></a><span id="l3.548"> </span>
<a href="#l3.549"></a><span id="l3.549"> ThreadSummary.prototype = {</span>
<a href="#l3.550"></a><span id="l3.550">   __proto__: MultiMessageSummary.prototype,</span>
<a href="#l3.551"></a><span id="l3.551"> </span>
<a href="#l3.552"></a><span id="l3.552">   summarize: function() {</span>
<a href="#l3.553"></a><span id="l3.553" class="difflineminus">-    this._headerNodes = {};</span>
<a href="#l3.554"></a><span id="l3.554" class="difflineminus">-    this._snippetNodes = {};</span>
<a href="#l3.555"></a><span id="l3.555" class="difflineplus">+    this._msgNodes = {};</span>
<a href="#l3.556"></a><span id="l3.556"> </span>
<a href="#l3.557"></a><span id="l3.557">     let htmlpane = pickMessagePane('multimessage');</span>
<a href="#l3.558"></a><span id="l3.558"> </span>
<a href="#l3.559"></a><span id="l3.559">     let firstMsgHdr = messenger.msgHdrFromURI(this._msgURIs[0]);</span>
<a href="#l3.560"></a><span id="l3.560">     let numMessages = this._msgURIs.length;</span>
<a href="#l3.561"></a><span id="l3.561">     let subject = (firstMsgHdr.mime2DecodedSubject || gSelectionSummaryStrings[&quot;noSubject&quot;])</span>
<a href="#l3.562"></a><span id="l3.562">        + &quot; &quot;</span>
<a href="#l3.563"></a><span id="l3.563">        + PluralForm.get(numMessages, gSelectionSummaryStrings[&quot;Nmessages&quot;]).replace('#1', numMessages);</span>
<a href="#l3.564"></a><span id="l3.564" class="difflineat">@@ -508,91 +522,99 @@ ThreadSummary.prototype = {</span>
<a href="#l3.565"></a><span id="l3.565">       messagesElt.removeChild(messagesElt.firstChild);</span>
<a href="#l3.566"></a><span id="l3.566"> </span>
<a href="#l3.567"></a><span id="l3.567">     let headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;]</span>
<a href="#l3.568"></a><span id="l3.568">                                     .getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l3.569"></a><span id="l3.569">     let msgHdrs = new Array();</span>
<a href="#l3.570"></a><span id="l3.570">     let count = 0;</span>
<a href="#l3.571"></a><span id="l3.571">     const MAXCOUNT = 100;</span>
<a href="#l3.572"></a><span id="l3.572">     let maxCountExceeded = false;</span>
<a href="#l3.573"></a><span id="l3.573" class="difflineminus">-    for (var i = 0; i &lt; this._msgURIs.length; ++i)</span>
<a href="#l3.574"></a><span id="l3.574" class="difflineminus">-    {</span>
<a href="#l3.575"></a><span id="l3.575" class="difflineplus">+    for (let i = 0; i &lt; this._msgURIs.length; ++i) {</span>
<a href="#l3.576"></a><span id="l3.576">       count += 1;</span>
<a href="#l3.577"></a><span id="l3.577">       if (count &gt; MAXCOUNT) {</span>
<a href="#l3.578"></a><span id="l3.578">         maxCountExceeded = true;</span>
<a href="#l3.579"></a><span id="l3.579">         break;</span>
<a href="#l3.580"></a><span id="l3.580">       }</span>
<a href="#l3.581"></a><span id="l3.581" class="difflineminus">-      let msgHdr, msg, header, sender, snippet, tags;</span>
<a href="#l3.582"></a><span id="l3.582" class="difflineminus">-      msgHdr = messenger.msgHdrFromURI(this._msgURIs[i]);</span>
<a href="#l3.583"></a><span id="l3.583" class="difflineplus">+      let msgHdr = messenger.msgHdrFromURI(this._msgURIs[i]);</span>
<a href="#l3.584"></a><span id="l3.584">       msgHdrs.push(msgHdr);</span>
<a href="#l3.585"></a><span id="l3.585" class="difflineminus">-      msg = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineminus">-      let key = msgHdr.messageKey + msgHdr.folder.URI;</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineplus">+</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineplus">+      let msg_classes = &quot;message &quot;;</span>
<a href="#l3.589"></a><span id="l3.589" class="difflineplus">+      if (! msgHdr.isRead)</span>
<a href="#l3.590"></a><span id="l3.590" class="difflineplus">+        msg_classes += &quot; unread&quot;;</span>
<a href="#l3.591"></a><span id="l3.591" class="difflineplus">+      if (msgHdr.isFlagged)</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineplus">+        msg_classes += &quot; starred&quot;;</span>
<a href="#l3.593"></a><span id="l3.593" class="difflineplus">+</span>
<a href="#l3.594"></a><span id="l3.594" class="difflineplus">+      let senderName = headerParser.extractHeaderAddressName(msgHdr.mime2DecodedAuthor);</span>
<a href="#l3.595"></a><span id="l3.595" class="difflineplus">+      let date = makeFriendlyDateAgo(new Date(msgHdr.date/1000));</span>
<a href="#l3.596"></a><span id="l3.596"> </span>
<a href="#l3.597"></a><span id="l3.597" class="difflineminus">-      _mm_addClass(msg, &quot;message&quot;);</span>
<a href="#l3.598"></a><span id="l3.598" class="difflineminus">-</span>
<a href="#l3.599"></a><span id="l3.599" class="difflineminus">-      if (! msgHdr.isRead)</span>
<a href="#l3.600"></a><span id="l3.600" class="difflineminus">-        _mm_addClass(msg, &quot;unread&quot;);</span>
<a href="#l3.601"></a><span id="l3.601" class="difflineplus">+      let msgContents = &lt;div class=&quot;row&quot;&gt;</span>
<a href="#l3.602"></a><span id="l3.602" class="difflineplus">+                          &lt;div class=&quot;star&quot;/&gt;</span>
<a href="#l3.603"></a><span id="l3.603" class="difflineplus">+                          &lt;div class=&quot;header&quot;&gt;</span>
<a href="#l3.604"></a><span id="l3.604" class="difflineplus">+                            &lt;div class=&quot;wrappedsender&quot;&gt;</span>
<a href="#l3.605"></a><span id="l3.605" class="difflineplus">+                              &lt;div class=&quot;sender link&quot;&gt;{senderName}&lt;/div&gt;</span>
<a href="#l3.606"></a><span id="l3.606" class="difflineplus">+                              &lt;div class=&quot;date&quot;&gt;{date}&lt;/div&gt;</span>
<a href="#l3.607"></a><span id="l3.607" class="difflineplus">+                              &lt;div class=&quot;tags&quot;&gt;&lt;/div&gt;</span>
<a href="#l3.608"></a><span id="l3.608" class="difflineplus">+                            &lt;/div&gt;</span>
<a href="#l3.609"></a><span id="l3.609" class="difflineplus">+                            &lt;div class=&quot;snippet&quot;&gt;&lt;/div&gt;</span>
<a href="#l3.610"></a><span id="l3.610" class="difflineplus">+                          &lt;/div&gt;</span>
<a href="#l3.611"></a><span id="l3.611" class="difflineplus">+                        &lt;/div&gt;;</span>
<a href="#l3.612"></a><span id="l3.612"> </span>
<a href="#l3.613"></a><span id="l3.613" class="difflineminus">-      header = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.614"></a><span id="l3.614" class="difflineminus">-      _mm_addClass(header, &quot;header&quot;);</span>
<a href="#l3.615"></a><span id="l3.615" class="difflineminus">-      if (msgHdr.isFlagged)</span>
<a href="#l3.616"></a><span id="l3.616" class="difflineminus">-        _mm_addClass(msg, &quot;starred&quot;);</span>
<a href="#l3.617"></a><span id="l3.617" class="difflineplus">+      let msgNode = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.618"></a><span id="l3.618" class="difflineplus">+      msgNode.innerHTML = msgContents.toXMLString();</span>
<a href="#l3.619"></a><span id="l3.619" class="difflineplus">+      _mm_addClass(msgNode, msg_classes);</span>
<a href="#l3.620"></a><span id="l3.620" class="difflineplus">+      messagesElt.appendChild(msgNode);</span>
<a href="#l3.621"></a><span id="l3.621"> </span>
<a href="#l3.622"></a><span id="l3.622" class="difflineminus">-      let senderName = headerParser.extractHeaderAddressNames(msgHdr.mime2DecodedAuthor);</span>
<a href="#l3.623"></a><span id="l3.623" class="difflineminus">-      senderName = this.stripQuotes(senderName);</span>
<a href="#l3.624"></a><span id="l3.624" class="difflineminus">-      sender = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.625"></a><span id="l3.625" class="difflineplus">+      let key = msgHdr.messageKey + msgHdr.folder.URI;</span>
<a href="#l3.626"></a><span id="l3.626" class="difflineplus">+      let snippetNode = msgNode.getElementsByClassName(&quot;snippet&quot;)[0];</span>
<a href="#l3.627"></a><span id="l3.627" class="difflineplus">+      let senderNode = msgNode.getElementsByClassName(&quot;sender&quot;)[0];</span>
<a href="#l3.628"></a><span id="l3.628" class="difflineplus">+      MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l3.629"></a><span id="l3.629" class="difflineplus">+          if (aMimeMsg == null) /* shouldn't happen, but sometimes does? */</span>
<a href="#l3.630"></a><span id="l3.630" class="difflineplus">+            return;</span>
<a href="#l3.631"></a><span id="l3.631" class="difflineplus">+          let [text, meta] = mimeMsgToContentSnippetAndMeta(aMimeMsg,</span>
<a href="#l3.632"></a><span id="l3.632" class="difflineplus">+                                                            aMsgHdr.folder, 200);</span>
<a href="#l3.633"></a><span id="l3.633" class="difflineplus">+          snippetNode.innerHTML = escapeXMLchars(text);</span>
<a href="#l3.634"></a><span id="l3.634" class="difflineplus">+          if (meta.author)</span>
<a href="#l3.635"></a><span id="l3.635" class="difflineplus">+            senderNode.innerHTML = escapeXMLchars(meta.author);</span>
<a href="#l3.636"></a><span id="l3.636" class="difflineplus">+      });</span>
<a href="#l3.637"></a><span id="l3.637" class="difflineplus">+</span>
<a href="#l3.638"></a><span id="l3.638" class="difflineplus">+      let tagsNode = msgNode.getElementsByClassName(&quot;tags&quot;)[0];</span>
<a href="#l3.639"></a><span id="l3.639" class="difflineplus">+      let tags = this.getTagsForMsg(msgHdr);</span>
<a href="#l3.640"></a><span id="l3.640" class="difflineplus">+      for each (let [,tag] in Iterator(tags)) {</span>
<a href="#l3.641"></a><span id="l3.641" class="difflineplus">+        let tagNode = tagsNode.ownerDocument.createElement('span');</span>
<a href="#l3.642"></a><span id="l3.642" class="difflineplus">+        // see tagColors.css</span>
<a href="#l3.643"></a><span id="l3.643" class="difflineplus">+        let colorClass = &quot;blc-&quot; + this._msgTagService.getColorForKey(tag.key).substr(1);</span>
<a href="#l3.644"></a><span id="l3.644" class="difflineplus">+        _mm_addClass(tagNode, &quot;tag &quot; + tag.tag + &quot; &quot; + colorClass);</span>
<a href="#l3.645"></a><span id="l3.645" class="difflineplus">+        tagNode.innerHTML = tag.tag;</span>
<a href="#l3.646"></a><span id="l3.646" class="difflineplus">+        tagsNode.appendChild(tagNode);</span>
<a href="#l3.647"></a><span id="l3.647" class="difflineplus">+      }</span>
<a href="#l3.648"></a><span id="l3.648" class="difflineplus">+      </span>
<a href="#l3.649"></a><span id="l3.649" class="difflineplus">+      let sender = msgNode.getElementsByClassName(&quot;sender&quot;)[0];</span>
<a href="#l3.650"></a><span id="l3.650">       sender.msgHdr = msgHdr;</span>
<a href="#l3.651"></a><span id="l3.651" class="difflineminus">-      _mm_addClass(sender, &quot;sender&quot;);</span>
<a href="#l3.652"></a><span id="l3.652">       sender.addEventListener(&quot;click&quot;, function(e) {</span>
<a href="#l3.653"></a><span id="l3.653">         // if the msg is the first message in a collapsed thread, we need to</span>
<a href="#l3.654"></a><span id="l3.654">         // uncollapse it.</span>
<a href="#l3.655"></a><span id="l3.655">         let origRowCount = gDBView.rowCount;</span>
<a href="#l3.656"></a><span id="l3.656">         let viewIndex = gDBView.findIndexOfMsgHdr(e.target.msgHdr, true);</span>
<a href="#l3.657"></a><span id="l3.657">         gDBView.selectFolderMsgByKey(this.folder, this.msgKey);</span>
<a href="#l3.658"></a><span id="l3.658">         if (gDBView.rowCount != origRowCount)</span>
<a href="#l3.659"></a><span id="l3.659">           gDBView.selectionChanged();</span>
<a href="#l3.660"></a><span id="l3.660">       }, true);</span>
<a href="#l3.661"></a><span id="l3.661" class="difflineminus">-      _mm_addClass(sender, &quot;link&quot;);</span>
<a href="#l3.662"></a><span id="l3.662" class="difflineminus">-      sender.innerHTML = escapeXMLchars(senderName); // escape?</span>
<a href="#l3.663"></a><span id="l3.663">       sender.folder = msgHdr.folder;</span>
<a href="#l3.664"></a><span id="l3.664">       sender.msgKey = msgHdr.messageKey;</span>
<a href="#l3.665"></a><span id="l3.665"> </span>
<a href="#l3.666"></a><span id="l3.666" class="difflineminus">-      let wrappedsender = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.667"></a><span id="l3.667" class="difflineminus">-      _mm_addClass(wrappedsender, &quot;wrappedsender&quot;);</span>
<a href="#l3.668"></a><span id="l3.668" class="difflineminus">-      let star = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.669"></a><span id="l3.669" class="difflineminus">-      _mm_addClass(star, &quot;star&quot;);</span>
<a href="#l3.670"></a><span id="l3.670" class="difflineminus">-      wrappedsender.appendChild(sender);</span>
<a href="#l3.671"></a><span id="l3.671" class="difflineminus">-</span>
<a href="#l3.672"></a><span id="l3.672" class="difflineminus">-      header.appendChild(wrappedsender);</span>
<a href="#l3.673"></a><span id="l3.673" class="difflineminus">-</span>
<a href="#l3.674"></a><span id="l3.674" class="difflineminus">-      snippet = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.675"></a><span id="l3.675" class="difflineminus">-      _mm_addClass(snippet, &quot;snippet&quot;);</span>
<a href="#l3.676"></a><span id="l3.676" class="difflineminus">-      header.appendChild(snippet);</span>
<a href="#l3.677"></a><span id="l3.677" class="difflineplus">+      this._msgNodes[key] = msgNode;</span>
<a href="#l3.678"></a><span id="l3.678"> </span>
<a href="#l3.679"></a><span id="l3.679" class="difflineminus">-      tags = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.680"></a><span id="l3.680" class="difflineminus">-      _mm_addClass(tags, &quot;tags&quot;);</span>
<a href="#l3.681"></a><span id="l3.681" class="difflineminus">-      header.appendChild(tags);</span>
<a href="#l3.682"></a><span id="l3.682" class="difflineminus">-</span>
<a href="#l3.683"></a><span id="l3.683" class="difflineminus">-      this._headerNodes[key] = msg;</span>
<a href="#l3.684"></a><span id="l3.684" class="difflineminus">-      this._snippetNodes[key] = snippet;</span>
<a href="#l3.685"></a><span id="l3.685" class="difflineminus">-      this._tagsNodes[key] = tags;</span>
<a href="#l3.686"></a><span id="l3.686" class="difflineminus">-</span>
<a href="#l3.687"></a><span id="l3.687" class="difflineminus">-      msg.appendChild(header);</span>
<a href="#l3.688"></a><span id="l3.688" class="difflineminus">-      let dateNode = htmlpane.contentDocument.createElement(&quot;div&quot;);</span>
<a href="#l3.689"></a><span id="l3.689" class="difflineminus">-      dateNode.innerHTML = makeFriendlyDateAgo(new Date(msgHdr.date/1000));</span>
<a href="#l3.690"></a><span id="l3.690" class="difflineminus">-      dateNode.appendChild(star);</span>
<a href="#l3.691"></a><span id="l3.691" class="difflineminus">-      _mm_addClass(dateNode, &quot;date&quot;);</span>
<a href="#l3.692"></a><span id="l3.692" class="difflineminus">-      msg.appendChild(dateNode);</span>
<a href="#l3.693"></a><span id="l3.693" class="difflineminus">-      messagesElt.appendChild(msg);</span>
<a href="#l3.694"></a><span id="l3.694" class="difflineplus">+      messagesElt.appendChild(msgNode);</span>
<a href="#l3.695"></a><span id="l3.695">     }</span>
<a href="#l3.696"></a><span id="l3.696" class="difflineplus">+    </span>
<a href="#l3.697"></a><span id="l3.697">     // stash somewhere so it doesn't get GC'ed</span>
<a href="#l3.698"></a><span id="l3.698">     this._glodaQueries.push(Gloda.getMessageCollectionForHeaders(msgHdrs, this));</span>
<a href="#l3.699"></a><span id="l3.699">     this.notifyMaxCountExceeded(numMessages, MAXCOUNT);</span>
<a href="#l3.700"></a><span id="l3.700"> </span>
<a href="#l3.701"></a><span id="l3.701" class="difflineminus">-    this.computeSize();</span>
<a href="#l3.702"></a><span id="l3.702" class="difflineplus">+    this.computeSize(htmlpane);</span>
<a href="#l3.703"></a><span id="l3.703">   }</span>
<a href="#l3.704"></a><span id="l3.704"> }</span>
<a href="#l3.705"></a><span id="l3.705"> </span>
<a href="#l3.706"></a><span id="l3.706"> // We use a global to prevent GC of gloda collection (and we reuse it to prevent</span>
<a href="#l3.707"></a><span id="l3.707"> // leaks).  Without a global, the GC is aggressive enough that the gloda query</span>
<a href="#l3.708"></a><span id="l3.708"> // is gone before it returns.</span>
<a href="#l3.709"></a><span id="l3.709"> var gSummary;</span>
<a href="#l3.710"></a><span id="l3.710"> </span>
<a href="#l3.711"></a><span id="l3.711" class="difflineat">@@ -741,19 +763,18 @@ function replaceInsert(aText, aIndex, aV</span>
<a href="#l3.712"></a><span id="l3.712">  * innerHTML.</span>
<a href="#l3.713"></a><span id="l3.713">  *</span>
<a href="#l3.714"></a><span id="l3.714">  * @param s</span>
<a href="#l3.715"></a><span id="l3.715">  *        input text</span>
<a href="#l3.716"></a><span id="l3.716">  * @return The string with &lt;, &gt;, and &amp; replaced by the corresponding entities.</span>
<a href="#l3.717"></a><span id="l3.717">  */</span>
<a href="#l3.718"></a><span id="l3.718"> function escapeXMLchars(s)</span>
<a href="#l3.719"></a><span id="l3.719"> {</span>
<a href="#l3.720"></a><span id="l3.720" class="difflineminus">-    return s.replace(/[&lt;&gt;&amp;]/g, function(s) {</span>
<a href="#l3.721"></a><span id="l3.721" class="difflineminus">-        switch (s) {</span>
<a href="#l3.722"></a><span id="l3.722" class="difflineminus">-            case &quot;&lt;&quot;: return &quot;&amp;lt;&quot;;</span>
<a href="#l3.723"></a><span id="l3.723" class="difflineminus">-            case &quot;&gt;&quot;: return &quot;&amp;gt;&quot;;</span>
<a href="#l3.724"></a><span id="l3.724" class="difflineminus">-            case &quot;&amp;&quot;: return &quot;&amp;amp;&quot;;</span>
<a href="#l3.725"></a><span id="l3.725" class="difflineminus">-            default: throw Error(&quot;Unexpected match&quot;);</span>
<a href="#l3.726"></a><span id="l3.726" class="difflineminus">-            }</span>
<a href="#l3.727"></a><span id="l3.727" class="difflineminus">-        }</span>
<a href="#l3.728"></a><span id="l3.728" class="difflineminus">-    );</span>
<a href="#l3.729"></a><span id="l3.729" class="difflineplus">+  return s.replace(/[&lt;&gt;&amp;]/g, function(s) {</span>
<a href="#l3.730"></a><span id="l3.730" class="difflineplus">+      switch (s) {</span>
<a href="#l3.731"></a><span id="l3.731" class="difflineplus">+          case &quot;&lt;&quot;: return &quot;&amp;lt;&quot;;</span>
<a href="#l3.732"></a><span id="l3.732" class="difflineplus">+          case &quot;&gt;&quot;: return &quot;&amp;gt;&quot;;</span>
<a href="#l3.733"></a><span id="l3.733" class="difflineplus">+          case &quot;&amp;&quot;: return &quot;&amp;amp;&quot;;</span>
<a href="#l3.734"></a><span id="l3.734" class="difflineplus">+          default: throw Error(&quot;Unexpected match&quot;);</span>
<a href="#l3.735"></a><span id="l3.735" class="difflineplus">+          }</span>
<a href="#l3.736"></a><span id="l3.736" class="difflineplus">+      }</span>
<a href="#l3.737"></a><span id="l3.737" class="difflineplus">+  );</span>
<a href="#l3.738"></a><span id="l3.738"> }</span>
<a href="#l3.739"></a><span id="l3.739" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/mail/base/content/sharedsummary.css</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,39 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+/* Generic (cross-platform) multimessage view CSS.  Some bits will be overriden</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+  by theme specific files */</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+body {</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+  font-family: sans-serif;</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+  margin: 0;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+  padding: 0;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  background-color: white;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+}</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+.hidden {</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  visibility: hidden;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  display: none !important; /* need to override the display property that sets inline-block */</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+}</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+#mozupdate {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+  clear: both;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  -moz-border-radius: 0.4ex;</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+  border: 1px solid #FFD8B9;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+  left: 1em;</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  right: 1em;</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  padding: 0.5em;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+}</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+a {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  color: darkblue;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+  font-weight: bold;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+}</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+a:hover {</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+  text-decoration: underline; </span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+}</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+.link:hover {</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  text-decoration: underline;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  cursor: pointer;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -71,16 +71,17 @@ messenger.jar:</span>
<a href="#l5.4"></a><span id="l5.4">     content/messenger/composerOverlay.css           (content/composerOverlay.css)</span>
<a href="#l5.5"></a><span id="l5.5">     content/messenger/threadPane.js                 (content/threadPane.js)</span>
<a href="#l5.6"></a><span id="l5.6"> #ifdef XP_MACOSX</span>
<a href="#l5.7"></a><span id="l5.7">     content/messenger/macMenuOverlay.xul            (content/macMenuOverlay.xul)</span>
<a href="#l5.8"></a><span id="l5.8"> #endif</span>
<a href="#l5.9"></a><span id="l5.9"> *   content/messenger/baseMenuOverlay.xul           (content/baseMenuOverlay.xul)</span>
<a href="#l5.10"></a><span id="l5.10">     content/messenger/selectionsummaries.js         (content/selectionsummaries.js)</span>
<a href="#l5.11"></a><span id="l5.11">     content/messenger/multimessageview.css          (content/multimessageview.css)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    content/messenger/sharedsummary.css             (content/sharedsummary.css)</span>
<a href="#l5.13"></a><span id="l5.13">     content/messenger/multimessageview.xhtml        (content/multimessageview.xhtml)</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> comm.jar:</span>
<a href="#l5.16"></a><span id="l5.16"> % content communicator %content/communicator/ xpcnativewrappers=yes</span>
<a href="#l5.17"></a><span id="l5.17"> *  content/communicator/contentAreaClick.js         (content/contentAreaClick.js)</span>
<a href="#l5.18"></a><span id="l5.18"> *  content/communicator/utilityOverlay.xul          (content/utilityOverlay.xul)</span>
<a href="#l5.19"></a><span id="l5.19"> *  content/communicator/utilityOverlay.js           (content/utilityOverlay.js)</span>
<a href="#l5.20"></a><span id="l5.20"> *  content/communicator/nsContextMenu.js            (content/nsContextMenu.js)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/multimessageview.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/multimessageview.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,16 +1,13 @@</span>
<a href="#l6.4"></a><span id="l6.4"> # LOCALIZATION NOTE (selectedNMessages, acrossNThreads): Semi-colon list of plural forms.</span>
<a href="#l6.5"></a><span id="l6.5"> # See: http://developer.mozilla.org/en/docs/Localization_and_Plurals</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-# #1 number of messages</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-# example: Selected: 23 messages</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-selectedNMessages=Selected: #1 message;Selected: #1 messages</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-# #1 number of threads</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-# example: across 3 threads</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-acrossNThreads= across #1 thread; across #1 threads</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+# #1 number of threads or solitary messages selected</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+# example: 4 conversations</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+NConversations=#1 conversation; #1 conversations</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16"> numMsgs=#1 message;#1 messages</span>
<a href="#l6.17"></a><span id="l6.17"> countUnread=, #1 unread;, #1 unread</span>
<a href="#l6.18"></a><span id="l6.18"> Nmessages=(#1 message);(#1 messages)</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> noSubject=(no subject)</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22"> # thread and multiple message selection summaries</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/db/gloda/modules/connotent.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/connotent.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -15,42 +15,120 @@</span>
<a href="#l7.4"></a><span id="l7.4">  *</span>
<a href="#l7.5"></a><span id="l7.5">  * The Initial Developer of the Original Code is</span>
<a href="#l7.6"></a><span id="l7.6">  * Mozilla Messaging, Inc.</span>
<a href="#l7.7"></a><span id="l7.7">  * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l7.8"></a><span id="l7.8">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l7.9"></a><span id="l7.9">  *</span>
<a href="#l7.10"></a><span id="l7.10">  * Contributor(s):</span>
<a href="#l7.11"></a><span id="l7.11">  *   Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+ *   David Ascerh &lt;dascher@mozillamessaging.com&gt;</span>
<a href="#l7.13"></a><span id="l7.13">  *</span>
<a href="#l7.14"></a><span id="l7.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l7.15"></a><span id="l7.15">  * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l7.16"></a><span id="l7.16">  * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l7.17"></a><span id="l7.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l7.18"></a><span id="l7.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l7.19"></a><span id="l7.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l7.20"></a><span id="l7.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.21"></a><span id="l7.21">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l7.22"></a><span id="l7.22">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.23"></a><span id="l7.23">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.24"></a><span id="l7.24">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.25"></a><span id="l7.25">  * </span>
<a href="#l7.26"></a><span id="l7.26">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-EXPORTED_SYMBOLS = ['GlodaContent'];</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+EXPORTED_SYMBOLS = ['GlodaContent', 'whittlerRegistry',</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+                    'mimeMsgToContentAndMeta', 'mimeMsgToContentSnippetAndMeta'];</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32"> const Cc = Components.classes;</span>
<a href="#l7.33"></a><span id="l7.33"> const Ci = Components.interfaces;</span>
<a href="#l7.34"></a><span id="l7.34"> const Cr = Components.results;</span>
<a href="#l7.35"></a><span id="l7.35"> const Cu = Components.utils;</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37"> Cu.import(&quot;resource://app/modules/gloda/log4moz.js&quot;);</span>
<a href="#l7.38"></a><span id="l7.38"> </span>
<a href="#l7.39"></a><span id="l7.39"> const LOG = Log4Moz.repository.getLogger(&quot;gloda.connotent&quot;);</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+/**</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+ * Given a MimeMsg and the corresponding folder, return the GlodaContent object.</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+ *</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+ * @param aMimeMsg: the MimeMessage instance</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+ * @param folder: the nsIMsgDBFolder</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+ * @return an array containing the GlodaContent instance, and the meta dictionary</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+ * that the Gloda content providers may have filled with useful data.</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+ */</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+function mimeMsgToContentAndMeta(aMimeMsg, folder) {</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+  let content = new GlodaContent();</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+  let meta = {subject: aMimeMsg.get(&quot;subject&quot;)};</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+  let bodyLines = aMimeMsg.coerceBodyToPlaintext(folder).split(/\r?\n/);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+  for each (let [, whittler] in Iterator(whittlerRegistry.getWhittlers()))</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+    whittler.contentWhittle(meta, bodyLines, content);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  return [content, meta];</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+}</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+/**</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+ * Given a MimeMsg, return the whittled content string, suitable for summarizing</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+ * a message.</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+ *</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+ * @param aMimeMsg: the MimeMessage instance</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+ * @param folder: the nsIMsgDBFolder</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+ * @param length: optional number of characters to trim the whittled content.</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+ * If the actual length of the message is greater than |length|, then the return</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+ * value is the first (length-1) characters with an ellipsis appended.</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+ * @return an array containing the text of the snippet, and the meta dictionary</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+ * that the Gloda content providers may have filled with useful data.</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+ */</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+function mimeMsgToContentSnippetAndMeta(aMimeMsg, folder, length) {</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  let [content, meta] = mimeMsgToContentAndMeta(aMimeMsg, folder);</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+  </span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+  let text = content.getContentSnippet(length);</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+  if (length &amp;&amp; text.length &gt; length)</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+    text = text.substring(0, length-1) + &quot;\u2026&quot;; // ellipsis</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+  return [text, meta];</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+}</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+/**</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+ * A registry of gloda providers that have contentWhittle() functions.</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+ * used by mimeMsgToContentSnippet, but populated by the Gloda object as it's</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+ * processing providers.</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+ */</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineplus">+function WhittlerRegistry() {</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+  this._whittlers = [];</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+}</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+WhittlerRegistry.prototype = {</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+  /**</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+   * Add a provider as a content whittler.</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+   */</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+  registerWhittler: function whittler_registry_registerWhittler(provider) {</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+    this._whittlers.push(provider);</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+  },</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+  /**</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+   * get the list of content whittlers, sorted from the most specific to</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+   * the most generic</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+   */</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+  getWhittlers: function whittler_registry_getWhittlers() {</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+    // Use the concat() trick to avoid mutating the internal object and</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+    // leaking an internal representation.</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+    return this._whittlers.concat().reverse();</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+  }</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+}</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+whittlerRegistry = new WhittlerRegistry();</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+</span>
<a href="#l7.117"></a><span id="l7.117"> function GlodaContent() {</span>
<a href="#l7.118"></a><span id="l7.118">   this._contentPriority = null;</span>
<a href="#l7.119"></a><span id="l7.119">   this._producing = false;</span>
<a href="#l7.120"></a><span id="l7.120">   this._hunks = [];</span>
<a href="#l7.121"></a><span id="l7.121"> }</span>
<a href="#l7.122"></a><span id="l7.122"> </span>
<a href="#l7.123"></a><span id="l7.123"> GlodaContent.prototype = {</span>
<a href="#l7.124"></a><span id="l7.124">   kPriorityBase: 0,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/db/gloda/modules/fundattr.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/fundattr.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -473,18 +473,17 @@ var GlodaFundAttr = {</span>
<a href="#l8.4"></a><span id="l8.4">     if (fromMeTo.length)</span>
<a href="#l8.5"></a><span id="l8.5">       aGlodaMessage.fromMeTo = fromMeTo;</span>
<a href="#l8.6"></a><span id="l8.6">     if (ccMe.length)</span>
<a href="#l8.7"></a><span id="l8.7">       aGlodaMessage.ccMe = ccMe;</span>
<a href="#l8.8"></a><span id="l8.8">     if (fromMeCc.length)</span>
<a href="#l8.9"></a><span id="l8.9">       aGlodaMessage.fromMeCc = fromMeCc;</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">     if (aRawReps.bodyLines &amp;&amp;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        this.contentWhittle(aGlodaMessage, {}, aRawReps.bodyLines,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-                            aRawReps.content)) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+        this.contentWhittle({}, aRawReps.bodyLines, aRawReps.content)) {</span>
<a href="#l8.15"></a><span id="l8.15">       // we were going to do something here?</span>
<a href="#l8.16"></a><span id="l8.16">     }</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">     yield Gloda.kWorkDone;</span>
<a href="#l8.19"></a><span id="l8.19">   },</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   _countQuoteDepthAndNormalize:</span>
<a href="#l8.22"></a><span id="l8.22">     function gloda_fundattr__countQuoteDepthAndNormalize(aLine) {</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineat">@@ -509,18 +508,18 @@ var GlodaFundAttr = {</span>
<a href="#l8.24"></a><span id="l8.24">   },</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">   /**</span>
<a href="#l8.27"></a><span id="l8.27">    * Attempt to understand simple quoting constructs that use &quot;&gt;&quot; with</span>
<a href="#l8.28"></a><span id="l8.28">    * obvious phrases to enter the quoting block.  No support for other types</span>
<a href="#l8.29"></a><span id="l8.29">    * of quoting at this time.  Also no support for piercing the wrapper of</span>
<a href="#l8.30"></a><span id="l8.30">    * forwarded messages to actually be the content of the forwarded message.</span>
<a href="#l8.31"></a><span id="l8.31">    */</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-  contentWhittle: function gloda_fundattr_contentWhittle(aGlodaMessage,</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-      aMeta, aBodyLines, aContent) {</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  contentWhittle: function gloda_fundattr_contentWhittle(aMeta,</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+      aBodyLines, aContent) {</span>
<a href="#l8.36"></a><span id="l8.36">     if (!aContent.volunteerContent(aContent.kPriorityBase))</span>
<a href="#l8.37"></a><span id="l8.37">       return false;</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">     // duplicate the list; we mutate somewhat...</span>
<a href="#l8.40"></a><span id="l8.40">     let bodyLines = aBodyLines.concat();</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42">     // lastNonBlankLine originally was just for detecting quoting idioms where</span>
<a href="#l8.43"></a><span id="l8.43">     //  the &quot;wrote&quot; line was separated from the quoted block by a blank line.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/db/gloda/modules/gloda.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/gloda.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -315,42 +315,18 @@ var Gloda = {</span>
<a href="#l9.4"></a><span id="l9.4">       clause.folder(folder);</span>
<a href="#l9.5"></a><span id="l9.5">       let messageKeys = [hdr.messageKey for each (hdr in headersForFolder)];</span>
<a href="#l9.6"></a><span id="l9.6">       clause.messageKey.apply(clause, messageKeys);</span>
<a href="#l9.7"></a><span id="l9.7">     }</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">     return query.getCollection(aListener, aData);</span>
<a href="#l9.10"></a><span id="l9.10">   },</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  getMessageContent: function gloda_ns_getMessageContent(aGlodaMessage,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-      aMimeMsg) {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-    let content = new GlodaContent();</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-    let meta = {subject: aMimeMsg.get(&quot;subject&quot;)};</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-    let bodyLines = aMimeMsg.coerceBodyToPlaintext(</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-                      aGlodaMessage.folderMessage.folder).split(/\r?\n/);</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-    // get the provider list in reverse order, mainly because we want more</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-    //  specific content processors to get a chance before the default one</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-    let attributeProviders =</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-      this._attrProviderOrderByNoun[this.NOUN_MESSAGE].concat().reverse();</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-    for each (let [, attrProvider] in Iterator(attributeProviders)) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-      if (attrProvider.contentWhittle) {</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-        try {</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-          attrProvider.contentWhittle(aGlodaMessage, meta, bodyLines, content);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-        }</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-        catch (ex) {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-          this._log.warn(&quot;Content whittler exception &quot; + ex.fileName + &quot;:&quot; +</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-            ex.lineNumber + &quot;: &quot; + ex);</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-        }</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-      }</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-    }</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-    return content;</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  getMessageContent: function gloda_ns_getMessageContent(aGlodaMessage, aMimeMsg) {</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+    return mimeMsgToContentAndMeta(aMimeMsg, aGlodaMessage.folderMessage.folder)[0];</span>
<a href="#l9.40"></a><span id="l9.40">   },</span>
<a href="#l9.41"></a><span id="l9.41"> </span>
<a href="#l9.42"></a><span id="l9.42">   getFolderForFolder: function gloda_ns_getFolderForFolder(aMsgFolder) {</span>
<a href="#l9.43"></a><span id="l9.43">     return GlodaDatastore._mapFolder(aMsgFolder);</span>
<a href="#l9.44"></a><span id="l9.44">   },</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46">   /**</span>
<a href="#l9.47"></a><span id="l9.47">    * Takes one or more strings containing lists of comma-delimited e-mail</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineat">@@ -1412,16 +1388,19 @@ var Gloda = {</span>
<a href="#l9.49"></a><span id="l9.49">       }</span>
<a href="#l9.50"></a><span id="l9.50"> </span>
<a href="#l9.51"></a><span id="l9.51">       if (aAttrDef.objectNounDef.tableName ||</span>
<a href="#l9.52"></a><span id="l9.52">           aAttrDef.objectNounDef.contributeObjDependencies) {</span>
<a href="#l9.53"></a><span id="l9.53">         subjectNounDef.hasObjDependencies = true;</span>
<a href="#l9.54"></a><span id="l9.54">       }</span>
<a href="#l9.55"></a><span id="l9.55">     }</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+    if (aAttrDef.provider.contentWhittle)</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+      whittlerRegistry.registerWhittler(aAttrDef.provider)</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+</span>
<a href="#l9.60"></a><span id="l9.60">     this._attrProviders[aAttrDef.provider.providerName].push(aAttrDef);</span>
<a href="#l9.61"></a><span id="l9.61">     return aAttrDef;</span>
<a href="#l9.62"></a><span id="l9.62">   },</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64">   /**</span>
<a href="#l9.65"></a><span id="l9.65">    * Retrieve the attribute provided by the given extension with the given</span>
<a href="#l9.66"></a><span id="l9.66">    *  attribute name.  The original idea was that plugins would effectively</span>
<a href="#l9.67"></a><span id="l9.67">    *  name-space attributes, helping avoid collisions.  Since we are leaning</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

