<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12997:ec3cd803c556650aac854e34fdb4e4ee2ecf87e2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ec3cd803c556650aac854e34fdb4e4ee2ecf87e2" />
<meta property="og:url" content="/comm-central/rev/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2" />
<meta property="og:description" content="Bug 910989. Remove nsTHashtable::Init, fallible allocation, and MT hashtables. r=jcranmer,a=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ec3cd803c556650aac854e34fdb4e4ee2ecf87e2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">shortlog</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">files</a> |
changeset |
<a href="/comm-central/raw-rev/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">raw</a>  | <a href="/comm-central/archive/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=910989">Bug 910989</a>. Remove nsTHashtable::Init, fallible allocation, and MT hashtables. r=jcranmer,a=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#101;&#114;&#116;&#32;&#79;&#39;&#67;&#97;&#108;&#108;&#97;&#104;&#97;&#110;&#32;&#60;&#114;&#111;&#98;&#101;&#114;&#116;&#64;&#111;&#99;&#97;&#108;&#108;&#97;&#104;&#97;&#110;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 06 Sep 2013 10:32:31 +0100</td></tr>

<tr>
 <td>changeset 12997</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">ec3cd803c556650aac854e34fdb4e4ee2ecf87e2</a></td>
</tr>



<tr>
<td>parent 12996</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/dd53119788d828291985f9be14fff04842524d3a">dd53119788d828291985f9be14fff04842524d3a</a>
</td>
</tr>

<tr>
<td>child 12998</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/838cfd8efab4a9026a897dde45bd93aa2f876d9c">838cfd8efab4a9026a897dde45bd93aa2f876d9c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">9475</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 06 Sep 2013 09:32:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ec3cd803c556 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&newProject=comm-central&newRevision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&newProject=comm-central&newRevision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&newProject=comm-central&newRevision=ec3cd803c556650aac854e34fdb4e4ee2ecf87e2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jcranmer%29&revcount=50">jcranmer</a>, <a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=910989">910989</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=910989">Bug 910989</a>. Remove nsTHashtable::Init, fallible allocation, and MT hashtables. r=jcranmer,a=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/calendar/base/backend/libical/calICSService.h">calendar/base/backend/libical/calICSService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/calendar/base/backend/libical/calICSService.h">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/calendar/base/backend/libical/calICSService.h">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/calendar/base/backend/libical/calICSService.h">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/calendar/base/backend/libical/calICSService.h">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/calendar/base/backend/libical/calICSService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.cpp">ldap/xpcom/src/nsLDAPConnection.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.h">ldap/xpcom/src/nsLDAPConnection.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.h">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.h">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.h">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.h">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPConnection.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPService.cpp">ldap/xpcom/src/nsLDAPService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPService.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPService.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPService.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPService.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/ldap/xpcom/src/nsLDAPService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbBSDirectory.cpp">mailnews/addrbook/src/nsAbBSDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbBSDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbBSDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbBSDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbBSDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbBSDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">mailnews/addrbook/src/nsAbOutlookDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgFolderCache.cpp">mailnews/base/src/nsMsgFolderCache.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgFolderCache.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgFolderCache.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgFolderCache.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgFolderCache.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgFolderCache.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgGroupView.cpp">mailnews/base/src/nsMsgGroupView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgGroupView.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgGroupView.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgGroupView.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgGroupView.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgGroupView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgTxn.cpp">mailnews/base/util/nsMsgTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgTxn.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgTxn.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgTxn.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgTxn.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/base/util/nsMsgTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsIMAPBodyShell.cpp">mailnews/imap/src/nsIMAPBodyShell.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsIMAPBodyShell.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsIMAPBodyShell.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsIMAPBodyShell.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsIMAPBodyShell.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsIMAPBodyShell.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapFlagAndUidState.cpp">mailnews/imap/src/nsImapFlagAndUidState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapFlagAndUidState.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapFlagAndUidState.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapFlagAndUidState.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapFlagAndUidState.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapFlagAndUidState.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/import/oexpress/nsOEAddressIterator.cpp">mailnews/import/oexpress/nsOEAddressIterator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/import/oexpress/nsOEAddressIterator.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/import/oexpress/nsOEAddressIterator.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/import/oexpress/nsOEAddressIterator.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/import/oexpress/nsOEAddressIterator.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/import/oexpress/nsOEAddressIterator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgBrkMBoxStore.cpp">mailnews/local/src/nsMsgBrkMBoxStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgBrkMBoxStore.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgBrkMBoxStore.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgBrkMBoxStore.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgBrkMBoxStore.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgBrkMBoxStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgMaildirStore.h">mailnews/local/src/nsMsgMaildirStore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgMaildirStore.h">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgMaildirStore.h">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgMaildirStore.h">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgMaildirStore.h">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/local/src/nsMsgMaildirStore.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/mapi/mapihook/src/msgMapiMain.cpp">mailnews/mapi/mapihook/src/msgMapiMain.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/mapi/mapihook/src/msgMapiMain.cpp">file</a> |
<a href="/comm-central/annotate/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/mapi/mapihook/src/msgMapiMain.cpp">annotate</a> |
<a href="/comm-central/diff/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/mapi/mapihook/src/msgMapiMain.cpp">diff</a> |
<a href="/comm-central/comparison/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/mapi/mapihook/src/msgMapiMain.cpp">comparison</a> |
<a href="/comm-central/log/ec3cd803c556650aac854e34fdb4e4ee2ecf87e2/mailnews/mapi/mapihook/src/msgMapiMain.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/backend/libical/calICSService.h</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/backend/libical/calICSService.h</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -102,22 +102,20 @@ class calIcalComponent : public calIIcal</span>
<a href="#l1.4"></a><span id="l1.4">                          public cal::XpcomBase</span>
<a href="#l1.5"></a><span id="l1.5"> {</span>
<a href="#l1.6"></a><span id="l1.6">     friend class calIcalProperty;</span>
<a href="#l1.7"></a><span id="l1.7"> public:</span>
<a href="#l1.8"></a><span id="l1.8">     calIcalComponent(icalcomponent *ical, calIIcalComponent *parent,</span>
<a href="#l1.9"></a><span id="l1.9">                      calITimezoneProvider *tzProvider = nullptr)</span>
<a href="#l1.10"></a><span id="l1.10">         : mComponent(ical), mTimezone(nullptr), mTzProvider(tzProvider), mParent(parent)</span>
<a href="#l1.11"></a><span id="l1.11">     {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        mReferencedTimezones.Init();</span>
<a href="#l1.13"></a><span id="l1.13">     }</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">     // VTIMEZONE ctor</span>
<a href="#l1.16"></a><span id="l1.16">     calIcalComponent(icaltimezone * icaltz, icalcomponent * ical) : mComponent(ical), mTimezone(icaltz) {</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-        mReferencedTimezones.Init();</span>
<a href="#l1.18"></a><span id="l1.18">     }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l1.21"></a><span id="l1.21">     NS_DECL_NSICLASSINFO</span>
<a href="#l1.22"></a><span id="l1.22">     NS_DECL_CALIICALCOMPONENT</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> protected:</span>
<a href="#l1.25"></a><span id="l1.25">     virtual ~calIcalComponent();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPConnection.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -21,23 +21,27 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsILDAPErrors.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsIClassInfoImpl.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsILDAPURL.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsCRT.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsLDAPUtils.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+using namespace mozilla;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14"> const char kConsoleServiceContractId[] = &quot;@mozilla.org/consoleservice;1&quot;;</span>
<a href="#l2.15"></a><span id="l2.15"> const char kDNSServiceContractId[] = &quot;@mozilla.org/network/dns-service;1&quot;;</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> // constructor</span>
<a href="#l2.18"></a><span id="l2.18"> //</span>
<a href="#l2.19"></a><span id="l2.19"> nsLDAPConnection::nsLDAPConnection()</span>
<a href="#l2.20"></a><span id="l2.20">     : mConnectionHandle(0),</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+      mPendingOperationsMutex(&quot;nsLDAPConnection.mPendingOperationsMutex&quot;),</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      mPendingOperations(10),</span>
<a href="#l2.23"></a><span id="l2.23">       mSSL(false),</span>
<a href="#l2.24"></a><span id="l2.24">       mVersion(nsILDAPConnection::VERSION3),</span>
<a href="#l2.25"></a><span id="l2.25">       mDNSRequest(0)</span>
<a href="#l2.26"></a><span id="l2.26"> {</span>
<a href="#l2.27"></a><span id="l2.27"> }</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29"> // destructor</span>
<a href="#l2.30"></a><span id="l2.30"> //</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineat">@@ -106,20 +110,16 @@ nsLDAPConnection::Init(nsILDAPURL *aUrl,</span>
<a href="#l2.32"></a><span id="l2.32">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34">   uint32_t options;</span>
<a href="#l2.35"></a><span id="l2.35">   rv = aUrl-&gt;GetOptions(&amp;options);</span>
<a href="#l2.36"></a><span id="l2.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">   mSSL = options &amp; nsILDAPURL::OPT_SECURE;</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-  // Initialise the hashtable to keep track of pending operations.</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-  // 10 buckets seems like a reasonable size.</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-  mPendingOperations.Init(10);</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-</span>
<a href="#l2.44"></a><span id="l2.44">   nsCOMPtr&lt;nsIThread&gt; curThread = do_GetCurrentThread();</span>
<a href="#l2.45"></a><span id="l2.45">   if (!curThread) {</span>
<a href="#l2.46"></a><span id="l2.46">     NS_ERROR(&quot;nsLDAPConnection::Init(): couldn't get current thread&quot;);</span>
<a href="#l2.47"></a><span id="l2.47">     return NS_ERROR_FAILURE;</span>
<a href="#l2.48"></a><span id="l2.48">   }</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50">   // Do the pre-resolve of the hostname, using the DNS service. This</span>
<a href="#l2.51"></a><span id="l2.51">   // will also initialize the LDAP connection properly, once we have</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineat">@@ -220,27 +220,28 @@ GetListOfPendingOperations(const uint32_</span>
<a href="#l2.53"></a><span id="l2.53"> }</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55"> NS_IMETHODIMP</span>
<a href="#l2.56"></a><span id="l2.56"> nsLDAPConnection::Observe(nsISupports *aSubject, const char *aTopic,</span>
<a href="#l2.57"></a><span id="l2.57">                           const PRUnichar *aData)</span>
<a href="#l2.58"></a><span id="l2.58"> {</span>
<a href="#l2.59"></a><span id="l2.59">   if (!nsCRT::strcmp(aTopic, &quot;profile-change-net-teardown&quot;)) {</span>
<a href="#l2.60"></a><span id="l2.60">     // Abort all ldap requests.</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-    if (mPendingOperations.Count() &gt; 0) {</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-      /* We cannot use enumerate function to abort operations because</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-       * nsILDAPOperation::AbandonExt() is modifying list of operations</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-       * and this leads to starvation.</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-       * We have to do a copy of pending operations.</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-       */</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-      nsTArray&lt;nsILDAPOperation*&gt; pending_operations;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+    /* We cannot use enumerate function to abort operations because</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+     * nsILDAPOperation::AbandonExt() is modifying list of operations</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+     * and this leads to starvation.</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+     * We have to do a copy of pending operations.</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+     */</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    nsTArray&lt;nsILDAPOperation*&gt; pending_operations;</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+    {</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+      MutexAutoLock lock(mPendingOperationsMutex);</span>
<a href="#l2.76"></a><span id="l2.76">       mPendingOperations.EnumerateRead(GetListOfPendingOperations, (void *) (&amp;pending_operations));</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-      for (uint32_t i = 0; i &lt; pending_operations.Length(); i++) {</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-        pending_operations[i]-&gt;AbandonExt();</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-      }</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    }</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    for (uint32_t i = 0; i &lt; pending_operations.Length(); i++) {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+      pending_operations[i]-&gt;AbandonExt();</span>
<a href="#l2.83"></a><span id="l2.83">     }</span>
<a href="#l2.84"></a><span id="l2.84">     Close();</span>
<a href="#l2.85"></a><span id="l2.85">   } else {</span>
<a href="#l2.86"></a><span id="l2.86">     NS_NOTREACHED(&quot;unexpected topic&quot;);</span>
<a href="#l2.87"></a><span id="l2.87">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l2.88"></a><span id="l2.88">   }</span>
<a href="#l2.89"></a><span id="l2.89">   return NS_OK;</span>
<a href="#l2.90"></a><span id="l2.90"> }</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineat">@@ -323,34 +324,36 @@ nsLDAPConnection::GetErrorString(PRUnich</span>
<a href="#l2.92"></a><span id="l2.92">  */</span>
<a href="#l2.93"></a><span id="l2.93"> nsresult</span>
<a href="#l2.94"></a><span id="l2.94"> nsLDAPConnection::AddPendingOperation(uint32_t aOperationID, nsILDAPOperation *aOperation)</span>
<a href="#l2.95"></a><span id="l2.95"> {</span>
<a href="#l2.96"></a><span id="l2.96">   NS_ENSURE_ARG_POINTER(aOperation);</span>
<a href="#l2.97"></a><span id="l2.97"> </span>
<a href="#l2.98"></a><span id="l2.98">   nsIRunnable* runnable = new nsLDAPConnectionRunnable(aOperationID, aOperation,</span>
<a href="#l2.99"></a><span id="l2.99">                                                        this);</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-  mPendingOperations.Put((uint32_t)aOperationID, aOperation);</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+  {</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+    MutexAutoLock lock(mPendingOperationsMutex);</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+    mPendingOperations.Put((uint32_t)aOperationID, aOperation);</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+    PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+           (&quot;pending operation added; total pending operations now = %d\n&quot;,</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+            mPendingOperations.Count()));</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+  }</span>
<a href="#l2.108"></a><span id="l2.108"> </span>
<a href="#l2.109"></a><span id="l2.109">   nsresult rv;</span>
<a href="#l2.110"></a><span id="l2.110">   if (!mThread)</span>
<a href="#l2.111"></a><span id="l2.111">   {</span>
<a href="#l2.112"></a><span id="l2.112">     rv = NS_NewThread(getter_AddRefs(mThread), runnable);</span>
<a href="#l2.113"></a><span id="l2.113">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.114"></a><span id="l2.114">   }</span>
<a href="#l2.115"></a><span id="l2.115">   else</span>
<a href="#l2.116"></a><span id="l2.116">   {</span>
<a href="#l2.117"></a><span id="l2.117">     rv = mThread-&gt;Dispatch(runnable, nsIEventTarget::DISPATCH_NORMAL);</span>
<a href="#l2.118"></a><span id="l2.118">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.119"></a><span id="l2.119">   }</span>
<a href="#l2.120"></a><span id="l2.120"> </span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-  PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-         (&quot;pending operation added; total pending operations now = %d\n&quot;,</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-          mPendingOperations.Count()));</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-</span>
<a href="#l2.125"></a><span id="l2.125">   return NS_OK;</span>
<a href="#l2.126"></a><span id="l2.126"> }</span>
<a href="#l2.127"></a><span id="l2.127"> </span>
<a href="#l2.128"></a><span id="l2.128"> /**</span>
<a href="#l2.129"></a><span id="l2.129">  * Remove an nsILDAPOperation from the list of operations pending on this</span>
<a href="#l2.130"></a><span id="l2.130">  * connection.  Mainly intended for use by the nsLDAPOperation code.</span>
<a href="#l2.131"></a><span id="l2.131">  *</span>
<a href="#l2.132"></a><span id="l2.132">  * @param aOperation    operation to add</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineat">@@ -363,21 +366,24 @@ nsLDAPConnection::AddPendingOperation(ui</span>
<a href="#l2.134"></a><span id="l2.134"> nsresult</span>
<a href="#l2.135"></a><span id="l2.135"> nsLDAPConnection::RemovePendingOperation(uint32_t aOperationID)</span>
<a href="#l2.136"></a><span id="l2.136"> {</span>
<a href="#l2.137"></a><span id="l2.137">   NS_ENSURE_TRUE(aOperationID &gt; 0, NS_ERROR_UNEXPECTED);</span>
<a href="#l2.138"></a><span id="l2.138"> </span>
<a href="#l2.139"></a><span id="l2.139">   PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l2.140"></a><span id="l2.140">          (&quot;nsLDAPConnection::RemovePendingOperation(): operation removed\n&quot;));</span>
<a href="#l2.141"></a><span id="l2.141"> </span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-  mPendingOperations.Remove(aOperationID);</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-  PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-         (&quot;nsLDAPConnection::RemovePendingOperation(): operation &quot;</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-          &quot;removed; total pending operations now = %d\n&quot;,</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-          mPendingOperations.Count()));</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+  {</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineplus">+    MutexAutoLock lock(mPendingOperationsMutex);</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineplus">+    mPendingOperations.Remove(aOperationID);</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineplus">+    PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineplus">+           (&quot;nsLDAPConnection::RemovePendingOperation(): operation &quot;</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+            &quot;removed; total pending operations now = %d\n&quot;,</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+            mPendingOperations.Count()));</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineplus">+  }</span>
<a href="#l2.155"></a><span id="l2.155"> </span>
<a href="#l2.156"></a><span id="l2.156">   return NS_OK;</span>
<a href="#l2.157"></a><span id="l2.157"> }</span>
<a href="#l2.158"></a><span id="l2.158"> </span>
<a href="#l2.159"></a><span id="l2.159"> class nsOnLDAPMessageRunnable : public nsRunnable</span>
<a href="#l2.160"></a><span id="l2.160"> {</span>
<a href="#l2.161"></a><span id="l2.161"> public:</span>
<a href="#l2.162"></a><span id="l2.162">   nsOnLDAPMessageRunnable(nsLDAPMessage *aMsg, bool aClear)</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineat">@@ -421,33 +427,37 @@ nsLDAPConnection::InvokeMessageCallback(</span>
<a href="#l2.164"></a><span id="l2.164"> {</span>
<a href="#l2.165"></a><span id="l2.165"> #if defined(DEBUG)</span>
<a href="#l2.166"></a><span id="l2.166">   // We only want this being logged for debug builds so as not to affect performance too much.</span>
<a href="#l2.167"></a><span id="l2.167">   PR_LOG(gLDAPLogModule, PR_LOG_DEBUG, (&quot;InvokeMessageCallback entered\n&quot;));</span>
<a href="#l2.168"></a><span id="l2.168"> #endif</span>
<a href="#l2.169"></a><span id="l2.169"> </span>
<a href="#l2.170"></a><span id="l2.170">   // Get the operation.</span>
<a href="#l2.171"></a><span id="l2.171">   nsCOMPtr&lt;nsILDAPOperation&gt; operation;</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineminus">-  mPendingOperations.Get((uint32_t)aOperation, getter_AddRefs(operation));</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+  {</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+    MutexAutoLock lock(mPendingOperationsMutex);</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+    mPendingOperations.Get((uint32_t)aOperation, getter_AddRefs(operation));</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+  }</span>
<a href="#l2.177"></a><span id="l2.177"> </span>
<a href="#l2.178"></a><span id="l2.178">   NS_ENSURE_TRUE(operation, NS_ERROR_NULL_POINTER);</span>
<a href="#l2.179"></a><span id="l2.179"> </span>
<a href="#l2.180"></a><span id="l2.180">   nsLDAPMessage *msg = static_cast&lt;nsLDAPMessage *&gt;(aMsg);</span>
<a href="#l2.181"></a><span id="l2.181">   msg-&gt;mOperation = operation;</span>
<a href="#l2.182"></a><span id="l2.182"> </span>
<a href="#l2.183"></a><span id="l2.183">   // proxy the listener callback to the ui thread.</span>
<a href="#l2.184"></a><span id="l2.184">   nsRefPtr&lt;nsOnLDAPMessageRunnable&gt; runnable =</span>
<a href="#l2.185"></a><span id="l2.185">     new nsOnLDAPMessageRunnable(msg, aRemoveOpFromConnQ);</span>
<a href="#l2.186"></a><span id="l2.186">   // invoke the callback</span>
<a href="#l2.187"></a><span id="l2.187">   NS_DispatchToMainThread(runnable);</span>
<a href="#l2.188"></a><span id="l2.188"> </span>
<a href="#l2.189"></a><span id="l2.189">   // if requested (ie the operation is done), remove the operation</span>
<a href="#l2.190"></a><span id="l2.190">   // from the connection queue.</span>
<a href="#l2.191"></a><span id="l2.191">   if (aRemoveOpFromConnQ)</span>
<a href="#l2.192"></a><span id="l2.192">   {</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+    MutexAutoLock lock(mPendingOperationsMutex);</span>
<a href="#l2.194"></a><span id="l2.194">     mPendingOperations.Remove(aOperation);</span>
<a href="#l2.195"></a><span id="l2.195"> </span>
<a href="#l2.196"></a><span id="l2.196">     PR_LOG(gLDAPLogModule, PR_LOG_DEBUG,</span>
<a href="#l2.197"></a><span id="l2.197">            (&quot;pending operation removed; total pending operations now =&quot;</span>
<a href="#l2.198"></a><span id="l2.198">             &quot; %d\n&quot;, mPendingOperations.Count()));</span>
<a href="#l2.199"></a><span id="l2.199">   }</span>
<a href="#l2.200"></a><span id="l2.200"> </span>
<a href="#l2.201"></a><span id="l2.201">   return NS_OK;</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineat">@@ -680,17 +690,20 @@ NS_IMETHODIMP nsLDAPConnectionRunnable::</span>
<a href="#l2.203"></a><span id="l2.203">           //</span>
<a href="#l2.204"></a><span id="l2.204">           if (errorCode == LDAP_SASL_BIND_IN_PROGRESS) {</span>
<a href="#l2.205"></a><span id="l2.205">             struct berval *creds;</span>
<a href="#l2.206"></a><span id="l2.206">             ldap_parse_sasl_bind_result(</span>
<a href="#l2.207"></a><span id="l2.207">               mConnection-&gt;mConnectionHandle, msgHandle,</span>
<a href="#l2.208"></a><span id="l2.208">               &amp;creds, 0);</span>
<a href="#l2.209"></a><span id="l2.209"> </span>
<a href="#l2.210"></a><span id="l2.210">             nsCOMPtr&lt;nsILDAPOperation&gt; operation;</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-            mConnection-&gt;mPendingOperations.Get((uint32_t)mOperationID, getter_AddRefs(operation));</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+            {</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+              MutexAutoLock lock(mConnection-&gt;mPendingOperationsMutex);</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+              mConnection-&gt;mPendingOperations.Get((uint32_t)mOperationID, getter_AddRefs(operation));</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+            }</span>
<a href="#l2.216"></a><span id="l2.216"> </span>
<a href="#l2.217"></a><span id="l2.217">             NS_ENSURE_TRUE(operation, NS_ERROR_NULL_POINTER);</span>
<a href="#l2.218"></a><span id="l2.218"> </span>
<a href="#l2.219"></a><span id="l2.219">             nsresult rv = operation-&gt;SaslStep(creds-&gt;bv_val, creds-&gt;bv_len);</span>
<a href="#l2.220"></a><span id="l2.220">             if (NS_SUCCEEDED(rv))</span>
<a href="#l2.221"></a><span id="l2.221">               return NS_OK;</span>
<a href="#l2.222"></a><span id="l2.222">           }</span>
<a href="#l2.223"></a><span id="l2.223">           break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPConnection.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPConnection.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -19,32 +19,34 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsWeakPtr.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsIDNSListener.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsICancelable.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsIRequest.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#include &quot;mozilla/Mutex.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14"> // 0d871e30-1dd2-11b2-8ea9-831778c78e93</span>
<a href="#l3.15"></a><span id="l3.15"> //</span>
<a href="#l3.16"></a><span id="l3.16"> #define NS_LDAPCONNECTION_CID \</span>
<a href="#l3.17"></a><span id="l3.17"> { 0x0d871e30, 0x1dd2, 0x11b2, \</span>
<a href="#l3.18"></a><span id="l3.18">  { 0x8e, 0xa9, 0x83, 0x17, 0x78, 0xc7, 0x8e, 0x93 }}</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> class nsLDAPConnection : public nsILDAPConnection,</span>
<a href="#l3.21"></a><span id="l3.21">                          public nsSupportsWeakReference,</span>
<a href="#l3.22"></a><span id="l3.22">                          public nsIDNSListener,</span>
<a href="#l3.23"></a><span id="l3.23">                          public nsIObserver</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25"> {</span>
<a href="#l3.26"></a><span id="l3.26">     friend class nsLDAPOperation;</span>
<a href="#l3.27"></a><span id="l3.27">     friend class nsLDAPMessage;</span>
<a href="#l3.28"></a><span id="l3.28">     friend class nsLDAPConnectionRunnable;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+    typedef mozilla::Mutex Mutex;</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31">   public:</span>
<a href="#l3.32"></a><span id="l3.32">     NS_DECL_THREADSAFE_ISUPPORTS</span>
<a href="#l3.33"></a><span id="l3.33">     NS_DECL_NSILDAPCONNECTION</span>
<a href="#l3.34"></a><span id="l3.34">     NS_DECL_NSIDNSLISTENER</span>
<a href="#l3.35"></a><span id="l3.35">     NS_DECL_NSIOBSERVER</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37">     // constructor &amp; destructor</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineat">@@ -85,17 +87,18 @@ class nsLDAPConnection : public nsILDAPC</span>
<a href="#l3.39"></a><span id="l3.39">      */</span>
<a href="#l3.40"></a><span id="l3.40">     nsresult RemovePendingOperation(uint32_t aOperationID);</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42">     void Close();                       // close the connection</span>
<a href="#l3.43"></a><span id="l3.43">     LDAP *mConnectionHandle;            // the LDAP C SDK's connection object</span>
<a href="#l3.44"></a><span id="l3.44">     nsCString mBindName;                // who to bind as</span>
<a href="#l3.45"></a><span id="l3.45">     nsCOMPtr&lt;nsIThread&gt; mThread;        // thread which marshals results</span>
<a href="#l3.46"></a><span id="l3.46"> </span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-    nsInterfaceHashtableMT&lt;nsUint32HashKey, nsILDAPOperation&gt; mPendingOperations;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+    Mutex mPendingOperationsMutex;</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+    nsInterfaceHashtable&lt;nsUint32HashKey, nsILDAPOperation&gt; mPendingOperations;</span>
<a href="#l3.50"></a><span id="l3.50"> </span>
<a href="#l3.51"></a><span id="l3.51">     int32_t mPort;                      // The LDAP port we're binding to</span>
<a href="#l3.52"></a><span id="l3.52">     bool mSSL;                        // the options</span>
<a href="#l3.53"></a><span id="l3.53">     uint32_t mVersion;                  // LDAP protocol version</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55">     nsCString mResolvedIP;              // Preresolved list of host IPs</span>
<a href="#l3.56"></a><span id="l3.56">     nsCOMPtr&lt;nsILDAPMessageListener&gt; mInitListener; // Init callback</span>
<a href="#l3.57"></a><span id="l3.57">     nsCOMPtr&lt;nsICancelable&gt; mDNSRequest;   // The &quot;active&quot; DNS request</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPService.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -180,23 +180,20 @@ nsLDAPService::nsLDAPService()</span>
<a href="#l4.4"></a><span id="l4.4"> }</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> // destructor</span>
<a href="#l4.7"></a><span id="l4.7"> //</span>
<a href="#l4.8"></a><span id="l4.8"> nsLDAPService::~nsLDAPService()</span>
<a href="#l4.9"></a><span id="l4.9"> {</span>
<a href="#l4.10"></a><span id="l4.10"> }</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-// Initializer, create some internal hash tables etc.</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+// Initializer</span>
<a href="#l4.14"></a><span id="l4.14"> //</span>
<a href="#l4.15"></a><span id="l4.15"> nsresult nsLDAPService::Init()</span>
<a href="#l4.16"></a><span id="l4.16"> {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-    mServers.Init();</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-    mConnections.Init();</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-</span>
<a href="#l4.20"></a><span id="l4.20">     return NS_OK;</span>
<a href="#l4.21"></a><span id="l4.21"> }</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> // void addServer (in nsILDAPServer aServer);</span>
<a href="#l4.24"></a><span id="l4.24"> NS_IMETHODIMP nsLDAPService::AddServer(nsILDAPServer *aServer)</span>
<a href="#l4.25"></a><span id="l4.25"> {</span>
<a href="#l4.26"></a><span id="l4.26">     nsLDAPServiceEntry *entry;</span>
<a href="#l4.27"></a><span id="l4.27">     nsString key;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbBSDirectory.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbBSDirectory.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -16,18 +16,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> nsAbBSDirectory::nsAbBSDirectory()</span>
<a href="#l5.11"></a><span id="l5.11"> : mInitialized(false)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+, mServers(13)</span>
<a href="#l5.13"></a><span id="l5.13"> {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-  mServers.Init(13);</span>
<a href="#l5.15"></a><span id="l5.15"> }</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> nsAbBSDirectory::~nsAbBSDirectory()</span>
<a href="#l5.18"></a><span id="l5.18"> {</span>
<a href="#l5.19"></a><span id="l5.19"> }</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21"> NS_IMETHODIMP nsAbBSDirectory::Init(const char *aURI)</span>
<a href="#l5.22"></a><span id="l5.22"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -102,18 +102,16 @@ static const AppendItem CHAT_ATTRS_ARRAY</span>
<a href="#l6.4"></a><span id="l6.4">   {kICQProperty, &quot;propertyICQ&quot;, eAppendLabel},</span>
<a href="#l6.5"></a><span id="l6.5">   {kXMPPProperty, &quot;propertyXMPP&quot;, eAppendLabel},</span>
<a href="#l6.6"></a><span id="l6.6">   {kIRCProperty, &quot;propertyIRC&quot;, eAppendLabel}</span>
<a href="#l6.7"></a><span id="l6.7"> };</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> nsAbCardProperty::nsAbCardProperty()</span>
<a href="#l6.10"></a><span id="l6.10">   : m_IsMailList(false)</span>
<a href="#l6.11"></a><span id="l6.11"> {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  m_properties.Init();</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-</span>
<a href="#l6.14"></a><span id="l6.14">   // Initialize some default properties</span>
<a href="#l6.15"></a><span id="l6.15">   SetPropertyAsUint32(kPreferMailFormatProperty, nsIAbPreferMailFormat::unknown);</span>
<a href="#l6.16"></a><span id="l6.16">   SetPropertyAsUint32(kPopularityIndexProperty, 0);</span>
<a href="#l6.17"></a><span id="l6.17">   // Uninitialized...</span>
<a href="#l6.18"></a><span id="l6.18">   SetPropertyAsUint32(kLastModifiedDateProperty, 0);</span>
<a href="#l6.19"></a><span id="l6.19">   SetPropertyAsBool(kAllowRemoteContentProperty, false);</span>
<a href="#l6.20"></a><span id="l6.20"> }</span>
<a href="#l6.21"></a><span id="l6.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -39,17 +39,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> using namespace mozilla;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> nsAbLDAPDirectory::nsAbLDAPDirectory() :</span>
<a href="#l7.7"></a><span id="l7.7">   nsAbDirProperty(),</span>
<a href="#l7.8"></a><span id="l7.8">   mPerformingQuery(false),</span>
<a href="#l7.9"></a><span id="l7.9">   mContext(0),</span>
<a href="#l7.10"></a><span id="l7.10">   mLock(&quot;nsAbLDAPDirectory.mLock&quot;)</span>
<a href="#l7.11"></a><span id="l7.11"> {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  mCache.Init();</span>
<a href="#l7.13"></a><span id="l7.13"> }</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> nsAbLDAPDirectory::~nsAbLDAPDirectory()</span>
<a href="#l7.16"></a><span id="l7.16"> {</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> NS_IMPL_ISUPPORTS_INHERITED3(nsAbLDAPDirectory, nsAbDirProperty,</span>
<a href="#l7.20"></a><span id="l7.20">                              nsISupportsWeakReference, nsIAbDirSearchListener,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -28,17 +28,16 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsMemory.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> nsAbMDBDirectory::nsAbMDBDirectory(void):</span>
<a href="#l8.9"></a><span id="l8.9">      nsAbMDBDirProperty(),</span>
<a href="#l8.10"></a><span id="l8.10">      mPerformingQuery(false)</span>
<a href="#l8.11"></a><span id="l8.11"> {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  mSearchCache.Init();</span>
<a href="#l8.13"></a><span id="l8.13"> }</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> nsAbMDBDirectory::~nsAbMDBDirectory(void)</span>
<a href="#l8.16"></a><span id="l8.16"> {</span>
<a href="#l8.17"></a><span id="l8.17">   if (mDatabase) {</span>
<a href="#l8.18"></a><span id="l8.18">     mDatabase-&gt;RemoveListener(this);</span>
<a href="#l8.19"></a><span id="l8.19">   }</span>
<a href="#l8.20"></a><span id="l8.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -117,17 +117,16 @@ const ExportAttributesTableStruct EXPORT</span>
<a href="#l9.4"></a><span id="l9.4">   {kFamilyNameProperty},</span>
<a href="#l9.5"></a><span id="l9.5"> };</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> //</span>
<a href="#l9.8"></a><span id="l9.8"> // nsAbManager</span>
<a href="#l9.9"></a><span id="l9.9"> //</span>
<a href="#l9.10"></a><span id="l9.10"> nsAbManager::nsAbManager()</span>
<a href="#l9.11"></a><span id="l9.11"> {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  mAbStore.Init();</span>
<a href="#l9.13"></a><span id="l9.13"> }</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15"> nsAbManager::~nsAbManager()</span>
<a href="#l9.16"></a><span id="l9.16"> {</span>
<a href="#l9.17"></a><span id="l9.17"> }</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> NS_IMPL_ISUPPORTS3(nsAbManager, nsIAbManager, nsICommandLineHandler,</span>
<a href="#l9.20"></a><span id="l9.20">   nsIObserver)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -49,19 +49,16 @@ nsAbOutlookDirectory::~nsAbOutlookDirect</span>
<a href="#l10.4"></a><span id="l10.4"> }</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> NS_IMPL_ISUPPORTS_INHERITED3(nsAbOutlookDirectory, nsAbDirProperty,</span>
<a href="#l10.7"></a><span id="l10.7">                              nsIAbDirectoryQuery, nsIAbDirectorySearch,</span>
<a href="#l10.8"></a><span id="l10.8">                              nsIAbDirSearchListener)</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> NS_IMETHODIMP nsAbOutlookDirectory::Init(const char *aUri)</span>
<a href="#l10.11"></a><span id="l10.11"> {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  mQueryThreads.Init();</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-  mCardList.Init();</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-</span>
<a href="#l10.15"></a><span id="l10.15">   nsresult rv = nsAbDirProperty::Init(aUri);</span>
<a href="#l10.16"></a><span id="l10.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">   nsAutoCString entry;</span>
<a href="#l10.19"></a><span id="l10.19">   nsAutoCString stub;</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">   mAbWinType = getAbWinType(kOutlookDirectoryScheme, mURINoQuery.get(), stub, entry);</span>
<a href="#l10.22"></a><span id="l10.22">   if (mAbWinType == nsAbWinType_Unknown) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -98,17 +98,16 @@ static void openMailWindow(const nsACStr</span>
<a href="#l11.4"></a><span id="l11.4">   }</span>
<a href="#l11.5"></a><span id="l11.5"> }</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> nsMessengerUnixIntegration::nsMessengerUnixIntegration()</span>
<a href="#l11.8"></a><span id="l11.8"> {</span>
<a href="#l11.9"></a><span id="l11.9">   mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l11.10"></a><span id="l11.10">   mNewMailReceivedAtom = MsgGetAtom(&quot;NewMailReceived&quot;);</span>
<a href="#l11.11"></a><span id="l11.11">   mAlertInProgress = false;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  mLastMRUTimes.Init();</span>
<a href="#l11.13"></a><span id="l11.13">   mFoldersWithNewMail = do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l11.14"></a><span id="l11.14"> }</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> NS_IMPL_ISUPPORTS4(nsMessengerUnixIntegration, nsIFolderListener, nsIObserver,</span>
<a href="#l11.17"></a><span id="l11.17">                    nsIMessengerOSIntegration, nsIUrlListener)</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> nsresult</span>
<a href="#l11.20"></a><span id="l11.20"> nsMessengerUnixIntegration::Init()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -152,19 +152,16 @@ nsMsgAccountManager::~nsMsgAccountManage</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> nsresult nsMsgAccountManager::Init()</span>
<a href="#l12.6"></a><span id="l12.6"> {</span>
<a href="#l12.7"></a><span id="l12.7">   nsresult rv;</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   m_prefs = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l12.10"></a><span id="l12.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  m_identities.Init();</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  m_incomingServers.Init();</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-</span>
<a href="#l12.15"></a><span id="l12.15">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l12.16"></a><span id="l12.16">            mozilla::services::GetObserverService();</span>
<a href="#l12.17"></a><span id="l12.17">   if (observerService)</span>
<a href="#l12.18"></a><span id="l12.18">   {</span>
<a href="#l12.19"></a><span id="l12.19">     observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);</span>
<a href="#l12.20"></a><span id="l12.20">     observerService-&gt;AddObserver(this, &quot;quit-application-granted&quot; , true);</span>
<a href="#l12.21"></a><span id="l12.21">     observerService-&gt;AddObserver(this, ABOUT_TO_GO_OFFLINE_TOPIC, true);</span>
<a href="#l12.22"></a><span id="l12.22">     observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -228,18 +228,16 @@ nsresult nsMsgFolderCache::OpenMDB(const</span>
<a href="#l13.4"></a><span id="l13.4">   }</span>
<a href="#l13.5"></a><span id="l13.5">   return ret;</span>
<a href="#l13.6"></a><span id="l13.6"> }</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> NS_IMETHODIMP nsMsgFolderCache::Init(nsIFile *aFile)</span>
<a href="#l13.9"></a><span id="l13.9"> {</span>
<a href="#l13.10"></a><span id="l13.10">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  m_cacheElements.Init();</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-</span>
<a href="#l13.14"></a><span id="l13.14">   bool exists;</span>
<a href="#l13.15"></a><span id="l13.15">   aFile-&gt;Exists(&amp;exists);</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">   nsAutoCString dbPath;</span>
<a href="#l13.18"></a><span id="l13.18">   aFile-&gt;GetNativePath(dbPath);</span>
<a href="#l13.19"></a><span id="l13.19">   // ### evil cast until MDB supports file streams.</span>
<a href="#l13.20"></a><span id="l13.20">   nsresult rv = OpenMDB(dbPath, exists);</span>
<a href="#l13.21"></a><span id="l13.21">   // if this fails and panacea.dat exists, try blowing away the db and recreating it</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -18,17 +18,16 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #define MSGHDR_CACHE_LOOK_AHEAD_SIZE  25    // Allocate this more to avoid reallocation on new mail.</span>
<a href="#l14.5"></a><span id="l14.5"> #define MSGHDR_CACHE_MAX_SIZE         8192  // Max msghdr cache entries.</span>
<a href="#l14.6"></a><span id="l14.6"> #define MSGHDR_CACHE_DEFAULT_SIZE     100</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> nsMsgGroupView::nsMsgGroupView()</span>
<a href="#l14.9"></a><span id="l14.9"> {</span>
<a href="#l14.10"></a><span id="l14.10">   m_dayChanged = false;</span>
<a href="#l14.11"></a><span id="l14.11">   m_lastCurExplodedTime.tm_mday = 0;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  m_groupsTable.Init();</span>
<a href="#l14.13"></a><span id="l14.13"> }</span>
<a href="#l14.14"></a><span id="l14.14"> </span>
<a href="#l14.15"></a><span id="l14.15"> nsMsgGroupView::~nsMsgGroupView()</span>
<a href="#l14.16"></a><span id="l14.16"> {</span>
<a href="#l14.17"></a><span id="l14.17"> }</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> NS_IMETHODIMP nsMsgGroupView::Open(nsIMsgFolder *aFolder, nsMsgViewSortTypeValue aSortType, nsMsgViewSortOrderValue aSortOrder, nsMsgViewFlagsTypeValue aViewFlags, int32_t *aCount)</span>
<a href="#l14.20"></a><span id="l14.20"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -27,18 +27,16 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> static bool gReferenceOnlyThreading;</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> nsMsgSearchDBView::nsMsgSearchDBView()</span>
<a href="#l15.9"></a><span id="l15.9"> {</span>
<a href="#l15.10"></a><span id="l15.10">   // don't try to display messages for the search pane.</span>
<a href="#l15.11"></a><span id="l15.11">   mSuppressMsgDisplay = true;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  m_threadsTable.Init();</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  m_hdrsTable.Init();</span>
<a href="#l15.14"></a><span id="l15.14">   m_totalMessagesInView = 0;</span>
<a href="#l15.15"></a><span id="l15.15">   m_nextThreadId = 1;</span>
<a href="#l15.16"></a><span id="l15.16"> }</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18"> nsMsgSearchDBView::~nsMsgSearchDBView()</span>
<a href="#l15.19"></a><span id="l15.19"> {	</span>
<a href="#l15.20"></a><span id="l15.20"> }</span>
<a href="#l15.21"></a><span id="l15.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -49,24 +49,24 @@</span>
<a href="#l16.4"></a><span id="l16.4"> #include &quot;nsIMsgFilter.h&quot;</span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;nsIArray.h&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> #define PORT_NOT_SET -1</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> nsMsgIncomingServer::nsMsgIncomingServer():</span>
<a href="#l16.11"></a><span id="l16.11">     m_rootFolder(0),</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+    m_downloadedHdrs(50),</span>
<a href="#l16.13"></a><span id="l16.13">     m_numMsgsDownloaded(0),</span>
<a href="#l16.14"></a><span id="l16.14">     m_biffState(nsIMsgFolder::nsMsgBiffState_Unknown),</span>
<a href="#l16.15"></a><span id="l16.15">     m_serverBusy(false),</span>
<a href="#l16.16"></a><span id="l16.16">     m_canHaveFilters(true),</span>
<a href="#l16.17"></a><span id="l16.17">     m_displayStartupPage(true),</span>
<a href="#l16.18"></a><span id="l16.18">     mPerformingBiff(false)</span>
<a href="#l16.19"></a><span id="l16.19"> { </span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-  m_downloadedHdrs.Init(50);</span>
<a href="#l16.21"></a><span id="l16.21"> }</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23"> nsMsgIncomingServer::~nsMsgIncomingServer()</span>
<a href="#l16.24"></a><span id="l16.24"> {</span>
<a href="#l16.25"></a><span id="l16.25"> }</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27"> NS_IMPL_ISUPPORTS2(nsMsgIncomingServer, nsIMsgIncomingServer,</span>
<a href="#l16.28"></a><span id="l16.28">   nsISupportsWeakReference)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/util/nsMsgTxn.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgTxn.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -31,17 +31,16 @@ nsMsgTxn::nsMsgTxn()</span>
<a href="#l17.4"></a><span id="l17.4"> }</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> nsMsgTxn::~nsMsgTxn()</span>
<a href="#l17.7"></a><span id="l17.7"> {</span>
<a href="#l17.8"></a><span id="l17.8"> }</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> nsresult nsMsgTxn::Init()</span>
<a href="#l17.11"></a><span id="l17.11"> {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  mPropertyHash.Init();</span>
<a href="#l17.13"></a><span id="l17.13">   return NS_OK;</span>
<a href="#l17.14"></a><span id="l17.14"> }</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16"> NS_IMETHODIMP nsMsgTxn::HasKey(const nsAString&amp; name, bool *aResult)</span>
<a href="#l17.17"></a><span id="l17.17"> {</span>
<a href="#l17.18"></a><span id="l17.18">   *aResult = mPropertyHash.Get(name, nullptr);</span>
<a href="#l17.19"></a><span id="l17.19">   return NS_OK;</span>
<a href="#l17.20"></a><span id="l17.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -154,17 +154,16 @@ nsresult nsMsgComposeService::Init()</span>
<a href="#l18.4"></a><span id="l18.4">     rv = observerService-&gt;AddObserver(this, &quot;profile-do-change&quot;, true);</span>
<a href="#l18.5"></a><span id="l18.5">   }</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">   // Register some pref observer</span>
<a href="#l18.8"></a><span id="l18.8">   nsCOMPtr&lt;nsIPrefBranch&gt; pbi = do_GetService(NS_PREFSERVICE_CONTRACTID);</span>
<a href="#l18.9"></a><span id="l18.9">   if (pbi)</span>
<a href="#l18.10"></a><span id="l18.10">     rv = pbi-&gt;AddObserver(PREF_MAIL_COMPOSE_MAXRECYCLEDWINDOWS, this, true);</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  mOpenComposeWindows.Init();</span>
<a href="#l18.13"></a><span id="l18.13">   Reset();</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   AddGlobalHtmlDomains();</span>
<a href="#l18.16"></a><span id="l18.16">   // Since the compose service should only be initialized once, we can</span>
<a href="#l18.17"></a><span id="l18.17">   // be pretty sure there aren't any existing compose windows open.</span>
<a href="#l18.18"></a><span id="l18.18">   MsgCleanupTempFiles(&quot;nsmail&quot;, &quot;tmp&quot;);</span>
<a href="#l18.19"></a><span id="l18.19">   MsgCleanupTempFiles(&quot;nsemail&quot;, &quot;html&quot;);</span>
<a href="#l18.20"></a><span id="l18.20">   MsgCleanupTempFiles(&quot;nscopy&quot;, &quot;tmp&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1200,18 +1200,18 @@ bool nsIMAPMessageHeaders::ShouldFetchIn</span>
<a href="#l19.4"></a><span id="l19.4"> static int</span>
<a href="#l19.5"></a><span id="l19.5"> imap_shell_cache_strcmp (const void *a, const void *b)</span>
<a href="#l19.6"></a><span id="l19.6"> {</span>
<a href="#l19.7"></a><span id="l19.7">   return PL_strcmp ((const char *) a, (const char *) b);</span>
<a href="#l19.8"></a><span id="l19.8"> }</span>
<a href="#l19.9"></a><span id="l19.9"> #endif</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11"> nsIMAPBodyShellCache::nsIMAPBodyShellCache()</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+: m_shellHash(20)</span>
<a href="#l19.13"></a><span id="l19.13"> {</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-  m_shellHash.Init(20);</span>
<a href="#l19.15"></a><span id="l19.15">   m_shellList = new nsVoidArray();</span>
<a href="#l19.16"></a><span id="l19.16"> }</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18"> /* static */ nsIMAPBodyShellCache *nsIMAPBodyShellCache::Create()</span>
<a href="#l19.19"></a><span id="l19.19"> {</span>
<a href="#l19.20"></a><span id="l19.20">   nsIMAPBodyShellCache *cache = new nsIMAPBodyShellCache();</span>
<a href="#l19.21"></a><span id="l19.21">   if (!cache || !cache-&gt;m_shellList)</span>
<a href="#l19.22"></a><span id="l19.22">     return NULL;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/imap/src/nsImapFlagAndUidState.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapFlagAndUidState.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -74,36 +74,35 @@ NS_IMETHODIMP nsImapFlagAndUidState::Get</span>
<a href="#l20.4"></a><span id="l20.4">   return NS_OK;</span>
<a href="#l20.5"></a><span id="l20.5"> }</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> /* amount to expand for imap entry flags when we need more */</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> nsImapFlagAndUidState::nsImapFlagAndUidState(int32_t numberOfMessages)</span>
<a href="#l20.10"></a><span id="l20.10">   : fUids(numberOfMessages),</span>
<a href="#l20.11"></a><span id="l20.11">     fFlags(numberOfMessages),</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+    m_customFlagsHash(10),</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    m_customAttributesHash(10),</span>
<a href="#l20.14"></a><span id="l20.14">     mLock(&quot;nsImapFlagAndUidState.mLock&quot;)</span>
<a href="#l20.15"></a><span id="l20.15"> {</span>
<a href="#l20.16"></a><span id="l20.16">   fSupportedUserFlags = 0;</span>
<a href="#l20.17"></a><span id="l20.17">   fNumberDeleted = 0;</span>
<a href="#l20.18"></a><span id="l20.18">   fPartialUIDFetch = true;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-  m_customFlagsHash.Init(10);</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-  m_customAttributesHash.Init(10);  </span>
<a href="#l20.21"></a><span id="l20.21"> }</span>
<a href="#l20.22"></a><span id="l20.22"> </span>
<a href="#l20.23"></a><span id="l20.23"> /* static */PLDHashOperator nsImapFlagAndUidState::FreeCustomFlags(const uint32_t &amp;aKey, char *aData,</span>
<a href="#l20.24"></a><span id="l20.24">                                         void *closure)</span>
<a href="#l20.25"></a><span id="l20.25"> {</span>
<a href="#l20.26"></a><span id="l20.26">   PR_Free(aData);</span>
<a href="#l20.27"></a><span id="l20.27">   return PL_DHASH_NEXT;</span>
<a href="#l20.28"></a><span id="l20.28"> }</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30"> nsImapFlagAndUidState::~nsImapFlagAndUidState()</span>
<a href="#l20.31"></a><span id="l20.31"> {</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-  if (m_customFlagsHash.IsInitialized())</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-    m_customFlagsHash.EnumerateRead(FreeCustomFlags, nullptr);</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+  m_customFlagsHash.EnumerateRead(FreeCustomFlags, nullptr);</span>
<a href="#l20.35"></a><span id="l20.35"> }</span>
<a href="#l20.36"></a><span id="l20.36"> </span>
<a href="#l20.37"></a><span id="l20.37"> NS_IMETHODIMP</span>
<a href="#l20.38"></a><span id="l20.38"> nsImapFlagAndUidState::OrSupportedUserFlags(uint16_t flags)</span>
<a href="#l20.39"></a><span id="l20.39"> {</span>
<a href="#l20.40"></a><span id="l20.40">   fSupportedUserFlags |= flags;</span>
<a href="#l20.41"></a><span id="l20.41">   return NS_OK;</span>
<a href="#l20.42"></a><span id="l20.42"> }</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineat">@@ -118,18 +117,17 @@ nsImapFlagAndUidState::GetSupportedUserF</span>
<a href="#l20.44"></a><span id="l20.44"> </span>
<a href="#l20.45"></a><span id="l20.45"> // we need to reset our flags, (re-read all) but chances are the memory allocation needed will be</span>
<a href="#l20.46"></a><span id="l20.46"> // very close to what we were already using</span>
<a href="#l20.47"></a><span id="l20.47"> </span>
<a href="#l20.48"></a><span id="l20.48"> NS_IMETHODIMP nsImapFlagAndUidState::Reset()</span>
<a href="#l20.49"></a><span id="l20.49"> {</span>
<a href="#l20.50"></a><span id="l20.50">   PR_CEnterMonitor(this);</span>
<a href="#l20.51"></a><span id="l20.51">   fNumberDeleted = 0;</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-  if (m_customFlagsHash.IsInitialized())</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-    m_customFlagsHash.EnumerateRead(FreeCustomFlags, nullptr);</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+  m_customFlagsHash.EnumerateRead(FreeCustomFlags, nullptr);</span>
<a href="#l20.55"></a><span id="l20.55">   m_customFlagsHash.Clear();</span>
<a href="#l20.56"></a><span id="l20.56">   fUids.Clear();</span>
<a href="#l20.57"></a><span id="l20.57">   fFlags.Clear();</span>
<a href="#l20.58"></a><span id="l20.58">   fPartialUIDFetch = true;</span>
<a href="#l20.59"></a><span id="l20.59">   PR_CExitMonitor(this);</span>
<a href="#l20.60"></a><span id="l20.60">   return NS_OK;</span>
<a href="#l20.61"></a><span id="l20.61"> }</span>
<a href="#l20.62"></a><span id="l20.62"> </span>
<a href="#l20.63"></a><span id="l20.63" class="difflineat">@@ -240,18 +238,16 @@ imapMessageFlagsType nsImapFlagAndUidSta</span>
<a href="#l20.64"></a><span id="l20.64">   imapMessageFlagsType retFlags = (*foundIt) ? fFlags[*ndx] : kNoImapMsgFlag;</span>
<a href="#l20.65"></a><span id="l20.65">   PR_CExitMonitor(this);</span>
<a href="#l20.66"></a><span id="l20.66">   return retFlags;</span>
<a href="#l20.67"></a><span id="l20.67"> }</span>
<a href="#l20.68"></a><span id="l20.68"> </span>
<a href="#l20.69"></a><span id="l20.69"> NS_IMETHODIMP nsImapFlagAndUidState::AddUidCustomFlagPair(uint32_t uid, const char *customFlag)</span>
<a href="#l20.70"></a><span id="l20.70"> {</span>
<a href="#l20.71"></a><span id="l20.71">   MutexAutoLock mon(mLock);</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-  if (!m_customFlagsHash.IsInitialized())</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l20.74"></a><span id="l20.74">   char *ourCustomFlags;</span>
<a href="#l20.75"></a><span id="l20.75">   char *oldValue = nullptr;</span>
<a href="#l20.76"></a><span id="l20.76">   m_customFlagsHash.Get(uid, &amp;oldValue);</span>
<a href="#l20.77"></a><span id="l20.77">   if (oldValue)</span>
<a href="#l20.78"></a><span id="l20.78">   {</span>
<a href="#l20.79"></a><span id="l20.79">   // we'll store multiple keys as space-delimited since space is not</span>
<a href="#l20.80"></a><span id="l20.80">   // a valid character in a keyword. First, we need to look for the</span>
<a href="#l20.81"></a><span id="l20.81">     // customFlag in the existing flags;</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineat">@@ -280,59 +276,51 @@ NS_IMETHODIMP nsImapFlagAndUidState::Add</span>
<a href="#l20.83"></a><span id="l20.83">   }</span>
<a href="#l20.84"></a><span id="l20.84">   m_customFlagsHash.Put(uid, ourCustomFlags);</span>
<a href="#l20.85"></a><span id="l20.85">   return NS_OK;</span>
<a href="#l20.86"></a><span id="l20.86"> }</span>
<a href="#l20.87"></a><span id="l20.87"> </span>
<a href="#l20.88"></a><span id="l20.88"> NS_IMETHODIMP nsImapFlagAndUidState::GetCustomFlags(uint32_t uid, char **customFlags)</span>
<a href="#l20.89"></a><span id="l20.89"> {</span>
<a href="#l20.90"></a><span id="l20.90">   MutexAutoLock mon(mLock);</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineminus">-  if (m_customFlagsHash.IsInitialized())</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineplus">+  char *value = nullptr;</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineplus">+  m_customFlagsHash.Get(uid, &amp;value);</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineplus">+  if (value)</span>
<a href="#l20.95"></a><span id="l20.95">   {</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineminus">-    char *value = nullptr;</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineminus">-    m_customFlagsHash.Get(uid, &amp;value);</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-    if (value)</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineminus">-    {</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineminus">-      *customFlags = NS_strdup(value);</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-      return (*customFlags) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-    }</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineplus">+    *customFlags = NS_strdup(value);</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+    return (*customFlags) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l20.105"></a><span id="l20.105">   }</span>
<a href="#l20.106"></a><span id="l20.106">   *customFlags = nullptr;</span>
<a href="#l20.107"></a><span id="l20.107">   return NS_OK;</span>
<a href="#l20.108"></a><span id="l20.108"> }</span>
<a href="#l20.109"></a><span id="l20.109"> </span>
<a href="#l20.110"></a><span id="l20.110"> NS_IMETHODIMP nsImapFlagAndUidState::ClearCustomFlags(uint32_t uid)</span>
<a href="#l20.111"></a><span id="l20.111"> {</span>
<a href="#l20.112"></a><span id="l20.112">   MutexAutoLock mon(mLock);</span>
<a href="#l20.113"></a><span id="l20.113">   m_customFlagsHash.Remove(uid);</span>
<a href="#l20.114"></a><span id="l20.114">   return NS_OK;</span>
<a href="#l20.115"></a><span id="l20.115"> }</span>
<a href="#l20.116"></a><span id="l20.116"> </span>
<a href="#l20.117"></a><span id="l20.117"> NS_IMETHODIMP nsImapFlagAndUidState::SetCustomAttribute(uint32_t aUid,</span>
<a href="#l20.118"></a><span id="l20.118">                                                         const nsACString &amp;aCustomAttributeName,</span>
<a href="#l20.119"></a><span id="l20.119">                                                         const nsACString &amp;aCustomAttributeValue)</span>
<a href="#l20.120"></a><span id="l20.120"> {</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineminus">-  if (!m_customAttributesHash.IsInitialized())</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l20.123"></a><span id="l20.123">   nsCString key;</span>
<a href="#l20.124"></a><span id="l20.124">   key.AppendInt((int64_t)aUid);</span>
<a href="#l20.125"></a><span id="l20.125">   key.Append(aCustomAttributeName);</span>
<a href="#l20.126"></a><span id="l20.126">   nsCString value;</span>
<a href="#l20.127"></a><span id="l20.127">   value.Assign(aCustomAttributeValue);</span>
<a href="#l20.128"></a><span id="l20.128">   m_customAttributesHash.Put(key, value);</span>
<a href="#l20.129"></a><span id="l20.129">   return NS_OK;</span>
<a href="#l20.130"></a><span id="l20.130"> }</span>
<a href="#l20.131"></a><span id="l20.131"> </span>
<a href="#l20.132"></a><span id="l20.132"> NS_IMETHODIMP nsImapFlagAndUidState::GetCustomAttribute(uint32_t aUid,</span>
<a href="#l20.133"></a><span id="l20.133">                                                         const nsACString &amp;aCustomAttributeName,</span>
<a href="#l20.134"></a><span id="l20.134">                                                         nsACString &amp;aCustomAttributeValue)</span>
<a href="#l20.135"></a><span id="l20.135"> {</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineminus">-  if (m_customAttributesHash.IsInitialized())</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineminus">-  {</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineminus">-    nsCString key;</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineminus">-    key.AppendInt((int64_t)aUid);</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineminus">-    key.Append(aCustomAttributeName);</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineminus">-    nsCString val;</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineminus">-    m_customAttributesHash.Get(key, &amp;val);</span>
<a href="#l20.143"></a><span id="l20.143" class="difflineminus">-    aCustomAttributeValue.Assign(val);</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineminus">-  }</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineplus">+  nsCString key;</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineplus">+  key.AppendInt((int64_t)aUid);</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineplus">+  key.Append(aCustomAttributeName);</span>
<a href="#l20.148"></a><span id="l20.148" class="difflineplus">+  nsCString val;</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineplus">+  m_customAttributesHash.Get(key, &amp;val);</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineplus">+  aCustomAttributeValue.Assign(val);</span>
<a href="#l20.151"></a><span id="l20.151">   return NS_OK;</span>
<a href="#l20.152"></a><span id="l20.152"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -3117,18 +3117,17 @@ nsresult nsImapMailFolder::NormalEndHead</span>
<a href="#l21.4"></a><span id="l21.4">     // Check if this header corresponds to a pseudo header</span>
<a href="#l21.5"></a><span id="l21.5">     // we have from doing a pseudo-offline move and then downloading</span>
<a href="#l21.6"></a><span id="l21.6">     // the real header from the server. In that case, we notify</span>
<a href="#l21.7"></a><span id="l21.7">     // db/folder listeners that the pseudo-header has become the new</span>
<a href="#l21.8"></a><span id="l21.8">     // header, i.e., the key has changed.</span>
<a href="#l21.9"></a><span id="l21.9">     nsCString newMessageId;</span>
<a href="#l21.10"></a><span id="l21.10">     nsMsgKey pseudoKey = nsMsgKey_None;</span>
<a href="#l21.11"></a><span id="l21.11">     newMsgHdr-&gt;GetMessageId(getter_Copies(newMessageId));</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    if (m_pseudoHdrs.IsInitialized())</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-      m_pseudoHdrs.Get(newMessageId, &amp;pseudoKey);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+    m_pseudoHdrs.Get(newMessageId, &amp;pseudoKey);</span>
<a href="#l21.15"></a><span id="l21.15">     if (notifier &amp;&amp; pseudoKey != nsMsgKey_None)</span>
<a href="#l21.16"></a><span id="l21.16">     {</span>
<a href="#l21.17"></a><span id="l21.17">       notifier-&gt;NotifyMsgKeyChanged(pseudoKey, newMsgHdr);</span>
<a href="#l21.18"></a><span id="l21.18">       m_pseudoHdrs.Remove(newMessageId);</span>
<a href="#l21.19"></a><span id="l21.19">     }</span>
<a href="#l21.20"></a><span id="l21.20">     mDatabase-&gt;AddNewHdrToDB(newMsgHdr, true);</span>
<a href="#l21.21"></a><span id="l21.21">     if (notifier)</span>
<a href="#l21.22"></a><span id="l21.22">       notifier-&gt;NotifyMsgAdded(newMsgHdr);</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineat">@@ -3869,18 +3868,16 @@ NS_IMETHODIMP nsImapMailFolder::AddMoveR</span>
<a href="#l21.24"></a><span id="l21.24">   nsCOMPtr&lt;nsIMsgDBHdr&gt; pseudoHdr;</span>
<a href="#l21.25"></a><span id="l21.25">   rv = mDatabase-&gt;GetMsgHdrForKey(aMsgKey, getter_AddRefs(pseudoHdr));</span>
<a href="#l21.26"></a><span id="l21.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.27"></a><span id="l21.27">   nsCString messageId;</span>
<a href="#l21.28"></a><span id="l21.28">   pseudoHdr-&gt;GetMessageId(getter_Copies(messageId));</span>
<a href="#l21.29"></a><span id="l21.29">   // err on the side of caution and ignore messages w/o messageid.</span>
<a href="#l21.30"></a><span id="l21.30">   if (messageId.IsEmpty())</span>
<a href="#l21.31"></a><span id="l21.31">     return NS_OK;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-  if (!m_pseudoHdrs.IsInitialized())</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-    m_pseudoHdrs.Init(10);</span>
<a href="#l21.34"></a><span id="l21.34">   m_pseudoHdrs.Put(messageId, aMsgKey);</span>
<a href="#l21.35"></a><span id="l21.35">   return NS_OK;</span>
<a href="#l21.36"></a><span id="l21.36"> }</span>
<a href="#l21.37"></a><span id="l21.37"> </span>
<a href="#l21.38"></a><span id="l21.38"> NS_IMETHODIMP nsImapMailFolder::StoreImapFlags(int32_t flags, bool addFlags,</span>
<a href="#l21.39"></a><span id="l21.39">                                                nsMsgKey *keys, uint32_t numKeys,</span>
<a href="#l21.40"></a><span id="l21.40">                                                nsIUrlListener *aUrlListener)</span>
<a href="#l21.41"></a><span id="l21.41"> {</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineat">@@ -6150,20 +6147,20 @@ NS_IMETHODIMP nsImapMailFolder::GetCanOp</span>
<a href="#l21.43"></a><span id="l21.43"> }</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45"> ///////// nsMsgIMAPFolderACL class ///////////////////////////////</span>
<a href="#l21.46"></a><span id="l21.46"> </span>
<a href="#l21.47"></a><span id="l21.47"> // This string is defined in the ACL RFC to be &quot;anyone&quot;</span>
<a href="#l21.48"></a><span id="l21.48"> #define IMAP_ACL_ANYONE_STRING &quot;anyone&quot;</span>
<a href="#l21.49"></a><span id="l21.49"> </span>
<a href="#l21.50"></a><span id="l21.50"> nsMsgIMAPFolderACL::nsMsgIMAPFolderACL(nsImapMailFolder *folder)</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+: m_rightsHash(24)</span>
<a href="#l21.52"></a><span id="l21.52"> {</span>
<a href="#l21.53"></a><span id="l21.53">   NS_ASSERTION(folder, &quot;need folder&quot;);</span>
<a href="#l21.54"></a><span id="l21.54">   m_folder = folder;</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-  m_rightsHash.Init(24);</span>
<a href="#l21.56"></a><span id="l21.56">   m_aclCount = 0;</span>
<a href="#l21.57"></a><span id="l21.57">   BuildInitialACLFromCache();</span>
<a href="#l21.58"></a><span id="l21.58"> }</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60"> nsMsgIMAPFolderACL::~nsMsgIMAPFolderACL()</span>
<a href="#l21.61"></a><span id="l21.61"> {</span>
<a href="#l21.62"></a><span id="l21.62"> }</span>
<a href="#l21.63"></a><span id="l21.63"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -456,18 +456,16 @@ nsImapProtocol::nsImapProtocol() : nsMsg</span>
<a href="#l22.4"></a><span id="l22.4">   m_inputStreamBuffer = new nsMsgLineStreamBuffer(OUTPUT_BUFFER_SIZE, true /* allocate new lines */, false /* leave CRLFs on the returned string */);</span>
<a href="#l22.5"></a><span id="l22.5">   m_currentBiffState = nsIMsgFolder::nsMsgBiffState_Unknown;</span>
<a href="#l22.6"></a><span id="l22.6">   m_progressStringName.Truncate();</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   // since these are embedded in the nsImapProtocol object, but passed</span>
<a href="#l22.9"></a><span id="l22.9">   // through proxied xpcom methods, just AddRef them here.</span>
<a href="#l22.10"></a><span id="l22.10">   m_hdrDownloadCache = new nsMsgImapHdrXferInfo();</span>
<a href="#l22.11"></a><span id="l22.11">   m_downloadLineCache = new nsMsgImapLineDownloadCache();</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  m_standardListMailboxes.Init(0);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-  m_specialXListMailboxes.Init(0);</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15">   // subscription</span>
<a href="#l22.16"></a><span id="l22.16">   m_autoSubscribe = true;</span>
<a href="#l22.17"></a><span id="l22.17">   m_autoUnsubscribe = true;</span>
<a href="#l22.18"></a><span id="l22.18">   m_autoSubscribeOnOpen = true;</span>
<a href="#l22.19"></a><span id="l22.19">   m_deletableChildren = nullptr;</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21">   mFolderLastModSeq = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEAddressIterator.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEAddressIterator.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -77,17 +77,16 @@ static MAPIFields  gMapiFields[] = {</span>
<a href="#l23.4"></a><span id="l23.4">   { 11, 12, PR_HOME_ADDRESS_STREET},</span>
<a href="#l23.5"></a><span id="l23.5">   { 24, kNoMultiLine, PR_DEPARTMENT_NAME}</span>
<a href="#l23.6"></a><span id="l23.6"> };</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> nsOEAddressIterator::nsOEAddressIterator(CWAB *pWab, nsIAddrDatabase *database)</span>
<a href="#l23.9"></a><span id="l23.9"> {</span>
<a href="#l23.10"></a><span id="l23.10">   m_pWab = pWab;</span>
<a href="#l23.11"></a><span id="l23.11">   m_database = database;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  m_listRows.Init();</span>
<a href="#l23.13"></a><span id="l23.13"> }</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15"> nsOEAddressIterator::~nsOEAddressIterator()</span>
<a href="#l23.16"></a><span id="l23.16"> {</span>
<a href="#l23.17"></a><span id="l23.17"> }</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19"> nsresult nsOEAddressIterator::EnumUser(const PRUnichar * pName, LPENTRYID pEid, ULONG cbEid)</span>
<a href="#l23.20"></a><span id="l23.20"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -35,17 +35,16 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;prprf.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &lt;cstdlib&gt; // for std::abs(int/long)</span>
<a href="#l24.8"></a><span id="l24.8"> #include &lt;cmath&gt; // for std::abs(float/double)</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10"> nsMsgBrkMBoxStore::nsMsgBrkMBoxStore()</span>
<a href="#l24.11"></a><span id="l24.11"> {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  m_outputStreams.Init();</span>
<a href="#l24.13"></a><span id="l24.13"> }</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15"> nsMsgBrkMBoxStore::~nsMsgBrkMBoxStore()</span>
<a href="#l24.16"></a><span id="l24.16"> {</span>
<a href="#l24.17"></a><span id="l24.17"> }</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19"> NS_IMPL_ISUPPORTS1(nsMsgBrkMBoxStore, nsIMsgPluggableStore)</span>
<a href="#l24.20"></a><span id="l24.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.h</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.h</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -7,17 +7,16 @@</span>
<a href="#l25.4"></a><span id="l25.4">    Class for handling Maildir stores.</span>
<a href="#l25.5"></a><span id="l25.5"> */</span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7"> #ifndef nsMsgMaildirStore_h__</span>
<a href="#l25.8"></a><span id="l25.8"> #define nsMsgMaildirStore_h__</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10"> #include &quot;nsMsgLocalStoreUtils.h&quot;</span>
<a href="#l25.11"></a><span id="l25.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-#include &quot;nsInterfaceHashtable.h&quot;</span>
<a href="#l25.13"></a><span id="l25.13"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15"> class nsMsgMaildirStore MOZ_FINAL : public nsMsgLocalStoreUtils, nsIMsgPluggableStore</span>
<a href="#l25.16"></a><span id="l25.16"> {</span>
<a href="#l25.17"></a><span id="l25.17"> public:</span>
<a href="#l25.18"></a><span id="l25.18">   NS_DECL_ISUPPORTS</span>
<a href="#l25.19"></a><span id="l25.19">   NS_DECL_NSIMSGPLUGGABLESTORE</span>
<a href="#l25.20"></a><span id="l25.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiMain.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiMain.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -22,18 +22,16 @@ nsMAPIConfiguration *nsMAPIConfiguration</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5">   return m_pSelfRef;</span>
<a href="#l26.6"></a><span id="l26.6"> }</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> nsMAPIConfiguration::nsMAPIConfiguration()</span>
<a href="#l26.9"></a><span id="l26.9"> : m_nMaxSessions(MAX_SESSIONS)</span>
<a href="#l26.10"></a><span id="l26.10"> {</span>
<a href="#l26.11"></a><span id="l26.11">   m_Lock = PR_NewLock();</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  m_SessionMap.Init();</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  m_ProfileMap.Init();</span>
<a href="#l26.14"></a><span id="l26.14"> }</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16"> nsMAPIConfiguration::~nsMAPIConfiguration()</span>
<a href="#l26.17"></a><span id="l26.17"> {</span>
<a href="#l26.18"></a><span id="l26.18">   if (m_Lock)</span>
<a href="#l26.19"></a><span id="l26.19">     PR_DestroyLock(m_Lock);</span>
<a href="#l26.20"></a><span id="l26.20"> }</span>
<a href="#l26.21"></a><span id="l26.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

