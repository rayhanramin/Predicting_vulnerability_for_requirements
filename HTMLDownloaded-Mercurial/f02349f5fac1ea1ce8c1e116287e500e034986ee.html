<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29523:f02349f5fac1ea1ce8c1e116287e500e034986ee</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f02349f5fac1ea1ce8c1e116287e500e034986ee" />
<meta property="og:url" content="/comm-central/rev/f02349f5fac1ea1ce8c1e116287e500e034986ee" />
<meta property="og:description" content="Bug 1636240 - Add script to generate rnp.symbols file. r=kaie" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f02349f5fac1ea1ce8c1e116287e500e034986ee 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f02349f5fac1ea1ce8c1e116287e500e034986ee">shortlog</a> |
<a href="/comm-central/log/f02349f5fac1ea1ce8c1e116287e500e034986ee">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f02349f5fac1ea1ce8c1e116287e500e034986ee">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f02349f5fac1ea1ce8c1e116287e500e034986ee">files</a> |
changeset |
<a href="/comm-central/raw-rev/f02349f5fac1ea1ce8c1e116287e500e034986ee">raw</a>  | <a href="/comm-central/archive/f02349f5fac1ea1ce8c1e116287e500e034986ee.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1636240">Bug 1636240</a> - Add script to generate rnp.symbols file. r=kaie
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#32;&#76;&#101;&#109;&#108;&#101;&#121;&#32;&#60;&#114;&#111;&#98;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 06 May 2020 19:21:45 -0400</td></tr>

<tr>
 <td>changeset 29523</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f02349f5fac1ea1ce8c1e116287e500e034986ee">f02349f5fac1ea1ce8c1e116287e500e034986ee</a></td>
</tr>



<tr>
<td>parent 29522</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/de5c89a17b436079f55f774e96d459fe7c662124">de5c89a17b436079f55f774e96d459fe7c662124</a>
</td>
</tr>

<tr>
<td>child 29524</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1cc2836506891f2e78a82f067a7206910468557a">1cc2836506891f2e78a82f067a7206910468557a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f02349f5fac1ea1ce8c1e116287e500e034986ee">17413</a></td></tr>
<tr><td>push user</td><td>thunderbird@calypsoblue.org</td></tr>
<tr><td>push date</td><td class="date age">Fri, 08 May 2020 19:14:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0657662eb16a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0657662eb16a5feea76cfc0b381d897e1f0f1328">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0657662eb16a5feea76cfc0b381d897e1f0f1328&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0657662eb16a5feea76cfc0b381d897e1f0f1328&newProject=comm-central&newRevision=de5c89a17b436079f55f774e96d459fe7c662124&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0657662eb16a5feea76cfc0b381d897e1f0f1328&newProject=comm-central&newRevision=de5c89a17b436079f55f774e96d459fe7c662124&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0657662eb16a5feea76cfc0b381d897e1f0f1328&newProject=comm-central&newRevision=de5c89a17b436079f55f774e96d459fe7c662124&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28kaie%29&revcount=50">kaie</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1636240">1636240</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1636240">Bug 1636240</a> - Add script to generate rnp.symbols file. r=kaie

rnp.symbols is the list of symbols that are exported from librnp.
When our copy of RNP gets updated, there may be new symbols that
need to be exported.
The script reads rnp/include/rnp/rnp.h pycparser, which needs to be
provided by the developer.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f02349f5fac1ea1ce8c1e116287e500e034986ee/python/thirdroc/thirdroc/rnp_symbols.py">python/thirdroc/thirdroc/rnp_symbols.py</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f02349f5fac1ea1ce8c1e116287e500e034986ee/python/thirdroc/thirdroc/rnp_symbols.py">file</a> |
<a href="/comm-central/annotate/f02349f5fac1ea1ce8c1e116287e500e034986ee/python/thirdroc/thirdroc/rnp_symbols.py">annotate</a> |
<a href="/comm-central/diff/f02349f5fac1ea1ce8c1e116287e500e034986ee/python/thirdroc/thirdroc/rnp_symbols.py">diff</a> |
<a href="/comm-central/comparison/f02349f5fac1ea1ce8c1e116287e500e034986ee/python/thirdroc/thirdroc/rnp_symbols.py">comparison</a> |
<a href="/comm-central/log/f02349f5fac1ea1ce8c1e116287e500e034986ee/python/thirdroc/thirdroc/rnp_symbols.py">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">new file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- /dev/null</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ b/python/thirdroc/thirdroc/rnp_symbols.py</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -0,0 +1,58 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineplus">+#!/usr/bin/python3</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+&quot;&quot;&quot;</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+Parse rnp/rnp.h header file and build a symbols file suitable</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+for use with mozbuild.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+&quot;&quot;&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+from __future__ import absolute_import, print_function</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+import sys</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+import os</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+try:</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+    import pycparser_fake_libc</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+    from pycparser import parse_file</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+    from pycparser.c_ast import Decl</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+    from pycparserext.ext_c_parser import (</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+        FuncDeclExt,</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+        GnuCParser,</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+    )</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+except ImportError:</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+    print(&quot;One or more dependencies not found: pycparser, pycparserext, pycparser_fake_libc&quot;)</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+    sys.exit(1)</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+HERE = os.path.dirname(__file__)</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+TOPSRCDIR = os.path.abspath(os.path.join(HERE, '../../../../'))</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+def is_func(obj):</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+    if isinstance(obj, Decl):</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+        return isinstance(obj.type, FuncDeclExt)</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+def extract_func_defs(filename):</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+    # Note that cpp is used. Provide a path to your own cpp or</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+    # make sure one exists in PATH.</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+    ast = parse_file(filename, use_cpp=True,</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+                     cpp_args=r'-I{}'.format(pycparser_fake_libc.directory),</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+                     parser=GnuCParser(lex_optimize=False, yacc_optimize=False))</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+    for node in ast.children():</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+        decl = node[1]</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+        if is_func(decl):</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+            yield decl.name</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+if __name__ == &quot;__main__&quot;:</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+    if len(sys.argv) &gt; 1:</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+        FILENAME = sys.argv[1]</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+    else:</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        FILENAME = os.path.join(TOPSRCDIR,</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+                                'comm/third_party/rnp/include/rnp/rnp.h')</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+    for f in sorted(extract_func_defs(FILENAME)):</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+        print(f)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

