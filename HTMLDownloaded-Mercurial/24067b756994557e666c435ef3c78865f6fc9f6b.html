<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22130:24067b756994557e666c435ef3c78865f6fc9f6b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 24067b756994557e666c435ef3c78865f6fc9f6b" />
<meta property="og:url" content="/comm-central/rev/24067b756994557e666c435ef3c78865f6fc9f6b" />
<meta property="og:description" content="Bug 1399756 - remove trailing spaces in mailnews/base/search. rs=white-space-only" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 24067b756994557e666c435ef3c78865f6fc9f6b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/24067b756994557e666c435ef3c78865f6fc9f6b">shortlog</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/24067b756994557e666c435ef3c78865f6fc9f6b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b">files</a> |
changeset |
<a href="/comm-central/raw-rev/24067b756994557e666c435ef3c78865f6fc9f6b">raw</a>  | <a href="/comm-central/archive/24067b756994557e666c435ef3c78865f6fc9f6b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">Bug 1399756</a> - remove trailing spaces in mailnews/base/search. rs=white-space-only
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 14 Sep 2017 09:50:16 +0200</td></tr>

<tr>
 <td>changeset 22130</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/24067b756994557e666c435ef3c78865f6fc9f6b">24067b756994557e666c435ef3c78865f6fc9f6b</a></td>
</tr>



<tr>
<td>parent 22129</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/87fec3bfd6453474b405b8009f1893286d8d10a4">87fec3bfd6453474b405b8009f1893286d8d10a4</a>
</td>
</tr>

<tr>
<td>child 22131</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f8fea55e9bd53d7f068455c89376c04e3a82559e">f8fea55e9bd53d7f068455c89376c04e3a82559e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=24067b756994557e666c435ef3c78865f6fc9f6b">13508</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 14 Sep 2017 07:52:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@24067b756994 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=24067b756994557e666c435ef3c78865f6fc9f6b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=24067b756994557e666c435ef3c78865f6fc9f6b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=24067b756994557e666c435ef3c78865f6fc9f6b&newProject=comm-central&newRevision=24067b756994557e666c435ef3c78865f6fc9f6b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=24067b756994557e666c435ef3c78865f6fc9f6b&newProject=comm-central&newRevision=24067b756994557e666c435ef3c78865f6fc9f6b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=24067b756994557e666c435ef3c78865f6fc9f6b&newProject=comm-central&newRevision=24067b756994557e666c435ef3c78865f6fc9f6b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28white-space-only%29&revcount=50">white-space-only</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">1399756</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1399756">Bug 1399756</a> - remove trailing spaces in mailnews/base/search. rs=white-space-only</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgBodyHandler.cpp">mailnews/base/search/src/nsMsgBodyHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgBodyHandler.cpp">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgBodyHandler.cpp">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgBodyHandler.cpp">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgBodyHandler.cpp">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgBodyHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgFilterList.h">mailnews/base/search/src/nsMsgFilterList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgFilterList.h">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgFilterList.h">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgFilterList.h">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgFilterList.h">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgFilterList.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgImapSearch.cpp">mailnews/base/search/src/nsMsgImapSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgImapSearch.cpp">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgImapSearch.cpp">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgImapSearch.cpp">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgImapSearch.cpp">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgImapSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchNews.cpp">mailnews/base/search/src/nsMsgSearchNews.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchNews.cpp">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchNews.cpp">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchNews.cpp">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchNews.cpp">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchNews.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchSession.cpp">mailnews/base/search/src/nsMsgSearchSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchSession.cpp">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchSession.cpp">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchSession.cpp">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchSession.cpp">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.cpp">mailnews/base/search/src/nsMsgSearchValue.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.cpp">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.cpp">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.cpp">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.cpp">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.h">mailnews/base/search/src/nsMsgSearchValue.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.h">file</a> |
<a href="/comm-central/annotate/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.h">annotate</a> |
<a href="/comm-central/diff/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.h">diff</a> |
<a href="/comm-central/comparison/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.h">comparison</a> |
<a href="/comm-central/log/24067b756994557e666c435ef3c78865f6fc9f6b/mailnews/base/search/src/nsMsgSearchValue.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -26,25 +26,25 @@ nsMsgBodyHandler::nsMsgBodyHandler (nsIM</span>
<a href="#l1.4"></a><span id="l1.4">   uint32_t flags;</span>
<a href="#l1.5"></a><span id="l1.5">   m_lineCountInBodyLines = NS_SUCCEEDED(msg-&gt;GetFlags(&amp;flags)) ?</span>
<a href="#l1.6"></a><span id="l1.6">     !(flags &amp; nsMsgMessageFlags::Offline) : true;</span>
<a href="#l1.7"></a><span id="l1.7">   // account for added x-mozilla-status lines, and envelope line.</span>
<a href="#l1.8"></a><span id="l1.8">   if (!m_lineCountInBodyLines)</span>
<a href="#l1.9"></a><span id="l1.9">     m_numLocalLines += 3;</span>
<a href="#l1.10"></a><span id="l1.10">   m_msgHdr = msg;</span>
<a href="#l1.11"></a><span id="l1.11">   m_db = db;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  </span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+</span>
<a href="#l1.14"></a><span id="l1.14">   // the following are variables used when the body handler is handling stuff from filters....through this constructor, that is not the</span>
<a href="#l1.15"></a><span id="l1.15">   // case so we set them to NULL.</span>
<a href="#l1.16"></a><span id="l1.16">   m_headers = NULL;</span>
<a href="#l1.17"></a><span id="l1.17">   m_headersSize = 0;</span>
<a href="#l1.18"></a><span id="l1.18">   m_Filtering = false; // make sure we set this before we call initialize...</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-  </span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+</span>
<a href="#l1.21"></a><span id="l1.21">   Initialize();  // common initialization stuff</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-  OpenLocalFolder();      </span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+  OpenLocalFolder();</span>
<a href="#l1.24"></a><span id="l1.24"> }</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26"> nsMsgBodyHandler::nsMsgBodyHandler(nsIMsgSearchScopeTerm * scope,</span>
<a href="#l1.27"></a><span id="l1.27">                                    uint32_t numLines,</span>
<a href="#l1.28"></a><span id="l1.28">                                    nsIMsgDBHdr* msg, nsIMsgDatabase* db,</span>
<a href="#l1.29"></a><span id="l1.29">                                    const char * headers, uint32_t headersSize,</span>
<a href="#l1.30"></a><span id="l1.30">                                    bool Filtering)</span>
<a href="#l1.31"></a><span id="l1.31"> {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineat">@@ -55,19 +55,19 @@ nsMsgBodyHandler::nsMsgBodyHandler(nsIMs</span>
<a href="#l1.33"></a><span id="l1.33">     !(flags &amp; nsMsgMessageFlags::Offline) : true;</span>
<a href="#l1.34"></a><span id="l1.34">   // account for added x-mozilla-status lines, and envelope line.</span>
<a href="#l1.35"></a><span id="l1.35">   if (!m_lineCountInBodyLines)</span>
<a href="#l1.36"></a><span id="l1.36">     m_numLocalLines += 3;</span>
<a href="#l1.37"></a><span id="l1.37">   m_msgHdr = msg;</span>
<a href="#l1.38"></a><span id="l1.38">   m_db = db;</span>
<a href="#l1.39"></a><span id="l1.39">   m_headersSize = headersSize;</span>
<a href="#l1.40"></a><span id="l1.40">   m_Filtering = Filtering;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-  </span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+</span>
<a href="#l1.43"></a><span id="l1.43">   Initialize();</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-  </span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+</span>
<a href="#l1.46"></a><span id="l1.46">   if (m_Filtering)</span>
<a href="#l1.47"></a><span id="l1.47">     m_headers = headers;</span>
<a href="#l1.48"></a><span id="l1.48">   else</span>
<a href="#l1.49"></a><span id="l1.49">     OpenLocalFolder();  // if nothing else applies, then we must be a POP folder file</span>
<a href="#l1.50"></a><span id="l1.50"> }</span>
<a href="#l1.51"></a><span id="l1.51"> </span>
<a href="#l1.52"></a><span id="l1.52"> void nsMsgBodyHandler::Initialize()</span>
<a href="#l1.53"></a><span id="l1.53"> // common initialization code regardless of what body type we are handling...</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineat">@@ -103,17 +103,17 @@ int32_t nsMsgBodyHandler::GetNextLine (n</span>
<a href="#l1.55"></a><span id="l1.55">       // 3 cases: Offline IMAP, POP, or we are dealing with a news message....</span>
<a href="#l1.56"></a><span id="l1.56">       // Offline cases should be same as local mail cases, since we're going</span>
<a href="#l1.57"></a><span id="l1.57">       // to store offline messages in berkeley format folders.</span>
<a href="#l1.58"></a><span id="l1.58">       if (m_db)</span>
<a href="#l1.59"></a><span id="l1.59">       {</span>
<a href="#l1.60"></a><span id="l1.60">          length = GetNextLocalLine (nextLine); // (2) POP</span>
<a href="#l1.61"></a><span id="l1.61">       }</span>
<a href="#l1.62"></a><span id="l1.62">     }</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-    </span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+</span>
<a href="#l1.65"></a><span id="l1.65">     if (length &lt; 0)</span>
<a href="#l1.66"></a><span id="l1.66">       break; // eof in</span>
<a href="#l1.67"></a><span id="l1.67"> </span>
<a href="#l1.68"></a><span id="l1.68">     outLength = ApplyTransformations(nextLine, length, eatThisLine, buf);</span>
<a href="#l1.69"></a><span id="l1.69">   }</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71">   if (outLength &lt; 0)</span>
<a href="#l1.72"></a><span id="l1.72">     return -1; // eof out</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineat">@@ -144,34 +144,34 @@ int32_t nsMsgBodyHandler::GetNextFilterL</span>
<a href="#l1.74"></a><span id="l1.74"> {</span>
<a href="#l1.75"></a><span id="l1.75">   // m_nextHdr always points to the next header in the list....the list is NULL terminated...</span>
<a href="#l1.76"></a><span id="l1.76">   uint32_t numBytesCopied = 0;</span>
<a href="#l1.77"></a><span id="l1.77">   if (m_headersSize &gt; 0)</span>
<a href="#l1.78"></a><span id="l1.78">   {</span>
<a href="#l1.79"></a><span id="l1.79">     // #mscott. Ugly hack! filter headers list have CRs &amp; LFs inside the NULL delimited list of header</span>
<a href="#l1.80"></a><span id="l1.80">     // strings. It is possible to have: To NULL CR LF From. We want to skip over these CR/LFs if they start</span>
<a href="#l1.81"></a><span id="l1.81">     // at the beginning of what we think is another header.</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-    </span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+</span>
<a href="#l1.84"></a><span id="l1.84">     while (m_headersSize &gt; 0 &amp;&amp; (m_headers[0] == '\r' || m_headers[0] == '\n' || m_headers[0] == ' ' || m_headers[0] == '\0'))</span>
<a href="#l1.85"></a><span id="l1.85">     {</span>
<a href="#l1.86"></a><span id="l1.86">       m_headers++;  // skip over these chars...</span>
<a href="#l1.87"></a><span id="l1.87">       m_headersSize--;</span>
<a href="#l1.88"></a><span id="l1.88">     }</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-    </span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+</span>
<a href="#l1.91"></a><span id="l1.91">     if (m_headersSize &gt; 0)</span>
<a href="#l1.92"></a><span id="l1.92">     {</span>
<a href="#l1.93"></a><span id="l1.93">       numBytesCopied = strlen(m_headers) + 1 ;</span>
<a href="#l1.94"></a><span id="l1.94">       buf.Assign(m_headers);</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-      m_headers += numBytesCopied;  </span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-      // be careful...m_headersSize is unsigned. Don't let it go negative or we overflow to 2^32....*yikes*  </span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+      m_headers += numBytesCopied;</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+      // be careful...m_headersSize is unsigned. Don't let it go negative or we overflow to 2^32....*yikes*</span>
<a href="#l1.99"></a><span id="l1.99">       if (m_headersSize &lt; numBytesCopied)</span>
<a href="#l1.100"></a><span id="l1.100">         m_headersSize = 0;</span>
<a href="#l1.101"></a><span id="l1.101">       else</span>
<a href="#l1.102"></a><span id="l1.102">         m_headersSize -= numBytesCopied;  // update # bytes we have read from the headers list</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-      </span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+</span>
<a href="#l1.105"></a><span id="l1.105">       return (int32_t) numBytesCopied;</span>
<a href="#l1.106"></a><span id="l1.106">     }</span>
<a href="#l1.107"></a><span id="l1.107">   }</span>
<a href="#l1.108"></a><span id="l1.108">   else if (m_headersSize == 0) {</span>
<a href="#l1.109"></a><span id="l1.109">     buf.Truncate();</span>
<a href="#l1.110"></a><span id="l1.110">   }</span>
<a href="#l1.111"></a><span id="l1.111">   return -1;</span>
<a href="#l1.112"></a><span id="l1.112"> }</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineat">@@ -192,23 +192,23 @@ int32_t nsMsgBodyHandler::GetNextLocalLi</span>
<a href="#l1.114"></a><span id="l1.114">     if (m_fileLineStream)</span>
<a href="#l1.115"></a><span id="l1.115">     {</span>
<a href="#l1.116"></a><span id="l1.116">       bool more = false;</span>
<a href="#l1.117"></a><span id="l1.117">       nsresult rv = m_fileLineStream-&gt;ReadLine(buf, &amp;more);</span>
<a href="#l1.118"></a><span id="l1.118">       if (NS_SUCCEEDED(rv))</span>
<a href="#l1.119"></a><span id="l1.119">         return buf.Length();</span>
<a href="#l1.120"></a><span id="l1.120">     }</span>
<a href="#l1.121"></a><span id="l1.121">   }</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineminus">-  </span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+</span>
<a href="#l1.124"></a><span id="l1.124">   return -1;</span>
<a href="#l1.125"></a><span id="l1.125"> }</span>
<a href="#l1.126"></a><span id="l1.126"> </span>
<a href="#l1.127"></a><span id="l1.127"> /**</span>
<a href="#l1.128"></a><span id="l1.128">  * This method applies a sequence of transformations to the line.</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineminus">- * </span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+ *</span>
<a href="#l1.131"></a><span id="l1.131">  * It applies the following sequences in order</span>
<a href="#l1.132"></a><span id="l1.132">  * * Removes headers if the searcher doesn't want them</span>
<a href="#l1.133"></a><span id="l1.133">  *   (sets m_pastHeaders)</span>
<a href="#l1.134"></a><span id="l1.134">  * * Determines the current MIME type.</span>
<a href="#l1.135"></a><span id="l1.135">  *   (via SniffPossibleMIMEHeader)</span>
<a href="#l1.136"></a><span id="l1.136">  * * Strips any HTML if the searcher doesn't want it</span>
<a href="#l1.137"></a><span id="l1.137">  * * Strips non-text parts</span>
<a href="#l1.138"></a><span id="l1.138">  * * Decodes any base64 part</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineat">@@ -223,38 +223,38 @@ int32_t nsMsgBodyHandler::GetNextLocalLi</span>
<a href="#l1.140"></a><span id="l1.140">  *                            redundant version of line).</span>
<a href="#l1.141"></a><span id="l1.141">  * @return            the length of the line after applying transformations</span>
<a href="#l1.142"></a><span id="l1.142">  */</span>
<a href="#l1.143"></a><span id="l1.143"> int32_t nsMsgBodyHandler::ApplyTransformations (const nsCString &amp;line, int32_t length,</span>
<a href="#l1.144"></a><span id="l1.144">                                                 bool &amp;eatThisLine, nsCString &amp;buf)</span>
<a href="#l1.145"></a><span id="l1.145"> {</span>
<a href="#l1.146"></a><span id="l1.146">   int32_t newLength = length;</span>
<a href="#l1.147"></a><span id="l1.147">   eatThisLine = false;</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-  </span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+</span>
<a href="#l1.150"></a><span id="l1.150">   if (!m_pastHeaders)  // line is a line from the message headers</span>
<a href="#l1.151"></a><span id="l1.151">   {</span>
<a href="#l1.152"></a><span id="l1.152">     if (m_stripHeaders)</span>
<a href="#l1.153"></a><span id="l1.153">       eatThisLine = true;</span>
<a href="#l1.154"></a><span id="l1.154"> </span>
<a href="#l1.155"></a><span id="l1.155">     // We have already grabbed all worthwhile information from the headers,</span>
<a href="#l1.156"></a><span id="l1.156">     // so there is no need to keep track of the current lines</span>
<a href="#l1.157"></a><span id="l1.157">     buf.Assign(line);</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineminus">-   </span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+</span>
<a href="#l1.160"></a><span id="l1.160">     SniffPossibleMIMEHeader(buf);</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineminus">-    </span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+</span>
<a href="#l1.163"></a><span id="l1.163">     m_pastHeaders = buf.IsEmpty() || buf.First() == '\r' ||</span>
<a href="#l1.164"></a><span id="l1.164">       buf.First() == '\n';</span>
<a href="#l1.165"></a><span id="l1.165"> </span>
<a href="#l1.166"></a><span id="l1.166">     return length;</span>
<a href="#l1.167"></a><span id="l1.167">   }</span>
<a href="#l1.168"></a><span id="l1.168"> </span>
<a href="#l1.169"></a><span id="l1.169">   // Check to see if this is the boundary string</span>
<a href="#l1.170"></a><span id="l1.170">   if (m_isMultipart &amp;&amp; StringBeginsWith(line, boundary))</span>
<a href="#l1.171"></a><span id="l1.171">   {</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineminus">-    if (m_base64part &amp;&amp; m_partIsText) </span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+    if (m_base64part &amp;&amp; m_partIsText)</span>
<a href="#l1.174"></a><span id="l1.174">     {</span>
<a href="#l1.175"></a><span id="l1.175">       Base64Decode(buf);</span>
<a href="#l1.176"></a><span id="l1.176">       // Work on the parsed string</span>
<a href="#l1.177"></a><span id="l1.177">       if (!buf.Length())</span>
<a href="#l1.178"></a><span id="l1.178">       {</span>
<a href="#l1.179"></a><span id="l1.179">         NS_WARNING(&quot;Trying to transform an empty buffer&quot;);</span>
<a href="#l1.180"></a><span id="l1.180">         eatThisLine = true;</span>
<a href="#l1.181"></a><span id="l1.181">       }</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineat">@@ -274,67 +274,67 @@ int32_t nsMsgBodyHandler::ApplyTransform</span>
<a href="#l1.183"></a><span id="l1.183">     // Reset all assumed headers</span>
<a href="#l1.184"></a><span id="l1.184">     m_base64part = false;</span>
<a href="#l1.185"></a><span id="l1.185">     m_pastHeaders = false;</span>
<a href="#l1.186"></a><span id="l1.186">     m_partIsHtml = false;</span>
<a href="#l1.187"></a><span id="l1.187">     m_partIsText = true;</span>
<a href="#l1.188"></a><span id="l1.188"> </span>
<a href="#l1.189"></a><span id="l1.189">     return buf.Length();</span>
<a href="#l1.190"></a><span id="l1.190">   }</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineminus">- </span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+</span>
<a href="#l1.193"></a><span id="l1.193">   if (!m_partIsText)</span>
<a href="#l1.194"></a><span id="l1.194">   {</span>
<a href="#l1.195"></a><span id="l1.195">     // Ignore non-text parts</span>
<a href="#l1.196"></a><span id="l1.196">     buf.Truncate();</span>
<a href="#l1.197"></a><span id="l1.197">     eatThisLine = true;</span>
<a href="#l1.198"></a><span id="l1.198">     return 0;</span>
<a href="#l1.199"></a><span id="l1.199">   }</span>
<a href="#l1.200"></a><span id="l1.200"> </span>
<a href="#l1.201"></a><span id="l1.201">   if (m_base64part)</span>
<a href="#l1.202"></a><span id="l1.202">   {</span>
<a href="#l1.203"></a><span id="l1.203">     // We need to keep track of all lines to parse base64encoded...</span>
<a href="#l1.204"></a><span id="l1.204">     buf.Append(line.get());</span>
<a href="#l1.205"></a><span id="l1.205">     eatThisLine = true;</span>
<a href="#l1.206"></a><span id="l1.206">     return buf.Length();</span>
<a href="#l1.207"></a><span id="l1.207">   }</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineminus">-    </span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+</span>
<a href="#l1.210"></a><span id="l1.210">   // ... but there's no point if we're not parsing base64.</span>
<a href="#l1.211"></a><span id="l1.211">   buf.Assign(line);</span>
<a href="#l1.212"></a><span id="l1.212">   if (m_stripHtml &amp;&amp; m_partIsHtml)</span>
<a href="#l1.213"></a><span id="l1.213">   {</span>
<a href="#l1.214"></a><span id="l1.214">     StripHtml (buf);</span>
<a href="#l1.215"></a><span id="l1.215">     newLength = buf.Length();</span>
<a href="#l1.216"></a><span id="l1.216">   }</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineminus">-  </span>
<a href="#l1.218"></a><span id="l1.218" class="difflineplus">+</span>
<a href="#l1.219"></a><span id="l1.219">   return newLength;</span>
<a href="#l1.220"></a><span id="l1.220"> }</span>
<a href="#l1.221"></a><span id="l1.221"> </span>
<a href="#l1.222"></a><span id="l1.222"> void nsMsgBodyHandler::StripHtml (nsCString &amp;pBufInOut)</span>
<a href="#l1.223"></a><span id="l1.223"> {</span>
<a href="#l1.224"></a><span id="l1.224">   char *pBuf = (char*) PR_Malloc (pBufInOut.Length() + 1);</span>
<a href="#l1.225"></a><span id="l1.225">   if (pBuf)</span>
<a href="#l1.226"></a><span id="l1.226">   {</span>
<a href="#l1.227"></a><span id="l1.227">     char *pWalk = pBuf;</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineminus">-    </span>
<a href="#l1.229"></a><span id="l1.229" class="difflineplus">+</span>
<a href="#l1.230"></a><span id="l1.230">     char *pWalkInOut = (char *) pBufInOut.get();</span>
<a href="#l1.231"></a><span id="l1.231">     bool inTag = false;</span>
<a href="#l1.232"></a><span id="l1.232">     while (*pWalkInOut) // throw away everything inside &lt; &gt;</span>
<a href="#l1.233"></a><span id="l1.233">     {</span>
<a href="#l1.234"></a><span id="l1.234">       if (!inTag)</span>
<a href="#l1.235"></a><span id="l1.235">         if (*pWalkInOut == '&lt;')</span>
<a href="#l1.236"></a><span id="l1.236">           inTag = true;</span>
<a href="#l1.237"></a><span id="l1.237">         else</span>
<a href="#l1.238"></a><span id="l1.238">           *pWalk++ = *pWalkInOut;</span>
<a href="#l1.239"></a><span id="l1.239">         else</span>
<a href="#l1.240"></a><span id="l1.240">           if (*pWalkInOut == '&gt;')</span>
<a href="#l1.241"></a><span id="l1.241">             inTag = false;</span>
<a href="#l1.242"></a><span id="l1.242">       pWalkInOut++;</span>
<a href="#l1.243"></a><span id="l1.243">     }</span>
<a href="#l1.244"></a><span id="l1.244">     *pWalk = 0; // null terminator</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-    </span>
<a href="#l1.246"></a><span id="l1.246" class="difflineplus">+</span>
<a href="#l1.247"></a><span id="l1.247">     pBufInOut.Adopt(pBuf);</span>
<a href="#l1.248"></a><span id="l1.248">   }</span>
<a href="#l1.249"></a><span id="l1.249"> }</span>
<a href="#l1.250"></a><span id="l1.250"> </span>
<a href="#l1.251"></a><span id="l1.251"> /**</span>
<a href="#l1.252"></a><span id="l1.252">  * Determines the MIME type, if present, from the current line.</span>
<a href="#l1.253"></a><span id="l1.253">  *</span>
<a href="#l1.254"></a><span id="l1.254">  * m_partIsHtml, m_isMultipart, m_partIsText, m_base64part, and boundary are</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineat">@@ -420,11 +420,11 @@ void nsMsgBodyHandler::Base64Decode (nsC</span>
<a href="#l1.256"></a><span id="l1.256">   while (offset != -1) {</span>
<a href="#l1.257"></a><span id="l1.257">     pBufInOut.Replace(offset, 1, ' ');</span>
<a href="#l1.258"></a><span id="l1.258">     offset = pBufInOut.FindChar('\n', offset);</span>
<a href="#l1.259"></a><span id="l1.259">   }</span>
<a href="#l1.260"></a><span id="l1.260">   offset = pBufInOut.FindChar('\r');</span>
<a href="#l1.261"></a><span id="l1.261">   while (offset != -1) {</span>
<a href="#l1.262"></a><span id="l1.262">     pBufInOut.Replace(offset, 1, ' ');</span>
<a href="#l1.263"></a><span id="l1.263">     offset = pBufInOut.FindChar('\r', offset);</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineminus">-  } </span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+  }</span>
<a href="#l1.266"></a><span id="l1.266"> }</span>
<a href="#l1.267"></a><span id="l1.267"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -58,17 +58,17 @@ protected:</span>
<a href="#l2.4"></a><span id="l2.4">   bool m_loggingEnabled;</span>
<a href="#l2.5"></a><span id="l2.5">   bool m_startWritingToBuffer; //tells us when to start writing one whole filter to m_unparsedBuffer</span>
<a href="#l2.6"></a><span id="l2.6">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folder;</span>
<a href="#l2.7"></a><span id="l2.7">   nsMsgFilter *m_curFilter; // filter we're filing in or out(?)</span>
<a href="#l2.8"></a><span id="l2.8">   nsCString m_filterFileName;</span>
<a href="#l2.9"></a><span id="l2.9">   nsTArray&lt;nsCOMPtr&lt;nsIMsgFilter&gt; &gt; m_filters;</span>
<a href="#l2.10"></a><span id="l2.10">   nsCString m_arbitraryHeaders;</span>
<a href="#l2.11"></a><span id="l2.11">   nsCOMPtr&lt;nsIFile&gt; m_defaultFile;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  nsCString m_unparsedFilterBuffer; //holds one entire filter unparsed </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  nsCString m_unparsedFilterBuffer; //holds one entire filter unparsed</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> private:</span>
<a href="#l2.16"></a><span id="l2.16">   nsresult TruncateLog();</span>
<a href="#l2.17"></a><span id="l2.17">   nsresult GetLogFile(nsIFile **aFile);</span>
<a href="#l2.18"></a><span id="l2.18">   nsresult EnsureLogFile(nsIFile *file);</span>
<a href="#l2.19"></a><span id="l2.19">   nsCOMPtr&lt;nsIOutputStream&gt; m_logStream;</span>
<a href="#l2.20"></a><span id="l2.20"> };</span>
<a href="#l2.21"></a><span id="l2.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -15,37 +15,37 @@</span>
<a href="#l3.4"></a><span id="l3.4"> // Implementation of search for IMAP mail folders</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> nsMsgSearchOnlineMail::nsMsgSearchOnlineMail (nsMsgSearchScopeTerm *scope, nsIArray *termList) : nsMsgSearchAdapter (scope, termList)</span>
<a href="#l3.8"></a><span id="l3.8"> {</span>
<a href="#l3.9"></a><span id="l3.9"> }</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-nsMsgSearchOnlineMail::~nsMsgSearchOnlineMail () </span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+nsMsgSearchOnlineMail::~nsMsgSearchOnlineMail ()</span>
<a href="#l3.14"></a><span id="l3.14"> {</span>
<a href="#l3.15"></a><span id="l3.15"> }</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> nsresult nsMsgSearchOnlineMail::ValidateTerms ()</span>
<a href="#l3.19"></a><span id="l3.19"> {</span>
<a href="#l3.20"></a><span id="l3.20">   nsresult err = nsMsgSearchAdapter::ValidateTerms ();</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-  </span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+</span>
<a href="#l3.23"></a><span id="l3.23">   if (NS_SUCCEEDED(err))</span>
<a href="#l3.24"></a><span id="l3.24">   {</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-      // ### mwelch Figure out the charsets to use </span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+      // ### mwelch Figure out the charsets to use</span>
<a href="#l3.27"></a><span id="l3.27">       //            for the search terms and targets.</span>
<a href="#l3.28"></a><span id="l3.28">       nsAutoString srcCharset, dstCharset;</span>
<a href="#l3.29"></a><span id="l3.29">       GetSearchCharsets(srcCharset, dstCharset);</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31">       // do IMAP specific validation</span>
<a href="#l3.32"></a><span id="l3.32">       err = Encode (m_encoding, m_searchTerms, dstCharset.get());</span>
<a href="#l3.33"></a><span id="l3.33">       NS_ASSERTION(NS_SUCCEEDED(err), &quot;failed to encode imap search&quot;);</span>
<a href="#l3.34"></a><span id="l3.34">   }</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-  </span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+</span>
<a href="#l3.37"></a><span id="l3.37">   return err;</span>
<a href="#l3.38"></a><span id="l3.38"> }</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41"> NS_IMETHODIMP nsMsgSearchOnlineMail::GetEncoding (char **result)</span>
<a href="#l3.42"></a><span id="l3.42"> {</span>
<a href="#l3.43"></a><span id="l3.43">   *result = ToNewCString(m_encoding);</span>
<a href="#l3.44"></a><span id="l3.44">   return NS_OK;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineat">@@ -76,75 +76,75 @@ nsresult nsMsgSearchOnlineMail::Search (</span>
<a href="#l3.46"></a><span id="l3.46">     return err;</span>
<a href="#l3.47"></a><span id="l3.47"> }</span>
<a href="#l3.48"></a><span id="l3.48"> </span>
<a href="#l3.49"></a><span id="l3.49"> nsresult nsMsgSearchOnlineMail::Encode (nsCString&amp; pEncoding,</span>
<a href="#l3.50"></a><span id="l3.50">                                         nsIArray *searchTerms,</span>
<a href="#l3.51"></a><span id="l3.51">                                         const char16_t *destCharset)</span>
<a href="#l3.52"></a><span id="l3.52"> {</span>
<a href="#l3.53"></a><span id="l3.53">   nsCString imapTerms;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-  </span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+</span>
<a href="#l3.56"></a><span id="l3.56">   //check if searchTerms are ascii only</span>
<a href="#l3.57"></a><span id="l3.57">   bool asciiOnly = true;</span>
<a href="#l3.58"></a><span id="l3.58">   // ### what's this mean in the NWO?????</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-  </span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+</span>
<a href="#l3.61"></a><span id="l3.61">   if (true) // !(srcCharset &amp; CODESET_MASK == STATEFUL || srcCharset &amp; CODESET_MASK == WIDECHAR) )   //assume all single/multiple bytes charset has ascii as subset</span>
<a href="#l3.62"></a><span id="l3.62">   {</span>
<a href="#l3.63"></a><span id="l3.63">     uint32_t termCount;</span>
<a href="#l3.64"></a><span id="l3.64">     searchTerms-&gt;GetLength(&amp;termCount);</span>
<a href="#l3.65"></a><span id="l3.65">     uint32_t i = 0;</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-    </span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+</span>
<a href="#l3.68"></a><span id="l3.68">     for (i = 0; i &lt; termCount &amp;&amp; asciiOnly; i++)</span>
<a href="#l3.69"></a><span id="l3.69">     {</span>
<a href="#l3.70"></a><span id="l3.70">       nsCOMPtr&lt;nsIMsgSearchTerm&gt; pTerm = do_QueryElementAt(searchTerms, i);</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-      </span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+</span>
<a href="#l3.73"></a><span id="l3.73">       nsMsgSearchAttribValue attribute;</span>
<a href="#l3.74"></a><span id="l3.74">       pTerm-&gt;GetAttrib(&amp;attribute);</span>
<a href="#l3.75"></a><span id="l3.75">       if (IS_STRING_ATTRIBUTE(attribute))</span>
<a href="#l3.76"></a><span id="l3.76">       {</span>
<a href="#l3.77"></a><span id="l3.77">         nsString pchar;</span>
<a href="#l3.78"></a><span id="l3.78">         nsCOMPtr &lt;nsIMsgSearchValue&gt; searchValue;</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-        </span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+</span>
<a href="#l3.81"></a><span id="l3.81">         nsresult rv = pTerm-&gt;GetValue(getter_AddRefs(searchValue));</span>
<a href="#l3.82"></a><span id="l3.82">         if (NS_FAILED(rv) || !searchValue)</span>
<a href="#l3.83"></a><span id="l3.83">           continue;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-        </span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-        </span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+</span>
<a href="#l3.88"></a><span id="l3.88">         rv = searchValue-&gt;GetStr(pchar);</span>
<a href="#l3.89"></a><span id="l3.89">         if (NS_FAILED(rv) || pchar.IsEmpty())</span>
<a href="#l3.90"></a><span id="l3.90">           continue;</span>
<a href="#l3.91"></a><span id="l3.91">         asciiOnly = NS_IsAscii(pchar.get());</span>
<a href="#l3.92"></a><span id="l3.92">       }</span>
<a href="#l3.93"></a><span id="l3.93">     }</span>
<a href="#l3.94"></a><span id="l3.94">   }</span>
<a href="#l3.95"></a><span id="l3.95"> //  else</span>
<a href="#l3.96"></a><span id="l3.96"> //    asciiOnly = false; // TODO: enable this line when the condition is not a plain &quot;true&quot; in the if().</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-  </span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+</span>
<a href="#l3.99"></a><span id="l3.99">   nsAutoString usAsciiCharSet(NS_LITERAL_STRING(&quot;us-ascii&quot;));</span>
<a href="#l3.100"></a><span id="l3.100">   // Get the optional CHARSET parameter, in case we need it.</span>
<a href="#l3.101"></a><span id="l3.101">   char *csname = GetImapCharsetParam(asciiOnly ? usAsciiCharSet.get() : destCharset);</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-  </span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+</span>
<a href="#l3.104"></a><span id="l3.104">   // We do not need &quot;srcCharset&quot; since the search term in always unicode.</span>
<a href="#l3.105"></a><span id="l3.105">   // I just pass destCharset for both src and dest charset instead of removing srcCharst from the arguemnt.</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-  nsresult err = nsMsgSearchAdapter::EncodeImap (getter_Copies(imapTerms), searchTerms, </span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-    asciiOnly ?  usAsciiCharSet.get(): destCharset, </span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+  nsresult err = nsMsgSearchAdapter::EncodeImap (getter_Copies(imapTerms), searchTerms,</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+    asciiOnly ?  usAsciiCharSet.get(): destCharset,</span>
<a href="#l3.110"></a><span id="l3.110">     asciiOnly ?  usAsciiCharSet.get(): destCharset, false);</span>
<a href="#l3.111"></a><span id="l3.111">   if (NS_SUCCEEDED(err))</span>
<a href="#l3.112"></a><span id="l3.112">   {</span>
<a href="#l3.113"></a><span id="l3.113">     pEncoding.Append(&quot;SEARCH&quot;);</span>
<a href="#l3.114"></a><span id="l3.114">     if (csname)</span>
<a href="#l3.115"></a><span id="l3.115">       pEncoding.Append(csname);</span>
<a href="#l3.116"></a><span id="l3.116">     pEncoding.Append(imapTerms);</span>
<a href="#l3.117"></a><span id="l3.117">   }</span>
<a href="#l3.118"></a><span id="l3.118">   PR_FREEIF(csname);</span>
<a href="#l3.119"></a><span id="l3.119">   return err;</span>
<a href="#l3.120"></a><span id="l3.120"> }</span>
<a href="#l3.121"></a><span id="l3.121"> </span>
<a href="#l3.122"></a><span id="l3.122"> </span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-nsresult </span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+nsresult</span>
<a href="#l3.125"></a><span id="l3.125"> nsMsgSearchValidityManager::InitOfflineMailTable()</span>
<a href="#l3.126"></a><span id="l3.126"> {</span>
<a href="#l3.127"></a><span id="l3.127">   NS_ASSERTION(!m_offlineMailTable, &quot;offline mail table already initted&quot;);</span>
<a href="#l3.128"></a><span id="l3.128">   nsresult rv = NewTable (getter_AddRefs(m_offlineMailTable));</span>
<a href="#l3.129"></a><span id="l3.129">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.130"></a><span id="l3.130"> </span>
<a href="#l3.131"></a><span id="l3.131">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.132"></a><span id="l3.132">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineat">@@ -153,22 +153,22 @@ nsMsgSearchValidityManager::InitOfflineM</span>
<a href="#l3.134"></a><span id="l3.134">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.135"></a><span id="l3.135">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.136"></a><span id="l3.136">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.137"></a><span id="l3.137">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.138"></a><span id="l3.138">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.139"></a><span id="l3.139">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.140"></a><span id="l3.140">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.141"></a><span id="l3.141">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-  </span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+</span>
<a href="#l3.144"></a><span id="l3.144">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.145"></a><span id="l3.145">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.146"></a><span id="l3.146">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.147"></a><span id="l3.147">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-  </span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+</span>
<a href="#l3.150"></a><span id="l3.150">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.151"></a><span id="l3.151">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.152"></a><span id="l3.152">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.153"></a><span id="l3.153">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.154"></a><span id="l3.154">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.155"></a><span id="l3.155">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.156"></a><span id="l3.156">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.157"></a><span id="l3.157">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineat">@@ -239,84 +239,84 @@ nsMsgSearchValidityManager::InitOfflineM</span>
<a href="#l3.159"></a><span id="l3.159">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.160"></a><span id="l3.160">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.161"></a><span id="l3.161">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.162"></a><span id="l3.162">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.163"></a><span id="l3.163">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.164"></a><span id="l3.164">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.165"></a><span id="l3.165">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.166"></a><span id="l3.166">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineminus">-  </span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+</span>
<a href="#l3.169"></a><span id="l3.169">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.170"></a><span id="l3.170">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.171"></a><span id="l3.171">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.172"></a><span id="l3.172">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.173"></a><span id="l3.173">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.174"></a><span id="l3.174">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.175"></a><span id="l3.175">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.176"></a><span id="l3.176">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-  </span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+</span>
<a href="#l3.179"></a><span id="l3.179">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.180"></a><span id="l3.180">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.181"></a><span id="l3.181">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.182"></a><span id="l3.182">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.183"></a><span id="l3.183">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.184"></a><span id="l3.184">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.185"></a><span id="l3.185">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.186"></a><span id="l3.186">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-  </span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+</span>
<a href="#l3.189"></a><span id="l3.189">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.190"></a><span id="l3.190">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.191"></a><span id="l3.191">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsLowerThan, 1);</span>
<a href="#l3.192"></a><span id="l3.192">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsLowerThan, 1);</span>
<a href="#l3.193"></a><span id="l3.193">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.194"></a><span id="l3.194">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.195"></a><span id="l3.195">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.196"></a><span id="l3.196">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.197"></a><span id="l3.197"> </span>
<a href="#l3.198"></a><span id="l3.198">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.199"></a><span id="l3.199">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.200"></a><span id="l3.200">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.201"></a><span id="l3.201">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineminus">-  </span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+</span>
<a href="#l3.204"></a><span id="l3.204">   //      m_offlineMailTable-&gt;SetValidButNotShown (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.205"></a><span id="l3.205">   //      m_offlineMailTable-&gt;SetValidButNotShown (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLowerThan,  1);</span>
<a href="#l3.206"></a><span id="l3.206">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.207"></a><span id="l3.207">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.208"></a><span id="l3.208">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l3.209"></a><span id="l3.209">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.210"></a><span id="l3.210">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is,  1);</span>
<a href="#l3.211"></a><span id="l3.211">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-  </span>
<a href="#l3.213"></a><span id="l3.213" class="difflineplus">+</span>
<a href="#l3.214"></a><span id="l3.214">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.215"></a><span id="l3.215">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.216"></a><span id="l3.216">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.217"></a><span id="l3.217">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.218"></a><span id="l3.218">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l3.219"></a><span id="l3.219">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l3.220"></a><span id="l3.220">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l3.221"></a><span id="l3.221">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-  </span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+</span>
<a href="#l3.224"></a><span id="l3.224">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.225"></a><span id="l3.225">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.226"></a><span id="l3.226">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.227"></a><span id="l3.227">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.228"></a><span id="l3.228">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.229"></a><span id="l3.229">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.230"></a><span id="l3.230"> </span>
<a href="#l3.231"></a><span id="l3.231">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.232"></a><span id="l3.232">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.233"></a><span id="l3.233">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.234"></a><span id="l3.234">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineminus">-  </span>
<a href="#l3.236"></a><span id="l3.236" class="difflineplus">+</span>
<a href="#l3.237"></a><span id="l3.237">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::HasAttachmentStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.238"></a><span id="l3.238">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::HasAttachmentStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.239"></a><span id="l3.239">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::HasAttachmentStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.240"></a><span id="l3.240">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::HasAttachmentStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-  </span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+</span>
<a href="#l3.243"></a><span id="l3.243">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.244"></a><span id="l3.244">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.245"></a><span id="l3.245">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.246"></a><span id="l3.246">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.247"></a><span id="l3.247">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.248"></a><span id="l3.248">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.249"></a><span id="l3.249"> </span>
<a href="#l3.250"></a><span id="l3.250">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineat">@@ -343,74 +343,74 @@ nsMsgSearchValidityManager::InitOfflineM</span>
<a href="#l3.252"></a><span id="l3.252">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l3.253"></a><span id="l3.253">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l3.254"></a><span id="l3.254">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l3.255"></a><span id="l3.255">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l3.256"></a><span id="l3.256">   return rv;</span>
<a href="#l3.257"></a><span id="l3.257"> }</span>
<a href="#l3.258"></a><span id="l3.258"> </span>
<a href="#l3.259"></a><span id="l3.259"> </span>
<a href="#l3.260"></a><span id="l3.260" class="difflineminus">-nsresult </span>
<a href="#l3.261"></a><span id="l3.261" class="difflineplus">+nsresult</span>
<a href="#l3.262"></a><span id="l3.262"> nsMsgSearchValidityManager::InitOnlineMailTable()</span>
<a href="#l3.263"></a><span id="l3.263"> {</span>
<a href="#l3.264"></a><span id="l3.264">   NS_ASSERTION(!m_onlineMailTable, &quot;Online mail table already initted!&quot;);</span>
<a href="#l3.265"></a><span id="l3.265">   nsresult rv = NewTable (getter_AddRefs(m_onlineMailTable));</span>
<a href="#l3.266"></a><span id="l3.266">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.267"></a><span id="l3.267"> </span>
<a href="#l3.268"></a><span id="l3.268">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.269"></a><span id="l3.269">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.270"></a><span id="l3.270">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.271"></a><span id="l3.271">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-  </span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+</span>
<a href="#l3.274"></a><span id="l3.274">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.275"></a><span id="l3.275">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.276"></a><span id="l3.276">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.277"></a><span id="l3.277">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineminus">-  </span>
<a href="#l3.279"></a><span id="l3.279" class="difflineplus">+</span>
<a href="#l3.280"></a><span id="l3.280">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.281"></a><span id="l3.281">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.282"></a><span id="l3.282">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.283"></a><span id="l3.283">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineminus">-  </span>
<a href="#l3.285"></a><span id="l3.285" class="difflineplus">+</span>
<a href="#l3.286"></a><span id="l3.286">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.287"></a><span id="l3.287">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.288"></a><span id="l3.288">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.289"></a><span id="l3.289">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineminus">-  </span>
<a href="#l3.291"></a><span id="l3.291" class="difflineplus">+</span>
<a href="#l3.292"></a><span id="l3.292">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.293"></a><span id="l3.293">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.294"></a><span id="l3.294">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.295"></a><span id="l3.295">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineminus">-  </span>
<a href="#l3.297"></a><span id="l3.297" class="difflineplus">+</span>
<a href="#l3.298"></a><span id="l3.298">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.299"></a><span id="l3.299">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.300"></a><span id="l3.300">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.301"></a><span id="l3.301">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-  </span>
<a href="#l3.303"></a><span id="l3.303" class="difflineplus">+</span>
<a href="#l3.304"></a><span id="l3.304">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.305"></a><span id="l3.305">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.306"></a><span id="l3.306">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.307"></a><span id="l3.307">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.308"></a><span id="l3.308">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.309"></a><span id="l3.309">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.310"></a><span id="l3.310">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.311"></a><span id="l3.311">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-  </span>
<a href="#l3.313"></a><span id="l3.313" class="difflineplus">+</span>
<a href="#l3.314"></a><span id="l3.314">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.315"></a><span id="l3.315">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.316"></a><span id="l3.316">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.317"></a><span id="l3.317">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineminus">-  </span>
<a href="#l3.319"></a><span id="l3.319" class="difflineplus">+</span>
<a href="#l3.320"></a><span id="l3.320">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.321"></a><span id="l3.321">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.322"></a><span id="l3.322">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l3.323"></a><span id="l3.323">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.324"></a><span id="l3.324">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.325"></a><span id="l3.325">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineminus">-  </span>
<a href="#l3.327"></a><span id="l3.327" class="difflineplus">+</span>
<a href="#l3.328"></a><span id="l3.328">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.329"></a><span id="l3.329">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.330"></a><span id="l3.330">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.331"></a><span id="l3.331">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.332"></a><span id="l3.332"> </span>
<a href="#l3.333"></a><span id="l3.333">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.334"></a><span id="l3.334">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.335"></a><span id="l3.335">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineat">@@ -423,82 +423,82 @@ nsMsgSearchValidityManager::InitOnlineMa</span>
<a href="#l3.337"></a><span id="l3.337">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.338"></a><span id="l3.338">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.339"></a><span id="l3.339">   m_onlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.340"></a><span id="l3.340">   m_onlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.341"></a><span id="l3.341"> </span>
<a href="#l3.342"></a><span id="l3.342">   return rv;</span>
<a href="#l3.343"></a><span id="l3.343"> }</span>
<a href="#l3.344"></a><span id="l3.344"> </span>
<a href="#l3.345"></a><span id="l3.345" class="difflineminus">-nsresult </span>
<a href="#l3.346"></a><span id="l3.346" class="difflineplus">+nsresult</span>
<a href="#l3.347"></a><span id="l3.347"> nsMsgSearchValidityManager::InitOnlineMailFilterTable()</span>
<a href="#l3.348"></a><span id="l3.348"> {</span>
<a href="#l3.349"></a><span id="l3.349">   // Oh what a tangled web...</span>
<a href="#l3.350"></a><span id="l3.350">   //</span>
<a href="#l3.351"></a><span id="l3.351">   // IMAP filtering happens on the client, fundamentally using the same</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineminus">-  // capabilities as POP filtering. However, since we don't yet have the </span>
<a href="#l3.353"></a><span id="l3.353" class="difflineplus">+  // capabilities as POP filtering. However, since we don't yet have the</span>
<a href="#l3.354"></a><span id="l3.354">   // IMAP message body, we can't filter on body attributes. So this table</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-  // is supposed to be the same as offline mail, except that the body </span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-  // attribute is omitted  </span>
<a href="#l3.357"></a><span id="l3.357" class="difflineplus">+  // is supposed to be the same as offline mail, except that the body</span>
<a href="#l3.358"></a><span id="l3.358" class="difflineplus">+  // attribute is omitted</span>
<a href="#l3.359"></a><span id="l3.359">   NS_ASSERTION(!m_onlineMailFilterTable, &quot;online filter table already initted&quot;);</span>
<a href="#l3.360"></a><span id="l3.360">   nsresult rv = NewTable (getter_AddRefs(m_onlineMailFilterTable));</span>
<a href="#l3.361"></a><span id="l3.361">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.362"></a><span id="l3.362" class="difflineminus">-  </span>
<a href="#l3.363"></a><span id="l3.363" class="difflineplus">+</span>
<a href="#l3.364"></a><span id="l3.364">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.365"></a><span id="l3.365">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.366"></a><span id="l3.366">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.367"></a><span id="l3.367">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.368"></a><span id="l3.368">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.369"></a><span id="l3.369">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.370"></a><span id="l3.370">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.371"></a><span id="l3.371">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.372"></a><span id="l3.372">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.373"></a><span id="l3.373">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.374"></a><span id="l3.374">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.375"></a><span id="l3.375">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineminus">-  </span>
<a href="#l3.377"></a><span id="l3.377" class="difflineplus">+</span>
<a href="#l3.378"></a><span id="l3.378">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.379"></a><span id="l3.379">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.380"></a><span id="l3.380">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.381"></a><span id="l3.381">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.382"></a><span id="l3.382" class="difflineminus">-  </span>
<a href="#l3.383"></a><span id="l3.383" class="difflineplus">+</span>
<a href="#l3.384"></a><span id="l3.384">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.385"></a><span id="l3.385">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.386"></a><span id="l3.386">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.387"></a><span id="l3.387">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.388"></a><span id="l3.388">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.389"></a><span id="l3.389">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.390"></a><span id="l3.390">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.391"></a><span id="l3.391">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.392"></a><span id="l3.392">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.393"></a><span id="l3.393">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.394"></a><span id="l3.394">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.395"></a><span id="l3.395">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.396"></a><span id="l3.396">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.397"></a><span id="l3.397">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.398"></a><span id="l3.398">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.399"></a><span id="l3.399">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-  </span>
<a href="#l3.401"></a><span id="l3.401" class="difflineplus">+</span>
<a href="#l3.402"></a><span id="l3.402">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.403"></a><span id="l3.403">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.404"></a><span id="l3.404">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.405"></a><span id="l3.405">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.406"></a><span id="l3.406">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.407"></a><span id="l3.407">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.408"></a><span id="l3.408">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.409"></a><span id="l3.409">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.410"></a><span id="l3.410">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.411"></a><span id="l3.411">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.412"></a><span id="l3.412">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.413"></a><span id="l3.413">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.414"></a><span id="l3.414">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.415"></a><span id="l3.415">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.416"></a><span id="l3.416">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.417"></a><span id="l3.417">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.418"></a><span id="l3.418" class="difflineminus">-  </span>
<a href="#l3.419"></a><span id="l3.419" class="difflineplus">+</span>
<a href="#l3.420"></a><span id="l3.420">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.421"></a><span id="l3.421">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.422"></a><span id="l3.422">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.423"></a><span id="l3.423">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.424"></a><span id="l3.424">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.425"></a><span id="l3.425">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.426"></a><span id="l3.426">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.427"></a><span id="l3.427">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.428"></a><span id="l3.428" class="difflineat">@@ -535,47 +535,47 @@ nsMsgSearchValidityManager::InitOnlineMa</span>
<a href="#l3.429"></a><span id="l3.429">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.430"></a><span id="l3.430">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.431"></a><span id="l3.431">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.432"></a><span id="l3.432">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.433"></a><span id="l3.433">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.434"></a><span id="l3.434">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.435"></a><span id="l3.435">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.436"></a><span id="l3.436">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineminus">-  </span>
<a href="#l3.438"></a><span id="l3.438" class="difflineplus">+</span>
<a href="#l3.439"></a><span id="l3.439">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.440"></a><span id="l3.440">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.441"></a><span id="l3.441">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.442"></a><span id="l3.442">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.443"></a><span id="l3.443">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.444"></a><span id="l3.444">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.445"></a><span id="l3.445">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.446"></a><span id="l3.446">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineminus">-  </span>
<a href="#l3.448"></a><span id="l3.448" class="difflineplus">+</span>
<a href="#l3.449"></a><span id="l3.449">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.450"></a><span id="l3.450">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.451"></a><span id="l3.451">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsLowerThan, 1);</span>
<a href="#l3.452"></a><span id="l3.452">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsLowerThan, 1);</span>
<a href="#l3.453"></a><span id="l3.453">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.454"></a><span id="l3.454">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.455"></a><span id="l3.455">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.456"></a><span id="l3.456">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.457"></a><span id="l3.457"> </span>
<a href="#l3.458"></a><span id="l3.458">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.459"></a><span id="l3.459">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.460"></a><span id="l3.460">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.461"></a><span id="l3.461">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.462"></a><span id="l3.462" class="difflineminus">-  </span>
<a href="#l3.463"></a><span id="l3.463" class="difflineplus">+</span>
<a href="#l3.464"></a><span id="l3.464">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.465"></a><span id="l3.465">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.466"></a><span id="l3.466">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l3.467"></a><span id="l3.467">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.468"></a><span id="l3.468">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.469"></a><span id="l3.469">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.470"></a><span id="l3.470" class="difflineminus">-  </span>
<a href="#l3.471"></a><span id="l3.471" class="difflineplus">+</span>
<a href="#l3.472"></a><span id="l3.472">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.473"></a><span id="l3.473">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.474"></a><span id="l3.474">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.475"></a><span id="l3.475">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.476"></a><span id="l3.476"> </span>
<a href="#l3.477"></a><span id="l3.477">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.478"></a><span id="l3.478">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.479"></a><span id="l3.479">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.480"></a><span id="l3.480" class="difflineat">@@ -600,17 +600,17 @@ nsMsgSearchValidityManager::InitOnlineMa</span>
<a href="#l3.481"></a><span id="l3.481">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.482"></a><span id="l3.482">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.483"></a><span id="l3.483">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.484"></a><span id="l3.484">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.485"></a><span id="l3.485"> </span>
<a href="#l3.486"></a><span id="l3.486">   return rv;</span>
<a href="#l3.487"></a><span id="l3.487"> }</span>
<a href="#l3.488"></a><span id="l3.488"> </span>
<a href="#l3.489"></a><span id="l3.489" class="difflineminus">-nsresult </span>
<a href="#l3.490"></a><span id="l3.490" class="difflineplus">+nsresult</span>
<a href="#l3.491"></a><span id="l3.491"> nsMsgSearchValidityManager::InitOfflineMailFilterTable()</span>
<a href="#l3.492"></a><span id="l3.492"> {</span>
<a href="#l3.493"></a><span id="l3.493">   NS_ASSERTION(!m_offlineMailFilterTable, &quot;offline mail filter table already initted&quot;);</span>
<a href="#l3.494"></a><span id="l3.494">   nsresult rv = NewTable (getter_AddRefs(m_offlineMailFilterTable));</span>
<a href="#l3.495"></a><span id="l3.495">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.496"></a><span id="l3.496"> </span>
<a href="#l3.497"></a><span id="l3.497">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.498"></a><span id="l3.498">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.499"></a><span id="l3.499" class="difflineat">@@ -619,135 +619,135 @@ nsMsgSearchValidityManager::InitOfflineM</span>
<a href="#l3.500"></a><span id="l3.500">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.501"></a><span id="l3.501">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.502"></a><span id="l3.502">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.503"></a><span id="l3.503">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.504"></a><span id="l3.504">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.505"></a><span id="l3.505">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.506"></a><span id="l3.506">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.507"></a><span id="l3.507">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.508"></a><span id="l3.508" class="difflineminus">-  </span>
<a href="#l3.509"></a><span id="l3.509" class="difflineplus">+</span>
<a href="#l3.510"></a><span id="l3.510">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.511"></a><span id="l3.511">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.512"></a><span id="l3.512">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.513"></a><span id="l3.513">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.514"></a><span id="l3.514" class="difflineminus">-  </span>
<a href="#l3.515"></a><span id="l3.515" class="difflineplus">+</span>
<a href="#l3.516"></a><span id="l3.516">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.517"></a><span id="l3.517">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.518"></a><span id="l3.518">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.519"></a><span id="l3.519">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.520"></a><span id="l3.520">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.521"></a><span id="l3.521">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.522"></a><span id="l3.522">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.523"></a><span id="l3.523">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.524"></a><span id="l3.524">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.525"></a><span id="l3.525">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.526"></a><span id="l3.526">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.527"></a><span id="l3.527">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.528"></a><span id="l3.528">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.529"></a><span id="l3.529">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.530"></a><span id="l3.530">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::To, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.531"></a><span id="l3.531">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::To, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.532"></a><span id="l3.532" class="difflineminus">-  </span>
<a href="#l3.533"></a><span id="l3.533" class="difflineplus">+</span>
<a href="#l3.534"></a><span id="l3.534">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.535"></a><span id="l3.535">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.536"></a><span id="l3.536">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.537"></a><span id="l3.537">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.538"></a><span id="l3.538">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.539"></a><span id="l3.539">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.540"></a><span id="l3.540">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.541"></a><span id="l3.541">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.542"></a><span id="l3.542">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.543"></a><span id="l3.543">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.544"></a><span id="l3.544">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.545"></a><span id="l3.545">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.546"></a><span id="l3.546">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.547"></a><span id="l3.547">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.548"></a><span id="l3.548">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.549"></a><span id="l3.549">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::CC, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.550"></a><span id="l3.550" class="difflineminus">-  </span>
<a href="#l3.551"></a><span id="l3.551" class="difflineplus">+</span>
<a href="#l3.552"></a><span id="l3.552">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.553"></a><span id="l3.553">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.554"></a><span id="l3.554">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.555"></a><span id="l3.555">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.556"></a><span id="l3.556">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.557"></a><span id="l3.557">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.558"></a><span id="l3.558">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.559"></a><span id="l3.559">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.560"></a><span id="l3.560">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.561"></a><span id="l3.561">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.562"></a><span id="l3.562">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.563"></a><span id="l3.563">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.564"></a><span id="l3.564">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.565"></a><span id="l3.565">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.566"></a><span id="l3.566">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.567"></a><span id="l3.567">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::ToOrCC, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.568"></a><span id="l3.568" class="difflineminus">-  </span>
<a href="#l3.569"></a><span id="l3.569" class="difflineplus">+</span>
<a href="#l3.570"></a><span id="l3.570">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.571"></a><span id="l3.571">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.572"></a><span id="l3.572">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.573"></a><span id="l3.573">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.574"></a><span id="l3.574">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.575"></a><span id="l3.575">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.576"></a><span id="l3.576">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.577"></a><span id="l3.577">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.578"></a><span id="l3.578">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.579"></a><span id="l3.579">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.580"></a><span id="l3.580">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.581"></a><span id="l3.581">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.582"></a><span id="l3.582">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.583"></a><span id="l3.583">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l3.584"></a><span id="l3.584">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.585"></a><span id="l3.585">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AllAddresses, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineminus">-  </span>
<a href="#l3.587"></a><span id="l3.587" class="difflineplus">+</span>
<a href="#l3.588"></a><span id="l3.588">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.589"></a><span id="l3.589">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.590"></a><span id="l3.590">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.591"></a><span id="l3.591">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.592"></a><span id="l3.592">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.593"></a><span id="l3.593">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.594"></a><span id="l3.594">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.595"></a><span id="l3.595">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.596"></a><span id="l3.596">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.597"></a><span id="l3.597">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l3.598"></a><span id="l3.598">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.599"></a><span id="l3.599">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l3.600"></a><span id="l3.600" class="difflineminus">-  </span>
<a href="#l3.601"></a><span id="l3.601" class="difflineplus">+</span>
<a href="#l3.602"></a><span id="l3.602">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.603"></a><span id="l3.603">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l3.604"></a><span id="l3.604">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.605"></a><span id="l3.605">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l3.606"></a><span id="l3.606">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.607"></a><span id="l3.607">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.608"></a><span id="l3.608">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.609"></a><span id="l3.609">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.610"></a><span id="l3.610" class="difflineminus">-  </span>
<a href="#l3.611"></a><span id="l3.611" class="difflineplus">+</span>
<a href="#l3.612"></a><span id="l3.612">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.613"></a><span id="l3.613">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l3.614"></a><span id="l3.614">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.615"></a><span id="l3.615">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l3.616"></a><span id="l3.616">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.617"></a><span id="l3.617">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.618"></a><span id="l3.618">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.619"></a><span id="l3.619">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.620"></a><span id="l3.620" class="difflineminus">-  </span>
<a href="#l3.621"></a><span id="l3.621" class="difflineplus">+</span>
<a href="#l3.622"></a><span id="l3.622">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.623"></a><span id="l3.623">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsHigherThan, 1);</span>
<a href="#l3.624"></a><span id="l3.624">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsLowerThan, 1);</span>
<a href="#l3.625"></a><span id="l3.625">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::IsLowerThan, 1);</span>
<a href="#l3.626"></a><span id="l3.626">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.627"></a><span id="l3.627">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.628"></a><span id="l3.628">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.629"></a><span id="l3.629">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Priority, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.630"></a><span id="l3.630"> </span>
<a href="#l3.631"></a><span id="l3.631">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.632"></a><span id="l3.632">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.633"></a><span id="l3.633">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.634"></a><span id="l3.634">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l3.635"></a><span id="l3.635" class="difflineminus">-  </span>
<a href="#l3.636"></a><span id="l3.636" class="difflineplus">+</span>
<a href="#l3.637"></a><span id="l3.637">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.638"></a><span id="l3.638">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l3.639"></a><span id="l3.639">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l3.640"></a><span id="l3.640">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l3.641"></a><span id="l3.641">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is,  1);</span>
<a href="#l3.642"></a><span id="l3.642">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l3.643"></a><span id="l3.643"> </span>
<a href="#l3.644"></a><span id="l3.644">   // junk status and attachment status not available for offline mail (POP) filters</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchNews.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -328,17 +328,17 @@ void nsMsgSearchNews::CollateHits()</span>
<a href="#l4.4"></a><span id="l4.4">     // get promoted into the hits list, a candidate article number must appear</span>
<a href="#l4.5"></a><span id="l4.5">     // in the results of each XPAT command. So if we fire 3 XPAT commands (one</span>
<a href="#l4.6"></a><span id="l4.6">     // per search term), the article number must appear 3 times. If it appears</span>
<a href="#l4.7"></a><span id="l4.7">     // fewer than 3 times, it matched some search terms, but not all.</span>
<a href="#l4.8"></a><span id="l4.8">     m_searchTerms-&gt;GetLength(&amp;termCount);</span>
<a href="#l4.9"></a><span id="l4.9">   }</span>
<a href="#l4.10"></a><span id="l4.10">   uint32_t candidateCount = 0;</span>
<a href="#l4.11"></a><span id="l4.11">   uint32_t candidate = m_candidateHits[0];</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  for (uint32_t index = 0; index &lt; size; ++index)   </span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  for (uint32_t index = 0; index &lt; size; ++index)</span>
<a href="#l4.14"></a><span id="l4.14">   {</span>
<a href="#l4.15"></a><span id="l4.15">     uint32_t possibleCandidate = m_candidateHits[index];</span>
<a href="#l4.16"></a><span id="l4.16">     if (candidate == possibleCandidate)</span>
<a href="#l4.17"></a><span id="l4.17">     {</span>
<a href="#l4.18"></a><span id="l4.18">       ++candidateCount;</span>
<a href="#l4.19"></a><span id="l4.19">     }</span>
<a href="#l4.20"></a><span id="l4.20">     else</span>
<a href="#l4.21"></a><span id="l4.21">     {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -416,17 +416,17 @@ nsresult nsMsgSearchValidityManager::Ini</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24"> #if 0</span>
<a href="#l4.25"></a><span id="l4.25">     // Size should be handled after the fact...</span>
<a href="#l4.26"></a><span id="l4.26">     m_newsTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l4.27"></a><span id="l4.27">     m_newsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l4.28"></a><span id="l4.28">     m_newsTable-&gt;SetAvailable (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l4.29"></a><span id="l4.29">     m_newsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Size, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l4.30"></a><span id="l4.30"> #endif</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    </span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+</span>
<a href="#l4.33"></a><span id="l4.33">     m_newsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l4.34"></a><span id="l4.34">     m_newsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l4.35"></a><span id="l4.35">     m_newsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.36"></a><span id="l4.36">     m_newsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.37"></a><span id="l4.37">     m_newsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l4.38"></a><span id="l4.38">     m_newsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l4.39"></a><span id="l4.39">     m_newsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l4.40"></a><span id="l4.40">     m_newsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -507,17 +507,17 @@ nsresult nsMsgSearchSession::SearchWOUrl</span>
<a href="#l5.4"></a><span id="l5.4"> NS_IMETHODIMP</span>
<a href="#l5.5"></a><span id="l5.5"> nsMsgSearchSession::GetRunningAdapter(nsIMsgSearchAdapter **aSearchAdapter)</span>
<a href="#l5.6"></a><span id="l5.6"> {</span>
<a href="#l5.7"></a><span id="l5.7">   NS_ENSURE_ARG_POINTER(aSearchAdapter);</span>
<a href="#l5.8"></a><span id="l5.8">   *aSearchAdapter = nullptr;</span>
<a href="#l5.9"></a><span id="l5.9">   nsMsgSearchScopeTerm *scope = GetRunningScope();</span>
<a href="#l5.10"></a><span id="l5.10">   if (scope)</span>
<a href="#l5.11"></a><span id="l5.11">   {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    NS_IF_ADDREF(*aSearchAdapter = scope-&gt;m_adapter);    </span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    NS_IF_ADDREF(*aSearchAdapter = scope-&gt;m_adapter);</span>
<a href="#l5.14"></a><span id="l5.14">   }</span>
<a href="#l5.15"></a><span id="l5.15">   return NS_OK;</span>
<a href="#l5.16"></a><span id="l5.16"> }</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> NS_IMETHODIMP nsMsgSearchSession::AddSearchHit(nsIMsgDBHdr *aHeader,</span>
<a href="#l5.19"></a><span id="l5.19">                                                nsIMsgFolder *aFolder)</span>
<a href="#l5.20"></a><span id="l5.20"> {</span>
<a href="#l5.21"></a><span id="l5.21">   nsCOMPtr&lt;nsIMsgSearchNotify&gt; listener;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -779,17 +779,17 @@ nsresult nsMsgSearchTerm::MatchArbitrary</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   nsCString headerFullValue; // contains matched header value accumulated over multiple lines.</span>
<a href="#l6.6"></a><span id="l6.6">   nsAutoCString buf;</span>
<a href="#l6.7"></a><span id="l6.7">   nsAutoCString curMsgHeader;</span>
<a href="#l6.8"></a><span id="l6.8">   bool searchingHeaders = true;</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">   // We will allow accumulation of received headers;</span>
<a href="#l6.11"></a><span id="l6.11">   bool isReceivedHeader = m_arbitraryHeader.EqualsLiteral(&quot;received&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  </span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+</span>
<a href="#l6.14"></a><span id="l6.14">   while (searchingHeaders)</span>
<a href="#l6.15"></a><span id="l6.15">   {</span>
<a href="#l6.16"></a><span id="l6.16">     if (bodyHandler-&gt;GetNextLine(buf) &lt; 0 || EMPTY_MESSAGE_LINE(buf))</span>
<a href="#l6.17"></a><span id="l6.17">       searchingHeaders = false;</span>
<a href="#l6.18"></a><span id="l6.18">     bool isContinuationHeader = searchingHeaders ? NS_IsAsciiWhitespace(buf.CharAt(0))</span>
<a href="#l6.19"></a><span id="l6.19">                                                    : false;</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">     // We try to match the header from the last time through the loop, which should now</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -1472,17 +1472,17 @@ nsresult nsMsgSearchTerm::MatchJunkPerce</span>
<a href="#l6.23"></a><span id="l6.23">     break;</span>
<a href="#l6.24"></a><span id="l6.24">   default:</span>
<a href="#l6.25"></a><span id="l6.25">     rv = NS_ERROR_FAILURE;</span>
<a href="#l6.26"></a><span id="l6.26">     NS_ERROR(&quot;invalid compare op for junk percent&quot;);</span>
<a href="#l6.27"></a><span id="l6.27">   }</span>
<a href="#l6.28"></a><span id="l6.28">   *pResult = result;</span>
<a href="#l6.29"></a><span id="l6.29">   return rv;</span>
<a href="#l6.30"></a><span id="l6.30"> }</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  </span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34"> nsresult nsMsgSearchTerm::MatchLabel(nsMsgLabelValue aLabelValue, bool *pResult)</span>
<a href="#l6.35"></a><span id="l6.35"> {</span>
<a href="#l6.36"></a><span id="l6.36">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38">   nsresult rv = NS_OK;</span>
<a href="#l6.39"></a><span id="l6.39">   bool result = false;</span>
<a href="#l6.40"></a><span id="l6.40">   switch (m_operator)</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -1499,17 +1499,17 @@ nsresult nsMsgSearchTerm::MatchLabel(nsM</span>
<a href="#l6.42"></a><span id="l6.42">     rv = NS_ERROR_FAILURE;</span>
<a href="#l6.43"></a><span id="l6.43">     NS_ERROR(&quot;invalid compare op for label value&quot;);</span>
<a href="#l6.44"></a><span id="l6.44">   }</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46">   *pResult = result;</span>
<a href="#l6.47"></a><span id="l6.47">   return rv;</span>
<a href="#l6.48"></a><span id="l6.48"> }</span>
<a href="#l6.49"></a><span id="l6.49"> </span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-// MatchStatus () is not only used for nsMsgMessageFlags but also for </span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+// MatchStatus () is not only used for nsMsgMessageFlags but also for</span>
<a href="#l6.52"></a><span id="l6.52"> // nsMsgFolderFlags (both being 'unsigned long')</span>
<a href="#l6.53"></a><span id="l6.53"> nsresult nsMsgSearchTerm::MatchStatus(uint32_t statusToMatch, bool *pResult)</span>
<a href="#l6.54"></a><span id="l6.54"> {</span>
<a href="#l6.55"></a><span id="l6.55">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l6.56"></a><span id="l6.56"> </span>
<a href="#l6.57"></a><span id="l6.57">   nsresult rv = NS_OK;</span>
<a href="#l6.58"></a><span id="l6.58">   bool matches = (statusToMatch &amp; m_value.u.msgStatus);</span>
<a href="#l6.59"></a><span id="l6.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchValue.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchValue.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -80,37 +80,37 @@ NS_IMETHODIMP</span>
<a href="#l7.4"></a><span id="l7.4"> nsMsgSearchValueImpl::ToString(nsAString &amp;aResult)</span>
<a href="#l7.5"></a><span id="l7.5"> {</span>
<a href="#l7.6"></a><span id="l7.6">     aResult.AssignLiteral(&quot;[nsIMsgSearchValue: &quot;);</span>
<a href="#l7.7"></a><span id="l7.7">     if (IS_STRING_ATTRIBUTE(mValue.attribute)) {</span>
<a href="#l7.8"></a><span id="l7.8">         aResult.Append(mValue.utf16String);</span>
<a href="#l7.9"></a><span id="l7.9">         return NS_OK;</span>
<a href="#l7.10"></a><span id="l7.10">     }</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14">     switch (mValue.attribute) {</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">     case nsMsgSearchAttrib::Priority:</span>
<a href="#l7.17"></a><span id="l7.17">     case nsMsgSearchAttrib::Date:</span>
<a href="#l7.18"></a><span id="l7.18">     case nsMsgSearchAttrib::MsgStatus:</span>
<a href="#l7.19"></a><span id="l7.19">     case nsMsgSearchAttrib::MessageKey:</span>
<a href="#l7.20"></a><span id="l7.20">     case nsMsgSearchAttrib::Size:</span>
<a href="#l7.21"></a><span id="l7.21">     case nsMsgSearchAttrib::AgeInDays:</span>
<a href="#l7.22"></a><span id="l7.22">     case nsMsgSearchAttrib::FolderInfo:</span>
<a href="#l7.23"></a><span id="l7.23">     case nsMsgSearchAttrib::Label:</span>
<a href="#l7.24"></a><span id="l7.24">     case nsMsgSearchAttrib::JunkStatus:</span>
<a href="#l7.25"></a><span id="l7.25">     case nsMsgSearchAttrib::JunkPercent:</span>
<a href="#l7.26"></a><span id="l7.26">     {</span>
<a href="#l7.27"></a><span id="l7.27">       nsAutoString tempInt;</span>
<a href="#l7.28"></a><span id="l7.28">       tempInt.AppendInt(mValue.attribute);</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-      </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+</span>
<a href="#l7.31"></a><span id="l7.31">         aResult.AppendLiteral(&quot;type=&quot;);</span>
<a href="#l7.32"></a><span id="l7.32">         aResult.Append(tempInt);</span>
<a href="#l7.33"></a><span id="l7.33">     }</span>
<a href="#l7.34"></a><span id="l7.34">         break;</span>
<a href="#l7.35"></a><span id="l7.35">     default:</span>
<a href="#l7.36"></a><span id="l7.36">         NS_ERROR(&quot;Unknown search value type&quot;);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-    }        </span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+    }</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">     aResult.AppendLiteral(&quot;]&quot;);</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">     return NS_OK;</span>
<a href="#l7.43"></a><span id="l7.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchValue.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchValue.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -10,17 +10,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsMsgSearchCore.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> class nsMsgSearchValueImpl : public nsIMsgSearchValue {</span>
<a href="#l8.7"></a><span id="l8.7">   public:</span>
<a href="#l8.8"></a><span id="l8.8">     nsMsgSearchValueImpl(nsMsgSearchValue *aInitialValue);</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">     NS_DECL_ISUPPORTS</span>
<a href="#l8.11"></a><span id="l8.11">     NS_DECL_NSIMSGSEARCHVALUE</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        </span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+</span>
<a href="#l8.14"></a><span id="l8.14">   private:</span>
<a href="#l8.15"></a><span id="l8.15">     virtual ~nsMsgSearchValueImpl();</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-                                  </span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+</span>
<a href="#l8.18"></a><span id="l8.18">     nsMsgSearchValue mValue;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-        </span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+</span>
<a href="#l8.21"></a><span id="l8.21"> };</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23"> #endif</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

