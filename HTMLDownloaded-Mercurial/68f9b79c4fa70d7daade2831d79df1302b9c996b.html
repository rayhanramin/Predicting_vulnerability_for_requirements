<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17933:68f9b79c4fa70d7daade2831d79df1302b9c996b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 68f9b79c4fa70d7daade2831d79df1302b9c996b" />
<meta property="og:url" content="/comm-central/rev/68f9b79c4fa70d7daade2831d79df1302b9c996b" />
<meta property="og:description" content="Bug 777770 - Replace nsVoidArray with nsTArray, part 2. r=rkent a=me CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 68f9b79c4fa70d7daade2831d79df1302b9c996b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/68f9b79c4fa70d7daade2831d79df1302b9c996b">shortlog</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/68f9b79c4fa70d7daade2831d79df1302b9c996b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b">files</a> |
changeset |
<a href="/comm-central/raw-rev/68f9b79c4fa70d7daade2831d79df1302b9c996b">raw</a>  | <a href="/comm-central/archive/68f9b79c4fa70d7daade2831d79df1302b9c996b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777770">Bug 777770</a> - Replace nsVoidArray with nsTArray, part 2. r=rkent a=me CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#116;&#101;&#102;&#97;&#110;&#32;&#83;&#105;&#116;&#116;&#101;&#114;&#32;&#60;&#115;&#115;&#105;&#116;&#116;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 13 May 2015 21:07:16 +0200</td></tr>

<tr>
 <td>changeset 17933</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/68f9b79c4fa70d7daade2831d79df1302b9c996b">68f9b79c4fa70d7daade2831d79df1302b9c996b</a></td>
</tr>



<tr>
<td>parent 17932</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d294256abf7b7301ee224dbf1d30cdedaad0f536">d294256abf7b7301ee224dbf1d30cdedaad0f536</a>
</td>
</tr>

<tr>
<td>child 17934</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1bf87d31938fd6e6e64b5a78aaaf17c6c0f25a07">1bf87d31938fd6e6e64b5a78aaaf17c6c0f25a07</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=68f9b79c4fa70d7daade2831d79df1302b9c996b">11026</a></td></tr>
<tr><td>push user</td><td>aleth@instantbird.org</td></tr>
<tr><td>push date</td><td class="date age">Wed, 13 May 2015 21:36:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@68f9b79c4fa7 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68f9b79c4fa70d7daade2831d79df1302b9c996b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68f9b79c4fa70d7daade2831d79df1302b9c996b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68f9b79c4fa70d7daade2831d79df1302b9c996b&newProject=comm-central&newRevision=68f9b79c4fa70d7daade2831d79df1302b9c996b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68f9b79c4fa70d7daade2831d79df1302b9c996b&newProject=comm-central&newRevision=68f9b79c4fa70d7daade2831d79df1302b9c996b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68f9b79c4fa70d7daade2831d79df1302b9c996b&newProject=comm-central&newRevision=68f9b79c4fa70d7daade2831d79df1302b9c996b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28rkent%29&revcount=50">rkent</a>, <a href="/comm-central/log?rev=reviewer%28me%29&revcount=50">me</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777770">777770</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=777770">Bug 777770</a> - Replace nsVoidArray with nsTArray, part 2. r=rkent a=me CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsAbView.cpp">mailnews/addrbook/src/nsAbView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsAbView.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsAbView.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsAbView.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsAbView.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsAbView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.cpp">mailnews/addrbook/src/nsDirPrefs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.h">mailnews/addrbook/src/nsDirPrefs.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.h">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.h">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.h">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.h">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/addrbook/src/nsDirPrefs.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPBodyShell.cpp">mailnews/imap/src/nsIMAPBodyShell.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPBodyShell.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPBodyShell.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPBodyShell.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPBodyShell.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPBodyShell.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPNamespace.cpp">mailnews/imap/src/nsIMAPNamespace.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPNamespace.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPNamespace.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPNamespace.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPNamespace.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsIMAPNamespace.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraAddress.cpp">mailnews/import/eudora/src/nsEudoraAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraAddress.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraAddress.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraAddress.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraAddress.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraCompose.cpp">mailnews/import/eudora/src/nsEudoraCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraCompose.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraCompose.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraCompose.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraCompose.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">mailnews/import/eudora/src/nsEudoraMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.cpp">mailnews/import/outlook/src/MapiApi.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.h">mailnews/import/outlook/src/MapiApi.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.h">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.h">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.h">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.h">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/outlook/src/MapiApi.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/src/nsImportFieldMap.cpp">mailnews/import/src/nsImportFieldMap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/src/nsImportFieldMap.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/src/nsImportFieldMap.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/src/nsImportFieldMap.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/src/nsImportFieldMap.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/import/src/nsImportFieldMap.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/public/nsIPop3Protocol.idl">mailnews/local/public/nsIPop3Protocol.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/public/nsIPop3Protocol.idl">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/public/nsIPop3Protocol.idl">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/public/nsIPop3Protocol.idl">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/public/nsIPop3Protocol.idl">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/public/nsIPop3Protocol.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">file</a> |
<a href="/comm-central/annotate/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">comparison</a> |
<a href="/comm-central/log/68f9b79c4fa70d7daade2831d79df1302b9c996b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -93,17 +93,17 @@ NS_IMETHODIMP nsAbView::ClearView()</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   return NS_OK;</span>
<a href="#l1.6"></a><span id="l1.6"> }</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> nsresult nsAbView::RemoveCardAt(int32_t row)</span>
<a href="#l1.9"></a><span id="l1.9"> {</span>
<a href="#l1.10"></a><span id="l1.10">   nsresult rv;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  AbCard *abcard = (AbCard*) (mCards.ElementAt(row));</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  AbCard *abcard = mCards.ElementAt(row);</span>
<a href="#l1.14"></a><span id="l1.14">   NS_IF_RELEASE(abcard-&gt;card);</span>
<a href="#l1.15"></a><span id="l1.15">   mCards.RemoveElementAt(row);</span>
<a href="#l1.16"></a><span id="l1.16">   PR_FREEIF(abcard-&gt;primaryCollationKey);</span>
<a href="#l1.17"></a><span id="l1.17">   PR_FREEIF(abcard-&gt;secondaryCollationKey);</span>
<a href="#l1.18"></a><span id="l1.18">   PR_FREEIF(abcard);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">   </span>
<a href="#l1.21"></a><span id="l1.21">   // This needs to happen after we remove the card, as RowCountChanged() will call GetRowCount()</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -349,17 +349,17 @@ NS_IMETHODIMP nsAbView::GetRowProperties</span>
<a href="#l1.23"></a><span id="l1.23"> {</span>
<a href="#l1.24"></a><span id="l1.24">     return NS_OK;</span>
<a href="#l1.25"></a><span id="l1.25"> }</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> NS_IMETHODIMP nsAbView::GetCellProperties(int32_t row, nsITreeColumn* col, nsAString&amp; properties)</span>
<a href="#l1.28"></a><span id="l1.28"> {</span>
<a href="#l1.29"></a><span id="l1.29">   NS_ENSURE_TRUE(row &gt;= 0, NS_ERROR_UNEXPECTED);</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  if (mCards.Length() &lt;= row)</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+  if (mCards.Length() &lt;= (size_t)row)</span>
<a href="#l1.33"></a><span id="l1.33">     return NS_OK;</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35">   const char16_t* colID;</span>
<a href="#l1.36"></a><span id="l1.36">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l1.37"></a><span id="l1.37">   // &quot;G&quot; == &quot;GeneratedName&quot;</span>
<a href="#l1.38"></a><span id="l1.38">   if (colID[0] != char16_t('G'))</span>
<a href="#l1.39"></a><span id="l1.39">     return NS_OK;</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -520,17 +520,17 @@ nsresult nsAbView::RefreshTree()</span>
<a href="#l1.42"></a><span id="l1.42">     SelectionChanged();</span>
<a href="#l1.43"></a><span id="l1.43">   }</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45">   return rv;</span>
<a href="#l1.46"></a><span id="l1.46"> }</span>
<a href="#l1.47"></a><span id="l1.47"> </span>
<a href="#l1.48"></a><span id="l1.48"> NS_IMETHODIMP nsAbView::GetCellText(int32_t row, nsITreeColumn* col, nsAString&amp; _retval)</span>
<a href="#l1.49"></a><span id="l1.49"> {</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-  NS_ENSURE_TRUE(row &gt;= 0 &amp;&amp; row &lt; mCards.Length(), NS_ERROR_UNEXPECTED);</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+  NS_ENSURE_TRUE(row &gt;= 0 &amp;&amp; (size_t)row &lt; mCards.Length(), NS_ERROR_UNEXPECTED);</span>
<a href="#l1.52"></a><span id="l1.52"> </span>
<a href="#l1.53"></a><span id="l1.53">   nsIAbCard *card = mCards.ElementAt(row)-&gt;card;</span>
<a href="#l1.54"></a><span id="l1.54">   const char16_t* colID;</span>
<a href="#l1.55"></a><span id="l1.55">   col-&gt;GetIdConst(&amp;colID);</span>
<a href="#l1.56"></a><span id="l1.56">   return GetCardValue(card, colID, _retval);</span>
<a href="#l1.57"></a><span id="l1.57"> }</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59"> NS_IMETHODIMP nsAbView::SetTree(nsITreeBoxObject *tree)</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineat">@@ -607,22 +607,21 @@ NS_IMETHODIMP nsAbView::PerformActionOnR</span>
<a href="#l1.61"></a><span id="l1.61"> NS_IMETHODIMP nsAbView::PerformActionOnCell(const char16_t *action, int32_t row, nsITreeColumn* col)</span>
<a href="#l1.62"></a><span id="l1.62"> {</span>
<a href="#l1.63"></a><span id="l1.63">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l1.64"></a><span id="l1.64"> }</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66"> NS_IMETHODIMP nsAbView::GetCardFromRow(int32_t row, nsIAbCard **aCard)</span>
<a href="#l1.67"></a><span id="l1.67"> {</span>
<a href="#l1.68"></a><span id="l1.68">   *aCard = nullptr;  </span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-  if (mCards.Length() &lt;= row) {</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+  NS_ENSURE_TRUE(row &gt;= 0, NS_ERROR_UNEXPECTED);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+  if (mCards.Length() &lt;= (size_t)row) {</span>
<a href="#l1.72"></a><span id="l1.72">     return NS_OK;</span>
<a href="#l1.73"></a><span id="l1.73">   }</span>
<a href="#l1.74"></a><span id="l1.74"> </span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-  NS_ENSURE_TRUE(row &gt;= 0, NS_ERROR_UNEXPECTED);</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-</span>
<a href="#l1.77"></a><span id="l1.77">   AbCard *a = mCards.ElementAt(row);</span>
<a href="#l1.78"></a><span id="l1.78">   if (!a)</span>
<a href="#l1.79"></a><span id="l1.79">       return NS_OK;</span>
<a href="#l1.80"></a><span id="l1.80"> </span>
<a href="#l1.81"></a><span id="l1.81">   NS_IF_ADDREF(*aCard = a-&gt;card);</span>
<a href="#l1.82"></a><span id="l1.82">   return NS_OK;</span>
<a href="#l1.83"></a><span id="l1.83"> }</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85" class="difflineat">@@ -632,23 +631,18 @@ NS_IMETHODIMP nsAbView::GetCardFromRow(i</span>
<a href="#l1.86"></a><span id="l1.86"> typedef struct SortClosure</span>
<a href="#l1.87"></a><span id="l1.87"> {</span>
<a href="#l1.88"></a><span id="l1.88">   const char16_t *colID;</span>
<a href="#l1.89"></a><span id="l1.89">   int32_t factor;</span>
<a href="#l1.90"></a><span id="l1.90">   nsAbView *abView;</span>
<a href="#l1.91"></a><span id="l1.91"> } SortClosure;</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93"> static int</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-inplaceSortCallback(const void *data1, const void *data2, void *privateData)</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+inplaceSortCallback(const AbCard *card1, const AbCard *card2, SortClosure *closure)</span>
<a href="#l1.96"></a><span id="l1.96"> {</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-  AbCard *card1 = (AbCard *)data1;</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-  AbCard *card2 = (AbCard *)data2;</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-  </span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-  SortClosure *closure = (SortClosure *) privateData;</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-  </span>
<a href="#l1.102"></a><span id="l1.102">   int32_t sortValue;</span>
<a href="#l1.103"></a><span id="l1.103">   </span>
<a href="#l1.104"></a><span id="l1.104">   // If we are sorting the &quot;PrimaryEmail&quot;, swap the collation keys, as the secondary is always the</span>
<a href="#l1.105"></a><span id="l1.105">   // PrimaryEmail. Use the last primary key as the secondary key.</span>
<a href="#l1.106"></a><span id="l1.106">   //</span>
<a href="#l1.107"></a><span id="l1.107">   // &quot;Pr&quot; to distinguish &quot;PrimaryEmail&quot; from &quot;PagerNumber&quot;</span>
<a href="#l1.108"></a><span id="l1.108">   if (closure-&gt;colID[0] == char16_t('P') &amp;&amp; closure-&gt;colID[1] == char16_t('r')) {</span>
<a href="#l1.109"></a><span id="l1.109">     sortValue = closure-&gt;abView-&gt;CompareCollationKeys(card1-&gt;secondaryCollationKey,card1-&gt;secondaryCollationKeyLen,card2-&gt;secondaryCollationKey,card2-&gt;secondaryCollationKeyLen);</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineat">@@ -674,29 +668,30 @@ static void SetSortClosure(const char16_</span>
<a href="#l1.111"></a><span id="l1.111">     closure-&gt;factor = DESCENDING_SORT_FACTOR;</span>
<a href="#l1.112"></a><span id="l1.112">   else </span>
<a href="#l1.113"></a><span id="l1.113">     closure-&gt;factor = ASCENDING_SORT_FACTOR;</span>
<a href="#l1.114"></a><span id="l1.114"> </span>
<a href="#l1.115"></a><span id="l1.115">   closure-&gt;abView = abView;</span>
<a href="#l1.116"></a><span id="l1.116">   return;</span>
<a href="#l1.117"></a><span id="l1.117"> }</span>
<a href="#l1.118"></a><span id="l1.118"> </span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-class CardComparator {</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineminus">-  private:</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineminus">-    SortClosure *m_closure;</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+class CardComparator</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+{</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+public:</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+  void SetClosure(SortClosure *closure) { m_closure = closure; };</span>
<a href="#l1.126"></a><span id="l1.126"> </span>
<a href="#l1.127"></a><span id="l1.127" class="difflineminus">-  public:</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineminus">-    void SetClosure(SortClosure *closure) { m_closure = closure; };</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineminus">-    /** @return True if the elements are equals; false otherise. */</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-    bool Equals(const AbCard* a, const AbCard* b) const {</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-      return inplaceSortCallback(a, b, m_closure) == 0;</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-    }</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-    bool LessThan(const AbCard* a, const AbCard* b) const{</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-      return inplaceSortCallback(a, b, m_closure) &lt; 0;</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-    }</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+  bool Equals(const AbCard *a, const AbCard *b) const {</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+    return inplaceSortCallback(a, b, m_closure) == 0;</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+  }</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+  bool LessThan(const AbCard *a, const AbCard *b) const{</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+    return inplaceSortCallback(a, b, m_closure) &lt; 0;</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  }</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+private:</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+  SortClosure *m_closure;</span>
<a href="#l1.145"></a><span id="l1.145"> };</span>
<a href="#l1.146"></a><span id="l1.146"> </span>
<a href="#l1.147"></a><span id="l1.147"> NS_IMETHODIMP nsAbView::SortBy(const char16_t *colID, const char16_t *sortDir, bool aResort = false)</span>
<a href="#l1.148"></a><span id="l1.148"> {</span>
<a href="#l1.149"></a><span id="l1.149">   nsresult rv;</span>
<a href="#l1.150"></a><span id="l1.150"> </span>
<a href="#l1.151"></a><span id="l1.151">   int32_t count = mCards.Length();</span>
<a href="#l1.152"></a><span id="l1.152"> </span>
<a href="#l1.153"></a><span id="l1.153" class="difflineat">@@ -947,26 +942,23 @@ nsresult nsAbView::AddCard(AbCard *abcar</span>
<a href="#l1.154"></a><span id="l1.154">   return rv;</span>
<a href="#l1.155"></a><span id="l1.155"> }</span>
<a href="#l1.156"></a><span id="l1.156"> </span>
<a href="#l1.157"></a><span id="l1.157"> int32_t nsAbView::FindIndexForInsert(AbCard *abcard)</span>
<a href="#l1.158"></a><span id="l1.158"> {</span>
<a href="#l1.159"></a><span id="l1.159">   int32_t count = mCards.Length();</span>
<a href="#l1.160"></a><span id="l1.160">   int32_t i;</span>
<a href="#l1.161"></a><span id="l1.161"> </span>
<a href="#l1.162"></a><span id="l1.162" class="difflineminus">-  void *item = (void *)abcard;</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-  </span>
<a href="#l1.164"></a><span id="l1.164">   SortClosure closure;</span>
<a href="#l1.165"></a><span id="l1.165">   SetSortClosure(mSortColumn.get(), mSortDirection.get(), this, &amp;closure);</span>
<a href="#l1.166"></a><span id="l1.166">   </span>
<a href="#l1.167"></a><span id="l1.167">   // XXX todo</span>
<a href="#l1.168"></a><span id="l1.168">   // Make this a binary search</span>
<a href="#l1.169"></a><span id="l1.169">   for (i=0; i &lt; count; i++) {</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineminus">-    void *current = (void *)mCards.ElementAt(i);</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineminus">-    int32_t value = inplaceSortCallback(item, current, (void *)(&amp;closure));</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+    int32_t value = inplaceSortCallback(abcard, mCards.ElementAt(i), &amp;closure);</span>
<a href="#l1.173"></a><span id="l1.173">     // XXX Fix me, this is not right for both ascending and descending</span>
<a href="#l1.174"></a><span id="l1.174">     if (value &lt;= 0) </span>
<a href="#l1.175"></a><span id="l1.175">       break;</span>
<a href="#l1.176"></a><span id="l1.176">   }</span>
<a href="#l1.177"></a><span id="l1.177">   return i;</span>
<a href="#l1.178"></a><span id="l1.178"> }</span>
<a href="#l1.179"></a><span id="l1.179"> </span>
<a href="#l1.180"></a><span id="l1.180"> NS_IMETHODIMP nsAbView::OnItemRemoved(nsISupports *parentDir, nsISupports *item)</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineat">@@ -1041,17 +1033,17 @@ int32_t nsAbView::FindIndexForCard(nsIAb</span>
<a href="#l1.182"></a><span id="l1.182"> {</span>
<a href="#l1.183"></a><span id="l1.183">   int32_t count = mCards.Length();</span>
<a href="#l1.184"></a><span id="l1.184">   int32_t i;</span>
<a href="#l1.185"></a><span id="l1.185">  </span>
<a href="#l1.186"></a><span id="l1.186">   // You can't implement the binary search here, as all you have is the nsIAbCard</span>
<a href="#l1.187"></a><span id="l1.187">   // you might be here because one of the card properties has changed, and that property</span>
<a href="#l1.188"></a><span id="l1.188">   // could be the collation key.</span>
<a href="#l1.189"></a><span id="l1.189">   for (i=0; i &lt; count; i++) {</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineminus">-    AbCard *abcard = (AbCard*) (mCards.ElementAt(i));</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+    AbCard *abcard = mCards.ElementAt(i);</span>
<a href="#l1.192"></a><span id="l1.192">     bool equals;</span>
<a href="#l1.193"></a><span id="l1.193">     nsresult rv = card-&gt;Equals(abcard-&gt;card, &amp;equals);</span>
<a href="#l1.194"></a><span id="l1.194">     if (NS_SUCCEEDED(rv) &amp;&amp; equals) {</span>
<a href="#l1.195"></a><span id="l1.195">       return i;</span>
<a href="#l1.196"></a><span id="l1.196">     }</span>
<a href="#l1.197"></a><span id="l1.197">   }</span>
<a href="#l1.198"></a><span id="l1.198">   return CARD_NOT_FOUND;</span>
<a href="#l1.199"></a><span id="l1.199"> }</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineat">@@ -1063,17 +1055,17 @@ NS_IMETHODIMP nsAbView::OnItemPropertyCh</span>
<a href="#l1.201"></a><span id="l1.201">   nsCOMPtr &lt;nsIAbCard&gt; card = do_QueryInterface(item);</span>
<a href="#l1.202"></a><span id="l1.202">   if (!card)</span>
<a href="#l1.203"></a><span id="l1.203">     return NS_OK;</span>
<a href="#l1.204"></a><span id="l1.204"> </span>
<a href="#l1.205"></a><span id="l1.205">   int32_t index = FindIndexForCard(card);</span>
<a href="#l1.206"></a><span id="l1.206">   if (index == -1)</span>
<a href="#l1.207"></a><span id="l1.207">     return NS_OK;</span>
<a href="#l1.208"></a><span id="l1.208"> </span>
<a href="#l1.209"></a><span id="l1.209" class="difflineminus">-  AbCard *oldCard = (AbCard*) (mCards.ElementAt(index));</span>
<a href="#l1.210"></a><span id="l1.210" class="difflineplus">+  AbCard *oldCard = mCards.ElementAt(index);</span>
<a href="#l1.211"></a><span id="l1.211"> </span>
<a href="#l1.212"></a><span id="l1.212">   // Malloc these from an arena</span>
<a href="#l1.213"></a><span id="l1.213">   AbCard *newCard = (AbCard *) PR_Calloc(1, sizeof(struct AbCard));</span>
<a href="#l1.214"></a><span id="l1.214">   if (!newCard)</span>
<a href="#l1.215"></a><span id="l1.215">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l1.216"></a><span id="l1.216"> </span>
<a href="#l1.217"></a><span id="l1.217">   newCard-&gt;card = card;</span>
<a href="#l1.218"></a><span id="l1.218">   NS_IF_ADDREF(newCard-&gt;card);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -194,17 +194,17 @@ DIR_Server* DIR_GetServerFromList(const </span>
<a href="#l2.4"></a><span id="l2.4">     DIR_GetDirServers();</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">   if (dir_ServerList)</span>
<a href="#l2.7"></a><span id="l2.7">   {</span>
<a href="#l2.8"></a><span id="l2.8">     int32_t count = dir_ServerList-&gt;Length();</span>
<a href="#l2.9"></a><span id="l2.9">     int32_t i;</span>
<a href="#l2.10"></a><span id="l2.10">     for (i = 0; i &lt; count; ++i)</span>
<a href="#l2.11"></a><span id="l2.11">     {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      DIR_Server *server = (DIR_Server *)dir_ServerList-&gt;ElementAt(i);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+      DIR_Server *server = dir_ServerList-&gt;ElementAt(i);</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">       if (server &amp;&amp; strcmp(server-&gt;prefName, prefName) == 0)</span>
<a href="#l2.16"></a><span id="l2.16">       {</span>
<a href="#l2.17"></a><span id="l2.17">         result = server;</span>
<a href="#l2.18"></a><span id="l2.18">         break;</span>
<a href="#l2.19"></a><span id="l2.19">       }</span>
<a href="#l2.20"></a><span id="l2.20">     }</span>
<a href="#l2.21"></a><span id="l2.21">   }</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -244,17 +244,17 @@ nsresult DIR_ShutDown()  /* FEs should c</span>
<a href="#l2.23"></a><span id="l2.23"> nsresult DIR_ContainsServer(DIR_Server* pServer, bool *hasDir)</span>
<a href="#l2.24"></a><span id="l2.24"> {</span>
<a href="#l2.25"></a><span id="l2.25">   if (dir_ServerList)</span>
<a href="#l2.26"></a><span id="l2.26">   {</span>
<a href="#l2.27"></a><span id="l2.27">     int32_t count = dir_ServerList-&gt;Length();</span>
<a href="#l2.28"></a><span id="l2.28">     int32_t i;</span>
<a href="#l2.29"></a><span id="l2.29">     for (i = 0; i &lt; count; i++)</span>
<a href="#l2.30"></a><span id="l2.30">     {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-      DIR_Server* server = (DIR_Server *)(dir_ServerList-&gt;ElementAt(i));</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      DIR_Server* server = dir_ServerList-&gt;ElementAt(i);</span>
<a href="#l2.33"></a><span id="l2.33">       if (server == pServer)</span>
<a href="#l2.34"></a><span id="l2.34">       {</span>
<a href="#l2.35"></a><span id="l2.35">         *hasDir = true;</span>
<a href="#l2.36"></a><span id="l2.36">         return NS_OK;</span>
<a href="#l2.37"></a><span id="l2.37">       }</span>
<a href="#l2.38"></a><span id="l2.38">     }</span>
<a href="#l2.39"></a><span id="l2.39">   }</span>
<a href="#l2.40"></a><span id="l2.40">   *hasDir = false;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -349,27 +349,27 @@ static bool DIR_SetServerPosition(nsTArr</span>
<a href="#l2.42"></a><span id="l2.42">    switch (position) {</span>
<a href="#l2.43"></a><span id="l2.43">    case DIR_POS_APPEND:</span>
<a href="#l2.44"></a><span id="l2.44">    /* Do nothing if the request is to append a server that is already</span>
<a href="#l2.45"></a><span id="l2.45">      * in the list.</span>
<a href="#l2.46"></a><span id="l2.46">      */</span>
<a href="#l2.47"></a><span id="l2.47">      count = wholeList-&gt;Length();</span>
<a href="#l2.48"></a><span id="l2.48">      for (i= 0; i &lt; count; i++)</span>
<a href="#l2.49"></a><span id="l2.49">      {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-       if  ((s = (DIR_Server *)wholeList-&gt;ElementAt(i)) != nullptr)</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+       if  ((s = wholeList-&gt;ElementAt(i)) != nullptr)</span>
<a href="#l2.52"></a><span id="l2.52">          if (s == server)</span>
<a href="#l2.53"></a><span id="l2.53">            return false;</span>
<a href="#l2.54"></a><span id="l2.54">      }</span>
<a href="#l2.55"></a><span id="l2.55">      /* In general, if there are any servers already in the list, set the</span>
<a href="#l2.56"></a><span id="l2.56">      * position to the position of the last server plus one.  If there</span>
<a href="#l2.57"></a><span id="l2.57">      * are none, set it to position 1.</span>
<a href="#l2.58"></a><span id="l2.58">      */</span>
<a href="#l2.59"></a><span id="l2.59">      if (count &gt; 0)</span>
<a href="#l2.60"></a><span id="l2.60">      {</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-       s = (DIR_Server *)wholeList-&gt;ElementAt(count - 1);</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+       s = wholeList-&gt;ElementAt(count - 1);</span>
<a href="#l2.63"></a><span id="l2.63">        server-&gt;position = s-&gt;position + 1;</span>
<a href="#l2.64"></a><span id="l2.64">      }</span>
<a href="#l2.65"></a><span id="l2.65">      else</span>
<a href="#l2.66"></a><span id="l2.66">        server-&gt;position = 1;</span>
<a href="#l2.67"></a><span id="l2.67">      </span>
<a href="#l2.68"></a><span id="l2.68">      wholeList-&gt;AppendElement(server);</span>
<a href="#l2.69"></a><span id="l2.69">      break;</span>
<a href="#l2.70"></a><span id="l2.70">      </span>
<a href="#l2.71"></a><span id="l2.71" class="difflineat">@@ -413,17 +413,17 @@ static bool DIR_SetServerPosition(nsTArr</span>
<a href="#l2.72"></a><span id="l2.72">      break;</span>
<a href="#l2.73"></a><span id="l2.73">      </span>
<a href="#l2.74"></a><span id="l2.74">    default:</span>
<a href="#l2.75"></a><span id="l2.75">    /* See if the server is already in the list.</span>
<a href="#l2.76"></a><span id="l2.76">      */</span>
<a href="#l2.77"></a><span id="l2.77">      count = wholeList-&gt;Length();</span>
<a href="#l2.78"></a><span id="l2.78">      for (i= 0; i &lt; count; i++)</span>
<a href="#l2.79"></a><span id="l2.79">      {</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-       if  ((s = (DIR_Server *)wholeList-&gt;ElementAt(i)) != nullptr)</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+       if  ((s = wholeList-&gt;ElementAt(i)) != nullptr)</span>
<a href="#l2.82"></a><span id="l2.82">          if (s == server)</span>
<a href="#l2.83"></a><span id="l2.83">            break;</span>
<a href="#l2.84"></a><span id="l2.84">      }</span>
<a href="#l2.85"></a><span id="l2.85">      </span>
<a href="#l2.86"></a><span id="l2.86">      /* If the server is not in the list, add it to the beginning and re-sort.</span>
<a href="#l2.87"></a><span id="l2.87">      */</span>
<a href="#l2.88"></a><span id="l2.88">      if (s == nullptr)</span>
<a href="#l2.89"></a><span id="l2.89">      {</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineat">@@ -463,17 +463,17 @@ static bool DIR_SetServerPosition(nsTArr</span>
<a href="#l2.91"></a><span id="l2.91"> static DIR_Server *dir_MatchServerPrefToServer(nsTArray&lt;DIR_Server*&gt; *wholeList, const char *pref)</span>
<a href="#l2.92"></a><span id="l2.92"> {</span>
<a href="#l2.93"></a><span id="l2.93">   DIR_Server *server;</span>
<a href="#l2.94"></a><span id="l2.94"> </span>
<a href="#l2.95"></a><span id="l2.95">   int32_t count = wholeList-&gt;Length();</span>
<a href="#l2.96"></a><span id="l2.96">   int32_t i;</span>
<a href="#l2.97"></a><span id="l2.97">   for (i = 0; i &lt; count; i++)</span>
<a href="#l2.98"></a><span id="l2.98">   {</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-    if ((server = (DIR_Server *)wholeList-&gt;ElementAt(i)) != nullptr)</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+    if ((server = wholeList-&gt;ElementAt(i)) != nullptr)</span>
<a href="#l2.101"></a><span id="l2.101">     {</span>
<a href="#l2.102"></a><span id="l2.102">       if (server-&gt;prefName &amp;&amp; PL_strstr(pref, server-&gt;prefName) == pref)</span>
<a href="#l2.103"></a><span id="l2.103">       {</span>
<a href="#l2.104"></a><span id="l2.104">         char c = pref[PL_strlen(server-&gt;prefName)];</span>
<a href="#l2.105"></a><span id="l2.105">         if (c == 0 || c == '.')</span>
<a href="#l2.106"></a><span id="l2.106">           return server;</span>
<a href="#l2.107"></a><span id="l2.107">       }</span>
<a href="#l2.108"></a><span id="l2.108">     }</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineat">@@ -676,17 +676,17 @@ static void DIR_DeleteServerList(nsTArra</span>
<a href="#l2.110"></a><span id="l2.110">   {</span>
<a href="#l2.111"></a><span id="l2.111">     DIR_Server *server = nullptr;</span>
<a href="#l2.112"></a><span id="l2.112">   </span>
<a href="#l2.113"></a><span id="l2.113">     /* TBD: Send notifications? */</span>
<a href="#l2.114"></a><span id="l2.114">     int32_t count = wholeList-&gt;Length();</span>
<a href="#l2.115"></a><span id="l2.115">     int32_t i;</span>
<a href="#l2.116"></a><span id="l2.116">     for (i = count - 1; i &gt;=0; i--)</span>
<a href="#l2.117"></a><span id="l2.117">     {</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-      server = (DIR_Server *)wholeList-&gt;ElementAt(i);</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+      server = wholeList-&gt;ElementAt(i);</span>
<a href="#l2.120"></a><span id="l2.120">       if (server != nullptr)</span>
<a href="#l2.121"></a><span id="l2.121">         DIR_DeleteServer(server);</span>
<a href="#l2.122"></a><span id="l2.122">     }</span>
<a href="#l2.123"></a><span id="l2.123">     delete wholeList;</span>
<a href="#l2.124"></a><span id="l2.124">   }</span>
<a href="#l2.125"></a><span id="l2.125"> }</span>
<a href="#l2.126"></a><span id="l2.126"> </span>
<a href="#l2.127"></a><span id="l2.127"> /*****************************************************************************</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineat">@@ -1186,19 +1186,19 @@ void DIR_SortServersByPosition(nsTArray&lt;</span>
<a href="#l2.129"></a><span id="l2.129">   int i, j;</span>
<a href="#l2.130"></a><span id="l2.130">   DIR_Server *server;</span>
<a href="#l2.131"></a><span id="l2.131">   </span>
<a href="#l2.132"></a><span id="l2.132">   int count = serverList-&gt;Length();</span>
<a href="#l2.133"></a><span id="l2.133">   for (i = 0; i &lt; count - 1; i++)</span>
<a href="#l2.134"></a><span id="l2.134">   {</span>
<a href="#l2.135"></a><span id="l2.135">     for (j = i + 1; j &lt; count; j++)</span>
<a href="#l2.136"></a><span id="l2.136">     {</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-      if (((DIR_Server *) serverList-&gt;ElementAt(j))-&gt;position &lt; ((DIR_Server *) serverList-&gt;ElementAt(i))-&gt;position)</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+      if (serverList-&gt;ElementAt(j)-&gt;position &lt; serverList-&gt;ElementAt(i)-&gt;position)</span>
<a href="#l2.139"></a><span id="l2.139">       {</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-        server        = (DIR_Server *) serverList-&gt;ElementAt(i);</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+        server = serverList-&gt;ElementAt(i);</span>
<a href="#l2.142"></a><span id="l2.142">         serverList-&gt;ReplaceElementAt(i, serverList-&gt;ElementAt(j));</span>
<a href="#l2.143"></a><span id="l2.143">         serverList-&gt;ReplaceElementAt(j, server);</span>
<a href="#l2.144"></a><span id="l2.144">       }</span>
<a href="#l2.145"></a><span id="l2.145">     }</span>
<a href="#l2.146"></a><span id="l2.146">   }</span>
<a href="#l2.147"></a><span id="l2.147"> }</span>
<a href="#l2.148"></a><span id="l2.148"> </span>
<a href="#l2.149"></a><span id="l2.149"> static nsresult DIR_GetServerPreferences(nsTArray&lt;DIR_Server*&gt;** list)</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineat">@@ -1438,15 +1438,15 @@ static void DIR_SaveServerPreferences(ns</span>
<a href="#l2.151"></a><span id="l2.151">     }</span>
<a href="#l2.152"></a><span id="l2.152"> </span>
<a href="#l2.153"></a><span id="l2.153">     int32_t  i;</span>
<a href="#l2.154"></a><span id="l2.154">     int32_t  count = wholeList-&gt;Length();</span>
<a href="#l2.155"></a><span id="l2.155">     DIR_Server *server;</span>
<a href="#l2.156"></a><span id="l2.156"> </span>
<a href="#l2.157"></a><span id="l2.157">     for (i = 0; i &lt; count; i++)</span>
<a href="#l2.158"></a><span id="l2.158">     {</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-      server = (DIR_Server *) wholeList-&gt;ElementAt(i);</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineplus">+      server = wholeList-&gt;ElementAt(i);</span>
<a href="#l2.161"></a><span id="l2.161">       if (server)</span>
<a href="#l2.162"></a><span id="l2.162">         DIR_SavePrefsForOneServer(server);</span>
<a href="#l2.163"></a><span id="l2.163">     }</span>
<a href="#l2.164"></a><span id="l2.164">     pPref-&gt;SetIntPref(PREF_LDAP_GLOBAL_TREE_NAME&quot;.user_id&quot;, dir_UserId);</span>
<a href="#l2.165"></a><span id="l2.165">   }</span>
<a href="#l2.166"></a><span id="l2.166"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsDirPrefs.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsDirPrefs.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,23 +1,23 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.5"></a><span id="l3.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> #ifndef _NSDIRPREFS_H_</span>
<a href="#l3.10"></a><span id="l3.10"> #define _NSDIRPREFS_H_</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#include &quot;nsTArray.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14"> //</span>
<a href="#l3.15"></a><span id="l3.15"> // XXX nsDirPrefs is being greatly reduced if not removed altogether. Directory</span>
<a href="#l3.16"></a><span id="l3.16"> // Prefs etc. should be handled via their appropriate nsAb*Directory classes.</span>
<a href="#l3.17"></a><span id="l3.17"> //</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-template &lt;class&gt; class nsTArray;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-</span>
<a href="#l3.21"></a><span id="l3.21"> #define kPreviousListVersion   2</span>
<a href="#l3.22"></a><span id="l3.22"> #define kCurrentListVersion    3</span>
<a href="#l3.23"></a><span id="l3.23"> #define PREF_LDAP_GLOBAL_TREE_NAME &quot;ldap_2&quot;</span>
<a href="#l3.24"></a><span id="l3.24"> #define PREF_LDAP_VERSION_NAME     &quot;ldap_2.version&quot;</span>
<a href="#l3.25"></a><span id="l3.25"> #define PREF_LDAP_SERVER_TREE_NAME &quot;ldap_2.servers&quot;</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> #define kMainLdapAddressBook &quot;ldap.mab&quot;   /* v3 main ldap address book file */</span>
<a href="#l3.28"></a><span id="l3.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -5579,17 +5579,17 @@ NS_IMETHODIMP nsMsgDBView::InsertTreeRow</span>
<a href="#l4.4"></a><span id="l4.4">   if (GetSize() &lt; aIndex)</span>
<a href="#l4.5"></a><span id="l4.5">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">   nsCOMArray&lt;nsIMsgFolder&gt; *folders = GetFolders();</span>
<a href="#l4.8"></a><span id="l4.8">   if (folders)</span>
<a href="#l4.9"></a><span id="l4.9">   {</span>
<a href="#l4.10"></a><span id="l4.10">     // In a search/xfvf view only, a folder is required.</span>
<a href="#l4.11"></a><span id="l4.11">     NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    for (int32_t i = 0; i &lt; aNumRows; i++)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    for (size_t i = 0; i &lt; aNumRows; i++)</span>
<a href="#l4.14"></a><span id="l4.14">       // Insert into m_folders.</span>
<a href="#l4.15"></a><span id="l4.15">       if (!folders-&gt;InsertObjectAt(aFolder, aIndex + i))</span>
<a href="#l4.16"></a><span id="l4.16">         return NS_ERROR_UNEXPECTED;</span>
<a href="#l4.17"></a><span id="l4.17">   }</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   if (m_keys.InsertElementsAt(aIndex, aNumRows, aKey) &amp;&amp;</span>
<a href="#l4.20"></a><span id="l4.20">       m_flags.InsertElementsAt(aIndex, aNumRows, aFlags) &amp;&amp;</span>
<a href="#l4.21"></a><span id="l4.21">       m_levels.InsertElementsAt(aIndex, aNumRows, aLevel))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -7,17 +7,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #define _nsMsgDBView_H_</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsIMsgDBView.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsIMessenger.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;nsTArray.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13"> #include &quot;nsIDBChangeListener.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> #include &quot;nsITreeView.h&quot;</span>
<a href="#l5.15"></a><span id="l5.15"> #include &quot;nsITreeBoxObject.h&quot;</span>
<a href="#l5.16"></a><span id="l5.16"> #include &quot;nsITreeSelection.h&quot;</span>
<a href="#l5.17"></a><span id="l5.17"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l5.18"></a><span id="l5.18"> #include &quot;nsIMsgThread.h&quot;</span>
<a href="#l5.19"></a><span id="l5.19"> #include &quot;nsIDateTimeFormat.h&quot;</span>
<a href="#l5.20"></a><span id="l5.20"> #include &quot;nsIDOMElement.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPBodyShell.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1008,17 +1008,17 @@ int32_t nsIMAPBodypartMultipart::Generat</span>
<a href="#l6.4"></a><span id="l6.4">     bool needMIMEHeader = !parentIsMessageType;  // !PL_strcasecmp(m_bodySubType, &quot;signed&quot;) ? true : !parentIsMessageType;</span>
<a href="#l6.5"></a><span id="l6.5">     if (needMIMEHeader &amp;&amp; !aShell-&gt;GetPseudoInterrupted())  // not a message body's type</span>
<a href="#l6.6"></a><span id="l6.6">     {</span>
<a href="#l6.7"></a><span id="l6.7">       len += GenerateMIMEHeader(aShell, stream, prefetch);</span>
<a href="#l6.8"></a><span id="l6.8">     }</span>
<a href="#l6.9"></a><span id="l6.9">     </span>
<a href="#l6.10"></a><span id="l6.10">     if (ShouldFetchInline(aShell))</span>
<a href="#l6.11"></a><span id="l6.11">     {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      for (int i = 0; i &lt; m_partList-&gt;Length(); i++)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      for (size_t i = 0; i &lt; m_partList-&gt;Length(); i++)</span>
<a href="#l6.14"></a><span id="l6.14">       {</span>
<a href="#l6.15"></a><span id="l6.15">         if (!aShell-&gt;GetPseudoInterrupted())</span>
<a href="#l6.16"></a><span id="l6.16">           len += GenerateBoundary(aShell, stream, prefetch, false);</span>
<a href="#l6.17"></a><span id="l6.17">         if (!aShell-&gt;GetPseudoInterrupted())</span>
<a href="#l6.18"></a><span id="l6.18">           len += m_partList-&gt;ElementAt(i)-&gt;Generate(aShell, stream, prefetch);</span>
<a href="#l6.19"></a><span id="l6.19">       }</span>
<a href="#l6.20"></a><span id="l6.20">       if (!aShell-&gt;GetPseudoInterrupted())</span>
<a href="#l6.21"></a><span id="l6.21">         len += GenerateBoundary(aShell, stream, prefetch, true);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -1081,17 +1081,17 @@ bool nsIMAPBodypartMultipart::ShouldFetc</span>
<a href="#l6.23"></a><span id="l6.23">     return true;</span>
<a href="#l6.24"></a><span id="l6.24">   }</span>
<a href="#l6.25"></a><span id="l6.25"> }</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27"> bool nsIMAPBodypartMultipart::PreflightCheckAllInline(nsIMAPBodyShell *aShell)</span>
<a href="#l6.28"></a><span id="l6.28"> {</span>
<a href="#l6.29"></a><span id="l6.29">   bool rv = ShouldFetchInline(aShell);</span>
<a href="#l6.30"></a><span id="l6.30">   </span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  int i = 0;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  size_t i = 0;</span>
<a href="#l6.33"></a><span id="l6.33">   while (rv &amp;&amp; (i &lt; m_partList-&gt;Length()))</span>
<a href="#l6.34"></a><span id="l6.34">   {</span>
<a href="#l6.35"></a><span id="l6.35">     rv = m_partList-&gt;ElementAt(i)-&gt;PreflightCheckAllInline(aShell);</span>
<a href="#l6.36"></a><span id="l6.36">     i++;</span>
<a href="#l6.37"></a><span id="l6.37">   }</span>
<a href="#l6.38"></a><span id="l6.38">   </span>
<a href="#l6.39"></a><span id="l6.39">   return rv;</span>
<a href="#l6.40"></a><span id="l6.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPNamespace.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPNamespace.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -111,17 +111,17 @@ nsresult nsIMAPNamespaceList::OutputToSt</span>
<a href="#l7.4"></a><span id="l7.4"> }</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> int nsIMAPNamespaceList::GetNumberOfNamespaces(EIMAPNamespaceType type)</span>
<a href="#l7.8"></a><span id="l7.8"> {</span>
<a href="#l7.9"></a><span id="l7.9"> 	int nodeIndex = 0, count = 0;</span>
<a href="#l7.10"></a><span id="l7.10"> 	for (nodeIndex = m_NamespaceList.Length() - 1; nodeIndex &gt;= 0; nodeIndex--)</span>
<a href="#l7.11"></a><span id="l7.11"> 	{</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-		nsIMAPNamespace *nspace = (nsIMAPNamespace *) m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+		nsIMAPNamespace *nspace = m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.14"></a><span id="l7.14"> 		if (nspace-&gt;GetType() == type)</span>
<a href="#l7.15"></a><span id="l7.15"> 		{</span>
<a href="#l7.16"></a><span id="l7.16"> 			count++;</span>
<a href="#l7.17"></a><span id="l7.17"> 		}</span>
<a href="#l7.18"></a><span id="l7.18"> 	}</span>
<a href="#l7.19"></a><span id="l7.19"> 	return count;</span>
<a href="#l7.20"></a><span id="l7.20"> }</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -131,17 +131,17 @@ int nsIMAPNamespaceList::AddNewNamespace</span>
<a href="#l7.23"></a><span id="l7.23"> 	// are any namespaces previously set by the preferences, or the default namespace.  If so, remove these.</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> 	if (!ns-&gt;GetIsNamespaceFromPrefs())</span>
<a href="#l7.26"></a><span id="l7.26"> 	{</span>
<a href="#l7.27"></a><span id="l7.27"> 		int nodeIndex;</span>
<a href="#l7.28"></a><span id="l7.28">         // iterate backwards because we delete elements</span>
<a href="#l7.29"></a><span id="l7.29"> 		for (nodeIndex = m_NamespaceList.Length() - 1; nodeIndex &gt;= 0; nodeIndex--)</span>
<a href="#l7.30"></a><span id="l7.30"> 		{</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-			nsIMAPNamespace *nspace = (nsIMAPNamespace *) m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+			nsIMAPNamespace *nspace = m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.33"></a><span id="l7.33"> 			// if we find existing namespace(s) that matches the </span>
<a href="#l7.34"></a><span id="l7.34"> 			// new one, we'll just remove the old ones and let the</span>
<a href="#l7.35"></a><span id="l7.35"> 			// new one get added when we've finished checking for</span>
<a href="#l7.36"></a><span id="l7.36"> 			// matching namespaces or namespaces that came from prefs.</span>
<a href="#l7.37"></a><span id="l7.37"> 			if (nspace &amp;&amp;</span>
<a href="#l7.38"></a><span id="l7.38">                             (nspace-&gt;GetIsNamespaceFromPrefs() ||</span>
<a href="#l7.39"></a><span id="l7.39">                             (!PL_strcmp(ns-&gt;GetPrefix(), nspace-&gt;GetPrefix()) &amp;&amp;</span>
<a href="#l7.40"></a><span id="l7.40"> 			     ns-&gt;GetType() == nspace-&gt;GetType() &amp;&amp;</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -164,17 +164,17 @@ int nsIMAPNamespaceList::AddNewNamespace</span>
<a href="#l7.42"></a><span id="l7.42"> // chrisf - later, fix this to know the real concept of &quot;default&quot; namespace of a given type</span>
<a href="#l7.43"></a><span id="l7.43"> nsIMAPNamespace *nsIMAPNamespaceList::GetDefaultNamespaceOfType(EIMAPNamespaceType type)</span>
<a href="#l7.44"></a><span id="l7.44"> {</span>
<a href="#l7.45"></a><span id="l7.45"> 	nsIMAPNamespace *rv = 0, *firstOfType = 0;</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47"> 	int nodeIndex, count = m_NamespaceList.Length();</span>
<a href="#l7.48"></a><span id="l7.48"> 	for (nodeIndex= 0; nodeIndex &lt; count &amp;&amp; !rv; nodeIndex++)</span>
<a href="#l7.49"></a><span id="l7.49"> 	{</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-		nsIMAPNamespace *ns = (nsIMAPNamespace *) m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+		nsIMAPNamespace *ns = m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.52"></a><span id="l7.52"> 		if (ns-&gt;GetType() == type)</span>
<a href="#l7.53"></a><span id="l7.53"> 		{</span>
<a href="#l7.54"></a><span id="l7.54"> 			if (!firstOfType)</span>
<a href="#l7.55"></a><span id="l7.55"> 				firstOfType = ns;</span>
<a href="#l7.56"></a><span id="l7.56"> 			if (!(*(ns-&gt;GetPrefix())))</span>
<a href="#l7.57"></a><span id="l7.57"> 			{</span>
<a href="#l7.58"></a><span id="l7.58"> 				// This namespace's prefix is &quot;&quot;</span>
<a href="#l7.59"></a><span id="l7.59"> 				// Therefore it is the default</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineat">@@ -195,17 +195,17 @@ nsIMAPNamespaceList::~nsIMAPNamespaceLis</span>
<a href="#l7.61"></a><span id="l7.61"> // ClearNamespaces removes and deletes the namespaces specified, and if there are no namespaces left,</span>
<a href="#l7.62"></a><span id="l7.62"> void nsIMAPNamespaceList::ClearNamespaces(bool deleteFromPrefsNamespaces, bool deleteServerAdvertisedNamespaces, bool reallyDelete)</span>
<a href="#l7.63"></a><span id="l7.63"> {</span>
<a href="#l7.64"></a><span id="l7.64"> 	int nodeIndex;</span>
<a href="#l7.65"></a><span id="l7.65"> 	</span>
<a href="#l7.66"></a><span id="l7.66">     // iterate backwards because we delete elements</span>
<a href="#l7.67"></a><span id="l7.67"> 	for (nodeIndex = m_NamespaceList.Length() - 1; nodeIndex &gt;= 0; nodeIndex--)</span>
<a href="#l7.68"></a><span id="l7.68"> 	{</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-		nsIMAPNamespace *ns = (nsIMAPNamespace *) m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+		nsIMAPNamespace *ns = m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.71"></a><span id="l7.71"> 		if (ns-&gt;GetIsNamespaceFromPrefs())</span>
<a href="#l7.72"></a><span id="l7.72"> 		{</span>
<a href="#l7.73"></a><span id="l7.73"> 			if (deleteFromPrefsNamespaces)</span>
<a href="#l7.74"></a><span id="l7.74"> 			{</span>
<a href="#l7.75"></a><span id="l7.75"> 				m_NamespaceList.RemoveElementAt(nodeIndex);</span>
<a href="#l7.76"></a><span id="l7.76"> 				if (reallyDelete)</span>
<a href="#l7.77"></a><span id="l7.77"> 					delete ns;</span>
<a href="#l7.78"></a><span id="l7.78"> 			}</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineat">@@ -220,25 +220,25 @@ void nsIMAPNamespaceList::ClearNamespace</span>
<a href="#l7.80"></a><span id="l7.80"> }</span>
<a href="#l7.81"></a><span id="l7.81"> </span>
<a href="#l7.82"></a><span id="l7.82"> nsIMAPNamespace *nsIMAPNamespaceList::GetNamespaceNumber(int nodeIndex)</span>
<a href="#l7.83"></a><span id="l7.83"> {</span>
<a href="#l7.84"></a><span id="l7.84">   NS_ASSERTION(nodeIndex &gt;= 0 &amp;&amp; nodeIndex &lt; GetNumberOfNamespaces(), &quot;invalid IMAP namespace node index&quot;);</span>
<a href="#l7.85"></a><span id="l7.85">   if (nodeIndex &lt; 0) nodeIndex = 0;</span>
<a href="#l7.86"></a><span id="l7.86"> </span>
<a href="#l7.87"></a><span id="l7.87">   // XXX really could be just ElementAt; that's why we have the assertion</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-  return 	(nsIMAPNamespace *) m_NamespaceList.SafeElementAt(nodeIndex);</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+  return m_NamespaceList.SafeElementAt(nodeIndex);</span>
<a href="#l7.90"></a><span id="l7.90"> }</span>
<a href="#l7.91"></a><span id="l7.91"> </span>
<a href="#l7.92"></a><span id="l7.92"> nsIMAPNamespace *nsIMAPNamespaceList::GetNamespaceNumber(int nodeIndex, EIMAPNamespaceType type)</span>
<a href="#l7.93"></a><span id="l7.93"> {</span>
<a href="#l7.94"></a><span id="l7.94">   int nodeCount, count = 0;</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-  for (nodeCount=m_NamespaceList.Length() - 1; nodeCount &gt;= 0; nodeCount--)</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+  for (nodeCount = m_NamespaceList.Length() - 1; nodeCount &gt;= 0; nodeCount--)</span>
<a href="#l7.97"></a><span id="l7.97">   {</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-    nsIMAPNamespace *nspace = (nsIMAPNamespace *) m_NamespaceList.ElementAt(nodeCount);</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+    nsIMAPNamespace *nspace = m_NamespaceList.ElementAt(nodeCount);</span>
<a href="#l7.100"></a><span id="l7.100">     if (nspace-&gt;GetType() == type)</span>
<a href="#l7.101"></a><span id="l7.101">     {</span>
<a href="#l7.102"></a><span id="l7.102">       count++;</span>
<a href="#l7.103"></a><span id="l7.103">       if (count == nodeIndex)</span>
<a href="#l7.104"></a><span id="l7.104">         return nspace;</span>
<a href="#l7.105"></a><span id="l7.105">     }</span>
<a href="#l7.106"></a><span id="l7.106">   }</span>
<a href="#l7.107"></a><span id="l7.107">   return nullptr;</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineat">@@ -260,17 +260,17 @@ nsIMAPNamespace *nsIMAPNamespaceList::Ge</span>
<a href="#l7.109"></a><span id="l7.109">   nsIMAPNamespace *rv = nullptr;</span>
<a href="#l7.110"></a><span id="l7.110">   int nodeIndex = 0;</span>
<a href="#l7.111"></a><span id="l7.111">   </span>
<a href="#l7.112"></a><span id="l7.112">   if (!PL_strcasecmp(boxname, &quot;INBOX&quot;))</span>
<a href="#l7.113"></a><span id="l7.113">     return GetDefaultNamespaceOfType(kPersonalNamespace);</span>
<a href="#l7.114"></a><span id="l7.114">   </span>
<a href="#l7.115"></a><span id="l7.115">   for (nodeIndex = m_NamespaceList.Length() - 1; nodeIndex &gt;= 0; nodeIndex--)</span>
<a href="#l7.116"></a><span id="l7.116">   {</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-    nsIMAPNamespace *nspace = (nsIMAPNamespace *) m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+    nsIMAPNamespace *nspace = m_NamespaceList.ElementAt(nodeIndex);</span>
<a href="#l7.119"></a><span id="l7.119">     currentMatchedLength = nspace-&gt;MailboxMatchesNamespace(boxname);</span>
<a href="#l7.120"></a><span id="l7.120">     if (currentMatchedLength &gt; lengthMatched)</span>
<a href="#l7.121"></a><span id="l7.121">     {</span>
<a href="#l7.122"></a><span id="l7.122">       rv = nspace;</span>
<a href="#l7.123"></a><span id="l7.123">       lengthMatched = currentMatchedLength;</span>
<a href="#l7.124"></a><span id="l7.124">     }</span>
<a href="#l7.125"></a><span id="l7.125">   }</span>
<a href="#l7.126"></a><span id="l7.126">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -538,17 +538,17 @@ nsImapIncomingServer::LoadNextQueuedUrl(</span>
<a href="#l8.4"></a><span id="l8.4">     if (aImapUrl)</span>
<a href="#l8.5"></a><span id="l8.5">     {</span>
<a href="#l8.6"></a><span id="l8.6">       nsImapProtocol::LogImapUrl(&quot;considering playing queued url&quot;, aImapUrl);</span>
<a href="#l8.7"></a><span id="l8.7">       rv = DoomUrlIfChannelHasError(aImapUrl, &amp;removeUrlFromQueue);</span>
<a href="#l8.8"></a><span id="l8.8">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.9"></a><span id="l8.9">       // if we didn't doom the url, lets run it.</span>
<a href="#l8.10"></a><span id="l8.10">       if (!removeUrlFromQueue)</span>
<a href="#l8.11"></a><span id="l8.11">       {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        nsISupports *aConsumer = (nsISupports*)m_urlConsumers.ElementAt(0);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+        nsISupports *aConsumer = m_urlConsumers.ElementAt(0);</span>
<a href="#l8.14"></a><span id="l8.14">         NS_IF_ADDREF(aConsumer);</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">         nsImapProtocol::LogImapUrl(&quot;creating protocol instance to play queued url&quot;, aImapUrl);</span>
<a href="#l8.17"></a><span id="l8.17">         rv = GetImapConnection(aImapUrl, getter_AddRefs(protocolInstance));</span>
<a href="#l8.18"></a><span id="l8.18">         if (NS_SUCCEEDED(rv) &amp;&amp; protocolInstance)</span>
<a href="#l8.19"></a><span id="l8.19">         {</span>
<a href="#l8.20"></a><span id="l8.20">           nsCOMPtr&lt;nsIURI&gt; url = do_QueryInterface(aImapUrl, &amp;rv);</span>
<a href="#l8.21"></a><span id="l8.21">           if (NS_SUCCEEDED(rv) &amp;&amp; url)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -6769,25 +6769,25 @@ bool nsImapProtocol::RenameHierarchyByHa</span>
<a href="#l9.4"></a><span id="l9.4">     }</span>
<a href="#l9.5"></a><span id="l9.5">     m_hierarchyNameState = kNoOperationInProgress;</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">     if (GetServerStateParser().LastCommandSuccessful())</span>
<a href="#l9.8"></a><span id="l9.8">       renameSucceeded = // rename this, and move subscriptions</span>
<a href="#l9.9"></a><span id="l9.9">                 RenameMailboxRespectingSubscriptions(oldParentMailboxName,</span>
<a href="#l9.10"></a><span id="l9.10">                                                      newParentMailboxName, true);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    int32_t numberToDelete = m_deletableChildren-&gt;Length();</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-        int32_t childIndex;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+    size_t numberToDelete = m_deletableChildren-&gt;Length();</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+    size_t childIndex;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">     for (childIndex = 0;</span>
<a href="#l9.18"></a><span id="l9.18">              (childIndex &lt; numberToDelete) &amp;&amp; renameSucceeded; childIndex++)</span>
<a href="#l9.19"></a><span id="l9.19">     {</span>
<a href="#l9.20"></a><span id="l9.20">       // the imap parser has already converted to a non UTF7 string in the canonical</span>
<a href="#l9.21"></a><span id="l9.21">       // format so convert it back</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-        char *currentName = (char *) m_deletableChildren-&gt;ElementAt(childIndex);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+        char *currentName = m_deletableChildren-&gt;ElementAt(childIndex);</span>
<a href="#l9.24"></a><span id="l9.24">         if (currentName)</span>
<a href="#l9.25"></a><span id="l9.25">         {</span>
<a href="#l9.26"></a><span id="l9.26">           char *serverName = nullptr;</span>
<a href="#l9.27"></a><span id="l9.27">           m_runningUrl-&gt;AllocateServerPath(currentName,</span>
<a href="#l9.28"></a><span id="l9.28">                                          onlineDirSeparator,</span>
<a href="#l9.29"></a><span id="l9.29">                                          &amp;serverName);</span>
<a href="#l9.30"></a><span id="l9.30">           PR_FREEIF(currentName);</span>
<a href="#l9.31"></a><span id="l9.31">           currentName = serverName;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineat">@@ -6833,48 +6833,48 @@ bool nsImapProtocol::DeleteSubFolders(co</span>
<a href="#l9.33"></a><span id="l9.33">       List(pattern.get(), false);</span>
<a href="#l9.34"></a><span id="l9.34">     }</span>
<a href="#l9.35"></a><span id="l9.35">     m_hierarchyNameState = kNoOperationInProgress;</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">     // this should be a short list so perform a sequential search for the</span>
<a href="#l9.38"></a><span id="l9.38">     // longest name mailbox.  Deleting the longest first will hopefully</span>
<a href="#l9.39"></a><span id="l9.39">         // prevent the server from having problems about deleting parents</span>
<a href="#l9.40"></a><span id="l9.40">         // ** jt - why? I don't understand this.</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-    int32_t numberToDelete = m_deletableChildren-&gt;Length();</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-    int32_t outerIndex, innerIndex;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+    size_t numberToDelete = m_deletableChildren-&gt;Length();</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+    size_t outerIndex, innerIndex;</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46">     // intelligently decide if myself(either plain format or following the dir-separator)</span>
<a href="#l9.47"></a><span id="l9.47">     // is in the sub-folder list</span>
<a href="#l9.48"></a><span id="l9.48">     bool folderInSubfolderList = false; // For Performance</span>
<a href="#l9.49"></a><span id="l9.49">     char *selectedMailboxDir = nullptr;</span>
<a href="#l9.50"></a><span id="l9.50">     {</span>
<a href="#l9.51"></a><span id="l9.51">         int32_t length = strlen(selectedMailbox);</span>
<a href="#l9.52"></a><span id="l9.52">         selectedMailboxDir = (char *)PR_MALLOC(length+2);</span>
<a href="#l9.53"></a><span id="l9.53">         if( selectedMailboxDir )    // only do the intelligent test if there is enough memory</span>
<a href="#l9.54"></a><span id="l9.54">         {</span>
<a href="#l9.55"></a><span id="l9.55">             strcpy(selectedMailboxDir, selectedMailbox);</span>
<a href="#l9.56"></a><span id="l9.56">             selectedMailboxDir[length] = onlineDirSeparator;</span>
<a href="#l9.57"></a><span id="l9.57">             selectedMailboxDir[length+1] = '\0';</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-            int32_t i;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+            size_t i;</span>
<a href="#l9.60"></a><span id="l9.60">             for( i=0; i&lt;numberToDelete &amp;&amp; !folderInSubfolderList; i++ )</span>
<a href="#l9.61"></a><span id="l9.61">             {</span>
<a href="#l9.62"></a><span id="l9.62">                 char *currentName = m_deletableChildren-&gt;ElementAt(i);</span>
<a href="#l9.63"></a><span id="l9.63">                 if( !strcmp(currentName, selectedMailbox) || !strcmp(currentName, selectedMailboxDir) )</span>
<a href="#l9.64"></a><span id="l9.64">                     folderInSubfolderList = true;</span>
<a href="#l9.65"></a><span id="l9.65">             }</span>
<a href="#l9.66"></a><span id="l9.66">         }</span>
<a href="#l9.67"></a><span id="l9.67">     }</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69">     deleteSucceeded = GetServerStateParser().LastCommandSuccessful();</span>
<a href="#l9.70"></a><span id="l9.70">     for (outerIndex = 0;</span>
<a href="#l9.71"></a><span id="l9.71">          (outerIndex &lt; numberToDelete) &amp;&amp; deleteSucceeded;</span>
<a href="#l9.72"></a><span id="l9.72">          outerIndex++)</span>
<a href="#l9.73"></a><span id="l9.73">     {</span>
<a href="#l9.74"></a><span id="l9.74">         char* longestName = nullptr;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-        int32_t longestIndex = 0; // fix bogus warning by initializing</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+        size_t longestIndex = 0; // fix bogus warning by initializing</span>
<a href="#l9.77"></a><span id="l9.77">         for (innerIndex = 0;</span>
<a href="#l9.78"></a><span id="l9.78">              innerIndex &lt; m_deletableChildren-&gt;Length();</span>
<a href="#l9.79"></a><span id="l9.79">              innerIndex++)</span>
<a href="#l9.80"></a><span id="l9.80">         {</span>
<a href="#l9.81"></a><span id="l9.81">             char *currentName = m_deletableChildren-&gt;ElementAt(innerIndex);</span>
<a href="#l9.82"></a><span id="l9.82">             if (!longestName || strlen(longestName) &lt; strlen(currentName))</span>
<a href="#l9.83"></a><span id="l9.83">             {</span>
<a href="#l9.84"></a><span id="l9.84">                 longestName = currentName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -56,18 +56,18 @@ public:</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> class CAliasEntry {</span>
<a href="#l10.6"></a><span id="l10.6"> public:</span>
<a href="#l10.7"></a><span id="l10.7">   CAliasEntry(nsCString&amp; name) { m_name = name;}</span>
<a href="#l10.8"></a><span id="l10.8">   ~CAliasEntry() { EmptyList();}</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">   void EmptyList(void) {</span>
<a href="#l10.11"></a><span id="l10.11">     CAliasData *pData;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    for (int32_t i = 0; i &lt; m_list.Length(); i++) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-      pData = (CAliasData *)m_list.ElementAt(i);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+    for (size_t i = 0; i &lt; m_list.Length(); i++) {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+      pData = m_list.ElementAt(i);</span>
<a href="#l10.16"></a><span id="l10.16">       delete pData;</span>
<a href="#l10.17"></a><span id="l10.17">     }</span>
<a href="#l10.18"></a><span id="l10.18">     m_list.Clear();</span>
<a href="#l10.19"></a><span id="l10.19">   }</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> public:</span>
<a href="#l10.22"></a><span id="l10.22">   nsCString  m_name;</span>
<a href="#l10.23"></a><span id="l10.23">   nsTArray&lt;CAliasData*&gt;  m_list;</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -152,17 +152,17 @@ int32_t nsEudoraAddress::CountWhiteSpace</span>
<a href="#l10.25"></a><span id="l10.25">   }</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">   return cnt;</span>
<a href="#l10.28"></a><span id="l10.28"> }</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30"> void nsEudoraAddress::EmptyAliases(void)</span>
<a href="#l10.31"></a><span id="l10.31"> {</span>
<a href="#l10.32"></a><span id="l10.32">   CAliasEntry *pData;</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-  for (int32_t i = 0; i &lt; m_alias.Length(); i++) {</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  for (size_t i = 0; i &lt; m_alias.Length(); i++) {</span>
<a href="#l10.35"></a><span id="l10.35">     pData = m_alias.ElementAt(i);</span>
<a href="#l10.36"></a><span id="l10.36">     delete pData;</span>
<a href="#l10.37"></a><span id="l10.37">   }</span>
<a href="#l10.38"></a><span id="l10.38">   m_alias.Clear();</span>
<a href="#l10.39"></a><span id="l10.39"> }</span>
<a href="#l10.40"></a><span id="l10.40"> </span>
<a href="#l10.41"></a><span id="l10.41"> void nsEudoraAddress::ProcessLine(const char *pLine, int32_t len, nsString&amp; errors)</span>
<a href="#l10.42"></a><span id="l10.42"> {</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineat">@@ -541,25 +541,25 @@ void DumpAliasArray(nsTArray&lt;CAliasEntry</span>
<a href="#l10.44"></a><span id="l10.44">   int32_t cnt = a.Length();</span>
<a href="#l10.45"></a><span id="l10.45">   IMPORT_LOG1(&quot;Alias list size: %ld\n&quot;, cnt);</span>
<a href="#l10.46"></a><span id="l10.46">   for (int32_t i = 0; i &lt; cnt; i++) {</span>
<a href="#l10.47"></a><span id="l10.47">     pEntry = a.ElementAt(i);</span>
<a href="#l10.48"></a><span id="l10.48">     IMPORT_LOG1(&quot;\tAlias: %s\n&quot;, pEntry-&gt;m_name.get());</span>
<a href="#l10.49"></a><span id="l10.49">     if (pEntry-&gt;m_list.Length() &gt; 1) {</span>
<a href="#l10.50"></a><span id="l10.50">       IMPORT_LOG1(&quot;\tList count #%ld\n&quot;, pEntry-&gt;m_list.Length());</span>
<a href="#l10.51"></a><span id="l10.51">       for (int32_t j = 0; j &lt; pEntry-&gt;m_list.Length(); j++) {</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-        pData = (CAliasData *) pEntry-&gt;m_list.ElementAt(j);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+        pData = pEntry-&gt;m_list.ElementAt(j);</span>
<a href="#l10.54"></a><span id="l10.54">         IMPORT_LOG0(&quot;\t\t--------\n&quot;);</span>
<a href="#l10.55"></a><span id="l10.55">         IMPORT_LOG1(&quot;\t\temail: %s\n&quot;, pData-&gt;m_email.get());</span>
<a href="#l10.56"></a><span id="l10.56">         IMPORT_LOG1(&quot;\t\trealName: %s\n&quot;, pData-&gt;m_realName.get());</span>
<a href="#l10.57"></a><span id="l10.57">         IMPORT_LOG1(&quot;\t\tnickName: %s\n&quot;, pData-&gt;m_nickName.get());</span>
<a href="#l10.58"></a><span id="l10.58">       }</span>
<a href="#l10.59"></a><span id="l10.59">     }</span>
<a href="#l10.60"></a><span id="l10.60">     else if (pEntry-&gt;m_list.Length()) {</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-      pData = (CAliasData *) pEntry-&gt;m_list.ElementAt(0);</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+      pData = pEntry-&gt;m_list.ElementAt(0);</span>
<a href="#l10.63"></a><span id="l10.63">       IMPORT_LOG1(&quot;\t\temail: %s\n&quot;, pData-&gt;m_email.get());</span>
<a href="#l10.64"></a><span id="l10.64">       IMPORT_LOG1(&quot;\t\trealName: %s\n&quot;, pData-&gt;m_realName.get());</span>
<a href="#l10.65"></a><span id="l10.65">       IMPORT_LOG1(&quot;\t\tnickName: %s\n&quot;, pData-&gt;m_nickName.get());</span>
<a href="#l10.66"></a><span id="l10.66">     }</span>
<a href="#l10.67"></a><span id="l10.67">   }</span>
<a href="#l10.68"></a><span id="l10.68"> }</span>
<a href="#l10.69"></a><span id="l10.69"> #endif</span>
<a href="#l10.70"></a><span id="l10.70"> </span>
<a href="#l10.71"></a><span id="l10.71" class="difflineat">@@ -584,17 +584,17 @@ void nsEudoraAddress::ResolveEntries(nsC</span>
<a href="#l10.72"></a><span id="l10.72">     if (result.Length() &gt; m_alias.Length())</span>
<a href="#l10.73"></a><span id="l10.73">         return;</span>
<a href="#l10.74"></a><span id="l10.74"> </span>
<a href="#l10.75"></a><span id="l10.75">     int32_t         max = list.Length();</span>
<a href="#l10.76"></a><span id="l10.76">     int32_t         i;</span>
<a href="#l10.77"></a><span id="l10.77">     CAliasData *    pData;</span>
<a href="#l10.78"></a><span id="l10.78">     CAliasEntry *   pEntry;</span>
<a href="#l10.79"></a><span id="l10.79">     for (i = 0; i &lt; max; i++) {</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-        pData = (CAliasData *)list.ElementAt(i);</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+        pData = list.ElementAt(i);</span>
<a href="#l10.82"></a><span id="l10.82">         // resolve the email to an existing alias!</span>
<a href="#l10.83"></a><span id="l10.83">         if (!name.Equals(pData-&gt;m_email, nsCaseInsensitiveCStringComparator()) &amp;&amp;</span>
<a href="#l10.84"></a><span id="l10.84">              ((pEntry = ResolveAlias(pData-&gt;m_fullEntry)) != nullptr)) {</span>
<a href="#l10.85"></a><span id="l10.85">             // This new entry has all of the entries for this puppie.</span>
<a href="#l10.86"></a><span id="l10.86">             // Resolve all of it's entries!</span>
<a href="#l10.87"></a><span id="l10.87">             numResolved++;  // Track the number of entries resolved</span>
<a href="#l10.88"></a><span id="l10.88"> </span>
<a href="#l10.89"></a><span id="l10.89">             // We pass in true for the 5th parameter so that we know that we're</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineat">@@ -858,17 +858,17 @@ void nsEudoraAddress::AddSingleCard(CAli</span>
<a href="#l10.91"></a><span id="l10.91">         // Store other web sites in the notes field, labeled nicely</span>
<a href="#l10.92"></a><span id="l10.92">         FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERWEB, otherWeb, noteUTF16);</span>
<a href="#l10.93"></a><span id="l10.93">       }</span>
<a href="#l10.94"></a><span id="l10.94"> </span>
<a href="#l10.95"></a><span id="l10.95">       noteUTF16.Append(NS_ConvertASCIItoUTF16(note));</span>
<a href="#l10.96"></a><span id="l10.96">     }</span>
<a href="#l10.97"></a><span id="l10.97">   }</span>
<a href="#l10.98"></a><span id="l10.98"> </span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-  CAliasData *pData = emailList.Length() ? (CAliasData *)emailList.ElementAt(0) : nullptr;</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+  CAliasData *pData = emailList.Length() ? emailList.ElementAt(0) : nullptr;</span>
<a href="#l10.101"></a><span id="l10.101"> </span>
<a href="#l10.102"></a><span id="l10.102">   if (pData &amp;&amp; !pData-&gt;m_realName.IsEmpty())</span>
<a href="#l10.103"></a><span id="l10.103">     displayName = pData-&gt;m_realName;</span>
<a href="#l10.104"></a><span id="l10.104">   else if (!name.IsEmpty())</span>
<a href="#l10.105"></a><span id="l10.105">     displayName = name;</span>
<a href="#l10.106"></a><span id="l10.106">   else</span>
<a href="#l10.107"></a><span id="l10.107">     displayName = pEntry-&gt;m_name;</span>
<a href="#l10.108"></a><span id="l10.108"> </span>
<a href="#l10.109"></a><span id="l10.109" class="difflineat">@@ -1009,17 +1009,17 @@ void nsEudoraAddress::AddSingleCard(CAli</span>
<a href="#l10.110"></a><span id="l10.110"> //</span>
<a href="#l10.111"></a><span id="l10.111"> void nsEudoraAddress::RememberGroupMembers(nsTArray&lt;CAliasData*&gt; &amp;membersArray, nsTArray&lt;CAliasData*&gt; &amp;emailList)</span>
<a href="#l10.112"></a><span id="l10.112"> {</span>
<a href="#l10.113"></a><span id="l10.113">   int32_t cnt = emailList.Length();</span>
<a href="#l10.114"></a><span id="l10.114">   CAliasData *pData;</span>
<a href="#l10.115"></a><span id="l10.115"> </span>
<a href="#l10.116"></a><span id="l10.116">   for (int32_t i = 0; i &lt; cnt; i++)</span>
<a href="#l10.117"></a><span id="l10.117">   {</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-    pData = (CAliasData *)emailList.ElementAt(i);</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+    pData = emailList.ElementAt(i);</span>
<a href="#l10.120"></a><span id="l10.120">     if (!pData)</span>
<a href="#l10.121"></a><span id="l10.121">       continue;</span>
<a href="#l10.122"></a><span id="l10.122"> </span>
<a href="#l10.123"></a><span id="l10.123">     int32_t memberCnt = membersArray.Length();</span>
<a href="#l10.124"></a><span id="l10.124">     int32_t j = 0;</span>
<a href="#l10.125"></a><span id="l10.125">     for (j = 0; j &lt; memberCnt; j++)</span>
<a href="#l10.126"></a><span id="l10.126">     {</span>
<a href="#l10.127"></a><span id="l10.127">       if (pData == membersArray.ElementAt(j))</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineat">@@ -1036,17 +1036,17 @@ nsresult nsEudoraAddress::AddGroupMember</span>
<a href="#l10.129"></a><span id="l10.129">   CAliasData *pData;</span>
<a href="#l10.130"></a><span id="l10.130">   nsresult rv = NS_OK;</span>
<a href="#l10.131"></a><span id="l10.131">   nsCOMPtr &lt;nsIMdbRow&gt; newRow;</span>
<a href="#l10.132"></a><span id="l10.132">   nsAutoString uniStr;</span>
<a href="#l10.133"></a><span id="l10.133">   nsAutoCString  displayName;</span>
<a href="#l10.134"></a><span id="l10.134"> </span>
<a href="#l10.135"></a><span id="l10.135">   for (int32_t i = 0; i &lt; max; i++)</span>
<a href="#l10.136"></a><span id="l10.136">   {</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineminus">-    pData = (CAliasData *)membersArray.ElementAt(i);</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+    pData = membersArray.ElementAt(i);</span>
<a href="#l10.139"></a><span id="l10.139"> </span>
<a href="#l10.140"></a><span id="l10.140">     if (!pData || (pData-&gt;m_email.IsEmpty()))</span>
<a href="#l10.141"></a><span id="l10.141">       continue;</span>
<a href="#l10.142"></a><span id="l10.142"> </span>
<a href="#l10.143"></a><span id="l10.143">     rv = pDb-&gt;GetNewRow(getter_AddRefs(newRow));</span>
<a href="#l10.144"></a><span id="l10.144">     if (NS_FAILED(rv) || !newRow)</span>
<a href="#l10.145"></a><span id="l10.145">       return rv;</span>
<a href="#l10.146"></a><span id="l10.146"> </span>
<a href="#l10.147"></a><span id="l10.147" class="difflineat">@@ -1090,17 +1090,17 @@ nsresult nsEudoraAddress::AddSingleList(</span>
<a href="#l10.148"></a><span id="l10.148">   // Add the name in pEntry as the list nickname, because it was the Eudora nickname</span>
<a href="#l10.149"></a><span id="l10.149">   rv = pDb-&gt;AddListNickName(newRow, pEntry-&gt;m_name.get());</span>
<a href="#l10.150"></a><span id="l10.150">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.151"></a><span id="l10.151"> </span>
<a href="#l10.152"></a><span id="l10.152">   // Now add the members.</span>
<a href="#l10.153"></a><span id="l10.153">   int32_t max = emailList.Length();</span>
<a href="#l10.154"></a><span id="l10.154">   for (int32_t i = 0; i &lt; max; i++)</span>
<a href="#l10.155"></a><span id="l10.155">   {</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-    CAliasData *pData = (CAliasData *)emailList.ElementAt(i);</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+    CAliasData *pData = emailList.ElementAt(i);</span>
<a href="#l10.158"></a><span id="l10.158">     nsAutoCString ldifValue(&quot;mail&quot;);</span>
<a href="#l10.159"></a><span id="l10.159">     ldifValue.Append(pData-&gt;m_email);</span>
<a href="#l10.160"></a><span id="l10.160">     rv = pDb-&gt;AddLdifListMember(newRow, ldifValue.get());</span>
<a href="#l10.161"></a><span id="l10.161">   }</span>
<a href="#l10.162"></a><span id="l10.162"> </span>
<a href="#l10.163"></a><span id="l10.163">   rv = pDb-&gt;AddCardRowToDB(newRow);</span>
<a href="#l10.164"></a><span id="l10.164">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.165"></a><span id="l10.165"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -516,17 +516,17 @@ nsresult nsEudoraCompose::GetLocalAttach</span>
<a href="#l11.4"></a><span id="l11.4">   ImportAttachment * pAttach;</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">   for (int32_t i = 0; i &lt; count; i++) {</span>
<a href="#l11.7"></a><span id="l11.7">     nsCOMPtr&lt;nsIMsgAttachedFile&gt; a(do_CreateInstance(NS_MSGATTACHEDFILE_CONTRACTID, &amp;rv));</span>
<a href="#l11.8"></a><span id="l11.8">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.9"></a><span id="l11.9">     // nsMsgNewURL(&amp;url, &quot;file://C:/boxster.jpg&quot;);</span>
<a href="#l11.10"></a><span id="l11.10">     // a[i].orig_url = url;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    pAttach = (ImportAttachment *) m_pAttachments-&gt;ElementAt(i);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    pAttach = m_pAttachments-&gt;ElementAt(i);</span>
<a href="#l11.14"></a><span id="l11.14">     nsCOMPtr&lt;nsIFile&gt; tmpFile = do_QueryInterface(pAttach-&gt;pAttachment);</span>
<a href="#l11.15"></a><span id="l11.15">     a-&gt;SetTmpFile(tmpFile);</span>
<a href="#l11.16"></a><span id="l11.16">     urlStr.Adopt(0);</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">     nsCOMPtr &lt;nsIURI&gt; uri;</span>
<a href="#l11.19"></a><span id="l11.19">     nsresult rv = NS_NewFileURI(getter_AddRefs(uri), pAttach-&gt;pAttachment);</span>
<a href="#l11.20"></a><span id="l11.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.21"></a><span id="l11.21">     uri-&gt;GetSpec(urlStr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1214,17 +1214,17 @@ nsresult nsEudoraMailbox::WriteFromSep(n</span>
<a href="#l12.4"></a><span id="l12.4">   return rv;</span>
<a href="#l12.5"></a><span id="l12.5"> }</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> void nsEudoraMailbox::EmptyAttachments(void)</span>
<a href="#l12.8"></a><span id="l12.8"> {</span>
<a href="#l12.9"></a><span id="l12.9">   int32_t max = m_attachments.Length();</span>
<a href="#l12.10"></a><span id="l12.10">   ImportAttachment *  pAttach;</span>
<a href="#l12.11"></a><span id="l12.11">   for (int32_t i = 0; i &lt; max; i++) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    pAttach = (ImportAttachment *) m_attachments.ElementAt(i);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    pAttach = m_attachments.ElementAt(i);</span>
<a href="#l12.14"></a><span id="l12.14">     if (pAttach) {</span>
<a href="#l12.15"></a><span id="l12.15">       NS_Free(pAttach-&gt;description);</span>
<a href="#l12.16"></a><span id="l12.16">       NS_Free(pAttach-&gt;mimeType);</span>
<a href="#l12.17"></a><span id="l12.17">       delete pAttach;</span>
<a href="#l12.18"></a><span id="l12.18">     }</span>
<a href="#l12.19"></a><span id="l12.19">   }</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">   m_attachments.Clear();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1101,17 +1101,17 @@ void CMapiApi::GetStoreInfo(CMapiFolder </span>
<a href="#l13.4"></a><span id="l13.4">   }</span>
<a href="#l13.5"></a><span id="l13.5"> }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> void CMapiApi::ClearMessageStores(void)</span>
<a href="#l13.9"></a><span id="l13.9"> {</span>
<a href="#l13.10"></a><span id="l13.10">   if (m_pStores) {</span>
<a href="#l13.11"></a><span id="l13.11">     CMsgStore *  pStore;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    for (int i = 0; i &lt; m_pStores-&gt;Length(); i++) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    for (size_t i = 0; i &lt; m_pStores-&gt;Length(); i++) {</span>
<a href="#l13.14"></a><span id="l13.14">       pStore = m_pStores-&gt;ElementAt(i);</span>
<a href="#l13.15"></a><span id="l13.15">       delete pStore;</span>
<a href="#l13.16"></a><span id="l13.16">     }</span>
<a href="#l13.17"></a><span id="l13.17">     m_pStores-&gt;Clear();</span>
<a href="#l13.18"></a><span id="l13.18">   }</span>
<a href="#l13.19"></a><span id="l13.19"> }</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21"> void CMapiApi::AddMessageStore(CMsgStore *pStore)</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -1126,17 +1126,17 @@ CMsgStore *  CMapiApi::FindMessageStore(</span>
<a href="#l13.23"></a><span id="l13.23">     MAPI_TRACE0(&quot;FindMessageStore called before session is open\n&quot;);</span>
<a href="#l13.24"></a><span id="l13.24">     m_lastError = -1;</span>
<a href="#l13.25"></a><span id="l13.25">     return NULL;</span>
<a href="#l13.26"></a><span id="l13.26">   }</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   ULONG    result;</span>
<a href="#l13.29"></a><span id="l13.29">   HRESULT    hr;</span>
<a href="#l13.30"></a><span id="l13.30">   CMsgStore *  pStore;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  for (int i = 0; i &lt; m_pStores-&gt;Length(); i++) {</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  for (size_t i = 0; i &lt; m_pStores-&gt;Length(); i++) {</span>
<a href="#l13.33"></a><span id="l13.33">     pStore = m_pStores-&gt;ElementAt(i);</span>
<a href="#l13.34"></a><span id="l13.34">     hr = m_lpSession-&gt;CompareEntryIDs(cbEid, lpEid, pStore-&gt;GetCBEntryID(), pStore-&gt;GetLPEntryID(),</span>
<a href="#l13.35"></a><span id="l13.35">                       0, &amp;result);</span>
<a href="#l13.36"></a><span id="l13.36">     if (HR_FAILED(hr)) {</span>
<a href="#l13.37"></a><span id="l13.37">       MAPI_TRACE2(&quot;CompareEntryIDs failed: 0x%lx, %d\n&quot;, (long)hr, (int)hr);</span>
<a href="#l13.38"></a><span id="l13.38">       m_lastError = hr;</span>
<a href="#l13.39"></a><span id="l13.39">       return NULL;</span>
<a href="#l13.40"></a><span id="l13.40">     }</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineat">@@ -1630,32 +1630,32 @@ void CMapiFolderList::GenerateFilePath(C</span>
<a href="#l13.42"></a><span id="l13.42">   }</span>
<a href="#l13.43"></a><span id="l13.43">   pFolder-&gt;GetDisplayName(name);</span>
<a href="#l13.44"></a><span id="l13.44">   pFolder-&gt;SetFilePath(name.get());</span>
<a href="#l13.45"></a><span id="l13.45"> }</span>
<a href="#l13.46"></a><span id="l13.46"> </span>
<a href="#l13.47"></a><span id="l13.47"> void CMapiFolderList::ClearAll(void)</span>
<a href="#l13.48"></a><span id="l13.48"> {</span>
<a href="#l13.49"></a><span id="l13.49">   CMapiFolder *pFolder;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-  for (int i = 0; i &lt; m_array.Length(); i++) {</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+  for (size_t i = 0; i &lt; m_array.Length(); i++) {</span>
<a href="#l13.52"></a><span id="l13.52">     pFolder = GetAt(i);</span>
<a href="#l13.53"></a><span id="l13.53">     delete pFolder;</span>
<a href="#l13.54"></a><span id="l13.54">   }</span>
<a href="#l13.55"></a><span id="l13.55">   m_array.Clear();</span>
<a href="#l13.56"></a><span id="l13.56"> }</span>
<a href="#l13.57"></a><span id="l13.57"> </span>
<a href="#l13.58"></a><span id="l13.58"> void CMapiFolderList::DumpList(void)</span>
<a href="#l13.59"></a><span id="l13.59"> {</span>
<a href="#l13.60"></a><span id="l13.60">   CMapiFolder *pFolder;</span>
<a href="#l13.61"></a><span id="l13.61">   nsString  str;</span>
<a href="#l13.62"></a><span id="l13.62">   int      depth;</span>
<a href="#l13.63"></a><span id="l13.63">   char    prefix[256];</span>
<a href="#l13.64"></a><span id="l13.64"> </span>
<a href="#l13.65"></a><span id="l13.65">   MAPI_TRACE0(&quot;Folder List ---------------------------------\n&quot;);</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-  for (int i = 0; i &lt; m_array.Length(); i++) {</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+  for (size_t i = 0; i &lt; m_array.Length(); i++) {</span>
<a href="#l13.68"></a><span id="l13.68">     pFolder = GetAt(i);</span>
<a href="#l13.69"></a><span id="l13.69">     depth = pFolder-&gt;GetDepth();</span>
<a href="#l13.70"></a><span id="l13.70">     pFolder-&gt;GetDisplayName(str);</span>
<a href="#l13.71"></a><span id="l13.71">     depth *= 2;</span>
<a href="#l13.72"></a><span id="l13.72">     if (depth &gt; 255)</span>
<a href="#l13.73"></a><span id="l13.73">       depth = 255;</span>
<a href="#l13.74"></a><span id="l13.74">     memset(prefix, ' ', depth);</span>
<a href="#l13.75"></a><span id="l13.75">     prefix[depth] = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -193,17 +193,17 @@ private:</span>
<a href="#l14.4"></a><span id="l14.4"> };</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> class CMapiFolderList {</span>
<a href="#l14.7"></a><span id="l14.7"> public:</span>
<a href="#l14.8"></a><span id="l14.8">   CMapiFolderList();</span>
<a href="#l14.9"></a><span id="l14.9">   ~CMapiFolderList();</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   void      AddItem(CMapiFolder *pFolder);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  CMapiFolder *  GetItem(int index) { if ((index &gt;= 0) &amp;&amp; (index &lt; m_array.Length())) return GetAt(index); else return NULL;}</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  CMapiFolder *  GetItem(int index) { if ((index &gt;= 0) &amp;&amp; (index &lt; (int)m_array.Length())) return GetAt(index); else return NULL;}</span>
<a href="#l14.14"></a><span id="l14.14">   void      ClearAll(void);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">   // Debugging and reporting</span>
<a href="#l14.17"></a><span id="l14.17">   void      DumpList(void);</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">   CMapiFolder *  GetAt(int index) { return m_array.ElementAt(index);}</span>
<a href="#l14.20"></a><span id="l14.20">   int        GetSize(void) { return m_array.Length();}</span>
<a href="#l14.21"></a><span id="l14.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/import/src/nsImportFieldMap.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/import/src/nsImportFieldMap.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -71,17 +71,17 @@ nsImportFieldMap::~nsImportFieldMap()</span>
<a href="#l15.4"></a><span id="l15.4"> {</span>
<a href="#l15.5"></a><span id="l15.5">   if (m_pFields)</span>
<a href="#l15.6"></a><span id="l15.6">     delete [] m_pFields;</span>
<a href="#l15.7"></a><span id="l15.7">   if (m_pActive)</span>
<a href="#l15.8"></a><span id="l15.8">     delete [] m_pActive;</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   nsString *  pStr;</span>
<a href="#l15.11"></a><span id="l15.11">   for (int32_t i = 0; i &lt; m_mozFieldCount; i++) {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    pStr = (nsString *) m_descriptions.ElementAt(i);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    pStr = m_descriptions.ElementAt(i);</span>
<a href="#l15.14"></a><span id="l15.14">     delete pStr;</span>
<a href="#l15.15"></a><span id="l15.15">   }</span>
<a href="#l15.16"></a><span id="l15.16">   m_descriptions.Clear();</span>
<a href="#l15.17"></a><span id="l15.17"> }</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20"> NS_IMETHODIMP nsImportFieldMap::GetNumMozFields(int32_t *aNumFields)</span>
<a href="#l15.21"></a><span id="l15.21"> {</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -105,20 +105,20 @@ NS_IMETHODIMP nsImportFieldMap::GetMapSi</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24"> NS_IMETHODIMP nsImportFieldMap::GetFieldDescription(int32_t index, char16_t **_retval)</span>
<a href="#l15.25"></a><span id="l15.25"> {</span>
<a href="#l15.26"></a><span id="l15.26">     NS_PRECONDITION(_retval != nullptr, &quot;null ptr&quot;);</span>
<a href="#l15.27"></a><span id="l15.27">   if (!_retval)</span>
<a href="#l15.28"></a><span id="l15.28">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30">   *_retval = nullptr;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  if ((index &lt; 0) || (index &gt;= m_descriptions.Length()))</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+  if ((index &lt; 0) || ((size_t)index &gt;= m_descriptions.Length()))</span>
<a href="#l15.33"></a><span id="l15.33">     return NS_ERROR_FAILURE;</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-  *_retval = ToNewUnicode(*((nsString *)m_descriptions.ElementAt(index)));</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+  *_retval = ToNewUnicode(*(m_descriptions.ElementAt(index)));</span>
<a href="#l15.37"></a><span id="l15.37">   return NS_OK;</span>
<a href="#l15.38"></a><span id="l15.38"> }</span>
<a href="#l15.39"></a><span id="l15.39"> </span>
<a href="#l15.40"></a><span id="l15.40"> NS_IMETHODIMP nsImportFieldMap::SetFieldMapSize(int32_t size)</span>
<a href="#l15.41"></a><span id="l15.41"> {</span>
<a href="#l15.42"></a><span id="l15.42">   nsresult rv = Allocate(size);</span>
<a href="#l15.43"></a><span id="l15.43">   if (NS_FAILED(rv))</span>
<a href="#l15.44"></a><span id="l15.44">     return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/local/public/nsIPop3Protocol.idl</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/local/public/nsIPop3Protocol.idl</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,25 +1,25 @@</span>
<a href="#l16.4"></a><span id="l16.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l16.5"></a><span id="l16.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.6"></a><span id="l16.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.7"></a><span id="l16.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">-[ptr] native nsPop3UidlEntryArrayRef(nsTArray&lt;Pop3UidlEntry*&gt;);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+[ptr] native Pop3UidlEntryArrayRef(nsTArray&lt;Pop3UidlEntry*&gt;);</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14"> %{C++</span>
<a href="#l16.15"></a><span id="l16.15"> #include &quot;nsTArray.h&quot;</span>
<a href="#l16.16"></a><span id="l16.16"> struct Pop3UidlEntry;</span>
<a href="#l16.17"></a><span id="l16.17"> %}</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-[scriptable, uuid(f3e1c1e8-3005-4554-9d46-595b1713a3a6)]</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+[scriptable, uuid(3aff0550-87de-4337-9bc1-c84eb5462afe)]</span>
<a href="#l16.21"></a><span id="l16.21"> interface nsIPop3Protocol : nsISupports {</span>
<a href="#l16.22"></a><span id="l16.22">   /* aUidl is an array of pointers to Pop3UidlEntry's. That structure is</span>
<a href="#l16.23"></a><span id="l16.23">    * currently defined in nsPop3Protocol.h, perhaps it should be here</span>
<a href="#l16.24"></a><span id="l16.24">    * instead...</span>
<a href="#l16.25"></a><span id="l16.25">    */</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-  [noscript] void markMessages(in nsPop3UidlEntryArrayRef aUidl);</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+  [noscript] void markMessages(in Pop3UidlEntryArrayRef aUidl);</span>
<a href="#l16.28"></a><span id="l16.28">   boolean checkMessage(in string aUidl);</span>
<a href="#l16.29"></a><span id="l16.29"> };</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -861,33 +861,33 @@ struct message_header *nsParseMailMessag</span>
<a href="#l17.4"></a><span id="l17.4"> void nsParseMailMessageState::GetAggregateHeader (nsTArray&lt;struct message_header*&gt; &amp;list, struct message_header *outHeader)</span>
<a href="#l17.5"></a><span id="l17.5"> {</span>
<a href="#l17.6"></a><span id="l17.6">   // When parsing a message with multiple To or CC header lines, we're storing each line in a</span>
<a href="#l17.7"></a><span id="l17.7">   // list, where the list represents the &quot;aggregate&quot; total of all the header. Here we combine</span>
<a href="#l17.8"></a><span id="l17.8">   // all the lines together, as though they were really all found on the same line</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">   struct message_header *header = nullptr;</span>
<a href="#l17.11"></a><span id="l17.11">   int length = 0;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  int i;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  size_t i;</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">   // Count up the bytes required to allocate the aggregated header</span>
<a href="#l17.16"></a><span id="l17.16">   for (i = 0; i &lt; list.Length(); i++)</span>
<a href="#l17.17"></a><span id="l17.17">   {</span>
<a href="#l17.18"></a><span id="l17.18">     header = list.ElementAt(i);</span>
<a href="#l17.19"></a><span id="l17.19">     length += (header-&gt;length + 1); //+ for &quot;,&quot;</span>
<a href="#l17.20"></a><span id="l17.20">   }</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22">   if (length &gt; 0)</span>
<a href="#l17.23"></a><span id="l17.23">   {</span>
<a href="#l17.24"></a><span id="l17.24">     char *value = (char*) PR_CALLOC (length + 1); //+1 for null term</span>
<a href="#l17.25"></a><span id="l17.25">     if (value)</span>
<a href="#l17.26"></a><span id="l17.26">     {</span>
<a href="#l17.27"></a><span id="l17.27">       // Catenate all the To lines together, separated by commas</span>
<a href="#l17.28"></a><span id="l17.28">       value[0] = '\0';</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-      int size = list.Length();</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+      size_t size = list.Length();</span>
<a href="#l17.31"></a><span id="l17.31">       for (i = 0; i &lt; size; i++)</span>
<a href="#l17.32"></a><span id="l17.32">       {</span>
<a href="#l17.33"></a><span id="l17.33">         header = list.ElementAt(i);</span>
<a href="#l17.34"></a><span id="l17.34">         PL_strncat (value, header-&gt;value, header-&gt;length);</span>
<a href="#l17.35"></a><span id="l17.35">         if (i + 1 &lt; size)</span>
<a href="#l17.36"></a><span id="l17.36">           PL_strcat (value, &quot;,&quot;);</span>
<a href="#l17.37"></a><span id="l17.37">       }</span>
<a href="#l17.38"></a><span id="l17.38">       outHeader-&gt;length = length;</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineat">@@ -901,17 +901,17 @@ void nsParseMailMessageState::GetAggrega</span>
<a href="#l17.40"></a><span id="l17.40">   }</span>
<a href="#l17.41"></a><span id="l17.41"> }</span>
<a href="#l17.42"></a><span id="l17.42"> </span>
<a href="#l17.43"></a><span id="l17.43"> void nsParseMailMessageState::ClearAggregateHeader (nsTArray&lt;struct message_header*&gt; &amp;list)</span>
<a href="#l17.44"></a><span id="l17.44"> {</span>
<a href="#l17.45"></a><span id="l17.45">   // Reset the aggregate headers. Free only the message_header struct since</span>
<a href="#l17.46"></a><span id="l17.46">   // we don't own the value pointer</span>
<a href="#l17.47"></a><span id="l17.47"> </span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-  for (int i = 0; i &lt; list.Length(); i++)</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  for (size_t i = 0; i &lt; list.Length(); i++)</span>
<a href="#l17.50"></a><span id="l17.50">     PR_Free (list.ElementAt(i));</span>
<a href="#l17.51"></a><span id="l17.51">   list.Clear();</span>
<a href="#l17.52"></a><span id="l17.52"> }</span>
<a href="#l17.53"></a><span id="l17.53"> </span>
<a href="#l17.54"></a><span id="l17.54"> // We've found a new envelope to parse.</span>
<a href="#l17.55"></a><span id="l17.55"> nsresult nsParseMailMessageState::StartNewEnvelope(const char *line, uint32_t lineLength)</span>
<a href="#l17.56"></a><span id="l17.56"> {</span>
<a href="#l17.57"></a><span id="l17.57">   m_envelope_pos = m_position;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeBaseEmitter.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -86,31 +86,29 @@ nsMimeBaseEmitter::nsMimeBaseEmitter()</span>
<a href="#l18.4"></a><span id="l18.4">   // Do prefs last since we can live without this if it fails...</span>
<a href="#l18.5"></a><span id="l18.5">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l18.6"></a><span id="l18.6">   if (pPrefBranch)</span>
<a href="#l18.7"></a><span id="l18.7">     pPrefBranch-&gt;GetIntPref(&quot;mail.show_headers&quot;, &amp;mHeaderDisplayType);</span>
<a href="#l18.8"></a><span id="l18.8"> }</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10"> nsMimeBaseEmitter::~nsMimeBaseEmitter(void)</span>
<a href="#l18.11"></a><span id="l18.11"> {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  int32_t i;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-</span>
<a href="#l18.14"></a><span id="l18.14">   // Delete the buffer manager...</span>
<a href="#l18.15"></a><span id="l18.15">   if (mBufferMgr)</span>
<a href="#l18.16"></a><span id="l18.16">   {</span>
<a href="#l18.17"></a><span id="l18.17">     delete mBufferMgr;</span>
<a href="#l18.18"></a><span id="l18.18">     mBufferMgr = nullptr;</span>
<a href="#l18.19"></a><span id="l18.19">   }</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">   // Clean up the attachment array structures...</span>
<a href="#l18.22"></a><span id="l18.22">   if (mAttachArray)</span>
<a href="#l18.23"></a><span id="l18.23">   {</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-    for (i=0; i&lt;mAttachArray-&gt;Length(); i++)</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+    for (size_t i = 0; i &lt; mAttachArray-&gt;Length(); i++)</span>
<a href="#l18.26"></a><span id="l18.26">     {</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-      attachmentInfoType *attachInfo = (attachmentInfoType *)mAttachArray-&gt;ElementAt(i);</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+      attachmentInfoType *attachInfo = mAttachArray-&gt;ElementAt(i);</span>
<a href="#l18.29"></a><span id="l18.29">       if (!attachInfo)</span>
<a href="#l18.30"></a><span id="l18.30">         continue;</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32">       PR_FREEIF(attachInfo-&gt;contentType);</span>
<a href="#l18.33"></a><span id="l18.33">       if (attachInfo-&gt;displayName)</span>
<a href="#l18.34"></a><span id="l18.34">         NS_Free(attachInfo-&gt;displayName);</span>
<a href="#l18.35"></a><span id="l18.35">       PR_FREEIF(attachInfo-&gt;urlSpec);</span>
<a href="#l18.36"></a><span id="l18.36">       PR_FREEIF(attachInfo);</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineat">@@ -133,17 +131,17 @@ NS_IMETHODIMP nsMimeBaseEmitter::GetInte</span>
<a href="#l18.38"></a><span id="l18.38"> }</span>
<a href="#l18.39"></a><span id="l18.39"> </span>
<a href="#l18.40"></a><span id="l18.40"> void</span>
<a href="#l18.41"></a><span id="l18.41"> nsMimeBaseEmitter::CleanupHeaderArray(nsTArray&lt;headerInfoType*&gt; *aArray)</span>
<a href="#l18.42"></a><span id="l18.42"> {</span>
<a href="#l18.43"></a><span id="l18.43">   if (!aArray)</span>
<a href="#l18.44"></a><span id="l18.44">     return;</span>
<a href="#l18.45"></a><span id="l18.45"> </span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-  for (int32_t i=0; i&lt;aArray-&gt;Length(); i++)</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+  for (size_t i = 0; i &lt; aArray-&gt;Length(); i++)</span>
<a href="#l18.48"></a><span id="l18.48">   {</span>
<a href="#l18.49"></a><span id="l18.49">     headerInfoType *headerInfo = aArray-&gt;ElementAt(i);</span>
<a href="#l18.50"></a><span id="l18.50">     if (!headerInfo)</span>
<a href="#l18.51"></a><span id="l18.51">       continue;</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">     PR_FREEIF(headerInfo-&gt;name);</span>
<a href="#l18.54"></a><span id="l18.54">     PR_FREEIF(headerInfo-&gt;value);</span>
<a href="#l18.55"></a><span id="l18.55">     PR_FREEIF(headerInfo);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineat">@@ -495,24 +493,23 @@ nsMimeBaseEmitter::WriteHelper(const nsA</span>
<a href="#l18.57"></a><span id="l18.57"> }</span>
<a href="#l18.58"></a><span id="l18.58"> </span>
<a href="#l18.59"></a><span id="l18.59"> //</span>
<a href="#l18.60"></a><span id="l18.60"> // Find a cached header! Note: Do NOT free this value!</span>
<a href="#l18.61"></a><span id="l18.61"> //</span>
<a href="#l18.62"></a><span id="l18.62"> const char *</span>
<a href="#l18.63"></a><span id="l18.63"> nsMimeBaseEmitter::GetHeaderValue(const char  *aHeaderName)</span>
<a href="#l18.64"></a><span id="l18.64"> {</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-  int32_t     i;</span>
<a href="#l18.66"></a><span id="l18.66">   char        *retVal = nullptr;</span>
<a href="#l18.67"></a><span id="l18.67">   nsTArray&lt;headerInfoType*&gt; *array = mDocHeader? mHeaderArray : mEmbeddedHeaderArray;</span>
<a href="#l18.68"></a><span id="l18.68"> </span>
<a href="#l18.69"></a><span id="l18.69">   if (!array)</span>
<a href="#l18.70"></a><span id="l18.70">     return nullptr;</span>
<a href="#l18.71"></a><span id="l18.71"> </span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-  for (i = 0; i &lt; array-&gt;Length(); i++)</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+  for (size_t i = 0; i &lt; array-&gt;Length(); i++)</span>
<a href="#l18.74"></a><span id="l18.74">   {</span>
<a href="#l18.75"></a><span id="l18.75">     headerInfoType *headerInfo = array-&gt;ElementAt(i);</span>
<a href="#l18.76"></a><span id="l18.76">     if ( (!headerInfo) || (!headerInfo-&gt;name) || (!(*headerInfo-&gt;name)) )</span>
<a href="#l18.77"></a><span id="l18.77">       continue;</span>
<a href="#l18.78"></a><span id="l18.78"> </span>
<a href="#l18.79"></a><span id="l18.79">     if (!PL_strcasecmp(aHeaderName, headerInfo-&gt;name))</span>
<a href="#l18.80"></a><span id="l18.80">     {</span>
<a href="#l18.81"></a><span id="l18.81">       retVal = headerInfo-&gt;value;</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineat">@@ -980,22 +977,21 @@ nsMimeBaseEmitter::DumpToCC()</span>
<a href="#l18.83"></a><span id="l18.83">   }</span>
<a href="#l18.84"></a><span id="l18.84"> </span>
<a href="#l18.85"></a><span id="l18.85">   return NS_OK;</span>
<a href="#l18.86"></a><span id="l18.86"> }</span>
<a href="#l18.87"></a><span id="l18.87"> </span>
<a href="#l18.88"></a><span id="l18.88"> nsresult</span>
<a href="#l18.89"></a><span id="l18.89"> nsMimeBaseEmitter::DumpRestOfHeaders()</span>
<a href="#l18.90"></a><span id="l18.90"> {</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineminus">-  int32_t     i;</span>
<a href="#l18.92"></a><span id="l18.92">   nsTArray&lt;headerInfoType*&gt; *array = mDocHeader? mHeaderArray : mEmbeddedHeaderArray;</span>
<a href="#l18.93"></a><span id="l18.93"> </span>
<a href="#l18.94"></a><span id="l18.94">   mHTMLHeaders.Append(&quot;&lt;table border=0 cellspacing=0 cellpadding=0 width=\&quot;100%\&quot; class=\&quot;header-part3\&quot;&gt;&quot;);</span>
<a href="#l18.95"></a><span id="l18.95"> </span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-  for (i = 0; i &lt; array-&gt;Length(); i++)</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineplus">+  for (size_t i = 0; i &lt; array-&gt;Length(); i++)</span>
<a href="#l18.98"></a><span id="l18.98">   {</span>
<a href="#l18.99"></a><span id="l18.99">     headerInfoType *headerInfo = array-&gt;ElementAt(i);</span>
<a href="#l18.100"></a><span id="l18.100">     if ( (!headerInfo) || (!headerInfo-&gt;name) || (!(*headerInfo-&gt;name)) ||</span>
<a href="#l18.101"></a><span id="l18.101">       (!headerInfo-&gt;value) || (!(*headerInfo-&gt;value)))</span>
<a href="#l18.102"></a><span id="l18.102">       continue;</span>
<a href="#l18.103"></a><span id="l18.103"> </span>
<a href="#l18.104"></a><span id="l18.104">     if ( (!PL_strcasecmp(HEADER_SUBJECT, headerInfo-&gt;name)) ||</span>
<a href="#l18.105"></a><span id="l18.105">       (!PL_strcasecmp(HEADER_DATE, headerInfo-&gt;name)) ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -179,17 +179,17 @@ nsresult nsMimeHtmlDisplayEmitter::Broad</span>
<a href="#l19.4"></a><span id="l19.4">     // todo - should make this upper case</span>
<a href="#l19.5"></a><span id="l19.5">     if (!extraExpandedHeaders.IsEmpty())</span>
<a href="#l19.6"></a><span id="l19.6">     {</span>
<a href="#l19.7"></a><span id="l19.7">       ToLowerCase(extraExpandedHeaders);</span>
<a href="#l19.8"></a><span id="l19.8">       ParseString(extraExpandedHeaders, ' ', extraExpandedHeadersArray);</span>
<a href="#l19.9"></a><span id="l19.9">     }</span>
<a href="#l19.10"></a><span id="l19.10">   }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  for (int32_t i=0; i&lt;mHeaderArray-&gt;Length(); i++)</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  for (size_t i = 0; i &lt; mHeaderArray-&gt;Length(); i++)</span>
<a href="#l19.14"></a><span id="l19.14">   {</span>
<a href="#l19.15"></a><span id="l19.15">     headerInfoType * headerInfo = mHeaderArray-&gt;ElementAt(i);</span>
<a href="#l19.16"></a><span id="l19.16">     if ( (!headerInfo) || (!headerInfo-&gt;name) || (!(*headerInfo-&gt;name)) || (!headerInfo-&gt;value) || (!(*headerInfo-&gt;value)))</span>
<a href="#l19.17"></a><span id="l19.17">       continue;</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19">     const char * headerValue = headerInfo-&gt;value;</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21">     // optimization: if we aren't in view all header view mode, we only show a small set of the total # of headers.</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -246,17 +246,17 @@ NS_IMETHODIMP nsMimeHtmlDisplayEmitter::</span>
<a href="#l19.23"></a><span id="l19.23">       mFormat = nsMimeOutput::nsMimeMessagePrintOutput;</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25">     return nsMimeBaseEmitter::WriteHTMLHeaders(name);</span>
<a href="#l19.26"></a><span id="l19.26">   }</span>
<a href="#l19.27"></a><span id="l19.27">   else</span>
<a href="#l19.28"></a><span id="l19.28">     mFirstHeaders = false;</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30">   bool bFromNewsgroups = false;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  for (int32_t j=0; j &lt; mHeaderArray-&gt;Length(); j++)</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+  for (size_t j = 0; j &lt; mHeaderArray-&gt;Length(); j++)</span>
<a href="#l19.33"></a><span id="l19.33">   {</span>
<a href="#l19.34"></a><span id="l19.34">     headerInfoType *headerInfo = mHeaderArray-&gt;ElementAt(j);</span>
<a href="#l19.35"></a><span id="l19.35">     if (!(headerInfo &amp;&amp; headerInfo-&gt;name &amp;&amp; *headerInfo-&gt;name))</span>
<a href="#l19.36"></a><span id="l19.36">       continue;</span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38">     if (!PL_strcasecmp(&quot;Newsgroups&quot;, headerInfo-&gt;name))</span>
<a href="#l19.39"></a><span id="l19.39">     {</span>
<a href="#l19.40"></a><span id="l19.40">       bFromNewsgroups = true;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

