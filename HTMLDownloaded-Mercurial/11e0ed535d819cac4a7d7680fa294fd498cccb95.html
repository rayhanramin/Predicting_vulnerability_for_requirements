<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 5659:11e0ed535d819cac4a7d7680fa294fd498cccb95</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 11e0ed535d819cac4a7d7680fa294fd498cccb95" />
<meta property="og:url" content="/comm-central/rev/11e0ed535d819cac4a7d7680fa294fd498cccb95" />
<meta property="og:description" content="Bug 516787 Message size in the main window should format large numbers (message size). r=bienvenu,sr=Neil,ui-review=clarkbw" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 11e0ed535d819cac4a7d7680fa294fd498cccb95 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/11e0ed535d819cac4a7d7680fa294fd498cccb95">shortlog</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/11e0ed535d819cac4a7d7680fa294fd498cccb95">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95">files</a> |
changeset |
<a href="/comm-central/raw-rev/11e0ed535d819cac4a7d7680fa294fd498cccb95">raw</a>  | <a href="/comm-central/archive/11e0ed535d819cac4a7d7680fa294fd498cccb95.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=516787">Bug 516787</a> Message size in the main window should format large numbers (message size). r=bienvenu,sr=Neil,ui-review=clarkbw
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#105;&#109;&#32;&#60;&#115;&#113;&#117;&#105;&#98;&#98;&#108;&#121;&#102;&#108;&#97;&#98;&#98;&#101;&#116;&#121;&#100;&#111;&#111;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 13 May 2010 11:12:04 +0100</td></tr>

<tr>
 <td>changeset 5659</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/11e0ed535d819cac4a7d7680fa294fd498cccb95">11e0ed535d819cac4a7d7680fa294fd498cccb95</a></td>
</tr>



<tr>
<td>parent 5658</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6c6a66610f911ec8a444ea3c03955a981ac498e9">6c6a66610f911ec8a444ea3c03955a981ac498e9</a>
</td>
</tr>

<tr>
<td>child 5660</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/111251cf0bb6d54e8325511d692622a8877af95f">111251cf0bb6d54e8325511d692622a8877af95f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=11e0ed535d819cac4a7d7680fa294fd498cccb95">4389</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 13 May 2010 10:18:32 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d1fa43776d9d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d1fa43776d9d5e810baee67cd9b56e4d0f27ecad">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d1fa43776d9d5e810baee67cd9b56e4d0f27ecad&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d1fa43776d9d5e810baee67cd9b56e4d0f27ecad&newProject=comm-central&newRevision=11e0ed535d819cac4a7d7680fa294fd498cccb95&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d1fa43776d9d5e810baee67cd9b56e4d0f27ecad&newProject=comm-central&newRevision=11e0ed535d819cac4a7d7680fa294fd498cccb95&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d1fa43776d9d5e810baee67cd9b56e4d0f27ecad&newProject=comm-central&newRevision=11e0ed535d819cac4a7d7680fa294fd498cccb95&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=516787">516787</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=516787">Bug 516787</a> Message size in the main window should format large numbers (message size). r=bienvenu,sr=Neil,ui-review=clarkbw</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/test/mozmill/folder-display/test-message-size.js">mail/test/mozmill/folder-display/test-message-size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/test/mozmill/folder-display/test-message-size.js">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/test/mozmill/folder-display/test-message-size.js">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/test/mozmill/folder-display/test-message-size.js">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/test/mozmill/folder-display/test-message-size.js">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mail/test/mozmill/folder-display/test-message-size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/public/nsIMessenger.idl">mailnews/base/public/nsIMessenger.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/public/nsIMessenger.idl">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/public/nsIMessenger.idl">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/public/nsIMessenger.idl">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/public/nsIMessenger.idl">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/public/nsIMessenger.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.h">mailnews/base/src/nsMsgFolderDataSource.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.h">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.h">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.h">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.h">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/src/nsMsgFolderDataSource.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/11e0ed535d819cac4a7d7680fa294fd498cccb95/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/11e0ed535d819cac4a7d7680fa294fd498cccb95/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/11e0ed535d819cac4a7d7680fa294fd498cccb95/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/11e0ed535d819cac4a7d7680fa294fd498cccb95/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/11e0ed535d819cac4a7d7680fa294fd498cccb95/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -414,20 +414,22 @@ editTagTitle=Edit Tag</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> # for the virtual folder list dialog title</span>
<a href="#l1.6"></a><span id="l1.6"> # %S is the name of the saved search folder</span>
<a href="#l1.7"></a><span id="l1.7"> editVirtualFolderPropertiesTitle=Edit Saved Search Properties for %S</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> #alert to inform the user to choose one or more folders to search for a saved search folder</span>
<a href="#l1.10"></a><span id="l1.10"> alertNoSearchFoldersSelected=You must choose at least one folder to search for the saved search folder.</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-# These two are displayed in the message and folder pane windows</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-# LOCALIZATION NOTE(????ByteAbbreviation): Do not translate %d below, it is the size of the message/folder</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-kiloByteAbbreviation=%dKB</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-megaByteAbbreviation=%dMB</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+# These are displayed in the message and folder pane windows</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+# LOCALIZATION NOTE %.*f is the abbreviated size in the appropriate units</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+byteAbbreviation2=%.*f bytes</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+kiloByteAbbreviation2=%.*f KB</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+megaByteAbbreviation2=%.*f MB</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+gigaByteAbbreviation2=%.*f GB</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23"> # Error message if message for a message id wasn't found</span>
<a href="#l1.24"></a><span id="l1.24"> errorOpenMessageForMessageIdTitle=Error opening message-id</span>
<a href="#l1.25"></a><span id="l1.25"> errorOpenMessageForMessageIdMessage=Message for message-id %S not found</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> # Warnings to alert users about phishing urls</span>
<a href="#l1.28"></a><span id="l1.28"> confirmPhishingTitle=Email Scam Alert</span>
<a href="#l1.29"></a><span id="l1.29"> #LOCALIZATION NOTE %1$S is the brand name, %2$S is the host name of the url being visited</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-message-size.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,99 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+ *   Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+ *</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+ *</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+ * License.</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+ *</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+ * The Original Code is Thunderbird Mail Client.</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+ *</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+ * Mozilla Messaging, Inc.</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+ *</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+ *   Jim Porter &lt;jvporter@wisc.edu&gt;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+ *</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+ *</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+/*</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+ * Test that the size column of in the message list is formatted properly (e.g.</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+   0.1 KB, 1.2 KB, 12.3 KB, 123 KB, and likewise for MB and GB).</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+ */</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+var MODULE_NAME = 'test-message-size';</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+var MODULE_REQUIRES = ['folder-display-helpers'];</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+var folder;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+function setupModule(module) {</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  fdh.installInto(module);</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+  folder = create_folder(&quot;MessageSizeA&quot;);</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+  // Create messages with sizes in the byte, KB, and MB ranges.</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  bytemsg = create_message({body: {body: &quot; &quot;}});</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+  kbstring = new Array(1024/2+1).join(&quot;x &quot;);</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+  kbmsg = create_message({body: {body: kbstring}});</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+  mbstring = new Array(1024+1).join(kbstring);</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+  mbmsg = create_message({body: {body: mbstring}});</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+  add_message_to_folder(folder, bytemsg);</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+  add_message_to_folder(folder, kbmsg);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+  add_message_to_folder(folder, mbmsg);</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+}</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+function _help_test_message_size(index, unit) {</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  be_in_folder(folder);</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+  // Select the nth message</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+  let curMessage = select_click_row(index);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+  // Look at the size column's data</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+  let tree = mc.folderDisplay.tree;</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+  let sizeCol = tree.columns[11];</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+  let sizeStr = tree.view.getCellText(index, sizeCol);</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+  // Note: this assumes that the numeric part of the size string is first</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+  let realSize = curMessage.messageSize;</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+  let abbrSize = parseFloat(sizeStr);</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+  if (isNaN(abbrSize))</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+    throw new Error(&quot;formatted size is not numeric: '&quot;+sizeStr+&quot;'&quot;);</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+  if (Math.abs(realSize/Math.pow(1024, unit) - abbrSize) &gt; 0.5)</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+    throw new Error(&quot;size mismatch: '&quot;+realSize+&quot;' and '&quot;+sizeStr+&quot;'&quot;);</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+}</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+function test_byte_message_size() {</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+  _help_test_message_size(0, 1);</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+}</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+function test_kb_message_size() {</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+  _help_test_message_size(1, 1);</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+}</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+function test_mb_message_size() {</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+  _help_test_message_size(2, 2);</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/public/nsIMessenger.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/public/nsIMessenger.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -44,17 +44,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> interface nsIMsgDBHdr;</span>
<a href="#l3.6"></a><span id="l3.6"> interface nsIDOMWindowInternal;</span>
<a href="#l3.7"></a><span id="l3.7"> interface nsITransactionManager;</span>
<a href="#l3.8"></a><span id="l3.8"> interface nsIMsgMessageService;</span>
<a href="#l3.9"></a><span id="l3.9"> interface nsIFile;</span>
<a href="#l3.10"></a><span id="l3.10"> interface nsIUrlListener;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-[scriptable, uuid(6D7062AD-BFC5-4d70-A036-FAEB58240363)]</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+[scriptable, uuid(be6f7aa0-36bd-11df-9879-0800200c9a66)]</span>
<a href="#l3.14"></a><span id="l3.14"> interface nsIMessenger : nsISupports {</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">     const long eUnknown = 0;</span>
<a href="#l3.17"></a><span id="l3.17">     const long eDeleteMsg = 1;</span>
<a href="#l3.18"></a><span id="l3.18">     const long eMoveMsg = 2;</span>
<a href="#l3.19"></a><span id="l3.19">     const long eCopyMsg = 3;</span>
<a href="#l3.20"></a><span id="l3.20">     const long eMarkAllMsg = 4;</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -145,10 +145,12 @@ interface nsIMessenger : nsISupports {</span>
<a href="#l3.23"></a><span id="l3.23">     ACString getMsgUriAtNavigatePos(in long aPos);</span>
<a href="#l3.24"></a><span id="l3.24">     ACString getFolderUriAtNavigatePos(in long aPos);</span>
<a href="#l3.25"></a><span id="l3.25">     attribute long navigatePos;</span>
<a href="#l3.26"></a><span id="l3.26">     // If caller just wants the count and cur pos, they can pass in a null history pointer, which will be more efficient</span>
<a href="#l3.27"></a><span id="l3.27">     // if they want a list suitable for display in a back/forward menu drop down, they should pass in a aHistory pointer,</span>
<a href="#l3.28"></a><span id="l3.28">     // and they'll get returned an array with strings containing something like subject and sender of the message - </span>
<a href="#l3.29"></a><span id="l3.29">     // other possible info is the folder containing the message, and the preview text, if available.</span>
<a href="#l3.30"></a><span id="l3.30">     void getNavigateHistory(out unsigned long aCurPos, out unsigned long aCount, [array, size_is(aCount)] out string aHistory);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    AString formatFileSize(in unsigned long long aPos, [optional] in boolean aUseKB);</span>
<a href="#l3.33"></a><span id="l3.33"> };</span>
<a href="#l3.34"></a><span id="l3.34"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2220,16 +2220,23 @@ NS_IMETHODIMP nsMessenger::GetNavigateHi</span>
<a href="#l4.4"></a><span id="l4.4">     if (!*next)</span>
<a href="#l4.5"></a><span id="l4.5">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l4.6"></a><span id="l4.6">     next++;</span>
<a href="#l4.7"></a><span id="l4.7">   }</span>
<a href="#l4.8"></a><span id="l4.8">   *aHistoryUris = outArray;</span>
<a href="#l4.9"></a><span id="l4.9">   return NS_OK;</span>
<a href="#l4.10"></a><span id="l4.10"> }</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+nsMessenger::FormatFileSize(PRUint64 aSize, PRBool aUseKB, nsAString&amp; aFormattedSize)</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+{</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  return ::FormatFileSize(aSize, aUseKB, aFormattedSize);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+}</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+</span>
<a href="#l4.19"></a><span id="l4.19"> /* void OnItemAdded (in nsIMsgFolder parentItem, in nsISupports item); */</span>
<a href="#l4.20"></a><span id="l4.20"> NS_IMETHODIMP nsMessenger::OnItemAdded(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l4.21"></a><span id="l4.21"> {</span>
<a href="#l4.22"></a><span id="l4.22">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l4.23"></a><span id="l4.23"> }</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25"> /* void OnItemRemoved (in nsIMsgFolder parentItem, in nsISupports item); */</span>
<a href="#l4.26"></a><span id="l4.26"> NS_IMETHODIMP nsMessenger::OnItemRemoved(nsIMsgFolder *parentItem, nsISupports *item)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -114,18 +114,16 @@ PRUnichar * nsMsgDBView::kHighPrioritySt</span>
<a href="#l5.4"></a><span id="l5.4"> PRUnichar * nsMsgDBView::kLowestPriorityString = nsnull;</span>
<a href="#l5.5"></a><span id="l5.5"> PRUnichar * nsMsgDBView::kLowPriorityString = nsnull;</span>
<a href="#l5.6"></a><span id="l5.6"> PRUnichar * nsMsgDBView::kNormalPriorityString = nsnull;</span>
<a href="#l5.7"></a><span id="l5.7"> PRUnichar * nsMsgDBView::kReadString = nsnull;</span>
<a href="#l5.8"></a><span id="l5.8"> PRUnichar * nsMsgDBView::kRepliedString = nsnull;</span>
<a href="#l5.9"></a><span id="l5.9"> PRUnichar * nsMsgDBView::kForwardedString = nsnull;</span>
<a href="#l5.10"></a><span id="l5.10"> PRUnichar * nsMsgDBView::kNewString = nsnull;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-PRUnichar * nsMsgDBView::kKiloByteString = nsnull;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-</span>
<a href="#l5.14"></a><span id="l5.14"> nsDateFormatSelector  nsMsgDBView::m_dateFormatDefault = kDateFormatShort;</span>
<a href="#l5.15"></a><span id="l5.15"> nsDateFormatSelector  nsMsgDBView::m_dateFormatThisWeek = kDateFormatShort;</span>
<a href="#l5.16"></a><span id="l5.16"> nsDateFormatSelector  nsMsgDBView::m_dateFormatToday = kDateFormatNone;</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> static const PRUint32 kMaxNumSortColumns = 2;</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> // this is passed into NS_QuickSort as custom data.</span>
<a href="#l5.21"></a><span id="l5.21"> class viewSortInfo</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -231,18 +229,16 @@ void nsMsgDBView::InitializeAtomsAndLite</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">   kLabelColorWhiteAtom = NS_NewAtom(&quot;lc-white&quot;);</span>
<a href="#l5.25"></a><span id="l5.25">   kLabelColorBlackAtom = NS_NewAtom(&quot;lc-black&quot;);</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">   kReadString = GetString(NS_LITERAL_STRING(&quot;read&quot;).get());</span>
<a href="#l5.28"></a><span id="l5.28">   kRepliedString = GetString(NS_LITERAL_STRING(&quot;replied&quot;).get());</span>
<a href="#l5.29"></a><span id="l5.29">   kForwardedString = GetString(NS_LITERAL_STRING(&quot;forwarded&quot;).get());</span>
<a href="#l5.30"></a><span id="l5.30">   kNewString = GetString(NS_LITERAL_STRING(&quot;new&quot;).get());</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  kKiloByteString = GetString(NS_LITERAL_STRING(&quot;kiloByteAbbreviation&quot;).get());</span>
<a href="#l5.33"></a><span id="l5.33"> }</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35"> nsMsgDBView::~nsMsgDBView()</span>
<a href="#l5.36"></a><span id="l5.36"> {</span>
<a href="#l5.37"></a><span id="l5.37">   if (m_db)</span>
<a href="#l5.38"></a><span id="l5.38">     m_db-&gt;RemoveListener(this);</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40">   gInstanceCount--;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -281,17 +277,16 @@ nsMsgDBView::~nsMsgDBView()</span>
<a href="#l5.42"></a><span id="l5.42">     NS_Free(kLowestPriorityString);</span>
<a href="#l5.43"></a><span id="l5.43">     NS_Free(kLowPriorityString);</span>
<a href="#l5.44"></a><span id="l5.44">     NS_Free(kNormalPriorityString);</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">     NS_Free(kReadString);</span>
<a href="#l5.47"></a><span id="l5.47">     NS_Free(kRepliedString);</span>
<a href="#l5.48"></a><span id="l5.48">     NS_Free(kForwardedString);</span>
<a href="#l5.49"></a><span id="l5.49">     NS_Free(kNewString);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-    NS_Free(kKiloByteString);</span>
<a href="#l5.51"></a><span id="l5.51">   }</span>
<a href="#l5.52"></a><span id="l5.52"> }</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54"> nsresult nsMsgDBView::InitLabelStrings()</span>
<a href="#l5.55"></a><span id="l5.55"> {</span>
<a href="#l5.56"></a><span id="l5.56">   nsresult rv = NS_OK;</span>
<a href="#l5.57"></a><span id="l5.57">   nsCString prefString;</span>
<a href="#l5.58"></a><span id="l5.58"> </span>
<a href="#l5.59"></a><span id="l5.59" class="difflineat">@@ -605,16 +600,17 @@ nsresult nsMsgDBView::FetchStatus(PRUint</span>
<a href="#l5.60"></a><span id="l5.60">   else if (aFlags &amp; nsMsgMessageFlags::Read)</span>
<a href="#l5.61"></a><span id="l5.61">     aStatusString = kReadString;</span>
<a href="#l5.62"></a><span id="l5.62"> </span>
<a href="#l5.63"></a><span id="l5.63">   return NS_OK;</span>
<a href="#l5.64"></a><span id="l5.64"> }</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66"> nsresult nsMsgDBView::FetchSize(nsIMsgDBHdr * aHdr, nsAString &amp;aSizeString)</span>
<a href="#l5.67"></a><span id="l5.67"> {</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+  nsresult rv;</span>
<a href="#l5.69"></a><span id="l5.69">   nsAutoString formattedSizeString;</span>
<a href="#l5.70"></a><span id="l5.70">   PRUint32 msgSize = 0;</span>
<a href="#l5.71"></a><span id="l5.71"> </span>
<a href="#l5.72"></a><span id="l5.72">   // for news, show the line count, not the size if the user wants so</span>
<a href="#l5.73"></a><span id="l5.73">   if (mShowSizeInLines)</span>
<a href="#l5.74"></a><span id="l5.74">   {</span>
<a href="#l5.75"></a><span id="l5.75">     aHdr-&gt;GetLineCount(&amp;msgSize);</span>
<a href="#l5.76"></a><span id="l5.76">     formattedSizeString.AppendInt(msgSize);</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineat">@@ -625,26 +621,18 @@ nsresult nsMsgDBView::FetchSize(nsIMsgDB</span>
<a href="#l5.78"></a><span id="l5.78"> </span>
<a href="#l5.79"></a><span id="l5.79">     aHdr-&gt;GetFlags(&amp;flags);</span>
<a href="#l5.80"></a><span id="l5.80">     if (flags &amp; nsMsgMessageFlags::Partial)</span>
<a href="#l5.81"></a><span id="l5.81">       aHdr-&gt;GetUint32Property(&quot;onlineSize&quot;, &amp;msgSize);</span>
<a href="#l5.82"></a><span id="l5.82"> </span>
<a href="#l5.83"></a><span id="l5.83">     if (msgSize == 0)</span>
<a href="#l5.84"></a><span id="l5.84">       aHdr-&gt;GetMessageSize(&amp;msgSize);</span>
<a href="#l5.85"></a><span id="l5.85"> </span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-    if(msgSize &lt; 1024)</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-      msgSize = 1024;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-    PRUint32 sizeInKB = msgSize/1024;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-    // kKiloByteString is a localized string that we use to get the right</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-    // format to add on the &quot;KB&quot; or equivalent</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-    nsTextFormatter::ssprintf(formattedSizeString,</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-                              kKiloByteString,</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-                              sizeInKB);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+    rv = FormatFileSize(msgSize, true, formattedSizeString);</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.98"></a><span id="l5.98">   }</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100">   aSizeString = formattedSizeString;</span>
<a href="#l5.101"></a><span id="l5.101">   // the formattingString Length includes the null terminator byte!</span>
<a href="#l5.102"></a><span id="l5.102">   if (!formattedSizeString.Last())</span>
<a href="#l5.103"></a><span id="l5.103">     aSizeString.SetLength(formattedSizeString.Length() - 1);</span>
<a href="#l5.104"></a><span id="l5.104">   return NS_OK;</span>
<a href="#l5.105"></a><span id="l5.105"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -188,18 +188,16 @@ protected:</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   static nsIAtom* kDummyMsgAtom;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">   static PRUnichar* kReadString;</span>
<a href="#l6.8"></a><span id="l6.8">   static PRUnichar* kRepliedString;</span>
<a href="#l6.9"></a><span id="l6.9">   static PRUnichar* kForwardedString;</span>
<a href="#l6.10"></a><span id="l6.10">   static PRUnichar* kNewString;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  static PRUnichar* kKiloByteString;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-</span>
<a href="#l6.14"></a><span id="l6.14">   nsCOMPtr&lt;nsITreeBoxObject&gt; mTree;</span>
<a href="#l6.15"></a><span id="l6.15">   nsCOMPtr&lt;nsITreeSelection&gt; mTreeSelection;</span>
<a href="#l6.16"></a><span id="l6.16">   PRUint32 mNumSelectedRows; // we cache this to determine when to push command status notifications.</span>
<a href="#l6.17"></a><span id="l6.17">   PRPackedBool   mSuppressMsgDisplay; // set when the message pane is collapsed</span>
<a href="#l6.18"></a><span id="l6.18">   PRPackedBool   mSuppressCommandUpdating;</span>
<a href="#l6.19"></a><span id="l6.19">   PRPackedBool   mRemovingRow; // set when we're telling the outline a row is being removed. used to suppress msg loading.</span>
<a href="#l6.20"></a><span id="l6.20">                         // during delete/move operations.</span>
<a href="#l6.21"></a><span id="l6.21">   PRPackedBool  mCommandsNeedDisablingBecauseOfSelection;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -39,16 +39,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;msgCore.h&quot;    // precompiled header...</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;prlog.h&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;prmem.h&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsMsgFolderDataSource.h&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> #include &quot;rdf.h&quot;</span>
<a href="#l7.16"></a><span id="l7.16"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l7.17"></a><span id="l7.17"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l7.18"></a><span id="l7.18"> #include &quot;nsIRDFNode.h&quot;</span>
<a href="#l7.19"></a><span id="l7.19"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -141,19 +142,16 @@ nsIAtom * nsMsgFolderDataSource::kFolder</span>
<a href="#l7.22"></a><span id="l7.22"> nsIAtom * nsMsgFolderDataSource::kNameAtom = nsnull;</span>
<a href="#l7.23"></a><span id="l7.23"> nsIAtom * nsMsgFolderDataSource::kSynchronizeAtom = nsnull;</span>
<a href="#l7.24"></a><span id="l7.24"> nsIAtom * nsMsgFolderDataSource::kOpenAtom = nsnull;</span>
<a href="#l7.25"></a><span id="l7.25"> nsIAtom * nsMsgFolderDataSource::kIsDeferredAtom = nsnull;</span>
<a href="#l7.26"></a><span id="l7.26"> nsIAtom * nsMsgFolderDataSource::kIsSecureAtom = nsnull;</span>
<a href="#l7.27"></a><span id="l7.27"> nsIAtom * nsMsgFolderDataSource::kCanFileMessagesAtom = nsnull;</span>
<a href="#l7.28"></a><span id="l7.28"> nsIAtom * nsMsgFolderDataSource::kInVFEditSearchScopeAtom = nsnull;</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-PRUnichar * nsMsgFolderDataSource::kKiloByteString = nsnull;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-PRUnichar * nsMsgFolderDataSource::kMegaByteString = nsnull;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-</span>
<a href="#l7.33"></a><span id="l7.33"> static const PRUint32 kDisplayBlankCount = 0xFFFFFFFE;</span>
<a href="#l7.34"></a><span id="l7.34"> static const PRUint32 kDisplayQuestionCount = 0xFFFFFFFF;</span>
<a href="#l7.35"></a><span id="l7.35"> </span>
<a href="#l7.36"></a><span id="l7.36"> nsMsgFolderDataSource::nsMsgFolderDataSource()</span>
<a href="#l7.37"></a><span id="l7.37"> {</span>
<a href="#l7.38"></a><span id="l7.38">   // one-time initialization here</span>
<a href="#l7.39"></a><span id="l7.39">   nsIRDFService* rdf = getRDFService();</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -225,30 +223,16 @@ nsMsgFolderDataSource::nsMsgFolderDataSo</span>
<a href="#l7.42"></a><span id="l7.42">     kNewMessagesAtom             = NS_NewAtom(&quot;NewMessages&quot;);</span>
<a href="#l7.43"></a><span id="l7.43">     kNameAtom                    = NS_NewAtom(&quot;Name&quot;);</span>
<a href="#l7.44"></a><span id="l7.44">     kSynchronizeAtom             = NS_NewAtom(&quot;Synchronize&quot;);</span>
<a href="#l7.45"></a><span id="l7.45">     kOpenAtom                    = NS_NewAtom(&quot;open&quot;);</span>
<a href="#l7.46"></a><span id="l7.46">     kIsDeferredAtom              = NS_NewAtom(&quot;isDeferred&quot;);</span>
<a href="#l7.47"></a><span id="l7.47">     kIsSecureAtom                = NS_NewAtom(&quot;isSecure&quot;);</span>
<a href="#l7.48"></a><span id="l7.48">     kCanFileMessagesAtom         = NS_NewAtom(&quot;canFileMessages&quot;);</span>
<a href="#l7.49"></a><span id="l7.49">     kInVFEditSearchScopeAtom     = NS_NewAtom(&quot;inVFEditSearchScope&quot;);</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; sBundleService)</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-      res = sBundleService-&gt;CreateBundle(MESSENGER_STRING_URL, getter_AddRefs(sMessengerStringBundle));</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; sMessengerStringBundle)</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-    {</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-      if (!NS_SUCCEEDED(sMessengerStringBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;kiloByteAbbreviation&quot;).get(), &amp;kKiloByteString)))</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-        kKiloByteString = ToNewUnicode(NS_LITERAL_STRING(&quot;kiloByteAbbreviation&quot;));</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-      if (!NS_SUCCEEDED(sMessengerStringBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;megaByteAbbreviation&quot;).get(), &amp;kMegaByteString)))</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-        kMegaByteString = ToNewUnicode(NS_LITERAL_STRING(&quot;megaByteAbbreviation&quot;));</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-    }</span>
<a href="#l7.64"></a><span id="l7.64">   }</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66">   CreateLiterals(rdf);</span>
<a href="#l7.67"></a><span id="l7.67">   CreateArcsOutEnumerator();</span>
<a href="#l7.68"></a><span id="l7.68"> }</span>
<a href="#l7.69"></a><span id="l7.69"> </span>
<a href="#l7.70"></a><span id="l7.70"> nsMsgFolderDataSource::~nsMsgFolderDataSource (void)</span>
<a href="#l7.71"></a><span id="l7.71"> {</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineat">@@ -317,18 +301,16 @@ nsMsgFolderDataSource::~nsMsgFolderDataS</span>
<a href="#l7.73"></a><span id="l7.73">     NS_RELEASE(kNewMessagesAtom);</span>
<a href="#l7.74"></a><span id="l7.74">     NS_RELEASE(kNameAtom);</span>
<a href="#l7.75"></a><span id="l7.75">     NS_RELEASE(kSynchronizeAtom);</span>
<a href="#l7.76"></a><span id="l7.76">     NS_RELEASE(kOpenAtom);</span>
<a href="#l7.77"></a><span id="l7.77">     NS_RELEASE(kIsDeferredAtom);</span>
<a href="#l7.78"></a><span id="l7.78">     NS_RELEASE(kIsSecureAtom);</span>
<a href="#l7.79"></a><span id="l7.79">     NS_RELEASE(kCanFileMessagesAtom);</span>
<a href="#l7.80"></a><span id="l7.80">     NS_RELEASE(kInVFEditSearchScopeAtom);</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-    nsMemory::Free(kKiloByteString);</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-    nsMemory::Free(kMegaByteString);</span>
<a href="#l7.83"></a><span id="l7.83">   }</span>
<a href="#l7.84"></a><span id="l7.84"> }</span>
<a href="#l7.85"></a><span id="l7.85"> </span>
<a href="#l7.86"></a><span id="l7.86"> nsresult nsMsgFolderDataSource::CreateLiterals(nsIRDFService *rdf)</span>
<a href="#l7.87"></a><span id="l7.87"> {</span>
<a href="#l7.88"></a><span id="l7.88">   createNode(NS_LITERAL_STRING(&quot;true&quot;).get(),</span>
<a href="#l7.89"></a><span id="l7.89">     getter_AddRefs(kTrueLiteral), rdf);</span>
<a href="#l7.90"></a><span id="l7.90">   createNode(NS_LITERAL_STRING(&quot;false&quot;).get(),</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineat">@@ -1833,38 +1815,31 @@ nsMsgFolderDataSource::GetNumMessagesNod</span>
<a href="#l7.92"></a><span id="l7.92">     createNode(NS_LITERAL_STRING(&quot;???&quot;).get(), node, getRDFService());</span>
<a href="#l7.93"></a><span id="l7.93">   else if (numMessages == kDisplayBlankCount || numMessages == 0)</span>
<a href="#l7.94"></a><span id="l7.94">     createNode(EmptyString().get(), node, getRDFService());</span>
<a href="#l7.95"></a><span id="l7.95">   else</span>
<a href="#l7.96"></a><span id="l7.96">     createIntNode(numMessages, node, getRDFService());</span>
<a href="#l7.97"></a><span id="l7.97">   return NS_OK;</span>
<a href="#l7.98"></a><span id="l7.98"> }</span>
<a href="#l7.99"></a><span id="l7.99"> </span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-#define DIVISIONWITHCEIL(num, div) (num/div+((num%div&gt;0)?1:0))</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-</span>
<a href="#l7.102"></a><span id="l7.102"> nsresult</span>
<a href="#l7.103"></a><span id="l7.103"> nsMsgFolderDataSource::GetFolderSizeNode(PRInt32 aFolderSize, nsIRDFNode **aNode)</span>
<a href="#l7.104"></a><span id="l7.104"> {</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+  nsresult rv;</span>
<a href="#l7.106"></a><span id="l7.106">   PRUint32 folderSize = aFolderSize;</span>
<a href="#l7.107"></a><span id="l7.107">   if (folderSize == kDisplayBlankCount || folderSize == 0)</span>
<a href="#l7.108"></a><span id="l7.108">     createNode(EmptyString().get(), aNode, getRDFService());</span>
<a href="#l7.109"></a><span id="l7.109">   else if(folderSize == kDisplayQuestionCount)</span>
<a href="#l7.110"></a><span id="l7.110">     createNode(NS_LITERAL_STRING(&quot;???&quot;).get(), aNode, getRDFService());</span>
<a href="#l7.111"></a><span id="l7.111">   else</span>
<a href="#l7.112"></a><span id="l7.112">   {</span>
<a href="#l7.113"></a><span id="l7.113">     nsAutoString sizeString;</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineminus">-    // use Round or Ceil - bug #251202</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineminus">-    folderSize = DIVISIONWITHCEIL(folderSize, 1024);  // normalize into k;</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineminus">-    PRBool sizeInMB = (folderSize &gt; 999); // 999, not 1024 - bug #251204</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineplus">+    rv = FormatFileSize(folderSize, true, sizeString);</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.119"></a><span id="l7.119"> </span>
<a href="#l7.120"></a><span id="l7.120" class="difflineminus">-    // kKiloByteString/kMegaByteString are localized strings that we use</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineminus">-    // to get the right format to add on the &quot;KB&quot;/&quot;MB&quot; or equivalent</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineminus">-    nsTextFormatter::ssprintf(sizeString,</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineminus">-                              (sizeInMB) ? kMegaByteString : kKiloByteString,</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineminus">-                              (sizeInMB) ? DIVISIONWITHCEIL(folderSize, 1024) : folderSize);</span>
<a href="#l7.125"></a><span id="l7.125">     createNode(sizeString.get(), aNode, getRDFService());</span>
<a href="#l7.126"></a><span id="l7.126">   }</span>
<a href="#l7.127"></a><span id="l7.127">   return NS_OK;</span>
<a href="#l7.128"></a><span id="l7.128"> }</span>
<a href="#l7.129"></a><span id="l7.129"> </span>
<a href="#l7.130"></a><span id="l7.130"> nsresult</span>
<a href="#l7.131"></a><span id="l7.131"> nsMsgFolderDataSource::createFolderChildNode(nsIMsgFolder *folder,</span>
<a href="#l7.132"></a><span id="l7.132">                                              nsIRDFNode **target)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -290,19 +290,16 @@ protected:</span>
<a href="#l8.4"></a><span id="l8.4">   static nsIAtom* kIsDeferredAtom;</span>
<a href="#l8.5"></a><span id="l8.5">   static nsIAtom* kIsSecureAtom;</span>
<a href="#l8.6"></a><span id="l8.6">   static nsrefcnt gFolderResourceRefCnt;</span>
<a href="#l8.7"></a><span id="l8.7">   static nsIAtom* kCanFileMessagesAtom;</span>
<a href="#l8.8"></a><span id="l8.8">   static nsIAtom* kInVFEditSearchScopeAtom;</span>
<a href="#l8.9"></a><span id="l8.9">   </span>
<a href="#l8.10"></a><span id="l8.10">   nsCOMArray&lt;nsIRDFResource&gt; kFolderArcsOutArray;</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  static PRUnichar* kKiloByteString;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  static PRUnichar* kMegaByteString;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-</span>
<a href="#l8.15"></a><span id="l8.15"> };</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> class nsMsgFlatFolderDataSource : public nsMsgFolderDataSource</span>
<a href="#l8.19"></a><span id="l8.19"> {</span>
<a href="#l8.20"></a><span id="l8.20"> public:</span>
<a href="#l8.21"></a><span id="l8.21">   // constructor could take a filter to filter out folders.</span>
<a href="#l8.22"></a><span id="l8.22">   nsMsgFlatFolderDataSource();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -85,16 +85,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l9.5"></a><span id="l9.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsIMsgSearchTerm.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+#include &quot;nsTextFormatter.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;nsIAtomService.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15"> static NS_DEFINE_CID(kImapUrlCID, NS_IMAPURL_CID);</span>
<a href="#l9.16"></a><span id="l9.16"> static NS_DEFINE_CID(kCMailboxUrl, NS_MAILBOXURL_CID);</span>
<a href="#l9.17"></a><span id="l9.17"> static NS_DEFINE_CID(kCNntpUrlCID, NS_NNTPURL_CID);</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> #define ILLEGAL_FOLDER_CHARS &quot;;#&quot;</span>
<a href="#l9.20"></a><span id="l9.20"> #define ILLEGAL_FOLDER_CHARS_AS_FIRST_LETTER &quot;.&quot;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -471,16 +472,72 @@ nsresult NS_MsgHashIfNecessary(nsAutoStr</span>
<a href="#l9.22"></a><span id="l9.22">     PR_snprintf(hashedname, 9, &quot;%08lx&quot;, (unsigned long) StringHash(name));</span>
<a href="#l9.23"></a><span id="l9.23">     name.SetLength(keptLength);</span>
<a href="#l9.24"></a><span id="l9.24">     name.Append(NS_ConvertASCIItoUTF16(hashedname));</span>
<a href="#l9.25"></a><span id="l9.25">   }</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">   return NS_OK;</span>
<a href="#l9.28"></a><span id="l9.28"> }</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+nsresult FormatFileSize(PRUint64 size, PRBool useKB, nsAString &amp;formattedSize)</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+{</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  NS_NAMED_LITERAL_STRING(byteAbbr, &quot;byteAbbreviation2&quot;);</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+  NS_NAMED_LITERAL_STRING(kbAbbr,   &quot;kiloByteAbbreviation2&quot;);</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+  NS_NAMED_LITERAL_STRING(mbAbbr,   &quot;megaByteAbbreviation2&quot;);</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+  NS_NAMED_LITERAL_STRING(gbAbbr,   &quot;gigaByteAbbreviation2&quot;);</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+  const PRUnichar *sizeAbbrNames[] = {</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+    byteAbbr.get(), kbAbbr.get(), mbAbbr.get(), gbAbbr.get()</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+  };</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+  nsresult rv;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+    do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+  rv = bundleSvc-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+                               getter_AddRefs(bundle));</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  float unitSize = size;</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  PRUint32 unitIndex = 0;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+  if (useKB) {</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+    // Start by formatting in kilobytes</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+    unitSize /= 1024;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+    if (unitSize &lt; 0.1)</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+      unitSize = 0.1;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+    unitIndex++;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+  }</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+  // Convert to next unit if it needs 4 digits (after rounding), but only if</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+  // we know the name of the next unit</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+  while ((unitSize &gt;= 999.5) &amp;&amp; (unitIndex &lt; NS_ARRAY_LENGTH(sizeAbbrNames)))</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+  {</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+      unitSize /= 1024;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+      unitIndex++;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+  }</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+  // Grab the string for the appropriate unit</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+  nsString sizeAbbr;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+  rv = bundle-&gt;GetStringFromName(sizeAbbrNames[unitIndex],</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+                                 getter_Copies(sizeAbbr));</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+  // Get rid of insignificant bits by truncating to 1 or 0 decimal points</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+  // 0.1 -&gt; 0.1; 1.2 -&gt; 1.2; 12.3 -&gt; 12.3; 123.4 -&gt; 123; 234.5 -&gt; 235</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+  nsTextFormatter::ssprintf(formattedSize,</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+                            sizeAbbr.get(),</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+                            (unitIndex != 0) &amp;&amp; (unitSize &lt; 99.95) ? 1 : 0,</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+                            unitSize);</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+  return NS_OK;</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+}</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+</span>
<a href="#l9.86"></a><span id="l9.86"> </span>
<a href="#l9.87"></a><span id="l9.87"> nsresult NS_MsgCreatePathStringFromFolderURI(const char *aFolderURI,</span>
<a href="#l9.88"></a><span id="l9.88">                                              nsCString&amp; aPathCString,</span>
<a href="#l9.89"></a><span id="l9.89">                                              const nsCString &amp;aScheme,</span>
<a href="#l9.90"></a><span id="l9.90">                                              PRBool aIsNewsFolder)</span>
<a href="#l9.91"></a><span id="l9.91"> {</span>
<a href="#l9.92"></a><span id="l9.92">   // A file name has to be in native charset. Here we convert</span>
<a href="#l9.93"></a><span id="l9.93">   // to UTF-16 and check for 'unsafe' characters before converting</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -87,16 +87,19 @@ NS_MSG_BASE nsresult NS_MsgGetPriorityVa</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> NS_MSG_BASE nsresult NS_MsgGetUntranslatedPriorityName(</span>
<a href="#l10.6"></a><span id="l10.6">                        const nsMsgPriorityValue p,</span>
<a href="#l10.7"></a><span id="l10.7">                        nsACString &amp; outName);</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> NS_MSG_BASE nsresult NS_MsgHashIfNecessary(nsAutoString &amp;name);</span>
<a href="#l10.10"></a><span id="l10.10"> NS_MSG_BASE nsresult NS_MsgHashIfNecessary(nsCAutoString &amp;name);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+NS_MSG_BASE nsresult FormatFileSize(PRUint64 size, PRBool useKB, nsAString &amp;formattedSize);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+</span>
<a href="#l10.15"></a><span id="l10.15"> /**</span>
<a href="#l10.16"></a><span id="l10.16">  * given a folder uri, return the path to folder in the user profile directory.</span>
<a href="#l10.17"></a><span id="l10.17">  *</span>
<a href="#l10.18"></a><span id="l10.18">  * @param aFolderURI uri of folder we want the path to, without the scheme</span>
<a href="#l10.19"></a><span id="l10.19">  * @param[out] aPathString result path string</span>
<a href="#l10.20"></a><span id="l10.20">  * @param aScheme scheme of the uri</span>
<a href="#l10.21"></a><span id="l10.21">  * @param[optional] aIsNewsFolder is this a news folder?</span>
<a href="#l10.22"></a><span id="l10.22">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -393,20 +393,22 @@ confirmResetJunkTrainingText=Are you sur</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> # for the virtual folder list dialog title</span>
<a href="#l11.6"></a><span id="l11.6"> # %S is the name of the saved search folder</span>
<a href="#l11.7"></a><span id="l11.7"> editVirtualFolderPropertiesTitle=Edit Saved Search Properties for %S</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> #alert to inform the user to choose one or more folders to search for a saved search folder</span>
<a href="#l11.10"></a><span id="l11.10"> alertNoSearchFoldersSelected=You must choose at least one folder to search for the saved search folder.</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-# These two are displayed in the message and folder pane windows</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-# LOCALIZATION NOTE(????ByteAbbreviation): Do not translate %d below, it is the size of the message/folder</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-kiloByteAbbreviation=%dKB</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-megaByteAbbreviation=%dMB</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+# These are displayed in the message and folder pane windows</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+# LOCALIZATION NOTE %.*f is the abbreviated size in the appropriate units</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+byteAbbreviation2=%.*f bytes</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+kiloByteAbbreviation2=%.*f KB</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+megaByteAbbreviation2=%.*f MB</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+gigaByteAbbreviation2=%.*f GB</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23"> # Error message if message for a message id wasn't found</span>
<a href="#l11.24"></a><span id="l11.24"> errorOpenMessageForMessageIdTitle=Error opening message-id</span>
<a href="#l11.25"></a><span id="l11.25"> errorOpenMessageForMessageIdMessage=Message for message-id %S not found</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> # Warnings to alert users about phishing urls</span>
<a href="#l11.28"></a><span id="l11.28"> confirmPhishingTitle=Email Scam Alert</span>
<a href="#l11.29"></a><span id="l11.29"> #LOCALIZATION NOTE %1$S is the brand name, %2$S is the host name of the url being visited</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

