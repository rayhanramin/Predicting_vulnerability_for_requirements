<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18921:ff1c31aa974c1258071b523e748fdc3a1b685c4f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ff1c31aa974c1258071b523e748fdc3a1b685c4f" />
<meta property="og:url" content="/comm-central/rev/ff1c31aa974c1258071b523e748fdc3a1b685c4f" />
<meta property="og:description" content="Bug 1244758 - Rename nsAutoTArray to AutoTArray following bug 1235261. rs=bustage-fix on CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ff1c31aa974c1258071b523e748fdc3a1b685c4f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ff1c31aa974c1258071b523e748fdc3a1b685c4f">shortlog</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ff1c31aa974c1258071b523e748fdc3a1b685c4f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f">files</a> |
changeset |
<a href="/comm-central/raw-rev/ff1c31aa974c1258071b523e748fdc3a1b685c4f">raw</a>  | <a href="/comm-central/archive/ff1c31aa974c1258071b523e748fdc3a1b685c4f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1244758">Bug 1244758</a> - Rename nsAutoTArray to AutoTArray following <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1235261">bug 1235261</a>. rs=bustage-fix on CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#32;&#67;&#104;&#101;&#101;&#32;&#60;&#112;&#104;&#105;&#108;&#105;&#112;&#46;&#99;&#104;&#101;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 01 Feb 2016 08:38:00 +0100</td></tr>

<tr>
 <td>changeset 18921</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ff1c31aa974c1258071b523e748fdc3a1b685c4f">ff1c31aa974c1258071b523e748fdc3a1b685c4f</a></td>
</tr>



<tr>
<td>parent 18920</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/de29414d264853d08ced88a2b416107b18b31607">de29414d264853d08ced88a2b416107b18b31607</a>
</td>
</tr>

<tr>
<td>child 18922</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c86d69003d74a01dfdaeba85b6ee5c104dcbba5f">c86d69003d74a01dfdaeba85b6ee5c104dcbba5f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ff1c31aa974c1258071b523e748fdc3a1b685c4f">11602</a></td></tr>
<tr><td>push user</td><td>aleth@instantbird.org</td></tr>
<tr><td>push date</td><td class="date age">Wed, 03 Feb 2016 13:28:59 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ff1c31aa974c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ff1c31aa974c1258071b523e748fdc3a1b685c4f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&newProject=comm-central&newRevision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&newProject=comm-central&newRevision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&newProject=comm-central&newRevision=ff1c31aa974c1258071b523e748fdc3a1b685c4f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1244758">1244758</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1235261">1235261</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1244758">Bug 1244758</a> - Rename nsAutoTArray to AutoTArray following <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1235261">bug 1235261</a>. rs=bustage-fix on CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgGroupView.cpp">mailnews/base/src/nsMsgGroupView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgGroupView.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgGroupView.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgGroupView.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgGroupView.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgGroupView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgThreadedDBView.cpp">mailnews/base/src/nsMsgThreadedDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgThreadedDBView.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgThreadedDBView.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgThreadedDBView.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgThreadedDBView.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/base/src/nsMsgThreadedDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/db/msgdb/public/nsMsgDatabase.h">mailnews/db/msgdb/public/nsMsgDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/db/msgdb/public/nsMsgDatabase.h">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/db/msgdb/public/nsMsgDatabase.h">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/db/msgdb/public/nsMsgDatabase.h">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/db/msgdb/public/nsMsgDatabase.h">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/db/msgdb/public/nsMsgDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mapi/mapihook/src/msgMapiImp.cpp">mailnews/mapi/mapihook/src/msgMapiImp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mapi/mapihook/src/msgMapiImp.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mapi/mapihook/src/msgMapiImp.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mapi/mapihook/src/msgMapiImp.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mapi/mapihook/src/msgMapiImp.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mapi/mapihook/src/msgMapiImp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/public/MimeHeaderParser.h">mailnews/mime/public/MimeHeaderParser.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/public/MimeHeaderParser.h">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/public/MimeHeaderParser.h">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/public/MimeHeaderParser.h">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/public/MimeHeaderParser.h">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/public/MimeHeaderParser.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/src/MimeHeaderParser.cpp">mailnews/mime/src/MimeHeaderParser.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/src/MimeHeaderParser.cpp">file</a> |
<a href="/comm-central/annotate/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/src/MimeHeaderParser.cpp">annotate</a> |
<a href="/comm-central/diff/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/src/MimeHeaderParser.cpp">diff</a> |
<a href="/comm-central/comparison/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/src/MimeHeaderParser.cpp">comparison</a> |
<a href="/comm-central/log/ff1c31aa974c1258071b523e748fdc3a1b685c4f/mailnews/mime/src/MimeHeaderParser.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -205,17 +205,17 @@ NS_IMETHODIMP nsAddrDatabase::NotifyAnno</span>
<a href="#l1.4"></a><span id="l1.4"> // why it isn't but its not, so don't think about making it a static variable.</span>
<a href="#l1.5"></a><span id="l1.5"> // Maybe bz knows.</span>
<a href="#l1.6"></a><span id="l1.6"> nsTArray&lt;nsAddrDatabase*&gt;* nsAddrDatabase::m_dbCache = nullptr;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> nsTArray&lt;nsAddrDatabase*&gt;*</span>
<a href="#l1.9"></a><span id="l1.9"> nsAddrDatabase::GetDBCache()</span>
<a href="#l1.10"></a><span id="l1.10"> {</span>
<a href="#l1.11"></a><span id="l1.11">   if (!m_dbCache)</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    m_dbCache = new nsAutoTArray&lt;nsAddrDatabase*, kInitialAddrDBCacheSize&gt;;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    m_dbCache = new AutoTArray&lt;nsAddrDatabase*, kInitialAddrDBCacheSize&gt;;</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">   return m_dbCache;</span>
<a href="#l1.16"></a><span id="l1.16"> }</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> void</span>
<a href="#l1.19"></a><span id="l1.19"> nsAddrDatabase::CleanupCache()</span>
<a href="#l1.20"></a><span id="l1.20"> {</span>
<a href="#l1.21"></a><span id="l1.21">   if (m_dbCache)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -7750,22 +7750,22 @@ NS_IMETHODIMP nsMsgDBView::SelectMsgByKe</span>
<a href="#l2.4"></a><span id="l2.4">   if (aKey == nsMsgKey_None)</span>
<a href="#l2.5"></a><span id="l2.5">     return NS_OK;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">   // use SaveAndClearSelection()</span>
<a href="#l2.8"></a><span id="l2.8">   // and RestoreSelection() so that we'll clear the current selection</span>
<a href="#l2.9"></a><span id="l2.9">   // but pass in a different key array so that we'll</span>
<a href="#l2.10"></a><span id="l2.10">   // select (and load) the desired message</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  AutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l2.14"></a><span id="l2.14">   nsresult rv = SaveAndClearSelection(nullptr, preservedSelection);</span>
<a href="#l2.15"></a><span id="l2.15">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">   // now, restore our desired selection</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-  nsAutoTArray&lt;nsMsgKey, 1&gt; keyArray;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  AutoTArray&lt;nsMsgKey, 1&gt; keyArray;</span>
<a href="#l2.20"></a><span id="l2.20">   keyArray.AppendElement(aKey);</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22">   // if the key was not found</span>
<a href="#l2.23"></a><span id="l2.23">   // (this can happen with &quot;remember last selected message&quot;)</span>
<a href="#l2.24"></a><span id="l2.24">   // nothing will be selected</span>
<a href="#l2.25"></a><span id="l2.25">   rv = RestoreSelection(aKey, keyArray);</span>
<a href="#l2.26"></a><span id="l2.26">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.27"></a><span id="l2.27">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -30,17 +30,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsTArray.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsTHashtable.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsHashKeys.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsIMsgCustomColumnHandler.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsIWeakReferenceUtils.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-typedef nsAutoTArray&lt;nsMsgViewIndex, 1&gt; nsMsgViewIndexArray;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+typedef AutoTArray&lt;nsMsgViewIndex, 1&gt; nsMsgViewIndexArray;</span>
<a href="#l3.14"></a><span id="l3.14"> static_assert(nsMsgViewIndex(nsMsgViewIndexArray::NoIndex) ==</span>
<a href="#l3.15"></a><span id="l3.15">   nsMsgViewIndex_None, &quot;These need to be the same value.&quot;);</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> enum eFieldType {</span>
<a href="#l3.18"></a><span id="l3.18">     kCollationKey,</span>
<a href="#l3.19"></a><span id="l3.19">     kU32</span>
<a href="#l3.20"></a><span id="l3.20"> };</span>
<a href="#l3.21"></a><span id="l3.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -495,17 +495,17 @@ nsMsgGroupView::CopyDBView(nsMsgDBView *</span>
<a href="#l4.4"></a><span id="l4.4"> // view flags to OpenWithHdrs.</span>
<a href="#l4.5"></a><span id="l4.5"> nsresult nsMsgGroupView::RebuildView(nsMsgViewFlagsTypeValue newFlags)</span>
<a href="#l4.6"></a><span id="l4.6"> {</span>
<a href="#l4.7"></a><span id="l4.7">   nsCOMPtr &lt;nsISimpleEnumerator&gt; headers;</span>
<a href="#l4.8"></a><span id="l4.8">   if (NS_SUCCEEDED(GetMessageEnumerator(getter_AddRefs(headers))))</span>
<a href="#l4.9"></a><span id="l4.9">   {</span>
<a href="#l4.10"></a><span id="l4.10">     int32_t count;</span>
<a href="#l4.11"></a><span id="l4.11">     m_dayChanged = false;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    AutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l4.14"></a><span id="l4.14">     nsMsgKey curSelectedKey;</span>
<a href="#l4.15"></a><span id="l4.15">     SaveAndClearSelection(&amp;curSelectedKey, preservedSelection);</span>
<a href="#l4.16"></a><span id="l4.16">     InternalClose();</span>
<a href="#l4.17"></a><span id="l4.17">     int32_t oldSize = GetSize();</span>
<a href="#l4.18"></a><span id="l4.18">     // this is important, because the tree will ask us for our</span>
<a href="#l4.19"></a><span id="l4.19">     // row count, which get determine from the number of keys.</span>
<a href="#l4.20"></a><span id="l4.20">     m_keys.Clear();</span>
<a href="#l4.21"></a><span id="l4.21">     // be consistent</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -519,17 +519,17 @@ nsresult nsMsgGroupView::RebuildView(nsM</span>
<a href="#l4.23"></a><span id="l4.23">     nsresult rv = OpenWithHdrs(headers, m_sortType, m_sortOrder, newFlags, &amp;count);</span>
<a href="#l4.24"></a><span id="l4.24">     SetSuppressChangeNotifications(false);</span>
<a href="#l4.25"></a><span id="l4.25">     if (mTree)</span>
<a href="#l4.26"></a><span id="l4.26">       mTree-&gt;RowCountChanged(0, GetSize());</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">     // now, restore our desired selection</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    nsAutoTArray&lt;nsMsgKey, 1&gt; keyArray;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    AutoTArray&lt;nsMsgKey, 1&gt; keyArray;</span>
<a href="#l4.33"></a><span id="l4.33">     keyArray.AppendElement(curSelectedKey);</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">     return RestoreSelection(curSelectedKey, keyArray);</span>
<a href="#l4.36"></a><span id="l4.36">   }</span>
<a href="#l4.37"></a><span id="l4.37">   return NS_OK;</span>
<a href="#l4.38"></a><span id="l4.38"> }</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40"> nsresult nsMsgGroupView::OnNewHeader(nsIMsgDBHdr *newHdr, nsMsgKey aParentKey, bool ensureListed)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -537,17 +537,17 @@ void nsMsgSearchDBView::MoveThreadAt(nsM</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   nsCOMPtr&lt;nsIMsgDBHdr&gt; threadHdr;</span>
<a href="#l5.6"></a><span id="l5.6">   GetMsgHdrForViewIndex(threadIndex, getter_AddRefs(threadHdr));</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">   uint32_t saveFlags = m_flags[threadIndex];</span>
<a href="#l5.9"></a><span id="l5.9">   bool threadIsExpanded = !(saveFlags &amp; nsMsgMessageFlags::Elided);</span>
<a href="#l5.10"></a><span id="l5.10">   int32_t childCount = 0;</span>
<a href="#l5.11"></a><span id="l5.11">   nsMsgKey preservedKey;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  AutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l5.14"></a><span id="l5.14">   int32_t selectionCount;</span>
<a href="#l5.15"></a><span id="l5.15">   int32_t currentIndex;</span>
<a href="#l5.16"></a><span id="l5.16">   bool hasSelection = mTree &amp;&amp; mTreeSelection &amp;&amp;</span>
<a href="#l5.17"></a><span id="l5.17">                         ((NS_SUCCEEDED(mTreeSelection-&gt;GetCurrentIndex(&amp;currentIndex)) &amp;&amp;</span>
<a href="#l5.18"></a><span id="l5.18">                          currentIndex &gt;= 0 &amp;&amp; (uint32_t)currentIndex &lt; GetSize()) ||</span>
<a href="#l5.19"></a><span id="l5.19">                          (NS_SUCCEEDED(mTreeSelection-&gt;GetRangeCount(&amp;selectionCount)) &amp;&amp;</span>
<a href="#l5.20"></a><span id="l5.20">                           selectionCount &gt; 0));</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -1097,17 +1097,17 @@ NS_IMETHODIMP nsMsgSearchDBView::Sort(ns</span>
<a href="#l5.23"></a><span id="l5.23">       // ### This forgets which threads were expanded, and is sub-optimal</span>
<a href="#l5.24"></a><span id="l5.24">       // since it rebuilds the thread objects.  </span>
<a href="#l5.25"></a><span id="l5.25">       m_sortType = sortType;</span>
<a href="#l5.26"></a><span id="l5.26">       m_sortOrder = sortOrder;</span>
<a href="#l5.27"></a><span id="l5.27">       return RebuildView(m_viewFlags);</span>
<a href="#l5.28"></a><span id="l5.28">     }</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30">     nsMsgKey preservedKey;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+    AutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l5.33"></a><span id="l5.33">     SaveAndClearSelection(&amp;preservedKey, preservedSelection);</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">     nsresult rv = nsMsgDBView::Sort(sortType,sortOrder);</span>
<a href="#l5.36"></a><span id="l5.36">     // the sort may have changed the number of rows</span>
<a href="#l5.37"></a><span id="l5.37">     // before we restore the selection, tell the tree</span>
<a href="#l5.38"></a><span id="l5.38">     // do this before we call restore selection</span>
<a href="#l5.39"></a><span id="l5.39">     // this is safe when there is no selection. </span>
<a href="#l5.40"></a><span id="l5.40">     rv = AdjustRowCount(rowCountBeforeSort, GetSize());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgThreadedDBView.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgThreadedDBView.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -271,17 +271,17 @@ NS_IMETHODIMP nsMsgThreadedDBView::Sort(</span>
<a href="#l6.4"></a><span id="l6.4">   // sort threads by sort order</span>
<a href="#l6.5"></a><span id="l6.5">   bool sortThreads = m_viewFlags &amp; (nsMsgViewFlagsType::kThreadedDisplay | nsMsgViewFlagsType::kGroupBySort);</span>
<a href="#l6.6"></a><span id="l6.6">   </span>
<a href="#l6.7"></a><span id="l6.7">   // if sort type is by thread, and we're already threaded, change sort type to byId</span>
<a href="#l6.8"></a><span id="l6.8">   if (sortType == nsMsgViewSortType::byThread &amp;&amp; (m_viewFlags &amp; nsMsgViewFlagsType::kThreadedDisplay) != 0)</span>
<a href="#l6.9"></a><span id="l6.9">     sortType = nsMsgViewSortType::byId;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">   nsMsgKey preservedKey;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  AutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l6.14"></a><span id="l6.14">   SaveAndClearSelection(&amp;preservedKey, preservedSelection);</span>
<a href="#l6.15"></a><span id="l6.15">   // if the client wants us to forget our cached id arrays, they</span>
<a href="#l6.16"></a><span id="l6.16">   // should build a new view. If this isn't good enough, we</span>
<a href="#l6.17"></a><span id="l6.17">   // need a method to do that.</span>
<a href="#l6.18"></a><span id="l6.18">   if (sortType != m_sortType || !m_sortValid || sortThreads)</span>
<a href="#l6.19"></a><span id="l6.19">   {</span>
<a href="#l6.20"></a><span id="l6.20">     SaveSortInfo(sortType, sortOrder);</span>
<a href="#l6.21"></a><span id="l6.21">     if (sortType == nsMsgViewSortType::byThread)  </span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -734,17 +734,17 @@ void nsMsgThreadedDBView::MoveThreadAt(n</span>
<a href="#l6.23"></a><span id="l6.23">     SetSuppressChangeNotifications(true);</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25">   nsCOMPtr &lt;nsIMsgDBHdr&gt; threadHdr;</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">   GetMsgHdrForViewIndex(threadIndex, getter_AddRefs(threadHdr));</span>
<a href="#l6.28"></a><span id="l6.28">   int32_t childCount = 0;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   nsMsgKey preservedKey;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  AutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l6.33"></a><span id="l6.33">   int32_t selectionCount;</span>
<a href="#l6.34"></a><span id="l6.34">   int32_t currentIndex;</span>
<a href="#l6.35"></a><span id="l6.35">   bool hasSelection = mTree &amp;&amp; mTreeSelection &amp;&amp;</span>
<a href="#l6.36"></a><span id="l6.36">                         ((NS_SUCCEEDED(mTreeSelection-&gt;GetCurrentIndex(&amp;currentIndex)) &amp;&amp;</span>
<a href="#l6.37"></a><span id="l6.37">                          currentIndex &gt;= 0 &amp;&amp; (uint32_t)currentIndex &lt; GetSize()) ||</span>
<a href="#l6.38"></a><span id="l6.38">                          (NS_SUCCEEDED(mTreeSelection-&gt;GetRangeCount(&amp;selectionCount)) &amp;&amp;</span>
<a href="#l6.39"></a><span id="l6.39">                           selectionCount &gt; 0));</span>
<a href="#l6.40"></a><span id="l6.40">   if (hasSelection)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsMsgDatabase.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsMsgDatabase.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -63,17 +63,17 @@ public:</span>
<a href="#l7.4"></a><span id="l7.4"> protected:</span>
<a href="#l7.5"></a><span id="l7.5">   ~nsMsgDBService();</span>
<a href="#l7.6"></a><span id="l7.6">   void HookupPendingListeners(nsIMsgDatabase *db, nsIMsgFolder *folder);</span>
<a href="#l7.7"></a><span id="l7.7">   void FinishDBOpen(nsIMsgFolder *aFolder, nsMsgDatabase *aMsgDB);</span>
<a href="#l7.8"></a><span id="l7.8">   nsMsgDatabase* FindInCache(nsIFile *dbName);</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">   nsCOMArray &lt;nsIMsgFolder&gt; m_foldersPendingListeners;</span>
<a href="#l7.11"></a><span id="l7.11">   nsCOMArray &lt;nsIDBChangeListener&gt; m_pendingListeners;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  nsAutoTArray&lt;nsMsgDatabase*, kInitialMsgDBCacheSize&gt; m_dbCache;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  AutoTArray&lt;nsMsgDatabase*, kInitialMsgDBCacheSize&gt; m_dbCache;</span>
<a href="#l7.14"></a><span id="l7.14"> };</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16"> class nsMsgDBEnumerator : public nsISimpleEnumerator {</span>
<a href="#l7.17"></a><span id="l7.17"> public:</span>
<a href="#l7.18"></a><span id="l7.18">     NS_DECL_ISUPPORTS</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">     // nsISimpleEnumerator methods:</span>
<a href="#l7.21"></a><span id="l7.21">     NS_DECL_NSISIMPLEENUMERATOR</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1397,30 +1397,30 @@ void nsBayesianFilter::classifyMessage(</span>
<a href="#l8.4"></a><span id="l8.4">       NS_ERROR(&quot;Each Pro trait needs a matching Anti trait&quot;);</span>
<a href="#l8.5"></a><span id="l8.5">       return;</span>
<a href="#l8.6"></a><span id="l8.6">     }</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">     /* this part is similar to the Graham algorithm with some adjustments. */</span>
<a href="#l8.9"></a><span id="l8.9">     uint32_t traitCount = aProTraits.Length();</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">     // pro message counts per trait index</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; numProMessages;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; numProMessages;</span>
<a href="#l8.14"></a><span id="l8.14">     // anti message counts per trait index</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-    nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; numAntiMessages;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; numAntiMessages;</span>
<a href="#l8.17"></a><span id="l8.17">     // array of pro aliases per trait index</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-    nsAutoTArray&lt;uint32_t*, kTraitAutoCapacity &gt; proAliasArrays;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+    AutoTArray&lt;uint32_t*, kTraitAutoCapacity &gt; proAliasArrays;</span>
<a href="#l8.20"></a><span id="l8.20">     // number of pro aliases per trait index</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-    nsAutoTArray&lt;uint32_t, kTraitAutoCapacity &gt; proAliasesLengths;    </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+    AutoTArray&lt;uint32_t, kTraitAutoCapacity &gt; proAliasesLengths;    </span>
<a href="#l8.23"></a><span id="l8.23">     // array of anti aliases per trait index</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-    nsAutoTArray&lt;uint32_t*, kTraitAutoCapacity&gt; antiAliasArrays;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+    AutoTArray&lt;uint32_t*, kTraitAutoCapacity&gt; antiAliasArrays;</span>
<a href="#l8.26"></a><span id="l8.26">     // number of anti aliases per trait index</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-    nsAutoTArray&lt;uint32_t, kTraitAutoCapacity &gt; antiAliasesLengths;    </span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+    AutoTArray&lt;uint32_t, kTraitAutoCapacity &gt; antiAliasesLengths;    </span>
<a href="#l8.29"></a><span id="l8.29">     // construct the outgoing listener arrays</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-    nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; traits;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; percents;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; traits;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+    AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; percents;</span>
<a href="#l8.34"></a><span id="l8.34">     if (traitCount &gt; kTraitAutoCapacity)</span>
<a href="#l8.35"></a><span id="l8.35">     {</span>
<a href="#l8.36"></a><span id="l8.36">       traits.SetCapacity(traitCount);</span>
<a href="#l8.37"></a><span id="l8.37">       percents.SetCapacity(traitCount);</span>
<a href="#l8.38"></a><span id="l8.38">       numProMessages.SetCapacity(traitCount);</span>
<a href="#l8.39"></a><span id="l8.39">       numAntiMessages.SetCapacity(traitCount);</span>
<a href="#l8.40"></a><span id="l8.40">       proAliasesLengths.SetCapacity(traitCount);</span>
<a href="#l8.41"></a><span id="l8.41">       antiAliasesLengths.SetCapacity(traitCount);</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineat">@@ -1529,17 +1529,17 @@ void nsBayesianFilter::classifyMessage(</span>
<a href="#l8.43"></a><span id="l8.43">           mozilla::DebugOnly&lt;nsresult&gt; rv = setAnalysis(token, traitIndex, distance, prob);</span>
<a href="#l8.44"></a><span id="l8.44">           NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Problem in setAnalysis&quot;);</span>
<a href="#l8.45"></a><span id="l8.45">         }</span>
<a href="#l8.46"></a><span id="l8.46">       }</span>
<a href="#l8.47"></a><span id="l8.47">     }</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49">     for (uint32_t traitIndex = 0; traitIndex &lt; traitCount; traitIndex++)</span>
<a href="#l8.50"></a><span id="l8.50">     {</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-      nsAutoTArray&lt;TraitAnalysis, 1024&gt; traitAnalyses;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+      AutoTArray&lt;TraitAnalysis, 1024&gt; traitAnalyses;</span>
<a href="#l8.53"></a><span id="l8.53">       // copy valid tokens into an array to sort</span>
<a href="#l8.54"></a><span id="l8.54">       for (uint32_t tokenIndex = 0; tokenIndex &lt; tokenCount; tokenIndex++)</span>
<a href="#l8.55"></a><span id="l8.55">       {</span>
<a href="#l8.56"></a><span id="l8.56">         uint32_t storeIndex = getAnalysisIndex(tokens[tokenIndex], traitIndex);</span>
<a href="#l8.57"></a><span id="l8.57">         if (storeIndex)</span>
<a href="#l8.58"></a><span id="l8.58">         {</span>
<a href="#l8.59"></a><span id="l8.59">           TraitAnalysis ta =</span>
<a href="#l8.60"></a><span id="l8.60">             {tokenIndex,</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineat">@@ -1716,18 +1716,18 @@ void nsBayesianFilter::classifyMessage(</span>
<a href="#l8.62"></a><span id="l8.62">     mAnalysisStore.Compact();</span>
<a href="#l8.63"></a><span id="l8.63"> }</span>
<a href="#l8.64"></a><span id="l8.64"> </span>
<a href="#l8.65"></a><span id="l8.65"> void nsBayesianFilter::classifyMessage(</span>
<a href="#l8.66"></a><span id="l8.66">   Tokenizer&amp; tokens,</span>
<a href="#l8.67"></a><span id="l8.67">   const char* messageURI,</span>
<a href="#l8.68"></a><span id="l8.68">   nsIJunkMailClassificationListener* aJunkListener)</span>
<a href="#l8.69"></a><span id="l8.69"> {</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-  nsAutoTArray&lt;uint32_t, 1&gt; proTraits;</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  nsAutoTArray&lt;uint32_t, 1&gt; antiTraits;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  AutoTArray&lt;uint32_t, 1&gt; proTraits;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+  AutoTArray&lt;uint32_t, 1&gt; antiTraits;</span>
<a href="#l8.74"></a><span id="l8.74">   proTraits.AppendElement(kJunkTrait);</span>
<a href="#l8.75"></a><span id="l8.75">   antiTraits.AppendElement(kGoodTrait);</span>
<a href="#l8.76"></a><span id="l8.76">   classifyMessage(tokens, messageURI, proTraits, antiTraits,</span>
<a href="#l8.77"></a><span id="l8.77">     aJunkListener, nullptr, nullptr);</span>
<a href="#l8.78"></a><span id="l8.78"> }</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80"> NS_IMETHODIMP</span>
<a href="#l8.81"></a><span id="l8.81"> nsBayesianFilter::Observe(nsISupports *aSubject, const char *aTopic,</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineat">@@ -1860,18 +1860,18 @@ NS_IMETHODIMP nsBayesianFilter::Classify</span>
<a href="#l8.83"></a><span id="l8.83">   const char **aMsgURIs,</span>
<a href="#l8.84"></a><span id="l8.84">   uint32_t aTraitCount,</span>
<a href="#l8.85"></a><span id="l8.85">   uint32_t *aProTraits,</span>
<a href="#l8.86"></a><span id="l8.86">   uint32_t *aAntiTraits,</span>
<a href="#l8.87"></a><span id="l8.87">   nsIMsgTraitClassificationListener *aTraitListener,</span>
<a href="#l8.88"></a><span id="l8.88">   nsIMsgWindow *aMsgWindow,</span>
<a href="#l8.89"></a><span id="l8.89">   nsIJunkMailClassificationListener *aJunkListener)</span>
<a href="#l8.90"></a><span id="l8.90"> {</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-  nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; proTraits;</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-  nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; antiTraits;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+  AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; proTraits;</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+  AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; antiTraits;</span>
<a href="#l8.95"></a><span id="l8.95">   if (aTraitCount &gt; kTraitAutoCapacity)</span>
<a href="#l8.96"></a><span id="l8.96">   {</span>
<a href="#l8.97"></a><span id="l8.97">     proTraits.SetCapacity(aTraitCount);</span>
<a href="#l8.98"></a><span id="l8.98">     antiTraits.SetCapacity(aTraitCount);</span>
<a href="#l8.99"></a><span id="l8.99">   }</span>
<a href="#l8.100"></a><span id="l8.100">   proTraits.AppendElements(aProTraits, aTraitCount);</span>
<a href="#l8.101"></a><span id="l8.101">   antiTraits.AppendElements(aAntiTraits, aTraitCount);</span>
<a href="#l8.102"></a><span id="l8.102"> </span>
<a href="#l8.103"></a><span id="l8.103" class="difflineat">@@ -1922,18 +1922,18 @@ NS_IMETHODIMP nsBayesianFilter::SetMsgTr</span>
<a href="#l8.104"></a><span id="l8.104">     uint32_t aOldCount,</span>
<a href="#l8.105"></a><span id="l8.105">     uint32_t *aOldTraits,</span>
<a href="#l8.106"></a><span id="l8.106">     uint32_t aNewCount,</span>
<a href="#l8.107"></a><span id="l8.107">     uint32_t *aNewTraits,</span>
<a href="#l8.108"></a><span id="l8.108">     nsIMsgTraitClassificationListener *aTraitListener,</span>
<a href="#l8.109"></a><span id="l8.109">     nsIMsgWindow *aMsgWindow,</span>
<a href="#l8.110"></a><span id="l8.110">     nsIJunkMailClassificationListener *aJunkListener)</span>
<a href="#l8.111"></a><span id="l8.111"> {</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-  nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; oldTraits;</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-  nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; newTraits;</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+  AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; oldTraits;</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+  AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; newTraits;</span>
<a href="#l8.116"></a><span id="l8.116">   if (aOldCount &gt; kTraitAutoCapacity)</span>
<a href="#l8.117"></a><span id="l8.117">     oldTraits.SetCapacity(aOldCount);</span>
<a href="#l8.118"></a><span id="l8.118">   if (aNewCount &gt; kTraitAutoCapacity)</span>
<a href="#l8.119"></a><span id="l8.119">     newTraits.SetCapacity(aNewCount);</span>
<a href="#l8.120"></a><span id="l8.120">   oldTraits.AppendElements(aOldTraits, aOldCount);</span>
<a href="#l8.121"></a><span id="l8.121">   newTraits.AppendElements(aNewTraits, aNewCount);</span>
<a href="#l8.122"></a><span id="l8.122"> </span>
<a href="#l8.123"></a><span id="l8.123">   MessageObserver* analyzer = new MessageObserver(this, oldTraits,</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineat">@@ -2009,18 +2009,18 @@ void nsBayesianFilter::observeMessage(</span>
<a href="#l8.125"></a><span id="l8.125">     }</span>
<a href="#l8.126"></a><span id="l8.126"> </span>
<a href="#l8.127"></a><span id="l8.127">     if (aJunkListener)</span>
<a href="#l8.128"></a><span id="l8.128">       aJunkListener-&gt;OnMessageClassified(messageURL, newClassification, junkPercent);</span>
<a href="#l8.129"></a><span id="l8.129"> </span>
<a href="#l8.130"></a><span id="l8.130">     if (aTraitListener)</span>
<a href="#l8.131"></a><span id="l8.131">     {</span>
<a href="#l8.132"></a><span id="l8.132">       // construct the outgoing listener arrays</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-      nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; traits;</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineminus">-      nsAutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; percents;</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineplus">+      AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; traits;</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineplus">+      AutoTArray&lt;uint32_t, kTraitAutoCapacity&gt; percents;</span>
<a href="#l8.137"></a><span id="l8.137">       uint32_t newLength = newClassifications.Length();</span>
<a href="#l8.138"></a><span id="l8.138">       if (newLength &gt; kTraitAutoCapacity)</span>
<a href="#l8.139"></a><span id="l8.139">       {</span>
<a href="#l8.140"></a><span id="l8.140">         traits.SetCapacity(newLength);</span>
<a href="#l8.141"></a><span id="l8.141">         percents.SetCapacity(newLength);</span>
<a href="#l8.142"></a><span id="l8.142">       }</span>
<a href="#l8.143"></a><span id="l8.143">       traits.AppendElements(newClassifications);</span>
<a href="#l8.144"></a><span id="l8.144">       for (uint32_t index = 0; index &lt; newLength; index++)</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineat">@@ -2051,18 +2051,18 @@ NS_IMETHODIMP nsBayesianFilter::GetUserH</span>
<a href="#l8.146"></a><span id="l8.146"> // Set message classification (only allows junk and good)</span>
<a href="#l8.147"></a><span id="l8.147"> NS_IMETHODIMP nsBayesianFilter::SetMessageClassification(</span>
<a href="#l8.148"></a><span id="l8.148">     const char *aMsgURL,</span>
<a href="#l8.149"></a><span id="l8.149">     nsMsgJunkStatus aOldClassification,</span>
<a href="#l8.150"></a><span id="l8.150">     nsMsgJunkStatus aNewClassification,</span>
<a href="#l8.151"></a><span id="l8.151">     nsIMsgWindow *aMsgWindow,</span>
<a href="#l8.152"></a><span id="l8.152">     nsIJunkMailClassificationListener *aListener)</span>
<a href="#l8.153"></a><span id="l8.153"> {</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineminus">-  nsAutoTArray&lt;uint32_t, 1&gt; oldClassifications;</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineminus">-  nsAutoTArray&lt;uint32_t, 1&gt; newClassifications;</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineplus">+  AutoTArray&lt;uint32_t, 1&gt; oldClassifications;</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+  AutoTArray&lt;uint32_t, 1&gt; newClassifications;</span>
<a href="#l8.158"></a><span id="l8.158"> </span>
<a href="#l8.159"></a><span id="l8.159">   // convert between classifications and trait</span>
<a href="#l8.160"></a><span id="l8.160">   if (aOldClassification == nsIJunkMailPlugin::JUNK)</span>
<a href="#l8.161"></a><span id="l8.161">     oldClassifications.AppendElement(kJunkTrait);</span>
<a href="#l8.162"></a><span id="l8.162">   else if (aOldClassification == nsIJunkMailPlugin::GOOD)</span>
<a href="#l8.163"></a><span id="l8.163">     oldClassifications.AppendElement(kGoodTrait);</span>
<a href="#l8.164"></a><span id="l8.164">   if (aNewClassification == nsIJunkMailPlugin::JUNK)</span>
<a href="#l8.165"></a><span id="l8.165">     newClassifications.AppendElement(kJunkTrait);</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineat">@@ -2084,18 +2084,18 @@ NS_IMETHODIMP nsBayesianFilter::ResetTra</span>
<a href="#l8.167"></a><span id="l8.167"> {</span>
<a href="#l8.168"></a><span id="l8.168">   return mCorpus.resetTrainingData();</span>
<a href="#l8.169"></a><span id="l8.169"> }</span>
<a href="#l8.170"></a><span id="l8.170"> </span>
<a href="#l8.171"></a><span id="l8.171"> NS_IMETHODIMP nsBayesianFilter::DetailMessage(const char *aMsgURI,</span>
<a href="#l8.172"></a><span id="l8.172">     uint32_t aProTrait, uint32_t aAntiTrait,</span>
<a href="#l8.173"></a><span id="l8.173">     nsIMsgTraitDetailListener *aDetailListener, nsIMsgWindow *aMsgWindow)</span>
<a href="#l8.174"></a><span id="l8.174"> {</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineminus">-  nsAutoTArray&lt;uint32_t, 1&gt; proTraits;</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineminus">-  nsAutoTArray&lt;uint32_t, 1&gt; antiTraits;</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineplus">+  AutoTArray&lt;uint32_t, 1&gt; proTraits;</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+  AutoTArray&lt;uint32_t, 1&gt; antiTraits;</span>
<a href="#l8.179"></a><span id="l8.179">   proTraits.AppendElement(aProTrait);</span>
<a href="#l8.180"></a><span id="l8.180">   antiTraits.AppendElement(aAntiTrait);</span>
<a href="#l8.181"></a><span id="l8.181"> </span>
<a href="#l8.182"></a><span id="l8.182">   MessageClassifier* analyzer = new MessageClassifier(this, nullptr,</span>
<a href="#l8.183"></a><span id="l8.183">     nullptr, aDetailListener, proTraits, antiTraits, aMsgWindow, 1, &amp;aMsgURI);</span>
<a href="#l8.184"></a><span id="l8.184">   NS_ENSURE_TRUE(analyzer, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l8.185"></a><span id="l8.185"> </span>
<a href="#l8.186"></a><span id="l8.186">   TokenStreamListener *tokenListener = new TokenStreamListener(analyzer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -840,17 +840,17 @@ MsgMapiListContext::DeleteMessage(nsMsgK</span>
<a href="#l9.4"></a><span id="l9.4">   </span>
<a href="#l9.5"></a><span id="l9.5">   if ( !IsIMAPHost() )</span>
<a href="#l9.6"></a><span id="l9.6">   {</span>
<a href="#l9.7"></a><span id="l9.7">     return NS_SUCCEEDED((m_db-&gt;DeleteMessages(1, &amp;key, nullptr)));</span>
<a href="#l9.8"></a><span id="l9.8">   }</span>
<a href="#l9.9"></a><span id="l9.9"> #if 0 </span>
<a href="#l9.10"></a><span id="l9.10">   else if ( m_folder-&gt;GetIMAPFolderInfoMail() )</span>
<a href="#l9.11"></a><span id="l9.11">   {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    nsAutoTArray&lt;nsMsgKey, 1&gt; messageKeys;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    AutoTArray&lt;nsMsgKey, 1&gt; messageKeys;</span>
<a href="#l9.14"></a><span id="l9.14">     messageKeys.AppendElement(key);</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">     (m_folder-&gt;GetIMAPFolderInfoMail())-&gt;DeleteSpecifiedMessages(pane, messageKeys, nsMsgKey_None);</span>
<a href="#l9.17"></a><span id="l9.17">     m_db-&gt;DeleteMessage(key, nullptr, FALSE);</span>
<a href="#l9.18"></a><span id="l9.18">     return TRUE;</span>
<a href="#l9.19"></a><span id="l9.19">   }</span>
<a href="#l9.20"></a><span id="l9.20"> #endif</span>
<a href="#l9.21"></a><span id="l9.21">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/mime/public/MimeHeaderParser.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/mime/public/MimeHeaderParser.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -48,17 +48,17 @@ class UTF16ArrayAdapter</span>
<a href="#l10.4"></a><span id="l10.4"> {</span>
<a href="#l10.5"></a><span id="l10.5"> public:</span>
<a href="#l10.6"></a><span id="l10.6">   UTF16ArrayAdapter(nsTArray&lt;nsCString&gt; &amp;aUTF8Array)</span>
<a href="#l10.7"></a><span id="l10.7">   : mUTF8Array(aUTF8Array) {}</span>
<a href="#l10.8"></a><span id="l10.8">   ~UTF16ArrayAdapter() { detail::DoConversion(mUTF16Array, mUTF8Array); }</span>
<a href="#l10.9"></a><span id="l10.9">   operator nsTArray&lt;nsString&gt;&amp;() { return mUTF16Array; }</span>
<a href="#l10.10"></a><span id="l10.10"> private:</span>
<a href="#l10.11"></a><span id="l10.11">   nsTArray&lt;nsCString&gt; &amp;mUTF8Array;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  nsAutoTArray&lt;nsString, N&gt; mUTF16Array;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  AutoTArray&lt;nsString, N&gt; mUTF16Array;</span>
<a href="#l10.14"></a><span id="l10.14"> };</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> /**</span>
<a href="#l10.17"></a><span id="l10.17">  * Given a name and an email, both encoded in UTF-8, produce a string suitable</span>
<a href="#l10.18"></a><span id="l10.18">  * for writing in an email header by quoting where necessary.</span>
<a href="#l10.19"></a><span id="l10.19">  *</span>
<a href="#l10.20"></a><span id="l10.20">  * If name is not empty, the output string will be name &lt;email&gt;. If it is empty,</span>
<a href="#l10.21"></a><span id="l10.21">  * the output string is just the email. Note that this DOES NOT do any RFC 2047</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/mime/src/MimeHeaderParser.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/mime/src/MimeHeaderParser.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -150,47 +150,47 @@ void ExtractEmails(const nsCOMArray&lt;msgI</span>
<a href="#l11.4"></a><span id="l11.4"> {</span>
<a href="#l11.5"></a><span id="l11.5">   nsTArray&lt;nsString&gt; names;</span>
<a href="#l11.6"></a><span id="l11.6">   ExtractAllAddresses(aHeader, names, emails);</span>
<a href="#l11.7"></a><span id="l11.7"> }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> void ExtractEmail(const nsCOMArray&lt;msgIAddressObject&gt; &amp;aHeader,</span>
<a href="#l11.10"></a><span id="l11.10">                   nsACString &amp;email)</span>
<a href="#l11.11"></a><span id="l11.11"> {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  nsAutoTArray&lt;nsString, 1&gt; names;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  nsAutoTArray&lt;nsString, 1&gt; emails;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; names;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; emails;</span>
<a href="#l11.16"></a><span id="l11.16">   ExtractAllAddresses(aHeader, names, emails);</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">   if (emails.Length() &gt; 0)</span>
<a href="#l11.19"></a><span id="l11.19">     CopyUTF16toUTF8(emails[0], email);</span>
<a href="#l11.20"></a><span id="l11.20">   else</span>
<a href="#l11.21"></a><span id="l11.21">     email.Truncate();</span>
<a href="#l11.22"></a><span id="l11.22"> }</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24"> void ExtractFirstAddress(const nsCOMArray&lt;msgIAddressObject&gt; &amp;aHeader,</span>
<a href="#l11.25"></a><span id="l11.25">                          nsACString &amp;name, nsACString &amp;email)</span>
<a href="#l11.26"></a><span id="l11.26"> {</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-  nsAutoTArray&lt;nsString, 1&gt; names, emails;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; names, emails;</span>
<a href="#l11.29"></a><span id="l11.29">   ExtractAllAddresses(aHeader, names, emails);</span>
<a href="#l11.30"></a><span id="l11.30">   if (names.Length() &gt; 0)</span>
<a href="#l11.31"></a><span id="l11.31">   {</span>
<a href="#l11.32"></a><span id="l11.32">     CopyUTF16toUTF8(names[0], name);</span>
<a href="#l11.33"></a><span id="l11.33">     CopyUTF16toUTF8(emails[0], email);</span>
<a href="#l11.34"></a><span id="l11.34">   }</span>
<a href="#l11.35"></a><span id="l11.35">   else</span>
<a href="#l11.36"></a><span id="l11.36">   {</span>
<a href="#l11.37"></a><span id="l11.37">     name.Truncate();</span>
<a href="#l11.38"></a><span id="l11.38">     email.Truncate();</span>
<a href="#l11.39"></a><span id="l11.39">   }</span>
<a href="#l11.40"></a><span id="l11.40"> }</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42"> void ExtractFirstAddress(const nsCOMArray&lt;msgIAddressObject&gt; &amp;aHeader,</span>
<a href="#l11.43"></a><span id="l11.43">                          nsAString &amp;name, nsACString &amp;email)</span>
<a href="#l11.44"></a><span id="l11.44"> {</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-  nsAutoTArray&lt;nsString, 1&gt; names, emails;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; names, emails;</span>
<a href="#l11.47"></a><span id="l11.47">   ExtractAllAddresses(aHeader, names, emails);</span>
<a href="#l11.48"></a><span id="l11.48">   if (names.Length() &gt; 0)</span>
<a href="#l11.49"></a><span id="l11.49">   {</span>
<a href="#l11.50"></a><span id="l11.50">     name = names[0];</span>
<a href="#l11.51"></a><span id="l11.51">     CopyUTF16toUTF8(emails[0], email);</span>
<a href="#l11.52"></a><span id="l11.52">   }</span>
<a href="#l11.53"></a><span id="l11.53">   else</span>
<a href="#l11.54"></a><span id="l11.54">   {</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineat">@@ -204,18 +204,18 @@ void ExtractName(const nsCOMArray&lt;msgIAd</span>
<a href="#l11.56"></a><span id="l11.56">   nsCString email;</span>
<a href="#l11.57"></a><span id="l11.57">   ExtractFirstAddress(aHeader, name, email);</span>
<a href="#l11.58"></a><span id="l11.58">   if (name.IsEmpty())</span>
<a href="#l11.59"></a><span id="l11.59">     name = email;</span>
<a href="#l11.60"></a><span id="l11.60"> }</span>
<a href="#l11.61"></a><span id="l11.61"> </span>
<a href="#l11.62"></a><span id="l11.62"> void ExtractName(const nsCOMArray&lt;msgIAddressObject&gt; &amp;aHeader, nsAString &amp;name)</span>
<a href="#l11.63"></a><span id="l11.63"> {</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-  nsAutoTArray&lt;nsString, 1&gt; names;</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-  nsAutoTArray&lt;nsString, 1&gt; emails;</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; names;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+  AutoTArray&lt;nsString, 1&gt; emails;</span>
<a href="#l11.68"></a><span id="l11.68">   ExtractAllAddresses(aHeader, names, emails);</span>
<a href="#l11.69"></a><span id="l11.69">   if (names.Length() &gt; 0)</span>
<a href="#l11.70"></a><span id="l11.70">   {</span>
<a href="#l11.71"></a><span id="l11.71">     if (names[0].IsEmpty())</span>
<a href="#l11.72"></a><span id="l11.72">       name = emails[0];</span>
<a href="#l11.73"></a><span id="l11.73">     else</span>
<a href="#l11.74"></a><span id="l11.74">       name = names[0];</span>
<a href="#l11.75"></a><span id="l11.75">   }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

