<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8482:c8adaba7bea582ffba2036b4d91bae53ff31e7e9</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ c8adaba7bea582ffba2036b4d91bae53ff31e7e9" />
<meta property="og:url" content="/comm-central/rev/c8adaba7bea582ffba2036b4d91bae53ff31e7e9" />
<meta property="og:description" content="Bug 686129 - MozMill: ensure after opening a page in the migration assistant we wait for the iframe to load. r=asuth" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / c8adaba7bea582ffba2036b4d91bae53ff31e7e9 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/c8adaba7bea582ffba2036b4d91bae53ff31e7e9">shortlog</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/c8adaba7bea582ffba2036b4d91bae53ff31e7e9">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9">files</a> |
changeset |
<a href="/comm-central/raw-rev/c8adaba7bea582ffba2036b4d91bae53ff31e7e9">raw</a>  | <a href="/comm-central/archive/c8adaba7bea582ffba2036b4d91bae53ff31e7e9.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686129">Bug 686129</a> - MozMill: ensure after opening a page in the migration assistant we wait for the iframe to load. r=asuth
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#105;&#100;&#100;&#104;&#97;&#114;&#116;&#104;&#32;&#65;&#103;&#97;&#114;&#119;&#97;&#108;&#32;&#60;&#115;&#105;&#100;&#46;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 12 Sep 2011 23:29:14 +0530</td></tr>

<tr>
 <td>changeset 8482</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/c8adaba7bea582ffba2036b4d91bae53ff31e7e9">c8adaba7bea582ffba2036b4d91bae53ff31e7e9</a></td>
</tr>



<tr>
<td>parent 8481</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/11360077d69335bd80dcaa3f75fc555cb0c5afa9">11360077d69335bd80dcaa3f75fc555cb0c5afa9</a>
</td>
</tr>

<tr>
<td>child 8483</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6538067b878488be0f2592641e28625c0d5f965f">6538067b878488be0f2592641e28625c0d5f965f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=c8adaba7bea582ffba2036b4d91bae53ff31e7e9">6511</a></td></tr>
<tr><td>push user</td><td>sid.bugzilla@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 12 Sep 2011 18:03:18 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c8adaba7bea5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&newProject=comm-central&newRevision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&newProject=comm-central&newRevision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&newProject=comm-central&newRevision=c8adaba7bea582ffba2036b4d91bae53ff31e7e9&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28asuth%29&revcount=50">asuth</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686129">686129</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686129">Bug 686129</a> - MozMill: ensure after opening a page in the migration assistant we wait for the iframe to load. r=asuth</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-about-support.js">mail/test/mozmill/content-tabs/test-about-support.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-about-support.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-about-support.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-about-support.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-about-support.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-about-support.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-addons-mgr.js">mail/test/mozmill/content-tabs/test-addons-mgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-addons-mgr.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-addons-mgr.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-addons-mgr.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-addons-mgr.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-addons-mgr.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-content-tab.js">mail/test/mozmill/content-tabs/test-content-tab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-content-tab.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-content-tab.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-content-tab.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-content-tab.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/content-tabs/test-content-tab.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/folder-display/test-message-commands.js">mail/test/mozmill/folder-display/test-message-commands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/folder-display/test-message-commands.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/folder-display/test-message-commands.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/folder-display/test-message-commands.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/folder-display/test-message-commands.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/folder-display/test-message-commands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration-from-tb2/test-1-introduction.js">mail/test/mozmill/migration-from-tb2/test-1-introduction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration-from-tb2/test-1-introduction.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration-from-tb2/test-1-introduction.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration-from-tb2/test-1-introduction.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration-from-tb2/test-1-introduction.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration-from-tb2/test-1-introduction.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-autosync.js">mail/test/mozmill/migration/test-autosync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-autosync.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-autosync.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-autosync.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-autosync.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-autosync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-compactheader.js">mail/test/mozmill/migration/test-compactheader.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-compactheader.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-compactheader.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-compactheader.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-compactheader.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-compactheader.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-folderpanecolumns.js">mail/test/mozmill/migration/test-folderpanecolumns.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-folderpanecolumns.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-folderpanecolumns.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-folderpanecolumns.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-folderpanecolumns.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-folderpanecolumns.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-introduction.js">mail/test/mozmill/migration/test-introduction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-introduction.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-introduction.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-introduction.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-introduction.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-introduction.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-toolbar.js">mail/test/mozmill/migration/test-toolbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-toolbar.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-toolbar.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-toolbar.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-toolbar.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/migration/test-toolbar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">mail/test/mozmill/shared-modules/test-content-tab-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-dom-helpers.js">mail/test/mozmill/shared-modules/test-dom-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-dom-helpers.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-dom-helpers.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-dom-helpers.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-dom-helpers.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-dom-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-migration-helpers.js">mail/test/mozmill/shared-modules/test-migration-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-migration-helpers.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-migration-helpers.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-migration-helpers.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-migration-helpers.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-migration-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-window-helpers.js">mail/test/mozmill/shared-modules/test-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-window-helpers.js">file</a> |
<a href="/comm-central/annotate/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-window-helpers.js">comparison</a> |
<a href="/comm-central/log/c8adaba7bea582ffba2036b4d91bae53ff31e7e9/mail/test/mozmill/shared-modules/test-window-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-about-support.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-about-support.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -79,18 +79,18 @@ const ABOUT_SUPPORT_ERROR_STRINGS = [&quot;un</span>
<a href="#l1.4"></a><span id="l1.4">  */</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> /**</span>
<a href="#l1.7"></a><span id="l1.7">  * Opens about:support and waits for it to load.</span>
<a href="#l1.8"></a><span id="l1.8">  *</span>
<a href="#l1.9"></a><span id="l1.9">  * @returns the about:support tab.</span>
<a href="#l1.10"></a><span id="l1.10">  */</span>
<a href="#l1.11"></a><span id="l1.11"> function open_about_support() {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  let tab = open_content_tab_with_click(mc.menus.helpMenu.aboutsupport_open);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-  assert_content_tab_has_url(tab, &quot;about:support&quot;);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  let tab = open_content_tab_with_click(mc.menus.helpMenu.aboutsupport_open,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+                                        &quot;about:support&quot;);</span>
<a href="#l1.16"></a><span id="l1.16">   // We have one variable that's asynchronously populated -- wait for it to be</span>
<a href="#l1.17"></a><span id="l1.17">   // populated.</span>
<a href="#l1.18"></a><span id="l1.18">   mc.waitFor(function () tab.browser.contentWindow.gExtensions !== undefined,</span>
<a href="#l1.19"></a><span id="l1.19">              &quot;Timeout waiting for about:support's gExtensions to populate.&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">   return tab;</span>
<a href="#l1.21"></a><span id="l1.21"> }</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-addons-mgr.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-addons-mgr.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -47,24 +47,22 @@ var setupModule = function (module) {</span>
<a href="#l2.4"></a><span id="l2.4">   cth.installInto(module);</span>
<a href="#l2.5"></a><span id="l2.5"> };</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> function test_open_addons_with_url() {</span>
<a href="#l2.8"></a><span id="l2.8">   mc.window.openAddonsMgr('addons://list/theme');</span>
<a href="#l2.9"></a><span id="l2.9">   mc.sleep(0);</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">   let tab = mc.tabmail.currentTabInfo;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  wait_for_content_tab_load(tab);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  assert_content_tab_has_url(tab, 'about:addons');</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  wait_for_content_tab_load(tab, 'about:addons');</span>
<a href="#l2.15"></a><span id="l2.15">   assert_true(content_tab_e(tab, 'category-theme').selected,</span>
<a href="#l2.16"></a><span id="l2.16">               &quot;Themes category should be selected!&quot;);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">   mc.tabmail.switchToTab(0); // switch to 3pane</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">   mc.window.openAddonsMgr('addons://list/plugin');</span>
<a href="#l2.21"></a><span id="l2.21">   mc.sleep(0);</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">   tab = mc.tabmail.currentTabInfo;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-  wait_for_content_tab_load(tab);</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-  assert_content_tab_has_url(tab, 'about:addons');</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+  wait_for_content_tab_load(tab, 'about:addons');</span>
<a href="#l2.27"></a><span id="l2.27">   assert_true(content_tab_e(tab, 'category-plugin').selected,</span>
<a href="#l2.28"></a><span id="l2.28">               &quot;Plugins category should be selected!&quot;);</span>
<a href="#l2.29"></a><span id="l2.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-content-tab.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-content-tab.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -65,20 +65,19 @@ var setupModule = function (module) {</span>
<a href="#l3.4"></a><span id="l3.4">   let wh = collector.getModule('window-helpers');</span>
<a href="#l3.5"></a><span id="l3.5">   wh.installInto(module);</span>
<a href="#l3.6"></a><span id="l3.6"> };</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> function test_content_tab_open() {</span>
<a href="#l3.9"></a><span id="l3.9">   // Set the pref so that what's new opens a local url</span>
<a href="#l3.10"></a><span id="l3.10">   Services.prefs.setCharPref(&quot;mailnews.start_page.override_url&quot;, whatsUrl);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  let tab = open_content_tab_with_click(mc.menus.helpMenu.whatsNew);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  let tab = open_content_tab_with_click(mc.menus.helpMenu.whatsNew, whatsUrl);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   assert_tab_has_title(tab, &quot;What's New Content Test&quot;);</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-  assert_content_tab_has_url(tab, whatsUrl);</span>
<a href="#l3.17"></a><span id="l3.17">   // Check the location of the what's new image, this is via the link element</span>
<a href="#l3.18"></a><span id="l3.18">   // and therefore should be set and not favicon.png.</span>
<a href="#l3.19"></a><span id="l3.19">   assert_content_tab_has_favicon(tab, url + &quot;whatsnew.png&quot;);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">   // Check that window.content is set up correctly wrt content-primary and</span>
<a href="#l3.22"></a><span id="l3.22">   // content-targetable.</span>
<a href="#l3.23"></a><span id="l3.23">   if (mc.window.content.location != whatsUrl)</span>
<a href="#l3.24"></a><span id="l3.24">     throw new Error(&quot;window.content is not set to the url loaded, incorrect type=\&quot;...\&quot;?&quot;);</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineat">@@ -140,20 +139,19 @@ function test_content_tab_open_same() {</span>
<a href="#l3.26"></a><span id="l3.26"> }</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28"> function test_content_tab_default_favicon() {</span>
<a href="#l3.29"></a><span id="l3.29">   const whatsUrl1 = url + &quot;whatsnew1.html&quot;;</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31">   // Set the pref so that what's new opens a local url</span>
<a href="#l3.32"></a><span id="l3.32">   Services.prefs.setCharPref(&quot;mailnews.start_page.override_url&quot;, whatsUrl1);</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-  let tab = open_content_tab_with_click(mc.menus.helpMenu.whatsNew);</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+  let tab = open_content_tab_with_click(mc.menus.helpMenu.whatsNew, whatsUrl1);</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37">   assert_tab_has_title(tab, &quot;What's New Content Test 1&quot;);</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-  assert_content_tab_has_url(tab, whatsUrl1);</span>
<a href="#l3.39"></a><span id="l3.39">   // Check the location of the favicon, this should be the site favicon in this</span>
<a href="#l3.40"></a><span id="l3.40">   // test.</span>
<a href="#l3.41"></a><span id="l3.41">   assert_content_tab_has_favicon(tab, url + &quot;favicon.ico&quot;);</span>
<a href="#l3.42"></a><span id="l3.42"> }</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44"> function test_content_tab_onbeforeunload() {</span>
<a href="#l3.45"></a><span id="l3.45">   let count = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l3.46"></a><span id="l3.46">   let tab = mc.tabmail.tabInfo[count-1];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-message-commands.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-message-commands.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -469,21 +469,20 @@ function test_tag_keys() {</span>
<a href="#l4.4"></a><span id="l4.4"> function test_tag_keys_disabled_in_content_tab() {</span>
<a href="#l4.5"></a><span id="l4.5">   be_in_folder(unreadFolder);</span>
<a href="#l4.6"></a><span id="l4.6">   let curMessage = select_click_row(0);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   mc.window.openAddonsMgr('addons://list/theme');</span>
<a href="#l4.9"></a><span id="l4.9">   mc.sleep(0);</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">   let tab = mc.tabmail.currentTabInfo;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  wait_for_content_tab_load(tab);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  assert_content_tab_has_url(tab, 'about:addons');</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  wait_for_content_tab_load(tab, 'about:addons');</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">   // Make sure pressing the &quot;1&quot; key in a content tab doesn't tag a message</span>
<a href="#l4.17"></a><span id="l4.17">   check_tag_in_message(curMessage, tagArray[0], false);</span>
<a href="#l4.18"></a><span id="l4.18">   mc.keypress(null, &quot;1&quot;, {});</span>
<a href="#l4.19"></a><span id="l4.19">   check_tag_in_message(curMessage, tagArray[0], false);</span>
<a href="#l4.20"></a><span id="l4.20"> }</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22"> function teardownModule() {</span>
<a href="#l4.23"></a><span id="l4.23">   // Make sure archiving is enabled at the end</span>
<a href="#l4.24"></a><span id="l4.24">   enable_archiving(true);</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-}</span>
<a href="#l4.26"></a><span id="l4.26">\ No newline at end of file</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/migration-from-tb2/test-1-introduction.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/migration-from-tb2/test-1-introduction.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -53,53 +53,48 @@ function setupModule(module) {</span>
<a href="#l5.4"></a><span id="l5.4">   let wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l5.5"></a><span id="l5.5">   wh.installInto(module);</span>
<a href="#l5.6"></a><span id="l5.6"> }</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> /**</span>
<a href="#l5.9"></a><span id="l5.9">  * Make sure the migration assistant, has opened automatically when we upgrade.</span>
<a href="#l5.10"></a><span id="l5.10">  */</span>
<a href="#l5.11"></a><span id="l5.11"> function test_open_and_close_migration_assistant() {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  function substringChecker(substring) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    return function (url) (url.spec.indexOf(substring) != -1);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  }</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16">   // Ensure that the migration assistant is opened on upgrade.</span>
<a href="#l5.17"></a><span id="l5.17">   let fc = wait_for_existing_window(&quot;mailnews:featureconfigurator&quot;);</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">   // The first page should be the introduction page.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-  let content = fc.e(&quot;contentFrame&quot;);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-  url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-  assert_true(url.indexOf(&quot;introduction&quot;) != -1,</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-              &quot;The first page (&quot; + url + &quot;) isn't the introduction page!&quot;);</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+  wait_for_frame_load(fc.contentFrame, substringChecker(&quot;introduction&quot;));</span>
<a href="#l5.25"></a><span id="l5.25">   check_introduction_page(fc);</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">   // Move to the next page, which should be the autosync page.</span>
<a href="#l5.28"></a><span id="l5.28">   fc.click(fc.eid(&quot;nextButton&quot;));</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-  url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-  assert_true(url.indexOf(&quot;autosync&quot;) != -1,</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-              &quot;The second page (&quot; + url + &quot;) isn't the autosync page!&quot;);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  check_autosync_page(fc);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+  let as = wait_for_frame_load(fc.contentFrame, substringChecker(&quot;autosync&quot;));</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  check_autosync_page(fc, as);</span>
<a href="#l5.35"></a><span id="l5.35"> </span>
<a href="#l5.36"></a><span id="l5.36">   // Move to the next page, which should be the toolbar page.</span>
<a href="#l5.37"></a><span id="l5.37">   fc.click(fc.eid(&quot;nextButton&quot;));</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-  url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-  assert_true(url.indexOf(&quot;toolbar&quot;) != -1,</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-              &quot;The third page (&quot; + url + &quot;) isn't the toolbar page!&quot;);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-  check_toolbar_page(fc);</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+  let tb = wait_for_frame_load(fc.contentFrame, substringChecker(&quot;toolbar&quot;));</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+  check_toolbar_page(fc, tb);</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">   // Move to the next page, which should be the compactheader page.</span>
<a href="#l5.46"></a><span id="l5.46">   fc.click(fc.eid(&quot;nextButton&quot;));</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-  url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-  assert_true(url.indexOf(&quot;compactheader&quot;) != -1,</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-              &quot;The fourth page (&quot; + url + &quot;) isn't the compactheader page!&quot;);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-  check_compactheader_page(fc);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  let ch = wait_for_frame_load(fc.contentFrame,</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+                               substringChecker(&quot;compactheader&quot;));</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+  check_compactheader_page(fc, ch);</span>
<a href="#l5.54"></a><span id="l5.54"> </span>
<a href="#l5.55"></a><span id="l5.55">   // Move to the next page, which should be the folderpanecolumns page.</span>
<a href="#l5.56"></a><span id="l5.56">   fc.click(fc.eid(&quot;nextButton&quot;));</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-  url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-  assert_true(url.indexOf(&quot;folderpanecolumns&quot;) != -1,</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-              &quot;The fifth page (&quot; + url + &quot;) isn't the folderpanecolumns page!&quot;);</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-  check_folderpanecolumns_page(fc);</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+  let fp = wait_for_frame_load(fc.contentFrame,</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+                               substringChecker(&quot;folderpanecolumns&quot;));</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+  check_folderpanecolumns_page(fc, fp);</span>
<a href="#l5.64"></a><span id="l5.64"> </span>
<a href="#l5.65"></a><span id="l5.65">   // And finally, close the migration assistant.</span>
<a href="#l5.66"></a><span id="l5.66">   close_migration_assistant(fc);</span>
<a href="#l5.67"></a><span id="l5.67"> }</span>
<a href="#l5.68"></a><span id="l5.68"> </span>
<a href="#l5.69"></a><span id="l5.69"> /**</span>
<a href="#l5.70"></a><span id="l5.70">  * Make sure that the introductory page works correctly.</span>
<a href="#l5.71"></a><span id="l5.71">  */</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineat">@@ -109,19 +104,18 @@ function check_introduction_page(fc) {</span>
<a href="#l5.73"></a><span id="l5.73">   assert_true(prevButton.disabled, &quot;We can go back from the first page!&quot;);</span>
<a href="#l5.74"></a><span id="l5.74"> </span>
<a href="#l5.75"></a><span id="l5.75">   // And there's not much more else on this page, so let's continue.</span>
<a href="#l5.76"></a><span id="l5.76"> }</span>
<a href="#l5.77"></a><span id="l5.77"> </span>
<a href="#l5.78"></a><span id="l5.78"> /**</span>
<a href="#l5.79"></a><span id="l5.79">  * Make sure that the autosync page works correctly.</span>
<a href="#l5.80"></a><span id="l5.80">  */</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-function check_autosync_page(fc) {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+function check_autosync_page(fc, as) {</span>
<a href="#l5.83"></a><span id="l5.83">   // There should only be one account, for &quot;blaketestwinton@gmail.com&quot;.</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-  let as = get_subpage(fc);</span>
<a href="#l5.85"></a><span id="l5.85">   let accountList = as.e(&quot;account_list&quot;);</span>
<a href="#l5.86"></a><span id="l5.86">   assert_equals(accountList.childNodes.length, 1, &quot;More than one account!&quot;);</span>
<a href="#l5.87"></a><span id="l5.87"> </span>
<a href="#l5.88"></a><span id="l5.88">   // Single account should be set to synchronize.</span>
<a href="#l5.89"></a><span id="l5.89">   let account = accountList.childNodes.item(0);</span>
<a href="#l5.90"></a><span id="l5.90">   assert_equals(account.textContent, &quot;blaketestwinton@gmail.com&quot;);</span>
<a href="#l5.91"></a><span id="l5.91">   assert_equals(account.className, &quot;button syncing&quot;);</span>
<a href="#l5.92"></a><span id="l5.92"> </span>
<a href="#l5.93"></a><span id="l5.93" class="difflineat">@@ -130,29 +124,27 @@ function check_autosync_page(fc) {</span>
<a href="#l5.94"></a><span id="l5.94">   as.assertChecked(as.eid(&quot;all-sync&quot;));</span>
<a href="#l5.95"></a><span id="l5.95">   as.assertNotChecked(as.eid(&quot;none-sync&quot;));</span>
<a href="#l5.96"></a><span id="l5.96">   as.assertNotChecked(as.eid(&quot;some-sync&quot;));</span>
<a href="#l5.97"></a><span id="l5.97"> }</span>
<a href="#l5.98"></a><span id="l5.98"> </span>
<a href="#l5.99"></a><span id="l5.99"> /**</span>
<a href="#l5.100"></a><span id="l5.100">  * Make sure that the toolbar page works correctly.</span>
<a href="#l5.101"></a><span id="l5.101">  */</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-function check_toolbar_page(fc) {</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+function check_toolbar_page(fc, tb) {</span>
<a href="#l5.104"></a><span id="l5.104">   // Toolbar radio buttons should be set to &quot;Message Buttons Toolbar&quot;.</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-  let tb = get_subpage(fc);</span>
<a href="#l5.106"></a><span id="l5.106">   tb.assertChecked(tb.eid(&quot;toolbar-new&quot;));</span>
<a href="#l5.107"></a><span id="l5.107">   tb.assertNotChecked(tb.eid(&quot;toolbar-original&quot;));</span>
<a href="#l5.108"></a><span id="l5.108"> }</span>
<a href="#l5.109"></a><span id="l5.109"> </span>
<a href="#l5.110"></a><span id="l5.110"> /**</span>
<a href="#l5.111"></a><span id="l5.111">  * Make sure that the compactheader page works correctly.</span>
<a href="#l5.112"></a><span id="l5.112">  */</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-function check_compactheader_page(fc) {</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+function check_compactheader_page(fc, ch) {</span>
<a href="#l5.115"></a><span id="l5.115">   // Compact header strong text should be shown.</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-  let ch = get_subpage(fc);</span>
<a href="#l5.117"></a><span id="l5.117">   assert_equals(get_display(ch, &quot;weak&quot;), &quot;none&quot;,</span>
<a href="#l5.118"></a><span id="l5.118">               &quot;The weak message should not be displayed.&quot;);</span>
<a href="#l5.119"></a><span id="l5.119">   assert_equals(get_display(ch, &quot;strong&quot;), &quot;block&quot;,</span>
<a href="#l5.120"></a><span id="l5.120">               &quot;The strong message should be displayed.&quot;);</span>
<a href="#l5.121"></a><span id="l5.121"> </span>
<a href="#l5.122"></a><span id="l5.122">   // Button to install should be shown.</span>
<a href="#l5.123"></a><span id="l5.123">   assert_equals(get_display(ch, &quot;addon-install-button&quot;), &quot;inline&quot;,</span>
<a href="#l5.124"></a><span id="l5.124">               &quot;The install button should be displayed.&quot;);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineat">@@ -162,23 +154,22 @@ function check_compactheader_page(fc) {</span>
<a href="#l5.126"></a><span id="l5.126">               &quot;The installed message should be displayed.&quot;);</span>
<a href="#l5.127"></a><span id="l5.127">   assert_equals(get_display(ch, &quot;alreadyInstalled&quot;), &quot;none&quot;,</span>
<a href="#l5.128"></a><span id="l5.128">               &quot;The already installed message should not be displayed.&quot;);</span>
<a href="#l5.129"></a><span id="l5.129"> }</span>
<a href="#l5.130"></a><span id="l5.130"> </span>
<a href="#l5.131"></a><span id="l5.131"> /**</span>
<a href="#l5.132"></a><span id="l5.132">  * Make sure that the folderpanecolumns page works correctly.</span>
<a href="#l5.133"></a><span id="l5.133">  */</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-function check_folderpanecolumns_page(fc) {</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+function check_folderpanecolumns_page(fc, fp) {</span>
<a href="#l5.136"></a><span id="l5.136">   // This should be the last page.</span>
<a href="#l5.137"></a><span id="l5.137">   let nextButton = fc.e(&quot;nextButton&quot;);</span>
<a href="#l5.138"></a><span id="l5.138">   assert_true(nextButton.disabled, &quot;We can go forward from the last page!&quot;);</span>
<a href="#l5.139"></a><span id="l5.139"> </span>
<a href="#l5.140"></a><span id="l5.140">   // Folder Pane strong text should be shown.</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-  let fp = get_subpage(fc);</span>
<a href="#l5.142"></a><span id="l5.142">   assert_equals(get_display(fp, &quot;weak&quot;), &quot;none&quot;,</span>
<a href="#l5.143"></a><span id="l5.143">               &quot;The weak message should not be displayed.&quot;);</span>
<a href="#l5.144"></a><span id="l5.144">   assert_equals(get_display(fp, &quot;strong&quot;), &quot;block&quot;,</span>
<a href="#l5.145"></a><span id="l5.145">               &quot;The strong message should be displayed.&quot;);</span>
<a href="#l5.146"></a><span id="l5.146"> </span>
<a href="#l5.147"></a><span id="l5.147">   // Button to install should be shown.</span>
<a href="#l5.148"></a><span id="l5.148">   assert_equals(get_display(fp, &quot;addon-install-button&quot;), &quot;inline&quot;,</span>
<a href="#l5.149"></a><span id="l5.149">               &quot;The install button should be displayed.&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/migration/test-autosync.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/migration/test-autosync.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -53,22 +53,22 @@ function setupModule(module) {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> /**</span>
<a href="#l6.6"></a><span id="l6.6">  * Make sure we can't open the autosync page, because we don't have any</span>
<a href="#l6.7"></a><span id="l6.7">  * fake IMAP servers.</span>
<a href="#l6.8"></a><span id="l6.8">  */</span>
<a href="#l6.9"></a><span id="l6.9"> function test_open_and_close_autosync() {</span>
<a href="#l6.10"></a><span id="l6.10">   // Open the migration assistant, and try to navigate to the autosync page.</span>
<a href="#l6.11"></a><span id="l6.11">   try {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    let fc = open_migration_assistant(mc, &quot;autosync&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    let [fc, ] = open_migration_assistant(mc, &quot;autosync&quot;);</span>
<a href="#l6.14"></a><span id="l6.14">     close_migration_assistant(fc);</span>
<a href="#l6.15"></a><span id="l6.15">   }</span>
<a href="#l6.16"></a><span id="l6.16">   catch (e) {</span>
<a href="#l6.17"></a><span id="l6.17">     // If it's not the error we were expecting, throw it!</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-    if (e.message != &quot;Didn't find autosync in Migration Assistant!&quot;)</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+    if (e.message != &quot;Pane 'autosync' not found in the list of subpages&quot;)</span>
<a href="#l6.20"></a><span id="l6.20">       throw e;</span>
<a href="#l6.21"></a><span id="l6.21">     // Otherwise, return before we throw the error below.</span>
<a href="#l6.22"></a><span id="l6.22">     return;</span>
<a href="#l6.23"></a><span id="l6.23">   }</span>
<a href="#l6.24"></a><span id="l6.24">   // Note: We don't find autosync because we don't have any fake IMAP</span>
<a href="#l6.25"></a><span id="l6.25">   // servers, so we shouldn't get here, and thus we're throwing an error.</span>
<a href="#l6.26"></a><span id="l6.26">   throw new Error(&quot;Found autosync, but didn't expect to!&quot;);</span>
<a href="#l6.27"></a><span id="l6.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/migration/test-compactheader.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/migration/test-compactheader.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -52,27 +52,26 @@ function setupModule(module) {</span>
<a href="#l7.4"></a><span id="l7.4"> }</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> /**</span>
<a href="#l7.7"></a><span id="l7.7">  * Make sure we can open the migration assistant, navigate to the</span>
<a href="#l7.8"></a><span id="l7.8">  * compactheader page, and close the migration assistant.</span>
<a href="#l7.9"></a><span id="l7.9">  */</span>
<a href="#l7.10"></a><span id="l7.10"> function test_open_and_close_compactheader() {</span>
<a href="#l7.11"></a><span id="l7.11">   // Open the migration assistant, and navigate to the compactheader page.</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;compactheader&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  let [fc, ] = open_migration_assistant(mc, &quot;compactheader&quot;);</span>
<a href="#l7.14"></a><span id="l7.14">   close_migration_assistant(fc);</span>
<a href="#l7.15"></a><span id="l7.15"> }</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> /**</span>
<a href="#l7.18"></a><span id="l7.18">  * Make sure the weak message is displayed by default.</span>
<a href="#l7.19"></a><span id="l7.19">  */</span>
<a href="#l7.20"></a><span id="l7.20"> function test_weak_message_by_default() {</span>
<a href="#l7.21"></a><span id="l7.21">   // Open the migration assistant, and navigate to the compactheader page.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;compactheader&quot;);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-  let ch = get_subpage(fc);</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  let [fc, ch] = open_migration_assistant(mc, &quot;compactheader&quot;);</span>
<a href="#l7.25"></a><span id="l7.25">   let weak = ch.window.getComputedStyle(ch.e(&quot;weak&quot;), null)</span>
<a href="#l7.26"></a><span id="l7.26">                       .getPropertyValue(&quot;display&quot;);</span>
<a href="#l7.27"></a><span id="l7.27">   let strong = ch.window.getComputedStyle(ch.e(&quot;strong&quot;), null)</span>
<a href="#l7.28"></a><span id="l7.28">                         .getPropertyValue(&quot;display&quot;);</span>
<a href="#l7.29"></a><span id="l7.29">   assert_true(weak == &quot;block&quot;, &quot;The weak message should be displayed.&quot;);</span>
<a href="#l7.30"></a><span id="l7.30">   assert_true(strong == &quot;none&quot;, &quot;The strong message should not be displayed.&quot;);</span>
<a href="#l7.31"></a><span id="l7.31">   close_migration_assistant(fc);</span>
<a href="#l7.32"></a><span id="l7.32"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/test/mozmill/migration/test-folderpanecolumns.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/test/mozmill/migration/test-folderpanecolumns.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -52,11 +52,11 @@ function setupModule(module) {</span>
<a href="#l8.4"></a><span id="l8.4"> }</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> /**</span>
<a href="#l8.7"></a><span id="l8.7">  * Make sure we can open the migration assistant, navigate to the</span>
<a href="#l8.8"></a><span id="l8.8">  * folderpanecolumns page, and close the migration assistant.</span>
<a href="#l8.9"></a><span id="l8.9">  */</span>
<a href="#l8.10"></a><span id="l8.10"> function test_open_and_close_folderpanecolumns() {</span>
<a href="#l8.11"></a><span id="l8.11">   // Open the migration assistant, and navigate to the folderpanecolumns page.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;folderpanecolumns&quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  let [fc, ] = open_migration_assistant(mc, &quot;folderpanecolumns&quot;);</span>
<a href="#l8.14"></a><span id="l8.14">   close_migration_assistant(fc);</span>
<a href="#l8.15"></a><span id="l8.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/test/mozmill/migration/test-introduction.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/test/mozmill/migration/test-introduction.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -52,11 +52,11 @@ function setupModule(module) {</span>
<a href="#l9.4"></a><span id="l9.4"> }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> /**</span>
<a href="#l9.7"></a><span id="l9.7">  * Make sure we can open the migration assistant, navigate to the</span>
<a href="#l9.8"></a><span id="l9.8">  * introduction page, and close the migration assistant.</span>
<a href="#l9.9"></a><span id="l9.9">  */</span>
<a href="#l9.10"></a><span id="l9.10"> function test_open_and_close_migration_assistant() {</span>
<a href="#l9.11"></a><span id="l9.11">   // Open the migration assistant, and navigate to the autosync page.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;introduction&quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  let [fc, ] = open_migration_assistant(mc, &quot;introduction&quot;);</span>
<a href="#l9.14"></a><span id="l9.14">   close_migration_assistant(fc);</span>
<a href="#l9.15"></a><span id="l9.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/migration/test-toolbar.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/migration/test-toolbar.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -139,27 +139,26 @@ function assert_checked_and_unchecked(aC</span>
<a href="#l10.4"></a><span id="l10.4"> }</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> /**</span>
<a href="#l10.7"></a><span id="l10.7">  * Make sure we can open the migration assistant, navigate to the</span>
<a href="#l10.8"></a><span id="l10.8">  * toolbar page, and close the migration assistant.</span>
<a href="#l10.9"></a><span id="l10.9">  */</span>
<a href="#l10.10"></a><span id="l10.10"> function test_open_and_close_toolbar() {</span>
<a href="#l10.11"></a><span id="l10.11">   // Open the migration assistant, and navigate to the toolbar page.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;toolbar&quot;);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  let [fc, ] = open_migration_assistant(mc, &quot;toolbar&quot;);</span>
<a href="#l10.14"></a><span id="l10.14">   close_migration_assistant(fc);</span>
<a href="#l10.15"></a><span id="l10.15"> }</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> /**</span>
<a href="#l10.18"></a><span id="l10.18">  * Test the new toolbar with the default TB3 buttons.</span>
<a href="#l10.19"></a><span id="l10.19">  */</span>
<a href="#l10.20"></a><span id="l10.20"> function test_new_toolbar_with_default_tb3() {</span>
<a href="#l10.21"></a><span id="l10.21">   // Open the migration assistant, and navigate to the toolbar page.</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;toolbar&quot;);</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-  let ch = get_subpage(fc);</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+  let [fc, ch] = open_migration_assistant(mc, &quot;toolbar&quot;);</span>
<a href="#l10.25"></a><span id="l10.25">   let tbNew = ch.e(&quot;toolbar-new&quot;);</span>
<a href="#l10.26"></a><span id="l10.26">   let tbOrig = ch.e(&quot;toolbar-original&quot;);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   assert_checked_and_unchecked(tbNew, tbOrig);</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30">   // Make sure that the original buttons are what we think they should be.</span>
<a href="#l10.31"></a><span id="l10.31">   let newbar = mc.e(&quot;mail-bar3&quot;);</span>
<a href="#l10.32"></a><span id="l10.32">   assert_default_tb3_settings(newbar, true);</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineat">@@ -185,18 +184,17 @@ function test_new_toolbar_with_custom_tb</span>
<a href="#l10.34"></a><span id="l10.34">   let newbar = mc.e(&quot;mail-bar3&quot;);</span>
<a href="#l10.35"></a><span id="l10.35">   newbar.currentSet = CUSTOM_TB3_SET;</span>
<a href="#l10.36"></a><span id="l10.36">   newbar.setAttribute(&quot;currentset&quot;, CUSTOM_TB3_SET);</span>
<a href="#l10.37"></a><span id="l10.37">   newbar.parentNode.setAttribute(&quot;labelalign&quot;, &quot;end&quot;);</span>
<a href="#l10.38"></a><span id="l10.38">   newbar.setAttribute(&quot;iconsize&quot;, &quot;small&quot;);</span>
<a href="#l10.39"></a><span id="l10.39">   newbar.parentNode.setAttribute(&quot;iconsize&quot;, &quot;small&quot;);</span>
<a href="#l10.40"></a><span id="l10.40"> </span>
<a href="#l10.41"></a><span id="l10.41">   // Open the migration assistant, and navigate to the toolbar page.</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-  let fc = open_migration_assistant(mc, &quot;toolbar&quot;);</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-  let ch = get_subpage(fc);</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+  let [fc, ch] = open_migration_assistant(mc, &quot;toolbar&quot;);</span>
<a href="#l10.45"></a><span id="l10.45">   let tbNew = ch.e(&quot;toolbar-new&quot;);</span>
<a href="#l10.46"></a><span id="l10.46">   let tbOrig = ch.e(&quot;toolbar-original&quot;);</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48">   assert_checked_and_unchecked(tbOrig, tbNew);</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50">   // Make sure that the custom buttons are what we think they should be.</span>
<a href="#l10.51"></a><span id="l10.51">   assert_custom_tb3_settings(newbar);</span>
<a href="#l10.52"></a><span id="l10.52"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -46,32 +46,35 @@ Cu.import('resource://mozmill/modules/mo</span>
<a href="#l11.4"></a><span id="l11.4"> var utils = {};</span>
<a href="#l11.5"></a><span id="l11.5"> Cu.import('resource://mozmill/modules/utils.js', utils);</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> const MODULE_NAME = 'content-tab-helpers';</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> const RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> // we need this for the main controller</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-const MODULE_REQUIRES = ['folder-display-helpers'];</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+const MODULE_REQUIRES = ['folder-display-helpers', 'window-helpers'];</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> const NORMAL_TIMEOUT = 6000;</span>
<a href="#l11.16"></a><span id="l11.16"> const FAST_TIMEOUT = 1000;</span>
<a href="#l11.17"></a><span id="l11.17"> const FAST_INTERVAL = 100;</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> var folderDisplayHelper;</span>
<a href="#l11.20"></a><span id="l11.20"> var mc;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+var wh;</span>
<a href="#l11.22"></a><span id="l11.22"> </span>
<a href="#l11.23"></a><span id="l11.23"> // logHelper (and therefore folderDisplayHelper) exports</span>
<a href="#l11.24"></a><span id="l11.24"> var mark_failure;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26"> function setupModule() {</span>
<a href="#l11.27"></a><span id="l11.27">   folderDisplayHelper = collector.getModule('folder-display-helpers');</span>
<a href="#l11.28"></a><span id="l11.28">   mc = folderDisplayHelper.mc;</span>
<a href="#l11.29"></a><span id="l11.29">   mark_failure = folderDisplayHelper.mark_failure;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+  wh = collector.getModule('window-helpers');</span>
<a href="#l11.32"></a><span id="l11.32"> }</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34"> function installInto(module) {</span>
<a href="#l11.35"></a><span id="l11.35">   setupModule();</span>
<a href="#l11.36"></a><span id="l11.36"> </span>
<a href="#l11.37"></a><span id="l11.37">   // Now copy helper functions</span>
<a href="#l11.38"></a><span id="l11.38">   module.open_content_tab_with_url = open_content_tab_with_url;</span>
<a href="#l11.39"></a><span id="l11.39">   module.open_content_tab_with_click = open_content_tab_with_click;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineat">@@ -114,46 +117,47 @@ function open_content_tab_with_url(aURL,</span>
<a href="#l11.41"></a><span id="l11.41">   utils.waitFor(function () (</span>
<a href="#l11.42"></a><span id="l11.42">                   aController.tabmail.tabContainer.childNodes.length == preCount + 1),</span>
<a href="#l11.43"></a><span id="l11.43">                 &quot;Timeout waiting for the content tab to open with URL: &quot; + aURL,</span>
<a href="#l11.44"></a><span id="l11.44">                 FAST_TIMEOUT, FAST_INTERVAL);</span>
<a href="#l11.45"></a><span id="l11.45"> </span>
<a href="#l11.46"></a><span id="l11.46">   // We append new tabs at the end, so check the last one.</span>
<a href="#l11.47"></a><span id="l11.47">   let expectedNewTab = aController.tabmail.tabInfo[preCount];</span>
<a href="#l11.48"></a><span id="l11.48">   folderDisplayHelper.assert_selected_tab(expectedNewTab);</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-  wait_for_content_tab_load(expectedNewTab);</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+  wait_for_content_tab_load(expectedNewTab, aURL);</span>
<a href="#l11.51"></a><span id="l11.51">   return expectedNewTab;</span>
<a href="#l11.52"></a><span id="l11.52"> }</span>
<a href="#l11.53"></a><span id="l11.53"> </span>
<a href="#l11.54"></a><span id="l11.54"> /**</span>
<a href="#l11.55"></a><span id="l11.55">  * Opens a content tab with a click on the given element. The tab is expected to</span>
<a href="#l11.56"></a><span id="l11.56">  * be opened in the foreground. The element is expected to be associated with</span>
<a href="#l11.57"></a><span id="l11.57">  * the given controller.</span>
<a href="#l11.58"></a><span id="l11.58">  *</span>
<a href="#l11.59"></a><span id="l11.59">  * @param aElem The element to click.</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+ * @param aExpectedURL The URL that is expected to be opened (string).</span>
<a href="#l11.61"></a><span id="l11.61">  * @param [aController] The controller the element is associated with. Defaults</span>
<a href="#l11.62"></a><span id="l11.62">  *                      to |mc|.</span>
<a href="#l11.63"></a><span id="l11.63">  * @returns The newly-opened tab.</span>
<a href="#l11.64"></a><span id="l11.64">  */</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-function open_content_tab_with_click(aElem, aController) {</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+function open_content_tab_with_click(aElem, aExpectedURL, aController) {</span>
<a href="#l11.67"></a><span id="l11.67">   if (aController === undefined)</span>
<a href="#l11.68"></a><span id="l11.68">     aController = mc;</span>
<a href="#l11.69"></a><span id="l11.69"> </span>
<a href="#l11.70"></a><span id="l11.70">   let preCount = aController.tabmail.tabContainer.childNodes.length;</span>
<a href="#l11.71"></a><span id="l11.71">   aController.click(new elib.Elem(aElem));</span>
<a href="#l11.72"></a><span id="l11.72">   utils.waitFor(function () (</span>
<a href="#l11.73"></a><span id="l11.73">                   aController.tabmail.tabContainer.childNodes.length == preCount + 1),</span>
<a href="#l11.74"></a><span id="l11.74">                 &quot;Timeout waiting for the content tab to open&quot;,</span>
<a href="#l11.75"></a><span id="l11.75">                 FAST_TIMEOUT, FAST_INTERVAL);</span>
<a href="#l11.76"></a><span id="l11.76"> </span>
<a href="#l11.77"></a><span id="l11.77">   // We append new tabs at the end, so check the last one.</span>
<a href="#l11.78"></a><span id="l11.78">   let expectedNewTab = aController.tabmail.tabInfo[preCount];</span>
<a href="#l11.79"></a><span id="l11.79">   folderDisplayHelper.assert_selected_tab(expectedNewTab);</span>
<a href="#l11.80"></a><span id="l11.80">   folderDisplayHelper.assert_tab_mode_name(expectedNewTab, &quot;contentTab&quot;);</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-  wait_for_content_tab_load(expectedNewTab);</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+  wait_for_content_tab_load(expectedNewTab, aExpectedURL);</span>
<a href="#l11.83"></a><span id="l11.83">   return expectedNewTab;</span>
<a href="#l11.84"></a><span id="l11.84"> }</span>
<a href="#l11.85"></a><span id="l11.85"> </span>
<a href="#l11.86"></a><span id="l11.86"> /**</span>
<a href="#l11.87"></a><span id="l11.87">  * Call this before triggering a page load that you are going to wait for using</span>
<a href="#l11.88"></a><span id="l11.88">  * |wait_for_content_tab_load|. This ensures that if a page is already displayed</span>
<a href="#l11.89"></a><span id="l11.89">  * in the given tab that state is sufficiently cleaned up so it doesn't trick us</span>
<a href="#l11.90"></a><span id="l11.90">  * into thinking that there is no need to wait.</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineat">@@ -162,45 +166,45 @@ function open_content_tab_with_click(aEl</span>
<a href="#l11.92"></a><span id="l11.92">  */</span>
<a href="#l11.93"></a><span id="l11.93"> function plan_for_content_tab_load(aTab) {</span>
<a href="#l11.94"></a><span id="l11.94">   if (aTab === undefined)</span>
<a href="#l11.95"></a><span id="l11.95">     aTab = mc.tabmail.currentTabInfo;</span>
<a href="#l11.96"></a><span id="l11.96">   aTab.pageLoaded = false;</span>
<a href="#l11.97"></a><span id="l11.97"> }</span>
<a href="#l11.98"></a><span id="l11.98"> </span>
<a href="#l11.99"></a><span id="l11.99"> /**</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">- * Waits for the given content tab to load completely. This is expected to be</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineminus">- * accompanied by a |plan_for_content_tab_load| right before the action</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineminus">- * triggering the page load takes place.</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+ * Waits for the given content tab to load completely with the given URL. This</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+ * is expected to be accompanied by a |plan_for_content_tab_load| right before</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+ * the action triggering the page load takes place.</span>
<a href="#l11.106"></a><span id="l11.106">  *</span>
<a href="#l11.107"></a><span id="l11.107">  * Note that you cannot call |plan_for_content_tab_load| if you're opening a new</span>
<a href="#l11.108"></a><span id="l11.108">  * tab. That is fine, because pageLoaded is initially false.</span>
<a href="#l11.109"></a><span id="l11.109">  *</span>
<a href="#l11.110"></a><span id="l11.110">  * @param [aTab] optional tab, defaulting to the current tab.</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+ * @param aURL The URL being loaded in the tab.</span>
<a href="#l11.112"></a><span id="l11.112">  */</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineminus">-function wait_for_content_tab_load(aTab) {</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+function wait_for_content_tab_load(aTab, aURL) {</span>
<a href="#l11.115"></a><span id="l11.115">   if (aTab === undefined)</span>
<a href="#l11.116"></a><span id="l11.116">     aTab = mc.tabmail.currentTabInfo;</span>
<a href="#l11.117"></a><span id="l11.117"> </span>
<a href="#l11.118"></a><span id="l11.118">   function isLoadedChecker() {</span>
<a href="#l11.119"></a><span id="l11.119">     // Require that the progress listener think that the page is loaded.</span>
<a href="#l11.120"></a><span id="l11.120">     if (!aTab.pageLoaded)</span>
<a href="#l11.121"></a><span id="l11.121">       return false;</span>
<a href="#l11.122"></a><span id="l11.122">     // Also require that our tab infrastructure thinks that the page is loaded.</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-    if (aTab.busy)</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-      return false;</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-    // Finally, require that the tab's browser thinks that no page is being loaded.</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-    return !(aTab.browser.isLoadingDocument);</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+    return (!aTab.busy);</span>
<a href="#l11.128"></a><span id="l11.128">   }</span>
<a href="#l11.129"></a><span id="l11.129"> </span>
<a href="#l11.130"></a><span id="l11.130">   utils.waitFor(isLoadedChecker,</span>
<a href="#l11.131"></a><span id="l11.131">                 &quot;Timeout waiting for the content tab page to load.&quot;);</span>
<a href="#l11.132"></a><span id="l11.132">   // the above may return immediately, meaning the event queue might not get a</span>
<a href="#l11.133"></a><span id="l11.133">   //  chance.  give it a chance now.</span>
<a href="#l11.134"></a><span id="l11.134">   mc.sleep(0);</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+  // Finally, require that the tab's browser thinks that no page is being loaded.</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+  wh.wait_for_browser_load(aTab.browser, aURL);</span>
<a href="#l11.137"></a><span id="l11.137"> }</span>
<a href="#l11.138"></a><span id="l11.138"> </span>
<a href="#l11.139"></a><span id="l11.139"> /**</span>
<a href="#l11.140"></a><span id="l11.140">  * Assert that the given content tab has the given URL (string) loaded.</span>
<a href="#l11.141"></a><span id="l11.141">  */</span>
<a href="#l11.142"></a><span id="l11.142"> function assert_content_tab_has_url(aTab, aURL) {</span>
<a href="#l11.143"></a><span id="l11.143">   if (aTab.browser.currentURI.spec != aURL)</span>
<a href="#l11.144"></a><span id="l11.144">     mark_failure([&quot;The tab&quot;, aTab, &quot;should have URL&quot;, aURL, &quot;but instead has&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-dom-helpers.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-dom-helpers.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -39,16 +39,18 @@ var Cc = Components.classes;</span>
<a href="#l12.4"></a><span id="l12.4"> var Cu = Components.utils;</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> var elib = {};</span>
<a href="#l12.7"></a><span id="l12.7"> Cu.import('resource://mozmill/modules/elementslib.js', elib);</span>
<a href="#l12.8"></a><span id="l12.8"> var mozmill = {};</span>
<a href="#l12.9"></a><span id="l12.9"> Cu.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l12.10"></a><span id="l12.10"> var controller = {};</span>
<a href="#l12.11"></a><span id="l12.11"> Cu.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+var utils = {};</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+Cu.import('resource://mozmill/modules/utils.js', utils);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15"> const MODULE_NAME = 'dom-helpers';</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> const RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> // we need this for the main controller</span>
<a href="#l12.20"></a><span id="l12.20"> const MODULE_REQUIRES = ['folder-display-helpers'];</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -71,16 +73,18 @@ function setupModule() {</span>
<a href="#l12.23"></a><span id="l12.23"> function installInto(module) {</span>
<a href="#l12.24"></a><span id="l12.24">   setupModule();</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">   // Now copy helper functions</span>
<a href="#l12.27"></a><span id="l12.27">   module.assert_element_visible = assert_element_visible;</span>
<a href="#l12.28"></a><span id="l12.28">   module.assert_element_not_visible = assert_element_not_visible;</span>
<a href="#l12.29"></a><span id="l12.29"> }</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+</span>
<a href="#l12.33"></a><span id="l12.33"> /**</span>
<a href="#l12.34"></a><span id="l12.34">  * This function takes either a string or an elementlibs.Elem, and returns</span>
<a href="#l12.35"></a><span id="l12.35">  * whether it is hidden or not (simply by poking at its hidden property). It</span>
<a href="#l12.36"></a><span id="l12.36">  * doesn't try to do anything smart, like is it not into view, or whatever.</span>
<a href="#l12.37"></a><span id="l12.37">  *</span>
<a href="#l12.38"></a><span id="l12.38">  * @param aElt The element to query.</span>
<a href="#l12.39"></a><span id="l12.39">  * @return Whether the element is visible or not.</span>
<a href="#l12.40"></a><span id="l12.40">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-migration-helpers.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-migration-helpers.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -45,94 +45,67 @@ Cu.import(&quot;resource://mozmill/modules/el</span>
<a href="#l13.4"></a><span id="l13.4"> const MODULE_NAME = &quot;migration-helpers&quot;;</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> var MODULE_REQUIRES = [&quot;window-helpers&quot;];</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> var controller = {};</span>
<a href="#l13.9"></a><span id="l13.9"> Cu.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> var wh;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+var dh;</span>
<a href="#l13.13"></a><span id="l13.13"> </span>
<a href="#l13.14"></a><span id="l13.14"> function setupModule() {</span>
<a href="#l13.15"></a><span id="l13.15">   wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l13.16"></a><span id="l13.16"> }</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18"> function installInto(module) {</span>
<a href="#l13.19"></a><span id="l13.19">   setupModule();</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21">   // Now copy helper functions</span>
<a href="#l13.22"></a><span id="l13.22">   module.open_migration_assistant = open_migration_assistant;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-  module.get_subpage = get_subpage;</span>
<a href="#l13.24"></a><span id="l13.24">   module.close_migration_assistant = close_migration_assistant;</span>
<a href="#l13.25"></a><span id="l13.25"> }</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27"> /**</span>
<a href="#l13.28"></a><span id="l13.28">  * Call this to open the migration assistant, and navigate to a specific</span>
<a href="#l13.29"></a><span id="l13.29">  * pane.</span>
<a href="#l13.30"></a><span id="l13.30">  *</span>
<a href="#l13.31"></a><span id="l13.31">  * @param mc the mail:3pane window, wrapped in a MozmillController.</span>
<a href="#l13.32"></a><span id="l13.32">  * @param [aPane] the pane to navigate to.  This value should be one of the</span>
<a href="#l13.33"></a><span id="l13.33">  *     ones contained in the &quot;subpages&quot; array of</span>
<a href="#l13.34"></a><span id="l13.34">  *     mail/base/content/featureConfigurator.js.  If unspecified, we will</span>
<a href="#l13.35"></a><span id="l13.35">  *     stay on the first pane of the migration assistant.</span>
<a href="#l13.36"></a><span id="l13.36">  *</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">- * @return The loaded migration assistant window wrapped in a MozmillController</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">- *     with the contentFrame displaying the appropriate pane.</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+ * @return A pair of (the loaded migration assistant window wrapped in a</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+ *     MozMillController with the contentFrame displaying the appropriate pane,</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+ *     the pane's content window wrapped in a MozMillController).</span>
<a href="#l13.42"></a><span id="l13.42">  */</span>
<a href="#l13.43"></a><span id="l13.43"> function open_migration_assistant(mc, aPane) {</span>
<a href="#l13.44"></a><span id="l13.44">   // Open the migration assistant.</span>
<a href="#l13.45"></a><span id="l13.45">   wh.plan_for_new_window(&quot;mailnews:featureconfigurator&quot;);</span>
<a href="#l13.46"></a><span id="l13.46">   mc.click(new elib.Elem(mc.menus.helpMenu.featureConfigurator));</span>
<a href="#l13.47"></a><span id="l13.47">   let fc = wh.wait_for_new_window(&quot;mailnews:featureconfigurator&quot;);</span>
<a href="#l13.48"></a><span id="l13.48">   if (!aPane)</span>
<a href="#l13.49"></a><span id="l13.49">     return fc;</span>
<a href="#l13.50"></a><span id="l13.50"> </span>
<a href="#l13.51"></a><span id="l13.51">   // Navigate to the specified pane.</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-  let content = fc.e(&quot;contentFrame&quot;);</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-  let url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-  while (url.indexOf(aPane) == -1) {</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-    prevUrl = url;</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-    fc.click(fc.eid(&quot;nextButton&quot;));</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-    url = content.getAttribute(&quot;src&quot;);</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+  let index = fc.featureConfigurator.subpages.indexOf(aPane);</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+  if (index == -1) {</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+    close_migration_assistant(fc);</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+    throw new Error(&quot;Pane '&quot; + aPane + &quot;' not found in the list of subpages&quot;);</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+  }</span>
<a href="#l13.63"></a><span id="l13.63"> </span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-    // If we didn't change urls, then we've hit the end, and still haven't</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-    // found the correct pane, so throw an error.</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-    if (url == prevUrl) {</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-      close_migration_assistant(fc);</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-      throw new Error(&quot;Didn't find &quot; + aPane + &quot; in Migration Assistant!&quot;);</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-    }</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-  }</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-  return fc;</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+  fc.featureConfigurator.index = index;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+  let panec = wh.wait_for_frame_load(fc.contentFrame,</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+                                     function (uri) (uri.spec.indexOf(aPane) != -1));</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+  return [fc, panec];</span>
<a href="#l13.76"></a><span id="l13.76"> }</span>
<a href="#l13.77"></a><span id="l13.77"> </span>
<a href="#l13.78"></a><span id="l13.78"> /**</span>
<a href="#l13.79"></a><span id="l13.79">  * Call this to close the migration assistant.</span>
<a href="#l13.80"></a><span id="l13.80">  *</span>
<a href="#l13.81"></a><span id="l13.81">  * @param fc the migration assistant window wrapped in a MozmillController.</span>
<a href="#l13.82"></a><span id="l13.82">  */</span>
<a href="#l13.83"></a><span id="l13.83"> function close_migration_assistant(fc) {</span>
<a href="#l13.84"></a><span id="l13.84">   wh.plan_for_window_close(fc);</span>
<a href="#l13.85"></a><span id="l13.85">   fc.click(fc.eid(&quot;closeButton&quot;));</span>
<a href="#l13.86"></a><span id="l13.86">   wh.wait_for_window_close();</span>
<a href="#l13.87"></a><span id="l13.87"> }</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-/**</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">- * Call this to get a MozmillController-wrapped window for the subpage</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">- * (a.k.a. the contents of the iframe).</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">- *</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">- * @param fc the migration assistant window wrapped in a MozmillController.</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">- *</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">- * @return The subpage's window wrapped in a MozmillController with the</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineminus">- *     contentFrame displaying the appropriate pane.</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">- */</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-function get_subpage(fc) {</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-  let contentWindow = fc.e(&quot;contentFrame&quot;).contentWindow;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-  // XXX this is not my fault, but I'm not going to fix it.  just make it less</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-  // broken:</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-  // Lie to mozmill to convince it to not explode because these frames never</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-  // get a mozmillDocumentLoaded attribute.</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-  contentWindow.mozmillDocumentLoaded = true;</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-  // And sleep so the page has a chance to load</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-  controller.sleep(1000);</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-  let aController = new controller.MozMillController(contentWindow);</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-  return wh.augment_controller(aController);</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -46,16 +46,17 @@ Cu.import('resource://mozmill/modules/co</span>
<a href="#l14.4"></a><span id="l14.4"> var elib = {};</span>
<a href="#l14.5"></a><span id="l14.5"> Cu.import('resource://mozmill/modules/elementslib.js', elib);</span>
<a href="#l14.6"></a><span id="l14.6"> var frame = {};</span>
<a href="#l14.7"></a><span id="l14.7"> Cu.import('resource://mozmill/modules/frame.js', frame);</span>
<a href="#l14.8"></a><span id="l14.8"> var utils = {};</span>
<a href="#l14.9"></a><span id="l14.9"> Cu.import('resource://mozmill/modules/utils.js', utils);</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> Cu.import('resource:///modules/iteratorUtils.jsm');</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+Cu.import('resource://gre/modules/NetUtil.jsm');</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14"> const MODULE_NAME = 'window-helpers';</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> /**</span>
<a href="#l14.17"></a><span id="l14.17">  * Timeout to use when waiting for the first window ever to load.  This is</span>
<a href="#l14.18"></a><span id="l14.18">  *  long because we are basically waiting for the entire app startup process.</span>
<a href="#l14.19"></a><span id="l14.19">  */</span>
<a href="#l14.20"></a><span id="l14.20"> const FIRST_WINDOW_EVER_TIMEOUT_MS = 30000;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -122,16 +123,19 @@ function installInto(module) {</span>
<a href="#l14.22"></a><span id="l14.22">   module.wait_for_new_window = wait_for_new_window;</span>
<a href="#l14.23"></a><span id="l14.23">   module.plan_for_modal_dialog = plan_for_modal_dialog;</span>
<a href="#l14.24"></a><span id="l14.24">   module.wait_for_modal_dialog = wait_for_modal_dialog;</span>
<a href="#l14.25"></a><span id="l14.25">   module.plan_for_window_close = plan_for_window_close;</span>
<a href="#l14.26"></a><span id="l14.26">   module.wait_for_window_close = wait_for_window_close;</span>
<a href="#l14.27"></a><span id="l14.27">   module.close_window = close_window;</span>
<a href="#l14.28"></a><span id="l14.28">   module.wait_for_existing_window = wait_for_existing_window;</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+  module.wait_for_browser_load = wait_for_browser_load;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+  module.wait_for_frame_load = wait_for_frame_load;</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+</span>
<a href="#l14.33"></a><span id="l14.33">   module.plan_for_observable_event = plan_for_observable_event;</span>
<a href="#l14.34"></a><span id="l14.34">   module.wait_for_observable_event = wait_for_observable_event;</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">   module.augment_controller = augment_controller;</span>
<a href="#l14.37"></a><span id="l14.37"> }</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39"> /**</span>
<a href="#l14.40"></a><span id="l14.40">  * Return the &quot;windowtype&quot; or &quot;id&quot; for the given xul window if it is available.</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -651,16 +655,89 @@ function wait_for_window_close() {</span>
<a href="#l14.42"></a><span id="l14.42">  * @param aController the controller whose window is to be closed.</span>
<a href="#l14.43"></a><span id="l14.43">  */</span>
<a href="#l14.44"></a><span id="l14.44"> function close_window(aController) {</span>
<a href="#l14.45"></a><span id="l14.45">   plan_for_window_close(aController);</span>
<a href="#l14.46"></a><span id="l14.46">   aController.window.close();</span>
<a href="#l14.47"></a><span id="l14.47">   wait_for_window_close();</span>
<a href="#l14.48"></a><span id="l14.48"> }</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+/**</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+ * Given a &lt;browser&gt;, waits for it to completely load.</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+ *</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+ * @param aBrowser The &lt;browser&gt; element to wait for.</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+ * @param aURLOrPredicate The URL that should be loaded (string) or a predicate</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+ *                        for the URL (function).</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+ * @returns The browser's content window wrapped in a MozMillController.</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+ */</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+function wait_for_browser_load(aBrowser, aURLOrPredicate) {</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+  // aBrowser has all the fields we need already.</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+  return _wait_for_generic_load(aBrowser, aURLOrPredicate);</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+}</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+/**</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+ * Given an HTML &lt;frame&gt; or &lt;iframe&gt;, waits for it to completely load.</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+ *</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+ * @param aFrame The element to wait for.</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+ * @param aURLOrPredicate The URL that should be loaded (string) or a predicate</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+ *                        for the URL (function).</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+ * @returns The frame wrapped in a MozMillController.</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+ */</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+function wait_for_frame_load(aFrame, aURLOrPredicate) {</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+  let details = {</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+    // Not sure whether all of these really need to be getters, but this is the</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+    // safest thing to do.</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+    get webProgress () (aFrame.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor)</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+                              .getInterface(Ci.nsIWebNavigation)</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+                              .QueryInterface(Ci.nsIWebProgress)),</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+    get currentURI () (NetUtil.newURI(aFrame.getAttribute(&quot;src&quot;))),</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+    get contentWindow () (aFrame.contentWindow),</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+  };</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+  return _wait_for_generic_load(details, aURLOrPredicate);</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+}</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+/**</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+ * Generic function to wait for some sort of document to load. We expect</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+ * aDetails to have three fields:</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+ * - webProgress: an nsIWebProgress associated with the contentWindow.</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+ * - currentURI: the currently loaded page (nsIURI). </span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+ * - contentWindow: the content window.</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+ */</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+function _wait_for_generic_load(aDetails, aURLOrPredicate) {</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+  let predicate;</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+  if (typeof aURLOrPredicate == &quot;string&quot;) {</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+    let expectedURL = NetUtil.newURI(aURLOrPredicate);</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+    predicate = function (url) (expectedURL.equals(url));</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+  }</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+  else {</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+    predicate = aURLOrPredicate;</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+  }</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+  function isLoadedChecker() {</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+    if (aDetails.webProgress.isLoadingDocument !== false)</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+      return false;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+    return predicate(aDetails.currentURI);</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+  }</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+  try {</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+    utils.waitFor(isLoadedChecker);</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+  } catch (e if e instanceof utils.TimeoutError) {</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+    mark_failure([&quot;Timeout waiting for content page to load. Current URL is:&quot;,</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+                  aDetails.currentURI.spec]);</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+  }</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+  // Lie to mozmill to convince it to not explode because these frames never</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+  // get a mozmillDocumentLoaded attribute (bug 666438).</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+  let contentWindow = aDetails.contentWindow;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+  contentWindow.mozmillDocumentLoaded = true;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+  let cwc = new controller.MozMillController(contentWindow);</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+  return augment_controller(cwc);</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+}</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineplus">+</span>
<a href="#l14.123"></a><span id="l14.123"> </span>
<a href="#l14.124"></a><span id="l14.124"> let obsService = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l14.125"></a><span id="l14.125">                    .getService(Ci.nsIObserverService);</span>
<a href="#l14.126"></a><span id="l14.126"> let observationWaitFuncs = {};</span>
<a href="#l14.127"></a><span id="l14.127"> let observationSaw = {};</span>
<a href="#l14.128"></a><span id="l14.128"> /**</span>
<a href="#l14.129"></a><span id="l14.129">  * Plan for a notification to be sent via the observer service.</span>
<a href="#l14.130"></a><span id="l14.130">  *</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineat">@@ -1153,17 +1230,29 @@ var PerWindowTypeAugmentations = {</span>
<a href="#l14.132"></a><span id="l14.132">     globalsToExposeViaGetters: {</span>
<a href="#l14.133"></a><span id="l14.133">       currentFolder: &quot;gCurrentFolder&quot;,</span>
<a href="#l14.134"></a><span id="l14.134">     },</span>
<a href="#l14.135"></a><span id="l14.135">     getters: {</span>
<a href="#l14.136"></a><span id="l14.136">       dbView: function () {</span>
<a href="#l14.137"></a><span id="l14.137">         return this.folderDisplay.view.dbView;</span>
<a href="#l14.138"></a><span id="l14.138">       }</span>
<a href="#l14.139"></a><span id="l14.139">     }</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-  }</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineplus">+  },</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+  /**</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+   * The feature configurator.</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+   */</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+  &quot;mailnews:featureconfigurator&quot;: {</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineplus">+    elementsToExpose: {</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+      contentFrame: &quot;contentFrame&quot;,</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+    },</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineplus">+    globalsToExposeViaGetters: {</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineplus">+      featureConfigurator: &quot;FeatureConfigurator&quot;,</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineplus">+    },</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineplus">+  },</span>
<a href="#l14.154"></a><span id="l14.154"> };</span>
<a href="#l14.155"></a><span id="l14.155"> </span>
<a href="#l14.156"></a><span id="l14.156"> function _augment_helper(aController, aAugmentDef) {</span>
<a href="#l14.157"></a><span id="l14.157">   if (aAugmentDef.elementsToExpose) {</span>
<a href="#l14.158"></a><span id="l14.158">     for each (let [key, value] in Iterator(aAugmentDef.elementsToExpose)) {</span>
<a href="#l14.159"></a><span id="l14.159">       aController[key] = aController.window.document.getElementById(value);</span>
<a href="#l14.160"></a><span id="l14.160">     }</span>
<a href="#l14.161"></a><span id="l14.161">   }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

