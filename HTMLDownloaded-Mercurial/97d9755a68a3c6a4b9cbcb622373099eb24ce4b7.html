<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22139:97d9755a68a3c6a4b9cbcb622373099eb24ce4b7</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 97d9755a68a3c6a4b9cbcb622373099eb24ce4b7" />
<meta property="og:url" content="/comm-central/rev/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7" />
<meta property="og:description" content="Bug 1340972 - Part 16: replace xxx.swap(*yyy) with xxx.forget(yyy) in mailnews. r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 97d9755a68a3c6a4b9cbcb622373099eb24ce4b7 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">shortlog</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">files</a> |
changeset |
<a href="/comm-central/raw-rev/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">raw</a>  | <a href="/comm-central/archive/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340972">Bug 1340972</a> - Part 16: replace xxx.swap(*yyy) with xxx.forget(yyy) in mailnews. r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 15 Sep 2017 20:30:56 +0200</td></tr>

<tr>
 <td>changeset 22139</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">97d9755a68a3c6a4b9cbcb622373099eb24ce4b7</a></td>
</tr>



<tr>
<td>parent 22138</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/68db819d0e77d97ddf657c1837f1f60e84a960de">68db819d0e77d97ddf657c1837f1f60e84a960de</a>
</td>
</tr>

<tr>
<td>child 22140</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3704436e2afb3ed774419dfc6682c99b4eaaddd1">3704436e2afb3ed774419dfc6682c99b4eaaddd1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=97d9755a68a3c6a4b9cbcb622373099eb24ce4b7">13514</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 15 Sep 2017 18:36:02 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@3704436e2afb [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3704436e2afb3ed774419dfc6682c99b4eaaddd1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3704436e2afb3ed774419dfc6682c99b4eaaddd1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3704436e2afb3ed774419dfc6682c99b4eaaddd1&newProject=comm-central&newRevision=68db819d0e77d97ddf657c1837f1f60e84a960de&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3704436e2afb3ed774419dfc6682c99b4eaaddd1&newProject=comm-central&newRevision=68db819d0e77d97ddf657c1837f1f60e84a960de&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3704436e2afb3ed774419dfc6682c99b4eaaddd1&newProject=comm-central&newRevision=68db819d0e77d97ddf657c1837f1f60e84a960de&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340972">1340972</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340972">Bug 1340972</a> - Part 16: replace xxx.swap(*yyy) with xxx.forget(yyy) in mailnews. r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">mailnews/addrbook/src/nsAbOutlookDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/addrbook/src/nsAbOutlookDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/search/src/nsMsgSearchSession.cpp">mailnews/base/search/src/nsMsgSearchSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/search/src/nsMsgSearchSession.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/search/src/nsMsgSearchSession.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/search/src/nsMsgSearchSession.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/search/src/nsMsgSearchSession.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/search/src/nsMsgSearchSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMailDirProvider.cpp">mailnews/base/src/nsMailDirProvider.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMailDirProvider.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMailDirProvider.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMailDirProvider.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMailDirProvider.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMailDirProvider.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerOSXIntegration.mm">mailnews/base/src/nsMessengerOSXIntegration.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerOSXIntegration.mm">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerOSXIntegration.mm">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerOSXIntegration.mm">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerOSXIntegration.mm">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerOSXIntegration.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccount.cpp">mailnews/base/src/nsMsgAccount.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccount.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccount.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccount.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccount.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccount.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgFolderCache.cpp">mailnews/base/src/nsMsgFolderCache.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgFolderCache.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgFolderCache.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgFolderCache.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgFolderCache.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgFolderCache.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgGroupView.cpp">mailnews/base/src/nsMsgGroupView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgGroupView.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgGroupView.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgGroupView.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgGroupView.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgGroupView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgWindow.cpp">mailnews/base/src/nsMsgWindow.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgWindow.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgWindow.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgWindow.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgWindow.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/src/nsMsgWindow.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapUrl.cpp">mailnews/imap/src/nsImapUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapUrl.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapUrl.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapUrl.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapUrl.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/imap/src/nsImapUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMailboxService.cpp">mailnews/local/src/nsMailboxService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMailboxService.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMailboxService.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMailboxService.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMailboxService.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMailboxService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMsgMaildirStore.cpp">mailnews/local/src/nsMsgMaildirStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMsgMaildirStore.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMsgMaildirStore.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMsgMaildirStore.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMsgMaildirStore.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/local/src/nsMsgMaildirStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/97d9755a68a3c6a4b9cbcb622373099eb24ce4b7/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbOutlookDirectory.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1525,11 +1525,11 @@ nsresult OutlookCardForURI(const nsACStr</span>
<a href="#l1.4"></a><span id="l1.4">   WORD year = 0, month = 0, day = 0;</span>
<a href="#l1.5"></a><span id="l1.5">   if (mapiAddBook-&gt;GetPropertyDate(mapiData, PR_BIRTHDAY, year, month, day))</span>
<a href="#l1.6"></a><span id="l1.6">   {</span>
<a href="#l1.7"></a><span id="l1.7">     card-&gt;SetPropertyAsUint32(kBirthYearProperty, year);</span>
<a href="#l1.8"></a><span id="l1.8">     card-&gt;SetPropertyAsUint32(kBirthMonthProperty, month);</span>
<a href="#l1.9"></a><span id="l1.9">     card-&gt;SetPropertyAsUint32(kBirthDayProperty, day);</span>
<a href="#l1.10"></a><span id="l1.10">   }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  card.swap(*newCard);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  card.forget(newCard);</span>
<a href="#l1.14"></a><span id="l1.14">   return NS_OK;</span>
<a href="#l1.15"></a><span id="l1.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -325,17 +325,17 @@ NS_IMETHODIMP nsMsgSearchSession::SetWin</span>
<a href="#l2.4"></a><span id="l2.4">   return NS_OK;</span>
<a href="#l2.5"></a><span id="l2.5"> }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> NS_IMETHODIMP nsMsgSearchSession::GetWindow(nsIMsgWindow **aWindow)</span>
<a href="#l2.8"></a><span id="l2.8"> {</span>
<a href="#l2.9"></a><span id="l2.9">   NS_ENSURE_ARG_POINTER(aWindow);</span>
<a href="#l2.10"></a><span id="l2.10">   *aWindow = nullptr;</span>
<a href="#l2.11"></a><span id="l2.11">   nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(m_msgWindowWeak));</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  msgWindow.swap(*aWindow);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  msgWindow.forget(aWindow);</span>
<a href="#l2.14"></a><span id="l2.14">   return NS_OK;</span>
<a href="#l2.15"></a><span id="l2.15"> }</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> NS_IMETHODIMP nsMsgSearchSession::OnStartRunningUrl(nsIURI *url)</span>
<a href="#l2.18"></a><span id="l2.18"> {</span>
<a href="#l2.19"></a><span id="l2.19">     return NS_OK;</span>
<a href="#l2.20"></a><span id="l2.20"> }</span>
<a href="#l2.21"></a><span id="l2.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -79,17 +79,17 @@ nsMailDirProvider::GetFile(const char *a</span>
<a href="#l3.4"></a><span id="l3.4">   if (NS_FAILED(rv))</span>
<a href="#l3.5"></a><span id="l3.5">     return rv;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">   bool exists;</span>
<a href="#l3.8"></a><span id="l3.8">   if (isDirectory &amp;&amp; NS_SUCCEEDED(file-&gt;Exists(&amp;exists)) &amp;&amp; !exists)</span>
<a href="#l3.9"></a><span id="l3.9">     rv = EnsureDirectory(file);</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   *aPersist = true;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  file.swap(*aResult);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  file.forget(aResult);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   return rv;</span>
<a href="#l3.16"></a><span id="l3.16"> }</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> NS_IMETHODIMP</span>
<a href="#l3.19"></a><span id="l3.19"> nsMailDirProvider::GetFiles(const char *aKey,</span>
<a href="#l3.20"></a><span id="l3.20">                             nsISimpleEnumerator **aResult)</span>
<a href="#l3.21"></a><span id="l3.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -798,17 +798,17 @@ nsMessenger::SaveAttachmentToFolder(cons</span>
<a href="#l4.4"></a><span id="l4.4">   rv = attachmentDestination-&gt;Append(unescapedFileName);</span>
<a href="#l4.5"></a><span id="l4.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.6"></a><span id="l4.6"> #ifdef XP_MACOSX</span>
<a href="#l4.7"></a><span id="l4.7">   rv = attachmentDestination-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, ATTACHMENT_PERMISSION);</span>
<a href="#l4.8"></a><span id="l4.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.9"></a><span id="l4.9"> #endif</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">   rv = SaveAttachment(attachmentDestination, url, messageUri, contentType, nullptr, nullptr);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  attachmentDestination.swap(*aOutFile);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  attachmentDestination.forget(aOutFile);</span>
<a href="#l4.14"></a><span id="l4.14">   return rv;</span>
<a href="#l4.15"></a><span id="l4.15"> }</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> NS_IMETHODIMP</span>
<a href="#l4.18"></a><span id="l4.18"> nsMessenger::SaveAttachment(const nsACString&amp; aContentType, const nsACString&amp; aURL,</span>
<a href="#l4.19"></a><span id="l4.19">                             const nsACString&amp; aDisplayName, const nsACString&amp; aMessageUri, bool aIsExternalAttachment)</span>
<a href="#l4.20"></a><span id="l4.20"> {</span>
<a href="#l4.21"></a><span id="l4.21">   // open external attachments inside our message pane which in turn should trigger the</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -1321,17 +1321,17 @@ nsMessenger::GetSaveAsFile(const nsAStri</span>
<a href="#l4.23"></a><span id="l4.23">     else</span>
<a href="#l4.24"></a><span id="l4.24">     {</span>
<a href="#l4.25"></a><span id="l4.25">       // We failed, or this isn't a file. We can't do anything about it.</span>
<a href="#l4.26"></a><span id="l4.26">       return NS_ERROR_FAILURE;</span>
<a href="#l4.27"></a><span id="l4.27">     }</span>
<a href="#l4.28"></a><span id="l4.28">   }</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">   *aSaveAsFile = nullptr;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  localFile.swap(*aSaveAsFile);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  localFile.forget(aSaveAsFile);</span>
<a href="#l4.33"></a><span id="l4.33">   return NS_OK;</span>
<a href="#l4.34"></a><span id="l4.34"> }</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> /**</span>
<a href="#l4.37"></a><span id="l4.37">  * Show a Save All dialog allowing the user to pick which folder to save</span>
<a href="#l4.38"></a><span id="l4.38">  * messages to.</span>
<a href="#l4.39"></a><span id="l4.39">  * @param [out] aSaveDir directory to save to. Will be null on cancel.</span>
<a href="#l4.40"></a><span id="l4.40">  */</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -1364,17 +1364,17 @@ nsMessenger::GetSaveToDir(nsIFile **aSav</span>
<a href="#l4.42"></a><span id="l4.42">   nsCOMPtr&lt;nsIFile&gt; dir;</span>
<a href="#l4.43"></a><span id="l4.43">   rv = filePicker-&gt;GetFile(getter_AddRefs(dir));</span>
<a href="#l4.44"></a><span id="l4.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">   rv = SetLastSaveDirectory(dir);</span>
<a href="#l4.47"></a><span id="l4.47">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49">   *aSaveDir = nullptr;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  dir.swap(*aSaveDir);</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  dir.forget(aSaveDir);</span>
<a href="#l4.52"></a><span id="l4.52">   return NS_OK;</span>
<a href="#l4.53"></a><span id="l4.53"> }</span>
<a href="#l4.54"></a><span id="l4.54"> </span>
<a href="#l4.55"></a><span id="l4.55"> NS_IMETHODIMP</span>
<a href="#l4.56"></a><span id="l4.56"> nsMessenger::SaveMessages(uint32_t aCount,</span>
<a href="#l4.57"></a><span id="l4.57">                           const char16_t **aFilenameArray,</span>
<a href="#l4.58"></a><span id="l4.58">                           const char **aMessageUriArray)</span>
<a href="#l4.59"></a><span id="l4.59"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -285,17 +285,17 @@ nsresult</span>
<a href="#l5.4"></a><span id="l5.4"> nsMessengerOSXIntegration::GetStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l5.5"></a><span id="l5.5"> {</span>
<a href="#l5.6"></a><span id="l5.6">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l5.7"></a><span id="l5.7">   nsresult rv;</span>
<a href="#l5.8"></a><span id="l5.8">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l5.9"></a><span id="l5.9">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l5.10"></a><span id="l5.10">   if (bundleService &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l5.11"></a><span id="l5.11">     bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  bundle.swap(*aBundle);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  bundle.forget(aBundle);</span>
<a href="#l5.14"></a><span id="l5.14">   return rv;</span>
<a href="#l5.15"></a><span id="l5.15"> }</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> void</span>
<a href="#l5.18"></a><span id="l5.18"> nsMessengerOSXIntegration::FillToolTipInfo(nsIMsgFolder *aFolder, int32_t aNewCount)</span>
<a href="#l5.19"></a><span id="l5.19"> {</span>
<a href="#l5.20"></a><span id="l5.20">   if (aFolder)</span>
<a href="#l5.21"></a><span id="l5.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -145,17 +145,17 @@ nsresult nsMessengerUnixIntegration::Get</span>
<a href="#l6.4"></a><span id="l6.4"> {</span>
<a href="#l6.5"></a><span id="l6.5">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l6.6"></a><span id="l6.6">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l6.7"></a><span id="l6.7">     mozilla::services::GetStringBundleService();</span>
<a href="#l6.8"></a><span id="l6.8">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l6.9"></a><span id="l6.9">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l6.10"></a><span id="l6.10">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l6.11"></a><span id="l6.11">                               getter_AddRefs(bundle));</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  bundle.swap(*aBundle);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  bundle.forget(aBundle);</span>
<a href="#l6.14"></a><span id="l6.14">   return NS_OK;</span>
<a href="#l6.15"></a><span id="l6.15"> }</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> bool</span>
<a href="#l6.18"></a><span id="l6.18"> nsMessengerUnixIntegration::BuildNotificationTitle(nsIMsgFolder *aFolder, nsIStringBundle *aBundle, nsString &amp;aTitle)</span>
<a href="#l6.19"></a><span id="l6.19"> {</span>
<a href="#l6.20"></a><span id="l6.20">   nsString accountName;</span>
<a href="#l6.21"></a><span id="l6.21">   aFolder-&gt;GetPrettyName(accountName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -246,17 +246,17 @@ nsMsgAccount::GetDefaultIdentity(nsIMsgI</span>
<a href="#l7.4"></a><span id="l7.4">   *aDefaultIdentity = nullptr;</span>
<a href="#l7.5"></a><span id="l7.5">   uint32_t count;</span>
<a href="#l7.6"></a><span id="l7.6">   nsresult rv = m_identities-&gt;GetLength(&amp;count);</span>
<a href="#l7.7"></a><span id="l7.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.8"></a><span id="l7.8">   if (count == 0)</span>
<a href="#l7.9"></a><span id="l7.9">     return NS_OK;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity = do_QueryElementAt(m_identities, 0, &amp;rv);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  identity.swap(*aDefaultIdentity);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  identity.forget(aDefaultIdentity);</span>
<a href="#l7.14"></a><span id="l7.14">   return rv;</span>
<a href="#l7.15"></a><span id="l7.15"> }</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> NS_IMETHODIMP</span>
<a href="#l7.18"></a><span id="l7.18"> nsMsgAccount::SetDefaultIdentity(nsIMsgIdentity *aDefaultIdentity)</span>
<a href="#l7.19"></a><span id="l7.19"> {</span>
<a href="#l7.20"></a><span id="l7.20">   NS_ENSURE_TRUE(m_identities, NS_ERROR_FAILURE);</span>
<a href="#l7.21"></a><span id="l7.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -393,17 +393,17 @@ nsMsgAccountManager::GetIdentity(const n</span>
<a href="#l8.4"></a><span id="l8.4">   nsresult rv = NS_OK;</span>
<a href="#l8.5"></a><span id="l8.5">   *_retval = nullptr;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">   if (!key.IsEmpty())</span>
<a href="#l8.8"></a><span id="l8.8">   {</span>
<a href="#l8.9"></a><span id="l8.9">     nsCOMPtr&lt;nsIMsgIdentity&gt; identity;</span>
<a href="#l8.10"></a><span id="l8.10">     m_identities.Get(key, getter_AddRefs(identity));</span>
<a href="#l8.11"></a><span id="l8.11">     if (identity)</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      identity.swap(*_retval);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      identity.forget(_retval);</span>
<a href="#l8.14"></a><span id="l8.14">     else // identity doesn't exist. create it.</span>
<a href="#l8.15"></a><span id="l8.15">       rv = createKeyedIdentity(key, _retval);</span>
<a href="#l8.16"></a><span id="l8.16">   }</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">   return rv;</span>
<a href="#l8.19"></a><span id="l8.19"> }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21"> /*</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -416,17 +416,17 @@ nsMsgAccountManager::createKeyedIdentity</span>
<a href="#l8.23"></a><span id="l8.23"> {</span>
<a href="#l8.24"></a><span id="l8.24">   nsresult rv;</span>
<a href="#l8.25"></a><span id="l8.25">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity =</span>
<a href="#l8.26"></a><span id="l8.26">       do_CreateInstance(NS_MSGIDENTITY_CONTRACTID, &amp;rv);</span>
<a href="#l8.27"></a><span id="l8.27">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">   identity-&gt;SetKey(key);</span>
<a href="#l8.30"></a><span id="l8.30">   m_identities.Put(key, identity);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  identity.swap(*aIdentity);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  identity.forget(aIdentity);</span>
<a href="#l8.33"></a><span id="l8.33">   return NS_OK;</span>
<a href="#l8.34"></a><span id="l8.34"> }</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36"> NS_IMETHODIMP</span>
<a href="#l8.37"></a><span id="l8.37"> nsMsgAccountManager::CreateIncomingServer(const nsACString&amp;  username,</span>
<a href="#l8.38"></a><span id="l8.38">                                           const nsACString&amp; hostname,</span>
<a href="#l8.39"></a><span id="l8.39">                                           const nsACString&amp; type,</span>
<a href="#l8.40"></a><span id="l8.40">                                           nsIMsgIncomingServer **_retval)</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -612,17 +612,17 @@ nsMsgAccountManager::createKeyedServer(c</span>
<a href="#l8.42"></a><span id="l8.42">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44">   nsTObserverArray&lt;nsCOMPtr&lt;nsIFolderListener&gt; &gt;::ForwardIterator iter(mFolderListeners);</span>
<a href="#l8.45"></a><span id="l8.45">   while (iter.HasMore())</span>
<a href="#l8.46"></a><span id="l8.46">   {</span>
<a href="#l8.47"></a><span id="l8.47">     rootFolder-&gt;AddFolderListener(iter.GetNext());</span>
<a href="#l8.48"></a><span id="l8.48">   }</span>
<a href="#l8.49"></a><span id="l8.49"> </span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-  server.swap(*aServer);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  server.forget(aServer);</span>
<a href="#l8.52"></a><span id="l8.52">   return NS_OK;</span>
<a href="#l8.53"></a><span id="l8.53"> }</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55"> void</span>
<a href="#l8.56"></a><span id="l8.56"> nsMsgAccountManager::removeListenersFromFolder(nsIMsgFolder *aFolder)</span>
<a href="#l8.57"></a><span id="l8.57"> {</span>
<a href="#l8.58"></a><span id="l8.58">   nsTObserverArray&lt;nsCOMPtr&lt;nsIFolderListener&gt; &gt;::ForwardIterator iter(mFolderListeners);</span>
<a href="#l8.59"></a><span id="l8.59">   while (iter.HasMore())</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineat">@@ -1730,17 +1730,17 @@ nsMsgAccountManager::createKeyedAccount(</span>
<a href="#l8.61"></a><span id="l8.61">   if (mAccountKeyList.IsEmpty())</span>
<a href="#l8.62"></a><span id="l8.62">     mAccountKeyList = key;</span>
<a href="#l8.63"></a><span id="l8.63">   else {</span>
<a href="#l8.64"></a><span id="l8.64">     mAccountKeyList.Append(',');</span>
<a href="#l8.65"></a><span id="l8.65">     mAccountKeyList.Append(key);</span>
<a href="#l8.66"></a><span id="l8.66">   }</span>
<a href="#l8.67"></a><span id="l8.67"> </span>
<a href="#l8.68"></a><span id="l8.68">   m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS, mAccountKeyList.get());</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-  account.swap(*aAccount);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+  account.forget(aAccount);</span>
<a href="#l8.71"></a><span id="l8.71">   return NS_OK;</span>
<a href="#l8.72"></a><span id="l8.72"> }</span>
<a href="#l8.73"></a><span id="l8.73"> </span>
<a href="#l8.74"></a><span id="l8.74"> NS_IMETHODIMP</span>
<a href="#l8.75"></a><span id="l8.75"> nsMsgAccountManager::CreateAccount(nsIMsgAccount **_retval)</span>
<a href="#l8.76"></a><span id="l8.76"> {</span>
<a href="#l8.77"></a><span id="l8.77">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l8.78"></a><span id="l8.78"> </span>
<a href="#l8.79"></a><span id="l8.79" class="difflineat">@@ -1758,17 +1758,17 @@ nsMsgAccountManager::GetAccount(const ns</span>
<a href="#l8.80"></a><span id="l8.80"> </span>
<a href="#l8.81"></a><span id="l8.81">   for (uint32_t i = 0; i &lt; m_accounts.Length(); ++i)</span>
<a href="#l8.82"></a><span id="l8.82">   {</span>
<a href="#l8.83"></a><span id="l8.83">     nsCOMPtr&lt;nsIMsgAccount&gt; account(m_accounts[i]);</span>
<a href="#l8.84"></a><span id="l8.84">     nsCString key;</span>
<a href="#l8.85"></a><span id="l8.85">     account-&gt;GetKey(key);</span>
<a href="#l8.86"></a><span id="l8.86">     if (key.Equals(aKey))</span>
<a href="#l8.87"></a><span id="l8.87">     {</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-      account.swap(*aAccount);</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+      account.forget(aAccount);</span>
<a href="#l8.90"></a><span id="l8.90">       break;</span>
<a href="#l8.91"></a><span id="l8.91">     }</span>
<a href="#l8.92"></a><span id="l8.92">   }</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94">   // If not found, create on demand.</span>
<a href="#l8.95"></a><span id="l8.95">   return NS_OK;</span>
<a href="#l8.96"></a><span id="l8.96"> }</span>
<a href="#l8.97"></a><span id="l8.97"> </span>
<a href="#l8.98"></a><span id="l8.98" class="difflineat">@@ -2077,17 +2077,17 @@ nsMsgAccountManager::GetFirstIdentityFor</span>
<a href="#l8.99"></a><span id="l8.99">   uint32_t numIdentities;</span>
<a href="#l8.100"></a><span id="l8.100">   rv = identities-&gt;GetLength(&amp;numIdentities);</span>
<a href="#l8.101"></a><span id="l8.101">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.102"></a><span id="l8.102"> </span>
<a href="#l8.103"></a><span id="l8.103">   if (numIdentities &gt; 0)</span>
<a href="#l8.104"></a><span id="l8.104">   {</span>
<a href="#l8.105"></a><span id="l8.105">     nsCOMPtr&lt;nsIMsgIdentity&gt; identity(do_QueryElementAt(identities, 0, &amp;rv));</span>
<a href="#l8.106"></a><span id="l8.106">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-    identity.swap(*aIdentity);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+    identity.forget(aIdentity);</span>
<a href="#l8.109"></a><span id="l8.109">   }</span>
<a href="#l8.110"></a><span id="l8.110">   else</span>
<a href="#l8.111"></a><span id="l8.111">     *aIdentity = nullptr;</span>
<a href="#l8.112"></a><span id="l8.112">   return rv;</span>
<a href="#l8.113"></a><span id="l8.113"> }</span>
<a href="#l8.114"></a><span id="l8.114"> </span>
<a href="#l8.115"></a><span id="l8.115"> NS_IMETHODIMP</span>
<a href="#l8.116"></a><span id="l8.116"> nsMsgAccountManager::GetIdentitiesForServer(nsIMsgIncomingServer *server,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -253,17 +253,17 @@ NS_IMETHODIMP nsMsgFolderCache::Init(nsI</span>
<a href="#l9.4"></a><span id="l9.4"> NS_IMETHODIMP nsMsgFolderCache::GetCacheElement(const nsACString&amp; pathKey, bool createIfMissing,</span>
<a href="#l9.5"></a><span id="l9.5">                                                 nsIMsgFolderCacheElement **result)</span>
<a href="#l9.6"></a><span id="l9.6"> {</span>
<a href="#l9.7"></a><span id="l9.7">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l9.8"></a><span id="l9.8">   NS_ENSURE_TRUE(!pathKey.IsEmpty(), NS_ERROR_FAILURE);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">   nsCOMPtr&lt;nsIMsgFolderCacheElement&gt; folderCacheEl;</span>
<a href="#l9.11"></a><span id="l9.11">   m_cacheElements.Get(pathKey, getter_AddRefs(folderCacheEl));</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  folderCacheEl.swap(*result);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  folderCacheEl.forget(result);</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">   if (*result)</span>
<a href="#l9.16"></a><span id="l9.16">     return NS_OK;</span>
<a href="#l9.17"></a><span id="l9.17">   else if (createIfMissing)</span>
<a href="#l9.18"></a><span id="l9.18">   {</span>
<a href="#l9.19"></a><span id="l9.19">     nsIMdbRow* hdrRow;</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21">     if (GetStore())</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -347,17 +347,17 @@ nsresult nsMsgFolderCache::AddCacheEleme</span>
<a href="#l9.23"></a><span id="l9.23">   cacheElement-&gt;SetOwningCache(this);</span>
<a href="#l9.24"></a><span id="l9.24">   nsCString hashStrKey(key);</span>
<a href="#l9.25"></a><span id="l9.25">   // if caller didn't pass in key, try to get it from row.</span>
<a href="#l9.26"></a><span id="l9.26">   if (key.IsEmpty())</span>
<a href="#l9.27"></a><span id="l9.27">     folderCacheEl-&gt;GetStringProperty(&quot;key&quot;, hashStrKey);</span>
<a href="#l9.28"></a><span id="l9.28">   folderCacheEl-&gt;SetKey(hashStrKey);</span>
<a href="#l9.29"></a><span id="l9.29">   m_cacheElements.Put(hashStrKey, folderCacheEl);</span>
<a href="#l9.30"></a><span id="l9.30">   if (result)</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    folderCacheEl.swap(*result);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    folderCacheEl.forget(result);</span>
<a href="#l9.33"></a><span id="l9.33">   return NS_OK;</span>
<a href="#l9.34"></a><span id="l9.34"> }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> nsresult nsMsgFolderCache::RowCellColumnToCharPtr(nsIMdbRow *hdrRow, mdb_token columnToken, nsACString&amp; resultStr)</span>
<a href="#l9.37"></a><span id="l9.37"> {</span>
<a href="#l9.38"></a><span id="l9.38">   nsresult err = NS_OK;</span>
<a href="#l9.39"></a><span id="l9.39">   nsIMdbCell *hdrCell;</span>
<a href="#l9.40"></a><span id="l9.40">   if (hdrRow) // ### probably should be an error if hdrRow is NULL...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -977,17 +977,17 @@ NS_IMETHODIMP nsMsgGroupView::GetThreadC</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">   nsString hashKey;</span>
<a href="#l10.6"></a><span id="l10.6">   nsresult rv = HashHdr(msgHdr, hashKey);</span>
<a href="#l10.7"></a><span id="l10.7">   *pThread = nullptr;</span>
<a href="#l10.8"></a><span id="l10.8">   if (NS_SUCCEEDED(rv))</span>
<a href="#l10.9"></a><span id="l10.9">   {</span>
<a href="#l10.10"></a><span id="l10.10">     nsCOMPtr&lt;nsIMsgThread&gt; thread;</span>
<a href="#l10.11"></a><span id="l10.11">     m_groupsTable.Get(hashKey, getter_AddRefs(thread));</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    thread.swap(*pThread);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    thread.forget(pThread);</span>
<a href="#l10.14"></a><span id="l10.14">   }</span>
<a href="#l10.15"></a><span id="l10.15">   return (*pThread) ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l10.16"></a><span id="l10.16"> }</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> int32_t nsMsgGroupView::FindLevelInThread(nsIMsgDBHdr *msgHdr,</span>
<a href="#l10.19"></a><span id="l10.19">                                           nsMsgViewIndex startOfThread, nsMsgViewIndex viewIndex)</span>
<a href="#l10.20"></a><span id="l10.20"> {</span>
<a href="#l10.21"></a><span id="l10.21">   if (!(m_viewFlags &amp; nsMsgViewFlagsType::kGroupBySort))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMsgWindow.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgWindow.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -88,17 +88,17 @@ NS_IMETHODIMP nsMsgWindow::GetMessageWin</span>
<a href="#l11.4"></a><span id="l11.4">                                       true, false, nullptr, nullptr,</span>
<a href="#l11.5"></a><span id="l11.5">                                       getter_AddRefs(msgDocShellItem));</span>
<a href="#l11.6"></a><span id="l11.6">       NS_ENSURE_TRUE(msgDocShellItem, NS_ERROR_FAILURE);</span>
<a href="#l11.7"></a><span id="l11.7">       docShell = do_QueryInterface(msgDocShellItem);</span>
<a href="#l11.8"></a><span id="l11.8">       // we don't own mMessageWindowDocShell so don't try to keep a reference to it!</span>
<a href="#l11.9"></a><span id="l11.9">       mMessageWindowDocShellWeak = do_GetWeakReference(docShell);</span>
<a href="#l11.10"></a><span id="l11.10">     }</span>
<a href="#l11.11"></a><span id="l11.11">   }</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  docShell.swap(*aDocShell);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  docShell.forget(aDocShell);</span>
<a href="#l11.14"></a><span id="l11.14">   return NS_OK;</span>
<a href="#l11.15"></a><span id="l11.15"> }</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17"> NS_IMETHODIMP nsMsgWindow::CloseWindow()</span>
<a href="#l11.18"></a><span id="l11.18"> {</span>
<a href="#l11.19"></a><span id="l11.19">   nsresult rv = NS_OK;</span>
<a href="#l11.20"></a><span id="l11.20">   nsCOMPtr&lt;nsIURILoader&gt; dispatcher = do_GetService(NS_URI_LOADER_CONTRACTID, &amp;rv);</span>
<a href="#l11.21"></a><span id="l11.21">   if (dispatcher) // on shut down it's possible dispatcher will be null.</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -224,17 +224,17 @@ NS_IMETHODIMP nsMsgWindow::GetAuthPrompt</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">   nsresult rv;</span>
<a href="#l11.25"></a><span id="l11.25">   nsCOMPtr&lt;nsIDocShell&gt; docShell(do_QueryReferent(mRootDocShellWeak.get(), &amp;rv));</span>
<a href="#l11.26"></a><span id="l11.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">   nsCOMPtr&lt;nsIAuthPrompt&gt; prompt = do_GetInterface(docShell, &amp;rv);</span>
<a href="#l11.29"></a><span id="l11.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  prompt.swap(*aAuthPrompt);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  prompt.forget(aAuthPrompt);</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34">   return rv;</span>
<a href="#l11.35"></a><span id="l11.35"> }</span>
<a href="#l11.36"></a><span id="l11.36"> </span>
<a href="#l11.37"></a><span id="l11.37"> NS_IMETHODIMP nsMsgWindow::SetAuthPrompt(nsIAuthPrompt* aAuthPrompt)</span>
<a href="#l11.38"></a><span id="l11.38"> {</span>
<a href="#l11.39"></a><span id="l11.39">   mAuthPrompt = aAuthPrompt;</span>
<a href="#l11.40"></a><span id="l11.40">   return NS_OK;</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -479,17 +479,17 @@ NS_IMETHODIMP nsMsgWindow::GetPromptDial</span>
<a href="#l11.42"></a><span id="l11.42">   }</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">   nsresult rv;</span>
<a href="#l11.45"></a><span id="l11.45">   nsCOMPtr&lt;nsIDocShell&gt; rootShell(do_QueryReferent(mRootDocShellWeak, &amp;rv));</span>
<a href="#l11.46"></a><span id="l11.46">   if (rootShell)</span>
<a href="#l11.47"></a><span id="l11.47">   {</span>
<a href="#l11.48"></a><span id="l11.48">     nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l11.49"></a><span id="l11.49">     dialog = do_GetInterface(rootShell, &amp;rv);</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-    dialog.swap(*aPrompt);</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+    dialog.forget(aPrompt);</span>
<a href="#l11.52"></a><span id="l11.52">   }</span>
<a href="#l11.53"></a><span id="l11.53">   return rv;</span>
<a href="#l11.54"></a><span id="l11.54"> }</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56"> NS_IMETHODIMP nsMsgWindow::SetPromptDialog(nsIPrompt* aPromptDialog)</span>
<a href="#l11.57"></a><span id="l11.57"> {</span>
<a href="#l11.58"></a><span id="l11.58">   mPromptDialog = aPromptDialog;</span>
<a href="#l11.59"></a><span id="l11.59">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -921,17 +921,17 @@ nsresult nsMsgDBFolder::CreateFileForDB(</span>
<a href="#l12.4"></a><span id="l12.4">     rv = dbPath-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l12.5"></a><span id="l12.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.6"></a><span id="l12.6">     dbPath-&gt;GetLeafName(proposedDBName);</span>
<a href="#l12.7"></a><span id="l12.7">   }</span>
<a href="#l12.8"></a><span id="l12.8">   // now, take the &quot;.msf&quot; off</span>
<a href="#l12.9"></a><span id="l12.9">   proposedDBName.SetLength(proposedDBName.Length() - NS_LITERAL_CSTRING(SUMMARY_SUFFIX).Length());</span>
<a href="#l12.10"></a><span id="l12.10">   dbPath-&gt;SetLeafName(proposedDBName);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  dbPath.swap(*dbFile);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  dbPath.forget(dbFile);</span>
<a href="#l12.14"></a><span id="l12.14">   return NS_OK;</span>
<a href="#l12.15"></a><span id="l12.15"> }</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> NS_IMETHODIMP</span>
<a href="#l12.18"></a><span id="l12.18"> nsMsgDBFolder::GetMsgDatabase(nsIMsgDatabase** aMsgDatabase)</span>
<a href="#l12.19"></a><span id="l12.19"> {</span>
<a href="#l12.20"></a><span id="l12.20">   NS_ENSURE_ARG_POINTER(aMsgDatabase);</span>
<a href="#l12.21"></a><span id="l12.21">   GetDatabase();</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -3022,17 +3022,17 @@ nsMsgDBFolder::FindSubFolder(const nsACS</span>
<a href="#l12.23"></a><span id="l12.23">   rv = rdf-&gt;GetResource(uri, getter_AddRefs(res));</span>
<a href="#l12.24"></a><span id="l12.24">   if (NS_FAILED(rv))</span>
<a href="#l12.25"></a><span id="l12.25">     return rv;</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(res, &amp;rv));</span>
<a href="#l12.28"></a><span id="l12.28">   if (NS_FAILED(rv))</span>
<a href="#l12.29"></a><span id="l12.29">     return rv;</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  folder.swap(*aFolder);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  folder.forget(aFolder);</span>
<a href="#l12.33"></a><span id="l12.33">   return NS_OK;</span>
<a href="#l12.34"></a><span id="l12.34"> }</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36"> NS_IMETHODIMP</span>
<a href="#l12.37"></a><span id="l12.37"> nsMsgDBFolder::GetHasSubFolders(bool *_retval)</span>
<a href="#l12.38"></a><span id="l12.38"> {</span>
<a href="#l12.39"></a><span id="l12.39">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l12.40"></a><span id="l12.40">   *_retval = mSubFolders.Count() &gt; 0;</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -3080,17 +3080,17 @@ NS_IMETHODIMP nsMsgDBFolder::SetParent(n</span>
<a href="#l12.42"></a><span id="l12.42">   }</span>
<a href="#l12.43"></a><span id="l12.43">   return NS_OK;</span>
<a href="#l12.44"></a><span id="l12.44"> }</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46"> NS_IMETHODIMP nsMsgDBFolder::GetParent(nsIMsgFolder **aParent)</span>
<a href="#l12.47"></a><span id="l12.47"> {</span>
<a href="#l12.48"></a><span id="l12.48">   NS_ENSURE_ARG_POINTER(aParent);</span>
<a href="#l12.49"></a><span id="l12.49">   nsCOMPtr&lt;nsIMsgFolder&gt; parent = do_QueryReferent(mParent);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-  parent.swap(*aParent);</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+  parent.forget(aParent);</span>
<a href="#l12.52"></a><span id="l12.52">   return NS_OK;</span>
<a href="#l12.53"></a><span id="l12.53"> }</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55"> NS_IMETHODIMP</span>
<a href="#l12.56"></a><span id="l12.56"> nsMsgDBFolder::GetMessages(nsISimpleEnumerator **result)</span>
<a href="#l12.57"></a><span id="l12.57"> {</span>
<a href="#l12.58"></a><span id="l12.58">   // XXX should this return an empty enumeration?</span>
<a href="#l12.59"></a><span id="l12.59">   return NS_ERROR_FAILURE;</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineat">@@ -3117,17 +3117,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetServer(n</span>
<a href="#l12.61"></a><span id="l12.61">   // short circut the server if we have it.</span>
<a href="#l12.62"></a><span id="l12.62">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryReferent(mServer, &amp;rv);</span>
<a href="#l12.63"></a><span id="l12.63">   if (NS_FAILED(rv))</span>
<a href="#l12.64"></a><span id="l12.64">   {</span>
<a href="#l12.65"></a><span id="l12.65">     // try again after parsing the URI</span>
<a href="#l12.66"></a><span id="l12.66">     rv = parseURI(true);</span>
<a href="#l12.67"></a><span id="l12.67">     server = do_QueryReferent(mServer);</span>
<a href="#l12.68"></a><span id="l12.68">   }</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-  server.swap(*aServer);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+  server.forget(aServer);</span>
<a href="#l12.71"></a><span id="l12.71">   return *aServer ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l12.72"></a><span id="l12.72"> }</span>
<a href="#l12.73"></a><span id="l12.73"> </span>
<a href="#l12.74"></a><span id="l12.74"> nsresult</span>
<a href="#l12.75"></a><span id="l12.75"> nsMsgDBFolder::parseURI(bool needServer)</span>
<a href="#l12.76"></a><span id="l12.76"> {</span>
<a href="#l12.77"></a><span id="l12.77">   nsresult rv;</span>
<a href="#l12.78"></a><span id="l12.78">   nsCOMPtr&lt;nsIURL&gt; url;</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineat">@@ -3783,17 +3783,17 @@ NS_IMETHODIMP nsMsgDBFolder::AddSubfolde</span>
<a href="#l12.80"></a><span id="l12.80">       flags |= nsMsgFolderFlags::Queue;</span>
<a href="#l12.81"></a><span id="l12.81">   }</span>
<a href="#l12.82"></a><span id="l12.82"> </span>
<a href="#l12.83"></a><span id="l12.83">   folder-&gt;SetFlags(flags);</span>
<a href="#l12.84"></a><span id="l12.84"> </span>
<a href="#l12.85"></a><span id="l12.85">   if (folder)</span>
<a href="#l12.86"></a><span id="l12.86">     mSubFolders.AppendObject(folder);</span>
<a href="#l12.87"></a><span id="l12.87"> </span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-  folder.swap(*child);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+  folder.forget(child);</span>
<a href="#l12.90"></a><span id="l12.90">   // at this point we must be ok and we don't want to return failure in case</span>
<a href="#l12.91"></a><span id="l12.91">   // GetIsServer failed.</span>
<a href="#l12.92"></a><span id="l12.92">   return NS_OK;</span>
<a href="#l12.93"></a><span id="l12.93"> }</span>
<a href="#l12.94"></a><span id="l12.94"> </span>
<a href="#l12.95"></a><span id="l12.95"> NS_IMETHODIMP nsMsgDBFolder::Compact(nsIUrlListener *aListener, nsIMsgWindow *aMsgWindow)</span>
<a href="#l12.96"></a><span id="l12.96"> {</span>
<a href="#l12.97"></a><span id="l12.97">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineat">@@ -3931,17 +3931,17 @@ nsresult nsMsgDBFolder::CreateDirectoryF</span>
<a href="#l12.99"></a><span id="l12.99">       bool pathExists;</span>
<a href="#l12.100"></a><span id="l12.100">       path-&gt;Exists(&amp;pathExists);</span>
<a href="#l12.101"></a><span id="l12.101">       //If for some reason there's a file with the directory separator</span>
<a href="#l12.102"></a><span id="l12.102">       //then we are going to fail.</span>
<a href="#l12.103"></a><span id="l12.103">       rv = pathExists ? NS_MSG_COULD_NOT_CREATE_DIRECTORY : path-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l12.104"></a><span id="l12.104">     }</span>
<a href="#l12.105"></a><span id="l12.105">   }</span>
<a href="#l12.106"></a><span id="l12.106">   if (NS_SUCCEEDED(rv))</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-    path.swap(*resultFile);</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+    path.forget(resultFile);</span>
<a href="#l12.109"></a><span id="l12.109">   return rv;</span>
<a href="#l12.110"></a><span id="l12.110"> }</span>
<a href="#l12.111"></a><span id="l12.111"> </span>
<a href="#l12.112"></a><span id="l12.112"> /* Finds the backup directory associated with this folder, stored on the temp</span>
<a href="#l12.113"></a><span id="l12.113">    drive. If that path doesn't currently exist then it will create it. Path is</span>
<a href="#l12.114"></a><span id="l12.114">    strictly an out parameter.</span>
<a href="#l12.115"></a><span id="l12.115">   */</span>
<a href="#l12.116"></a><span id="l12.116"> nsresult nsMsgDBFolder::CreateBackupDirectory(nsIFile **resultFile)</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineat">@@ -3961,17 +3961,17 @@ nsresult nsMsgDBFolder::CreateBackupDire</span>
<a href="#l12.118"></a><span id="l12.118">     bool pathExists;</span>
<a href="#l12.119"></a><span id="l12.119">     path-&gt;Exists(&amp;pathExists);</span>
<a href="#l12.120"></a><span id="l12.120">     // If for some reason there's a file with the directory separator</span>
<a href="#l12.121"></a><span id="l12.121">     // then we are going to fail.</span>
<a href="#l12.122"></a><span id="l12.122">     rv = pathExists ? NS_MSG_COULD_NOT_CREATE_DIRECTORY :</span>
<a href="#l12.123"></a><span id="l12.123">                       path-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l12.124"></a><span id="l12.124">   }</span>
<a href="#l12.125"></a><span id="l12.125">   if (NS_SUCCEEDED(rv))</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-    path.swap(*resultFile);</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+    path.forget(resultFile);</span>
<a href="#l12.128"></a><span id="l12.128">   return rv;</span>
<a href="#l12.129"></a><span id="l12.129"> }</span>
<a href="#l12.130"></a><span id="l12.130"> </span>
<a href="#l12.131"></a><span id="l12.131"> nsresult nsMsgDBFolder::GetBackupSummaryFile(nsIFile **aBackupFile, const nsACString&amp; newName)</span>
<a href="#l12.132"></a><span id="l12.132"> {</span>
<a href="#l12.133"></a><span id="l12.133">   nsCOMPtr&lt;nsIFile&gt; backupDir;</span>
<a href="#l12.134"></a><span id="l12.134">   nsresult rv = CreateBackupDirectory(getter_AddRefs(backupDir));</span>
<a href="#l12.135"></a><span id="l12.135">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineat">@@ -3998,17 +3998,17 @@ nsresult nsMsgDBFolder::GetBackupSummary</span>
<a href="#l12.137"></a><span id="l12.137">     rv = backupDBDummyFolder-&gt;AppendNative(folderName);</span>
<a href="#l12.138"></a><span id="l12.138">   }</span>
<a href="#l12.139"></a><span id="l12.139">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.140"></a><span id="l12.140"> </span>
<a href="#l12.141"></a><span id="l12.141">   nsCOMPtr&lt;nsIFile&gt; backupDBFile;</span>
<a href="#l12.142"></a><span id="l12.142">   rv = GetSummaryFileLocation(backupDBDummyFolder, getter_AddRefs(backupDBFile));</span>
<a href="#l12.143"></a><span id="l12.143">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.144"></a><span id="l12.144"> </span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-  backupDBFile.swap(*aBackupFile);</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+  backupDBFile.forget(aBackupFile);</span>
<a href="#l12.147"></a><span id="l12.147">   return NS_OK;</span>
<a href="#l12.148"></a><span id="l12.148"> }</span>
<a href="#l12.149"></a><span id="l12.149"> </span>
<a href="#l12.150"></a><span id="l12.150"> NS_IMETHODIMP nsMsgDBFolder::Rename(const nsAString&amp; aNewName, nsIMsgWindow *msgWindow)</span>
<a href="#l12.151"></a><span id="l12.151"> {</span>
<a href="#l12.152"></a><span id="l12.152">   nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l12.153"></a><span id="l12.153">   nsresult rv = GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l12.154"></a><span id="l12.154">   if (NS_FAILED(rv))</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineat">@@ -4693,17 +4693,17 @@ nsMsgDBFolder::GetFilePath(nsIFile * *aF</span>
<a href="#l12.156"></a><span id="l12.156">   nsresult rv;</span>
<a href="#l12.157"></a><span id="l12.157">   // make a new nsIFile object in case the caller</span>
<a href="#l12.158"></a><span id="l12.158">   // alters the underlying file object.</span>
<a href="#l12.159"></a><span id="l12.159">   nsCOMPtr &lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l12.160"></a><span id="l12.160">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.161"></a><span id="l12.161">   if (!mPath)</span>
<a href="#l12.162"></a><span id="l12.162">     parseURI(true);</span>
<a href="#l12.163"></a><span id="l12.163">   rv = file-&gt;InitWithFile(mPath);</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-  file.swap(*aFile);</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineplus">+  file.forget(aFile);</span>
<a href="#l12.166"></a><span id="l12.166">   return NS_OK;</span>
<a href="#l12.167"></a><span id="l12.167"> }</span>
<a href="#l12.168"></a><span id="l12.168"> </span>
<a href="#l12.169"></a><span id="l12.169"> NS_IMETHODIMP nsMsgDBFolder::GetSummaryFile(nsIFile **aSummaryFile)</span>
<a href="#l12.170"></a><span id="l12.170"> {</span>
<a href="#l12.171"></a><span id="l12.171">   NS_ENSURE_ARG_POINTER(aSummaryFile);</span>
<a href="#l12.172"></a><span id="l12.172"> </span>
<a href="#l12.173"></a><span id="l12.173">   nsresult rv;</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineat">@@ -5191,17 +5191,17 @@ nsMsgDBFolder::GetBaseStringBundle(nsISt</span>
<a href="#l12.175"></a><span id="l12.175"> {</span>
<a href="#l12.176"></a><span id="l12.176">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l12.177"></a><span id="l12.177">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l12.178"></a><span id="l12.178">     mozilla::services::GetStringBundleService();</span>
<a href="#l12.179"></a><span id="l12.179">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l12.180"></a><span id="l12.180">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l12.181"></a><span id="l12.181">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l12.182"></a><span id="l12.182">                                  getter_AddRefs(bundle));</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-  bundle.swap(*aBundle);</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+  bundle.forget(aBundle);</span>
<a href="#l12.185"></a><span id="l12.185">   return NS_OK;</span>
<a href="#l12.186"></a><span id="l12.186"> }</span>
<a href="#l12.187"></a><span id="l12.187"> </span>
<a href="#l12.188"></a><span id="l12.188"> nsresult //Do not use this routine if you have to call it very often because it creates a new bundle each time</span>
<a href="#l12.189"></a><span id="l12.189"> nsMsgDBFolder::GetStringFromBundle(const char *msgName, nsString&amp; aResult)</span>
<a href="#l12.190"></a><span id="l12.190"> {</span>
<a href="#l12.191"></a><span id="l12.191">   nsresult rv;</span>
<a href="#l12.192"></a><span id="l12.192">   nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -922,17 +922,17 @@ nsMsgIncomingServer::GetLocalPath(nsIFil</span>
<a href="#l13.4"></a><span id="l13.4">   rv = localPath-&gt;AppendNative(hostname);</span>
<a href="#l13.5"></a><span id="l13.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.6"></a><span id="l13.6">   rv = localPath-&gt;CreateUnique(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l13.7"></a><span id="l13.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">   rv = SetLocalPath(localPath);</span>
<a href="#l13.10"></a><span id="l13.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  localPath.swap(*aLocalPath);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  localPath.forget(aLocalPath);</span>
<a href="#l13.14"></a><span id="l13.14">   return NS_OK;</span>
<a href="#l13.15"></a><span id="l13.15"> }</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17"> NS_IMETHODIMP</span>
<a href="#l13.18"></a><span id="l13.18"> nsMsgIncomingServer::GetMsgStore(nsIMsgPluggableStore **aMsgStore)</span>
<a href="#l13.19"></a><span id="l13.19"> {</span>
<a href="#l13.20"></a><span id="l13.20">   NS_ENSURE_ARG_POINTER(aMsgStore);</span>
<a href="#l13.21"></a><span id="l13.21">   if (!m_msgStore)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -242,17 +242,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetServe</span>
<a href="#l14.4"></a><span id="l14.4"> }</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> NS_IMETHODIMP nsMsgMailNewsUrl::GetMsgWindow(nsIMsgWindow **aMsgWindow)</span>
<a href="#l14.7"></a><span id="l14.7"> {</span>
<a href="#l14.8"></a><span id="l14.8">   NS_ENSURE_ARG_POINTER(aMsgWindow);</span>
<a href="#l14.9"></a><span id="l14.9">   *aMsgWindow = nullptr;</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(m_msgWindowWeak));</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  msgWindow.swap(*aMsgWindow);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  msgWindow.forget(aMsgWindow);</span>
<a href="#l14.14"></a><span id="l14.14">   return *aMsgWindow ? NS_OK : NS_ERROR_NULL_POINTER;</span>
<a href="#l14.15"></a><span id="l14.15"> }</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17"> NS_IMETHODIMP nsMsgMailNewsUrl::SetMsgWindow(nsIMsgWindow *aMsgWindow)</span>
<a href="#l14.18"></a><span id="l14.18"> {</span>
<a href="#l14.19"></a><span id="l14.19"> #ifdef DEBUG_David_Bienvenu</span>
<a href="#l14.20"></a><span id="l14.20">   NS_ASSERTION(aMsgWindow || !m_msgWindowWeak, &quot;someone crunching non-null msg window&quot;);</span>
<a href="#l14.21"></a><span id="l14.21"> #endif</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -269,17 +269,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetStatu</span>
<a href="#l14.23"></a><span id="l14.23">   {</span>
<a href="#l14.24"></a><span id="l14.24">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(m_msgWindowWeak));</span>
<a href="#l14.25"></a><span id="l14.25">     if (msgWindow)</span>
<a href="#l14.26"></a><span id="l14.26">       msgWindow-&gt;GetStatusFeedback(aMsgFeedback);</span>
<a href="#l14.27"></a><span id="l14.27">   }</span>
<a href="#l14.28"></a><span id="l14.28">   else</span>
<a href="#l14.29"></a><span id="l14.29">   {</span>
<a href="#l14.30"></a><span id="l14.30">     nsCOMPtr&lt;nsIMsgStatusFeedback&gt; statusFeedback(do_QueryReferent(m_statusFeedbackWeak));</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    statusFeedback.swap(*aMsgFeedback);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    statusFeedback.forget(aMsgFeedback);</span>
<a href="#l14.33"></a><span id="l14.33">   }</span>
<a href="#l14.34"></a><span id="l14.34">   return *aMsgFeedback ? NS_OK : NS_ERROR_NULL_POINTER;</span>
<a href="#l14.35"></a><span id="l14.35"> }</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37"> NS_IMETHODIMP nsMsgMailNewsUrl::SetStatusFeedback(nsIMsgStatusFeedback *aMsgFeedback)</span>
<a href="#l14.38"></a><span id="l14.38"> {</span>
<a href="#l14.39"></a><span id="l14.39">   if (aMsgFeedback)</span>
<a href="#l14.40"></a><span id="l14.40">     m_statusFeedbackWeak = do_GetWeakReference(aMsgFeedback);</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -312,17 +312,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetLoadG</span>
<a href="#l14.42"></a><span id="l14.42">       // XXXbz This is really weird... why are we getting some</span>
<a href="#l14.43"></a><span id="l14.43">       // random loadgroup we're not really a part of?</span>
<a href="#l14.44"></a><span id="l14.44">       nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l14.45"></a><span id="l14.45">       msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l14.46"></a><span id="l14.46">       loadGroup = do_GetInterface(docShell);</span>
<a href="#l14.47"></a><span id="l14.47">       m_loadGroupWeak = do_GetWeakReference(loadGroup);</span>
<a href="#l14.48"></a><span id="l14.48">     }</span>
<a href="#l14.49"></a><span id="l14.49">   }</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  loadGroup.swap(*aLoadGroup);</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+  loadGroup.forget(aLoadGroup);</span>
<a href="#l14.52"></a><span id="l14.52">   return *aLoadGroup ? NS_OK : NS_ERROR_NULL_POINTER;</span>
<a href="#l14.53"></a><span id="l14.53"> }</span>
<a href="#l14.54"></a><span id="l14.54"> </span>
<a href="#l14.55"></a><span id="l14.55"> NS_IMETHODIMP nsMsgMailNewsUrl::GetUpdatingFolder(bool *aResult)</span>
<a href="#l14.56"></a><span id="l14.56"> {</span>
<a href="#l14.57"></a><span id="l14.57">   NS_ENSURE_ARG(aResult);</span>
<a href="#l14.58"></a><span id="l14.58">   *aResult = m_updatingFolder;</span>
<a href="#l14.59"></a><span id="l14.59">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -485,17 +485,17 @@ nsSmtpService::createKeyedServer(const c</span>
<a href="#l15.4"></a><span id="l15.4">     if (mServerKeyList.IsEmpty())</span>
<a href="#l15.5"></a><span id="l15.5">         mServerKeyList = key;</span>
<a href="#l15.6"></a><span id="l15.6">     else {</span>
<a href="#l15.7"></a><span id="l15.7">         mServerKeyList.Append(',');</span>
<a href="#l15.8"></a><span id="l15.8">         mServerKeyList += key;</span>
<a href="#l15.9"></a><span id="l15.9">     }</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">     if (aResult) </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-       server.swap(*aResult);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+       server.forget(aResult);</span>
<a href="#l15.14"></a><span id="l15.14">     </span>
<a href="#l15.15"></a><span id="l15.15">     return NS_OK;</span>
<a href="#l15.16"></a><span id="l15.16"> }</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18"> NS_IMETHODIMP</span>
<a href="#l15.19"></a><span id="l15.19"> nsSmtpService::GetSessionDefaultServer(nsISmtpServer **aServer)</span>
<a href="#l15.20"></a><span id="l15.20"> {</span>
<a href="#l15.21"></a><span id="l15.21">     NS_ENSURE_ARG_POINTER(aServer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1311,17 +1311,17 @@ nsresult nsImapIncomingServer::GetFolder</span>
<a href="#l16.4"></a><span id="l16.4">       nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l16.5"></a><span id="l16.5">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.6"></a><span id="l16.6">       nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l16.7"></a><span id="l16.7">       rv = rdf-&gt;GetResource(uriString, getter_AddRefs(res));</span>
<a href="#l16.8"></a><span id="l16.8">       if (NS_SUCCEEDED(rv))</span>
<a href="#l16.9"></a><span id="l16.9">       {</span>
<a href="#l16.10"></a><span id="l16.10">         nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(res, &amp;rv));</span>
<a href="#l16.11"></a><span id="l16.11">         if (NS_SUCCEEDED(rv) &amp;&amp; folder)</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-          folder.swap(*pFolder);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+          folder.forget(pFolder);</span>
<a href="#l16.14"></a><span id="l16.14">       }</span>
<a href="#l16.15"></a><span id="l16.15">     }</span>
<a href="#l16.16"></a><span id="l16.16">   }</span>
<a href="#l16.17"></a><span id="l16.17">   return rv;</span>
<a href="#l16.18"></a><span id="l16.18"> }</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> NS_IMETHODIMP  nsImapIncomingServer::OnlineFolderDelete(const nsACString&amp; aFolderName)</span>
<a href="#l16.21"></a><span id="l16.21"> {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -3267,17 +3267,17 @@ nsImapIncomingServer::GetMsgFolderFromUR</span>
<a href="#l16.23"></a><span id="l16.23">       folderResource = do_QueryInterface(resource, &amp;rv);</span>
<a href="#l16.24"></a><span id="l16.24">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.25"></a><span id="l16.25">       msgFolder = folderResource;</span>
<a href="#l16.26"></a><span id="l16.26">     }</span>
<a href="#l16.27"></a><span id="l16.27">     else</span>
<a href="#l16.28"></a><span id="l16.28">       msgFolder = aFolderResource;</span>
<a href="#l16.29"></a><span id="l16.29">   }</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-  msgFolder.swap(*aFolder);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+  msgFolder.forget(aFolder);</span>
<a href="#l16.33"></a><span id="l16.33">   return NS_OK;</span>
<a href="#l16.34"></a><span id="l16.34"> }</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36"> nsresult</span>
<a href="#l16.37"></a><span id="l16.37"> nsImapIncomingServer::GetExistingMsgFolder(const nsACString&amp; aURI,</span>
<a href="#l16.38"></a><span id="l16.38">                                            nsACString&amp; aFolderUriWithNamespace,</span>
<a href="#l16.39"></a><span id="l16.39">                                            bool&amp; aNamespacePrefixAdded,</span>
<a href="#l16.40"></a><span id="l16.40">                                            bool aCaseInsensitive,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -320,17 +320,17 @@ NS_IMETHODIMP nsImapMailFolder::AddSubfo</span>
<a href="#l17.4"></a><span id="l17.4">       flags |= nsMsgFolderFlags::Offline;</span>
<a href="#l17.5"></a><span id="l17.5">   }</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">   folder-&gt;SetParent(this);</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">   folder-&gt;SetFlags(flags);</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   mSubFolders.AppendObject(folder);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  folder.swap(*aChild);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  folder.forget(aChild);</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">   nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapChild = do_QueryInterface(*aChild);</span>
<a href="#l17.16"></a><span id="l17.16">   if (imapChild)</span>
<a href="#l17.17"></a><span id="l17.17">   {</span>
<a href="#l17.18"></a><span id="l17.18">     imapChild-&gt;SetOnlineName(NS_LossyConvertUTF16toASCII(aName));</span>
<a href="#l17.19"></a><span id="l17.19">     imapChild-&gt;SetHierarchyDelimiter(m_hierarchyDelimiter);</span>
<a href="#l17.20"></a><span id="l17.20">   }</span>
<a href="#l17.21"></a><span id="l17.21">   NotifyItemAdded(*aChild);</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -412,17 +412,17 @@ nsresult nsImapMailFolder::AddSubfolderW</span>
<a href="#l17.23"></a><span id="l17.23">     if (NS_SUCCEEDED(rv) &amp;&amp; setNewFoldersForOffline)</span>
<a href="#l17.24"></a><span id="l17.24">       flags |= nsMsgFolderFlags::Offline;</span>
<a href="#l17.25"></a><span id="l17.25">   }</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27">   folder-&gt;SetFlags(flags);</span>
<a href="#l17.28"></a><span id="l17.28"> </span>
<a href="#l17.29"></a><span id="l17.29">   if (folder)</span>
<a href="#l17.30"></a><span id="l17.30">     mSubFolders.AppendObject(folder);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  folder.swap(*child);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  folder.forget(child);</span>
<a href="#l17.33"></a><span id="l17.33">   return NS_OK;</span>
<a href="#l17.34"></a><span id="l17.34"> }</span>
<a href="#l17.35"></a><span id="l17.35"> </span>
<a href="#l17.36"></a><span id="l17.36"> nsresult nsImapMailFolder::CreateSubFolders(nsIFile *path)</span>
<a href="#l17.37"></a><span id="l17.37"> {</span>
<a href="#l17.38"></a><span id="l17.38">   nsresult rv = NS_OK;</span>
<a href="#l17.39"></a><span id="l17.39">   nsAutoString currentFolderNameStr;    // online name</span>
<a href="#l17.40"></a><span id="l17.40">   nsAutoString currentFolderDBNameStr;  // possibly munged name</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineat">@@ -1817,17 +1817,17 @@ nsresult nsImapMailFolder::GetServerKey(</span>
<a href="#l17.42"></a><span id="l17.42"> NS_IMETHODIMP</span>
<a href="#l17.43"></a><span id="l17.43"> nsImapMailFolder::GetImapIncomingServer(nsIImapIncomingServer **aImapIncomingServer)</span>
<a href="#l17.44"></a><span id="l17.44"> {</span>
<a href="#l17.45"></a><span id="l17.45">   NS_ENSURE_ARG(aImapIncomingServer);</span>
<a href="#l17.46"></a><span id="l17.46">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l17.47"></a><span id="l17.47">   if (NS_SUCCEEDED(GetServer(getter_AddRefs(server))) &amp;&amp; server)</span>
<a href="#l17.48"></a><span id="l17.48">   {</span>
<a href="#l17.49"></a><span id="l17.49">     nsCOMPtr &lt;nsIImapIncomingServer&gt; incomingServer = do_QueryInterface(server);</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-    incomingServer.swap(*aImapIncomingServer);</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+    incomingServer.forget(aImapIncomingServer);</span>
<a href="#l17.52"></a><span id="l17.52">     return NS_OK;</span>
<a href="#l17.53"></a><span id="l17.53">   }</span>
<a href="#l17.54"></a><span id="l17.54">   return NS_ERROR_NULL_POINTER;</span>
<a href="#l17.55"></a><span id="l17.55"> }</span>
<a href="#l17.56"></a><span id="l17.56"> </span>
<a href="#l17.57"></a><span id="l17.57"> NS_IMETHODIMP</span>
<a href="#l17.58"></a><span id="l17.58"> nsImapMailFolder::AddMessageDispositionState(nsIMsgDBHdr *aMessage, nsMsgDispositionState aDispositionFlag)</span>
<a href="#l17.59"></a><span id="l17.59"> {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineat">@@ -6947,17 +6947,17 @@ nsresult nsImapMailFolder::GetClearedOri</span>
<a href="#l17.61"></a><span id="l17.61">             returnOp-&gt;GetDestinationFolderURI(getter_Copies(moveDestination));</span>
<a href="#l17.62"></a><span id="l17.62">             if (moveDestination.Equals(thisFolderURI))</span>
<a href="#l17.63"></a><span id="l17.63">               returnOp-&gt;ClearOperation(nsIMsgOfflineImapOperation::kMoveResult);</span>
<a href="#l17.64"></a><span id="l17.64">           }</span>
<a href="#l17.65"></a><span id="l17.65">         }</span>
<a href="#l17.66"></a><span id="l17.66">       }</span>
<a href="#l17.67"></a><span id="l17.67">     }</span>
<a href="#l17.68"></a><span id="l17.68">   }</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-  returnOp.swap(*originalOp);</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+  returnOp.forget(originalOp);</span>
<a href="#l17.71"></a><span id="l17.71">   return rv;</span>
<a href="#l17.72"></a><span id="l17.72"> }</span>
<a href="#l17.73"></a><span id="l17.73"> </span>
<a href="#l17.74"></a><span id="l17.74"> nsresult nsImapMailFolder::GetOriginalOp(nsIMsgOfflineImapOperation *op, nsIMsgOfflineImapOperation **originalOp, nsIMsgDatabase **originalDB)</span>
<a href="#l17.75"></a><span id="l17.75"> {</span>
<a href="#l17.76"></a><span id="l17.76">   nsCOMPtr&lt;nsIMsgOfflineImapOperation&gt; returnOp;</span>
<a href="#l17.77"></a><span id="l17.77">   nsCString sourceFolderURI;</span>
<a href="#l17.78"></a><span id="l17.78">   op-&gt;GetSourceFolderURI(getter_Copies(sourceFolderURI));</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineat">@@ -6976,17 +6976,17 @@ nsresult nsImapMailFolder::GetOriginalOp</span>
<a href="#l17.80"></a><span id="l17.80">     sourceFolder-&gt;GetDBFolderInfoAndDB(getter_AddRefs(folderInfo), originalDB);</span>
<a href="#l17.81"></a><span id="l17.81">     if (*originalDB)</span>
<a href="#l17.82"></a><span id="l17.82">     {</span>
<a href="#l17.83"></a><span id="l17.83">       nsMsgKey originalKey;</span>
<a href="#l17.84"></a><span id="l17.84">       op-&gt;GetMessageKey(&amp;originalKey);</span>
<a href="#l17.85"></a><span id="l17.85">       rv = (*originalDB)-&gt;GetOfflineOpForKey(originalKey, false, getter_AddRefs(returnOp));</span>
<a href="#l17.86"></a><span id="l17.86">     }</span>
<a href="#l17.87"></a><span id="l17.87">   }</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-  returnOp.swap(*originalOp);</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+  returnOp.forget(originalOp);</span>
<a href="#l17.90"></a><span id="l17.90">   return rv;</span>
<a href="#l17.91"></a><span id="l17.91"> }</span>
<a href="#l17.92"></a><span id="l17.92"> </span>
<a href="#l17.93"></a><span id="l17.93"> nsresult nsImapMailFolder::CopyOfflineMsgBody(nsIMsgFolder *srcFolder,</span>
<a href="#l17.94"></a><span id="l17.94">                                               nsIMsgDBHdr *destHdr,</span>
<a href="#l17.95"></a><span id="l17.95">                                               nsIMsgDBHdr *origHdr,</span>
<a href="#l17.96"></a><span id="l17.96">                                               nsIInputStream *inputStream,</span>
<a href="#l17.97"></a><span id="l17.97">                                               nsIOutputStream *outputStream)</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineat">@@ -9453,17 +9453,17 @@ NS_IMETHODIMP nsImapMailFolder::GetCusto</span>
<a href="#l17.99"></a><span id="l17.99">           nsCOMPtr &lt;nsIMsgAccount&gt; account;</span>
<a href="#l17.100"></a><span id="l17.100">           accountManager-&gt;FindAccountForServer(server, getter_AddRefs(account));</span>
<a href="#l17.101"></a><span id="l17.101">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.102"></a><span id="l17.102">           account-&gt;AddIdentity(retIdentity);</span>
<a href="#l17.103"></a><span id="l17.103">         }</span>
<a href="#l17.104"></a><span id="l17.104">       }</span>
<a href="#l17.105"></a><span id="l17.105">       if (retIdentity)</span>
<a href="#l17.106"></a><span id="l17.106">       {</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-        retIdentity.swap(*aIdentity);</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+        retIdentity.forget(aIdentity);</span>
<a href="#l17.109"></a><span id="l17.109">         return NS_OK;</span>
<a href="#l17.110"></a><span id="l17.110">       }</span>
<a href="#l17.111"></a><span id="l17.111">     }</span>
<a href="#l17.112"></a><span id="l17.112">   }</span>
<a href="#l17.113"></a><span id="l17.113">   return nsMsgDBFolder::GetCustomIdentity(aIdentity);</span>
<a href="#l17.114"></a><span id="l17.114"> }</span>
<a href="#l17.115"></a><span id="l17.115"> </span>
<a href="#l17.116"></a><span id="l17.116"> NS_IMETHODIMP nsImapMailFolder::ChangePendingTotal(int32_t aDelta)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -885,17 +885,17 @@ nsresult nsImapService::DecomposeImapURI</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">   nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l18.6"></a><span id="l18.6">   rv = rdf-&gt;GetResource(folderURI, getter_AddRefs(res));</span>
<a href="#l18.7"></a><span id="l18.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">   nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder = do_QueryInterface(res);</span>
<a href="#l18.10"></a><span id="l18.10">   NS_ENSURE_TRUE(msgFolder, NS_ERROR_FAILURE);</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  msgFolder.swap(*aFolder);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  msgFolder.forget(aFolder);</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   return NS_OK;</span>
<a href="#l18.16"></a><span id="l18.16"> }</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18"> NS_IMETHODIMP nsImapService::SaveMessageToDisk(const char *aMessageURI,</span>
<a href="#l18.19"></a><span id="l18.19">                                                nsIFile *aFile,</span>
<a href="#l18.20"></a><span id="l18.20">                                                bool aAddDummyEnvelope,</span>
<a href="#l18.21"></a><span id="l18.21">                                                nsIUrlListener *aUrlListener,</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -2218,17 +2218,17 @@ nsresult nsImapService::GetImapConnectio</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; aMsgIncomingServer;</span>
<a href="#l18.25"></a><span id="l18.25">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl = do_QueryInterface(aImapUrl);</span>
<a href="#l18.26"></a><span id="l18.26">   nsresult rv = msgUrl-&gt;GetServer(getter_AddRefs(aMsgIncomingServer));</span>
<a href="#l18.27"></a><span id="l18.27">     </span>
<a href="#l18.28"></a><span id="l18.28">   if (aURL)</span>
<a href="#l18.29"></a><span id="l18.29">   {</span>
<a href="#l18.30"></a><span id="l18.30">     nsCOMPtr&lt;nsIURI&gt; msgUrlUri = do_QueryInterface(msgUrl);</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    msgUrlUri.swap(*aURL);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    msgUrlUri.forget(aURL);</span>
<a href="#l18.33"></a><span id="l18.33">   }</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35">   if (NS_SUCCEEDED(rv) &amp;&amp; aMsgIncomingServer)</span>
<a href="#l18.36"></a><span id="l18.36">   {</span>
<a href="#l18.37"></a><span id="l18.37">     nsCOMPtr&lt;nsIImapIncomingServer&gt; aImapServer(do_QueryInterface(aMsgIncomingServer, &amp;rv));</span>
<a href="#l18.38"></a><span id="l18.38">     if (NS_SUCCEEDED(rv) &amp;&amp; aImapServer)</span>
<a href="#l18.39"></a><span id="l18.39">       rv = aImapServer-&gt;GetImapConnectionAndLoadUrl(aImapUrl, aConsumer);</span>
<a href="#l18.40"></a><span id="l18.40">   }</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -2633,17 +2633,17 @@ NS_IMETHODIMP nsImapService::NewURI(cons</span>
<a href="#l18.42"></a><span id="l18.42">   bool mimePartSelectorDetected = false;</span>
<a href="#l18.43"></a><span id="l18.43">   aImapUrl-&gt;GetMimePartSelectorDetected(&amp;mimePartSelectorDetected);</span>
<a href="#l18.44"></a><span id="l18.44">   if (mimePartSelectorDetected)</span>
<a href="#l18.45"></a><span id="l18.45">     aImapUrl-&gt;SetFetchPartsOnDemand(true);</span>
<a href="#l18.46"></a><span id="l18.46"> </span>
<a href="#l18.47"></a><span id="l18.47">   // we got an imap url, so be sure to return it...</span>
<a href="#l18.48"></a><span id="l18.48">   nsCOMPtr&lt;nsIURI&gt; imapUri = do_QueryInterface(aImapUrl);</span>
<a href="#l18.49"></a><span id="l18.49"> </span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-  imapUri.swap(*aRetVal);</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+  imapUri.forget(aRetVal);</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">   return rv;</span>
<a href="#l18.54"></a><span id="l18.54"> }</span>
<a href="#l18.55"></a><span id="l18.55"> </span>
<a href="#l18.56"></a><span id="l18.56"> NS_IMETHODIMP nsImapService::NewChannel(nsIURI *aURI, nsIChannel **aRetVal)</span>
<a href="#l18.57"></a><span id="l18.57"> {</span>
<a href="#l18.58"></a><span id="l18.58">   return NewChannel2(aURI, nullptr, aRetVal);</span>
<a href="#l18.59"></a><span id="l18.59"> }</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineat">@@ -2891,17 +2891,17 @@ NS_IMETHODIMP nsImapService::GetDefaultL</span>
<a href="#l18.61"></a><span id="l18.61">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.62"></a><span id="l18.62"> </span>
<a href="#l18.63"></a><span id="l18.63">   if (!havePref || !exists)</span>
<a href="#l18.64"></a><span id="l18.64">   {</span>
<a href="#l18.65"></a><span id="l18.65">     rv = NS_SetPersistentFile(PREF_MAIL_ROOT_IMAP_REL, PREF_MAIL_ROOT_IMAP, localFile);</span>
<a href="#l18.66"></a><span id="l18.66">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Failed to set root dir pref.&quot;);</span>
<a href="#l18.67"></a><span id="l18.67">   }</span>
<a href="#l18.68"></a><span id="l18.68"> </span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-  localFile.swap(*aResult);</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+  localFile.forget(aResult);</span>
<a href="#l18.71"></a><span id="l18.71">   return NS_OK;</span>
<a href="#l18.72"></a><span id="l18.72"> }</span>
<a href="#l18.73"></a><span id="l18.73"> </span>
<a href="#l18.74"></a><span id="l18.74"> NS_IMETHODIMP nsImapService::GetServerIID(nsIID **aServerIID)</span>
<a href="#l18.75"></a><span id="l18.75"> {</span>
<a href="#l18.76"></a><span id="l18.76">   *aServerIID = new nsIID(NS_GET_IID(nsIImapIncomingServer));</span>
<a href="#l18.77"></a><span id="l18.77">   return NS_OK;</span>
<a href="#l18.78"></a><span id="l18.78"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1140,17 +1140,17 @@ nsImapUrl::GetMsgFile(nsIFile** aFile)</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> // this method is called from the UI thread..</span>
<a href="#l19.6"></a><span id="l19.6"> NS_IMETHODIMP nsImapUrl::GetMockChannel(nsIImapMockChannel ** aChannel)</span>
<a href="#l19.7"></a><span id="l19.7"> {</span>
<a href="#l19.8"></a><span id="l19.8">   NS_ENSURE_ARG_POINTER(aChannel);</span>
<a href="#l19.9"></a><span id="l19.9">   NS_WARNING_ASSERTION(NS_IsMainThread(), &quot;should only access mock channel on ui thread&quot;);</span>
<a href="#l19.10"></a><span id="l19.10">   *aChannel = nullptr;</span>
<a href="#l19.11"></a><span id="l19.11">   nsCOMPtr&lt;nsIImapMockChannel&gt; channel(do_QueryReferent(m_channelWeakPtr));</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  channel.swap(*aChannel);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  channel.forget(aChannel);</span>
<a href="#l19.14"></a><span id="l19.14">   return *aChannel ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l19.15"></a><span id="l19.15"> }</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17"> NS_IMETHODIMP nsImapUrl::SetMockChannel(nsIImapMockChannel * aChannel)</span>
<a href="#l19.18"></a><span id="l19.18"> {</span>
<a href="#l19.19"></a><span id="l19.19">   NS_WARNING_ASSERTION(NS_IsMainThread(), &quot;should only access mock channel on ui thread&quot;);</span>
<a href="#l19.20"></a><span id="l19.20">   m_channelWeakPtr = do_GetWeakReference(aChannel);</span>
<a href="#l19.21"></a><span id="l19.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -565,23 +565,20 @@ nsMsgLocalMailFolder::CreateSubfolderInt</span>
<a href="#l20.4"></a><span id="l20.4">   }</span>
<a href="#l20.5"></a><span id="l20.5">   else if (rv == NS_MSG_FOLDER_EXISTS)</span>
<a href="#l20.6"></a><span id="l20.6">   {</span>
<a href="#l20.7"></a><span id="l20.7">     ThrowAlertMsg(&quot;folderExists&quot;, msgWindow);</span>
<a href="#l20.8"></a><span id="l20.8">   }</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">   if (NS_SUCCEEDED(rv))</span>
<a href="#l20.11"></a><span id="l20.11">   {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; child = *aNewFolder;</span>
<a href="#l20.13"></a><span id="l20.13">     //we need to notify explicitly the flag change because it failed when we did AddSubfolder</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-    child-&gt;OnFlagChange(mFlags);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-    child-&gt;SetPrettyName(folderName);  //because empty trash will create a new trash folder</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-    NotifyItemAdded(child);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-    if (aNewFolder)</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-      child.swap(*aNewFolder);</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+    (*aNewFolder)-&gt;OnFlagChange(mFlags);</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+    (*aNewFolder)-&gt;SetPrettyName(folderName);  //because empty trash will create a new trash folder</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+    NotifyItemAdded(*aNewFolder);</span>
<a href="#l20.22"></a><span id="l20.22">   }</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">   return rv;</span>
<a href="#l20.25"></a><span id="l20.25"> }</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27"> NS_IMETHODIMP nsMsgLocalMailFolder::CompactAll(nsIUrlListener *aListener,</span>
<a href="#l20.28"></a><span id="l20.28">                                                nsIMsgWindow *aMsgWindow,</span>
<a href="#l20.29"></a><span id="l20.29">                                                bool aCompactOfflineAlso)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -557,17 +557,17 @@ NS_IMETHODIMP nsMailboxService::NewURI(c</span>
<a href="#l21.4"></a><span id="l21.4">     rv = aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l21.5"></a><span id="l21.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.6"></a><span id="l21.6">     (void) aMsgUri-&gt;SetSpec(newSpec);</span>
<a href="#l21.7"></a><span id="l21.7">   }</span>
<a href="#l21.8"></a><span id="l21.8">   else</span>
<a href="#l21.9"></a><span id="l21.9">   {</span>
<a href="#l21.10"></a><span id="l21.10">     (void) aMsgUri-&gt;SetSpec(aSpec);</span>
<a href="#l21.11"></a><span id="l21.11">   }</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  aMsgUri.swap(*_retval);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  aMsgUri.forget(_retval);</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15">   return rv;</span>
<a href="#l21.16"></a><span id="l21.16"> }</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18"> NS_IMETHODIMP nsMailboxService::NewChannel(nsIURI *aURI, nsIChannel **_retval)</span>
<a href="#l21.19"></a><span id="l21.19"> {</span>
<a href="#l21.20"></a><span id="l21.20">   return NewChannel2(aURI, nullptr, _retval);</span>
<a href="#l21.21"></a><span id="l21.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -246,17 +246,17 @@ NS_IMETHODIMP nsMsgMaildirStore::CreateF</span>
<a href="#l22.4"></a><span id="l22.4">     else</span>
<a href="#l22.5"></a><span id="l22.5">     {</span>
<a href="#l22.6"></a><span id="l22.6">       MOZ_LOG(MailDirLog, mozilla::LogLevel::Info,</span>
<a href="#l22.7"></a><span id="l22.7">             (&quot;CreateFolder - failed creating db for new folder\n&quot;));</span>
<a href="#l22.8"></a><span id="l22.8">       path-&gt;Remove(true); // recursive</span>
<a href="#l22.9"></a><span id="l22.9">       rv = NS_MSG_CANT_CREATE_FOLDER;</span>
<a href="#l22.10"></a><span id="l22.10">     }</span>
<a href="#l22.11"></a><span id="l22.11">   }</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  child.swap(*aResult);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  child.forget(aResult);</span>
<a href="#l22.14"></a><span id="l22.14">   return rv;</span>
<a href="#l22.15"></a><span id="l22.15"> }</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17"> NS_IMETHODIMP nsMsgMaildirStore::HasSpaceAvailable(nsIMsgFolder *aFolder,</span>
<a href="#l22.18"></a><span id="l22.18">                                                    int64_t aSpaceRequested,</span>
<a href="#l22.19"></a><span id="l22.19">                                                    bool *aResult)</span>
<a href="#l22.20"></a><span id="l22.20"> {</span>
<a href="#l22.21"></a><span id="l22.21">   NS_ENSURE_ARG_POINTER(aResult);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -197,17 +197,17 @@ nsMsgNewsFolder::AddNewsgroup(const nsAC</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">   // add kNewsSortOffset (9000) to prevent this problem:  1,10,11,2,3,4,5</span>
<a href="#l23.6"></a><span id="l23.6">   // We use 9000 instead of 1000 so newsgroups will sort to bottom of flat folder views</span>
<a href="#l23.7"></a><span id="l23.7">   rv = folder-&gt;SetSortOrder(numExistingGroups + kNewsSortOffset);</span>
<a href="#l23.8"></a><span id="l23.8">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10">   mSubFolders.AppendObject(folder);</span>
<a href="#l23.11"></a><span id="l23.11">   folder-&gt;SetParent(this);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  folder.swap(*child);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  folder.forget(child);</span>
<a href="#l23.14"></a><span id="l23.14">   return rv;</span>
<a href="#l23.15"></a><span id="l23.15"> }</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17"> nsresult nsMsgNewsFolder::ParseFolder(nsIFile *path)</span>
<a href="#l23.18"></a><span id="l23.18"> {</span>
<a href="#l23.19"></a><span id="l23.19">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l23.20"></a><span id="l23.20"> }</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -1512,17 +1512,17 @@ nsMsgNewsFolder::GetNntpServer(nsINntpIn</span>
<a href="#l23.23"></a><span id="l23.23">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l23.24"></a><span id="l23.24">   rv = GetServer(getter_AddRefs(server));</span>
<a href="#l23.25"></a><span id="l23.25">   if (NS_FAILED(rv))</span>
<a href="#l23.26"></a><span id="l23.26">     return rv;</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28">   nsCOMPtr&lt;nsINntpIncomingServer&gt; nntpServer = do_QueryInterface(server, &amp;rv);</span>
<a href="#l23.29"></a><span id="l23.29">   if (NS_FAILED(rv))</span>
<a href="#l23.30"></a><span id="l23.30">     return rv;</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-  nntpServer.swap(*result);</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+  nntpServer.forget(result);</span>
<a href="#l23.33"></a><span id="l23.33">   return NS_OK;</span>
<a href="#l23.34"></a><span id="l23.34"> }</span>
<a href="#l23.35"></a><span id="l23.35"> </span>
<a href="#l23.36"></a><span id="l23.36"> // this gets called after the message actually gets cancelled</span>
<a href="#l23.37"></a><span id="l23.37"> // it removes the cancelled message from the db</span>
<a href="#l23.38"></a><span id="l23.38"> NS_IMETHODIMP nsMsgNewsFolder::RemoveMessage(nsMsgKey key)</span>
<a href="#l23.39"></a><span id="l23.39"> {</span>
<a href="#l23.40"></a><span id="l23.40">   nsresult rv = GetDatabase();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -378,17 +378,17 @@ nsNntpService::FetchMessage(nsIMsgFolder</span>
<a href="#l24.4"></a><span id="l24.4">   rv = ConstructNntpUrl(messageIdURL.get(), aUrlListener, aMsgWindow, originalMessageUri.get(),</span>
<a href="#l24.5"></a><span id="l24.5">                         nsINntpUrl::ActionFetchArticle, getter_AddRefs(url));</span>
<a href="#l24.6"></a><span id="l24.6">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">   rv = RunNewsUrl(url, aMsgWindow, aConsumer);</span>
<a href="#l24.9"></a><span id="l24.9">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11">   if (aURL)</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    url.swap(*aURL);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    url.forget(aURL);</span>
<a href="#l24.14"></a><span id="l24.14">   return rv;</span>
<a href="#l24.15"></a><span id="l24.15"> }</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17"> NS_IMETHODIMP nsNntpService::FetchMimePart(nsIURI *aURI, const char *aMessageURI, nsISupports *aDisplayConsumer, nsIMsgWindow *aMsgWindow, nsIUrlListener *aUrlListener, nsIURI **aURL)</span>
<a href="#l24.18"></a><span id="l24.18"> {</span>
<a href="#l24.19"></a><span id="l24.19">   nsresult rv;</span>
<a href="#l24.20"></a><span id="l24.20">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl (do_QueryInterface(aURI, &amp;rv));</span>
<a href="#l24.21"></a><span id="l24.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -588,17 +588,17 @@ nsNntpService::GetFolderFromUri(const ch</span>
<a href="#l24.23"></a><span id="l24.23">   nsCString unescapedPath;</span>
<a href="#l24.24"></a><span id="l24.24">   MsgUnescapeString(Substring(path, 1), 0, unescapedPath); /* skip the leading slash */</span>
<a href="#l24.25"></a><span id="l24.25"> </span>
<a href="#l24.26"></a><span id="l24.26">   nsCOMPtr&lt;nsIMsgFolder&gt; subFolder;</span>
<a href="#l24.27"></a><span id="l24.27">   rv = rootFolder-&gt;GetChildNamed(NS_ConvertUTF8toUTF16(unescapedPath),</span>
<a href="#l24.28"></a><span id="l24.28">                                  getter_AddRefs(subFolder));</span>
<a href="#l24.29"></a><span id="l24.29">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-  subFolder.swap(*aFolder);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+  subFolder.forget(aFolder);</span>
<a href="#l24.33"></a><span id="l24.33">   return NS_OK;</span>
<a href="#l24.34"></a><span id="l24.34"> }</span>
<a href="#l24.35"></a><span id="l24.35"> </span>
<a href="#l24.36"></a><span id="l24.36"> NS_IMETHODIMP</span>
<a href="#l24.37"></a><span id="l24.37"> nsNntpService::CopyMessage(const char * aSrcMessageURI, nsIStreamListener * aMailboxCopyHandler, bool moveMessage,</span>
<a href="#l24.38"></a><span id="l24.38">                            nsIUrlListener * aUrlListener, nsIMsgWindow *aMsgWindow, nsIURI **aURL)</span>
<a href="#l24.39"></a><span id="l24.39"> {</span>
<a href="#l24.40"></a><span id="l24.40">   NS_ENSURE_ARG_POINTER(aSrcMessageURI);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

