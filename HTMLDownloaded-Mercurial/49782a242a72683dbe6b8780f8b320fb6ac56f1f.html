<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 5790:49782a242a72683dbe6b8780f8b320fb6ac56f1f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 49782a242a72683dbe6b8780f8b320fb6ac56f1f" />
<meta property="og:url" content="/comm-central/rev/49782a242a72683dbe6b8780f8b320fb6ac56f1f" />
<meta property="og:description" content="Bug 377319 Convert mailnews/base/src to the external API r=Neil sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 49782a242a72683dbe6b8780f8b320fb6ac56f1f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/49782a242a72683dbe6b8780f8b320fb6ac56f1f">shortlog</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/49782a242a72683dbe6b8780f8b320fb6ac56f1f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f">files</a> |
changeset |
<a href="/comm-central/raw-rev/49782a242a72683dbe6b8780f8b320fb6ac56f1f">raw</a>  | <a href="/comm-central/archive/49782a242a72683dbe6b8780f8b320fb6ac56f1f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=377319">Bug 377319</a> Convert mailnews/base/src to the external API r=Neil sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#97;&#110;&#32;&#72;&#111;&#114;&#97;&#107;&#32;&#60;&#106;&#104;&#111;&#114;&#97;&#107;&#64;&#114;&#101;&#100;&#104;&#97;&#116;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 10 Jun 2010 11:09:35 +0100</td></tr>

<tr>
 <td>changeset 5790</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/49782a242a72683dbe6b8780f8b320fb6ac56f1f">49782a242a72683dbe6b8780f8b320fb6ac56f1f</a></td>
</tr>



<tr>
<td>parent 5789</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/12981f9325ed8d19fe8c6b3cf355770419e15b65">12981f9325ed8d19fe8c6b3cf355770419e15b65</a>
</td>
</tr>

<tr>
<td>child 5791</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c2c24182c9312dddfe5c85a5be5eb5fe23995845">c2c24182c9312dddfe5c85a5be5eb5fe23995845</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=49782a242a72683dbe6b8780f8b320fb6ac56f1f">4489</a></td></tr>
<tr><td>push user</td><td>neil@parkwaycc.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Thu, 10 Jun 2010 10:10:37 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c2c24182c931 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c2c24182c9312dddfe5c85a5be5eb5fe23995845">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c2c24182c9312dddfe5c85a5be5eb5fe23995845&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c2c24182c9312dddfe5c85a5be5eb5fe23995845&newProject=comm-central&newRevision=12981f9325ed8d19fe8c6b3cf355770419e15b65&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c2c24182c9312dddfe5c85a5be5eb5fe23995845&newProject=comm-central&newRevision=12981f9325ed8d19fe8c6b3cf355770419e15b65&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c2c24182c9312dddfe5c85a5be5eb5fe23995845&newProject=comm-central&newRevision=12981f9325ed8d19fe8c6b3cf355770419e15b65&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=377319">377319</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=377319">Bug 377319</a> Convert mailnews/base/src to the external API r=Neil sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsCidProtocolHandler.cpp">mailnews/base/src/nsCidProtocolHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsCidProtocolHandler.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsCidProtocolHandler.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsCidProtocolHandler.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsCidProtocolHandler.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsCidProtocolHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.cpp">mailnews/base/src/nsMailDirProvider.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.h">mailnews/base/src/nsMailDirProvider.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMailDirProvider.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerBootstrap.cpp">mailnews/base/src/nsMessengerBootstrap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerBootstrap.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerBootstrap.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerBootstrap.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerBootstrap.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerBootstrap.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerContentHandler.cpp">mailnews/base/src/nsMessengerContentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerContentHandler.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerContentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerContentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerContentHandler.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerContentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOS2Integration.cpp">mailnews/base/src/nsMessengerOS2Integration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOS2Integration.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOS2Integration.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOS2Integration.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOS2Integration.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOS2Integration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.h">mailnews/base/src/nsMessengerOSXIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.mm">mailnews/base/src/nsMessengerOSXIntegration.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.mm">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.mm">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.mm">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.mm">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerOSXIntegration.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.h">mailnews/base/src/nsMessengerWinIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMessengerWinIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.cpp">mailnews/base/src/nsMsgAccount.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.h">mailnews/base/src/nsMsgAccount.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccount.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.h">mailnews/base/src/nsMsgAccountManagerDS.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgAccountManagerDS.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgBiffManager.cpp">mailnews/base/src/nsMsgBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgCopyService.cpp">mailnews/base/src/nsMsgCopyService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgCopyService.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgCopyService.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgCopyService.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgCopyService.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgCopyService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCache.cpp">mailnews/base/src/nsMsgFolderCache.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCache.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCache.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCache.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCache.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCache.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderNotificationService.h">mailnews/base/src/nsMsgFolderNotificationService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderNotificationService.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderNotificationService.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderNotificationService.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderNotificationService.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgFolderNotificationService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupThread.cpp">mailnews/base/src/nsMsgGroupThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupThread.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupThread.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupThread.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupThread.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupView.cpp">mailnews/base/src/nsMsgGroupView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupView.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupView.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupView.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupView.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgGroupView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgOfflineManager.cpp">mailnews/base/src/nsMsgOfflineManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgOfflineManager.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgOfflineManager.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgOfflineManager.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgOfflineManager.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgOfflineManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.cpp">mailnews/base/src/nsMsgProgress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.h">mailnews/base/src/nsMsgProgress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgProgress.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPurgeService.cpp">mailnews/base/src/nsMsgPurgeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPurgeService.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPurgeService.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPurgeService.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPurgeService.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgPurgeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgQuickSearchDBView.cpp">mailnews/base/src/nsMsgQuickSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgQuickSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgQuickSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgQuickSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgQuickSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgQuickSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFDataSource.cpp">mailnews/base/src/nsMsgRDFDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFDataSource.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFDataSource.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFUtils.cpp">mailnews/base/src/nsMsgRDFUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFUtils.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFUtils.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFUtils.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFUtils.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgRDFUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgStatusFeedback.cpp">mailnews/base/src/nsMsgStatusFeedback.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgStatusFeedback.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgStatusFeedback.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgStatusFeedback.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgStatusFeedback.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgStatusFeedback.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.cpp">mailnews/base/src/nsMsgTagService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.h">mailnews/base/src/nsMsgTagService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgTagService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgWindow.cpp">mailnews/base/src/nsMsgWindow.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgWindow.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgWindow.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgWindow.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgWindow.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgWindow.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.h">mailnews/base/src/nsSpamSettings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.h">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.h">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.h">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.h">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSpamSettings.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsStatusBarBiffManager.cpp">mailnews/base/src/nsStatusBarBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsStatusBarBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsStatusBarBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsStatusBarBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsStatusBarBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsStatusBarBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribableServer.cpp">mailnews/base/src/nsSubscribableServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribableServer.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribableServer.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribableServer.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribableServer.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribableServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribeDataSource.cpp">mailnews/base/src/nsSubscribeDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribeDataSource.cpp">file</a> |
<a href="/comm-central/annotate/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribeDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribeDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribeDataSource.cpp">comparison</a> |
<a href="/comm-central/log/49782a242a72683dbe6b8780f8b320fb6ac56f1f/mailnews/base/src/nsSubscribeDataSource.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/src/nsCidProtocolHandler.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/src/nsCidProtocolHandler.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -32,17 +32,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l1.5"></a><span id="l1.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l1.6"></a><span id="l1.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l1.7"></a><span id="l1.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.8"></a><span id="l1.8">  *</span>
<a href="#l1.9"></a><span id="l1.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsCidProtocolHandler.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsIURI.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> nsCidProtocolHandler::nsCidProtocolHandler()</span>
<a href="#l1.19"></a><span id="l1.19"> {</span>
<a href="#l1.20"></a><span id="l1.20"> }</span>
<a href="#l1.21"></a><span id="l1.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -41,16 +41,18 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIChromeRegistry.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+#include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> #define MAIL_DIR_50_NAME             &quot;Mail&quot;</span>
<a href="#l2.16"></a><span id="l2.16"> #define IMAP_MAIL_DIR_50_NAME        &quot;ImapMail&quot;</span>
<a href="#l2.17"></a><span id="l2.17"> #define NEWS_DIR_50_NAME             &quot;News&quot;</span>
<a href="#l2.18"></a><span id="l2.18"> #define MSG_FOLDER_CACHE_DIR_50_NAME &quot;panacea.dat&quot;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> nsresult</span>
<a href="#l2.21"></a><span id="l2.21"> nsMailDirProvider::EnsureDirectory(nsIFile *aDirectory)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMailDirProvider.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMailDirProvider.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -38,17 +38,18 @@</span>
<a href="#l3.4"></a><span id="l3.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> #ifndef nsMailDirProvider_h__</span>
<a href="#l3.7"></a><span id="l3.7"> #define nsMailDirProvider_h__</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsIGenericFactory.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsISimpleEnumerator.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> class nsMailDirProvider : public nsIDirectoryServiceProvider2</span>
<a href="#l3.17"></a><span id="l3.17"> {</span>
<a href="#l3.18"></a><span id="l3.18"> public:</span>
<a href="#l3.19"></a><span id="l3.19">   NS_DECL_ISUPPORTS</span>
<a href="#l3.20"></a><span id="l3.20">   NS_DECL_NSIDIRECTORYSERVICEPROVIDER</span>
<a href="#l3.21"></a><span id="l3.21">   NS_DECL_NSIDIRECTORYSERVICEPROVIDER2</span>
<a href="#l3.22"></a><span id="l3.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -41,17 +41,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;prsystem.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsMessenger.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> // xpcom</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsIStringStream.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l4.15"></a><span id="l4.15"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l4.16"></a><span id="l4.16"> #include &quot;nsQuickSort.h&quot;</span>
<a href="#l4.17"></a><span id="l4.17"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l4.18"></a><span id="l4.18"> #if defined(XP_MACOSX) &amp;&amp; !defined(__LP64__)</span>
<a href="#l4.19"></a><span id="l4.19"> #include &quot;nsIAppleFileDecoder.h&quot;</span>
<a href="#l4.20"></a><span id="l4.20"> #include &quot;nsILocalFileMac.h&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -86,17 +85,16 @@</span>
<a href="#l4.22"></a><span id="l4.22"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l4.23"></a><span id="l4.23"> #include &quot;nsIDocShellLoadInfo.h&quot;</span>
<a href="#l4.24"></a><span id="l4.24"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l4.25"></a><span id="l4.25"> #include &quot;nsIDocShellTreeNode.h&quot;</span>
<a href="#l4.26"></a><span id="l4.26"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28"> // mail</span>
<a href="#l4.29"></a><span id="l4.29"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l4.31"></a><span id="l4.31"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l4.32"></a><span id="l4.32"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l4.33"></a><span id="l4.33"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l4.34"></a><span id="l4.34"> #include &quot;nsIMailboxUrl.h&quot;</span>
<a href="#l4.35"></a><span id="l4.35"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l4.36"></a><span id="l4.36"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l4.37"></a><span id="l4.37"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l4.38"></a><span id="l4.38"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -152,16 +150,17 @@ static NS_DEFINE_CID(kMsgSendLaterCID, N</span>
<a href="#l4.40"></a><span id="l4.40"> //</span>
<a href="#l4.41"></a><span id="l4.41"> // Convert an nsString buffer to plain text...</span>
<a href="#l4.42"></a><span id="l4.42"> //</span>
<a href="#l4.43"></a><span id="l4.43"> #include &quot;nsIParser.h&quot;</span>
<a href="#l4.44"></a><span id="l4.44"> #include &quot;nsParserCIID.h&quot;</span>
<a href="#l4.45"></a><span id="l4.45"> #include &quot;nsICharsetConverterManager.h&quot;</span>
<a href="#l4.46"></a><span id="l4.46"> #include &quot;nsIContentSink.h&quot;</span>
<a href="#l4.47"></a><span id="l4.47"> #include &quot;nsIHTMLToTextSink.h&quot;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50"> static NS_DEFINE_CID(kCParserCID, NS_PARSER_CID);</span>
<a href="#l4.51"></a><span id="l4.51"> </span>
<a href="#l4.52"></a><span id="l4.52"> static nsresult</span>
<a href="#l4.53"></a><span id="l4.53"> ConvertBufToPlainText(nsString &amp;aConBuf)</span>
<a href="#l4.54"></a><span id="l4.54"> {</span>
<a href="#l4.55"></a><span id="l4.55">   if (aConBuf.IsEmpty())</span>
<a href="#l4.56"></a><span id="l4.56">     return NS_OK;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineat">@@ -204,17 +203,17 @@ static void ConvertAndSanitizeFileName(c</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59">   /* we need to convert the UTF-8 fileName to platform specific character set.</span>
<a href="#l4.60"></a><span id="l4.60">      The display name is in UTF-8 because it has been escaped from JS</span>
<a href="#l4.61"></a><span id="l4.61">   */</span>
<a href="#l4.62"></a><span id="l4.62">   MsgUnescapeString(nsDependentCString(displayName), 0, unescapedName);</span>
<a href="#l4.63"></a><span id="l4.63">   CopyUTF8toUTF16(unescapedName, aResult);</span>
<a href="#l4.64"></a><span id="l4.64"> </span>
<a href="#l4.65"></a><span id="l4.65">   // replace platform specific path separator and illegale characters to avoid any confusion</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-  aResult.ReplaceChar(FILE_PATH_SEPARATOR FILE_ILLEGAL_CHARACTERS, '-');</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+  MsgReplaceChar(aResult, FILE_PATH_SEPARATOR FILE_ILLEGAL_CHARACTERS, '-');</span>
<a href="#l4.68"></a><span id="l4.68"> }</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70"> // ***************************************************</span>
<a href="#l4.71"></a><span id="l4.71"> // jefft - this is a rather obscured class serves for Save Message As File,</span>
<a href="#l4.72"></a><span id="l4.72"> // Save Message As Template, and Save Attachment to a file</span>
<a href="#l4.73"></a><span id="l4.73"> //</span>
<a href="#l4.74"></a><span id="l4.74"> class nsSaveAllAttachmentsState;</span>
<a href="#l4.75"></a><span id="l4.75"> </span>
<a href="#l4.76"></a><span id="l4.76" class="difflineat">@@ -629,37 +628,37 @@ nsMessenger::LoadURL(nsIDOMWindowInterna</span>
<a href="#l4.77"></a><span id="l4.77">     rv = NS_NewURI(getter_AddRefs(fileUri), uriString);</span>
<a href="#l4.78"></a><span id="l4.78">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.79"></a><span id="l4.79">     nsCOMPtr &lt;nsIFileURL&gt; fileUrl = do_QueryInterface(fileUri, &amp;rv);</span>
<a href="#l4.80"></a><span id="l4.80">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.81"></a><span id="l4.81">     nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l4.82"></a><span id="l4.82">     rv = fileUrl-&gt;GetFile(getter_AddRefs(file));</span>
<a href="#l4.83"></a><span id="l4.83">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.84"></a><span id="l4.84">     file-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-    uriString.ReplaceSubstring(NS_LITERAL_STRING(&quot;file:&quot;), NS_LITERAL_STRING(&quot;mailbox:&quot;));</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+    uriString.Replace(0, 5, NS_LITERAL_STRING(&quot;mailbox:&quot;));</span>
<a href="#l4.87"></a><span id="l4.87">     uriString.Append(NS_LITERAL_STRING(&quot;&amp;number=0&quot;));</span>
<a href="#l4.88"></a><span id="l4.88">     loadingFromFile = PR_TRUE;</span>
<a href="#l4.89"></a><span id="l4.89">     getDummyMsgHdr = PR_TRUE;</span>
<a href="#l4.90"></a><span id="l4.90">   }</span>
<a href="#l4.91"></a><span id="l4.91">   else if (StringBeginsWith(uriString, NS_LITERAL_STRING(&quot;mailbox:&quot;)) &amp;&amp;</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-           (uriString.Find(NS_LITERAL_STRING(&quot;.eml?&quot;), PR_TRUE) != -1))</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+           (uriString.Find(NS_LITERAL_STRING(&quot;.eml?&quot;), CaseInsensitiveCompare) != -1))</span>
<a href="#l4.94"></a><span id="l4.94">   {</span>
<a href="#l4.95"></a><span id="l4.95">     // if we have a mailbox:// url that points to an .eml file, we have to read</span>
<a href="#l4.96"></a><span id="l4.96">     // the file size as well</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-    uriString.ReplaceSubstring(NS_LITERAL_STRING(&quot;mailbox:&quot;), NS_LITERAL_STRING(&quot;file:&quot;));</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+    uriString.Replace(0, 8, NS_LITERAL_STRING(&quot;file:&quot;));</span>
<a href="#l4.99"></a><span id="l4.99">     nsCOMPtr&lt;nsIURI&gt; fileUri;</span>
<a href="#l4.100"></a><span id="l4.100">     rv = NS_NewURI(getter_AddRefs(fileUri), uriString);</span>
<a href="#l4.101"></a><span id="l4.101">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.102"></a><span id="l4.102">     nsCOMPtr &lt;nsIFileURL&gt; fileUrl = do_QueryInterface(fileUri, &amp;rv);</span>
<a href="#l4.103"></a><span id="l4.103">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.104"></a><span id="l4.104">     nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l4.105"></a><span id="l4.105">     rv = fileUrl-&gt;GetFile(getter_AddRefs(file));</span>
<a href="#l4.106"></a><span id="l4.106">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.107"></a><span id="l4.107">     file-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-    uriString.ReplaceSubstring(NS_LITERAL_STRING(&quot;file:&quot;), NS_LITERAL_STRING(&quot;mailbox:&quot;));</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+    uriString.Replace(0, 5, NS_LITERAL_STRING(&quot;mailbox:&quot;));</span>
<a href="#l4.110"></a><span id="l4.110">     loadingFromFile = PR_TRUE;</span>
<a href="#l4.111"></a><span id="l4.111">     getDummyMsgHdr = PR_TRUE;</span>
<a href="#l4.112"></a><span id="l4.112">   }</span>
<a href="#l4.113"></a><span id="l4.113">   else if (uriString.Find(&quot;type=application/x-message-display&quot;) &gt;= 0)</span>
<a href="#l4.114"></a><span id="l4.114">     getDummyMsgHdr = PR_TRUE;</span>
<a href="#l4.115"></a><span id="l4.115"> </span>
<a href="#l4.116"></a><span id="l4.116">   nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l4.117"></a><span id="l4.117">   rv = NS_NewURI(getter_AddRefs(uri), uriString);</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineat">@@ -802,42 +801,40 @@ nsresult nsMessenger::SaveAttachment(nsI</span>
<a href="#l4.119"></a><span id="l4.119">   {</span>
<a href="#l4.120"></a><span id="l4.120">     urlString.Cut(typeIndex, sizeof(&quot;?type=application/x-message-display&quot;) - 1);</span>
<a href="#l4.121"></a><span id="l4.121">     // we also need to replace the next '&amp;' with '?'</span>
<a href="#l4.122"></a><span id="l4.122">     PRInt32 firstPartIndex = urlString.FindChar('&amp;');</span>
<a href="#l4.123"></a><span id="l4.123">     if (firstPartIndex != kNotFound)</span>
<a href="#l4.124"></a><span id="l4.124">       urlString.SetCharAt('?', firstPartIndex);</span>
<a href="#l4.125"></a><span id="l4.125">   }</span>
<a href="#l4.126"></a><span id="l4.126"> </span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-  urlString.ReplaceSubstring(&quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+  MsgReplaceSubstring(urlString, &quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l4.129"></a><span id="l4.129">   nsresult rv = CreateStartupUrl(urlString.get(), getter_AddRefs(URL));</span>
<a href="#l4.130"></a><span id="l4.130"> </span>
<a href="#l4.131"></a><span id="l4.131">   if (NS_SUCCEEDED(rv))</span>
<a href="#l4.132"></a><span id="l4.132">   {</span>
<a href="#l4.133"></a><span id="l4.133">     rv = GetMessageServiceFromURI(aMessageUri, getter_AddRefs(messageService));</span>
<a href="#l4.134"></a><span id="l4.134">     if (NS_SUCCEEDED(rv))</span>
<a href="#l4.135"></a><span id="l4.135">     {</span>
<a href="#l4.136"></a><span id="l4.136">       fetchService = do_QueryInterface(messageService);</span>
<a href="#l4.137"></a><span id="l4.137">       // if the message service has a fetch part service then we know we can fetch mime parts...</span>
<a href="#l4.138"></a><span id="l4.138">       if (fetchService)</span>
<a href="#l4.139"></a><span id="l4.139">       {</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-        nsCString mimePart;</span>
<a href="#l4.141"></a><span id="l4.141">         PRInt32 sectionPos = urlString.Find(&quot;?section&quot;);</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-        urlString.Right(mimePart, urlString.Length() - sectionPos);</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-        fullMessageUri.Append(mimePart);</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+        fullMessageUri.Append(Substring(urlString, sectionPos));</span>
<a href="#l4.145"></a><span id="l4.145">       }</span>
<a href="#l4.146"></a><span id="l4.146"> </span>
<a href="#l4.147"></a><span id="l4.147">       nsCOMPtr&lt;nsIStreamListener&gt; convertedListener;</span>
<a href="#l4.148"></a><span id="l4.148">       saveListener-&gt;QueryInterface(NS_GET_IID(nsIStreamListener),</span>
<a href="#l4.149"></a><span id="l4.149">                                  getter_AddRefs(convertedListener));</span>
<a href="#l4.150"></a><span id="l4.150"> </span>
<a href="#l4.151"></a><span id="l4.151"> #ifndef XP_MACOSX</span>
<a href="#l4.152"></a><span id="l4.152">       // if the content type is bin hex we are going to do a hokey hack and make sure we decode the bin hex</span>
<a href="#l4.153"></a><span id="l4.153">       // when saving an attachment to disk..</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-      if (aContentType.LowerCaseEqualsLiteral(APPLICATION_BINHEX))</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+      if (MsgLowerCaseEqualsLiteral(aContentType, APPLICATION_BINHEX))</span>
<a href="#l4.156"></a><span id="l4.156">       {</span>
<a href="#l4.157"></a><span id="l4.157">         nsCOMPtr&lt;nsIStreamListener&gt; listener (do_QueryInterface(convertedListener));</span>
<a href="#l4.158"></a><span id="l4.158">         nsCOMPtr&lt;nsIStreamConverterService&gt; streamConverterService = do_GetService(&quot;@mozilla.org/streamConverters;1&quot;, &amp;rv);</span>
<a href="#l4.159"></a><span id="l4.159">         nsCOMPtr&lt;nsISupports&gt; channelSupport = do_QueryInterface(saveListener-&gt;m_channel);</span>
<a href="#l4.160"></a><span id="l4.160"> </span>
<a href="#l4.161"></a><span id="l4.161">         rv = streamConverterService-&gt;AsyncConvertData(APPLICATION_BINHEX,</span>
<a href="#l4.162"></a><span id="l4.162">                                                       &quot;*/*&quot;,</span>
<a href="#l4.163"></a><span id="l4.163">                                                       listener,</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineat">@@ -1286,23 +1283,23 @@ nsMessenger::GetSaveAsFile(const nsAStri</span>
<a href="#l4.165"></a><span id="l4.165"> </span>
<a href="#l4.166"></a><span id="l4.166">   // If All Files was selected, look at the extension</span>
<a href="#l4.167"></a><span id="l4.167">   if (selectedSaveAsFileType == ANY_FILE_TYPE)</span>
<a href="#l4.168"></a><span id="l4.168">   {</span>
<a href="#l4.169"></a><span id="l4.169">     nsAutoString fileName;</span>
<a href="#l4.170"></a><span id="l4.170">     rv = localFile-&gt;GetLeafName(fileName);</span>
<a href="#l4.171"></a><span id="l4.171">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.172"></a><span id="l4.172"> </span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-    if ((fileName.RFind(HTML_FILE_EXTENSION, PR_TRUE, -1,</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-                        sizeof(HTML_FILE_EXTENSION) - 1) != kNotFound) ||</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-        (fileName.RFind(HTML_FILE_EXTENSION2, PR_TRUE, -1,</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-                        sizeof(HTML_FILE_EXTENSION2) - 1) != kNotFound))</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+    if (StringEndsWith(fileName, NS_LITERAL_STRING(HTML_FILE_EXTENSION),</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+                       nsCaseInsensitiveStringComparator()) ||</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+        StringEndsWith(fileName, NS_LITERAL_STRING(HTML_FILE_EXTENSION2),</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+                       nsCaseInsensitiveStringComparator()))</span>
<a href="#l4.181"></a><span id="l4.181">       *aSaveAsFileType = HTML_FILE_TYPE;</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-    else if (fileName.RFind(TEXT_FILE_EXTENSION, PR_TRUE, -1,</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-                            sizeof(TEXT_FILE_EXTENSION)-1) != kNotFound)</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+    else if (StringEndsWith(fileName, NS_LITERAL_STRING(TEXT_FILE_EXTENSION),</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+                            nsCaseInsensitiveStringComparator()) != kNotFound)</span>
<a href="#l4.186"></a><span id="l4.186">       *aSaveAsFileType = TEXT_FILE_TYPE;</span>
<a href="#l4.187"></a><span id="l4.187">     else</span>
<a href="#l4.188"></a><span id="l4.188">       // The default is .eml</span>
<a href="#l4.189"></a><span id="l4.189">       *aSaveAsFileType = EML_FILE_TYPE;</span>
<a href="#l4.190"></a><span id="l4.190">   }</span>
<a href="#l4.191"></a><span id="l4.191">   else</span>
<a href="#l4.192"></a><span id="l4.192">   {</span>
<a href="#l4.193"></a><span id="l4.193">     *aSaveAsFileType = selectedSaveAsFileType;</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineat">@@ -1469,18 +1466,20 @@ nsMessenger::MessageServiceFromURI(const</span>
<a href="#l4.195"></a><span id="l4.195"> </span>
<a href="#l4.196"></a><span id="l4.196"> NS_IMETHODIMP</span>
<a href="#l4.197"></a><span id="l4.197"> nsMessenger::MsgHdrFromURI(const nsACString&amp; aUri, nsIMsgDBHdr **aMsgHdr)</span>
<a href="#l4.198"></a><span id="l4.198"> {</span>
<a href="#l4.199"></a><span id="l4.199">   NS_ENSURE_ARG_POINTER(aMsgHdr);</span>
<a href="#l4.200"></a><span id="l4.200">   nsCOMPtr &lt;nsIMsgMessageService&gt; msgService;</span>
<a href="#l4.201"></a><span id="l4.201">   nsresult rv;</span>
<a href="#l4.202"></a><span id="l4.202"> </span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-  if (mMsgWindow &amp;&amp; (StringBeginsWith(aUri, NS_LITERAL_CSTRING(&quot;file:&quot;)) ||</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-                     nsDependentCString(aUri).Find(&quot;type=application/x-message-display&quot;) &gt;= 0))</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineplus">+</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+  if (mMsgWindow &amp;&amp;</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+      (StringBeginsWith(aUri, NS_LITERAL_CSTRING(&quot;file:&quot;)) ||</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+       PromiseFlatCString(aUri).Find(&quot;type=application/x-message-display&quot;) &gt;= 0))</span>
<a href="#l4.209"></a><span id="l4.209">   {</span>
<a href="#l4.210"></a><span id="l4.210">     nsCOMPtr &lt;nsIMsgHeaderSink&gt; headerSink;</span>
<a href="#l4.211"></a><span id="l4.211">     mMsgWindow-&gt;GetMsgHeaderSink(getter_AddRefs(headerSink));</span>
<a href="#l4.212"></a><span id="l4.212">     if (headerSink)</span>
<a href="#l4.213"></a><span id="l4.213">     {</span>
<a href="#l4.214"></a><span id="l4.214">       rv = headerSink-&gt;GetDummyMsgHeader(aMsgHdr);</span>
<a href="#l4.215"></a><span id="l4.215">       // Is there a way to check if they're asking for the hdr currently</span>
<a href="#l4.216"></a><span id="l4.216">       // displayed in a stand-alone msg window from a .eml file?</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineat">@@ -1839,18 +1838,18 @@ nsresult nsSaveMsgListener::InitializeDo</span>
<a href="#l4.218"></a><span id="l4.218">         </span>
<a href="#l4.219"></a><span id="l4.219">           // now store the web progresslistener</span>
<a href="#l4.220"></a><span id="l4.220">         mTransfer = tr;</span>
<a href="#l4.221"></a><span id="l4.221">       }</span>
<a href="#l4.222"></a><span id="l4.222">     }</span>
<a href="#l4.223"></a><span id="l4.223">     </span>
<a href="#l4.224"></a><span id="l4.224"> #if defined(XP_MACOSX) &amp;&amp; !defined(__LP64__)</span>
<a href="#l4.225"></a><span id="l4.225">     /* if we are saving an appledouble or applesingle attachment, we need to use an Apple File Decoder */</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineminus">-    if (m_contentType.LowerCaseEqualsLiteral(APPLICATION_APPLEFILE) ||</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineminus">-        m_contentType.LowerCaseEqualsLiteral(MULTIPART_APPLEDOUBLE))</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+    if (MsgLowerCaseEqualsLiteral(m_contentType, APPLICATION_APPLEFILE) ||</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+        MsgLowerCaseEqualsLiteral(m_contentType, MULTIPART_APPLEDOUBLE))</span>
<a href="#l4.230"></a><span id="l4.230">     {</span>
<a href="#l4.231"></a><span id="l4.231">       nsCOMPtr&lt;nsIAppleFileDecoder&gt; appleFileDecoder = do_CreateInstance(NS_IAPPLEFILEDECODER_CONTRACTID, &amp;rv);</span>
<a href="#l4.232"></a><span id="l4.232">       if (NS_SUCCEEDED(rv) &amp;&amp; appleFileDecoder)</span>
<a href="#l4.233"></a><span id="l4.233">       {</span>
<a href="#l4.234"></a><span id="l4.234">         rv = appleFileDecoder-&gt;Initialize(m_outputStream, outputFile);</span>
<a href="#l4.235"></a><span id="l4.235">         if (NS_SUCCEEDED(rv))</span>
<a href="#l4.236"></a><span id="l4.236">           m_outputStream = do_QueryInterface(appleFileDecoder, &amp;rv);</span>
<a href="#l4.237"></a><span id="l4.237">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -46,16 +46,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> NS_IMPL_THREADSAFE_ADDREF(nsMessengerBootstrap)</span>
<a href="#l5.16"></a><span id="l5.16"> NS_IMPL_THREADSAFE_RELEASE(nsMessengerBootstrap)</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> NS_IMPL_QUERY_INTERFACE1(nsMessengerBootstrap, nsIMessengerWindowService)</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> nsMessengerBootstrap::nsMessengerBootstrap()</span>
<a href="#l5.21"></a><span id="l5.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerContentHandler.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerContentHandler.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -43,16 +43,17 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsIURL.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;plstr.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsIURL.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> </span>
<a href="#l6.14"></a><span id="l6.14"> nsMessengerContentHandler::nsMessengerContentHandler()</span>
<a href="#l6.15"></a><span id="l6.15"> {</span>
<a href="#l6.16"></a><span id="l6.16"> }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> /* the following macro actually implement addref, release and query interface for our component. */</span>
<a href="#l6.19"></a><span id="l6.19"> NS_IMPL_ISUPPORTS1(nsMessengerContentHandler, nsIContentHandler)</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -79,17 +80,19 @@ NS_IMETHODIMP nsMessengerContentHandler:</span>
<a href="#l6.22"></a><span id="l6.22">       rv = request-&gt;Cancel(NS_ERROR_ABORT);</span>
<a href="#l6.23"></a><span id="l6.23">       if (NS_SUCCEEDED(rv))</span>
<a href="#l6.24"></a><span id="l6.24">       {</span>
<a href="#l6.25"></a><span id="l6.25">         nsCOMPtr&lt;nsIURL&gt; aUrl = do_QueryInterface(aUri);</span>
<a href="#l6.26"></a><span id="l6.26">         if (aUrl)</span>
<a href="#l6.27"></a><span id="l6.27">         {</span>
<a href="#l6.28"></a><span id="l6.28">           nsCAutoString queryPart;</span>
<a href="#l6.29"></a><span id="l6.29">           aUrl-&gt;GetQuery(queryPart);</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-          queryPart.ReplaceSubstring(&quot;type=message/rfc822&quot;, &quot;type=application/x-message-display&quot;);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+          queryPart.Replace(queryPart.Find(&quot;type=message/rfc822&quot;),</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+                            sizeof(&quot;type=message/rfc822&quot;) - 1,</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+                            &quot;type=application/x-message-display&quot;);</span>
<a href="#l6.34"></a><span id="l6.34">           aUrl-&gt;SetQuery(queryPart);</span>
<a href="#l6.35"></a><span id="l6.35">           rv = OpenWindow(aUri);</span>
<a href="#l6.36"></a><span id="l6.36">         }</span>
<a href="#l6.37"></a><span id="l6.37">       }</span>
<a href="#l6.38"></a><span id="l6.38">     }</span>
<a href="#l6.39"></a><span id="l6.39">   }</span>
<a href="#l6.40"></a><span id="l6.40"> </span>
<a href="#l6.41"></a><span id="l6.41">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOS2Integration.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOS2Integration.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -69,18 +69,18 @@ nsMessengerOS2Integration::nsMessengerOS</span>
<a href="#l7.4"></a><span id="l7.4"> #else</span>
<a href="#l7.5"></a><span id="l7.5">     rc = DosAllocSharedMem(&amp;pvObject, WARPCENTER_SHAREDMEM, sizeof(ULONG),</span>
<a href="#l7.6"></a><span id="l7.6">                            PAG_COMMIT | PAG_WRITE);</span>
<a href="#l7.7"></a><span id="l7.7"> #endif</span>
<a href="#l7.8"></a><span id="l7.8">     pUnreadState = (PULONG)pvObject;</span>
<a href="#l7.9"></a><span id="l7.9">   }</span>
<a href="#l7.10"></a><span id="l7.10">   *pUnreadState = 0;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  mBiffStateAtom = do_GetAtom(&quot;BiffState&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  mTotalUnreadMessagesAtom = do_GetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+  mTotalUnreadMessagesAtom = MsgGetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l7.16"></a><span id="l7.16"> }</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> nsMessengerOS2Integration::~nsMessengerOS2Integration()</span>
<a href="#l7.19"></a><span id="l7.19"> {</span>
<a href="#l7.20"></a><span id="l7.20">   PULONG pUnreadState = NULL;</span>
<a href="#l7.21"></a><span id="l7.21">   APIRET rc = DosGetNamedSharedMem((PVOID *)&amp;pUnreadState, WARPCENTER_SHAREDMEM,</span>
<a href="#l7.22"></a><span id="l7.22">                                    PAG_READ | PAG_WRITE);</span>
<a href="#l7.23"></a><span id="l7.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -41,17 +41,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #ifndef __nsMessengerOSXIntegration_h</span>
<a href="#l8.5"></a><span id="l8.5"> #define __nsMessengerOSXIntegration_h</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l8.8"></a><span id="l8.8"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsITimer.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14"> #include &quot;nsInt64.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16"> #include &quot;nsIAlertsService.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> #define NS_MESSENGEROSXINTEGRATION_CID \</span>
<a href="#l8.19"></a><span id="l8.19">   {0xaa83266, 0x4225, 0x4c4b, \</span>
<a href="#l8.20"></a><span id="l8.20">   {0x93, 0xf8, 0x94, 0xb1, 0x82, 0x58, 0x6f, 0x93}}</span>
<a href="#l8.21"></a><span id="l8.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -38,16 +38,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">  *</span>
<a href="#l9.5"></a><span id="l9.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> #ifdef MOZ_LOGGING</span>
<a href="#l9.8"></a><span id="l9.8"> #define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l9.9"></a><span id="l9.9"> #endif</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nscore.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;nsMessengerOSXIntegration.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> #include &quot;nsIMsgIdentity.h&quot;</span>
<a href="#l9.17"></a><span id="l9.17"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l9.18"></a><span id="l9.18"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l9.19"></a><span id="l9.19"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l9.20"></a><span id="l9.20"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -78,16 +79,18 @@</span>
<a href="#l9.22"></a><span id="l9.22"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l9.23"></a><span id="l9.23"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l9.24"></a><span id="l9.24"> #include &quot;nsMsgLocalCID.h&quot;</span>
<a href="#l9.25"></a><span id="l9.25"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l9.26"></a><span id="l9.26"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l9.27"></a><span id="l9.27"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l9.28"></a><span id="l9.28"> #include &quot;nsIMessenger.h&quot;</span>
<a href="#l9.29"></a><span id="l9.29"> #include &quot;nsObjCExceptions.h&quot;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33"> #include &lt;Carbon/Carbon.h&gt;</span>
<a href="#l9.34"></a><span id="l9.34"> #import &lt;Cocoa/Cocoa.h&gt;</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> #define kNewMailAlertIcon &quot;chrome://messenger/skin/icons/new-mail-alert.png&quot;</span>
<a href="#l9.37"></a><span id="l9.37"> #define kBiffShowAlertPref &quot;mail.biff.show_alert&quot;</span>
<a href="#l9.38"></a><span id="l9.38"> #define kCountInboxesPref &quot;mail.notification.count.inbox_only&quot;</span>
<a href="#l9.39"></a><span id="l9.39"> #define kMaxDisplayCount 10</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineat">@@ -216,19 +219,19 @@ static void openMailWindow(const nsCStri</span>
<a href="#l9.41"></a><span id="l9.41">     if (messengerWindowService)</span>
<a href="#l9.42"></a><span id="l9.42">       messengerWindowService-&gt;OpenMessengerWindowWithUri(</span>
<a href="#l9.43"></a><span id="l9.43">                                 &quot;mail:3pane&quot;, aUri.get(), nsMsgKey_None);</span>
<a href="#l9.44"></a><span id="l9.44">   }</span>
<a href="#l9.45"></a><span id="l9.45"> }</span>
<a href="#l9.46"></a><span id="l9.46"> </span>
<a href="#l9.47"></a><span id="l9.47"> nsMessengerOSXIntegration::nsMessengerOSXIntegration()</span>
<a href="#l9.48"></a><span id="l9.48"> {</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-  mBiffStateAtom = do_GetAtom(&quot;BiffState&quot;);</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-  mNewMailReceivedAtom = do_GetAtom(&quot;NewMailReceived&quot;);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-  mTotalUnreadMessagesAtom = do_GetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  mNewMailReceivedAtom = MsgGetAtom(&quot;NewMailReceived&quot;);</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+  mTotalUnreadMessagesAtom = MsgGetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l9.55"></a><span id="l9.55">   mUnreadTotal = 0;</span>
<a href="#l9.56"></a><span id="l9.56">   mNewTotal = 0;</span>
<a href="#l9.57"></a><span id="l9.57">   mOnlyCountInboxes = PR_TRUE;</span>
<a href="#l9.58"></a><span id="l9.58">   mOnLeopardOrLater = OnLeopardOrLater();</span>
<a href="#l9.59"></a><span id="l9.59">   mDoneInitialCount = PR_FALSE;</span>
<a href="#l9.60"></a><span id="l9.60"> }</span>
<a href="#l9.61"></a><span id="l9.61"> </span>
<a href="#l9.62"></a><span id="l9.62"> nsMessengerOSXIntegration::~nsMessengerOSXIntegration()</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineat">@@ -904,17 +907,17 @@ nsMessengerOSXIntegration::GetNewMailAut</span>
<a href="#l9.64"></a><span id="l9.64">           os-&gt;NotifyObservers(notify, &quot;newmail-notification-requested&quot;,</span>
<a href="#l9.65"></a><span id="l9.65">                               PromiseFlatString(author).get());</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67">           PRBool includeSender;</span>
<a href="#l9.68"></a><span id="l9.68">           notify-&gt;GetData(&amp;includeSender);</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70">           // Don't add unwanted or duplicate names</span>
<a href="#l9.71"></a><span id="l9.71">           if (includeSender &amp;&amp;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-              aAuthors.Find(name, PR_TRUE, 0, -1) == -1)</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+              aAuthors.Find(name.get(), PR_TRUE) == -1)</span>
<a href="#l9.74"></a><span id="l9.74">           {</span>
<a href="#l9.75"></a><span id="l9.75">             if (displayed &gt; 0)</span>
<a href="#l9.76"></a><span id="l9.76">               aAuthors.Append(listSeparator);</span>
<a href="#l9.77"></a><span id="l9.77">             aAuthors.Append(NS_ConvertUTF8toUTF16(name));</span>
<a href="#l9.78"></a><span id="l9.78">             displayed++;</span>
<a href="#l9.79"></a><span id="l9.79">           }</span>
<a href="#l9.80"></a><span id="l9.80">         }</span>
<a href="#l9.81"></a><span id="l9.81">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -63,19 +63,23 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #include &quot;nsIMessengerWindowService.h&quot;</span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;prprf.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsIWeakReference.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIAlertsService.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+#include &quot;nsIWeakReferenceUtils.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsToolkitCompsCID.h&quot; </span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> #define ALERT_CHROME_URL &quot;chrome://messenger/content/newmailalert.xul&quot;</span>
<a href="#l10.21"></a><span id="l10.21"> #define NEW_MAIL_ALERT_ICON &quot;chrome://messenger/skin/icons/new-mail-alert.png&quot;</span>
<a href="#l10.22"></a><span id="l10.22"> #define SHOW_ALERT_PREF &quot;mail.biff.show_alert&quot;</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24"> static void openMailWindow(const nsACString&amp; aFolderUri)</span>
<a href="#l10.25"></a><span id="l10.25"> {</span>
<a href="#l10.26"></a><span id="l10.26">   nsresult rv;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineat">@@ -110,17 +114,17 @@ static void openMailWindow(const nsACStr</span>
<a href="#l10.28"></a><span id="l10.28">     if (messengerWindowService)</span>
<a href="#l10.29"></a><span id="l10.29">       messengerWindowService-&gt;OpenMessengerWindowWithUri(</span>
<a href="#l10.30"></a><span id="l10.30">                                 &quot;mail:3pane&quot;, nsCString(aFolderUri).get(), nsMsgKey_None);</span>
<a href="#l10.31"></a><span id="l10.31">   }</span>
<a href="#l10.32"></a><span id="l10.32"> }</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34"> nsMessengerUnixIntegration::nsMessengerUnixIntegration()</span>
<a href="#l10.35"></a><span id="l10.35"> {</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-  mBiffStateAtom = do_GetAtom(&quot;BiffState&quot;);</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l10.38"></a><span id="l10.38">   mAlertInProgress = PR_FALSE;</span>
<a href="#l10.39"></a><span id="l10.39">   NS_NewISupportsArray(getter_AddRefs(mFoldersWithNewMail));</span>
<a href="#l10.40"></a><span id="l10.40"> }</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42"> NS_IMPL_ISUPPORTS3(nsMessengerUnixIntegration, nsIFolderListener, nsIObserver, nsIMessengerOSIntegration)</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44"> nsresult</span>
<a href="#l10.45"></a><span id="l10.45"> nsMessengerUnixIntegration::Init()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -71,16 +71,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #include &quot;nsIWeakReference.h&quot;</span>
<a href="#l11.5"></a><span id="l11.5"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsIAlertsService.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> </span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsToolkitCompsCID.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &lt;stdlib.h&gt;</span>
<a href="#l11.16"></a><span id="l11.16"> #define PROFILE_COMMANDLINE_ARG &quot; -profile &quot;</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18"> #define XP_SHSetUnreadMailCounts &quot;SHSetUnreadMailCountW&quot;</span>
<a href="#l11.19"></a><span id="l11.19"> #define XP_SHEnumerateUnreadMailAccounts &quot;SHEnumerateUnreadMailAccountsW&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> #define NOTIFICATIONCLASSNAME &quot;MailBiffNotificationMessageWindow&quot;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -243,23 +244,23 @@ static nsresult Create()</span>
<a href="#l11.22"></a><span id="l11.22">                                               0 ),        // create struct</span>
<a href="#l11.23"></a><span id="l11.23">                   NS_ERROR_FAILURE );</span>
<a href="#l11.24"></a><span id="l11.24">   return NS_OK;</span>
<a href="#l11.25"></a><span id="l11.25"> }</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28"> nsMessengerWinIntegration::nsMessengerWinIntegration()</span>
<a href="#l11.29"></a><span id="l11.29"> {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-  mDefaultServerAtom = do_GetAtom(&quot;DefaultServer&quot;);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  mTotalUnreadMessagesAtom = do_GetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  mDefaultServerAtom = MsgGetAtom(&quot;DefaultServer&quot;);</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+  mTotalUnreadMessagesAtom = MsgGetAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35">   mUnreadTimerActive = PR_FALSE;</span>
<a href="#l11.36"></a><span id="l11.36">   mStoreUnreadCounts = PR_FALSE;</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-  mBiffStateAtom = do_GetAtom(&quot;BiffState&quot;);</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+  mBiffStateAtom = MsgGetAtom(&quot;BiffState&quot;);</span>
<a href="#l11.40"></a><span id="l11.40">   mBiffIconVisible = PR_FALSE;</span>
<a href="#l11.41"></a><span id="l11.41">   mSuppressBiffIcon = PR_FALSE;</span>
<a href="#l11.42"></a><span id="l11.42">   mAlertInProgress = PR_FALSE;</span>
<a href="#l11.43"></a><span id="l11.43">   mBiffIconInitialized = PR_FALSE;</span>
<a href="#l11.44"></a><span id="l11.44">   NS_NewISupportsArray(getter_AddRefs(mFoldersWithNewMail));</span>
<a href="#l11.45"></a><span id="l11.45"> }</span>
<a href="#l11.46"></a><span id="l11.46"> </span>
<a href="#l11.47"></a><span id="l11.47"> nsMessengerWinIntegration::~nsMessengerWinIntegration()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -46,17 +46,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> // shellapi.h is needed to build with WIN32_LEAN_AND_MEAN</span>
<a href="#l12.5"></a><span id="l12.5"> #include &lt;shellapi.h&gt;</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;nsITimer.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14"> #include &quot;nsInt64.h&quot;</span>
<a href="#l12.15"></a><span id="l12.15"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> // this function is exported by shell32.dll version 5.60 or later (Windows XP or greater)</span>
<a href="#l12.19"></a><span id="l12.19"> extern &quot;C&quot;</span>
<a href="#l12.20"></a><span id="l12.20"> {</span>
<a href="#l12.21"></a><span id="l12.21"> typedef HRESULT (__stdcall *fnSHSetUnreadMailCount)(LPCWSTR pszMailAddress, DWORD dwCount, LPCWSTR pszShellExecuteCommand);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -39,25 +39,28 @@</span>
<a href="#l13.4"></a><span id="l13.4"> #include &quot;prprf.h&quot;</span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;plstr.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;prmem.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> #include &quot;nsMsgAccount.h&quot;</span>
<a href="#l13.19"></a><span id="l13.19"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l13.20"></a><span id="l13.20"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+#include &quot;nsMemory.h&quot;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26"> NS_IMPL_ISUPPORTS1(nsMsgAccount, nsIMsgAccount)</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28"> nsMsgAccount::nsMsgAccount()</span>
<a href="#l13.29"></a><span id="l13.29"> {</span>
<a href="#l13.30"></a><span id="l13.30"> }</span>
<a href="#l13.31"></a><span id="l13.31"> </span>
<a href="#l13.32"></a><span id="l13.32"> nsMsgAccount::~nsMsgAccount()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccount.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccount.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -33,17 +33,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.5"></a><span id="l14.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.6"></a><span id="l14.6">  *</span>
<a href="#l14.7"></a><span id="l14.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nscore.h&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l14.14"></a><span id="l14.14"> </span>
<a href="#l14.15"></a><span id="l14.15"> class nsMsgAccount : public nsIMsgAccount</span>
<a href="#l14.16"></a><span id="l14.16"> {</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> public:</span>
<a href="#l14.19"></a><span id="l14.19">   nsMsgAccount();</span>
<a href="#l14.20"></a><span id="l14.20">   virtual ~nsMsgAccount();</span>
<a href="#l14.21"></a><span id="l14.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -51,17 +51,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsMsgAccountManager.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;prmem.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;prcmon.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;prthread.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;plstr.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nscore.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;prprf.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsIURL.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -92,16 +92,17 @@</span>
<a href="#l15.23"></a><span id="l15.23"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l15.24"></a><span id="l15.24"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l15.25"></a><span id="l15.25"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l15.26"></a><span id="l15.26"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l15.27"></a><span id="l15.27"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l15.28"></a><span id="l15.28"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l15.29"></a><span id="l15.29"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l15.30"></a><span id="l15.30"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+#include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33"> #define PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS &quot;mail.accountmanager.accounts&quot;</span>
<a href="#l15.34"></a><span id="l15.34"> #define PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT &quot;mail.accountmanager.defaultaccount&quot;</span>
<a href="#l15.35"></a><span id="l15.35"> #define PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER &quot;mail.accountmanager.localfoldersserver&quot;</span>
<a href="#l15.36"></a><span id="l15.36"> #define PREF_MAIL_SERVER_PREFIX &quot;mail.server.&quot;</span>
<a href="#l15.37"></a><span id="l15.37"> #define ACCOUNT_PREFIX &quot;account&quot;</span>
<a href="#l15.38"></a><span id="l15.38"> #define SERVER_PREFIX &quot;server&quot;</span>
<a href="#l15.39"></a><span id="l15.39"> #define ID_PREFIX &quot;id&quot;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineat">@@ -1000,17 +1001,17 @@ hashCleanupOnExit(nsCStringHashKey::KeyT</span>
<a href="#l15.41"></a><span id="l15.41">            {</span>
<a href="#l15.42"></a><span id="l15.42">              rv = folder-&gt;EmptyTrash(nsnull, urlListener);</span>
<a href="#l15.43"></a><span id="l15.43">              if (isImap &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l15.44"></a><span id="l15.44">                accountManager-&gt;SetFolderDoingEmptyTrash(folder);</span>
<a href="#l15.45"></a><span id="l15.45">            }</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">            if (isImap &amp;&amp; urlListener)</span>
<a href="#l15.48"></a><span id="l15.48">            {</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-             nsIThread *thread = NS_GetCurrentThread();</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+             nsCOMPtr&lt;nsIThread&gt; thread(do_GetCurrentThread());</span>
<a href="#l15.51"></a><span id="l15.51"> </span>
<a href="#l15.52"></a><span id="l15.52">              PRBool inProgress = PR_FALSE;</span>
<a href="#l15.53"></a><span id="l15.53">              if (cleanupInboxOnExit)</span>
<a href="#l15.54"></a><span id="l15.54">              {</span>
<a href="#l15.55"></a><span id="l15.55">                PRInt32 loopCount = 0; // used to break out after 5 seconds</span>
<a href="#l15.56"></a><span id="l15.56">                accountManager-&gt;GetCleanupInboxInProgress(&amp;inProgress);</span>
<a href="#l15.57"></a><span id="l15.57">                while (inProgress &amp;&amp; loopCount++ &lt; 5000)</span>
<a href="#l15.58"></a><span id="l15.58">                {</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineat">@@ -1210,18 +1211,18 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l15.60"></a><span id="l15.60">   if (m_accountsLoaded)</span>
<a href="#l15.61"></a><span id="l15.61">     return NS_OK;</span>
<a href="#l15.62"></a><span id="l15.62"> </span>
<a href="#l15.63"></a><span id="l15.63">   // If we have code trying to do things after we've unloaded accounts,</span>
<a href="#l15.64"></a><span id="l15.64">   // ignore it.</span>
<a href="#l15.65"></a><span id="l15.65">   if (m_shutdownInProgress || m_haveShutdown)</span>
<a href="#l15.66"></a><span id="l15.66">     return NS_ERROR_FAILURE;</span>
<a href="#l15.67"></a><span id="l15.67"> </span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-  kDefaultServerAtom = do_GetAtom(&quot;DefaultServer&quot;);</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-  mFolderFlagAtom = do_GetAtom(&quot;FolderFlag&quot;);</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+  kDefaultServerAtom = MsgGetAtom(&quot;DefaultServer&quot;);</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+  mFolderFlagAtom = MsgGetAtom(&quot;FolderFlag&quot;);</span>
<a href="#l15.72"></a><span id="l15.72"> </span>
<a href="#l15.73"></a><span id="l15.73">   //Ensure biff service has started</span>
<a href="#l15.74"></a><span id="l15.74">   nsCOMPtr&lt;nsIMsgBiffManager&gt; biffService =</span>
<a href="#l15.75"></a><span id="l15.75">            do_GetService(NS_MSGBIFFMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l15.76"></a><span id="l15.76"> </span>
<a href="#l15.77"></a><span id="l15.77">   if (NS_SUCCEEDED(rv))</span>
<a href="#l15.78"></a><span id="l15.78">     biffService-&gt;Init();</span>
<a href="#l15.79"></a><span id="l15.79"> </span>
<a href="#l15.80"></a><span id="l15.80" class="difflineat">@@ -3007,17 +3008,17 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l15.81"></a><span id="l15.81">     while (isMore &amp;&amp;</span>
<a href="#l15.82"></a><span id="l15.82">            NS_SUCCEEDED(lineInputStream-&gt;ReadLine(buffer, &amp;isMore)))</span>
<a href="#l15.83"></a><span id="l15.83">     {</span>
<a href="#l15.84"></a><span id="l15.84">       if (!buffer.IsEmpty())</span>
<a href="#l15.85"></a><span id="l15.85">       {</span>
<a href="#l15.86"></a><span id="l15.86">         if (version == -1)</span>
<a href="#l15.87"></a><span id="l15.87">         {</span>
<a href="#l15.88"></a><span id="l15.88">           buffer.Cut(0, 8);</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-          PRInt32 irv;</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+          nsresult irv;</span>
<a href="#l15.91"></a><span id="l15.91">           version = buffer.ToInteger(&amp;irv, 10);</span>
<a href="#l15.92"></a><span id="l15.92">           continue;</span>
<a href="#l15.93"></a><span id="l15.93">         }</span>
<a href="#l15.94"></a><span id="l15.94">         if (Substring(buffer, 0, 4).Equals(&quot;uri=&quot;))</span>
<a href="#l15.95"></a><span id="l15.95">         {</span>
<a href="#l15.96"></a><span id="l15.96">           buffer.Cut(0, 4);</span>
<a href="#l15.97"></a><span id="l15.97">           dbFolderInfo = nsnull;</span>
<a href="#l15.98"></a><span id="l15.98"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -49,16 +49,20 @@</span>
<a href="#l16.4"></a><span id="l16.4"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+#include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17"> // turn this on to see useful output</span>
<a href="#l16.18"></a><span id="l16.18"> #undef DEBUG_amds</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> #define NC_RDF_PAGETITLE_PREFIX               NC_NAMESPACE_URI &quot;PageTitle&quot;</span>
<a href="#l16.21"></a><span id="l16.21"> #define NC_RDF_PAGETITLE_MAIN                 NC_RDF_PAGETITLE_PREFIX &quot;Main&quot;</span>
<a href="#l16.22"></a><span id="l16.22"> #define NC_RDF_PAGETITLE_SERVER               NC_RDF_PAGETITLE_PREFIX &quot;Server&quot;</span>
<a href="#l16.23"></a><span id="l16.23"> #define NC_RDF_PAGETITLE_COPIES               NC_RDF_PAGETITLE_PREFIX &quot;Copies&quot;</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineat">@@ -68,17 +72,17 @@</span>
<a href="#l16.25"></a><span id="l16.25"> #define NC_RDF_PAGETITLE_SMTP                 NC_RDF_PAGETITLE_PREFIX &quot;SMTP&quot;</span>
<a href="#l16.26"></a><span id="l16.26"> #define NC_RDF_PAGETITLE_JUNK                 NC_RDF_PAGETITLE_PREFIX &quot;Junk&quot;</span>
<a href="#l16.27"></a><span id="l16.27"> #define NC_RDF_PAGETAG NC_NAMESPACE_URI &quot;PageTag&quot;</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29"> </span>
<a href="#l16.30"></a><span id="l16.30"> #define NC_RDF_ACCOUNTROOT &quot;msgaccounts:/&quot;</span>
<a href="#l16.31"></a><span id="l16.31"> </span>
<a href="#l16.32"></a><span id="l16.32"> typedef struct _serverCreationParams {</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-  nsISupportsArray *serverArray;</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+  nsCOMArray&lt;nsIRDFResource&gt; *serverArray;</span>
<a href="#l16.35"></a><span id="l16.35">   nsIRDFService *rdfService;</span>
<a href="#l16.36"></a><span id="l16.36"> } serverCreationParams;</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38"> typedef struct {</span>
<a href="#l16.39"></a><span id="l16.39">   nsCString serverKey;</span>
<a href="#l16.40"></a><span id="l16.40">   PRBool found;</span>
<a href="#l16.41"></a><span id="l16.41"> } findServerByKeyEntry;</span>
<a href="#l16.42"></a><span id="l16.42"> </span>
<a href="#l16.43"></a><span id="l16.43" class="difflineat">@@ -121,18 +125,18 @@ nsIRDFResource* nsMsgAccountManagerDataS</span>
<a href="#l16.44"></a><span id="l16.44"> // common literals</span>
<a href="#l16.45"></a><span id="l16.45"> nsIRDFLiteral* nsMsgAccountManagerDataSource::kTrueLiteral = nsnull;</span>
<a href="#l16.46"></a><span id="l16.46"> </span>
<a href="#l16.47"></a><span id="l16.47"> nsIAtom* nsMsgAccountManagerDataSource::kDefaultServerAtom = nsnull;</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49"> nsrefcnt nsMsgAccountManagerDataSource::gAccountManagerResourceRefCnt = 0;</span>
<a href="#l16.50"></a><span id="l16.50"> </span>
<a href="#l16.51"></a><span id="l16.51"> // shared arc lists</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-nsCOMPtr&lt;nsISupportsArray&gt; nsMsgAccountManagerDataSource::mAccountArcsOut;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-nsCOMPtr&lt;nsISupportsArray&gt; nsMsgAccountManagerDataSource::mAccountRootArcsOut;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+nsCOMPtr&lt;nsIMutableArray&gt; nsMsgAccountManagerDataSource::mAccountArcsOut;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+nsCOMPtr&lt;nsIMutableArray&gt; nsMsgAccountManagerDataSource::mAccountRootArcsOut;</span>
<a href="#l16.56"></a><span id="l16.56"> </span>
<a href="#l16.57"></a><span id="l16.57"> </span>
<a href="#l16.58"></a><span id="l16.58"> // RDF to match</span>
<a href="#l16.59"></a><span id="l16.59"> #define NC_RDF_ACCOUNT NC_NAMESPACE_URI &quot;Account&quot;</span>
<a href="#l16.60"></a><span id="l16.60"> #define NC_RDF_SERVER  NC_NAMESPACE_URI &quot;Server&quot;</span>
<a href="#l16.61"></a><span id="l16.61"> #define NC_RDF_IDENTITY NC_NAMESPACE_URI &quot;Identity&quot;</span>
<a href="#l16.62"></a><span id="l16.62"> #define NC_RDF_SETTINGS NC_NAMESPACE_URI &quot;Settings&quot;</span>
<a href="#l16.63"></a><span id="l16.63"> #define NC_RDF_JUNK NC_NAMESPACE_URI &quot;Junk&quot;</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineat">@@ -194,17 +198,17 @@ nsMsgAccountManagerDataSource::nsMsgAcco</span>
<a href="#l16.65"></a><span id="l16.65"> </span>
<a href="#l16.66"></a><span id="l16.66">     getRDFService()-&gt;GetLiteral(NS_LITERAL_STRING(&quot;true&quot;).get(),</span>
<a href="#l16.67"></a><span id="l16.67">                                 &amp;kTrueLiteral);</span>
<a href="#l16.68"></a><span id="l16.68"> </span>
<a href="#l16.69"></a><span id="l16.69">     // eventually these need to exist in some kind of array</span>
<a href="#l16.70"></a><span id="l16.70">     // that's easily extensible</span>
<a href="#l16.71"></a><span id="l16.71">     getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SETTINGS), &amp;kNC_Settings);</span>
<a href="#l16.72"></a><span id="l16.72"> </span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-    kDefaultServerAtom = NS_NewAtom(&quot;DefaultServer&quot;);</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+    kDefaultServerAtom = MsgNewAtom(&quot;DefaultServer&quot;);</span>
<a href="#l16.75"></a><span id="l16.75">   }</span>
<a href="#l16.76"></a><span id="l16.76"> }</span>
<a href="#l16.77"></a><span id="l16.77"> </span>
<a href="#l16.78"></a><span id="l16.78"> nsMsgAccountManagerDataSource::~nsMsgAccountManagerDataSource()</span>
<a href="#l16.79"></a><span id="l16.79"> {</span>
<a href="#l16.80"></a><span id="l16.80">   nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l16.81"></a><span id="l16.81">   if (am)</span>
<a href="#l16.82"></a><span id="l16.82">     am-&gt;RemoveIncomingServerListener(this);</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineat">@@ -461,19 +465,19 @@ nsMsgAccountManagerDataSource::GetTarget</span>
<a href="#l16.84"></a><span id="l16.84">       else {</span>
<a href="#l16.85"></a><span id="l16.85">         rv = am-&gt;FindServerIndex(server, &amp;accountNum);</span>
<a href="#l16.86"></a><span id="l16.86">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l16.87"></a><span id="l16.87"> </span>
<a href="#l16.88"></a><span id="l16.88">         // this is a hack for now - hardcode server order by type</span>
<a href="#l16.89"></a><span id="l16.89">         nsCString serverType;</span>
<a href="#l16.90"></a><span id="l16.90">         server-&gt;GetType(serverType);</span>
<a href="#l16.91"></a><span id="l16.91"> </span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-        if (serverType.LowerCaseEqualsLiteral(&quot;none&quot;))</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+        if (MsgLowerCaseEqualsLiteral(serverType, &quot;none&quot;))</span>
<a href="#l16.94"></a><span id="l16.94">           accountNum += 2000;</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineminus">-        else if (serverType.LowerCaseEqualsLiteral(&quot;nntp&quot;))</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+        else if (MsgLowerCaseEqualsLiteral(serverType, &quot;nntp&quot;))</span>
<a href="#l16.97"></a><span id="l16.97">           accountNum += 3000;</span>
<a href="#l16.98"></a><span id="l16.98">         else</span>
<a href="#l16.99"></a><span id="l16.99">           accountNum += 1000;     // default is to appear at the top</span>
<a href="#l16.100"></a><span id="l16.100"> </span>
<a href="#l16.101"></a><span id="l16.101">         str.AppendInt(accountNum);</span>
<a href="#l16.102"></a><span id="l16.102">       }</span>
<a href="#l16.103"></a><span id="l16.103">     }</span>
<a href="#l16.104"></a><span id="l16.104">     else {</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineat">@@ -502,17 +506,17 @@ nsMsgAccountManagerDataSource::GetTarget</span>
<a href="#l16.106"></a><span id="l16.106">         else if (source == kNC_PageTitleDiskSpace)</span>
<a href="#l16.107"></a><span id="l16.107">           str.AssignLiteral(&quot;4&quot;);</span>
<a href="#l16.108"></a><span id="l16.108">         else if (source == kNC_PageTitleJunk)</span>
<a href="#l16.109"></a><span id="l16.109">           str.AssignLiteral(&quot;5&quot;);</span>
<a href="#l16.110"></a><span id="l16.110">         else {</span>
<a href="#l16.111"></a><span id="l16.111">           // allow for the accountmanager to be dynamically extended</span>
<a href="#l16.112"></a><span id="l16.112">           // all the other pages come after the standard ones</span>
<a href="#l16.113"></a><span id="l16.113">           // server, copies, addressing, disk space (or offline &amp; disk space)</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-          CopyASCIItoUTF16(sourceValue, str);</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineplus">+          CopyASCIItoUTF16(nsDependentCString(sourceValue), str);</span>
<a href="#l16.116"></a><span id="l16.116">         }</span>
<a href="#l16.117"></a><span id="l16.117">       }</span>
<a href="#l16.118"></a><span id="l16.118">       else {</span>
<a href="#l16.119"></a><span id="l16.119">         return NS_RDF_NO_VALUE;</span>
<a href="#l16.120"></a><span id="l16.120">       }</span>
<a href="#l16.121"></a><span id="l16.121">     }</span>
<a href="#l16.122"></a><span id="l16.122">   }</span>
<a href="#l16.123"></a><span id="l16.123"> </span>
<a href="#l16.124"></a><span id="l16.124" class="difflineat">@@ -583,75 +587,69 @@ nsMsgAccountManagerDataSource::GetTarget</span>
<a href="#l16.125"></a><span id="l16.125">                                           nsIRDFResource *property,</span>
<a href="#l16.126"></a><span id="l16.126">                                           PRBool aTruthValue,</span>
<a href="#l16.127"></a><span id="l16.127">                                           nsISimpleEnumerator **_retval)</span>
<a href="#l16.128"></a><span id="l16.128"> {</span>
<a href="#l16.129"></a><span id="l16.129">   nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l16.130"></a><span id="l16.130"> </span>
<a href="#l16.131"></a><span id="l16.131">   // create array and enumerator</span>
<a href="#l16.132"></a><span id="l16.132">   // even if we're not handling this we need to return something empty?</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; nodes;</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineminus">-  rv = NS_NewISupportsArray(getter_AddRefs(nodes));</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineminus">-  rv = NS_NewArrayEnumerator(_retval, nodes);</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+  nsCOMArray&lt;nsIRDFResource&gt; nodes;</span>
<a href="#l16.139"></a><span id="l16.139">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineminus">-</span>
<a href="#l16.141"></a><span id="l16.141">   if (source == kNC_AccountRoot)</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineminus">-    rv = createRootResources(property, nodes);</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+    rv = createRootResources(property, &amp;nodes);</span>
<a href="#l16.144"></a><span id="l16.144">   else if (property == kNC_Settings)</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineminus">-    rv = createSettingsResources(source, nodes);</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+    rv = createSettingsResources(source, &amp;nodes);</span>
<a href="#l16.147"></a><span id="l16.147"> </span>
<a href="#l16.148"></a><span id="l16.148">   if (NS_FAILED(rv))</span>
<a href="#l16.149"></a><span id="l16.149">     return NS_RDF_NO_VALUE;</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineminus">-  return NS_OK;</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+  return NS_NewArrayEnumerator(_retval, nodes);</span>
<a href="#l16.153"></a><span id="l16.153"> }</span>
<a href="#l16.154"></a><span id="l16.154"> </span>
<a href="#l16.155"></a><span id="l16.155"> // end of all arcs coming out of msgaccounts:/</span>
<a href="#l16.156"></a><span id="l16.156"> nsresult</span>
<a href="#l16.157"></a><span id="l16.157"> nsMsgAccountManagerDataSource::createRootResources(nsIRDFResource *property,</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineminus">-                                                   nsISupportsArray* aNodeArray)</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+                                                   nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l16.160"></a><span id="l16.160"> {</span>
<a href="#l16.161"></a><span id="l16.161">   nsresult rv = NS_OK;</span>
<a href="#l16.162"></a><span id="l16.162">   if (isContainment(property)) {</span>
<a href="#l16.163"></a><span id="l16.163"> </span>
<a href="#l16.164"></a><span id="l16.164">     nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l16.165"></a><span id="l16.165">     if (!am) return NS_ERROR_FAILURE;</span>
<a href="#l16.166"></a><span id="l16.166"> </span>
<a href="#l16.167"></a><span id="l16.167">     nsCOMPtr&lt;nsISupportsArray&gt; servers;</span>
<a href="#l16.168"></a><span id="l16.168">     rv = am-&gt;GetAllServers(getter_AddRefs(servers));</span>
<a href="#l16.169"></a><span id="l16.169">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l16.170"></a><span id="l16.170"> </span>
<a href="#l16.171"></a><span id="l16.171">     // fill up the nodes array with the RDF Resources for the servers</span>
<a href="#l16.172"></a><span id="l16.172">     serverCreationParams params = { aNodeArray, getRDFService() };</span>
<a href="#l16.173"></a><span id="l16.173">     servers-&gt;EnumerateForwards(createServerResources, (void*)&amp;params);</span>
<a href="#l16.174"></a><span id="l16.174"> #ifdef DEBUG_amds</span>
<a href="#l16.175"></a><span id="l16.175">     PRUint32 nodecount;</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineminus">-    aNodeArray-&gt;Count(&amp;nodecount);</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineplus">+    aNodeArray-&gt;GetLength(&amp;nodecount);</span>
<a href="#l16.178"></a><span id="l16.178">     printf(&quot;GetTargets(): added %d servers on %s\n&quot;, nodecount,</span>
<a href="#l16.179"></a><span id="l16.179">            (const char*)property_arc);</span>
<a href="#l16.180"></a><span id="l16.180"> #endif</span>
<a href="#l16.181"></a><span id="l16.181">     // For the &quot;settings&quot; arc, we also want to add SMTP setting.</span>
<a href="#l16.182"></a><span id="l16.182">     if (property == kNC_Settings) {</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleSMTP);</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleSMTP);</span>
<a href="#l16.185"></a><span id="l16.185">     }</span>
<a href="#l16.186"></a><span id="l16.186">   }</span>
<a href="#l16.187"></a><span id="l16.187"> </span>
<a href="#l16.188"></a><span id="l16.188"> #ifdef DEBUG_amds</span>
<a href="#l16.189"></a><span id="l16.189">   else {</span>
<a href="#l16.190"></a><span id="l16.190">     printf(&quot;unknown arc %s on msgaccounts:/\n&quot;, (const char*)property_arc);</span>
<a href="#l16.191"></a><span id="l16.191">   }</span>
<a href="#l16.192"></a><span id="l16.192"> #endif</span>
<a href="#l16.193"></a><span id="l16.193"> </span>
<a href="#l16.194"></a><span id="l16.194">   return rv;</span>
<a href="#l16.195"></a><span id="l16.195"> }</span>
<a href="#l16.196"></a><span id="l16.196"> </span>
<a href="#l16.197"></a><span id="l16.197"> nsresult</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineminus">-nsMsgAccountManagerDataSource::appendGenericSettingsResources(nsIMsgIncomingServer *server, nsISupportsArray *aNodeArray)</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineplus">+nsMsgAccountManagerDataSource::appendGenericSettingsResources(nsIMsgIncomingServer *server, nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l16.200"></a><span id="l16.200"> {</span>
<a href="#l16.201"></a><span id="l16.201">   nsresult rv;</span>
<a href="#l16.202"></a><span id="l16.202"> </span>
<a href="#l16.203"></a><span id="l16.203">   nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l16.204"></a><span id="l16.204">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.205"></a><span id="l16.205"> </span>
<a href="#l16.206"></a><span id="l16.206">   nsCOMPtr&lt;nsISimpleEnumerator&gt; e;</span>
<a href="#l16.207"></a><span id="l16.207">   rv = catman-&gt;EnumerateCategory(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, getter_AddRefs(e));</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineat">@@ -694,78 +692,78 @@ nsMsgAccountManagerDataSource::appendGen</span>
<a href="#l16.209"></a><span id="l16.209">       }</span>
<a href="#l16.210"></a><span id="l16.210">     }</span>
<a href="#l16.211"></a><span id="l16.211">   }</span>
<a href="#l16.212"></a><span id="l16.212">   return NS_OK;</span>
<a href="#l16.213"></a><span id="l16.213"> }</span>
<a href="#l16.214"></a><span id="l16.214"> </span>
<a href="#l16.215"></a><span id="l16.215"> nsresult</span>
<a href="#l16.216"></a><span id="l16.216"> nsMsgAccountManagerDataSource::appendGenericSetting(const char *name,</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineminus">-                                                    nsISupportsArray *aNodeArray)</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+                                                    nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l16.219"></a><span id="l16.219"> {</span>
<a href="#l16.220"></a><span id="l16.220">   NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l16.221"></a><span id="l16.221">   NS_ENSURE_ARG_POINTER(aNodeArray);</span>
<a href="#l16.222"></a><span id="l16.222"> </span>
<a href="#l16.223"></a><span id="l16.223">   nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l16.224"></a><span id="l16.224"> </span>
<a href="#l16.225"></a><span id="l16.225">   nsCAutoString resourceStr;</span>
<a href="#l16.226"></a><span id="l16.226">   resourceStr = NC_RDF_PAGETITLE_PREFIX;</span>
<a href="#l16.227"></a><span id="l16.227">   resourceStr += name;</span>
<a href="#l16.228"></a><span id="l16.228"> </span>
<a href="#l16.229"></a><span id="l16.229">   nsresult rv = getRDFService()-&gt;GetResource(resourceStr, getter_AddRefs(resource));</span>
<a href="#l16.230"></a><span id="l16.230">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.231"></a><span id="l16.231"> </span>
<a href="#l16.232"></a><span id="l16.232">   // AppendElement will addref.</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineminus">-  aNodeArray-&gt;AppendElement(resource);</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineplus">+  aNodeArray-&gt;AppendObject(resource);</span>
<a href="#l16.235"></a><span id="l16.235">   return NS_OK;</span>
<a href="#l16.236"></a><span id="l16.236"> }</span>
<a href="#l16.237"></a><span id="l16.237"> </span>
<a href="#l16.238"></a><span id="l16.238"> // end of all #Settings arcs</span>
<a href="#l16.239"></a><span id="l16.239"> nsresult</span>
<a href="#l16.240"></a><span id="l16.240"> nsMsgAccountManagerDataSource::createSettingsResources(nsIRDFResource *aSource,</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineminus">-                                                       nsISupportsArray *aNodeArray)</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineplus">+                                                       nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l16.243"></a><span id="l16.243"> {</span>
<a href="#l16.244"></a><span id="l16.244">   // If this isn't a server, just return.</span>
<a href="#l16.245"></a><span id="l16.245">   if (aSource == kNC_PageTitleSMTP)</span>
<a href="#l16.246"></a><span id="l16.246">     return NS_OK;</span>
<a href="#l16.247"></a><span id="l16.247"> </span>
<a href="#l16.248"></a><span id="l16.248">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l16.249"></a><span id="l16.249">   getServerForFolderNode(aSource, getter_AddRefs(server));</span>
<a href="#l16.250"></a><span id="l16.250">   if (server) {</span>
<a href="#l16.251"></a><span id="l16.251">     PRBool hasIdentities;</span>
<a href="#l16.252"></a><span id="l16.252">     nsresult rv = serverHasIdentities(server, &amp;hasIdentities);</span>
<a href="#l16.253"></a><span id="l16.253"> </span>
<a href="#l16.254"></a><span id="l16.254">     if (hasIdentities) {</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleServer);</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleCopies);</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleAddressing);</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleServer);</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleCopies);</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleAddressing);</span>
<a href="#l16.261"></a><span id="l16.261">     }</span>
<a href="#l16.262"></a><span id="l16.262"> </span>
<a href="#l16.263"></a><span id="l16.263">     // Junk settings apply for all server types except for news and rss.</span>
<a href="#l16.264"></a><span id="l16.264">     nsCString serverType;</span>
<a href="#l16.265"></a><span id="l16.265">     server-&gt;GetType(serverType);</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineminus">-    if (!serverType.LowerCaseEqualsLiteral(&quot;nntp&quot;) &amp;&amp;</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineminus">-        !serverType.LowerCaseEqualsLiteral(&quot;rss&quot;))</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleJunk);</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineplus">+    if (!MsgLowerCaseEqualsLiteral(serverType, &quot;nntp&quot;) &amp;&amp;</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineplus">+        !MsgLowerCaseEqualsLiteral(serverType, &quot;rss&quot;))</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleJunk);</span>
<a href="#l16.272"></a><span id="l16.272"> </span>
<a href="#l16.273"></a><span id="l16.273">     // Check the offline capability before adding</span>
<a href="#l16.274"></a><span id="l16.274">     // offline item</span>
<a href="#l16.275"></a><span id="l16.275">     PRInt32 offlineSupportLevel = 0;</span>
<a href="#l16.276"></a><span id="l16.276">     rv = server-&gt;GetOfflineSupportLevel(&amp;offlineSupportLevel);</span>
<a href="#l16.277"></a><span id="l16.277">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.278"></a><span id="l16.278"> </span>
<a href="#l16.279"></a><span id="l16.279">     PRBool supportsDiskSpace;</span>
<a href="#l16.280"></a><span id="l16.280">     rv = server-&gt;GetSupportsDiskSpace(&amp;supportsDiskSpace);</span>
<a href="#l16.281"></a><span id="l16.281">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.282"></a><span id="l16.282"> </span>
<a href="#l16.283"></a><span id="l16.283">     // currently there is no offline without diskspace</span>
<a href="#l16.284"></a><span id="l16.284">     if (offlineSupportLevel &gt;= OFFLINE_SUPPORT_LEVEL_REGULAR) </span>
<a href="#l16.285"></a><span id="l16.285" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleSynchronization);</span>
<a href="#l16.286"></a><span id="l16.286" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleSynchronization);</span>
<a href="#l16.287"></a><span id="l16.287">     else if (supportsDiskSpace)</span>
<a href="#l16.288"></a><span id="l16.288" class="difflineminus">-      aNodeArray-&gt;AppendElement(kNC_PageTitleDiskSpace);</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineplus">+      aNodeArray-&gt;AppendObject(kNC_PageTitleDiskSpace);</span>
<a href="#l16.290"></a><span id="l16.290"> </span>
<a href="#l16.291"></a><span id="l16.291">     if (hasIdentities) {</span>
<a href="#l16.292"></a><span id="l16.292">       // extensions come after the default panels</span>
<a href="#l16.293"></a><span id="l16.293">       rv = appendGenericSettingsResources(server, aNodeArray);</span>
<a href="#l16.294"></a><span id="l16.294">       NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to add generic panels&quot;);</span>
<a href="#l16.295"></a><span id="l16.295">     }</span>
<a href="#l16.296"></a><span id="l16.296">   }</span>
<a href="#l16.297"></a><span id="l16.297"> </span>
<a href="#l16.298"></a><span id="l16.298" class="difflineat">@@ -803,76 +801,74 @@ nsMsgAccountManagerDataSource::serverHas</span>
<a href="#l16.299"></a><span id="l16.299"> // always return PR_TRUE to try on every element instead of aborting early</span>
<a href="#l16.300"></a><span id="l16.300"> PRBool</span>
<a href="#l16.301"></a><span id="l16.301"> nsMsgAccountManagerDataSource::createServerResources(nsISupports *element,</span>
<a href="#l16.302"></a><span id="l16.302">                                                      void *data)</span>
<a href="#l16.303"></a><span id="l16.303"> {</span>
<a href="#l16.304"></a><span id="l16.304">   nsresult rv;</span>
<a href="#l16.305"></a><span id="l16.305">   // get parameters out of the data argument</span>
<a href="#l16.306"></a><span id="l16.306">   serverCreationParams *params = (serverCreationParams*)data;</span>
<a href="#l16.307"></a><span id="l16.307" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; servers = params-&gt;serverArray;</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineplus">+  nsCOMArray&lt;nsIRDFResource&gt; *servers = params-&gt;serverArray;</span>
<a href="#l16.309"></a><span id="l16.309">   nsCOMPtr&lt;nsIRDFService&gt; rdf = params-&gt;rdfService;</span>
<a href="#l16.310"></a><span id="l16.310"> </span>
<a href="#l16.311"></a><span id="l16.311">   // the server itself is in the element argument</span>
<a href="#l16.312"></a><span id="l16.312">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(element, &amp;rv);</span>
<a href="#l16.313"></a><span id="l16.313">   if (NS_FAILED(rv)) return PR_TRUE;</span>
<a href="#l16.314"></a><span id="l16.314"> </span>
<a href="#l16.315"></a><span id="l16.315">   nsCOMPtr &lt;nsIMsgFolder&gt; serverFolder;</span>
<a href="#l16.316"></a><span id="l16.316">   rv = server-&gt;GetRootFolder(getter_AddRefs(serverFolder));</span>
<a href="#l16.317"></a><span id="l16.317">   if(NS_FAILED(rv)) return PR_TRUE;</span>
<a href="#l16.318"></a><span id="l16.318"> </span>
<a href="#l16.319"></a><span id="l16.319">   // add the resource to the array</span>
<a href="#l16.320"></a><span id="l16.320">   nsCOMPtr&lt;nsIRDFResource&gt; serverResource = do_QueryInterface(serverFolder);</span>
<a href="#l16.321"></a><span id="l16.321">   if(serverResource)</span>
<a href="#l16.322"></a><span id="l16.322" class="difflineminus">-    (void) servers-&gt;AppendElement(serverResource);</span>
<a href="#l16.323"></a><span id="l16.323" class="difflineplus">+    (void) servers-&gt;AppendObject(serverResource);</span>
<a href="#l16.324"></a><span id="l16.324">   return PR_TRUE;</span>
<a href="#l16.325"></a><span id="l16.325"> }</span>
<a href="#l16.326"></a><span id="l16.326"> </span>
<a href="#l16.327"></a><span id="l16.327"> nsresult</span>
<a href="#l16.328"></a><span id="l16.328" class="difflineminus">-nsMsgAccountManagerDataSource::getAccountArcs(nsISupportsArray **aResult)</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineplus">+nsMsgAccountManagerDataSource::getAccountArcs(nsIMutableArray **aResult)</span>
<a href="#l16.330"></a><span id="l16.330"> {</span>
<a href="#l16.331"></a><span id="l16.331">   nsresult rv;</span>
<a href="#l16.332"></a><span id="l16.332">   if (!mAccountArcsOut) {</span>
<a href="#l16.333"></a><span id="l16.333" class="difflineminus">-</span>
<a href="#l16.334"></a><span id="l16.334" class="difflineminus">-    rv = NS_NewISupportsArray(getter_AddRefs(mAccountArcsOut));</span>
<a href="#l16.335"></a><span id="l16.335" class="difflineplus">+    mAccountArcsOut = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l16.336"></a><span id="l16.336">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.337"></a><span id="l16.337"> </span>
<a href="#l16.338"></a><span id="l16.338" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_Settings);</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_Name);</span>
<a href="#l16.340"></a><span id="l16.340" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeName);</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName);</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_NameSort);</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort);</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_PageTag);</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_Settings, PR_FALSE);</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_Name, PR_FALSE);</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeName, PR_FALSE);</span>
<a href="#l16.348"></a><span id="l16.348" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName, PR_FALSE);</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_NameSort, PR_FALSE);</span>
<a href="#l16.350"></a><span id="l16.350" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort, PR_FALSE);</span>
<a href="#l16.351"></a><span id="l16.351" class="difflineplus">+    mAccountArcsOut-&gt;AppendElement(kNC_PageTag, PR_FALSE);</span>
<a href="#l16.352"></a><span id="l16.352">   }</span>
<a href="#l16.353"></a><span id="l16.353"> </span>
<a href="#l16.354"></a><span id="l16.354">   *aResult = mAccountArcsOut;</span>
<a href="#l16.355"></a><span id="l16.355">   NS_IF_ADDREF(*aResult);</span>
<a href="#l16.356"></a><span id="l16.356">   return NS_OK;</span>
<a href="#l16.357"></a><span id="l16.357"> }</span>
<a href="#l16.358"></a><span id="l16.358"> </span>
<a href="#l16.359"></a><span id="l16.359"> nsresult</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineminus">-nsMsgAccountManagerDataSource::getAccountRootArcs(nsISupportsArray **aResult)</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineplus">+nsMsgAccountManagerDataSource::getAccountRootArcs(nsIMutableArray **aResult)</span>
<a href="#l16.362"></a><span id="l16.362"> {</span>
<a href="#l16.363"></a><span id="l16.363">   nsresult rv;</span>
<a href="#l16.364"></a><span id="l16.364">   if (!mAccountRootArcsOut) {</span>
<a href="#l16.365"></a><span id="l16.365" class="difflineminus">-</span>
<a href="#l16.366"></a><span id="l16.366" class="difflineminus">-    rv = NS_NewISupportsArray(getter_AddRefs(mAccountRootArcsOut));</span>
<a href="#l16.367"></a><span id="l16.367" class="difflineplus">+    mAccountRootArcsOut = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l16.368"></a><span id="l16.368">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.369"></a><span id="l16.369"> </span>
<a href="#l16.370"></a><span id="l16.370" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Server);</span>
<a href="#l16.371"></a><span id="l16.371" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Child);</span>
<a href="#l16.372"></a><span id="l16.372" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_Server, PR_FALSE);</span>
<a href="#l16.373"></a><span id="l16.373" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_Child, PR_FALSE);</span>
<a href="#l16.374"></a><span id="l16.374"> </span>
<a href="#l16.375"></a><span id="l16.375" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Settings);</span>
<a href="#l16.376"></a><span id="l16.376" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Name);</span>
<a href="#l16.377"></a><span id="l16.377" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeName);</span>
<a href="#l16.378"></a><span id="l16.378" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName);</span>
<a href="#l16.379"></a><span id="l16.379" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_NameSort);</span>
<a href="#l16.380"></a><span id="l16.380" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort);</span>
<a href="#l16.381"></a><span id="l16.381" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_PageTag);</span>
<a href="#l16.382"></a><span id="l16.382" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_Settings, PR_FALSE);</span>
<a href="#l16.383"></a><span id="l16.383" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_Name, PR_FALSE);</span>
<a href="#l16.384"></a><span id="l16.384" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeName, PR_FALSE);</span>
<a href="#l16.385"></a><span id="l16.385" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName, PR_FALSE);</span>
<a href="#l16.386"></a><span id="l16.386" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_NameSort, PR_FALSE);</span>
<a href="#l16.387"></a><span id="l16.387" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort, PR_FALSE);</span>
<a href="#l16.388"></a><span id="l16.388" class="difflineplus">+    mAccountRootArcsOut-&gt;AppendElement(kNC_PageTag, PR_FALSE);</span>
<a href="#l16.389"></a><span id="l16.389">   }</span>
<a href="#l16.390"></a><span id="l16.390"> </span>
<a href="#l16.391"></a><span id="l16.391">   *aResult = mAccountRootArcsOut;</span>
<a href="#l16.392"></a><span id="l16.392">   NS_IF_ADDREF(*aResult);</span>
<a href="#l16.393"></a><span id="l16.393">   return NS_OK;</span>
<a href="#l16.394"></a><span id="l16.394"> }</span>
<a href="#l16.395"></a><span id="l16.395"> </span>
<a href="#l16.396"></a><span id="l16.396"> NS_IMETHODIMP</span>
<a href="#l16.397"></a><span id="l16.397" class="difflineat">@@ -910,17 +906,17 @@ nsMsgAccountManagerDataSource::HasArcOut</span>
<a href="#l16.398"></a><span id="l16.398"> /* nsISimpleEnumerator ArcLabelsOut (in nsIRDFResource aSource); */</span>
<a href="#l16.399"></a><span id="l16.399"> NS_IMETHODIMP</span>
<a href="#l16.400"></a><span id="l16.400"> nsMsgAccountManagerDataSource::ArcLabelsOut(nsIRDFResource *source,</span>
<a href="#l16.401"></a><span id="l16.401">                                             nsISimpleEnumerator **_retval)</span>
<a href="#l16.402"></a><span id="l16.402"> {</span>
<a href="#l16.403"></a><span id="l16.403">   nsresult rv;</span>
<a href="#l16.404"></a><span id="l16.404"> </span>
<a href="#l16.405"></a><span id="l16.405">   // we have to return something, so always create the array/enumerators</span>
<a href="#l16.406"></a><span id="l16.406" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; arcs;</span>
<a href="#l16.407"></a><span id="l16.407" class="difflineplus">+  nsCOMPtr&lt;nsIMutableArray&gt; arcs;</span>
<a href="#l16.408"></a><span id="l16.408">   if (source == kNC_AccountRoot)</span>
<a href="#l16.409"></a><span id="l16.409">     rv = getAccountRootArcs(getter_AddRefs(arcs));</span>
<a href="#l16.410"></a><span id="l16.410">   else</span>
<a href="#l16.411"></a><span id="l16.411">     rv = getAccountArcs(getter_AddRefs(arcs));</span>
<a href="#l16.412"></a><span id="l16.412">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.413"></a><span id="l16.413"> </span>
<a href="#l16.414"></a><span id="l16.414">   rv = NS_NewArrayEnumerator(_retval, arcs);</span>
<a href="#l16.415"></a><span id="l16.415">   if (NS_FAILED(rv)) return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.h</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -45,16 +45,18 @@</span>
<a href="#l17.4"></a><span id="l17.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l17.5"></a><span id="l17.5"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7"> #include &quot;nsMsgRDFDataSource.h&quot;</span>
<a href="#l17.8"></a><span id="l17.8"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l17.9"></a><span id="l17.9"> #include &quot;nsIIncomingServerListener.h&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #include &quot;nsWeakPtr.h&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+#include &quot;nsCOMArray.h&quot;</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15"> /* {3f989ca4-f77a-11d2-969d-006008948010} */</span>
<a href="#l17.16"></a><span id="l17.16"> #define NS_MSGACCOUNTMANAGERDATASOURCE_CID \</span>
<a href="#l17.17"></a><span id="l17.17">   {0x3f989ca4, 0xf77a, 0x11d2, \</span>
<a href="#l17.18"></a><span id="l17.18">     {0x96, 0x9d, 0x00, 0x60, 0x08, 0x94, 0x80, 0x10}}</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20"> class nsMsgAccountManagerDataSource : public nsMsgRDFDataSource,</span>
<a href="#l17.21"></a><span id="l17.21">                                       public nsIFolderListener,</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -111,21 +113,21 @@ protected:</span>
<a href="#l17.23"></a><span id="l17.23">   PRBool canGetMessages(nsIMsgIncomingServer *aServer);</span>
<a href="#l17.24"></a><span id="l17.24">   PRBool canGetIncomingMessages(nsIMsgIncomingServer *aServer);</span>
<a href="#l17.25"></a><span id="l17.25">   </span>
<a href="#l17.26"></a><span id="l17.26">   static PRBool isContainment(nsIRDFResource *aProperty);</span>
<a href="#l17.27"></a><span id="l17.27">   nsresult getServerForFolderNode(nsIRDFNode *aResource,</span>
<a href="#l17.28"></a><span id="l17.28">                                   nsIMsgIncomingServer **aResult);</span>
<a href="#l17.29"></a><span id="l17.29">   </span>
<a href="#l17.30"></a><span id="l17.30">   nsresult createRootResources(nsIRDFResource *aProperty,</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-                               nsISupportsArray* aNodeArray);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+                               nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l17.33"></a><span id="l17.33">   nsresult createSettingsResources(nsIRDFResource *aSource,</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-                                   nsISupportsArray *aNodeArray);</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-  nsresult appendGenericSettingsResources(nsIMsgIncomingServer *server, nsISupportsArray *aNodeArray);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-  nsresult appendGenericSetting(const char *name, nsISupportsArray *aNodeArray);</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+                                   nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+  nsresult appendGenericSettingsResources(nsIMsgIncomingServer *server, nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  nsresult appendGenericSetting(const char *name, nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l17.40"></a><span id="l17.40"> </span>
<a href="#l17.41"></a><span id="l17.41">   static nsIRDFResource* kNC_Name;</span>
<a href="#l17.42"></a><span id="l17.42">   static nsIRDFResource* kNC_FolderTreeName;</span>
<a href="#l17.43"></a><span id="l17.43">   static nsIRDFResource* kNC_FolderTreeSimpleName;</span>
<a href="#l17.44"></a><span id="l17.44">   static nsIRDFResource* kNC_NameSort;</span>
<a href="#l17.45"></a><span id="l17.45">   static nsIRDFResource* kNC_FolderTreeNameSort;</span>
<a href="#l17.46"></a><span id="l17.46">   static nsIRDFResource* kNC_PageTag;</span>
<a href="#l17.47"></a><span id="l17.47">   static nsIRDFResource* kNC_IsDefaultServer;</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineat">@@ -152,29 +154,29 @@ protected:</span>
<a href="#l17.49"></a><span id="l17.49">   static nsIRDFResource* kNC_PageTitleJunk;</span>
<a href="#l17.50"></a><span id="l17.50"> </span>
<a href="#l17.51"></a><span id="l17.51">   static nsIRDFLiteral* kTrueLiteral;</span>
<a href="#l17.52"></a><span id="l17.52"> </span>
<a href="#l17.53"></a><span id="l17.53">   static nsIAtom* kDefaultServerAtom;</span>
<a href="#l17.54"></a><span id="l17.54"> </span>
<a href="#l17.55"></a><span id="l17.55">   static nsrefcnt gAccountManagerResourceRefCnt;</span>
<a href="#l17.56"></a><span id="l17.56"> </span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-  static nsresult getAccountArcs(nsISupportsArray **aResult);</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-  static nsresult getAccountRootArcs(nsISupportsArray **aResult);</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  static nsresult getAccountArcs(nsIMutableArray **aResult);</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+  static nsresult getAccountRootArcs(nsIMutableArray **aResult);</span>
<a href="#l17.61"></a><span id="l17.61">   </span>
<a href="#l17.62"></a><span id="l17.62"> private:</span>
<a href="#l17.63"></a><span id="l17.63">   // enumeration function to convert each server (element)</span>
<a href="#l17.64"></a><span id="l17.64">   // to an nsIRDFResource and append it to the array (in data)</span>
<a href="#l17.65"></a><span id="l17.65">   static PRBool createServerResources(nsISupports *element, void *data);</span>
<a href="#l17.66"></a><span id="l17.66"> </span>
<a href="#l17.67"></a><span id="l17.67">   // search for an account by key</span>
<a href="#l17.68"></a><span id="l17.68">   static PRBool findServerByKey(nsISupports *aElement, void *aData);</span>
<a href="#l17.69"></a><span id="l17.69"> </span>
<a href="#l17.70"></a><span id="l17.70">   nsresult serverHasIdentities(nsIMsgIncomingServer *aServer, PRBool *aResult);</span>
<a href="#l17.71"></a><span id="l17.71">   nsresult getStringBundle();</span>
<a href="#l17.72"></a><span id="l17.72"> </span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-  static nsCOMPtr&lt;nsISupportsArray&gt; mAccountArcsOut;</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-  static nsCOMPtr&lt;nsISupportsArray&gt; mAccountRootArcsOut;</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+  static nsCOMPtr&lt;nsIMutableArray&gt; mAccountArcsOut;</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+  static nsCOMPtr&lt;nsIMutableArray&gt; mAccountRootArcsOut;</span>
<a href="#l17.77"></a><span id="l17.77">   nsWeakPtr mAccountManager;</span>
<a href="#l17.78"></a><span id="l17.78">   nsCOMPtr&lt;nsIStringBundle&gt; mStringBundle;</span>
<a href="#l17.79"></a><span id="l17.79"> };</span>
<a href="#l17.80"></a><span id="l17.80"> </span>
<a href="#l17.81"></a><span id="l17.81"> #endif /* __nsMsgAccountManagerDS_h */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -43,16 +43,19 @@</span>
<a href="#l18.4"></a><span id="l18.4"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l18.5"></a><span id="l18.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> #include &quot;nsStatusBarBiffManager.h&quot;</span>
<a href="#l18.7"></a><span id="l18.7"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l18.8"></a><span id="l18.8"> #include &quot;prlog.h&quot;</span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;nspr.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16"> #define PREF_BIFF_JITTER &quot;mail.biff.add_interval_jitter&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18"> static NS_DEFINE_CID(kStatusBarBiffManagerCID, NS_STATUSBARBIFFMANAGER_CID);</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> static PRLogModuleInfo *MsgBiffLogModule = nsnull;</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22"> NS_IMPL_ISUPPORTS3(nsMsgBiffManager, nsIMsgBiffManager, nsIIncomingServerListener, nsISupportsWeakReference)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -47,17 +47,16 @@</span>
<a href="#l19.4"></a><span id="l19.4"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l19.5"></a><span id="l19.5"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l19.6"></a><span id="l19.6"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l19.11"></a><span id="l19.11"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15"> #include &quot;nsIMsgComposeService.h&quot;</span>
<a href="#l19.16"></a><span id="l19.16"> #include &quot;nsIMsgCompose.h&quot;</span>
<a href="#l19.17"></a><span id="l19.17"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19"> // needed by the content load policy manager</span>
<a href="#l19.20"></a><span id="l19.20"> #include &quot;nsIExternalProtocolService.h&quot;</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -66,16 +65,17 @@</span>
<a href="#l19.22"></a><span id="l19.22"> // needed for mailnews content load policy manager</span>
<a href="#l19.23"></a><span id="l19.23"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l19.24"></a><span id="l19.24"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l19.25"></a><span id="l19.25"> #include &quot;nsContentPolicyUtils.h&quot;</span>
<a href="#l19.26"></a><span id="l19.26"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l19.27"></a><span id="l19.27"> #include &quot;nsILoadContext.h&quot;</span>
<a href="#l19.28"></a><span id="l19.28"> #include &quot;nsIFrameLoader.h&quot;</span>
<a href="#l19.29"></a><span id="l19.29"> #include &quot;nsIWebProgress.h&quot;</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32"> static const char kBlockRemoteImages[] = &quot;mailnews.message_display.disable_remote_image&quot;;</span>
<a href="#l19.33"></a><span id="l19.33"> static const char kAllowPlugins[] = &quot;mailnews.message_display.allow.plugins&quot;;</span>
<a href="#l19.34"></a><span id="l19.34"> static const char kTrustedDomains[] =  &quot;mail.trusteddomains&quot;;</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36"> // Per message headder flags to keep track of whether the user is allowing remote</span>
<a href="#l19.37"></a><span id="l19.37"> // content for a particular message. </span>
<a href="#l19.38"></a><span id="l19.38"> // if you change or add more values to these constants, be sure to modify</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineat">@@ -424,25 +424,25 @@ PRBool</span>
<a href="#l19.40"></a><span id="l19.40"> nsMsgContentPolicy::IsExposedProtocol(nsIURI *aContentLocation)</span>
<a href="#l19.41"></a><span id="l19.41"> {</span>
<a href="#l19.42"></a><span id="l19.42">   nsCAutoString contentScheme;</span>
<a href="#l19.43"></a><span id="l19.43">   nsresult rv = aContentLocation-&gt;GetScheme(contentScheme);</span>
<a href="#l19.44"></a><span id="l19.44">   NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l19.45"></a><span id="l19.45"> </span>
<a href="#l19.46"></a><span id="l19.46">   // If you are changing this list, you may need to also consider changing the</span>
<a href="#l19.47"></a><span id="l19.47">   // list of network.protocol-handler.expose.* prefs in all-thunderbird.js.</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-  if (contentScheme.LowerCaseEqualsLiteral(&quot;mailto&quot;) ||</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;news&quot;) ||</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;snews&quot;) ||</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;nntp&quot;) ||</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;imap&quot;) ||</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;addbook&quot;) ||</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;pop&quot;) ||</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;mailbox&quot;) ||</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-      contentScheme.LowerCaseEqualsLiteral(&quot;about&quot;))</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+  if (MsgLowerCaseEqualsLiteral(contentScheme, &quot;mailto&quot;) ||</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;news&quot;) ||</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;snews&quot;) ||</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;nntp&quot;) ||</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;imap&quot;) ||</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;addbook&quot;) ||</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;pop&quot;) ||</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;mailbox&quot;) ||</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineplus">+      MsgLowerCaseEqualsLiteral(contentScheme, &quot;about&quot;))</span>
<a href="#l19.66"></a><span id="l19.66">     return PR_TRUE;</span>
<a href="#l19.67"></a><span id="l19.67"> </span>
<a href="#l19.68"></a><span id="l19.68">   PRBool isData;</span>
<a href="#l19.69"></a><span id="l19.69">   PRBool isChrome;</span>
<a href="#l19.70"></a><span id="l19.70">   PRBool isRes;</span>
<a href="#l19.71"></a><span id="l19.71">   rv = aContentLocation-&gt;SchemeIs(&quot;chrome&quot;, &amp;isChrome);</span>
<a href="#l19.72"></a><span id="l19.72">   rv |= aContentLocation-&gt;SchemeIs(&quot;resource&quot;, &amp;isRes);</span>
<a href="#l19.73"></a><span id="l19.73">   rv |= aContentLocation-&gt;SchemeIs(&quot;data&quot;, &amp;isData);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/src/nsMsgCopyService.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgCopyService.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -39,16 +39,19 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;nsMsgCopyService.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;nspr.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;nsIFile.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16"> // ******************** nsCopySource ******************</span>
<a href="#l20.17"></a><span id="l20.17"> //</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19"> nsCopySource::nsCopySource() : m_processed(PR_FALSE)</span>
<a href="#l20.20"></a><span id="l20.20"> {</span>
<a href="#l20.21"></a><span id="l20.21">   MOZ_COUNT_CTOR(nsCopySource);</span>
<a href="#l20.22"></a><span id="l20.22">   m_messageArray = do_CreateInstance(NS_ARRAY_CONTRACTID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -35,17 +35,16 @@</span>
<a href="#l21.4"></a><span id="l21.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.5"></a><span id="l21.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.6"></a><span id="l21.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.7"></a><span id="l21.7">  *</span>
<a href="#l21.8"></a><span id="l21.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> #include &quot;msgCore.h&quot;</span>
<a href="#l21.11"></a><span id="l21.11"> #include &quot;prmem.h&quot;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14"> #include &quot;nsIMsgCustomColumnHandler.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15"> #include &quot;nsMsgDBView.h&quot;</span>
<a href="#l21.16"></a><span id="l21.16"> #include &quot;nsISupports.h&quot;</span>
<a href="#l21.17"></a><span id="l21.17"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l21.18"></a><span id="l21.18"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l21.19"></a><span id="l21.19"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l21.20"></a><span id="l21.20"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -72,16 +71,20 @@</span>
<a href="#l21.22"></a><span id="l21.22"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l21.23"></a><span id="l21.23"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l21.24"></a><span id="l21.24"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l21.25"></a><span id="l21.25"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l21.26"></a><span id="l21.26"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l21.27"></a><span id="l21.27"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l21.28"></a><span id="l21.28"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l21.29"></a><span id="l21.29"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+#include &quot;nsMemory.h&quot;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+#include &quot;nsAlgorithm.h&quot;</span>
<a href="#l21.34"></a><span id="l21.34"> </span>
<a href="#l21.35"></a><span id="l21.35"> nsrefcnt nsMsgDBView::gInstanceCount  = 0;</span>
<a href="#l21.36"></a><span id="l21.36"> </span>
<a href="#l21.37"></a><span id="l21.37"> #ifdef SUPPORT_PRIORITY_COLORS</span>
<a href="#l21.38"></a><span id="l21.38"> nsIAtom * nsMsgDBView::kHighestPriorityAtom = nsnull;</span>
<a href="#l21.39"></a><span id="l21.39"> nsIAtom * nsMsgDBView::kHighPriorityAtom = nsnull;</span>
<a href="#l21.40"></a><span id="l21.40"> nsIAtom * nsMsgDBView::kLowestPriorityAtom = nsnull;</span>
<a href="#l21.41"></a><span id="l21.41"> nsIAtom * nsMsgDBView::kLowPriorityAtom = nsnull;</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineat">@@ -191,49 +194,49 @@ nsMsgDBView::nsMsgDBView()</span>
<a href="#l21.43"></a><span id="l21.43">   }</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45">   InitLabelStrings();</span>
<a href="#l21.46"></a><span id="l21.46">   gInstanceCount++;</span>
<a href="#l21.47"></a><span id="l21.47"> }</span>
<a href="#l21.48"></a><span id="l21.48"> </span>
<a href="#l21.49"></a><span id="l21.49"> void nsMsgDBView::InitializeAtomsAndLiterals()</span>
<a href="#l21.50"></a><span id="l21.50"> {</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineminus">-  kUnreadMsgAtom = NS_NewAtom(&quot;unread&quot;);</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-  kNewMsgAtom = NS_NewAtom(&quot;new&quot;);</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-  kReadMsgAtom = NS_NewAtom(&quot;read&quot;);</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-  kRepliedMsgAtom = NS_NewAtom(&quot;replied&quot;);</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-  kForwardedMsgAtom = NS_NewAtom(&quot;forwarded&quot;);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-  kOfflineMsgAtom = NS_NewAtom(&quot;offline&quot;);</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-  kFlaggedMsgAtom = NS_NewAtom(&quot;flagged&quot;);</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-  kImapDeletedMsgAtom = NS_NewAtom(&quot;imapdeleted&quot;);</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-  kAttachMsgAtom = NS_NewAtom(&quot;attach&quot;);</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-  kHasUnreadAtom = NS_NewAtom(&quot;hasUnread&quot;);</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineminus">-  kWatchThreadAtom = NS_NewAtom(&quot;watch&quot;);</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineminus">-  kIgnoreThreadAtom = NS_NewAtom(&quot;ignore&quot;);</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineminus">-  kIgnoreSubthreadAtom = NS_NewAtom(&quot;ignoreSubthread&quot;);</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-  kHasImageAtom = NS_NewAtom(&quot;hasimage&quot;);</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-  kJunkMsgAtom = NS_NewAtom(&quot;junk&quot;);</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">-  kNotJunkMsgAtom = NS_NewAtom(&quot;notjunk&quot;);</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-  kDummyMsgAtom = NS_NewAtom(&quot;dummy&quot;);</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+  kUnreadMsgAtom = MsgNewAtom(&quot;unread&quot;);</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+  kNewMsgAtom = MsgNewAtom(&quot;new&quot;);</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+  kReadMsgAtom = MsgNewAtom(&quot;read&quot;);</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+  kRepliedMsgAtom = MsgNewAtom(&quot;replied&quot;);</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+  kForwardedMsgAtom = MsgNewAtom(&quot;forwarded&quot;);</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+  kOfflineMsgAtom = MsgNewAtom(&quot;offline&quot;);</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+  kFlaggedMsgAtom = MsgNewAtom(&quot;flagged&quot;);</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+  kImapDeletedMsgAtom = MsgNewAtom(&quot;imapdeleted&quot;);</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+  kAttachMsgAtom = MsgNewAtom(&quot;attach&quot;);</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+  kHasUnreadAtom = MsgNewAtom(&quot;hasUnread&quot;);</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+  kWatchThreadAtom = MsgNewAtom(&quot;watch&quot;);</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+  kIgnoreThreadAtom = MsgNewAtom(&quot;ignore&quot;);</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+  kIgnoreSubthreadAtom = MsgNewAtom(&quot;ignoreSubthread&quot;);</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+  kHasImageAtom = MsgNewAtom(&quot;hasimage&quot;);</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+  kJunkMsgAtom = MsgNewAtom(&quot;junk&quot;);</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+  kNotJunkMsgAtom = MsgNewAtom(&quot;notjunk&quot;);</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+  kDummyMsgAtom = MsgNewAtom(&quot;dummy&quot;);</span>
<a href="#l21.85"></a><span id="l21.85"> #ifdef SUPPORT_PRIORITY_COLORS</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">-  kHighestPriorityAtom = NS_NewAtom(&quot;priority-highest&quot;);</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">-  kHighPriorityAtom = NS_NewAtom(&quot;priority-high&quot;);</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineminus">-  kLowestPriorityAtom = NS_NewAtom(&quot;priority-lowest&quot;);</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-  kLowPriorityAtom = NS_NewAtom(&quot;priority-low&quot;);</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+  kHighestPriorityAtom = MsgNewAtom(&quot;priority-highest&quot;);</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+  kHighPriorityAtom = MsgNewAtom(&quot;priority-high&quot;);</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+  kLowestPriorityAtom = MsgNewAtom(&quot;priority-lowest&quot;);</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+  kLowPriorityAtom = MsgNewAtom(&quot;priority-low&quot;);</span>
<a href="#l21.94"></a><span id="l21.94"> #endif</span>
<a href="#l21.95"></a><span id="l21.95"> </span>
<a href="#l21.96"></a><span id="l21.96">   // priority strings</span>
<a href="#l21.97"></a><span id="l21.97">   kHighestPriorityString = GetString(NS_LITERAL_STRING(&quot;priorityHighest&quot;).get());</span>
<a href="#l21.98"></a><span id="l21.98">   kHighPriorityString = GetString(NS_LITERAL_STRING(&quot;priorityHigh&quot;).get());</span>
<a href="#l21.99"></a><span id="l21.99">   kLowestPriorityString = GetString(NS_LITERAL_STRING(&quot;priorityLowest&quot;).get());</span>
<a href="#l21.100"></a><span id="l21.100">   kLowPriorityString = GetString(NS_LITERAL_STRING(&quot;priorityLow&quot;).get());</span>
<a href="#l21.101"></a><span id="l21.101">   kNormalPriorityString = GetString(NS_LITERAL_STRING(&quot;priorityNormal&quot;).get());</span>
<a href="#l21.102"></a><span id="l21.102"> </span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-  kLabelColorWhiteAtom = NS_NewAtom(&quot;lc-white&quot;);</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-  kLabelColorBlackAtom = NS_NewAtom(&quot;lc-black&quot;);</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineplus">+  kLabelColorWhiteAtom = MsgNewAtom(&quot;lc-white&quot;);</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineplus">+  kLabelColorBlackAtom = MsgNewAtom(&quot;lc-black&quot;);</span>
<a href="#l21.107"></a><span id="l21.107"> </span>
<a href="#l21.108"></a><span id="l21.108">   kReadString = GetString(NS_LITERAL_STRING(&quot;read&quot;).get());</span>
<a href="#l21.109"></a><span id="l21.109">   kRepliedString = GetString(NS_LITERAL_STRING(&quot;replied&quot;).get());</span>
<a href="#l21.110"></a><span id="l21.110">   kForwardedString = GetString(NS_LITERAL_STRING(&quot;forwarded&quot;).get());</span>
<a href="#l21.111"></a><span id="l21.111">   kNewString = GetString(NS_LITERAL_STRING(&quot;new&quot;).get());</span>
<a href="#l21.112"></a><span id="l21.112"> }</span>
<a href="#l21.113"></a><span id="l21.113"> </span>
<a href="#l21.114"></a><span id="l21.114"> nsMsgDBView::~nsMsgDBView()</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineat">@@ -360,17 +363,17 @@ nsresult nsMsgDBView::AppendKeywordPrope</span>
<a href="#l21.116"></a><span id="l21.116">   rv = mTagService-&gt;GetColorForKey(topKey, color);</span>
<a href="#l21.117"></a><span id="l21.117">   if (NS_SUCCEEDED(rv) &amp;&amp; !color.IsEmpty())</span>
<a href="#l21.118"></a><span id="l21.118">   {</span>
<a href="#l21.119"></a><span id="l21.119">     if (addSelectedTextProperty)</span>
<a href="#l21.120"></a><span id="l21.120">       properties-&gt;AppendElement(color.EqualsLiteral(LABEL_COLOR_WHITE_STRING)</span>
<a href="#l21.121"></a><span id="l21.121">         ? kLabelColorBlackAtom</span>
<a href="#l21.122"></a><span id="l21.122">         : kLabelColorWhiteAtom);</span>
<a href="#l21.123"></a><span id="l21.123">     color.Replace(0, 1, NS_LITERAL_CSTRING(LABEL_COLOR_STRING));</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineminus">-    nsCOMPtr &lt;nsIAtom&gt; keywordAtom = do_GetAtom(color.get());</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+    nsCOMPtr &lt;nsIAtom&gt; keywordAtom = MsgGetAtom(color.get());</span>
<a href="#l21.126"></a><span id="l21.126">     properties-&gt;AppendElement(keywordAtom);</span>
<a href="#l21.127"></a><span id="l21.127">   }</span>
<a href="#l21.128"></a><span id="l21.128">   return rv;</span>
<a href="#l21.129"></a><span id="l21.129"> }</span>
<a href="#l21.130"></a><span id="l21.130"> </span>
<a href="#l21.131"></a><span id="l21.131"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l21.132"></a><span id="l21.132"> // nsITreeView Implementation Methods (and helper methods)</span>
<a href="#l21.133"></a><span id="l21.133"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineat">@@ -678,17 +681,17 @@ nsresult nsMsgDBView::FetchKeywords(nsIM</span>
<a href="#l21.135"></a><span id="l21.135"> </span>
<a href="#l21.136"></a><span id="l21.136">   rv = aHdr-&gt;GetLabel(&amp;label);</span>
<a href="#l21.137"></a><span id="l21.137">   nsCString keywords;</span>
<a href="#l21.138"></a><span id="l21.138">   aHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l21.139"></a><span id="l21.139">   if (label &gt; 0)</span>
<a href="#l21.140"></a><span id="l21.140">   {</span>
<a href="#l21.141"></a><span id="l21.141">     nsCAutoString labelStr(&quot;$label&quot;);</span>
<a href="#l21.142"></a><span id="l21.142">     labelStr.Append((char) (label + '0'));</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineminus">-    if (keywords.Find(labelStr, PR_TRUE) == -1)</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineplus">+    if (keywords.Find(labelStr, CaseInsensitiveCompare) == -1)</span>
<a href="#l21.145"></a><span id="l21.145">     {</span>
<a href="#l21.146"></a><span id="l21.146">       if (!keywords.IsEmpty())</span>
<a href="#l21.147"></a><span id="l21.147">         keywords.Append(' ');</span>
<a href="#l21.148"></a><span id="l21.148">       keywords.Append(labelStr);</span>
<a href="#l21.149"></a><span id="l21.149">     }</span>
<a href="#l21.150"></a><span id="l21.150">   }</span>
<a href="#l21.151"></a><span id="l21.151">   keywordString = keywords;</span>
<a href="#l21.152"></a><span id="l21.152">   return NS_OK;</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineat">@@ -708,17 +711,17 @@ nsresult nsMsgDBView::FetchTags(nsIMsgDB</span>
<a href="#l21.154"></a><span id="l21.154">   aHdr-&gt;GetStringProperty(&quot;keywords&quot;, getter_Copies(keywords));</span>
<a href="#l21.155"></a><span id="l21.155"> </span>
<a href="#l21.156"></a><span id="l21.156">   nsMsgLabelValue label = 0;</span>
<a href="#l21.157"></a><span id="l21.157">   rv = aHdr-&gt;GetLabel(&amp;label);</span>
<a href="#l21.158"></a><span id="l21.158">   if (label &gt; 0)</span>
<a href="#l21.159"></a><span id="l21.159">   {</span>
<a href="#l21.160"></a><span id="l21.160">     nsCAutoString labelStr(&quot;$label&quot;);</span>
<a href="#l21.161"></a><span id="l21.161">     labelStr.Append((char) (label + '0'));</span>
<a href="#l21.162"></a><span id="l21.162" class="difflineminus">-    if (keywords.Find(labelStr, PR_TRUE) == -1)</span>
<a href="#l21.163"></a><span id="l21.163" class="difflineplus">+    if (keywords.Find(labelStr, CaseInsensitiveCompare) == -1)</span>
<a href="#l21.164"></a><span id="l21.164">       FetchLabel(aHdr, tags);</span>
<a href="#l21.165"></a><span id="l21.165">   }</span>
<a href="#l21.166"></a><span id="l21.166"> </span>
<a href="#l21.167"></a><span id="l21.167">   nsTArray&lt;nsCString&gt; keywordsArray;</span>
<a href="#l21.168"></a><span id="l21.168">   ParseString(keywords, ' ', keywordsArray);</span>
<a href="#l21.169"></a><span id="l21.169">   nsAutoString tag;</span>
<a href="#l21.170"></a><span id="l21.170"> </span>
<a href="#l21.171"></a><span id="l21.171">   for (PRUint32 i = 0; i &lt; keywordsArray.Length(); i++)</span>
<a href="#l21.172"></a><span id="l21.172" class="difflineat">@@ -744,17 +747,17 @@ nsresult nsMsgDBView::FetchLabel(nsIMsgD</span>
<a href="#l21.173"></a><span id="l21.173">   NS_ENSURE_ARG_POINTER(aHdr);</span>
<a href="#l21.174"></a><span id="l21.174"> </span>
<a href="#l21.175"></a><span id="l21.175">   rv = aHdr-&gt;GetLabel(&amp;label);</span>
<a href="#l21.176"></a><span id="l21.176">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.177"></a><span id="l21.177"> </span>
<a href="#l21.178"></a><span id="l21.178">   // we don't care if label is not between 1 and PREF_LABELS_MAX inclusive.</span>
<a href="#l21.179"></a><span id="l21.179">   if ((label &lt; 1) || (label &gt; PREF_LABELS_MAX))</span>
<a href="#l21.180"></a><span id="l21.180">   {</span>
<a href="#l21.181"></a><span id="l21.181" class="difflineminus">-    aLabelString.SetLength(0);</span>
<a href="#l21.182"></a><span id="l21.182" class="difflineplus">+    aLabelString.Truncate();</span>
<a href="#l21.183"></a><span id="l21.183">     return NS_OK;</span>
<a href="#l21.184"></a><span id="l21.184">   }</span>
<a href="#l21.185"></a><span id="l21.185"> </span>
<a href="#l21.186"></a><span id="l21.186">   // We need to subtract 1 because mLabelPrefDescriptions is 0 based.</span>
<a href="#l21.187"></a><span id="l21.187">   aLabelString = mLabelPrefDescriptions[label - 1];</span>
<a href="#l21.188"></a><span id="l21.188">   return NS_OK;</span>
<a href="#l21.189"></a><span id="l21.189"> }</span>
<a href="#l21.190"></a><span id="l21.190"> </span>
<a href="#l21.191"></a><span id="l21.191" class="difflineat">@@ -940,17 +943,17 @@ NS_IMETHODIMP nsMsgDBView::SetSelection(</span>
<a href="#l21.192"></a><span id="l21.192"> }</span>
<a href="#l21.193"></a><span id="l21.193"> </span>
<a href="#l21.194"></a><span id="l21.194"> NS_IMETHODIMP nsMsgDBView::ReloadMessageWithAllParts()</span>
<a href="#l21.195"></a><span id="l21.195"> {</span>
<a href="#l21.196"></a><span id="l21.196">   if (m_currentlyDisplayedMsgUri.IsEmpty() || mSuppressMsgDisplay)</span>
<a href="#l21.197"></a><span id="l21.197">     return NS_OK;</span>
<a href="#l21.198"></a><span id="l21.198"> </span>
<a href="#l21.199"></a><span id="l21.199">   nsCAutoString forceAllParts(m_currentlyDisplayedMsgUri);</span>
<a href="#l21.200"></a><span id="l21.200" class="difflineminus">-  forceAllParts += (forceAllParts.FindChar('?') == kNotFound) ? &quot;?&quot; : &quot;&amp;&quot;;</span>
<a href="#l21.201"></a><span id="l21.201" class="difflineplus">+  forceAllParts += (forceAllParts.FindChar('?') == kNotFound) ? '?' : '&amp;';</span>
<a href="#l21.202"></a><span id="l21.202">   forceAllParts.AppendLiteral(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l21.203"></a><span id="l21.203">   nsCOMPtr&lt;nsIMessenger&gt; messenger (do_QueryReferent(mMessengerWeak));</span>
<a href="#l21.204"></a><span id="l21.204">   NS_ENSURE_TRUE(messenger, NS_ERROR_FAILURE);</span>
<a href="#l21.205"></a><span id="l21.205"> </span>
<a href="#l21.206"></a><span id="l21.206">   nsresult rv = messenger-&gt;OpenURL(forceAllParts);</span>
<a href="#l21.207"></a><span id="l21.207">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l21.208"></a><span id="l21.208"> </span>
<a href="#l21.209"></a><span id="l21.209">   UpdateDisplayMessage(m_currentlyDisplayedViewIndex);</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineat">@@ -1283,17 +1286,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellProper</span>
<a href="#l21.211"></a><span id="l21.211">   if (!imageSize.IsEmpty())</span>
<a href="#l21.212"></a><span id="l21.212">   {</span>
<a href="#l21.213"></a><span id="l21.213">     properties-&gt;AppendElement(kHasImageAtom);</span>
<a href="#l21.214"></a><span id="l21.214">   }</span>
<a href="#l21.215"></a><span id="l21.215"> </span>
<a href="#l21.216"></a><span id="l21.216">   nsCString junkScoreStr;</span>
<a href="#l21.217"></a><span id="l21.217">   msgHdr-&gt;GetStringProperty(&quot;junkscore&quot;, getter_Copies(junkScoreStr));</span>
<a href="#l21.218"></a><span id="l21.218">   if (!junkScoreStr.IsEmpty()) {</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineminus">-    properties-&gt;AppendElement(junkScoreStr.ToInteger((PRInt32*)&amp;rv, 10) == nsIJunkMailPlugin::IS_SPAM_SCORE ?</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineplus">+    properties-&gt;AppendElement(junkScoreStr.ToInteger(&amp;rv, 10) == nsIJunkMailPlugin::IS_SPAM_SCORE ?</span>
<a href="#l21.221"></a><span id="l21.221">                               kJunkMsgAtom : kNotJunkMsgAtom);</span>
<a href="#l21.222"></a><span id="l21.222">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Converting junkScore to integer failed.&quot;);</span>
<a href="#l21.223"></a><span id="l21.223">   }</span>
<a href="#l21.224"></a><span id="l21.224"> </span>
<a href="#l21.225"></a><span id="l21.225">   nsCString keywords;</span>
<a href="#l21.226"></a><span id="l21.226">   FetchKeywords(msgHdr, keywords);</span>
<a href="#l21.227"></a><span id="l21.227">   if (!keywords.IsEmpty())</span>
<a href="#l21.228"></a><span id="l21.228">     AppendKeywordProperties(keywords, properties, PR_TRUE);</span>
<a href="#l21.229"></a><span id="l21.229" class="difflineat">@@ -1308,19 +1311,19 @@ NS_IMETHODIMP nsMsgDBView::GetCellProper</span>
<a href="#l21.230"></a><span id="l21.230">   {</span>
<a href="#l21.231"></a><span id="l21.231">     nsCAutoString keywords(keywordProperty);</span>
<a href="#l21.232"></a><span id="l21.232">     nsCAutoString nextKeyword;</span>
<a href="#l21.233"></a><span id="l21.233">     PRInt32 spaceIndex = 0;</span>
<a href="#l21.234"></a><span id="l21.234">     do</span>
<a href="#l21.235"></a><span id="l21.235">     {</span>
<a href="#l21.236"></a><span id="l21.236">       spaceIndex = keywords.FindChar(' ');</span>
<a href="#l21.237"></a><span id="l21.237">       PRInt32 endOfKeyword = (spaceIndex == -1) ? keywords.Length() : spaceIndex;</span>
<a href="#l21.238"></a><span id="l21.238" class="difflineminus">-      keywords.Left(nextKeyword, endOfKeyword);</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineminus">-      nextKeyword.Insert(&quot;kw-&quot;, 0);</span>
<a href="#l21.240"></a><span id="l21.240" class="difflineminus">-      nsCOMPtr &lt;nsIAtom&gt; keywordAtom = do_GetAtom(nextKeyword.get());</span>
<a href="#l21.241"></a><span id="l21.241" class="difflineplus">+      nextKeyword.AssignLiteral(&quot;kw-&quot;);</span>
<a href="#l21.242"></a><span id="l21.242" class="difflineplus">+      nextKeyword.Append(StringHead(keywords, endOfKeyword));</span>
<a href="#l21.243"></a><span id="l21.243" class="difflineplus">+      nsCOMPtr &lt;nsIAtom&gt; keywordAtom = MsgGetAtom(nextKeyword.get());</span>
<a href="#l21.244"></a><span id="l21.244">       properties-&gt;AppendElement(keywordAtom);</span>
<a href="#l21.245"></a><span id="l21.245">       if (spaceIndex &gt; 0)</span>
<a href="#l21.246"></a><span id="l21.246">         keywords.Cut(0, endOfKeyword + 1);</span>
<a href="#l21.247"></a><span id="l21.247">     }</span>
<a href="#l21.248"></a><span id="l21.248">     while (spaceIndex &gt; 0);</span>
<a href="#l21.249"></a><span id="l21.249">   }</span>
<a href="#l21.250"></a><span id="l21.250"> </span>
<a href="#l21.251"></a><span id="l21.251"> #ifdef SUPPORT_PRIORITY_COLORS</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineat">@@ -1611,58 +1614,70 @@ NS_IMETHODIMP nsMsgDBView::GetCellValue(</span>
<a href="#l21.253"></a><span id="l21.253">   msgHdr-&gt;GetFlags(&amp;flags);</span>
<a href="#l21.254"></a><span id="l21.254"> </span>
<a href="#l21.255"></a><span id="l21.255">   aValue.Truncate();</span>
<a href="#l21.256"></a><span id="l21.256">   // provide a string &quot;value&quot; for cells that do not normally have text.</span>
<a href="#l21.257"></a><span id="l21.257">   // use empty string for the normal states &quot;Read&quot;, &quot;Not Starred&quot;, &quot;No Attachment&quot; and &quot;Not Junk&quot;</span>
<a href="#l21.258"></a><span id="l21.258">   switch (colID[0])</span>
<a href="#l21.259"></a><span id="l21.259">   {</span>
<a href="#l21.260"></a><span id="l21.260">     case 'a': // attachment column</span>
<a href="#l21.261"></a><span id="l21.261" class="difflineminus">-      if (flags &amp; nsMsgMessageFlags::Attachment)</span>
<a href="#l21.262"></a><span id="l21.262" class="difflineminus">-        aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasAttachment&quot;).get()));</span>
<a href="#l21.263"></a><span id="l21.263" class="difflineplus">+      if (flags &amp; nsMsgMessageFlags::Attachment) {</span>
<a href="#l21.264"></a><span id="l21.264" class="difflineplus">+        nsString tmp_str;</span>
<a href="#l21.265"></a><span id="l21.265" class="difflineplus">+        tmp_str.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasAttachment&quot;).get()));</span>
<a href="#l21.266"></a><span id="l21.266" class="difflineplus">+        aValue.Assign(tmp_str);</span>
<a href="#l21.267"></a><span id="l21.267" class="difflineplus">+      }</span>
<a href="#l21.268"></a><span id="l21.268">       break;</span>
<a href="#l21.269"></a><span id="l21.269">     case 'f': // flagged (starred) column</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineminus">-      if (flags &amp; nsMsgMessageFlags::Marked)</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineminus">-        aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasFlag&quot;).get()));</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineplus">+      if (flags &amp; nsMsgMessageFlags::Marked) {</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineplus">+        nsString tmp_str;</span>
<a href="#l21.274"></a><span id="l21.274" class="difflineplus">+        tmp_str.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasFlag&quot;).get()));</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineplus">+        aValue.Assign(tmp_str);</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineplus">+      }</span>
<a href="#l21.277"></a><span id="l21.277">       break;</span>
<a href="#l21.278"></a><span id="l21.278">     case 'j': // junk column</span>
<a href="#l21.279"></a><span id="l21.279">       if (JunkControlsEnabled(aRow))</span>
<a href="#l21.280"></a><span id="l21.280">       {</span>
<a href="#l21.281"></a><span id="l21.281">         nsCString junkScoreStr;</span>
<a href="#l21.282"></a><span id="l21.282">         msgHdr-&gt;GetStringProperty(&quot;junkscore&quot;, getter_Copies(junkScoreStr));</span>
<a href="#l21.283"></a><span id="l21.283">         // Only need to assing a real value for junk, it's empty already</span>
<a href="#l21.284"></a><span id="l21.284">         // as it should be for non-junk.</span>
<a href="#l21.285"></a><span id="l21.285">         if (!junkScoreStr.IsEmpty() &amp;&amp;</span>
<a href="#l21.286"></a><span id="l21.286" class="difflineminus">-            (junkScoreStr.ToInteger((PRInt32*)&amp;rv, 10) == nsIJunkMailPlugin::IS_SPAM_SCORE))</span>
<a href="#l21.287"></a><span id="l21.287" class="difflineplus">+            (junkScoreStr.ToInteger(&amp;rv, 10) == nsIJunkMailPlugin::IS_SPAM_SCORE))</span>
<a href="#l21.288"></a><span id="l21.288">           aValue.AssignLiteral(&quot;messageJunk&quot;);</span>
<a href="#l21.289"></a><span id="l21.289"> </span>
<a href="#l21.290"></a><span id="l21.290">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Converting junkScore to integer failed.&quot;);</span>
<a href="#l21.291"></a><span id="l21.291">       }</span>
<a href="#l21.292"></a><span id="l21.292">       break;</span>
<a href="#l21.293"></a><span id="l21.293">     case 't':</span>
<a href="#l21.294"></a><span id="l21.294">       if (colID[1] == 'h' &amp;&amp; (m_viewFlags &amp; nsMsgViewFlagsType::kThreadedDisplay))</span>
<a href="#l21.295"></a><span id="l21.295">       {       // thread column</span>
<a href="#l21.296"></a><span id="l21.296">         PRBool isContainer, isContainerEmpty, isContainerOpen;</span>
<a href="#l21.297"></a><span id="l21.297">         IsContainer(aRow, &amp;isContainer);</span>
<a href="#l21.298"></a><span id="l21.298">         if (isContainer)</span>
<a href="#l21.299"></a><span id="l21.299">         {</span>
<a href="#l21.300"></a><span id="l21.300">           IsContainerEmpty(aRow, &amp;isContainerEmpty);</span>
<a href="#l21.301"></a><span id="l21.301">           if (!isContainerEmpty)</span>
<a href="#l21.302"></a><span id="l21.302">           {</span>
<a href="#l21.303"></a><span id="l21.303" class="difflineplus">+            nsString tmp_str;</span>
<a href="#l21.304"></a><span id="l21.304" class="difflineplus">+</span>
<a href="#l21.305"></a><span id="l21.305">             IsContainerOpen(aRow, &amp;isContainerOpen);</span>
<a href="#l21.306"></a><span id="l21.306" class="difflineminus">-            aValue.Adopt(GetString(isContainerOpen ?</span>
<a href="#l21.307"></a><span id="l21.307" class="difflineplus">+            tmp_str.Adopt(GetString(isContainerOpen ?</span>
<a href="#l21.308"></a><span id="l21.308">                                    NS_LITERAL_STRING(&quot;messageExpanded&quot;).get() :</span>
<a href="#l21.309"></a><span id="l21.309">                                    NS_LITERAL_STRING(&quot;messageCollapsed&quot;).get()));</span>
<a href="#l21.310"></a><span id="l21.310" class="difflineplus">+            aValue.Assign(tmp_str);</span>
<a href="#l21.311"></a><span id="l21.311">           }</span>
<a href="#l21.312"></a><span id="l21.312">         }</span>
<a href="#l21.313"></a><span id="l21.313">       }</span>
<a href="#l21.314"></a><span id="l21.314">       break;</span>
<a href="#l21.315"></a><span id="l21.315">     case 'u': // read/unread column</span>
<a href="#l21.316"></a><span id="l21.316" class="difflineminus">-      if (!(flags &amp; nsMsgMessageFlags::Read))</span>
<a href="#l21.317"></a><span id="l21.317" class="difflineminus">-        aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageUnread&quot;).get()));</span>
<a href="#l21.318"></a><span id="l21.318" class="difflineplus">+      if (!(flags &amp; nsMsgMessageFlags::Read)) {</span>
<a href="#l21.319"></a><span id="l21.319" class="difflineplus">+        nsString tmp_str;</span>
<a href="#l21.320"></a><span id="l21.320" class="difflineplus">+        tmp_str.Adopt(GetString(NS_LITERAL_STRING(&quot;messageUnread&quot;).get()));</span>
<a href="#l21.321"></a><span id="l21.321" class="difflineplus">+        aValue.Assign(tmp_str);</span>
<a href="#l21.322"></a><span id="l21.322" class="difflineplus">+      }</span>
<a href="#l21.323"></a><span id="l21.323">       break;</span>
<a href="#l21.324"></a><span id="l21.324">     default:</span>
<a href="#l21.325"></a><span id="l21.325">       aValue.Assign(colID);</span>
<a href="#l21.326"></a><span id="l21.326">       break;</span>
<a href="#l21.327"></a><span id="l21.327">   }</span>
<a href="#l21.328"></a><span id="l21.328">   return rv;</span>
<a href="#l21.329"></a><span id="l21.329"> }</span>
<a href="#l21.330"></a><span id="l21.330"> </span>
<a href="#l21.331"></a><span id="l21.331" class="difflineat">@@ -1813,17 +1828,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellText(P</span>
<a href="#l21.332"></a><span id="l21.332">   rv = GetMsgHdrForViewIndex(aRow, getter_AddRefs(msgHdr));</span>
<a href="#l21.333"></a><span id="l21.333"> </span>
<a href="#l21.334"></a><span id="l21.334">   if (NS_FAILED(rv) || !msgHdr)</span>
<a href="#l21.335"></a><span id="l21.335">   {</span>
<a href="#l21.336"></a><span id="l21.336">     ClearHdrCache();</span>
<a href="#l21.337"></a><span id="l21.337">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l21.338"></a><span id="l21.338">   }</span>
<a href="#l21.339"></a><span id="l21.339"> </span>
<a href="#l21.340"></a><span id="l21.340" class="difflineminus">-  aValue.SetCapacity(0);</span>
<a href="#l21.341"></a><span id="l21.341" class="difflineplus">+  aValue.Truncate();</span>
<a href="#l21.342"></a><span id="l21.342">   // XXX fix me by making Fetch* take an nsAString&amp; parameter</span>
<a href="#l21.343"></a><span id="l21.343">   nsString valueText;</span>
<a href="#l21.344"></a><span id="l21.344">   nsCOMPtr &lt;nsIMsgThread&gt; thread;</span>
<a href="#l21.345"></a><span id="l21.345"> </span>
<a href="#l21.346"></a><span id="l21.346">   const PRUnichar* colID;</span>
<a href="#l21.347"></a><span id="l21.347">   aCol-&gt;GetIdConst(&amp;colID);</span>
<a href="#l21.348"></a><span id="l21.348"> </span>
<a href="#l21.349"></a><span id="l21.349">   //attempt to retreive a custom column handler. If it exists call it and return</span>
<a href="#l21.350"></a><span id="l21.350" class="difflineat">@@ -2003,17 +2018,17 @@ NS_IMETHODIMP nsMsgDBView::CycleCell(PRI</span>
<a href="#l21.351"></a><span id="l21.351"> </span>
<a href="#l21.352"></a><span id="l21.352">       nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l21.353"></a><span id="l21.353"> </span>
<a href="#l21.354"></a><span id="l21.354">       nsresult rv = GetMsgHdrForViewIndex(row, getter_AddRefs(msgHdr));</span>
<a href="#l21.355"></a><span id="l21.355">       if (NS_SUCCEEDED(rv) &amp;&amp; msgHdr)</span>
<a href="#l21.356"></a><span id="l21.356">       {</span>
<a href="#l21.357"></a><span id="l21.357">         nsCString junkScoreStr;</span>
<a href="#l21.358"></a><span id="l21.358">         rv = msgHdr-&gt;GetStringProperty(&quot;junkscore&quot;, getter_Copies(junkScoreStr));</span>
<a href="#l21.359"></a><span id="l21.359" class="difflineminus">-        if (junkScoreStr.IsEmpty() || (junkScoreStr.ToInteger((PRInt32*)&amp;rv, 10) == nsIJunkMailPlugin::IS_HAM_SCORE))</span>
<a href="#l21.360"></a><span id="l21.360" class="difflineplus">+        if (junkScoreStr.IsEmpty() || (junkScoreStr.ToInteger(&amp;rv, 10) == nsIJunkMailPlugin::IS_HAM_SCORE))</span>
<a href="#l21.361"></a><span id="l21.361">           ApplyCommandToIndices(nsMsgViewCommandType::junk, (nsMsgViewIndex *) &amp;row, 1);</span>
<a href="#l21.362"></a><span id="l21.362">         else</span>
<a href="#l21.363"></a><span id="l21.363">           ApplyCommandToIndices(nsMsgViewCommandType::unjunk, (nsMsgViewIndex *) &amp;row, 1);</span>
<a href="#l21.364"></a><span id="l21.364"> </span>
<a href="#l21.365"></a><span id="l21.365">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Converting junkScore to integer failed.&quot;);</span>
<a href="#l21.366"></a><span id="l21.366">       }</span>
<a href="#l21.367"></a><span id="l21.367">     }</span>
<a href="#l21.368"></a><span id="l21.368">     break;</span>
<a href="#l21.369"></a><span id="l21.369" class="difflineat">@@ -2082,32 +2097,32 @@ NS_IMETHODIMP nsMsgDBView::Open(nsIMsgFo</span>
<a href="#l21.370"></a><span id="l21.370">     rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l21.371"></a><span id="l21.371">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l21.372"></a><span id="l21.372">     nsCString type;</span>
<a href="#l21.373"></a><span id="l21.373">     rv = server-&gt;GetType(type);</span>
<a href="#l21.374"></a><span id="l21.374">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l21.375"></a><span id="l21.375"> </span>
<a href="#l21.376"></a><span id="l21.376">     // I'm not sure this is correct, because XF virtual folders with mixed news</span>
<a href="#l21.377"></a><span id="l21.377">     // and mail can have this set.</span>
<a href="#l21.378"></a><span id="l21.378" class="difflineminus">-    mIsNews = type.LowerCaseEqualsLiteral(&quot;nntp&quot;);</span>
<a href="#l21.379"></a><span id="l21.379" class="difflineplus">+    mIsNews = MsgLowerCaseEqualsLiteral(type, &quot;nntp&quot;);</span>
<a href="#l21.380"></a><span id="l21.380"> </span>
<a href="#l21.381"></a><span id="l21.381">     // Default to a virtual folder if folder not set, since synthetic search</span>
<a href="#l21.382"></a><span id="l21.382">     // views may not have a folder.</span>
<a href="#l21.383"></a><span id="l21.383">     PRUint32 folderFlags = nsMsgFolderFlags::Virtual;</span>
<a href="#l21.384"></a><span id="l21.384">     if (folder)</span>
<a href="#l21.385"></a><span id="l21.385">       folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l21.386"></a><span id="l21.386">     mIsXFVirtual = folderFlags &amp; nsMsgFolderFlags::Virtual;</span>
<a href="#l21.387"></a><span id="l21.387"> </span>
<a href="#l21.388"></a><span id="l21.388" class="difflineminus">-    if (!mIsXFVirtual &amp;&amp; type.LowerCaseEqualsLiteral(&quot;rss&quot;))</span>
<a href="#l21.389"></a><span id="l21.389" class="difflineplus">+    if (!mIsXFVirtual &amp;&amp; MsgLowerCaseEqualsLiteral(type, &quot;rss&quot;))</span>
<a href="#l21.390"></a><span id="l21.390">       mIsRss = PR_TRUE;</span>
<a href="#l21.391"></a><span id="l21.391"> </span>
<a href="#l21.392"></a><span id="l21.392">     if (type.IsEmpty())</span>
<a href="#l21.393"></a><span id="l21.393">       mMessageTypeAtom = nsnull;</span>
<a href="#l21.394"></a><span id="l21.394">     else  // special case nntp --&gt; news since we'll break themes if we try to be consistent</span>
<a href="#l21.395"></a><span id="l21.395" class="difflineminus">-      mMessageTypeAtom = do_GetAtom(mIsNews ? &quot;news&quot; : type.get());</span>
<a href="#l21.396"></a><span id="l21.396" class="difflineplus">+      mMessageTypeAtom = MsgGetAtom(mIsNews ? &quot;news&quot; : type.get());</span>
<a href="#l21.397"></a><span id="l21.397"> </span>
<a href="#l21.398"></a><span id="l21.398">     GetImapDeleteModel(nsnull);</span>
<a href="#l21.399"></a><span id="l21.399"> </span>
<a href="#l21.400"></a><span id="l21.400">     if (mIsNews)</span>
<a href="#l21.401"></a><span id="l21.401">     {</span>
<a href="#l21.402"></a><span id="l21.402">       nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l21.403"></a><span id="l21.403">       if (prefs)</span>
<a href="#l21.404"></a><span id="l21.404">       {</span>
<a href="#l21.405"></a><span id="l21.405" class="difflineat">@@ -3140,17 +3155,17 @@ nsresult nsMsgDBView::SetMsgHdrJunkStatu</span>
<a href="#l21.406"></a><span id="l21.406">     nsMsgJunkStatus oldUserClassification;</span>
<a href="#l21.407"></a><span id="l21.407">     if (oldOriginStr.get()[0] != 'u') {</span>
<a href="#l21.408"></a><span id="l21.408">         oldUserClassification = nsIJunkMailPlugin::UNCLASSIFIED;</span>
<a href="#l21.409"></a><span id="l21.409">     }</span>
<a href="#l21.410"></a><span id="l21.410">     else {</span>
<a href="#l21.411"></a><span id="l21.411">         // otherwise, pass the actual user classification</span>
<a href="#l21.412"></a><span id="l21.412">         if (junkScoreStr.IsEmpty())</span>
<a href="#l21.413"></a><span id="l21.413">           oldUserClassification = nsIJunkMailPlugin::UNCLASSIFIED;</span>
<a href="#l21.414"></a><span id="l21.414" class="difflineminus">-        else if (junkScoreStr.ToInteger((PRInt32*)&amp;rv, 10) == nsIJunkMailPlugin::IS_SPAM_SCORE)</span>
<a href="#l21.415"></a><span id="l21.415" class="difflineplus">+        else if (junkScoreStr.ToInteger(&amp;rv, 10) == nsIJunkMailPlugin::IS_SPAM_SCORE)</span>
<a href="#l21.416"></a><span id="l21.416">           oldUserClassification = nsIJunkMailPlugin::JUNK;</span>
<a href="#l21.417"></a><span id="l21.417">         else</span>
<a href="#l21.418"></a><span id="l21.418">           oldUserClassification = nsIJunkMailPlugin::GOOD;</span>
<a href="#l21.419"></a><span id="l21.419"> </span>
<a href="#l21.420"></a><span id="l21.420">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Converting junkScore to integer failed.&quot;);</span>
<a href="#l21.421"></a><span id="l21.421">     }</span>
<a href="#l21.422"></a><span id="l21.422"> </span>
<a href="#l21.423"></a><span id="l21.423">     // get the URI for this message so we can pass it to the plugin</span>
<a href="#l21.424"></a><span id="l21.424" class="difflineat">@@ -7404,17 +7419,17 @@ PRBool nsMsgDBView::JunkControlsEnabled(</span>
<a href="#l21.425"></a><span id="l21.425">     // Check if this is a mail message in search folders.</span>
<a href="#l21.426"></a><span id="l21.426">     if (mIsXFVirtual)</span>
<a href="#l21.427"></a><span id="l21.427">     {</span>
<a href="#l21.428"></a><span id="l21.428">       nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l21.429"></a><span id="l21.429">       folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l21.430"></a><span id="l21.430">       nsCAutoString type;</span>
<a href="#l21.431"></a><span id="l21.431">       if (server)</span>
<a href="#l21.432"></a><span id="l21.432">         server-&gt;GetType(type);</span>
<a href="#l21.433"></a><span id="l21.433" class="difflineminus">-      if (!(type.LowerCaseEqualsLiteral(&quot;nntp&quot;) || type.LowerCaseEqualsLiteral(&quot;rss&quot;)))</span>
<a href="#l21.434"></a><span id="l21.434" class="difflineplus">+      if (!(MsgLowerCaseEqualsLiteral(type, &quot;nntp&quot;) || MsgLowerCaseEqualsLiteral(type, &quot;rss&quot;)))</span>
<a href="#l21.435"></a><span id="l21.435">         return PR_TRUE;</span>
<a href="#l21.436"></a><span id="l21.436">     }</span>
<a href="#l21.437"></a><span id="l21.437"> </span>
<a href="#l21.438"></a><span id="l21.438">     // For rss and news, check the inherited folder property.</span>
<a href="#l21.439"></a><span id="l21.439">     nsCAutoString junkEnableOverride;</span>
<a href="#l21.440"></a><span id="l21.440">     folder-&gt;GetInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;,</span>
<a href="#l21.441"></a><span id="l21.441">                                        junkEnableOverride);</span>
<a href="#l21.442"></a><span id="l21.442">     if (junkEnableOverride.EqualsLiteral(&quot;true&quot;))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -63,16 +63,17 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #include &quot;nsIWeakReference.h&quot;</span>
<a href="#l22.5"></a><span id="l22.5"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsMsgTagService.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsTArray.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsIMsgCustomColumnHandler.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+#include &quot;nsIWeakReferenceUtils.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15"> typedef nsAutoTArray&lt;nsMsgViewIndex, 1&gt; nsMsgViewIndexArray;</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17"> enum eFieldType {</span>
<a href="#l22.18"></a><span id="l22.18">     kCollationKey,</span>
<a href="#l22.19"></a><span id="l22.19">     kU32</span>
<a href="#l22.20"></a><span id="l22.20"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCache.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -38,16 +38,17 @@</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> #include &quot;msgCore.h&quot;</span>
<a href="#l23.6"></a><span id="l23.6"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l23.7"></a><span id="l23.7"> #include &quot;nsMsgFolderCacheElement.h&quot;</span>
<a href="#l23.8"></a><span id="l23.8"> #include &quot;nsMsgFolderCache.h&quot;</span>
<a href="#l23.9"></a><span id="l23.9"> #include &quot;nsMorkCID.h&quot;</span>
<a href="#l23.10"></a><span id="l23.10"> #include &quot;nsIMdbFactoryFactory.h&quot;</span>
<a href="#l23.11"></a><span id="l23.11"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13"> </span>
<a href="#l23.14"></a><span id="l23.14"> const char *kFoldersScope = &quot;ns:msg:db:row:scope:folders:all&quot;;	// scope for all folders table</span>
<a href="#l23.15"></a><span id="l23.15"> const char *kFoldersTableKind = &quot;ns:msg:db:table:kind:folders&quot;;</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17"> nsMsgFolderCache::nsMsgFolderCache()</span>
<a href="#l23.18"></a><span id="l23.18"> {</span>
<a href="#l23.19"></a><span id="l23.19">   m_mdbEnv = nsnull;</span>
<a href="#l23.20"></a><span id="l23.20">   m_mdbStore = nsnull;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -659,17 +659,17 @@ nsFolderCompactState::OnDataAvailable(ns</span>
<a href="#l24.4"></a><span id="l24.4">   PRUint32 needToGrowKeywords = 0;</span>
<a href="#l24.5"></a><span id="l24.5">   PRUint32 statusOffset;</span>
<a href="#l24.6"></a><span id="l24.6">   nsCString msgHdrKeywords;</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">   if (m_startOfMsg)</span>
<a href="#l24.9"></a><span id="l24.9">   {</span>
<a href="#l24.10"></a><span id="l24.10">     m_statusOffset = 0;</span>
<a href="#l24.11"></a><span id="l24.11">     m_addedHeaderSize = 0;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    m_messageUri.SetLength(0); // clear the previous message uri</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    m_messageUri.Truncate(); // clear the previous message uri</span>
<a href="#l24.14"></a><span id="l24.14">     if (NS_SUCCEEDED(BuildMessageURI(m_baseMessageUri.get(), m_keyArray[m_curIndex],</span>
<a href="#l24.15"></a><span id="l24.15">                                 m_messageUri)))</span>
<a href="#l24.16"></a><span id="l24.16">     {</span>
<a href="#l24.17"></a><span id="l24.17">       rv = GetMessage(getter_AddRefs(m_curSrcHdr));</span>
<a href="#l24.18"></a><span id="l24.18">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.19"></a><span id="l24.19">       if (m_curSrcHdr)</span>
<a href="#l24.20"></a><span id="l24.20">       {</span>
<a href="#l24.21"></a><span id="l24.21">         (void) m_curSrcHdr-&gt;GetFlags(&amp;msgFlags);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -915,17 +915,17 @@ nsOfflineStoreCompactState::InitDB(nsIMs</span>
<a href="#l24.23"></a><span id="l24.23">  * This will copy one message to the offline store, but if it fails to</span>
<a href="#l24.24"></a><span id="l24.24">  * copy the next message, it will keep trying messages until it finds one</span>
<a href="#l24.25"></a><span id="l24.25">  * it can copy, or it runs out of messages.</span>
<a href="#l24.26"></a><span id="l24.26">  */</span>
<a href="#l24.27"></a><span id="l24.27"> nsresult nsOfflineStoreCompactState::CopyNextMessage(PRBool &amp;done)</span>
<a href="#l24.28"></a><span id="l24.28"> {</span>
<a href="#l24.29"></a><span id="l24.29">   while (m_curIndex &lt; m_size)</span>
<a href="#l24.30"></a><span id="l24.30">   {</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-    m_messageUri.SetLength(0); // clear the previous message uri</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+    m_messageUri.Truncate(); // clear the previous message uri</span>
<a href="#l24.33"></a><span id="l24.33">     nsresult rv = BuildMessageURI(m_baseMessageUri.get(), m_keyArray[m_curIndex],</span>
<a href="#l24.34"></a><span id="l24.34">                                   m_messageUri);</span>
<a href="#l24.35"></a><span id="l24.35">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.36"></a><span id="l24.36">     m_startOfMsg = PR_TRUE;</span>
<a href="#l24.37"></a><span id="l24.37">     nsCOMPtr&lt;nsISupports&gt; thisSupports;</span>
<a href="#l24.38"></a><span id="l24.38">     QueryInterface(NS_GET_IID(nsISupports), getter_AddRefs(thisSupports));</span>
<a href="#l24.39"></a><span id="l24.39">     rv = m_messageService-&gt;StreamMessage(m_messageUri.get(), thisSupports, m_window, nsnull,</span>
<a href="#l24.40"></a><span id="l24.40">                                     PR_FALSE, EmptyCString(), PR_TRUE, nsnull);</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineat">@@ -1173,17 +1173,17 @@ nsOfflineStoreCompactState::OnDataAvaila</span>
<a href="#l24.42"></a><span id="l24.42">     return NS_ERROR_FAILURE;</span>
<a href="#l24.43"></a><span id="l24.43"> </span>
<a href="#l24.44"></a><span id="l24.44">   nsresult rv = NS_OK;</span>
<a href="#l24.45"></a><span id="l24.45"> </span>
<a href="#l24.46"></a><span id="l24.46">   if (m_startOfMsg)</span>
<a href="#l24.47"></a><span id="l24.47">   {</span>
<a href="#l24.48"></a><span id="l24.48">     m_statusOffset = 0;</span>
<a href="#l24.49"></a><span id="l24.49">     m_offlineMsgSize = 0;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-    m_messageUri.SetLength(0); // clear the previous message uri</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+    m_messageUri.Truncate(); // clear the previous message uri</span>
<a href="#l24.52"></a><span id="l24.52">     if (NS_SUCCEEDED(BuildMessageURI(m_baseMessageUri.get(), m_keyArray[m_curIndex],</span>
<a href="#l24.53"></a><span id="l24.53">                                 m_messageUri)))</span>
<a href="#l24.54"></a><span id="l24.54">     {</span>
<a href="#l24.55"></a><span id="l24.55">       rv = GetMessage(getter_AddRefs(m_curSrcHdr));</span>
<a href="#l24.56"></a><span id="l24.56">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.57"></a><span id="l24.57">     }</span>
<a href="#l24.58"></a><span id="l24.58">   }</span>
<a href="#l24.59"></a><span id="l24.59">   PRUint32 maxReadCount, readCount, writeCount;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -48,19 +48,18 @@</span>
<a href="#l25.4"></a><span id="l25.4"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6"> #include &quot;rdf.h&quot;</span>
<a href="#l25.7"></a><span id="l25.7"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l25.8"></a><span id="l25.8"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l25.9"></a><span id="l25.9"> #include &quot;nsIRDFNode.h&quot;</span>
<a href="#l25.10"></a><span id="l25.10"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l25.14"></a><span id="l25.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l25.18"></a><span id="l25.18"> #include &quot;nsIMsgCopyService.h&quot;</span>
<a href="#l25.19"></a><span id="l25.19"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l25.20"></a><span id="l25.20"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l25.21"></a><span id="l25.21"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l25.22"></a><span id="l25.22"> #include &quot;nsTraceRefcnt.h&quot;</span>
<a href="#l25.23"></a><span id="l25.23"> #include &quot;nsIMsgFolder.h&quot; // TO include biffState enum. Change to bool later...</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineat">@@ -68,16 +67,20 @@</span>
<a href="#l25.25"></a><span id="l25.25"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l25.26"></a><span id="l25.26"> #include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l25.27"></a><span id="l25.27"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l25.28"></a><span id="l25.28"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l25.29"></a><span id="l25.29"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l25.30"></a><span id="l25.30"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l25.31"></a><span id="l25.31"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l25.32"></a><span id="l25.32"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+#include &quot;nsMemory.h&quot;</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l25.37"></a><span id="l25.37"> </span>
<a href="#l25.38"></a><span id="l25.38"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l25.39"></a><span id="l25.39"> </span>
<a href="#l25.40"></a><span id="l25.40"> nsIRDFResource* nsMsgFolderDataSource::kNC_Child = nsnull;</span>
<a href="#l25.41"></a><span id="l25.41"> nsIRDFResource* nsMsgFolderDataSource::kNC_Folder= nsnull;</span>
<a href="#l25.42"></a><span id="l25.42"> nsIRDFResource* nsMsgFolderDataSource::kNC_Name= nsnull;</span>
<a href="#l25.43"></a><span id="l25.43"> nsIRDFResource* nsMsgFolderDataSource::kNC_Open = nsnull;</span>
<a href="#l25.44"></a><span id="l25.44"> nsIRDFResource* nsMsgFolderDataSource::kNC_FolderTreeName= nsnull;</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineat">@@ -210,29 +213,29 @@ nsMsgFolderDataSource::nsMsgFolderDataSo</span>
<a href="#l25.46"></a><span id="l25.46">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MOVEFOLDER), &amp;kNC_MoveFolder);</span>
<a href="#l25.47"></a><span id="l25.47">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MARKALLMESSAGESREAD),</span>
<a href="#l25.48"></a><span id="l25.48">                              &amp;kNC_MarkAllMessagesRead);</span>
<a href="#l25.49"></a><span id="l25.49">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACT), &amp;kNC_Compact);</span>
<a href="#l25.50"></a><span id="l25.50">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACTALL), &amp;kNC_CompactAll);</span>
<a href="#l25.51"></a><span id="l25.51">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_RENAME), &amp;kNC_Rename);</span>
<a href="#l25.52"></a><span id="l25.52">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_EMPTYTRASH), &amp;kNC_EmptyTrash);</span>
<a href="#l25.53"></a><span id="l25.53"> </span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-    kTotalMessagesAtom           = NS_NewAtom(&quot;TotalMessages&quot;);</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-    kTotalUnreadMessagesAtom     = NS_NewAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-    kFolderSizeAtom              = NS_NewAtom(&quot;FolderSize&quot;);</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineminus">-    kBiffStateAtom               = NS_NewAtom(&quot;BiffState&quot;);</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineminus">-    kSortOrderAtom               = NS_NewAtom(&quot;SortOrder&quot;);</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineminus">-    kNewMessagesAtom             = NS_NewAtom(&quot;NewMessages&quot;);</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineminus">-    kNameAtom                    = NS_NewAtom(&quot;Name&quot;);</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineminus">-    kSynchronizeAtom             = NS_NewAtom(&quot;Synchronize&quot;);</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineminus">-    kOpenAtom                    = NS_NewAtom(&quot;open&quot;);</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineminus">-    kIsDeferredAtom              = NS_NewAtom(&quot;isDeferred&quot;);</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineminus">-    kIsSecureAtom                = NS_NewAtom(&quot;isSecure&quot;);</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineminus">-    kCanFileMessagesAtom         = NS_NewAtom(&quot;canFileMessages&quot;);</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineminus">-    kInVFEditSearchScopeAtom     = NS_NewAtom(&quot;inVFEditSearchScope&quot;);</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineplus">+    kTotalMessagesAtom           = MsgNewAtom(&quot;TotalMessages&quot;);</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+    kTotalUnreadMessagesAtom     = MsgNewAtom(&quot;TotalUnreadMessages&quot;);</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+    kFolderSizeAtom              = MsgNewAtom(&quot;FolderSize&quot;);</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+    kBiffStateAtom               = MsgNewAtom(&quot;BiffState&quot;);</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+    kSortOrderAtom               = MsgNewAtom(&quot;SortOrder&quot;);</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+    kNewMessagesAtom             = MsgNewAtom(&quot;NewMessages&quot;);</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineplus">+    kNameAtom                    = MsgNewAtom(&quot;Name&quot;);</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineplus">+    kSynchronizeAtom             = MsgNewAtom(&quot;Synchronize&quot;);</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineplus">+    kOpenAtom                    = MsgNewAtom(&quot;open&quot;);</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineplus">+    kIsDeferredAtom              = MsgNewAtom(&quot;isDeferred&quot;);</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineplus">+    kIsSecureAtom                = MsgNewAtom(&quot;isSecure&quot;);</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+    kCanFileMessagesAtom         = MsgNewAtom(&quot;canFileMessages&quot;);</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineplus">+    kInVFEditSearchScopeAtom     = MsgNewAtom(&quot;inVFEditSearchScope&quot;);</span>
<a href="#l25.80"></a><span id="l25.80">   }</span>
<a href="#l25.81"></a><span id="l25.81"> </span>
<a href="#l25.82"></a><span id="l25.82">   CreateLiterals(rdf);</span>
<a href="#l25.83"></a><span id="l25.83">   CreateArcsOutEnumerator();</span>
<a href="#l25.84"></a><span id="l25.84"> }</span>
<a href="#l25.85"></a><span id="l25.85"> </span>
<a href="#l25.86"></a><span id="l25.86"> nsMsgFolderDataSource::~nsMsgFolderDataSource (void)</span>
<a href="#l25.87"></a><span id="l25.87"> {</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineat">@@ -1299,17 +1302,17 @@ nsMsgFolderDataSource::createFolderSyncD</span>
<a href="#l25.89"></a><span id="l25.89"> </span>
<a href="#l25.90"></a><span id="l25.90">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l25.91"></a><span id="l25.91">   if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l25.92"></a><span id="l25.92"> </span>
<a href="#l25.93"></a><span id="l25.93">   nsCString serverType;</span>
<a href="#l25.94"></a><span id="l25.94">   rv = server-&gt;GetType(serverType);</span>
<a href="#l25.95"></a><span id="l25.95">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l25.96"></a><span id="l25.96"> </span>
<a href="#l25.97"></a><span id="l25.97" class="difflineminus">-  *target = isServer || serverType.LowerCaseEqualsLiteral(&quot;none&quot;) || serverType.LowerCaseEqualsLiteral(&quot;pop3&quot;) ?</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineplus">+  *target = isServer ||  MsgLowerCaseEqualsLiteral(serverType, &quot;none&quot;) || MsgLowerCaseEqualsLiteral(serverType, &quot;pop3&quot;) ?</span>
<a href="#l25.99"></a><span id="l25.99">             kTrueLiteral : kFalseLiteral;</span>
<a href="#l25.100"></a><span id="l25.100">   NS_IF_ADDREF(*target);</span>
<a href="#l25.101"></a><span id="l25.101">   return NS_OK;</span>
<a href="#l25.102"></a><span id="l25.102"> }</span>
<a href="#l25.103"></a><span id="l25.103"> </span>
<a href="#l25.104"></a><span id="l25.104"> nsresult</span>
<a href="#l25.105"></a><span id="l25.105"> nsMsgFolderDataSource::createCanSearchMessages(nsIMsgFolder* folder,</span>
<a href="#l25.106"></a><span id="l25.106">                                                                  nsIRDFNode **target)</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineat">@@ -2198,17 +2201,17 @@ void nsMsgFlatFolderDataSource::EnsureFo</span>
<a href="#l25.108"></a><span id="l25.108">     // need an enumerator that gives all folders with unread</span>
<a href="#l25.109"></a><span id="l25.109">     nsresult rv;</span>
<a href="#l25.110"></a><span id="l25.110">     nsCOMPtr &lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l25.111"></a><span id="l25.111">     if (NS_FAILED(rv))</span>
<a href="#l25.112"></a><span id="l25.112">       return;</span>
<a href="#l25.113"></a><span id="l25.113"> </span>
<a href="#l25.114"></a><span id="l25.114">     nsCOMPtr&lt;nsISupportsArray&gt; allServers;</span>
<a href="#l25.115"></a><span id="l25.115">     rv = accountManager-&gt;GetAllServers(getter_AddRefs(allServers));</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineminus">-    nsCOMPtr &lt;nsISupportsArray&gt; allFolders = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv);;</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineplus">+    nsCOMPtr &lt;nsISupportsArray&gt; allFolders = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l25.118"></a><span id="l25.118">     if (NS_SUCCEEDED(rv) &amp;&amp; allServers)</span>
<a href="#l25.119"></a><span id="l25.119">     {</span>
<a href="#l25.120"></a><span id="l25.120">       PRUint32 count = 0;</span>
<a href="#l25.121"></a><span id="l25.121">       allServers-&gt;Count(&amp;count);</span>
<a href="#l25.122"></a><span id="l25.122">       PRUint32 i;</span>
<a href="#l25.123"></a><span id="l25.123">       for (i = 0; i &lt; count; i++)</span>
<a href="#l25.124"></a><span id="l25.124">       {</span>
<a href="#l25.125"></a><span id="l25.125">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryElementAt(allServers, i);</span>
<a href="#l25.126"></a><span id="l25.126" class="difflineat">@@ -2397,17 +2400,17 @@ void nsMsgRecentFoldersDataSource::Ensur</span>
<a href="#l25.127"></a><span id="l25.127"> </span>
<a href="#l25.128"></a><span id="l25.128">     nsresult rv;</span>
<a href="#l25.129"></a><span id="l25.129">     nsCOMPtr &lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l25.130"></a><span id="l25.130">     if (NS_FAILED(rv))</span>
<a href="#l25.131"></a><span id="l25.131">       return;</span>
<a href="#l25.132"></a><span id="l25.132"> </span>
<a href="#l25.133"></a><span id="l25.133">     nsCOMPtr&lt;nsISupportsArray&gt; allServers;</span>
<a href="#l25.134"></a><span id="l25.134">     rv = accountManager-&gt;GetAllServers(getter_AddRefs(allServers));</span>
<a href="#l25.135"></a><span id="l25.135" class="difflineminus">-    nsCOMPtr &lt;nsISupportsArray&gt; allFolders = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv);;</span>
<a href="#l25.136"></a><span id="l25.136" class="difflineplus">+    nsCOMPtr &lt;nsISupportsArray&gt; allFolders = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l25.137"></a><span id="l25.137">     if (NS_SUCCEEDED(rv) &amp;&amp; allServers)</span>
<a href="#l25.138"></a><span id="l25.138">     {</span>
<a href="#l25.139"></a><span id="l25.139">       PRUint32 count = 0;</span>
<a href="#l25.140"></a><span id="l25.140">       allServers-&gt;Count(&amp;count);</span>
<a href="#l25.141"></a><span id="l25.141">       PRUint32 i;</span>
<a href="#l25.142"></a><span id="l25.142">       for (i = 0; i &lt; count; i++)</span>
<a href="#l25.143"></a><span id="l25.143">       {</span>
<a href="#l25.144"></a><span id="l25.144">         nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryElementAt(allServers, i);</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineat">@@ -2424,17 +2427,17 @@ void nsMsgRecentFoldersDataSource::Ensur</span>
<a href="#l25.146"></a><span id="l25.146">             allFolders-&gt;Count(&amp;lastEntry);</span>
<a href="#l25.147"></a><span id="l25.147">             rv = rootFolder-&gt;ListDescendents(allFolders);</span>
<a href="#l25.148"></a><span id="l25.148">             PRUint32 newLastEntry;</span>
<a href="#l25.149"></a><span id="l25.149">             allFolders-&gt;Count(&amp;newLastEntry);</span>
<a href="#l25.150"></a><span id="l25.150">             for (PRUint32 newEntryIndex = lastEntry; newEntryIndex &lt; newLastEntry; newEntryIndex++)</span>
<a href="#l25.151"></a><span id="l25.151">             {</span>
<a href="#l25.152"></a><span id="l25.152">               nsCOMPtr &lt;nsIMsgFolder&gt; curFolder = do_QueryElementAt(allFolders, newEntryIndex);</span>
<a href="#l25.153"></a><span id="l25.153">               nsCString dateStr;</span>
<a href="#l25.154"></a><span id="l25.154" class="difflineminus">-              PRInt32 err;</span>
<a href="#l25.155"></a><span id="l25.155" class="difflineplus">+              nsresult err;</span>
<a href="#l25.156"></a><span id="l25.156">               curFolder-&gt;GetStringProperty(MRU_TIME_PROPERTY, dateStr);</span>
<a href="#l25.157"></a><span id="l25.157">               PRUint32 curFolderDate = (PRUint32) dateStr.ToInteger(&amp;err, 10);</span>
<a href="#l25.158"></a><span id="l25.158">               if (err)</span>
<a href="#l25.159"></a><span id="l25.159">                 curFolderDate = 0;</span>
<a href="#l25.160"></a><span id="l25.160">               if (curFolderDate &gt; m_cutOffDate)</span>
<a href="#l25.161"></a><span id="l25.161">               {</span>
<a href="#l25.162"></a><span id="l25.162">                 // if m_folders is &quot;full&quot;, replace oldest folder with this folder,</span>
<a href="#l25.163"></a><span id="l25.163">                 // and adjust m_cutOffDate so that it's the mrutime</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderNotificationService.h</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderNotificationService.h</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -37,16 +37,17 @@</span>
<a href="#l26.4"></a><span id="l26.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6"> #ifndef nsMsgFolderNotificationService_h__</span>
<a href="#l26.7"></a><span id="l26.7"> #define nsMsgFolderNotificationService_h__</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;nsIMsgFolderListener.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> #include &quot;nsTObserverArray.h&quot;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l26.13"></a><span id="l26.13"> </span>
<a href="#l26.14"></a><span id="l26.14"> class nsMsgFolderNotificationService : public nsIMsgFolderNotificationService</span>
<a href="#l26.15"></a><span id="l26.15"> {</span>
<a href="#l26.16"></a><span id="l26.16"> public:</span>
<a href="#l26.17"></a><span id="l26.17">   NS_DECL_ISUPPORTS</span>
<a href="#l26.18"></a><span id="l26.18">   NS_DECL_NSIMSGFOLDERNOTIFICATIONSERVICE</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20">   nsMsgFolderNotificationService();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -35,16 +35,17 @@</span>
<a href="#l27.4"></a><span id="l27.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.5"></a><span id="l27.5">  *</span>
<a href="#l27.6"></a><span id="l27.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> #include &quot;msgCore.h&quot;</span>
<a href="#l27.9"></a><span id="l27.9"> #include &quot;nsMsgGroupThread.h&quot;</span>
<a href="#l27.10"></a><span id="l27.10"> #include &quot;nsMsgDBView.h&quot;</span>
<a href="#l27.11"></a><span id="l27.11"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l27.13"></a><span id="l27.13"> </span>
<a href="#l27.14"></a><span id="l27.14"> NS_IMPL_ISUPPORTS1(nsMsgGroupThread, nsIMsgThread)</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> nsMsgGroupThread::nsMsgGroupThread()</span>
<a href="#l27.17"></a><span id="l27.17"> {</span>
<a href="#l27.18"></a><span id="l27.18">   Init();</span>
<a href="#l27.19"></a><span id="l27.19"> }</span>
<a href="#l27.20"></a><span id="l27.20"> nsMsgGroupThread::nsMsgGroupThread(nsIMsgDatabase *db)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupView.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -788,17 +788,18 @@ NS_IMETHODIMP nsMsgGroupView::GetCellTex</span>
<a href="#l28.4"></a><span id="l28.4">     nsCOMPtr&lt;nsIMsgThread&gt; msgThread;</span>
<a href="#l28.5"></a><span id="l28.5">     m_groupsTable.Get(hashKey, getter_AddRefs(msgThread));</span>
<a href="#l28.6"></a><span id="l28.6">     nsMsgGroupThread * groupThread = static_cast&lt;nsMsgGroupThread *&gt;(msgThread.get());</span>
<a href="#l28.7"></a><span id="l28.7">     if (colID[0] == 's'  &amp;&amp; colID[1] == 'u' )</span>
<a href="#l28.8"></a><span id="l28.8">     {</span>
<a href="#l28.9"></a><span id="l28.9">       PRUint32 flags;</span>
<a href="#l28.10"></a><span id="l28.10">       PRBool rcvDate = PR_FALSE;</span>
<a href="#l28.11"></a><span id="l28.11">       msgHdr-&gt;GetFlags(&amp;flags);</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-      aValue.SetCapacity(0);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+      aValue.Truncate();</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+      nsString tmp_str;</span>
<a href="#l28.15"></a><span id="l28.15">       switch (m_sortType)</span>
<a href="#l28.16"></a><span id="l28.16">       {</span>
<a href="#l28.17"></a><span id="l28.17">         case nsMsgViewSortType::byReceived:</span>
<a href="#l28.18"></a><span id="l28.18">           rcvDate = PR_TRUE;</span>
<a href="#l28.19"></a><span id="l28.19">         case nsMsgViewSortType::byDate:</span>
<a href="#l28.20"></a><span id="l28.20">         {</span>
<a href="#l28.21"></a><span id="l28.21">           PRUint32 ageBucket = 0;</span>
<a href="#l28.22"></a><span id="l28.22">           GetAgeBucketValue(msgHdr, &amp;ageBucket, rcvDate);</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineat">@@ -835,44 +836,52 @@ NS_IMETHODIMP nsMsgGroupView::GetCellTex</span>
<a href="#l28.24"></a><span id="l28.24">           }</span>
<a href="#l28.25"></a><span id="l28.25">           break;</span>
<a href="#l28.26"></a><span id="l28.26">         }</span>
<a href="#l28.27"></a><span id="l28.27">         case nsMsgViewSortType::byAuthor:</span>
<a href="#l28.28"></a><span id="l28.28">           FetchAuthor(msgHdr, aValue);</span>
<a href="#l28.29"></a><span id="l28.29">           break;</span>
<a href="#l28.30"></a><span id="l28.30">         case nsMsgViewSortType::byStatus:</span>
<a href="#l28.31"></a><span id="l28.31">           rv = FetchStatus(m_flags[aRow], aValue);</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-          if (aValue.IsEmpty())</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-            aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messagesWithNoStatus&quot;).get()));</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+          if (aValue.IsEmpty()) {</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+            tmp_str.Adopt(GetString(NS_LITERAL_STRING(&quot;messagesWithNoStatus&quot;).get()));</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+            aValue.Assign(tmp_str);</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+          }</span>
<a href="#l28.38"></a><span id="l28.38">           break;</span>
<a href="#l28.39"></a><span id="l28.39">         case nsMsgViewSortType::byTags:</span>
<a href="#l28.40"></a><span id="l28.40">           rv = FetchTags(msgHdr, aValue);</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-          if (aValue.IsEmpty())</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineminus">-            aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;untaggedMessages&quot;).get()));</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+          if (aValue.IsEmpty()) {</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+            tmp_str.Adopt(GetString(NS_LITERAL_STRING(&quot;untaggedMessages&quot;).get()));</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineplus">+            aValue.Assign(tmp_str);</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineplus">+          }</span>
<a href="#l28.47"></a><span id="l28.47">           break;</span>
<a href="#l28.48"></a><span id="l28.48">         case nsMsgViewSortType::byPriority:</span>
<a href="#l28.49"></a><span id="l28.49">           FetchPriority(msgHdr, aValue);</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-          if (aValue.IsEmpty())</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-            aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;noPriority&quot;).get()));</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+          if (aValue.IsEmpty()) {</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineplus">+            tmp_str.Adopt(GetString(NS_LITERAL_STRING(&quot;noPriority&quot;).get()));</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+            aValue.Assign(tmp_str);</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineplus">+          }</span>
<a href="#l28.56"></a><span id="l28.56">           break;</span>
<a href="#l28.57"></a><span id="l28.57">         case nsMsgViewSortType::byAccount:</span>
<a href="#l28.58"></a><span id="l28.58">           FetchAccount(msgHdr, aValue);</span>
<a href="#l28.59"></a><span id="l28.59">           break;</span>
<a href="#l28.60"></a><span id="l28.60">         case nsMsgViewSortType::byRecipient:</span>
<a href="#l28.61"></a><span id="l28.61">           FetchRecipients(msgHdr, aValue);</span>
<a href="#l28.62"></a><span id="l28.62">           break;</span>
<a href="#l28.63"></a><span id="l28.63">         case nsMsgViewSortType::byAttachments:</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-          aValue.Adopt(GetString(flags &amp; nsMsgMessageFlags::Attachment</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+          tmp_str.Adopt(GetString(flags &amp; nsMsgMessageFlags::Attachment</span>
<a href="#l28.66"></a><span id="l28.66">             ? NS_LITERAL_STRING(&quot;attachments&quot;).get()</span>
<a href="#l28.67"></a><span id="l28.67">             : NS_LITERAL_STRING(&quot;noAttachments&quot;).get()));</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineplus">+          aValue.Assign(tmp_str);</span>
<a href="#l28.69"></a><span id="l28.69">           break;</span>
<a href="#l28.70"></a><span id="l28.70">         case nsMsgViewSortType::byFlagged:</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-          aValue.Adopt(GetString(flags &amp; nsMsgMessageFlags::Marked </span>
<a href="#l28.72"></a><span id="l28.72" class="difflineplus">+          tmp_str.Adopt(GetString(flags &amp; nsMsgMessageFlags::Marked</span>
<a href="#l28.73"></a><span id="l28.73">             ? NS_LITERAL_STRING(&quot;groupFlagged&quot;).get()</span>
<a href="#l28.74"></a><span id="l28.74">             : NS_LITERAL_STRING(&quot;notFlagged&quot;).get()));</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+          aValue.Assign(tmp_str);</span>
<a href="#l28.76"></a><span id="l28.76">           break;</span>
<a href="#l28.77"></a><span id="l28.77">         // byLocation is a special case; we don't want to have duplicate</span>
<a href="#l28.78"></a><span id="l28.78">         //  all this logic in nsMsgSearchDBView, and its hash key is what we</span>
<a href="#l28.79"></a><span id="l28.79">         //  want anyways, so just copy it across.</span>
<a href="#l28.80"></a><span id="l28.80">         case nsMsgViewSortType::byLocation:</span>
<a href="#l28.81"></a><span id="l28.81">           aValue = hashKey;</span>
<a href="#l28.82"></a><span id="l28.82">           break;</span>
<a href="#l28.83"></a><span id="l28.83">         case nsMsgViewSortType::byCustom:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -56,16 +56,19 @@</span>
<a href="#l29.4"></a><span id="l29.4"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l29.5"></a><span id="l29.5"> #include &quot;nsIAppShellService.h&quot;</span>
<a href="#l29.6"></a><span id="l29.6"> #include &quot;nsAppShellCID.h&quot;</span>
<a href="#l29.7"></a><span id="l29.7"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l29.8"></a><span id="l29.8"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l29.9"></a><span id="l29.9"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l29.10"></a><span id="l29.10"> #include &quot;prcmon.h&quot;</span>
<a href="#l29.11"></a><span id="l29.11"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+#include &quot;nsIProperties.h&quot;</span>
<a href="#l29.15"></a><span id="l29.15"> </span>
<a href="#l29.16"></a><span id="l29.16"> NS_IMPL_THREADSAFE_ADDREF(nsMsgMailSession)</span>
<a href="#l29.17"></a><span id="l29.17"> NS_IMPL_THREADSAFE_RELEASE(nsMsgMailSession)</span>
<a href="#l29.18"></a><span id="l29.18"> NS_INTERFACE_MAP_BEGIN(nsMsgMailSession)</span>
<a href="#l29.19"></a><span id="l29.19">   NS_INTERFACE_MAP_ENTRY(nsIMsgMailSession)</span>
<a href="#l29.20"></a><span id="l29.20">   NS_INTERFACE_MAP_ENTRY(nsIFolderListener)</span>
<a href="#l29.21"></a><span id="l29.21">   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMsgMailSession)</span>
<a href="#l29.22"></a><span id="l29.22"> NS_INTERFACE_MAP_END_THREADSAFE</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineat">@@ -735,17 +738,17 @@ NS_IMETHODIMP nsMsgShutdownService::Obse</span>
<a href="#l29.24"></a><span id="l29.24">     }</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26">     mMsgProgress-&gt;OpenProgressDialog(internalDomWin, topMsgWindow, </span>
<a href="#l29.27"></a><span id="l29.27">                                      &quot;chrome://messenger/content/shutdownWindow.xul&quot;, </span>
<a href="#l29.28"></a><span id="l29.28">                                      PR_FALSE, nsnull);</span>
<a href="#l29.29"></a><span id="l29.29"> </span>
<a href="#l29.30"></a><span id="l29.30">     if (mQuitForced)</span>
<a href="#l29.31"></a><span id="l29.31">     {</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">-      nsIThread *thread = NS_GetCurrentThread();</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+      nsCOMPtr&lt;nsIThread&gt; thread(do_GetCurrentThread());</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">       mReadyToQuit = PR_FALSE;</span>
<a href="#l29.36"></a><span id="l29.36">       while (!mReadyToQuit)</span>
<a href="#l29.37"></a><span id="l29.37">       {</span>
<a href="#l29.38"></a><span id="l29.38">         PR_CEnterMonitor(this);</span>
<a href="#l29.39"></a><span id="l29.39">         // Waiting for 50 milliseconds</span>
<a href="#l29.40"></a><span id="l29.40">         PR_CWait(this, PR_MicrosecondsToInterval(50000UL));</span>
<a href="#l29.41"></a><span id="l29.41">         PR_CExitMonitor(this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -49,16 +49,17 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #include &quot;nsIMsgSendLater.h&quot;</span>
<a href="#l30.5"></a><span id="l30.5"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l30.8"></a><span id="l30.8"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsMsgNewsCID.h&quot;</span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsINntpService.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l30.13"></a><span id="l30.13"> </span>
<a href="#l30.14"></a><span id="l30.14"> static NS_DEFINE_CID(kMsgSendLaterCID, NS_MSGSENDLATER_CID); </span>
<a href="#l30.15"></a><span id="l30.15"> </span>
<a href="#l30.16"></a><span id="l30.16"> NS_IMPL_THREADSAFE_ISUPPORTS5(nsMsgOfflineManager,</span>
<a href="#l30.17"></a><span id="l30.17">                               nsIMsgOfflineManager,</span>
<a href="#l30.18"></a><span id="l30.18">                               nsIMsgSendLaterListener,</span>
<a href="#l30.19"></a><span id="l30.19">                               nsIObserver,</span>
<a href="#l30.20"></a><span id="l30.20">                               nsISupportsWeakReference,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -40,21 +40,19 @@</span>
<a href="#l31.4"></a><span id="l31.4"> #include &quot;nscore.h&quot;</span>
<a href="#l31.5"></a><span id="l31.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9"> #include &quot;nsISupports.h&quot;</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11"> #include &quot;nsIURI.h&quot;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l31.13"></a><span id="l31.13"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l31.14"></a><span id="l31.14"> #include &quot;nsPIDOMWindow.h&quot;</span>
<a href="#l31.15"></a><span id="l31.15"> #include &quot;nsIDocumentViewer.h&quot;</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-#include &quot;nsPresContext.h&quot;</span>
<a href="#l31.17"></a><span id="l31.17"> #include &quot;nsIPresShell.h&quot;</span>
<a href="#l31.18"></a><span id="l31.18"> #include &quot;nsIDocument.h&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l31.20"></a><span id="l31.20"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l31.21"></a><span id="l31.21"> #include &quot;nsIWebProgress.h&quot;</span>
<a href="#l31.22"></a><span id="l31.22"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l31.23"></a><span id="l31.23"> #include &quot;nsIMarkupDocumentViewer.h&quot;</span>
<a href="#l31.24"></a><span id="l31.24"> #include &quot;nsMsgPrintEngine.h&quot;</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineat">@@ -71,16 +69,17 @@</span>
<a href="#l31.26"></a><span id="l31.26"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l31.27"></a><span id="l31.27"> #include &quot;nsIDocShellTreeOwner.h&quot;</span>
<a href="#l31.28"></a><span id="l31.28"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l31.29"></a><span id="l31.29"> #include &quot;nsIDocShellTreeNode.h&quot;</span>
<a href="#l31.30"></a><span id="l31.30"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l31.31"></a><span id="l31.31"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l31.32"></a><span id="l31.32"> #include &quot;nsIContentViewerFile.h&quot;</span>
<a href="#l31.33"></a><span id="l31.33"> #include &quot;nsIPrintingPromptService.h&quot;</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36"> static const char* kPrintingPromptService = &quot;@mozilla.org/embedcomp/printingprompt-service;1&quot;;</span>
<a href="#l31.37"></a><span id="l31.37"> </span>
<a href="#l31.38"></a><span id="l31.38"> /////////////////////////////////////////////////////////////////////////</span>
<a href="#l31.39"></a><span id="l31.39"> // nsMsgPrintEngine implementation</span>
<a href="#l31.40"></a><span id="l31.40"> /////////////////////////////////////////////////////////////////////////</span>
<a href="#l31.41"></a><span id="l31.41"> </span>
<a href="#l31.42"></a><span id="l31.42"> nsMsgPrintEngine::nsMsgPrintEngine() :</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -42,16 +42,18 @@</span>
<a href="#l32.4"></a><span id="l32.4"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l32.5"></a><span id="l32.5"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l32.6"></a><span id="l32.6"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l32.7"></a><span id="l32.7"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l32.8"></a><span id="l32.8"> #include &quot;nsNetError.h&quot;</span>
<a href="#l32.9"></a><span id="l32.9"> #include &quot;nsInt64.h&quot;</span>
<a href="#l32.10"></a><span id="l32.10"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l32.11"></a><span id="l32.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l32.14"></a><span id="l32.14"> </span>
<a href="#l32.15"></a><span id="l32.15"> NS_IMPL_THREADSAFE_ADDREF(nsMsgProgress)</span>
<a href="#l32.16"></a><span id="l32.16"> NS_IMPL_THREADSAFE_RELEASE(nsMsgProgress)</span>
<a href="#l32.17"></a><span id="l32.17"> </span>
<a href="#l32.18"></a><span id="l32.18"> NS_INTERFACE_MAP_BEGIN(nsMsgProgress)</span>
<a href="#l32.19"></a><span id="l32.19">   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMsgStatusFeedback)</span>
<a href="#l32.20"></a><span id="l32.20">   NS_INTERFACE_MAP_ENTRY(nsIMsgProgress)</span>
<a href="#l32.21"></a><span id="l32.21">   NS_INTERFACE_MAP_ENTRY(nsIMsgStatusFeedback)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/base/src/nsMsgProgress.h</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgProgress.h</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -39,17 +39,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> #ifndef nsMsgProgress_h_</span>
<a href="#l33.5"></a><span id="l33.5"> #define nsMsgProgress_h_</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7"> #include &quot;nsIMsgProgress.h&quot;</span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &quot;nsIDOMWindowInternal.h&quot;</span>
<a href="#l33.11"></a><span id="l33.11"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l33.14"></a><span id="l33.14"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l33.15"></a><span id="l33.15"> #include &quot;nsIProgressEventSink.h&quot;</span>
<a href="#l33.16"></a><span id="l33.16"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l33.17"></a><span id="l33.17"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19"> class nsMsgProgress : public nsIMsgProgress, </span>
<a href="#l33.20"></a><span id="l33.20">                       public nsIMsgStatusFeedback, </span>
<a href="#l33.21"></a><span id="l33.21">                       public nsIProgressEventSink,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPurgeService.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPurgeService.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -54,16 +54,18 @@</span>
<a href="#l34.4"></a><span id="l34.4"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l34.5"></a><span id="l34.5"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l34.6"></a><span id="l34.6"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l34.7"></a><span id="l34.7"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l34.8"></a><span id="l34.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l34.9"></a><span id="l34.9"> #include &quot;prlog.h&quot;</span>
<a href="#l34.10"></a><span id="l34.10"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l34.11"></a><span id="l34.11"> #include &lt;stdlib.h&gt;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l34.14"></a><span id="l34.14"> </span>
<a href="#l34.15"></a><span id="l34.15"> static PRLogModuleInfo *MsgPurgeLogModule = nsnull;</span>
<a href="#l34.16"></a><span id="l34.16"> </span>
<a href="#l34.17"></a><span id="l34.17"> NS_IMPL_ISUPPORTS2(nsMsgPurgeService, nsIMsgPurgeService, nsIMsgSearchNotify)</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19"> void OnPurgeTimer(nsITimer *timer, void *aPurgeService)</span>
<a href="#l34.20"></a><span id="l34.20"> {</span>
<a href="#l34.21"></a><span id="l34.21">   nsMsgPurgeService *purgeService = (nsMsgPurgeService*)aPurgeService;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -43,16 +43,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l35.5"></a><span id="l35.5"> #include &quot;nsIMsgImapMailFolder.h&quot;</span>
<a href="#l35.6"></a><span id="l35.6"> #include &quot;nsImapCore.h&quot;</span>
<a href="#l35.7"></a><span id="l35.7"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l35.8"></a><span id="l35.8"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l35.9"></a><span id="l35.9"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l35.10"></a><span id="l35.10"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l35.11"></a><span id="l35.11"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l35.13"></a><span id="l35.13"> </span>
<a href="#l35.14"></a><span id="l35.14"> nsMsgQuickSearchDBView::nsMsgQuickSearchDBView()</span>
<a href="#l35.15"></a><span id="l35.15"> {</span>
<a href="#l35.16"></a><span id="l35.16">   m_usingCachedHits = PR_FALSE;</span>
<a href="#l35.17"></a><span id="l35.17">   m_cacheEmpty = PR_TRUE;</span>
<a href="#l35.18"></a><span id="l35.18"> }</span>
<a href="#l35.19"></a><span id="l35.19"> </span>
<a href="#l35.20"></a><span id="l35.20"> nsMsgQuickSearchDBView::~nsMsgQuickSearchDBView()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -37,16 +37,18 @@</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5"> #include &quot;nsMsgRDFDataSource.h&quot;</span>
<a href="#l36.6"></a><span id="l36.6"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l36.7"></a><span id="l36.7"> #include &quot;rdf.h&quot;</span>
<a href="#l36.8"></a><span id="l36.8"> #include &quot;plstr.h&quot;</span>
<a href="#l36.9"></a><span id="l36.9"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l36.10"></a><span id="l36.10"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l36.11"></a><span id="l36.11"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l36.14"></a><span id="l36.14"> </span>
<a href="#l36.15"></a><span id="l36.15"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l36.16"></a><span id="l36.16"> </span>
<a href="#l36.17"></a><span id="l36.17"> nsMsgRDFDataSource::nsMsgRDFDataSource():</span>
<a href="#l36.18"></a><span id="l36.18">     m_shuttingDown(PR_FALSE),</span>
<a href="#l36.19"></a><span id="l36.19">     mInitialized(PR_FALSE)</span>
<a href="#l36.20"></a><span id="l36.20"> {</span>
<a href="#l36.21"></a><span id="l36.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFUtils.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFUtils.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -34,17 +34,16 @@</span>
<a href="#l37.4"></a><span id="l37.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l37.5"></a><span id="l37.5">  *</span>
<a href="#l37.6"></a><span id="l37.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l37.7"></a><span id="l37.7"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l37.8"></a><span id="l37.8"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l37.9"></a><span id="l37.9"> #include &quot;prprf.h&quot;</span>
<a href="#l37.10"></a><span id="l37.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l37.11"></a><span id="l37.11"> #include &quot;nsMemory.h&quot;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l37.13"></a><span id="l37.13"> </span>
<a href="#l37.14"></a><span id="l37.14"> nsresult createNode(const PRUnichar *str, nsIRDFNode **node, nsIRDFService *rdfService)</span>
<a href="#l37.15"></a><span id="l37.15"> {</span>
<a href="#l37.16"></a><span id="l37.16">   nsresult rv;</span>
<a href="#l37.17"></a><span id="l37.17">   nsCOMPtr&lt;nsIRDFLiteral&gt; value;</span>
<a href="#l37.18"></a><span id="l37.18"> </span>
<a href="#l37.19"></a><span id="l37.19">   NS_ASSERTION(rdfService, &quot;rdfService is null&quot;);</span>
<a href="#l37.20"></a><span id="l37.20">   if (!rdfService) return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -51,16 +51,18 @@</span>
<a href="#l38.4"></a><span id="l38.4"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l38.5"></a><span id="l38.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l38.6"></a><span id="l38.6"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l38.7"></a><span id="l38.7"> #include &quot;nsMsgGroupThread.h&quot;</span>
<a href="#l38.8"></a><span id="l38.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l38.9"></a><span id="l38.9"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l38.10"></a><span id="l38.10"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l38.11"></a><span id="l38.11"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15"> static PRBool gReferenceOnlyThreading;</span>
<a href="#l38.16"></a><span id="l38.16"> </span>
<a href="#l38.17"></a><span id="l38.17"> nsMsgSearchDBView::nsMsgSearchDBView()</span>
<a href="#l38.18"></a><span id="l38.18"> {</span>
<a href="#l38.19"></a><span id="l38.19">   // don't try to display messages for the search pane.</span>
<a href="#l38.20"></a><span id="l38.20">   mSuppressMsgDisplay = PR_TRUE;</span>
<a href="#l38.21"></a><span id="l38.21">   m_threadsTable.Init();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -50,33 +50,34 @@</span>
<a href="#l39.4"></a><span id="l39.4"> #include &quot;nsInt64.h&quot;</span>
<a href="#l39.5"></a><span id="l39.5"> #include &quot;nsITimelineService.h&quot;</span>
<a href="#l39.6"></a><span id="l39.6"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l39.7"></a><span id="l39.7"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l39.8"></a><span id="l39.8"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l39.9"></a><span id="l39.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l39.10"></a><span id="l39.10"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l39.11"></a><span id="l39.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l39.13"></a><span id="l39.13"> </span>
<a href="#l39.14"></a><span id="l39.14"> #define MSGFEEDBACK_TIMER_INTERVAL 500</span>
<a href="#l39.15"></a><span id="l39.15"> </span>
<a href="#l39.16"></a><span id="l39.16"> nsMsgStatusFeedback::nsMsgStatusFeedback() :</span>
<a href="#l39.17"></a><span id="l39.17">   m_lastPercent(0)</span>
<a href="#l39.18"></a><span id="l39.18"> {</span>
<a href="#l39.19"></a><span id="l39.19">   LL_I2L(m_lastProgressTime, 0);</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21">   nsresult rv;</span>
<a href="#l39.22"></a><span id="l39.22">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l39.23"></a><span id="l39.23">     do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25">   if (NS_SUCCEEDED(rv))</span>
<a href="#l39.26"></a><span id="l39.26">     bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l39.27"></a><span id="l39.27">                                 getter_AddRefs(mBundle));</span>
<a href="#l39.28"></a><span id="l39.28"> </span>
<a href="#l39.29"></a><span id="l39.29" class="difflineminus">-  m_msgLoadedAtom = do_GetAtom(&quot;msgLoaded&quot;);</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineplus">+  m_msgLoadedAtom = MsgGetAtom(&quot;msgLoaded&quot;);</span>
<a href="#l39.31"></a><span id="l39.31"> }</span>
<a href="#l39.32"></a><span id="l39.32"> </span>
<a href="#l39.33"></a><span id="l39.33"> nsMsgStatusFeedback::~nsMsgStatusFeedback()</span>
<a href="#l39.34"></a><span id="l39.34"> {</span>
<a href="#l39.35"></a><span id="l39.35">   mBundle = nsnull;</span>
<a href="#l39.36"></a><span id="l39.36"> }</span>
<a href="#l39.37"></a><span id="l39.37"> </span>
<a href="#l39.38"></a><span id="l39.38"> NS_IMPL_THREADSAFE_ADDREF(nsMsgStatusFeedback)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -42,16 +42,19 @@</span>
<a href="#l40.4"></a><span id="l40.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l40.5"></a><span id="l40.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l40.6"></a><span id="l40.6"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l40.7"></a><span id="l40.7"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l40.8"></a><span id="l40.8"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l40.9"></a><span id="l40.9"> #include &quot;nsMsgDBView.h&quot; // for labels migration</span>
<a href="#l40.10"></a><span id="l40.10"> #include &quot;nsQuickSort.h&quot;</span>
<a href="#l40.11"></a><span id="l40.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+#include &quot;nsMemory.h&quot;</span>
<a href="#l40.15"></a><span id="l40.15"> </span>
<a href="#l40.16"></a><span id="l40.16"> #define STRLEN(s) (sizeof(s) - 1)</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18"> #define TAG_PREF_VERSION        &quot;version&quot;</span>
<a href="#l40.19"></a><span id="l40.19"> #define TAG_PREF_SUFFIX_TAG     &quot;.tag&quot;</span>
<a href="#l40.20"></a><span id="l40.20"> #define TAG_PREF_SUFFIX_COLOR   &quot;.color&quot;</span>
<a href="#l40.21"></a><span id="l40.21"> #define TAG_PREF_SUFFIX_ORDINAL &quot;.ordinal&quot;</span>
<a href="#l40.22"></a><span id="l40.22"> #define TAG_CMP_LESSER          -1</span>
<a href="#l40.23"></a><span id="l40.23" class="difflineat">@@ -277,17 +280,17 @@ NS_IMETHODIMP nsMsgTagService::AddTag(co</span>
<a href="#l40.24"></a><span id="l40.24">                                       const nsACString &amp;ordinal)</span>
<a href="#l40.25"></a><span id="l40.25"> {</span>
<a href="#l40.26"></a><span id="l40.26">   // figure out key from tag. Apply transformation stripping out</span>
<a href="#l40.27"></a><span id="l40.27">   // illegal characters like &lt;SP&gt; and then convert to imap mod utf7.</span>
<a href="#l40.28"></a><span id="l40.28">   // Then, check if we have a tag with that key yet, and if so,</span>
<a href="#l40.29"></a><span id="l40.29">   // make it unique by appending A, AA, etc.</span>
<a href="#l40.30"></a><span id="l40.30">   // Should we use an iterator?</span>
<a href="#l40.31"></a><span id="l40.31">   nsAutoString transformedTag(tag);</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineminus">-  transformedTag.ReplaceChar(&quot; ()/{%*&lt;&gt;\\\&quot;&quot;, '_');</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineplus">+  MsgReplaceChar(transformedTag, &quot; ()/{%*&lt;&gt;\\\&quot;&quot;, '_');</span>
<a href="#l40.34"></a><span id="l40.34">   nsCAutoString key;</span>
<a href="#l40.35"></a><span id="l40.35">   CopyUTF16toMUTF7(transformedTag, key);</span>
<a href="#l40.36"></a><span id="l40.36">   // We have an imap server that converts keys to upper case so we're going</span>
<a href="#l40.37"></a><span id="l40.37">   // to normalize all keys to lower case (upper case looks ugly in prefs.js)</span>
<a href="#l40.38"></a><span id="l40.38">   ToLowerCase(key);</span>
<a href="#l40.39"></a><span id="l40.39">   nsCAutoString prefName(key);</span>
<a href="#l40.40"></a><span id="l40.40">   while (PR_TRUE)</span>
<a href="#l40.41"></a><span id="l40.41">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.h</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.h</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -37,16 +37,17 @@</span>
<a href="#l41.4"></a><span id="l41.4">  *</span>
<a href="#l41.5"></a><span id="l41.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7"> #ifndef nsMsgTagService_h__</span>
<a href="#l41.8"></a><span id="l41.8"> #define nsMsgTagService_h__</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10"> #include &quot;nsIMsgTagService.h&quot;</span>
<a href="#l41.11"></a><span id="l41.11"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l41.13"></a><span id="l41.13"> </span>
<a href="#l41.14"></a><span id="l41.14"> </span>
<a href="#l41.15"></a><span id="l41.15"> class nsMsgTag : public nsIMsgTag</span>
<a href="#l41.16"></a><span id="l41.16"> {</span>
<a href="#l41.17"></a><span id="l41.17"> public:</span>
<a href="#l41.18"></a><span id="l41.18">   NS_DECL_ISUPPORTS</span>
<a href="#l41.19"></a><span id="l41.19">   NS_DECL_NSIMSGTAG</span>
<a href="#l41.20"></a><span id="l41.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/base/src/nsMsgWindow.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgWindow.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -31,17 +31,16 @@</span>
<a href="#l42.4"></a><span id="l42.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l42.5"></a><span id="l42.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l42.6"></a><span id="l42.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l42.7"></a><span id="l42.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l42.8"></a><span id="l42.8">  *</span>
<a href="#l42.9"></a><span id="l42.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l42.10"></a><span id="l42.10"> </span>
<a href="#l42.11"></a><span id="l42.11"> #include &quot;nsMsgWindow.h&quot;</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l42.13"></a><span id="l42.13"> #include &quot;nsIURILoader.h&quot;</span>
<a href="#l42.14"></a><span id="l42.14"> #include &quot;nsCURILoader.h&quot;</span>
<a href="#l42.15"></a><span id="l42.15"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l42.16"></a><span id="l42.16"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l42.17"></a><span id="l42.17"> #include &quot;nsIDocShellTreeNode.h&quot;</span>
<a href="#l42.18"></a><span id="l42.18"> #include &quot;nsIDOMElement.h&quot;</span>
<a href="#l42.19"></a><span id="l42.19"> #include &quot;nsIDOMWindowInternal.h&quot;</span>
<a href="#l42.20"></a><span id="l42.20"> #include &quot;nsTransactionManagerCID.h&quot;</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineat">@@ -59,16 +58,18 @@</span>
<a href="#l42.22"></a><span id="l42.22"> #include &quot;nsIRequestObserver.h&quot;</span>
<a href="#l42.23"></a><span id="l42.23"> #include &quot;netCore.h&quot;</span>
<a href="#l42.24"></a><span id="l42.24"> #include &quot;prmem.h&quot;</span>
<a href="#l42.25"></a><span id="l42.25"> #include &quot;plbase64.h&quot;</span>
<a href="#l42.26"></a><span id="l42.26"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l42.27"></a><span id="l42.27"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l42.28"></a><span id="l42.28"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l42.29"></a><span id="l42.29"> #include &quot;nsMsgContentPolicy.h&quot;</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l42.32"></a><span id="l42.32"> </span>
<a href="#l42.33"></a><span id="l42.33"> // used to dispatch urls to default protocol handlers</span>
<a href="#l42.34"></a><span id="l42.34"> #include &quot;nsCExternalHandlerService.h&quot;</span>
<a href="#l42.35"></a><span id="l42.35"> #include &quot;nsIExternalProtocolService.h&quot;</span>
<a href="#l42.36"></a><span id="l42.36"> </span>
<a href="#l42.37"></a><span id="l42.37"> static NS_DEFINE_CID(kTransactionManagerCID, NS_TRANSACTIONMANAGER_CID);</span>
<a href="#l42.38"></a><span id="l42.38"> </span>
<a href="#l42.39"></a><span id="l42.39"> NS_IMPL_THREADSAFE_ISUPPORTS3(nsMsgWindow,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -45,16 +45,17 @@</span>
<a href="#l43.4"></a><span id="l43.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l43.5"></a><span id="l43.5"> #include &quot;nsIMsgCopyService.h&quot;</span>
<a href="#l43.6"></a><span id="l43.6"> #include &quot;nsICopyMsgStreamListener.h&quot;</span>
<a href="#l43.7"></a><span id="l43.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l43.8"></a><span id="l43.8"> #include &quot;nsITreeColumns.h&quot;</span>
<a href="#l43.9"></a><span id="l43.9"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l43.10"></a><span id="l43.10"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l43.11"></a><span id="l43.11"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l43.13"></a><span id="l43.13"> </span>
<a href="#l43.14"></a><span id="l43.14"> nsMsgXFVirtualFolderDBView::nsMsgXFVirtualFolderDBView()</span>
<a href="#l43.15"></a><span id="l43.15"> {</span>
<a href="#l43.16"></a><span id="l43.16">   mSuppressMsgDisplay = PR_FALSE;</span>
<a href="#l43.17"></a><span id="l43.17">   m_doingSearch = PR_FALSE;</span>
<a href="#l43.18"></a><span id="l43.18">   m_doingQuickSearch = PR_FALSE;</span>
<a href="#l43.19"></a><span id="l43.19"> }</span>
<a href="#l43.20"></a><span id="l43.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -699,17 +699,19 @@ NS_IMETHODIMP nsSpamSettings::LogJunkHit</span>
<a href="#l44.4"></a><span id="l44.4">                                       dateValue);</span>
<a href="#l44.5"></a><span id="l44.5"> </span>
<a href="#l44.6"></a><span id="l44.6">   (void)aMsgHdr-&gt;GetMime2DecodedAuthor(authorValue);</span>
<a href="#l44.7"></a><span id="l44.7">   (void)aMsgHdr-&gt;GetMime2DecodedSubject(subjectValue);</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9">   nsCString buffer;</span>
<a href="#l44.10"></a><span id="l44.10">   // this is big enough to hold a log entry.</span>
<a href="#l44.11"></a><span id="l44.11">   // do this so we avoid growing and copying as we append to the log.</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l44.13"></a><span id="l44.13">   buffer.SetCapacity(512);</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+#endif</span>
<a href="#l44.15"></a><span id="l44.15"> </span>
<a href="#l44.16"></a><span id="l44.16">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l44.17"></a><span id="l44.17">     do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l44.18"></a><span id="l44.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l44.19"></a><span id="l44.19"> </span>
<a href="#l44.20"></a><span id="l44.20">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l44.21"></a><span id="l44.21">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l44.22"></a><span id="l44.22">     getter_AddRefs(bundle));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.h</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.h</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -38,17 +38,17 @@</span>
<a href="#l45.4"></a><span id="l45.4">  *</span>
<a href="#l45.5"></a><span id="l45.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l45.6"></a><span id="l45.6"> </span>
<a href="#l45.7"></a><span id="l45.7"> #ifndef nsSpamSettings_h__</span>
<a href="#l45.8"></a><span id="l45.8"> #define nsSpamSettings_h__</span>
<a href="#l45.9"></a><span id="l45.9"> </span>
<a href="#l45.10"></a><span id="l45.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l45.11"></a><span id="l45.11"> #include &quot;nsISpamSettings.h&quot;</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l45.14"></a><span id="l45.14"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l45.15"></a><span id="l45.15"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l45.16"></a><span id="l45.16"> #include &quot;nsIUrlListener.h&quot;</span>
<a href="#l45.17"></a><span id="l45.17"> #include &quot;nsIDateTimeFormat.h&quot;</span>
<a href="#l45.18"></a><span id="l45.18"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l45.19"></a><span id="l45.19"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l45.20"></a><span id="l45.20"> #include &quot;nsTArray.h&quot;</span>
<a href="#l45.21"></a><span id="l45.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -48,16 +48,17 @@</span>
<a href="#l46.4"></a><span id="l46.4"> #include &quot;nsIMsgFolder.h&quot; // TO include biffState enum. Change to bool later...</span>
<a href="#l46.5"></a><span id="l46.5"> #include &quot;nsIFileChannel.h&quot;</span>
<a href="#l46.6"></a><span id="l46.6"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l46.7"></a><span id="l46.7"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l46.8"></a><span id="l46.8"> #include &quot;nsIURL.h&quot;</span>
<a href="#l46.9"></a><span id="l46.9"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l46.10"></a><span id="l46.10"> #include &quot;nsIFileURL.h&quot;</span>
<a href="#l46.11"></a><span id="l46.11"> #include &quot;nsIFile.h&quot;</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l46.13"></a><span id="l46.13"> </span>
<a href="#l46.14"></a><span id="l46.14"> // QueryInterface, AddRef, and Release</span>
<a href="#l46.15"></a><span id="l46.15"> //</span>
<a href="#l46.16"></a><span id="l46.16"> NS_IMPL_ISUPPORTS2(nsStatusBarBiffManager, nsIStatusBarBiffManager, nsIFolderListener)</span>
<a href="#l46.17"></a><span id="l46.17"> </span>
<a href="#l46.18"></a><span id="l46.18"> nsIAtom * nsStatusBarBiffManager::kBiffStateAtom = nsnull;</span>
<a href="#l46.19"></a><span id="l46.19"> </span>
<a href="#l46.20"></a><span id="l46.20"> nsStatusBarBiffManager::nsStatusBarBiffManager()</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineat">@@ -79,17 +80,17 @@ nsStatusBarBiffManager::~nsStatusBarBiff</span>
<a href="#l46.22"></a><span id="l46.22"> </span>
<a href="#l46.23"></a><span id="l46.23"> nsresult nsStatusBarBiffManager::Init()</span>
<a href="#l46.24"></a><span id="l46.24"> {</span>
<a href="#l46.25"></a><span id="l46.25">   if (mInitialized)</span>
<a href="#l46.26"></a><span id="l46.26">     return NS_ERROR_ALREADY_INITIALIZED;</span>
<a href="#l46.27"></a><span id="l46.27"> </span>
<a href="#l46.28"></a><span id="l46.28">   nsresult rv;</span>
<a href="#l46.29"></a><span id="l46.29"> </span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-  kBiffStateAtom = NS_NewAtom(&quot;BiffState&quot;);</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineplus">+  kBiffStateAtom = MsgNewAtom(&quot;BiffState&quot;);</span>
<a href="#l46.32"></a><span id="l46.32"> </span>
<a href="#l46.33"></a><span id="l46.33">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = </span>
<a href="#l46.34"></a><span id="l46.34">     do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv); </span>
<a href="#l46.35"></a><span id="l46.35">   if(NS_SUCCEEDED(rv))</span>
<a href="#l46.36"></a><span id="l46.36">     mailSession-&gt;AddFolderListener(this, nsIFolderListener::intPropertyChanged);</span>
<a href="#l46.37"></a><span id="l46.37"> </span>
<a href="#l46.38"></a><span id="l46.38">   mInitialized = PR_TRUE;</span>
<a href="#l46.39"></a><span id="l46.39">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -40,16 +40,17 @@</span>
<a href="#l47.4"></a><span id="l47.4"> #include &quot;prmem.h&quot;</span>
<a href="#l47.5"></a><span id="l47.5"> #include &quot;rdf.h&quot;</span>
<a href="#l47.6"></a><span id="l47.6"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l47.7"></a><span id="l47.7"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l47.8"></a><span id="l47.8"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l47.9"></a><span id="l47.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l47.10"></a><span id="l47.10"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l47.11"></a><span id="l47.11"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l47.13"></a><span id="l47.13"> </span>
<a href="#l47.14"></a><span id="l47.14"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16"> nsSubscribableServer::nsSubscribableServer(void)</span>
<a href="#l47.17"></a><span id="l47.17"> {</span>
<a href="#l47.18"></a><span id="l47.18">     mDelimiter = '.';</span>
<a href="#l47.19"></a><span id="l47.19">     mShowFullName = PR_TRUE;</span>
<a href="#l47.20"></a><span id="l47.20">     mTreeRoot = nsnull;</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineat">@@ -171,17 +172,17 @@ nsSubscribableServer::AddTo(const nsACSt</span>
<a href="#l47.22"></a><span id="l47.22"> NS_IMETHODIMP</span>
<a href="#l47.23"></a><span id="l47.23"> nsSubscribableServer::SetState(const nsACString &amp;aPath, PRBool aState,</span>
<a href="#l47.24"></a><span id="l47.24">                                PRBool *aStateChanged)</span>
<a href="#l47.25"></a><span id="l47.25"> {</span>
<a href="#l47.26"></a><span id="l47.26">     nsresult rv = NS_OK;</span>
<a href="#l47.27"></a><span id="l47.27">     NS_ASSERTION(!aPath.IsEmpty() &amp;&amp; aStateChanged, &quot;no path or stateChanged&quot;);</span>
<a href="#l47.28"></a><span id="l47.28">     if (aPath.IsEmpty() || !aStateChanged) return NS_ERROR_NULL_POINTER;</span>
<a href="#l47.29"></a><span id="l47.29"> </span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">-    NS_ASSERTION(IsUTF8(aPath), &quot;aPath is not in UTF-8&quot;);</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineplus">+    NS_ASSERTION(MsgIsUTF8(aPath), &quot;aPath is not in UTF-8&quot;);</span>
<a href="#l47.32"></a><span id="l47.32"> </span>
<a href="#l47.33"></a><span id="l47.33">     *aStateChanged = PR_FALSE;</span>
<a href="#l47.34"></a><span id="l47.34"> </span>
<a href="#l47.35"></a><span id="l47.35">     SubscribeTreeNode *node = nsnull;</span>
<a href="#l47.36"></a><span id="l47.36">     rv = FindAndCreateNode(aPath, &amp;node);</span>
<a href="#l47.37"></a><span id="l47.37">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l47.38"></a><span id="l47.38"> </span>
<a href="#l47.39"></a><span id="l47.39">     NS_ASSERTION(node,&quot;didn't find the node&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribeDataSource.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribeDataSource.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -39,22 +39,25 @@</span>
<a href="#l48.4"></a><span id="l48.4"> #include &quot;nsSubscribeDataSource.h&quot;</span>
<a href="#l48.5"></a><span id="l48.5"> </span>
<a href="#l48.6"></a><span id="l48.6"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l48.7"></a><span id="l48.7"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l48.8"></a><span id="l48.8"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l48.9"></a><span id="l48.9"> #include &quot;rdf.h&quot;</span>
<a href="#l48.10"></a><span id="l48.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l48.11"></a><span id="l48.11"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l48.14"></a><span id="l48.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l48.15"></a><span id="l48.15"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l48.16"></a><span id="l48.16"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l48.17"></a><span id="l48.17"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l48.18"></a><span id="l48.18"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l48.19"></a><span id="l48.19" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l48.20"></a><span id="l48.20" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l48.21"></a><span id="l48.21" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l48.22"></a><span id="l48.22"> </span>
<a href="#l48.23"></a><span id="l48.23"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25"> // this is used for notification of observers using nsVoidArray</span>
<a href="#l48.26"></a><span id="l48.26"> typedef struct _nsSubscribeNotification {</span>
<a href="#l48.27"></a><span id="l48.27">   nsIRDFDataSource *datasource;</span>
<a href="#l48.28"></a><span id="l48.28">   nsIRDFResource *subject;</span>
<a href="#l48.29"></a><span id="l48.29">   nsIRDFResource *property;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

