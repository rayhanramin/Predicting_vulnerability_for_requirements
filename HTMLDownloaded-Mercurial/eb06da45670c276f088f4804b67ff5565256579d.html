<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20081:eb06da45670c276f088f4804b67ff5565256579d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ eb06da45670c276f088f4804b67ff5565256579d" />
<meta property="og:url" content="/comm-central/rev/eb06da45670c276f088f4804b67ff5565256579d" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable object-curly-newline rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / eb06da45670c276f088f4804b67ff5565256579d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/eb06da45670c276f088f4804b67ff5565256579d">shortlog</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/eb06da45670c276f088f4804b67ff5565256579d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d">files</a> |
changeset |
<a href="/comm-central/raw-rev/eb06da45670c276f088f4804b67ff5565256579d">raw</a>  | <a href="/comm-central/archive/eb06da45670c276f088f4804b67ff5565256579d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable object-curly-newline rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 14:09:23 +0200</td></tr>

<tr>
 <td>changeset 20081</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/eb06da45670c276f088f4804b67ff5565256579d">eb06da45670c276f088f4804b67ff5565256579d</a></td>
</tr>



<tr>
<td>parent 20080</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/289338a394d31814b30269ba6752035e303e04a3">289338a394d31814b30269ba6752035e303e04a3</a>
</td>
</tr>

<tr>
<td>child 20082</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a67fcf52bf1fc8cb96f811c1fc9e334d0bb7cfb0">a67fcf52bf1fc8cb96f811c1fc9e334d0bb7cfb0</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=eb06da45670c276f088f4804b67ff5565256579d">12310</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:32:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d0755bd52da8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d0755bd52da8189fbed8fa4b7496f29bc1854289">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d0755bd52da8189fbed8fa4b7496f29bc1854289&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d0755bd52da8189fbed8fa4b7496f29bc1854289&newProject=comm-central&newRevision=289338a394d31814b30269ba6752035e303e04a3&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d0755bd52da8189fbed8fa4b7496f29bc1854289&newProject=comm-central&newRevision=289338a394d31814b30269ba6752035e303e04a3&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d0755bd52da8189fbed8fa4b7496f29bc1854289&newProject=comm-central&newRevision=289338a394d31814b30269ba6752035e303e04a3&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable object-curly-newline rule. r=MakeMyDay

MozReview-Commit-ID: IN157uYMsZI</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/html-item-editing/react-code.js">calendar/lightning/content/html-item-editing/react-code.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/html-item-editing/react-code.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/html-item-editing/react-code.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/html-item-editing/react-code.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/html-item-editing/react-code.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/html-item-editing/react-code.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_alarm.js">calendar/test/unit/test_alarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_alarm.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_alarm.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_alarm.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_alarm.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_alarm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_freebusy_service.js">calendar/test/unit/test_freebusy_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_freebusy_service.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_freebusy_service.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_freebusy_service.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_freebusy_service.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_freebusy_service.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics.js">calendar/test/unit/test_ics.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ltninvitationutils.js">calendar/test/unit/test_ltninvitationutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ltninvitationutils.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ltninvitationutils.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ltninvitationutils.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ltninvitationutils.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_ltninvitationutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_search_service.js">calendar/test/unit/test_search_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_search_service.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_search_service.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_search_service.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_search_service.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_search_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_utils.js">calendar/test/unit/test_utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_utils.js">file</a> |
<a href="/comm-central/annotate/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_utils.js">annotate</a> |
<a href="/comm-central/diff/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_utils.js">diff</a> |
<a href="/comm-central/comparison/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_utils.js">comparison</a> |
<a href="/comm-central/log/eb06da45670c276f088f4804b67ff5565256579d/calendar/test/unit/test_utils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -389,13 +389,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &quot;dot-notation&quot;: 2,</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     // Disallow named function expressions</span>
<a href="#l1.7"></a><span id="l1.7">     &quot;func-names&quot;: [2, &quot;never&quot;],</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Enforce placing object properties on separate lines</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;object-property-newline&quot;: [2, { &quot;allowMultiplePropertiesPerLine&quot;: true }],</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Enforce consistent line breaks inside braces</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;object-curly-newline&quot;: [2, { &quot;multiline&quot;: true }],</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.16"></a><span id="l1.16">     // easier updates in the future.</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">   }</span>
<a href="#l1.19"></a><span id="l1.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -855,28 +855,24 @@ agendaListbox.getListItemByHashId = func</span>
<a href="#l2.4"></a><span id="l2.4">     } while (!leaveloop);</span>
<a href="#l2.5"></a><span id="l2.5">     return null;</span>
<a href="#l2.6"></a><span id="l2.6"> };</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> /**</span>
<a href="#l2.9"></a><span id="l2.9">  * The operation listener used for calendar queries.</span>
<a href="#l2.10"></a><span id="l2.10">  * Implements calIOperationListener.</span>
<a href="#l2.11"></a><span id="l2.11">  */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-agendaListbox.calendarOpListener = {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    agendaListbox: agendaListbox</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-};</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+agendaListbox.calendarOpListener = { agendaListbox: agendaListbox };</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17"> /**</span>
<a href="#l2.18"></a><span id="l2.18">  * Calendar and composite observer, used to keep agenda listbox up to date.</span>
<a href="#l2.19"></a><span id="l2.19">  * @see calIObserver</span>
<a href="#l2.20"></a><span id="l2.20">  * @see calICompositeObserver</span>
<a href="#l2.21"></a><span id="l2.21">  */</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-agendaListbox.calendarObserver = {</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-    agendaListbox: agendaListbox</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-};</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+agendaListbox.calendarObserver = { agendaListbox: agendaListbox };</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> agendaListbox.calendarObserver.QueryInterface = function(aIID) {</span>
<a href="#l2.28"></a><span id="l2.28">     if (!aIID.equals(Components.interfaces.calIObserver) &amp;&amp;</span>
<a href="#l2.29"></a><span id="l2.29">         !aIID.equals(Components.interfaces.calICompositeObserver) &amp;&amp;</span>
<a href="#l2.30"></a><span id="l2.30">         !aIID.equals(Components.interfaces.nsISupports)) {</span>
<a href="#l2.31"></a><span id="l2.31">         throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l2.32"></a><span id="l2.32">     }</span>
<a href="#l2.33"></a><span id="l2.33">     return this;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -38,24 +38,26 @@</span>
<a href="#l3.4"></a><span id="l3.4">       &lt;field name=&quot;mDropShadows&quot;&gt;null&lt;/field&gt;</span>
<a href="#l3.5"></a><span id="l3.5">       &lt;field name=&quot;mMagnifyAmount&quot;&gt;0&lt;/field&gt;</span>
<a href="#l3.6"></a><span id="l3.6">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l3.7"></a><span id="l3.7">       &lt;field name=&quot;mViewStart&quot;&gt;null&lt;/field&gt;</span>
<a href="#l3.8"></a><span id="l3.8">       &lt;field name=&quot;mViewEnd&quot;&gt;null&lt;/field&gt;</span>
<a href="#l3.9"></a><span id="l3.9">       &lt;field name=&quot;mToggleStatus&quot;&gt;0&lt;/field&gt;</span>
<a href="#l3.10"></a><span id="l3.10">       &lt;field name=&quot;mLog&quot;&gt;null&lt;/field&gt;</span>
<a href="#l3.11"></a><span id="l3.11">       &lt;field name=&quot;mToggleStatusFlag&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      ({ WorkdaysOnly:  1,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      ({</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+         WorkdaysOnly:  1,</span>
<a href="#l3.15"></a><span id="l3.15">          TasksInView:   2,</span>
<a href="#l3.16"></a><span id="l3.16">          ShowCompleted: 4,</span>
<a href="#l3.17"></a><span id="l3.17">       })</span>
<a href="#l3.18"></a><span id="l3.18">       ]]&gt;&lt;/field&gt;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">       &lt;field name=&quot;mPrefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-      ({ calView: this,</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+      ({</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+         calView: this,</span>
<a href="#l3.24"></a><span id="l3.24">          observe: function(subj, topic, pref) {</span>
<a href="#l3.25"></a><span id="l3.25">              this.calView.handlePreference(subj, topic, pref);</span>
<a href="#l3.26"></a><span id="l3.26">              return;</span>
<a href="#l3.27"></a><span id="l3.27">          }</span>
<a href="#l3.28"></a><span id="l3.28">       })</span>
<a href="#l3.29"></a><span id="l3.29">       ]]&gt;&lt;/field&gt;</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31">       &lt;field name=&quot;mObserver&quot;&gt;&lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -560,20 +560,22 @@</span>
<a href="#l4.4"></a><span id="l4.4">            let durend = enddate.subtractDate(this.mDate);</span>
<a href="#l4.5"></a><span id="l4.5">            let durstart = stdate.subtractDate(this.mDate);</span>
<a href="#l4.6"></a><span id="l4.6">            // 'durend' is always positive, instead 'durstart' might be negative</span>
<a href="#l4.7"></a><span id="l4.7">            // if the event starts one or more days before the date of this column</span>
<a href="#l4.8"></a><span id="l4.8">            let realStart_ = (durstart.days * 24 + durstart.hours) * 60 + durstart.minutes;</span>
<a href="#l4.9"></a><span id="l4.9">            realStart_ = durstart.isNegative ? -1 * realStart_ : realStart_;</span>
<a href="#l4.10"></a><span id="l4.10">            let realEnd_ = (durend.days * 24 + durend.hours) * 60 + durend.minutes;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-           return { start:        startHour * 60 + startMinute,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                    end:          endHour * 60 + endMinute,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                    realStart:    realStart_,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-                    realEnd:      realEnd_ };</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+           return {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+               start: startHour * 60 + startMinute,</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+               end: endHour * 60 + endMinute,</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+               realStart: realStart_,</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+               realEnd: realEnd_</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+           };</span>
<a href="#l4.22"></a><span id="l4.22">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.23"></a><span id="l4.23">       &lt;/method&gt;</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">       &lt;method name=&quot;createChunk&quot;&gt;</span>
<a href="#l4.26"></a><span id="l4.26">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l4.27"></a><span id="l4.27">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.28"></a><span id="l4.28">            let mins = this.getStartEndMinutesForOccurrence(aOccurrence);</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineat">@@ -919,19 +921,21 @@</span>
<a href="#l4.31"></a><span id="l4.31">            * Step 1: Look for an existing column with room for the item.</span>
<a href="#l4.32"></a><span id="l4.32">            * Step 2: Look for a previously placed item that can be shrunk in</span>
<a href="#l4.33"></a><span id="l4.33">            *         width to make room for the item.</span>
<a href="#l4.34"></a><span id="l4.34">            * Step 3: Give up and create a new column for the item.</span>
<a href="#l4.35"></a><span id="l4.35">            *</span>
<a href="#l4.36"></a><span id="l4.36">            * (The steps are explained in more detail as we come to them)</span>
<a href="#l4.37"></a><span id="l4.37">            */</span>
<a href="#l4.38"></a><span id="l4.38">           for (let i in this.mEventInfos) {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-              let curItemInfo = { event: this.mEventInfos[i].event,</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-                                  layoutStart: this.mEventInfos[i].layoutStart,</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-                                  layoutEnd: this.mEventInfos[i].layoutEnd };</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+              let curItemInfo = {</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+                  event: this.mEventInfos[i].event,</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+                  layoutStart: this.mEventInfos[i].layoutStart,</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+                  layoutEnd: this.mEventInfos[i].layoutEnd</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+              };</span>
<a href="#l4.47"></a><span id="l4.47">               if (!latestItemEnd) {</span>
<a href="#l4.48"></a><span id="l4.48">                  latestItemEnd = curItemInfo.layoutEnd;</span>
<a href="#l4.49"></a><span id="l4.49">               }</span>
<a href="#l4.50"></a><span id="l4.50">               if (currentBlob.length &amp;&amp; latestItemEnd &amp;&amp;</span>
<a href="#l4.51"></a><span id="l4.51">                   curItemInfo.layoutStart.compare(latestItemEnd) != -1) {</span>
<a href="#l4.52"></a><span id="l4.52">                   // We're done with this current blob because item starts</span>
<a href="#l4.53"></a><span id="l4.53">                   // after the last event in the current blob ended.</span>
<a href="#l4.54"></a><span id="l4.54">                   blobs.push({ blob: currentBlob, totalCols: colEndArray.length });</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineat">@@ -975,19 +979,21 @@</span>
<a href="#l4.56"></a><span id="l4.56">                           // can't expand any further</span>
<a href="#l4.57"></a><span id="l4.57">                           if (nextColEnd.compare(curItemInfo.layoutStart) == 1) {</span>
<a href="#l4.58"></a><span id="l4.58">                               break;</span>
<a href="#l4.59"></a><span id="l4.59">                           }</span>
<a href="#l4.60"></a><span id="l4.60">                           colEndArray[lastCol] = curItemInfo;</span>
<a href="#l4.61"></a><span id="l4.61">                           lastCol++;</span>
<a href="#l4.62"></a><span id="l4.62">                       }</span>
<a href="#l4.63"></a><span id="l4.63">                       // Now construct the info we need to push into the blob</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-                      currentBlob.push({ itemInfo: curItemInfo,</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-                                         startCol: ii,</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-                                         colSpan: lastCol - ii });</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+                      currentBlob.push({</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+                          itemInfo: curItemInfo,</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+                          startCol: ii,</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+                          colSpan: lastCol - ii</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+                      });</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73">                       // Update latestItemEnd</span>
<a href="#l4.74"></a><span id="l4.74">                       if (latestItemEnd &amp;&amp;</span>
<a href="#l4.75"></a><span id="l4.75">                           curItemInfo.layoutEnd.compare(latestItemEnd) == 1) {</span>
<a href="#l4.76"></a><span id="l4.76">                           latestItemEnd = curItemInfo.layoutEnd;</span>
<a href="#l4.77"></a><span id="l4.77">                       }</span>
<a href="#l4.78"></a><span id="l4.78">                       placedItem = true;</span>
<a href="#l4.79"></a><span id="l4.79">                       break; // Stop iterating through colEndArray</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineat">@@ -1018,29 +1024,33 @@</span>
<a href="#l4.81"></a><span id="l4.81">               for (let jj = 1; jj &lt; colEndArray.length; ++jj) {</span>
<a href="#l4.82"></a><span id="l4.82">                   if (colEndArray[jj].event.hashId == colEndArray[jj - 1].event.hashId) {</span>
<a href="#l4.83"></a><span id="l4.83">                       // Good we found a item that spanned multiple columns.</span>
<a href="#l4.84"></a><span id="l4.84">                       // Find it in the blob so we can modify its properties</span>
<a href="#l4.85"></a><span id="l4.85">                       for (let kk in currentBlob) {</span>
<a href="#l4.86"></a><span id="l4.86">                           if (currentBlob[kk].itemInfo.event.hashId == colEndArray[jj].event.hashId) {</span>
<a href="#l4.87"></a><span id="l4.87">                               // Take all but the first spot that the item spanned</span>
<a href="#l4.88"></a><span id="l4.88">                               let spanOfShrunkItem = currentBlob[kk].colSpan;</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-                              currentBlob.push({ itemInfo: curItemInfo,</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-                                                 startCol: Number(currentBlob[kk].startCol) + 1,</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-                                                 colSpan: spanOfShrunkItem - 1 });</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+                              currentBlob.push({</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+                                  itemInfo: curItemInfo,</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+                                  startCol: Number(currentBlob[kk].startCol) + 1,</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+                                  colSpan: spanOfShrunkItem - 1</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+                              });</span>
<a href="#l4.97"></a><span id="l4.97"> </span>
<a href="#l4.98"></a><span id="l4.98">                               // Update colEndArray</span>
<a href="#l4.99"></a><span id="l4.99">                               for (let ll = jj; ll &lt; jj + spanOfShrunkItem - 1; ll++) {</span>
<a href="#l4.100"></a><span id="l4.100">                                   colEndArray[ll] = curItemInfo;</span>
<a href="#l4.101"></a><span id="l4.101">                               }</span>
<a href="#l4.102"></a><span id="l4.102"> </span>
<a href="#l4.103"></a><span id="l4.103">                               // Modify the data on the old item</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-                              currentBlob[kk] = { itemInfo: currentBlob[kk].itemInfo,</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-                                                  startCol: currentBlob[kk].startCol,</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-                                                  colSpan: 1 };</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+                              currentBlob[kk] = {</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+                                  itemInfo: currentBlob[kk].itemInfo,</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+                                  startCol: currentBlob[kk].startCol,</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+                                  colSpan: 1</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+                              };</span>
<a href="#l4.112"></a><span id="l4.112">                               // Update latestItemEnd</span>
<a href="#l4.113"></a><span id="l4.113">                               if (latestItemEnd &amp;&amp;</span>
<a href="#l4.114"></a><span id="l4.114">                                   curItemInfo.layoutEnd.compare(latestItemEnd) == 1) {</span>
<a href="#l4.115"></a><span id="l4.115">                                   latestItemEnd = curItemInfo.layoutEnd;</span>
<a href="#l4.116"></a><span id="l4.116">                               }</span>
<a href="#l4.117"></a><span id="l4.117">                               break; // Stop iterating through currentBlob</span>
<a href="#l4.118"></a><span id="l4.118">                           }</span>
<a href="#l4.119"></a><span id="l4.119">                       }</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineat">@@ -1065,35 +1075,41 @@</span>
<a href="#l4.121"></a><span id="l4.121">               // * Note that there can only be one, because we sorted our</span>
<a href="#l4.122"></a><span id="l4.122">               //   events by start time, so this event must start later than</span>
<a href="#l4.123"></a><span id="l4.123">               //   the start of any possible conflicts.</span>
<a href="#l4.124"></a><span id="l4.124">               let lastColNum = colEndArray.length;</span>
<a href="#l4.125"></a><span id="l4.125">               for (let mm in currentBlob) {</span>
<a href="#l4.126"></a><span id="l4.126">                   let mmEnd = currentBlob[mm].itemInfo.layoutEnd;</span>
<a href="#l4.127"></a><span id="l4.127">                   if (currentBlob[mm].startCol + currentBlob[mm].colSpan == lastColNum &amp;&amp;</span>
<a href="#l4.128"></a><span id="l4.128">                       mmEnd.compare(curItemInfo.layoutStart) != 1) {</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-                      currentBlob[mm] = { itemInfo: currentBlob[mm].itemInfo,</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-                                          startCol: currentBlob[mm].startCol,</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-                                          colSpan: currentBlob[mm].colSpan + 1 };</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+                      currentBlob[mm] = {</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+                          itemInfo: currentBlob[mm].itemInfo,</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+                          startCol: currentBlob[mm].startCol,</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+                          colSpan: currentBlob[mm].colSpan + 1</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+                      };</span>
<a href="#l4.137"></a><span id="l4.137">                   }</span>
<a href="#l4.138"></a><span id="l4.138">               }</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-              currentBlob.push({ itemInfo: curItemInfo,</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-                                 startCol: colEndArray.length,</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-                                 colSpan: 1 });</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+              currentBlob.push({</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+                  itemInfo: curItemInfo,</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+                  startCol: colEndArray.length,</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+                  colSpan: 1</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+              });</span>
<a href="#l4.147"></a><span id="l4.147">               colEndArray.push(curItemInfo);</span>
<a href="#l4.148"></a><span id="l4.148"> </span>
<a href="#l4.149"></a><span id="l4.149">               // Update latestItemEnd</span>
<a href="#l4.150"></a><span id="l4.150">               if (latestItemEnd &amp;&amp; curItemInfo.layoutEnd.compare(latestItemEnd) == 1) {</span>
<a href="#l4.151"></a><span id="l4.151">                   latestItemEnd = curItemInfo.layoutEnd;</span>
<a href="#l4.152"></a><span id="l4.152">               }</span>
<a href="#l4.153"></a><span id="l4.153">               // Go get the next item</span>
<a href="#l4.154"></a><span id="l4.154">           }</span>
<a href="#l4.155"></a><span id="l4.155">           // Add the last blob</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-          blobs.push({ blob: currentBlob,</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-                       totalCols: colEndArray.length });</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+          blobs.push({</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+              blob: currentBlob,</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+              totalCols: colEndArray.length</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+          });</span>
<a href="#l4.162"></a><span id="l4.162">           return this.setupBoxStructure(blobs);</span>
<a href="#l4.163"></a><span id="l4.163">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.164"></a><span id="l4.164">       &lt;/method&gt;</span>
<a href="#l4.165"></a><span id="l4.165">       &lt;method name=&quot;setupBoxStructure&quot;&gt;</span>
<a href="#l4.166"></a><span id="l4.166">         &lt;parameter name=&quot;aBlobs&quot;/&gt;</span>
<a href="#l4.167"></a><span id="l4.167">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.168"></a><span id="l4.168">           // This is actually going to end up being a 3-d array</span>
<a href="#l4.169"></a><span id="l4.169">           // 1st dimension: &quot;layers&quot;, sets of columns of events that all</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineat">@@ -1210,20 +1226,22 @@</span>
<a href="#l4.171"></a><span id="l4.171">                   let floatstart = start.clone();</span>
<a href="#l4.172"></a><span id="l4.172">                   floatstart.timezone = floating();</span>
<a href="#l4.173"></a><span id="l4.173">                   let dur = floatstart.subtractDate(prevEnd);</span>
<a href="#l4.174"></a><span id="l4.174">                   if (dur.inSeconds) {</span>
<a href="#l4.175"></a><span id="l4.175">                       col.push({ duration: dur });</span>
<a href="#l4.176"></a><span id="l4.176">                   }</span>
<a href="#l4.177"></a><span id="l4.177">                   let floatend = end.clone();</span>
<a href="#l4.178"></a><span id="l4.178">                   floatend.timezone = floating();</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-                  col.push({ event: data.itemInfo.event,</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-                             endDate: end,</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-                             startDate: start,</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-                             duration: floatend.subtractDate(floatstart) });</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+                  col.push({</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+                      event: data.itemInfo.event,</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+                      endDate: end,</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+                      startDate: start,</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+                      duration: floatend.subtractDate(floatstart)</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+                  });</span>
<a href="#l4.189"></a><span id="l4.189">               }</span>
<a href="#l4.190"></a><span id="l4.190">               layerOffset = layers.length;</span>
<a href="#l4.191"></a><span id="l4.191">           }</span>
<a href="#l4.192"></a><span id="l4.192">           return layers;</span>
<a href="#l4.193"></a><span id="l4.193">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.194"></a><span id="l4.194">       &lt;/method&gt;</span>
<a href="#l4.195"></a><span id="l4.195"> </span>
<a href="#l4.196"></a><span id="l4.196">       &lt;method name=&quot;getShadowElements&quot;&gt;</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineat">@@ -1241,21 +1259,22 @@</span>
<a href="#l4.198"></a><span id="l4.198">                 let reminder = Math.abs(aStart) % this.mEndMin;</span>
<a href="#l4.199"></a><span id="l4.199">                 startMin = this.mEndMin - (reminder ? reminder : this.mEndMin);</span>
<a href="#l4.200"></a><span id="l4.200">             } else {</span>
<a href="#l4.201"></a><span id="l4.201">                 startMin = aStart;</span>
<a href="#l4.202"></a><span id="l4.202">             }</span>
<a href="#l4.203"></a><span id="l4.203">             shadows += Math.floor(aEnd / this.mEndMin);</span>
<a href="#l4.204"></a><span id="l4.204"> </span>
<a href="#l4.205"></a><span id="l4.205">             // return values needed to build the shadows while dragging</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-            return { shadows:  shadows,      // number of shadows</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-                     offset:   offset,       // Offset first&lt;-&gt;selected shadows</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-                     startMin: startMin,     // First shadow start minute</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-                     endMin:   aEnd % this.mEndMin   // Last shadow end minute</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-                   };</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineplus">+            return {</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+                shadows: shadows,             // number of shadows</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+                offset: offset,               // Offset first&lt;-&gt;selected shadows</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+                startMin: startMin,           // First shadow start minute</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+                endMin: aEnd % this.mEndMin   // Last shadow end minute</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+            };</span>
<a href="#l4.217"></a><span id="l4.217">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.218"></a><span id="l4.218">       &lt;/method&gt;</span>
<a href="#l4.219"></a><span id="l4.219"> </span>
<a href="#l4.220"></a><span id="l4.220">       &lt;method name=&quot;firstLastShadowColumns&quot;&gt;</span>
<a href="#l4.221"></a><span id="l4.221">         &lt;parameter name=&quot;aOffset&quot;/&gt;</span>
<a href="#l4.222"></a><span id="l4.222">         &lt;parameter name=&quot;aShadows&quot;/&gt;</span>
<a href="#l4.223"></a><span id="l4.223">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.224"></a><span id="l4.224">           let firstCol = this; // eslint-disable-line consistent-this</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineat">@@ -1270,20 +1289,22 @@</span>
<a href="#l4.226"></a><span id="l4.226">           while (lastCol.nextSibling &amp;&amp; lastIndex &lt; lastShadow - 1) {</span>
<a href="#l4.227"></a><span id="l4.227">               lastCol = lastCol.nextSibling;</span>
<a href="#l4.228"></a><span id="l4.228">               lastIndex++;</span>
<a href="#l4.229"></a><span id="l4.229">           }</span>
<a href="#l4.230"></a><span id="l4.230"> </span>
<a href="#l4.231"></a><span id="l4.231">           // returns first and last column with shadows that are visible in the</span>
<a href="#l4.232"></a><span id="l4.232">           // week and the positions of these (visible) columns in the set of</span>
<a href="#l4.233"></a><span id="l4.233">           // columns shadows of the occurrence</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-          return { firstCol:    firstCol,</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-                   firstIndex:  firstIndex,</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-                   lastCol:     lastCol,</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-                   lastIndex:   lastIndex };</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineplus">+          return {</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineplus">+              firstCol: firstCol,</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+              firstIndex: firstIndex,</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+              lastCol: lastCol,</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+              lastIndex: lastIndex</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+          };</span>
<a href="#l4.244"></a><span id="l4.244">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.245"></a><span id="l4.245">       &lt;/method&gt;</span>
<a href="#l4.246"></a><span id="l4.246"> </span>
<a href="#l4.247"></a><span id="l4.247">       &lt;method name=&quot;updateShadowsBoxes&quot;&gt;</span>
<a href="#l4.248"></a><span id="l4.248">         &lt;parameter name=&quot;aStart&quot;/&gt;</span>
<a href="#l4.249"></a><span id="l4.249">         &lt;parameter name=&quot;aEnd&quot;/&gt;</span>
<a href="#l4.250"></a><span id="l4.250">         &lt;parameter name=&quot;aCurrentOffset&quot;/&gt;</span>
<a href="#l4.251"></a><span id="l4.251">         &lt;parameter name=&quot;aCurrentShadows&quot;/&gt;</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineat">@@ -1539,26 +1560,30 @@</span>
<a href="#l4.253"></a><span id="l4.253">           let deltamin = curmin - dragState.origMin;</span>
<a href="#l4.254"></a><span id="l4.254"> </span>
<a href="#l4.255"></a><span id="l4.255">           let shadowElements;</span>
<a href="#l4.256"></a><span id="l4.256">           if (dragState.dragType == &quot;new&quot;) {</span>
<a href="#l4.257"></a><span id="l4.257">               // Extend deltamin in a linear way over the columns</span>
<a href="#l4.258"></a><span id="l4.258">               deltamin += minutesInDay * dragState.jumpedColumns;</span>
<a href="#l4.259"></a><span id="l4.259">               if (deltamin &lt; 0) {</span>
<a href="#l4.260"></a><span id="l4.260">                   // create a new event modifying the start. End time is fixed</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-                  shadowElements = { shadows: 1 - dragState.jumpedColumns,</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-                                     offset: 0,</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-                                     startMin: curmin,</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-                                     endMin: dragState.origMin };</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineplus">+                  shadowElements = {</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineplus">+                      shadows: 1 - dragState.jumpedColumns,</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+                      offset: 0,</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+                      startMin: curmin,</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+                      endMin: dragState.origMin</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+                  };</span>
<a href="#l4.271"></a><span id="l4.271">               } else {</span>
<a href="#l4.272"></a><span id="l4.272">                   // create a new event modifying the end. Start time is fixed</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-                  shadowElements = { shadows: dragState.jumpedColumns + 1,</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-                                     offset: dragState.jumpedColumns,</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-                                     startMin: dragState.origMin,</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-                                     endMin: curmin };</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineplus">+                  shadowElements = {</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineplus">+                      shadows: dragState.jumpedColumns + 1,</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+                      offset: dragState.jumpedColumns,</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineplus">+                      startMin: dragState.origMin,</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineplus">+                      endMin: curmin</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineplus">+                  };</span>
<a href="#l4.283"></a><span id="l4.283">               }</span>
<a href="#l4.284"></a><span id="l4.284">               dragState.startMin = shadowElements.startMin;</span>
<a href="#l4.285"></a><span id="l4.285">               dragState.endMin = shadowElements.endMin;</span>
<a href="#l4.286"></a><span id="l4.286">           } else if (dragState.dragType == &quot;move&quot;) {</span>
<a href="#l4.287"></a><span id="l4.287">               // if we're moving, we modify startMin and endMin of the shadow.</span>
<a href="#l4.288"></a><span id="l4.288">               shadowElements = col.getShadowElements(dragState.origMinStart + deltamin,</span>
<a href="#l4.289"></a><span id="l4.289">                                                      dragState.origMinEnd + deltamin);</span>
<a href="#l4.290"></a><span id="l4.290">               dragState.startMin = shadowElements.startMin;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -426,20 +426,22 @@ function updateListboxDeleteButton(listb</span>
<a href="#l5.4"></a><span id="l5.4">  *</span>
<a href="#l5.5"></a><span id="l5.5">  * @param aLength         The number to use to determine the plural form</span>
<a href="#l5.6"></a><span id="l5.6">  * @param aUnit           The unit to find the plural form of</span>
<a href="#l5.7"></a><span id="l5.7">  * @param aIncludeLength  (optional) If true, the length will be included in the</span>
<a href="#l5.8"></a><span id="l5.8">  *                          result. If false, only the pluralized unit is returned.</span>
<a href="#l5.9"></a><span id="l5.9">  * @return                A string containg the pluralized version of the unit</span>
<a href="#l5.10"></a><span id="l5.10">  */</span>
<a href="#l5.11"></a><span id="l5.11"> function unitPluralForm(aLength, aUnit, aIncludeLength=true) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    let unitProp = { &quot;minutes&quot;: &quot;unitMinutes&quot;,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                     &quot;hours&quot;: &quot;unitHours&quot;,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                     &quot;days&quot;: &quot;unitDays&quot;,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-                     &quot;weeks&quot;: &quot;unitWeeks&quot; }[aUnit] || &quot;unitMinutes&quot;;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+    let unitProp = {</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+        &quot;minutes&quot;: &quot;unitMinutes&quot;,</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+        &quot;hours&quot;: &quot;unitHours&quot;,</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+        &quot;days&quot;: &quot;unitDays&quot;,</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+        &quot;weeks&quot;: &quot;unitWeeks&quot;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+    }[aUnit] || &quot;unitMinutes&quot;;</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">     return PluralForm.get(aLength, cal.calGetString(&quot;calendar&quot;, unitProp))</span>
<a href="#l5.24"></a><span id="l5.24">                      .replace(&quot;#1&quot;, aIncludeLength ? aLength : &quot;&quot;).trim();</span>
<a href="#l5.25"></a><span id="l5.25"> }</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27"> /**</span>
<a href="#l5.28"></a><span id="l5.28">  * Update the given unit label to show the correct plural form.</span>
<a href="#l5.29"></a><span id="l5.29">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -422,19 +422,21 @@ cal.toRFC3339 = function(aDateTime) {</span>
<a href="#l6.4"></a><span id="l6.4">             str += &quot;Z&quot;;</span>
<a href="#l6.5"></a><span id="l6.5">         }</span>
<a href="#l6.6"></a><span id="l6.6">     }</span>
<a href="#l6.7"></a><span id="l6.7">     return str;</span>
<a href="#l6.8"></a><span id="l6.8"> };</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> cal.promptOverwrite = function(aMode, aItem) {</span>
<a href="#l6.11"></a><span id="l6.11">     let window = cal.getCalendarWindow();</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    let args = { item: aItem,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                 mode: aMode,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                 overwrite: false };</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    let args = {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+        item: aItem,</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+        mode: aMode,</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+        overwrite: false</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+    };</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">     window.openDialog(&quot;chrome://calendar/content/calendar-conflicts-dialog.xul&quot;,</span>
<a href="#l6.22"></a><span id="l6.22">                       &quot;calendarConflictsDialog&quot;,</span>
<a href="#l6.23"></a><span id="l6.23">                       &quot;chrome,titlebar,modal&quot;,</span>
<a href="#l6.24"></a><span id="l6.24">                       args);</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">     return args.overwrite;</span>
<a href="#l6.27"></a><span id="l6.27"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -77,19 +77,21 @@ var locales = [localeEn, localeNl];</span>
<a href="#l7.4"></a><span id="l7.4"> // Windows line endings, CSV files with LF only can't be read by Outlook.</span>
<a href="#l7.5"></a><span id="l7.5"> var exportLineEnding = &quot;\r\n&quot;;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> // Shared functions</span>
<a href="#l7.8"></a><span id="l7.8"> function getOutlookCsvFileTypes(aCount) {</span>
<a href="#l7.9"></a><span id="l7.9">     aCount.value = 1;</span>
<a href="#l7.10"></a><span id="l7.10">     let wildmat = &quot;*.csv&quot;;</span>
<a href="#l7.11"></a><span id="l7.11">     let label = cal.calGetString(&quot;calendar&quot;, &quot;filterOutlookCsv&quot;, [wildmat]);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    return [{ defaultExtension: &quot;csv&quot;,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-              extensionFilter: wildmat,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-              description: label }];</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    return [{</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+        defaultExtension: &quot;csv&quot;,</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+        extensionFilter: wildmat,</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+        description: label</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+    }];</span>
<a href="#l7.20"></a><span id="l7.20"> }</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22"> // Importer</span>
<a href="#l7.23"></a><span id="l7.23"> function calOutlookCSVImporter() {</span>
<a href="#l7.24"></a><span id="l7.24">     this.wrappedJSObject = this;</span>
<a href="#l7.25"></a><span id="l7.25"> }</span>
<a href="#l7.26"></a><span id="l7.26"> var calOutlookCSVImporterClassID = Components.ID(&quot;{64a5d17a-0497-48c5-b54f-72b15c9e9a14}&quot;);</span>
<a href="#l7.27"></a><span id="l7.27"> var calOutlookCSVImporterInterfaces = [Components.interfaces.calIImporter];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/lightning/content/html-item-editing/react-code.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/lightning/content/html-item-editing/react-code.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -114,19 +114,17 @@ var Link = React.createClass({</span>
<a href="#l8.4"></a><span id="l8.4">         },</span>
<a href="#l8.5"></a><span id="l8.5">         this.props.value</span>
<a href="#l8.6"></a><span id="l8.6">         );</span>
<a href="#l8.7"></a><span id="l8.7">     }</span>
<a href="#l8.8"></a><span id="l8.8"> });</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> var DatePicker = React.createClass({</span>
<a href="#l8.11"></a><span id="l8.11">     render: function() {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        return React.DOM.input({</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-            type: &quot;date&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-        });</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+        return React.DOM.input({ type: &quot;date&quot; });</span>
<a href="#l8.16"></a><span id="l8.16">     }</span>
<a href="#l8.17"></a><span id="l8.17"> });</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> var Capsule = React.createClass({</span>
<a href="#l8.20"></a><span id="l8.20">     handleDelete: function() {</span>
<a href="#l8.21"></a><span id="l8.21">         this.props.onDelete(this.props.keyprop, this.props.value);</span>
<a href="#l8.22"></a><span id="l8.22">     },</span>
<a href="#l8.23"></a><span id="l8.23">     render: function() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -351,20 +351,19 @@ var ltnImipBar = {</span>
<a href="#l9.4"></a><span id="l9.4">                     return false;</span>
<a href="#l9.5"></a><span id="l9.5">                 }</span>
<a href="#l9.6"></a><span id="l9.6">             }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">             if (partStat == &quot;X-SAVECOPY&quot;) {</span>
<a href="#l9.9"></a><span id="l9.9">                 // we create and adopt copies of the respective events</span>
<a href="#l9.10"></a><span id="l9.10">                 let saveitems = ltnImipBar.itipItem.getItemList({}).map(cal.getPublishLikeItemCopy.bind(cal));</span>
<a href="#l9.11"></a><span id="l9.11">                 if (saveitems.length &gt; 0) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+                    let methods = { receivedMethod: &quot;PUBLISH&quot;, responseMethod: &quot;PUBLISH&quot; };</span>
<a href="#l9.13"></a><span id="l9.13">                     let newItipItem = cal.itip.getModifiedItipItem(ltnImipBar.itipItem,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                                                                   saveitems,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-                                                                   { receivedMethod: &quot;PUBLISH&quot;,</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-                                                                     responseMethod: &quot;PUBLISH&quot; });</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+                                                                   saveitems, methods);</span>
<a href="#l9.18"></a><span id="l9.18">                     // control to avoid processing _execAction on later user changes on the item</span>
<a href="#l9.19"></a><span id="l9.19">                     let isFirstProcessing = true;</span>
<a href="#l9.20"></a><span id="l9.20">                     // setup callback and trigger re-processing</span>
<a href="#l9.21"></a><span id="l9.21">                     let storeCopy = function(aItipItem, aRc, aActionFunc, aFoundItems) {</span>
<a href="#l9.22"></a><span id="l9.22">                         if (isFirstProcessing &amp;&amp; aActionFunc &amp;&amp; Components.isSuccessCode(aRc)) {</span>
<a href="#l9.23"></a><span id="l9.23">                             _execAction(aActionFunc, aItipItem, window, partStat);</span>
<a href="#l9.24"></a><span id="l9.24">                         }</span>
<a href="#l9.25"></a><span id="l9.25">                     };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -153,22 +153,18 @@ var calendarTabType = {</span>
<a href="#l10.4"></a><span id="l10.4">  * comm-central/mail/base/content/mailTabs.js</span>
<a href="#l10.5"></a><span id="l10.5">  * comm-central/mail/base/content/tabmail.xml</span>
<a href="#l10.6"></a><span id="l10.6">  */</span>
<a href="#l10.7"></a><span id="l10.7"> var calendarItemTabType = {</span>
<a href="#l10.8"></a><span id="l10.8">     name: &quot;calendarItem&quot;,</span>
<a href="#l10.9"></a><span id="l10.9">     perTabPanel: &quot;vbox&quot;,</span>
<a href="#l10.10"></a><span id="l10.10">     idNumber: 0,</span>
<a href="#l10.11"></a><span id="l10.11">     modes: {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        calendarEvent: {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-            type: &quot;calendarEvent&quot;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-        },</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-        calendarTask: {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-            type: &quot;calendarTask&quot;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-        }</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+        calendarEvent: { type: &quot;calendarEvent&quot; },</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+        calendarTask: { type: &quot;calendarTask&quot; }</span>
<a href="#l10.20"></a><span id="l10.20">     },</span>
<a href="#l10.21"></a><span id="l10.21">     /**</span>
<a href="#l10.22"></a><span id="l10.22">      * Opens an event tab or a task tab.</span>
<a href="#l10.23"></a><span id="l10.23">      *</span>
<a href="#l10.24"></a><span id="l10.24">      * @param {Object} aTab   A tab info object</span>
<a href="#l10.25"></a><span id="l10.25">      * @param {Object} aArgs  Contains data about the event/task</span>
<a href="#l10.26"></a><span id="l10.26">      */</span>
<a href="#l10.27"></a><span id="l10.27">     openTab: function(aTab, aArgs) {</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineat">@@ -445,18 +441,20 @@ function ltnIntegrationNotification() {</span>
<a href="#l10.29"></a><span id="l10.29">         // display notification bar again</span>
<a href="#l10.30"></a><span id="l10.30">         ltnIntegrationNotification();</span>
<a href="#l10.31"></a><span id="l10.31">     };</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33">     // call backs for the opt-out bar</span>
<a href="#l10.34"></a><span id="l10.34">     let cbLearnMore = function(aNotificationBar, aButton) {</span>
<a href="#l10.35"></a><span id="l10.35">         // In SeaMonkey the second parameter should be either null or an</span>
<a href="#l10.36"></a><span id="l10.36">         // event object with a non null target.ownerDocument.</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-        openUILink(kSupportUri, { button: 0,</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-                                  target: { ownerDocument: document } });</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+        openUILink(kSupportUri, {</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+            button: 0,</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+            target: { ownerDocument: document }</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+        });</span>
<a href="#l10.43"></a><span id="l10.43">         return true;</span>
<a href="#l10.44"></a><span id="l10.44">     };</span>
<a href="#l10.45"></a><span id="l10.45">     let cbKeepIt = function(aNotificationBar, aButton) {</span>
<a href="#l10.46"></a><span id="l10.46">         Preferences.set(kNotify, false);</span>
<a href="#l10.47"></a><span id="l10.47">     };</span>
<a href="#l10.48"></a><span id="l10.48">     let cbOptOut = function(aNotificationBar, aButton) {</span>
<a href="#l10.49"></a><span id="l10.49">         Preferences.set(kNotify, false);</span>
<a href="#l10.50"></a><span id="l10.50">         Preferences.set(kOptOut, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -260,20 +260,22 @@ calDavCalendar.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">         let refreshNeeded = false;</span>
<a href="#l11.5"></a><span id="l11.5">         let getMetaListener = {</span>
<a href="#l11.6"></a><span id="l11.6">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l11.7"></a><span id="l11.7">             onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l11.8"></a><span id="l11.8">                 for (let item of aItems) {</span>
<a href="#l11.9"></a><span id="l11.9">                     if (!(item.id in self.mItemInfoCache)) {</span>
<a href="#l11.10"></a><span id="l11.10">                         let path = self.getItemLocationPath(item);</span>
<a href="#l11.11"></a><span id="l11.11">                         cal.LOG(&quot;Adding meta-data for cached item &quot; + item.id);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-                        self.mItemInfoCache[item.id] = { etag: null,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                                                         isNew: false,</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-                                                         locationPath: path,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-                                                         isInboxItem: false };</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+                        self.mItemInfoCache[item.id] = {</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+                            etag: null,</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+                            isNew: false,</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+                            locationPath: path,</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+                            isInboxItem: false</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+                        };</span>
<a href="#l11.22"></a><span id="l11.22">                         self.mHrefIndex[self.mLocationPath + path] = item.id;</span>
<a href="#l11.23"></a><span id="l11.23">                         refreshNeeded = true;</span>
<a href="#l11.24"></a><span id="l11.24">                     }</span>
<a href="#l11.25"></a><span id="l11.25">                 }</span>
<a href="#l11.26"></a><span id="l11.26">             },</span>
<a href="#l11.27"></a><span id="l11.27">             onOperationComplete: function(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l11.28"></a><span id="l11.28">                 if (refreshNeeded) {</span>
<a href="#l11.29"></a><span id="l11.29">                     // reseting the cached ctag forces an item refresh when</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineat">@@ -315,20 +317,22 @@ calDavCalendar.prototype = {</span>
<a href="#l11.31"></a><span id="l11.31">                 let itemDataArray = itemData.split(&quot;\u001A&quot;);</span>
<a href="#l11.32"></a><span id="l11.32">                 let etag = itemDataArray[0];</span>
<a href="#l11.33"></a><span id="l11.33">                 let resourcePath = itemDataArray[1];</span>
<a href="#l11.34"></a><span id="l11.34">                 let isInboxItem = itemDataArray[2];</span>
<a href="#l11.35"></a><span id="l11.35">                 if (itemDataArray.length == 3) {</span>
<a href="#l11.36"></a><span id="l11.36">                     this.mHrefIndex[resourcePath] = itemId;</span>
<a href="#l11.37"></a><span id="l11.37">                     let locationPath = resourcePath</span>
<a href="#l11.38"></a><span id="l11.38">                         .substr(this.mLocationPath.length);</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-                    let item = { etag: etag,</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-                                 isNew: false,</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-                                 locationPath: locationPath,</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-                                 isInboxItem: isInboxItem == &quot;true&quot; };</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+                    let item = {</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+                        etag: etag,</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+                        isNew: false,</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+                        locationPath: locationPath,</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+                        isInboxItem: isInboxItem == &quot;true&quot;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+                    };</span>
<a href="#l11.49"></a><span id="l11.49">                     this.mItemInfoCache[itemId] = item;</span>
<a href="#l11.50"></a><span id="l11.50">                 }</span>
<a href="#l11.51"></a><span id="l11.51">             }</span>
<a href="#l11.52"></a><span id="l11.52">         }</span>
<a href="#l11.53"></a><span id="l11.53"> </span>
<a href="#l11.54"></a><span id="l11.54">         this.ensureMetaData();</span>
<a href="#l11.55"></a><span id="l11.55">     },</span>
<a href="#l11.56"></a><span id="l11.56"> </span>
<a href="#l11.57"></a><span id="l11.57" class="difflineat">@@ -674,19 +678,17 @@ calDavCalendar.prototype = {</span>
<a href="#l11.58"></a><span id="l11.58">                     // 201 = HTTP &quot;Created&quot;</span>
<a href="#l11.59"></a><span id="l11.59">                     // 204 = HTTP &quot;No Content&quot;</span>
<a href="#l11.60"></a><span id="l11.60">                     cal.LOG(&quot;CalDAV: Item added to &quot; + self.name + &quot; successfully&quot;);</span>
<a href="#l11.61"></a><span id="l11.61"> </span>
<a href="#l11.62"></a><span id="l11.62">                     let uriComponentParts = self.makeUri().path.replace(/\/{2,}/g, &quot;/&quot;).split(&quot;/&quot;).length;</span>
<a href="#l11.63"></a><span id="l11.63">                     let targetParts = request.URI.path.split(&quot;/&quot;);</span>
<a href="#l11.64"></a><span id="l11.64">                     targetParts.splice(0, uriComponentParts - 1);</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-                    self.mItemInfoCache[parentItem.id] = {</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-                        locationPath: targetParts.join(&quot;/&quot;)</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-                    };</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+                    self.mItemInfoCache[parentItem.id] = { locationPath: targetParts.join(&quot;/&quot;) };</span>
<a href="#l11.70"></a><span id="l11.70">                     // TODO: onOpComplete adds the item to the cache, probably after getUpdatedItem!</span>
<a href="#l11.71"></a><span id="l11.71"> </span>
<a href="#l11.72"></a><span id="l11.72">                     // Some CalDAV servers will modify items on PUT (add X-props,</span>
<a href="#l11.73"></a><span id="l11.73">                     // for instance) so we'd best re-fetch in order to know</span>
<a href="#l11.74"></a><span id="l11.74">                     // the current state of the item</span>
<a href="#l11.75"></a><span id="l11.75">                     // Observers will be notified in getUpdatedItem()</span>
<a href="#l11.76"></a><span id="l11.76">                     self.getUpdatedItem(parentItem, aListener);</span>
<a href="#l11.77"></a><span id="l11.77">                     return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -19,20 +19,17 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l12.4"></a><span id="l12.4"> //</span>
<a href="#l12.5"></a><span id="l12.5"> // XXX Should do locks, so that external changes are not overwritten.</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> var CI = Components.interfaces;</span>
<a href="#l12.8"></a><span id="l12.8"> var calICalendar = Components.interfaces.calICalendar;</span>
<a href="#l12.9"></a><span id="l12.9"> var calIErrors = Components.interfaces.calIErrors;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> function icsNSResolver(prefix) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    const ns = {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-        D: &quot;DAV:&quot;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-    };</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+    const ns = { D: &quot;DAV:&quot; };</span>
<a href="#l12.17"></a><span id="l12.17">     return ns[prefix] || null;</span>
<a href="#l12.18"></a><span id="l12.18"> }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> function icsXPathFirst(aNode, aExpr, aType) {</span>
<a href="#l12.21"></a><span id="l12.21">     return cal.xml.evalXPathFirst(aNode, aExpr, icsNSResolver, aType);</span>
<a href="#l12.22"></a><span id="l12.22"> }</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24"> function calICSCalendar() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -639,19 +639,17 @@ var upgrade = {};</span>
<a href="#l13.4"></a><span id="l13.4">  *</span>
<a href="#l13.5"></a><span id="l13.5">  * No bug - new recurrence system. exceptions supported now, along with</span>
<a href="#l13.6"></a><span id="l13.6">  * everything else ical can throw at us. I hope.</span>
<a href="#l13.7"></a><span id="l13.7">  * p=vlad</span>
<a href="#l13.8"></a><span id="l13.8">  */</span>
<a href="#l13.9"></a><span id="l13.9"> upgrade.v2 = upgrade.v1 = function(db, version) {</span>
<a href="#l13.10"></a><span id="l13.10">     LOGdb(db, &quot;Storage: Upgrading to v1/v2&quot;);</span>
<a href="#l13.11"></a><span id="l13.11">     let tblData = {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      cal_calendar_schema_version: {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-        version: &quot;INTEGER&quot;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-      },</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+      cal_calendar_schema_version: { version: &quot;INTEGER&quot; },</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">     /* While this table is in v1, actually keeping it in the sql object will</span>
<a href="#l13.18"></a><span id="l13.18">      * cause problems when migrating from storage.sdb to local.sqlite. There,</span>
<a href="#l13.19"></a><span id="l13.19">      * all tables from storage.sdb will be moved to local.sqlite and so starting</span>
<a href="#l13.20"></a><span id="l13.20">      * sunbird again afterwards causes a borked upgrade since its missing tables</span>
<a href="#l13.21"></a><span id="l13.21">      * it expects.</span>
<a href="#l13.22"></a><span id="l13.22">      *</span>
<a href="#l13.23"></a><span id="l13.23">      *  cal_calendars: {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -207,28 +207,32 @@ function readJSONFile(aFile) {</span>
<a href="#l14.4"></a><span id="l14.4">   } finally {</span>
<a href="#l14.5"></a><span id="l14.5">       stream.close();</span>
<a href="#l14.6"></a><span id="l14.6">   }</span>
<a href="#l14.7"></a><span id="l14.7">   return false;</span>
<a href="#l14.8"></a><span id="l14.8"> }</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> function do_load_timezoneservice(callback) {</span>
<a href="#l14.11"></a><span id="l14.11">     do_test_pending();</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    cal.getTimezoneService().startup({ onResult: function() {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-        do_test_finished();</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-        callback();</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-    } });</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+    cal.getTimezoneService().startup({</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+        onResult: function() {</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+            do_test_finished();</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+            callback();</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+        }</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+    });</span>
<a href="#l14.22"></a><span id="l14.22"> }</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24"> function do_load_calmgr(callback) {</span>
<a href="#l14.25"></a><span id="l14.25">     do_test_pending();</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-    cal.getCalendarManager().startup({ onResult: function() {</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-        do_test_finished();</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-        callback();</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-    } });</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+    cal.getCalendarManager().startup({</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+        onResult: function() {</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+            do_test_finished();</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+            callback();</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+        }</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+    });</span>
<a href="#l14.36"></a><span id="l14.36"> }</span>
<a href="#l14.37"></a><span id="l14.37"> </span>
<a href="#l14.38"></a><span id="l14.38"> function do_calendar_startup(callback) {</span>
<a href="#l14.39"></a><span id="l14.39">     let obs = {</span>
<a href="#l14.40"></a><span id="l14.40">       observe: function() {</span>
<a href="#l14.41"></a><span id="l14.41">         Services.obs.removeObserver(this, &quot;calendar-startup-done&quot;);</span>
<a href="#l14.42"></a><span id="l14.42">         do_test_finished();</span>
<a href="#l14.43"></a><span id="l14.43">         do_execute_soon(callback);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/test/unit/test_alarm.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/test/unit/test_alarm.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -359,31 +359,33 @@ function test_dates() {</span>
<a href="#l15.4"></a><span id="l15.4">     }</span>
<a href="#l15.5"></a><span id="l15.5">     if (!passed) {</span>
<a href="#l15.6"></a><span id="l15.6">         do_throw(&quot;Setting offset when alarm is absolute should not succeed&quot;);</span>
<a href="#l15.7"></a><span id="l15.7">     }</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">     dump(&quot;Done\n&quot;);</span>
<a href="#l15.10"></a><span id="l15.10"> }</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-var propMap = { &quot;related&quot;: Ci.calIAlarm.ALARM_RELATED_START,</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                &quot;repeat&quot;: 1,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                &quot;action&quot;: &quot;X-TEST&quot;,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                &quot;description&quot;: &quot;description&quot;,</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-                &quot;summary&quot;: &quot;summary&quot;,</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-                &quot;offset&quot;: createDuration(&quot;PT4M&quot;),</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-                &quot;repeatOffset&quot;: createDuration(&quot;PT1M&quot;)</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+var propMap = {</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+    &quot;related&quot;: Ci.calIAlarm.ALARM_RELATED_START,</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+    &quot;repeat&quot;: 1,</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+    &quot;action&quot;: &quot;X-TEST&quot;,</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+    &quot;description&quot;: &quot;description&quot;,</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+    &quot;summary&quot;: &quot;summary&quot;,</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+    &quot;offset&quot;: createDuration(&quot;PT4M&quot;),</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+    &quot;repeatOffset&quot;: createDuration(&quot;PT1M&quot;)</span>
<a href="#l15.27"></a><span id="l15.27"> };</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-var clonePropMap = { &quot;related&quot;: Ci.calIAlarm.ALARM_RELATED_END,</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-                     &quot;repeat&quot;: 2,</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-                     &quot;action&quot;: &quot;X-CHANGED&quot;,</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-                     &quot;description&quot;: &quot;description-changed&quot;,</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-                     &quot;summary&quot;: &quot;summary-changed&quot;,</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-                     &quot;offset&quot;: createDuration(&quot;PT5M&quot;),</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-                     &quot;repeatOffset&quot;: createDuration(&quot;PT2M&quot;)</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+var clonePropMap = {</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+    &quot;related&quot;: Ci.calIAlarm.ALARM_RELATED_END,</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+    &quot;repeat&quot;: 2,</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+    &quot;action&quot;: &quot;X-CHANGED&quot;,</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+    &quot;description&quot;: &quot;description-changed&quot;,</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+    &quot;summary&quot;: &quot;summary-changed&quot;,</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+    &quot;offset&quot;: createDuration(&quot;PT5M&quot;),</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+    &quot;repeatOffset&quot;: createDuration(&quot;PT2M&quot;)</span>
<a href="#l15.43"></a><span id="l15.43"> };</span>
<a href="#l15.44"></a><span id="l15.44"> </span>
<a href="#l15.45"></a><span id="l15.45"> function test_immutable() {</span>
<a href="#l15.46"></a><span id="l15.46">     dump(&quot;Testing immutable alarms...&quot;);</span>
<a href="#l15.47"></a><span id="l15.47">     let alarm = cal.createAlarm();</span>
<a href="#l15.48"></a><span id="l15.48">     // Set up each attribute</span>
<a href="#l15.49"></a><span id="l15.49">     for (let prop in propMap) {</span>
<a href="#l15.50"></a><span id="l15.50">         alarm[prop] = propMap[prop];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy_service.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy_service.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -106,20 +106,22 @@ function test_failure() {</span>
<a href="#l16.4"></a><span id="l16.4"> }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> function test_cancel() {</span>
<a href="#l16.7"></a><span id="l16.7">     _clearProviders();</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">     let provider = {</span>
<a href="#l16.10"></a><span id="l16.10">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIFreeBusyProvider, Components.interfaces.calIOperation]),</span>
<a href="#l16.11"></a><span id="l16.11">         getFreeBusyIntervals: function(aCalId, aStart, aEnd, aTypes, aListener) {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-            Services.tm.currentThread.dispatch({ run: function() {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                dump(&quot;Cancelling freebusy query...&quot;);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-                op.cancel();</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-            } }, Components.interfaces.nsIEventTarget.DISPATCH_NORMAL);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+            Services.tm.currentThread.dispatch({</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+                run: function() {</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+                    dump(&quot;Cancelling freebusy query...&quot;);</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+                    op.cancel();</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+                }</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+            }, Components.interfaces.nsIEventTarget.DISPATCH_NORMAL);</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23">             // No listener call, we emulate a long running search</span>
<a href="#l16.24"></a><span id="l16.24">             // Do return the operation though</span>
<a href="#l16.25"></a><span id="l16.25">             return this;</span>
<a href="#l16.26"></a><span id="l16.26">         },</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28">         isPending: true,</span>
<a href="#l16.29"></a><span id="l16.29">         cancelCalled: false,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -491,24 +491,28 @@ function getAllMeta(calendar) {</span>
<a href="#l17.4"></a><span id="l17.4"> }</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> function run_test() {</span>
<a href="#l17.7"></a><span id="l17.7">     replaceAlertsService();</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">     // TODO: make do_calendar_startup to work with this test and replace the startup code here</span>
<a href="#l17.10"></a><span id="l17.10">     do_get_profile();</span>
<a href="#l17.11"></a><span id="l17.11">     do_test_pending();</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    cal.getCalendarManager().startup({ onResult: function() {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-        gServer = new GDataServer(&quot;xpcshell@example.com&quot;, &quot;tasksId&quot;);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-        gServer.start();</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-        cal.getTimezoneService().startup({ onResult: function() {</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-            run_next_test();</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-            do_test_finished();</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-        } });</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-    } });</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+    cal.getCalendarManager().startup({</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+        onResult: function() {</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+            gServer = new GDataServer(&quot;xpcshell@example.com&quot;, &quot;tasksId&quot;);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+            gServer.start();</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+            cal.getTimezoneService().startup({</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+                onResult: function() {</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+                    run_next_test();</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+                    do_test_finished();</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+                }</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+            });</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+        }</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+    });</span>
<a href="#l17.32"></a><span id="l17.32"> }</span>
<a href="#l17.33"></a><span id="l17.33"> </span>
<a href="#l17.34"></a><span id="l17.34"> add_task(function* test_migrate_cache() {</span>
<a href="#l17.35"></a><span id="l17.35">     let uriString = &quot;googleapi://xpcshell/?calendar=xpcshell%40example.com&quot;;</span>
<a href="#l17.36"></a><span id="l17.36">     let uri = Services.io.newURI(uriString, null, null);</span>
<a href="#l17.37"></a><span id="l17.37">     let client = cal.getCalendarManager().createCalendar(&quot;gdata&quot;, uri);</span>
<a href="#l17.38"></a><span id="l17.38">     let unwrapped = client.wrappedJSObject;</span>
<a href="#l17.39"></a><span id="l17.39">     let migrateStorageCache = unwrapped.migrateStorageCache.bind(unwrapped);</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineat">@@ -871,19 +875,17 @@ add_task(function* test_basicItems() {</span>
<a href="#l17.41"></a><span id="l17.41">          &quot;attendees&quot;: [{</span>
<a href="#l17.42"></a><span id="l17.42">             &quot;displayName&quot;: &quot;attendee name&quot;,</span>
<a href="#l17.43"></a><span id="l17.43">             &quot;email&quot;: &quot;attendee@example.com&quot;,</span>
<a href="#l17.44"></a><span id="l17.44">             &quot;optional&quot;: true,</span>
<a href="#l17.45"></a><span id="l17.45">             &quot;responseStatus&quot;: &quot;tentative&quot;</span>
<a href="#l17.46"></a><span id="l17.46">         }],</span>
<a href="#l17.47"></a><span id="l17.47"> </span>
<a href="#l17.48"></a><span id="l17.48">         &quot;extendedProperties&quot;: {</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-          &quot;shared&quot;: {</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-            &quot;X-MOZ-CATEGORIES&quot;: &quot;foo,bar&quot;</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-          },</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+          &quot;shared&quot;: { &quot;X-MOZ-CATEGORIES&quot;: &quot;foo,bar&quot; },</span>
<a href="#l17.53"></a><span id="l17.53">           &quot;private&quot;: {</span>
<a href="#l17.54"></a><span id="l17.54">             &quot;X-MOZ-LASTACK&quot;: &quot;2014-01-01T01:01:01Z&quot;,</span>
<a href="#l17.55"></a><span id="l17.55">             &quot;X-MOZ-SNOOZE-TIME&quot;: &quot;2014-01-01T02:02:02Z&quot;</span>
<a href="#l17.56"></a><span id="l17.56">           }</span>
<a href="#l17.57"></a><span id="l17.57">         }</span>
<a href="#l17.58"></a><span id="l17.58">       }</span>
<a href="#l17.59"></a><span id="l17.59">     ];</span>
<a href="#l17.60"></a><span id="l17.60"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/unit/test_ics.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/unit/test_ics.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -87,19 +87,17 @@ var test_data = [</span>
<a href="#l18.4"></a><span id="l18.4">         &quot; cle.com\n&quot; +</span>
<a href="#l18.5"></a><span id="l18.5">         &quot;ATTENDEE;X-ORACLE-GUID=E93594067929763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l18.6"></a><span id="l18.6">         &quot; ;RSVP=TRUE;CN=Stuart Parmenter;PARTSTAT=NEEDS-ACTION:mailto:stuart.parme\n&quot; +</span>
<a href="#l18.7"></a><span id="l18.7">         &quot; nter@oracle.com\n&quot; +</span>
<a href="#l18.8"></a><span id="l18.8">         &quot;END:VEVENT\n&quot; +</span>
<a href="#l18.9"></a><span id="l18.9">         &quot;END:VCALENDAR\n&quot;</span>
<a href="#l18.10"></a><span id="l18.10">     },</span>
<a href="#l18.11"></a><span id="l18.11">     {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-        expectedProps: {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-            &quot;x-magic&quot;: &quot;mymagicstring&quot;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-        },</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+        expectedProps: { &quot;x-magic&quot;: &quot;mymagicstring&quot; },</span>
<a href="#l18.16"></a><span id="l18.16">         ics: &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l18.17"></a><span id="l18.17">              &quot;UID:1\n&quot; +</span>
<a href="#l18.18"></a><span id="l18.18">              &quot;DTSTART:20070521T100000Z\n&quot; +</span>
<a href="#l18.19"></a><span id="l18.19">              &quot;X-MAGIC:mymagicstring\n&quot; +</span>
<a href="#l18.20"></a><span id="l18.20">              &quot;END:VEVENT&quot;</span>
<a href="#l18.21"></a><span id="l18.21">     }</span>
<a href="#l18.22"></a><span id="l18.22"> ];</span>
<a href="#l18.23"></a><span id="l18.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -115,18 +115,20 @@ function test_icsservice() {</span>
<a href="#l19.4"></a><span id="l19.4">     // Test ::createIcalPropertyFromString</span>
<a href="#l19.5"></a><span id="l19.5">     checkProp(svc.createIcalPropertyFromString.bind(svc),</span>
<a href="#l19.6"></a><span id="l19.6">               &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l19.7"></a><span id="l19.7">               { value: &quot;http://example.com/test.ics&quot;, propertyName: &quot;ATTACH&quot; },</span>
<a href="#l19.8"></a><span id="l19.8">               { ENCODING: &quot;BASE64&quot;, FMTTYPE: &quot;text/calendar&quot;, FILENAME: &quot;test.ics&quot; });</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">     checkProp(svc.createIcalPropertyFromString.bind(svc),</span>
<a href="#l19.11"></a><span id="l19.11">               &quot;DESCRIPTION:new\\nlines\\nare\\ngreat\\,eh?&quot;,</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-              { value: &quot;new\nlines\nare\ngreat,eh?&quot;,</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                valueAsIcalString: &quot;new\\nlines\\nare\\ngreat\\,eh?&quot; }, {});</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+              {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+                  value: &quot;new\nlines\nare\ngreat,eh?&quot;,</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+                  valueAsIcalString: &quot;new\\nlines\\nare\\ngreat\\,eh?&quot;</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+              }, {});</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19">     // Test ::createIcalProperty</span>
<a href="#l19.20"></a><span id="l19.20">     let attach2 = svc.createIcalProperty(&quot;ATTACH&quot;);</span>
<a href="#l19.21"></a><span id="l19.21">     equal(attach2.propertyName, &quot;ATTACH&quot;);</span>
<a href="#l19.22"></a><span id="l19.22">     attach2.value = &quot;http://example.com/&quot;;</span>
<a href="#l19.23"></a><span id="l19.23">     equal(attach2.icalString, &quot;ATTACH:http://example.com/\r\n&quot;);</span>
<a href="#l19.24"></a><span id="l19.24"> }</span>
<a href="#l19.25"></a><span id="l19.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -128,73 +128,59 @@ add_task(function* getItipHeader_test() </span>
<a href="#l20.4"></a><span id="l20.4">         itipItem.init(item);</span>
<a href="#l20.5"></a><span id="l20.5">         equal(ltn.invitation.getItipHeader(itipItem), test.expected,</span>
<a href="#l20.6"></a><span id="l20.6">               &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l20.7"></a><span id="l20.7">     }</span>
<a href="#l20.8"></a><span id="l20.8"> });</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10"> add_task(function* createInvitationOverlay_test() {</span>
<a href="#l20.11"></a><span id="l20.11">     let data = [{</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        input: {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-            description: &quot;DESCRIPTION:Go to https://www.example.net if you can.\r\n&quot;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-        },</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+        input: { description: &quot;DESCRIPTION:Go to https://www.example.net if you can.\r\n&quot; },</span>
<a href="#l20.16"></a><span id="l20.16">         expected: {</span>
<a href="#l20.17"></a><span id="l20.17">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l20.18"></a><span id="l20.18">             value: &quot;Go to &lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-freetext&quot; +</span>
<a href="#l20.19"></a><span id="l20.19">                    &quot;\&quot; href=\&quot;https://www.example.net\&quot;&gt;https://www.example.net&lt;/a&gt; if you can.&quot;</span>
<a href="#l20.20"></a><span id="l20.20">         }</span>
<a href="#l20.21"></a><span id="l20.21">     }, {</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-        input: {</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-            description: &quot;DESCRIPTION:Go to www.example.net if you can.\r\n&quot;</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-        },</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+        input: { description: &quot;DESCRIPTION:Go to www.example.net if you can.\r\n&quot; },</span>
<a href="#l20.26"></a><span id="l20.26">         expected: {</span>
<a href="#l20.27"></a><span id="l20.27">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l20.28"></a><span id="l20.28">             value: &quot;Go to &lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-abbrevia&quot; +</span>
<a href="#l20.29"></a><span id="l20.29">                    &quot;ted\&quot; href=\&quot;http://www.example.net\&quot;&gt;www.example.net&lt;/a&gt; if you can.&quot;</span>
<a href="#l20.30"></a><span id="l20.30">         }</span>
<a href="#l20.31"></a><span id="l20.31">     }, {</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-        input: {</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-            description: &quot;DESCRIPTION:Or write to mailto:faq@example.net instead.\r\n&quot;</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-        },</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+        input: { description: &quot;DESCRIPTION:Or write to mailto:faq@example.net instead.\r\n&quot; },</span>
<a href="#l20.36"></a><span id="l20.36">         expected: {</span>
<a href="#l20.37"></a><span id="l20.37">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l20.38"></a><span id="l20.38">             value: &quot;Or write to &lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-fr&quot; +</span>
<a href="#l20.39"></a><span id="l20.39">                    &quot;eetext\&quot; href=\&quot;mailto:faq@example.net\&quot;&gt;mailto:faq@example.net&lt;/a&gt; instead.&quot;</span>
<a href="#l20.40"></a><span id="l20.40">         }</span>
<a href="#l20.41"></a><span id="l20.41">     }, {</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-        input: {</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-            description: &quot;DESCRIPTION:Or write to faq@example.net instead.\r\n&quot;</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-        },</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+        input: { description: &quot;DESCRIPTION:Or write to faq@example.net instead.\r\n&quot; },</span>
<a href="#l20.46"></a><span id="l20.46">         expected: {</span>
<a href="#l20.47"></a><span id="l20.47">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l20.48"></a><span id="l20.48">             value: &quot;Or write to &lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-ab&quot; +</span>
<a href="#l20.49"></a><span id="l20.49">                    &quot;breviated\&quot; href=\&quot;mailto:faq@example.net\&quot;&gt;faq@example.net&lt;/a&gt; instead.&quot;</span>
<a href="#l20.50"></a><span id="l20.50">         }</span>
<a href="#l20.51"></a><span id="l20.51">     }, {</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-        input: {</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-            description: &quot;DESCRIPTION:It's up to you ;-)\r\n&quot;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-        },</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+        input: { description: &quot;DESCRIPTION:It's up to you ;-)\r\n&quot; },</span>
<a href="#l20.56"></a><span id="l20.56">         expected: {</span>
<a href="#l20.57"></a><span id="l20.57">             node: &quot;imipHtml-description-content&quot;,</span>
<a href="#l20.58"></a><span id="l20.58">             value: &quot;It's up to you &lt;span xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-smile&quot; +</span>
<a href="#l20.59"></a><span id="l20.59">                    &quot;y-s3\&quot; title=\&quot;;-)\&quot;&gt;&lt;span&gt;;-)&lt;/span&gt;&lt;/span&gt;&quot;</span>
<a href="#l20.60"></a><span id="l20.60">         }</span>
<a href="#l20.61"></a><span id="l20.61">     }, {</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-        input: {</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-            url: &quot;URL:http://www.example.org/event.ics\r\n&quot;</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-        },</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+        input: { url: &quot;URL:http://www.example.org/event.ics\r\n&quot; },</span>
<a href="#l20.66"></a><span id="l20.66">         expected: {</span>
<a href="#l20.67"></a><span id="l20.67">             node: &quot;imipHtml-url-content&quot;,</span>
<a href="#l20.68"></a><span id="l20.68">             value: &quot;&lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-freetext\&quot; hre&quot; +</span>
<a href="#l20.69"></a><span id="l20.69">                    &quot;f=\&quot;http://www.example.org/event.ics\&quot;&gt;http://www.example.org/event.ics&lt;/a&gt;&quot;</span>
<a href="#l20.70"></a><span id="l20.70">         }</span>
<a href="#l20.71"></a><span id="l20.71">     }, {</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-        input: {</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-            attach: &quot;ATTACH:http://www.example.org\r\n&quot;</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-        },</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineplus">+        input: { attach: &quot;ATTACH:http://www.example.org\r\n&quot; },</span>
<a href="#l20.76"></a><span id="l20.76">         expected: {</span>
<a href="#l20.77"></a><span id="l20.77">             node: &quot;imipHtml-attachments-content&quot;,</span>
<a href="#l20.78"></a><span id="l20.78">             value: &quot;&lt;a xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; class=\&quot;moz-txt-link-freetext\&quot; hre&quot; +</span>
<a href="#l20.79"></a><span id="l20.79">                    &quot;f=\&quot;http://www.example.org/\&quot;&gt;http://www.example.org/&lt;/a&gt;&quot;</span>
<a href="#l20.80"></a><span id="l20.80">         }</span>
<a href="#l20.81"></a><span id="l20.81">     }, {</span>
<a href="#l20.82"></a><span id="l20.82">         input: {</span>
<a href="#l20.83"></a><span id="l20.83">             attach: &quot;ATTACH;FMTTYPE=text/plain;ENCODING=BASE64;VALUE=BINARY:VGhlIHF1aWNrIGJyb3duI&quot; +</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineat">@@ -364,37 +350,29 @@ add_task(function* compareInvitationOver</span>
<a href="#l20.85"></a><span id="l20.85">         let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l20.86"></a><span id="l20.86">                                .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l20.87"></a><span id="l20.87">         parser.parseString(item);</span>
<a href="#l20.88"></a><span id="l20.88">         let dom = ltn.invitation.createInvitationOverlay(parser.getItems({})[0], itipItem);</span>
<a href="#l20.89"></a><span id="l20.89">         return cal.xml.serializeDOM(dom);</span>
<a href="#l20.90"></a><span id="l20.90">     }</span>
<a href="#l20.91"></a><span id="l20.91">     let data = [{</span>
<a href="#l20.92"></a><span id="l20.92">         input: {</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineminus">-            previous: {</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-                location: &quot;LOCATION:This place\r\n&quot;</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-            },</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineminus">-            current: {</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineminus">-                location: &quot;LOCATION:Another location\r\n&quot;</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-            },</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineplus">+            previous: { location: &quot;LOCATION:This place\r\n&quot; },</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineplus">+            current: { location: &quot;LOCATION:Another location\r\n&quot; },</span>
<a href="#l20.101"></a><span id="l20.101">             ignore: &quot;&quot;</span>
<a href="#l20.102"></a><span id="l20.102">         },</span>
<a href="#l20.103"></a><span id="l20.103">         expected: {</span>
<a href="#l20.104"></a><span id="l20.104">             node: &quot;imipHtml-location-content&quot;,</span>
<a href="#l20.105"></a><span id="l20.105">             value: &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Another location&lt;/span&gt;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l20.106"></a><span id="l20.106">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;This place&lt;/span&gt;&quot;</span>
<a href="#l20.107"></a><span id="l20.107">         }</span>
<a href="#l20.108"></a><span id="l20.108">     }, {</span>
<a href="#l20.109"></a><span id="l20.109">         input: {</span>
<a href="#l20.110"></a><span id="l20.110" class="difflineminus">-            previous: {</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineminus">-                summary: &quot;SUMMARY:My invitation\r\n&quot;</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineminus">-            },</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineminus">-            current: {</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineminus">-                summary: &quot;SUMMARY:My new invitation\r\n&quot;</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineminus">-            },</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineplus">+            previous: { summary: &quot;SUMMARY:My invitation\r\n&quot; },</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineplus">+            current: { summary: &quot;SUMMARY:My new invitation\r\n&quot; },</span>
<a href="#l20.118"></a><span id="l20.118">             ignore: &quot;&quot;</span>
<a href="#l20.119"></a><span id="l20.119">         },</span>
<a href="#l20.120"></a><span id="l20.120">         expected: {</span>
<a href="#l20.121"></a><span id="l20.121">             node: &quot;imipHtml-summary-content&quot;,</span>
<a href="#l20.122"></a><span id="l20.122">             value: &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;My new invitation&lt;/span&gt;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l20.123"></a><span id="l20.123">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;My invitation&lt;/span&gt;&quot;</span>
<a href="#l20.124"></a><span id="l20.124">         }</span>
<a href="#l20.125"></a><span id="l20.125">     }, {</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineat">@@ -442,22 +420,18 @@ add_task(function* compareInvitationOver</span>
<a href="#l20.127"></a><span id="l20.127">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 9 Sep 2015 13:00  14:00&lt;/span&gt;&quot;,</span>
<a href="#l20.128"></a><span id="l20.128"> </span>
<a href="#l20.129"></a><span id="l20.129">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wed 09 Sep 2015 14:00  15:00&lt;/span&gt;&quot; +</span>
<a href="#l20.130"></a><span id="l20.130">                    &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l20.131"></a><span id="l20.131">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 09 Sep 2015 13:00  14:00&lt;/span&gt;&quot;]</span>
<a href="#l20.132"></a><span id="l20.132">         }</span>
<a href="#l20.133"></a><span id="l20.133">     }, {</span>
<a href="#l20.134"></a><span id="l20.134">         input: {</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineminus">-            previous: {</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineminus">-                organizer: &quot;ORGANIZER:mailto:organizer1@example.net\r\n&quot;</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineminus">-            },</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineminus">-            current: {</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineminus">-                organizer: &quot;ORGANIZER:mailto:organizer2@example.net\r\n&quot;</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineminus">-            },</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineplus">+            previous: { organizer: &quot;ORGANIZER:mailto:organizer1@example.net\r\n&quot; },</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineplus">+            current: { organizer: &quot;ORGANIZER:mailto:organizer2@example.net\r\n&quot; },</span>
<a href="#l20.143"></a><span id="l20.143">             ignore: &quot;&quot;</span>
<a href="#l20.144"></a><span id="l20.144">         },</span>
<a href="#l20.145"></a><span id="l20.145">         expected: {</span>
<a href="#l20.146"></a><span id="l20.146">             node: &quot;organizer-table&quot;,</span>
<a href="#l20.147"></a><span id="l20.147">             each: [&quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;organizer2@example.net&lt;/span&gt;&quot;,</span>
<a href="#l20.148"></a><span id="l20.148">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;organizer1@example.net&lt;/span&gt;&quot;]</span>
<a href="#l20.149"></a><span id="l20.149">         }</span>
<a href="#l20.150"></a><span id="l20.150">     }, {</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineat">@@ -571,19 +545,17 @@ add_task(function* getHeaderSection_test</span>
<a href="#l20.152"></a><span id="l20.152">                   &quot;To: rec1@example.net, Recipient 2 &lt;rec2@example.net&gt;,\r\n \&quot;Rec, 3\&quot; &lt;rec3@example.net&gt;\r\n&quot; +</span>
<a href="#l20.153"></a><span id="l20.153">                   &quot;Subject: Invitation: test subject\r\n&quot; +</span>
<a href="#l20.154"></a><span id="l20.154">                   &quot;Cc: cc1@example.net, Cc 2 &lt;cc2@example.net&gt;, \&quot;Cc, 3\&quot; &lt;cc3@example.net&gt;\r\n&quot; +</span>
<a href="#l20.155"></a><span id="l20.155">                   &quot;Bcc: bcc1@example.net, BCc 2 &lt;bcc2@example.net&gt;, \&quot;Bcc, 3\&quot;\r\n &lt;bcc3@example.net&gt;\r\n&quot;</span>
<a href="#l20.156"></a><span id="l20.156">     }, {</span>
<a href="#l20.157"></a><span id="l20.157">         input: {</span>
<a href="#l20.158"></a><span id="l20.158">             toList: &quot;recipient@example.net&quot;,</span>
<a href="#l20.159"></a><span id="l20.159">             subject: &quot;Invitation: test subject&quot;,</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineminus">-            identity: {</span>
<a href="#l20.161"></a><span id="l20.161" class="difflineminus">-                email: &quot;sender@example.net&quot;</span>
<a href="#l20.162"></a><span id="l20.162" class="difflineminus">-            }</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineplus">+            identity: { email: &quot;sender@example.net&quot; }</span>
<a href="#l20.164"></a><span id="l20.164">         },</span>
<a href="#l20.165"></a><span id="l20.165">         expected: &quot;MIME-version: 1.0\r\n&quot; +</span>
<a href="#l20.166"></a><span id="l20.166">                   &quot;From: sender@example.net\r\n&quot; +</span>
<a href="#l20.167"></a><span id="l20.167">                   &quot;To: recipient@example.net\r\n&quot; +</span>
<a href="#l20.168"></a><span id="l20.168">                   &quot;Subject: Invitation: test subject\r\n&quot;</span>
<a href="#l20.169"></a><span id="l20.169">     }, {</span>
<a href="#l20.170"></a><span id="l20.170">         input: {</span>
<a href="#l20.171"></a><span id="l20.171">             toList: &quot;Max Mller &lt;mueller@example.net&gt;&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/test/unit/test_search_service.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/test/unit/test_search_service.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -30,19 +30,17 @@ function test_found() {</span>
<a href="#l21.4"></a><span id="l21.4">         searchForCalendars: function(aStr, aHint, aMax, aListener) {</span>
<a href="#l21.5"></a><span id="l21.5">             ok(!this.called);</span>
<a href="#l21.6"></a><span id="l21.6">             this.called = true;</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">             equal(aStr, &quot;str&quot;);</span>
<a href="#l21.9"></a><span id="l21.9">             equal(aHint, HINT_EXACT_MATCH);</span>
<a href="#l21.10"></a><span id="l21.10">             equal(aMax, 0);</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-            let mockCalendar = {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-                id: &quot;test&quot;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-            };</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+            let mockCalendar = { id: &quot;test&quot; };</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">             aListener.onResult(null, [mockCalendar]);</span>
<a href="#l21.18"></a><span id="l21.18">         }</span>
<a href="#l21.19"></a><span id="l21.19">     };</span>
<a href="#l21.20"></a><span id="l21.20">     provider2.wrappedJSObject = provider2;</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22">     search.addProvider(provider1);</span>
<a href="#l21.23"></a><span id="l21.23">     equal(search.getProviders({}).length, 1);</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineat">@@ -93,20 +91,22 @@ function test_failure() {</span>
<a href="#l21.25"></a><span id="l21.25"> }</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27"> function test_cancel() {</span>
<a href="#l21.28"></a><span id="l21.28">     search.getProviders({}).forEach(search.removeProvider, search);</span>
<a href="#l21.29"></a><span id="l21.29"> </span>
<a href="#l21.30"></a><span id="l21.30">     let provider = {</span>
<a href="#l21.31"></a><span id="l21.31">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICalendarSearchProvider, Components.interfaces.calIOperation]),</span>
<a href="#l21.32"></a><span id="l21.32">         searchForCalendars: function(aStr, aHint, aMax, aListener) {</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-            Services.tm.currentThread.dispatch({ run: function() {</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-                dump(&quot;Cancelling search...&quot;);</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-                op.cancel();</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-            } }, Components.interfaces.nsIEventTarget.DISPATCH_NORMAL);</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+            Services.tm.currentThread.dispatch({</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+                run: function() {</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+                    dump(&quot;Cancelling search...&quot;);</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+                    op.cancel();</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+                }</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+            }, Components.interfaces.nsIEventTarget.DISPATCH_NORMAL);</span>
<a href="#l21.43"></a><span id="l21.43"> </span>
<a href="#l21.44"></a><span id="l21.44">             // No listener call, we emulate a long running search</span>
<a href="#l21.45"></a><span id="l21.45">             // Do return the operation though</span>
<a href="#l21.46"></a><span id="l21.46">             return this;</span>
<a href="#l21.47"></a><span id="l21.47">         },</span>
<a href="#l21.48"></a><span id="l21.48"> </span>
<a href="#l21.49"></a><span id="l21.49">         isPending: true,</span>
<a href="#l21.50"></a><span id="l21.50">         cancelCalled: false,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/test/unit/test_utils.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/test/unit/test_utils.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -127,19 +127,17 @@ function test_calOperationGroup() {</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">     let group = new cal.calOperationGroup(cancelFunc);</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">     ok(group.isEmpty);</span>
<a href="#l22.8"></a><span id="l22.8">     equal(group.id, cal.calOperationGroup.mOpGroupPrefix + &quot;0&quot;);</span>
<a href="#l22.9"></a><span id="l22.9">     equal(group.status, Components.results.NS_OK);</span>
<a href="#l22.10"></a><span id="l22.10">     equal(group.isPending, true);</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    let completedOp = {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-        isPending: false</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-    };</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+    let completedOp = { isPending: false };</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">     group.add(completedOp);</span>
<a href="#l22.18"></a><span id="l22.18">     ok(group.isEmpty);</span>
<a href="#l22.19"></a><span id="l22.19">     equal(group.isPending, true);</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21">     let pendingOp1 = {</span>
<a href="#l22.22"></a><span id="l22.22">         id: 1,</span>
<a href="#l22.23"></a><span id="l22.23">         isPending: true,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

