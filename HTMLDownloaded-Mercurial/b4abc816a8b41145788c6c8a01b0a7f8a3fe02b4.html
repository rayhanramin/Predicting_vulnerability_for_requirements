<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20090:b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4" />
<meta property="og:url" content="/comm-central/rev/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable no-negated-condition rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">shortlog</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">files</a> |
changeset |
<a href="/comm-central/raw-rev/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">raw</a>  | <a href="/comm-central/archive/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-negated-condition rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 14:11:31 +0200</td></tr>

<tr>
 <td>changeset 20090</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4</a></td>
</tr>



<tr>
<td>parent 20089</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/69ec77254bf412f0fe236c10f2eb3919a62f9b9d">69ec77254bf412f0fe236c10f2eb3919a62f9b9d</a>
</td>
</tr>

<tr>
<td>child 20091</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0f801095088a5868cbd812ae3f1770eee0e76863">0f801095088a5868cbd812ae3f1770eee0e76863</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4">12311</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:37:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0f9a99fba7f3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&newProject=comm-central&newRevision=e6a3cd0ad1e007cea30628f9cb96ba9085162329&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&newProject=comm-central&newRevision=e6a3cd0ad1e007cea30628f9cb96ba9085162329&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&newProject=comm-central&newRevision=e6a3cd0ad1e007cea30628f9cb96ba9085162329&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-negated-condition rule. r=MakeMyDay

MozReview-Commit-ID: DPlHUl3VbHA</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.xml">calendar/base/content/agenda-listbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/agenda-listbox.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-editing.js">calendar/base/content/calendar-task-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-editing.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-editing.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-editing.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-editing.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.xml">calendar/base/content/calendar-views.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/calendar-views.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/import-export.js">calendar/base/content/import-export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/import-export.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/import-export.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/import-export.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/import-export.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/import-export.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/calendar-alarm-widget.xml">calendar/base/content/widgets/calendar-alarm-widget.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/calendar-alarm-widget.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/calendar-alarm-widget.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/calendar-alarm-widget.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/calendar-alarm-widget.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/calendar-alarm-widget.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calAuthUtils.jsm">calendar/base/modules/calAuthUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calAuthUtils.jsm">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calAuthUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calAuthUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calAuthUtils.jsm">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calAuthUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calExtract.jsm">calendar/base/modules/calExtract.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calExtract.jsm">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calExtract.jsm">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calExtract.jsm">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calExtract.jsm">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calExtract.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAttendee.js">calendar/base/src/calAttendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAttendee.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAttendee.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAttendee.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAttendee.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calAttendee.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calDateTimeFormatter.js">calendar/base/src/calDateTimeFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calDateTimeFormatter.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calDateTimeFormatter.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calDateTimeFormatter.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calDateTimeFormatter.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calDateTimeFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calIcsParser.js">calendar/base/src/calIcsParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calIcsParser.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calIcsParser.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calIcsParser.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calIcsParser.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calIcsParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTransactionManager.js">calendar/base/src/calTransactionManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTransactionManager.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTransactionManager.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTransactionManager.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTransactionManager.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calTransactionManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/html-item-editing/react-code.js">calendar/lightning/content/html-item-editing/react-code.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/html-item-editing/react-code.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/html-item-editing/react-code.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/html-item-editing/react-code.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/html-item-editing/react-code.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/html-item-editing/react-code.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-panel.js">calendar/lightning/content/lightning-item-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-panel.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-panel.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-panel.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-panel.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/content/lightning-item-panel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapRequest.js">calendar/providers/wcap/calWcapRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapRequest.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapRequest.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapRequest.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapRequest.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapRequest.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/calendarCreation.js">calendar/resources/content/calendarCreation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/calendarCreation.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/calendarCreation.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/calendarCreation.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/calendarCreation.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/calendarCreation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/b4abc816a8b41145788c6c8a01b0a7f8a3fe02b4/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -424,13 +424,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &quot;prefer-arrow-callback&quot;: [2, { &quot;allowNamedFunctions&quot;: true }],</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     // Suggest using the spread operator instead of .apply()</span>
<a href="#l1.7"></a><span id="l1.7">     &quot;prefer-spread&quot;: 2,</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Quoting style for property names</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;quote-props&quot;: [&quot;error&quot;, &quot;consistent-as-needed&quot;, { &quot;keywords&quot;: true }],</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Disallow negated conditions</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;no-negated-condition&quot;: 2,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.16"></a><span id="l1.16">     // easier updates in the future.</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">   }</span>
<a href="#l1.19"></a><span id="l1.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -306,35 +306,35 @@ agendaListbox.addItem = function(aItem) </span>
<a href="#l2.4"></a><span id="l2.4">         let visible = complistItem.getCheckbox().checked;</span>
<a href="#l2.5"></a><span id="l2.5">         if (aItem.startDate.isDate &amp;&amp; period.duration == 1 &amp;&amp; aItem.duration.days == 1) {</span>
<a href="#l2.6"></a><span id="l2.6">             if (this.getListItems(aItem, period).length == 0) {</span>
<a href="#l2.7"></a><span id="l2.7">                 this.addItemBefore(aItem, period.listItem.nextSibling, period, visible);</span>
<a href="#l2.8"></a><span id="l2.8">             }</span>
<a href="#l2.9"></a><span id="l2.9">         } else {</span>
<a href="#l2.10"></a><span id="l2.10">             do {</span>
<a href="#l2.11"></a><span id="l2.11">                 complistItem = complistItem.nextSibling;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                if (!this.isEventListItem(complistItem)) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                    newlistItem = this.addItemBefore(aItem, complistItem, period, visible);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                    break;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                } else {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+                if (this.isEventListItem(complistItem)) {</span>
<a href="#l2.17"></a><span id="l2.17">                     let compitem = complistItem.occurrence;</span>
<a href="#l2.18"></a><span id="l2.18">                     if (this.isSameEvent(aItem, compitem)) {</span>
<a href="#l2.19"></a><span id="l2.19">                         // The same event occurs on several calendars but we only</span>
<a href="#l2.20"></a><span id="l2.20">                         // display the first one.</span>
<a href="#l2.21"></a><span id="l2.21">                         // TODO: find a way to display this special circumstance</span>
<a href="#l2.22"></a><span id="l2.22">                         break;</span>
<a href="#l2.23"></a><span id="l2.23">                     } else if (this.isBefore(aItem, compitem, period)) {</span>
<a href="#l2.24"></a><span id="l2.24">                         if (this.isSameEvent(aItem, compitem)) {</span>
<a href="#l2.25"></a><span id="l2.25">                             newlistItem = this.addItemBefore(aItem, complistItem, period, visible);</span>
<a href="#l2.26"></a><span id="l2.26">                             break;</span>
<a href="#l2.27"></a><span id="l2.27">                         } else {</span>
<a href="#l2.28"></a><span id="l2.28">                             newlistItem = this.addItemBefore(aItem, complistItem, period, visible);</span>
<a href="#l2.29"></a><span id="l2.29">                             break;</span>
<a href="#l2.30"></a><span id="l2.30">                         }</span>
<a href="#l2.31"></a><span id="l2.31">                     }</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+                } else {</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+                    newlistItem = this.addItemBefore(aItem, complistItem, period, visible);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+                    break;</span>
<a href="#l2.35"></a><span id="l2.35">                 }</span>
<a href="#l2.36"></a><span id="l2.36">             } while (complistItem);</span>
<a href="#l2.37"></a><span id="l2.37">         }</span>
<a href="#l2.38"></a><span id="l2.38">     }</span>
<a href="#l2.39"></a><span id="l2.39">     return newlistItem;</span>
<a href="#l2.40"></a><span id="l2.40"> };</span>
<a href="#l2.41"></a><span id="l2.41"> </span>
<a href="#l2.42"></a><span id="l2.42"> /**</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineat">@@ -762,20 +762,20 @@ agendaListbox.showsToday = function(aSta</span>
<a href="#l2.44"></a><span id="l2.44">     return lshowsToday;</span>
<a href="#l2.45"></a><span id="l2.45"> };</span>
<a href="#l2.46"></a><span id="l2.46"> </span>
<a href="#l2.47"></a><span id="l2.47"> /**</span>
<a href="#l2.48"></a><span id="l2.48">  * Moves the selection. Moves down unless the next item is a period item, in</span>
<a href="#l2.49"></a><span id="l2.49">  * which case the selection moves up.</span>
<a href="#l2.50"></a><span id="l2.50">  */</span>
<a href="#l2.51"></a><span id="l2.51"> agendaListbox.moveSelection = function() {</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-    if (!this.isEventListItem(this.agendaListboxControl.selectedItem.nextSibling)) {</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+    if (this.isEventListItem(this.agendaListboxControl.selectedItem.nextSibling)) {</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+        this.agendaListboxControl.goDown();</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+    } else {</span>
<a href="#l2.56"></a><span id="l2.56">         this.agendaListboxControl.goUp();</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-    } else {</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-        this.agendaListboxControl.goDown();</span>
<a href="#l2.59"></a><span id="l2.59">     }</span>
<a href="#l2.60"></a><span id="l2.60"> };</span>
<a href="#l2.61"></a><span id="l2.61"> </span>
<a href="#l2.62"></a><span id="l2.62"> /**</span>
<a href="#l2.63"></a><span id="l2.63">  * Gets an array of selected items. If a period node is selected, it is not</span>
<a href="#l2.64"></a><span id="l2.64">  * included.</span>
<a href="#l2.65"></a><span id="l2.65">  *</span>
<a href="#l2.66"></a><span id="l2.66">  * @return      An array with all selected items.</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineat">@@ -817,20 +817,20 @@ agendaListbox.removeListItems = function</span>
<a href="#l2.68"></a><span id="l2.68">         do {</span>
<a href="#l2.69"></a><span id="l2.69">             let newlistItem = null;</span>
<a href="#l2.70"></a><span id="l2.70">             if (listItem) {</span>
<a href="#l2.71"></a><span id="l2.71">                 newlistItem = listItem.previousSibling;</span>
<a href="#l2.72"></a><span id="l2.72">             } else {</span>
<a href="#l2.73"></a><span id="l2.73">                 leaveloop = true;</span>
<a href="#l2.74"></a><span id="l2.74">             }</span>
<a href="#l2.75"></a><span id="l2.75">             if (this.isEventListItem(listItem)) {</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-                if (listItem != this.agendaListboxControl.firstChild) {</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+                if (listItem == this.agendaListboxControl.firstChild) {</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+                    leaveloop = true;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+                } else {</span>
<a href="#l2.80"></a><span id="l2.80">                     listItem.remove();</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-                } else {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-                    leaveloop = true;</span>
<a href="#l2.83"></a><span id="l2.83">                 }</span>
<a href="#l2.84"></a><span id="l2.84">             }</span>
<a href="#l2.85"></a><span id="l2.85">             listItem = newlistItem;</span>
<a href="#l2.86"></a><span id="l2.86">         } while (!leaveloop);</span>
<a href="#l2.87"></a><span id="l2.87">     }</span>
<a href="#l2.88"></a><span id="l2.88"> };</span>
<a href="#l2.89"></a><span id="l2.89"> </span>
<a href="#l2.90"></a><span id="l2.90"> /**</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineat">@@ -1078,17 +1078,19 @@ function scheduleNextCurrentEventUpdate(</span>
<a href="#l2.92"></a><span id="l2.92">     // workaround bug 291386.  If we don't, we stand a decent chance of getting</span>
<a href="#l2.93"></a><span id="l2.93">     // stuck in an infinite loop.</span>
<a href="#l2.94"></a><span id="l2.94">     let udCallback = {</span>
<a href="#l2.95"></a><span id="l2.95">         notify: function(timer) {</span>
<a href="#l2.96"></a><span id="l2.96">             aRefreshCallback();</span>
<a href="#l2.97"></a><span id="l2.97">         }</span>
<a href="#l2.98"></a><span id="l2.98">     };</span>
<a href="#l2.99"></a><span id="l2.99"> </span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-    if (!gEventTimer) {</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+    if (gEventTimer) {</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+        gEventTimer.cancel();</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+    } else {</span>
<a href="#l2.104"></a><span id="l2.104">         // Observer for wake after sleep/hibernate/standby to create new timers and refresh UI</span>
<a href="#l2.105"></a><span id="l2.105">         let wakeObserver = {</span>
<a href="#l2.106"></a><span id="l2.106">            observe: function(aSubject, aTopic, aData) {</span>
<a href="#l2.107"></a><span id="l2.107">                if (aTopic == &quot;wake_notification&quot;) {</span>
<a href="#l2.108"></a><span id="l2.108">                    aRefreshCallback();</span>
<a href="#l2.109"></a><span id="l2.109">                }</span>
<a href="#l2.110"></a><span id="l2.110">            }</span>
<a href="#l2.111"></a><span id="l2.111">         };</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineat">@@ -1097,18 +1099,16 @@ function scheduleNextCurrentEventUpdate(</span>
<a href="#l2.113"></a><span id="l2.113"> </span>
<a href="#l2.114"></a><span id="l2.114">         // Remove observer on unload</span>
<a href="#l2.115"></a><span id="l2.115">         window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l2.116"></a><span id="l2.116">             Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l2.117"></a><span id="l2.117">         }, false);</span>
<a href="#l2.118"></a><span id="l2.118"> </span>
<a href="#l2.119"></a><span id="l2.119">         gEventTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l2.120"></a><span id="l2.120">                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-    } else {</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-        gEventTimer.cancel();</span>
<a href="#l2.123"></a><span id="l2.123">     }</span>
<a href="#l2.124"></a><span id="l2.124">     gEventTimer.initWithCallback(udCallback, aMsUntil, gEventTimer.TYPE_ONE_SHOT);</span>
<a href="#l2.125"></a><span id="l2.125"> }</span>
<a href="#l2.126"></a><span id="l2.126"> </span>
<a href="#l2.127"></a><span id="l2.127"> /**</span>
<a href="#l2.128"></a><span id="l2.128">  * Gets a right value for calendar.agendaListbox.soondays preference, avoid</span>
<a href="#l2.129"></a><span id="l2.129">  * erroneus values edited in the lightning.js preference file</span>
<a href="#l2.130"></a><span id="l2.130">  **/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -128,33 +128,31 @@</span>
<a href="#l3.4"></a><span id="l3.4">             // Show items's date for long periods but also for &quot;Upcoming&quot;</span>
<a href="#l3.5"></a><span id="l3.5">             // period with one day duration.</span>
<a href="#l3.6"></a><span id="l3.6">             let showDate = aPeriod.multiday || aPeriod.duration &gt; 1;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">             let date = &quot;&quot;;</span>
<a href="#l3.9"></a><span id="l3.9">             let iconType = &quot;&quot;;</span>
<a href="#l3.10"></a><span id="l3.10">             let allDayDateLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-allDayEvent-date&quot;);</span>
<a href="#l3.11"></a><span id="l3.11">             setBooleanAttribute(allDayDateLabel, &quot;hidden&quot;, !showDate);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            if (startDate.compare(endPreviousDay) != 0) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                // All day event spanning multiple days.</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-                     startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-                    iconType = &quot;start&quot;;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                    date = dateFormatter.formatDate(startDate);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-                } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-                           endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-                    iconType = &quot;end&quot;;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-                    date = dateFormatter.formatDate(endPreviousDay);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-                } else {</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-                    iconType = &quot;continue&quot;;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-                    hideElement(allDayDateLabel);</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-                }</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-            } else {</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+            if (startDate.compare(endPreviousDay) == 0) {</span>
<a href="#l3.28"></a><span id="l3.28">                 // All day event one day duration.</span>
<a href="#l3.29"></a><span id="l3.29">                 date = dateFormatter.formatDate(startDate);</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+            } else if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+                 startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+                // All day event spanning multiple days.</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+                iconType = &quot;start&quot;;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+                date = dateFormatter.formatDate(startDate);</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+            } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                       endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+                iconType = &quot;end&quot;;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+                date = dateFormatter.formatDate(endPreviousDay);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+            } else {</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+                iconType = &quot;continue&quot;;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+                hideElement(allDayDateLabel);</span>
<a href="#l3.42"></a><span id="l3.42">             }</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44">             let multiDayImage = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-multiDayEvent-image&quot;);</span>
<a href="#l3.45"></a><span id="l3.45">             multiDayImage.setAttribute(&quot;type&quot;, iconType);</span>
<a href="#l3.46"></a><span id="l3.46">             // class wrap causes allday items to wrap its text in today-pane</span>
<a href="#l3.47"></a><span id="l3.47">             let addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;eventbox&quot;);</span>
<a href="#l3.48"></a><span id="l3.48">             addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l3.49"></a><span id="l3.49">             addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;event-detail-box&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -41,20 +41,20 @@ var calendarExtract = {</span>
<a href="#l4.4"></a><span id="l4.4">         langs.sort((a, b) =&gt; {</span>
<a href="#l4.5"></a><span id="l4.5">             let idx_a = lastUsedLangs.indexOf(a[1]);</span>
<a href="#l4.6"></a><span id="l4.6">             let idx_b = lastUsedLangs.indexOf(b[1]);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">             if (idx_a == -1 &amp;&amp; idx_b == -1) {</span>
<a href="#l4.9"></a><span id="l4.9">                 return a[0].localeCompare(b[0]);</span>
<a href="#l4.10"></a><span id="l4.10">             } else if (idx_a != -1 &amp;&amp; idx_b != -1) {</span>
<a href="#l4.11"></a><span id="l4.11">                 return idx_a - idx_b;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-            } else if (idx_a != -1) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+            } else if (idx_a == -1) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                return 1;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+            } else {</span>
<a href="#l4.16"></a><span id="l4.16">                 return -1;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-            } else {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-                return 1;</span>
<a href="#l4.19"></a><span id="l4.19">             }</span>
<a href="#l4.20"></a><span id="l4.20">         });</span>
<a href="#l4.21"></a><span id="l4.21">         removeChildren(localeList);</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">         for (let lang of langs) {</span>
<a href="#l4.24"></a><span id="l4.24">             addMenuItem(localeList, lang[0], lang[1], null);</span>
<a href="#l4.25"></a><span id="l4.25">         }</span>
<a href="#l4.26"></a><span id="l4.26">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -387,23 +387,23 @@ InvitationsManager.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">     },</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">     /**</span>
<a href="#l5.7"></a><span id="l5.7">      * Updates the start date for the invitations manager to the date returned</span>
<a href="#l5.8"></a><span id="l5.8">      * from this.getStartDate(), unless the previously existing start date is</span>
<a href="#l5.9"></a><span id="l5.9">      * the same or after what getStartDate() returned.</span>
<a href="#l5.10"></a><span id="l5.10">      */</span>
<a href="#l5.11"></a><span id="l5.11">     updateStartDate: function() {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-        if (!this.mStartDate) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-            this.mStartDate = this.getStartDate();</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-        } else {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        if (this.mStartDate) {</span>
<a href="#l5.16"></a><span id="l5.16">             let startDate = this.getStartDate();</span>
<a href="#l5.17"></a><span id="l5.17">             if (startDate.compare(this.mStartDate) &gt; 0) {</span>
<a href="#l5.18"></a><span id="l5.18">                 this.mStartDate = startDate;</span>
<a href="#l5.19"></a><span id="l5.19">             }</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+        } else {</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+            this.mStartDate = this.getStartDate();</span>
<a href="#l5.22"></a><span id="l5.22">         }</span>
<a href="#l5.23"></a><span id="l5.23">     },</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">     /**</span>
<a href="#l5.26"></a><span id="l5.26">      * Checks if the item is valid for the invitation manager. Checks if the</span>
<a href="#l5.27"></a><span id="l5.27">      * item is in the range of the invitation manager and if the item is a valid</span>
<a href="#l5.28"></a><span id="l5.28">      * invitation.</span>
<a href="#l5.29"></a><span id="l5.29">      *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -77,23 +77,23 @@ function setDefaultItemValues(aItem, aCa</span>
<a href="#l6.4"></a><span id="l6.4">                 // XXX it is currently not specified, how callers that force all</span>
<a href="#l6.5"></a><span id="l6.5">                 // day should pass the end date. Right now, they should make</span>
<a href="#l6.6"></a><span id="l6.6">                 // sure that the end date is 00:00:00 of the day after.</span>
<a href="#l6.7"></a><span id="l6.7">                 aItem.endDate.isDate = true;</span>
<a href="#l6.8"></a><span id="l6.8">                 aItem.endDate.timezone = cal.floating();</span>
<a href="#l6.9"></a><span id="l6.9">             }</span>
<a href="#l6.10"></a><span id="l6.10">         } else {</span>
<a href="#l6.11"></a><span id="l6.11">             aItem.endDate = aItem.startDate.clone();</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-            if (!aForceAllday) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+            if (aForceAllday) {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+                // All day events need to go to the beginning of the next day.</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+                aItem.endDate.day++;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+            } else {</span>
<a href="#l6.17"></a><span id="l6.17">                 // If the event is not all day, then add the default event</span>
<a href="#l6.18"></a><span id="l6.18">                 // length.</span>
<a href="#l6.19"></a><span id="l6.19">                 aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-            } else {</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-                // All day events need to go to the beginning of the next day.</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-                aItem.endDate.day++;</span>
<a href="#l6.23"></a><span id="l6.23">             }</span>
<a href="#l6.24"></a><span id="l6.24">         }</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">         // Free/busy status is only valid for events, must not be set for tasks.</span>
<a href="#l6.27"></a><span id="l6.27">         aItem.setProperty(&quot;TRANSP&quot;, cal.getEventDefaultTransparency(aForceAllday));</span>
<a href="#l6.28"></a><span id="l6.28">     } else if (cal.isToDo(aItem)) {</span>
<a href="#l6.29"></a><span id="l6.29">         let now = cal.now();</span>
<a href="#l6.30"></a><span id="l6.30">         let initDate = initialDate ? initialDate.clone() : now;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -90,27 +90,27 @@ function loadCalendarManager() {</span>
<a href="#l7.4"></a><span id="l7.4">     let compositeCalendar = getCompositeCalendar();</span>
<a href="#l7.5"></a><span id="l7.5">     tree.compositeCalendar = compositeCalendar;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">     // Initialize our composite observer</span>
<a href="#l7.8"></a><span id="l7.8">     compositeCalendar.addObserver(compositeObserver);</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">     // Create the home calendar if no calendar exists.</span>
<a href="#l7.11"></a><span id="l7.11">     let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    if (!calendars.length) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-        initHomeCalendar();</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-    } else {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    if (calendars.length) {</span>
<a href="#l7.16"></a><span id="l7.16">         // migration code to make sure calendars, which do not support caching have cache enabled</span>
<a href="#l7.17"></a><span id="l7.17">         // required to further clean up on top of bug 1182264</span>
<a href="#l7.18"></a><span id="l7.18">         for (let calendar of calendars) {</span>
<a href="#l7.19"></a><span id="l7.19">             if (calendar.getProperty(&quot;cache.supported&quot;) === false &amp;&amp;</span>
<a href="#l7.20"></a><span id="l7.20">                 calendar.getProperty(&quot;cache.enabled&quot;) === true) {</span>
<a href="#l7.21"></a><span id="l7.21">                 calendar.deleteProperty(&quot;cache.enabled&quot;);</span>
<a href="#l7.22"></a><span id="l7.22">             }</span>
<a href="#l7.23"></a><span id="l7.23">         }</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+    } else {</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+        initHomeCalendar();</span>
<a href="#l7.26"></a><span id="l7.26">     }</span>
<a href="#l7.27"></a><span id="l7.27"> }</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29"> /**</span>
<a href="#l7.30"></a><span id="l7.30">  * Creates the initial &quot;Home&quot; calendar if no calendar exists.</span>
<a href="#l7.31"></a><span id="l7.31">  */</span>
<a href="#l7.32"></a><span id="l7.32"> function initHomeCalendar() {</span>
<a href="#l7.33"></a><span id="l7.33">     let calMgr = cal.getCalendarManager();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1089,23 +1089,23 @@</span>
<a href="#l8.4"></a><span id="l8.4">                   itemData.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l8.5"></a><span id="l8.5">                 } else {</span>
<a href="#l8.6"></a><span id="l8.6">                   itemData.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l8.7"></a><span id="l8.7">                 }</span>
<a href="#l8.8"></a><span id="l8.8">               }</span>
<a href="#l8.9"></a><span id="l8.9">             }</span>
<a href="#l8.10"></a><span id="l8.10">           }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          if (!aStop) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+          if (aStop) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+            // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+            delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+          } else {</span>
<a href="#l8.17"></a><span id="l8.17">             // Set up a timer to stop the flashing after the total time.</span>
<a href="#l8.18"></a><span id="l8.18">             this.mFlashingEvents[aAlarmItem.hashId] = aAlarmItem;</span>
<a href="#l8.19"></a><span id="l8.19">             setTimeout(() =&gt; this.flashAlarm(aAlarmItem, true), totaltime);</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-          } else {</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-            // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-            delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l8.23"></a><span id="l8.23">           }</span>
<a href="#l8.24"></a><span id="l8.24">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.25"></a><span id="l8.25">       &lt;/method&gt;</span>
<a href="#l8.26"></a><span id="l8.26">     &lt;/implementation&gt;</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">     &lt;handlers&gt;</span>
<a href="#l8.29"></a><span id="l8.29">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.30"></a><span id="l8.30">         const pixelThreshold = 150;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -142,23 +142,23 @@</span>
<a href="#l9.4"></a><span id="l9.4">               }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">               // calculate duration pixel as the difference between</span>
<a href="#l9.7"></a><span id="l9.7">               // start pixel and end pixel to avoid rounding errors.</span>
<a href="#l9.8"></a><span id="l9.8">               let startPix = Math.round(theMin * this.mPixPerMin);</span>
<a href="#l9.9"></a><span id="l9.9">               let endPix = Math.round((theMin + dur) * this.mPixPerMin);</span>
<a href="#l9.10"></a><span id="l9.10">               let durPix = endPix - startPix;</span>
<a href="#l9.11"></a><span id="l9.11">               let box;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-              if (dur != 60) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                  box = makeTimeBox(&quot;&quot;, durPix);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-              } else {</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+              if (dur == 60) {</span>
<a href="#l9.16"></a><span id="l9.16">                   timeString = formatter.FormatTime(&quot;&quot;,</span>
<a href="#l9.17"></a><span id="l9.17">                                                     Components.interfaces.nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l9.18"></a><span id="l9.18">                                                     theHour, 0, 0);</span>
<a href="#l9.19"></a><span id="l9.19">                   box = makeTimeBox(timeString, durPix);</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+              } else {</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+                  box = makeTimeBox(&quot;&quot;, durPix);</span>
<a href="#l9.22"></a><span id="l9.22">               }</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">               // Set up workweek hours</span>
<a href="#l9.25"></a><span id="l9.25">               if (theHour &lt; this.mDayStartHour || theHour &gt;= this.mDayEndHour) {</span>
<a href="#l9.26"></a><span id="l9.26">                   box.setAttribute(&quot;off-time&quot;, &quot;true&quot;);</span>
<a href="#l9.27"></a><span id="l9.27">               }</span>
<a href="#l9.28"></a><span id="l9.28"> </span>
<a href="#l9.29"></a><span id="l9.29">               box.setAttribute(&quot;class&quot;, &quot;calendar-time-bar-box-&quot; + (theHour % 2 == 0 ? &quot;even&quot; : &quot;odd&quot;));</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineat">@@ -491,25 +491,25 @@</span>
<a href="#l9.31"></a><span id="l9.31">            for (let i in this.mEventInfos) {</span>
<a href="#l9.32"></a><span id="l9.32">                occ = this.mEventInfos[i].event;</span>
<a href="#l9.33"></a><span id="l9.33">                if (occ.hashId == aOccurrence.hashId) {</span>
<a href="#l9.34"></a><span id="l9.34">                    itemIndex = i;</span>
<a href="#l9.35"></a><span id="l9.35">                    break;</span>
<a href="#l9.36"></a><span id="l9.36">                }</span>
<a href="#l9.37"></a><span id="l9.37">            }</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-           if (itemIndex != -1) {</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+           if (itemIndex == -1) {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+               return false;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+           } else {</span>
<a href="#l9.43"></a><span id="l9.43">                delete this.mSelectedItemIds[occ.hashId];</span>
<a href="#l9.44"></a><span id="l9.44">                this.mSelectedChunks = this.mSelectedChunks.filter((item) =&gt; {</span>
<a href="#l9.45"></a><span id="l9.45">                    return !item.occurrence || (item.occurrence.hashId != aOccurrence.hashId);</span>
<a href="#l9.46"></a><span id="l9.46">                });</span>
<a href="#l9.47"></a><span id="l9.47">                this.mEventInfos.splice(itemIndex, 1);</span>
<a href="#l9.48"></a><span id="l9.48">                return true;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-           } else {</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-               return false;</span>
<a href="#l9.51"></a><span id="l9.51">            }</span>
<a href="#l9.52"></a><span id="l9.52">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.53"></a><span id="l9.53">       &lt;/method&gt;</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55">       &lt;method name=&quot;recalculateStartEndMinutes&quot;&gt;</span>
<a href="#l9.56"></a><span id="l9.56">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.57"></a><span id="l9.57">           for (let chunk of this.mEventInfos) {</span>
<a href="#l9.58"></a><span id="l9.58">               let mins = this.getStartEndMinutesForOccurrence(chunk.event);</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineat">@@ -876,22 +876,22 @@</span>
<a href="#l9.60"></a><span id="l9.60">            * An item with no conflicts will have startCol: 0 and colSpan: 1.</span>
<a href="#l9.61"></a><span id="l9.61">            */</span>
<a href="#l9.62"></a><span id="l9.62">           let blobs = [];</span>
<a href="#l9.63"></a><span id="l9.63">           let currentBlob = [];</span>
<a href="#l9.64"></a><span id="l9.64">           function sortByStart(aEventInfo, bEventInfo) {</span>
<a href="#l9.65"></a><span id="l9.65">               // If you pass in tasks without both entry and due dates, I will</span>
<a href="#l9.66"></a><span id="l9.66">               // kill you</span>
<a href="#l9.67"></a><span id="l9.67">               let startComparison = aEventInfo.layoutStart.compare(bEventInfo.layoutStart);</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-              if (startComparison != 0) {</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-                  return startComparison;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-              } else {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+              if (startComparison == 0) {</span>
<a href="#l9.72"></a><span id="l9.72">                   // If the items start at the same time, return the longer one</span>
<a href="#l9.73"></a><span id="l9.73">                   // first</span>
<a href="#l9.74"></a><span id="l9.74">                   return bEventInfo.layoutEnd.compare(aEventInfo.layoutEnd);</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+              } else {</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+                  return startComparison;</span>
<a href="#l9.77"></a><span id="l9.77">               }</span>
<a href="#l9.78"></a><span id="l9.78">           }</span>
<a href="#l9.79"></a><span id="l9.79">           this.mEventInfos.forEach((aEventInfo) =&gt; {</span>
<a href="#l9.80"></a><span id="l9.80">               let item = aEventInfo.event.clone();</span>
<a href="#l9.81"></a><span id="l9.81">               let start = item.startDate || item.entryDate || item.dueDate;</span>
<a href="#l9.82"></a><span id="l9.82">               start = start.getInTimezone(this.mTimezone);</span>
<a href="#l9.83"></a><span id="l9.83">               aEventInfo.layoutStart = start;</span>
<a href="#l9.84"></a><span id="l9.84">               let end = item.endDate || item.dueDate || item.entryDate;</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineat">@@ -1140,29 +1140,29 @@</span>
<a href="#l9.86"></a><span id="l9.86"> </span>
<a href="#l9.87"></a><span id="l9.87">                   // each blob receives its own layer, that's the first part of the story. within</span>
<a href="#l9.88"></a><span id="l9.88">                   // a given blob we need to distribute the items on different layers depending on</span>
<a href="#l9.89"></a><span id="l9.89">                   // the number of columns each item spans. if each item just spans a single column</span>
<a href="#l9.90"></a><span id="l9.90">                   // the blob will cover *one* layer. if the blob contains items that span more than</span>
<a href="#l9.91"></a><span id="l9.91">                   // a single column, this blob will cover more than one layer. the algorithm places</span>
<a href="#l9.92"></a><span id="l9.92">                   // the items on the first layer in the case an item covers a single column. new layers</span>
<a href="#l9.93"></a><span id="l9.93">                   // are introduced based on the start column and number of spanning columns of an item.</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-                  if (data.colSpan != 1) {</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+                  if (data.colSpan == 1) {</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+                      layerIndex = 0;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+                  } else {</span>
<a href="#l9.98"></a><span id="l9.98">                       let index = glob.totalCols * data.colSpan + data.startCol;</span>
<a href="#l9.99"></a><span id="l9.99">                       layerIndex = layerArray[index];</span>
<a href="#l9.100"></a><span id="l9.100">                       if (!layerIndex) {</span>
<a href="#l9.101"></a><span id="l9.101">                           layerIndex = layerCounter++;</span>
<a href="#l9.102"></a><span id="l9.102">                           layerArray[index] = layerIndex;</span>
<a href="#l9.103"></a><span id="l9.103">                       }</span>
<a href="#l9.104"></a><span id="l9.104">                       let offset = (glob.totalCols - data.colSpan) % glob.totalCols;</span>
<a href="#l9.105"></a><span id="l9.105">                       if (offset != 0) {</span>
<a href="#l9.106"></a><span id="l9.106">                           specialSpan = data.colSpan / glob.totalCols;</span>
<a href="#l9.107"></a><span id="l9.107">                       }</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-                  } else {</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-                      layerIndex = 0;</span>
<a href="#l9.110"></a><span id="l9.110">                   }</span>
<a href="#l9.111"></a><span id="l9.111">                   layerIndex += layerOffset;</span>
<a href="#l9.112"></a><span id="l9.112"> </span>
<a href="#l9.113"></a><span id="l9.113">                   // Make sure there's room to insert stuff</span>
<a href="#l9.114"></a><span id="l9.114">                   while (layerIndex &gt;= layers.length) {</span>
<a href="#l9.115"></a><span id="l9.115">                       layers.push([]);</span>
<a href="#l9.116"></a><span id="l9.116">                   }</span>
<a href="#l9.117"></a><span id="l9.117"> </span>
<a href="#l9.118"></a><span id="l9.118" class="difflineat">@@ -1273,23 +1273,23 @@</span>
<a href="#l9.119"></a><span id="l9.119">       &lt;/method&gt;</span>
<a href="#l9.120"></a><span id="l9.120"> </span>
<a href="#l9.121"></a><span id="l9.121">       &lt;method name=&quot;firstLastShadowColumns&quot;&gt;</span>
<a href="#l9.122"></a><span id="l9.122">         &lt;parameter name=&quot;aOffset&quot;/&gt;</span>
<a href="#l9.123"></a><span id="l9.123">         &lt;parameter name=&quot;aShadows&quot;/&gt;</span>
<a href="#l9.124"></a><span id="l9.124">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.125"></a><span id="l9.125">           let firstCol = this; // eslint-disable-line consistent-this</span>
<a href="#l9.126"></a><span id="l9.126">           let lastCol = this; // eslint-disable-line consistent-this</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineminus">-          let firstIndex = (aOffset != null ? aOffset : this.mDragState.offset);</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+          let firstIndex = aOffset || this.mDragState.offset;</span>
<a href="#l9.129"></a><span id="l9.129">           let lastIndex = firstIndex;</span>
<a href="#l9.130"></a><span id="l9.130">           while (firstCol.previousSibling &amp;&amp; firstIndex &gt; 0) {</span>
<a href="#l9.131"></a><span id="l9.131">               firstCol = firstCol.previousSibling;</span>
<a href="#l9.132"></a><span id="l9.132">               firstIndex--;</span>
<a href="#l9.133"></a><span id="l9.133">           }</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-          let lastShadow = (aShadows != null ? aShadows : this.mDragState.shadows);</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+          let lastShadow = aShadows || this.mDragState.shadows;</span>
<a href="#l9.136"></a><span id="l9.136">           while (lastCol.nextSibling &amp;&amp; lastIndex &lt; lastShadow - 1) {</span>
<a href="#l9.137"></a><span id="l9.137">               lastCol = lastCol.nextSibling;</span>
<a href="#l9.138"></a><span id="l9.138">               lastIndex++;</span>
<a href="#l9.139"></a><span id="l9.139">           }</span>
<a href="#l9.140"></a><span id="l9.140"> </span>
<a href="#l9.141"></a><span id="l9.141">           // returns first and last column with shadows that are visible in the</span>
<a href="#l9.142"></a><span id="l9.142">           // week and the positions of these (visible) columns in the set of</span>
<a href="#l9.143"></a><span id="l9.143">           // columns shadows of the occurrence</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineat">@@ -2420,33 +2420,33 @@</span>
<a href="#l9.145"></a><span id="l9.145">             return;</span>
<a href="#l9.146"></a><span id="l9.146">         }</span>
<a href="#l9.147"></a><span id="l9.147"> </span>
<a href="#l9.148"></a><span id="l9.148">         this.parentColumn.calendarView.selectedDay = this.parentColumn.mDate;</span>
<a href="#l9.149"></a><span id="l9.149">         this.mMouseX = event.screenX;</span>
<a href="#l9.150"></a><span id="l9.150">         this.mMouseY = event.screenY;</span>
<a href="#l9.151"></a><span id="l9.151"> </span>
<a href="#l9.152"></a><span id="l9.152">         let whichside = event.whichside;</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-        if (!whichside) {</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-            // may be click or drag,</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-            // so wait for mousemove (or mouseout if fast) to start item move drag</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-            this.mInMouseDown = true;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-            return;</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-        } else {</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+        if (whichside) {</span>
<a href="#l9.160"></a><span id="l9.160">             this.calendarView.setSelectedItems(1,</span>
<a href="#l9.161"></a><span id="l9.161">                 [event.ctrlKey ? this.mOccurrence.parentItem : this.mOccurrence]);</span>
<a href="#l9.162"></a><span id="l9.162"> </span>
<a href="#l9.163"></a><span id="l9.163">             let snapIntMin = (event.shiftKey &amp;&amp;</span>
<a href="#l9.164"></a><span id="l9.164">                               !event.ctrlKey &amp;&amp;</span>
<a href="#l9.165"></a><span id="l9.165">                               !event.altKey &amp;&amp;</span>
<a href="#l9.166"></a><span id="l9.166">                               !event.metaKey) ? 1 : 15;</span>
<a href="#l9.167"></a><span id="l9.167">             // start edge resize drag</span>
<a href="#l9.168"></a><span id="l9.168">             this.parentColumn.startSweepingToModifyEvent(this, this.mOccurrence, whichside,</span>
<a href="#l9.169"></a><span id="l9.169">                                                          event.screenX, event.screenY,</span>
<a href="#l9.170"></a><span id="l9.170">                                                          snapIntMin);</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+        } else {</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+            // may be click or drag,</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+            // so wait for mousemove (or mouseout if fast) to start item move drag</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+            this.mInMouseDown = true;</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+            return;</span>
<a href="#l9.176"></a><span id="l9.176">         }</span>
<a href="#l9.177"></a><span id="l9.177">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l9.178"></a><span id="l9.178"> </span>
<a href="#l9.179"></a><span id="l9.179">       &lt;handler event=&quot;mousemove&quot;&gt;&lt;![CDATA[</span>
<a href="#l9.180"></a><span id="l9.180">         if (!this.mInMouseDown) {</span>
<a href="#l9.181"></a><span id="l9.181">             return;</span>
<a href="#l9.182"></a><span id="l9.182">         }</span>
<a href="#l9.183"></a><span id="l9.183"> </span>
<a href="#l9.184"></a><span id="l9.184" class="difflineat">@@ -2782,23 +2782,23 @@</span>
<a href="#l9.185"></a><span id="l9.185">               setFlashingAttribute(box.eventbox);</span>
<a href="#l9.186"></a><span id="l9.186">             }</span>
<a href="#l9.187"></a><span id="l9.187">             box = col.header.findBoxForItem(aAlarmItem);</span>
<a href="#l9.188"></a><span id="l9.188">             if (box) {</span>
<a href="#l9.189"></a><span id="l9.189">               setFlashingAttribute(box);</span>
<a href="#l9.190"></a><span id="l9.190">             }</span>
<a href="#l9.191"></a><span id="l9.191">           }</span>
<a href="#l9.192"></a><span id="l9.192"> </span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-          if (!aStop) {</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+          if (aStop) {</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+            // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+            delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineplus">+          } else {</span>
<a href="#l9.198"></a><span id="l9.198">             // Set up a timer to stop the flashing after the total time.</span>
<a href="#l9.199"></a><span id="l9.199">             this.mFlashingEvents[aAlarmItem.hashId] = aAlarmItem;</span>
<a href="#l9.200"></a><span id="l9.200">             setTimeout(() =&gt; this.flashAlarm(aAlarmItem, true), totaltime);</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineminus">-          } else {</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineminus">-            // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineminus">-            delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l9.204"></a><span id="l9.204">           }</span>
<a href="#l9.205"></a><span id="l9.205">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.206"></a><span id="l9.206">       &lt;/method&gt;</span>
<a href="#l9.207"></a><span id="l9.207"> </span>
<a href="#l9.208"></a><span id="l9.208">       &lt;!-- calICalendarView --&gt;</span>
<a href="#l9.209"></a><span id="l9.209">       &lt;property name=&quot;supportsDisjointDates&quot;</span>
<a href="#l9.210"></a><span id="l9.210">         onget=&quot;return true&quot;/&gt;</span>
<a href="#l9.211"></a><span id="l9.211">       &lt;property name=&quot;hasDisjointDates&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-task-editing.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-editing.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -68,23 +68,23 @@ var taskEdit = {</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">         let calendar = getSelectedCalendar();</span>
<a href="#l10.6"></a><span id="l10.6">         edit.showsInstructions = true;</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">         if (calendar.getProperty(&quot;capabilities.tasks.supported&quot;) === false) {</span>
<a href="#l10.9"></a><span id="l10.9">             taskEdit.setupTaskField(edit,</span>
<a href="#l10.10"></a><span id="l10.10">                                     true,</span>
<a href="#l10.11"></a><span id="l10.11">                                     calGetString(&quot;calendar&quot;, &quot;taskEditInstructionsCapability&quot;));</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        } else if (!isCalendarWritable(calendar)) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+        } else if (isCalendarWritable(calendar)) {</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+            edit.showsInstructions = false;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+            taskEdit.setupTaskField(edit, false, edit.savedValue || &quot;&quot;);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+        } else {</span>
<a href="#l10.17"></a><span id="l10.17">             taskEdit.setupTaskField(edit,</span>
<a href="#l10.18"></a><span id="l10.18">                                     true,</span>
<a href="#l10.19"></a><span id="l10.19">                                     calGetString(&quot;calendar&quot;, &quot;taskEditInstructionsReadonly&quot;));</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-        } else {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-            edit.showsInstructions = false;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-            taskEdit.setupTaskField(edit, false, edit.savedValue || &quot;&quot;);</span>
<a href="#l10.23"></a><span id="l10.23">         }</span>
<a href="#l10.24"></a><span id="l10.24">     },</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">     /**</span>
<a href="#l10.27"></a><span id="l10.27">      * Handler function to call when the quick-add textbox loses focus.</span>
<a href="#l10.28"></a><span id="l10.28">      *</span>
<a href="#l10.29"></a><span id="l10.29">      * @param aEvent    The DOM blur event</span>
<a href="#l10.30"></a><span id="l10.30">      */</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineat">@@ -102,27 +102,27 @@ var taskEdit = {</span>
<a href="#l10.32"></a><span id="l10.32">             // this must be a first run, we don't have a calendar yet</span>
<a href="#l10.33"></a><span id="l10.33">             return;</span>
<a href="#l10.34"></a><span id="l10.34">         }</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">         if (calendar.getProperty(&quot;capabilities.tasks.supported&quot;) === false) {</span>
<a href="#l10.37"></a><span id="l10.37">             taskEdit.setupTaskField(edit,</span>
<a href="#l10.38"></a><span id="l10.38">                                     true,</span>
<a href="#l10.39"></a><span id="l10.39">                                     calGetString(&quot;calendar&quot;, &quot;taskEditInstructionsCapability&quot;));</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-        } else if (!isCalendarWritable(calendar)) {</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-            taskEdit.setupTaskField(edit,</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-                                    true,</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-                                    calGetString(&quot;calendar&quot;, &quot;taskEditInstructionsReadonly&quot;));</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-        } else {</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+        } else if (isCalendarWritable(calendar)) {</span>
<a href="#l10.46"></a><span id="l10.46">             if (!edit.showsInstructions) {</span>
<a href="#l10.47"></a><span id="l10.47">                 edit.savedValue = edit.value || &quot;&quot;;</span>
<a href="#l10.48"></a><span id="l10.48">             }</span>
<a href="#l10.49"></a><span id="l10.49">             taskEdit.setupTaskField(edit,</span>
<a href="#l10.50"></a><span id="l10.50">                                     false,</span>
<a href="#l10.51"></a><span id="l10.51">                                     calGetString(&quot;calendar&quot;, &quot;taskEditInstructions&quot;));</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+        } else {</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+            taskEdit.setupTaskField(edit,</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+                                    true,</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+                                    calGetString(&quot;calendar&quot;, &quot;taskEditInstructionsReadonly&quot;));</span>
<a href="#l10.56"></a><span id="l10.56">         }</span>
<a href="#l10.57"></a><span id="l10.57">         edit.showsInstructions = true;</span>
<a href="#l10.58"></a><span id="l10.58">     },</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60">     /**</span>
<a href="#l10.61"></a><span id="l10.61">      * Handler function to call on keypress for the quick-add textbox.</span>
<a href="#l10.62"></a><span id="l10.62">      *</span>
<a href="#l10.63"></a><span id="l10.63">      * @param aEvent    The DOM keypress event</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -275,21 +275,17 @@ function getTaskTree() {</span>
<a href="#l11.4"></a><span id="l11.4">  *</span>
<a href="#l11.5"></a><span id="l11.5">  * XXX Parameter aEvent is unused, needs to be removed here and in calling</span>
<a href="#l11.6"></a><span id="l11.6">  * functions.</span>
<a href="#l11.7"></a><span id="l11.7">  *</span>
<a href="#l11.8"></a><span id="l11.8">  * @param aEvent      Unused</span>
<a href="#l11.9"></a><span id="l11.9">  */</span>
<a href="#l11.10"></a><span id="l11.10"> function getSelectedTasks(aEvent) {</span>
<a href="#l11.11"></a><span id="l11.11">     let taskTree = getTaskTree();</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    if (taskTree != null) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-        return taskTree.selectedTasks;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-    } else {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-        return [];</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-    }</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    return taskTree ? taskTree.selectedTasks : [];</span>
<a href="#l11.18"></a><span id="l11.18"> }</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20"> /**</span>
<a href="#l11.21"></a><span id="l11.21">  * Convert selected tasks to emails.</span>
<a href="#l11.22"></a><span id="l11.22">  */</span>
<a href="#l11.23"></a><span id="l11.23"> function tasksToMail(aEvent) {</span>
<a href="#l11.24"></a><span id="l11.24">     let tasks = getSelectedTasks(aEvent);</span>
<a href="#l11.25"></a><span id="l11.25">     calendarMailButtonDNDObserver.onDropItems(tasks);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -485,20 +485,20 @@ function updateMenuLabelsPlural(aLengthF</span>
<a href="#l12.4"></a><span id="l12.4">  *</span>
<a href="#l12.5"></a><span id="l12.5">  * @param menuListId    The ID of the menulist to check.</span>
<a href="#l12.6"></a><span id="l12.6">  * @param value         The value to set.</span>
<a href="#l12.7"></a><span id="l12.7">  * @throws              String error if value not found.</span>
<a href="#l12.8"></a><span id="l12.8">  */</span>
<a href="#l12.9"></a><span id="l12.9"> function menuListSelectItem(menuListId, value) {</span>
<a href="#l12.10"></a><span id="l12.10">     let menuList = document.getElementById(menuListId);</span>
<a href="#l12.11"></a><span id="l12.11">     let index = menuListIndexOf(menuList, value);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    if (index != -1) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    if (index == -1) {</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+        throw &quot;menuListSelectItem: No such Element: &quot; + value;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+    } else {</span>
<a href="#l12.16"></a><span id="l12.16">         menuList.selectedIndex = index;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-    } else {</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-        throw &quot;menuListSelectItem: No such Element: &quot; + value;</span>
<a href="#l12.19"></a><span id="l12.19">     }</span>
<a href="#l12.20"></a><span id="l12.20"> }</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22"> /**</span>
<a href="#l12.23"></a><span id="l12.23">  * Find index of menuitem with the given value, or return -1 if not found.</span>
<a href="#l12.24"></a><span id="l12.24">  *</span>
<a href="#l12.25"></a><span id="l12.25">  * @param menuListId    The XUL menulist node to check.</span>
<a href="#l12.26"></a><span id="l12.26">  * @param value         The value to look for.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -305,17 +305,17 @@ function unifinderDoubleClick(event) {</span>
<a href="#l13.4"></a><span id="l13.4">     // We only care about button 0 (left click) events</span>
<a href="#l13.5"></a><span id="l13.5">     if (event.button != 0) {</span>
<a href="#l13.6"></a><span id="l13.6">         return;</span>
<a href="#l13.7"></a><span id="l13.7">     }</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">     // find event by id</span>
<a href="#l13.10"></a><span id="l13.10">     let calendarEvent = unifinderTreeView.getItemFromEvent(event);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    if (calendarEvent != null) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    if (calendarEvent) {</span>
<a href="#l13.14"></a><span id="l13.14">         modifyEventWithDialog(calendarEvent, null, true);</span>
<a href="#l13.15"></a><span id="l13.15">     } else {</span>
<a href="#l13.16"></a><span id="l13.16">         createEventWithDialog();</span>
<a href="#l13.17"></a><span id="l13.17">     }</span>
<a href="#l13.18"></a><span id="l13.18"> }</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> /**</span>
<a href="#l13.21"></a><span id="l13.21">  * Handler function for selection in the unifinder.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -140,24 +140,24 @@ var calendarViewController = {</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">                 itemToDelete = targetItem;</span>
<a href="#l14.6"></a><span id="l14.6">             }</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8">             // Now some dirty work: Make sure more than one occurrence can be</span>
<a href="#l14.9"></a><span id="l14.9">             // deleted by saving the recurring items and removing occurrences as</span>
<a href="#l14.10"></a><span id="l14.10">             // they come in. If this is not an occurrence, we can go ahead and</span>
<a href="#l14.11"></a><span id="l14.11">             // delete the whole item.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            if (itemToDelete.parentItem.hashId != itemToDelete.hashId) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+            if (itemToDelete.parentItem.hashId == itemToDelete.hashId) {</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+                doTransaction(&quot;delete&quot;, itemToDelete, itemToDelete.calendar, null, null);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+            } else {</span>
<a href="#l14.16"></a><span id="l14.16">                 let savedItem = getSavedItem(itemToDelete);</span>
<a href="#l14.17"></a><span id="l14.17">                 savedItem.newItem.recurrenceInfo</span>
<a href="#l14.18"></a><span id="l14.18">                          .removeOccurrenceAt(itemToDelete.recurrenceId);</span>
<a href="#l14.19"></a><span id="l14.19">                 // Dont start the transaction yet. Do so later, in case the</span>
<a href="#l14.20"></a><span id="l14.20">                 // parent item gets modified more than once.</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-            } else {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-                doTransaction(&quot;delete&quot;, itemToDelete, itemToDelete.calendar, null, null);</span>
<a href="#l14.23"></a><span id="l14.23">             }</span>
<a href="#l14.24"></a><span id="l14.24">         }</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">         // Now handle recurring events. This makes sure that all occurrences</span>
<a href="#l14.27"></a><span id="l14.27">         // that have been passed are deleted.</span>
<a href="#l14.28"></a><span id="l14.28">         for (let hashVal in recurringItems) {</span>
<a href="#l14.29"></a><span id="l14.29">             let ritem = recurringItems[hashVal];</span>
<a href="#l14.30"></a><span id="l14.30">             doTransaction(&quot;modify&quot;,</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineat">@@ -309,17 +309,19 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l14.32"></a><span id="l14.32">     // workaround bug 291386.  If we don't, we stand a decent chance of getting</span>
<a href="#l14.33"></a><span id="l14.33">     // stuck in an infinite loop.</span>
<a href="#l14.34"></a><span id="l14.34">     let udCallback = {</span>
<a href="#l14.35"></a><span id="l14.35">         notify: function(timer) {</span>
<a href="#l14.36"></a><span id="l14.36">             aRefreshCallback();</span>
<a href="#l14.37"></a><span id="l14.37">         }</span>
<a href="#l14.38"></a><span id="l14.38">     };</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-    if (!gMidnightTimer) {</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+    if (gMidnightTimer) {</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+        gMidnightTimer.cancel();</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+    } else {</span>
<a href="#l14.44"></a><span id="l14.44">         // Observer for wake after sleep/hibernate/standby to create new timers and refresh UI</span>
<a href="#l14.45"></a><span id="l14.45">         let wakeObserver = {</span>
<a href="#l14.46"></a><span id="l14.46">            observe: function(aSubject, aTopic, aData) {</span>
<a href="#l14.47"></a><span id="l14.47">                if (aTopic == &quot;wake_notification&quot;) {</span>
<a href="#l14.48"></a><span id="l14.48">                    // postpone refresh for another couple of seconds to get netwerk ready:</span>
<a href="#l14.49"></a><span id="l14.49">                    if (this.mTimer) {</span>
<a href="#l14.50"></a><span id="l14.50">                        this.mTimer.cancel();</span>
<a href="#l14.51"></a><span id="l14.51">                    } else {</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineat">@@ -336,18 +338,16 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l14.53"></a><span id="l14.53">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l14.54"></a><span id="l14.54"> </span>
<a href="#l14.55"></a><span id="l14.55">         // Remove observer on unload</span>
<a href="#l14.56"></a><span id="l14.56">         window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l14.57"></a><span id="l14.57">             Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l14.58"></a><span id="l14.58">         }, false);</span>
<a href="#l14.59"></a><span id="l14.59">         gMidnightTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l14.60"></a><span id="l14.60">                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-    } else {</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-        gMidnightTimer.cancel();</span>
<a href="#l14.63"></a><span id="l14.63">     }</span>
<a href="#l14.64"></a><span id="l14.64">     gMidnightTimer.initWithCallback(udCallback, msUntilTomorrow, gMidnightTimer.TYPE_ONE_SHOT);</span>
<a href="#l14.65"></a><span id="l14.65"> }</span>
<a href="#l14.66"></a><span id="l14.66"> </span>
<a href="#l14.67"></a><span id="l14.67"> /**</span>
<a href="#l14.68"></a><span id="l14.68">  * Retuns a cached copy of the view stylesheet.</span>
<a href="#l14.69"></a><span id="l14.69">  *</span>
<a href="#l14.70"></a><span id="l14.70">  * @return      The view stylesheet object.</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineat">@@ -408,23 +408,23 @@ var categoryManagement = {</span>
<a href="#l14.72"></a><span id="l14.72">       categoryPrefBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l14.73"></a><span id="l14.73">       let categories = categoryPrefBranch.getChildList(&quot;&quot;);</span>
<a href="#l14.74"></a><span id="l14.74"> </span>
<a href="#l14.75"></a><span id="l14.75">       // Fix illegally formatted category prefs.</span>
<a href="#l14.76"></a><span id="l14.76">       for (let i in categories) {</span>
<a href="#l14.77"></a><span id="l14.77">           let category = categories[i];</span>
<a href="#l14.78"></a><span id="l14.78">           if (category.search(/[^_0-9a-z-]/) != -1) {</span>
<a href="#l14.79"></a><span id="l14.79">               let categoryFix = formatStringForCSSRule(category);</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-              if (!categoryPrefBranch.prefHasUserValue(categoryFix)) {</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+              if (categoryPrefBranch.prefHasUserValue(categoryFix)) {</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+                  categories.splice(i, 1); // remove illegal name</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+              } else {</span>
<a href="#l14.84"></a><span id="l14.84">                   let color = categoryPrefBranch.getCharPref(category);</span>
<a href="#l14.85"></a><span id="l14.85">                   categoryPrefBranch.setCharPref(categoryFix, color);</span>
<a href="#l14.86"></a><span id="l14.86">                   categoryPrefBranch.clearUserPref(category); // not usable</span>
<a href="#l14.87"></a><span id="l14.87">                   categories[i] = categoryFix;  // replace illegal name</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-              } else {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-                  categories.splice(i, 1); // remove illegal name</span>
<a href="#l14.90"></a><span id="l14.90">               }</span>
<a href="#l14.91"></a><span id="l14.91">           }</span>
<a href="#l14.92"></a><span id="l14.92">       }</span>
<a href="#l14.93"></a><span id="l14.93"> </span>
<a href="#l14.94"></a><span id="l14.94">       // Add color information to the stylesheets.</span>
<a href="#l14.95"></a><span id="l14.95">       categories.forEach(categoryManagement.updateStyleSheetForCategory,</span>
<a href="#l14.96"></a><span id="l14.96">                          categoryManagement);</span>
<a href="#l14.97"></a><span id="l14.97">       categoryPrefBranch.addObserver(&quot;&quot;, categoryManagement, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/calendar-views.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -34,22 +34,22 @@</span>
<a href="#l15.4"></a><span id="l15.4">                     aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l15.5"></a><span id="l15.5">                     this.setDateRange(aDate, aDate);</span>
<a href="#l15.6"></a><span id="l15.6">                     this.selectedDay = aDate;</span>
<a href="#l15.7"></a><span id="l15.7">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.8"></a><span id="l15.8">             &lt;/method&gt;</span>
<a href="#l15.9"></a><span id="l15.9">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l15.10"></a><span id="l15.10">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l15.11"></a><span id="l15.11">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-                    if (!aNumber) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                        this.goToDay(now());</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                    } else {</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+                    if (aNumber) {</span>
<a href="#l15.16"></a><span id="l15.16">                         let currentDay = this.startDay.clone();</span>
<a href="#l15.17"></a><span id="l15.17">                         currentDay.day += aNumber;</span>
<a href="#l15.18"></a><span id="l15.18">                         this.goToDay(currentDay);</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+                    } else {</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+                        this.goToDay(now());</span>
<a href="#l15.21"></a><span id="l15.21">                     }</span>
<a href="#l15.22"></a><span id="l15.22">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.23"></a><span id="l15.23">             &lt;/method&gt;</span>
<a href="#l15.24"></a><span id="l15.24">         &lt;/implementation&gt;</span>
<a href="#l15.25"></a><span id="l15.25">     &lt;/binding&gt;</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">     &lt;binding id=&quot;calendar-week-view&quot;</span>
<a href="#l15.28"></a><span id="l15.28">              extends=&quot;chrome://calendar/content/calendar-multiday-view.xml#calendar-multiday-view&quot;&gt;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineat">@@ -99,22 +99,22 @@</span>
<a href="#l15.30"></a><span id="l15.30">                     d2.day += 6;</span>
<a href="#l15.31"></a><span id="l15.31">                     this.setDateRange(d1, d2);</span>
<a href="#l15.32"></a><span id="l15.32">                     this.selectedDay = aDate;</span>
<a href="#l15.33"></a><span id="l15.33">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.34"></a><span id="l15.34">             &lt;/method&gt;</span>
<a href="#l15.35"></a><span id="l15.35">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l15.36"></a><span id="l15.36">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l15.37"></a><span id="l15.37">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-                    if (!aNumber) {</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-                        this.goToDay(now());</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-                    } else {</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+                    if (aNumber) {</span>
<a href="#l15.42"></a><span id="l15.42">                         let d1 = this.selectedDay.clone();</span>
<a href="#l15.43"></a><span id="l15.43">                         d1.day += 7 * aNumber;</span>
<a href="#l15.44"></a><span id="l15.44">                         this.goToDay(d1);</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+                    } else {</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+                        this.goToDay(now());</span>
<a href="#l15.47"></a><span id="l15.47">                     }</span>
<a href="#l15.48"></a><span id="l15.48">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.49"></a><span id="l15.49">             &lt;/method&gt;</span>
<a href="#l15.50"></a><span id="l15.50">         &lt;/implementation&gt;</span>
<a href="#l15.51"></a><span id="l15.51">     &lt;/binding&gt;</span>
<a href="#l15.52"></a><span id="l15.52"> </span>
<a href="#l15.53"></a><span id="l15.53">     &lt;binding id=&quot;calendar-multiweek-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l15.54"></a><span id="l15.54">         &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineat">@@ -195,29 +195,29 @@</span>
<a href="#l15.56"></a><span id="l15.56">                     } else {</span>
<a href="#l15.57"></a><span id="l15.57">                         this.refresh();</span>
<a href="#l15.58"></a><span id="l15.58">                     }</span>
<a href="#l15.59"></a><span id="l15.59">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.60"></a><span id="l15.60">             &lt;/method&gt;</span>
<a href="#l15.61"></a><span id="l15.61">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l15.62"></a><span id="l15.62">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l15.63"></a><span id="l15.63">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-                    if (!aNumber) {</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-                        let date = now();</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-                        this.selectedDay = date;</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-                    } else {</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+                    if (aNumber) {</span>
<a href="#l15.70"></a><span id="l15.70">                         let d1 = this.startDay.clone();</span>
<a href="#l15.71"></a><span id="l15.71">                         let savedSelectedDay = this.selectedDay.clone();</span>
<a href="#l15.72"></a><span id="l15.72">                         // aNumber only corresponds to the number of weeks to move</span>
<a href="#l15.73"></a><span id="l15.73">                         // make sure to compensate for previous weeks in view too</span>
<a href="#l15.74"></a><span id="l15.74">                         d1.day += 7 * (aNumber + Preferences.get(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l15.75"></a><span id="l15.75">                         this.goToDay(d1);</span>
<a href="#l15.76"></a><span id="l15.76">                         savedSelectedDay.day += 7 * aNumber;</span>
<a href="#l15.77"></a><span id="l15.77">                         this.selectedDay = savedSelectedDay;</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+                    } else {</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+                        let date = now();</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+                        this.goToDay(date);</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+                        this.selectedDay = date;</span>
<a href="#l15.82"></a><span id="l15.82">                     }</span>
<a href="#l15.83"></a><span id="l15.83">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.84"></a><span id="l15.84">             &lt;/method&gt;</span>
<a href="#l15.85"></a><span id="l15.85">         &lt;/implementation&gt;</span>
<a href="#l15.86"></a><span id="l15.86">     &lt;/binding&gt;</span>
<a href="#l15.87"></a><span id="l15.87"> </span>
<a href="#l15.88"></a><span id="l15.88">     &lt;binding id=&quot;calendar-month-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l15.89"></a><span id="l15.89">         &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineat">@@ -248,21 +248,17 @@</span>
<a href="#l15.91"></a><span id="l15.91">                  ]]&gt;&lt;/body&gt;</span>
<a href="#l15.92"></a><span id="l15.92">              &lt;/method&gt;</span>
<a href="#l15.93"></a><span id="l15.93">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l15.94"></a><span id="l15.94">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l15.95"></a><span id="l15.95">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.96"></a><span id="l15.96">                     let dates = this.getDateList({});</span>
<a href="#l15.97"></a><span id="l15.97">                     this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l15.98"></a><span id="l15.98"> </span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-                    if (!aNumber) {</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-                        let date = now();</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-                        this.selectedDay = date;</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-                    } else {</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+                    if (aNumber) {</span>
<a href="#l15.105"></a><span id="l15.105">                         // The first few dates in this list are likely in the month</span>
<a href="#l15.106"></a><span id="l15.106">                         // prior to the one actually being shown (since the month</span>
<a href="#l15.107"></a><span id="l15.107">                         // probably doesn't start on a Sunday).  The 7th item must</span>
<a href="#l15.108"></a><span id="l15.108">                         // be in correct month though.</span>
<a href="#l15.109"></a><span id="l15.109">                         let date = dates[6].clone();</span>
<a href="#l15.110"></a><span id="l15.110"> </span>
<a href="#l15.111"></a><span id="l15.111">                         date.month += aNumber;</span>
<a href="#l15.112"></a><span id="l15.112">                         // Need to store this before we move</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineat">@@ -276,14 +272,18 @@</span>
<a href="#l15.114"></a><span id="l15.114">                         newSelectedDay.month += aNumber;</span>
<a href="#l15.115"></a><span id="l15.115">                         // correct for accidental rollover into the next month</span>
<a href="#l15.116"></a><span id="l15.116">                         if ((newSelectedDay.month - aNumber + 12) % 12 != oldSelectedDay.month) {</span>
<a href="#l15.117"></a><span id="l15.117">                             newSelectedDay.month -= 1;</span>
<a href="#l15.118"></a><span id="l15.118">                             newSelectedDay.day = newSelectedDay.endOfMonth.day;</span>
<a href="#l15.119"></a><span id="l15.119">                         }</span>
<a href="#l15.120"></a><span id="l15.120"> </span>
<a href="#l15.121"></a><span id="l15.121">                         this.selectedDay = newSelectedDay;</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineplus">+                    } else {</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+                        let date = now();</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+                        this.goToDay(date);</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineplus">+                        this.selectedDay = date;</span>
<a href="#l15.126"></a><span id="l15.126">                     }</span>
<a href="#l15.127"></a><span id="l15.127">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l15.128"></a><span id="l15.128">             &lt;/method&gt;</span>
<a href="#l15.129"></a><span id="l15.129">         &lt;/implementation&gt;</span>
<a href="#l15.130"></a><span id="l15.130">     &lt;/binding&gt;</span>
<a href="#l15.131"></a><span id="l15.131"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -199,26 +199,26 @@ function updateReminderDetails() {</span>
<a href="#l16.4"></a><span id="l16.4">         // If there is only one reminder, display the reminder string</span>
<a href="#l16.5"></a><span id="l16.5">         if (reminders.length == 1) {</span>
<a href="#l16.6"></a><span id="l16.6">             setElementValue(reminderSingleLabel,</span>
<a href="#l16.7"></a><span id="l16.7">                             reminders[0].toString(window.calendarItem));</span>
<a href="#l16.8"></a><span id="l16.8">         }</span>
<a href="#l16.9"></a><span id="l16.9">     } else {</span>
<a href="#l16.10"></a><span id="l16.10">         hideElement(reminderMultipleLabel);</span>
<a href="#l16.11"></a><span id="l16.11">         hideElement(reminderSingleLabel);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        if (reminderList.value != &quot;none&quot;) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-            // This is one of the predefined dropdown items. We should show a single</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-            // icon in the icons box to tell the user what kind of alarm this will</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-            // be.</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+        if (reminderList.value == &quot;none&quot;) {</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+            // No reminder selected means show no icons.</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+            removeChildren(iconBox);</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+        } else {</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+            // This is one of the predefined dropdown items. We should show a</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+            // single icon in the icons box to tell the user what kind of alarm</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+            // this will be.</span>
<a href="#l16.23"></a><span id="l16.23">             let mockAlarm = cal.createAlarm();</span>
<a href="#l16.24"></a><span id="l16.24">             mockAlarm.action = getDefaultAlarmType();</span>
<a href="#l16.25"></a><span id="l16.25">             cal.alarms.addReminderImages(iconBox, [mockAlarm]);</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-        } else {</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-            // No reminder selected means show no icons.</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-            removeChildren(iconBox);</span>
<a href="#l16.29"></a><span id="l16.29">         }</span>
<a href="#l16.30"></a><span id="l16.30">     }</span>
<a href="#l16.31"></a><span id="l16.31"> }</span>
<a href="#l16.32"></a><span id="l16.32"> </span>
<a href="#l16.33"></a><span id="l16.33"> var gLastAlarmSelection = 0;</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35"> function matchCustomReminderToMenuitem(reminder) {</span>
<a href="#l16.36"></a><span id="l16.36">     let defaultAlarmType = getDefaultAlarmType();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -308,17 +308,17 @@ function updateTimezone() {</span>
<a href="#l17.4"></a><span id="l17.4">         let equalTimezones = false;</span>
<a href="#l17.5"></a><span id="l17.5">         if (startTimezone &amp;&amp; endTimezone &amp;&amp;</span>
<a href="#l17.6"></a><span id="l17.6">             (compareObjects(startTimezone, endTimezone) || endTimezone.isUTC)) {</span>
<a href="#l17.7"></a><span id="l17.7">             equalTimezones = true;</span>
<a href="#l17.8"></a><span id="l17.8">         }</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">         let tzStart = document.getElementById(&quot;timezone-starttime&quot;);</span>
<a href="#l17.11"></a><span id="l17.11">         let tzEnd = document.getElementById(&quot;timezone-endtime&quot;);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        if (startTimezone != null) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        if (startTimezone) {</span>
<a href="#l17.14"></a><span id="l17.14">             tzStart.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l17.15"></a><span id="l17.15">             tzStart.value = startTimezone.displayName || startTimezone.tzid;</span>
<a href="#l17.16"></a><span id="l17.16">         } else {</span>
<a href="#l17.17"></a><span id="l17.17">             tzStart.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">         }</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">         // we never display the second timezone if both are equal</span>
<a href="#l17.21"></a><span id="l17.21">         if (endTimezone != null &amp;&amp; !equalTimezones) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -119,31 +119,31 @@</span>
<a href="#l18.4"></a><span id="l18.4">           if (this.mIsReadOnly || this.mIsInvitation) {</span>
<a href="#l18.5"></a><span id="l18.5">               listbox.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l18.6"></a><span id="l18.6">           }</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">           // TODO: the organizer should show up in the attendee list, but this information</span>
<a href="#l18.9"></a><span id="l18.9">           // should be based on the organizer contained in the appropriate field of calIItemBase.</span>
<a href="#l18.10"></a><span id="l18.10">           // This is currently not supported, since we're still missing calendar identities.</span>
<a href="#l18.11"></a><span id="l18.11">           if (organizerID &amp;&amp; organizerID != &quot;&quot;) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-              if (!organizer) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                  organizer = this.createAttendee();</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-                  organizer.id = organizerID;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-                  organizer.role = &quot;CHAIR&quot;;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-                  organizer.participationStatus = &quot;ACCEPTED&quot;;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-              } else {</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+              if (organizer) {</span>
<a href="#l18.19"></a><span id="l18.19">                   if (!organizer.id) {</span>
<a href="#l18.20"></a><span id="l18.20">                       organizer.id = organizerID;</span>
<a href="#l18.21"></a><span id="l18.21">                   }</span>
<a href="#l18.22"></a><span id="l18.22">                   if (!organizer.role) {</span>
<a href="#l18.23"></a><span id="l18.23">                       organizer.role = &quot;CHAIR&quot;;</span>
<a href="#l18.24"></a><span id="l18.24">                   }</span>
<a href="#l18.25"></a><span id="l18.25">                   if (!organizer.participationStatus) {</span>
<a href="#l18.26"></a><span id="l18.26">                       organizer.participationStatus = &quot;ACCEPTED&quot;;</span>
<a href="#l18.27"></a><span id="l18.27">                   }</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+              } else {</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+                  organizer = this.createAttendee();</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+                  organizer.id = organizerID;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+                  organizer.role = &quot;CHAIR&quot;;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+                  organizer.participationStatus = &quot;ACCEPTED&quot;;</span>
<a href="#l18.33"></a><span id="l18.33">               }</span>
<a href="#l18.34"></a><span id="l18.34">               if (!organizer.commonName || !organizer.commonName.length) {</span>
<a href="#l18.35"></a><span id="l18.35">                   organizer.commonName = calendar.getProperty(&quot;organizerCN&quot;);</span>
<a href="#l18.36"></a><span id="l18.36">               }</span>
<a href="#l18.37"></a><span id="l18.37">               organizer.isOrganizer = true;</span>
<a href="#l18.38"></a><span id="l18.38">               this.appendAttendee(organizer, listbox, template, true);</span>
<a href="#l18.39"></a><span id="l18.39">           }</span>
<a href="#l18.40"></a><span id="l18.40"> </span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -1563,21 +1563,20 @@</span>
<a href="#l18.42"></a><span id="l18.42">                 this.mMouseX = mouseX;</span>
<a href="#l18.43"></a><span id="l18.43">                 this.update();</span>
<a href="#l18.44"></a><span id="l18.44">             }</span>
<a href="#l18.45"></a><span id="l18.45">         } else if (this.mDragState == 2) {</span>
<a href="#l18.46"></a><span id="l18.46">             // Move the startdate only...</span>
<a href="#l18.47"></a><span id="l18.47">             let delta = event.screenX - this.mSelectionbar.boxObject.screenX;</span>
<a href="#l18.48"></a><span id="l18.48">             let newStart = this.moveTime(this.mStartDate, delta, true);</span>
<a href="#l18.49"></a><span id="l18.49">             if (newStart.compare(this.mEndDate) &gt;= 0) {</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-                if (!this.mStartDate.isDate) {</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-                    newStart = this.mEndDate;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-                } else {</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+                if (this.mStartDate.isDate) {</span>
<a href="#l18.54"></a><span id="l18.54">                     return;</span>
<a href="#l18.55"></a><span id="l18.55">                 }</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+                newStart = this.mEndDate;</span>
<a href="#l18.57"></a><span id="l18.57">             }</span>
<a href="#l18.58"></a><span id="l18.58">             if (newStart.compare(this.mStartDate) != 0) {</span>
<a href="#l18.59"></a><span id="l18.59">                 this.startDate = newStart;</span>
<a href="#l18.60"></a><span id="l18.60">                 this.update();</span>
<a href="#l18.61"></a><span id="l18.61">             }</span>
<a href="#l18.62"></a><span id="l18.62">         } else if (this.mDragState == 3) {</span>
<a href="#l18.63"></a><span id="l18.63">             // Move the enddate only..</span>
<a href="#l18.64"></a><span id="l18.64">             let delta = mouseX - (this.mSelectionbar.boxObject.screenX +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -223,28 +223,28 @@ function initializeControls(rule) {</span>
<a href="#l19.4"></a><span id="l19.4">         if (rule.count == -1) {</span>
<a href="#l19.5"></a><span id="l19.5">             setElementValue(&quot;recurrence-duration&quot;, &quot;forever&quot;);</span>
<a href="#l19.6"></a><span id="l19.6">         } else {</span>
<a href="#l19.7"></a><span id="l19.7">             setElementValue(&quot;recurrence-duration&quot;, &quot;ntimes&quot;);</span>
<a href="#l19.8"></a><span id="l19.8">             setElementValue(&quot;repeat-ntimes-count&quot;, rule.count);</span>
<a href="#l19.9"></a><span id="l19.9">         }</span>
<a href="#l19.10"></a><span id="l19.10">     } else {</span>
<a href="#l19.11"></a><span id="l19.11">         let untilDate = rule.untilDate;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        if (!untilDate) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-            setElementValue(&quot;recurrence-duration&quot;, &quot;forever&quot;);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-        } else {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+        if (untilDate) {</span>
<a href="#l19.16"></a><span id="l19.16">             gUntilDate = untilDate.getInTimezone(gStartTime.timezone); // calIRecurrenceRule::untilDate is always UTC or floating</span>
<a href="#l19.17"></a><span id="l19.17">             // Change the until date to start date if the rule has a forbidden</span>
<a href="#l19.18"></a><span id="l19.18">             // value (earlier than the start date).</span>
<a href="#l19.19"></a><span id="l19.19">             if (gUntilDate.compare(gStartTime) &lt; 0) {</span>
<a href="#l19.20"></a><span id="l19.20">                 gUntilDate = gStartTime.clone();</span>
<a href="#l19.21"></a><span id="l19.21">             }</span>
<a href="#l19.22"></a><span id="l19.22">             let repeatDate = cal.dateTimeToJsDate(gUntilDate.getInTimezone(cal.floating()));</span>
<a href="#l19.23"></a><span id="l19.23">             setElementValue(&quot;recurrence-duration&quot;, &quot;until&quot;);</span>
<a href="#l19.24"></a><span id="l19.24">             setElementValue(&quot;repeat-until-date&quot;, repeatDate);</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+        } else {</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+            setElementValue(&quot;recurrence-duration&quot;, &quot;forever&quot;);</span>
<a href="#l19.27"></a><span id="l19.27">         }</span>
<a href="#l19.28"></a><span id="l19.28">     }</span>
<a href="#l19.29"></a><span id="l19.29"> }</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31"> /**</span>
<a href="#l19.32"></a><span id="l19.32">  * Save the recurrence information selected in the dialog back to the given</span>
<a href="#l19.33"></a><span id="l19.33">  * item.</span>
<a href="#l19.34"></a><span id="l19.34">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/import-export.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/import-export.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -322,28 +322,28 @@ function exportEntireCalendar(aCalendar)</span>
<a href="#l20.4"></a><span id="l20.4">         }</span>
<a href="#l20.5"></a><span id="l20.5">     };</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7">     let getItemsFromCal = function(aCal) {</span>
<a href="#l20.8"></a><span id="l20.8">         aCal.getItems(Components.interfaces.calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l20.9"></a><span id="l20.9">                       0, null, null, getListener);</span>
<a href="#l20.10"></a><span id="l20.10">     };</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    if (!aCalendar) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    if (aCalendar) {</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+        getItemsFromCal(aCalendar);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+    } else {</span>
<a href="#l20.16"></a><span id="l20.16">         let count = {};</span>
<a href="#l20.17"></a><span id="l20.17">         let calendars = getCalendarManager().getCalendars(count);</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19">         if (count.value == 1) {</span>
<a href="#l20.20"></a><span id="l20.20">             // There's only one calendar, so it's silly to ask what calendar</span>
<a href="#l20.21"></a><span id="l20.21">             // the user wants to import into.</span>
<a href="#l20.22"></a><span id="l20.22">             getItemsFromCal(calendars[0]);</span>
<a href="#l20.23"></a><span id="l20.23">         } else {</span>
<a href="#l20.24"></a><span id="l20.24">             // Ask what calendar to import into</span>
<a href="#l20.25"></a><span id="l20.25">             let args = {};</span>
<a href="#l20.26"></a><span id="l20.26">             args.onOk = getItemsFromCal;</span>
<a href="#l20.27"></a><span id="l20.27">             args.promptText = calGetString(&quot;calendar&quot;, &quot;exportPrompt&quot;);</span>
<a href="#l20.28"></a><span id="l20.28">             openDialog(&quot;chrome://calendar/content/chooseCalendarDialog.xul&quot;,</span>
<a href="#l20.29"></a><span id="l20.29">                        &quot;_blank&quot;, &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l20.30"></a><span id="l20.30">         }</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-    } else {</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-        getItemsFromCal(aCalendar);</span>
<a href="#l20.33"></a><span id="l20.33">     }</span>
<a href="#l20.34"></a><span id="l20.34"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -118,21 +118,17 @@</span>
<a href="#l21.4"></a><span id="l21.4"> </span>
<a href="#l21.5"></a><span id="l21.5">       &lt;method name=&quot;updateRelativeDateLabel&quot;&gt;</span>
<a href="#l21.6"></a><span id="l21.6">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.7"></a><span id="l21.7">           let formatter = cal.getDateFormatter();</span>
<a href="#l21.8"></a><span id="l21.8">           let item = this.mItem;</span>
<a href="#l21.9"></a><span id="l21.9">           let relativeDateLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-relative-date-label&quot;);</span>
<a href="#l21.10"></a><span id="l21.10">           let relativeDateString;</span>
<a href="#l21.11"></a><span id="l21.11">           let startDate = item[calGetStartDateProp(item)] || item[calGetEndDateProp(item)];</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-          if (!startDate) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-              // No start or end date, therefore the alarm must be absolute and</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-              // have an alarm date.</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-              relativeDateString = [formatter.formatDateTime(this.mAlarm.alarmDate)];</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-          } else {</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+          if (startDate) {</span>
<a href="#l21.18"></a><span id="l21.18">               startDate = startDate.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l21.19"></a><span id="l21.19">               let currentDate = now();</span>
<a href="#l21.20"></a><span id="l21.20">               let sinceDayStart = (currentDate.hour * 3600) + (currentDate.minute * 60);</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22">               currentDate.second = 0;</span>
<a href="#l21.23"></a><span id="l21.23">               startDate.second = 0;</span>
<a href="#l21.24"></a><span id="l21.24"> </span>
<a href="#l21.25"></a><span id="l21.25">               let sinceAlarm = currentDate.subtractDate(startDate).inSeconds;</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineat">@@ -152,16 +148,20 @@</span>
<a href="#l21.27"></a><span id="l21.27">                   // The alarm is yesterday</span>
<a href="#l21.28"></a><span id="l21.28">                   relativeDateString = calGetString(&quot;calendar&quot;,</span>
<a href="#l21.29"></a><span id="l21.29">                                                     &quot;alarmYesterdayAt&quot;,</span>
<a href="#l21.30"></a><span id="l21.30">                                                     [formatter.formatTime(startDate)]);</span>
<a href="#l21.31"></a><span id="l21.31">               } else {</span>
<a href="#l21.32"></a><span id="l21.32">                   // The alarm is way back</span>
<a href="#l21.33"></a><span id="l21.33">                   relativeDateString = [formatter.formatDateTime(startDate)];</span>
<a href="#l21.34"></a><span id="l21.34">               }</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+          } else {</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+              // No start or end date, therefore the alarm must be absolute and</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+              // have an alarm date.</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+              relativeDateString = [formatter.formatDateTime(this.mAlarm.alarmDate)];</span>
<a href="#l21.39"></a><span id="l21.39">           }</span>
<a href="#l21.40"></a><span id="l21.40"> </span>
<a href="#l21.41"></a><span id="l21.41">           relativeDateLabel.textContent = relativeDateString;</span>
<a href="#l21.42"></a><span id="l21.42">         ]]&gt;&lt;/body&gt;</span>
<a href="#l21.43"></a><span id="l21.43">       &lt;/method&gt;</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45">       &lt;method name=&quot;showDetails&quot;&gt;</span>
<a href="#l21.46"></a><span id="l21.46">         &lt;parameter name=&quot;event&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -856,20 +856,20 @@</span>
<a href="#l22.4"></a><span id="l22.4">                               date.getMonth() + &quot;-&quot; +</span>
<a href="#l22.5"></a><span id="l22.5">                               date.getDate();</span>
<a href="#l22.6"></a><span id="l22.6">                     this.mDayMap[ymd] = day;</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">                     if (!this.mIsReadOnly) {</span>
<a href="#l22.9"></a><span id="l22.9">                         day.setAttribute(&quot;interactive&quot;, &quot;true&quot;);</span>
<a href="#l22.10"></a><span id="l22.10">                     }</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-                    if (aDate.getMonth() != date.getMonth()) {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+                    if (aDate.getMonth() == date.getMonth()) {</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+                        day.removeAttribute(&quot;othermonth&quot;);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+                    } else {</span>
<a href="#l22.16"></a><span id="l22.16">                         day.setAttribute(&quot;othermonth&quot;, &quot;true&quot;);</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-                    } else {</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-                        day.removeAttribute(&quot;othermonth&quot;);</span>
<a href="#l22.19"></a><span id="l22.19">                     }</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21">                     // highlight today</span>
<a href="#l22.22"></a><span id="l22.22">                     if (this._sameDay(today, date)) {</span>
<a href="#l22.23"></a><span id="l22.23">                         this.mToday = day;</span>
<a href="#l22.24"></a><span id="l22.24">                         day.setAttribute(&quot;today&quot;, &quot;true&quot;);</span>
<a href="#l22.25"></a><span id="l22.25">                     }</span>
<a href="#l22.26"></a><span id="l22.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/modules/calAuthUtils.jsm</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/modules/calAuthUtils.jsm</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -313,20 +313,20 @@ cal.auth.Prompt.prototype = {</span>
<a href="#l23.4"></a><span id="l23.4">             let asyncprompter = Components.classes[&quot;@mozilla.org/messenger/msgAsyncPrompter;1&quot;]</span>
<a href="#l23.5"></a><span id="l23.5">                                           .getService(Components.interfaces.nsIMsgAsyncPrompter);</span>
<a href="#l23.6"></a><span id="l23.6">             asyncprompter.queueAsyncAuthPrompt(hostKey, false, promptlistener);</span>
<a href="#l23.7"></a><span id="l23.7">         }</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">         self.mWindow = cal.getCalendarWindow();</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">         // the prompt will fail if we are too early</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        if (self.mWindow.document.readyState != &quot;complete&quot;) {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        if (self.mWindow.document.readyState == &quot;complete&quot;) {</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+            queuePrompt();</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+        } else {</span>
<a href="#l23.16"></a><span id="l23.16">             self.mWindow.addEventListener(&quot;load&quot;, queuePrompt, true);</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-        } else {</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-            queuePrompt();</span>
<a href="#l23.19"></a><span id="l23.19">         }</span>
<a href="#l23.20"></a><span id="l23.20">     }</span>
<a href="#l23.21"></a><span id="l23.21"> };</span>
<a href="#l23.22"></a><span id="l23.22"> </span>
<a href="#l23.23"></a><span id="l23.23"> // Cache for authentication information since onAuthInformation in the prompt</span>
<a href="#l23.24"></a><span id="l23.24"> // listener is called without further information. If the password is not</span>
<a href="#l23.25"></a><span id="l23.25"> // saved, there is no way to retrieve it. We use ref counting to avoid keeping</span>
<a href="#l23.26"></a><span id="l23.26"> // the password in memory longer than needed.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/modules/calExtract.jsm</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/modules/calExtract.jsm</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -748,35 +748,29 @@ Extractor.prototype = {</span>
<a href="#l24.4"></a><span id="l24.4">             return 0;</span>
<a href="#l24.5"></a><span id="l24.5">         // sort dates before times</span>
<a href="#l24.6"></a><span id="l24.6">         } else if (one.year != null &amp;&amp; two.year == null) {</span>
<a href="#l24.7"></a><span id="l24.7">             return -1;</span>
<a href="#l24.8"></a><span id="l24.8">         } else if (one.year == null &amp;&amp; two.year != null) {</span>
<a href="#l24.9"></a><span id="l24.9">             return 1;</span>
<a href="#l24.10"></a><span id="l24.10">         } else if (one.year != null &amp;&amp; two.year != null) {</span>
<a href="#l24.11"></a><span id="l24.11">             rc = (one.year &gt; two.year) - (one.year &lt; two.year);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-            if (rc != 0) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-                return rc;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-            } else {</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+            if (rc == 0) {</span>
<a href="#l24.16"></a><span id="l24.16">                 rc = (one.month &gt; two.month) - (one.month &lt; two.month);</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-                if (rc != 0) {</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-                    return rc;</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-                } else {</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+                if (rc == 0) {</span>
<a href="#l24.21"></a><span id="l24.21">                     rc = (one.day &gt; two.day) - (one.day &lt; two.day);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-                    return rc;</span>
<a href="#l24.23"></a><span id="l24.23">                 }</span>
<a href="#l24.24"></a><span id="l24.24">             }</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+            return rc;</span>
<a href="#l24.26"></a><span id="l24.26">         } else {</span>
<a href="#l24.27"></a><span id="l24.27">             rc = (one.hour &gt; two.hour) - (one.hour &lt; two.hour);</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-            if (rc != 0) {</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-                return rc;</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-            } else {</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+            if (rc == 0) {</span>
<a href="#l24.32"></a><span id="l24.32">                 rc = (one.minute &gt; two.minute) - (one.minute &lt; two.minute);</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-                return rc;</span>
<a href="#l24.34"></a><span id="l24.34">             }</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+            return rc;</span>
<a href="#l24.36"></a><span id="l24.36">         }</span>
<a href="#l24.37"></a><span id="l24.37">     },</span>
<a href="#l24.38"></a><span id="l24.38"> </span>
<a href="#l24.39"></a><span id="l24.39">     /**</span>
<a href="#l24.40"></a><span id="l24.40">     * Guesses start time from list of guessed datetimes</span>
<a href="#l24.41"></a><span id="l24.41">     *</span>
<a href="#l24.42"></a><span id="l24.42">     * @param isTask    whether start time should be guessed for task or event</span>
<a href="#l24.43"></a><span id="l24.43">     * @return          datetime object for start time</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineat">@@ -933,17 +927,17 @@ Extractor.prototype = {</span>
<a href="#l24.45"></a><span id="l24.45"> </span>
<a href="#l24.46"></a><span id="l24.46">                 for (let val in durations) {</span>
<a href="#l24.47"></a><span id="l24.47">                     duration += durations[val].duration;</span>
<a href="#l24.48"></a><span id="l24.48">                     cal.LOG(&quot;[calExtract] Dur: &quot; + JSON.stringify(durations[val]));</span>
<a href="#l24.49"></a><span id="l24.49">                 }</span>
<a href="#l24.50"></a><span id="l24.50"> </span>
<a href="#l24.51"></a><span id="l24.51">                 if (duration != 0) {</span>
<a href="#l24.52"></a><span id="l24.52">                     let startDate = new Date(start.year, start.month - 1, start.day);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-                    if (start.hour != null) {</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+                    if (start.hour) {</span>
<a href="#l24.55"></a><span id="l24.55">                         startDate.setHours(start.hour);</span>
<a href="#l24.56"></a><span id="l24.56">                         startDate.setMinutes(start.minute);</span>
<a href="#l24.57"></a><span id="l24.57">                     } else {</span>
<a href="#l24.58"></a><span id="l24.58">                         startDate.setHours(0);</span>
<a href="#l24.59"></a><span id="l24.59">                         startDate.setMinutes(0);</span>
<a href="#l24.60"></a><span id="l24.60">                     }</span>
<a href="#l24.61"></a><span id="l24.61"> </span>
<a href="#l24.62"></a><span id="l24.62">                     let endTime = new Date(startDate.getTime() + duration * 60 * 1000);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -229,38 +229,17 @@ cal.getImipTransport = function(aCalenda</span>
<a href="#l25.4"></a><span id="l25.4">  *</span>
<a href="#l25.5"></a><span id="l25.5">  * @param aCalendar     Calendar instance</span>
<a href="#l25.6"></a><span id="l25.6">  * @param outAccount    Optional out value for account</span>
<a href="#l25.7"></a><span id="l25.7">  * @return              The configured identity</span>
<a href="#l25.8"></a><span id="l25.8">  */</span>
<a href="#l25.9"></a><span id="l25.9"> cal.getEmailIdentityOfCalendar = function(aCalendar, outAccount) {</span>
<a href="#l25.10"></a><span id="l25.10">     cal.ASSERT(aCalendar, &quot;no calendar!&quot;, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l25.11"></a><span id="l25.11">     let key = aCalendar.getProperty(&quot;imip.identity.key&quot;);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    if (key !== null) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-        if (key.length == 0) { // i.e. &quot;None&quot;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-            return null;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-        }</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-        let identity = null;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">-        cal.calIterateEmailIdentities((identity_, account) =&gt; {</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-            if (identity_.key == key) {</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-                identity = identity_;</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-                if (outAccount) {</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-                    outAccount.value = account;</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-                }</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-            }</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-            return (identity_.key != key);</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">-        });</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">-</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-        if (!identity) {</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-            // dangling identity:</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-            cal.WARN(&quot;Calendar &quot; + (aCalendar.uri ? aCalendar.uri.spec : aCalendar.id) +</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-                     &quot; has a dangling E-Mail identity configured.&quot;);</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-        }</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-        return identity;</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">-    } else { // take default account/identity:</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+    if (key === null) { // take default account/identity:</span>
<a href="#l25.35"></a><span id="l25.35">         let findIdentity = function(account) {</span>
<a href="#l25.36"></a><span id="l25.36">             if (account &amp;&amp; account.identities.length) {</span>
<a href="#l25.37"></a><span id="l25.37">                 return account.defaultIdentity ||</span>
<a href="#l25.38"></a><span id="l25.38">                        account.identities.queryElementAt(0, Components.interfaces.nsIMsgIdentity);</span>
<a href="#l25.39"></a><span id="l25.39">             }</span>
<a href="#l25.40"></a><span id="l25.40">             return null;</span>
<a href="#l25.41"></a><span id="l25.41">         };</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43" class="difflineat">@@ -285,16 +264,37 @@ cal.getEmailIdentityOfCalendar = functio</span>
<a href="#l25.44"></a><span id="l25.44">                 }</span>
<a href="#l25.45"></a><span id="l25.45">             }</span>
<a href="#l25.46"></a><span id="l25.46">         }</span>
<a href="#l25.47"></a><span id="l25.47"> </span>
<a href="#l25.48"></a><span id="l25.48">         if (outAccount) {</span>
<a href="#l25.49"></a><span id="l25.49">             outAccount.value = foundIdentity ? foundAccount : null;</span>
<a href="#l25.50"></a><span id="l25.50">         }</span>
<a href="#l25.51"></a><span id="l25.51">         return foundIdentity;</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineplus">+    } else {</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+        if (key.length == 0) { // i.e. &quot;None&quot;</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineplus">+            return null;</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineplus">+        }</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineplus">+        let identity = null;</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+        cal.calIterateEmailIdentities((identity_, account) =&gt; {</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+            if (identity_.key == key) {</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+                identity = identity_;</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineplus">+                if (outAccount) {</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineplus">+                    outAccount.value = account;</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineplus">+                }</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineplus">+            }</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineplus">+            return (identity_.key != key);</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineplus">+        });</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineplus">+</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineplus">+        if (!identity) {</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+            // dangling identity:</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+            cal.WARN(&quot;Calendar &quot; + (aCalendar.uri ? aCalendar.uri.spec : aCalendar.id) +</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+                     &quot; has a dangling E-Mail identity configured.&quot;);</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+        }</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+        return identity;</span>
<a href="#l25.73"></a><span id="l25.73">     }</span>
<a href="#l25.74"></a><span id="l25.74"> };</span>
<a href="#l25.75"></a><span id="l25.75"> </span>
<a href="#l25.76"></a><span id="l25.76"> </span>
<a href="#l25.77"></a><span id="l25.77"> /**</span>
<a href="#l25.78"></a><span id="l25.78">  * fromRFC3339</span>
<a href="#l25.79"></a><span id="l25.79">  * Convert a RFC3339 compliant Date string to a calIDateTime.</span>
<a href="#l25.80"></a><span id="l25.80">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -161,25 +161,25 @@ calAlarmService.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4">         let alarmTime = nowUTC();</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">         // Set the last acknowledged time to now.</span>
<a href="#l26.7"></a><span id="l26.7">         newEvent.alarmLastAck = alarmTime;</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">         alarmTime = alarmTime.clone();</span>
<a href="#l26.10"></a><span id="l26.10">         alarmTime.addDuration(aDuration);</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        if (aItem.parentItem != aItem) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+        if (aItem.parentItem == aItem) {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+            newEvent.setProperty(&quot;X-MOZ-SNOOZE-TIME&quot;, alarmTime.icalString);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+        } else {</span>
<a href="#l26.16"></a><span id="l26.16">             // This is the *really* hard case where we've snoozed a single</span>
<a href="#l26.17"></a><span id="l26.17">             // instance of a recurring event.  We need to not only know that</span>
<a href="#l26.18"></a><span id="l26.18">             // there was a snooze, but also which occurrence was snoozed.  Part</span>
<a href="#l26.19"></a><span id="l26.19">             // of me just wants to create a local db of snoozes here...</span>
<a href="#l26.20"></a><span id="l26.20">             newEvent.setProperty(&quot;X-MOZ-SNOOZE-TIME-&quot; + aItem.recurrenceId.nativeTime,</span>
<a href="#l26.21"></a><span id="l26.21">                                  alarmTime.icalString);</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-        } else {</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">-            newEvent.setProperty(&quot;X-MOZ-SNOOZE-TIME&quot;, alarmTime.icalString);</span>
<a href="#l26.24"></a><span id="l26.24">         }</span>
<a href="#l26.25"></a><span id="l26.25">         // calling modifyItem will cause us to get the right callback</span>
<a href="#l26.26"></a><span id="l26.26">         // and update the alarm properly</span>
<a href="#l26.27"></a><span id="l26.27">         return newEvent.calendar.modifyItem(newEvent, aItem.parentItem, null);</span>
<a href="#l26.28"></a><span id="l26.28">     },</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30">     dismissAlarm: function(aItem, aAlarm) {</span>
<a href="#l26.31"></a><span id="l26.31">         let now = nowUTC();</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineat">@@ -228,27 +228,27 @@ calAlarmService.prototype = {</span>
<a href="#l26.33"></a><span id="l26.33">         }</span>
<a href="#l26.34"></a><span id="l26.34"> </span>
<a href="#l26.35"></a><span id="l26.35">         /* set up a timer to update alarms every N hours */</span>
<a href="#l26.36"></a><span id="l26.36">         let timerCallback = {</span>
<a href="#l26.37"></a><span id="l26.37">             alarmService: this,</span>
<a href="#l26.38"></a><span id="l26.38">             notify: function() {</span>
<a href="#l26.39"></a><span id="l26.39">                 let now = nowUTC();</span>
<a href="#l26.40"></a><span id="l26.40">                 let start;</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-                if (!this.alarmService.mRangeEnd) {</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+                if (this.alarmService.mRangeEnd) {</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+                    // This is a subsequent search, so we got all the past alarms before</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+                    start = this.alarmService.mRangeEnd.clone();</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+                } else {</span>
<a href="#l26.46"></a><span id="l26.46">                     // This is our first search for alarms.  We're going to look for</span>
<a href="#l26.47"></a><span id="l26.47">                     // alarms +/- 1 month from now.  If someone sets an alarm more than</span>
<a href="#l26.48"></a><span id="l26.48">                     // a month ahead of an event, or doesn't start Lightning</span>
<a href="#l26.49"></a><span id="l26.49">                     // for a month, they'll miss some, but that's a slim chance</span>
<a href="#l26.50"></a><span id="l26.50">                     start = now.clone();</span>
<a href="#l26.51"></a><span id="l26.51">                     start.month -= Components.interfaces.calIAlarmService.MAX_SNOOZE_MONTHS;</span>
<a href="#l26.52"></a><span id="l26.52">                     this.alarmService.mRangeStart = start.clone();</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineminus">-                } else {</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineminus">-                    // This is a subsequent search, so we got all the past alarms before</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineminus">-                    start = this.alarmService.mRangeEnd.clone();</span>
<a href="#l26.56"></a><span id="l26.56">                 }</span>
<a href="#l26.57"></a><span id="l26.57">                 let until = now.clone();</span>
<a href="#l26.58"></a><span id="l26.58">                 until.month += Components.interfaces.calIAlarmService.MAX_SNOOZE_MONTHS;</span>
<a href="#l26.59"></a><span id="l26.59"> </span>
<a href="#l26.60"></a><span id="l26.60">                 // We don't set timers for every future alarm, only those within 6 hours</span>
<a href="#l26.61"></a><span id="l26.61">                 let end = now.clone();</span>
<a href="#l26.62"></a><span id="l26.62">                 end.hour += kHoursBetweenUpdates;</span>
<a href="#l26.63"></a><span id="l26.63">                 this.alarmService.mRangeEnd = end.getInTimezone(UTC());</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineat">@@ -329,20 +329,20 @@ calAlarmService.prototype = {</span>
<a href="#l26.65"></a><span id="l26.65">             if (alarmDate.isDate) {</span>
<a href="#l26.66"></a><span id="l26.66">                 alarmDate = alarmDate.getInTimezone(this.timezone);</span>
<a href="#l26.67"></a><span id="l26.67">                 alarmDate.isDate = false;</span>
<a href="#l26.68"></a><span id="l26.68">             }</span>
<a href="#l26.69"></a><span id="l26.69">             alarmDate = alarmDate.getInTimezone(UTC());</span>
<a href="#l26.70"></a><span id="l26.70"> </span>
<a href="#l26.71"></a><span id="l26.71">             // Check for snooze</span>
<a href="#l26.72"></a><span id="l26.72">             let snoozeDate;</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineminus">-            if (aItem.parentItem != aItem) {</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+            if (aItem.parentItem == aItem) {</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+                snoozeDate = aItem.getProperty(&quot;X-MOZ-SNOOZE-TIME&quot;);</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+            } else {</span>
<a href="#l26.77"></a><span id="l26.77">                 snoozeDate = aItem.parentItem.getProperty(&quot;X-MOZ-SNOOZE-TIME-&quot; + aItem.recurrenceId.nativeTime);</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineminus">-            } else {</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineminus">-                snoozeDate = aItem.getProperty(&quot;X-MOZ-SNOOZE-TIME&quot;);</span>
<a href="#l26.80"></a><span id="l26.80">             }</span>
<a href="#l26.81"></a><span id="l26.81"> </span>
<a href="#l26.82"></a><span id="l26.82">             if (snoozeDate &amp;&amp; !(snoozeDate instanceof Components.interfaces.calIDateTime)) {</span>
<a href="#l26.83"></a><span id="l26.83">                 snoozeDate = cal.createDateTime(snoozeDate);</span>
<a href="#l26.84"></a><span id="l26.84">             }</span>
<a href="#l26.85"></a><span id="l26.85"> </span>
<a href="#l26.86"></a><span id="l26.86">             // an alarm can only be snoozed to a later time, if earlier it's from another alarm.</span>
<a href="#l26.87"></a><span id="l26.87">             if (snoozeDate &amp;&amp; snoozeDate.compare(alarmDate) &gt; 0) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/calAttendee.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/calAttendee.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -91,20 +91,20 @@ calAttendee.prototype = {</span>
<a href="#l27.4"></a><span id="l27.4">                 this.setProperty(name, value);</span>
<a href="#l27.5"></a><span id="l27.5">             }</span>
<a href="#l27.6"></a><span id="l27.6">         }</span>
<a href="#l27.7"></a><span id="l27.7">     },</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9">     get icalProperty() {</span>
<a href="#l27.10"></a><span id="l27.10">         let icssvc = cal.getIcsService();</span>
<a href="#l27.11"></a><span id="l27.11">         let icalatt;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-        if (!this.mIsOrganizer) {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+        if (this.mIsOrganizer) {</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+            icalatt = icssvc.createIcalProperty(&quot;ORGANIZER&quot;);</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+        } else {</span>
<a href="#l27.16"></a><span id="l27.16">             icalatt = icssvc.createIcalProperty(&quot;ATTENDEE&quot;);</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-        } else {</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineminus">-            icalatt = icssvc.createIcalProperty(&quot;ORGANIZER&quot;);</span>
<a href="#l27.19"></a><span id="l27.19">         }</span>
<a href="#l27.20"></a><span id="l27.20"> </span>
<a href="#l27.21"></a><span id="l27.21">         if (!this.id) {</span>
<a href="#l27.22"></a><span id="l27.22">             throw Components.results.NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l27.23"></a><span id="l27.23">         }</span>
<a href="#l27.24"></a><span id="l27.24">         icalatt.valueAsIcalString = this.id;</span>
<a href="#l27.25"></a><span id="l27.25">         for (let i = 0; i &lt; this.icalAttendeePropMap.length; i++) {</span>
<a href="#l27.26"></a><span id="l27.26">             let prop = this.icalAttendeePropMap[i];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -331,25 +331,25 @@ calCalendarManager.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5">                 this.migrateDB(db);</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7">                 db.executeSimpleSQL(&quot;DROP TABLE cal_calendars; &quot; +</span>
<a href="#l28.8"></a><span id="l28.8">                                     &quot;DROP TABLE cal_calendars_prefs; &quot; +</span>
<a href="#l28.9"></a><span id="l28.9">                                     &quot;DROP TABLE cal_calmgr_schema_version;&quot;);</span>
<a href="#l28.10"></a><span id="l28.10">             }</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-            if (!db.tableExists(&quot;cal_calendars&quot;)) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+            if (db.tableExists(&quot;cal_calendars&quot;)) {</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+                db.rollbackTransaction();</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+            } else {</span>
<a href="#l28.16"></a><span id="l28.16">                 // create dummy cal_calendars, so previous versions (pre 1.0pre) run into the schema check:</span>
<a href="#l28.17"></a><span id="l28.17">                 db.createTable(&quot;cal_calendars&quot;, &quot;id INTEGER&quot;);</span>
<a href="#l28.18"></a><span id="l28.18">                 // let schema checks always fail, we cannot take the shared cal_calendar_schema_version:</span>
<a href="#l28.19"></a><span id="l28.19">                 db.createTable(&quot;cal_calmgr_schema_version&quot;, &quot;version INTEGER&quot;);</span>
<a href="#l28.20"></a><span id="l28.20">                 db.executeSimpleSQL(&quot;INSERT INTO cal_calmgr_schema_version VALUES(&quot; + (DB_SCHEMA_VERSION + 1) + &quot;)&quot;);</span>
<a href="#l28.21"></a><span id="l28.21">                 db.commitTransaction();</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">-            } else {</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">-                db.rollbackTransaction();</span>
<a href="#l28.24"></a><span id="l28.24">             }</span>
<a href="#l28.25"></a><span id="l28.25">         } catch (exc) {</span>
<a href="#l28.26"></a><span id="l28.26">             db.rollbackTransaction();</span>
<a href="#l28.27"></a><span id="l28.27">             throw exc;</span>
<a href="#l28.28"></a><span id="l28.28">         } finally {</span>
<a href="#l28.29"></a><span id="l28.29">             db.close();</span>
<a href="#l28.30"></a><span id="l28.30">         }</span>
<a href="#l28.31"></a><span id="l28.31">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -200,23 +200,23 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4">                 let startDay = this.formatDayWithOrdinal(aStartDate.day);</span>
<a href="#l29.5"></a><span id="l29.5">                 let startYear = aStartDate.year;</span>
<a href="#l29.6"></a><span id="l29.6">                 let endDay = this.formatDayWithOrdinal(endDate.day);</span>
<a href="#l29.7"></a><span id="l29.7">                 let endYear = endDate.year;</span>
<a href="#l29.8"></a><span id="l29.8">                 if (aStartDate.year != endDate.year) {</span>
<a href="#l29.9"></a><span id="l29.9">                     let startMonthName = cal.formatMonth(aStartDate.month + 1, &quot;calendar&quot;, &quot;daysIntervalBetweenYears&quot;);</span>
<a href="#l29.10"></a><span id="l29.10">                     let endMonthName = cal.formatMonth(aEndDate.month + 1, &quot;calendar&quot;, &quot;daysIntervalBetweenYears&quot;);</span>
<a href="#l29.11"></a><span id="l29.11">                     return cal.calGetString(&quot;calendar&quot;, &quot;daysIntervalBetweenYears&quot;, [startMonthName, startDay, startYear, endMonthName, endDay, endYear]);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-                } else if (aStartDate.month != endDate.month) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+                } else if (aStartDate.month == endDate.month) {</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+                    let startMonthName = cal.formatMonth(aStartDate.month + 1, &quot;calendar&quot;, &quot;daysIntervalInMonth&quot;);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+                    return cal.calGetString(&quot;calendar&quot;, &quot;daysIntervalInMonth&quot;, [startMonthName, startDay, endDay, endYear]);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+                } else {</span>
<a href="#l29.17"></a><span id="l29.17">                     let startMonthName = cal.formatMonth(aStartDate.month + 1, &quot;calendar&quot;, &quot;daysIntervalBetweenMonths&quot;);</span>
<a href="#l29.18"></a><span id="l29.18">                     let endMonthName = cal.formatMonth(aEndDate.month + 1, &quot;calendar&quot;, &quot;daysIntervalBetweenMonths&quot;);</span>
<a href="#l29.19"></a><span id="l29.19">                     return cal.calGetString(&quot;calendar&quot;, &quot;daysIntervalBetweenMonths&quot;, [startMonthName, startDay, endMonthName, endDay, endYear]);</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineminus">-                } else {</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">-                    let startMonthName = cal.formatMonth(aStartDate.month + 1, &quot;calendar&quot;, &quot;daysIntervalInMonth&quot;);</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">-                    return cal.calGetString(&quot;calendar&quot;, &quot;daysIntervalInMonth&quot;, [startMonthName, startDay, endDay, endYear]);</span>
<a href="#l29.23"></a><span id="l29.23">                 }</span>
<a href="#l29.24"></a><span id="l29.24">             }</span>
<a href="#l29.25"></a><span id="l29.25">         } else {</span>
<a href="#l29.26"></a><span id="l29.26">             let startDateString = this.formatDate(aStartDate);</span>
<a href="#l29.27"></a><span id="l29.27">             let startTime = this.formatTime(aStartDate);</span>
<a href="#l29.28"></a><span id="l29.28">             let endDateString = this.formatDate(endDate);</span>
<a href="#l29.29"></a><span id="l29.29">             let endTime = this.formatTime(endDate);</span>
<a href="#l29.30"></a><span id="l29.30">             // non-allday, so need to return date and time</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -678,21 +678,21 @@ calFilter.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">             this.mFilterProperties = aFilter;</span>
<a href="#l30.5"></a><span id="l30.5">         } else if (typeof aFilter == &quot;function&quot;) {</span>
<a href="#l30.6"></a><span id="l30.6">             this.mFilterProperties = new calFilterProperties();</span>
<a href="#l30.7"></a><span id="l30.7">             this.mFilterProperties.onfilter = aFilter;</span>
<a href="#l30.8"></a><span id="l30.8">         } else {</span>
<a href="#l30.9"></a><span id="l30.9">             this.mFilterProperties = new calFilterProperties();</span>
<a href="#l30.10"></a><span id="l30.10">         }</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        if (!this.mFilterProperties) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-            cal.WARN(&quot;[calFilter] Unable to apply filter &quot; + aFilter);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-        } else {</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+        if (this.mFilterProperties) {</span>
<a href="#l30.16"></a><span id="l30.16">             this.updateFilterDates();</span>
<a href="#l30.17"></a><span id="l30.17">             // this.mFilterProperties.LOG(&quot;Applying filter:&quot;);</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+        } else {</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+            cal.WARN(&quot;[calFilter] Unable to apply filter &quot; + aFilter);</span>
<a href="#l30.20"></a><span id="l30.20">         }</span>
<a href="#l30.21"></a><span id="l30.21">     },</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23">     /**</span>
<a href="#l30.24"></a><span id="l30.24">      * Calculates the current start and end dates for the currently applied filter, and updates</span>
<a href="#l30.25"></a><span id="l30.25">      * the current filter start and end dates. This function can be used to update the date range</span>
<a href="#l30.26"></a><span id="l30.26">      * for date range filters that are relative to the selected date or current date and time.</span>
<a href="#l30.27"></a><span id="l30.27">      *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/src/calIcsParser.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/src/calIcsParser.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -279,23 +279,23 @@ parserState.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4">                         break;</span>
<a href="#l31.5"></a><span id="l31.5">                     default:</span>
<a href="#l31.6"></a><span id="l31.6">                         self.extraComponents.push(subComp);</span>
<a href="#l31.7"></a><span id="l31.7">                         break;</span>
<a href="#l31.8"></a><span id="l31.8">                 }</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10">                 if (item) {</span>
<a href="#l31.11"></a><span id="l31.11">                     let rid = item.recurrenceId;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-                    if (!rid) {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+                    if (rid) {</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+                        self.excItems.push(item);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+                    } else {</span>
<a href="#l31.16"></a><span id="l31.16">                         self.items.push(item);</span>
<a href="#l31.17"></a><span id="l31.17">                         if (item.recurrenceInfo) {</span>
<a href="#l31.18"></a><span id="l31.18">                             self.uid2parent[item.id] = item;</span>
<a href="#l31.19"></a><span id="l31.19">                         }</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">-                    } else {</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">-                        self.excItems.push(item);</span>
<a href="#l31.22"></a><span id="l31.22">                     }</span>
<a href="#l31.23"></a><span id="l31.23">                 }</span>
<a href="#l31.24"></a><span id="l31.24">                 self.threadCount--;</span>
<a href="#l31.25"></a><span id="l31.25">                 self.checkCompletion();</span>
<a href="#l31.26"></a><span id="l31.26">             }</span>
<a href="#l31.27"></a><span id="l31.27">         };</span>
<a href="#l31.28"></a><span id="l31.28"> </span>
<a href="#l31.29"></a><span id="l31.29">         this.threadCount++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -461,20 +461,20 @@ calItemBase.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">     // void setPropertyParameter(in AString aPropertyName,</span>
<a href="#l32.5"></a><span id="l32.5">     //                           in AString aParameterName,</span>
<a href="#l32.6"></a><span id="l32.6">     //                           in AUTF8String aParameterValue);</span>
<a href="#l32.7"></a><span id="l32.7">     setPropertyParameter: function(aPropName, aParamName, aParamValue) {</span>
<a href="#l32.8"></a><span id="l32.8">         let propName = aPropName.toUpperCase();</span>
<a href="#l32.9"></a><span id="l32.9">         let paramName = aParamName.toUpperCase();</span>
<a href="#l32.10"></a><span id="l32.10">         this.modify();</span>
<a href="#l32.11"></a><span id="l32.11">         if (!(propName in this.mPropertyParams)) {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-            if (!this.hasProperty(propName)) {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+            if (this.hasProperty(propName)) {</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+                this.mPropertyParams[propName] = {};</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+            } else {</span>
<a href="#l32.16"></a><span id="l32.16">                 throw &quot;Property &quot; + aPropName + &quot; not set&quot;;</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineminus">-            } else {</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineminus">-                this.mPropertyParams[propName] = {};</span>
<a href="#l32.19"></a><span id="l32.19">             }</span>
<a href="#l32.20"></a><span id="l32.20">         }</span>
<a href="#l32.21"></a><span id="l32.21">         if (aParamValue || !isNaN(parseInt(aParamValue, 10))) {</span>
<a href="#l32.22"></a><span id="l32.22">             this.mPropertyParams[propName][paramName] = aParamValue;</span>
<a href="#l32.23"></a><span id="l32.23">         } else {</span>
<a href="#l32.24"></a><span id="l32.24">             delete this.mPropertyParams[propName][paramName];</span>
<a href="#l32.25"></a><span id="l32.25">         }</span>
<a href="#l32.26"></a><span id="l32.26">         return aParamValue;</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineat">@@ -536,20 +536,20 @@ calItemBase.prototype = {</span>
<a href="#l32.28"></a><span id="l32.28">     // void removeAttendee(in calIAttendee attendee);</span>
<a href="#l32.29"></a><span id="l32.29">     removeAttendee: function(attendee) {</span>
<a href="#l32.30"></a><span id="l32.30">         this.modify();</span>
<a href="#l32.31"></a><span id="l32.31">         let found = false, newAttendees = [];</span>
<a href="#l32.32"></a><span id="l32.32">         let attendees = this.getAttendees({});</span>
<a href="#l32.33"></a><span id="l32.33">         let attIdLowerCase = attendee.id.toLowerCase();</span>
<a href="#l32.34"></a><span id="l32.34"> </span>
<a href="#l32.35"></a><span id="l32.35">         for (let i = 0; i &lt; attendees.length; i++) {</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-            if (attendees[i].id.toLowerCase() != attIdLowerCase) {</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+            if (attendees[i].id.toLowerCase() == attIdLowerCase) {</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+                found = true;</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+            } else {</span>
<a href="#l32.40"></a><span id="l32.40">                 newAttendees.push(attendees[i]);</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineminus">-            } else {</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineminus">-                found = true;</span>
<a href="#l32.43"></a><span id="l32.43">             }</span>
<a href="#l32.44"></a><span id="l32.44">         }</span>
<a href="#l32.45"></a><span id="l32.45">         if (found) {</span>
<a href="#l32.46"></a><span id="l32.46">             this.mAttendees = newAttendees;</span>
<a href="#l32.47"></a><span id="l32.47">         }</span>
<a href="#l32.48"></a><span id="l32.48">     },</span>
<a href="#l32.49"></a><span id="l32.49"> </span>
<a href="#l32.50"></a><span id="l32.50">     // void removeAllAttendees();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -791,17 +791,17 @@ function guessSystemTimezone() {</span>
<a href="#l33.4"></a><span id="l33.4">                     (standardStart &lt; daylightStart</span>
<a href="#l33.5"></a><span id="l33.5">                       ? standardText + daylightText</span>
<a href="#l33.6"></a><span id="l33.6">                       : daylightText + standardText) +</span>
<a href="#l33.7"></a><span id="l33.7">                      calProperties.GetStringFromName(&quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;);</span>
<a href="#l33.8"></a><span id="l33.8">             } else {</span>
<a href="#l33.9"></a><span id="l33.9">                 warningDetail = calProperties.GetStringFromName(&quot;TZSeemsToMatchOS&quot;);</span>
<a href="#l33.10"></a><span id="l33.10">             }</span>
<a href="#l33.11"></a><span id="l33.11">             let offsetString = standardTZOffset +</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-                                 (!daylightTZOffset ? &quot;&quot; : &quot;/&quot; + daylightTZOffset);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+                                 (daylightTZOffset ? &quot;/&quot; + daylightTZOffset : &quot;&quot;);</span>
<a href="#l33.14"></a><span id="l33.14">             let warningMsg = calProperties.formatStringFromName(&quot;WarningUsingGuessedTZ&quot;,</span>
<a href="#l33.15"></a><span id="l33.15">                               [tzId, offsetString, warningDetail, probableTZSource], 4);</span>
<a href="#l33.16"></a><span id="l33.16">             cal.WARN(warningMsg);</span>
<a href="#l33.17"></a><span id="l33.17">             break;</span>
<a href="#l33.18"></a><span id="l33.18">         }</span>
<a href="#l33.19"></a><span id="l33.19">     } catch (ex) { // don't abort if error occurs warning user</span>
<a href="#l33.20"></a><span id="l33.20">         Components.utils.reportError(ex);</span>
<a href="#l33.21"></a><span id="l33.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/src/calTransactionManager.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/src/calTransactionManager.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -145,33 +145,33 @@ calTransaction.prototype = {</span>
<a href="#l34.4"></a><span id="l34.4"> </span>
<a href="#l34.5"></a><span id="l34.5">     doTransaction: function() {</span>
<a href="#l34.6"></a><span id="l34.6">         this.mIsDoTransaction = true;</span>
<a href="#l34.7"></a><span id="l34.7">         switch (this.mAction) {</span>
<a href="#l34.8"></a><span id="l34.8">             case &quot;add&quot;:</span>
<a href="#l34.9"></a><span id="l34.9">                 this.mCalendar.addItem(this.mItem, this);</span>
<a href="#l34.10"></a><span id="l34.10">                 break;</span>
<a href="#l34.11"></a><span id="l34.11">             case &quot;modify&quot;:</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-                if (this.mItem.calendar.id != this.mOldItem.calendar.id) {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+                if (this.mItem.calendar.id == this.mOldItem.calendar.id) {</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+                    this.mCalendar.modifyItem(cal.itip.prepareSequence(this.mItem, this.mOldItem),</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+                                              this.mOldItem,</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+                                              this);</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+                } else {</span>
<a href="#l34.18"></a><span id="l34.18">                     let self = this;</span>
<a href="#l34.19"></a><span id="l34.19">                     let addListener = {</span>
<a href="#l34.20"></a><span id="l34.20">                         onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l34.21"></a><span id="l34.21">                             self.onOperationComplete(...arguments);</span>
<a href="#l34.22"></a><span id="l34.22">                             if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l34.23"></a><span id="l34.23">                                 self.mOldItem.calendar.deleteItem(self.mOldItem, self);</span>
<a href="#l34.24"></a><span id="l34.24">                             }</span>
<a href="#l34.25"></a><span id="l34.25">                         }</span>
<a href="#l34.26"></a><span id="l34.26">                     };</span>
<a href="#l34.27"></a><span id="l34.27"> </span>
<a href="#l34.28"></a><span id="l34.28">                     this.mOldCalendar = this.mOldItem.calendar;</span>
<a href="#l34.29"></a><span id="l34.29">                     this.mCalendar.addItem(this.mItem, addListener);</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-                } else {</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-                    this.mCalendar.modifyItem(cal.itip.prepareSequence(this.mItem, this.mOldItem),</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineminus">-                                              this.mOldItem,</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineminus">-                                              this);</span>
<a href="#l34.34"></a><span id="l34.34">                 }</span>
<a href="#l34.35"></a><span id="l34.35">                 break;</span>
<a href="#l34.36"></a><span id="l34.36">             case &quot;delete&quot;:</span>
<a href="#l34.37"></a><span id="l34.37">                 this.mCalendar.deleteItem(this.mItem, this);</span>
<a href="#l34.38"></a><span id="l34.38">                 break;</span>
<a href="#l34.39"></a><span id="l34.39">             default:</span>
<a href="#l34.40"></a><span id="l34.40">                 throw new Components.Exception(&quot;Invalid action specified&quot;,</span>
<a href="#l34.41"></a><span id="l34.41">                                                Components.results.NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineat">@@ -180,22 +180,22 @@ calTransaction.prototype = {</span>
<a href="#l34.43"></a><span id="l34.43"> </span>
<a href="#l34.44"></a><span id="l34.44">     undoTransaction: function() {</span>
<a href="#l34.45"></a><span id="l34.45">         this.mIsDoTransaction = false;</span>
<a href="#l34.46"></a><span id="l34.46">         switch (this.mAction) {</span>
<a href="#l34.47"></a><span id="l34.47">             case &quot;add&quot;:</span>
<a href="#l34.48"></a><span id="l34.48">                 this.mCalendar.deleteItem(this.mItem, this);</span>
<a href="#l34.49"></a><span id="l34.49">                 break;</span>
<a href="#l34.50"></a><span id="l34.50">             case &quot;modify&quot;:</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-                if (this.mOldItem.calendar.id != this.mItem.calendar.id) {</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineplus">+                if (this.mOldItem.calendar.id == this.mItem.calendar.id) {</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+                    this.mCalendar.modifyItem(cal.itip.prepareSequence(this.mOldItem, this.mItem),</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineplus">+                                              this.mItem, this);</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineplus">+                } else {</span>
<a href="#l34.56"></a><span id="l34.56">                     this.mCalendar.deleteItem(this.mItem, this);</span>
<a href="#l34.57"></a><span id="l34.57">                     this.mOldCalendar.addItem(this.mOldItem, this);</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineminus">-                } else {</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineminus">-                    this.mCalendar.modifyItem(cal.itip.prepareSequence(this.mOldItem, this.mItem),</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineminus">-                                              this.mItem, this);</span>
<a href="#l34.61"></a><span id="l34.61">                 }</span>
<a href="#l34.62"></a><span id="l34.62">                 break;</span>
<a href="#l34.63"></a><span id="l34.63">             case &quot;delete&quot;:</span>
<a href="#l34.64"></a><span id="l34.64">                 this.mCalendar.addItem(this.mItem, this);</span>
<a href="#l34.65"></a><span id="l34.65">                 break;</span>
<a href="#l34.66"></a><span id="l34.66">             default:</span>
<a href="#l34.67"></a><span id="l34.67">                 throw new Components.Exception(&quot;Invalid action specified&quot;,</span>
<a href="#l34.68"></a><span id="l34.68">                                                Components.results.NS_ERROR_ILLEGAL_VALUE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -174,23 +174,23 @@ function getRecentTimezones(aConvertZone</span>
<a href="#l35.4"></a><span id="l35.4">         recentTimezones = [];</span>
<a href="#l35.5"></a><span id="l35.5">     }</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7">     let tzService = cal.getTimezoneService();</span>
<a href="#l35.8"></a><span id="l35.8">     if (aConvertZones) {</span>
<a href="#l35.9"></a><span id="l35.9">         let oldZonesLength = recentTimezones.length;</span>
<a href="#l35.10"></a><span id="l35.10">         for (let i = 0; i &lt; recentTimezones.length; i++) {</span>
<a href="#l35.11"></a><span id="l35.11">             let tz = tzService.getTimezone(recentTimezones[i]);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-            if (!tz) {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+            if (tz) {</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+                // Replace id with found timezone</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+                recentTimezones[i] = tz;</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+            } else {</span>
<a href="#l35.17"></a><span id="l35.17">                 // Looks like the timezone doesn't longer exist, remove it</span>
<a href="#l35.18"></a><span id="l35.18">                 recentTimezones.splice(i, 1);</span>
<a href="#l35.19"></a><span id="l35.19">                 i--;</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">-            } else {</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineminus">-                // Replace id with found timezone</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">-                recentTimezones[i] = tz;</span>
<a href="#l35.23"></a><span id="l35.23">             }</span>
<a href="#l35.24"></a><span id="l35.24">         }</span>
<a href="#l35.25"></a><span id="l35.25"> </span>
<a href="#l35.26"></a><span id="l35.26">         if (oldZonesLength != recentTimezones.length) {</span>
<a href="#l35.27"></a><span id="l35.27">             // Looks like the one or other timezone dropped out. Go ahead and</span>
<a href="#l35.28"></a><span id="l35.28">             // modify the pref.</span>
<a href="#l35.29"></a><span id="l35.29">             Preferences.set(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l35.30"></a><span id="l35.30">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -70,29 +70,29 @@ calItipEmailTransport.prototype = {</span>
<a href="#l36.4"></a><span id="l36.4">         let subject = &quot;&quot;;</span>
<a href="#l36.5"></a><span id="l36.5">         let body = &quot;&quot;;</span>
<a href="#l36.6"></a><span id="l36.6">         switch (aItipItem.responseMethod) {</span>
<a href="#l36.7"></a><span id="l36.7">             case &quot;REQUEST&quot;:</span>
<a href="#l36.8"></a><span id="l36.8">                 let usePrefixes = Preferences.get(</span>
<a href="#l36.9"></a><span id="l36.9">                     &quot;calendar.itip.useInvitationSubjectPrefixes&quot;,</span>
<a href="#l36.10"></a><span id="l36.10">                     true</span>
<a href="#l36.11"></a><span id="l36.11">                 );</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-                if (!usePrefixes) {</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-                    subject = summary;</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-                } else {</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+                if (usePrefixes) {</span>
<a href="#l36.16"></a><span id="l36.16">                     let seq = item.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l36.17"></a><span id="l36.17">                     let subjectKey = seq &amp;&amp; seq &gt; 0</span>
<a href="#l36.18"></a><span id="l36.18">                         ? &quot;itipRequestUpdatedSubject&quot;</span>
<a href="#l36.19"></a><span id="l36.19">                         : &quot;itipRequestSubject&quot;;</span>
<a href="#l36.20"></a><span id="l36.20">                     subject = cal.calGetString(</span>
<a href="#l36.21"></a><span id="l36.21">                         &quot;lightning&quot;,</span>
<a href="#l36.22"></a><span id="l36.22">                         subjectKey,</span>
<a href="#l36.23"></a><span id="l36.23">                         [summary],</span>
<a href="#l36.24"></a><span id="l36.24">                         &quot;lightning&quot;</span>
<a href="#l36.25"></a><span id="l36.25">                     );</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineplus">+                } else {</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineplus">+                    subject = summary;</span>
<a href="#l36.28"></a><span id="l36.28">                 }</span>
<a href="#l36.29"></a><span id="l36.29">                 body = cal.calGetString(</span>
<a href="#l36.30"></a><span id="l36.30">                     &quot;lightning&quot;,</span>
<a href="#l36.31"></a><span id="l36.31">                     &quot;itipRequestBody&quot;,</span>
<a href="#l36.32"></a><span id="l36.32">                     [item.organizer ? item.organizer.toString() : &quot;&quot;, summary],</span>
<a href="#l36.33"></a><span id="l36.33">                     &quot;lightning&quot;</span>
<a href="#l36.34"></a><span id="l36.34">                 );</span>
<a href="#l36.35"></a><span id="l36.35">                 break;</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineat">@@ -268,19 +268,18 @@ calItipEmailTransport.prototype = {</span>
<a href="#l36.37"></a><span id="l36.37">                 let messageId = composeUtils.msgGenerateMessageId(identity);</span>
<a href="#l36.38"></a><span id="l36.38">                 let mailFile = this._createTempImipFile(compatMode, toList, aSubject, aBody, aItem, identity, messageId);</span>
<a href="#l36.39"></a><span id="l36.39">                 if (mailFile) {</span>
<a href="#l36.40"></a><span id="l36.40">                     // compose fields for message: from/to etc need to be specified both here and in the file</span>
<a href="#l36.41"></a><span id="l36.41">                     let composeFields = Components.classes[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l36.42"></a><span id="l36.42">                                                   .createInstance(Components.interfaces.nsIMsgCompFields);</span>
<a href="#l36.43"></a><span id="l36.43">                     composeFields.characterSet = &quot;UTF-8&quot;;</span>
<a href="#l36.44"></a><span id="l36.44">                     composeFields.to = toList;</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-                    let mailfrom = (!identity.fullName.length) ? identity.email : identity.fullName + &quot; &lt;&quot; + identity.email + &quot;&gt;&quot;;</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-                    composeFields.from = (cal.validateRecipientList(mailfrom) == mailfrom)</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-                                         ? mailfrom : identity.email;</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+                    let mailfrom = (identity.fullName.length ? identity.fullName + &quot; &lt;&quot; + identity.email + &quot;&gt;&quot; : identity.email);</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineplus">+                    composeFields.from = (cal.validateRecipientList(mailfrom) == mailfrom ? mailfrom : identity.email);</span>
<a href="#l36.50"></a><span id="l36.50">                     composeFields.replyTo = identity.replyTo;</span>
<a href="#l36.51"></a><span id="l36.51">                     composeFields.organization = identity.organization;</span>
<a href="#l36.52"></a><span id="l36.52">                     composeFields.messageId = messageId;</span>
<a href="#l36.53"></a><span id="l36.53">                     let validRecipients;</span>
<a href="#l36.54"></a><span id="l36.54">                     if (identity.doCc) {</span>
<a href="#l36.55"></a><span id="l36.55">                         validRecipients = cal.validateRecipientList(identity.doCcList);</span>
<a href="#l36.56"></a><span id="l36.56">                         if (validRecipients != &quot;&quot;) {</span>
<a href="#l36.57"></a><span id="l36.57">                             composeFields.cc = validRecipients;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/lightning/content/html-item-editing/react-code.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/lightning/content/html-item-editing/react-code.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -363,24 +363,24 @@ var TopComponent = React.createClass({</span>
<a href="#l37.4"></a><span id="l37.4">             { id: &quot;repeatDiv&quot;, className: &quot;box&quot; },</span>
<a href="#l37.5"></a><span id="l37.5">             &quot;Repeat &quot;,</span>
<a href="#l37.6"></a><span id="l37.6">             React.createElement(Dropdown, {</span>
<a href="#l37.7"></a><span id="l37.7">                 keyprop: &quot;repeat&quot;,</span>
<a href="#l37.8"></a><span id="l37.8">                 value: this.state.repeat,</span>
<a href="#l37.9"></a><span id="l37.9">                 options: this.props.repeatList,</span>
<a href="#l37.10"></a><span id="l37.10">                 onInput: this.handleSimpleChange</span>
<a href="#l37.11"></a><span id="l37.11">             }),</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-            (this.state.repeat != &quot;none&quot; ? &quot; Until &quot; : null),</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-            (this.state.repeat!= &quot;none&quot; ?</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-                React.createElement(TextField, {</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+            (this.state.repeat == &quot;none&quot; ? null : &quot; Until &quot;),</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+            (this.state.repeat == &quot;none&quot;</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+                ? null</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineplus">+                : React.createElement(TextField, {</span>
<a href="#l37.19"></a><span id="l37.19">                     keyprop: &quot;repeatUntilDate&quot;,</span>
<a href="#l37.20"></a><span id="l37.20">                     value: this.state.repeatUntilDate,</span>
<a href="#l37.21"></a><span id="l37.21">                     onInput: this.handleSimpleChange</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">-                })</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">-                : null)</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+                }))</span>
<a href="#l37.25"></a><span id="l37.25">         );</span>
<a href="#l37.26"></a><span id="l37.26">         let calendarDiv = React.DOM.div(</span>
<a href="#l37.27"></a><span id="l37.27">             { id: &quot;calendarDiv&quot;, className: &quot;box&quot; },</span>
<a href="#l37.28"></a><span id="l37.28">             &quot;Calendar &quot;,</span>
<a href="#l37.29"></a><span id="l37.29">             React.createElement(Dropdown, {</span>
<a href="#l37.30"></a><span id="l37.30">                 keyprop: &quot;calendarId&quot;,</span>
<a href="#l37.31"></a><span id="l37.31">                 value: this.state.calendarId,</span>
<a href="#l37.32"></a><span id="l37.32">                 options: this.props.calendarList,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1422,17 +1422,17 @@ function saveDialog(item) {</span>
<a href="#l38.4"></a><span id="l38.4">         } else {</span>
<a href="#l38.5"></a><span id="l38.5">             item.deleteProperty(&quot;STATUS&quot;);</span>
<a href="#l38.6"></a><span id="l38.6">         }</span>
<a href="#l38.7"></a><span id="l38.7">     } else {</span>
<a href="#l38.8"></a><span id="l38.8">         let status = getElementValue(&quot;todo-status&quot;);</span>
<a href="#l38.9"></a><span id="l38.9">         if (status != &quot;COMPLETED&quot;) {</span>
<a href="#l38.10"></a><span id="l38.10">             item.completedDate = null;</span>
<a href="#l38.11"></a><span id="l38.11">         }</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-        setItemProperty(item, &quot;STATUS&quot;, (status != &quot;NONE&quot;) ? status : null);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+        setItemProperty(item, &quot;STATUS&quot;, status == &quot;NONE&quot; ? null : status);</span>
<a href="#l38.14"></a><span id="l38.14">     }</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16">     // set the &quot;PRIORITY&quot; property if a valid priority has been</span>
<a href="#l38.17"></a><span id="l38.17">     // specified (any integer value except *null*) OR the item</span>
<a href="#l38.18"></a><span id="l38.18">     // already specifies a priority. in any other case we don't</span>
<a href="#l38.19"></a><span id="l38.19">     // need this property and can safely delete it. we need this special</span>
<a href="#l38.20"></a><span id="l38.20">     // handling since the WCAP provider always includes the priority</span>
<a href="#l38.21"></a><span id="l38.21">     // with value *null* and we don't detect changes to this item if</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -2073,17 +2073,17 @@ function lastDirectory(aFileUri) {</span>
<a href="#l38.23"></a><span id="l38.23">     if (aFileUri) {</span>
<a href="#l38.24"></a><span id="l38.24">         // Act similar to a setter, save the passed uri.</span>
<a href="#l38.25"></a><span id="l38.25">         let uri = makeURL(aFileUri);</span>
<a href="#l38.26"></a><span id="l38.26">         let file = uri.QueryInterface(Components.interfaces.nsIFileURL).file;</span>
<a href="#l38.27"></a><span id="l38.27">         lastDirectory.mValue = file.parent.QueryInterface(Components.interfaces.nsILocalFile);</span>
<a href="#l38.28"></a><span id="l38.28">     }</span>
<a href="#l38.29"></a><span id="l38.29"> </span>
<a href="#l38.30"></a><span id="l38.30">     // In any case, return the value</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-    return (lastDirectory.mValue !== undefined ? lastDirectory.mValue : null);</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+    return (lastDirectory.mValue === undefined ? null : lastDirectory.mValue);</span>
<a href="#l38.33"></a><span id="l38.33"> }</span>
<a href="#l38.34"></a><span id="l38.34"> </span>
<a href="#l38.35"></a><span id="l38.35"> /**</span>
<a href="#l38.36"></a><span id="l38.36">  * Turns an url into a string that can be used in UI.</span>
<a href="#l38.37"></a><span id="l38.37">  * - For a file:// url, shows the filename.</span>
<a href="#l38.38"></a><span id="l38.38">  * - For a http:// url, removes protocol and trailing slash</span>
<a href="#l38.39"></a><span id="l38.39">  *</span>
<a href="#l38.40"></a><span id="l38.40">  * @param aUri    The uri to parse.</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineat">@@ -2660,18 +2660,18 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l38.42"></a><span id="l38.42">             let rule = rrules[0][0];</span>
<a href="#l38.43"></a><span id="l38.43"> </span>
<a href="#l38.44"></a><span id="l38.44">             // If the previous rule was &quot;custom&quot; we have to recover the until</span>
<a href="#l38.45"></a><span id="l38.45">             // date, or the last occurrence's date in order to set the</span>
<a href="#l38.46"></a><span id="l38.46">             // repeat-until-datepicker with the same date.</span>
<a href="#l38.47"></a><span id="l38.47">             if (aItemRepeatCall &amp;&amp; repeatDeck.selectedIndex == 1) {</span>
<a href="#l38.48"></a><span id="l38.48">                 if (!rule.isByCount || !rule.isFinite) {</span>
<a href="#l38.49"></a><span id="l38.49">                     setElementValue(&quot;repeat-until-datepicker&quot;,</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-                                    !rule.isByCount ? cal.dateTimeToJsDate(rule.untilDate.getInTimezone(cal.floating()))</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-                                                    : &quot;forever&quot;);</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineplus">+                                    rule.isByCount ? &quot;forever&quot;</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+                                                   : cal.dateTimeToJsDate(rule.untilDate.getInTimezone(cal.floating())));</span>
<a href="#l38.54"></a><span id="l38.54">                 } else {</span>
<a href="#l38.55"></a><span id="l38.55">                     // Try to recover the last occurrence in 10(?) years.</span>
<a href="#l38.56"></a><span id="l38.56">                     let endDate = gStartTime.clone();</span>
<a href="#l38.57"></a><span id="l38.57">                     endDate.year += 10;</span>
<a href="#l38.58"></a><span id="l38.58">                     let lastOccurrenceDate = null;</span>
<a href="#l38.59"></a><span id="l38.59">                     let dates = recurrenceInfo.getOccurrenceDates(gStartTime, endDate, 0, {});</span>
<a href="#l38.60"></a><span id="l38.60">                     if (dates) {</span>
<a href="#l38.61"></a><span id="l38.61">                         lastOccurrenceDate = dates[dates.length - 1];</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineat">@@ -3527,20 +3527,17 @@ function updateItemURL(aShow, aUrl) {</span>
<a href="#l38.63"></a><span id="l38.63"> </span>
<a href="#l38.64"></a><span id="l38.64"> /**</span>
<a href="#l38.65"></a><span id="l38.65">  * This function updates dialog controls related to attendees.</span>
<a href="#l38.66"></a><span id="l38.66">  */</span>
<a href="#l38.67"></a><span id="l38.67"> function updateAttendees() {</span>
<a href="#l38.68"></a><span id="l38.68">     // sending email invitations currently only supported for events</span>
<a href="#l38.69"></a><span id="l38.69">     let attendeeTab = document.getElementById(&quot;event-grid-tab-attendees&quot;);</span>
<a href="#l38.70"></a><span id="l38.70">     let attendeePanel = document.getElementById(&quot;event-grid-tabpanel-attendees&quot;);</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineminus">-    if (!isEvent(window.calendarItem)) {</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineminus">-        attendeeTab.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-        attendeePanel.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineminus">-    } else {</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineplus">+    if (isEvent(window.calendarItem)) {</span>
<a href="#l38.76"></a><span id="l38.76">         attendeeTab.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l38.77"></a><span id="l38.77">         attendeePanel.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l38.78"></a><span id="l38.78"> </span>
<a href="#l38.79"></a><span id="l38.79">         if (window.organizer &amp;&amp; window.organizer.id) {</span>
<a href="#l38.80"></a><span id="l38.80">             document.getElementById(&quot;item-organizer-row&quot;).removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l38.81"></a><span id="l38.81">             let cell = document.querySelector(&quot;.item-organizer-cell&quot;);</span>
<a href="#l38.82"></a><span id="l38.82">             let icon = cell.querySelector(&quot;img:nth-of-type(1)&quot;);</span>
<a href="#l38.83"></a><span id="l38.83">             let text = cell.querySelector(&quot;label:nth-of-type(1)&quot;);</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineat">@@ -3564,16 +3561,19 @@ function updateAttendees() {</span>
<a href="#l38.85"></a><span id="l38.85">             cell.setAttribute(&quot;tooltiptext&quot;, tt);</span>
<a href="#l38.86"></a><span id="l38.86">             icon.setAttribute(&quot;partstat&quot;, ps);</span>
<a href="#l38.87"></a><span id="l38.87">             icon.setAttribute(&quot;usertype&quot;, ut);</span>
<a href="#l38.88"></a><span id="l38.88">             icon.setAttribute(&quot;role&quot;, role);</span>
<a href="#l38.89"></a><span id="l38.89">         } else {</span>
<a href="#l38.90"></a><span id="l38.90">             setBooleanAttribute(&quot;item-organizer-row&quot;, &quot;collapsed&quot;, true);</span>
<a href="#l38.91"></a><span id="l38.91">         }</span>
<a href="#l38.92"></a><span id="l38.92">         setupAttendees();</span>
<a href="#l38.93"></a><span id="l38.93" class="difflineplus">+    } else {</span>
<a href="#l38.94"></a><span id="l38.94" class="difflineplus">+        attendeeTab.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l38.95"></a><span id="l38.95" class="difflineplus">+        attendeePanel.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l38.96"></a><span id="l38.96">     }</span>
<a href="#l38.97"></a><span id="l38.97"> }</span>
<a href="#l38.98"></a><span id="l38.98"> </span>
<a href="#l38.99"></a><span id="l38.99"> /**</span>
<a href="#l38.100"></a><span id="l38.100">  * This function updates dialog controls related to recurrence, in this case the</span>
<a href="#l38.101"></a><span id="l38.101">  * text describing the recurrence rule.</span>
<a href="#l38.102"></a><span id="l38.102">  */</span>
<a href="#l38.103"></a><span id="l38.103"> function updateRepeatDetails() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -522,20 +522,20 @@ function updatePrivacy(aArg) {</span>
<a href="#l39.4"></a><span id="l39.4">                 } else {</span>
<a href="#l39.5"></a><span id="l39.5">                     node.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l39.6"></a><span id="l39.6">                     hasAnyPrivacyValue = true;</span>
<a href="#l39.7"></a><span id="l39.7">                 }</span>
<a href="#l39.8"></a><span id="l39.8">             }</span>
<a href="#l39.9"></a><span id="l39.9">         }</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11">         // Don't show the status panel if no valid privacy value is selected</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-        if (!hasAnyPrivacyValue) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+        if (hasAnyPrivacyValue) {</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineplus">+            privacyPanel.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineplus">+        } else {</span>
<a href="#l39.16"></a><span id="l39.16">             privacyPanel.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineminus">-        } else {</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineminus">-            privacyPanel.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l39.19"></a><span id="l39.19">         }</span>
<a href="#l39.20"></a><span id="l39.20">     } else {</span>
<a href="#l39.21"></a><span id="l39.21">         // aArg.hasPrivacy is false</span>
<a href="#l39.22"></a><span id="l39.22">         setElementValue(&quot;button-privacy&quot;, &quot;true&quot;, &quot;disabled&quot;);</span>
<a href="#l39.23"></a><span id="l39.23">         setElementValue(&quot;status-privacy&quot;, &quot;true&quot;, &quot;collapsed&quot;);</span>
<a href="#l39.24"></a><span id="l39.24">         // in the tab case the menu item does not exist</span>
<a href="#l39.25"></a><span id="l39.25">         let privacyMenuItem = document.getElementById(&quot;options-privacy-menu&quot;);</span>
<a href="#l39.26"></a><span id="l39.26">         if (privacyMenuItem) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -401,19 +401,19 @@ ltn.invitation = {</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5">     /**</span>
<a href="#l40.6"></a><span id="l40.6">      * Returns the header section for an invitation email.</span>
<a href="#l40.7"></a><span id="l40.7">      * @param   {String}         aMessageId  the message id to use for that email</span>
<a href="#l40.8"></a><span id="l40.8">      * @param   {nsIMsgIdentity} aIdentity   the identity to use for that email</span>
<a href="#l40.9"></a><span id="l40.9">      * @returns {String}                     the source code of the header section of the email</span>
<a href="#l40.10"></a><span id="l40.10">      */</span>
<a href="#l40.11"></a><span id="l40.11">     getHeaderSection: function(aMessageId, aIdentity, aToList, aSubject) {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-        let from = !aIdentity.fullName.length ? aIdentity.email</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-                                              : cal.validateRecipientList(aIdentity.fullName +</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-                                                                          &quot; &lt;&quot; + aIdentity.email + &quot;&gt;&quot;);</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+        let recipient = aIdentity.fullName + &quot; &lt;&quot; + aIdentity.email + &quot;&gt;&quot;;</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+        let from = aIdentity.fullName.length ? cal.validateRecipientList(recipient)</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+                                             : aIdentity.email;</span>
<a href="#l40.18"></a><span id="l40.18">         let header = &quot;MIME-version: 1.0\r\n&quot; +</span>
<a href="#l40.19"></a><span id="l40.19">                      (aIdentity.replyTo ? &quot;Return-path: &quot; +</span>
<a href="#l40.20"></a><span id="l40.20">                                           ltn.invitation.encodeMimeHeader(aIdentity.replyTo, true) +</span>
<a href="#l40.21"></a><span id="l40.21">                                           &quot;\r\n&quot; : &quot;&quot;) +</span>
<a href="#l40.22"></a><span id="l40.22">                      &quot;From: &quot; + ltn.invitation.encodeMimeHeader(from, true) + &quot;\r\n&quot; +</span>
<a href="#l40.23"></a><span id="l40.23">                      (aIdentity.organization ? &quot;Organization: &quot; +</span>
<a href="#l40.24"></a><span id="l40.24">                                                ltn.invitation.encodeMimeHeader(aIdentity.organization) +</span>
<a href="#l40.25"></a><span id="l40.25">                                                &quot;\r\n&quot; : &quot;&quot;) +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -225,22 +225,22 @@ calDavCalendar.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">             if (properties[property] !== undefined) {</span>
<a href="#l41.5"></a><span id="l41.5">                 this[property] = properties[property];</span>
<a href="#l41.6"></a><span id="l41.6">             }</span>
<a href="#l41.7"></a><span id="l41.7">         }</span>
<a href="#l41.8"></a><span id="l41.8">     },</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10">     // in calIGenericOperationListener aListener</span>
<a href="#l41.11"></a><span id="l41.11">     replayChangesOn: function(aChangeLogListener) {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-        if (!this.checkedServerInfo) {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+        if (this.checkedServerInfo) {</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+            this.safeRefresh(aChangeLogListener);</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+        } else {</span>
<a href="#l41.16"></a><span id="l41.16">             // If we haven't refreshed yet, then we should check the resource</span>
<a href="#l41.17"></a><span id="l41.17">             // type first. This will call refresh() again afterwards.</span>
<a href="#l41.18"></a><span id="l41.18">             this.setupAuthentication(aChangeLogListener);</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineminus">-        } else {</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineminus">-            this.safeRefresh(aChangeLogListener);</span>
<a href="#l41.21"></a><span id="l41.21">         }</span>
<a href="#l41.22"></a><span id="l41.22">     },</span>
<a href="#l41.23"></a><span id="l41.23">     setMetaData: function(id, path, etag, isInboxItem) {</span>
<a href="#l41.24"></a><span id="l41.24">         if (this.mOfflineStorage.setMetaData) {</span>
<a href="#l41.25"></a><span id="l41.25">             if (id) {</span>
<a href="#l41.26"></a><span id="l41.26">                 let dataString = [etag, path, isInboxItem ? &quot;true&quot; : &quot;false&quot;].join(&quot;\u001A&quot;);</span>
<a href="#l41.27"></a><span id="l41.27">                 this.mOfflineStorage.setMetaData(id, dataString);</span>
<a href="#l41.28"></a><span id="l41.28">             } else {</span>
<a href="#l41.29"></a><span id="l41.29" class="difflineat">@@ -1292,20 +1292,20 @@ calDavCalendar.prototype = {</span>
<a href="#l41.30"></a><span id="l41.30">                 this.mOfflineStorage.getItems(...arguments);</span>
<a href="#l41.31"></a><span id="l41.31">             } else {</span>
<a href="#l41.32"></a><span id="l41.32">                 this.notifyOperationComplete(aListener,</span>
<a href="#l41.33"></a><span id="l41.33">                                              Components.results.NS_OK,</span>
<a href="#l41.34"></a><span id="l41.34">                                              cIOL.GET,</span>
<a href="#l41.35"></a><span id="l41.35">                                              null,</span>
<a href="#l41.36"></a><span id="l41.36">                                              null);</span>
<a href="#l41.37"></a><span id="l41.37">             }</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineminus">-        } else if (!this.checkedServerInfo) {</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineplus">+        } else if (this.checkedServerInfo) {</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineplus">+            this.mOfflineStorage.getItems(...arguments);</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineplus">+        } else {</span>
<a href="#l41.42"></a><span id="l41.42">             this.mQueuedQueries.push(Array.from(arguments));</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineminus">-        } else {</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineminus">-            this.mOfflineStorage.getItems(...arguments);</span>
<a href="#l41.45"></a><span id="l41.45">         }</span>
<a href="#l41.46"></a><span id="l41.46">     },</span>
<a href="#l41.47"></a><span id="l41.47"> </span>
<a href="#l41.48"></a><span id="l41.48">     fillACLProperties: function() {</span>
<a href="#l41.49"></a><span id="l41.49">         let orgId = this.calendarUserAddress;</span>
<a href="#l41.50"></a><span id="l41.50">         if (orgId) {</span>
<a href="#l41.51"></a><span id="l41.51">             this.mACLProperties.organizerId = orgId;</span>
<a href="#l41.52"></a><span id="l41.52">         }</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineat">@@ -1622,20 +1622,20 @@ calDavCalendar.prototype = {</span>
<a href="#l41.54"></a><span id="l41.54">                                 }</span>
<a href="#l41.55"></a><span id="l41.55">                             }</span>
<a href="#l41.56"></a><span id="l41.56">                             this.mRefreshToken = pass.value;</span>
<a href="#l41.57"></a><span id="l41.57">                         }</span>
<a href="#l41.58"></a><span id="l41.58">                         return this.mRefreshToken;</span>
<a href="#l41.59"></a><span id="l41.59">                     },</span>
<a href="#l41.60"></a><span id="l41.60">                     set: function(val) {</span>
<a href="#l41.61"></a><span id="l41.61">                         try {</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineminus">-                            if (!val) {</span>
<a href="#l41.63"></a><span id="l41.63" class="difflineplus">+                            if (val) {</span>
<a href="#l41.64"></a><span id="l41.64" class="difflineplus">+                                cal.auth.passwordManagerSave(sessionId, val, sessionId, pwMgrId);</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineplus">+                            } else {</span>
<a href="#l41.66"></a><span id="l41.66">                                 cal.auth.passwordManagerRemove(sessionId, sessionId, pwMgrId);</span>
<a href="#l41.67"></a><span id="l41.67" class="difflineminus">-                            } else {</span>
<a href="#l41.68"></a><span id="l41.68" class="difflineminus">-                                cal.auth.passwordManagerSave(sessionId, val, sessionId, pwMgrId);</span>
<a href="#l41.69"></a><span id="l41.69">                             }</span>
<a href="#l41.70"></a><span id="l41.70">                         } catch (e) {</span>
<a href="#l41.71"></a><span id="l41.71">                             // User might have cancelled the master password prompt, thats ok</span>
<a href="#l41.72"></a><span id="l41.72">                             if (e.result != Components.results.NS_ERROR_ABORT) {</span>
<a href="#l41.73"></a><span id="l41.73">                                 throw e;</span>
<a href="#l41.74"></a><span id="l41.74">                             }</span>
<a href="#l41.75"></a><span id="l41.75">                         }</span>
<a href="#l41.76"></a><span id="l41.76">                         return (this.mRefreshToken = val);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -130,40 +130,40 @@ etagsHandler.prototype = {</span>
<a href="#l42.4"></a><span id="l42.4">         } finally {</span>
<a href="#l42.5"></a><span id="l42.5">             if (this.calendar.isCached) {</span>
<a href="#l42.6"></a><span id="l42.6">                 this.calendar.superCalendar.endBatch();</span>
<a href="#l42.7"></a><span id="l42.7">             }</span>
<a href="#l42.8"></a><span id="l42.8">         }</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10">         // Avoid sending empty multiget requests update views if something has</span>
<a href="#l42.11"></a><span id="l42.11">         // been deleted server-side.</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-        if (!this.itemsNeedFetching.length) {</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+        if (this.itemsNeedFetching.length) {</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+            let multiget = new multigetSyncHandler(this.itemsNeedFetching,</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+                                       this.calendar,</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+                                       this.baseUri,</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+                                       null,</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+                                       false,</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+                                       null,</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineplus">+                                       this.changeLogListener);</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineplus">+            multiget.doMultiGet();</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineplus">+        } else {</span>
<a href="#l42.23"></a><span id="l42.23">             if (this.calendar.isCached &amp;&amp; this.changeLogListener) {</span>
<a href="#l42.24"></a><span id="l42.24">                 this.changeLogListener.onResult({ status: Components.results.NS_OK },</span>
<a href="#l42.25"></a><span id="l42.25">                                                 Components.results.NS_OK);</span>
<a href="#l42.26"></a><span id="l42.26">             }</span>
<a href="#l42.27"></a><span id="l42.27"> </span>
<a href="#l42.28"></a><span id="l42.28">             if (needsRefresh) {</span>
<a href="#l42.29"></a><span id="l42.29">                 this.calendar.mObservers.notify(&quot;onLoad&quot;, [this.calendar]);</span>
<a href="#l42.30"></a><span id="l42.30">             }</span>
<a href="#l42.31"></a><span id="l42.31"> </span>
<a href="#l42.32"></a><span id="l42.32">             // but do poll the inbox</span>
<a href="#l42.33"></a><span id="l42.33">             if (this.calendar.mShouldPollInbox &amp;&amp;</span>
<a href="#l42.34"></a><span id="l42.34">                 !this.calendar.isInbox(this.baseUri.spec)) {</span>
<a href="#l42.35"></a><span id="l42.35">                 this.calendar.pollInbox();</span>
<a href="#l42.36"></a><span id="l42.36">             }</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineminus">-        } else {</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineminus">-            let multiget = new multigetSyncHandler(this.itemsNeedFetching,</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineminus">-                                       this.calendar,</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineminus">-                                       this.baseUri,</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineminus">-                                       null,</span>
<a href="#l42.42"></a><span id="l42.42" class="difflineminus">-                                       false,</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineminus">-                                       null,</span>
<a href="#l42.44"></a><span id="l42.44" class="difflineminus">-                                       this.changeLogListener);</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineminus">-            multiget.doMultiGet();</span>
<a href="#l42.46"></a><span id="l42.46">         }</span>
<a href="#l42.47"></a><span id="l42.47">     }),</span>
<a href="#l42.48"></a><span id="l42.48"> </span>
<a href="#l42.49"></a><span id="l42.49">     onDataAvailable: function(request, context, inputStream, offset, count) {</span>
<a href="#l42.50"></a><span id="l42.50">         if (this._reader) {</span>
<a href="#l42.51"></a><span id="l42.51">             // No reader means request error</span>
<a href="#l42.52"></a><span id="l42.52">             this._reader.onDataAvailable(request, context, inputStream, offset, count);</span>
<a href="#l42.53"></a><span id="l42.53">         }</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineat">@@ -473,33 +473,33 @@ webDavSyncHandler.prototype = {</span>
<a href="#l42.55"></a><span id="l42.55">                     this.calendar.deleteTargetCalendarItem(path);</span>
<a href="#l42.56"></a><span id="l42.56">                 }</span>
<a href="#l42.57"></a><span id="l42.57">             }</span>
<a href="#l42.58"></a><span id="l42.58">         }</span>
<a href="#l42.59"></a><span id="l42.59">         if (this.calendar.isCached) {</span>
<a href="#l42.60"></a><span id="l42.60">             this.calendar.superCalendar.endBatch();</span>
<a href="#l42.61"></a><span id="l42.61">         }</span>
<a href="#l42.62"></a><span id="l42.62"> </span>
<a href="#l42.63"></a><span id="l42.63" class="difflineminus">-        if (!this.itemsNeedFetching.length) {</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineminus">-            if (this.newSyncToken) {</span>
<a href="#l42.65"></a><span id="l42.65" class="difflineminus">-                this.calendar.mWebdavSyncToken = this.newSyncToken;</span>
<a href="#l42.66"></a><span id="l42.66" class="difflineminus">-                this.calendar.saveCalendarProperties();</span>
<a href="#l42.67"></a><span id="l42.67" class="difflineminus">-                cal.LOG(&quot;CalDAV: New webdav-sync Token: &quot; + this.calendar.mWebdavSyncToken);</span>
<a href="#l42.68"></a><span id="l42.68" class="difflineminus">-            }</span>
<a href="#l42.69"></a><span id="l42.69" class="difflineminus">-            this.calendar.finalizeUpdatedItems(this.changeLogListener,</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineminus">-                                               this.baseUri);</span>
<a href="#l42.71"></a><span id="l42.71" class="difflineminus">-        } else {</span>
<a href="#l42.72"></a><span id="l42.72" class="difflineplus">+        if (this.itemsNeedFetching.length) {</span>
<a href="#l42.73"></a><span id="l42.73">             let multiget = new multigetSyncHandler(this.itemsNeedFetching,</span>
<a href="#l42.74"></a><span id="l42.74">                                                    this.calendar,</span>
<a href="#l42.75"></a><span id="l42.75">                                                    this.baseUri,</span>
<a href="#l42.76"></a><span id="l42.76">                                                    this.newSyncToken,</span>
<a href="#l42.77"></a><span id="l42.77">                                                    this.additionalSyncNeeded,</span>
<a href="#l42.78"></a><span id="l42.78">                                                    null,</span>
<a href="#l42.79"></a><span id="l42.79">                                                    this.changeLogListener);</span>
<a href="#l42.80"></a><span id="l42.80">             multiget.doMultiGet();</span>
<a href="#l42.81"></a><span id="l42.81" class="difflineplus">+        } else {</span>
<a href="#l42.82"></a><span id="l42.82" class="difflineplus">+            if (this.newSyncToken) {</span>
<a href="#l42.83"></a><span id="l42.83" class="difflineplus">+                this.calendar.mWebdavSyncToken = this.newSyncToken;</span>
<a href="#l42.84"></a><span id="l42.84" class="difflineplus">+                this.calendar.saveCalendarProperties();</span>
<a href="#l42.85"></a><span id="l42.85" class="difflineplus">+                cal.LOG(&quot;CalDAV: New webdav-sync Token: &quot; + this.calendar.mWebdavSyncToken);</span>
<a href="#l42.86"></a><span id="l42.86" class="difflineplus">+            }</span>
<a href="#l42.87"></a><span id="l42.87" class="difflineplus">+            this.calendar.finalizeUpdatedItems(this.changeLogListener,</span>
<a href="#l42.88"></a><span id="l42.88" class="difflineplus">+                                               this.baseUri);</span>
<a href="#l42.89"></a><span id="l42.89">         }</span>
<a href="#l42.90"></a><span id="l42.90">     },</span>
<a href="#l42.91"></a><span id="l42.91"> </span>
<a href="#l42.92"></a><span id="l42.92">     startElement: function(aUri, aLocalName, aQName, aAttributes) {</span>
<a href="#l42.93"></a><span id="l42.93">         switch (aLocalName) {</span>
<a href="#l42.94"></a><span id="l42.94">             case &quot;response&quot;: // WebDAV Sync draft 3</span>
<a href="#l42.95"></a><span id="l42.95">                 this.currentResponse = {};</span>
<a href="#l42.96"></a><span id="l42.96">                 this.tag = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -411,20 +411,20 @@ calCompositeCalendar.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4">     startBatch: function() {</span>
<a href="#l43.5"></a><span id="l43.5">         this.mCompositeObservers.notify(&quot;onStartBatch&quot;);</span>
<a href="#l43.6"></a><span id="l43.6">     },</span>
<a href="#l43.7"></a><span id="l43.7">     endBatch: function() {</span>
<a href="#l43.8"></a><span id="l43.8">         this.mCompositeObservers.notify(&quot;onEndBatch&quot;);</span>
<a href="#l43.9"></a><span id="l43.9">     },</span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11">     get statusDisplayed() {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-        if (!this.mStatusObserver) {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+        if (this.mStatusObserver) {</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineplus">+            return this.mStatusObserver.spinning != Components.interfaces.calIStatusObserver.NO_PROGRESS;</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineplus">+        } else {</span>
<a href="#l43.16"></a><span id="l43.16">             return false;</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-        } else {</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineminus">-            return this.mStatusObserver.spinning != Components.interfaces.calIStatusObserver.NO_PROGRESS;</span>
<a href="#l43.19"></a><span id="l43.19">         }</span>
<a href="#l43.20"></a><span id="l43.20">     },</span>
<a href="#l43.21"></a><span id="l43.21"> </span>
<a href="#l43.22"></a><span id="l43.22">     setStatusObserver: function(aStatusObserver, aWindow) {</span>
<a href="#l43.23"></a><span id="l43.23">         this.mStatusObserver = aStatusObserver;</span>
<a href="#l43.24"></a><span id="l43.24">         if (this.mStatusObserver) {</span>
<a href="#l43.25"></a><span id="l43.25">             this.mStatusObserver.initialize(aWindow);</span>
<a href="#l43.26"></a><span id="l43.26">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -305,45 +305,45 @@ calStorageCalendar.prototype = {</span>
<a href="#l44.4"></a><span id="l44.4">                         }</span>
<a href="#l44.5"></a><span id="l44.5">                     }</span>
<a href="#l44.6"></a><span id="l44.6">                 };</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8">                 let id = 0;</span>
<a href="#l44.9"></a><span id="l44.9">                 let path = this.uri.path;</span>
<a href="#l44.10"></a><span id="l44.10">                 let pos = path.indexOf(&quot;?id=&quot;);</span>
<a href="#l44.11"></a><span id="l44.11"> </span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-                if (pos != -1) {</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+                if (pos == -1) {</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+                    // For some reason, the first storage calendar before the</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+                    // v19 upgrade has cal_id=0. If we still have a</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineplus">+                    // moz-profile-calendar here, then this is the one and we</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineplus">+                    // need to move all events with cal_id=0 to this id.</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineplus">+                    cal.LOG(&quot;[calStorageCalendar] Migrating stray cal_id=0 calendar to uuid&quot;);</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineplus">+                    migrateTables(this.mDB, this.id, 0);</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineplus">+                    this.setProperty(&quot;uri&quot;, &quot;moz-storage-calendar://&quot;);</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineplus">+                    this.setProperty(&quot;old_calendar_id&quot;, 0);</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineplus">+                    this.mDB.commitTransaction();</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineplus">+                } else {</span>
<a href="#l44.24"></a><span id="l44.24">                     // There is an &quot;id&quot; parameter in the uri. This calendar</span>
<a href="#l44.25"></a><span id="l44.25">                     // has not been migrated to using the uuid as its cal_id.</span>
<a href="#l44.26"></a><span id="l44.26">                     pos = this.uri.path.indexOf(&quot;?id=&quot;);</span>
<a href="#l44.27"></a><span id="l44.27" class="difflineminus">-                    if (pos != -1) {</span>
<a href="#l44.28"></a><span id="l44.28" class="difflineplus">+                    if (pos == -1) {</span>
<a href="#l44.29"></a><span id="l44.29" class="difflineplus">+                        this.mDB.rollbackTransaction();</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineplus">+                    } else {</span>
<a href="#l44.31"></a><span id="l44.31">                         cal.LOG(&quot;[calStorageCalendar] Migrating numeric cal_id to uuid&quot;);</span>
<a href="#l44.32"></a><span id="l44.32">                         id = parseInt(path.substr(pos + 4), 10);</span>
<a href="#l44.33"></a><span id="l44.33">                         migrateTables(this.mDB, this.id, id);</span>
<a href="#l44.34"></a><span id="l44.34"> </span>
<a href="#l44.35"></a><span id="l44.35">                         // Now remove the id from the uri to make sure we don't do this</span>
<a href="#l44.36"></a><span id="l44.36">                         // again. Remeber the id, so we can recover in case something</span>
<a href="#l44.37"></a><span id="l44.37">                         // goes wrong.</span>
<a href="#l44.38"></a><span id="l44.38">                         this.setProperty(&quot;uri&quot;, &quot;moz-storage-calendar://&quot;);</span>
<a href="#l44.39"></a><span id="l44.39">                         this.setProperty(&quot;old_calendar_id&quot;, id);</span>
<a href="#l44.40"></a><span id="l44.40"> </span>
<a href="#l44.41"></a><span id="l44.41">                         this.mDB.commitTransaction();</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineminus">-                    } else {</span>
<a href="#l44.43"></a><span id="l44.43" class="difflineminus">-                        this.mDB.rollbackTransaction();</span>
<a href="#l44.44"></a><span id="l44.44">                     }</span>
<a href="#l44.45"></a><span id="l44.45" class="difflineminus">-                } else {</span>
<a href="#l44.46"></a><span id="l44.46" class="difflineminus">-                    // For some reason, the first storage calendar before the</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineminus">-                    // v19 upgrade has cal_id=0. If we still have a</span>
<a href="#l44.48"></a><span id="l44.48" class="difflineminus">-                    // moz-profile-calendar here, then this is the one and we</span>
<a href="#l44.49"></a><span id="l44.49" class="difflineminus">-                    // need to move all events with cal_id=0 to this id.</span>
<a href="#l44.50"></a><span id="l44.50" class="difflineminus">-                    cal.LOG(&quot;[calStorageCalendar] Migrating stray cal_id=0 calendar to uuid&quot;);</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineminus">-                    migrateTables(this.mDB, this.id, 0);</span>
<a href="#l44.52"></a><span id="l44.52" class="difflineminus">-                    this.setProperty(&quot;uri&quot;, &quot;moz-storage-calendar://&quot;);</span>
<a href="#l44.53"></a><span id="l44.53" class="difflineminus">-                    this.setProperty(&quot;old_calendar_id&quot;, 0);</span>
<a href="#l44.54"></a><span id="l44.54" class="difflineminus">-                    this.mDB.commitTransaction();</span>
<a href="#l44.55"></a><span id="l44.55">                 }</span>
<a href="#l44.56"></a><span id="l44.56">             } catch (exc) {</span>
<a href="#l44.57"></a><span id="l44.57">                 this.logError(&quot;prepareInitDB  moz-profile-calendar migration exception&quot;, exc);</span>
<a href="#l44.58"></a><span id="l44.58">                 this.mDB.rollbackTransaction();</span>
<a href="#l44.59"></a><span id="l44.59">                 throw exc;</span>
<a href="#l44.60"></a><span id="l44.60">             }</span>
<a href="#l44.61"></a><span id="l44.61">         } else if (this.uri.schemeIs(&quot;moz-storage-calendar&quot;)) {</span>
<a href="#l44.62"></a><span id="l44.62">             // New style uri, no need for migration here</span>
<a href="#l44.63"></a><span id="l44.63" class="difflineat">@@ -937,21 +937,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l44.64"></a><span id="l44.64">                                      Components.results.NS_OK,</span>
<a href="#l44.65"></a><span id="l44.65">                                      Components.interfaces.calIOperationListener.GET,</span>
<a href="#l44.66"></a><span id="l44.66">                                      null,</span>
<a href="#l44.67"></a><span id="l44.67">                                      null);</span>
<a href="#l44.68"></a><span id="l44.68">     },</span>
<a href="#l44.69"></a><span id="l44.69"> </span>
<a href="#l44.70"></a><span id="l44.70">     getItemOfflineFlag: function(aItem, aListener) {</span>
<a href="#l44.71"></a><span id="l44.71">         let flag = null;</span>
<a href="#l44.72"></a><span id="l44.72" class="difflineminus">-        if (!aItem) {</span>
<a href="#l44.73"></a><span id="l44.73" class="difflineminus">-            // It is possible that aItem can be null, flag provided should be null in this case</span>
<a href="#l44.74"></a><span id="l44.74" class="difflineminus">-            aListener.onOperationComplete(this, Components.results.NS_OK,</span>
<a href="#l44.75"></a><span id="l44.75" class="difflineminus">-                                               Components.interfaces.calIOperationListener.GET, null, flag);</span>
<a href="#l44.76"></a><span id="l44.76" class="difflineminus">-        } else {</span>
<a href="#l44.77"></a><span id="l44.77" class="difflineplus">+        if (aItem) {</span>
<a href="#l44.78"></a><span id="l44.78">             let aID = aItem.id;</span>
<a href="#l44.79"></a><span id="l44.79">             let self = this;</span>
<a href="#l44.80"></a><span id="l44.80">             let listener = {</span>
<a href="#l44.81"></a><span id="l44.81">                 handleResult: function(aResultSet) {</span>
<a href="#l44.82"></a><span id="l44.82">                         let row = aResultSet.getNextRow();</span>
<a href="#l44.83"></a><span id="l44.83">                         flag = row.getResultByName(&quot;offline_journal&quot;) || null;</span>
<a href="#l44.84"></a><span id="l44.84">                 },</span>
<a href="#l44.85"></a><span id="l44.85">                 handleError: function(aError) {</span>
<a href="#l44.86"></a><span id="l44.86" class="difflineat">@@ -968,16 +964,20 @@ calStorageCalendar.prototype = {</span>
<a href="#l44.87"></a><span id="l44.87">                 this.prepareStatement(this.mSelectEvent);</span>
<a href="#l44.88"></a><span id="l44.88">                 this.mSelectEvent.params.id = aID;</span>
<a href="#l44.89"></a><span id="l44.89">                 this.mSelectEvent.executeAsync(listener);</span>
<a href="#l44.90"></a><span id="l44.90">             } else if (cal.isToDo(aItem)) {</span>
<a href="#l44.91"></a><span id="l44.91">                 this.prepareStatement(this.mSelectTodo);</span>
<a href="#l44.92"></a><span id="l44.92">                 this.mSelectTodo.params.id = aID;</span>
<a href="#l44.93"></a><span id="l44.93">                 this.mSelectTodo.executeAsync(listener);</span>
<a href="#l44.94"></a><span id="l44.94">             }</span>
<a href="#l44.95"></a><span id="l44.95" class="difflineplus">+        } else {</span>
<a href="#l44.96"></a><span id="l44.96" class="difflineplus">+            // It is possible that aItem can be null, flag provided should be null in this case</span>
<a href="#l44.97"></a><span id="l44.97" class="difflineplus">+            aListener.onOperationComplete(this, Components.results.NS_OK,</span>
<a href="#l44.98"></a><span id="l44.98" class="difflineplus">+                                               Components.interfaces.calIOperationListener.GET, null, flag);</span>
<a href="#l44.99"></a><span id="l44.99">         }</span>
<a href="#l44.100"></a><span id="l44.100">     },</span>
<a href="#l44.101"></a><span id="l44.101"> </span>
<a href="#l44.102"></a><span id="l44.102">     setOfflineJournalFlag: function(aItem, flag) {</span>
<a href="#l44.103"></a><span id="l44.103">         let aID = aItem.id;</span>
<a href="#l44.104"></a><span id="l44.104">         if (cal.isEvent(aItem)) {</span>
<a href="#l44.105"></a><span id="l44.105">             this.prepareStatement(this.mEditEventOfflineFlag);</span>
<a href="#l44.106"></a><span id="l44.106">             this.mEditEventOfflineFlag.params.id = aID;</span>
<a href="#l44.107"></a><span id="l44.107" class="difflineat">@@ -1950,20 +1950,20 @@ calStorageCalendar.prototype = {</span>
<a href="#l44.108"></a><span id="l44.108"> </span>
<a href="#l44.109"></a><span id="l44.109">     setDateParamHelper: function(params, entryname, cdt) {</span>
<a href="#l44.110"></a><span id="l44.110">         if (cdt) {</span>
<a href="#l44.111"></a><span id="l44.111">             params[entryname] = cdt.nativeTime;</span>
<a href="#l44.112"></a><span id="l44.112">             let tz = cdt.timezone;</span>
<a href="#l44.113"></a><span id="l44.113">             let ownTz = cal.getTimezoneService().getTimezone(tz.tzid);</span>
<a href="#l44.114"></a><span id="l44.114">             if (ownTz) { // if we know that TZID, we use it</span>
<a href="#l44.115"></a><span id="l44.115">                 params[entryname + &quot;_tz&quot;] = ownTz.tzid;</span>
<a href="#l44.116"></a><span id="l44.116" class="difflineminus">-            } else if (!tz.icalComponent) { // timezone component missing</span>
<a href="#l44.117"></a><span id="l44.117" class="difflineplus">+            } else if (tz.icalComponent) { // foreign one</span>
<a href="#l44.118"></a><span id="l44.118" class="difflineplus">+                params[entryname + &quot;_tz&quot;] = tz.icalComponent.serializeToICS();</span>
<a href="#l44.119"></a><span id="l44.119" class="difflineplus">+            } else { // timezone component missing</span>
<a href="#l44.120"></a><span id="l44.120">                 params[entryname + &quot;_tz&quot;] = &quot;floating&quot;;</span>
<a href="#l44.121"></a><span id="l44.121" class="difflineminus">-            } else { // foreign one</span>
<a href="#l44.122"></a><span id="l44.122" class="difflineminus">-                params[entryname + &quot;_tz&quot;] = tz.icalComponent.serializeToICS();</span>
<a href="#l44.123"></a><span id="l44.123">             }</span>
<a href="#l44.124"></a><span id="l44.124">         } else {</span>
<a href="#l44.125"></a><span id="l44.125">             params[entryname] = null;</span>
<a href="#l44.126"></a><span id="l44.126">             params[entryname + &quot;_tz&quot;] = null;</span>
<a href="#l44.127"></a><span id="l44.127">         }</span>
<a href="#l44.128"></a><span id="l44.128">     },</span>
<a href="#l44.129"></a><span id="l44.129"> </span>
<a href="#l44.130"></a><span id="l44.130">     flushItem: function(item, olditem) {</span>
<a href="#l44.131"></a><span id="l44.131" class="difflineat">@@ -2332,23 +2332,23 @@ calStorageCalendar.prototype = {</span>
<a href="#l44.132"></a><span id="l44.132">         this.executeItemStatement(this.mDeleteMetaData, &quot;item_id&quot;, id);</span>
<a href="#l44.133"></a><span id="l44.133">         try {</span>
<a href="#l44.134"></a><span id="l44.134">             this.prepareStatement(this.mInsertMetaData);</span>
<a href="#l44.135"></a><span id="l44.135">             let sp = this.mInsertMetaData.params;</span>
<a href="#l44.136"></a><span id="l44.136">             sp.item_id = id;</span>
<a href="#l44.137"></a><span id="l44.137">             sp.value = value;</span>
<a href="#l44.138"></a><span id="l44.138">             this.mInsertMetaData.executeStep();</span>
<a href="#l44.139"></a><span id="l44.139">         } catch (e) {</span>
<a href="#l44.140"></a><span id="l44.140" class="difflineminus">-            if (e.result != Components.results.NS_ERROR_ILLEGAL_VALUE) {</span>
<a href="#l44.141"></a><span id="l44.141" class="difflineplus">+            if (e.result == Components.results.NS_ERROR_ILLEGAL_VALUE) {</span>
<a href="#l44.142"></a><span id="l44.142" class="difflineplus">+                this.logError(&quot;Unknown error!&quot;, e);</span>
<a href="#l44.143"></a><span id="l44.143" class="difflineplus">+            } else {</span>
<a href="#l44.144"></a><span id="l44.144">                 // The storage service throws an NS_ERROR_ILLEGAL_VALUE in</span>
<a href="#l44.145"></a><span id="l44.145">                 // case pval is something complex (i.e not a string or</span>
<a href="#l44.146"></a><span id="l44.146">                 // number). Swallow this error, leaving the value empty.</span>
<a href="#l44.147"></a><span id="l44.147">                 this.logError(&quot;Error setting metadata for id &quot; + id + &quot;!&quot;, e);</span>
<a href="#l44.148"></a><span id="l44.148" class="difflineminus">-            } else {</span>
<a href="#l44.149"></a><span id="l44.149" class="difflineminus">-                this.logError(&quot;Unknown error!&quot;, e);</span>
<a href="#l44.150"></a><span id="l44.150">             }</span>
<a href="#l44.151"></a><span id="l44.151">         } finally {</span>
<a href="#l44.152"></a><span id="l44.152">             this.mInsertMetaData.reset();</span>
<a href="#l44.153"></a><span id="l44.153">         }</span>
<a href="#l44.154"></a><span id="l44.154">     },</span>
<a href="#l44.155"></a><span id="l44.155"> </span>
<a href="#l44.156"></a><span id="l44.156">     deleteMetaData: function(id) {</span>
<a href="#l44.157"></a><span id="l44.157">         this.executeItemStatement(this.mDeleteMetaData, &quot;item_id&quot;, id);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -201,38 +201,38 @@ function backupDB(db, currentVersion) {</span>
<a href="#l45.4"></a><span id="l45.4"> </span>
<a href="#l45.5"></a><span id="l45.5"> /**</span>
<a href="#l45.6"></a><span id="l45.6">  * Upgrade the passed database.</span>
<a href="#l45.7"></a><span id="l45.7">  *</span>
<a href="#l45.8"></a><span id="l45.8">  * @param db        The database to bring up to date.</span>
<a href="#l45.9"></a><span id="l45.9">  */</span>
<a href="#l45.10"></a><span id="l45.10"> function upgradeDB(db) {</span>
<a href="#l45.11"></a><span id="l45.11">     cal.ASSERT(db, &quot;Database has not been opened!&quot;, true);</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-    if (!db.tableExists(&quot;cal_calendar_schema_version&quot;)) {</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">-        cal.LOG(&quot;Storage: Creating tables from scratch&quot;);</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">-        beginTransaction(db);</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">-        try {</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">-            executeSimpleSQL(db, getAllSql());</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineminus">-            setDbVersionAndCommit(db, DB_SCHEMA_VERSION);</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineminus">-        } catch (e) {</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineminus">-            reportErrorAndRollback(db, e);</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineminus">-        }</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineminus">-    } else {</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineplus">+    if (db.tableExists(&quot;cal_calendar_schema_version&quot;)) {</span>
<a href="#l45.23"></a><span id="l45.23">         let version = getVersion(db);</span>
<a href="#l45.24"></a><span id="l45.24">         if (version &lt; DB_SCHEMA_VERSION) {</span>
<a href="#l45.25"></a><span id="l45.25">             // First, create a backup</span>
<a href="#l45.26"></a><span id="l45.26">             backupDB(db, version);</span>
<a href="#l45.27"></a><span id="l45.27"> </span>
<a href="#l45.28"></a><span id="l45.28">             // Then start the latest upgrader</span>
<a href="#l45.29"></a><span id="l45.29">             cal.LOG(&quot;Storage: Preparing to upgrade v&quot; + version +</span>
<a href="#l45.30"></a><span id="l45.30">                     &quot; to v&quot; + DB_SCHEMA_VERSION);</span>
<a href="#l45.31"></a><span id="l45.31">             upgrade[&quot;v&quot; + DB_SCHEMA_VERSION](db, version);</span>
<a href="#l45.32"></a><span id="l45.32">         } else if (version &gt; DB_SCHEMA_VERSION) {</span>
<a href="#l45.33"></a><span id="l45.33">             throw Components.interfaces.calIErrors.STORAGE_UNKNOWN_SCHEMA_ERROR;</span>
<a href="#l45.34"></a><span id="l45.34">         }</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineplus">+    } else {</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineplus">+        cal.LOG(&quot;Storage: Creating tables from scratch&quot;);</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineplus">+        beginTransaction(db);</span>
<a href="#l45.38"></a><span id="l45.38" class="difflineplus">+        try {</span>
<a href="#l45.39"></a><span id="l45.39" class="difflineplus">+            executeSimpleSQL(db, getAllSql());</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineplus">+            setDbVersionAndCommit(db, DB_SCHEMA_VERSION);</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineplus">+        } catch (e) {</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineplus">+            reportErrorAndRollback(db, e);</span>
<a href="#l45.43"></a><span id="l45.43" class="difflineplus">+        }</span>
<a href="#l45.44"></a><span id="l45.44">     }</span>
<a href="#l45.45"></a><span id="l45.45"> </span>
<a href="#l45.46"></a><span id="l45.46">     ensureUpdatedTimezones(db);</span>
<a href="#l45.47"></a><span id="l45.47"> }</span>
<a href="#l45.48"></a><span id="l45.48"> </span>
<a href="#l45.49"></a><span id="l45.49"> /**</span>
<a href="#l45.50"></a><span id="l45.50">  * Sets the db version and commits any open transaction.</span>
<a href="#l45.51"></a><span id="l45.51">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -90,26 +90,24 @@ calWcapRequest.prototype = {</span>
<a href="#l46.4"></a><span id="l46.4">         }</span>
<a href="#l46.5"></a><span id="l46.5">         ret += &quot;, isPending=&quot; + this.isPending;</span>
<a href="#l46.6"></a><span id="l46.6">         ret += &quot;, status=&quot; + errorToString(this.status);</span>
<a href="#l46.7"></a><span id="l46.7">         return ret;</span>
<a href="#l46.8"></a><span id="l46.8">     },</span>
<a href="#l46.9"></a><span id="l46.9"> </span>
<a href="#l46.10"></a><span id="l46.10">     attachSubRequest: function(req) {</span>
<a href="#l46.11"></a><span id="l46.11">         if (req) {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-            if (!this.m_attachedRequests.some(req_ =&gt; req.id == req_.id)) {</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">-                if (req.isPending) {</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">-                    this.m_attachedRequests.push(req);</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">-                    req.parentRequest = this;</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineminus">-                    log(&quot;attachSubRequest()&quot;, this);</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineminus">-                } else if (!this.m_locked &amp;&amp; this.m_attachedRequests.length == 0) {</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineminus">-                    this.execRespFunc(req.status);</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineminus">-                }</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineminus">-            } else {</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineplus">+            if (this.m_attachedRequests.some(req_ =&gt; req.id == req_.id)) {</span>
<a href="#l46.22"></a><span id="l46.22">                 logError(&quot;request already attached: &quot; + req.id, this);</span>
<a href="#l46.23"></a><span id="l46.23" class="difflineplus">+            } else if (req.isPending) {</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineplus">+                this.m_attachedRequests.push(req);</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineplus">+                req.parentRequest = this;</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineplus">+                log(&quot;attachSubRequest()&quot;, this);</span>
<a href="#l46.27"></a><span id="l46.27" class="difflineplus">+            } else if (!this.m_locked &amp;&amp; this.m_attachedRequests.length == 0) {</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineplus">+                this.execRespFunc(req.status);</span>
<a href="#l46.29"></a><span id="l46.29">             }</span>
<a href="#l46.30"></a><span id="l46.30">         }</span>
<a href="#l46.31"></a><span id="l46.31">     },</span>
<a href="#l46.32"></a><span id="l46.32"> </span>
<a href="#l46.33"></a><span id="l46.33">     detachSubRequest: function(req, err) {</span>
<a href="#l46.34"></a><span id="l46.34">         this.m_attachedRequests = this.m_attachedRequests.filter(req_ =&gt; req.id != req_.id);</span>
<a href="#l46.35"></a><span id="l46.35">         if (err) {</span>
<a href="#l46.36"></a><span id="l46.36">             // first failing sub request stops parent request:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -32,19 +32,19 @@ calWcapTimezone.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4">     toString: function() {</span>
<a href="#l47.5"></a><span id="l47.5">         return this.icalComponent.toString();</span>
<a href="#l47.6"></a><span id="l47.6">     }</span>
<a href="#l47.7"></a><span id="l47.7"> };</span>
<a href="#l47.8"></a><span id="l47.8"> </span>
<a href="#l47.9"></a><span id="l47.9"> function splitUriParams(uri) {</span>
<a href="#l47.10"></a><span id="l47.10">     let spec = uri.spec;</span>
<a href="#l47.11"></a><span id="l47.11">     let qmPos = spec.indexOf(&quot;?&quot;);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    return qmPos != -1</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">-           ? [spec.substring(0, qmPos), spec.substring(qmPos)]</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">-           : [spec, &quot;&quot;];</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineplus">+    return qmPos == -1</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineplus">+           ? [spec, &quot;&quot;]</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineplus">+           : [spec.substring(0, qmPos), spec.substring(qmPos)];</span>
<a href="#l47.18"></a><span id="l47.18"> }</span>
<a href="#l47.19"></a><span id="l47.19"> </span>
<a href="#l47.20"></a><span id="l47.20"> function getWcapSessionFor(calendar, uri) {</span>
<a href="#l47.21"></a><span id="l47.21">     let contextId = calendar.getProperty(&quot;shared_context&quot;);</span>
<a href="#l47.22"></a><span id="l47.22">     if (!contextId) {</span>
<a href="#l47.23"></a><span id="l47.23">         contextId = cal.getUUID();</span>
<a href="#l47.24"></a><span id="l47.24">         calendar.setProperty(&quot;shared_context&quot;, contextId);</span>
<a href="#l47.25"></a><span id="l47.25">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -176,18 +176,18 @@ function prepareCreateCalendar() {</span>
<a href="#l48.4"></a><span id="l48.4">  */</span>
<a href="#l48.5"></a><span id="l48.5"> function doCreateCalendar() {</span>
<a href="#l48.6"></a><span id="l48.6">     let cal_name = document.getElementById(&quot;calendar-name&quot;).value;</span>
<a href="#l48.7"></a><span id="l48.7">     let cal_color = document.getElementById(&quot;calendar-color&quot;).value;</span>
<a href="#l48.8"></a><span id="l48.8"> </span>
<a href="#l48.9"></a><span id="l48.9">     gCalendar.name = cal_name;</span>
<a href="#l48.10"></a><span id="l48.10">     gCalendar.setProperty(&quot;color&quot;, cal_color);</span>
<a href="#l48.11"></a><span id="l48.11">     if (!gCalendar.getProperty(&quot;cache.always&quot;)) {</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-        gCalendar.setProperty(&quot;cache.enabled&quot;, gCalendar.getProperty(&quot;cache.supported&quot;) !== false ?</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-                                               document.getElementById(&quot;cache&quot;).checked : false);</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineplus">+        gCalendar.setProperty(&quot;cache.enabled&quot;, gCalendar.getProperty(&quot;cache.supported&quot;) === false</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineplus">+                                               ? false : document.getElementById(&quot;cache&quot;).checked);</span>
<a href="#l48.16"></a><span id="l48.16">     }</span>
<a href="#l48.17"></a><span id="l48.17"> </span>
<a href="#l48.18"></a><span id="l48.18">     if (!document.getElementById(&quot;fire-alarms&quot;).checked) {</span>
<a href="#l48.19"></a><span id="l48.19">         gCalendar.setProperty(&quot;suppressAlarms&quot;, true);</span>
<a href="#l48.20"></a><span id="l48.20">     }</span>
<a href="#l48.21"></a><span id="l48.21"> </span>
<a href="#l48.22"></a><span id="l48.22">     cal.getCalendarManager().registerCalendar(gCalendar);</span>
<a href="#l48.23"></a><span id="l48.23">     return true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1787,17 +1787,17 @@</span>
<a href="#l49.4"></a><span id="l49.4"> </span>
<a href="#l49.5"></a><span id="l49.5">             // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l49.6"></a><span id="l49.6">             // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l49.7"></a><span id="l49.7">             // which do not match \w, esp. in CJK locales.)</span>
<a href="#l49.8"></a><span id="l49.8">             this.parseShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)\D?$/;</span>
<a href="#l49.9"></a><span id="l49.9">             let probeDate = new Date(2002, 2, 4); // month is 0-based</span>
<a href="#l49.10"></a><span id="l49.10">             let probeString = this.formatDate(probeDate);</span>
<a href="#l49.11"></a><span id="l49.11">             let probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-            if (probeArray != null) {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+            if (probeArray) {</span>
<a href="#l49.14"></a><span id="l49.14">               // Numeric month format</span>
<a href="#l49.15"></a><span id="l49.15">               for (let i = 1; i &lt;= 3; i++) {</span>
<a href="#l49.16"></a><span id="l49.16">                 switch (Number(probeArray[i])) {</span>
<a href="#l49.17"></a><span id="l49.17">                   case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l49.18"></a><span id="l49.18">                   case 2002: this.yearIndex = i; break;</span>
<a href="#l49.19"></a><span id="l49.19">                   case 3: this.monthIndex = i; break;</span>
<a href="#l49.20"></a><span id="l49.20">                   case 4: this.dayIndex = i; break;</span>
<a href="#l49.21"></a><span id="l49.21">                 }</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -1827,17 +1827,17 @@</span>
<a href="#l49.23"></a><span id="l49.23">                 if (this.yearIndex != -1 &amp;&amp; this.dayIndex != -1 &amp;&amp; this.monthIndex != -1) {</span>
<a href="#l49.24"></a><span id="l49.24">                   this.probeSucceeded = true;</span>
<a href="#l49.25"></a><span id="l49.25">                   // Fill this.alphaMonths with month names.</span>
<a href="#l49.26"></a><span id="l49.26">                   this.alphaMonths = new Array(12);</span>
<a href="#l49.27"></a><span id="l49.27">                   for (let m = 0; m &lt; 12; m++) {</span>
<a href="#l49.28"></a><span id="l49.28">                     probeDate.setMonth(m);</span>
<a href="#l49.29"></a><span id="l49.29">                     probeString = this.formatDate(probeDate);</span>
<a href="#l49.30"></a><span id="l49.30">                     probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-                    if (probeArray != null) {</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+                    if (probeArray) {</span>
<a href="#l49.33"></a><span id="l49.33">                       this.alphaMonths[m] = probeArray[this.monthIndex].toUpperCase();</span>
<a href="#l49.34"></a><span id="l49.34">                     } else {</span>
<a href="#l49.35"></a><span id="l49.35">                       this.probeSucceeded = false;</span>
<a href="#l49.36"></a><span id="l49.36">                     }</span>
<a href="#l49.37"></a><span id="l49.37">                   }</span>
<a href="#l49.38"></a><span id="l49.38">                 }</span>
<a href="#l49.39"></a><span id="l49.39">               }</span>
<a href="#l49.40"></a><span id="l49.40">             }</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineat">@@ -1883,19 +1883,17 @@</span>
<a href="#l49.42"></a><span id="l49.42">             if (amProbeString != pmProbeString) {</span>
<a href="#l49.43"></a><span id="l49.43">               let amProbeArray = probeTimeRegExp.exec(amProbeString);</span>
<a href="#l49.44"></a><span id="l49.44">               let pmProbeArray = probeTimeRegExp.exec(pmProbeString);</span>
<a href="#l49.45"></a><span id="l49.45">               if (amProbeArray != null &amp;&amp; pmProbeArray != null) {</span>
<a href="#l49.46"></a><span id="l49.46">                 if (amProbeArray[PRE_INDEX] &amp;&amp; pmProbeArray[PRE_INDEX] &amp;&amp;</span>
<a href="#l49.47"></a><span id="l49.47">                     amProbeArray[PRE_INDEX] != pmProbeArray[PRE_INDEX]) {</span>
<a href="#l49.48"></a><span id="l49.48">                   this.ampmIndex = PRE_INDEX;</span>
<a href="#l49.49"></a><span id="l49.49">                 } else if (amProbeArray[POST_INDEX] &amp;&amp; pmProbeArray[POST_INDEX]) {</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineminus">-                  if (amProbeArray[POST_INDEX] != pmProbeArray[POST_INDEX]) {</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineminus">-                    this.ampmIndex = POST_INDEX;</span>
<a href="#l49.52"></a><span id="l49.52" class="difflineminus">-                  } else {</span>
<a href="#l49.53"></a><span id="l49.53" class="difflineplus">+                  if (amProbeArray[POST_INDEX] == pmProbeArray[POST_INDEX]) {</span>
<a href="#l49.54"></a><span id="l49.54">                     // check if need to append previous character,</span>
<a href="#l49.55"></a><span id="l49.55">                     // captured by the optional separator pattern after seconds digits,</span>
<a href="#l49.56"></a><span id="l49.56">                     // or after minutes if no seconds, or after hours if no minutes.</span>
<a href="#l49.57"></a><span id="l49.57">                     for (let k = SEC_INDEX; k &gt;= HR_INDEX; k -= 2) {</span>
<a href="#l49.58"></a><span id="l49.58">                       let nextSepI = k + 1;</span>
<a href="#l49.59"></a><span id="l49.59">                       let nextDigitsI = k + 2;</span>
<a href="#l49.60"></a><span id="l49.60">                       if ((k == SEC_INDEX ||</span>
<a href="#l49.61"></a><span id="l49.61">                            (!amProbeArray[nextDigitsI] &amp;&amp; !pmProbeArray[nextDigitsI])) &amp;&amp;</span>
<a href="#l49.62"></a><span id="l49.62" class="difflineat">@@ -1904,16 +1902,18 @@</span>
<a href="#l49.63"></a><span id="l49.63">                         amProbeArray[POST_INDEX] =</span>
<a href="#l49.64"></a><span id="l49.64">                           amProbeArray[nextSepI] + amProbeArray[POST_INDEX];</span>
<a href="#l49.65"></a><span id="l49.65">                         pmProbeArray[POST_INDEX] =</span>
<a href="#l49.66"></a><span id="l49.66">                           pmProbeArray[nextSepI] + pmProbeArray[POST_INDEX];</span>
<a href="#l49.67"></a><span id="l49.67">                         this.ampmIndex = POST_INDEX;</span>
<a href="#l49.68"></a><span id="l49.68">                         break;</span>
<a href="#l49.69"></a><span id="l49.69">                       }</span>
<a href="#l49.70"></a><span id="l49.70">                     }</span>
<a href="#l49.71"></a><span id="l49.71" class="difflineplus">+                  } else {</span>
<a href="#l49.72"></a><span id="l49.72" class="difflineplus">+                    this.ampmIndex = POST_INDEX;</span>
<a href="#l49.73"></a><span id="l49.73">                   }</span>
<a href="#l49.74"></a><span id="l49.74">                 }</span>
<a href="#l49.75"></a><span id="l49.75">                 if (this.ampmIndex) {</span>
<a href="#l49.76"></a><span id="l49.76">                   let makeFormatRegExp = function(string) {</span>
<a href="#l49.77"></a><span id="l49.77">                     // make expr to accept either as provided, lowercased, or uppercased</span>
<a href="#l49.78"></a><span id="l49.78">                     let regExp = string.replace(/(\W)/g, &quot;[$1]&quot;); // escape punctuation</span>
<a href="#l49.79"></a><span id="l49.79">                     let lowercased = string.toLowerCase();</span>
<a href="#l49.80"></a><span id="l49.80">                     if (string != lowercased) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -426,45 +426,45 @@ function setData(controller, data) {</span>
<a href="#l50.4"></a><span id="l50.4">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l50.5"></a><span id="l50.5">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l50.6"></a><span id="l50.6">   let mac = utils.appInfo.os.toLowerCase().includes(&quot;darwin&quot;);</span>
<a href="#l50.7"></a><span id="l50.7">   // wait for input elements' values to be populated</span>
<a href="#l50.8"></a><span id="l50.8">   controller.sleep(sleep);</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">   // title</span>
<a href="#l50.11"></a><span id="l50.11">   if (data.title != undefined) {</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    if (mac) {</span>
<a href="#l50.14"></a><span id="l50.14" class="difflineplus">+      let titleField = new elementslib.ID(controller.window.document, &quot;item-title&quot;);</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineplus">+      titleField.getNode().value = data.title;</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineplus">+    } else {</span>
<a href="#l50.17"></a><span id="l50.17">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.18"></a><span id="l50.18">         'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l50.19"></a><span id="l50.19">         'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l50.20"></a><span id="l50.20">         &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.21"></a><span id="l50.21">       controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.22"></a><span id="l50.22">         'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l50.23"></a><span id="l50.23">         'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l50.24"></a><span id="l50.24">         data.title);</span>
<a href="#l50.25"></a><span id="l50.25" class="difflineminus">-    } else {</span>
<a href="#l50.26"></a><span id="l50.26" class="difflineminus">-      let titleField = new elementslib.ID(controller.window.document, &quot;item-title&quot;);</span>
<a href="#l50.27"></a><span id="l50.27" class="difflineminus">-      titleField.getNode().value = data.title;</span>
<a href="#l50.28"></a><span id="l50.28">     }</span>
<a href="#l50.29"></a><span id="l50.29">   }</span>
<a href="#l50.30"></a><span id="l50.30"> </span>
<a href="#l50.31"></a><span id="l50.31">   // location</span>
<a href="#l50.32"></a><span id="l50.32">   if (data.location != undefined) {</span>
<a href="#l50.33"></a><span id="l50.33" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.34"></a><span id="l50.34" class="difflineplus">+    if (mac) {</span>
<a href="#l50.35"></a><span id="l50.35" class="difflineplus">+      let locationField = new elementslib.ID(controller.window.document, &quot;item-location&quot;);</span>
<a href="#l50.36"></a><span id="l50.36" class="difflineplus">+      locationField.getNode().value = data.location;</span>
<a href="#l50.37"></a><span id="l50.37" class="difflineplus">+    } else {</span>
<a href="#l50.38"></a><span id="l50.38">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.39"></a><span id="l50.39">         'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l50.40"></a><span id="l50.40">         'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l50.41"></a><span id="l50.41">         &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.42"></a><span id="l50.42">       controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.43"></a><span id="l50.43">         'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l50.44"></a><span id="l50.44">         'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l50.45"></a><span id="l50.45">         data.location);</span>
<a href="#l50.46"></a><span id="l50.46" class="difflineminus">-    } else {</span>
<a href="#l50.47"></a><span id="l50.47" class="difflineminus">-      let locationField = new elementslib.ID(controller.window.document, &quot;item-location&quot;);</span>
<a href="#l50.48"></a><span id="l50.48" class="difflineminus">-      locationField.getNode().value = data.location;</span>
<a href="#l50.49"></a><span id="l50.49">     }</span>
<a href="#l50.50"></a><span id="l50.50">   }</span>
<a href="#l50.51"></a><span id="l50.51"> </span>
<a href="#l50.52"></a><span id="l50.52">   // category</span>
<a href="#l50.53"></a><span id="l50.53">   if (data.category != undefined) {</span>
<a href="#l50.54"></a><span id="l50.54">     controller.select(new elementslib.ID(controller.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l50.55"></a><span id="l50.55">       data.category);</span>
<a href="#l50.56"></a><span id="l50.56">     controller.sleep(sleep);</span>
<a href="#l50.57"></a><span id="l50.57" class="difflineat">@@ -484,92 +484,92 @@ function setData(controller, data) {</span>
<a href="#l50.58"></a><span id="l50.58"> </span>
<a href="#l50.59"></a><span id="l50.59">   // startdate</span>
<a href="#l50.60"></a><span id="l50.60">   if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l50.61"></a><span id="l50.61">     let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l50.62"></a><span id="l50.62">       data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l50.63"></a><span id="l50.63">     if (!isEvent) {</span>
<a href="#l50.64"></a><span id="l50.64">       controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-entrydate&quot;), true);</span>
<a href="#l50.65"></a><span id="l50.65">     }</span>
<a href="#l50.66"></a><span id="l50.66" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.67"></a><span id="l50.67" class="difflineplus">+    if (mac) {</span>
<a href="#l50.68"></a><span id="l50.68" class="difflineplus">+      startDateInput.getNode().value = startdate;</span>
<a href="#l50.69"></a><span id="l50.69" class="difflineplus">+    } else {</span>
<a href="#l50.70"></a><span id="l50.70">       controller.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.71"></a><span id="l50.71">       controller.type(startDateInput, startdate);</span>
<a href="#l50.72"></a><span id="l50.72" class="difflineminus">-    } else {</span>
<a href="#l50.73"></a><span id="l50.73" class="difflineminus">-      startDateInput.getNode().value = startdate;</span>
<a href="#l50.74"></a><span id="l50.74">     }</span>
<a href="#l50.75"></a><span id="l50.75">   }</span>
<a href="#l50.76"></a><span id="l50.76"> </span>
<a href="#l50.77"></a><span id="l50.77">   // starttime</span>
<a href="#l50.78"></a><span id="l50.78">   if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l50.79"></a><span id="l50.79">     let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l50.80"></a><span id="l50.80">       data.starttime.getHours(), data.starttime.getMinutes(), 0);</span>
<a href="#l50.81"></a><span id="l50.81" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.82"></a><span id="l50.82" class="difflineplus">+    if (mac) {</span>
<a href="#l50.83"></a><span id="l50.83" class="difflineplus">+      startTimeInput.getNode().value = starttime;</span>
<a href="#l50.84"></a><span id="l50.84" class="difflineplus">+      controller.sleep(sleep);</span>
<a href="#l50.85"></a><span id="l50.85" class="difflineplus">+    } else {</span>
<a href="#l50.86"></a><span id="l50.86">       controller.keypress(startTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.87"></a><span id="l50.87">       controller.type(startTimeInput, starttime);</span>
<a href="#l50.88"></a><span id="l50.88" class="difflineminus">-    } else {</span>
<a href="#l50.89"></a><span id="l50.89" class="difflineminus">-      startTimeInput.getNode().value = starttime;</span>
<a href="#l50.90"></a><span id="l50.90" class="difflineminus">-      controller.sleep(sleep);</span>
<a href="#l50.91"></a><span id="l50.91">     }</span>
<a href="#l50.92"></a><span id="l50.92">   }</span>
<a href="#l50.93"></a><span id="l50.93"> </span>
<a href="#l50.94"></a><span id="l50.94">   // enddate</span>
<a href="#l50.95"></a><span id="l50.95">   if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l50.96"></a><span id="l50.96">     let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l50.97"></a><span id="l50.97">       data.enddate.getFullYear(), data.enddate.getMonth() + 1, data.enddate.getDate());</span>
<a href="#l50.98"></a><span id="l50.98">     if (!isEvent) {</span>
<a href="#l50.99"></a><span id="l50.99">       controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-duedate&quot;), true);</span>
<a href="#l50.100"></a><span id="l50.100">     }</span>
<a href="#l50.101"></a><span id="l50.101" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.102"></a><span id="l50.102" class="difflineplus">+    if (mac) {</span>
<a href="#l50.103"></a><span id="l50.103" class="difflineplus">+      endDateInput.getNode().value = enddate;</span>
<a href="#l50.104"></a><span id="l50.104" class="difflineplus">+    } else {</span>
<a href="#l50.105"></a><span id="l50.105">       controller.keypress(endDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.106"></a><span id="l50.106">       controller.type(endDateInput, enddate);</span>
<a href="#l50.107"></a><span id="l50.107" class="difflineminus">-    } else {</span>
<a href="#l50.108"></a><span id="l50.108" class="difflineminus">-      endDateInput.getNode().value = enddate;</span>
<a href="#l50.109"></a><span id="l50.109">     }</span>
<a href="#l50.110"></a><span id="l50.110">   }</span>
<a href="#l50.111"></a><span id="l50.111"> </span>
<a href="#l50.112"></a><span id="l50.112">   // endttime</span>
<a href="#l50.113"></a><span id="l50.113">   if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l50.114"></a><span id="l50.114">     let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l50.115"></a><span id="l50.115">       data.endtime.getHours(), data.endtime.getMinutes(), 0);</span>
<a href="#l50.116"></a><span id="l50.116" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.117"></a><span id="l50.117" class="difflineplus">+    if (mac) {</span>
<a href="#l50.118"></a><span id="l50.118" class="difflineplus">+      endTimeInput.getNode().value = endtime;</span>
<a href="#l50.119"></a><span id="l50.119" class="difflineplus">+      controller.sleep(sleep);</span>
<a href="#l50.120"></a><span id="l50.120" class="difflineplus">+    } else {</span>
<a href="#l50.121"></a><span id="l50.121">       controller.keypress(endTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.122"></a><span id="l50.122">       controller.type(endTimeInput, endtime);</span>
<a href="#l50.123"></a><span id="l50.123" class="difflineminus">-    } else {</span>
<a href="#l50.124"></a><span id="l50.124" class="difflineminus">-      endTimeInput.getNode().value = endtime;</span>
<a href="#l50.125"></a><span id="l50.125" class="difflineminus">-      controller.sleep(sleep);</span>
<a href="#l50.126"></a><span id="l50.126">     }</span>
<a href="#l50.127"></a><span id="l50.127">   }</span>
<a href="#l50.128"></a><span id="l50.128"> </span>
<a href="#l50.129"></a><span id="l50.129">   // recurrence</span>
<a href="#l50.130"></a><span id="l50.130">   if (data.repeat != undefined) {</span>
<a href="#l50.131"></a><span id="l50.131">     controller.select(new elementslib.ID(controller.window.document, &quot;item-repeat&quot;), undefined,</span>
<a href="#l50.132"></a><span id="l50.132">       undefined, data.repeat);</span>
<a href="#l50.133"></a><span id="l50.133">   }</span>
<a href="#l50.134"></a><span id="l50.134"> </span>
<a href="#l50.135"></a><span id="l50.135">   // reminder</span>
<a href="#l50.136"></a><span id="l50.136">   if (data.reminder != undefined) {</span>
<a href="#l50.137"></a><span id="l50.137">     controller.select(new elementslib.ID(controller.window.document, &quot;item-alarm&quot;), data.reminder);</span>
<a href="#l50.138"></a><span id="l50.138">   }</span>
<a href="#l50.139"></a><span id="l50.139"> </span>
<a href="#l50.140"></a><span id="l50.140">   // description</span>
<a href="#l50.141"></a><span id="l50.141">   if (data.description != undefined) {</span>
<a href="#l50.142"></a><span id="l50.142" class="difflineminus">-    if (!mac) {</span>
<a href="#l50.143"></a><span id="l50.143" class="difflineplus">+    if (mac) {</span>
<a href="#l50.144"></a><span id="l50.144" class="difflineplus">+      let descField = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.145"></a><span id="l50.145" class="difflineplus">+        'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l50.146"></a><span id="l50.146" class="difflineplus">+        'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l50.147"></a><span id="l50.147" class="difflineplus">+      descField.getNode().value = data.description;</span>
<a href="#l50.148"></a><span id="l50.148" class="difflineplus">+    } else {</span>
<a href="#l50.149"></a><span id="l50.149">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.150"></a><span id="l50.150">         'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l50.151"></a><span id="l50.151">         'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l50.152"></a><span id="l50.152">         &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.153"></a><span id="l50.153">       controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.154"></a><span id="l50.154">         'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l50.155"></a><span id="l50.155">         'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l50.156"></a><span id="l50.156">         data.description);</span>
<a href="#l50.157"></a><span id="l50.157" class="difflineminus">-    } else {</span>
<a href="#l50.158"></a><span id="l50.158" class="difflineminus">-      let descField = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l50.159"></a><span id="l50.159" class="difflineminus">-        'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l50.160"></a><span id="l50.160" class="difflineminus">-        'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l50.161"></a><span id="l50.161" class="difflineminus">-      descField.getNode().value = data.description;</span>
<a href="#l50.162"></a><span id="l50.162">     }</span>
<a href="#l50.163"></a><span id="l50.163">   }</span>
<a href="#l50.164"></a><span id="l50.164"> </span>
<a href="#l50.165"></a><span id="l50.165">   // priority</span>
<a href="#l50.166"></a><span id="l50.166">   if (data.priority != undefined) {</span>
<a href="#l50.167"></a><span id="l50.167">     controller.mainMenu.click(&quot;#options-priority-&quot; + data.priority + &quot;-label&quot;);</span>
<a href="#l50.168"></a><span id="l50.168">   }</span>
<a href="#l50.169"></a><span id="l50.169"> </span>
<a href="#l50.170"></a><span id="l50.170" class="difflineat">@@ -593,21 +593,21 @@ function setData(controller, data) {</span>
<a href="#l50.171"></a><span id="l50.171"> </span>
<a href="#l50.172"></a><span id="l50.172">   // completed on</span>
<a href="#l50.173"></a><span id="l50.173">   if (data.completed != undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l50.174"></a><span id="l50.174">     let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l50.175"></a><span id="l50.175">       data.completed.getFullYear(), data.completed.getMonth() + 1,</span>
<a href="#l50.176"></a><span id="l50.176">       data.completed.getDate());</span>
<a href="#l50.177"></a><span id="l50.177"> </span>
<a href="#l50.178"></a><span id="l50.178">     if (currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l50.179"></a><span id="l50.179" class="difflineminus">-      if (!mac) {</span>
<a href="#l50.180"></a><span id="l50.180" class="difflineplus">+      if (mac) {</span>
<a href="#l50.181"></a><span id="l50.181" class="difflineplus">+        completedDateInput.getNode().value = completeddate;</span>
<a href="#l50.182"></a><span id="l50.182" class="difflineplus">+      } else {</span>
<a href="#l50.183"></a><span id="l50.183">         controller.keypress(completedDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l50.184"></a><span id="l50.184">         controller.type(completedDateInput, completeddate);</span>
<a href="#l50.185"></a><span id="l50.185" class="difflineminus">-      } else {</span>
<a href="#l50.186"></a><span id="l50.186" class="difflineminus">-        completedDateInput.getNode().value = completeddate;</span>
<a href="#l50.187"></a><span id="l50.187">       }</span>
<a href="#l50.188"></a><span id="l50.188">     }</span>
<a href="#l50.189"></a><span id="l50.189">   }</span>
<a href="#l50.190"></a><span id="l50.190"> </span>
<a href="#l50.191"></a><span id="l50.191">   // percent complete</span>
<a href="#l50.192"></a><span id="l50.192">   if (data.percent != undefined &amp;&amp;</span>
<a href="#l50.193"></a><span id="l50.193">        (currentStatus == &quot;NEEDS-ACTION&quot; || currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l50.194"></a><span id="l50.194">         currentStatus == &quot;COMPLETED&quot;)) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

