<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25963:0022c92d1421d34bbff34fc72241804c3193fb3b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0022c92d1421d34bbff34fc72241804c3193fb3b" />
<meta property="og:url" content="/comm-central/rev/0022c92d1421d34bbff34fc72241804c3193fb3b" />
<meta property="og:description" content="Bug 1531307 - Port bug 1525319: Remove context parameter from OnStartRequest/OnStopRequest/OnDataAvailable, JS part. rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0022c92d1421d34bbff34fc72241804c3193fb3b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0022c92d1421d34bbff34fc72241804c3193fb3b">shortlog</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0022c92d1421d34bbff34fc72241804c3193fb3b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b">files</a> |
changeset |
<a href="/comm-central/raw-rev/0022c92d1421d34bbff34fc72241804c3193fb3b">raw</a>  | <a href="/comm-central/archive/0022c92d1421d34bbff34fc72241804c3193fb3b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1531307">Bug 1531307</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1525319">bug 1525319</a>: Remove context parameter from OnStartRequest/OnStopRequest/OnDataAvailable, JS part. rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 28 Feb 2019 18:55:51 +0100</td></tr>

<tr>
 <td>changeset 25963</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0022c92d1421d34bbff34fc72241804c3193fb3b">0022c92d1421d34bbff34fc72241804c3193fb3b</a></td>
</tr>



<tr>
<td>parent 25962</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/276188d87e1bddeb98705e6f949802ed3591f65f">276188d87e1bddeb98705e6f949802ed3591f65f</a>
</td>
</tr>

<tr>
<td>child 25964</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1f07f970b92e52c52fc7cc7864252aadaf68bdf7">1f07f970b92e52c52fc7cc7864252aadaf68bdf7</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0022c92d1421d34bbff34fc72241804c3193fb3b">15584</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 28 Feb 2019 17:58:01 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0022c92d1421 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0022c92d1421d34bbff34fc72241804c3193fb3b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0022c92d1421d34bbff34fc72241804c3193fb3b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0022c92d1421d34bbff34fc72241804c3193fb3b&newProject=comm-central&newRevision=276188d87e1bddeb98705e6f949802ed3591f65f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0022c92d1421d34bbff34fc72241804c3193fb3b&newProject=comm-central&newRevision=276188d87e1bddeb98705e6f949802ed3591f65f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0022c92d1421d34bbff34fc72241804c3193fb3b&newProject=comm-central&newRevision=276188d87e1bddeb98705e6f949802ed3591f65f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1531307">1531307</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1525319">1525319</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1531307">Bug 1531307</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1525319">bug 1525319</a>: Remove context parameter from OnStartRequest/OnStopRequest/OnDataAvailable, JS part. rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/modules/socket.jsm">chat/modules/socket.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/modules/socket.jsm">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/modules/socket.jsm">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/modules/socket.jsm">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/modules/socket.jsm">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/modules/socket.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-session.jsm">chat/protocols/xmpp/xmpp-session.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-session.jsm">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-session.jsm">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-session.jsm">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-session.jsm">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-session.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-xml.jsm">chat/protocols/xmpp/xmpp-xml.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-xml.jsm">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-xml.jsm">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-xml.jsm">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-xml.jsm">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/chat/protocols/xmpp/xmpp-xml.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/editor/ui/dialogs/content/EdLinkChecker.js">editor/ui/dialogs/content/EdLinkChecker.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/editor/ui/dialogs/content/EdLinkChecker.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/editor/ui/dialogs/content/EdLinkChecker.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/editor/ui/dialogs/content/EdLinkChecker.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/editor/ui/dialogs/content/EdLinkChecker.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/editor/ui/dialogs/content/EdLinkChecker.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/accountcreation/content/guessConfig.js">mail/components/accountcreation/content/guessConfig.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/accountcreation/content/guessConfig.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/accountcreation/content/guessConfig.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/accountcreation/content/guessConfig.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/accountcreation/content/guessConfig.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/accountcreation/content/guessConfig.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/box.jsm">mail/components/cloudfile/box/box.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/box.jsm">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/box.jsm">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/box.jsm">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/box.jsm">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/box.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/management.js">mail/components/cloudfile/box/management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/management.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/management.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/management.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/management.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/box/management.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/hightail.jsm">mail/components/cloudfile/hightail/hightail.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/hightail.jsm">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/hightail.jsm">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/hightail.jsm">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/hightail.jsm">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/hightail.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/management.js">mail/components/cloudfile/hightail/management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/management.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/management.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/management.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/management.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/cloudfile/hightail/management.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/extensions/parent/ext-cloudFile.js">mail/components/extensions/parent/ext-cloudFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/extensions/parent/ext-cloudFile.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/extensions/parent/ext-cloudFile.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/extensions/parent/ext-cloudFile.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/extensions/parent/ext-cloudFile.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/extensions/parent/ext-cloudFile.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/newmailaccount/content/uriListener.js">mail/components/newmailaccount/content/uriListener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/newmailaccount/content/uriListener.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/newmailaccount/content/uriListener.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/newmailaccount/content/uriListener.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/newmailaccount/content/uriListener.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/newmailaccount/content/uriListener.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/nsMailDefaultHandler.js">mail/components/nsMailDefaultHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/nsMailDefaultHandler.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/nsMailDefaultHandler.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/nsMailDefaultHandler.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/nsMailDefaultHandler.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/nsMailDefaultHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/SpotlightIntegration.js">mail/components/search/content/SpotlightIntegration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/SpotlightIntegration.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/SpotlightIntegration.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/SpotlightIntegration.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/SpotlightIntegration.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/SpotlightIntegration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/WinSearchIntegration.js">mail/components/search/content/WinSearchIntegration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/WinSearchIntegration.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/WinSearchIntegration.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/WinSearchIntegration.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/WinSearchIntegration.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mail/components/search/content/WinSearchIntegration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/db/gloda/modules/mimemsg.js">mailnews/db/gloda/modules/mimemsg.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/db/gloda/modules/mimemsg.js">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/db/gloda/modules/mimemsg.js">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/db/gloda/modules/mimemsg.js">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/db/gloda/modules/mimemsg.js">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/db/gloda/modules/mimemsg.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/mime/src/mimeParser.jsm">mailnews/mime/src/mimeParser.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/mime/src/mimeParser.jsm">file</a> |
<a href="/comm-central/annotate/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/mime/src/mimeParser.jsm">annotate</a> |
<a href="/comm-central/diff/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/mime/src/mimeParser.jsm">diff</a> |
<a href="/comm-central/comparison/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/mime/src/mimeParser.jsm">comparison</a> |
<a href="/comm-central/log/0022c92d1421d34bbff34fc72241804c3193fb3b/mailnews/mime/src/mimeParser.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -2225,17 +2225,17 @@ function uploadCloudAttachment(attachmen</span>
<a href="#l1.4"></a><span id="l1.4">     let file = attachment.uri.QueryInterface(Ci.nsIFileURL).file;</span>
<a href="#l1.5"></a><span id="l1.5">     listItem.attachLocalFile = file;</span>
<a href="#l1.6"></a><span id="l1.6">     listItem.attachCloudProvider = cloudProvider;</span>
<a href="#l1.7"></a><span id="l1.7">     cloudProvider.uploadFile(file, {</span>
<a href="#l1.8"></a><span id="l1.8">         onStartRequest: function() {</span>
<a href="#l1.9"></a><span id="l1.9">             listItem.setAttribute(&quot;image&quot;, &quot;chrome://global/skin/icons/loading.png&quot;);</span>
<a href="#l1.10"></a><span id="l1.10">         },</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        onStopRequest: function(aRequest, aStatusCode) {</span>
<a href="#l1.14"></a><span id="l1.14">             if (Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l1.15"></a><span id="l1.15">                 delete gAttachMap[attachment.hashId];</span>
<a href="#l1.16"></a><span id="l1.16">                 attachment.uri = Services.io.newURI(cloudProvider.urlForFile(file));</span>
<a href="#l1.17"></a><span id="l1.17">                 attachment.setParameter(&quot;FILENAME&quot;, file.leafName);</span>
<a href="#l1.18"></a><span id="l1.18">                 attachment.setParameter(&quot;PROVIDER&quot;, cloudProvider.type);</span>
<a href="#l1.19"></a><span id="l1.19">                 listItem.setAttribute(&quot;label&quot;, file.leafName);</span>
<a href="#l1.20"></a><span id="l1.20">                 gAttachMap[attachment.hashId] = attachment;</span>
<a href="#l1.21"></a><span id="l1.21">                 listItem.setAttribute(&quot;image&quot;, cloudProvider.iconClass);</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -2350,17 +2350,17 @@ function deleteAttachment() {</span>
<a href="#l1.23"></a><span id="l1.23">     let documentLink = document.getElementById(&quot;attachment-link&quot;);</span>
<a href="#l1.24"></a><span id="l1.24">     let item = documentLink.selectedItem;</span>
<a href="#l1.25"></a><span id="l1.25">     delete gAttachMap[item.attachment.hashId];</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">     if (item.attachLocalFile &amp;&amp; item.attachCloudProvider) {</span>
<a href="#l1.28"></a><span id="l1.28">         try {</span>
<a href="#l1.29"></a><span id="l1.29">             item.attachCloudProvider.deleteFile(item.attachLocalFile, {</span>
<a href="#l1.30"></a><span id="l1.30">                 onStartRequest: function() {},</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-                onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+                onStopRequest: function(aRequest, aStatusCode) {</span>
<a href="#l1.33"></a><span id="l1.33">                     if (!Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l1.34"></a><span id="l1.34">                         // TODO With a notification bar, we could actually show this error.</span>
<a href="#l1.35"></a><span id="l1.35">                         cal.ERROR(&quot;[calendar-event-dialog] Deleting cloud attachment &quot; +</span>
<a href="#l1.36"></a><span id="l1.36">                                   &quot;failed, file will remain on server. &quot; +</span>
<a href="#l1.37"></a><span id="l1.37">                                   &quot; Status code: &quot; + aStatusCode);</span>
<a href="#l1.38"></a><span id="l1.38">                     }</span>
<a href="#l1.39"></a><span id="l1.39">                 }</span>
<a href="#l1.40"></a><span id="l1.40">             });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -49,51 +49,51 @@ etagsHandler.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">         Ci.nsISAXErrorHandler,</span>
<a href="#l2.5"></a><span id="l2.5">         Ci.nsIRequestObserver,</span>
<a href="#l2.6"></a><span id="l2.6">         Ci.nsIStreamListener</span>
<a href="#l2.7"></a><span id="l2.7">     ]),</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">     /**</span>
<a href="#l2.10"></a><span id="l2.10">      * @see nsIStreamListener</span>
<a href="#l2.11"></a><span id="l2.11">      */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    onStartRequest: function(request, context) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    onStartRequest: function(request) {</span>
<a href="#l2.14"></a><span id="l2.14">         let httpchannel = request.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">         let responseStatus;</span>
<a href="#l2.17"></a><span id="l2.17">         try {</span>
<a href="#l2.18"></a><span id="l2.18">             responseStatus = httpchannel.responseStatus;</span>
<a href="#l2.19"></a><span id="l2.19">         } catch (ex) {</span>
<a href="#l2.20"></a><span id="l2.20">             cal.WARN(&quot;CalDAV: No response status getting etags for calendar &quot; + this.calendar.name);</span>
<a href="#l2.21"></a><span id="l2.21">         }</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">         if (responseStatus == 207) {</span>
<a href="#l2.24"></a><span id="l2.24">             // We only need to parse 207's, anything else is probably a</span>
<a href="#l2.25"></a><span id="l2.25">             // server error (i.e 50x).</span>
<a href="#l2.26"></a><span id="l2.26">             httpchannel.contentType = &quot;application/xml&quot;;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-            this._reader.onStartRequest(request, context);</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+            this._reader.onStartRequest(request);</span>
<a href="#l2.29"></a><span id="l2.29">         } else {</span>
<a href="#l2.30"></a><span id="l2.30">             cal.LOG(&quot;CalDAV: Error fetching item etags&quot;);</span>
<a href="#l2.31"></a><span id="l2.31">             this.calendar.reportDavError(Ci.calIErrors.DAV_REPORT_ERROR);</span>
<a href="#l2.32"></a><span id="l2.32">             if (this.calendar.isCached &amp;&amp; this.changeLogListener) {</span>
<a href="#l2.33"></a><span id="l2.33">                 this.changeLogListener.onResult({ status: Cr.NS_ERROR_FAILURE }, Cr.NS_ERROR_FAILURE);</span>
<a href="#l2.34"></a><span id="l2.34">             }</span>
<a href="#l2.35"></a><span id="l2.35">             this._reader = null;</span>
<a href="#l2.36"></a><span id="l2.36">         }</span>
<a href="#l2.37"></a><span id="l2.37">     },</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-    onStopRequest: async function(request, context, statusCode) {</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+    onStopRequest: async function(request, statusCode) {</span>
<a href="#l2.41"></a><span id="l2.41">         if (this.calendar.verboseLogging()) {</span>
<a href="#l2.42"></a><span id="l2.42">             cal.LOG(&quot;CalDAV: recv: &quot; + this.logXML);</span>
<a href="#l2.43"></a><span id="l2.43">         }</span>
<a href="#l2.44"></a><span id="l2.44">         if (!this._reader) {</span>
<a href="#l2.45"></a><span id="l2.45">             // No reader means there was a request error</span>
<a href="#l2.46"></a><span id="l2.46">             return;</span>
<a href="#l2.47"></a><span id="l2.47">         }</span>
<a href="#l2.48"></a><span id="l2.48">         try {</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-            this._reader.onStopRequest(request, context, statusCode);</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+            this._reader.onStopRequest(request, statusCode);</span>
<a href="#l2.51"></a><span id="l2.51">         } finally {</span>
<a href="#l2.52"></a><span id="l2.52">             this._reader = null;</span>
<a href="#l2.53"></a><span id="l2.53">         }</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55">         // Now that we are done, check which items need fetching.</span>
<a href="#l2.56"></a><span id="l2.56">         if (this.calendar.isCached) {</span>
<a href="#l2.57"></a><span id="l2.57">             this.calendar.superCalendar.startBatch();</span>
<a href="#l2.58"></a><span id="l2.58">         }</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineat">@@ -152,20 +152,20 @@ etagsHandler.prototype = {</span>
<a href="#l2.60"></a><span id="l2.60">             // but do poll the inbox</span>
<a href="#l2.61"></a><span id="l2.61">             if (this.calendar.mShouldPollInbox &amp;&amp;</span>
<a href="#l2.62"></a><span id="l2.62">                 !this.calendar.isInbox(this.baseUri.spec)) {</span>
<a href="#l2.63"></a><span id="l2.63">                 this.calendar.pollInbox();</span>
<a href="#l2.64"></a><span id="l2.64">             }</span>
<a href="#l2.65"></a><span id="l2.65">         }</span>
<a href="#l2.66"></a><span id="l2.66">     },</span>
<a href="#l2.67"></a><span id="l2.67"> </span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-    onDataAvailable: function(request, context, inputStream, offset, count) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+    onDataAvailable: function(request, inputStream, offset, count) {</span>
<a href="#l2.70"></a><span id="l2.70">         if (this._reader) {</span>
<a href="#l2.71"></a><span id="l2.71">             // No reader means request error</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-            this._reader.onDataAvailable(request, context, inputStream, offset, count);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+            this._reader.onDataAvailable(request, inputStream, offset, count);</span>
<a href="#l2.74"></a><span id="l2.74">         }</span>
<a href="#l2.75"></a><span id="l2.75">     },</span>
<a href="#l2.76"></a><span id="l2.76"> </span>
<a href="#l2.77"></a><span id="l2.77"> </span>
<a href="#l2.78"></a><span id="l2.78">     /**</span>
<a href="#l2.79"></a><span id="l2.79">      * @see nsISAXErrorHandler</span>
<a href="#l2.80"></a><span id="l2.80">      */</span>
<a href="#l2.81"></a><span id="l2.81">     fatalError: function() {</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineat">@@ -355,31 +355,31 @@ webDavSyncHandler.prototype = {</span>
<a href="#l2.83"></a><span id="l2.83">                 this.changeLogListener.onResult({ status: Cr.NS_ERROR_NOT_AVAILABLE }, Cr.NS_ERROR_NOT_AVAILABLE);</span>
<a href="#l2.84"></a><span id="l2.84">             }</span>
<a href="#l2.85"></a><span id="l2.85">         }, false);</span>
<a href="#l2.86"></a><span id="l2.86">     },</span>
<a href="#l2.87"></a><span id="l2.87"> </span>
<a href="#l2.88"></a><span id="l2.88">     /**</span>
<a href="#l2.89"></a><span id="l2.89">      * @see nsIStreamListener</span>
<a href="#l2.90"></a><span id="l2.90">      */</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-    onStartRequest: function(request, context) {</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+    onStartRequest: function(request) {</span>
<a href="#l2.93"></a><span id="l2.93">         let httpchannel = request.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l2.94"></a><span id="l2.94"> </span>
<a href="#l2.95"></a><span id="l2.95">         let responseStatus;</span>
<a href="#l2.96"></a><span id="l2.96">         try {</span>
<a href="#l2.97"></a><span id="l2.97">             responseStatus = httpchannel.responseStatus;</span>
<a href="#l2.98"></a><span id="l2.98">         } catch (ex) {</span>
<a href="#l2.99"></a><span id="l2.99">             cal.WARN(&quot;CalDAV: No response status doing webdav sync for calendar &quot; + this.calendar.name);</span>
<a href="#l2.100"></a><span id="l2.100">         }</span>
<a href="#l2.101"></a><span id="l2.101"> </span>
<a href="#l2.102"></a><span id="l2.102">         if (responseStatus == 207) {</span>
<a href="#l2.103"></a><span id="l2.103">             // We only need to parse 207's, anything else is probably a</span>
<a href="#l2.104"></a><span id="l2.104">             // server error (i.e 50x).</span>
<a href="#l2.105"></a><span id="l2.105">             httpchannel.contentType = &quot;application/xml&quot;;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-            this._reader.onStartRequest(request, context);</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+            this._reader.onStartRequest(request);</span>
<a href="#l2.108"></a><span id="l2.108">         } else if (this.calendar.mWebdavSyncToken != null &amp;&amp;</span>
<a href="#l2.109"></a><span id="l2.109">                    responseStatus &gt;= 400 &amp;&amp;</span>
<a href="#l2.110"></a><span id="l2.110">                    responseStatus &lt;= 499) {</span>
<a href="#l2.111"></a><span id="l2.111">             // Invalidate sync token with 4xx errors that could indicate the</span>
<a href="#l2.112"></a><span id="l2.112">             // sync token has become invalid and do a refresh</span>
<a href="#l2.113"></a><span id="l2.113">             cal.LOG(&quot;CalDAV: Reseting sync token because server returned status code: &quot; + responseStatus);</span>
<a href="#l2.114"></a><span id="l2.114">             this._reader = null;</span>
<a href="#l2.115"></a><span id="l2.115">             this.calendar.mWebdavSyncToken = null;</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineat">@@ -390,36 +390,36 @@ webDavSyncHandler.prototype = {</span>
<a href="#l2.117"></a><span id="l2.117">             this.calendar.reportDavError(Ci.calIErrors.DAV_REPORT_ERROR);</span>
<a href="#l2.118"></a><span id="l2.118">             if (this.calendar.isCached &amp;&amp; this.changeLogListener) {</span>
<a href="#l2.119"></a><span id="l2.119">                 this.changeLogListener.onResult({ status: Cr.NS_ERROR_FAILURE }, Cr.NS_ERROR_FAILURE);</span>
<a href="#l2.120"></a><span id="l2.120">             }</span>
<a href="#l2.121"></a><span id="l2.121">             this._reader = null;</span>
<a href="#l2.122"></a><span id="l2.122">         }</span>
<a href="#l2.123"></a><span id="l2.123">     },</span>
<a href="#l2.124"></a><span id="l2.124"> </span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-    onStopRequest: function(request, context, statusCode) {</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+    onStopRequest: function(request, statusCode) {</span>
<a href="#l2.127"></a><span id="l2.127">         if (this.calendar.verboseLogging()) {</span>
<a href="#l2.128"></a><span id="l2.128">             cal.LOG(&quot;CalDAV: recv: &quot; + this.logXML);</span>
<a href="#l2.129"></a><span id="l2.129">         }</span>
<a href="#l2.130"></a><span id="l2.130">         if (!this._reader) {</span>
<a href="#l2.131"></a><span id="l2.131">             // No reader means there was a request error</span>
<a href="#l2.132"></a><span id="l2.132">             cal.LOG(&quot;CalDAV: onStopRequest: no reader&quot;);</span>
<a href="#l2.133"></a><span id="l2.133">             return;</span>
<a href="#l2.134"></a><span id="l2.134">         }</span>
<a href="#l2.135"></a><span id="l2.135">         try {</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-            this._reader.onStopRequest(request, context, statusCode);</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+            this._reader.onStopRequest(request, statusCode);</span>
<a href="#l2.138"></a><span id="l2.138">         } finally {</span>
<a href="#l2.139"></a><span id="l2.139">             this._reader = null;</span>
<a href="#l2.140"></a><span id="l2.140">         }</span>
<a href="#l2.141"></a><span id="l2.141">     },</span>
<a href="#l2.142"></a><span id="l2.142"> </span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-    onDataAvailable: function(request, context, inputStream, offset, count) {</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+    onDataAvailable: function(request, inputStream, offset, count) {</span>
<a href="#l2.145"></a><span id="l2.145">         if (this._reader) {</span>
<a href="#l2.146"></a><span id="l2.146">             // No reader means request error</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-            this._reader.onDataAvailable(request, context, inputStream, offset, count);</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineplus">+            this._reader.onDataAvailable(request, inputStream, offset, count);</span>
<a href="#l2.149"></a><span id="l2.149">         }</span>
<a href="#l2.150"></a><span id="l2.150">     },</span>
<a href="#l2.151"></a><span id="l2.151"> </span>
<a href="#l2.152"></a><span id="l2.152">     /**</span>
<a href="#l2.153"></a><span id="l2.153">      * @see nsISAXErrorHandler</span>
<a href="#l2.154"></a><span id="l2.154">      */</span>
<a href="#l2.155"></a><span id="l2.155">     fatalError: function() {</span>
<a href="#l2.156"></a><span id="l2.156">         cal.WARN(&quot;CalDAV: Fatal Error doing webdav sync for &quot; + this.calendar.name);</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineat">@@ -713,40 +713,40 @@ multigetSyncHandler.prototype = {</span>
<a href="#l2.158"></a><span id="l2.158">                 this.changeLogListener.onResult({ status: Cr.NS_ERROR_NOT_AVAILABLE }, Cr.NS_ERROR_NOT_AVAILABLE);</span>
<a href="#l2.159"></a><span id="l2.159">             }</span>
<a href="#l2.160"></a><span id="l2.160">         }, false);</span>
<a href="#l2.161"></a><span id="l2.161">     },</span>
<a href="#l2.162"></a><span id="l2.162"> </span>
<a href="#l2.163"></a><span id="l2.163">     /**</span>
<a href="#l2.164"></a><span id="l2.164">      * @see nsIStreamListener</span>
<a href="#l2.165"></a><span id="l2.165">      */</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-    onStartRequest: function(request, context) {</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+    onStartRequest: function(request) {</span>
<a href="#l2.168"></a><span id="l2.168">         let httpchannel = request.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l2.169"></a><span id="l2.169"> </span>
<a href="#l2.170"></a><span id="l2.170">         let responseStatus;</span>
<a href="#l2.171"></a><span id="l2.171">         try {</span>
<a href="#l2.172"></a><span id="l2.172">             responseStatus = httpchannel.responseStatus;</span>
<a href="#l2.173"></a><span id="l2.173">         } catch (ex) {</span>
<a href="#l2.174"></a><span id="l2.174">             cal.WARN(&quot;CalDAV: No response status doing multiget for calendar &quot; + this.calendar.name);</span>
<a href="#l2.175"></a><span id="l2.175">         }</span>
<a href="#l2.176"></a><span id="l2.176"> </span>
<a href="#l2.177"></a><span id="l2.177">         if (responseStatus == 207) {</span>
<a href="#l2.178"></a><span id="l2.178">             // We only need to parse 207's, anything else is probably a</span>
<a href="#l2.179"></a><span id="l2.179">             // server error (i.e 50x).</span>
<a href="#l2.180"></a><span id="l2.180">             httpchannel.contentType = &quot;application/xml&quot;;</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineminus">-            this._reader.onStartRequest(request, context);</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+            this._reader.onStartRequest(request);</span>
<a href="#l2.183"></a><span id="l2.183">         } else {</span>
<a href="#l2.184"></a><span id="l2.184">             let errorMsg = &quot;CalDAV: Error: got status &quot; + responseStatus +</span>
<a href="#l2.185"></a><span id="l2.185">                                &quot; fetching calendar data for &quot; + this.calendar.name + &quot;, &quot; + this.listener;</span>
<a href="#l2.186"></a><span id="l2.186">             this.calendar.notifyGetFailed(errorMsg, this.listener, this.changeLogListener);</span>
<a href="#l2.187"></a><span id="l2.187">             this._reader = null;</span>
<a href="#l2.188"></a><span id="l2.188">         }</span>
<a href="#l2.189"></a><span id="l2.189">     },</span>
<a href="#l2.190"></a><span id="l2.190"> </span>
<a href="#l2.191"></a><span id="l2.191" class="difflineminus">-    onStopRequest: function(request, context, statusCode) {</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+    onStopRequest: function(request, statusCode) {</span>
<a href="#l2.193"></a><span id="l2.193">         if (this.calendar.verboseLogging()) {</span>
<a href="#l2.194"></a><span id="l2.194">             cal.LOG(&quot;CalDAV: recv: &quot; + this.logXML);</span>
<a href="#l2.195"></a><span id="l2.195">         }</span>
<a href="#l2.196"></a><span id="l2.196">         if (this.unhandledErrors) {</span>
<a href="#l2.197"></a><span id="l2.197">             this.calendar.superCalendar.endBatch();</span>
<a href="#l2.198"></a><span id="l2.198">             this.calendar.notifyGetFailed(&quot;multiget error&quot;, this.listener, this.changeLogListener);</span>
<a href="#l2.199"></a><span id="l2.199">             return;</span>
<a href="#l2.200"></a><span id="l2.200">         }</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineat">@@ -771,17 +771,17 @@ multigetSyncHandler.prototype = {</span>
<a href="#l2.202"></a><span id="l2.202">         }</span>
<a href="#l2.203"></a><span id="l2.203">         if (!this._reader) {</span>
<a href="#l2.204"></a><span id="l2.204">             // No reader means there was a request error. The error is already</span>
<a href="#l2.205"></a><span id="l2.205">             // notified in onStartRequest, so no need to do it here.</span>
<a href="#l2.206"></a><span id="l2.206">             cal.LOG(&quot;CalDAV: onStopRequest: no reader&quot;);</span>
<a href="#l2.207"></a><span id="l2.207">             return;</span>
<a href="#l2.208"></a><span id="l2.208">         }</span>
<a href="#l2.209"></a><span id="l2.209">         try {</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineminus">-            this._reader.onStopRequest(request, context, statusCode);</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineplus">+            this._reader.onStopRequest(request, statusCode);</span>
<a href="#l2.212"></a><span id="l2.212">         } finally {</span>
<a href="#l2.213"></a><span id="l2.213">             this._reader = null;</span>
<a href="#l2.214"></a><span id="l2.214">         }</span>
<a href="#l2.215"></a><span id="l2.215">         if (this.itemsNeedFetching.length &gt; 0) {</span>
<a href="#l2.216"></a><span id="l2.216">             cal.LOG(&quot;CalDAV: Still need to fetch &quot; + this.itemsNeedFetching.length + &quot; elements.&quot;);</span>
<a href="#l2.217"></a><span id="l2.217">             this._reader = Cc[&quot;@mozilla.org/saxparser/xmlreader;1&quot;].createInstance(Ci.nsISAXXMLReader);</span>
<a href="#l2.218"></a><span id="l2.218">             this._reader.contentHandler = this;</span>
<a href="#l2.219"></a><span id="l2.219">             this._reader.errorHandler = this;</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineat">@@ -797,20 +797,20 @@ multigetSyncHandler.prototype = {</span>
<a href="#l2.221"></a><span id="l2.221">             this.timer.initWithCallback(</span>
<a href="#l2.222"></a><span id="l2.222">                 timerCallback,</span>
<a href="#l2.223"></a><span id="l2.223">                 0,</span>
<a href="#l2.224"></a><span id="l2.224">                 Ci.nsITimer.TYPE_ONE_SHOT</span>
<a href="#l2.225"></a><span id="l2.225">             );</span>
<a href="#l2.226"></a><span id="l2.226">         }</span>
<a href="#l2.227"></a><span id="l2.227">     },</span>
<a href="#l2.228"></a><span id="l2.228"> </span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-    onDataAvailable: function(request, context, inputStream, offset, count) {</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+    onDataAvailable: function(request, inputStream, offset, count) {</span>
<a href="#l2.231"></a><span id="l2.231">         if (this._reader) {</span>
<a href="#l2.232"></a><span id="l2.232">             // No reader means request error</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineminus">-            this._reader.onDataAvailable(request, context, inputStream, offset, count);</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineplus">+            this._reader.onDataAvailable(request, inputStream, offset, count);</span>
<a href="#l2.235"></a><span id="l2.235">         }</span>
<a href="#l2.236"></a><span id="l2.236">     },</span>
<a href="#l2.237"></a><span id="l2.237"> </span>
<a href="#l2.238"></a><span id="l2.238">     /**</span>
<a href="#l2.239"></a><span id="l2.239">      * @see nsISAXErrorHandler</span>
<a href="#l2.240"></a><span id="l2.240">      */</span>
<a href="#l2.241"></a><span id="l2.241">     fatalError: function() {</span>
<a href="#l2.242"></a><span id="l2.242">         cal.WARN(&quot;CalDAV: Fatal Error doing multiget for &quot; + this.calendar.name);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -380,26 +380,26 @@ calICSCalendar.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">         // don't call this.getItems, because we are locked:</span>
<a href="#l3.6"></a><span id="l3.6">         this.mMemoryCalendar.getItems(calICalendar.ITEM_FILTER_TYPE_ALL | calICalendar.ITEM_FILTER_COMPLETED_ALL,</span>
<a href="#l3.7"></a><span id="l3.7">                                       0, null, null, listener);</span>
<a href="#l3.8"></a><span id="l3.8">     },</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">     // nsIStreamListener impl</span>
<a href="#l3.11"></a><span id="l3.11">     // For after publishing. Do error checks here</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    onStartRequest: function(request, ctxt) {},</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    onDataAvailable: function(request, ctxt, inStream, sourceOffset, count) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    onStartRequest: function(request) {},</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    onDataAvailable: function(request, inStream, sourceOffset, count) {</span>
<a href="#l3.16"></a><span id="l3.16">         // All data must be consumed. For an upload channel, there is</span>
<a href="#l3.17"></a><span id="l3.17">         // no meaningfull data. So it gets read and then ignored</span>
<a href="#l3.18"></a><span id="l3.18">         let scriptableInputStream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l3.19"></a><span id="l3.19">                                       .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l3.20"></a><span id="l3.20">         scriptableInputStream.init(inStream);</span>
<a href="#l3.21"></a><span id="l3.21">         scriptableInputStream.read(-1);</span>
<a href="#l3.22"></a><span id="l3.22">     },</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-    onStopRequest: function(request, ctxt, status, errorMsg) {</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+    onStopRequest: function(request, status, errorMsg) {</span>
<a href="#l3.25"></a><span id="l3.25">         let httpChannel;</span>
<a href="#l3.26"></a><span id="l3.26">         let requestSucceeded = false;</span>
<a href="#l3.27"></a><span id="l3.27">         try {</span>
<a href="#l3.28"></a><span id="l3.28">             httpChannel = request.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l3.29"></a><span id="l3.29">             requestSucceeded = httpChannel.requestSucceeded;</span>
<a href="#l3.30"></a><span id="l3.30">         } catch (e) {</span>
<a href="#l3.31"></a><span id="l3.31">             // This may fail if it was not a http channel, handled later on.</span>
<a href="#l3.32"></a><span id="l3.32">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -191,21 +191,21 @@ var notificationCallbacks = {</span>
<a href="#l4.4"></a><span id="l4.4">         throw Cr.NS_ERROR_NO_INTERFACE;</span>
<a href="#l4.5"></a><span id="l4.5">     }</span>
<a href="#l4.6"></a><span id="l4.6"> };</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> var publishingListener = {</span>
<a href="#l4.10"></a><span id="l4.10">     QueryInterface: ChromeUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    onStartRequest: function(request, ctxt) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    onStartRequest: function(request) {</span>
<a href="#l4.14"></a><span id="l4.14">     },</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-    onStopRequest: function(request, ctxt, status, errorMsg) {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-        ctxt.wrappedJSObject.onStopUpload();</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+    onStopRequest: function(request, status, errorMsg) {</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+        this.wrappedJSObject.onStopUpload();</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">         let channel;</span>
<a href="#l4.22"></a><span id="l4.22">         let requestSucceeded;</span>
<a href="#l4.23"></a><span id="l4.23">         try {</span>
<a href="#l4.24"></a><span id="l4.24">             channel = request.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l4.25"></a><span id="l4.25">             requestSucceeded = channel.requestSucceeded;</span>
<a href="#l4.26"></a><span id="l4.26">         } catch (e) {</span>
<a href="#l4.27"></a><span id="l4.27">             // Don't fail if it is not a http channel, will be handled below</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineat">@@ -218,11 +218,11 @@ var publishingListener = {</span>
<a href="#l4.29"></a><span id="l4.29">             Services.prompt.alert(null, cal.l10n.getCalString(&quot;genericErrorTitle&quot;), body);</span>
<a href="#l4.30"></a><span id="l4.30">         } else if (!channel &amp;&amp; !Components.isSuccessCode(request.status)) {</span>
<a href="#l4.31"></a><span id="l4.31">             // XXX this should be made human-readable.</span>
<a href="#l4.32"></a><span id="l4.32">             let body = cal.l10n.getCalString(&quot;otherPutError&quot;, [request.status.toString(16)]);</span>
<a href="#l4.33"></a><span id="l4.33">             Services.prompt.alert(null, cal.l10n.getCalString(&quot;genericErrorTitle&quot;), body);</span>
<a href="#l4.34"></a><span id="l4.34">         }</span>
<a href="#l4.35"></a><span id="l4.35">     },</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-    onDataAvailable: function(request, ctxt, inStream, sourceOffset, count) {</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+    onDataAvailable: function(request, inStream, sourceOffset, count) {</span>
<a href="#l4.39"></a><span id="l4.39">     }</span>
<a href="#l4.40"></a><span id="l4.40"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/chat/modules/socket.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/chat/modules/socket.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -356,17 +356,17 @@ var Socket = {</span>
<a href="#l5.4"></a><span id="l5.4">     delete this._proxyCancel;</span>
<a href="#l5.5"></a><span id="l5.5">   },</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">   /*</span>
<a href="#l5.8"></a><span id="l5.8">    * nsIStreamListener methods</span>
<a href="#l5.9"></a><span id="l5.9">    */</span>
<a href="#l5.10"></a><span id="l5.10">   // onDataAvailable, called by Mozilla's networking code.</span>
<a href="#l5.11"></a><span id="l5.11">   // Buffers the data, and parses it into discrete messages.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  onDataAvailable(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  onDataAvailable(aRequest, aInputStream, aOffset, aCount) {</span>
<a href="#l5.14"></a><span id="l5.14">     if (this.disconnected)</span>
<a href="#l5.15"></a><span id="l5.15">       return;</span>
<a href="#l5.16"></a><span id="l5.16">     this._lastAliveTime = Date.now();</span>
<a href="#l5.17"></a><span id="l5.17">     if (this.binaryMode) {</span>
<a href="#l5.18"></a><span id="l5.18">       // Load the data from the stream</span>
<a href="#l5.19"></a><span id="l5.19">       this._incomingDataBuffer = this._incomingDataBuffer</span>
<a href="#l5.20"></a><span id="l5.20">                                      .concat(this._binaryInputStream</span>
<a href="#l5.21"></a><span id="l5.21">                                                  .readByteArray(aCount));</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -435,25 +435,25 @@ var Socket = {</span>
<a href="#l5.23"></a><span id="l5.23">     if (&quot;_stopRequestStatus&quot; in this)</span>
<a href="#l5.24"></a><span id="l5.24">       this._handleStopRequest(this._stopRequestStatus);</span>
<a href="#l5.25"></a><span id="l5.25">   },</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">   /*</span>
<a href="#l5.28"></a><span id="l5.28">    * nsIRequestObserver methods</span>
<a href="#l5.29"></a><span id="l5.29">    */</span>
<a href="#l5.30"></a><span id="l5.30">   // Signifies the beginning of an async request</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-  onStartRequest(aRequest, aContext) {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  onStartRequest(aRequest) {</span>
<a href="#l5.33"></a><span id="l5.33">     if (this.disconnected) {</span>
<a href="#l5.34"></a><span id="l5.34">       // Ignore this if we're already disconnected.</span>
<a href="#l5.35"></a><span id="l5.35">       return;</span>
<a href="#l5.36"></a><span id="l5.36">     }</span>
<a href="#l5.37"></a><span id="l5.37">     this.DEBUG(&quot;onStartRequest&quot;);</span>
<a href="#l5.38"></a><span id="l5.38">   },</span>
<a href="#l5.39"></a><span id="l5.39">   // Called to signify the end of an asynchronous request.</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-  onStopRequest(aRequest, aContext, aStatus) {</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+  onStopRequest(aRequest, aStatus) {</span>
<a href="#l5.42"></a><span id="l5.42">     if (this.disconnected) {</span>
<a href="#l5.43"></a><span id="l5.43">       // We're already disconnected, so nothing left to do here.</span>
<a href="#l5.44"></a><span id="l5.44">       return;</span>
<a href="#l5.45"></a><span id="l5.45">     }</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47">     this.DEBUG(&quot;onStopRequest (&quot; + aStatus + &quot;)&quot;);</span>
<a href="#l5.48"></a><span id="l5.48">     this._stopRequestStatus = aStatus;</span>
<a href="#l5.49"></a><span id="l5.49">     // The stop request will be handled when the queue is next empty.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp-session.jsm</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp-session.jsm</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -305,17 +305,17 @@ XMPPSession.prototype = {</span>
<a href="#l6.4"></a><span id="l6.4">   /* When incoming data is available to be parsed */</span>
<a href="#l6.5"></a><span id="l6.5">   onDataReceived(aData) {</span>
<a href="#l6.6"></a><span id="l6.6">     this.checkPingTimer();</span>
<a href="#l6.7"></a><span id="l6.7">     let istream = Cc[&quot;@mozilla.org/io/string-input-stream;1&quot;]</span>
<a href="#l6.8"></a><span id="l6.8">                     .createInstance(Ci.nsIStringInputStream);</span>
<a href="#l6.9"></a><span id="l6.9">     istream.setData(aData, aData.length);</span>
<a href="#l6.10"></a><span id="l6.10">     this._lastReceivedData = aData;</span>
<a href="#l6.11"></a><span id="l6.11">     try {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      this._parser.onDataAvailable(istream, 0, aData.length);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      this._parser.onDataAvailable(istream, 0, aData.length);  // XXX TODO: This looks wrong, request parameter missing.</span>
<a href="#l6.14"></a><span id="l6.14">     } catch (e) {</span>
<a href="#l6.15"></a><span id="l6.15">       Cu.reportError(e);</span>
<a href="#l6.16"></a><span id="l6.16">       this.onXMLError(&quot;parser-exception&quot;, e);</span>
<a href="#l6.17"></a><span id="l6.17">     }</span>
<a href="#l6.18"></a><span id="l6.18">     delete this._lastReceivedData;</span>
<a href="#l6.19"></a><span id="l6.19">   },</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">   /* The connection got disconnected without us closing it. */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp-xml.jsm</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp-xml.jsm</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -312,31 +312,31 @@ XMLNode.prototype = {</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> function XMPPParser(aListener) {</span>
<a href="#l7.6"></a><span id="l7.6">   this._parser = Cc[&quot;@mozilla.org/saxparser/xmlreader;1&quot;]</span>
<a href="#l7.7"></a><span id="l7.7">                    .createInstance(Ci.nsISAXXMLReader);</span>
<a href="#l7.8"></a><span id="l7.8">   this._parser.contentHandler = this;</span>
<a href="#l7.9"></a><span id="l7.9">   this._parser.errorHandler = this;</span>
<a href="#l7.10"></a><span id="l7.10">   this._parser.parseAsync(null);</span>
<a href="#l7.11"></a><span id="l7.11">   this._listener = aListener;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  this._parser.onStartRequest(this._dummyRequest, null);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  this._parser.onStartRequest(this._dummyRequest);</span>
<a href="#l7.14"></a><span id="l7.14"> }</span>
<a href="#l7.15"></a><span id="l7.15"> XMPPParser.prototype = {</span>
<a href="#l7.16"></a><span id="l7.16">   _destroyPending: false,</span>
<a href="#l7.17"></a><span id="l7.17">   destroy() {</span>
<a href="#l7.18"></a><span id="l7.18">     // Avoid reference cycles</span>
<a href="#l7.19"></a><span id="l7.19">     this._parser.contentHandler = null;</span>
<a href="#l7.20"></a><span id="l7.20">     delete this._listener;</span>
<a href="#l7.21"></a><span id="l7.21">     // Calling onStopRequest while we are in an onDataAvailable</span>
<a href="#l7.22"></a><span id="l7.22">     // callback crashes, don't do it.</span>
<a href="#l7.23"></a><span id="l7.23">     if (this._inOnDataAvailable) {</span>
<a href="#l7.24"></a><span id="l7.24">       this._destroyPending = true;</span>
<a href="#l7.25"></a><span id="l7.25">       return;</span>
<a href="#l7.26"></a><span id="l7.26">     }</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-    this._parser.onStopRequest(this._dummyRequest, null, Cr.NS_OK);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+    this._parser.onStopRequest(this._dummyRequest, Cr.NS_OK);</span>
<a href="#l7.29"></a><span id="l7.29">     // Stopping the request causes parse errors (because we parsed</span>
<a href="#l7.30"></a><span id="l7.30">     // only partial XML documents?), so the error handler is still</span>
<a href="#l7.31"></a><span id="l7.31">     // needed to avoid the errors being reported to the error console.</span>
<a href="#l7.32"></a><span id="l7.32">     this._parser.errorHandler = null;</span>
<a href="#l7.33"></a><span id="l7.33">     delete this._parser;</span>
<a href="#l7.34"></a><span id="l7.34">   },</span>
<a href="#l7.35"></a><span id="l7.35">   _dummyRequest: {</span>
<a href="#l7.36"></a><span id="l7.36">     cancel() { },</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineat">@@ -346,17 +346,17 @@ XMPPParser.prototype = {</span>
<a href="#l7.38"></a><span id="l7.38">   },</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40">   _logReceivedData(aData) {</span>
<a href="#l7.41"></a><span id="l7.41">     this._listener.LOG(&quot;received:\n&quot; + aData);</span>
<a href="#l7.42"></a><span id="l7.42">   },</span>
<a href="#l7.43"></a><span id="l7.43">   _inOnDataAvailable: false,</span>
<a href="#l7.44"></a><span id="l7.44">   onDataAvailable(aInputStream, aOffset, aCount) {</span>
<a href="#l7.45"></a><span id="l7.45">     this._inOnDataAvailable = true;</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-    this._parser.onDataAvailable(this._dummyRequest, null,</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+    this._parser.onDataAvailable(this._dummyRequest,</span>
<a href="#l7.48"></a><span id="l7.48">                                  aInputStream, aOffset, aCount);</span>
<a href="#l7.49"></a><span id="l7.49">     delete this._inOnDataAvailable;</span>
<a href="#l7.50"></a><span id="l7.50">     if (this._destroyPending)</span>
<a href="#l7.51"></a><span id="l7.51">       this.destroy();</span>
<a href="#l7.52"></a><span id="l7.52">   },</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54">   /* nsISAXContentHandler implementation */</span>
<a href="#l7.55"></a><span id="l7.55">   startDocument() { },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/editor/ui/dialogs/content/EdLinkChecker.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/editor/ui/dialogs/content/EdLinkChecker.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -9,20 +9,20 @@ var gURIRefObjects = [];      // Array o</span>
<a href="#l8.4"></a><span id="l8.4"> var gNumLinksCalledBack = 0;</span>
<a href="#l8.5"></a><span id="l8.5"> var gStartedAllChecks = false;</span>
<a href="#l8.6"></a><span id="l8.6"> var gLinkCheckTimerID = 0;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> // Implement nsIRequestObserver:</span>
<a href="#l8.9"></a><span id="l8.9"> var gRequestObserver =</span>
<a href="#l8.10"></a><span id="l8.10"> {</span>
<a href="#l8.11"></a><span id="l8.11">   // urichecker requires that we have an OnStartRequest even tho it's a nop.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  onStartRequest: function(request, ctxt) { },</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  onStartRequest: function(request) { },</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   // onStopRequest is where we really handle the status.</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-  onStopRequest: function(request, ctxt, status)</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  onStopRequest: function(request, status)</span>
<a href="#l8.18"></a><span id="l8.18">   {</span>
<a href="#l8.19"></a><span id="l8.19">     var linkChecker = request.QueryInterface(Ci.nsIURIChecker);</span>
<a href="#l8.20"></a><span id="l8.20">     if (linkChecker)</span>
<a href="#l8.21"></a><span id="l8.21">     {</span>
<a href="#l8.22"></a><span id="l8.22">       gNumLinksCalledBack++;</span>
<a href="#l8.23"></a><span id="l8.23">       linkChecker.status = status;</span>
<a href="#l8.24"></a><span id="l8.24">       for (var i = 0; i &lt; gNumLinksCalledBack; i++)</span>
<a href="#l8.25"></a><span id="l8.25">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/accountcreation/content/guessConfig.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/accountcreation/content/guessConfig.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -995,34 +995,34 @@ function SocketUtil(hostname, port, ssl,</span>
<a href="#l9.4"></a><span id="l9.4">   var outstream = transport.openOutputStream(0, 0, 0);</span>
<a href="#l9.5"></a><span id="l9.5">   var stream = transport.openInputStream(0, 0, 0);</span>
<a href="#l9.6"></a><span id="l9.6">   var instream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l9.7"></a><span id="l9.7">       .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l9.8"></a><span id="l9.8">   instream.init(stream);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">   var dataListener = {</span>
<a href="#l9.11"></a><span id="l9.11">     data: [],</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    onStartRequest(request, context) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    onStartRequest(request) {</span>
<a href="#l9.14"></a><span id="l9.14">       try {</span>
<a href="#l9.15"></a><span id="l9.15">         initialized = true;</span>
<a href="#l9.16"></a><span id="l9.16">         if (!aborted) {</span>
<a href="#l9.17"></a><span id="l9.17">           // Send the first request</span>
<a href="#l9.18"></a><span id="l9.18">           let outputData = commands[index++];</span>
<a href="#l9.19"></a><span id="l9.19">           outstream.write(outputData, outputData.length);</span>
<a href="#l9.20"></a><span id="l9.20">         }</span>
<a href="#l9.21"></a><span id="l9.21">       } catch (e) { _error(e); }</span>
<a href="#l9.22"></a><span id="l9.22">     },</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-    onStopRequest(request, context, status) {</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+    onStopRequest(request, status) {</span>
<a href="#l9.25"></a><span id="l9.25">       try {</span>
<a href="#l9.26"></a><span id="l9.26">         instream.close();</span>
<a href="#l9.27"></a><span id="l9.27">         outstream.close();</span>
<a href="#l9.28"></a><span id="l9.28">         resultCallback(this.data.length ? this.data : null);</span>
<a href="#l9.29"></a><span id="l9.29">       } catch (e) { _error(e); }</span>
<a href="#l9.30"></a><span id="l9.30">     },</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    onDataAvailable(request, context, inputStream, offset, count) {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    onDataAvailable(request, inputStream, offset, count) {</span>
<a href="#l9.33"></a><span id="l9.33">       try {</span>
<a href="#l9.34"></a><span id="l9.34">         if (!aborted) {</span>
<a href="#l9.35"></a><span id="l9.35">           let inputData = instream.read(count);</span>
<a href="#l9.36"></a><span id="l9.36">           this.data.push(inputData);</span>
<a href="#l9.37"></a><span id="l9.37">           if (index &lt; commands.length) {</span>
<a href="#l9.38"></a><span id="l9.38">             // Send the next request to the server.</span>
<a href="#l9.39"></a><span id="l9.39">             let outputData = commands[index++];</span>
<a href="#l9.40"></a><span id="l9.40">             outstream.write(outputData, outputData.length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/cloudfile/box/box.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/cloudfile/box/box.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -139,17 +139,17 @@ nsBox.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">    * Private callback function passed to, and called from</span>
<a href="#l10.5"></a><span id="l10.5">    * nsBoxFileUploader.</span>
<a href="#l10.6"></a><span id="l10.6">    *</span>
<a href="#l10.7"></a><span id="l10.7">    * @param aRequestObserver a request observer for monitoring the start and</span>
<a href="#l10.8"></a><span id="l10.8">    *                         stop states of a request.</span>
<a href="#l10.9"></a><span id="l10.9">    * @param aStatus the status of the request.</span>
<a href="#l10.10"></a><span id="l10.10">    */</span>
<a href="#l10.11"></a><span id="l10.11">   _uploaderCallback(aRequestObserver, aStatus) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    aRequestObserver.onStopRequest(null, null, aStatus);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    aRequestObserver.onStopRequest(null, aStatus);</span>
<a href="#l10.14"></a><span id="l10.14">     this._uploadingFile = null;</span>
<a href="#l10.15"></a><span id="l10.15">     this._uploads.shift();</span>
<a href="#l10.16"></a><span id="l10.16">     if (this._uploads.length &gt; 0) {</span>
<a href="#l10.17"></a><span id="l10.17">       let nextUpload = this._uploads[0];</span>
<a href="#l10.18"></a><span id="l10.18">       this.log.info(&quot;chaining upload, file = &quot; + nextUpload.file.leafName);</span>
<a href="#l10.19"></a><span id="l10.19">       this._uploadingFile = nextUpload.file;</span>
<a href="#l10.20"></a><span id="l10.20">       this._uploader = nextUpload;</span>
<a href="#l10.21"></a><span id="l10.21">       try {</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -195,18 +195,17 @@ nsBox.prototype = {</span>
<a href="#l10.23"></a><span id="l10.23">       this._finishUpload(aFile, aCallback);</span>
<a href="#l10.24"></a><span id="l10.24">     }.bind(this);</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">     let onGetUserInfoSuccess = function() {</span>
<a href="#l10.27"></a><span id="l10.27">       this._initFolder(finish);</span>
<a href="#l10.28"></a><span id="l10.28">     }.bind(this);</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30">     let onAuthFailure = function() {</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-      aCallback.onStopRequest(null, null,</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-                              cloudFileAccounts.constants.authErr);</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+      aCallback.onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l10.34"></a><span id="l10.34">     };</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">     this.log.info(&quot;Checking to see if we're logged in&quot;);</span>
<a href="#l10.37"></a><span id="l10.37"> </span>
<a href="#l10.38"></a><span id="l10.38">     if (!this._loggedIn) {</span>
<a href="#l10.39"></a><span id="l10.39">       let onLoginSuccess = function() {</span>
<a href="#l10.40"></a><span id="l10.40">         this._getUserInfo(onGetUserInfoSuccess, onAuthFailure);</span>
<a href="#l10.41"></a><span id="l10.41">       }.bind(this);</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineat">@@ -231,21 +230,21 @@ nsBox.prototype = {</span>
<a href="#l10.43"></a><span id="l10.43">    * @param aFile the nsIFile to upload</span>
<a href="#l10.44"></a><span id="l10.44">    * @param aCallback the nsIRequestObserver for monitoring the start and stop</span>
<a href="#l10.45"></a><span id="l10.45">    *                  states of the upload procedure.</span>
<a href="#l10.46"></a><span id="l10.46">    */</span>
<a href="#l10.47"></a><span id="l10.47">   _finishUpload(aFile, aCallback) {</span>
<a href="#l10.48"></a><span id="l10.48">     let exceedsFileLimit = cloudFileAccounts.constants.uploadExceedsFileLimit;</span>
<a href="#l10.49"></a><span id="l10.49">     let exceedsQuota = cloudFileAccounts.constants.uploadWouldExceedQuota;</span>
<a href="#l10.50"></a><span id="l10.50">     if (aFile.fileSize &gt; this._maxFileSize) {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-      aCallback.onStopRequest(null, null, exceedsFileLimit);</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+      aCallback.onStopRequest(null, exceedsFileLimit);</span>
<a href="#l10.53"></a><span id="l10.53">       return;</span>
<a href="#l10.54"></a><span id="l10.54">     }</span>
<a href="#l10.55"></a><span id="l10.55">     if (aFile.fileSize &gt; this.remainingFileSpace) {</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-      aCallback.onStopRequest(null, null, exceedsQuota);</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+      aCallback.onStopRequest(null, exceedsQuota);</span>
<a href="#l10.58"></a><span id="l10.58">       return;</span>
<a href="#l10.59"></a><span id="l10.59">     }</span>
<a href="#l10.60"></a><span id="l10.60"> </span>
<a href="#l10.61"></a><span id="l10.61">     delete this._userInfo; // force us to update userInfo on every upload.</span>
<a href="#l10.62"></a><span id="l10.62"> </span>
<a href="#l10.63"></a><span id="l10.63">     if (!this._uploader) {</span>
<a href="#l10.64"></a><span id="l10.64">       this._uploader = new nsBoxFileUploader(this, aFile,</span>
<a href="#l10.65"></a><span id="l10.65">                                              this._uploaderCallback</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineat">@@ -265,17 +264,17 @@ nsBox.prototype = {</span>
<a href="#l10.67"></a><span id="l10.67">    */</span>
<a href="#l10.68"></a><span id="l10.68">   cancelFileUpload(aFile) {</span>
<a href="#l10.69"></a><span id="l10.69">     if (this._uploadingFile.equals(aFile)) {</span>
<a href="#l10.70"></a><span id="l10.70">       this._uploader.cancel();</span>
<a href="#l10.71"></a><span id="l10.71">     } else {</span>
<a href="#l10.72"></a><span id="l10.72">       for (let i = 0; i &lt; this._uploads.length; i++)</span>
<a href="#l10.73"></a><span id="l10.73">         if (this._uploads[i].file.equals(aFile)) {</span>
<a href="#l10.74"></a><span id="l10.74">           this._uploads[i].requestObserver.onStopRequest(</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-            null, null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+            null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l10.77"></a><span id="l10.77">           this._uploads.splice(i, 1);</span>
<a href="#l10.78"></a><span id="l10.78">           return;</span>
<a href="#l10.79"></a><span id="l10.79">         }</span>
<a href="#l10.80"></a><span id="l10.80">     }</span>
<a href="#l10.81"></a><span id="l10.81">   },</span>
<a href="#l10.82"></a><span id="l10.82"> </span>
<a href="#l10.83"></a><span id="l10.83">   /**</span>
<a href="#l10.84"></a><span id="l10.84">    * A private function for retrieving profile information about a user.</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineat">@@ -287,24 +286,24 @@ nsBox.prototype = {</span>
<a href="#l10.86"></a><span id="l10.86">    */</span>
<a href="#l10.87"></a><span id="l10.87">   _getUserInfo(successCallback, failureCallback) {</span>
<a href="#l10.88"></a><span id="l10.88">     let requestUrl = gServerUrl + &quot;users/me&quot;;</span>
<a href="#l10.89"></a><span id="l10.89">     this.log.info(&quot;get_account_info requestUrl = &quot; + requestUrl);</span>
<a href="#l10.90"></a><span id="l10.90"> </span>
<a href="#l10.91"></a><span id="l10.91">     if (!successCallback)</span>
<a href="#l10.92"></a><span id="l10.92">       successCallback = function() {</span>
<a href="#l10.93"></a><span id="l10.93">         this.requestObserver</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-            .onStopRequest(null, null,</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+            .onStopRequest(null,</span>
<a href="#l10.96"></a><span id="l10.96">                            this._loggedIn ? Cr.NS_OK : cloudFileAccounts.constants.authErr);</span>
<a href="#l10.97"></a><span id="l10.97">     }.bind(this);</span>
<a href="#l10.98"></a><span id="l10.98"> </span>
<a href="#l10.99"></a><span id="l10.99">     if (!failureCallback)</span>
<a href="#l10.100"></a><span id="l10.100">       failureCallback = function() {</span>
<a href="#l10.101"></a><span id="l10.101">         this.requestObserver</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-            .onStopRequest(null, null, cloudFileAccounts.constants.authErr);</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+            .onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l10.104"></a><span id="l10.104">     }.bind(this);</span>
<a href="#l10.105"></a><span id="l10.105"> </span>
<a href="#l10.106"></a><span id="l10.106">     let accountInfoSuccess = function(aResponseText, aRequest) {</span>
<a href="#l10.107"></a><span id="l10.107">       this.log.info(&quot;get_account_info request response = &quot; + aResponseText);</span>
<a href="#l10.108"></a><span id="l10.108"> </span>
<a href="#l10.109"></a><span id="l10.109">       try {</span>
<a href="#l10.110"></a><span id="l10.110">         this._userInfo = JSON.parse(aResponseText);</span>
<a href="#l10.111"></a><span id="l10.111"> </span>
<a href="#l10.112"></a><span id="l10.112" class="difflineat">@@ -353,17 +352,17 @@ nsBox.prototype = {</span>
<a href="#l10.113"></a><span id="l10.113">    * @param aFailureCallback the function called on failed information retrieval</span>
<a href="#l10.114"></a><span id="l10.114">    * @param aWithUI a boolean for whether or not we should display authorization</span>
<a href="#l10.115"></a><span id="l10.115">    *                UI if we don't have a valid token anymore, or just fail out.</span>
<a href="#l10.116"></a><span id="l10.116">    */</span>
<a href="#l10.117"></a><span id="l10.117">   _logonAndGetUserInfo(aSuccessCallback, aFailureCallback, aWithUI) {</span>
<a href="#l10.118"></a><span id="l10.118">     if (!aFailureCallback)</span>
<a href="#l10.119"></a><span id="l10.119">       aFailureCallback = function() {</span>
<a href="#l10.120"></a><span id="l10.120">         this.requestObserver</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-            .onStopRequest(null, null, cloudFileAccounts.constants.authErr);</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+            .onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l10.123"></a><span id="l10.123">       }.bind(this);</span>
<a href="#l10.124"></a><span id="l10.124"> </span>
<a href="#l10.125"></a><span id="l10.125">     return this.logon(function() {</span>
<a href="#l10.126"></a><span id="l10.126">       this._getUserInfo(aSuccessCallback, aFailureCallback);</span>
<a href="#l10.127"></a><span id="l10.127">     }.bind(this), aFailureCallback, aWithUI);</span>
<a href="#l10.128"></a><span id="l10.128">   },</span>
<a href="#l10.129"></a><span id="l10.129"> </span>
<a href="#l10.130"></a><span id="l10.130">   /**</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineat">@@ -384,23 +383,23 @@ nsBox.prototype = {</span>
<a href="#l10.132"></a><span id="l10.132">    * @param aCallback an nsIRequestObserver for observing the starting and</span>
<a href="#l10.133"></a><span id="l10.133">    *                  ending states of the request.</span>
<a href="#l10.134"></a><span id="l10.134">    */</span>
<a href="#l10.135"></a><span id="l10.135">   refreshUserInfo(aWithUI, aCallback) {</span>
<a href="#l10.136"></a><span id="l10.136">     this.log.info(&quot;Getting User Info 1 : &quot; + this._loggedIn);</span>
<a href="#l10.137"></a><span id="l10.137">     if (Services.io.offline)</span>
<a href="#l10.138"></a><span id="l10.138">       throw cloudFileAccounts.constants.offlineErr;</span>
<a href="#l10.139"></a><span id="l10.139">     this.requestObserver = aCallback;</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-    aCallback.onStartRequest(null, null);</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+    aCallback.onStartRequest(null);</span>
<a href="#l10.142"></a><span id="l10.142">     if (!this._loggedIn)</span>
<a href="#l10.143"></a><span id="l10.143">       return this._logonAndGetUserInfo(null, null, aWithUI);</span>
<a href="#l10.144"></a><span id="l10.144">     if (!this._userInfo)</span>
<a href="#l10.145"></a><span id="l10.145">       return this._getUserInfo();</span>
<a href="#l10.146"></a><span id="l10.146"> </span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-    aCallback.onStopRequest(null, null);</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+    aCallback.onStopRequest(null, null);  // XXX TODO: This looks wrong, second argument is a status.</span>
<a href="#l10.149"></a><span id="l10.149">     return this._userInfo;</span>
<a href="#l10.150"></a><span id="l10.150">   },</span>
<a href="#l10.151"></a><span id="l10.151"> </span>
<a href="#l10.152"></a><span id="l10.152">   /**</span>
<a href="#l10.153"></a><span id="l10.153">    * Our Box implementation does not implement the createNewAccount</span>
<a href="#l10.154"></a><span id="l10.154">    * function defined in nsIMsgCloudFileProvider.idl.</span>
<a href="#l10.155"></a><span id="l10.155">    */</span>
<a href="#l10.156"></a><span id="l10.156">   createNewAccount(aEmailAddress, aPassword, aFirstName, aLastName) {</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineat">@@ -531,22 +530,21 @@ nsBox.prototype = {</span>
<a href="#l10.158"></a><span id="l10.158">    * allows them to log in.</span>
<a href="#l10.159"></a><span id="l10.159">    *</span>
<a href="#l10.160"></a><span id="l10.160">    * @param aRequestObserver an nsIRequestObserver for monitoring the start and</span>
<a href="#l10.161"></a><span id="l10.161">    *                         stop states of the login procedure.</span>
<a href="#l10.162"></a><span id="l10.162">    */</span>
<a href="#l10.163"></a><span id="l10.163">   createExistingAccount(aRequestObserver) {</span>
<a href="#l10.164"></a><span id="l10.164">      // XXX: replace this with a better function</span>
<a href="#l10.165"></a><span id="l10.165">     let successCb = () =&gt; {</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-      aRequestObserver.onStopRequest(null, this, Cr.NS_OK);</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+      aRequestObserver.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l10.168"></a><span id="l10.168">     };</span>
<a href="#l10.169"></a><span id="l10.169"> </span>
<a href="#l10.170"></a><span id="l10.170">     let failureCb = (aResponseText) =&gt; {</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-      aRequestObserver.onStopRequest(null, this,</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineminus">-                                     cloudFileAccounts.constants.authErr);</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+      aRequestObserver.onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l10.174"></a><span id="l10.174">     };</span>
<a href="#l10.175"></a><span id="l10.175"> </span>
<a href="#l10.176"></a><span id="l10.176">     this.logon(successCb, failureCb, true);</span>
<a href="#l10.177"></a><span id="l10.177">   },</span>
<a href="#l10.178"></a><span id="l10.178"> </span>
<a href="#l10.179"></a><span id="l10.179">   /**</span>
<a href="#l10.180"></a><span id="l10.180">    * Returns an appropriate provider-specific URL for dealing with a particular</span>
<a href="#l10.181"></a><span id="l10.181">    * error type.</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineat">@@ -597,21 +595,21 @@ nsBox.prototype = {</span>
<a href="#l10.183"></a><span id="l10.183">     let requestUrl = gServerUrl + &quot;files/&quot; + uploadInfo.fileId;</span>
<a href="#l10.184"></a><span id="l10.184">     this.log.info(&quot;delete requestUrl = &quot; + requestUrl);</span>
<a href="#l10.185"></a><span id="l10.185"> </span>
<a href="#l10.186"></a><span id="l10.186">     let deleteSuccess = function(aResponseText, aRequest) {</span>
<a href="#l10.187"></a><span id="l10.187">       // An empty 204 is sent on successful delete.</span>
<a href="#l10.188"></a><span id="l10.188">       this.log.info(&quot;delete request response = &quot; + aRequest.status);</span>
<a href="#l10.189"></a><span id="l10.189"> </span>
<a href="#l10.190"></a><span id="l10.190">       if (aRequest.status != 204)</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineminus">-        aCallback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+        aCallback.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l10.193"></a><span id="l10.193">     }.bind(this);</span>
<a href="#l10.194"></a><span id="l10.194">     let deleteFailure = function(aException, aResponseText, aRequest) {</span>
<a href="#l10.195"></a><span id="l10.195">       this.log.error(&quot;Failed to delete file:&quot; + aResponseText);</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineminus">-      aCallback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+      aCallback.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l10.198"></a><span id="l10.198">     }.bind(this);</span>
<a href="#l10.199"></a><span id="l10.199"> </span>
<a href="#l10.200"></a><span id="l10.200">     // Request to delete a file</span>
<a href="#l10.201"></a><span id="l10.201">     httpRequest(requestUrl, {</span>
<a href="#l10.202"></a><span id="l10.202">                   onLoad: deleteSuccess,</span>
<a href="#l10.203"></a><span id="l10.203">                   onError: deleteFailure,</span>
<a href="#l10.204"></a><span id="l10.204">                   method: &quot;DELETE&quot;,</span>
<a href="#l10.205"></a><span id="l10.205">                   headers: [[&quot;Authorization&quot;, &quot;Bearer &quot; + this._oauth.accessToken]],</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/cloudfile/box/management.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/cloudfile/box/management.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -24,17 +24,17 @@ if (cloudFileAccounts.getSecretValue(acc</span>
<a href="#l11.4"></a><span id="l11.4"> function onDoAuth(button) {</span>
<a href="#l11.5"></a><span id="l11.5">   button.disabled = true;</span>
<a href="#l11.6"></a><span id="l11.6">   loading.hidden = false;</span>
<a href="#l11.7"></a><span id="l11.7">   auth.hidden = true;</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   account.createExistingAccount({</span>
<a href="#l11.10"></a><span id="l11.10">     onStartRequest() {</span>
<a href="#l11.11"></a><span id="l11.11">     },</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    onStopRequest(unused1, unused2, error) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    onStopRequest(unused1, error) {</span>
<a href="#l11.14"></a><span id="l11.14">       button.disabled = false;</span>
<a href="#l11.15"></a><span id="l11.15">       if (error) {</span>
<a href="#l11.16"></a><span id="l11.16">         loading.hidden = true;</span>
<a href="#l11.17"></a><span id="l11.17">         auth.hidden = false;</span>
<a href="#l11.18"></a><span id="l11.18">         return;</span>
<a href="#l11.19"></a><span id="l11.19">       }</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">       cloudFileAccounts.emit(&quot;accountConfigured&quot;, account);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/cloudfile/hightail/hightail.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/cloudfile/hightail/hightail.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -129,17 +129,17 @@ nsHightail.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">    * Private callback function passed to, and called from</span>
<a href="#l12.5"></a><span id="l12.5">    * nsHightailFileUploader.</span>
<a href="#l12.6"></a><span id="l12.6">    *</span>
<a href="#l12.7"></a><span id="l12.7">    * @param aRequestObserver a request observer for monitoring the start and</span>
<a href="#l12.8"></a><span id="l12.8">    *                         stop states of a request.</span>
<a href="#l12.9"></a><span id="l12.9">    * @param aStatus the status of the request.</span>
<a href="#l12.10"></a><span id="l12.10">    */</span>
<a href="#l12.11"></a><span id="l12.11">   _uploaderCallback(aRequestObserver, aStatus) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    aRequestObserver.onStopRequest(null, null, aStatus);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    aRequestObserver.onStopRequest(null, aStatus);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">     this._uploadingFile = null;</span>
<a href="#l12.16"></a><span id="l12.16">     this._uploads.shift();</span>
<a href="#l12.17"></a><span id="l12.17">     if (this._uploads.length &gt; 0) {</span>
<a href="#l12.18"></a><span id="l12.18">       let nextUpload = this._uploads[0];</span>
<a href="#l12.19"></a><span id="l12.19">       this.log.info(&quot;chaining upload, file = &quot; + nextUpload.file.leafName);</span>
<a href="#l12.20"></a><span id="l12.20">       this._uploadingFile = nextUpload.file;</span>
<a href="#l12.21"></a><span id="l12.21">       this._uploader = nextUpload;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -184,18 +184,17 @@ nsHightail.prototype = {</span>
<a href="#l12.23"></a><span id="l12.23">       this._finishUpload(aFile, aCallback);</span>
<a href="#l12.24"></a><span id="l12.24">     }.bind(this);</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">     let onGetUserInfoSuccess = function() {</span>
<a href="#l12.27"></a><span id="l12.27">       this._initFolder(finish);</span>
<a href="#l12.28"></a><span id="l12.28">     }.bind(this);</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">     let onAuthFailure = function() {</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-      aCallback.onStopRequest(null, null,</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-                              cloudFileAccounts.constants.authErr);</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+      aCallback.onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l12.34"></a><span id="l12.34">     };</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36">     this.log.info(&quot;Checking to see if we're logged in&quot;);</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38">     if (!this._loggedIn) {</span>
<a href="#l12.39"></a><span id="l12.39">       let onLoginSuccess = function() {</span>
<a href="#l12.40"></a><span id="l12.40">         this._getUserInfo(onGetUserInfoSuccess, onAuthFailure);</span>
<a href="#l12.41"></a><span id="l12.41">       }.bind(this);</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineat">@@ -261,34 +260,34 @@ nsHightail.prototype = {</span>
<a href="#l12.43"></a><span id="l12.43">     let args = {storage: aStorageSize};</span>
<a href="#l12.44"></a><span id="l12.44">     args.wrappedJSObject = args;</span>
<a href="#l12.45"></a><span id="l12.45">     Services.ww.openWindow(null,</span>
<a href="#l12.46"></a><span id="l12.46">                            &quot;chrome://messenger/content/cloudfile/Hightail/&quot;</span>
<a href="#l12.47"></a><span id="l12.47">                            + &quot;fileExceeds&quot; + aType + &quot;.xul&quot;,</span>
<a href="#l12.48"></a><span id="l12.48">                            &quot;Hightail&quot;, &quot;chrome,centerscreen,dialog,modal,resizable=yes&quot;,</span>
<a href="#l12.49"></a><span id="l12.49">                            args).focus();</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-    return aCallback.onStopRequest(null, null, cancel);</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+    return aCallback.onStopRequest(null, cancel);</span>
<a href="#l12.53"></a><span id="l12.53">   },</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55">   /**</span>
<a href="#l12.56"></a><span id="l12.56">    * Cancels an in-progress file upload.</span>
<a href="#l12.57"></a><span id="l12.57">    *</span>
<a href="#l12.58"></a><span id="l12.58">    * @param aFile the nsIFile being uploaded.</span>
<a href="#l12.59"></a><span id="l12.59">    */</span>
<a href="#l12.60"></a><span id="l12.60">   cancelFileUpload(aFile) {</span>
<a href="#l12.61"></a><span id="l12.61">     this.log.info(&quot;in cancel upload&quot;);</span>
<a href="#l12.62"></a><span id="l12.62">     if (this._uploadingFile != null &amp;&amp; this._uploader != null &amp;&amp;</span>
<a href="#l12.63"></a><span id="l12.63">         this._uploadingFile.equals(aFile)) {</span>
<a href="#l12.64"></a><span id="l12.64">       this._uploader.cancel();</span>
<a href="#l12.65"></a><span id="l12.65">     } else {</span>
<a href="#l12.66"></a><span id="l12.66">       for (let i = 0; i &lt; this._uploads.length; i++)</span>
<a href="#l12.67"></a><span id="l12.67">         if (this._uploads[i].file.equals(aFile)) {</span>
<a href="#l12.68"></a><span id="l12.68">           this._uploads[i].requestObserver.onStopRequest(</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-            null, null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+            null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l12.71"></a><span id="l12.71">           this._uploads.splice(i, 1);</span>
<a href="#l12.72"></a><span id="l12.72">           return;</span>
<a href="#l12.73"></a><span id="l12.73">         }</span>
<a href="#l12.74"></a><span id="l12.74">     }</span>
<a href="#l12.75"></a><span id="l12.75">   },</span>
<a href="#l12.76"></a><span id="l12.76"> </span>
<a href="#l12.77"></a><span id="l12.77">   /**</span>
<a href="#l12.78"></a><span id="l12.78">    * A private function for dealing with stale tokens.  Attempts to refresh</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineat">@@ -401,26 +400,25 @@ nsHightail.prototype = {</span>
<a href="#l12.80"></a><span id="l12.80">    *                a password if we don't have a proper token.</span>
<a href="#l12.81"></a><span id="l12.81">    * @param aListener an nsIRequestObserver for monitoring the start and stop</span>
<a href="#l12.82"></a><span id="l12.82">    *                  states of fetching profile information.</span>
<a href="#l12.83"></a><span id="l12.83">    */</span>
<a href="#l12.84"></a><span id="l12.84">   refreshUserInfo(aWithUI, aListener) {</span>
<a href="#l12.85"></a><span id="l12.85">     if (Services.io.offline)</span>
<a href="#l12.86"></a><span id="l12.86">       throw cloudFileAccounts.constants.offlineErr;</span>
<a href="#l12.87"></a><span id="l12.87"> </span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-    aListener.onStartRequest(null, null);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+    aListener.onStartRequest(null);</span>
<a href="#l12.90"></a><span id="l12.90"> </span>
<a href="#l12.91"></a><span id="l12.91">     // Let's define some reusable callback functions...</span>
<a href="#l12.92"></a><span id="l12.92">     let onGetUserInfoSuccess = function() {</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-      aListener.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+      aListener.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l12.95"></a><span id="l12.95">     };</span>
<a href="#l12.96"></a><span id="l12.96"> </span>
<a href="#l12.97"></a><span id="l12.97">     let onAuthFailure = function() {</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-      aListener.onStopRequest(null, null,</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-                              cloudFileAccounts.constants.authErr);</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+      aListener.onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l12.101"></a><span id="l12.101">     };</span>
<a href="#l12.102"></a><span id="l12.102"> </span>
<a href="#l12.103"></a><span id="l12.103">     // If we're not logged in, attempt to login, and then attempt to</span>
<a href="#l12.104"></a><span id="l12.104">     // get user info if logging in is successful.</span>
<a href="#l12.105"></a><span id="l12.105">     this.log.info(&quot;Checking to see if we're logged in&quot;);</span>
<a href="#l12.106"></a><span id="l12.106">     if (!this._loggedIn) {</span>
<a href="#l12.107"></a><span id="l12.107">       let onLoginSuccess = function() {</span>
<a href="#l12.108"></a><span id="l12.108">         this._getUserInfo(onGetUserInfoSuccess, onAuthFailure);</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineat">@@ -450,28 +448,28 @@ nsHightail.prototype = {</span>
<a href="#l12.110"></a><span id="l12.110"> </span>
<a href="#l12.111"></a><span id="l12.111">     req.open(&quot;POST&quot;, gServerUrl + kUserInfoPath + args + kUrlTail, true);</span>
<a href="#l12.112"></a><span id="l12.112"> </span>
<a href="#l12.113"></a><span id="l12.113">     req.onload = function() {</span>
<a href="#l12.114"></a><span id="l12.114">       if (req.status &gt;= 200 &amp;&amp;</span>
<a href="#l12.115"></a><span id="l12.115">           req.status &lt; 400) {</span>
<a href="#l12.116"></a><span id="l12.116">         this.log.info(&quot;request status = &quot; + req + &quot; response = &quot; +</span>
<a href="#l12.117"></a><span id="l12.117">                       req.responseText);</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineminus">-        aRequestObserver.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+        aRequestObserver.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l12.120"></a><span id="l12.120">       } else {</span>
<a href="#l12.121"></a><span id="l12.121">         let docResponse = JSON.parse(req.responseText);</span>
<a href="#l12.122"></a><span id="l12.122">         this._lastErrorText = docResponse.errorStatus.message;</span>
<a href="#l12.123"></a><span id="l12.123">         this._lastErrorStatus = docResponse.errorStatus.code;</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-        aRequestObserver.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+        aRequestObserver.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l12.126"></a><span id="l12.126">       }</span>
<a href="#l12.127"></a><span id="l12.127">     }.bind(this);</span>
<a href="#l12.128"></a><span id="l12.128"> </span>
<a href="#l12.129"></a><span id="l12.129">     req.onerror = function() {</span>
<a href="#l12.130"></a><span id="l12.130">       this.log.info(&quot;getUserInfo failed - status = &quot; + req.status);</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-      aRequestObserver.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+      aRequestObserver.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l12.133"></a><span id="l12.133">     }.bind(this);</span>
<a href="#l12.134"></a><span id="l12.134">     // Add a space at the end because http logging looks for two</span>
<a href="#l12.135"></a><span id="l12.135">     // spaces in the X-Auth-Token header to avoid putting passwords</span>
<a href="#l12.136"></a><span id="l12.136">     // in the log, and crashes if there aren't two spaces.</span>
<a href="#l12.137"></a><span id="l12.137">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this._cachedAuthToken + &quot; &quot;);</span>
<a href="#l12.138"></a><span id="l12.138">     req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l12.139"></a><span id="l12.139">     req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l12.140"></a><span id="l12.140">     req.send();</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineat">@@ -606,23 +604,22 @@ nsHightail.prototype = {</span>
<a href="#l12.142"></a><span id="l12.142">    * allows them to log in.</span>
<a href="#l12.143"></a><span id="l12.143">    *</span>
<a href="#l12.144"></a><span id="l12.144">    * @param aRequestObserver an nsIRequestObserver for monitoring the start and</span>
<a href="#l12.145"></a><span id="l12.145">    *                         stop states of the login procedure.</span>
<a href="#l12.146"></a><span id="l12.146">    */</span>
<a href="#l12.147"></a><span id="l12.147">   createExistingAccount(aRequestObserver) {</span>
<a href="#l12.148"></a><span id="l12.148">      // XXX: replace this with a better function</span>
<a href="#l12.149"></a><span id="l12.149">     let successCb = function(aResponseText, aRequest) {</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineminus">-      aRequestObserver.onStopRequest(null, this, Cr.NS_OK);</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineminus">-    }.bind(this);</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineplus">+      aRequestObserver.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineplus">+    };</span>
<a href="#l12.154"></a><span id="l12.154"> </span>
<a href="#l12.155"></a><span id="l12.155">     let failureCb = function(aResponseText, aRequest) {</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-      aRequestObserver.onStopRequest(null, this,</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-                                     cloudFileAccounts.constants.authErr);</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-    }.bind(this);</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+      aRequestObserver.onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineplus">+    };</span>
<a href="#l12.161"></a><span id="l12.161"> </span>
<a href="#l12.162"></a><span id="l12.162">     this.logon(successCb, failureCb, true);</span>
<a href="#l12.163"></a><span id="l12.163">   },</span>
<a href="#l12.164"></a><span id="l12.164"> </span>
<a href="#l12.165"></a><span id="l12.165">   /**</span>
<a href="#l12.166"></a><span id="l12.166">    * Returns an appropriate provider-specific URL for dealing with a particular</span>
<a href="#l12.167"></a><span id="l12.167">    * error type.</span>
<a href="#l12.168"></a><span id="l12.168">    *</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineat">@@ -678,17 +675,17 @@ nsHightail.prototype = {</span>
<a href="#l12.170"></a><span id="l12.170">     req.open(&quot;DELETE&quot;, gServerUrl + args + kUrlTail, true);</span>
<a href="#l12.171"></a><span id="l12.171">     this.log.info(&quot;Sending request to: &quot; + gServerUrl + args);</span>
<a href="#l12.172"></a><span id="l12.172"> </span>
<a href="#l12.173"></a><span id="l12.173">     req.onerror = function() {</span>
<a href="#l12.174"></a><span id="l12.174">       let response = JSON.parse(req.responseText);</span>
<a href="#l12.175"></a><span id="l12.175">       this._lastErrorStatus = response.errorStatus.status;</span>
<a href="#l12.176"></a><span id="l12.176">       this._lastErrorText = response.errorStatus.message;</span>
<a href="#l12.177"></a><span id="l12.177">       this.log.error(&quot;There was a problem deleting: &quot; + this._lastErrorText);</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineminus">-      aCallback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineplus">+      aCallback.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l12.180"></a><span id="l12.180">     }.bind(this);</span>
<a href="#l12.181"></a><span id="l12.181"> </span>
<a href="#l12.182"></a><span id="l12.182">     req.onload = function() {</span>
<a href="#l12.183"></a><span id="l12.183">       // Response is the URL.</span>
<a href="#l12.184"></a><span id="l12.184">       let response = req.responseText;</span>
<a href="#l12.185"></a><span id="l12.185">       this.log.info(&quot;delete response = &quot; + response);</span>
<a href="#l12.186"></a><span id="l12.186">       let deleteInfo = JSON.parse(response);</span>
<a href="#l12.187"></a><span id="l12.187"> </span>
<a href="#l12.188"></a><span id="l12.188" class="difflineat">@@ -698,34 +695,32 @@ nsHightail.prototype = {</span>
<a href="#l12.189"></a><span id="l12.189">         if (deleteInfo.errorStatus.code == 401) {</span>
<a href="#l12.190"></a><span id="l12.190">           this.log.warn(&quot;Token has gone stale! Will attempt to reauth.&quot;);</span>
<a href="#l12.191"></a><span id="l12.191">           // Our token has gone stale</span>
<a href="#l12.192"></a><span id="l12.192">           let onTokenRefresh = function() {</span>
<a href="#l12.193"></a><span id="l12.193">             this.deleteFile(aFile, aCallback);</span>
<a href="#l12.194"></a><span id="l12.194">           }.bind(this);</span>
<a href="#l12.195"></a><span id="l12.195"> </span>
<a href="#l12.196"></a><span id="l12.196">           let onTokenRefreshFailure = function() {</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-            aCallback.onStopRequest(null, null,</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-                                    cloudFileAccounts.constants.authErr);</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineplus">+            aCallback.onStopRequest(null, cloudFileAccounts.constants.authErr);</span>
<a href="#l12.200"></a><span id="l12.200">           };</span>
<a href="#l12.201"></a><span id="l12.201">           this._handleStaleToken(onTokenRefresh, onTokenRefreshFailure);</span>
<a href="#l12.202"></a><span id="l12.202">           return;</span>
<a href="#l12.203"></a><span id="l12.203">         }</span>
<a href="#l12.204"></a><span id="l12.204"> </span>
<a href="#l12.205"></a><span id="l12.205">         this.log.error(&quot;Server has returned a failure on our delete request.&quot;);</span>
<a href="#l12.206"></a><span id="l12.206">         this.log.error(&quot;Error code: &quot; + deleteInfo.errorStatus.code);</span>
<a href="#l12.207"></a><span id="l12.207">         this.log.error(&quot;Error message: &quot; + deleteInfo.errorStatus.message);</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineminus">-        // aCallback.onStopRequest(null, null,</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineminus">-        //                         Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineplus">+        // aCallback.onStopRequest(null, Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l12.211"></a><span id="l12.211">         return;</span>
<a href="#l12.212"></a><span id="l12.212">       }</span>
<a href="#l12.213"></a><span id="l12.213"> </span>
<a href="#l12.214"></a><span id="l12.214">       this.log.info(&quot;Delete was successful!&quot;);</span>
<a href="#l12.215"></a><span id="l12.215">       // Success!</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineminus">-      aCallback.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineplus">+      aCallback.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l12.218"></a><span id="l12.218">     }.bind(this);</span>
<a href="#l12.219"></a><span id="l12.219"> </span>
<a href="#l12.220"></a><span id="l12.220">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this._cachedAuthToken + &quot; &quot;);</span>
<a href="#l12.221"></a><span id="l12.221">     req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l12.222"></a><span id="l12.222">     req.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span>
<a href="#l12.223"></a><span id="l12.223">     req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l12.224"></a><span id="l12.224">     req.send();</span>
<a href="#l12.225"></a><span id="l12.225">   },</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineat">@@ -875,17 +870,17 @@ nsHightailFileUploader.prototype = {</span>
<a href="#l12.227"></a><span id="l12.227">   file: null,</span>
<a href="#l12.228"></a><span id="l12.228">   callback: null,</span>
<a href="#l12.229"></a><span id="l12.229">   _request: null,</span>
<a href="#l12.230"></a><span id="l12.230"> </span>
<a href="#l12.231"></a><span id="l12.231">   /**</span>
<a href="#l12.232"></a><span id="l12.232">    * Kicks off the upload procedure for this uploader.</span>
<a href="#l12.233"></a><span id="l12.233">    */</span>
<a href="#l12.234"></a><span id="l12.234">   startUpload() {</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineminus">-    this.requestObserver.onStartRequest(null, null);</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+    this.requestObserver.onStartRequest(null);</span>
<a href="#l12.237"></a><span id="l12.237"> </span>
<a href="#l12.238"></a><span id="l12.238">     let onSuccess = function() {</span>
<a href="#l12.239"></a><span id="l12.239">       this._uploadFile();</span>
<a href="#l12.240"></a><span id="l12.240">     }.bind(this);</span>
<a href="#l12.241"></a><span id="l12.241"> </span>
<a href="#l12.242"></a><span id="l12.242">     let onFailure = function() {</span>
<a href="#l12.243"></a><span id="l12.243">       this.callback(this.requestObserver, cloudFileAccounts.constants.uploadErr);</span>
<a href="#l12.244"></a><span id="l12.244">     }.bind(this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/cloudfile/hightail/management.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/cloudfile/hightail/management.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -24,17 +24,17 @@ if (cloudFileAccounts.getSecretValue(acc</span>
<a href="#l13.4"></a><span id="l13.4"> function onDoAuth(button) {</span>
<a href="#l13.5"></a><span id="l13.5">   button.disabled = true;</span>
<a href="#l13.6"></a><span id="l13.6">   loading.hidden = false;</span>
<a href="#l13.7"></a><span id="l13.7">   auth.hidden = true;</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">   account.createExistingAccount({</span>
<a href="#l13.10"></a><span id="l13.10">     onStartRequest() {</span>
<a href="#l13.11"></a><span id="l13.11">     },</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    onStopRequest(unused1, unused2, error) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    onStopRequest(unused1, error) {</span>
<a href="#l13.14"></a><span id="l13.14">       button.disabled = false;</span>
<a href="#l13.15"></a><span id="l13.15">       if (error) {</span>
<a href="#l13.16"></a><span id="l13.16">         loading.hidden = true;</span>
<a href="#l13.17"></a><span id="l13.17">         auth.hidden = false;</span>
<a href="#l13.18"></a><span id="l13.18">         return;</span>
<a href="#l13.19"></a><span id="l13.19">       }</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21">       cloudFileAccounts.emit(&quot;accountConfigured&quot;, account);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1506,24 +1506,24 @@ function uploadListener(aAttachment, aFi</span>
<a href="#l14.4"></a><span id="l14.4">         cloudFileAccounts.getDisplayName(this.cloudProvider),</span>
<a href="#l14.5"></a><span id="l14.5">       ]));</span>
<a href="#l14.6"></a><span id="l14.6">     item.uploading = true;</span>
<a href="#l14.7"></a><span id="l14.7">     item.cloudProvider = this.cloudProvider;</span>
<a href="#l14.8"></a><span id="l14.8">   }</span>
<a href="#l14.9"></a><span id="l14.9"> }</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> uploadListener.prototype = {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  onStartRequest(aRequest, aContext) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  onStartRequest(aRequest) {</span>
<a href="#l14.14"></a><span id="l14.14">     let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l14.15"></a><span id="l14.15">     let item = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l14.16"></a><span id="l14.16">     if (item)</span>
<a href="#l14.17"></a><span id="l14.17">       item.image = &quot;chrome://global/skin/icons/loading.png&quot;;</span>
<a href="#l14.18"></a><span id="l14.18">   },</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-  onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+  onStopRequest(aRequest, aStatusCode) {</span>
<a href="#l14.22"></a><span id="l14.22">     let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l14.23"></a><span id="l14.23">     let attachmentItem = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">     if (Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l14.26"></a><span id="l14.26">       let originalUrl = this.attachment.url;</span>
<a href="#l14.27"></a><span id="l14.27">       this.attachment.contentLocation = this.cloudProvider.urlForFile(this.file);</span>
<a href="#l14.28"></a><span id="l14.28">       this.attachment.cloudProviderKey = this.cloudProvider.accountKey;</span>
<a href="#l14.29"></a><span id="l14.29">       if (attachmentItem) {</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineat">@@ -1634,20 +1634,20 @@ uploadListener.prototype = {</span>
<a href="#l14.31"></a><span id="l14.31"> };</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33"> function deletionListener(aAttachment, aCloudProvider) {</span>
<a href="#l14.34"></a><span id="l14.34">   this.attachment = aAttachment;</span>
<a href="#l14.35"></a><span id="l14.35">   this.cloudProvider = aCloudProvider;</span>
<a href="#l14.36"></a><span id="l14.36"> }</span>
<a href="#l14.37"></a><span id="l14.37"> </span>
<a href="#l14.38"></a><span id="l14.38"> deletionListener.prototype = {</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-  onStartRequest(aRequest, aContext) {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+  onStartRequest(aRequest) {</span>
<a href="#l14.41"></a><span id="l14.41">   },</span>
<a href="#l14.42"></a><span id="l14.42"> </span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-  onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+  onStopRequest(aRequest, aStatusCode) {</span>
<a href="#l14.45"></a><span id="l14.45">     if (!Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l14.46"></a><span id="l14.46">       let displayName = cloudFileAccounts.getDisplayName(this.cloudProvider);</span>
<a href="#l14.47"></a><span id="l14.47">       Services.prompt.alert(window,</span>
<a href="#l14.48"></a><span id="l14.48">         getComposeBundle().getString(&quot;errorCloudFileDeletion.title&quot;),</span>
<a href="#l14.49"></a><span id="l14.49">         getComposeBundle().getFormattedString(&quot;errorCloudFileDeletion.message&quot;,</span>
<a href="#l14.50"></a><span id="l14.50">                                               [displayName,</span>
<a href="#l14.51"></a><span id="l14.51">                                                this.attachment.name]));</span>
<a href="#l14.52"></a><span id="l14.52">     }</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineat">@@ -1686,17 +1686,17 @@ function attachToCloud(aProvider) {</span>
<a href="#l14.54"></a><span id="l14.54">     let attachments = files.map(f =&gt; FileToAttachment(f));</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56">     let i = 0;</span>
<a href="#l14.57"></a><span id="l14.57">     AddAttachments(attachments, function(aItem) {</span>
<a href="#l14.58"></a><span id="l14.58">       let listener = new uploadListener(attachments[i], files[i], aProvider);</span>
<a href="#l14.59"></a><span id="l14.59">       try {</span>
<a href="#l14.60"></a><span id="l14.60">         aProvider.uploadFile(files[i], listener);</span>
<a href="#l14.61"></a><span id="l14.61">       } catch (ex) {</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-        listener.onStopRequest(null, null, ex.result);</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+        listener.onStopRequest(null, ex.result);</span>
<a href="#l14.64"></a><span id="l14.64">       }</span>
<a href="#l14.65"></a><span id="l14.65">       i++;</span>
<a href="#l14.66"></a><span id="l14.66">     });</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68">     dispatchAttachmentBucketEvent(&quot;attachments-uploading&quot;, attachments);</span>
<a href="#l14.69"></a><span id="l14.69">     SetLastAttachDirectory(files[files.length - 1]);</span>
<a href="#l14.70"></a><span id="l14.70">   });</span>
<a href="#l14.71"></a><span id="l14.71"> }</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineat">@@ -1734,17 +1734,17 @@ function convertListItemsToCloudAttachme</span>
<a href="#l14.73"></a><span id="l14.73">         file, new deletionListener(item.attachment, item.cloudProvider));</span>
<a href="#l14.74"></a><span id="l14.74">     }</span>
<a href="#l14.75"></a><span id="l14.75"> </span>
<a href="#l14.76"></a><span id="l14.76">     let listener = new uploadListener(item.attachment, file, aProvider);</span>
<a href="#l14.77"></a><span id="l14.77">     try {</span>
<a href="#l14.78"></a><span id="l14.78">       aProvider.uploadFile(file, listener);</span>
<a href="#l14.79"></a><span id="l14.79">       convertedAttachments.appendElement(item.attachment);</span>
<a href="#l14.80"></a><span id="l14.80">     } catch (ex) {</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-      listener.onStopRequest(null, null, ex.result);</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+      listener.onStopRequest(null, ex.result);</span>
<a href="#l14.83"></a><span id="l14.83">     }</span>
<a href="#l14.84"></a><span id="l14.84">   }</span>
<a href="#l14.85"></a><span id="l14.85"> </span>
<a href="#l14.86"></a><span id="l14.86">   if (convertedAttachments.length &gt; 0) {</span>
<a href="#l14.87"></a><span id="l14.87">     dispatchAttachmentBucketEvent(&quot;attachments-converted&quot;, convertedAttachments);</span>
<a href="#l14.88"></a><span id="l14.88">     Services.obs.notifyObservers(convertedAttachments,</span>
<a href="#l14.89"></a><span id="l14.89">                                  &quot;mail:attachmentsConverted&quot;,</span>
<a href="#l14.90"></a><span id="l14.90">                                  aProvider.accountKey);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-cloudFile.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-cloudFile.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -97,35 +97,35 @@ class CloudFileAccount {</span>
<a href="#l15.4"></a><span id="l15.4">       this._fileIds.set(file.path, id);</span>
<a href="#l15.5"></a><span id="l15.5">       results = await this.extension.emit(&quot;uploadFile&quot;, this, {</span>
<a href="#l15.6"></a><span id="l15.6">         id,</span>
<a href="#l15.7"></a><span id="l15.7">         name: file.leafName,</span>
<a href="#l15.8"></a><span id="l15.8">         data: buffer,</span>
<a href="#l15.9"></a><span id="l15.9">       });</span>
<a href="#l15.10"></a><span id="l15.10">     } catch (ex) {</span>
<a href="#l15.11"></a><span id="l15.11">       if (ex.result == 0x80530014) { // NS_ERROR_DOM_ABORT_ERR</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        callback.onStopRequest(null, null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        callback.onStopRequest(null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l15.14"></a><span id="l15.14">       } else {</span>
<a href="#l15.15"></a><span id="l15.15">         console.error(ex);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-        callback.onStopRequest(null, null, cloudFileAccounts.constants.uploadErr);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+        callback.onStopRequest(null, cloudFileAccounts.constants.uploadErr);</span>
<a href="#l15.18"></a><span id="l15.18">       }</span>
<a href="#l15.19"></a><span id="l15.19">       return;</span>
<a href="#l15.20"></a><span id="l15.20">     }</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">     if (results &amp;&amp; results.length &gt; 0) {</span>
<a href="#l15.23"></a><span id="l15.23">       if (results[0].aborted) {</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-        callback.onStopRequest(null, null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+        callback.onStopRequest(null, cloudFileAccounts.constants.uploadCancelled);</span>
<a href="#l15.26"></a><span id="l15.26">         return;</span>
<a href="#l15.27"></a><span id="l15.27">       }</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">       let url = results[0].url;</span>
<a href="#l15.30"></a><span id="l15.30">       this._fileUrls.set(file.path, url);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-      callback.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+      callback.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l15.33"></a><span id="l15.33">     } else {</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-      callback.onStopRequest(null, null, cloudFileAccounts.constants.uploadErr);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+      callback.onStopRequest(null, cloudFileAccounts.constants.uploadErr);</span>
<a href="#l15.36"></a><span id="l15.36">       throw new ExtensionUtils.ExtensionError(</span>
<a href="#l15.37"></a><span id="l15.37">         `Missing cloudFile.onFileUpload listener for ${this.extension.id}`</span>
<a href="#l15.38"></a><span id="l15.38">       );</span>
<a href="#l15.39"></a><span id="l15.39">     }</span>
<a href="#l15.40"></a><span id="l15.40">   }</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42">   urlForFile(file) {</span>
<a href="#l15.43"></a><span id="l15.43">     return this._fileUrls.get(file.path);</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineat">@@ -136,50 +136,50 @@ class CloudFileAccount {</span>
<a href="#l15.45"></a><span id="l15.45">       id: this._fileIds.get(file.path),</span>
<a href="#l15.46"></a><span id="l15.46">     });</span>
<a href="#l15.47"></a><span id="l15.47">   }</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">   refreshUserInfo(withUI, callback) {</span>
<a href="#l15.50"></a><span id="l15.50">     if (Services.io.offline) {</span>
<a href="#l15.51"></a><span id="l15.51">       throw cloudFileAccounts.constants.offlineErr;</span>
<a href="#l15.52"></a><span id="l15.52">     }</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-    callback.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+    callback.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l15.55"></a><span id="l15.55">   }</span>
<a href="#l15.56"></a><span id="l15.56"> </span>
<a href="#l15.57"></a><span id="l15.57">   async deleteFile(file, callback) {</span>
<a href="#l15.58"></a><span id="l15.58">     let results;</span>
<a href="#l15.59"></a><span id="l15.59">     try {</span>
<a href="#l15.60"></a><span id="l15.60">       if (this._fileIds.has(file.path)) {</span>
<a href="#l15.61"></a><span id="l15.61">         let id = this._fileIds.get(file.path);</span>
<a href="#l15.62"></a><span id="l15.62">         results = await this.extension.emit(&quot;deleteFile&quot;, this, { id });</span>
<a href="#l15.63"></a><span id="l15.63">       }</span>
<a href="#l15.64"></a><span id="l15.64">     } catch (ex) {</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-      callback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+      callback.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l15.67"></a><span id="l15.67">     }</span>
<a href="#l15.68"></a><span id="l15.68"> </span>
<a href="#l15.69"></a><span id="l15.69">     if (results &amp;&amp; results.length &gt; 0) {</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-      callback.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+      callback.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l15.72"></a><span id="l15.72">     } else {</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-      callback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+      callback.onStopRequest(null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l15.75"></a><span id="l15.75">       throw new ExtensionUtils.ExtensionError(</span>
<a href="#l15.76"></a><span id="l15.76">         `Missing cloudFile.onFileDeleted listener for ${this.extension.id}`</span>
<a href="#l15.77"></a><span id="l15.77">       );</span>
<a href="#l15.78"></a><span id="l15.78">     }</span>
<a href="#l15.79"></a><span id="l15.79">   }</span>
<a href="#l15.80"></a><span id="l15.80"> </span>
<a href="#l15.81"></a><span id="l15.81">   createNewAccount(...args) {</span>
<a href="#l15.82"></a><span id="l15.82">     throw Cr.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l15.83"></a><span id="l15.83">   }</span>
<a href="#l15.84"></a><span id="l15.84"> </span>
<a href="#l15.85"></a><span id="l15.85">   createExistingAccount(callback) {</span>
<a href="#l15.86"></a><span id="l15.86">     if (Services.io.offline) {</span>
<a href="#l15.87"></a><span id="l15.87">       throw cloudFileAccounts.constants.offlineErr;</span>
<a href="#l15.88"></a><span id="l15.88">     }</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-    // We're assuming everything is ok here. Maybe expose this in the future if there is a need</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-    callback.onStopRequest(null, this, Cr.NS_OK);</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+    // We're assuming everything is ok here.</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+    callback.onStopRequest(null, Cr.NS_OK);</span>
<a href="#l15.93"></a><span id="l15.93">   }</span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95">   providerUrlForError(error) {</span>
<a href="#l15.96"></a><span id="l15.96">     return &quot;&quot;;</span>
<a href="#l15.97"></a><span id="l15.97">   }</span>
<a href="#l15.98"></a><span id="l15.98"> </span>
<a href="#l15.99"></a><span id="l15.99">   overrideUrls(count, urls) {</span>
<a href="#l15.100"></a><span id="l15.100">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/newmailaccount/content/uriListener.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/uriListener.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -121,23 +121,21 @@ function TracingListener(aBrowser, aPara</span>
<a href="#l16.4"></a><span id="l16.4">   this.chunks = [];</span>
<a href="#l16.5"></a><span id="l16.5">   this.browser = aBrowser;</span>
<a href="#l16.6"></a><span id="l16.6">   this.params = aParams;</span>
<a href="#l16.7"></a><span id="l16.7">   this.oldListener = null;</span>
<a href="#l16.8"></a><span id="l16.8"> }</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> TracingListener.prototype = {</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  onStartRequest(/* nsIRequest */ aRequest,</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                 /* nsISupports */ aContext) {</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-    this.oldListener.onStartRequest(aRequest, aContext);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  onStartRequest(/* nsIRequest */ aRequest) {</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+    this.oldListener.onStartRequest(aRequest);</span>
<a href="#l16.17"></a><span id="l16.17">   },</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   onStopRequest(/* nsIRequest */ aRequest,</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-                /* nsISupports */ aContext,</span>
<a href="#l16.21"></a><span id="l16.21">                 /* int */ aStatusCode) {</span>
<a href="#l16.22"></a><span id="l16.22">     // Why don't people use JSMs? Sigh...</span>
<a href="#l16.23"></a><span id="l16.23">     let accountCreationFuncs = {};</span>
<a href="#l16.24"></a><span id="l16.24">     Services.scriptloader.loadSubScript(</span>
<a href="#l16.25"></a><span id="l16.25">       &quot;chrome://messenger/content/accountcreation/util.js&quot;,</span>
<a href="#l16.26"></a><span id="l16.26">       accountCreationFuncs);</span>
<a href="#l16.27"></a><span id="l16.27">     Services.scriptloader.loadSubScript(</span>
<a href="#l16.28"></a><span id="l16.28">       &quot;chrome://messenger/content/accountcreation/accountConfig.js&quot;,</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineat">@@ -202,21 +200,20 @@ TracingListener.prototype = {</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31">     // Respawn the account provisioner to announce our success</span>
<a href="#l16.32"></a><span id="l16.32">     NewMailAccountProvisioner(null, {</span>
<a href="#l16.33"></a><span id="l16.33">       success,</span>
<a href="#l16.34"></a><span id="l16.34">       search_engine: this.params.searchEngine,</span>
<a href="#l16.35"></a><span id="l16.35">       account,</span>
<a href="#l16.36"></a><span id="l16.36">     });</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-    this.oldListener.onStopRequest(aRequest, aContext, aStatusCode);</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+    this.oldListener.onStopRequest(aRequest, aStatusCode);</span>
<a href="#l16.40"></a><span id="l16.40">   },</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42">   onDataAvailable(/* nsIRequest */ aRequest,</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-                  /* nsISupports */ aContext,</span>
<a href="#l16.44"></a><span id="l16.44">                   /* nsIInputStream */ aStream,</span>
<a href="#l16.45"></a><span id="l16.45">                   /* int */ aOffset,</span>
<a href="#l16.46"></a><span id="l16.46">                   /* int */ aCount) {</span>
<a href="#l16.47"></a><span id="l16.47">     // We want to read the stream of incoming data, but we also want</span>
<a href="#l16.48"></a><span id="l16.48">     // to make sure it gets passed to the original listener. We do this</span>
<a href="#l16.49"></a><span id="l16.49">     // by passing the input stream through an nsIStorageStream, writing</span>
<a href="#l16.50"></a><span id="l16.50">     // the data to that stream, and passing it along to the next listener.</span>
<a href="#l16.51"></a><span id="l16.51">     let binaryInputStream = Cc[&quot;@mozilla.org/binaryinputstream;1&quot;]</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineat">@@ -233,17 +230,17 @@ TracingListener.prototype = {</span>
<a href="#l16.53"></a><span id="l16.53">     // web.</span>
<a href="#l16.54"></a><span id="l16.54">     storageStream.init(8192, aCount, null);</span>
<a href="#l16.55"></a><span id="l16.55">     outStream.setOutputStream(storageStream.getOutputStream(0));</span>
<a href="#l16.56"></a><span id="l16.56"> </span>
<a href="#l16.57"></a><span id="l16.57">     let data = binaryInputStream.readBytes(aCount);</span>
<a href="#l16.58"></a><span id="l16.58">     this.chunks.push(data);</span>
<a href="#l16.59"></a><span id="l16.59"> </span>
<a href="#l16.60"></a><span id="l16.60">     outStream.writeBytes(data, aCount);</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-    this.oldListener.onDataAvailable(aRequest, aContext,</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+    this.oldListener.onDataAvailable(aRequest,</span>
<a href="#l16.63"></a><span id="l16.63">                                      storageStream.newInputStream(0),</span>
<a href="#l16.64"></a><span id="l16.64">                                      aOffset, aCount);</span>
<a href="#l16.65"></a><span id="l16.65">   },</span>
<a href="#l16.66"></a><span id="l16.66"> </span>
<a href="#l16.67"></a><span id="l16.67">   QueryInterface: ChromeUtils.generateQI([Ci.nsIStreamListener,</span>
<a href="#l16.68"></a><span id="l16.68">                                           Ci.nsIRequestObserver]),</span>
<a href="#l16.69"></a><span id="l16.69"> </span>
<a href="#l16.70"></a><span id="l16.70"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/nsMailDefaultHandler.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/nsMailDefaultHandler.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -77,21 +77,21 @@ function openURI(uri) {</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5">   // We cannot load a URI on startup asynchronously without protecting</span>
<a href="#l17.6"></a><span id="l17.6">   // the startup</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">   var loadgroup = Cc[&quot;@mozilla.org/network/load-group;1&quot;]</span>
<a href="#l17.9"></a><span id="l17.9">                     .createInstance(Ci.nsILoadGroup);</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   var loadlistener = {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    onStartRequest(aRequest, aContext) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    onStartRequest(aRequest) {</span>
<a href="#l17.14"></a><span id="l17.14">       Services.startup.enterLastWindowClosingSurvivalArea();</span>
<a href="#l17.15"></a><span id="l17.15">     },</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-    onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+    onStopRequest(aRequest, aStatusCode) {</span>
<a href="#l17.19"></a><span id="l17.19">       Services.startup.exitLastWindowClosingSurvivalArea();</span>
<a href="#l17.20"></a><span id="l17.20">     },</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22">     QueryInterface: ChromeUtils.generateQI([Ci.nsIRequestObserver,</span>
<a href="#l17.23"></a><span id="l17.23">                                             Ci.nsISupportsWeakReference]),</span>
<a href="#l17.24"></a><span id="l17.24">   };</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26">   loadgroup.groupObserver = loadlistener;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/search/content/SpotlightIntegration.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/search/content/SpotlightIntegration.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -108,17 +108,17 @@ SearchIntegration = { // eslint-disable-</span>
<a href="#l18.4"></a><span id="l18.4">           case &quot;&gt;&quot;: return &quot;&amp;gt;&quot;;</span>
<a href="#l18.5"></a><span id="l18.5">           case &quot;&amp;&quot;: return &quot;&amp;amp;&quot;;</span>
<a href="#l18.6"></a><span id="l18.6">           default: throw &quot;Unexpected match&quot;;</span>
<a href="#l18.7"></a><span id="l18.7">           }</span>
<a href="#l18.8"></a><span id="l18.8">         }</span>
<a href="#l18.9"></a><span id="l18.9">       );</span>
<a href="#l18.10"></a><span id="l18.10">     },</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    onStartRequest(request, context) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    onStartRequest(request) {</span>
<a href="#l18.14"></a><span id="l18.14">       try {</span>
<a href="#l18.15"></a><span id="l18.15">         let outputFileStream = Cc[&quot;@mozilla.org/network/file-output-stream;1&quot;]</span>
<a href="#l18.16"></a><span id="l18.16">                                .createInstance(Ci.nsIFileOutputStream);</span>
<a href="#l18.17"></a><span id="l18.17">         outputFileStream.init(this._outputFile, -1, -1, 0);</span>
<a href="#l18.18"></a><span id="l18.18">         this._outputStream = Cc[&quot;@mozilla.org/intl/converter-output-stream;1&quot;]</span>
<a href="#l18.19"></a><span id="l18.19">                                .createInstance(Ci.nsIConverterOutputStream);</span>
<a href="#l18.20"></a><span id="l18.20">         this._outputStream.init(outputFileStream, &quot;UTF-8&quot;);</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -150,17 +150,17 @@ SearchIntegration = { // eslint-disable-</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24">         this._outputStream.writeString(escapedSubject);</span>
<a href="#l18.25"></a><span id="l18.25">         this._outputStream.writeString(&quot; &quot;);</span>
<a href="#l18.26"></a><span id="l18.26">       } catch (ex) {</span>
<a href="#l18.27"></a><span id="l18.27">         this._onDoneStreaming(false);</span>
<a href="#l18.28"></a><span id="l18.28">       }</span>
<a href="#l18.29"></a><span id="l18.29">     },</span>
<a href="#l18.30"></a><span id="l18.30"> </span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    onStopRequest(request, context, status, errorMsg) {</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    onStopRequest(request, status) {</span>
<a href="#l18.33"></a><span id="l18.33">       try {</span>
<a href="#l18.34"></a><span id="l18.34">         // we want to write out the from, to, cc, and subject headers into the</span>
<a href="#l18.35"></a><span id="l18.35">         // Text Content value, so they'll be indexed.</span>
<a href="#l18.36"></a><span id="l18.36">         let stringStream = Cc[&quot;@mozilla.org/io/string-input-stream;1&quot;]</span>
<a href="#l18.37"></a><span id="l18.37">                              .createInstance(Ci.nsIStringInputStream);</span>
<a href="#l18.38"></a><span id="l18.38">         stringStream.setData(this._message, this._message.length);</span>
<a href="#l18.39"></a><span id="l18.39">         let folder = this._msgHdr.folder;</span>
<a href="#l18.40"></a><span id="l18.40">         let text = folder.getMsgTextFromStream(stringStream,</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -180,17 +180,17 @@ SearchIntegration = { // eslint-disable-</span>
<a href="#l18.42"></a><span id="l18.42">       } catch (ex) {</span>
<a href="#l18.43"></a><span id="l18.43">         SearchIntegration._log.error(ex);</span>
<a href="#l18.44"></a><span id="l18.44">         this._onDoneStreaming(false);</span>
<a href="#l18.45"></a><span id="l18.45">         return;</span>
<a href="#l18.46"></a><span id="l18.46">       }</span>
<a href="#l18.47"></a><span id="l18.47">       this._onDoneStreaming(true);</span>
<a href="#l18.48"></a><span id="l18.48">     },</span>
<a href="#l18.49"></a><span id="l18.49"> </span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-    onDataAvailable(request, context, inputStream, offset, count) {</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+    onDataAvailable(request, inputStream, offset, count) {</span>
<a href="#l18.52"></a><span id="l18.52">       try {</span>
<a href="#l18.53"></a><span id="l18.53">         let inStream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l18.54"></a><span id="l18.54">                          .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l18.55"></a><span id="l18.55">         inStream.init(inputStream);</span>
<a href="#l18.56"></a><span id="l18.56"> </span>
<a href="#l18.57"></a><span id="l18.57">         // It is necessary to read in data from the input stream</span>
<a href="#l18.58"></a><span id="l18.58">         let inData = inStream.read(count);</span>
<a href="#l18.59"></a><span id="l18.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/components/search/content/WinSearchIntegration.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/components/search/content/WinSearchIntegration.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -217,30 +217,30 @@ SearchIntegration = { // eslint-disable-</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">   // The stream listener to read messages</span>
<a href="#l19.6"></a><span id="l19.6">   _streamListener: {</span>
<a href="#l19.7"></a><span id="l19.7">     __proto__: SearchSupport._streamListenerBase,</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">     // Buffer to store the message</span>
<a href="#l19.10"></a><span id="l19.10">     _message: &quot;&quot;,</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    onStartRequest(request, context) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    onStartRequest(request) {</span>
<a href="#l19.14"></a><span id="l19.14">       try {</span>
<a href="#l19.15"></a><span id="l19.15">         let outputFileStream =  Cc[&quot;@mozilla.org/network/file-output-stream;1&quot;]</span>
<a href="#l19.16"></a><span id="l19.16">                                   .createInstance(Ci.nsIFileOutputStream);</span>
<a href="#l19.17"></a><span id="l19.17">         outputFileStream.init(this._outputFile, -1, -1, 0);</span>
<a href="#l19.18"></a><span id="l19.18">         this._outputStream = Cc[&quot;@mozilla.org/intl/converter-output-stream;1&quot;]</span>
<a href="#l19.19"></a><span id="l19.19">                                .createInstance(Ci.nsIConverterOutputStream);</span>
<a href="#l19.20"></a><span id="l19.20">         this._outputStream.init(outputFileStream, &quot;UTF-8&quot;);</span>
<a href="#l19.21"></a><span id="l19.21">       } catch (ex) {</span>
<a href="#l19.22"></a><span id="l19.22">         this._onDoneStreaming(false);</span>
<a href="#l19.23"></a><span id="l19.23">       }</span>
<a href="#l19.24"></a><span id="l19.24">     },</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">-    onStopRequest(request, context, status, errorMsg) {</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+    onStopRequest(request, status) {</span>
<a href="#l19.28"></a><span id="l19.28">       try {</span>
<a href="#l19.29"></a><span id="l19.29">         // XXX Once the JS emitter gets checked in, this code should probably be</span>
<a href="#l19.30"></a><span id="l19.30">         // switched over to use that</span>
<a href="#l19.31"></a><span id="l19.31">         // Decode using getMsgTextFromStream</span>
<a href="#l19.32"></a><span id="l19.32">         let stringStream = Cc[&quot;@mozilla.org/io/string-input-stream;1&quot;]</span>
<a href="#l19.33"></a><span id="l19.33">                              .createInstance(Ci.nsIStringInputStream);</span>
<a href="#l19.34"></a><span id="l19.34">         stringStream.setData(this._message, this._message.length);</span>
<a href="#l19.35"></a><span id="l19.35">         let contentType = {};</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineat">@@ -288,17 +288,17 @@ SearchIntegration = { // eslint-disable-</span>
<a href="#l19.37"></a><span id="l19.37">       } catch (ex) {</span>
<a href="#l19.38"></a><span id="l19.38">         SearchIntegration._log.error(ex);</span>
<a href="#l19.39"></a><span id="l19.39">         this._onDoneStreaming(false);</span>
<a href="#l19.40"></a><span id="l19.40">         return;</span>
<a href="#l19.41"></a><span id="l19.41">       }</span>
<a href="#l19.42"></a><span id="l19.42">       this._onDoneStreaming(true);</span>
<a href="#l19.43"></a><span id="l19.43">     },</span>
<a href="#l19.44"></a><span id="l19.44"> </span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-    onDataAvailable(request, context, inputStream, offset, count) {</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+    onDataAvailable(request, inputStream, offset, count) {</span>
<a href="#l19.47"></a><span id="l19.47">       try {</span>
<a href="#l19.48"></a><span id="l19.48">         let inStream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l19.49"></a><span id="l19.49">                          .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l19.50"></a><span id="l19.50">         inStream.init(inputStream);</span>
<a href="#l19.51"></a><span id="l19.51"> </span>
<a href="#l19.52"></a><span id="l19.52">         // It is necessary to read in data from the input stream</span>
<a href="#l19.53"></a><span id="l19.53">         let inData = inStream.read(count);</span>
<a href="#l19.54"></a><span id="l19.54"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/db/gloda/modules/mimemsg.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/mimemsg.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -71,20 +71,20 @@ function CallbackStreamListener(aMsgHdr,</span>
<a href="#l20.4"></a><span id="l20.4">   }</span>
<a href="#l20.5"></a><span id="l20.5">   activeStreamListeners[hdrURI] = this;</span>
<a href="#l20.6"></a><span id="l20.6"> }</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8"> CallbackStreamListener.prototype = {</span>
<a href="#l20.9"></a><span id="l20.9">   QueryInterface: ChromeUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   // nsIRequestObserver part</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  onStartRequest: function (aRequest, aContext) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  onStartRequest: function (aRequest) {</span>
<a href="#l20.14"></a><span id="l20.14">     this._request = aRequest;</span>
<a href="#l20.15"></a><span id="l20.15">   },</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-  onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+  onStopRequest: function (aRequest, aStatusCode) {</span>
<a href="#l20.18"></a><span id="l20.18">     let msgURI = this._msgHdr.folder.getUriForMsg(this._msgHdr);</span>
<a href="#l20.19"></a><span id="l20.19">     delete activeStreamListeners[msgURI];</span>
<a href="#l20.20"></a><span id="l20.20"> </span>
<a href="#l20.21"></a><span id="l20.21">     aRequest.QueryInterface(Ci.nsIChannel);</span>
<a href="#l20.22"></a><span id="l20.22">     let message = MsgHdrToMimeMessage.RESULT_RENDEVOUZ[aRequest.URI.spec];</span>
<a href="#l20.23"></a><span id="l20.23">     if (message === undefined)</span>
<a href="#l20.24"></a><span id="l20.24">       message = null;</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26" class="difflineat">@@ -109,17 +109,17 @@ CallbackStreamListener.prototype = {</span>
<a href="#l20.27"></a><span id="l20.27">     this._callbacksThis = null;</span>
<a href="#l20.28"></a><span id="l20.28">     this._callbacks = null;</span>
<a href="#l20.29"></a><span id="l20.29">   },</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31">   /* okay, our onDataAvailable should actually never be called.  the stream</span>
<a href="#l20.32"></a><span id="l20.32">      converter is actually eating everything except the start and stop</span>
<a href="#l20.33"></a><span id="l20.33">      notification. */</span>
<a href="#l20.34"></a><span id="l20.34">   // nsIStreamListener part</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-  onDataAvailable: function (aRequest,aContext,aInputStream,aOffset,aCount) {</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+  onDataAvailable: function (aRequest,aInputStream,aOffset,aCount) {</span>
<a href="#l20.37"></a><span id="l20.37">     dump(&quot;this should not be happening! arrgggggh!\n&quot;);</span>
<a href="#l20.38"></a><span id="l20.38">     if (this._stream === null) {</span>
<a href="#l20.39"></a><span id="l20.39">       this._stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].</span>
<a href="#l20.40"></a><span id="l20.40">                     createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l20.41"></a><span id="l20.41">       this._stream.init(aInputStream);</span>
<a href="#l20.42"></a><span id="l20.42">     }</span>
<a href="#l20.43"></a><span id="l20.43">     this._stream.read(aCount);</span>
<a href="#l20.44"></a><span id="l20.44"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/mime/src/mimeParser.jsm</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/mime/src/mimeParser.jsm</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -94,30 +94,30 @@ var MimeParser = {</span>
<a href="#l21.4"></a><span id="l21.4">    * generated stream listener will also make calls to onStartRequest and</span>
<a href="#l21.5"></a><span id="l21.5">    * onStopRequest on the emitter (if they exist).</span>
<a href="#l21.6"></a><span id="l21.6">    *</span>
<a href="#l21.7"></a><span id="l21.7">    * @param emitter The emitter to receive callbacks on.</span>
<a href="#l21.8"></a><span id="l21.8">    * @param opts    A set of options for the parser.</span>
<a href="#l21.9"></a><span id="l21.9">    */</span>
<a href="#l21.10"></a><span id="l21.10">   makeStreamListenerParser: function MimeParser_makeSLParser(emitter, opts) {</span>
<a href="#l21.11"></a><span id="l21.11">     var StreamListener = {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      onStartRequest: function SLP_onStartRequest(aRequest, aContext) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+      onStartRequest: function SLP_onStartRequest(aRequest) {</span>
<a href="#l21.14"></a><span id="l21.14">         try {</span>
<a href="#l21.15"></a><span id="l21.15">           if (&quot;onStartRequest&quot; in emitter)</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-            emitter.onStartRequest(aRequest, aContext);</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+            emitter.onStartRequest(aRequest);</span>
<a href="#l21.18"></a><span id="l21.18">         } finally {</span>
<a href="#l21.19"></a><span id="l21.19">           this._parser.resetParser();</span>
<a href="#l21.20"></a><span id="l21.20">         }</span>
<a href="#l21.21"></a><span id="l21.21">       },</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-      onStopRequest: function SLP_onStopRequest(aRequest, aContext, aStatus) {</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+      onStopRequest: function SLP_onStopRequest(aRequest, aStatus) {</span>
<a href="#l21.24"></a><span id="l21.24">         this._parser.deliverEOF();</span>
<a href="#l21.25"></a><span id="l21.25">         if (&quot;onStopRequest&quot; in emitter)</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-          emitter.onStopRequest(aRequest, aContext, aStatus);</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+          emitter.onStopRequest(aRequest, aStatus);</span>
<a href="#l21.28"></a><span id="l21.28">       },</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-      onDataAvailable: function SLP_onData(aRequest, aContext, aStream,</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+      onDataAvailable: function SLP_onData(aRequest, aStream,</span>
<a href="#l21.31"></a><span id="l21.31">                                            aOffset, aCount) {</span>
<a href="#l21.32"></a><span id="l21.32">         var scriptIn = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l21.33"></a><span id="l21.33">                          .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l21.34"></a><span id="l21.34">         scriptIn.init(aStream);</span>
<a href="#l21.35"></a><span id="l21.35">         // Use readBytes instead of read to handle embedded NULs properly.</span>
<a href="#l21.36"></a><span id="l21.36">         this._parser.deliverData(scriptIn.readBytes(aCount));</span>
<a href="#l21.37"></a><span id="l21.37">       },</span>
<a href="#l21.38"></a><span id="l21.38">       QueryInterface: ChromeUtils.generateQI([Ci.nsIStreamListener,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

