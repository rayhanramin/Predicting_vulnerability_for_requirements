<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1696:f384b7b8145235136b350323c931b0cbc3d56fa5</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f384b7b8145235136b350323c931b0cbc3d56fa5" />
<meta property="og:url" content="/comm-central/rev/f384b7b8145235136b350323c931b0cbc3d56fa5" />
<meta property="og:description" content="Bug 468420 -  Consolidation of the navigation bar;r=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f384b7b8145235136b350323c931b0cbc3d56fa5 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f384b7b8145235136b350323c931b0cbc3d56fa5">shortlog</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f384b7b8145235136b350323c931b0cbc3d56fa5">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5">files</a> |
changeset |
<a href="/comm-central/raw-rev/f384b7b8145235136b350323c931b0cbc3d56fa5">raw</a>  | <a href="/comm-central/archive/f384b7b8145235136b350323c931b0cbc3d56fa5.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=468420">Bug 468420</a> -  Consolidation of the navigation bar;r=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#101;&#114;&#101;&#110;&#100;&#32;&#67;&#111;&#114;&#110;&#101;&#108;&#105;&#117;&#115;&#32;&#91;&#58;&#98;&#101;&#114;&#101;&#110;&#100;&#93;&#32;&#60;&#98;&#101;&#114;&#101;&#110;&#100;&#46;&#99;&#111;&#114;&#110;&#101;&#108;&#105;&#117;&#115;&#64;&#115;&#117;&#110;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 19 Jan 2009 21:29:00 +0100</td></tr>

<tr>
 <td>changeset 1696</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f384b7b8145235136b350323c931b0cbc3d56fa5">f384b7b8145235136b350323c931b0cbc3d56fa5</a></td>
</tr>



<tr>
<td>parent 1695</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/90cc9f3ab09f4b44061f49eadbd13bf2fafea5d5">90cc9f3ab09f4b44061f49eadbd13bf2fafea5d5</a>
</td>
</tr>

<tr>
<td>child 1697</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/825f066d21c273854ce1b49b278c39b6f1f258de">825f066d21c273854ce1b49b278c39b6f1f258de</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f384b7b8145235136b350323c931b0cbc3d56fa5">1360</a></td></tr>
<tr><td>push user</td><td>Berend.Cornelius@sun.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 19 Jan 2009 20:29:13 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f384b7b81452 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f384b7b8145235136b350323c931b0cbc3d56fa5">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f384b7b8145235136b350323c931b0cbc3d56fa5&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f384b7b8145235136b350323c931b0cbc3d56fa5&newProject=comm-central&newRevision=f384b7b8145235136b350323c931b0cbc3d56fa5&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f384b7b8145235136b350323c931b0cbc3d56fa5&newProject=comm-central&newRevision=f384b7b8145235136b350323c931b0cbc3d56fa5&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f384b7b8145235136b350323c931b0cbc3d56fa5&newProject=comm-central&newRevision=f384b7b8145235136b350323c931b0cbc3d56fa5&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=468420">468420</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=468420">Bug 468420</a> -  Consolidation of the navigation bar;r=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-bindings.css">calendar/base/content/calendar-bindings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-bindings.css">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-bindings.css">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-bindings.css">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-bindings.css">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-bindings.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-day-view.xml">calendar/base/content/calendar-decorated-day-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-day-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-day-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-day-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-day-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-day-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-month-view.xml">calendar/base/content/calendar-decorated-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-month-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-month-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-month-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-month-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiday-base-view.xml">calendar/base/content/calendar-decorated-multiday-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiday-base-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiday-base-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiday-base-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiday-base-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiday-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiweek-view.xml">calendar/base/content/calendar-decorated-multiweek-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiweek-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiweek-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiweek-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiweek-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-multiweek-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-week-view.xml">calendar/base/content/calendar-decorated-week-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-week-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-week-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-week-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-week-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-decorated-week-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-views.xul">calendar/base/content/calendar-views.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-views.xul">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-views.xul">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-views.xul">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-views.xul">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/content/calendar-views.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/jar.mn">calendar/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/jar.mn">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/jar.mn">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/Makefile.in">calendar/base/public/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/Makefile.in">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/Makefile.in">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/calICalendarView.idl">calendar/base/public/calICalendarView.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/calICalendarView.idl">file</a> |
<a href="/comm-central/annotate/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/calICalendarView.idl">annotate</a> |
<a href="/comm-central/diff/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/calICalendarView.idl">diff</a> |
<a href="/comm-central/comparison/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/calICalendarView.idl">comparison</a> |
<a href="/comm-central/log/f384b7b8145235136b350323c931b0cbc3d56fa5/calendar/base/public/calICalendarView.idl">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -40,32 +40,45 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;bindings id=&quot;calendar-multiday-view-bindings&quot;</span>
<a href="#l1.5"></a><span id="l1.5">   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l1.6"></a><span id="l1.6">   xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l1.7"></a><span id="l1.7">   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l1.8"></a><span id="l1.8">   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">   &lt;binding id=&quot;calendar-base-view&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11">     &lt;implementation&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+      &lt;field name=&quot;mWeekStartOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      &lt;field name=&quot;mRangeStartDate&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      &lt;field name=&quot;mRangeEndDate&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      &lt;field name=&quot;mWorkdaysOnly&quot;&gt;false&lt;/field&gt;</span>
<a href="#l1.16"></a><span id="l1.16">       &lt;field name=&quot;mRefreshQueue&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l1.17"></a><span id="l1.17">       &lt;field name=&quot;mRefreshPending&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.18"></a><span id="l1.18">       &lt;field name=&quot;mCalendar&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.19"></a><span id="l1.19">       &lt;field name=&quot;mController&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.20"></a><span id="l1.20">       &lt;field name=&quot;mStartDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.21"></a><span id="l1.21">       &lt;field name=&quot;mEndDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.22"></a><span id="l1.22">       &lt;field name=&quot;mTasksInView&quot;&gt;false&lt;/field&gt;</span>
<a href="#l1.23"></a><span id="l1.23">       &lt;field name=&quot;mShowCompleted&quot;&gt;false&lt;/field&gt;</span>
<a href="#l1.24"></a><span id="l1.24">       &lt;field name=&quot;mDisplayDaysOff&quot;&gt;true&lt;/field&gt;</span>
<a href="#l1.25"></a><span id="l1.25">       &lt;field name=&quot;mDaysOffArray&quot;&gt;[0,6]&lt;/field&gt;</span>
<a href="#l1.26"></a><span id="l1.26">       &lt;field name=&quot;mTimezone&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.27"></a><span id="l1.27">       &lt;field name=&quot;mFlashingEvents&quot;&gt;new Object()&lt;/field&gt;</span>
<a href="#l1.28"></a><span id="l1.28">       &lt;field name=&quot;mSelectedItems&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l1.29"></a><span id="l1.29">       &lt;field name=&quot;mBatchCount&quot;&gt;0&lt;/field&gt;</span>
<a href="#l1.30"></a><span id="l1.30">       &lt;field name=&quot;mLongWeekdayTotalPixels&quot;&gt;-1&lt;/field&gt;</span>
<a href="#l1.31"></a><span id="l1.31">       &lt;field name=&quot;mResizeHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      &lt;field name=&quot;mPrefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+      ({ calView: this,</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+         observe: function calViewPrefChange(subj, topic, pref) {</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+             this.calView.handlePreference(subj, topic, pref);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+             return;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+         }</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+      })</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+      ]]&gt;&lt;/field&gt;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+</span>
<a href="#l1.41"></a><span id="l1.41">       &lt;field name=&quot;mOperationListener&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.42"></a><span id="l1.42">       ({</span>
<a href="#l1.43"></a><span id="l1.43">           calView: this,</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45">           onOperationComplete:</span>
<a href="#l1.46"></a><span id="l1.46">           function onOperationComplete(aCalendar, aStatus, aOperationType,</span>
<a href="#l1.47"></a><span id="l1.47">                                        aId, aDetail) {</span>
<a href="#l1.48"></a><span id="l1.48">               // Fire event</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineat">@@ -272,42 +285,77 @@</span>
<a href="#l1.50"></a><span id="l1.50">             onDefaultCalendarChanged:</span>
<a href="#l1.51"></a><span id="l1.51">             function onDefaultCalendarChanged(aNewDefaultCalendar) {</span>
<a href="#l1.52"></a><span id="l1.52">                 // don't care, for now</span>
<a href="#l1.53"></a><span id="l1.53">             }</span>
<a href="#l1.54"></a><span id="l1.54">         })</span>
<a href="#l1.55"></a><span id="l1.55">       ]]&gt;&lt;/field&gt;</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        const kWorkdaysCommand = &quot;calendar_toggle_workdays_only_command&quot;;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+        const kTasksInViewCommand = &quot;calendar_toggle_tasks_in_view_command&quot;;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+        const kShowCompleted = &quot;calendar_toggle_show_completed_in_view_command&quot;;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        const kOrientation = &quot;calendar_toggle_orientation_command&quot;;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+        this.workdaysOnly = (document.getElementById(kWorkdaysCommand)</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+                                .getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+        this.tasksInView = (document.getElementById(kTasksInViewCommand)</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+                                .getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+        this.rotated = (document.getElementById(kOrientation)</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+                                .getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+        this.showCompleted = (document.getElementById(kShowCompleted)</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+                                .getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+</span>
<a href="#l1.72"></a><span id="l1.72">         this.mTimezone = calendarDefaultTimezone();</span>
<a href="#l1.73"></a><span id="l1.73">         let alarmService = Components.classes['@mozilla.org/calendar/alarm-service;1']</span>
<a href="#l1.74"></a><span id="l1.74">                            .getService(Components.interfaces.calIAlarmService);</span>
<a href="#l1.75"></a><span id="l1.75">         alarmService.addObserver(this.mObserver);</span>
<a href="#l1.76"></a><span id="l1.76">         let self = this;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+        this.setAttribute(&quot;type&quot;, this.type);</span>
<a href="#l1.78"></a><span id="l1.78">         this.mResizeHandler = function resizeHandler() {</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-         self.onResize(self); };</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+            self.onResize(self); };</span>
<a href="#l1.81"></a><span id="l1.81">         this.viewBroadcaster.addEventListener(this.getAttribute(&quot;type&quot;) + &quot;viewresized&quot;, this.mResizeHandler, true);</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+        // add a preference observer to monitor changes</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+        let pb2 = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+                  getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+        pb2.addObserver(&quot;calendar.&quot;, this.mPrefObserver, false);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+        this.weekStartOffset = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+        this.updateDaysOffPrefs();</span>
<a href="#l1.89"></a><span id="l1.89">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l1.90"></a><span id="l1.90"> </span>
<a href="#l1.91"></a><span id="l1.91">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l1.92"></a><span id="l1.92">         if (this.mCalendar) {</span>
<a href="#l1.93"></a><span id="l1.93">             this.mCalendar.removeObserver(this.mObserver);</span>
<a href="#l1.94"></a><span id="l1.94">         }</span>
<a href="#l1.95"></a><span id="l1.95">         let alarmService = Components.classes['@mozilla.org/calendar/alarm-service;1']</span>
<a href="#l1.96"></a><span id="l1.96">                            .getService(Components.interfaces.calIAlarmService);</span>
<a href="#l1.97"></a><span id="l1.97">         alarmService.removeObserver(this.mObserver);</span>
<a href="#l1.98"></a><span id="l1.98">         this.viewBroadcaster.removeEventListener(this.getAttribute(&quot;type&quot;) + &quot;viewresized&quot;, this.mResizeHandler, true);</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+        let pb2 = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+                  getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+        pb2.removeObserver(&quot;calendar.&quot;, this.mPrefObserver);</span>
<a href="#l1.102"></a><span id="l1.102">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+      &lt;property name=&quot;type&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+            let typelist = this.id.split(&quot;-&quot;);</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+            return typelist[0];</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+</span>
<a href="#l1.111"></a><span id="l1.111">       &lt;property name=&quot;viewBroadcaster&quot; readonly=&quot;true&quot;</span>
<a href="#l1.112"></a><span id="l1.112">                 onget=&quot;return document.getElementById('calendarviewBroadcaster')&quot;/&gt;</span>
<a href="#l1.113"></a><span id="l1.113"> </span>
<a href="#l1.114"></a><span id="l1.114">       &lt;property name=&quot;labeldaybox&quot; readonly=&quot;true&quot;</span>
<a href="#l1.115"></a><span id="l1.115">                 onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'labeldaybox')&quot;/&gt;</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+      &lt;property name=&quot;rotated&quot;</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+                onget=&quot;return (this.orient == 'horizontal')&quot;</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+                onset=&quot;return (this.orient = (val ? 'horizontal' : 'vertical'))&quot;/&gt;</span>
<a href="#l1.120"></a><span id="l1.120">       &lt;property name=&quot;displayDaysOff&quot;</span>
<a href="#l1.121"></a><span id="l1.121">                 onget=&quot;return this.mDisplayDaysOff;&quot;</span>
<a href="#l1.122"></a><span id="l1.122">                 onset=&quot;return (this.mDisplayDaysOff = val);&quot;/&gt;</span>
<a href="#l1.123"></a><span id="l1.123">       &lt;property name=&quot;controller&quot;</span>
<a href="#l1.124"></a><span id="l1.124">                 onget=&quot;return this.mController;&quot;</span>
<a href="#l1.125"></a><span id="l1.125">                 onset=&quot;return (this.mController = val);&quot;/&gt;</span>
<a href="#l1.126"></a><span id="l1.126">       &lt;property name=&quot;daysOffArray&quot;</span>
<a href="#l1.127"></a><span id="l1.127">                 onget=&quot;return this.mDaysOffArray;&quot;</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineat">@@ -316,31 +364,86 @@</span>
<a href="#l1.129"></a><span id="l1.129">                 onget=&quot;return this.mTasksInView;&quot;</span>
<a href="#l1.130"></a><span id="l1.130">                 onset=&quot;return (this.mTasksInView = val);&quot;/&gt;</span>
<a href="#l1.131"></a><span id="l1.131">       &lt;property name=&quot;showCompleted&quot;</span>
<a href="#l1.132"></a><span id="l1.132">                 onget=&quot;return this.mShowCompleted;&quot;</span>
<a href="#l1.133"></a><span id="l1.133">                 onset=&quot;return (this.mShowCompleted = val);&quot;/&gt;</span>
<a href="#l1.134"></a><span id="l1.134">       &lt;property name=&quot;timezone&quot;</span>
<a href="#l1.135"></a><span id="l1.135">                 onget=&quot;return this.mTimezone;&quot;</span>
<a href="#l1.136"></a><span id="l1.136">                 onset=&quot;return (this.mTimezone = val);&quot;/&gt;</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+      &lt;property name=&quot;workdaysOnly&quot;</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+                onget=&quot;return this.mWorkdaysOnly;&quot;</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+                onset=&quot;return (this.mWorkdayOnly = val);&quot;/&gt;</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+      &lt;property name=&quot;selectionObserver&quot; readonly=&quot;true&quot;</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+                onget=&quot;return this.mSelectionObserver;&quot;/&gt;</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+      &lt;property name=&quot;startDay&quot; readonly=&quot;true&quot;</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+                onget=&quot;return this.startDate;&quot;/&gt;</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+      &lt;property name=&quot;endDay&quot; readonly=&quot;true&quot;</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+                onget=&quot;return this.endDate;&quot;/&gt;</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+      &lt;property name=&quot;rangeStartDate&quot;</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+                onget=&quot;return this.mRangeStartDate;&quot;</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+                onset=&quot;return (this.mRangeStartDate = val);&quot;/&gt;</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+      &lt;property name=&quot;rangeEndDate&quot;</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+                onget=&quot;return this.mRangeEndDate;&quot;</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+                onset=&quot;return (this.mRangeEndDate = val);&quot;/&gt;</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+      &lt;property name=&quot;observerID&quot; readonly=&quot;true&quot;</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+                onget=&quot;return 'base-view-observer';&quot;/&gt;</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+      &lt;property name=&quot;weekStartOffset&quot;&gt;</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+           return this.mWeekStartOffset;</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+           this.mWeekStartOffset = val;</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+           return val;</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.164"></a><span id="l1.164"> </span>
<a href="#l1.165"></a><span id="l1.165">       &lt;property name=&quot;displayCalendar&quot;&gt;</span>
<a href="#l1.166"></a><span id="l1.166">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l1.167"></a><span id="l1.167">           return this.mCalendar;</span>
<a href="#l1.168"></a><span id="l1.168">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l1.169"></a><span id="l1.169">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l1.170"></a><span id="l1.170">           if (this.mCalendar)</span>
<a href="#l1.171"></a><span id="l1.171">               this.mCalendar.removeObserver(this.mObserver);</span>
<a href="#l1.172"></a><span id="l1.172">           this.mCalendar = val;</span>
<a href="#l1.173"></a><span id="l1.173">           this.mCalendar.addObserver(this.mObserver);</span>
<a href="#l1.174"></a><span id="l1.174">           this.refresh();</span>
<a href="#l1.175"></a><span id="l1.175">           return val;</span>
<a href="#l1.176"></a><span id="l1.176">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l1.177"></a><span id="l1.177">       &lt;/property&gt;</span>
<a href="#l1.178"></a><span id="l1.178"> </span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+      &lt;property name=&quot;initialized&quot;&gt;</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+            let retval;</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+            // Some views throw when accessing an uninitialized startDay</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+            try {</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+                retval = this.displayCalendar &amp;&amp; this.startDay</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+                         &amp;&amp; this.endDay;</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+            } catch(ex) {</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+                return false;</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+            }</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+            return retval;</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+      &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineplus">+            this.showDate(aDate);</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+      &lt;method name=&quot;getRangeDescription&quot;&gt;</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineplus">+            return getDateFormatter().formatInterval(this.rangeStartDate, this.rangeEndDate);</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineplus">+</span>
<a href="#l1.207"></a><span id="l1.207">       &lt;method name=&quot;popRefreshQueue&quot;&gt;</span>
<a href="#l1.208"></a><span id="l1.208">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.209"></a><span id="l1.209">           let pendingRefresh = this.mRefreshPending;</span>
<a href="#l1.210"></a><span id="l1.210">           if (pendingRefresh) {</span>
<a href="#l1.211"></a><span id="l1.211">               if (calInstanceOf(pendingRefresh, Components.interfaces.calIOperation)) {</span>
<a href="#l1.212"></a><span id="l1.212">                   this.mRefreshPending = null;</span>
<a href="#l1.213"></a><span id="l1.213">                   pendingRefresh.cancel(null);</span>
<a href="#l1.214"></a><span id="l1.214">               } else {</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineat">@@ -431,17 +534,17 @@</span>
<a href="#l1.216"></a><span id="l1.216">           date = date.getInTimezone(this.mTimezone);</span>
<a href="#l1.217"></a><span id="l1.217">           date.isDate = true;</span>
<a href="#l1.218"></a><span id="l1.218">           return date;</span>
<a href="#l1.219"></a><span id="l1.219">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.220"></a><span id="l1.220">       &lt;/method&gt;</span>
<a href="#l1.221"></a><span id="l1.221"> </span>
<a href="#l1.222"></a><span id="l1.222">       &lt;method name=&quot;isVisible&quot;&gt;</span>
<a href="#l1.223"></a><span id="l1.223">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-            return (this.nodeName == currentView().viewElem.nodeName);</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineplus">+            return (this.nodeName == currentView().nodeName);</span>
<a href="#l1.226"></a><span id="l1.226">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.227"></a><span id="l1.227">       &lt;/method&gt;</span>
<a href="#l1.228"></a><span id="l1.228"> </span>
<a href="#l1.229"></a><span id="l1.229">       &lt;method name=&quot;refresh&quot;&gt;</span>
<a href="#l1.230"></a><span id="l1.230">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.231"></a><span id="l1.231">           if (this.mBatchCount == 0 &amp;&amp; this.isVisible()) {</span>
<a href="#l1.232"></a><span id="l1.232">               var refreshJob = {};</span>
<a href="#l1.233"></a><span id="l1.233">               this.mRefreshQueue.push(refreshJob);</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineat">@@ -495,17 +598,111 @@</span>
<a href="#l1.235"></a><span id="l1.235">                       maxDayWidth = Math.max(maxDayWidth, curPixelLength);</span>
<a href="#l1.236"></a><span id="l1.236">                   }</span>
<a href="#l1.237"></a><span id="l1.237">               }</span>
<a href="#l1.238"></a><span id="l1.238">               this.mLongWeekdayTotalPixels = (maxDayWidth * this.labeldaybox.childNodes.length) + 10;</span>
<a href="#l1.239"></a><span id="l1.239">           }</span>
<a href="#l1.240"></a><span id="l1.240">           return this.mLongWeekdayTotalPixels;</span>
<a href="#l1.241"></a><span id="l1.241">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.242"></a><span id="l1.242">       &lt;/method&gt;</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineplus">+</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineplus">+      &lt;!-- A preference handler which is called by the preference observer.</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineplus">+           Can be overwritten in derived bindings. --&gt;</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineplus">+      &lt;method name=&quot;handleCommonPreference&quot;&gt;</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineplus">+        &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineplus">+        &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineplus">+        &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+           // refresh view if categories seem to have changed</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+           if (aPreference.indexOf(&quot;calendar.category.color&quot;) == 0) {</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+               this.refreshView();</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+               return;</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+           }</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+           switch (aPreference) {</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+               case &quot;calendar.week.d0sundaysoff&quot;:</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+               case &quot;calendar.week.d1mondaysoff&quot;:</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineplus">+               case &quot;calendar.week.d2tuesdaysoff&quot;:</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineplus">+               case &quot;calendar.week.d3wednesdaysoff&quot;:</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineplus">+               case &quot;calendar.week.d4thursdaysoff&quot;:</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineplus">+               case &quot;calendar.week.d5fridaysoff&quot;:</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineplus">+               case &quot;calendar.week.d6saturdaysoff&quot;:</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineplus">+                   this.updateDaysOffPrefs();</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+                   break;</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineplus">+               case &quot;calendar.timezone.local&quot;:</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+                   this.timezone = calendarDefaultTimezone();</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineplus">+                   break;</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineplus">+               case &quot;calendar.alarms.indicator.show&quot;:</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+                   //Break here to ensure the view is refreshed</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineplus">+                   break;</span>
<a href="#l1.272"></a><span id="l1.272" class="difflineplus">+               case &quot;calendar.week.start&quot;:</span>
<a href="#l1.273"></a><span id="l1.273" class="difflineplus">+                   this.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineplus">+                   break;</span>
<a href="#l1.275"></a><span id="l1.275" class="difflineplus">+               default:</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineplus">+                   return;</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineplus">+            }</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineplus">+            this.refreshView();</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l1.280"></a><span id="l1.280" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineplus">+</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineplus">+      &lt;method name=&quot;updateDaysOffPrefs&quot;&gt;</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineplus">+            const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineplus">+            const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineplus">+                               &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineplus">+                               &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineplus">+            const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineplus">+                              &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineplus">+            let daysOff = new Array();</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineplus">+            for (let i in prefNames) {</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineplus">+                if (getPrefSafe(weekPrefix+prefNames[i])) {</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+                    daysOff.push(Number(i));</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+                }</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineplus">+            }</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineplus">+            this.daysOffArray = daysOff;</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+       &lt;/method&gt;</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineplus">+       &lt;method name=&quot;refreshView&quot;&gt;</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineplus">+         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineplus">+           if (!this.startDay || !this.endDay) {</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+               // don't refresh if we're not initialized</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineplus">+               return;</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineplus">+            }</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineplus">+            // Just refresh, the goToDay function will notice</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+            this.goToDay(this.selectedDay);</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineplus">+          ]]&gt;&lt;/body&gt;</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineplus">+        &lt;/method&gt;</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineplus">+</span>
<a href="#l1.311"></a><span id="l1.311">     &lt;/implementation&gt;</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineplus">+    &lt;handlers&gt;</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineplus">+      &lt;handler event=&quot;move&quot;&gt;</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineplus">+          this.moveView(event.detail);</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineplus">+        ]]&gt;</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineplus">+      &lt;handler event=&quot;keypress&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineplus">+        const kKE = Components.interfaces.nsIDOMKeyEvent;</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineplus">+        switch (event.keyCode) {</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineplus">+            case kKE.DOM_VK_PAGE_UP:</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineplus">+                this.moveView(-1);</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineplus">+                break;</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineplus">+            case kKE.DOM_VK_PAGE_DOWN:</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineplus">+                this.moveView(1);</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineplus">+                break;</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineplus">+        }</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineplus">+      &lt;handler event=&quot;DOMMouseScroll&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineplus">+        if (event.shiftKey) {</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineplus">+            this.moveView(event.detail &lt; 0 ? -1 : 1);</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineplus">+        }</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineplus">+</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+        // Prevent default scroll handling</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineplus">+        event.preventDefault();</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineplus">+    &lt;/handlers&gt;</span>
<a href="#l1.338"></a><span id="l1.338">   &lt;/binding&gt;</span>
<a href="#l1.339"></a><span id="l1.339"> </span>
<a href="#l1.340"></a><span id="l1.340">   &lt;binding id=&quot;calendar-day-label&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l1.341"></a><span id="l1.341">     &lt;content flex=&quot;1&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l1.342"></a><span id="l1.342">       &lt;xul:label anonid=&quot;longWeekdayName&quot; class=&quot;calendar-day-label-name&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l1.343"></a><span id="l1.343">       &lt;xul:label anonid=&quot;shortWeekdayName&quot; class=&quot;calendar-day-label-name&quot; hidden=&quot;true&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l1.344"></a><span id="l1.344">     &lt;/content&gt;</span>
<a href="#l1.345"></a><span id="l1.345">     &lt;implementation&gt;</span>
<a href="#l1.346"></a><span id="l1.346" class="difflineat">@@ -552,17 +749,16 @@</span>
<a href="#l1.347"></a><span id="l1.347">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l1.348"></a><span id="l1.348">       &lt;/property&gt;</span>
<a href="#l1.349"></a><span id="l1.349"> </span>
<a href="#l1.350"></a><span id="l1.350">       &lt;method name=&quot;getLongWeekdayPixels&quot;&gt;</span>
<a href="#l1.351"></a><span id="l1.351">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.352"></a><span id="l1.352">           // Only do this if the long weekdays are visible and we haven't already cached.</span>
<a href="#l1.353"></a><span id="l1.353">           let longNameWidth = this.longName.boxObject.width;</span>
<a href="#l1.354"></a><span id="l1.354">           if (longNameWidth &gt; 0) {</span>
<a href="#l1.355"></a><span id="l1.355" class="difflineminus">-//              WARN(&quot;getting longWeekdayPixels...&quot; + this.longName.boxObject.width);</span>
<a href="#l1.356"></a><span id="l1.356">               this.longWeekdayPixels = longNameWidth +</span>
<a href="#l1.357"></a><span id="l1.357">                                        getSummarizedStyleValues(this.longName, [&quot;margin-left&quot;, &quot;margin-right&quot;]);</span>
<a href="#l1.358"></a><span id="l1.358">               this.longWeekdayPixels += getSummarizedStyleValues(this, [&quot;border-left-width&quot;,</span>
<a href="#l1.359"></a><span id="l1.359">                                                                         &quot;padding-left&quot;, &quot;padding-right&quot;]);</span>
<a href="#l1.360"></a><span id="l1.360">               return this.longWeekdayPixels;</span>
<a href="#l1.361"></a><span id="l1.361">           } else {</span>
<a href="#l1.362"></a><span id="l1.362">               // in this case the weekdaypixels have not yet been layouted;</span>
<a href="#l1.363"></a><span id="l1.363">               // by definition 0 is returned</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-bindings.css</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-bindings.css</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -32,20 +32,16 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.5"></a><span id="l2.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.6"></a><span id="l2.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.7"></a><span id="l2.7">  *</span>
<a href="#l2.8"></a><span id="l2.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-calendar-decorated-base-view { </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  -moz-binding: url(chrome://calendar/content/calendar-decorated-base.xml#calendar-decorated-base-view);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-}</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-</span>
<a href="#l2.16"></a><span id="l2.16"> calendar-decorated-multiday-base-view {</span>
<a href="#l2.17"></a><span id="l2.17">   -moz-binding: url(chrome://calendar/content/calendar-decorated-multiday-base-view.xml#calendar-decorated-multiday-base-view);</span>
<a href="#l2.18"></a><span id="l2.18"> }</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> calendar-decorated-month-view-parent {</span>
<a href="#l2.21"></a><span id="l2.21">   -moz-binding: url(chrome://calendar/content/calendar-decorated-month-view.xml#calendar-decorated-month-view-parent);</span>
<a href="#l2.22"></a><span id="l2.22"> }</span>
<a href="#l2.23"></a><span id="l2.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-decorated-day-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-decorated-day-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">    -</span>
<a href="#l3.5"></a><span id="l3.5">    - The Initial Developer of the Original Code is</span>
<a href="#l3.6"></a><span id="l3.6">    -   Joey Minta &lt;jminta@gmail.com&gt;</span>
<a href="#l3.7"></a><span id="l3.7">    - Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l3.8"></a><span id="l3.8">    - the Initial Developer. All Rights Reserved.</span>
<a href="#l3.9"></a><span id="l3.9">    -</span>
<a href="#l3.10"></a><span id="l3.10">    - Contributor(s):</span>
<a href="#l3.11"></a><span id="l3.11">    -   Dan Mosedale &lt;dan.mosedale@oracle.com&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+   -   Berend Cornelius &lt;berend.cornelius@sun.com&gt;</span>
<a href="#l3.13"></a><span id="l3.13">    -</span>
<a href="#l3.14"></a><span id="l3.14">    - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l3.15"></a><span id="l3.15">    - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l3.16"></a><span id="l3.16">    - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l3.17"></a><span id="l3.17">    - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l3.18"></a><span id="l3.18">    - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l3.19"></a><span id="l3.19">    - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l3.20"></a><span id="l3.20">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -43,37 +44,33 @@</span>
<a href="#l3.22"></a><span id="l3.22"> &lt;bindings id=&quot;calendar-specific-view-bindings&quot;</span>
<a href="#l3.23"></a><span id="l3.23">     xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l3.24"></a><span id="l3.24">     xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l3.25"></a><span id="l3.25">     xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l3.26"></a><span id="l3.26">     xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">     &lt;binding id=&quot;calendar-decorated-day-view&quot;</span>
<a href="#l3.29"></a><span id="l3.29">              extends=&quot;chrome://calendar/content/calendar-decorated-multiday-base-view.xml#calendar-decorated-multiday-base-view&quot;&gt;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-        &lt;content flex=&quot;1&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-            &lt;xul:calendar-multiday-view anonid=&quot;view-element&quot; flex=&quot;1&quot; orient=&quot;vertical&quot; xbl:inherits=&quot;context,item-context&quot;/&gt;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-        &lt;/content&gt;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-        &lt;implementation implements=&quot;calIDecoratedView&quot;&gt;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l3.36"></a><span id="l3.36">             &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l3.37"></a><span id="l3.37">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l3.38"></a><span id="l3.38">                     return &quot;day-view-observer&quot;;</span>
<a href="#l3.39"></a><span id="l3.39">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l3.40"></a><span id="l3.40">             &lt;/property&gt;</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42">             &lt;!--Public methods--&gt;</span>
<a href="#l3.43"></a><span id="l3.43">             &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l3.44"></a><span id="l3.44">                 &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l3.45"></a><span id="l3.45">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-                    aDate = aDate.getInTimezone(this.viewElem.timezone);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+                    aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+                    this.setDateRange(aDate, aDate);</span>
<a href="#l3.49"></a><span id="l3.49">                     var toolTips = calGetStringArray(&quot;calendar&quot;,</span>
<a href="#l3.50"></a><span id="l3.50">                                                       [&quot;oneDayBack&quot;, &quot;gotoToday&quot;, &quot;oneDayForward&quot;]);</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-                    this.setDateRange(aDate, aDate, toolTips);</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-                    this.viewElem.setDateRange(aDate, aDate);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-                    this.viewElem.selectedDay = aDate;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+                    cal.navigationBar.setDateRange(aDate, aDate, toolTips);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+                    this.selectedDay = aDate;</span>
<a href="#l3.56"></a><span id="l3.56">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l3.57"></a><span id="l3.57">             &lt;/method&gt;</span>
<a href="#l3.58"></a><span id="l3.58">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l3.59"></a><span id="l3.59">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l3.60"></a><span id="l3.60">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l3.61"></a><span id="l3.61">                     if (!aNumber) {</span>
<a href="#l3.62"></a><span id="l3.62">                         this.goToDay(now());</span>
<a href="#l3.63"></a><span id="l3.63">                     } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-decorated-month-view.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-decorated-month-view.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -42,59 +42,55 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;!-- Note that this file depends on helper functions in calUtils.js--&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> &lt;bindings id=&quot;calendar-specific-view-bindings&quot;</span>
<a href="#l4.7"></a><span id="l4.7">     xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.8"></a><span id="l4.8">     xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l4.9"></a><span id="l4.9">     xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">     &lt;binding id=&quot;calendar-decorated-month-view&quot; extends=&quot;chrome://calendar/content/calendar-decorated-month-view.xml#calendar-decorated-month-view-parent&quot;&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-        &lt;content  flex=&quot;1&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-            &lt;xul:calendar-month-view style=&quot;overflow: auto;&quot; anonid=&quot;view-element&quot; flex=&quot;1&quot; xbl:inherits=&quot;context,item-context&quot;/&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-        &lt;/content&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-        &lt;implementation implements=&quot;calIDecoratedView&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">             &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.21"></a><span id="l4.21">                     return &quot;month-view-observer&quot;;</span>
<a href="#l4.22"></a><span id="l4.22">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.23"></a><span id="l4.23">             &lt;/property&gt;</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">             &lt;!--Public methods--&gt;</span>
<a href="#l4.26"></a><span id="l4.26">             &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l4.27"></a><span id="l4.27">                 &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l4.28"></a><span id="l4.28">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-                    let viewElement = this.viewElem;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-                    viewElement.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-                    aDate = aDate.getInTimezone(viewElement.timezone);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+                    aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                    this.setDateRange(aDate.startOfMonth, aDate.endOfMonth);</span>
<a href="#l4.36"></a><span id="l4.36">                     let toolTips = calGetStringArray(&quot;calendar&quot;,</span>
<a href="#l4.37"></a><span id="l4.37">                                                       [&quot;oneMonthBack&quot;, &quot;gotoToday&quot;, &quot;oneMonthForward&quot;]);</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-                    this.setDateRange(aDate.startOfMonth, aDate.endOfMonth, toolTips);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-                    viewElement.showDate(aDate);</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+                    cal.navigationBar.setDateRange(aDate.startOfMonth, aDate.endOfMonth, toolTips);</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+                    this.showDate(aDate);</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+                    this.selectedDay = aDate;</span>
<a href="#l4.43"></a><span id="l4.43">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l4.44"></a><span id="l4.44">             &lt;/method&gt;</span>
<a href="#l4.45"></a><span id="l4.45">             &lt;method name=&quot;getRangeDescription&quot;&gt;</span>
<a href="#l4.46"></a><span id="l4.46">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.47"></a><span id="l4.47">                     let monthName = calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + (this.rangeStartDate.month + 1) + &quot;.name&quot;);</span>
<a href="#l4.48"></a><span id="l4.48">                     return calGetString(&quot;calendar&quot;, &quot;monthInYear&quot;, [monthName, this.rangeStartDate.year]);</span>
<a href="#l4.49"></a><span id="l4.49">                  ]]&gt;&lt;/body&gt;</span>
<a href="#l4.50"></a><span id="l4.50">              &lt;/method&gt;</span>
<a href="#l4.51"></a><span id="l4.51">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l4.52"></a><span id="l4.52">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l4.53"></a><span id="l4.53">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-                    let monthViewElement = this.viewElem;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-                    let dates = monthViewElement.getDateList({});</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-                    monthViewElement.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+                    let dates = this.getDateList({});</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60">                     if (!aNumber) {</span>
<a href="#l4.61"></a><span id="l4.61">                         let date = now();</span>
<a href="#l4.62"></a><span id="l4.62">                         this.goToDay(date);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-                        monthViewElement.selectedDay = date;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+                        this.selectedDay = date;</span>
<a href="#l4.65"></a><span id="l4.65">                     } else {</span>
<a href="#l4.66"></a><span id="l4.66">                         // The first few dates in this list are likely in the month</span>
<a href="#l4.67"></a><span id="l4.67">                         // prior to the one actually being shown (since the month</span>
<a href="#l4.68"></a><span id="l4.68">                         // probably doesn't start on a Sunday).  The 7th item must</span>
<a href="#l4.69"></a><span id="l4.69">                         // be in correct month though.</span>
<a href="#l4.70"></a><span id="l4.70">                         let date = dates[6].clone();</span>
<a href="#l4.71"></a><span id="l4.71"> </span>
<a href="#l4.72"></a><span id="l4.72">                         date.month += aNumber;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineat">@@ -108,172 +104,76 @@</span>
<a href="#l4.74"></a><span id="l4.74">                         let newSelectedDay = oldSelectedDay.clone();</span>
<a href="#l4.75"></a><span id="l4.75">                         newSelectedDay.month += aNumber;</span>
<a href="#l4.76"></a><span id="l4.76">                         // correct for accidental rollover into the next month</span>
<a href="#l4.77"></a><span id="l4.77">                         if ((newSelectedDay.month - aNumber + 12) % 12 != oldSelectedDay.month) {</span>
<a href="#l4.78"></a><span id="l4.78">                             newSelectedDay.month -= 1;</span>
<a href="#l4.79"></a><span id="l4.79">                             newSelectedDay.day = newSelectedDay.endOfMonth.day;</span>
<a href="#l4.80"></a><span id="l4.80">                         }</span>
<a href="#l4.81"></a><span id="l4.81"> </span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-                        monthViewElement.selectedDay = newSelectedDay;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+                        this.selectedDay = newSelectedDay;</span>
<a href="#l4.84"></a><span id="l4.84">                     }</span>
<a href="#l4.85"></a><span id="l4.85">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l4.86"></a><span id="l4.86">             &lt;/method&gt;</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-            &lt;method name=&quot;updateDaysOffPrefs&quot;&gt;</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-                    const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-                    const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-                                       &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-                                       &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-                    const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-                                      &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-                    let daysOff = new Array();</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-                    for (let i in prefNames) {</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-                        if (getPrefSafe(weekPrefix + prefNames[i])) {</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-                            daysOff.push(Number(i));</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-                        }</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-                    }</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-                    this.viewElem.daysOffArray = daysOff;</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l4.104"></a><span id="l4.104">         &lt;/implementation&gt;</span>
<a href="#l4.105"></a><span id="l4.105">     &lt;/binding&gt;</span>
<a href="#l4.106"></a><span id="l4.106"> </span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-    &lt;binding id=&quot;calendar-decorated-month-view-parent&quot; extends=&quot;chrome://calendar/content/calendar-decorated-base.xml#calendar-decorated-base-view&quot;&gt;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+    &lt;binding id=&quot;calendar-decorated-month-view-parent&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-view&quot;&gt;</span>
<a href="#l4.109"></a><span id="l4.109">         &lt;implementation&gt;</span>
<a href="#l4.110"></a><span id="l4.110">             &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.111"></a><span id="l4.111">                 // Set the preference for the default start of the week</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-                this.viewElem.weekStartOffset = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-                this.updateDaysOffPrefs();</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-                // add a preference observer to monitor changes</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-                let pb2 = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-                          getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-                pb2.addObserver(&quot;calendar.&quot;, this.mPrefObserver, false);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-                return;</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+                this.weekStartOffset = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l4.122"></a><span id="l4.122">             ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.123"></a><span id="l4.123"> </span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-            &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-                let pb2 = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-                          getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-                pb2.removeObserver(&quot;calendar.&quot;, this.mPrefObserver);</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-                return;</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-            ]]&gt;&lt;/destructor&gt;</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-            &lt;field name=&quot;mPrefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-            ({ calView: this,</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-               observe: function calDecWeekViewPrefChange(subj, topic, pref) {</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-                   subj.QueryInterface(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+            &lt;method name=&quot;handlePreference&quot;&gt;</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+                &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+                &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+                &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+                   aSubject.QueryInterface(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l4.141"></a><span id="l4.141"> </span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-                   // refresh view if categories seem to have changed</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-                   if (pref.indexOf(&quot;calendar.category.color&quot;) == 0) {</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-                       if (!this.calView.startDay || !this.calView.endDay) {</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-                           // Don't refresh if we're not initialized</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-                           return;</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-                       }</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-                       // Refresh the view to recreate the event boxes</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-                       this.calView.goToDay(this.calView.selectedDay);</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-                   }</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-                   switch (pref) {</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-                   case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-                   case &quot;calendar.week.d0sundaysoff&quot;:</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-                   case &quot;calendar.week.d1mondaysoff&quot;:</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-                   case &quot;calendar.week.d2tuesdaysoff&quot;:</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-                   case &quot;calendar.week.d3wednesdaysoff&quot;:</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-                   case &quot;calendar.week.d4thursdaysoff&quot;:</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-                   case &quot;calendar.week.d5fridaysoff&quot;:</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-                   case &quot;calendar.week.d6saturdaysoff&quot;:</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-                       this.calView.updateDaysOffPrefs();</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-                       if (this.calView.selectedDay) {</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-                           this.calView.goToDay(this.calView.selectedDay);</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-                       }</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-                       break;</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineplus">+                   switch (aPreference) {</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+                       case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+                           this.updateDaysOffPrefs();</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineplus">+                           this.refreshView();</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineplus">+                           break;</span>
<a href="#l4.172"></a><span id="l4.172"> </span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-                   case &quot;calendar.week.start&quot;:</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-                       this.calView.viewElem.weekStartOffset = subj.getIntPref(pref);</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-                       if (!this.calView.startDay || !this.calView.endDay) {</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineminus">-                           // Don't refresh if we're not initialized</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineminus">-                           return;</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineminus">-                       }</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineminus">-</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-                       // Refresh the view so the settings take effect</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineminus">-                       this.calView.goToDay(this.calView.selectedDay);</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-                       break;</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineminus">-</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineminus">-                   case &quot;calendar.weeks.inview&quot;:</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-                       this.calView.weeksInView = subj.getIntPref(pref);</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-                       break;</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineminus">-</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-                   case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineminus">-                       this.refresh();</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineminus">-                       break;</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+                       case &quot;calendar.week.start&quot;:</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+                           this.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+                           // Refresh the view so the settings take effect</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+                           this.refreshView();</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+                           break;</span>
<a href="#l4.197"></a><span id="l4.197"> </span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-                   case &quot;calendar.timezone.local&quot;:</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-                       this.calView.viewElem.timezone = calendarDefaultTimezone();</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-                       if (!this.calView.startDay || !this.calView.endDay) {</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-                           // Don't refresh if we're not initialized</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-                           return;</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-                       }</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-                       this.calView.goToDay(this.calView.selectedDay);</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-                       break;</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+                       case &quot;calendar.weeks.inview&quot;:</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+                           this.weeksInView = aSubject.getIntPref(aPreference);</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+                           break;</span>
<a href="#l4.209"></a><span id="l4.209"> </span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-                   case &quot;calendar.alarms.indicator.show&quot;:</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-                       if (this.calView.startDay &amp;&amp; this.calView.endDay) {</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-                           // Refresh the view, the view core takes care of</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-                           // resetting the alarm image.</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-                           this.calView.goToDay(this.calView.selectedDay);</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-                       }</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineminus">-                       break;</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+                       case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+                           this.refreshView();</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineplus">+                           break;</span>
<a href="#l4.220"></a><span id="l4.220"> </span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-                   default:</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-                       break;</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+                       default:</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+                           this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+                           break;</span>
<a href="#l4.226"></a><span id="l4.226">                    }</span>
<a href="#l4.227"></a><span id="l4.227">                    return;</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-               }</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineminus">-            })</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-            ]]&gt;&lt;/field&gt;</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+                ]]&gt;&lt;/body&gt;</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+            &lt;/method&gt;</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineplus">+</span>
<a href="#l4.234"></a><span id="l4.234">             &lt;!-- this property may be overridden by the</span>
<a href="#l4.235"></a><span id="l4.235">                 descendent classes if neeeded  --&gt;</span>
<a href="#l4.236"></a><span id="l4.236">             &lt;property name=&quot;weeksInView&quot;&gt;</span>
<a href="#l4.237"></a><span id="l4.237">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.238"></a><span id="l4.238">                     return 0;</span>
<a href="#l4.239"></a><span id="l4.239">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.240"></a><span id="l4.240">                 &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.241"></a><span id="l4.241">                     return val;</span>
<a href="#l4.242"></a><span id="l4.242">                 ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.243"></a><span id="l4.243">             &lt;/property&gt;</span>
<a href="#l4.244"></a><span id="l4.244"> </span>
<a href="#l4.245"></a><span id="l4.245" class="difflineminus">-            &lt;!-- this methody may be overridden by the</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-                descendent classes if neeeded  --&gt;</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-           &lt;method name=&quot;refreshView&quot;&gt;</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-           &lt;method name=&quot;updateDaysOffPrefs&quot;&gt;</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-                    const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-                    const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-                                       &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineminus">-                                       &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-                    const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-                                      &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-                    let daysOff = new Array();</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-                    for (let i in prefNames) {</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-                        if (getPrefSafe(weekPrefix+prefNames[i])) {</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-                            daysOff.push(Number(i));</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-                        }</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-                    }</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-                    this.viewElem.daysOffArray = daysOff;</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l4.269"></a><span id="l4.269">         &lt;/implementation&gt;</span>
<a href="#l4.270"></a><span id="l4.270"> </span>
<a href="#l4.271"></a><span id="l4.271">         &lt;handlers&gt;</span>
<a href="#l4.272"></a><span id="l4.272">             &lt;handler event=&quot;DOMMouseScroll&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.273"></a><span id="l4.273">               if (!event.ctrlKey &amp;&amp;</span>
<a href="#l4.274"></a><span id="l4.274">                   !event.shiftKey &amp;&amp;</span>
<a href="#l4.275"></a><span id="l4.275">                   !event.altKey &amp;&amp;</span>
<a href="#l4.276"></a><span id="l4.276">                   !event.metaKey) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-decorated-multiday-base-view.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-decorated-multiday-base-view.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">    - The Initial Developer of the Original Code is</span>
<a href="#l5.5"></a><span id="l5.5">    -   Joey Minta &lt;jminta@gmail.com&gt;</span>
<a href="#l5.6"></a><span id="l5.6">    - Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l5.7"></a><span id="l5.7">    - the Initial Developer. All Rights Reserved.</span>
<a href="#l5.8"></a><span id="l5.8">    -</span>
<a href="#l5.9"></a><span id="l5.9">    - Contributor(s):</span>
<a href="#l5.10"></a><span id="l5.10">    -   Dan Mosedale &lt;dan.mosedale@oracle.com&gt;</span>
<a href="#l5.11"></a><span id="l5.11">    -   Philipp Kewisch &lt;mozilla@kewis.ch&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+   -   Berend Cornelius &lt;berend.cornelius@sun.com&gt;</span>
<a href="#l5.13"></a><span id="l5.13">    -</span>
<a href="#l5.14"></a><span id="l5.14">    - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.15"></a><span id="l5.15">    - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.16"></a><span id="l5.16">    - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.17"></a><span id="l5.17">    - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.18"></a><span id="l5.18">    - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.19"></a><span id="l5.19">    - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.20"></a><span id="l5.20">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -39,166 +40,62 @@</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> &lt;bindings id=&quot;calendar-specific-view-bindings&quot;</span>
<a href="#l5.24"></a><span id="l5.24">     xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l5.25"></a><span id="l5.25">     xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l5.26"></a><span id="l5.26">     xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.27"></a><span id="l5.27">     xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">     &lt;binding id=&quot;calendar-decorated-multiday-base-view&quot;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-             extends=&quot;chrome://calendar/content/calendar-decorated-base.xml#calendar-decorated-base-view&quot;&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-        &lt;implementation implements=&quot;calIDecoratedView&quot;&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+             extends=&quot;chrome://calendar/content/calendar-multiday-view.xml#calendar-multiday-view&quot;&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l5.34"></a><span id="l5.34">             &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l5.35"></a><span id="l5.35">                 // get day start/end hour from prefs and set on the view</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-                this.mDayStartMin = getPrefSafe(</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-                                    &quot;calendar.view.daystarthour&quot;, 8) * 60;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-                this.mDayEndMin = getPrefSafe(</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-                                  &quot;calendar.view.dayendhour&quot;, 17) * 60;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-                var viewElement = this.viewElem;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-                viewElement.setDayStartEndMinutes(this.mDayStartMin,</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-                                                  this.mDayEndMin);</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+                this.setDayStartEndMinutes(getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8) * 60,</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+                                           getPrefSafe(&quot;calendar.view.dayendhour&quot;, 17) * 60);</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">                 // initially scroll to the day start hour in the view</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-                viewElement.scrollToMinute(this.mDayStartMin);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+                this.scrollToMinute(this.mDayStartMin);</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50">                 // get visible hours from prefs and set on the view</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-                var visibleMinutes = getPrefSafe(</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-                                     &quot;calendar.view.visiblehours&quot;, 9) * 60;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-                viewElement.setVisibleMinutes(visibleMinutes);</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-                // add a preference observer to monitor changes</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-                var pb2 = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-                          getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-                pb2.addObserver(&quot;calendar.&quot;, this.mPrefObserver, false);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-                this.updateDaysOffPrefs();</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-            ]]&gt;&lt;/constructor&gt;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-            &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-                var pb2 = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-                          getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-                pb2.removeObserver(&quot;calendar.&quot;, this.mPrefObserver);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-            ]]&gt;&lt;/destructor&gt;</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+                let visibleMinutes = getPrefSafe(&quot;calendar.view.visiblehours&quot;, 9) * 60;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+                this.setVisibleMinutes(visibleMinutes);</span>
<a href="#l5.70"></a><span id="l5.70"> </span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-            &lt;field name=&quot;mDayStartMin&quot;&gt;8*60&lt;/field&gt;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-            &lt;field name=&quot;mDayEndMin&quot;&gt;17*60&lt;/field&gt;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-            &lt;field name=&quot;mPrefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-            ({ calView: this,</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-               observe: function calDecMultidayViewPrefChange(subj, topic, pref) {</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-                   this.calView.handlePreference(subj, topic, pref);</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-                   return;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-               }</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-            })</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-            ]]&gt;&lt;/field&gt;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-            &lt;!-- A preference handler which is called by the preference observer.</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-                 Can be overriden in derived bindings. --&gt;</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-            &lt;method name=&quot;handlePreference&quot;&gt;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-                &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-                &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-                &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-                    this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+            ]]&gt;&lt;/constructor&gt;</span>
<a href="#l5.94"></a><span id="l5.94"> </span>
<a href="#l5.95"></a><span id="l5.95">             &lt;!-- A base implementation for the handling of common preferences.</span>
<a href="#l5.96"></a><span id="l5.96">                  Can be called in handlePreference from derived bindings. --&gt;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-            &lt;method name=&quot;handleCommonPreference&quot;&gt;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+            &lt;method name=&quot;handlePreference&quot;&gt;</span>
<a href="#l5.99"></a><span id="l5.99">                 &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l5.100"></a><span id="l5.100">                 &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l5.101"></a><span id="l5.101">                 &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l5.102"></a><span id="l5.102">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.103"></a><span id="l5.103">                     aSubject.QueryInterface(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-</span>
<a href="#l5.105"></a><span id="l5.105">                     switch (aPreference) {</span>
<a href="#l5.106"></a><span id="l5.106"> </span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-                        case &quot;calendar.week.d0sundaysoff&quot;:</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-                        case &quot;calendar.week.d1mondaysoff&quot;:</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-                        case &quot;calendar.week.d2tuesdaysoff&quot;:</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-                        case &quot;calendar.week.d3wednesdaysoff&quot;:</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-                        case &quot;calendar.week.d4thursdaysoff&quot;:</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-                        case &quot;calendar.week.d5fridaysoff&quot;:</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-                        case &quot;calendar.week.d6saturdaysoff&quot;:</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-                            this.updateDaysOffPrefs();</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-                            if (!this.startDay || !this.endDay) {</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-                                // don't refresh if we're not initialized</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-                                return;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineminus">-                            }</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-                            this.goToDay(this.selectedDay);</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-                            break;</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+                        case &quot;calendar.view.daystarthour&quot;:</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+                            this.setDayStartEndMinutes(aSubject.getIntPref(aPreference) * 60,</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+                                                       this.mDayEndMin);</span>
<a href="#l5.124"></a><span id="l5.124"> </span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-                        case &quot;calendar.view.daystarthour&quot;:</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-                            this.mDayStartMin = aSubject.getIntPref(aPreference) * 60;</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-                            this.viewElem.setDayStartEndMinutes(this.mDayStartMin,</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-                                                                this.mDayEndMin);</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-                            if (!this.startDay || !this.endDay) {</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-                                // don't refresh if we're not initialized</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-                                return;</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-                            }</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-                            this.goToDay(this.selectedDay);</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+                            this.refreshView();</span>
<a href="#l5.135"></a><span id="l5.135">                             break;</span>
<a href="#l5.136"></a><span id="l5.136"> </span>
<a href="#l5.137"></a><span id="l5.137">                         case &quot;calendar.view.dayendhour&quot;:</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-                            this.mDayEndMin = aSubject.getIntPref(aPreference) * 60;</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-                            this.viewElem.setDayStartEndMinutes(this.mDayStartMin,</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-                                                                this.mDayEndMin);</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-                            if (!this.startDay || !this.endDay) {</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-                                // don't refresh if we're not initialized</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-                                return;</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-                            }</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-                            this.goToDay(this.selectedDay);</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+                            this.setDayStartEndMinutes(this.mDayStartMin,</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+                                                       aSubject.getIntPref(aPreference) * 60);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+                            this.refreshView();</span>
<a href="#l5.149"></a><span id="l5.149">                             break;</span>
<a href="#l5.150"></a><span id="l5.150"> </span>
<a href="#l5.151"></a><span id="l5.151">                         case &quot;calendar.view.visiblehours&quot;:</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-                            var visibleMinutes = aSubject.getIntPref(aPreference) * 60;</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-                            this.viewElem.setVisibleMinutes(visibleMinutes);</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-                            if (!this.startDay || !this.endDay) {</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-                                // don't refresh if we're not initialized</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-                                return;</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-                            }</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-                            this.goToDay(this.selectedDay);</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-                            break;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-                        case &quot;calendar.timezone.local&quot;:</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-                            this.viewElem.timezone = calendarDefaultTimezone();</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-                            if (!this.startDay || !this.endDay) {</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-                                // don't refresh if we're not initialized</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-                                return;</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-                            }</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-                            this.goToDay(this.selectedDay);</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-                            break;</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-                        case &quot;calendar.alarms.indicator.show&quot;:</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-                            if (this.startDay &amp;&amp; this.endDay) {</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-                                // Refresh the view, the view core takes care of</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-                                // resetting the alarm image.</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-                                this.goToDay(this.selectedDay);</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineminus">-                            }</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+                            this.setVisibleMinutes(aSubject.getIntPref(aPreference) * 60);</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+                            this.refreshView();</span>
<a href="#l5.178"></a><span id="l5.178">                             break;</span>
<a href="#l5.179"></a><span id="l5.179"> </span>
<a href="#l5.180"></a><span id="l5.180">                         default:</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+                            this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l5.182"></a><span id="l5.182">                             break;</span>
<a href="#l5.183"></a><span id="l5.183">                     }</span>
<a href="#l5.184"></a><span id="l5.184">                     return;</span>
<a href="#l5.185"></a><span id="l5.185">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l5.186"></a><span id="l5.186">             &lt;/method&gt;</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-            &lt;method name=&quot;updateDaysOffPrefs&quot;&gt;</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-                    var prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-                                     &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-                                     &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-                    var defaults = [true, false, false, false, false, false, true];</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-                    var daysOff = new Array();</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineminus">-                    const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineminus">-                    for (var i in prefNames) {</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineminus">-                         if (getPrefSafe(weekPrefix+prefNames[i], defaults[i])) {</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineminus">-                                daysOff.push(Number(i));</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-                         }</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-                    }</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineminus">-                    this.viewElem.daysOffArray = daysOff;</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l5.204"></a><span id="l5.204">         &lt;/implementation&gt;</span>
<a href="#l5.205"></a><span id="l5.205">     &lt;/binding&gt;</span>
<a href="#l5.206"></a><span id="l5.206"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-decorated-multiweek-view.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-decorated-multiweek-view.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -43,95 +43,80 @@</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> &lt;bindings id=&quot;calendar-specific-view-bindings&quot;</span>
<a href="#l6.6"></a><span id="l6.6">     xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l6.7"></a><span id="l6.7">     xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l6.8"></a><span id="l6.8">     xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l6.9"></a><span id="l6.9">     xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     &lt;binding id=&quot;calendar-decorated-multiweek-view&quot; extends=&quot;chrome://calendar/content/calendar-decorated-month-view.xml#calendar-decorated-month-view-parent&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        &lt;content  flex=&quot;1&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-            &lt;xul:calendar-month-view anonid=&quot;view-element&quot; style=&quot;overflow: auto;&quot; flex=&quot;1&quot; xbl:inherits=&quot;context,item-context&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-        &lt;/content&gt;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-        &lt;implementation implements=&quot;calIDecoratedView&quot;&gt;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l6.18"></a><span id="l6.18"> 	        &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l6.19"></a><span id="l6.19">                 this.mWeeksInView = getPrefSafe(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l6.20"></a><span id="l6.20">             ]]&gt;&lt;/constructor&gt;</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">             &lt;field name=&quot;mWeeksInView&quot;&gt;4&lt;/field&gt;</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">             &lt;property name=&quot;weeksInView&quot;&gt;</span>
<a href="#l6.25"></a><span id="l6.25">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l6.26"></a><span id="l6.26">                     return this.mWeeksInView;</span>
<a href="#l6.27"></a><span id="l6.27">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l6.28"></a><span id="l6.28">                 &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l6.29"></a><span id="l6.29">                     this.mWeeksInView = val;</span>
<a href="#l6.30"></a><span id="l6.30">                     setPref(&quot;calendar.weeks.inview&quot;, val);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-                    if (this.selectedDay) {</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-                        this.goToDay(this.selectedDay);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-                    }</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+                    this.refreshView();</span>
<a href="#l6.36"></a><span id="l6.36">                     return val;</span>
<a href="#l6.37"></a><span id="l6.37">                 ]]&gt;&lt;/setter&gt;</span>
<a href="#l6.38"></a><span id="l6.38">             &lt;/property&gt;</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">             &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l6.41"></a><span id="l6.41">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l6.42"></a><span id="l6.42">                     return &quot;multiweek-view-observer&quot;;</span>
<a href="#l6.43"></a><span id="l6.43">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l6.44"></a><span id="l6.44">             &lt;/property&gt;</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-           &lt;method name=&quot;refreshView&quot;&gt;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-                   // Just refresh, the goToDay function will notice</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-                   this.calView.goToDay(this.calView.selectedDay);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-</span>
<a href="#l6.53"></a><span id="l6.53">             &lt;!--Public methods--&gt;</span>
<a href="#l6.54"></a><span id="l6.54">             &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l6.55"></a><span id="l6.55">                 &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l6.56"></a><span id="l6.56">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-                    let viewElement = this.viewElem;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-                    viewElement.showFullMonth = false;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-                    viewElement.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+                    this.showFullMonth = false;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l6.62"></a><span id="l6.62"> </span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-                    aDate = aDate.getInTimezone(viewElement.timezone);</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+                    aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l6.65"></a><span id="l6.65"> </span>
<a href="#l6.66"></a><span id="l6.66">                     // Get the first date that should be shown.  This is the</span>
<a href="#l6.67"></a><span id="l6.67">                     // start of the week of the day that we're centering around</span>
<a href="#l6.68"></a><span id="l6.68">                     // adjusted for the day the week starts on and the number</span>
<a href="#l6.69"></a><span id="l6.69">                     // of previous weeks we're supposed to display.</span>
<a href="#l6.70"></a><span id="l6.70">                     let d1 = getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l6.71"></a><span id="l6.71">                     d1.day -= (7 * getPrefSafe(&quot;calendar.previousweeks.inview&quot;, 0));</span>
<a href="#l6.72"></a><span id="l6.72">                     // The last day we're supposed to show</span>
<a href="#l6.73"></a><span id="l6.73">                     let d2 = d1.clone();</span>
<a href="#l6.74"></a><span id="l6.74">                     d2.day += ((7 * this.mWeeksInView) - 1);</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+                    this.setDateRange(d1,d2);</span>
<a href="#l6.76"></a><span id="l6.76">                     let toolTips = calGetStringArray(&quot;calendar&quot;,</span>
<a href="#l6.77"></a><span id="l6.77">                                                      [&quot;oneWeekBack&quot;, &quot;gotoToday&quot;, &quot;oneWeekForward&quot;]);</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-                    this.setDateRange(d1,d2, toolTips);</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-                    viewElement.setDateRange(d1, d2);</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-                    viewElement.selectedDay = aDate;</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+                    cal.navigationBar.setDateRange(d1,d2, toolTips);</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+                    this.selectedDay = aDate;</span>
<a href="#l6.83"></a><span id="l6.83">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l6.84"></a><span id="l6.84">             &lt;/method&gt;</span>
<a href="#l6.85"></a><span id="l6.85">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l6.86"></a><span id="l6.86">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l6.87"></a><span id="l6.87">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.88"></a><span id="l6.88">                     if (!aNumber) {</span>
<a href="#l6.89"></a><span id="l6.89">                         let date = now();</span>
<a href="#l6.90"></a><span id="l6.90">                         this.goToDay(date);</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-                        this.viewElem.selectedDay = date;</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+                        this.selectedDay = date;</span>
<a href="#l6.93"></a><span id="l6.93">                     } else {</span>
<a href="#l6.94"></a><span id="l6.94">                         let d1 = this.startDay.clone();</span>
<a href="#l6.95"></a><span id="l6.95">                         let savedSelectedDay = this.selectedDay.clone();</span>
<a href="#l6.96"></a><span id="l6.96">                         // aNumber only corresponds to the number of weeks to move</span>
<a href="#l6.97"></a><span id="l6.97">                         // make sure to compensate for previous weeks in view too</span>
<a href="#l6.98"></a><span id="l6.98">                         d1.day += 7 * (aNumber + getPrefSafe(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l6.99"></a><span id="l6.99">                         this.goToDay(d1);</span>
<a href="#l6.100"></a><span id="l6.100">                         savedSelectedDay.day += 7 * aNumber;</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-                        this.viewElem.selectedDay = savedSelectedDay;</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineplus">+                        this.selectedDay = savedSelectedDay;</span>
<a href="#l6.103"></a><span id="l6.103">                     }</span>
<a href="#l6.104"></a><span id="l6.104">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l6.105"></a><span id="l6.105">             &lt;/method&gt;</span>
<a href="#l6.106"></a><span id="l6.106">         &lt;/implementation&gt;</span>
<a href="#l6.107"></a><span id="l6.107">     &lt;/binding&gt;</span>
<a href="#l6.108"></a><span id="l6.108"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-decorated-week-view.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-decorated-week-view.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">    -</span>
<a href="#l7.5"></a><span id="l7.5">    - The Initial Developer of the Original Code is</span>
<a href="#l7.6"></a><span id="l7.6">    -   Joey Minta &lt;jminta@gmail.com&gt;</span>
<a href="#l7.7"></a><span id="l7.7">    - Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l7.8"></a><span id="l7.8">    - the Initial Developer. All Rights Reserved.</span>
<a href="#l7.9"></a><span id="l7.9">    -</span>
<a href="#l7.10"></a><span id="l7.10">    - Contributor(s):</span>
<a href="#l7.11"></a><span id="l7.11">    -   Dan Mosedale &lt;dan.mosedale@oracle.com&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+   -   Berend Cornelius &lt;berend.cornelius@sun.com&gt;</span>
<a href="#l7.13"></a><span id="l7.13">    -</span>
<a href="#l7.14"></a><span id="l7.14">    - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l7.15"></a><span id="l7.15">    - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l7.16"></a><span id="l7.16">    - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l7.17"></a><span id="l7.17">    - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l7.18"></a><span id="l7.18">    - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l7.19"></a><span id="l7.19">    - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l7.20"></a><span id="l7.20">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -43,87 +44,38 @@</span>
<a href="#l7.22"></a><span id="l7.22"> &lt;bindings id=&quot;calendar-specific-view-bindings&quot;</span>
<a href="#l7.23"></a><span id="l7.23">     xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l7.24"></a><span id="l7.24">     xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l7.25"></a><span id="l7.25">     xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l7.26"></a><span id="l7.26">     xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28">     &lt;binding id=&quot;calendar-decorated-week-view&quot;</span>
<a href="#l7.29"></a><span id="l7.29">              extends=&quot;chrome://calendar/content/calendar-decorated-multiday-base-view.xml#calendar-decorated-multiday-base-view&quot;&gt;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-        &lt;content flex=&quot;1&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-          &lt;xul:calendar-multiday-view anonid=&quot;view-element&quot; flex=&quot;1&quot; orient=&quot;vertical&quot; xbl:inherits=&quot;context,item-context&quot;/&gt;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-        &lt;/content&gt;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-        &lt;implementation implements=&quot;calIDecoratedView&quot;&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-            &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-                this.mWeekStartOffset = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-            ]]&gt;&lt;/constructor&gt;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-            &lt;field name=&quot;mWeekStartOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l7.42"></a><span id="l7.42">             &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l7.43"></a><span id="l7.43">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l7.44"></a><span id="l7.44">                     return &quot;week-view-observer&quot;;</span>
<a href="#l7.45"></a><span id="l7.45">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l7.46"></a><span id="l7.46">             &lt;/property&gt;</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-            &lt;method name=&quot;handlePreference&quot;&gt;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-                &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-                &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-                &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-                    aSubject.QueryInterface(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-                    // refresh view if categories seem to have changed</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-                    if (aPreference.indexOf(&quot;calendar.category.color&quot;) == 0) {</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-                        if (!this.startDay || !this.endDay) {</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-                            // Don't refresh if we're not initialized</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-                            return;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-                        }</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-                        // Refresh the view to recreate the event boxes</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-                        this.goToDay(this.selectedDay);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-                    }</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-                    switch (aPreference) {</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-                        case &quot;calendar.week.start&quot;:</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-                            this.mWeekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-                            this.viewElem.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-                            if (!this.startDay || !this.endDay) {</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-                                // Don't refresh if we're not initialized</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-                                return;</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-                            }</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-                            // Refresh the view so the settings take effect</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-                            this.goToDay(this.selectedDay);</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-                            break;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-                        default:</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-                            this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-                            break;</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-                    }</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-                    return;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-</span>
<a href="#l7.86"></a><span id="l7.86">             &lt;!--Public methods--&gt;</span>
<a href="#l7.87"></a><span id="l7.87">             &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l7.88"></a><span id="l7.88">                 &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l7.89"></a><span id="l7.89">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-                    var viewElement = this.viewElem;</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-                    viewElement.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l7.93"></a><span id="l7.93"> </span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-                    aDate = aDate.getInTimezone(viewElement.timezone);</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+                    aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l7.96"></a><span id="l7.96">                     var d1 = getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l7.97"></a><span id="l7.97">                     var d2 = d1.clone();</span>
<a href="#l7.98"></a><span id="l7.98">                     d2.day += 6;</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+                    this.setDateRange(d1, d2);</span>
<a href="#l7.100"></a><span id="l7.100">                     var toolTips = calGetStringArray(&quot;calendar&quot;,</span>
<a href="#l7.101"></a><span id="l7.101">                                                      [&quot;oneWeekBack&quot;, &quot;gotoToday&quot;, &quot;oneWeekForward&quot;]);</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-                    this.setDateRange(d1, d2, toolTips);</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-                    viewElement.setDateRange(d1, d2);</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-                    viewElement.selectedDay = aDate;</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+                    cal.navigationBar.setDateRange(d1, d2, toolTips);</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+                    this.selectedDay = aDate;</span>
<a href="#l7.107"></a><span id="l7.107">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l7.108"></a><span id="l7.108">             &lt;/method&gt;</span>
<a href="#l7.109"></a><span id="l7.109">             &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l7.110"></a><span id="l7.110">                 &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l7.111"></a><span id="l7.111">                 &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.112"></a><span id="l7.112">                     if (!aNumber) {</span>
<a href="#l7.113"></a><span id="l7.113">                         this.goToDay(now());</span>
<a href="#l7.114"></a><span id="l7.114">                     } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -422,17 +422,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">                 event.stopPropagation();</span>
<a href="#l8.5"></a><span id="l8.5">             }</span>
<a href="#l8.6"></a><span id="l8.6">         }</span>
<a href="#l8.7"></a><span id="l8.7">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l8.8"></a><span id="l8.8">     &lt;/handlers&gt;</span>
<a href="#l8.9"></a><span id="l8.9">   &lt;/binding&gt;</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   &lt;binding id=&quot;calendar-month-view&quot; extends=&quot;chrome://calendar/content/calendar-base-view.xml#calendar-base-view&quot;&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    &lt;content style=&quot;overflow: auto;&quot; flex=&quot;1&quot; xbl:inherits=&quot;context,item-context&quot;&gt;</span>
<a href="#l8.14"></a><span id="l8.14">       &lt;xul:vbox anonid=&quot;mainbox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l8.15"></a><span id="l8.15">         &lt;xul:hbox class=&quot;labeldaybox-container&quot; anonid=&quot;labeldaybox&quot; equalsize=&quot;always&quot;/&gt;</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">         &lt;xul:grid anonid=&quot;monthgrid&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l8.18"></a><span id="l8.18">           &lt;xul:columns anonid=&quot;monthgridcolumns&quot; equalsize=&quot;always&quot;&gt;</span>
<a href="#l8.19"></a><span id="l8.19">             &lt;xul:column flex=&quot;1&quot; class=&quot;calendar-month-view-grid-column&quot;/&gt;</span>
<a href="#l8.20"></a><span id="l8.20">             &lt;xul:column flex=&quot;1&quot; class=&quot;calendar-month-view-grid-column&quot;/&gt;</span>
<a href="#l8.21"></a><span id="l8.21">             &lt;xul:column flex=&quot;1&quot; class=&quot;calendar-month-view-grid-column&quot;/&gt;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -516,17 +516,16 @@</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24">       &lt;!-- fields --&gt;</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">       &lt;field name=&quot;mDateBoxes&quot;&gt;null&lt;/field&gt;</span>
<a href="#l8.27"></a><span id="l8.27">       &lt;field name=&quot;mSelectedDayBox&quot;&gt;null&lt;/field&gt;</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">       &lt;field name=&quot;mShowDaysOutsideMonth&quot;&gt;true&lt;/field&gt;</span>
<a href="#l8.30"></a><span id="l8.30">       &lt;field name=&quot;mShowFullMonth&quot;&gt;true&lt;/field&gt;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-      &lt;field name=&quot;mWeekStartOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">       &lt;!-- other methods --&gt;</span>
<a href="#l8.34"></a><span id="l8.34">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l8.35"></a><span id="l8.35">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l8.36"></a><span id="l8.36">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l8.37"></a><span id="l8.37">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.38"></a><span id="l8.38">           var needsrelayout = false;</span>
<a href="#l8.39"></a><span id="l8.39">           if (aAttr == &quot;context&quot; || aAttr == &quot;item-context&quot;)</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineat">@@ -543,27 +542,16 @@</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42">       &lt;!-- calICalendarView --&gt;</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44">       &lt;property name=&quot;supportsDisjointDates&quot; readonly=&quot;true&quot;</span>
<a href="#l8.45"></a><span id="l8.45">                 onget=&quot;return false;&quot;/&gt;</span>
<a href="#l8.46"></a><span id="l8.46">       &lt;property name=&quot;hasDisjointDates&quot; readonly=&quot;true&quot;</span>
<a href="#l8.47"></a><span id="l8.47">                 onget=&quot;return false;&quot;/&gt;</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-      &lt;property name=&quot;weekStartOffset&quot;&gt;</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-           return this.mWeekStartOffset;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-           this.mWeekStartOffset = val;</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-           return val;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-</span>
<a href="#l8.60"></a><span id="l8.60">       &lt;property name=&quot;startDate&quot; readonly=&quot;true&quot;</span>
<a href="#l8.61"></a><span id="l8.61">                 onget=&quot;return this.mStartDate&quot;/&gt;</span>
<a href="#l8.62"></a><span id="l8.62"> </span>
<a href="#l8.63"></a><span id="l8.63">       &lt;property name=&quot;endDate&quot; readonly=&quot;true&quot;</span>
<a href="#l8.64"></a><span id="l8.64">                 onget=&quot;return this.mEndDate&quot;/&gt;</span>
<a href="#l8.65"></a><span id="l8.65"> </span>
<a href="#l8.66"></a><span id="l8.66">       &lt;property name=&quot;showFullMonth&quot;&gt;</span>
<a href="#l8.67"></a><span id="l8.67">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineat">@@ -658,16 +646,18 @@</span>
<a href="#l8.69"></a><span id="l8.69">           aBinding.adjustWeekdayLength();</span>
<a href="#l8.70"></a><span id="l8.70">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.71"></a><span id="l8.71">       &lt;/method&gt;</span>
<a href="#l8.72"></a><span id="l8.72"> </span>
<a href="#l8.73"></a><span id="l8.73">       &lt;method name=&quot;setDateRange&quot;&gt;</span>
<a href="#l8.74"></a><span id="l8.74">         &lt;parameter name=&quot;aStartDate&quot;/&gt;</span>
<a href="#l8.75"></a><span id="l8.75">         &lt;parameter name=&quot;aEndDate&quot;/&gt;</span>
<a href="#l8.76"></a><span id="l8.76">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+          this.rangeStartDate = aStartDate;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+          this.rangeEndDate = aEndDate;</span>
<a href="#l8.79"></a><span id="l8.79">           this.mStartDate = getWeekInfoService().getStartOfWeek(aStartDate.getInTimezone(this.mTimezone))</span>
<a href="#l8.80"></a><span id="l8.80">           this.mEndDate = getWeekInfoService().getEndOfWeek(aEndDate.getInTimezone(this.mTimezone));</span>
<a href="#l8.81"></a><span id="l8.81">           this.refresh();</span>
<a href="#l8.82"></a><span id="l8.82">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.83"></a><span id="l8.83">       &lt;/method&gt;</span>
<a href="#l8.84"></a><span id="l8.84"> </span>
<a href="#l8.85"></a><span id="l8.85">       &lt;method name=&quot;setDateList&quot;&gt;</span>
<a href="#l8.86"></a><span id="l8.86">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineat">@@ -787,17 +777,16 @@</span>
<a href="#l8.88"></a><span id="l8.88">               // the month being currently shown or not.</span>
<a href="#l8.89"></a><span id="l8.89">               var boxClass;</span>
<a href="#l8.90"></a><span id="l8.90">               if (this.showFullMonth) {</span>
<a href="#l8.91"></a><span id="l8.91">                   boxClass = &quot;calendar-month-day-box-&quot; + </span>
<a href="#l8.92"></a><span id="l8.92">                              (mainMonth == date.month ? &quot;current-month&quot; : &quot;other-month&quot;);</span>
<a href="#l8.93"></a><span id="l8.93">               } else {</span>
<a href="#l8.94"></a><span id="l8.94">                   boxClass = &quot;calendar-month-day-box-current-month&quot;;</span>
<a href="#l8.95"></a><span id="l8.95">               }</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-</span>
<a href="#l8.97"></a><span id="l8.97">               function matchesDayOff(dayOffNum) { return dayOffNum == date.weekday; }</span>
<a href="#l8.98"></a><span id="l8.98">               if (this.mDaysOffArray.some(matchesDayOff)) {</span>
<a href="#l8.99"></a><span id="l8.99">                 boxClass = &quot;calendar-month-day-box-day-off &quot; + boxClass;</span>
<a href="#l8.100"></a><span id="l8.100">               }</span>
<a href="#l8.101"></a><span id="l8.101"> </span>
<a href="#l8.102"></a><span id="l8.102">               // Set up date relations</span>
<a href="#l8.103"></a><span id="l8.103">               switch (date.compare(today)) {</span>
<a href="#l8.104"></a><span id="l8.104">                   case -1:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1259,17 +1259,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">               // the multiday view currently exhibits a less than optimal strategy</span>
<a href="#l9.6"></a><span id="l9.6">               // in terms of item selection. items don't get automatically selected</span>
<a href="#l9.7"></a><span id="l9.7">               // when clicked and dragged, as to differentiate inline editing from</span>
<a href="#l9.8"></a><span id="l9.8">               // the act of selecting an event. but the application internal drop</span>
<a href="#l9.9"></a><span id="l9.9">               // targets will ask for selected items in order to pull the data from</span>
<a href="#l9.10"></a><span id="l9.10">               // the packets. that's why we need to make sure at least the currently</span>
<a href="#l9.11"></a><span id="l9.11">               // dragged event is contained in the set of selected items.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-              var selectedItems = currentView().getSelectedItems({});</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+              let selectedItems = this.getSelectedItems({});</span>
<a href="#l9.14"></a><span id="l9.14">               if (!selectedItems.some(</span>
<a href="#l9.15"></a><span id="l9.15">                   function (aItem) {</span>
<a href="#l9.16"></a><span id="l9.16">                       return (aItem.hashId == item.hashId);</span>
<a href="#l9.17"></a><span id="l9.17">                   })) {</span>
<a href="#l9.18"></a><span id="l9.18">                   col.calendarView.setSelectedItems(1,</span>
<a href="#l9.19"></a><span id="l9.19">                       [event.ctrlKey ? item.parentItem : item]);</span>
<a href="#l9.20"></a><span id="l9.20">               }</span>
<a href="#l9.21"></a><span id="l9.21">               invokeEventDragSession(dragState.dragOccurrence, col);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -1665,16 +1665,17 @@</span>
<a href="#l9.23"></a><span id="l9.23">         &lt;parameter name=&quot;aDayEndMin&quot;/&gt;</span>
<a href="#l9.24"></a><span id="l9.24">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.25"></a><span id="l9.25">           if (aDayStartMin &lt; this.mStartMin || aDayStartMin &gt; aDayEndMin ||</span>
<a href="#l9.26"></a><span id="l9.26">             aDayEndMin &gt; this.mEndMin) {</span>
<a href="#l9.27"></a><span id="l9.27">             throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l9.28"></a><span id="l9.28">           }</span>
<a href="#l9.29"></a><span id="l9.29">           if (this.mDayStartMin != aDayStartMin ||</span>
<a href="#l9.30"></a><span id="l9.30">             this.mDayEndMin != aDayEndMin) {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+</span>
<a href="#l9.32"></a><span id="l9.32">             this.mDayStartMin = aDayStartMin;</span>
<a href="#l9.33"></a><span id="l9.33">             this.mDayEndMin = aDayEndMin;</span>
<a href="#l9.34"></a><span id="l9.34">           }</span>
<a href="#l9.35"></a><span id="l9.35">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.36"></a><span id="l9.36">       &lt;/method&gt;</span>
<a href="#l9.37"></a><span id="l9.37">     &lt;/implementation&gt;</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39">     &lt;handlers&gt;</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineat">@@ -2112,17 +2113,17 @@</span>
<a href="#l9.41"></a><span id="l9.41">             event.stopPropagation();</span>
<a href="#l9.42"></a><span id="l9.42">             onMouseOverItem(event);</span>
<a href="#l9.43"></a><span id="l9.43">         }</span>
<a href="#l9.44"></a><span id="l9.44">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l9.45"></a><span id="l9.45">     &lt;/handlers&gt;</span>
<a href="#l9.46"></a><span id="l9.46">   &lt;/binding&gt;</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48">   &lt;binding id=&quot;calendar-multiday-view&quot; extends=&quot;chrome://calendar/content/calendar-base-view.xml#calendar-base-view&quot;&gt;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+    &lt;content flex=&quot;1&quot; orient=&quot;vertical&quot; xbl:inherits=&quot;context,item-context&quot;&gt;</span>
<a href="#l9.51"></a><span id="l9.51">       &lt;xul:box anonid=&quot;mainbox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.52"></a><span id="l9.52">         &lt;!-- these boxes are tricky: width or height in CSS depend on orient --&gt;</span>
<a href="#l9.53"></a><span id="l9.53">         &lt;xul:box anonid=&quot;labelbox&quot;&gt;</span>
<a href="#l9.54"></a><span id="l9.54">           &lt;xul:box anonid=&quot;labeltimespacer&quot;/&gt;</span>
<a href="#l9.55"></a><span id="l9.55">           &lt;xul:box anonid=&quot;labeldaybox&quot; class=&quot;calendar-label-day-box&quot; flex=&quot;1&quot;</span>
<a href="#l9.56"></a><span id="l9.56">                    equalsize=&quot;always&quot; /&gt;</span>
<a href="#l9.57"></a><span id="l9.57">           &lt;xul:box anonid=&quot;labelscrollbarspacer&quot;/&gt;</span>
<a href="#l9.58"></a><span id="l9.58">         &lt;/xul:box&gt;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineat">@@ -2301,16 +2302,18 @@</span>
<a href="#l9.60"></a><span id="l9.60">           this.selectedDay = targetDate;</span>
<a href="#l9.61"></a><span id="l9.61">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.62"></a><span id="l9.62">       &lt;/method&gt;</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64">       &lt;method name=&quot;setDateRange&quot;&gt;</span>
<a href="#l9.65"></a><span id="l9.65">         &lt;parameter name=&quot;aStartDate&quot;/&gt;</span>
<a href="#l9.66"></a><span id="l9.66">         &lt;parameter name=&quot;aEndDate&quot;/&gt;</span>
<a href="#l9.67"></a><span id="l9.67">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+          this.rangeStartDate = aStartDate;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+          this.rangeEndDate = aEndDate;</span>
<a href="#l9.70"></a><span id="l9.70">           // normalize dates to display timezone</span>
<a href="#l9.71"></a><span id="l9.71">           var startDate = aStartDate.getInTimezone(this.mTimezone);</span>
<a href="#l9.72"></a><span id="l9.72">           startDate.isDate = true;</span>
<a href="#l9.73"></a><span id="l9.73">           var endDate = aEndDate.getInTimezone(this.mTimezone);</span>
<a href="#l9.74"></a><span id="l9.74">           endDate.isDate = true;</span>
<a href="#l9.75"></a><span id="l9.75">           // make sure unnormalized version not used below</span>
<a href="#l9.76"></a><span id="l9.76">           aStartDate = aEndDate = null;</span>
<a href="#l9.77"></a><span id="l9.77"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-views.xul</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -107,17 +107,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">        &lt;deck flex=&quot;1&quot;</span>
<a href="#l10.5"></a><span id="l10.5">             id=&quot;view-deck&quot;</span>
<a href="#l10.6"></a><span id="l10.6">             persist=&quot;selectedIndex&quot;</span>
<a href="#l10.7"></a><span id="l10.7">             ondraggesture=&quot;nsDragAndDrop.startDrag(event, calendarViewDNDObserver);&quot;</span>
<a href="#l10.8"></a><span id="l10.8">             ondragover=&quot;nsDragAndDrop.dragOver(event, calendarViewDNDObserver);&quot;</span>
<a href="#l10.9"></a><span id="l10.9">             ondragdrop=&quot;nsDragAndDrop.drop(event, calendarViewDNDObserver);&quot;&gt;</span>
<a href="#l10.10"></a><span id="l10.10">         &lt;!-- Note: the &quot;id&quot; attributes of the decorated panes **must** follow the</span>
<a href="#l10.11"></a><span id="l10.11">              notation 'type + &quot;-&quot; + &quot;view&quot;', where &quot;type&quot; should refer to the</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-             displayed time period as described in base/public/calIDecoratedView.idl --&gt;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+             displayed time period as described in base/public/calICalendarView.idl --&gt;</span>
<a href="#l10.14"></a><span id="l10.14">         &lt;calendar-decorated-day-view id=&quot;day-view&quot; flex=&quot;1&quot;</span>
<a href="#l10.15"></a><span id="l10.15">                                      context=&quot;calendar-view-context-menu&quot;</span>
<a href="#l10.16"></a><span id="l10.16">                                      item-context=&quot;calendar-item-context-menu&quot;/&gt;</span>
<a href="#l10.17"></a><span id="l10.17">         &lt;calendar-decorated-week-view id=&quot;week-view&quot; flex=&quot;1&quot;</span>
<a href="#l10.18"></a><span id="l10.18">                                       context=&quot;calendar-view-context-menu&quot;</span>
<a href="#l10.19"></a><span id="l10.19">                                       item-context=&quot;calendar-item-context-menu&quot;/&gt;</span>
<a href="#l10.20"></a><span id="l10.20">         &lt;calendar-decorated-multiweek-view id=&quot;multiweek-view&quot; flex=&quot;1&quot;</span>
<a href="#l10.21"></a><span id="l10.21">                                            context=&quot;calendar-view-context-menu&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/jar.mn</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/jar.mn</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -13,17 +13,16 @@ calendar.jar:</span>
<a href="#l11.4"></a><span id="l11.4">     content/calendar/calendar-bindings.css                 (content/calendar-bindings.css)</span>
<a href="#l11.5"></a><span id="l11.5">     content/calendar/calendar-calendars-list.xul           (content/calendar-calendars-list.xul)</span>
<a href="#l11.6"></a><span id="l11.6">     content/calendar/calendar-chrome-startup.js            (content/calendar-chrome-startup.js)</span>
<a href="#l11.7"></a><span id="l11.7">     content/calendar/calendar-clipboard.js                 (content/calendar-clipboard.js)</span>
<a href="#l11.8"></a><span id="l11.8"> *   content/calendar/calendar-common-sets.xul              (content/calendar-common-sets.xul)</span>
<a href="#l11.9"></a><span id="l11.9">     content/calendar/calendar-common-sets.js               (content/calendar-common-sets.js)</span>
<a href="#l11.10"></a><span id="l11.10">     content/calendar/calendar-creation.js                  (content/calendar-creation.js)</span>
<a href="#l11.11"></a><span id="l11.11">     content/calendar/calendar-daypicker.xml                (content/calendar-daypicker.xml)</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    content/calendar/calendar-decorated-base.xml           (content/calendar-decorated-base.xml)</span>
<a href="#l11.13"></a><span id="l11.13">     content/calendar/calendar-decorated-multiday-base-view.xml  (content/calendar-decorated-multiday-base-view.xml)</span>
<a href="#l11.14"></a><span id="l11.14">     content/calendar/calendar-decorated-day-view.xml       (content/calendar-decorated-day-view.xml)</span>
<a href="#l11.15"></a><span id="l11.15">     content/calendar/calendar-decorated-week-view.xml      (content/calendar-decorated-week-view.xml)</span>
<a href="#l11.16"></a><span id="l11.16">     content/calendar/calendar-decorated-multiweek-view.xml (content/calendar-decorated-multiweek-view.xml)</span>
<a href="#l11.17"></a><span id="l11.17">     content/calendar/calendar-decorated-month-view.xml     (content/calendar-decorated-month-view.xml)</span>
<a href="#l11.18"></a><span id="l11.18">     content/calendar/calendar-dialog-utils.js              (content/calendar-dialog-utils.js)</span>
<a href="#l11.19"></a><span id="l11.19"> *   content/calendar/calendar-dnd-listener.js              (content/calendar-dnd-listener.js)</span>
<a href="#l11.20"></a><span id="l11.20">     content/calendar/calendar-invitations-manager.js       (content/calendar-invitations-manager.js)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/public/Makefile.in</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/public/Makefile.in</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -55,17 +55,16 @@ XPIDLSRCS = calIAlarm.idl \</span>
<a href="#l12.4"></a><span id="l12.4">             calICalendarManager.idl \</span>
<a href="#l12.5"></a><span id="l12.5">             calICalendarProvider.idl \</span>
<a href="#l12.6"></a><span id="l12.6">             calICalendarSearchProvider.idl \</span>
<a href="#l12.7"></a><span id="l12.7">             calICalendarView.idl \</span>
<a href="#l12.8"></a><span id="l12.8">             calICalendarViewController.idl \</span>
<a href="#l12.9"></a><span id="l12.9">             calIChangeLog.idl \</span>
<a href="#l12.10"></a><span id="l12.10">             calIDateTime.idl \</span>
<a href="#l12.11"></a><span id="l12.11">             calIDateTimeFormatter.idl \</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-            calIDecoratedView.idl \</span>
<a href="#l12.13"></a><span id="l12.13">             calIDuration.idl \</span>
<a href="#l12.14"></a><span id="l12.14">             calIErrors.idl \</span>
<a href="#l12.15"></a><span id="l12.15">             calIEvent.idl \</span>
<a href="#l12.16"></a><span id="l12.16">             calIFreeBusyProvider.idl \</span>
<a href="#l12.17"></a><span id="l12.17">             calIIcsParser.idl \</span>
<a href="#l12.18"></a><span id="l12.18">             calIIcsSerializer.idl \</span>
<a href="#l12.19"></a><span id="l12.19">             calIICSService.idl \</span>
<a href="#l12.20"></a><span id="l12.20">             calIImportExport.idl \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/public/calICalendarView.idl</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/public/calICalendarView.idl</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * The Initial Developer of the Original Code is</span>
<a href="#l13.5"></a><span id="l13.5">  *   Oracle Corporation</span>
<a href="#l13.6"></a><span id="l13.6">  * Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l13.7"></a><span id="l13.7">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l13.8"></a><span id="l13.8">  *</span>
<a href="#l13.9"></a><span id="l13.9">  * Contributor(s):</span>
<a href="#l13.10"></a><span id="l13.10">  *   Vladimir Vukicevic &lt;vladimir.vukicevic@oracle.com&gt;</span>
<a href="#l13.11"></a><span id="l13.11">  *   Dan Mosedale &lt;dan.mosedale@oracle.com&gt;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+ *   Berend Cornelius &lt;berend.cornelius@sun.com&gt;</span>
<a href="#l13.13"></a><span id="l13.13">  *</span>
<a href="#l13.14"></a><span id="l13.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.15"></a><span id="l13.15">  * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l13.16"></a><span id="l13.16">  * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.17"></a><span id="l13.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.18"></a><span id="l13.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.19"></a><span id="l13.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.20"></a><span id="l13.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -50,26 +51,64 @@ interface calIItemBase;</span>
<a href="#l13.22"></a><span id="l13.22">  *</span>
<a href="#l13.23"></a><span id="l13.23">  * @note Code that implements this interface is intended to be pure</span>
<a href="#l13.24"></a><span id="l13.24">  * widgetry and thus not have any preference dependencies.</span>
<a href="#l13.25"></a><span id="l13.25">  * Preferences and pref observers should live in the decorated views.</span>
<a href="#l13.26"></a><span id="l13.26">  */</span>
<a href="#l13.27"></a><span id="l13.27"> [scriptable, uuid(3e567ccb-2ecf-4f59-b7ca-bf42b0fbf24a)]</span>
<a href="#l13.28"></a><span id="l13.28"> interface calICalendarView : nsISupports</span>
<a href="#l13.29"></a><span id="l13.29"> {</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+  /**</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+   * Oftentimes other elements in the DOM in which a calIDecoratedView is</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+   * used want to be aware of whether or not the view is selected.  An element</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+   * whose ID is observerID can be included in that DOM, and will be set to be</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+   * enabled or disabled depending on whether the view is selected.</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+   */</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+  readonly attribute AUTF8String observerID;</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+  /**</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+   * Generally corresponds to whether or not the view has been previously shown.</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+   * Strictly speaking, it reports whether displayCalendar, startDay and endDay</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+   * are all non-null.</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+   */</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+  readonly attribute boolean initialized;</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+</span>
<a href="#l13.46"></a><span id="l13.46">   /**</span>
<a href="#l13.47"></a><span id="l13.47">    * the calendar that this view is displaying</span>
<a href="#l13.48"></a><span id="l13.48">    */</span>
<a href="#l13.49"></a><span id="l13.49">   attribute calICalendar displayCalendar;</span>
<a href="#l13.50"></a><span id="l13.50"> </span>
<a href="#l13.51"></a><span id="l13.51">   /**</span>
<a href="#l13.52"></a><span id="l13.52">    * the controller for this view</span>
<a href="#l13.53"></a><span id="l13.53">    */</span>
<a href="#l13.54"></a><span id="l13.54">   attribute calICalendarViewController controller;</span>
<a href="#l13.55"></a><span id="l13.55"> </span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+/**</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+   * If this is set to 'true', the view should not display days specified to be</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+   * non-workdays.  The implementor is responsible for obtaining what those</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+   * days are on its own.</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+   */</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+  attribute boolean workdaysOnly;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+  /**</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+   * Whether or not tasks are to be displayed in the calICalendarView</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+   */</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+  attribute boolean tasksInView;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+  /**</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+   * If set, the view will be rotated (i.e time on top, date at left)</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+   */</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+  attribute boolean rotated;</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+  /**</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+   * Whether or not completed tasks are shown in the calICalendarView</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+   */</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+  attribute boolean showCompleted;</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+</span>
<a href="#l13.78"></a><span id="l13.78">   /**</span>
<a href="#l13.79"></a><span id="l13.79">    * Ensure that the given date is visible; the view is free</span>
<a href="#l13.80"></a><span id="l13.80">    * to show more dates than the given date (e.g. week view</span>
<a href="#l13.81"></a><span id="l13.81">    * would show the entire week).</span>
<a href="#l13.82"></a><span id="l13.82">    */</span>
<a href="#l13.83"></a><span id="l13.83">   void showDate(in calIDateTime aDate);</span>
<a href="#l13.84"></a><span id="l13.84"> </span>
<a href="#l13.85"></a><span id="l13.85">   /**</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineat">@@ -93,16 +132,26 @@ interface calICalendarView : nsISupports</span>
<a href="#l13.87"></a><span id="l13.87">    * disjoint dates, this will be the latest date that's displayed.</span>
<a href="#l13.88"></a><span id="l13.88">    *</span>
<a href="#l13.89"></a><span id="l13.89">    * Note that this won't be equivalent to the aEndDate passed to</span>
<a href="#l13.90"></a><span id="l13.90">    * setDateRange, because that date isn't actually displayed!</span>
<a href="#l13.91"></a><span id="l13.91">    */</span>
<a href="#l13.92"></a><span id="l13.92">   readonly attribute calIDateTime endDate;</span>
<a href="#l13.93"></a><span id="l13.93"> </span>
<a href="#l13.94"></a><span id="l13.94">   /**</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+   * The first day shown in the embedded view</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+   */</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+  readonly attribute calIDateTime startDay;</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+  /**</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+   * The last day shown in the embedded view</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+   */</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+  readonly attribute calIDateTime endDay;</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+  /**</span>
<a href="#l13.105"></a><span id="l13.105">    * True if this view supports disjoint dates</span>
<a href="#l13.106"></a><span id="l13.106">    */</span>
<a href="#l13.107"></a><span id="l13.107">   readonly attribute boolean supportsDisjointDates;</span>
<a href="#l13.108"></a><span id="l13.108"> </span>
<a href="#l13.109"></a><span id="l13.109">   /**</span>
<a href="#l13.110"></a><span id="l13.110">    * True if this view currently has a disjoint date set.</span>
<a href="#l13.111"></a><span id="l13.111">    */</span>
<a href="#l13.112"></a><span id="l13.112">   readonly attribute boolean hasDisjointDates;</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineat">@@ -154,13 +203,43 @@ interface calICalendarView : nsISupports</span>
<a href="#l13.114"></a><span id="l13.114"> </span>
<a href="#l13.115"></a><span id="l13.115">   /**</span>
<a href="#l13.116"></a><span id="l13.116">    * Get or set the timezone that the view's elements should be displayed in.</span>
<a href="#l13.117"></a><span id="l13.117">    * Setting this does not refresh the view.</span>
<a href="#l13.118"></a><span id="l13.118">    */</span>
<a href="#l13.119"></a><span id="l13.119">   attribute AUTF8String timezone;</span>
<a href="#l13.120"></a><span id="l13.120"> </span>
<a href="#l13.121"></a><span id="l13.121">   /**</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+   * Ensures that the given date is visible, and that the view is centered</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+   * around this date.  aDate becomes the selectedDay of the view.  Calling</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+   * this function with the current selectedDay effectively refreshes the view</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineplus">+   *</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineplus">+   * @param aDate       the date that must be shown in the view and becomes</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineplus">+   *                    the selected day</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+   */</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+  void goToDay(in calIDateTime aDate);</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineplus">+</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+  /**</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+   * Moves the view a specific number of pages.  Negative numbers correspond to</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+   * moving the view backwards.  Note that it is up to the view to determine</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+   * how the selected day ought to move as well.</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+   *</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+   * @param aNumber       the number of pages to move the view</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+   */</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+  void moveView(in long aNumber);</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+  /**</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+   * gets the description of the range displayed by the view</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+   */</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+  AString getRangeDescription();</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+  /**</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+   * The type of the view e.g &quot;day&quot;, &quot;week&quot;, &quot;multiweek&quot; or &quot;month&quot; that refers</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+   * to the displayed time period.</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+   */</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+  readonly attribute string type;</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+  /**</span>
<a href="#l13.151"></a><span id="l13.151">    * removes the dropshadows that are inserted into childelements during a</span>
<a href="#l13.152"></a><span id="l13.152">    * drag and drop session</span>
<a href="#l13.153"></a><span id="l13.153">    */</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+</span>
<a href="#l13.155"></a><span id="l13.155">   void removeDropShadows();</span>
<a href="#l13.156"></a><span id="l13.156"> };</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

